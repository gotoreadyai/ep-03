const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/LoginPage-D2iw1kim.js","assets/radix-ui-LETSITqz.js","assets/react-vendor-nLIND2rL.js","assets/refine-core-hvoUa3GG.js","assets/NarrowCol-D6-3Hnlm.js","assets/ui-utils-B27Pbv8h.js","assets/utils-Bi50OPJh.js","assets/refine-ui-CgT0brDl.js","assets/forms-Dah7oaIm.js","assets/tables-CU6sXyU_.js","assets/RegisterFlow-zr4ywZ35.js","assets/ForgotPasswordPage-Ds3vNWHe.js","assets/UpdatePasswordPage-CNW1z1zd.js"])))=>i.map(i=>d[i]);
var u4=Object.defineProperty;var d4=(t,e,s)=>e in t?u4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var rn=(t,e,s)=>d4(t,typeof e!="symbol"?e+"":e,s);import{j as r,R as Qw,I as Yw,F as Xw,S as Up,a as e1,P as h4,C as t1,b as s1,V as f4,c as m4,d as n1,e as p4,T as r1,f as x4,g as i1,h as a1,i as g4,k as o1,l as y4,L as l1,m as c1,n as b4,o as j4,p as u1,q as w4,r as v4,s as d1,t as h1,u as f1,v as m1,w as k4,x as p1,y as N4,z as hr,A as x1,B as Wp,D as $n,E as Te,G as S4,H as C4,J as z4,K as g1,M as _4,N as A4,O as T4,Q as y1,U as E4,W as b1,X as D4,Y as j1,Z as w1,_ as M4,$ as v1,a0 as P4,a1 as I4,a2 as Od,a3 as k1,a4 as O4,a5 as N1,a6 as S1,a7 as C1,a8 as Rd,a9 as R4,aa as L4,ab as F4,ac as $4,ad as B4,ae as q4,af as V4,ag as U4,ah as W4,ai as K4,aj as H4,ak as G4,al as w0}from"./radix-ui-LETSITqz.js";import{k as J4,a as j,l as Z,n as Ba,N as dn,e as pe,L as Ke,d as gn,o as Ld,O as Kp,u as Qt,R as ae,h as $o,p as Fd,b as z1,j as Z4,B as Q4}from"./react-vendor-nLIND2rL.js";import{t as G,c as _1,a as A1,v as Y4,o as co,u as qa,b as Hp,n as Xl,d as bu,e as X4,f as T1,E as e_,g as Gp,h as xl,m as Is,i as t_,j as s_,k as Dr,s as Zh,r as n_,l as Bo,p as fa,q as r_,M as Va,T as i_}from"./utils-Bi50OPJh.js";import{n as wt,M as $d,d as E1,$ as Y,e as Hi,X as hn,f as lr,I as D1,i as tt,E as Jp,o as Zp,k as M1,j as Yt,s as P1,l as a_,Q as o_,m as l_,p as c_,D as u_}from"./refine-core-hvoUa3GG.js";import{c as d_,_ as Bd,k as ni,I as h_}from"./refine-ui-CgT0brDl.js";import{t as f_,c as m_,U as gl,M as qd,G as cr,a as Vd,S as ju,b as Ud,C as ls,d as Ua,e as Ds,X as fn,f as ec,L as Wd,T as wu,g as qt,h as St,i as uo,j as ge,F as p_,A as Ue,P as Je,k as js,l as Pi,B as Se,m as x_,n as g_,o as y_,p as He,q as I1,r as b_,W as tc,s as Jt,H as j_,I as Gi,u as st,v as Pe,w as Jr,x as ws,y as ho,z as w_,R as Qp,D as qr,E as v_,J as Ze,K as pt,N as vu,O as ri,Q as dt,V as ii,Y as O1,Z as cs,_ as Tt,$ as yl,a0 as k_,a1 as ft,a2 as N_,a3 as S_,a4 as R1,a5 as Jo,a6 as Kd,a7 as Bn,a8 as L1,a9 as C_,aa as z_,ab as Da,ac as __,ad as A_,ae as T_,af as E_,ag as D_,ah as M_,ai as P_,aj as I_,ak as O_,al as R_,am as L_,an as F_,ao as ku,ap as $_,aq as B_,ar as q_,as as V_,at as U_,au as W_,av as F1,aw as Et,ax as Vr,ay as Os,az as Nu,aA as Hd,aB as $1,aC as Ii,aD as B1,aE as An,aF as Vt,aG as K_,aH as H_,aI as q1,aJ as bm,aK as G_,aL as J_,aM as Z_,aN as v0,aO as Q_,aP as Y_,aQ as Yp,aR as X_,aS as eA,aT as tA,aU as sA,aV as k0}from"./ui-utils-B27Pbv8h.js";import{a as N0,o as S0,b as nA,c as C0,n as z0,s as _0}from"./forms-Dah7oaIm.js";import{w as rA,R as ht,A as Gd,C as Ms,X as ys,Y as is,T as gt,a as Zr,P as Su,b as Cu,c as Tn,B as sc,d as Wa,L as V1,e as Xp,F as iA,f as aA,g as oA,h as Ma,S as U1,Z as W1,i as K1,j as lA,k as cA,l as uA,m as dA,n as hA,o as fA,p as mA,q as pA}from"./tables-CU6sXyU_.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function s(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=s(i);fetch(i.href,a)}})();var Cc={},A0;function xA(){if(A0)return Cc;A0=1;var t=J4();return Cc.createRoot=t.createRoot,Cc.hydrateRoot=t.hydrateRoot,Cc}var gA=xA();const yA="https://hqsyimochfcfqahcuprn.supabase.co",bA="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhxc3lpbW9jaGZjZnFhaGN1cHJuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM4NjU4NTYsImV4cCI6MjA2OTQ0MTg1Nn0.KutvVrkDKuVyvrYQosU3SI6QrrMnWqDCSZ2E3fhCteI",oe=d_(yA,bA,{db:{schema:"public"},auth:{persistSession:!0}}),U=(...t)=>f_(m_(t)),jA={invalid_credentials:"Nieprawidłowy email lub hasło.","Invalid login credentials":"Nieprawidłowy email lub hasło.",email_not_confirmed:"Email nie został potwierdzony.","Email not confirmed":"Email nie został potwierdzony.",user_not_found:"Nie znaleziono użytkownika.","User not found":"Nie znaleziono użytkownika.",network_error:"Błąd połączenia z serwerem.","Too many requests":"Zbyt wiele prób. Spróbuj ponownie za chwilę."},wA=t=>{if(!t)return{message:"Nieznany błąd",name:"UnknownError",statusCode:500};const e=t.message||t.error_description||"";for(const[s,n]of Object.entries(jA))if(e.includes(s))return{message:n,name:"LoginError",statusCode:t.code==="invalid_credentials"?401:400};return{message:e||"Błąd logowania",name:"LoginError",statusCode:400}},H1={login:async(t,e)=>{try{if(!t||!e)return{success:!1,error:"Email i hasło są wymagane"};const{data:s,error:n}=await oe.auth.signInWithPassword({email:t.trim().toLowerCase(),password:e});if(n)return{success:!1,error:wA(n).message};if(!s.session)return{success:!1,error:"Nie udało się utworzyć sesji"};const{data:i}=await oe.from("users").select("role").eq("id",s.user.id).single();return{success:!0,redirectTo:i?.role==="admin"?"/admin/dashboard/overview":i?.role==="teacher"?"/teacher/dashboard/overview":i?.role==="student"?"/student/dashboard":"/profiles"}}catch(s){return{success:!1,error:s.message||"Nieznany błąd"}}},loginForRefine:async(t,e)=>{const s=await H1.login(t,e);return s.success?s:{success:!1,error:{message:s.error,name:"LoginError",statusCode:400}}},checkAuth:async()=>{const{data:{session:t}}=await oe.auth.getSession();return!!t}},vA={user_already_exists:"Konto z tym adresem email już istnieje","User already registered":"Konto z tym adresem email już istnieje","already exists":"Konto z tym adresem email już istnieje",weak_password:"Hasło musi mieć co najmniej 6 znaków","Password should be at least":"Hasło musi mieć co najmniej 6 znaków","Password cannot be longer than 72":"Hasło nie może być dłuższe niż 72 znaki",invalid_email:"Nieprawidłowy format adresu email","Invalid email":"Nieprawidłowy format adresu email",over_email_send_rate_limit:"Za szybko! Poczekaj 2 sekundy przed ponowną próbą"},T0=t=>{if(!t)return{message:"Nieznany błąd",name:"UnknownError",statusCode:500};const e=t.message||"";for(const[s,n]of Object.entries(vA))if(e.includes(s)){let i=400;return s.includes("already")&&(i=409),s.includes("email_send_rate")&&(i=429),{message:n,name:"RegisterError",statusCode:i}}return{message:e||"Rejestracja nie powiodła się",name:"RegisterError",statusCode:400}},G1={register:async(t,e,s)=>{try{const{data:n,error:i}=await oe.auth.signUp({email:t.trim().toLowerCase(),password:e,options:{data:{full_name:s.trim(),role:"student"},emailRedirectTo:`${window.location.origin}/login?verified=true`}});return i?{success:!1,error:T0(i).message}:n.user?{success:!0,needsEmailConfirmation:!n.session}:{success:!1,error:"Rejestracja nie powiodła się"}}catch(n){return{success:!1,error:n.message||"Błąd rejestracji"}}},registerForRefine:async(t,e,s)=>{const n=await G1.register(t,e,s);return n.success?{success:!0,successNotification:n.needsEmailConfirmation?{message:"Rejestracja udana!",description:"Sprawdź email aby potwierdzić konto."}:{message:"Rejestracja udana!",description:"Możesz się teraz zalogować."}}:{success:!1,error:T0({message:n.error})}}},kA={"User not found":"Nie znaleziono użytkownika z tym adresem email","Invalid email":"Nieprawidłowy format adresu email",over_email_send_rate_limit:"Za szybko! Poczekaj chwilę przed kolejną próbą",reset_password_rate_limit:"Zbyt wiele prób. Spróbuj ponownie za kilka minut"},E0=t=>{if(!t)return{message:"Nieznany błąd",name:"UnknownError",statusCode:500};const e=t.message||"";for(const[s,n]of Object.entries(kA))if(e.includes(s))return{message:n,name:"ForgotPasswordError",statusCode:s.includes("rate_limit")?429:400};return{message:e||"Błąd podczas wysyłania emaila",name:"ForgotPasswordError",statusCode:400}},J1={sendResetEmail:async t=>{try{const{error:e}=await oe.auth.resetPasswordForEmail(t.trim().toLowerCase(),{redirectTo:`${window.location.origin}/update-password`});return e?{success:!1,error:E0(e).message}:{success:!0}}catch(e){return{success:!1,error:e.message||"Błąd podczas wysyłania emaila"}}},sendResetEmailForRefine:async t=>{const e=await J1.sendResetEmail(t);return e.success?{success:!0,successNotification:{message:"Email wysłany!",description:"Sprawdź swoją skrzynkę odbiorczą"}}:{success:!1,error:E0({message:e.error})}}},NA={"New password should be different":"Nowe hasło musi być inne niż obecne","Password should be at least":"Hasło musi mieć co najmniej 6 znaków","Invalid token":"Link wygasł lub jest nieprawidłowy",session_not_found:"Sesja wygasła. Spróbuj ponownie"},D0=t=>{if(!t)return{message:"Nieznany błąd",name:"UnknownError",statusCode:500};const e=t.message||"";for(const[s,n]of Object.entries(NA))if(e.includes(s))return{message:n,name:"UpdatePasswordError",statusCode:s.includes("token")||s.includes("session")?401:400};return{message:e||"Błąd aktualizacji hasła",name:"UpdatePasswordError",statusCode:400}},Z1={checkSession:async()=>{try{const{data:t}=await oe.auth.getSession(),s=new URLSearchParams(window.location.hash.substring(1)).get("type");return!t.session&&s!=="recovery"?{isValid:!1,error:"Link wygasł lub jest nieprawidłowy"}:{isValid:!0}}catch{return{isValid:!1,error:"Błąd weryfikacji sesji"}}},updatePassword:async t=>{try{const{error:e}=await oe.auth.updateUser({password:t});return e?{success:!1,error:D0(e).message}:{success:!0}}catch(e){return{success:!1,error:e.message||"Błąd aktualizacji hasła"}}},updatePasswordForRefine:async t=>{const e=await Z1.updatePassword(t);return e.success?{success:!0,redirectTo:"/login?passwordChanged=true"}:{success:!1,error:D0({message:e.error})}}};class SA{constructor(){rn(this,"cache",null);rn(this,"lastFetch",0);rn(this,"CACHE_DURATION",300*1e3);rn(this,"fetchPromise",null)}async get(e=!1){const s=Date.now();if(!e&&this.cache&&s-this.lastFetch<this.CACHE_DURATION)return this.cache;if(this.fetchPromise)return this.fetchPromise;this.fetchPromise=this.fetchUser();const n=await this.fetchPromise;return this.fetchPromise=null,n}async fetchUser(){try{const{data:{session:e}}=await oe.auth.getSession();if(!e?.user)return this.clear(),null;const{data:s,error:n}=await oe.from("users").select("*").eq("id",e.user.id).single();if(n||!s){console.error("Error fetching user data:",n);const a={id:e.user.id,email:e.user.email||"",full_name:e.user.user_metadata?.full_name||e.user.email?.split("@")[0]||"User",vendor_id:1,role:"student"};return this.set(a),a}const i={id:s.id,email:s.email,full_name:s.full_name,vendor_id:s.vendor_id,role:s.role,is_active:s.is_active,created_at:s.created_at};return this.set(i),i}catch(e){return console.error("Error in fetchUser:",e),this.clear(),null}}set(e){this.cache=e,this.lastFetch=Date.now()}clear(){this.cache=null,this.lastFetch=0,this.fetchPromise=null}async refresh(){return this.get(!0)}}const Rr=new SA;oe.auth.onAuthStateChange((t,e)=>{t==="SIGNED_OUT"||!e?Rr.clear():(t==="SIGNED_IN"||t==="TOKEN_REFRESHED")&&Rr.get(!0)});const Qh={logout:async()=>{try{Rr.clear();const{error:t}=await oe.auth.signOut();return t?{success:!1,error:{message:"Błąd podczas wylogowania",name:"LogoutError",statusCode:500}}:{success:!0,redirectTo:"/login"}}catch{return{success:!1,error:{message:"Nieoczekiwany błąd podczas wylogowania",name:"LogoutError",statusCode:500}}}},check:async()=>{try{const{data:{session:t}}=await oe.auth.getSession();if(!t)return{authenticated:!1,redirectTo:"/login"};const e=t.expires_at;return e&&e*1e3<Date.now()?{authenticated:!1,redirectTo:"/login"}:{authenticated:!0}}catch{return{authenticated:!1,redirectTo:"/login"}}},handleError:async t=>(console.error("Auth error:",t),t?.statusCode===401?(Rr.clear(),{redirectTo:"/login",logout:!0,error:t}):{error:t})},CA={login:async({email:t,password:e})=>{const s=await H1.login(t,e);return s.success&&await Rr.refresh(),s},logout:async()=>await Qh.logout(),check:async()=>await Qh.check(),getIdentity:async()=>await Rr.get(),getPermissions:async()=>(await Rr.get())?.role||null,register:async({email:t,password:e,name:s})=>await G1.registerForRefine(t,e,s),forgotPassword:async({email:t})=>await J1.sendResetEmailForRefine(t),updatePassword:async({password:t})=>{const e=await Z1.updatePasswordForRefine(t);return e.success&&await Rr.clear(),e},onError:async t=>await Qh.handleError(t)},ex=({isLoading:t,isError:e,loadingText:s="Loading...",errorMsg:n="Error loading data"})=>t?r.jsx("div",{className:"p-6 text-gray-600 animate-reverse-pulse",children:s}):e?r.jsx("div",{className:"p-6 text-red-500",children:n}):null;console.log("1. Login index.tsx - ładowanie modułu");const zA=j.lazy(()=>(console.log("2. Login - rozpoczęcie lazy load"),Bd(()=>import("./LoginPage-D2iw1kim.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])).then(t=>(console.log("3. Login - moduł załadowany",t),t)))),_A=()=>(console.log("4. Login - renderowanie fallback"),r.jsx("div",{className:"flex items-center justify-center min-h-screen",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-4 text-gray-600",children:"Ładowanie logowania..."})]})})),Q1=r.jsx(Z,{path:"/login",element:r.jsx(j.Suspense,{fallback:r.jsx(_A,{}),children:r.jsx(zA,{})})});console.log("5. Login module exported",Q1);const AA=j.lazy(()=>Bd(()=>import("./RegisterFlow-zr4ywZ35.js"),__vite__mapDeps([10,1,2,3,5,4,6,7,8,9]))),TA=()=>r.jsx("div",{className:"flex items-center justify-center min-h-screen",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto"}),r.jsx("p",{className:"mt-4 text-gray-600",children:"Przygotowywanie rejestracji..."})]})}),EA=r.jsx(Z,{path:"/register/*",element:r.jsx(j.Suspense,{fallback:r.jsx(TA,{}),children:r.jsx(AA,{})})}),DA=j.lazy(()=>Bd(()=>import("./ForgotPasswordPage-Ds3vNWHe.js"),__vite__mapDeps([11,1,2,3,4,5,6,7,8,9]))),MA=()=>r.jsx("div",{className:"flex items-center justify-center min-h-screen",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-yellow-600 mx-auto"}),r.jsx("p",{className:"mt-4 text-gray-600",children:"Ładowanie formularza resetowania..."})]})}),PA=r.jsx(Z,{path:"/forgot-password",element:r.jsx(j.Suspense,{fallback:r.jsx(MA,{}),children:r.jsx(DA,{})})}),IA=j.lazy(()=>Bd(()=>import("./UpdatePasswordPage-CNW1z1zd.js"),__vite__mapDeps([12,1,2,3,4,5,6,7,8,9]))),OA=()=>r.jsx("div",{className:"flex items-center justify-center min-h-screen",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto"}),r.jsx("p",{className:"mt-4 text-gray-600",children:"Weryfikacja linku resetowania..."})]})}),RA=r.jsx(Z,{path:"/update-password",element:r.jsx(j.Suspense,{fallback:r.jsx(OA,{}),children:r.jsx(IA,{})})}),bl=j.forwardRef(({className:t,...e},s)=>r.jsx(Qw,{ref:s,className:U("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...e}));bl.displayName=Qw.displayName;const LA=j.forwardRef(({className:t,...e},s)=>r.jsx(Yw,{ref:s,className:U("aspect-square h-full w-full object-cover",t),...e}));LA.displayName=Yw.displayName;const jl=j.forwardRef(({className:t,...e},s)=>r.jsx(Xw,{ref:s,className:U("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...e}));jl.displayName=Xw.displayName;function _s({className:t,...e}){return r.jsx("div",{className:U("animate-pulse rounded-md bg-primary/10",t),...e})}const Y1=({className:t="",showRole:e=!0,showEmail:s=!0,compact:n=!1})=>{const{data:i,isLoading:a,error:o}=wt(),l=f=>{switch(f){case"admin":return r.jsx(ju,{className:"h-3 w-3"});case"teacher":return r.jsx(Vd,{className:"h-3 w-3"});case"student":return r.jsx(cr,{className:"h-3 w-3"});default:return r.jsx(gl,{className:"h-3 w-3"})}},c=f=>{switch(f){case"admin":return"Administrator";case"teacher":return"Nauczyciel";case"student":return"Uczeń";default:return"Użytkownik"}},u=f=>{switch(f){case"admin":return"text-purple-600 bg-purple-50";case"teacher":return"text-blue-600 bg-blue-50";case"student":return"text-green-600 bg-green-50";default:return"text-gray-600 bg-gray-50"}};if(a)return r.jsxs("div",{className:`flex items-center space-x-3 p-3 ${t}`,children:[r.jsx(_s,{className:"h-10 w-10 rounded-full"}),r.jsxs("div",{className:"space-y-1.5",children:[r.jsx(_s,{className:"h-4 w-28"}),r.jsx(_s,{className:"h-3 w-20"}),e&&r.jsx(_s,{className:"h-3 w-16"})]})]});if(o||!i)return r.jsxs("div",{className:`flex items-center space-x-3 p-3 text-muted-foreground ${t}`,children:[r.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-100 flex items-center justify-center",children:r.jsx(gl,{className:"h-5 w-5 text-gray-400"})}),r.jsxs("div",{className:"text-sm",children:[r.jsx("div",{className:"font-medium text-gray-500",children:"Nie zalogowano"}),r.jsx("div",{className:"text-xs opacity-70",children:"Brak danych użytkownika"})]})]});const h=(f=>{if(!f)return"U";const m=f.trim().split(" ");return m.length>=2?`${m[0][0]}${m[m.length-1][0]}`.toUpperCase():f.slice(0,2).toUpperCase()})(i.full_name||i.email);return n?r.jsxs("div",{className:`flex items-center space-x-2 p-2 ${t}`,children:[r.jsx(bl,{className:"h-8 w-8",children:r.jsx(jl,{className:"bg-gradient-to-br from-purple-500 to-pink-500 text-white text-xs",children:h})}),r.jsx("div",{className:"flex-1 min-w-0",children:r.jsx("div",{className:"font-medium text-sm truncate",children:i.full_name})})]}):r.jsxs("div",{className:`flex items-center space-x-3 px-4 pt-4 rounded-lg bg-white/50 backdrop-blur-sm border border-purple-100/20 ${t}`,children:[r.jsx(bl,{className:"h-12 w-12 ring-2 ring-purple-100 ring-offset-2",children:r.jsx(jl,{className:"bg-gradient-to-br from-purple-500 to-pink-500 text-white font-medium",children:h})}),r.jsxs("div",{className:"flex-1 min-w-0 space-y-1",children:[r.jsx("div",{className:"font-semibold text-gray-900 truncate",title:i.full_name,children:i.full_name}),s&&i.email&&r.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-500",children:[r.jsx(qd,{className:"h-3 w-3"}),r.jsx("span",{className:"truncate",title:i.email,children:i.email})]}),e&&i.role&&r.jsx("div",{className:"inline-flex items-center gap-1.5",children:r.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full text-xs font-medium ${u(i.role)}`,children:[l(i.role),c(i.role)]})})]})]})},FA=Ud("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-3.5 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),we=j.forwardRef(({className:t,variant:e,...s},n)=>r.jsx("div",{ref:n,role:"alert",className:U(FA({variant:e}),t),...s}));we.displayName="Alert";const $A=j.forwardRef(({className:t,...e},s)=>r.jsx("h5",{ref:s,className:U("mb-1 font-medium leading-none tracking-tight",t),...e}));$A.displayName="AlertTitle";const ve=j.forwardRef(({className:t,...e},s)=>r.jsx("div",{ref:s,className:U("text-sm [&_p]:leading-relaxed",t),...e}));ve.displayName="AlertDescription";const BA=Ud("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function V({className:t,variant:e,asChild:s=!1,...n}){const i=s?Up:"span";return r.jsx(i,{"data-slot":"badge",className:U(BA({variant:e}),t),...n})}const qA=j.forwardRef(({...t},e)=>r.jsx("nav",{ref:e,"aria-label":"breadcrumb",...t}));qA.displayName="Breadcrumb";const VA=j.forwardRef(({className:t,...e},s)=>r.jsx("ol",{ref:s,className:U("flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",t),...e}));VA.displayName="BreadcrumbList";const UA=j.forwardRef(({className:t,...e},s)=>r.jsx("li",{ref:s,className:U("inline-flex items-center gap-1.5",t),...e}));UA.displayName="BreadcrumbItem";const WA=j.forwardRef(({asChild:t,className:e,...s},n)=>{const i=t?Up:"a";return r.jsx(i,{ref:n,className:U("transition-colors hover:text-foreground",e),...s})});WA.displayName="BreadcrumbLink";const KA=j.forwardRef(({className:t,...e},s)=>r.jsx("span",{ref:s,role:"link","aria-disabled":"true","aria-current":"page",className:U("font-normal text-foreground",t),...e}));KA.displayName="BreadcrumbPage";const HA=Ud("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),D=j.forwardRef(({className:t,variant:e,size:s,asChild:n=!1,...i},a)=>{const o=n?Up:"button";return r.jsx(o,{className:U(HA({variant:e,size:s,className:t})),ref:a,...i})});D.displayName="Button";const P=j.forwardRef(({className:t,...e},s)=>r.jsx("div",{ref:s,className:U("rounded-xl border bg-card text-card-foreground shadow flex flex-col overflow-hidden",t),...e}));P.displayName="Card";const F=j.forwardRef(({className:t,...e},s)=>r.jsx("div",{ref:s,className:U("flex flex-col space-y-1.5 p-6 pb-3 bg-pink-200/25",t),...e}));F.displayName="CardHeader";const L=j.forwardRef(({className:t,...e},s)=>r.jsx("div",{ref:s,className:U("text-lg font-semibold leading-tight tracking-tight pt-3",t),...e}));L.displayName="CardTitle";const Jd=j.forwardRef(({className:t,...e},s)=>r.jsx("div",{ref:s,className:U("text-sm text-muted-foreground",t),...e}));Jd.displayName="CardDescription";const I=j.forwardRef(({className:t,...e},s)=>r.jsx("div",{ref:s,className:U("p-3 lg:p-6 pt-3 space-y-3 flex-1 bg-background",t),...e}));I.displayName="CardContent";const GA=j.forwardRef(({className:t,...e},s)=>r.jsx("div",{ref:s,className:U("flex items-center justify-between p-6 pt-0",t),...e}));GA.displayName="CardFooter";const JA=Ud("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Oi=j.forwardRef(({className:t,...e},s)=>r.jsx(e1,{ref:s,className:U(JA(),t),...e}));Oi.displayName=e1.displayName;j.createContext({});j.createContext({});const te=j.forwardRef(({className:t,type:e,...s},n)=>r.jsx("input",{type:e,className:U("flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:n,...s}));te.displayName="Input";const ZA=j.forwardRef(({className:t,align:e="center",sideOffset:s=4,...n},i)=>r.jsx(h4,{children:r.jsx(t1,{ref:i,align:e,sideOffset:s,className:U("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",t),...n})}));ZA.displayName=t1.displayName;const bt=j.forwardRef(({className:t,children:e,...s},n)=>r.jsxs(s1,{ref:n,className:U("relative overflow-hidden",t),...s,children:[r.jsx(f4,{className:"h-full w-full rounded-[inherit]",children:e}),r.jsx(X1,{}),r.jsx(m4,{})]}));bt.displayName=s1.displayName;const X1=j.forwardRef(({className:t,orientation:e="vertical",...s},n)=>r.jsx(n1,{ref:n,orientation:e,className:U("flex touch-none select-none transition-colors",e==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",e==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...s,children:r.jsx(p4,{className:"relative flex-1 rounded-full bg-border"})}));X1.displayName=n1.displayName;const Ee=w4,De=v4,_e=j.forwardRef(({className:t,children:e,...s},n)=>r.jsxs(r1,{ref:n,className:U("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-background px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...s,children:[e,r.jsx(x4,{asChild:!0,children:r.jsx(ls,{className:"h-4 w-4 opacity-50"})})]}));_e.displayName=r1.displayName;const ev=j.forwardRef(({className:t,...e},s)=>r.jsx(i1,{ref:s,className:U("flex cursor-default items-center justify-center py-1",t),...e,children:r.jsx(Ua,{className:"h-4 w-4"})}));ev.displayName=i1.displayName;const tv=j.forwardRef(({className:t,...e},s)=>r.jsx(a1,{ref:s,className:U("flex cursor-default items-center justify-center py-1",t),...e,children:r.jsx(ls,{className:"h-4 w-4"})}));tv.displayName=a1.displayName;const Ae=j.forwardRef(({className:t,children:e,position:s="popper",...n},i)=>r.jsx(g4,{children:r.jsxs(o1,{ref:i,className:U("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:s,...n,children:[r.jsx(ev,{}),r.jsx(y4,{className:U("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:e}),r.jsx(tv,{})]})}));Ae.displayName=o1.displayName;const QA=j.forwardRef(({className:t,...e},s)=>r.jsx(l1,{ref:s,className:U("px-2 py-1.5 text-sm font-semibold",t),...e}));QA.displayName=l1.displayName;const ee=j.forwardRef(({className:t,children:e,...s},n)=>r.jsxs(c1,{ref:n,className:U("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...s,children:[r.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:r.jsx(b4,{children:r.jsx(Ds,{className:"h-4 w-4"})})}),r.jsx(j4,{children:e})]}));ee.displayName=c1.displayName;const YA=j.forwardRef(({className:t,...e},s)=>r.jsx(u1,{ref:s,className:U("-mx-1 my-1 h-px bg-muted",t),...e}));YA.displayName=u1.displayName;const Zd=j.forwardRef(({className:t,orientation:e="horizontal",decorative:s=!0,...n},i)=>r.jsx(d1,{ref:i,decorative:s,orientation:e,className:U("shrink-0 bg-border",e==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...n}));Zd.displayName=d1.displayName;function fr({className:t,...e}){return r.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:r.jsx("table",{"data-slot":"table",className:U("w-full caption-bottom text-sm",t),...e})})}function mr({className:t,...e}){return r.jsx("thead",{"data-slot":"table-header",className:U("[&_tr]:border-b",t),...e})}function pr({className:t,...e}){return r.jsx("tbody",{"data-slot":"table-body",className:U("[&_tr:last-child]:border-0",t),...e})}function Nt({className:t,...e}){return r.jsx("tr",{"data-slot":"table-row",className:U("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...e})}function de({className:t,...e}){return r.jsx("th",{"data-slot":"table-head",className:U("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...e})}function ue({className:t,...e}){return r.jsx("td",{"data-slot":"table-cell",className:U("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...e})}const mn=j.forwardRef(({className:t,...e},s)=>r.jsx("textarea",{className:U("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:s,...e}));mn.displayName="Textarea";const tx=k4,Qd=j.forwardRef(({className:t,...e},s)=>r.jsx(h1,{ref:s,className:U("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",t),...e}));Qd.displayName=h1.displayName;const Ks=j.forwardRef(({className:t,...e},s)=>r.jsx(f1,{ref:s,className:U("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",t),...e}));Ks.displayName=f1.displayName;const Hs=j.forwardRef(({className:t,...e},s)=>r.jsx(m1,{ref:s,className:U("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...e}));Hs.displayName=m1.displayName;const mt=j.forwardRef(({className:t,...e},s)=>r.jsx(p1,{ref:s,className:U("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...e,children:r.jsx(N4,{className:U("flex items-center justify-center text-current"),children:r.jsx(Ds,{className:"h-4 w-4"})})}));mt.displayName=p1.displayName;var Yd="Switch",[XA,rY]=Wp(Yd),[eT,tT]=XA(Yd),sv=j.forwardRef((t,e)=>{const{__scopeSwitch:s,name:n,checked:i,defaultChecked:a,required:o,disabled:l,value:c="on",onCheckedChange:u,form:d,...h}=t,[f,m]=j.useState(null),p=hr(e,w=>m(w)),x=j.useRef(!1),g=f?d||!!f.closest("form"):!0,[y,b]=x1({prop:i,defaultProp:a??!1,onChange:u,caller:Yd});return r.jsxs(eT,{scope:s,checked:y,disabled:l,children:[r.jsx($n.button,{type:"button",role:"switch","aria-checked":y,"aria-required":o,"data-state":av(y),"data-disabled":l?"":void 0,disabled:l,value:c,...h,ref:p,onClick:Te(t.onClick,w=>{b(S=>!S),g&&(x.current=w.isPropagationStopped(),x.current||w.stopPropagation())})}),g&&r.jsx(iv,{control:f,bubbles:!x.current,name:n,value:c,checked:y,required:o,disabled:l,form:d,style:{transform:"translateX(-100%)"}})]})});sv.displayName=Yd;var nv="SwitchThumb",rv=j.forwardRef((t,e)=>{const{__scopeSwitch:s,...n}=t,i=tT(nv,s);return r.jsx($n.span,{"data-state":av(i.checked),"data-disabled":i.disabled?"":void 0,...n,ref:e})});rv.displayName=nv;var sT="SwitchBubbleInput",iv=j.forwardRef(({__scopeSwitch:t,control:e,checked:s,bubbles:n=!0,...i},a)=>{const o=j.useRef(null),l=hr(o,a),c=S4(s),u=C4(e);return j.useEffect(()=>{const d=o.current;if(!d)return;const h=window.HTMLInputElement.prototype,m=Object.getOwnPropertyDescriptor(h,"checked").set;if(c!==s&&m){const p=new Event("click",{bubbles:n});m.call(d,s),d.dispatchEvent(p)}},[c,s,n]),r.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:s,...i,tabIndex:-1,ref:l,style:{...i.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});iv.displayName=sT;function av(t){return t?"checked":"unchecked"}var ov=sv,nT=rv;const fs=j.forwardRef(({className:t,...e},s)=>r.jsx(ov,{className:U("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...e,ref:s,children:r.jsx(nT,{className:U("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));fs.displayName=ov.displayName;const ba=_4,ja=A4,wa=T4,gi=j.forwardRef(({className:t,sideOffset:e=4,...s},n)=>r.jsx(z4,{children:r.jsx(g1,{ref:n,sideOffset:e,className:U("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",t),...s})}));gi.displayName=g1.displayName;const pn=M4,rT=E4,lv=j.forwardRef(({className:t,...e},s)=>r.jsx(y1,{ref:s,className:U("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e}));lv.displayName=y1.displayName;const en=j.forwardRef(({className:t,children:e,...s},n)=>r.jsxs(rT,{children:[r.jsx(lv,{}),r.jsxs(b1,{ref:n,className:U("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...s,children:[e,r.jsxs(D4,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[r.jsx(fn,{className:"h-4 w-4"}),r.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));en.displayName=b1.displayName;const tn=({className:t,...e})=>r.jsx("div",{className:U("flex flex-col space-y-1.5 text-center sm:text-left",t),...e});tn.displayName="DialogHeader";const Ka=({className:t,...e})=>r.jsx("div",{className:U("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...e});Ka.displayName="DialogFooter";const sn=j.forwardRef(({className:t,...e},s)=>r.jsx(j1,{ref:s,className:U("text-lg font-semibold leading-none tracking-tight",t),...e}));sn.displayName=j1.displayName;const Ha=j.forwardRef(({className:t,...e},s)=>r.jsx(w1,{ref:s,className:U("text-sm text-muted-foreground",t),...e}));Ha.displayName=w1.displayName;const un=j.forwardRef(({className:t,value:e,...s},n)=>r.jsx(v1,{ref:n,className:U("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",t),...s,children:r.jsx(P4,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(e||0)}%)`}})}));un.displayName=v1.displayName;const iT=({onClose:t})=>{const{mutate:e}=$d(),{menuItems:s}=E1(),{data:n}=wt(),i=()=>{t&&t()};return r.jsxs("div",{className:"flex h-full w-64 flex-col border-r bg-background",children:[r.jsxs("div",{className:"flex h-16 items-center justify-between border-b px-6",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(ec,{className:"h-6 w-6 mr-2"}),r.jsx("span",{className:"font-semibold",children:"Smart Up"})]}),t&&r.jsx(D,{variant:"ghost",size:"sm",onClick:t,className:"lg:hidden",children:r.jsx(fn,{className:"h-4 w-4"})})]}),r.jsx(bt,{className:"flex-1 px-3 py-4",children:r.jsx("nav",{className:"space-y-4",children:s.map(a=>r.jsxs("div",{className:"space-y-2",children:[r.jsxs(Ba,{to:a.route??"/",onClick:i,className:({isActive:o})=>U("flex items-center justify-between rounded-md px-3 py-2 text-sm font-semibold transition-colors hover:bg-accent hover:text-accent-foreground",o?"bg-accent text-accent-foreground":"text-foreground"),children:[r.jsxs("span",{className:"flex items-center",children:[a.icon&&r.jsx("span",{className:"mr-3",children:a.icon}),a.label]}),a.children&&a.children.length>0&&r.jsx(ls,{className:"h-4 w-4 opacity-60"})]}),a.children&&a.children.length>0&&r.jsx("div",{className:"ml-3 border-l pl-3 space-y-1",children:a.children.map(o=>r.jsxs(Ba,{to:o.route??"/",onClick:i,className:({isActive:l})=>U("flex items-center rounded-md px-3 py-2 text-sm transition-colors hover:bg-accent hover:text-accent-foreground",l?"bg-accent text-accent-foreground":"text-muted-foreground"),children:[o.icon&&r.jsx("span",{className:"mr-3",children:o.icon}),o.label]},o.key))})]},a.key))})}),r.jsx(Zd,{}),r.jsx(Y1,{className:"border-b"}),r.jsx("div",{className:"p-4",children:r.jsxs(D,{variant:"outline",size:"sm",onClick:()=>{e(),t&&t()},className:"w-full justify-start",children:[r.jsx(Wd,{className:"mr-2 h-4 w-4"}),"Logout"]})})]})},aT=({children:t})=>{const[e,s]=j.useState(!1),n=()=>{s(!e)};return r.jsx("div",{className:"min-h-screen bg-stone-200 relative overflow-x-hidden",children:r.jsxs("div",{className:"flex relative",children:[e&&r.jsx("div",{className:"fixed inset-0 z-40 bg-purple-900/20 backdrop-blur-sm lg:hidden",onClick:()=>s(!1)}),r.jsx("aside",{className:`
            h-screen w-64 transform transition-transform duration-300 ease-in-out
            fixed left-0 top-0 z-50
            ${e?"translate-x-0":"-translate-x-full"}
            lg:translate-x-0
            bg-background/95 backdrop-blur-md border-r border-purple-200/20
          `,children:r.jsx(iT,{onClose:()=>s(!1)})}),r.jsxs("main",{className:"flex-1 lg:ml-64 min-w-0 relative z-10",children:[r.jsxs("div",{className:"sticky top-0 z-30 flex h-16 items-center border-b border-purple-200/20 bg-background/80 backdrop-blur-md px-4 lg:hidden",children:[r.jsx(D,{variant:"ghost",size:"sm",onClick:n,className:"mr-2 hover:bg-purple-100/20 hover:text-purple-700",children:r.jsx(ec,{className:"h-6 w-6"})}),r.jsx("span",{className:"font-semibold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:"Smart Up"})]}),t]})]})})},oT=()=>r.jsxs("div",{className:"p-6",children:[r.jsx("h1",{className:"text-2xl font-bold",children:"Admin Dashboard"}),r.jsx("p",{children:"Welcome to admin panel"})]}),lT=[r.jsx(Z,{path:"dashboard/overview",element:r.jsx(oT,{})},"dashboard-overview")],X=({children:t})=>r.jsx("div",{className:"p-2 md:p-12 space-y-6 max-w-8xl mx-auto",children:t}),cT=()=>r.jsx(P,{className:"border-purple/20 bg-purple/5 hover:shadow-md transition-shadow",children:r.jsx(I,{className:"p-5",children:r.jsxs("div",{className:"grid grid-cols-[auto_1fr] gap-4",children:[r.jsxs("div",{className:"flex flex-col items-center gap-2 pr-4 border-r border-purple/20",children:[r.jsx("div",{className:"w-12 h-12 rounded-xl bg-purple flex items-center justify-center shadow-sm",children:r.jsx(ju,{className:"w-6 h-6 text-purple-foreground"})}),r.jsx("div",{className:"text-center",children:r.jsx("p",{className:"text-xs font-bold text-purple uppercase tracking-wide",children:"Role"})})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"font-semibold text-sm text-foreground mb-1",children:"Zarządzaj rolami użytkowników"}),r.jsx("p",{className:"text-xs text-muted-foreground leading-relaxed",children:"Zmiana roli określa uprawnienia użytkownika w systemie"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-start gap-2 text-xs",children:[r.jsx(cr,{className:"w-4 h-4 text-green-600 dark:text-green-400 flex-shrink-0 mt-0.5"}),r.jsxs("div",{children:[r.jsx("strong",{children:"Uczeń"})," → może się uczyć z kursów (gdy dostanie dostęp przez grupy)"]})]}),r.jsxs("div",{className:"flex items-start gap-2 text-xs",children:[r.jsx(Vd,{className:"w-4 h-4 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),r.jsxs("div",{children:[r.jsx("strong",{children:"Nauczyciel"})," → może edytować kursy (gdy zostanie przypisany)"]})]}),r.jsxs("div",{className:"flex items-start gap-2 text-xs",children:[r.jsx(ju,{className:"w-4 h-4 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5"}),r.jsxs("div",{children:[r.jsx("strong",{children:"Administrator"})," → pełne uprawnienia do zarządzania systemem"]})]})]}),r.jsx("div",{className:"px-3 py-2 bg-background rounded-md border border-purple/20",children:r.jsxs("p",{className:"text-xs text-foreground",children:[r.jsx("strong",{children:"Co to robi?"})," Zmiana roli → użytkownik dostaje nowe uprawnienia w systemie"]})}),r.jsx("div",{className:"px-3 py-2 bg-orange/10 rounded-md border border-orange/20",children:r.jsxs("p",{className:"text-xs text-foreground leading-relaxed",children:[r.jsx("strong",{children:"Ważne:"})," Sama zmiana roli NIE przypisuje kursów ani grup - to robisz w innych modułach"]})})]})]})})}),uT=({open:t,onOpenChange:e,user:s,onSuccess:n})=>{const[i,a]=j.useState(""),[o,l]=j.useState(!1),[c,u]=j.useState(!1),[d,h]=j.useState({activityProgress:!0,gamificationLog:!0,userStats:!0,userUpgrades:!0}),f=async()=>{if(s){if(i!==s.full_name){G.error("Nieprawidłowe potwierdzenie");return}l(!0);try{const y=[];d.activityProgress&&y.push(oe.from("activity_progress").delete().eq("user_id",s.id)),d.gamificationLog&&y.push(oe.from("gamification_log").delete().eq("user_id",s.id)),d.userUpgrades&&y.push(oe.from("user_upgrades").delete().eq("user_id",s.id)),d.userStats&&y.push(oe.from("user_stats").update({total_points:0,current_level:1,daily_streak:0,idle_points_rate:1,quizzes_completed:0,perfect_scores:0,total_time_spent:0}).eq("user_id",s.id));const b=await Promise.all(y);if(b.some(S=>S.error)){const S=b.filter(z=>z.error).map(z=>z.error);throw console.error("Errors during clear:",S),new Error("Błąd podczas czyszczenia danych")}G.success("Aktywności zostały wyczyszczone"),n(),e(!1),a("")}catch(y){console.error("Clear activities error:",y),G.error("Błąd podczas czyszczenia aktywności")}finally{l(!1)}}},m=y=>{o||(e(y),y||a(""))};if(!s)return null;const p=i===s.full_name,x=()=>{const y=[];return d.activityProgress&&y.push(`-- Usuń postępy w aktywnościach
DELETE FROM activity_progress WHERE user_id = '${s.id}';`),d.gamificationLog&&y.push(`-- Usuń historię gamifikacji
DELETE FROM gamification_log WHERE user_id = '${s.id}';`),d.userUpgrades&&y.push(`-- Usuń idle upgrades
DELETE FROM user_upgrades WHERE user_id = '${s.id}';`),d.userStats&&y.push(`-- Zresetuj statystyki
UPDATE user_stats
SET 
  total_points = 0,
  current_level = 1,
  daily_streak = 0,
  idle_points_rate = 1,
  quizzes_completed = 0,
  perfect_scores = 0,
  total_time_spent = 0,
  last_active = CURRENT_DATE,
  last_idle_claim = NOW()
WHERE user_id = '${s.id}';`),y.join(`

`)},g=()=>{const y=x();navigator.clipboard.writeText(y),G.success("SQL skopiowany do schowka")};return r.jsx(pn,{open:t,onOpenChange:m,children:r.jsxs(en,{className:"max-w-4xl",children:[r.jsxs(tn,{children:[r.jsxs(sn,{className:"flex items-center gap-2 text-destructive",children:[r.jsx(wu,{className:"w-5 h-5"}),"Wyczyść wszystkie aktywności"]}),r.jsx(Ha,{className:"text-left",children:r.jsxs("div",{className:"space-y-2",children:[r.jsxs("p",{children:["Ta akcja usunie dane użytkownika: ",r.jsx("strong",{children:s.full_name})]}),r.jsx("p",{className:"text-destructive font-medium",children:"Ta operacja jest nieodwracalna!"})]})})]}),r.jsxs("div",{className:"space-y-4 py-4",children:[r.jsxs("div",{className:"space-y-3",children:[r.jsx(Oi,{className:"text-sm font-medium",children:"Co chcesz wyczyścić?"}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(mt,{id:"activityProgress",checked:d.activityProgress,onCheckedChange:y=>h({...d,activityProgress:y})}),r.jsx("label",{htmlFor:"activityProgress",className:"text-sm leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Postępy w aktywnościach (quizy, materiały)"})]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(mt,{id:"gamificationLog",checked:d.gamificationLog,onCheckedChange:y=>h({...d,gamificationLog:y})}),r.jsx("label",{htmlFor:"gamificationLog",className:"text-sm leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Historia gamifikacji (logi punktów)"})]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(mt,{id:"userStats",checked:d.userStats,onCheckedChange:y=>h({...d,userStats:y})}),r.jsx("label",{htmlFor:"userStats",className:"text-sm leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Statystyki (punkty, poziom, streak)"})]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(mt,{id:"userUpgrades",checked:d.userUpgrades,onCheckedChange:y=>h({...d,userUpgrades:y})}),r.jsx("label",{htmlFor:"userUpgrades",className:"text-sm leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Idle upgrades"})]})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(Oi,{htmlFor:"confirmation",className:"text-sm font-medium",children:"Wpisz pełne imię i nazwisko użytkownika aby potwierdzić:"}),r.jsx(te,{id:"confirmation",value:i,onChange:y=>a(y.target.value),placeholder:s.full_name,className:"font-mono",disabled:o}),r.jsxs("p",{className:"text-xs text-muted-foreground",children:["Wymagane: ",r.jsx("code",{className:"bg-muted px-1 py-0.5 rounded",children:s.full_name})]})]}),r.jsxs("div",{className:"flex items-start gap-2 p-3 bg-destructive/10 rounded-md border border-destructive/20",children:[r.jsx(wu,{className:"w-4 h-4 text-destructive flex-shrink-0 mt-0.5"}),r.jsxs("div",{className:"text-xs text-foreground leading-relaxed",children:[r.jsx("strong",{children:"UWAGA:"})," Po usunięciu danych nie będzie możliwości ich odzyskania. Użytkownik straci wszystkie postępy i będzie musiał zacząć od nowa."]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(D,{type:"button",variant:"outline",size:"sm",onClick:()=>u(!c),className:"w-full",children:c?"Ukryj SQL":"Pokaż SQL (do ręcznego wykonania)"}),c&&r.jsxs("div",{className:"space-y-2",children:[r.jsx("pre",{className:"p-3 bg-muted rounded text-xs overflow-x-auto max-h-[200px] overflow-y-auto",children:x()}),r.jsx(D,{type:"button",variant:"secondary",size:"sm",onClick:g,className:"w-full",children:"Skopiuj SQL do schowka"}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"Możesz skopiować ten SQL i wykonać go ręcznie w Supabase SQL Editor"})]})]})]}),r.jsxs(Ka,{children:[r.jsx(D,{variant:"outline",onClick:()=>m(!1),disabled:o,children:"Anuluj"}),r.jsx(D,{variant:"destructive",onClick:f,disabled:!p||o,children:o?r.jsxs(r.Fragment,{children:[r.jsx(qt,{className:"w-4 h-4 mr-2 animate-spin"}),"Czyszczenie..."]}):r.jsxs(r.Fragment,{children:[r.jsx(St,{className:"w-4 h-4 mr-2"}),"Wyczyść aktywności"]})})]})]})})},dT=()=>{const[t,e]=j.useState(""),[s,n]=j.useState("all"),[i,a]=j.useState(!1),[o,l]=j.useState(null),{data:c,isLoading:u,refetch:d}=Y({resource:"users",pagination:{pageSize:1e3},sorters:[{field:"full_name",order:"asc"}]}),{mutate:h}=Hi(),f=c?.data??[],m=j.useMemo(()=>({total:f.length,students:f.filter(w=>w.role==="student").length,teachers:f.filter(w=>w.role==="teacher").length,admins:f.filter(w=>w.role==="admin").length}),[f]),p=j.useMemo(()=>f.filter(w=>{const S=!t||w.full_name.toLowerCase().includes(t.toLowerCase())||w.email.toLowerCase().includes(t.toLowerCase()),z=s==="all"||w.role===s;return S&&z}),[f,t,s]),x=(w,S)=>{h({resource:"users",id:w,values:{role:S}},{onSuccess:()=>{G.success("Rola zmieniona"),d()},onError:()=>G.error("Błąd zmiany roli")})},g=(w,S)=>{h({resource:"users",id:w,values:{is_active:!S}},{onSuccess:()=>{G.success(S?"Konto dezaktywowane":"Konto aktywowane"),d()},onError:()=>G.error("Błąd zmiany statusu")})},y=w=>{l(w),a(!0)},b=w=>{switch(w){case"admin":return r.jsxs(V,{className:"bg-red-500",children:[r.jsx(ju,{className:"w-3 h-3 mr-1"}),"Administrator"]});case"teacher":return r.jsxs(V,{className:"bg-blue-500",children:[r.jsx(Vd,{className:"w-3 h-3 mr-1"}),"Nauczyciel"]});default:return r.jsxs(V,{className:"bg-green-500",children:[r.jsx(cr,{className:"w-3 h-3 mr-1"}),"Uczeń"]})}};return r.jsx(X,{children:r.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold",children:"Użytkownicy"}),r.jsx("p",{className:"text-muted-foreground mt-1",children:"Zarządzaj rolami użytkowników w systemie"})]}),r.jsx(cT,{}),r.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[r.jsx(P,{children:r.jsxs(I,{className:"p-4 text-center",children:[r.jsx("div",{className:"text-3xl font-bold",children:m.total}),r.jsx("div",{className:"text-sm text-muted-foreground",children:"Wszyscy"})]})}),r.jsx(P,{className:"border-green-200 bg-green-50/50 dark:border-green-900 dark:bg-green-950/20",children:r.jsxs(I,{className:"p-4 text-center",children:[r.jsx("div",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:m.students}),r.jsx("div",{className:"text-sm text-muted-foreground",children:"Uczniowie"})]})}),r.jsx(P,{className:"border-blue-200 bg-blue-50/50 dark:border-blue-900 dark:bg-blue-950/20",children:r.jsxs(I,{className:"p-4 text-center",children:[r.jsx("div",{className:"text-3xl font-bold text-blue-600 dark:text-blue-400",children:m.teachers}),r.jsx("div",{className:"text-sm text-muted-foreground",children:"Nauczyciele"})]})}),r.jsx(P,{className:"border-red-200 bg-red-50/50 dark:border-red-900 dark:bg-red-950/20",children:r.jsxs(I,{className:"p-4 text-center",children:[r.jsx("div",{className:"text-3xl font-bold text-red-600 dark:text-red-400",children:m.admins}),r.jsx("div",{className:"text-sm text-muted-foreground",children:"Administratorzy"})]})})]}),r.jsx(P,{children:r.jsx(I,{className:"p-4",children:r.jsxs("div",{className:"flex gap-3",children:[r.jsxs("div",{className:"flex-1 relative",children:[r.jsx(uo,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),r.jsx(te,{placeholder:"Szukaj po imieniu lub emailu...",value:t,onChange:w=>e(w.target.value),className:"pl-9"})]}),r.jsxs(Ee,{value:s,onValueChange:w=>n(w),children:[r.jsx(_e,{className:"w-[200px]",children:r.jsx(De,{})}),r.jsxs(Ae,{children:[r.jsx(ee,{value:"all",children:"Wszystkie role"}),r.jsx(ee,{value:"student",children:"Tylko uczniowie"}),r.jsx(ee,{value:"teacher",children:"Tylko nauczyciele"}),r.jsx(ee,{value:"admin",children:"Tylko administratorzy"})]})]})]})})}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{children:["Użytkownicy (",p.length,")"]})}),r.jsx(I,{className:"p-0",children:u?r.jsx("div",{className:"p-8 text-center",children:"Ładowanie..."}):p.length===0?r.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"Nie znaleziono użytkowników"}):r.jsxs(fr,{children:[r.jsx(mr,{children:r.jsxs(Nt,{children:[r.jsx(de,{children:"Użytkownik"}),r.jsx(de,{children:"Email"}),r.jsx(de,{children:"Obecna rola"}),r.jsx(de,{children:"Zmień rolę"}),r.jsx(de,{className:"text-center",children:"Aktywny"}),r.jsx(de,{className:"text-center",children:"Akcje"})]})}),r.jsx(pr,{children:p.map(w=>r.jsxs(Nt,{className:w.is_active?"":"opacity-50",children:[r.jsx(ue,{className:"font-medium",children:w.full_name}),r.jsx(ue,{className:"text-sm text-muted-foreground",children:w.email}),r.jsx(ue,{children:b(w.role)}),r.jsx(ue,{children:r.jsxs(Ee,{value:w.role,onValueChange:S=>x(w.id,S),children:[r.jsx(_e,{className:"w-[160px] h-8",children:r.jsx(De,{})}),r.jsxs(Ae,{children:[r.jsx(ee,{value:"student",children:"Uczeń"}),r.jsx(ee,{value:"teacher",children:"Nauczyciel"}),r.jsx(ee,{value:"admin",children:"Administrator"})]})]})}),r.jsx(ue,{className:"text-center",children:r.jsx(fs,{checked:w.is_active,onCheckedChange:()=>g(w.id,w.is_active)})}),r.jsx(ue,{className:"text-center",children:r.jsx(D,{variant:"ghost",size:"sm",onClick:()=>y(w),className:"text-destructive hover:text-destructive hover:bg-destructive/10",children:r.jsx(St,{className:"w-4 h-4"})})})]},w.id))})]})})]}),r.jsx(uT,{open:i,onOpenChange:a,user:o,onSuccess:()=>{d()}})]})})},hT=()=>r.jsx(P,{className:"border-primary/20 bg-primary/5 hover:shadow-md transition-shadow",children:r.jsx(I,{className:"p-5",children:r.jsxs("div",{className:"grid grid-cols-[auto_1fr] gap-4",children:[r.jsxs("div",{className:"flex flex-col items-center gap-2 pr-4 border-r border-primary/20",children:[r.jsx("div",{className:"w-12 h-12 rounded-xl bg-primary flex items-center justify-center shadow-sm",children:r.jsx(ge,{className:"w-6 h-6 text-primary-foreground"})}),r.jsx("div",{className:"text-center",children:r.jsx("p",{className:"text-xs font-bold text-primary uppercase tracking-wide",children:"Grupy"})})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"font-semibold text-sm text-foreground mb-1",children:"Co to jest grupa?"}),r.jsxs("p",{className:"text-xs text-muted-foreground leading-relaxed",children:['Grupa = kontener na uczniów (np. "Klasa 1A"). Sama grupa ',r.jsx("strong",{children:"NIE DAJE"})," dostępu do żadnych kursów."]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[r.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-primary"}),r.jsx("span",{children:"Organizujesz uczniów w logiczne klasy/zespoły"})]}),r.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[r.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-primary"}),r.jsx("span",{children:"Możesz dodawać i usuwać uczniów z grupy"})]}),r.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[r.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-primary"}),r.jsx("span",{children:"Grupa służy tylko do organizacji"})]})]}),r.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-background rounded-md border border-primary/20",children:[r.jsx(p_,{className:"w-4 h-4 text-primary flex-shrink-0"}),r.jsx(Ue,{className:"w-3 h-3 text-muted-foreground flex-shrink-0"}),r.jsxs("p",{className:"text-xs text-muted-foreground",children:["Aby dać dostęp do kursów → użyj modułu ",r.jsx("strong",{children:'"Kursy dla grup"'})]})]})]})]})})}),fT=()=>{const[t,e]=j.useState(""),[s,n]=j.useState(!1),[i,a]=j.useState(!1),[o,l]=j.useState(null),[c,u]=j.useState(""),[d,h]=j.useState("2024/2025"),[f,m]=j.useState(""),[p,x]=j.useState(new Set),{data:g,isLoading:y,refetch:b}=Y({resource:"groups",pagination:{pageSize:1e3},sorters:[{field:"name",order:"asc"}]}),{data:w}=Y({resource:"users",filters:[{field:"role",operator:"eq",value:"student"},{field:"is_active",operator:"eq",value:!0}],pagination:{pageSize:1e3},sorters:[{field:"full_name",order:"asc"}],queryOptions:{enabled:i}}),{data:S,refetch:z}=Y({resource:"group_members",pagination:{pageSize:1e4},meta:{select:"*, users!inner(full_name, email)"}}),{mutate:N}=hn(),{mutate:k}=Hi(),{mutate:C}=lr(),T=g?.data??[],v=w?.data??[],_=S?.data??[],A=j.useMemo(()=>{const W={};return T.forEach(me=>{W[me.id]=_.filter(Ve=>Ve.group_id===me.id).length}),W},[T,_]),E=j.useMemo(()=>T.filter(W=>!t||W.name.toLowerCase().includes(t.toLowerCase())||W.academic_year.includes(t)),[T,t]),M=j.useMemo(()=>o?_.filter(W=>W.group_id===o.id):[],[o,_]),O=j.useMemo(()=>{if(!o)return[];const W=new Set(M.map(me=>me.user_id));return v.filter(me=>!W.has(me.id)&&(!f||me.full_name.toLowerCase().includes(f.toLowerCase())||me.email.toLowerCase().includes(f.toLowerCase())))},[o,v,M,f]),R=()=>{c.trim()&&N({resource:"groups",values:{name:c,academic_year:d,vendor_id:1}},{onSuccess:()=>{G.success("Grupa utworzona"),n(!1),u(""),b()},onError:()=>G.error("Błąd tworzenia grupy")})},B=W=>{confirm("Czy na pewno chcesz usunąć tę grupę?")&&C({resource:"groups",id:W},{onSuccess:()=>{G.success("Grupa usunięta"),b()},onError:()=>G.error("Błąd usuwania grupy")})},K=W=>{k({resource:"groups",id:W.id,values:{is_active:!W.is_active}},{onSuccess:()=>{G.success(W.is_active?"Grupa dezaktywowana":"Grupa aktywowana"),b()},onError:()=>G.error("Błąd zmiany statusu")})},$=W=>{l(W),a(!0),x(new Set),m("")},J=async()=>{if(!(!o||p.size===0))try{const W=Array.from(p).map(Ve=>({group_id:o.id,user_id:Ve})),{error:me}=await oe.from("group_members").insert(W);if(me)throw me;G.success(`Dodano ${p.size} uczniów`),x(new Set),m(""),z()}catch{G.error("Błąd dodawania uczniów")}},ie=async W=>{if(o)try{const{error:me}=await oe.from("group_members").delete().eq("group_id",o.id).eq("user_id",W);if(me)throw me;G.success("Uczeń usunięty z grupy"),z()}catch{G.error("Błąd usuwania ucznia")}};return r.jsxs(X,{children:[r.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold",children:"Grupy i uczniowie"}),r.jsx("p",{className:"text-muted-foreground mt-1",children:"Twórz klasy i przypisuj uczniów"})]}),r.jsxs(D,{onClick:()=>n(!0),children:[r.jsx(Je,{className:"w-4 h-4 mr-2"}),"Nowa grupa"]})]}),r.jsx(hT,{}),r.jsx(P,{children:r.jsx(I,{className:"p-4",children:r.jsxs("div",{className:"relative",children:[r.jsx(uo,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),r.jsx(te,{placeholder:"Szukaj grupy...",value:t,onChange:W=>e(W.target.value),className:"pl-9"})]})})}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{children:["Grupy (",T.length,")"]})}),r.jsx(I,{className:"p-0",children:y?r.jsx("div",{className:"p-8 text-center",children:"Ładowanie..."}):E.length===0?r.jsxs("div",{className:"p-8 text-center",children:[r.jsx(ge,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground/50"}),r.jsx("p",{className:"text-muted-foreground mb-4",children:t?"Nie znaleziono grup":"Brak grup"}),r.jsxs(D,{onClick:()=>n(!0),children:[r.jsx(Je,{className:"w-4 h-4 mr-2"}),"Utwórz pierwszą grupę"]})]}):r.jsxs(fr,{children:[r.jsx(mr,{children:r.jsxs(Nt,{children:[r.jsx(de,{children:"Nazwa grupy"}),r.jsx(de,{children:"Rok akademicki"}),r.jsx(de,{className:"text-center",children:"Liczba uczniów"}),r.jsx(de,{className:"text-center",children:"Status"}),r.jsx(de,{className:"text-center",children:"Akcje"})]})}),r.jsx(pr,{children:E.map(W=>r.jsxs(Nt,{children:[r.jsx(ue,{className:"font-medium",children:W.name}),r.jsx(ue,{children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(js,{className:"w-4 h-4 text-muted-foreground"}),W.academic_year]})}),r.jsx(ue,{className:"text-center",children:r.jsxs(V,{variant:"secondary",children:[A[W.id]||0," uczniów"]})}),r.jsx(ue,{className:"text-center",children:r.jsx(fs,{checked:W.is_active,onCheckedChange:()=>K(W)})}),r.jsx(ue,{className:"text-center",children:r.jsxs("div",{className:"flex items-center justify-center gap-2",children:[r.jsxs(D,{size:"sm",variant:"outline",onClick:()=>$(W),children:[r.jsx(ge,{className:"w-4 h-4 mr-1"}),"Zarządzaj uczniami"]}),r.jsx(D,{size:"sm",variant:"ghost",onClick:()=>B(W.id),className:"text-red-600",children:r.jsx(St,{className:"w-4 h-4"})})]})})]},W.id))})]})})]})]}),r.jsx(pn,{open:s,onOpenChange:n,children:r.jsxs(en,{children:[r.jsx(tn,{children:r.jsx(sn,{children:"Utwórz nową grupę"})}),r.jsxs("div",{className:"space-y-4 py-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(Oi,{htmlFor:"name",children:"Nazwa grupy"}),r.jsx(te,{id:"name",value:c,onChange:W=>u(W.target.value),placeholder:"np. Klasa 1A"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(Oi,{htmlFor:"year",children:"Rok akademicki"}),r.jsx(te,{id:"year",value:d,onChange:W=>h(W.target.value),placeholder:"np. 2024/2025"})]})]}),r.jsxs(Ka,{children:[r.jsx(D,{variant:"outline",onClick:()=>n(!1),children:"Anuluj"}),r.jsx(D,{onClick:R,disabled:!c.trim(),children:"Utwórz"})]})]})}),r.jsx(pn,{open:i,onOpenChange:a,children:r.jsxs(en,{className:"max-w-4xl max-h-[80vh]",children:[r.jsx(tn,{children:r.jsxs(sn,{children:["Uczniowie w grupie: ",o?.name]})}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"font-medium text-sm",children:["Obecni uczniowie (",M.length,")"]}),r.jsx(bt,{className:"h-[400px] border rounded-lg p-3",children:M.length===0?r.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Brak uczniów w grupie"}):r.jsx("div",{className:"space-y-2",children:M.map(W=>r.jsxs("div",{className:"flex items-center justify-between p-2 rounded hover:bg-muted",children:[r.jsxs("div",{children:[r.jsx("div",{className:"font-medium text-sm",children:W.users?.full_name}),r.jsx("div",{className:"text-xs text-muted-foreground",children:W.users?.email})]}),r.jsx(D,{size:"sm",variant:"ghost",onClick:()=>ie(W.user_id),className:"text-red-600",children:r.jsx(St,{className:"w-4 h-4"})})]},W.user_id))})})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"font-medium text-sm",children:["Dostępni uczniowie (",O.length,")"]}),r.jsx(te,{placeholder:"Szukaj ucznia...",value:f,onChange:W=>m(W.target.value),className:"h-9"}),r.jsx(bt,{className:"h-[350px] border rounded-lg p-3",children:O.length===0?r.jsx("p",{className:"text-center text-muted-foreground py-8",children:f?"Nie znaleziono":"Wszyscy uczniowie są w grupie"}):r.jsx("div",{className:"space-y-2",children:O.map(W=>r.jsxs("label",{className:"flex items-center gap-3 p-2 rounded hover:bg-muted cursor-pointer",children:[r.jsx(mt,{checked:p.has(W.id),onCheckedChange:me=>{const Ve=new Set(p);me?Ve.add(W.id):Ve.delete(W.id),x(Ve)}}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"font-medium text-sm",children:W.full_name}),r.jsx("div",{className:"text-xs text-muted-foreground",children:W.email})]})]},W.id))})}),p.size>0&&r.jsxs(D,{onClick:J,className:"w-full",children:[r.jsx(Pi,{className:"w-4 h-4 mr-2"}),"Dodaj zaznaczonych (",p.size,")"]})]})]}),r.jsx(Ka,{children:r.jsx(D,{variant:"outline",onClick:()=>a(!1),children:"Zamknij"})})]})})]})},mT=({open:t,onOpenChange:e,course:s,teachers:n,access:i,refetchAccess:a})=>{const[o,l]=j.useState(""),[c,u]=j.useState(!1),d=j.useMemo(()=>s?new Set(i.filter(m=>m.course_id===s.id&&m.teacher_id).map(m=>m.teacher_id)):new Set,[s,i]),h=j.useMemo(()=>n.filter(m=>!o||m.full_name.toLowerCase().includes(o.toLowerCase())||m.email.toLowerCase().includes(o.toLowerCase())),[n,o]),f=async m=>{if(!s||c)return;const p=d.has(m);u(!0);try{if(p){const{error:x}=await oe.from("course_access").delete().eq("teacher_id",m).eq("course_id",s.id);if(x)throw x}else{const{error:x}=await oe.from("course_access").insert({course_id:s.id,teacher_id:m,group_id:null});if(x)throw x}await a(),G.success(p?"Usunięto przypisanie":"Dodano przypisanie")}catch{G.error("Błąd przypisania")}finally{u(!1)}};return s?r.jsx(pn,{open:t,onOpenChange:e,children:r.jsxs(en,{className:"max-w-2xl max-h-[80vh]",children:[r.jsx(tn,{children:r.jsx(sn,{children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Vd,{className:"w-5 h-5"}),r.jsxs("div",{children:[r.jsxs("div",{children:["Nauczyciele dla kursu: ",s.title]}),r.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Zaznacz nauczycieli, którzy mają dostęp do tego kursu"})]})]})})}),r.jsxs("div",{className:"space-y-3",children:[r.jsx(te,{placeholder:"Szukaj nauczyciela...",value:o,onChange:m=>l(m.target.value),className:"h-9"}),r.jsx(bt,{className:"h-[400px] border rounded-lg p-3",children:r.jsx("div",{className:"space-y-2",children:h.map(m=>{const p=d.has(m.id);return r.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border-2 cursor-pointer transition-all ${p?"border-primary bg-primary/5":"border-transparent hover:bg-muted"}`,onClick:()=>f(m.id),children:[r.jsx(mt,{checked:p,disabled:c,onClick:x=>x.stopPropagation(),onCheckedChange:()=>f(m.id)}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"font-medium",children:m.full_name}),r.jsx("div",{className:"text-xs text-muted-foreground",children:m.email})]})]},m.id)})})})]}),r.jsxs(Ka,{children:[r.jsx(D,{variant:"outline",onClick:()=>e(!1),disabled:c,children:"Zamknij"}),c&&r.jsx(qt,{className:"w-4 h-4 animate-spin ml-2"})]})]})}):null},pT=({courses:t,getAssignmentCount:e,onTogglePublish:s,onDelete:n,onManage:i})=>r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{children:["Kursy (",t.length,")"]})}),r.jsx(I,{className:"p-0",children:r.jsxs(fr,{children:[r.jsx(mr,{children:r.jsxs(Nt,{children:[r.jsx(de,{children:"Kurs"}),r.jsx(de,{className:"text-center",children:"Opublikowany"}),r.jsx(de,{className:"text-center",children:"Liczba przypisań"}),r.jsx(de,{className:"text-center",children:"Akcje"})]})}),r.jsx(pr,{children:t.map(a=>r.jsxs(Nt,{children:[r.jsxs(ue,{className:"font-medium flex items-center gap-2",children:[r.jsx("span",{className:"text-xl",children:a.icon_emoji||"📘"}),a.title]}),r.jsx(ue,{className:"text-center",children:r.jsx(fs,{checked:a.is_published,onCheckedChange:()=>s(a.id,a.is_published)})}),r.jsx(ue,{className:"text-center",children:r.jsxs(V,{variant:"secondary",children:[e(a.id)," przypisań"]})}),r.jsx(ue,{className:"text-center",children:r.jsxs("div",{className:"flex items-center justify-center gap-2",children:[r.jsxs(D,{size:"sm",variant:"outline",onClick:()=>i(a),children:[r.jsx(Se,{className:"w-4 h-4 mr-1"})," Zarządzaj"]}),r.jsx(D,{size:"sm",variant:"ghost",className:"text-red-600",onClick:()=>n(a.id),children:r.jsx(St,{className:"w-4 h-4"})})]})})]},a.id))})]})})]}),xT=()=>{const[t,e]=j.useState(null),[s,n]=j.useState(!1),{data:i,refetch:a}=Y({resource:"courses",pagination:{pageSize:1e3},sorters:[{field:"title",order:"asc"}]}),{data:o}=Y({resource:"users",filters:[{field:"role",operator:"eq",value:"teacher"},{field:"is_active",operator:"eq",value:!0}],pagination:{pageSize:1e3}}),{data:l,refetch:c}=Y({resource:"course_access",pagination:{pageSize:1e4}}),u=i?.data??[],d=o?.data??[],h=(l?.data??[]).filter(g=>g.teacher_id!==null),f=g=>h.filter(y=>y.course_id===g).length,m=async(g,y)=>{const{error:b}=await oe.from("courses").update({is_published:!y}).eq("id",g);b?G.error("Błąd zmiany statusu"):(G.success(y?"Kurs ukryty":"Kurs opublikowany"),a())},p=async g=>{if(!confirm("Czy na pewno chcesz usunąć ten kurs?"))return;const{error:y}=await oe.from("courses").delete().eq("id",g);y?G.error("Błąd usuwania kursu"):(G.success("Kurs usunięty"),a())},x=g=>{e(g),n(!0)};return r.jsx(X,{children:r.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold",children:"Kursy i nauczyciele"}),r.jsx("p",{className:"text-muted-foreground mt-1",children:"Zarządzaj przypisaniem nauczycieli do kursów"})]}),r.jsx(pT,{courses:u,getAssignmentCount:f,onTogglePublish:m,onDelete:p,onManage:x}),r.jsx(mT,{open:s,onOpenChange:n,course:t,teachers:d,access:h,refetchAccess:c})]})})},gT=()=>{const[t,e]=j.useState(""),[s,n]=j.useState(""),[i,a]=j.useState(null),[o,l]=j.useState(!1),[c,u]=j.useState(!1),{data:d,isLoading:h,refetch:f}=Y({resource:"courses",pagination:{pageSize:1e3},sorters:[{field:"title",order:"asc"}]}),{data:m}=Y({resource:"groups",filters:[{field:"is_active",operator:"eq",value:!0}],pagination:{pageSize:1e3},sorters:[{field:"name",order:"asc"}],queryOptions:{enabled:o}}),{data:p,refetch:x}=Y({resource:"course_access",pagination:{pageSize:1e4}}),g=d?.data??[],y=m?.data??[],b=j.useMemo(()=>(p?.data??[]).filter(_=>_.group_id!==null),[p]),w=j.useMemo(()=>g.filter(_=>!t||_.title.toLowerCase().includes(t.toLowerCase())),[g,t]),S=j.useMemo(()=>{const _={};return w.forEach(A=>{_[A.id]=b.filter(E=>E.course_id===A.id).length}),_},[w,b]),z=j.useMemo(()=>i?new Set(b.filter(_=>_.course_id===i.id).map(_=>_.group_id)):new Set,[i,b]),N=j.useMemo(()=>y.filter(_=>!s||_.name.toLowerCase().includes(s.toLowerCase())||_.academic_year.includes(s)),[y,s]),k=_=>{a(_),n(""),l(!0)},C=async _=>{if(!i||c)return;const A=z.has(_);u(!0);try{if(A){const{error:E}=await oe.from("course_access").delete().eq("course_id",i.id).eq("group_id",_);if(E)throw E;G.success("Usunięto grupę z kursu")}else{const{error:E}=await oe.from("course_access").insert({course_id:i.id,group_id:_,teacher_id:null});if(E)throw E;G.success("Dodano grupę do kursu")}await x()}catch(E){G.error(E.message||"Wystąpił błąd")}finally{u(!1)}},T=async _=>{try{const{error:A}=await oe.from("courses").update({is_published:!_.is_published}).eq("id",_.id);if(A)throw A;G.success(_.is_published?"Przeniesiono do szkicu":"Opublikowano kurs"),await f()}catch(A){G.error(A.message||"Błąd zmiany publikacji")}},v=async _=>{if(confirm("Na pewno usunąć ten kurs? Tej operacji nie można cofnąć."))try{const{error:A}=await oe.from("courses").delete().eq("id",_);if(A)throw A;G.success("Kurs usunięty"),await f(),await x()}catch(A){G.error(A.message||"Błąd usuwania kursu")}};return r.jsxs(X,{children:[r.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold",children:"Kursy i grupy"}),r.jsx("p",{className:"text-muted-foreground mt-1",children:"Najpierw wybierz kurs, potem przypisz do niego grupy"})]}),r.jsx(P,{children:r.jsx(I,{className:"p-4",children:r.jsxs("div",{className:"relative",children:[r.jsx(uo,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),r.jsx(te,{placeholder:"Szukaj kursu...",value:t,onChange:_=>e(_.target.value),className:"pl-9"})]})})}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{children:["Kursy (",w.length,")"]})}),r.jsx(I,{className:"p-0",children:h?r.jsx("div",{className:"p-8 text-center",children:"Ładowanie..."}):w.length===0?r.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"Brak kursów"}):r.jsxs(fr,{children:[r.jsx(mr,{children:r.jsxs(Nt,{children:[r.jsx(de,{children:"Kurs"}),r.jsx(de,{className:"text-center",children:"Grupy"}),r.jsx(de,{className:"text-center",children:"Publikacja"}),r.jsx(de,{className:"text-center",children:"Akcje"})]})}),r.jsx(pr,{children:w.map(_=>r.jsxs(Nt,{children:[r.jsx(ue,{className:"font-medium",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-2xl",children:_.icon_emoji||"📚"}),_.title,_.is_published?r.jsx(V,{variant:"secondary",className:"ml-2",children:"Opublikowany"}):r.jsx(V,{className:"ml-2",children:"Szkic"})]})}),r.jsx(ue,{className:"text-center",children:r.jsxs(V,{variant:"secondary",children:[S[_.id]||0," grup"]})}),r.jsx(ue,{className:"text-center",children:r.jsx(fs,{checked:!!_.is_published,onCheckedChange:()=>T(_)})}),r.jsx(ue,{className:"text-center",children:r.jsxs("div",{className:"flex items-center justify-center gap-2",children:[r.jsxs(D,{size:"sm",variant:"outline",onClick:()=>k(_),children:[r.jsx(ge,{className:"w-4 h-4 mr-1"}),"Zarządzaj grupami"]}),r.jsx(D,{size:"sm",variant:"ghost",onClick:()=>v(_.id),className:"text-red-600",children:r.jsx(St,{className:"w-4 h-4"})})]})})]},_.id))})]})})]})]}),r.jsx(pn,{open:o,onOpenChange:l,children:r.jsxs(en,{className:"max-w-2xl max-h-[80vh]",children:[r.jsx(tn,{children:r.jsx(sn,{children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(ge,{className:"w-5 h-5"}),r.jsxs("div",{children:[r.jsxs("div",{children:["Grupy dla kursu: ",i?.title]}),r.jsx("div",{className:"text-sm font-normal text-muted-foreground mt-1",children:"Zaznacz grupy, które mają mieć dostęp do tego kursu"})]})]})})}),r.jsxs("div",{className:"space-y-3",children:[r.jsx(te,{placeholder:"Szukaj grupy...",value:s,onChange:_=>n(_.target.value),className:"h-9"}),r.jsx(bt,{className:"h-[420px] border rounded-lg p-3",children:r.jsxs("div",{className:"space-y-2",children:[N.map(_=>{const A=z.has(_.id);return r.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border-2 cursor-pointer transition-all ${A?"border-primary bg-primary/5":"border-transparent hover:bg-muted"}`,onClick:()=>C(_.id),children:[r.jsx(mt,{checked:A,disabled:c,onClick:E=>E.stopPropagation(),onCheckedChange:()=>C(_.id)}),r.jsx("span",{className:"text-2xl",children:"👥"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"font-medium",children:_.name}),r.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[r.jsx(js,{className:"w-3 h-3"}),_.academic_year]})]})]},_.id)}),N.length===0&&r.jsx("div",{className:"text-center text-muted-foreground py-10 text-sm",children:"Brak wyników"})]})})]}),r.jsx(Ka,{children:r.jsx(D,{variant:"outline",onClick:()=>l(!1),children:"Zamknij"})})]})})]})},yT={name:"permissions",list:"/admin/permissions",meta:{label:"Uprawnienia",icon:r.jsx(x_,{className:"h-4 w-4"})}},bT={name:"permissions-users",list:"/admin/permissions/users",meta:{label:"Użytkownicy",icon:r.jsx(ge,{className:"h-4 w-4"}),parent:"permissions"}},jT={name:"permissions-groups",list:"/admin/permissions/groups",meta:{label:"Grupy i uczniowie",icon:r.jsx(g_,{className:"h-4 w-4"}),parent:"permissions"}},wT={name:"permissions-teacher-courses",list:"/admin/permissions/teacher-courses",meta:{label:"Kursy i nauczyciele",icon:r.jsx(Se,{className:"h-4 w-4"}),parent:"permissions"}},vT={name:"permissions-group-courses",list:"/admin/permissions/group-courses",meta:{label:"Kursy i grupy",icon:r.jsx(cr,{className:"h-4 w-4"}),parent:"permissions"}},kT=[r.jsx(Z,{path:"permissions",element:r.jsx(dn,{to:"/admin/permissions/users",replace:!0})},"permissions-default"),r.jsx(Z,{path:"permissions/users",element:r.jsx(dT,{})},"permissions-users"),r.jsx(Z,{path:"permissions/groups",element:r.jsx(fT,{})},"permissions-groups"),r.jsx(Z,{path:"permissions/teacher-courses",element:r.jsx(xT,{})},"permissions-teacher-courses"),r.jsx(Z,{path:"permissions/group-courses",element:r.jsx(gT,{})},"permissions-group-courses")],Yh=[yT,bT,jT,wT,vT],NT={"between-center":"flex justify-between items-center gap-2",center:"flex justify-center items-center gap-2",start:"flex justify-start items-center gap-2",end:"flex justify-end items-center gap-2"},he=({children:t,variant:e="between-center",className:s=""})=>{const n=NT[e],i=s?`${n} ${s}`:n;return r.jsx("div",{className:i,children:t})},ST={"1-2-3":"grid gap-6 md:grid-cols-2 lg:grid-cols-3","1-2-2":"grid gap-6 md:grid-cols-2","1-1-1":"grid gap-6","2-2-4":"grid gap-6 grid-cols-2 lg:grid-cols-4"},Pt=({children:t,variant:e="1-2-3",className:s=""})=>{const n=ST[e],i=s?`${n} ${s}`:n;return r.jsx("div",{className:i,children:t})},cv=({current:t,pageSize:e,total:s,setCurrent:n,setPageSize:i,itemName:a="elementów",pageSizeOptions:o=[10,20,50]})=>{const l=Math.ceil(s/e),c=(t-1)*e+1,u=Math.min(t*e,s),d=t>1,h=t<l,f=()=>{const m=[];if(l<=5)for(let x=1;x<=l;x++)m.push(x);else{m.push(1),t>3&&m.push("...");const x=Math.max(2,t-1),g=Math.min(l-1,t+1);for(let y=x;y<=g;y++)m.push(y);t<l-2&&m.push("..."),m.push(l)}return m};return s===0?null:r.jsxs(he,{className:"mt-6",children:[r.jsxs("div",{className:"text-sm text-muted-foreground",children:["Pokazuje ",c,"-",u," z ",s," ",a]}),r.jsxs(he,{className:"gap-2",children:[i&&r.jsxs(Ee,{value:e.toString(),onValueChange:m=>{i(parseInt(m)),n(1)},children:[r.jsx(_e,{className:"w-[100px]",children:r.jsx(De,{})}),r.jsx(Ae,{children:o.map(m=>r.jsxs(ee,{value:m.toString(),children:[m," / str."]},m))})]}),r.jsx(D,{variant:"outline",size:"sm",onClick:()=>n(t-1),disabled:!d,children:r.jsx(y_,{className:"w-4 h-4"})}),r.jsx("div",{className:"hidden sm:flex gap-1",children:f().map((m,p)=>m==="..."?r.jsx("span",{className:"px-3 py-1 text-sm text-muted-foreground",children:"..."},`ellipsis-${p}`):r.jsx(D,{variant:t===m?"default":"outline",size:"sm",onClick:()=>n(m),className:"min-w-[40px]",children:m},m))}),r.jsxs("div",{className:"flex sm:hidden items-center px-3 text-sm",children:[t," / ",l]}),r.jsx(D,{variant:"outline",size:"sm",onClick:()=>n(t+1),disabled:!h,children:r.jsx(He,{className:"w-4 h-4"})})]})]})},CT={card:{wrap:"space-y-0",title:"font-medium",description:"text-muted-foreground"},lg:{wrap:"space-y-0",title:"text-3xl font-bold tracking-tight",description:"text-muted-foreground"},md:{wrap:"space-y-0",title:"font-medium",description:"text-muted-foreground"},sm:{wrap:"space-y-1",title:"font-medium text-sm text-muted-foreground mb-1",description:"text-sm"}},je=({title:t,description:e,variant:s="lg"})=>{const n=CT[s],i=()=>{switch(s){case"lg":return r.jsx("h1",{className:n.title,children:t});case"md":return r.jsx("h2",{className:n.title,children:t});case"sm":return r.jsx("h3",{className:n.title,children:t});default:return r.jsx("h1",{className:n.title,children:t})}};return s==="card"?r.jsxs(r.Fragment,{children:[r.jsx(L,{className:"text-lg font-semibold leading-tight flex items-center gap-2",children:t}),r.jsx(Jd,{className:"text-sm text-muted-foreground mt-2",children:e})]}):r.jsx(r.Fragment,{children:r.jsxs("div",{className:n.wrap,children:[i(),r.jsx("p",{className:`prose ${n.description}`,children:e})]})})},zT=()=>{const{tableQuery:{data:t,isLoading:e,isError:s},current:n,setCurrent:i,pageSize:a,setFilters:o}=D1({sorters:{initial:[{field:"created_at",order:"desc"}]}}),l=ex({isLoading:e,isError:s});return l||r.jsxs(X,{children:[r.jsx(je,{title:"Organizacje",description:"Lista wszystkich organizacji w systemie"}),r.jsx(he,{children:r.jsx(te,{placeholder:"Szukaj organizacji...",className:"max-w-sm",onChange:c=>{o([{operator:"or",value:[{field:"name",operator:"contains",value:c.target.value},{field:"subdomain",operator:"contains",value:c.target.value}]}])}})}),r.jsx(Pt,{children:t?.data?.map(c=>r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(he,{children:[r.jsxs(L,{className:"flex items-center gap-2",children:[r.jsx(I1,{className:"w-5 h-5"}),c.name]}),r.jsx(V,{variant:c.is_active?"default":"secondary",children:c.is_active?"Aktywna":"Nieaktywna"})]})}),r.jsxs(I,{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[r.jsx(b_,{className:"w-3 h-3"}),r.jsxs("span",{children:[c.subdomain,".example.com"]})]}),r.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[r.jsx(js,{className:"w-3 h-3"}),r.jsxs("span",{children:["Utworzono: ",new Date(c.created_at).toLocaleDateString("pl-PL")]})]})]})]},c.id))}),r.jsx(cv,{current:n,pageSize:a,total:t?.total||0,setCurrent:i,itemName:"organizacji"})]})},M0={name:"vendors",list:"/admin/vendors",meta:{label:"Organizacje",icon:r.jsx(I1,{className:"h-4 w-4"})}},_T=[r.jsx(Z,{path:"vendors",element:r.jsx(zT,{})},"vendors-list")];function AT(t,e){let s;try{s=t()}catch{return}return{getItem:i=>{var a;const o=c=>c===null?null:JSON.parse(c,void 0),l=(a=s.getItem(i))!=null?a:null;return l instanceof Promise?l.then(o):o(l)},setItem:(i,a)=>s.setItem(i,JSON.stringify(a,void 0)),removeItem:i=>s.removeItem(i)}}const jm=t=>e=>{try{const s=t(e);return s instanceof Promise?s:{then(n){return jm(n)(s)},catch(n){return this}}}catch(s){return{then(n){return this},catch(n){return jm(n)(s)}}}},TT=(t,e)=>(s,n,i)=>{let a={storage:AT(()=>localStorage),partialize:x=>x,version:0,merge:(x,g)=>({...g,...x}),...e},o=!1;const l=new Set,c=new Set;let u=a.storage;if(!u)return t((...x)=>{console.warn(`[zustand persist middleware] Unable to update item '${a.name}', the given storage is currently unavailable.`),s(...x)},n,i);const d=()=>{const x=a.partialize({...n()});return u.setItem(a.name,{state:x,version:a.version})},h=i.setState;i.setState=(x,g)=>{h(x,g),d()};const f=t((...x)=>{s(...x),d()},n,i);i.getInitialState=()=>f;let m;const p=()=>{var x,g;if(!u)return;o=!1,l.forEach(b=>{var w;return b((w=n())!=null?w:f)});const y=((g=a.onRehydrateStorage)==null?void 0:g.call(a,(x=n())!=null?x:f))||void 0;return jm(u.getItem.bind(u))(a.name).then(b=>{if(b)if(typeof b.version=="number"&&b.version!==a.version){if(a.migrate){const w=a.migrate(b.state,b.version);return w instanceof Promise?w.then(S=>[!0,S]):[!0,w]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,b.state];return[!1,void 0]}).then(b=>{var w;const[S,z]=b;if(m=a.merge(z,(w=n())!=null?w:f),s(m,!0),S)return d()}).then(()=>{y?.(m,void 0),m=n(),o=!0,c.forEach(b=>b(m))}).catch(b=>{y?.(void 0,b)})};return i.persist={setOptions:x=>{a={...a,...x},x.storage&&(u=x.storage)},clearStorage:()=>{u?.removeItem(a.name)},getOptions:()=>a,rehydrate:()=>p(),hasHydrated:()=>o,onHydrate:x=>(l.add(x),()=>{l.delete(x)}),onFinishHydration:x=>(c.add(x),()=>{c.delete(x)})},a.skipHydration||p(),m||f},uv=TT,In=_1()(uv((t,e)=>({steps:{},schemas:{},registerStep:(s,n,i=!1)=>{t(a=>({schemas:{...a.schemas,[s]:{schema:n,clearOnNext:i}}}))},setStepData:(s,n)=>{t(i=>({steps:{...i.steps,[s]:{...i.steps[s],...n}}}))},getStepData:s=>e().steps[s]||{},clearStep:s=>{t(n=>({steps:{...n.steps,[s]:{}}}))},clearAll:()=>t({steps:{}})}),{name:"step-store"})),ET=_1()(uv((t,e)=>({snapshots:[],saveSnapshot:s=>{const n=In.getState().steps,i={id:Date.now().toString(),name:s,data:n,created:Date.now()};t(a=>({snapshots:[...a.snapshots,i]}))},loadSnapshot:s=>{const n=e().snapshots.find(i=>i.id===s);if(n){const i=In.getState();i.clearAll(),Object.entries(n.data).forEach(([a,o])=>{i.setStepData(a,o)})}},deleteSnapshot:s=>{t(n=>({snapshots:n.snapshots.filter(i=>i.id!==s)}))},listSnapshots:()=>e().snapshots}),{name:"snapshot-store"}));function dv(){const[t,e]=j.useState(!1),[s,n]=j.useState(""),[i,a]=j.useState(""),{snapshots:o,saveSnapshot:l,loadSnapshot:c,deleteSnapshot:u}=ET();j.useEffect(()=>{const p=x=>{x.key==="Escape"&&e(!1)};return window.addEventListener("keydown",p),()=>window.removeEventListener("keydown",p)},[]);const d=j.useMemo(()=>[...o].sort((p,x)=>x.created-p.created),[o]),h=j.useMemo(()=>{const p=i.trim().toLowerCase();return p?d.filter(x=>x.name.toLowerCase().includes(p)):d},[d,i]),f=()=>{const p=new Date().toLocaleString();l(`Snapshot ${p}`)},m=()=>{const p=s.trim();p&&(l(p),n(""))};return r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:()=>e(!0),title:"Snapshoty",className:"fixed right-4 bottom-4 bg-black text-white p-3 rounded-full shadow hover:bg-gray-900",children:"📸"}),t&&r.jsxs("div",{className:"fixed right-0 top-0 h-full w-64 bg-white border-l z-50 flex flex-col",children:[r.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b",children:[r.jsx("div",{className:"font-semibold text-sm",children:"Snapshoty"}),r.jsx("button",{onClick:()=>e(!1),className:"text-gray-500 hover:text-black text-lg leading-none","aria-label":"Zamknij",title:"Zamknij",children:"×"})]}),r.jsxs("div",{className:"p-3 border-b space-y-2",children:[r.jsxs("div",{className:"flex gap-2",children:[r.jsx("input",{className:"border px-2 py-1 rounded w-full text-sm",placeholder:"Nazwa snapshotu",value:s,onChange:p=>n(p.target.value),onKeyDown:p=>p.key==="Enter"&&m()}),r.jsx("button",{onClick:m,className:"bg-blue-600 hover:bg-blue-700 text-white text-xs px-3 rounded",children:"Zapisz"})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("button",{onClick:f,className:"text-xs text-blue-700 underline",children:"Szybki zapis"}),r.jsx("input",{className:"border px-2 py-1 rounded text-xs w-32",placeholder:"Szukaj…",value:i,onChange:p=>a(p.target.value)})]})]}),r.jsx("div",{className:"p-3 overflow-y-auto text-sm space-y-2",children:h.length===0?r.jsx("div",{className:"text-gray-500 text-xs text-center mt-4",children:"Brak snapshotów"}):h.map(p=>r.jsxs("div",{className:"border rounded p-2",children:[r.jsx("div",{className:"font-medium truncate",title:p.name,children:p.name}),r.jsx("div",{className:"text-[11px] text-gray-500",children:new Date(p.created).toLocaleString()}),r.jsxs("div",{className:"flex gap-2 mt-2",children:[r.jsx("button",{onClick:()=>c(p.id),className:"bg-green-600 hover:bg-green-700 text-white text-xs px-2 py-1 rounded",children:"Wczytaj"}),r.jsx("button",{onClick:()=>{confirm(`Usunąć „${p.name}”?`)&&u(p.id)},className:"bg-red-500 hover:bg-red-600 text-white text-xs px-2 py-1 rounded",children:"Usuń"})]})]},p.id))})]})]})}function DT(){const t=pe(),{steps:e,clearAll:s}=In(),n=!!e?.step1,i=!!e?.step1?.outline,a=!!e?.step2,o=e?.step2?.refined,l=()=>{s(),t("/admin/course-structure/step1",{replace:!0})};return r.jsxs(X,{children:[r.jsxs("div",{className:"relative overflow-hidden rounded-2xl border mb-6",children:[r.jsx("div",{className:"absolute inset-0 bg-purple-50"}),r.jsxs("div",{className:"relative px-6 py-8 flex items-center gap-3",children:[r.jsx("div",{className:"shrink-0 inline-flex h-10 w-10 items-center justify-center rounded-xl bg-black text-white",children:r.jsx(tc,{className:"w-5 h-5"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h1",{className:"text-xl sm:text-2xl font-semibold leading-tight",children:"Generator kursów — panel"}),r.jsx("p",{className:"text-sm text-zinc-600",children:"W 2 krokach wygenerujesz szkic kursu i rozpiszesz tematy lekcji z pomocą LLM."})]}),r.jsx("div",{className:"hidden md:block",children:r.jsxs(D,{onClick:l,className:"inline-flex items-center gap-2",children:["Nowy kurs",r.jsx(He,{className:"w-4 h-4"})]})})]})]}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[r.jsxs(P,{className:"lg:col-span-2",children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center gap-2",children:[r.jsx(Jt,{className:"w-5 h-5"}),"Szybki start"]})}),r.jsxs(I,{className:"space-y-5",children:[r.jsxs("div",{className:"rounded-xl border p-4",children:[r.jsxs("ol",{className:"list-decimal list-inside text-sm text-zinc-700 space-y-1",children:[r.jsx("li",{children:"Krok 1 — podstawy kursu (temat, grupa docelowa, poziom)."}),r.jsx("li",{children:"Krok 2 — doprecyzowanie listy modułów i lekcji."})]}),r.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row gap-2",children:[r.jsxs(D,{onClick:l,className:"flex-1 inline-flex items-center gap-2",children:["Rozpocznij",r.jsx(He,{className:"w-4 h-4"})]}),r.jsx(D,{asChild:!0,variant:"secondary",className:"flex-1",children:r.jsxs(Ke,{to:"/admin/course-structure/step4",className:"inline-flex items-center gap-2",children:["Edytuj istniejące kursy",r.jsx(He,{className:"w-4 h-4"})]})})]})]}),n||a?r.jsx(P,{className:"bg-muted/40",children:r.jsxs(I,{className:"pt-6",children:[r.jsxs("p",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[r.jsx(j_,{className:"w-4 h-4"}),"Ostatnia sesja"]}),r.jsx("div",{className:"text-sm text-muted-foreground",children:o?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"font-medium text-foreground",children:o.courseTitle}),r.jsxs("div",{className:"text-xs",children:[o.subject," • ",String(o.level),o.isMaturaCourse?" • Maturalny":""]}),r.jsxs("div",{className:"mt-3 flex gap-2",children:[r.jsx(D,{size:"sm",onClick:()=>t("/admin/course-structure/step2"),children:"Kontynuuj w kroku 2"}),r.jsx(D,{size:"sm",variant:"outline",onClick:()=>t("/admin/course-structure/step1"),children:"Podgląd kroku 1"}),r.jsx(D,{size:"sm",variant:"ghost",onClick:()=>s(),className:"text-red-600 hover:text-red-700",children:"Wyczyść sesję"})]})]}):i?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"font-medium text-foreground",children:e?.step1?.outline?.title||"Szkic kursu"}),r.jsxs("div",{className:"text-xs",children:[e?.step1?.outline?.subject||e?.step1?.subject," •"," ",e?.step1?.outline?.level||e?.step1?.level]}),r.jsx("div",{className:"mt-3",children:r.jsx(D,{size:"sm",onClick:()=>t("/admin/course-structure/step2"),children:"Przejdź do kroku 2"})})]}):r.jsx("div",{className:"text-sm",children:"Brak zapisanych szkiców do wznowienia."})})]})}):null]})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center gap-2",children:[r.jsx(Se,{className:"w-5 h-5"}),"Jak to działa?"]})}),r.jsxs(I,{className:"space-y-3",children:[r.jsxs(we,{children:[r.jsx(Gi,{className:"h-4 w-4"}),r.jsx(ve,{className:"text-xs",children:"Kreator może uwzględnić najnowszą (2025) podstawę programową LO (PL) dla kursów maturalnych."})]}),r.jsxs("div",{className:"text-sm text-muted-foreground space-y-2",children:[r.jsxs("p",{children:[r.jsx("span",{className:"font-medium text-foreground",children:"Krok 1:"})," podaj parametry kursu, wybierz poziom i (opcjonalnie) zgodność z podstawą."]}),r.jsxs("p",{children:[r.jsx("span",{className:"font-medium text-foreground",children:"Krok 2:"})," wygeneruj listę lekcji (z opisami), zweryfikuj i zapisz."]})]}),r.jsx("div",{className:"pt-2",children:r.jsxs(D,{onClick:l,variant:"outline",className:"w-full inline-flex items-center justify-center gap-2",children:["Przejdź do kroku 1",r.jsx(He,{className:"w-4 h-4"})]})})]})]})]})]})}function wm(t){if(!t)return N0();switch(t.type){case"string":return t.required?_0():_0().optional();case"number":return t.required?z0():z0().optional();case"boolean":return t.required?C0():C0().optional();case"array":return nA(wm(t.items||{}));case"object":{if(!t.properties)return S0({});const e={};for(const[s,n]of Object.entries(t.properties))e[s]=wm(n);return S0(e)}default:return N0()}}function vm(t,e=0){const s=" ".repeat(e);switch(t.type){case"string":return`${s}string${t.required?" (wymagane)":""}`;case"number":return`${s}number${t.required?" (wymagane)":""}`;case"boolean":return`${s}boolean${t.required?" (wymagane)":""}`;case"enum":return`${s}enum: ${t.options?.join(" | ")}`+(t.required?" (wymagane)":"");case"array":return`${s}array${t.minItems?` (min ${t.minItems})`:""}${t.maxItems?` (max ${t.maxItems})`:""}, element:
`+vm(t.items||{},e+2);case"object":return t.properties?s+`{
`+Object.entries(t.properties).map(([n,i])=>`${s}  ${n}: ${vm(i,e+4)}`).join(`
`)+`
`+s+"}":`${s}object`;default:return`${s}any`}}function MT(t){return`⚠️ Odpowiedz wyłącznie poprawnym JSON-em zgodnym z poniższą strukturą:

`+vm(t,0)}class su extends Error{constructor(s,n,i){super(s);rn(this,"status");rn(this,"info");this.name="LLMError",this.status=i,this.info=n}}async function Ji(t,e,s="json"){let n=t;s==="json"&&e&&(n+=`

`+MT(e));const i=await fetch("http://localhost:3001/api/chat",{method:"POST",headers:{"content-type":"application/json","x-api-key":"ce040e01e5b1b24f530a541f89e2409b328cf51efc6ba295c85ba1858072498b"},body:JSON.stringify({message:n,model:"gemini-2.5-flash",responseFormat:s})}),a=await i.text();let o=null;try{o=a?JSON.parse(a):null}catch{}if(!i.ok){const u=o?.error||o?.message||o?.details||i.statusText||"Błąd wywołania LLM";throw new su(u,o??{raw:a},i.status)}const l=o??{},c=l.response||l.text||l.message||"";if(s==="json"){const u=c.replace(/```json\s*|\s*```/g,"").trim();let d;try{d=JSON.parse(u)}catch{throw new su("Niepoprawny JSON z modelu",{raw:c})}if(e){const h=wm(e);try{return h.parse(d)}catch(f){throw new su("Błąd walidacji odpowiedzi LLM",{zodIssues:f?.issues??f,parsed:d})}}return d}return c}const sx=["Matematyka","Biologia","Chemia","Fizyka","Informatyka","Geografia","Historia","Polski","Angielski"],PT={Matematyka:"Matematyka",Biologia:"Biologia",Chemia:"Chemia",Fizyka:"Fizyka",Informatyka:"Informatyka",Geografia:"Geografia",Historia:"Historia",Polski:"Język polski",Angielski:"Język obcy nowożytny"},IT=[{id:"pl-lo-2025-math",label:"Podstawa programowa LO (2025) — Matematyka",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/matematyka",subjects:["Matematyka"],outcomes:{Matematyka:["Rozwiązuje równania i nierówności oraz interpretuje wyniki.","Analizuje funkcje i wykresy; stosuje własności do rozwiązywania zadań.","Geometria płaska i przestrzenna w praktycznych zastosowaniach.","Rachunek prawdopodobieństwa i statystyka opisowa do wnioskowania.","Modeluje problemy tekstowe z użyciem narzędzi matematycznych."]}},{id:"pl-lo-2025-it",label:"Podstawa programowa LO (2025) — Informatyka",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/informatyka",subjects:["Informatyka"],outcomes:{Informatyka:["Projektuje i analizuje proste algorytmy; implementuje je.","Dobiera i stosuje struktury danych.","Pisze, uruchamia i testuje programy.","Podstawy sieci i bezpieczeństwa informacji.","Współpraca zespołowa (repozytoria, wersjonowanie)."]}},{id:"pl-lo-2025-polish",label:"Podstawa programowa LO (2025) — Język polski",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/jezyk-polski",subjects:["Polski"],outcomes:{Polski:["Analizuje i interpretuje teksty literackie i nieliterackie.","Świadomie posługuje się środkami językowymi w wypowiedzi.","Tworzy wypowiedzi pisemne zgodne z wymogami gatunku.","Rozpoznaje konteksty kulturowe i historyczne utworów.","Korzysta z różnych źródeł informacji i je weryfikuje."]}},{id:"pl-lo-2025-bio",label:"Podstawa programowa LO (2025) — Biologia",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/biologia",subjects:["Biologia"],outcomes:{Biologia:["Wyjaśnia zjawiska biologiczne w oparciu o strukturę i funkcję.","Planuje i interpretuje proste doświadczenia biologiczne.","Analizuje dziedziczenie cech i zmienność organizmów.","Rozumie podstawy ekologii i ochrony środowiska.","Korzysta z danych biologicznych do wnioskowania."]}},{id:"pl-lo-2025-phy",label:"Podstawa programowa LO (2025) — Fizyka",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/fizyka",subjects:["Fizyka"],outcomes:{Fizyka:["Opisuje i wyjaśnia zjawiska fizyczne z użyciem pojęć i praw fizyki.","Wykonuje pomiary, szacuje niepewności i analizuje wyniki.","Stosuje zasady dynamiki, energii i pędu w zadaniach.","Interpretuje wykresy i zależności wielkości fizycznych.","Rozwiązuje zadania obliczeniowe, uzasadniając tok rozumowania."]}},{id:"pl-lo-2025-chem-podst",label:"Podstawa programowa LO (2025) — Chemia (podstawowy)",year:2025,level:"podstawowy",sourceUrl:"https://podstawaprogramowa.pl/Liceum-technikum/Chemia",subjects:["Chemia"],outcomes:{Chemia:["Stosuje zasady BHP w pracowni chemicznej; rozpoznaje piktogramy i prowadzi proste doświadczenia.","Opisuje budowę atomu i okresowość właściwości pierwiastków; zapisuje proste konfiguracje elektronowe.","Rozróżnia i charakteryzuje wiązania (jonowe, kowalencyjne, metaliczne) i przewiduje właściwości substancji.","Posługuje się pojęciami mol, masa molowa, objętość molowa; wykonuje obliczenia stechiometryczne.","Pisze i bilansuje równania reakcji, w tym redoks; wyznacza stopnie utlenienia.","Analizuje roztwory: oblicza stężenie procentowe i molowe; opisuje rozpuszczalność i czynniki ją zmieniające.","Opisuje kwasowo-zasadowość: pH, wskaźniki, moc kwasów/zasad; rozwiązuje proste zadania obliczeniowe.","Wyjaśnia czynniki wpływające na szybkość reakcji; opisuje równowagi chemiczne i zasadę Le Chateliera.","Charakteryzuje właściwości gazów i cieczy; stosuje równanie gazu doskonałego w prostych zadaniach.","Rozpoznaje podstawowe grupy funkcyjne w chemii organicznej; podaje właściwości i reakcje charakterystyczne.","Interpretuje i krytycznie analizuje dane (tabele, wykresy, schematy) oraz formułuje wnioski.","Wskazuje zastosowania związków chemicznych w życiu codziennym, środowisku i przemyśle; ocenia wpływ na środowisko."]}},{id:"pl-lo-2025-chem-rozsz",label:"Podstawa programowa LO (2025) — Chemia (rozszerzony)",year:2025,level:"rozszerzony",sourceUrl:"https://podstawaprogramowa.pl/Liceum-technikum/Chemia",subjects:["Chemia"],outcomes:{Chemia:["Wykonuje złożone obliczenia stechiometryczne (odczynnik ograniczający, wydajność, mieszanie roztworów).","Stosuje prawa termochemii: ΔH reakcji, prawo Hessa; jakościowo interpretuje wpływ ΔS i ΔG na spontaniczność.","Analizuje równowagi: zapisuje wyrażenia Kc/Kp, szacuje przesunięcia równowagi (Le Chatelier), rozwiązuje proste układy z K.","Opisuje i oblicza zagadnienia kwas-zasada: stałe dysocjacji, hydroliza soli, bufor i równanie Hendersona–Hasselbalcha.","Projektuje i interpretuje miareczkowania (kwas–zasada, redoks); szkicuje krzywe miareczkowania i dobiera wskaźniki.","Stosuje podstawy kinetyki: prawo szybkości, rząd reakcji z danych doświadczalnych, pojęcie energii aktywacji (Arrhenius jakościowo).","Wykorzystuje elektrochemię: buduje schematy ogniw, oblicza SEM ze standardowych potencjałów; jakościowo stosuje równanie Nernsta.","Posługuje się iloczynem rozpuszczalności (Ksp) do przewidywania strącania; analizuje równowagi strąceniowe.","Rozpoznaje i opisuje mechanizmy podstawowych reakcji organicznych (substytucja/addycja/eliminacja na poziomie jakościowym).","Analizuje izomerię (strukturalna, geometryczna, optyczna) i konsekwencje stereochemiczne właściwości związków.","Charakteryzuje polimery (addycja, kondensacja), makrocząsteczki i ich zastosowania; wskazuje aspekty środowiskowe.","Stosuje elementy analizy jakościowej i instrumentalnej (chromatografia w ujęciu szkolnym, proste widma) do identyfikacji związków."]}},{id:"pl-lo-2025-geo",label:"Podstawa programowa LO (2025) — Geografia",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/geografia",subjects:["Geografia"],outcomes:{Geografia:["Analizuje mapy, dane statystyczne i obrazy Ziemi.","Wyjaśnia procesy przyrodnicze i społeczno-ekonomiczne.","Ocena wpływu działalności człowieka na środowisko.","Interpretuje wskaźniki demograficzne i gospodarcze.","Korzysta z narzędzi GIS/geo-danych na poziomie podstawowym."]}},{id:"pl-lo-2025-hist",label:"Podstawa programowa LO (2025) — Historia",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/historia",subjects:["Historia"],outcomes:{Historia:["Porządkuje wydarzenia w czasie i przestrzeni (chronologia, mapa).","Analizuje i interpretuje źródła historyczne.","Wyjaśnia przyczyny i skutki zjawisk historycznych.","Rozpoznaje spory interpretacyjne i różne narracje.","Formułuje argumenty i wnioski w dyskusji o przeszłości."]}},{id:"pl-lo-2025-eng",label:"Podstawa programowa LO (2025) — Język obcy nowożytny (Angielski)",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/jezyk-obcy-nowozytny",subjects:["Angielski"],outcomes:{Angielski:["Rozumie typowe wypowiedzi ustne i pisemne w kontekście szkolnym.","Komunikuje się w codziennych sytuacjach i w tematach szkolnych.","Pisze krótkie wypowiedzi użytkowe zgodnie z celem i odbiorcą.","Rozwija zakres środków językowych (słownictwo, gramatyka).","Stosuje strategie uczenia się i korzysta z różnych źródeł."]}}];function OT(t){return sx.find(s=>s===t)??null}function nx(t){if(!t)return null;const e=OT(t);if(!e)return null;const s=PT[e],n=IT.filter(a=>a.subjects.includes(e)||a.subjects.includes(s));return n.length===0?null:[...n].sort((a,o)=>{const l=a.year??0,c=o.year??0;return c!==l?c-l:a.id.localeCompare(o.id)})[0]??null}const P0={type:"object",properties:{title:{type:"string"},subject:{type:"string",required:!0},level:{type:"string",required:!0},isMaturaCourse:{type:"boolean",required:!0},topics:{type:"array",minItems:5,items:{type:"object",properties:{title:{type:"string",required:!0},description:{type:"string",required:!0}}}}}};function RT({custom:t,generated:e,activeIsCustom:s}){const n=(t||"").trim(),i=(e||"").trim();return!n&&!i?null:r.jsxs("div",{className:"space-y-1",children:[r.jsx("span",{className:"text-xs text-primary/80",children:"NAZWA KURSU"}),r.jsxs("div",{children:[" ",r.jsx("span",{className:s?"font-medium":"",children:n}),s&&r.jsx("span",{className:"ml-2 text-xs text-primary/80",children:"(aktywna)"})]}),r.jsxs("div",{children:[r.jsx("span",{className:s?"":"font-medium",children:i}),!s&&r.jsx("span",{className:"ml-2 text-xs text-primary/80",children:"(aktywna)"})]})]})}function Xh({children:t}){return r.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-xs border bg-primary/10 border-primary text-primary",children:t})}function LT({subjectActive:t,levelActive:e,isMatura:s}){return r.jsxs("div",{className:"space-y-2",children:[r.jsx("div",{className:"text-[10px] uppercase tracking-wide text-muted-foreground",children:"Szczegóły"}),r.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[t&&r.jsx(Xh,{children:t}),e&&r.jsx(Xh,{children:e}),r.jsx(Xh,{children:s?"maturalny":"niematuralny"})]})]})}function FT(){const{registerStep:t,setStepData:e,getStepData:s}=In(),n=s("step1")||{};j.useEffect(()=>{t("step1",P0),n.subject||e("step1",{subject:"Matematyka",level:"podstawowy",isMaturaCourse:!0,alignToCurriculum:!0,useCustomTitle:!1})},[]);const i=j.useMemo(()=>nx(n.subject),[n.subject]),[a,o]=j.useState(!1),l=async()=>{e("step1",{isGenerating:!0});try{const p=i?.outcomes?.[n.subject]??[],x=n.isMaturaCourse&&n.alignToCurriculum&&i?`
Uwzględnij zgodność z podstawą programową LO (PL).
(Dokument: ${i.label}${i.year?` • ${i.year}`:""})
Wymagania do pokrycia:
${p.map((b,w)=>`${w+1}. ${b}`).join(`
`)}
Jeśli to możliwe, sygnalizuj pokrycie wymagań w nawiasie, np. "[PP]".
          `.trim():"",g=`
Wygeneruj szkic kursu dla nauczyciela:
- przedmiot: ${n.subject}
- poziom: ${n.level}
- charakter: ${n.isMaturaCourse?"maturalny":"niematuralny"}
${x?`
${x}
`:""}

Szkic ma być zwięzły, klarowny i praktyczny dla planowania lekcji. Zadbaj, by tematy były sensownie dobrane do poziomu.
      `.trim(),y=await Ji(g,P0);e("step1",{outline:y,isGenerating:!1})}catch{e("step1",{isGenerating:!1})}},c=!!(n.isMaturaCourse&&i&&n.alignToCurriculum),u=(n.title||"").trim(),d=(n.outline?.title||"").trim(),h=!!(n.useCustomTitle&&u),f=h?u:d||(n.subject&&n.level?`${n.subject} — kurs ${n.level}`:"Szkic kursu"),m=i?.outcomes?.[n.subject]??[];return r.jsxs(X,{children:[r.jsx(je,{title:"Krok 1 ",description:"Szkic kursu"}),r.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Parametry kursu"})}),r.jsxs(I,{className:"space-y-4",children:[r.jsxs(Ee,{value:n.subject||"Matematyka",onValueChange:p=>e("step1",{subject:p}),disabled:n.isGenerating,children:[r.jsx(_e,{children:r.jsx(De,{placeholder:"Wybierz przedmiot"})}),r.jsx(Ae,{children:sx.map(p=>r.jsx(ee,{value:p,children:p},p))})]}),r.jsxs(Ee,{value:n.level||"podstawowy",onValueChange:p=>e("step1",{level:p}),disabled:n.isGenerating,children:[r.jsx(_e,{children:r.jsx(De,{placeholder:"Wybierz poziom"})}),r.jsxs(Ae,{children:[r.jsx(ee,{value:"podstawowy",children:"Podstawowy"}),r.jsx(ee,{value:"rozszerzony",children:"Rozszerzony"})]})]}),r.jsx(te,{placeholder:"Tytuł kursu (opcjonalnie)",value:n.title||"",onChange:p=>e("step1",{title:p.target.value}),disabled:n.isGenerating}),r.jsx(P,{className:"bg-muted/40 border-dashed",children:r.jsxs(I,{className:"space-y-3 pt-4",children:[(n.title||"").trim()?r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(mt,{checked:!!n.useCustomTitle,onCheckedChange:p=>e("step1",{useCustomTitle:!!p}),disabled:n.isGenerating}),r.jsxs("span",{className:"text-sm",children:["Użyj ",r.jsx("strong",{children:"mojej nazwy"})," przy zapisie (zamiast wygenerowanej)"]})]}):null,r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(mt,{checked:n.isMaturaCourse||!1,onCheckedChange:p=>e("step1",{isMaturaCourse:!!p,alignToCurriculum:p?n.alignToCurriculum:!1}),disabled:n.isGenerating}),r.jsx("span",{className:"text-sm",children:"Kurs maturalny"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(mt,{checked:n.alignToCurriculum||!1,onCheckedChange:p=>e("step1",{alignToCurriculum:!!p}),disabled:n.isGenerating}),r.jsxs("span",{className:"text-sm",children:["Uwzględnij ",r.jsx("strong",{children:"najnowszą (2025)"})," podstawę programową LO (PL)"]})]})]})}),c&&r.jsxs(r.Fragment,{children:[r.jsxs(we,{children:[r.jsx(Gi,{className:"h-4 w-4"}),r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[r.jsxs(ve,{className:"text-xs",children:["Dokument: ",r.jsx("strong",{children:i?.label}),i?.year?` • ${i.year}`:""]}),m.length>0&&r.jsx(D,{type:"button",size:"sm",variant:"outline",className:"h-7 px-2 text-xs shrink-0",onClick:()=>o(p=>!p),children:a?"Ukryj wymagania":`Pokaż wymagania (${m.length})`})]})]}),a&&r.jsx("ul",{className:"text-xs list-disc pl-5 space-y-1 max-h-40 overflow-auto rounded-md border p-2",children:m.map((p,x)=>r.jsx("li",{className:"leading-snug",children:p},x))})]}),r.jsx(D,{onClick:l,disabled:n.isGenerating,className:"w-full",children:n.isGenerating?r.jsxs(r.Fragment,{children:[r.jsx(qt,{className:"w-4 h-4 animate-spin"}),"Generowanie..."]}):r.jsxs(r.Fragment,{children:[r.jsx(Jt,{className:"w-4 h-4"}),"Generuj szkic"]})})]})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Podgląd szkicu"})}),r.jsx(I,{children:n.isGenerating?r.jsx("div",{className:"flex items-center justify-center py-12",children:r.jsx(qt,{className:"w-6 h-6 animate-spin"})}):n.outline?r.jsxs("div",{className:"space-y-5",children:[r.jsx(RT,{custom:u,generated:d,activeIsCustom:h}),r.jsx(LT,{subjectActive:n.subject,levelActive:n.level,isMatura:n.isMaturaCourse}),r.jsx("div",{className:"space-y-2 max-h-96 overflow-auto pr-1",children:n.outline.topics?.map((p,x)=>r.jsxs(P,{className:"p-3",children:[r.jsxs("div",{className:"font-medium",children:[x+1,". ",p.title]}),r.jsx("div",{className:"text-sm text-muted-foreground",children:p.description})]},x))}),r.jsx(D,{asChild:!0,className:"w-full",children:r.jsx(Ke,{to:"/admin/course-structure/step2",children:"Dalej →"})})]}):r.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[r.jsx("div",{className:"font-medium",children:f}),r.jsx("div",{className:"text-xs mt-1",children:"Kliknij „Generuj szkic”"})]})})]})]}),r.jsx(dv,{})]})}const I0={type:"object",properties:{courseTitle:{type:"string",required:!0},courseDescription:{type:"string"},subject:{type:"string",required:!0},level:{type:"string",required:!0},isMaturaCourse:{type:"boolean",required:!0},topics:{type:"array",minItems:1,items:{type:"object",properties:{title:{type:"string",required:!0},description:{type:"string",required:!0},position:{type:"number",required:!0},is_published:{type:"boolean",required:!0}}}}}},O0=950;function $T(t){return String(t??"").trim().toLowerCase()==="rozszerzony"?"rozszerzony":"podstawowy"}function BT(){const{registerStep:t,setStepData:e,getStepData:s}=In(),n=pe(),i=s("step1")||{},a=s("step2")||{},[o,l]=j.useState(!1);j.useEffect(()=>{if(t("step2",I0),a.targetCount||e("step2",{targetCount:15}),!a.titleSource){const h=i.useCustomTitle&&i.title?.trim()?"custom":"generated";e("step2",{titleSource:h})}i.outline||n("/admin/course-structure/step1")},[]);const c=async()=>{if(!i.outline){e("step2",{error:"Brak danych z kroku 1"});return}e("step2",{isGenerating:!0,error:null,errorDetails:null});const h=String(i.subject||i.outline?.subject||"").trim(),f=$T(i.level||i.outline?.level),m=!!(i.isMaturaCourse??i.outline?.isMaturaCourse);let p=`
Rozwiń szkic kursu do dokładnie ${a.targetCount} tematów lekcji, logicznie uporządkowanych od podstaw do bardziej zaawansowanych.
Wygeneruj tytuły i krótkie opisy (2–3 zdania) z perspektywy nauczyciela przygotowującego plan pracy.
Kontekst:
- tytuł szkicu: ${i.outline.title}
- przedmiot: ${h}
- poziom: ${f}
- kurs ${m?"maturalny":"niematuralny"}
- główne tematy szkicu: ${(i.outline.topics||[]).map(x=>x.title).join(", ")}

Zachowaj spójność terminologii i adekwatność do poziomu. Jeśli kurs maturalny — uwzględnij wymagania egzaminacyjne w zakresie doboru tematów.
    `.trim();p.length>O0&&(p=p.slice(0,O0-3)+"...");try{const x=await Ji(p,I0),g=x.courseTitle||x.title||i.outline.title,b=(a.titleSource||(i.useCustomTitle&&i.title?.trim()?"custom":"generated"))==="custom"&&i.title?.trim()?i.title.trim():g,w={...x,courseTitle:b,subject:h,level:f,isMaturaCourse:m,topics:(x.topics||[]).map((S,z)=>({...S,position:Number(S.position||z+1),is_published:!1}))};e("step2",{refined:w,isGenerating:!1,error:null,errorDetails:null,generatedTitle:g})}catch(x){console.error("Błąd generowania:",x);let g;x instanceof su?g={message:x.message,status:x.status,...x.info&&typeof x.info=="object"?x.info:{raw:x.info}}:x instanceof Error?g={message:x.message}:g={error:x},e("step2",{isGenerating:!1,error:"Nie udało się wygenerować tematów. Spróbuj ponownie.",errorDetails:g})}},u=()=>{n("/admin/course-structure/step3",{state:{refined:a.refined,outline:i.outline}})},d=a.titleSource==="custom"&&i.title?.trim()?i.title.trim():a.generatedTitle||i.outline?.title;return r.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[r.jsx("h1",{className:"text-2xl font-semibold mb-6",children:"Krok 2 — Szczegółowe tematy lekcji"}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Konfiguracja"})}),r.jsxs(I,{className:"space-y-4",children:[i.outline&&r.jsxs(we,{children:[r.jsx(st,{className:"h-4 w-4"}),r.jsxs(ve,{children:[r.jsx("strong",{children:"Rozwijamy kurs:"})," ",i.outline.title,r.jsx("br",{}),r.jsxs("span",{className:"text-muted-foreground",children:[String(i.subject||i.outline.subject)," • ",String(i.level||i.outline.level),!!(i.isMaturaCourse||i.outline.isMaturaCourse)&&" • Maturalny"]})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"block text-sm font-medium",children:"Źródło tytułu kursu"}),i.title?.trim()?r.jsxs("div",{className:"flex flex-col gap-2",children:[r.jsxs("div",{className:"flex gap-2",children:[r.jsx(D,{type:"button",variant:a.titleSource==="custom"?"default":"outline",onClick:()=>e("step2",{titleSource:"custom"}),className:"flex-1",children:"Moja nazwa"}),r.jsx(D,{type:"button",variant:a.titleSource==="generated"?"default":"outline",onClick:()=>e("step2",{titleSource:"generated"}),className:"flex-1",children:"Wygenerowana"})]}),r.jsxs("div",{className:"text-xs text-muted-foreground",children:["• Moja: ",r.jsx("strong",{children:i.title.trim()}),r.jsx("br",{}),"• Wygenerowana: ",r.jsx("strong",{children:a.generatedTitle||i.outline?.title})]}),r.jsxs("div",{className:"text-xs",children:["Zostanie zapisane: ",r.jsx("strong",{children:d})]})]}):r.jsx("div",{className:"text-xs text-muted-foreground",children:"Brak własnej nazwy z kroku 1 — zostanie użyta wygenerowana."})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-2",children:"Liczba tematów lekcji"}),r.jsx(te,{type:"number",min:"5",max:"50",value:a.targetCount||15,onChange:h=>e("step2",{targetCount:Number(h.target.value)}),disabled:a.isGenerating}),r.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Zalecane: 10-20 dla kursu podstawowego, 20-30 dla rozszerzonego"})]}),a.error&&r.jsxs("div",{className:"space-y-2",children:[r.jsxs(we,{variant:"destructive",children:[r.jsx(st,{className:"h-4 w-4"}),r.jsx(ve,{children:a.error})]}),a.errorDetails&&r.jsxs(P,{children:[r.jsx(F,{className:"py-3",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx(L,{className:"text-sm",children:"Szczegóły błędu"}),r.jsx(D,{variant:"ghost",size:"sm",onClick:()=>l(h=>!h),className:"h-7",children:o?r.jsx(Ua,{className:"w-4 h-4"}):r.jsx(ls,{className:"w-4 h-4"})})]})}),o&&r.jsxs(I,{className:"pt-0",children:[r.jsx(mn,{className:"font-mono text-xs h-40",readOnly:!0,value:JSON.stringify(a.errorDetails,null,2)}),"limits"in a.errorDetails&&r.jsxs("div",{className:"text-xs text-muted-foreground mt-2",children:[r.jsx("strong",{children:"Wskazówka:"})," Twoja wiadomość mogła przekroczyć limit (",a.errorDetails.limits?.maxMessageLength," znaków). Spróbuj zmniejszyć liczbę tematów lub usunąć część kontekstu."]}),typeof a.errorDetails?.status=="number"&&a.errorDetails.status>=500&&r.jsxs("div",{className:"text-xs text-muted-foreground mt-2",children:[r.jsx("strong",{children:"Wskazówka:"})," Usługa modelu chwilowo przeciążona (HTTP ",a.errorDetails.status,"). Spróbuj ponownie za chwilę."]})]})]})]}),r.jsx(D,{onClick:c,disabled:a.isGenerating||!i.outline,className:"w-full",children:a.isGenerating?r.jsxs(r.Fragment,{children:[r.jsx(qt,{className:"w-4 h-4 animate-spin"}),"Generowanie tematów..."]}):r.jsxs(r.Fragment,{children:[r.jsx(Jt,{className:"w-4 h-4"}),"Generuj ",a.targetCount," tematów"]})}),a.refined&&r.jsx(P,{className:"bg-muted",children:r.jsxs(I,{className:"pt-6",children:[r.jsx("p",{className:"text-sm font-medium mb-2",children:"Wygenerowano:"}),r.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[r.jsxs("div",{children:["• ",a.refined.topics?.length||0," tematów"]}),r.jsxs("div",{children:["• ",a.refined.courseDescription?"✓":"✗"," Opis kursu"]}),r.jsxs("div",{children:["• Poziom: ",a.refined.level]})]})]})})]})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Podgląd tematów"})}),r.jsx(I,{children:a.isGenerating?r.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-muted-foreground",children:[r.jsx(qt,{className:"w-8 h-8 animate-spin mb-3"}),r.jsxs("p",{className:"text-sm",children:["Generowanie ",a.targetCount," tematów..."]}),r.jsx("p",{className:"text-xs mt-1",children:"To może potrwać do 30 sekund"})]}):a.refined?r.jsxs(r.Fragment,{children:[r.jsx(P,{className:"mb-4",children:r.jsxs(I,{className:"pt-6",children:[r.jsx("h3",{className:"font-bold",children:a.refined.courseTitle}),a.refined.courseDescription&&r.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:a.refined.courseDescription}),r.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[a.refined.subject," • ",a.refined.level,a.refined.isMaturaCourse?" • Maturalny":""]})]})}),r.jsx(bt,{className:"h-[400px] mb-4",children:r.jsx("div",{className:"space-y-2",children:a.refined.topics?.map(h=>r.jsx(P,{className:"p-3",children:r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsxs("span",{className:"text-muted-foreground text-sm",children:[h.position,"."]}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"font-medium text-sm",children:h.title}),r.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:h.description})]})]})},h.position))})}),r.jsxs(D,{onClick:u,className:"w-full",variant:"default",children:[r.jsx("span",{children:"Przejdź do zapisu"}),r.jsx(He,{className:"w-4 h-4"})]})]}):r.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[r.jsx("p",{className:"text-sm",children:"Tematy pojawią się tutaj po wygenerowaniu"}),r.jsx("p",{className:"text-xs mt-2",children:'Wybierz liczbę tematów i kliknij "Generuj"'})]})})]})]}),r.jsx(dv,{})]})}function qT(t){return String(t??"").trim().toLowerCase()==="rozszerzony"?"rozszerzony":"podstawowy"}function VT(){const t=pe(),e=gn(),{data:s}=wt(),{steps:n,clearAll:i}=In(),a=j.useMemo(()=>e?.state?.refined??n?.step2?.refined,[e?.state,n]),o=j.useMemo(()=>e?.state?.outline??n?.step1?.outline,[e?.state,n]),[l,c]=j.useState(!1),[u,d]=j.useState(null),[h,f]=j.useState(0),[m,p]=j.useState(null),{mutate:x}=hn(),{mutate:g}=hn(),y=async()=>{if(!a){p("Brak danych kursu (refined). Wróć do kroku 2.");return}p(null),c(!0),f(0);try{const w=qT(a.level),S=String(a.subject??o?.subject??"").trim(),z=!!a.isMaturaCourse,N=await new Promise((v,_)=>{x({resource:"courses",values:{title:a.courseTitle,description:a.courseDescription||"",vendor_id:Number(s?.vendor_id??0),is_published:!1,icon_emoji:o?.icon_emoji||"📚",subject:S,level:w,is_exam_course:z}},{onSuccess:A=>{const E=A?.data?.id;if(E==null)return _(new Error("Brak ID kursu"));v(E)},onError:A=>_(A)})});d(N);const k=typeof N=="string"?parseInt(N,10):N,C=a.topics?.length||0;for(let v=0;v<C;v++){const _=a.topics[v],A=Number(_.position??v+1);await new Promise(E=>{g({resource:"topics",values:{course_id:k,title:_.title,position:A,is_published:!!(_.is_published??!1)}},{onSuccess:()=>{f(M=>M+1),E()},onError:()=>E()})})}const T=a.topics?.length||0;t("/admin/course-structure/step4",{replace:!0,state:{courseId:k,courseTitle:a.courseTitle,topicsCount:T}}),i()}catch(w){console.error("Błąd zapisu:",w),p(w?.message||"Nie udało się zapisać kursu.")}finally{c(!1)}};if(!a)return r.jsx("div",{className:"max-w-3xl mx-auto p-6",children:r.jsx(P,{children:r.jsxs(I,{className:"pt-6",children:[r.jsxs(we,{variant:"destructive",children:[r.jsx(st,{className:"h-4 w-4"}),r.jsxs(ve,{children:[r.jsx("span",{className:"font-medium",children:"Brak danych do zapisu"}),r.jsx("br",{}),"Wróć do kroku 2 i wygeneruj tematy kursu."]})]}),r.jsx(D,{asChild:!0,className:"mt-4",children:r.jsxs(Ke,{to:"/admin/course-structure/step2",children:[r.jsx(Pe,{className:"w-4 h-4"}),"Wróć do kroku 2"]})})]})})});const b=a.topics?.length>0?h/a.topics.length*100:0;return r.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[r.jsxs("header",{className:"flex items-center gap-2 mb-6",children:[r.jsx(Jr,{className:"w-5 h-5"}),r.jsx("h1",{className:"text-xl font-semibold",children:"Krok 3 — Zapis kursu"})]}),r.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Podsumowanie"})}),r.jsxs(I,{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"font-semibold",children:a.courseTitle}),a.courseDescription&&r.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:a.courseDescription}),r.jsxs("div",{className:"text-xs text-muted-foreground mt-2",children:[a.subject," • ",String(a.level),a.isMaturaCourse?" • Maturalny":""]})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"text-sm font-medium mb-2",children:["Tematy (",a.topics.length,"):"]}),r.jsx(bt,{className:"h-64",children:r.jsxs("div",{className:"space-y-1 text-sm",children:[a.topics.slice(0,12).map((w,S)=>r.jsxs("div",{className:"border-l-2 border-muted pl-2",children:[r.jsxs("span",{className:"text-muted-foreground",children:[Number(w.position??S+1),"."]})," ",w.title]},S)),a.topics.length>12&&r.jsxs("div",{className:"text-xs text-muted-foreground italic",children:["... i ",a.topics.length-12," więcej"]})]})})]}),m&&r.jsxs(we,{variant:"destructive",children:[r.jsx(st,{className:"h-4 w-4"}),r.jsx(ve,{children:m})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(D,{onClick:y,disabled:l,className:"flex-1",children:[l?r.jsx(qt,{className:"w-4 h-4 animate-spin"}):r.jsx(Jr,{className:"w-4 h-4"}),l?"Zapisywanie...":"Zapisz kurs i tematy"]}),r.jsx(D,{asChild:!0,variant:"outline",children:r.jsx(Ke,{to:"/admin/course-structure/step2",children:r.jsx(Pe,{className:"w-4 h-4"})})})]})]})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Status zapisu"})}),r.jsx(I,{children:!l&&!u?r.jsxs("p",{className:"text-sm text-muted-foreground",children:['Kliknij „Zapisz kurs i tematy", aby utworzyć kurs i'," ",a.topics.length," tematów."]}):l?r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[r.jsx(qt,{className:"w-4 h-4 animate-spin"}),"Zapisywanie tematów: ",h," / ",a.topics.length]}),r.jsx(un,{value:b,className:"w-full"})]}):u?r.jsxs(we,{children:[r.jsx(ws,{className:"h-4 w-4"}),r.jsxs(ve,{children:[r.jsx("span",{className:"font-medium",children:"Zapisano pomyślnie!"}),r.jsx("br",{}),"ID kursu: ",String(u)]})]}):null})]})]})]})}const UT={type:"object",properties:{courseTitle:{type:"string"},topics:{type:"array",minItems:1,items:{type:"object",properties:{title:{type:"string",required:!0},description:{type:"string",required:!0}}}}}};function WT(){const t=gn(),e=pe(),s=t?.state?.courseId,n=t?.state?.courseTitle||"Nowy kurs",i=t?.state?.topicsCount||0,{data:a,isLoading:o,isError:l,refetch:c}=Y({resource:"courses",pagination:{current:1,pageSize:50},sorters:[{field:"id",order:"desc"}]}),u=a?.data??[],[d,h]=j.useState(s);j.useEffect(()=>{!d&&u.length>0&&h(u[0].id)},[d,u]),j.useEffect(()=>{c()},[]);const{data:f,isLoading:m,isError:p,refetch:x}=Y({resource:"topics",filters:d?[{field:"course_id",operator:"eq",value:typeof d=="string"?parseInt(d,10):d}]:[],sorters:[{field:"position",order:"asc"}],pagination:{current:1,pageSize:500},queryOptions:{enabled:!!d}});j.useEffect(()=>{d&&x()},[d]);const g=f?.data??[],y=j.useMemo(()=>{if(s!==void 0)return typeof s=="string"?parseInt(s,10):s},[s]),{mutate:b}=lr(),[w,S]=j.useState(null),z=async($,J)=>{window.confirm(`Na pewno usunąć temat${J?`: “${J}”`:""}? Tego nie można cofnąć.`)&&(S($),await new Promise(W=>{b({resource:"topics",id:$},{onSuccess:()=>{S(null),x(),W()},onError:()=>{S(null),W()}})}))},{mutate:N}=lr(),[k,C]=j.useState(!1),T=async()=>{if(!d)return;const J=u.find(W=>Number(W.id)===Number(d))?.title||`Kurs #${String(d)}`;window.confirm(`Usunąć kurs „${J}”? Wszystkie jego tematy (i dalsze zależne rekordy) zostaną usunięte kaskadowo. Tej operacji nie można cofnąć.`)&&(C(!0),await new Promise(W=>{N({resource:"courses",id:d},{onSuccess:async()=>{C(!1),h(void 0),await c(),await x(),W()},onError:()=>{C(!1),W()}})}))},{mutate:v}=hn(),[_,A]=j.useState(g.length||15),[E,M]=j.useState(!1),[O,R]=j.useState(0),B=async()=>{if(!d)return;const $=u.find(me=>Number(me.id)===Number(d)),J=$?.title||"Kurs",ie=$?.description||"";if(window.confirm(`To zastąpi WSZYSTKIE tematy kursu „${J}”.

Kontynuować?`)){M(!0),R(0);try{const me=`
Jesteś metodykiem. Wygeneruj dokładnie ${_} tematów lekcji do kursu:
- Tytuł kursu: ${J}
- Opis (jeśli jest): ${ie||"(brak)"}

Wypisz listę tematów (tytuł + krótki opis 1–2 zdania) z narastającą trudnością.
`.trim(),It=(await Ji(me,UT))?.topics||[],Re=g.filter(ke=>ke?.id!==void 0&&ke?.id!==null);for(let ke=0;ke<Re.length;ke++){const es=Re[ke].id;await new Promise(ts=>{b({resource:"topics",id:es},{onSuccess:()=>ts(),onError:()=>ts()})}),R(Math.round((ke+1)/(Re.length+It.length)*100))}for(let ke=0;ke<It.length;ke++){const es=It[ke];await new Promise(ts=>{v({resource:"topics",values:{course_id:typeof d=="string"?parseInt(d,10):d,title:es.title,position:ke+1,is_published:!1}},{onSuccess:()=>{R(Math.round((Re.length+(ke+1))/(Re.length+It.length)*100)),ts()},onError:()=>ts()})})}await x()}catch(me){console.error("Regeneracja tematów nie powiodła się",me)}finally{M(!1),R(0)}}},K=()=>{if(!d)return;const $=u.find(J=>Number(J.id)===Number(d));e("/admin/course-structure/step5",{state:{courseId:typeof d=="string"?parseInt(d,10):d,courseTitle:$?.title||`Kurs #${String(d)}`,courseDescription:$?.description||"",currentCount:g.length}})};return r.jsxs("div",{className:"max-w-7xl mx-auto p-6 min-h-screen flex flex-col",children:[r.jsxs("header",{className:"flex items-center gap-2 mb-6",children:[r.jsx(ho,{className:"w-5 h-5 text-green-600"}),r.jsx("h1",{className:"text-xl font-semibold",children:"Krok 4 — Zakończone"})]}),s!==void 0&&r.jsxs(P,{className:"mb-6 border-green-200 bg-green-50/50",children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center gap-2",children:[r.jsx(w_,{className:"w-5 h-5 text-green-700"}),"Kurs utworzony"]})}),r.jsxs(I,{className:"space-y-2",children:[r.jsx(we,{children:r.jsxs(ve,{className:"text-sm",children:[r.jsx("span",{className:"font-medium",children:n}),i?r.jsxs(r.Fragment,{children:[" — zapisano ",i," temat",i===1?"":i<5?"y":"ów","."]}):null," ","(ID: ",String(s),")"]})}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"Nowy kurs jest wyróżniony i zaznaczony — po prawej widzisz jego tematy."})]})]}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-6 flex-1",children:[r.jsxs(P,{className:"lg:col-span-2 lg:h-full flex flex-col",children:[r.jsx(F,{children:r.jsx(L,{children:"Wszystkie kursy"})}),r.jsx(I,{className:"flex-1 overflow-hidden",children:o?r.jsxs("div",{className:"space-y-2",children:[r.jsx(_s,{className:"h-10 w-full"}),r.jsx(_s,{className:"h-10 w-full"}),r.jsx(_s,{className:"h-10 w-full"})]}):l?r.jsx(we,{variant:"destructive",children:r.jsx(ve,{children:"Nie udało się pobrać listy kursów."})}):u.length===0?r.jsx("div",{className:"text-sm text-muted-foreground py-4",children:"Brak kursów."}):r.jsx(bt,{className:"h-full pr-2",children:r.jsx("div",{className:"space-y-2",children:u.map($=>{const J=y!==void 0&&Number($.id)===Number(y),ie=d!==void 0&&Number($.id)===Number(d);return r.jsx("button",{onClick:()=>h($.id),className:["w-full text-left rounded-xl border px-3 py-2 transition",ie?"border-black/80 bg-black text-white":"hover:bg-muted/60",J&&!ie?"border-green-400":"",J&&ie?"ring-2 ring-green-300":""].join(" "),children:r.jsxs("div",{className:"flex items-start justify-between gap-2",children:[r.jsxs("div",{children:[r.jsx("div",{className:["font-medium",ie?"text-white":"text-foreground"].join(" "),children:$.title||`Kurs #${$.id}`}),$.description?r.jsx("div",{className:["text-xs line-clamp-2",ie?"text-white/80":"text-muted-foreground"].join(" "),children:$.description}):null]}),r.jsxs("div",{className:"shrink-0 flex items-center gap-2",children:[J&&r.jsx(V,{variant:ie?"secondary":"default",children:"NOWY"}),!$.is_published&&r.jsx(V,{variant:ie?"secondary":"outline",className:"text-[10px]",children:"szkic"})]})]})},$.id)})})})})]}),r.jsxs(P,{className:"lg:col-span-3 lg:h-full flex flex-col",children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center justify-between gap-2",children:[r.jsxs("span",{children:["Tematy:"," ",(()=>{const $=u.find(J=>Number(J.id)===Number(d));return $?.title?$.title:d?`Kurs #${String(d)}`:"—"})()]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs(D,{size:"sm",variant:"destructive",onClick:T,disabled:!d||k||E||m,title:"Usuń kurs wraz z powiązanymi danymi",children:[r.jsx(St,{className:"w-4 h-4 mr-1"}),k?"Usuwanie...":"Usuń kurs"]}),r.jsxs(D,{size:"sm",variant:"outline",onClick:K,disabled:!d||m,children:[r.jsx(Jt,{className:"w-4 h-4 mr-1"}),"Uzupełnij braki"]})]})]})}),r.jsxs(I,{className:"flex-1 overflow-hidden space-y-4",children:[r.jsxs("div",{className:"rounded-xl border p-3",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(Qp,{className:"w-4 h-4"}),r.jsx("div",{className:"text-sm font-medium",children:"Wygeneruj od nowa"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(te,{type:"number",min:5,max:50,value:_,onChange:$=>A(Number($.target.value)),className:"max-w-[120px]",disabled:E||m||!d}),r.jsx(D,{size:"sm",onClick:B,disabled:E||m||!d||_<1,children:E?r.jsxs(r.Fragment,{children:[r.jsx(un,{value:O,className:"w-28 mr-2"}),"Przebudowa…"]}):r.jsxs(r.Fragment,{children:[r.jsx(Jt,{className:"w-4 h-4 mr-1"}),"Generuj ",_]})})]}),r.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Zastąpi wszystkie istniejące tematy nowymi propozycjami (LLM) na podstawie tytułu/opisu kursu."})]}),d?m?r.jsxs("div",{className:"space-y-2",children:[r.jsx(_s,{className:"h-16 w-full"}),r.jsx(_s,{className:"h-16 w-full"}),r.jsx(_s,{className:"h-16 w-full"})]}):p?r.jsx(we,{variant:"destructive",children:r.jsx(ve,{children:"Nie udało się pobrać tematów dla wybranego kursu."})}):g.length===0?r.jsx("div",{className:"text-sm text-muted-foreground py-4",children:"Brak tematów dla tego kursu."}):r.jsx(bt,{className:"h-full",children:r.jsx("div",{className:"space-y-2",children:g.map(($,J)=>{const ie=Number($.position??J+1),W=$?.id!==void 0&&$?.id!==null,me=W&&w===$.id;return r.jsxs("div",{className:"rounded-xl border p-3 flex items-start gap-3",children:[r.jsxs("span",{className:"text-sm text-muted-foreground",children:[ie,"."]}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"font-medium text-sm",children:$.title}),"description"in $&&$.description?r.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:$.description}):null]}),r.jsx(D,{type:"button",size:"sm",variant:"ghost",className:"text-red-600 hover:text-red-700",disabled:!W||me,onClick:()=>W&&z($.id,$.title),title:W?"Usuń temat":"Brak ID tematu",children:r.jsx(St,{className:"w-4 h-4"})})]},$.id??`row-${J}`)})})}):r.jsx("div",{className:"text-sm text-muted-foreground py-4",children:"Wybierz kurs z listy po lewej."})]})]})]})]})}const KT={type:"object",properties:{topics:{type:"array",minItems:1,items:{type:"object",properties:{title:{type:"string",required:!0},description:{type:"string",required:!0}}}}}};function HT(){const t=pe(),e=gn(),s=e?.state?.courseId,n=e?.state?.courseTitle||"Kurs",i=e?.state?.courseDescription||"";j.useEffect(()=>{s||t("/admin/course-structure/step4")},[s]);const{data:a,refetch:o,isLoading:l}=Y({resource:"topics",filters:s?[{field:"course_id",operator:"eq",value:typeof s=="string"?parseInt(s,10):s}]:[],sorters:[{field:"position",order:"asc"}],pagination:{current:1,pageSize:500},queryOptions:{enabled:!!s}}),c=j.useMemo(()=>a?.data??[],[a]),u=j.useMemo(()=>c.reduce((C,T)=>Math.max(C,Number(T.position??0)),0),[c]),[d,h]=j.useState(""),[f,m]=j.useState(!1),[p,x]=j.useState([]),[g,y]=j.useState({}),{mutate:b}=hn(),w=C=>y(T=>({...T,[C]:!T[C]})),S=()=>y(Object.fromEntries(p.map((C,T)=>[T,!0]))),z=()=>y({}),N=async()=>{if(!s)return;const C=3;m(!0);try{const T=c.map(E=>E.title).filter(Boolean),v=`
Uzupełnij kurs o NOWE tematy. Wygeneruj DOKŁADNIE ${C} propozycje (tytuł + krótki opis 1–2 zdania).
Unikaj powtórzeń względem istniejących tematów.
${d?`Preferowane kierunki / wskazówki: ${d}`:""}
Dane kursu:
- Tytuł: ${n}
- Opis: ${i||"(brak)"}
- Istniejące tematy: ${T.length?T.join("; "):"(brak)"}

Zwróć listę obiektów JSON zgodnych ze schematem.
`.trim(),A=(await Ji(v,KT))?.topics||[];x(A),y(Object.fromEntries(A.map((E,M)=>[M,!0])))}finally{m(!1)}},k=async()=>{if(!s||p.length===0)return;const C=p.filter((_,A)=>g[A]);if(C.length===0)return;const T=typeof s=="string"?parseInt(s,10):s;let v=u;for(let _=0;_<C.length;_++){v+=1;const A=C[_];await new Promise(E=>{b({resource:"topics",values:{course_id:T,title:A.title,position:v,is_published:!1}},{onSuccess:()=>E(),onError:()=>E()})})}await o(),t("/admin/course-structure/step4",{replace:!0,state:{courseId:s,courseTitle:n,topicsCount:c.length+C.length}})};return r.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[r.jsxs("header",{className:"flex items-center gap-2 mb-6",children:[r.jsx(Jt,{className:"w-5 h-5"}),r.jsx("h1",{className:"text-xl font-semibold",children:"Krok 5 — Uzupełnij brakujące tematy"})]}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center gap-2",children:[r.jsx(qr,{className:"w-4 h-4"}),"Kontekst kursu"]})}),r.jsxs(I,{className:"space-y-3",children:[r.jsxs("div",{className:"text-sm",children:[r.jsx("div",{className:"font-medium",children:n}),i&&r.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:i})]}),r.jsxs("div",{className:"text-sm",children:["Aktualnie: ",r.jsx("strong",{children:c.length})," tematów"]}),r.jsxs("div",{className:"flex flex-col gap-1",children:[r.jsx("label",{className:"text-sm",children:"Podpowiedź dla generatora (opcjonalnie)"}),r.jsx(te,{type:"text",placeholder:"Np. dodaj tematy z ekologii i ochrony środowiska…",value:d,onChange:C=>h(C.target.value)})]}),r.jsx("div",{className:"text-xs text-muted-foreground",children:"Poniżej lista istniejących tematów — generator unika duplikatów."}),r.jsx(bt,{className:"h-[280px] pr-2",children:l?r.jsx("div",{className:"text-sm text-muted-foreground",children:"Ładowanie…"}):c.length===0?r.jsx("div",{className:"text-sm text-muted-foreground",children:"Brak tematów."}):r.jsx("div",{className:"space-y-1 text-sm",children:c.map((C,T)=>r.jsxs("div",{className:"border-l-2 border-muted pl-2",children:[r.jsxs("span",{className:"text-muted-foreground",children:[Number(C.position??T+1),"."]})," ",C.title]},C.id??T))})}),r.jsxs("div",{className:"pt-2",children:[r.jsx(D,{asChild:!0,size:"sm",variant:"outline",className:"mr-2",children:r.jsxs(Ke,{to:"/admin/course-structure/step4",children:[r.jsx(Pe,{className:"mr-1"}),"Wróć"]})}),r.jsxs(D,{size:"sm",onClick:N,disabled:f,children:[r.jsx(tc,{}),f?"Generowanie...":"Generuj propozycje nowych tematów"]})]})]})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center gap-2",children:[r.jsx(v_,{className:"w-4 h-4"}),"Propozycje (zaznacz, które dodać)"]})}),r.jsx(I,{children:p.length===0?r.jsxs(we,{children:[r.jsx(st,{className:"h-4 w-4"}),r.jsx(ve,{className:"text-sm",children:"Brak propozycji."})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[r.jsx(D,{size:"sm",variant:"outline",onClick:S,children:"Zaznacz wszystko"}),r.jsx(D,{size:"sm",variant:"outline",onClick:z,children:"Wyczyść zaznaczenie"}),r.jsxs("div",{className:"text-xs text-muted-foreground ml-auto",children:["Wybrane: ",p.filter((C,T)=>g[T]).length," / ",p.length]})]}),r.jsx(bt,{className:"h-[380px] pr-2",children:r.jsx("div",{className:"space-y-2",children:p.map((C,T)=>r.jsxs("div",{className:"rounded-xl border p-3 flex items-start gap-3",children:[r.jsx(mt,{checked:!!g[T],onCheckedChange:()=>w(T),className:"mt-1"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"font-medium text-sm",children:C.title}),r.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:C.description})]})]},T))})}),r.jsxs("div",{className:"flex gap-2 mt-4",children:[r.jsxs(D,{onClick:k,className:"flex-1",disabled:p.every((C,T)=>!g[T]),children:["Zapisz wybrane",r.jsx(He,{className:"w-4 h-4 ml-1"})]}),r.jsx(D,{variant:"outline",className:"flex-1",onClick:()=>x([]),children:"Wyczyść podgląd"})]})]})})]})]})]})}const GT=[r.jsx(Z,{path:"/course-structure",element:r.jsx(DT,{})},"course-dashboard"),r.jsx(Z,{path:"/course-structure/step1",element:r.jsx(FT,{})},"course-step1"),r.jsx(Z,{path:"/course-structure/step2",element:r.jsx(BT,{})},"course-step2"),r.jsx(Z,{path:"/course-structure/step3",element:r.jsx(VT,{})},"course-step3"),r.jsx(Z,{path:"/course-structure/step4",element:r.jsx(WT,{})},"course-step4"),r.jsx(Z,{path:"/course-structure/step5",element:r.jsx(HT,{})},"course-step5")],R0={name:"course-structure",list:"/course-structure",create:"/course-structure/step1",meta:{canDelete:!1,label:"Generator kursów",icon:r.jsx(tc,{className:"h-4 w-4"})}},JT=[{id:"course-structure",title:"Generator struktury kursu",description:"Stwórz kompletną strukturę kursu z harmonogramem i tematami",icon:vu,path:"/admin/course-structure",color:"from-indigo-50 to-blue-50",borderColor:"border-indigo-200",iconBg:"bg-indigo-100",iconColor:"text-indigo-600",buttonBg:"bg-indigo-600 hover:bg-indigo-700",features:["Automatyczna analiza wymagań","Generowanie harmonogramu","Podział na tygodnie i tematy","Zgodność z podstawą programową"],estimatedTime:"15-20 min",targetAudience:"Twórcy nowych kursów"},{id:"educational-material",title:"Kreator materiałów edukacyjnych",description:"Generuj angażujące materiały dydaktyczne dostosowane do wieku uczniów",icon:Se,path:"/admin/educational-material",color:"from-purple-50 to-pink-50",borderColor:"border-purple-200",iconBg:"bg-purple-100",iconColor:"text-purple-600",buttonBg:"bg-purple-600 hover:bg-purple-700",features:["Materiały dostosowane do wieku","Ćwiczenia praktyczne","Formatowanie Markdown","Integracja z istniejącymi kursami"],estimatedTime:"10-15 min",targetAudience:"Nauczyciele wszystkich poziomów"},{id:"quiz-wizard",title:"Kreator quizów",description:"Twórz profesjonalne testy sprawdzające z różnymi typami pytań",icon:ri,path:"/admin/quiz-wizard",color:"from-blue-50 to-cyan-50",borderColor:"border-blue-200",iconBg:"bg-blue-100",iconColor:"text-blue-600",buttonBg:"bg-blue-600 hover:bg-blue-700",features:["Różne typy pytań","Automatyczne wyjaśnienia","Konfiguracja parametrów","Inteligentne punktowanie"],estimatedTime:"10-15 min",targetAudience:"Do sprawdzania wiedzy"}],ZT=()=>{const t=pe();return r.jsxs(X,{children:[r.jsx(je,{title:"Narzędzia AI dla nauczycieli",description:"Wykorzystaj sztuczną inteligencję do tworzenia wysokiej jakości materiałów edukacyjnych"}),r.jsx("div",{className:"mb-8 p-6 bg-gradient-to-r from-violet-50 to-purple-50 rounded-lg border border-purple-200",children:r.jsxs("div",{className:"flex items-start gap-4",children:[r.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:r.jsx(Jt,{className:"w-8 h-8 text-purple-600"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Przyspiesz tworzenie materiałów z AI"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"Nasze narzędzia AI pomagają tworzyć spersonalizowane materiały edukacyjne w ułamku czasu potrzebnego na tradycyjne przygotowanie. Każdy kreator prowadzi Cię krok po kroku przez proces tworzenia."}),r.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Ze,{className:"w-4 h-4 text-purple-600"}),r.jsx("span",{children:"Oszczędność czasu do 80%"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(pt,{className:"w-4 h-4 text-purple-600"}),r.jsx("span",{children:"Dostosowane do programu nauczania"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(ge,{className:"w-4 h-4 text-purple-600"}),r.jsx("span",{children:"Personalizacja dla różnych grup"})]})]})]})]})}),r.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:JT.map(e=>{const s=e.icon;return r.jsxs(P,{className:`hover:shadow-lg transition-shadow cursor-pointer border-2 ${e.borderColor}`,onClick:()=>t(e.path),children:[r.jsxs(F,{children:[r.jsxs("div",{className:"flex items-start justify-between mb-4",children:[r.jsx("div",{className:`p-3 rounded-lg ${e.iconBg}`,children:r.jsx(s,{className:`w-6 h-6 ${e.iconColor}`})}),r.jsx(Ue,{className:"w-5 h-5 text-gray-400"})]}),r.jsx(L,{className:"text-lg",children:e.title}),r.jsx(Jd,{children:e.description})]}),r.jsx(I,{children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-xs font-medium text-gray-700 mb-2",children:"Główne funkcje:"}),r.jsx("ul",{className:"space-y-1",children:e.features.slice(0,3).map((n,i)=>r.jsxs("li",{className:"text-xs text-gray-600 flex items-start gap-1",children:[r.jsx("span",{className:"text-green-500 mt-0.5",children:"•"}),r.jsx("span",{children:n})]},i))})]}),r.jsxs("div",{className:"flex justify-between items-center pt-3 border-t",children:[r.jsxs("div",{className:"text-xs text-gray-500",children:[r.jsx(Ze,{className:"w-3 h-3 inline mr-1"}),e.estimatedTime]}),r.jsxs(D,{size:"sm",className:`${e.buttonBg} text-white`,children:[r.jsx(tc,{className:"w-3 h-3 mr-1"}),"Rozpocznij"]})]})]})})]},e.id)})}),r.jsxs("div",{className:"mt-8 p-6 bg-blue-50 rounded-lg border border-blue-200",children:[r.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[r.jsx(dt,{className:"w-5 h-5 text-blue-600"}),"Wskazówki dla najlepszych rezultatów"]}),r.jsxs("div",{className:"grid md:grid-cols-2 gap-4 text-sm text-gray-700",children:[r.jsxs("div",{children:[r.jsx("p",{className:"font-medium mb-1",children:"Przed rozpoczęciem:"}),r.jsxs("ul",{className:"space-y-1 text-gray-600",children:[r.jsx("li",{children:"• Przygotuj podstawowe informacje o kursie"}),r.jsx("li",{children:"• Określ grupę docelową i poziom"}),r.jsx("li",{children:"• Zaplanuj cele edukacyjne"})]})]}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium mb-1",children:"Podczas tworzenia:"}),r.jsxs("ul",{className:"space-y-1 text-gray-600",children:[r.jsx("li",{children:"• Sprawdzaj podglądy na każdym etapie"}),r.jsx("li",{children:"• Dostosuj wygenerowane treści do potrzeb"}),r.jsx("li",{children:"• Zapisuj regularnie postępy"})]})]})]})]})]})},QT=[r.jsx(Z,{path:"ai-tools",element:r.jsx(ZT,{})},"ai-tools")];function YT(){return r.jsxs(X,{children:[r.jsx(je,{title:"Kreator materiałów — panel",description:"Generuj spójny materiał Markdown dla wybranego tematu kursu"}),r.jsxs("div",{className:"relative overflow-hidden rounded-2xl border mb-6",children:[r.jsx("div",{className:"absolute inset-0 bg-blue-50"}),r.jsxs("div",{className:"relative px-6 py-8 flex items-center gap-3",children:[r.jsx("div",{className:"shrink-0 inline-flex h-10 w-10 items-center justify-center rounded-xl bg-black text-white",children:r.jsx(tc,{className:"w-5 h-5"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h1",{className:"text-xl sm:text-2xl font-semibold leading-tight",children:"Kreator materiałów"}),r.jsx("p",{className:"text-sm text-zinc-600",children:"Wygeneruj treść lekcji (Markdown) dla jednego, wskazanego tematu — z opisem, przykładami i podsumowaniem."})]}),r.jsx("div",{className:"hidden md:block",children:r.jsx(D,{asChild:!0,children:r.jsxs(Ke,{to:"/admin/educational-material/step1",className:"inline-flex items-center gap-2",children:["Nowa sesja",r.jsx(He,{className:"w-4 h-4"})]})})})]})]}),r.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center gap-2",children:[r.jsx(Jt,{className:"w-5 h-5"}),"Szybki start"]})}),r.jsxs(I,{className:"space-y-4",children:[r.jsxs("ol",{className:"list-decimal list-inside text-sm text-zinc-700 space-y-1",children:[r.jsx("li",{children:"Wybierz kurs i temat."}),r.jsx("li",{children:"Ustaw parametry (poziom, styl, długość, zgodność z podstawą)."}),r.jsx("li",{children:"Wygeneruj pojedynczy materiał."}),r.jsxs("li",{children:["Zapisz jako aktywność typu ",r.jsx("code",{children:"material"}),"."]}),r.jsx("li",{children:"Opcjonalnie dodaj pytania kontrolne w kroku 4."})]}),r.jsx(D,{asChild:!0,className:"w-full",children:r.jsxs(Ke,{to:"/admin/educational-material/step1",className:"inline-flex items-center gap-2",children:["Przejdź do kroku 1",r.jsx(He,{className:"w-4 h-4"})]})})]})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center gap-2",children:[r.jsx(Se,{className:"w-5 h-5"}),"Jakie treści generujemy?"]})}),r.jsxs(I,{className:"space-y-3 text-sm text-muted-foreground",children:[r.jsx("p",{children:"Struktura: 6 głównych sekcji (Cele → Pojęcia → Omówienie → Przykłady → Błędy → Podsumowanie)"}),r.jsx("p",{children:"Format: czysty Markdown (obsługujesz już w widoku materiału)."}),r.jsxs(we,{children:[r.jsx(Gi,{className:"h-4 w-4"}),r.jsxs(ve,{className:"text-xs",children:["Jeśli kurs jest maturalny i włączysz zgodność z podstawą LO (2025), kreator dopasuje treści do wymagań z pliku ",r.jsx("code",{children:"curriculum.ts"}),". Pytania kontrolne dodajesz opcjonalnie w kroku 4."]})]})]})]}),r.jsxs(P,{className:"lg:col-span-2",children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center gap-2",children:[r.jsx(dt,{className:"w-5 h-5"}),"Dodawanie pytań kontrolnych (opcjonalne - krok 4)"]})}),r.jsx(I,{children:r.jsxs("div",{className:"flex items-start gap-4",children:[r.jsxs("div",{className:"flex-1 space-y-2",children:[r.jsx("p",{className:"text-sm text-muted-foreground",children:"Po wygenerowaniu materiałów możesz przejść do kroku 4, aby dodać pytania kontrolne do każdej sekcji."}),r.jsxs("ul",{className:"text-sm text-zinc-700 space-y-1 list-disc list-inside",children:[r.jsx("li",{children:"Przeglądaj wygenerowane materiały według kursów i tematów"}),r.jsx("li",{children:"Generuj pytania kontrolne dla każdej sekcji materiału"}),r.jsx("li",{children:"Pytania są automatycznie formatowane w YAML i wstawiane do treści"}),r.jsx("li",{children:"Uczniowie muszą odpowiedzieć poprawnie, aby odhaczyć sekcję"})]})]}),r.jsx("div",{className:"flex flex-col gap-2",children:r.jsx(D,{asChild:!0,variant:"outline",children:r.jsxs(Ke,{to:"/admin/educational-material/step4",className:"inline-flex items-center gap-2",children:[r.jsx(dt,{className:"w-4 h-4"}),"Zarządzaj pytaniami"]})})})]})})]})]})]})}function hv({value:t,onChange:e,showAlert:s=!0,label:n,placeholder:i="Wybierz kurs"}){const[a,o]=j.useState(!1),{data:l}=Y({resource:"courses",filters:a?[{field:"is_published",operator:"eq",value:!0}]:[],sorters:[{field:"created_at",order:"desc"}],pagination:{pageSize:100}}),c=l?.data?.find(u=>u.id===t);return r.jsxs("div",{className:"space-y-4",children:[n&&r.jsx("label",{className:"text-xs font-medium block",children:n}),r.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted rounded-lg",children:[r.jsx(mt,{checked:a,onCheckedChange:u=>o(!!u)}),r.jsx("label",{className:"text-sm cursor-pointer",children:"Pokazuj tylko opublikowane kursy"})]}),r.jsxs(Ee,{value:t?String(t):"",onValueChange:u=>e(u?Number(u):null),children:[r.jsx(_e,{children:r.jsx(De,{placeholder:i})}),r.jsx(Ae,{children:(l?.data||[]).length===0?r.jsx("div",{className:"p-3 text-xs text-muted-foreground",children:a?"Brak opublikowanych kursów. Odznacz filtr.":"Brak kursów. Najpierw wygeneruj kurs."}):(l?.data||[]).map(u=>r.jsx(ee,{value:String(u.id),children:r.jsxs("div",{className:"flex items-center gap-2",children:[u.icon_emoji?`${u.icon_emoji} `:"📚 ",r.jsx("span",{children:u.title}),!u.is_published&&r.jsxs(V,{variant:"outline",className:"ml-2 text-xs",children:[r.jsx(ii,{className:"w-3 h-3 mr-1"}),"Szkic"]})]})},u.id))})]}),s&&c&&!c.is_published&&r.jsxs(we,{children:[r.jsx(Gi,{className:"h-4 w-4"}),r.jsx(ve,{className:"text-xs",children:"Wybrany kurs jest szkicem (nieopublikowany). Materiały zostaną utworzone, ale nie będą widoczne dla uczniów dopóki nie opublikujesz kursu."})]})]})}function L0(t,e){const s=String(t);if(typeof e!="string")throw new TypeError("Expected character");let n=0,i=s.indexOf(e);for(;i!==-1;)n++,i=s.indexOf(e,i+e.length);return n}function XT(t){if(typeof t!="string")throw new TypeError("Expected a string");return t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function eE(t,e,s){const i=A1((s||{}).ignore||[]),a=tE(e);let o=-1;for(;++o<a.length;)Y4(t,"text",l);function l(u,d){let h=-1,f;for(;++h<d.length;){const m=d[h],p=f?f.children:void 0;if(i(m,p?p.indexOf(m):void 0,f))return;f=m}if(f)return c(u,d)}function c(u,d){const h=d[d.length-1],f=a[o][0],m=a[o][1];let p=0;const g=h.children.indexOf(u);let y=!1,b=[];f.lastIndex=0;let w=f.exec(u.value);for(;w;){const S=w.index,z={index:w.index,input:w.input,stack:[...d,u]};let N=m(...w,z);if(typeof N=="string"&&(N=N.length>0?{type:"text",value:N}:void 0),N===!1?f.lastIndex=S+1:(p!==S&&b.push({type:"text",value:u.value.slice(p,S)}),Array.isArray(N)?b.push(...N):N&&b.push(N),p=S+w[0].length,y=!0),!f.global)break;w=f.exec(u.value)}return y?(p<u.value.length&&b.push({type:"text",value:u.value.slice(p)}),h.children.splice(g,1,...b)):b=[u],g+b.length}}function tE(t){const e=[];if(!Array.isArray(t))throw new TypeError("Expected find and replace tuple or list of tuples");const s=!t[0]||Array.isArray(t[0])?t:[t];let n=-1;for(;++n<s.length;){const i=s[n];e.push([sE(i[0]),nE(i[1])])}return e}function sE(t){return typeof t=="string"?new RegExp(XT(t),"g"):t}function nE(t){return typeof t=="function"?t:function(){return t}}const ef="phrasing",tf=["autolink","link","image","label"];function rE(){return{transforms:[dE],enter:{literalAutolink:aE,literalAutolinkEmail:sf,literalAutolinkHttp:sf,literalAutolinkWww:sf},exit:{literalAutolink:uE,literalAutolinkEmail:cE,literalAutolinkHttp:oE,literalAutolinkWww:lE}}}function iE(){return{unsafe:[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:ef,notInConstruct:tf},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:ef,notInConstruct:tf},{character:":",before:"[ps]",after:"\\/",inConstruct:ef,notInConstruct:tf}]}}function aE(t){this.enter({type:"link",title:null,url:"",children:[]},t)}function sf(t){this.config.enter.autolinkProtocol.call(this,t)}function oE(t){this.config.exit.autolinkProtocol.call(this,t)}function lE(t){this.config.exit.data.call(this,t);const e=this.stack[this.stack.length-1];co(e.type==="link"),e.url="http://"+this.sliceSerialize(t)}function cE(t){this.config.exit.autolinkEmail.call(this,t)}function uE(t){this.exit(t)}function dE(t){eE(t,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,hE],[/(?<=^|\s|\p{P}|\p{S})([-.\w+]+)@([-\w]+(?:\.[-\w]+)+)/gu,fE]],{ignore:["link","linkReference"]})}function hE(t,e,s,n,i){let a="";if(!fv(i)||(/^w/i.test(e)&&(s=e+s,e="",a="http://"),!mE(s)))return!1;const o=pE(s+n);if(!o[0])return!1;const l={type:"link",title:null,url:a+e+o[0],children:[{type:"text",value:e+o[0]}]};return o[1]?[l,{type:"text",value:o[1]}]:l}function fE(t,e,s,n){return!fv(n,!0)||/[-\d_]$/.test(s)?!1:{type:"link",title:null,url:"mailto:"+e+"@"+s,children:[{type:"text",value:e+"@"+s}]}}function mE(t){const e=t.split(".");return!(e.length<2||e[e.length-1]&&(/_/.test(e[e.length-1])||!/[a-zA-Z\d]/.test(e[e.length-1]))||e[e.length-2]&&(/_/.test(e[e.length-2])||!/[a-zA-Z\d]/.test(e[e.length-2])))}function pE(t){const e=/[!"&'),.:;<>?\]}]+$/.exec(t);if(!e)return[t,void 0];t=t.slice(0,e.index);let s=e[0],n=s.indexOf(")");const i=L0(t,"(");let a=L0(t,")");for(;n!==-1&&i>a;)t+=s.slice(0,n+1),s=s.slice(n+1),n=s.indexOf(")"),a++;return[t,s]}function fv(t,e){const s=t.input.charCodeAt(t.index-1);return(t.index===0||qa(s)||Hp(s))&&(!e||s!==47)}mv.peek=NE;function xE(){this.buffer()}function gE(t){this.enter({type:"footnoteReference",identifier:"",label:""},t)}function yE(){this.buffer()}function bE(t){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},t)}function jE(t){const e=this.resume(),s=this.stack[this.stack.length-1];co(s.type==="footnoteReference"),s.identifier=Xl(this.sliceSerialize(t)).toLowerCase(),s.label=e}function wE(t){this.exit(t)}function vE(t){const e=this.resume(),s=this.stack[this.stack.length-1];co(s.type==="footnoteDefinition"),s.identifier=Xl(this.sliceSerialize(t)).toLowerCase(),s.label=e}function kE(t){this.exit(t)}function NE(){return"["}function mv(t,e,s,n){const i=s.createTracker(n);let a=i.move("[^");const o=s.enter("footnoteReference"),l=s.enter("reference");return a+=i.move(s.safe(s.associationId(t),{after:"]",before:a})),l(),o(),a+=i.move("]"),a}function SE(){return{enter:{gfmFootnoteCallString:xE,gfmFootnoteCall:gE,gfmFootnoteDefinitionLabelString:yE,gfmFootnoteDefinition:bE},exit:{gfmFootnoteCallString:jE,gfmFootnoteCall:wE,gfmFootnoteDefinitionLabelString:vE,gfmFootnoteDefinition:kE}}}function CE(t){let e=!1;return t&&t.firstLineBlank&&(e=!0),{handlers:{footnoteDefinition:s,footnoteReference:mv},unsafe:[{character:"[",inConstruct:["label","phrasing","reference"]}]};function s(n,i,a,o){const l=a.createTracker(o);let c=l.move("[^");const u=a.enter("footnoteDefinition"),d=a.enter("label");return c+=l.move(a.safe(a.associationId(n),{before:c,after:"]"})),d(),c+=l.move("]:"),n.children&&n.children.length>0&&(l.shift(4),c+=l.move((e?`
`:" ")+a.indentLines(a.containerFlow(n,l.current()),e?pv:zE))),u(),c}}function zE(t,e,s){return e===0?t:pv(t,e,s)}function pv(t,e,s){return(s?"":"    ")+t}const _E=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"];xv.peek=ME;function AE(){return{canContainEols:["delete"],enter:{strikethrough:EE},exit:{strikethrough:DE}}}function TE(){return{unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:_E}],handlers:{delete:xv}}}function EE(t){this.enter({type:"delete",children:[]},t)}function DE(t){this.exit(t)}function xv(t,e,s,n){const i=s.createTracker(n),a=s.enter("strikethrough");let o=i.move("~~");return o+=s.containerPhrasing(t,{...i.current(),before:o,after:"~"}),o+=i.move("~~"),a(),o}function ME(){return"~"}function PE(t){return t.length}function IE(t,e){const s=e||{},n=(s.align||[]).concat(),i=s.stringLength||PE,a=[],o=[],l=[],c=[];let u=0,d=-1;for(;++d<t.length;){const x=[],g=[];let y=-1;for(t[d].length>u&&(u=t[d].length);++y<t[d].length;){const b=OE(t[d][y]);if(s.alignDelimiters!==!1){const w=i(b);g[y]=w,(c[y]===void 0||w>c[y])&&(c[y]=w)}x.push(b)}o[d]=x,l[d]=g}let h=-1;if(typeof n=="object"&&"length"in n)for(;++h<u;)a[h]=F0(n[h]);else{const x=F0(n);for(;++h<u;)a[h]=x}h=-1;const f=[],m=[];for(;++h<u;){const x=a[h];let g="",y="";x===99?(g=":",y=":"):x===108?g=":":x===114&&(y=":");let b=s.alignDelimiters===!1?1:Math.max(1,c[h]-g.length-y.length);const w=g+"-".repeat(b)+y;s.alignDelimiters!==!1&&(b=g.length+b+y.length,b>c[h]&&(c[h]=b),m[h]=b),f[h]=w}o.splice(1,0,f),l.splice(1,0,m),d=-1;const p=[];for(;++d<o.length;){const x=o[d],g=l[d];h=-1;const y=[];for(;++h<u;){const b=x[h]||"";let w="",S="";if(s.alignDelimiters!==!1){const z=c[h]-(g[h]||0),N=a[h];N===114?w=" ".repeat(z):N===99?z%2?(w=" ".repeat(z/2+.5),S=" ".repeat(z/2-.5)):(w=" ".repeat(z/2),S=w):S=" ".repeat(z)}s.delimiterStart!==!1&&!h&&y.push("|"),s.padding!==!1&&!(s.alignDelimiters===!1&&b==="")&&(s.delimiterStart!==!1||h)&&y.push(" "),s.alignDelimiters!==!1&&y.push(w),y.push(b),s.alignDelimiters!==!1&&y.push(S),s.padding!==!1&&y.push(" "),(s.delimiterEnd!==!1||h!==u-1)&&y.push("|")}p.push(s.delimiterEnd===!1?y.join("").replace(/ +$/,""):y.join(""))}return p.join(`
`)}function OE(t){return t==null?"":String(t)}function F0(t){const e=typeof t=="string"?t.codePointAt(0):0;return e===67||e===99?99:e===76||e===108?108:e===82||e===114?114:0}function RE(t,e,s,n){const i=s.enter("blockquote"),a=s.createTracker(n);a.move("> "),a.shift(2);const o=s.indentLines(s.containerFlow(t,a.current()),LE);return i(),o}function LE(t,e,s){return">"+(s?"":" ")+t}function FE(t,e){return $0(t,e.inConstruct,!0)&&!$0(t,e.notInConstruct,!1)}function $0(t,e,s){if(typeof e=="string"&&(e=[e]),!e||e.length===0)return s;let n=-1;for(;++n<e.length;)if(t.includes(e[n]))return!0;return!1}function B0(t,e,s,n){let i=-1;for(;++i<s.unsafe.length;)if(s.unsafe[i].character===`
`&&FE(s.stack,s.unsafe[i]))return/[ \t]/.test(n.before)?"":" ";return`\\
`}function $E(t,e){const s=String(t);let n=s.indexOf(e),i=n,a=0,o=0;if(typeof e!="string")throw new TypeError("Expected substring");for(;n!==-1;)n===i?++a>o&&(o=a):a=1,i=n+e.length,n=s.indexOf(e,i);return o}function BE(t,e){return!!(e.options.fences===!1&&t.value&&!t.lang&&/[^ \r\n]/.test(t.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(t.value))}function qE(t){const e=t.options.fence||"`";if(e!=="`"&&e!=="~")throw new Error("Cannot serialize code with `"+e+"` for `options.fence`, expected `` ` `` or `~`");return e}function VE(t,e,s,n){const i=qE(s),a=t.value||"",o=i==="`"?"GraveAccent":"Tilde";if(BE(t,s)){const h=s.enter("codeIndented"),f=s.indentLines(a,UE);return h(),f}const l=s.createTracker(n),c=i.repeat(Math.max($E(a,i)+1,3)),u=s.enter("codeFenced");let d=l.move(c);if(t.lang){const h=s.enter(`codeFencedLang${o}`);d+=l.move(s.safe(t.lang,{before:d,after:" ",encode:["`"],...l.current()})),h()}if(t.lang&&t.meta){const h=s.enter(`codeFencedMeta${o}`);d+=l.move(" "),d+=l.move(s.safe(t.meta,{before:d,after:`
`,encode:["`"],...l.current()})),h()}return d+=l.move(`
`),a&&(d+=l.move(a+`
`)),d+=l.move(c),u(),d}function UE(t,e,s){return(s?"":"    ")+t}function rx(t){const e=t.options.quote||'"';if(e!=='"'&&e!=="'")throw new Error("Cannot serialize title with `"+e+"` for `options.quote`, expected `\"`, or `'`");return e}function WE(t,e,s,n){const i=rx(s),a=i==='"'?"Quote":"Apostrophe",o=s.enter("definition");let l=s.enter("label");const c=s.createTracker(n);let u=c.move("[");return u+=c.move(s.safe(s.associationId(t),{before:u,after:"]",...c.current()})),u+=c.move("]: "),l(),!t.url||/[\0- \u007F]/.test(t.url)?(l=s.enter("destinationLiteral"),u+=c.move("<"),u+=c.move(s.safe(t.url,{before:u,after:">",...c.current()})),u+=c.move(">")):(l=s.enter("destinationRaw"),u+=c.move(s.safe(t.url,{before:u,after:t.title?" ":`
`,...c.current()}))),l(),t.title&&(l=s.enter(`title${a}`),u+=c.move(" "+i),u+=c.move(s.safe(t.title,{before:u,after:i,...c.current()})),u+=c.move(i),l()),o(),u}function KE(t){const e=t.options.emphasis||"*";if(e!=="*"&&e!=="_")throw new Error("Cannot serialize emphasis with `"+e+"` for `options.emphasis`, expected `*`, or `_`");return e}function wl(t){return"&#x"+t.toString(16).toUpperCase()+";"}function zu(t,e,s){const n=bu(t),i=bu(e);return n===void 0?i===void 0?s==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:i===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:n===1?i===void 0?{inside:!1,outside:!1}:i===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:i===void 0?{inside:!1,outside:!1}:i===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}gv.peek=HE;function gv(t,e,s,n){const i=KE(s),a=s.enter("emphasis"),o=s.createTracker(n),l=o.move(i);let c=o.move(s.containerPhrasing(t,{after:i,before:l,...o.current()}));const u=c.charCodeAt(0),d=zu(n.before.charCodeAt(n.before.length-1),u,i);d.inside&&(c=wl(u)+c.slice(1));const h=c.charCodeAt(c.length-1),f=zu(n.after.charCodeAt(0),h,i);f.inside&&(c=c.slice(0,-1)+wl(h));const m=o.move(i);return a(),s.attentionEncodeSurroundingInfo={after:f.outside,before:d.outside},l+c+m}function HE(t,e,s){return s.options.emphasis||"*"}function GE(t,e){let s=!1;return X4(t,function(n){if("value"in n&&/\r?\n|\r/.test(n.value)||n.type==="break")return s=!0,e_}),!!((!t.depth||t.depth<3)&&T1(t)&&(e.options.setext||s))}function JE(t,e,s,n){const i=Math.max(Math.min(6,t.depth||1),1),a=s.createTracker(n);if(GE(t,s)){const d=s.enter("headingSetext"),h=s.enter("phrasing"),f=s.containerPhrasing(t,{...a.current(),before:`
`,after:`
`});return h(),d(),f+`
`+(i===1?"=":"-").repeat(f.length-(Math.max(f.lastIndexOf("\r"),f.lastIndexOf(`
`))+1))}const o="#".repeat(i),l=s.enter("headingAtx"),c=s.enter("phrasing");a.move(o+" ");let u=s.containerPhrasing(t,{before:"# ",after:`
`,...a.current()});return/^[\t ]/.test(u)&&(u=wl(u.charCodeAt(0))+u.slice(1)),u=u?o+" "+u:o,s.options.closeAtx&&(u+=" "+o),c(),l(),u}yv.peek=ZE;function yv(t){return t.value||""}function ZE(){return"<"}bv.peek=QE;function bv(t,e,s,n){const i=rx(s),a=i==='"'?"Quote":"Apostrophe",o=s.enter("image");let l=s.enter("label");const c=s.createTracker(n);let u=c.move("![");return u+=c.move(s.safe(t.alt,{before:u,after:"]",...c.current()})),u+=c.move("]("),l(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(l=s.enter("destinationLiteral"),u+=c.move("<"),u+=c.move(s.safe(t.url,{before:u,after:">",...c.current()})),u+=c.move(">")):(l=s.enter("destinationRaw"),u+=c.move(s.safe(t.url,{before:u,after:t.title?" ":")",...c.current()}))),l(),t.title&&(l=s.enter(`title${a}`),u+=c.move(" "+i),u+=c.move(s.safe(t.title,{before:u,after:i,...c.current()})),u+=c.move(i),l()),u+=c.move(")"),o(),u}function QE(){return"!"}jv.peek=YE;function jv(t,e,s,n){const i=t.referenceType,a=s.enter("imageReference");let o=s.enter("label");const l=s.createTracker(n);let c=l.move("![");const u=s.safe(t.alt,{before:c,after:"]",...l.current()});c+=l.move(u+"]["),o();const d=s.stack;s.stack=[],o=s.enter("reference");const h=s.safe(s.associationId(t),{before:c,after:"]",...l.current()});return o(),s.stack=d,a(),i==="full"||!u||u!==h?c+=l.move(h+"]"):i==="shortcut"?c=c.slice(0,-1):c+=l.move("]"),c}function YE(){return"!"}wv.peek=XE;function wv(t,e,s){let n=t.value||"",i="`",a=-1;for(;new RegExp("(^|[^`])"+i+"([^`]|$)").test(n);)i+="`";for(/[^ \r\n]/.test(n)&&(/^[ \r\n]/.test(n)&&/[ \r\n]$/.test(n)||/^`|`$/.test(n))&&(n=" "+n+" ");++a<s.unsafe.length;){const o=s.unsafe[a],l=s.compilePattern(o);let c;if(o.atBreak)for(;c=l.exec(n);){let u=c.index;n.charCodeAt(u)===10&&n.charCodeAt(u-1)===13&&u--,n=n.slice(0,u)+" "+n.slice(c.index+1)}}return i+n+i}function XE(){return"`"}function vv(t,e){const s=T1(t);return!!(!e.options.resourceLink&&t.url&&!t.title&&t.children&&t.children.length===1&&t.children[0].type==="text"&&(s===t.url||"mailto:"+s===t.url)&&/^[a-z][a-z+.-]+:/i.test(t.url)&&!/[\0- <>\u007F]/.test(t.url))}kv.peek=e6;function kv(t,e,s,n){const i=rx(s),a=i==='"'?"Quote":"Apostrophe",o=s.createTracker(n);let l,c;if(vv(t,s)){const d=s.stack;s.stack=[],l=s.enter("autolink");let h=o.move("<");return h+=o.move(s.containerPhrasing(t,{before:h,after:">",...o.current()})),h+=o.move(">"),l(),s.stack=d,h}l=s.enter("link"),c=s.enter("label");let u=o.move("[");return u+=o.move(s.containerPhrasing(t,{before:u,after:"](",...o.current()})),u+=o.move("]("),c(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(c=s.enter("destinationLiteral"),u+=o.move("<"),u+=o.move(s.safe(t.url,{before:u,after:">",...o.current()})),u+=o.move(">")):(c=s.enter("destinationRaw"),u+=o.move(s.safe(t.url,{before:u,after:t.title?" ":")",...o.current()}))),c(),t.title&&(c=s.enter(`title${a}`),u+=o.move(" "+i),u+=o.move(s.safe(t.title,{before:u,after:i,...o.current()})),u+=o.move(i),c()),u+=o.move(")"),l(),u}function e6(t,e,s){return vv(t,s)?"<":"["}Nv.peek=t6;function Nv(t,e,s,n){const i=t.referenceType,a=s.enter("linkReference");let o=s.enter("label");const l=s.createTracker(n);let c=l.move("[");const u=s.containerPhrasing(t,{before:c,after:"]",...l.current()});c+=l.move(u+"]["),o();const d=s.stack;s.stack=[],o=s.enter("reference");const h=s.safe(s.associationId(t),{before:c,after:"]",...l.current()});return o(),s.stack=d,a(),i==="full"||!u||u!==h?c+=l.move(h+"]"):i==="shortcut"?c=c.slice(0,-1):c+=l.move("]"),c}function t6(){return"["}function ix(t){const e=t.options.bullet||"*";if(e!=="*"&&e!=="+"&&e!=="-")throw new Error("Cannot serialize items with `"+e+"` for `options.bullet`, expected `*`, `+`, or `-`");return e}function s6(t){const e=ix(t),s=t.options.bulletOther;if(!s)return e==="*"?"-":"*";if(s!=="*"&&s!=="+"&&s!=="-")throw new Error("Cannot serialize items with `"+s+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(s===e)throw new Error("Expected `bullet` (`"+e+"`) and `bulletOther` (`"+s+"`) to be different");return s}function n6(t){const e=t.options.bulletOrdered||".";if(e!=="."&&e!==")")throw new Error("Cannot serialize items with `"+e+"` for `options.bulletOrdered`, expected `.` or `)`");return e}function Sv(t){const e=t.options.rule||"*";if(e!=="*"&&e!=="-"&&e!=="_")throw new Error("Cannot serialize rules with `"+e+"` for `options.rule`, expected `*`, `-`, or `_`");return e}function r6(t,e,s,n){const i=s.enter("list"),a=s.bulletCurrent;let o=t.ordered?n6(s):ix(s);const l=t.ordered?o==="."?")":".":s6(s);let c=e&&s.bulletLastUsed?o===s.bulletLastUsed:!1;if(!t.ordered){const d=t.children?t.children[0]:void 0;if((o==="*"||o==="-")&&d&&(!d.children||!d.children[0])&&s.stack[s.stack.length-1]==="list"&&s.stack[s.stack.length-2]==="listItem"&&s.stack[s.stack.length-3]==="list"&&s.stack[s.stack.length-4]==="listItem"&&s.indexStack[s.indexStack.length-1]===0&&s.indexStack[s.indexStack.length-2]===0&&s.indexStack[s.indexStack.length-3]===0&&(c=!0),Sv(s)===o&&d){let h=-1;for(;++h<t.children.length;){const f=t.children[h];if(f&&f.type==="listItem"&&f.children&&f.children[0]&&f.children[0].type==="thematicBreak"){c=!0;break}}}}c&&(o=l),s.bulletCurrent=o;const u=s.containerFlow(t,n);return s.bulletLastUsed=o,s.bulletCurrent=a,i(),u}function i6(t){const e=t.options.listItemIndent||"one";if(e!=="tab"&&e!=="one"&&e!=="mixed")throw new Error("Cannot serialize items with `"+e+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return e}function a6(t,e,s,n){const i=i6(s);let a=s.bulletCurrent||ix(s);e&&e.type==="list"&&e.ordered&&(a=(typeof e.start=="number"&&e.start>-1?e.start:1)+(s.options.incrementListMarker===!1?0:e.children.indexOf(t))+a);let o=a.length+1;(i==="tab"||i==="mixed"&&(e&&e.type==="list"&&e.spread||t.spread))&&(o=Math.ceil(o/4)*4);const l=s.createTracker(n);l.move(a+" ".repeat(o-a.length)),l.shift(o);const c=s.enter("listItem"),u=s.indentLines(s.containerFlow(t,l.current()),d);return c(),u;function d(h,f,m){return f?(m?"":" ".repeat(o))+h:(m?a:a+" ".repeat(o-a.length))+h}}function o6(t,e,s,n){const i=s.enter("paragraph"),a=s.enter("phrasing"),o=s.containerPhrasing(t,n);return a(),i(),o}const l6=A1(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function c6(t,e,s,n){return(t.children.some(function(o){return l6(o)})?s.containerPhrasing:s.containerFlow).call(s,t,n)}function u6(t){const e=t.options.strong||"*";if(e!=="*"&&e!=="_")throw new Error("Cannot serialize strong with `"+e+"` for `options.strong`, expected `*`, or `_`");return e}Cv.peek=d6;function Cv(t,e,s,n){const i=u6(s),a=s.enter("strong"),o=s.createTracker(n),l=o.move(i+i);let c=o.move(s.containerPhrasing(t,{after:i,before:l,...o.current()}));const u=c.charCodeAt(0),d=zu(n.before.charCodeAt(n.before.length-1),u,i);d.inside&&(c=wl(u)+c.slice(1));const h=c.charCodeAt(c.length-1),f=zu(n.after.charCodeAt(0),h,i);f.inside&&(c=c.slice(0,-1)+wl(h));const m=o.move(i+i);return a(),s.attentionEncodeSurroundingInfo={after:f.outside,before:d.outside},l+c+m}function d6(t,e,s){return s.options.strong||"*"}function h6(t,e,s,n){return s.safe(t.value,n)}function f6(t){const e=t.options.ruleRepetition||3;if(e<3)throw new Error("Cannot serialize rules with repetition `"+e+"` for `options.ruleRepetition`, expected `3` or more");return e}function m6(t,e,s){const n=(Sv(s)+(s.options.ruleSpaces?" ":"")).repeat(f6(s));return s.options.ruleSpaces?n.slice(0,-1):n}const zv={blockquote:RE,break:B0,code:VE,definition:WE,emphasis:gv,hardBreak:B0,heading:JE,html:yv,image:bv,imageReference:jv,inlineCode:wv,link:kv,linkReference:Nv,list:r6,listItem:a6,paragraph:o6,root:c6,strong:Cv,text:h6,thematicBreak:m6};function p6(){return{enter:{table:x6,tableData:q0,tableHeader:q0,tableRow:y6},exit:{codeText:b6,table:g6,tableData:nf,tableHeader:nf,tableRow:nf}}}function x6(t){const e=t._align;this.enter({type:"table",align:e.map(function(s){return s==="none"?null:s}),children:[]},t),this.data.inTable=!0}function g6(t){this.exit(t),this.data.inTable=void 0}function y6(t){this.enter({type:"tableRow",children:[]},t)}function nf(t){this.exit(t)}function q0(t){this.enter({type:"tableCell",children:[]},t)}function b6(t){let e=this.resume();this.data.inTable&&(e=e.replace(/\\([\\|])/g,j6));const s=this.stack[this.stack.length-1];co(s.type==="inlineCode"),s.value=e,this.exit(t)}function j6(t,e){return e==="|"?e:t}function w6(t){const e=t||{},s=e.tableCellPadding,n=e.tablePipeAlign,i=e.stringLength,a=s?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:`
`,inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[	 :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{inlineCode:f,table:o,tableCell:c,tableRow:l}};function o(m,p,x,g){return u(d(m,x,g),m.align)}function l(m,p,x,g){const y=h(m,x,g),b=u([y]);return b.slice(0,b.indexOf(`
`))}function c(m,p,x,g){const y=x.enter("tableCell"),b=x.enter("phrasing"),w=x.containerPhrasing(m,{...g,before:a,after:a});return b(),y(),w}function u(m,p){return IE(m,{align:p,alignDelimiters:n,padding:s,stringLength:i})}function d(m,p,x){const g=m.children;let y=-1;const b=[],w=p.enter("table");for(;++y<g.length;)b[y]=h(g[y],p,x);return w(),b}function h(m,p,x){const g=m.children;let y=-1;const b=[],w=p.enter("tableRow");for(;++y<g.length;)b[y]=c(g[y],m,p,x);return w(),b}function f(m,p,x){let g=zv.inlineCode(m,p,x);return x.stack.includes("tableCell")&&(g=g.replace(/\|/g,"\\$&")),g}}function v6(){return{exit:{taskListCheckValueChecked:V0,taskListCheckValueUnchecked:V0,paragraph:N6}}}function k6(){return{unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:S6}}}function V0(t){const e=this.stack[this.stack.length-2];co(e.type==="listItem"),e.checked=t.type==="taskListCheckValueChecked"}function N6(t){const e=this.stack[this.stack.length-2];if(e&&e.type==="listItem"&&typeof e.checked=="boolean"){const s=this.stack[this.stack.length-1];co(s.type==="paragraph");const n=s.children[0];if(n&&n.type==="text"){const i=e.children;let a=-1,o;for(;++a<i.length;){const l=i[a];if(l.type==="paragraph"){o=l;break}}o===s&&(n.value=n.value.slice(1),n.value.length===0?s.children.shift():s.position&&n.position&&typeof n.position.start.offset=="number"&&(n.position.start.column++,n.position.start.offset++,s.position.start=Object.assign({},n.position.start)))}}this.exit(t)}function S6(t,e,s,n){const i=t.children[0],a=typeof t.checked=="boolean"&&i&&i.type==="paragraph",o="["+(t.checked?"x":" ")+"] ",l=s.createTracker(n);a&&l.move(o);let c=zv.listItem(t,e,s,{...n,...l.current()});return a&&(c=c.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,u)),c;function u(d){return d+o}}function C6(){return[rE(),SE(),AE(),p6(),v6()]}function z6(t){return{extensions:[iE(),CE(t),TE(),w6(t),k6()]}}const _6={tokenize:P6,partial:!0},_v={tokenize:I6,partial:!0},Av={tokenize:O6,partial:!0},Tv={tokenize:R6,partial:!0},A6={tokenize:L6,partial:!0},Ev={name:"wwwAutolink",tokenize:D6,previous:Mv},Dv={name:"protocolAutolink",tokenize:M6,previous:Pv},xr={name:"emailAutolink",tokenize:E6,previous:Iv},qn={};function T6(){return{text:qn}}let hi=48;for(;hi<123;)qn[hi]=xr,hi++,hi===58?hi=65:hi===91&&(hi=97);qn[43]=xr;qn[45]=xr;qn[46]=xr;qn[95]=xr;qn[72]=[xr,Dv];qn[104]=[xr,Dv];qn[87]=[xr,Ev];qn[119]=[xr,Ev];function E6(t,e,s){const n=this;let i,a;return o;function o(h){return!km(h)||!Iv.call(n,n.previous)||ax(n.events)?s(h):(t.enter("literalAutolink"),t.enter("literalAutolinkEmail"),l(h))}function l(h){return km(h)?(t.consume(h),l):h===64?(t.consume(h),c):s(h)}function c(h){return h===46?t.check(A6,d,u)(h):h===45||h===95||Gp(h)?(a=!0,t.consume(h),c):d(h)}function u(h){return t.consume(h),i=!0,c}function d(h){return a&&i&&xl(n.previous)?(t.exit("literalAutolinkEmail"),t.exit("literalAutolink"),e(h)):s(h)}}function D6(t,e,s){const n=this;return i;function i(o){return o!==87&&o!==119||!Mv.call(n,n.previous)||ax(n.events)?s(o):(t.enter("literalAutolink"),t.enter("literalAutolinkWww"),t.check(_6,t.attempt(_v,t.attempt(Av,a),s),s)(o))}function a(o){return t.exit("literalAutolinkWww"),t.exit("literalAutolink"),e(o)}}function M6(t,e,s){const n=this;let i="",a=!1;return o;function o(h){return(h===72||h===104)&&Pv.call(n,n.previous)&&!ax(n.events)?(t.enter("literalAutolink"),t.enter("literalAutolinkHttp"),i+=String.fromCodePoint(h),t.consume(h),l):s(h)}function l(h){if(xl(h)&&i.length<5)return i+=String.fromCodePoint(h),t.consume(h),l;if(h===58){const f=i.toLowerCase();if(f==="http"||f==="https")return t.consume(h),c}return s(h)}function c(h){return h===47?(t.consume(h),a?u:(a=!0,c)):s(h)}function u(h){return h===null||t_(h)||Is(h)||qa(h)||Hp(h)?s(h):t.attempt(_v,t.attempt(Av,d),s)(h)}function d(h){return t.exit("literalAutolinkHttp"),t.exit("literalAutolink"),e(h)}}function P6(t,e,s){let n=0;return i;function i(o){return(o===87||o===119)&&n<3?(n++,t.consume(o),i):o===46&&n===3?(t.consume(o),a):s(o)}function a(o){return o===null?s(o):e(o)}}function I6(t,e,s){let n,i,a;return o;function o(u){return u===46||u===95?t.check(Tv,c,l)(u):u===null||Is(u)||qa(u)||u!==45&&Hp(u)?c(u):(a=!0,t.consume(u),o)}function l(u){return u===95?n=!0:(i=n,n=void 0),t.consume(u),o}function c(u){return i||n||!a?s(u):e(u)}}function O6(t,e){let s=0,n=0;return i;function i(o){return o===40?(s++,t.consume(o),i):o===41&&n<s?a(o):o===33||o===34||o===38||o===39||o===41||o===42||o===44||o===46||o===58||o===59||o===60||o===63||o===93||o===95||o===126?t.check(Tv,e,a)(o):o===null||Is(o)||qa(o)?e(o):(t.consume(o),i)}function a(o){return o===41&&n++,t.consume(o),i}}function R6(t,e,s){return n;function n(l){return l===33||l===34||l===39||l===41||l===42||l===44||l===46||l===58||l===59||l===63||l===95||l===126?(t.consume(l),n):l===38?(t.consume(l),a):l===93?(t.consume(l),i):l===60||l===null||Is(l)||qa(l)?e(l):s(l)}function i(l){return l===null||l===40||l===91||Is(l)||qa(l)?e(l):n(l)}function a(l){return xl(l)?o(l):s(l)}function o(l){return l===59?(t.consume(l),n):xl(l)?(t.consume(l),o):s(l)}}function L6(t,e,s){return n;function n(a){return t.consume(a),i}function i(a){return Gp(a)?s(a):e(a)}}function Mv(t){return t===null||t===40||t===42||t===95||t===91||t===93||t===126||Is(t)}function Pv(t){return!xl(t)}function Iv(t){return!(t===47||km(t))}function km(t){return t===43||t===45||t===46||t===95||Gp(t)}function ax(t){let e=t.length,s=!1;for(;e--;){const n=t[e][1];if((n.type==="labelLink"||n.type==="labelImage")&&!n._balanced){s=!0;break}if(n._gfmAutolinkLiteralWalkedInto){s=!1;break}}return t.length>0&&!s&&(t[t.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),s}const F6={tokenize:H6,partial:!0};function $6(){return{document:{91:{name:"gfmFootnoteDefinition",tokenize:U6,continuation:{tokenize:W6},exit:K6}},text:{91:{name:"gfmFootnoteCall",tokenize:V6},93:{name:"gfmPotentialFootnoteCall",add:"after",tokenize:B6,resolveTo:q6}}}}function B6(t,e,s){const n=this;let i=n.events.length;const a=n.parser.gfmFootnotes||(n.parser.gfmFootnotes=[]);let o;for(;i--;){const c=n.events[i][1];if(c.type==="labelImage"){o=c;break}if(c.type==="gfmFootnoteCall"||c.type==="labelLink"||c.type==="label"||c.type==="image"||c.type==="link")break}return l;function l(c){if(!o||!o._balanced)return s(c);const u=Xl(n.sliceSerialize({start:o.end,end:n.now()}));return u.codePointAt(0)!==94||!a.includes(u.slice(1))?s(c):(t.enter("gfmFootnoteCallLabelMarker"),t.consume(c),t.exit("gfmFootnoteCallLabelMarker"),e(c))}}function q6(t,e){let s=t.length;for(;s--;)if(t[s][1].type==="labelImage"&&t[s][0]==="enter"){t[s][1];break}t[s+1][1].type="data",t[s+3][1].type="gfmFootnoteCallLabelMarker";const n={type:"gfmFootnoteCall",start:Object.assign({},t[s+3][1].start),end:Object.assign({},t[t.length-1][1].end)},i={type:"gfmFootnoteCallMarker",start:Object.assign({},t[s+3][1].end),end:Object.assign({},t[s+3][1].end)};i.end.column++,i.end.offset++,i.end._bufferIndex++;const a={type:"gfmFootnoteCallString",start:Object.assign({},i.end),end:Object.assign({},t[t.length-1][1].start)},o={type:"chunkString",contentType:"string",start:Object.assign({},a.start),end:Object.assign({},a.end)},l=[t[s+1],t[s+2],["enter",n,e],t[s+3],t[s+4],["enter",i,e],["exit",i,e],["enter",a,e],["enter",o,e],["exit",o,e],["exit",a,e],t[t.length-2],t[t.length-1],["exit",n,e]];return t.splice(s,t.length-s+1,...l),t}function V6(t,e,s){const n=this,i=n.parser.gfmFootnotes||(n.parser.gfmFootnotes=[]);let a=0,o;return l;function l(h){return t.enter("gfmFootnoteCall"),t.enter("gfmFootnoteCallLabelMarker"),t.consume(h),t.exit("gfmFootnoteCallLabelMarker"),c}function c(h){return h!==94?s(h):(t.enter("gfmFootnoteCallMarker"),t.consume(h),t.exit("gfmFootnoteCallMarker"),t.enter("gfmFootnoteCallString"),t.enter("chunkString").contentType="string",u)}function u(h){if(a>999||h===93&&!o||h===null||h===91||Is(h))return s(h);if(h===93){t.exit("chunkString");const f=t.exit("gfmFootnoteCallString");return i.includes(Xl(n.sliceSerialize(f)))?(t.enter("gfmFootnoteCallLabelMarker"),t.consume(h),t.exit("gfmFootnoteCallLabelMarker"),t.exit("gfmFootnoteCall"),e):s(h)}return Is(h)||(o=!0),a++,t.consume(h),h===92?d:u}function d(h){return h===91||h===92||h===93?(t.consume(h),a++,u):u(h)}}function U6(t,e,s){const n=this,i=n.parser.gfmFootnotes||(n.parser.gfmFootnotes=[]);let a,o=0,l;return c;function c(p){return t.enter("gfmFootnoteDefinition")._container=!0,t.enter("gfmFootnoteDefinitionLabel"),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(p),t.exit("gfmFootnoteDefinitionLabelMarker"),u}function u(p){return p===94?(t.enter("gfmFootnoteDefinitionMarker"),t.consume(p),t.exit("gfmFootnoteDefinitionMarker"),t.enter("gfmFootnoteDefinitionLabelString"),t.enter("chunkString").contentType="string",d):s(p)}function d(p){if(o>999||p===93&&!l||p===null||p===91||Is(p))return s(p);if(p===93){t.exit("chunkString");const x=t.exit("gfmFootnoteDefinitionLabelString");return a=Xl(n.sliceSerialize(x)),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(p),t.exit("gfmFootnoteDefinitionLabelMarker"),t.exit("gfmFootnoteDefinitionLabel"),f}return Is(p)||(l=!0),o++,t.consume(p),p===92?h:d}function h(p){return p===91||p===92||p===93?(t.consume(p),o++,d):d(p)}function f(p){return p===58?(t.enter("definitionMarker"),t.consume(p),t.exit("definitionMarker"),i.includes(a)||i.push(a),Dr(t,m,"gfmFootnoteDefinitionWhitespace")):s(p)}function m(p){return e(p)}}function W6(t,e,s){return t.check(s_,e,t.attempt(F6,e,s))}function K6(t){t.exit("gfmFootnoteDefinition")}function H6(t,e,s){const n=this;return Dr(t,i,"gfmFootnoteDefinitionIndent",5);function i(a){const o=n.events[n.events.length-1];return o&&o[1].type==="gfmFootnoteDefinitionIndent"&&o[2].sliceSerialize(o[1],!0).length===4?e(a):s(a)}}function G6(t){let s=(t||{}).singleTilde;const n={name:"strikethrough",tokenize:a,resolveAll:i};return s==null&&(s=!0),{text:{126:n},insideSpan:{null:[n]},attentionMarkers:{null:[126]}};function i(o,l){let c=-1;for(;++c<o.length;)if(o[c][0]==="enter"&&o[c][1].type==="strikethroughSequenceTemporary"&&o[c][1]._close){let u=c;for(;u--;)if(o[u][0]==="exit"&&o[u][1].type==="strikethroughSequenceTemporary"&&o[u][1]._open&&o[c][1].end.offset-o[c][1].start.offset===o[u][1].end.offset-o[u][1].start.offset){o[c][1].type="strikethroughSequence",o[u][1].type="strikethroughSequence";const d={type:"strikethrough",start:Object.assign({},o[u][1].start),end:Object.assign({},o[c][1].end)},h={type:"strikethroughText",start:Object.assign({},o[u][1].end),end:Object.assign({},o[c][1].start)},f=[["enter",d,l],["enter",o[u][1],l],["exit",o[u][1],l],["enter",h,l]],m=l.parser.constructs.insideSpan.null;m&&Zh(f,f.length,0,n_(m,o.slice(u+1,c),l)),Zh(f,f.length,0,[["exit",h,l],["enter",o[c][1],l],["exit",o[c][1],l],["exit",d,l]]),Zh(o,u-1,c-u+3,f),c=u+f.length-2;break}}for(c=-1;++c<o.length;)o[c][1].type==="strikethroughSequenceTemporary"&&(o[c][1].type="data");return o}function a(o,l,c){const u=this.previous,d=this.events;let h=0;return f;function f(p){return u===126&&d[d.length-1][1].type!=="characterEscape"?c(p):(o.enter("strikethroughSequenceTemporary"),m(p))}function m(p){const x=bu(u);if(p===126)return h>1?c(p):(o.consume(p),h++,m);if(h<2&&!s)return c(p);const g=o.exit("strikethroughSequenceTemporary"),y=bu(p);return g._open=!y||y===2&&!!x,g._close=!x||x===2&&!!y,l(p)}}}class J6{constructor(){this.map=[]}add(e,s,n){Z6(this,e,s,n)}consume(e){if(this.map.sort(function(a,o){return a[0]-o[0]}),this.map.length===0)return;let s=this.map.length;const n=[];for(;s>0;)s-=1,n.push(e.slice(this.map[s][0]+this.map[s][1]),this.map[s][2]),e.length=this.map[s][0];n.push(e.slice()),e.length=0;let i=n.pop();for(;i;){for(const a of i)e.push(a);i=n.pop()}this.map.length=0}}function Z6(t,e,s,n){let i=0;if(!(s===0&&n.length===0)){for(;i<t.map.length;){if(t.map[i][0]===e){t.map[i][1]+=s,t.map[i][2].push(...n);return}i+=1}t.map.push([e,s,n])}}function Q6(t,e){let s=!1;const n=[];for(;e<t.length;){const i=t[e];if(s){if(i[0]==="enter")i[1].type==="tableContent"&&n.push(t[e+1][1].type==="tableDelimiterMarker"?"left":"none");else if(i[1].type==="tableContent"){if(t[e-1][1].type==="tableDelimiterMarker"){const a=n.length-1;n[a]=n[a]==="left"?"center":"right"}}else if(i[1].type==="tableDelimiterRow")break}else i[0]==="enter"&&i[1].type==="tableDelimiterRow"&&(s=!0);e+=1}return n}function Y6(){return{flow:{null:{name:"table",tokenize:X6,resolveAll:eD}}}}function X6(t,e,s){const n=this;let i=0,a=0,o;return l;function l(v){let _=n.events.length-1;for(;_>-1;){const M=n.events[_][1].type;if(M==="lineEnding"||M==="linePrefix")_--;else break}const A=_>-1?n.events[_][1].type:null,E=A==="tableHead"||A==="tableRow"?N:c;return E===N&&n.parser.lazy[n.now().line]?s(v):E(v)}function c(v){return t.enter("tableHead"),t.enter("tableRow"),u(v)}function u(v){return v===124||(o=!0,a+=1),d(v)}function d(v){return v===null?s(v):Bo(v)?a>1?(a=0,n.interrupt=!0,t.exit("tableRow"),t.enter("lineEnding"),t.consume(v),t.exit("lineEnding"),m):s(v):fa(v)?Dr(t,d,"whitespace")(v):(a+=1,o&&(o=!1,i+=1),v===124?(t.enter("tableCellDivider"),t.consume(v),t.exit("tableCellDivider"),o=!0,d):(t.enter("data"),h(v)))}function h(v){return v===null||v===124||Is(v)?(t.exit("data"),d(v)):(t.consume(v),v===92?f:h)}function f(v){return v===92||v===124?(t.consume(v),h):h(v)}function m(v){return n.interrupt=!1,n.parser.lazy[n.now().line]?s(v):(t.enter("tableDelimiterRow"),o=!1,fa(v)?Dr(t,p,"linePrefix",n.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(v):p(v))}function p(v){return v===45||v===58?g(v):v===124?(o=!0,t.enter("tableCellDivider"),t.consume(v),t.exit("tableCellDivider"),x):z(v)}function x(v){return fa(v)?Dr(t,g,"whitespace")(v):g(v)}function g(v){return v===58?(a+=1,o=!0,t.enter("tableDelimiterMarker"),t.consume(v),t.exit("tableDelimiterMarker"),y):v===45?(a+=1,y(v)):v===null||Bo(v)?S(v):z(v)}function y(v){return v===45?(t.enter("tableDelimiterFiller"),b(v)):z(v)}function b(v){return v===45?(t.consume(v),b):v===58?(o=!0,t.exit("tableDelimiterFiller"),t.enter("tableDelimiterMarker"),t.consume(v),t.exit("tableDelimiterMarker"),w):(t.exit("tableDelimiterFiller"),w(v))}function w(v){return fa(v)?Dr(t,S,"whitespace")(v):S(v)}function S(v){return v===124?p(v):v===null||Bo(v)?!o||i!==a?z(v):(t.exit("tableDelimiterRow"),t.exit("tableHead"),e(v)):z(v)}function z(v){return s(v)}function N(v){return t.enter("tableRow"),k(v)}function k(v){return v===124?(t.enter("tableCellDivider"),t.consume(v),t.exit("tableCellDivider"),k):v===null||Bo(v)?(t.exit("tableRow"),e(v)):fa(v)?Dr(t,k,"whitespace")(v):(t.enter("data"),C(v))}function C(v){return v===null||v===124||Is(v)?(t.exit("data"),k(v)):(t.consume(v),v===92?T:C)}function T(v){return v===92||v===124?(t.consume(v),C):C(v)}}function eD(t,e){let s=-1,n=!0,i=0,a=[0,0,0,0],o=[0,0,0,0],l=!1,c=0,u,d,h;const f=new J6;for(;++s<t.length;){const m=t[s],p=m[1];m[0]==="enter"?p.type==="tableHead"?(l=!1,c!==0&&(U0(f,e,c,u,d),d=void 0,c=0),u={type:"table",start:Object.assign({},p.start),end:Object.assign({},p.end)},f.add(s,0,[["enter",u,e]])):p.type==="tableRow"||p.type==="tableDelimiterRow"?(n=!0,h=void 0,a=[0,0,0,0],o=[0,s+1,0,0],l&&(l=!1,d={type:"tableBody",start:Object.assign({},p.start),end:Object.assign({},p.end)},f.add(s,0,[["enter",d,e]])),i=p.type==="tableDelimiterRow"?2:d?3:1):i&&(p.type==="data"||p.type==="tableDelimiterMarker"||p.type==="tableDelimiterFiller")?(n=!1,o[2]===0&&(a[1]!==0&&(o[0]=o[1],h=zc(f,e,a,i,void 0,h),a=[0,0,0,0]),o[2]=s)):p.type==="tableCellDivider"&&(n?n=!1:(a[1]!==0&&(o[0]=o[1],h=zc(f,e,a,i,void 0,h)),a=o,o=[a[1],s,0,0])):p.type==="tableHead"?(l=!0,c=s):p.type==="tableRow"||p.type==="tableDelimiterRow"?(c=s,a[1]!==0?(o[0]=o[1],h=zc(f,e,a,i,s,h)):o[1]!==0&&(h=zc(f,e,o,i,s,h)),i=0):i&&(p.type==="data"||p.type==="tableDelimiterMarker"||p.type==="tableDelimiterFiller")&&(o[3]=s)}for(c!==0&&U0(f,e,c,u,d),f.consume(e.events),s=-1;++s<e.events.length;){const m=e.events[s];m[0]==="enter"&&m[1].type==="table"&&(m[1]._align=Q6(e.events,s))}return t}function zc(t,e,s,n,i,a){const o=n===1?"tableHeader":n===2?"tableDelimiter":"tableData",l="tableContent";s[0]!==0&&(a.end=Object.assign({},ma(e.events,s[0])),t.add(s[0],0,[["exit",a,e]]));const c=ma(e.events,s[1]);if(a={type:o,start:Object.assign({},c),end:Object.assign({},c)},t.add(s[1],0,[["enter",a,e]]),s[2]!==0){const u=ma(e.events,s[2]),d=ma(e.events,s[3]),h={type:l,start:Object.assign({},u),end:Object.assign({},d)};if(t.add(s[2],0,[["enter",h,e]]),n!==2){const f=e.events[s[2]],m=e.events[s[3]];if(f[1].end=Object.assign({},m[1].end),f[1].type="chunkText",f[1].contentType="text",s[3]>s[2]+1){const p=s[2]+1,x=s[3]-s[2]-1;t.add(p,x,[])}}t.add(s[3]+1,0,[["exit",h,e]])}return i!==void 0&&(a.end=Object.assign({},ma(e.events,i)),t.add(i,0,[["exit",a,e]]),a=void 0),a}function U0(t,e,s,n,i){const a=[],o=ma(e.events,s);i&&(i.end=Object.assign({},o),a.push(["exit",i,e])),n.end=Object.assign({},o),a.push(["exit",n,e]),t.add(s+1,0,a)}function ma(t,e){const s=t[e],n=s[0]==="enter"?"start":"end";return s[1][n]}const tD={name:"tasklistCheck",tokenize:nD};function sD(){return{text:{91:tD}}}function nD(t,e,s){const n=this;return i;function i(c){return n.previous!==null||!n._gfmTasklistFirstContentOfListItem?s(c):(t.enter("taskListCheck"),t.enter("taskListCheckMarker"),t.consume(c),t.exit("taskListCheckMarker"),a)}function a(c){return Is(c)?(t.enter("taskListCheckValueUnchecked"),t.consume(c),t.exit("taskListCheckValueUnchecked"),o):c===88||c===120?(t.enter("taskListCheckValueChecked"),t.consume(c),t.exit("taskListCheckValueChecked"),o):s(c)}function o(c){return c===93?(t.enter("taskListCheckMarker"),t.consume(c),t.exit("taskListCheckMarker"),t.exit("taskListCheck"),l):s(c)}function l(c){return Bo(c)?e(c):fa(c)?t.check({tokenize:rD},e,s)(c):s(c)}}function rD(t,e,s){return Dr(t,n,"whitespace");function n(i){return i===null?s(i):e(i)}}function iD(t){return r_([T6(),$6(),G6(t),Y6(),sD()])}const aD={};function Ga(t){const e=this,s=t||aD,n=e.data(),i=n.micromarkExtensions||(n.micromarkExtensions=[]),a=n.fromMarkdownExtensions||(n.fromMarkdownExtensions=[]),o=n.toMarkdownExtensions||(n.toMarkdownExtensions=[]);i.push(iD(s)),a.push(C6()),o.push(z6(s))}const Xd=({content:t,metadata:e,showMetadata:s=!0,height:n="500px"})=>r.jsxs("div",{className:"space-y-4",children:[s&&e&&r.jsxs("div",{className:"grid grid-cols-3 gap-4 p-4 bg-muted rounded-lg",children:[e.duration_min&&r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[r.jsx(Ze,{className:"w-4 h-4"}),"Czas trwania"]}),r.jsxs("p",{className:"font-medium",children:[e.duration_min," minut"]})]}),e.position!==void 0&&r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[r.jsx(O1,{className:"w-4 h-4"}),"Pozycja"]}),r.jsx("p",{className:"font-medium",children:e.position})]}),e.created_at&&r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[r.jsx(js,{className:"w-4 h-4"}),"Utworzono"]}),r.jsx("p",{className:"font-medium",children:new Date(e.created_at).toLocaleDateString("pl-PL")})]}),e.updated_at&&r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[r.jsx(js,{className:"w-4 h-4"}),"Ostatnia aktualizacja"]}),r.jsx("p",{className:"font-medium",children:new Date(e.updated_at).toLocaleDateString("pl-PL")})]})]}),r.jsx(bt,{className:"rounded-lg border p-4",style:{height:n},children:r.jsx("div",{className:"prose prose-sm max-w-none dark:prose-invert",children:r.jsx(Va,{remarkPlugins:[Ga],children:t})})})]}),oD={type:"object",properties:{courseId:{type:"number",required:!0},topicId:{type:"number",required:!0},subject:{type:"string"},level:{type:"string"},isMaturaCourse:{type:"boolean"},alignToCurriculum:{type:"boolean"},defaultDuration:{type:"number"},style:{type:"string"},tone:{type:"string"}}};function lD(){const{registerStep:t,setStepData:e,getStepData:s}=In(),n=pe(),i=s("em_step1")||{},[a,o]=j.useState({open:!1,material:null});j.useEffect(()=>{t("em_step1",oD),i.subject||e("em_step1",{subject:"Matematyka",level:"podstawowy",isMaturaCourse:!0,alignToCurriculum:!0,style:"notebook",tone:"friendly",defaultDuration:20})},[]);const{data:l}=Y({resource:"courses",sorters:[{field:"created_at",order:"desc"}],pagination:{pageSize:100}}),{data:c,isLoading:u}=Y({resource:"topics",filters:[{field:"course_id",operator:"eq",value:i.courseId||-1}],sorters:[{field:"position",order:"asc"}],pagination:{pageSize:500},queryOptions:{enabled:!!i.courseId}}),d=j.useMemo(()=>(c?.data||[]).map(S=>S.id),[c?.data]),{data:h}=Y({resource:"activities",filters:d.length>0?[{field:"topic_id",operator:"in",value:d},{field:"type",operator:"eq",value:"material"}]:[],sorters:[{field:"position",order:"asc"}],pagination:{pageSize:1e3},meta:{select:"id,topic_id,title,type,position,content,duration_min,created_at,is_published"},queryOptions:{enabled:d.length>0}}),f=j.useMemo(()=>{const S={};if(h?.data)for(const z of h.data){const N=z.topic_id;S[N]||(S[N]={count:0,materials:[]}),S[N].count++,S[N].materials.push(z)}return S},[h?.data]);j.useEffect(()=>{e("em_step1",{topicId:void 0})},[i.courseId]);const m=j.useMemo(()=>l?.data?.find(S=>S.id===i.courseId),[l?.data,i.courseId]);j.useEffect(()=>{if(!m)return;const z=String(m.level||"").toLowerCase()==="rozszerzony"?"rozszerzony":"podstawowy";e("em_step1",{subject:m.subject||"Matematyka",level:z,isMaturaCourse:!!m.is_exam_course,alignToCurriculum:!!m.is_exam_course})},[m]);const[p,x]=j.useState(""),g=j.useMemo(()=>{const S=c?.data||[];if(!p.trim())return S;const z=p.toLowerCase();return S.filter(N=>String(N.title).toLowerCase().includes(z)||String(N.position).includes(z))},[c?.data,p]),y=j.useMemo(()=>nx(i.subject),[i.subject]),b=!!i.courseId&&!!i.topicId,w=(S,z)=>{z.stopPropagation(),o({open:!0,material:S})};return r.jsxs(X,{children:[r.jsx(je,{title:"Krok 1",description:"Wybór kursu, tematu i parametrów"}),r.jsxs("div",{className:"grid gap-6 lg:grid-cols-[1.2fr,0.8fr]",children:[r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Kurs i temat"})}),r.jsxs(I,{className:"space-y-4",children:[r.jsx(hv,{value:i.courseId||null,onChange:S=>e("em_step1",{courseId:S||void 0}),showAlert:!0}),i.courseId&&r.jsxs("div",{className:"rounded-lg border",children:[r.jsxs("div",{className:"flex items-center gap-2 p-2 border-b bg-muted/40",children:[r.jsx(uo,{className:"w-4 h-4 text-muted-foreground"}),r.jsx(te,{value:p,onChange:S=>x(S.target.value),placeholder:"Filtruj tematy…",className:"h-8"})]}),r.jsxs("div",{className:"divide-y",children:[u&&r.jsx("div",{className:"p-3 text-xs text-muted-foreground",children:"Ładowanie tematów…"}),!u&&g.length===0&&r.jsx("div",{className:"p-3 text-xs text-muted-foreground",children:p?"Brak wyników dla filtru.":"Ten kurs nie ma jeszcze tematów."}),g.map(S=>{const z=f[S.id],N=i.topicId===S.id;return r.jsx("button",{type:"button",onClick:()=>e("em_step1",{topicId:S.id}),className:["w-full text-left p-3 hover:bg-muted/50 transition",N?"bg-blue-50/60 ring-1 ring-blue-200":""].join(" "),children:r.jsxs("div",{className:"flex items-start justify-between gap-3",children:[r.jsxs("div",{className:"min-w-0 flex-1",children:[r.jsxs("div",{className:"text-sm font-medium flex items-center gap-2",children:[r.jsx("span",{className:"shrink-0 inline-flex items-center justify-center w-5 h-5 rounded-full bg-primary/10 text-xs font-semibold",children:S.position}),r.jsx("span",{className:"truncate",children:S.title}),!S.is_published&&r.jsx(V,{variant:"outline",className:"text-xs shrink-0",children:r.jsx(ii,{className:"w-3 h-3"})})]}),N&&r.jsx("div",{className:"mt-2 ml-7",children:z?.count>0?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground mb-1",children:[r.jsx(cs,{className:"w-3 h-3"}),r.jsx("span",{children:"Materiały:"}),r.jsx(V,{variant:"secondary",className:"text-xs h-4 px-1",children:z.count})]}),r.jsx("ul",{className:"space-y-0.5 ml-4",children:z.materials.map(k=>r.jsx("li",{className:"text-[11px]",children:r.jsxs("button",{onClick:C=>w(k,C),className:"text-primary/70 hover:text-primary hover:underline inline-flex items-center gap-1 w-full text-left",children:[r.jsx("span",{className:"mr-1",children:"•"}),r.jsx("span",{className:"truncate flex-1",children:k.title}),r.jsx(Tt,{className:"w-3 h-3 opacity-0 hover:opacity-100 transition-opacity flex-shrink-0"})]})},k.id))})]}):r.jsx("div",{className:"text-xs text-muted-foreground/50 italic",children:"Brak materiałów"})})]}),r.jsx("div",{className:["shrink-0 w-3 h-3 rounded-full border mt-1",N?"bg-blue-500 border-blue-500":"bg-white"].join(" "),"aria-hidden":!0})]})},S.id)})]}),r.jsx("div",{className:"p-2 border-t text-[11px] text-muted-foreground",children:"Kliknij temat aby go wybrać i zobaczyć wszystkie materiały. Kliknij tytuł materiału aby zobaczyć podgląd."})]})]})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Parametry generowania"})}),r.jsxs(I,{className:"space-y-4",children:[r.jsxs(Ee,{value:i.subject||"Matematyka",onValueChange:S=>e("em_step1",{subject:S}),children:[r.jsx(_e,{children:r.jsx(De,{placeholder:"Przedmiot"})}),r.jsx(Ae,{children:sx.map(S=>r.jsx(ee,{value:S,children:S},S))})]}),r.jsxs(Ee,{value:i.level||"podstawowy",onValueChange:S=>e("em_step1",{level:S}),children:[r.jsx(_e,{children:r.jsx(De,{placeholder:"Poziom"})}),r.jsxs(Ae,{children:[r.jsx(ee,{value:"podstawowy",children:"Podstawowy"}),r.jsx(ee,{value:"rozszerzony",children:"Rozszerzony"})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(mt,{checked:i.isMaturaCourse||!1,onCheckedChange:S=>e("em_step1",{isMaturaCourse:!!S,alignToCurriculum:S?i.alignToCurriculum:!1})}),r.jsx("span",{className:"text-sm",children:"Kurs maturalny"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(mt,{checked:i.alignToCurriculum||!1,onCheckedChange:S=>e("em_step1",{alignToCurriculum:!!S}),disabled:!i.isMaturaCourse}),r.jsx("span",{className:"text-sm",children:"Uwzględnij najnowszą (2025) podstawę LO (PL)"})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[r.jsxs("div",{children:[r.jsx("div",{className:"text-xs mb-1",children:"Styl"}),r.jsxs(Ee,{value:i.style||"notebook",onValueChange:S=>e("em_step1",{style:S}),children:[r.jsx(_e,{children:r.jsx(De,{placeholder:"Wybierz styl"})}),r.jsxs(Ae,{children:[r.jsx(ee,{value:"notebook",children:"Notatka z lekcji"}),r.jsx(ee,{value:"exam",children:"Pod egzamin"}),r.jsx(ee,{value:"concise",children:"Zwięzły"})]})]})]}),r.jsxs("div",{children:[r.jsx("div",{className:"text-xs mb-1",children:"Ton"}),r.jsxs(Ee,{value:i.tone||"friendly",onValueChange:S=>e("em_step1",{tone:S}),children:[r.jsx(_e,{children:r.jsx(De,{placeholder:"Ton"})}),r.jsxs(Ae,{children:[r.jsx(ee,{value:"friendly",children:"Przystępny"}),r.jsx(ee,{value:"neutral",children:"Neutralny"}),r.jsx(ee,{value:"formal",children:"Formalny"})]})]})]})]}),r.jsxs("div",{children:[r.jsx("div",{className:"text-xs mb-1",children:"Domyślny czas (min)"}),r.jsx(te,{type:"number",min:5,value:i.defaultDuration??20,onChange:S=>e("em_step1",{defaultDuration:Number(S.target.value)})})]}),i.isMaturaCourse&&i.alignToCurriculum&&y&&r.jsxs(we,{children:[r.jsx(Gi,{className:"h-4 w-4"}),r.jsxs(ve,{className:"text-xs",children:["Dokument: ",r.jsx("strong",{children:y.label}),y.year?` • ${y.year}`:""]})]}),r.jsxs(D,{disabled:!b,className:"w-full",onClick:()=>n("/admin/educational-material/step2"),children:["Kontynuuj",r.jsx(He,{className:"w-4 h-4 ml-1"})]}),!b&&r.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Wybierz kurs i temat aby kontynuować"})]})]})]}),r.jsx(pn,{open:a.open,onOpenChange:S=>{S||o({open:!1,material:null})},children:r.jsxs(en,{className:"max-w-6xl max-h-[90vh]",children:[r.jsxs(tn,{children:[r.jsxs(sn,{className:"flex items-center gap-2",children:[r.jsx(Tt,{className:"w-5 h-5"}),a.material?.title]}),r.jsxs(Ha,{children:["Podgląd materiału • ",a.material?.duration_min||20," min"]})]}),a.material&&r.jsx(Xd,{content:a.material.content,metadata:{duration_min:a.material.duration_min,position:a.material.position,created_at:a.material.created_at},showMetadata:!0,height:"500px"})]})})]})}const cD={type:"object",properties:{title:{type:"string",required:!0},duration_min:{type:"number"},content_markdown:{type:"string",required:!0},section_count:{type:"number",minimum:6,maximum:6,description:"Must have exactly 6 H2 sections"}}},uD={Matematyka:"używaj wzorów matematycznych w blokach kodu, pokazuj kroki rozwiązania, dodawaj wykresy ASCII gdzie to możliwe",Angielski:"dodaj tabele z odmianą czasowników, przykładowe dialogi, różnice British/American English",Informatyka:"używaj bloków kodu z komentarzami, pokazuj input/output, best practices",Fizyka:"wyjaśniaj wzory krok po kroku, dodawaj jednostki, pokazuj zastosowania praktyczne",Chemia:"równania reakcji w blokach kodu, zasady bezpieczeństwa, przykłady z życia",Biologia:"używaj analogii do życia codziennego, pokazuj zależności w ekosystemach",Historia:"dodawaj kontekst czasowy, mapy konceptualne wydarzeń, ciekawostki",Geografia:"opisuj zjawiska z przykładami regionalnymi, wpływ człowieka na środowisko",Polski:"analizuj teksty krok po kroku, środki stylistyczne z przykładami"},dD={podstawowy:"uczniowie 12-16 lat - używaj prostych analogii z życia codziennego, gier, social mediów, unikaj abstrakcji",rozszerzony:"uczniowie 16-19 lat - mogą zrozumieć abstrakcje, zainteresowani praktycznymi zastosowaniami i karierą"},hD=t=>{const e=t.match(/^##\s+[^#]/gm);if(!e||e.length!==6)throw new Error(`Nieprawidłowa struktura: znaleziono ${e?.length||0} sekcji, wymagane 6`);if(/^#\s+[^#]/m.test(t))throw new Error("Materiał zawiera niedozwolone nagłówki H1");if(/```quiz/i.test(t))throw new Error("Materiał zawiera bloki quiz - usuń je, quizy dodaje się w Step 4");return!0};function fD(){const{getStepData:t,setStepData:e}=In(),s=pe(),n=t("em_step1"),i=n?.courseId,a=n?.topicId,[o,l]=j.useState(null),[c,u]=j.useState(!1),[d,h]=j.useState(null),[f,m]=j.useState(null),[p,x]=j.useState(!1);j.useEffect(()=>{(!i||!a)&&s("/admin/educational-material/step1")},[i,a,s]);const{data:g}=Y({resource:"topics",filters:[{field:"course_id",operator:"eq",value:i||-1},{field:"id",operator:"eq",value:a||-1}],sorters:[{field:"position",order:"asc"}],pagination:{pageSize:1},queryOptions:{enabled:!!i&&!!a}}),y=j.useMemo(()=>(g?.data||[])[0],[g?.data]),b=j.useMemo(()=>{if(y?.id!=null)return typeof y.id=="string"?Number(y.id):y.id},[y?.id]),w=j.useMemo(()=>y?.position==null?0:typeof y.position=="string"?Number(y.position):y.position,[y?.position]),{data:S}=tt({resource:"courses",id:String(i||""),meta:{select:"*"},queryOptions:{enabled:!!i}}),z=n?.isMaturaCourse&&n?.alignToCurriculum?nx(n?.subject):null,N=async()=>{if(!y||b==null)return;h(null),m(null),x(!1),u(!0),e("em_step2",{isGenerating:!0});const C=z?`
ZGODNOŚĆ Z PODSTAWĄ PROGRAMOWĄ:
- Dokument: ${z.label}${z.year?` • ${z.year}`:""}
- Przedmiot: ${n.subject}
Oznacz fragmenty zgodne z wymaganiami tagiem [PP].
      `.trim():"",T=uD[n.subject||""]||"",v=dD[n.level||"podstawowy"]||"",_=`
Jesteś doświadczonym nauczycielem tworzącym angażujący materiał edukacyjny.

KONTEKST:
- Kurs: ${S?.data?.title||"Kurs"}
- Temat lekcji: ${y.title} (lekcja ${w})
- Przedmiot: ${n.subject}
- Poziom: ${n.level} (${v})
- Typ kursu: ${n.isMaturaCourse?"maturalny":"podstawowy"}
- Czas trwania: ${n.defaultDuration??20} minut

${C}

KRYTYCZNA ZASADA STRUKTURY:
- Używaj WYŁĄCZNIE nagłówków poziomu 2 (##) dla głównych sekcji
- NIE używaj # (H1) - tytuł materiału jest osobno
- Możesz używać ### (H3) i #### (H4) WEWNĄTRZ sekcji dla podpodziałów
- Każda główna sekcja MUSI zaczynać się od ##
- NIE dodawaj bloków \`\`\`quiz - pytania kontrolne są dodawane osobno w Step 4

WYMAGANIA PEDAGOGICZNE:
1. Język: ${n.level==="podstawowy"?"prosty, bezpośredni, z analogiami do życia codziennego":"precyzyjny z terminologią fachową, ale wciąż przystępny"}
2. Ton: ${n.tone==="friendly"?'przyjazny, bezpośredni (używaj "poznamy", "zobaczysz", "odkryjesz")':n.tone==="formal"?"profesjonalny ale przystępny":"neutralny, rzeczowy"}
3. Przedmiot: ${T}

OBOWIĄZKOWA STRUKTURA (dokładnie w tej kolejności, używając ##):

## 🎯 Cele lekcji
Po tej lekcji będziesz:
- [Czasownik w formie dokonanej: poznasz/zrozumiesz/nauczysz się - konkretna wiedza]
- [Czasownik w formie dokonanej: potrafisz/zastosujesz - konkretna umiejętność]
- [Czasownik w formie dokonanej: rozróżnisz/przeanalizujesz - konkretne zastosowanie]

## 📚 Kluczowe pojęcia

**[Pojęcie 1]:** [Definicja prostym językiem, max 2 zdania]

**[Pojęcie 2]:** [Definicja z mini-przykładem w nawiasie]

**[Pojęcie 3]:** [Definicja z odniesieniem do życia codziennego]

[Dodaj 3-5 pojęć kluczowych dla tematu]

## 🔍 Szczegółowe omówienie

### [Podtemat 1 - najważniejszy koncept]

[Akapit wyjaśniający z analogią lub metaforą odpowiednią do wieku]

[Jeśli to przedmiot ścisły, dodaj wzór/równanie/kod:]
\`\`\`
[przykład]
\`\`\`

**Kluczowe zasady:**
- [Zasada 1 z krótkim wyjaśnieniem]
- [Zasada 2 z przykładem]
- [Zasada 3 - do zapamiętania]

**Przykład praktyczny:**
[Opisz konkretną sytuację gdzie to się stosuje]

### [Podtemat 2 - rozwinięcie lub drugi aspekt]

[Wyjaśnienie z kontekstem praktycznym]

${n.subject==="Angielski"||n.subject==="Matematyka"||n.subject==="Chemia"?`
**Tabela pomocnicza:**
| [Nagłówek 1] | [Nagłówek 2] | [Nagłówek 3] |
|--------------|--------------|--------------|
| [Przykład] | [Przykład] | [Przykład] |
`:""}

### [Podtemat 3 - zastosowania lub podsumowanie]

[Połączenie wszystkich elementów w całość]

## 🌟 Przykłady z życia

1. **[Sytuacja codzienna]:** [Opis jak temat występuje w codziennym życiu ucznia]

2. **[Zastosowanie praktyczne]:** [Gdzie spotkamy to w realnym świecie/karierze]

3. **[Ciekawostka]:** [Coś fascynującego co zainteresuje uczniów w tym wieku]

## ⚠️ Częste błędy i pułapki

❌ **Błąd:** [Opis typowego błędu uczniów]
✅ **Poprawnie:** [Jak zrobić to dobrze z wyjaśnieniem dlaczego]

[Powtórz dla 2-3 najczęstszych błędów]

## 📝 Podsumowanie

### ✅ Najważniejsze do zapamiętania:
- **[Absolutne minimum]** - jeśli zapamiętasz tylko jedną rzecz
- **[Kluczowa zasada/wzór]** - fundament tematu
- **[Praktyczne zastosowanie]** - jak użyć tej wiedzy

### 🎯 Po tej lekcji potrafisz:
- [Konkretna umiejętność 1]
- [Konkretna umiejętność 2]
- [Konkretna umiejętność 3]

${n.isMaturaCourse?`
### 📊 Na maturze:
[Wskazówka jak ten temat pojawia się na egzaminie - typy zadań, na co zwrócić uwagę]
`:""}

---
*💫 Następny krok: Ten temat jest fundamentem dla [wskaż co będzie dalej]. Jeśli go opanujesz, [zachęta do dalszej nauki].*

DODATKOWE WYTYCZNE:
- Używaj emoji jako ikon sekcji (max 1-2 na sekcję)
- Formatuj kluczowe terminy **pogrubioną czcionką**
- Twórz listy dla przejrzystości
- Dodawaj tabele gdzie zwiększają zrozumienie
- Przykłady kodu/wzorów/równań w blokach \`\`\`
- Proporcje: 50% wyjaśnienia, 30% przykłady, 20% podsumowanie
- Długość: 800-1200 słów
- Unikaj ściany tekstu - używaj akapitów, list, tabel
- NIE dodawaj bloków \`\`\`quiz ani ćwiczeń - pytania kontrolne będą w Step 4

WALIDACJA STRUKTURY:
- Materiał MUSI mieć dokładnie 6 sekcji na poziomie ## (Cele, Pojęcia, Omówienie, Przykłady, Błędy, Podsumowanie)
- Każda sekcja MUSI zaczynać się od ##
- Wewnątrz sekcji możesz używać ###, ####
- NIE używaj # (H1) w treści

PRZYKŁAD BŁĘDNY ❌:
# Główny tytuł
### Podsekcja bez ## przed
## Sekcja

PRZYKŁAD POPRAWNY ✅:
## 🎯 Cele lekcji
Treść...

## 📚 Kluczowe pojęcia
### Podsekcja wewnątrz (to jest OK)
Treść...

Generuj materiał w czystym Markdown. Bądź konkretny, praktyczny i angażujący dla grupy wiekowej ${v}.
    `.trim();try{const A=await Ji(_,cD);hD(A.content_markdown);const E={topic_id:b,position:w,title:A.title||y.title,duration_min:A.duration_min??n.defaultDuration??20,content_markdown:A.content_markdown};l(E)}catch(A){const E=A?.message?.toString()?.includes("503")||A?.details?.toString()?.includes?.("503")?"Błąd komunikacji z Gemini":A?.message||"Nie udało się wygenerować materiału.";h(E);const M=A?.info??A?.response??{message:A?.message,status:A?.status||A?.statusCode,details:A?.details,hint:A?.hint,raw:A};m(M)}finally{u(!1),e("em_step2",{isGenerating:!1})}},k=()=>{o&&s("/admin/educational-material/step3",{state:{item:o}})};return r.jsxs(X,{children:[r.jsx(je,{title:"Krok 2",description:"Generowanie materiału edukacyjnego"}),r.jsxs("div",{className:"grid gap-6 lg:grid-cols-[0.9fr,1.1fr]",children:[r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center gap-2",children:[r.jsx(pt,{className:"w-5 h-5"}),"Panel generowania"]})}),r.jsxs(I,{className:"space-y-4",children:[r.jsxs("div",{className:"rounded-lg bg-muted p-4 space-y-2",children:[r.jsxs("div",{className:"text-sm",children:[r.jsx("span",{className:"text-muted-foreground",children:"Kurs:"})," ",r.jsx("span",{className:"font-medium",children:S?.data?.title||"-"})]}),r.jsxs("div",{className:"text-sm",children:[r.jsx("span",{className:"text-muted-foreground",children:"Temat:"})," ",r.jsx("span",{className:"font-medium",children:y?`${w}. ${y.title}`:"-"})]}),r.jsxs("div",{className:"flex gap-2 mt-3",children:[r.jsx(V,{variant:"outline",children:n.subject}),r.jsx(V,{variant:"outline",children:n.level}),n.isMaturaCourse&&r.jsx(V,{variant:"default",children:"Maturalny"})]})]}),r.jsxs(we,{children:[r.jsx(Se,{className:"h-4 w-4"}),r.jsxs(ve,{className:"text-xs",children:[r.jsx("strong",{children:"Struktura:"})," 6 głównych sekcji (##)",r.jsx("br",{}),r.jsx("strong",{children:"Styl:"})," ",n.style==="notebook"?"Notatka z lekcji":n.style==="exam"?"Przygotowanie do egzaminu":"Zwięzły",r.jsx("br",{}),r.jsx("strong",{children:"Ton:"})," ",n.tone==="friendly"?"Przyjazny":n.tone==="formal"?"Formalny":"Neutralny",r.jsx("br",{}),r.jsx("strong",{children:"Pytania kontrolne:"})," Dodasz w kroku 4"]})]}),r.jsxs("div",{className:"flex flex-col gap-2",children:[r.jsx(D,{onClick:N,disabled:c,className:"w-full",size:"lg",children:c?r.jsxs(r.Fragment,{children:[r.jsx(qt,{className:"w-4 h-4 mr-2 animate-spin"}),"Generowanie materiału..."]}):r.jsxs(r.Fragment,{children:[r.jsx(Jt,{className:"w-4 h-4 mr-2"}),"Wygeneruj materiał wysokiej jakości"]})}),r.jsxs(D,{variant:"default",onClick:k,disabled:!o||c,className:"w-full",children:["Przejdź do zapisu",r.jsx(He,{className:"w-4 h-4 ml-1"})]})]}),d&&r.jsxs("div",{className:"space-y-2",children:[r.jsxs(we,{variant:"destructive",children:[r.jsx(st,{className:"h-4 w-4"}),r.jsx(ve,{children:d})]}),(f?.status||f?.statusCode||(typeof f=="object"&&"error"in f&&f.error?.includes?.("503")?503:void 0))===503?r.jsxs("div",{className:"text-xs text-muted-foreground",children:[r.jsx("strong",{children:"Wskazówka:"})," Model jest przeciążony (HTTP 503). Spróbuj ponownie za chwilę lub zmień model/zmniejsz objętość kontekstu."]}):null,f&&r.jsxs(P,{children:[r.jsx(F,{className:"py-3",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx(L,{className:"text-sm",children:"Szczegóły błędu"}),r.jsx(D,{variant:"ghost",size:"sm",onClick:()=>x(C=>!C),className:"h-7",children:p?r.jsx(Ua,{className:"w-4 h-4"}):r.jsx(ls,{className:"w-4 h-4"})})]})}),p&&r.jsx(I,{className:"pt-0",children:r.jsx(mn,{className:"font-mono text-xs h-40",readOnly:!0,value:(()=>{try{return JSON.stringify(f,null,2)}catch{return String(f)}})()})})]})]}),c&&r.jsxs("div",{className:"text-center text-sm text-muted-foreground space-y-1",children:[r.jsx("p",{children:"Tworzę angażujący materiał..."}),r.jsx("p",{className:"text-xs",children:"To może potrwać 20-30 sekund"})]})]})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Podgląd materiału"})}),r.jsx(I,{children:o?r.jsxs(r.Fragment,{children:[r.jsx(P,{className:"mb-3 bg-muted",children:r.jsxs(I,{className:"pt-6",children:[r.jsx("div",{className:"font-semibold",children:o.title}),r.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-3 mt-2",children:[r.jsxs("span",{children:["⏱️ ",o.duration_min??20," min"]}),r.jsxs("span",{children:["📝 ",o.content_markdown.length," znaków"]}),r.jsx("span",{children:"📄 6 sekcji"})]})]})}),r.jsx(bt,{className:"h-[500px] rounded-lg border p-4",children:r.jsx("div",{className:"prose prose-sm max-w-none dark:prose-invert",children:r.jsx(Va,{remarkPlugins:[Ga],children:o.content_markdown})})})]}):r.jsx("div",{className:"flex flex-col items-center justify-center py-16 text-muted-foreground",children:c?r.jsxs(r.Fragment,{children:[r.jsx(qt,{className:"w-8 h-8 mb-3 animate-spin"}),r.jsx("div",{className:"text-sm",children:"Generowanie struktury..."}),r.jsx("div",{className:"text-xs mt-2",children:"Dodawanie przykładów..."})]}):r.jsxs(r.Fragment,{children:[r.jsx(Se,{className:"w-8 h-8 mb-3 opacity-50"}),r.jsx("div",{className:"text-sm",children:"Brak wygenerowanego materiału"}),r.jsx("div",{className:"text-xs mt-1",children:'Kliknij "Wygeneruj materiał"'})]})})})]})]})]})}function mD(){const t=pe(),e=gn(),{mutate:s}=hn(),n=j.useMemo(()=>e?.state?.item??null,[e?.state?.item]),[i,a]=j.useState(n?.title??""),[o,l]=j.useState(!1),[c,u]=j.useState(!1),[d,h]=j.useState(null),[f,m]=j.useState(null),{data:p}=Y({resource:"activities",filters:n?[{field:"topic_id",operator:"eq",value:n.topic_id}]:[],sorters:[{field:"position",order:"desc"}],pagination:{pageSize:1},queryOptions:{enabled:!!n?.topic_id}});j.useEffect(()=>{n||t("/admin/educational-material/step2")},[n,t]);const x=async()=>{if(n){if(!i||i.trim().length<3){h("Tytuł musi mieć minimum 3 znaki.");return}if(!n.content_markdown||n.content_markdown.trim().length<50){h("Materiał jest zbyt krótki. Wróć do kroku 2 i wygeneruj ponownie.");return}u(!0),h(null);try{const g=Number(n.topic_id),y=p?.data?.[0],b=y?.position?Number(y.position)+1:1,w=await new Promise((S,z)=>{s({resource:"activities",values:{topic_id:g,type:"material",title:i.trim(),content:n.content_markdown,duration_min:n.duration_min??20,position:b,is_published:o}},{onSuccess:N=>{const k=N?.data?.id;if(k){const C=typeof k=="string"?parseInt(k,10):k;m(C),S(C)}else z(new Error("Nie otrzymano ID aktywności"))},onError:N=>{console.error("Błąd zapisu:",N),z(N)}})})}catch(g){console.error("Błąd podczas zapisu:",g),g?.code==="23505"?h("Materiał o tym tytule już istnieje w tym temacie. Zmień tytuł."):g?.code==="23503"?h("Nieprawidłowy temat. Odśwież stronę i spróbuj ponownie."):g?.message?h(g.message):h("Nie udało się zapisać materiału. Spróbuj ponownie."),u(!1)}}};return n?r.jsxs(X,{children:[r.jsx(je,{title:"Krok 3",description:"Zapis materiału do bazy"}),r.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Ustawienia zapisu"})}),r.jsxs(I,{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium mb-2",children:["Tytuł materiału ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx(te,{value:i,onChange:g=>a(g.target.value),placeholder:"np. Wprowadzenie do tematu",disabled:c||f!==null}),r.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Tytuł będzie widoczny dla uczniów"})]}),r.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[r.jsxs("div",{className:"text-sm",children:[r.jsx("div",{className:"font-medium",children:"Opublikuj od razu"}),r.jsx("div",{className:"text-xs text-muted-foreground",children:"Materiał będzie widoczny dla uczniów"})]}),r.jsx(fs,{checked:o,onCheckedChange:l,disabled:c||f!==null})]}),d&&r.jsxs(we,{variant:"destructive",children:[r.jsx(st,{className:"h-4 w-4"}),r.jsx(ve,{children:d})]}),f&&r.jsxs(we,{className:"border-green-200 bg-green-50",children:[r.jsx(ws,{className:"h-4 w-4 text-green-600"}),r.jsxs(ve,{className:"text-green-900",children:[r.jsx("span",{className:"font-medium",children:"Materiał zapisany!"}),r.jsx("br",{}),"ID: ",f,r.jsx("br",{}),r.jsx("span",{className:"text-xs",children:"Możesz teraz dodać pytania kontrolne lub przejść do podglądu."})]})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(D,{onClick:x,disabled:c||f!==null||!i.trim(),className:"flex-1",children:c?r.jsxs(r.Fragment,{children:[r.jsx(Jr,{className:"w-4 h-4 mr-2 animate-pulse"}),"Zapisywanie..."]}):f?r.jsxs(r.Fragment,{children:[r.jsx(ws,{className:"w-4 h-4 mr-2"}),"Zapisano!"]}):r.jsxs(r.Fragment,{children:[r.jsx(Jr,{className:"w-4 h-4 mr-2"}),"Zapisz materiał"]})}),r.jsx(D,{asChild:!0,variant:"outline",disabled:c,children:r.jsxs(Ke,{to:"/admin/educational-material/step2",children:[r.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Wróć"]})})]}),f&&r.jsxs("div",{className:"pt-4 border-t space-y-2",children:[r.jsx("p",{className:"text-sm font-medium mb-2",children:"Co dalej?"}),r.jsx(D,{asChild:!0,variant:"default",className:"w-full",children:r.jsxs(Ke,{to:"/admin/educational-material/step4",children:[r.jsx(dt,{className:"w-4 h-4 mr-2"}),"Dodaj pytania kontrolne (krok 4)"]})}),r.jsx(D,{asChild:!0,variant:"outline",className:"w-full",children:r.jsx(Ke,{to:"/admin/educational-material/step1",children:"Stwórz kolejny materiał"})})]})]})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Podsumowanie materiału"})}),r.jsxs(I,{className:"space-y-4",children:[r.jsxs("div",{className:"grid gap-3",children:[r.jsxs("div",{children:[r.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"ID Tematu"}),r.jsx("div",{className:"font-medium",children:n.topic_id})]}),r.jsxs("div",{children:[r.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Wygenerowany tytuł"}),r.jsx("div",{className:"font-medium",children:n.title})]}),r.jsxs("div",{children:[r.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Czas trwania"}),r.jsxs("div",{className:"font-medium",children:[n.duration_min??20," minut"]})]}),r.jsxs("div",{children:[r.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Długość treści"}),r.jsxs("div",{className:"font-medium",children:[n.content_markdown.length," znaków"]})]}),r.jsxs("div",{children:[r.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Pozycja w temacie"}),r.jsx("div",{className:"font-medium",children:p?.data?.[0]?.position?`${Number(p.data[0].position)+1} (po ${p.data.length} istniejących)`:"1 (pierwszy materiał)"})]})]}),r.jsxs(we,{children:[r.jsx(st,{className:"h-4 w-4"}),r.jsx(ve,{className:"text-xs",children:"Po zapisie materiał będzie dostępny w module aktywności. Możesz go później edytować, dodać pytania kontrolne i przypisać do grup uczniów."})]})]})]})]})]}):r.jsxs(X,{children:[r.jsx(je,{title:"Krok 3",description:"Zapis materiału"}),r.jsx(P,{children:r.jsx(I,{className:"pt-6",children:r.jsxs(we,{variant:"destructive",children:[r.jsx(st,{className:"h-4 w-4"}),r.jsxs(ve,{children:["Brak danych z poprzedniego kroku.",r.jsx(Ke,{to:"/admin/educational-material/step2",className:"underline ml-1",children:"Wróć do kroku 2"})]})]})})})]})}const ox=Symbol.for("yaml.alias"),Nm=Symbol.for("yaml.document"),Ur=Symbol.for("yaml.map"),Ov=Symbol.for("yaml.pair"),On=Symbol.for("yaml.scalar"),fo=Symbol.for("yaml.seq"),nn=Symbol.for("yaml.node.type"),ai=t=>!!t&&typeof t=="object"&&t[nn]===ox,Zi=t=>!!t&&typeof t=="object"&&t[nn]===Nm,mo=t=>!!t&&typeof t=="object"&&t[nn]===Ur,Qe=t=>!!t&&typeof t=="object"&&t[nn]===Ov,Oe=t=>!!t&&typeof t=="object"&&t[nn]===On,po=t=>!!t&&typeof t=="object"&&t[nn]===fo;function Xe(t){if(t&&typeof t=="object")switch(t[nn]){case Ur:case fo:return!0}return!1}function nt(t){if(t&&typeof t=="object")switch(t[nn]){case ox:case Ur:case On:case fo:return!0}return!1}const Rv=t=>(Oe(t)||Xe(t))&&!!t.anchor,ps=Symbol("break visit"),Lv=Symbol("skip children"),En=Symbol("remove node");function Qi(t,e){const s=Fv(e);Zi(t)?va(null,t.contents,s,Object.freeze([t]))===En&&(t.contents=null):va(null,t,s,Object.freeze([]))}Qi.BREAK=ps;Qi.SKIP=Lv;Qi.REMOVE=En;function va(t,e,s,n){const i=$v(t,e,s,n);if(nt(i)||Qe(i))return Bv(t,n,i),va(t,i,s,n);if(typeof i!="symbol"){if(Xe(e)){n=Object.freeze(n.concat(e));for(let a=0;a<e.items.length;++a){const o=va(a,e.items[a],s,n);if(typeof o=="number")a=o-1;else{if(o===ps)return ps;o===En&&(e.items.splice(a,1),a-=1)}}}else if(Qe(e)){n=Object.freeze(n.concat(e));const a=va("key",e.key,s,n);if(a===ps)return ps;a===En&&(e.key=null);const o=va("value",e.value,s,n);if(o===ps)return ps;o===En&&(e.value=null)}}return i}async function eh(t,e){const s=Fv(e);Zi(t)?await ka(null,t.contents,s,Object.freeze([t]))===En&&(t.contents=null):await ka(null,t,s,Object.freeze([]))}eh.BREAK=ps;eh.SKIP=Lv;eh.REMOVE=En;async function ka(t,e,s,n){const i=await $v(t,e,s,n);if(nt(i)||Qe(i))return Bv(t,n,i),ka(t,i,s,n);if(typeof i!="symbol"){if(Xe(e)){n=Object.freeze(n.concat(e));for(let a=0;a<e.items.length;++a){const o=await ka(a,e.items[a],s,n);if(typeof o=="number")a=o-1;else{if(o===ps)return ps;o===En&&(e.items.splice(a,1),a-=1)}}}else if(Qe(e)){n=Object.freeze(n.concat(e));const a=await ka("key",e.key,s,n);if(a===ps)return ps;a===En&&(e.key=null);const o=await ka("value",e.value,s,n);if(o===ps)return ps;o===En&&(e.value=null)}}return i}function Fv(t){return typeof t=="object"&&(t.Collection||t.Node||t.Value)?Object.assign({Alias:t.Node,Map:t.Node,Scalar:t.Node,Seq:t.Node},t.Value&&{Map:t.Value,Scalar:t.Value,Seq:t.Value},t.Collection&&{Map:t.Collection,Seq:t.Collection},t):t}function $v(t,e,s,n){if(typeof s=="function")return s(t,e,n);if(mo(e))return s.Map?.(t,e,n);if(po(e))return s.Seq?.(t,e,n);if(Qe(e))return s.Pair?.(t,e,n);if(Oe(e))return s.Scalar?.(t,e,n);if(ai(e))return s.Alias?.(t,e,n)}function Bv(t,e,s){const n=e[e.length-1];if(Xe(n))n.items[t]=s;else if(Qe(n))t==="key"?n.key=s:n.value=s;else if(Zi(n))n.contents=s;else{const i=ai(n)?"alias":"scalar";throw new Error(`Cannot replace node with ${i} parent`)}}const pD={"!":"%21",",":"%2C","[":"%5B","]":"%5D","{":"%7B","}":"%7D"},xD=t=>t.replace(/[!,[\]{}]/g,e=>pD[e]);class ns{constructor(e,s){this.docStart=null,this.docEnd=!1,this.yaml=Object.assign({},ns.defaultYaml,e),this.tags=Object.assign({},ns.defaultTags,s)}clone(){const e=new ns(this.yaml,this.tags);return e.docStart=this.docStart,e}atDocument(){const e=new ns(this.yaml,this.tags);switch(this.yaml.version){case"1.1":this.atNextDocument=!0;break;case"1.2":this.atNextDocument=!1,this.yaml={explicit:ns.defaultYaml.explicit,version:"1.2"},this.tags=Object.assign({},ns.defaultTags);break}return e}add(e,s){this.atNextDocument&&(this.yaml={explicit:ns.defaultYaml.explicit,version:"1.1"},this.tags=Object.assign({},ns.defaultTags),this.atNextDocument=!1);const n=e.trim().split(/[ \t]+/),i=n.shift();switch(i){case"%TAG":{if(n.length!==2&&(s(0,"%TAG directive should contain exactly two parts"),n.length<2))return!1;const[a,o]=n;return this.tags[a]=o,!0}case"%YAML":{if(this.yaml.explicit=!0,n.length!==1)return s(0,"%YAML directive should contain exactly one part"),!1;const[a]=n;if(a==="1.1"||a==="1.2")return this.yaml.version=a,!0;{const o=/^\d+\.\d+$/.test(a);return s(6,`Unsupported YAML version ${a}`,o),!1}}default:return s(0,`Unknown directive ${i}`,!0),!1}}tagName(e,s){if(e==="!")return"!";if(e[0]!=="!")return s(`Not a valid tag: ${e}`),null;if(e[1]==="<"){const o=e.slice(2,-1);return o==="!"||o==="!!"?(s(`Verbatim tags aren't resolved, so ${e} is invalid.`),null):(e[e.length-1]!==">"&&s("Verbatim tags must end with a >"),o)}const[,n,i]=e.match(/^(.*!)([^!]*)$/s);i||s(`The ${e} tag has no suffix`);const a=this.tags[n];if(a)try{return a+decodeURIComponent(i)}catch(o){return s(String(o)),null}return n==="!"?e:(s(`Could not resolve tag: ${e}`),null)}tagString(e){for(const[s,n]of Object.entries(this.tags))if(e.startsWith(n))return s+xD(e.substring(n.length));return e[0]==="!"?e:`!<${e}>`}toString(e){const s=this.yaml.explicit?[`%YAML ${this.yaml.version||"1.2"}`]:[],n=Object.entries(this.tags);let i;if(e&&n.length>0&&nt(e.contents)){const a={};Qi(e.contents,(o,l)=>{nt(l)&&l.tag&&(a[l.tag]=!0)}),i=Object.keys(a)}else i=[];for(const[a,o]of n)a==="!!"&&o==="tag:yaml.org,2002:"||(!e||i.some(l=>l.startsWith(o)))&&s.push(`%TAG ${a} ${o}`);return s.join(`
`)}}ns.defaultYaml={explicit:!1,version:"1.2"};ns.defaultTags={"!!":"tag:yaml.org,2002:"};function qv(t){if(/[\x00-\x19\s,[\]{}]/.test(t)){const s=`Anchor must not contain whitespace or control characters: ${JSON.stringify(t)}`;throw new Error(s)}return!0}function Vv(t){const e=new Set;return Qi(t,{Value(s,n){n.anchor&&e.add(n.anchor)}}),e}function Uv(t,e){for(let s=1;;++s){const n=`${t}${s}`;if(!e.has(n))return n}}function gD(t,e){const s=[],n=new Map;let i=null;return{onAnchor:a=>{s.push(a),i??(i=Vv(t));const o=Uv(e,i);return i.add(o),o},setAnchors:()=>{for(const a of s){const o=n.get(a);if(typeof o=="object"&&o.anchor&&(Oe(o.node)||Xe(o.node)))o.node.anchor=o.anchor;else{const l=new Error("Failed to resolve repeated object (this should not happen)");throw l.source=a,l}}},sourceObjects:n}}function Na(t,e,s,n){if(n&&typeof n=="object")if(Array.isArray(n))for(let i=0,a=n.length;i<a;++i){const o=n[i],l=Na(t,n,String(i),o);l===void 0?delete n[i]:l!==o&&(n[i]=l)}else if(n instanceof Map)for(const i of Array.from(n.keys())){const a=n.get(i),o=Na(t,n,i,a);o===void 0?n.delete(i):o!==a&&n.set(i,o)}else if(n instanceof Set)for(const i of Array.from(n)){const a=Na(t,n,i,i);a===void 0?n.delete(i):a!==i&&(n.delete(i),n.add(a))}else for(const[i,a]of Object.entries(n)){const o=Na(t,n,i,a);o===void 0?delete n[i]:o!==a&&(n[i]=o)}return t.call(e,s,n)}function Js(t,e,s){if(Array.isArray(t))return t.map((n,i)=>Js(n,String(i),s));if(t&&typeof t.toJSON=="function"){if(!s||!Rv(t))return t.toJSON(e,s);const n={aliasCount:0,count:1,res:void 0};s.anchors.set(t,n),s.onCreate=a=>{n.res=a,delete s.onCreate};const i=t.toJSON(e,s);return s.onCreate&&s.onCreate(i),i}return typeof t=="bigint"&&!s?.keep?Number(t):t}class lx{constructor(e){Object.defineProperty(this,nn,{value:e})}clone(){const e=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return this.range&&(e.range=this.range.slice()),e}toJS(e,{mapAsMap:s,maxAliasCount:n,onAnchor:i,reviver:a}={}){if(!Zi(e))throw new TypeError("A document argument is required");const o={anchors:new Map,doc:e,keep:!0,mapAsMap:s===!0,mapKeyWarned:!1,maxAliasCount:typeof n=="number"?n:100},l=Js(this,"",o);if(typeof i=="function")for(const{count:c,res:u}of o.anchors.values())i(u,c);return typeof a=="function"?Na(a,{"":l},"",l):l}}class th extends lx{constructor(e){super(ox),this.source=e,Object.defineProperty(this,"tag",{set(){throw new Error("Alias nodes cannot have tags")}})}resolve(e,s){let n;s?.aliasResolveCache?n=s.aliasResolveCache:(n=[],Qi(e,{Node:(a,o)=>{(ai(o)||Rv(o))&&n.push(o)}}),s&&(s.aliasResolveCache=n));let i;for(const a of n){if(a===this)break;a.anchor===this.source&&(i=a)}return i}toJSON(e,s){if(!s)return{source:this.source};const{anchors:n,doc:i,maxAliasCount:a}=s,o=this.resolve(i,s);if(!o){const c=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new ReferenceError(c)}let l=n.get(o);if(l||(Js(o,null,s),l=n.get(o)),!l||l.res===void 0){const c="This should not happen: Alias anchor was not resolved?";throw new ReferenceError(c)}if(a>=0&&(l.count+=1,l.aliasCount===0&&(l.aliasCount=nu(i,o,n)),l.count*l.aliasCount>a)){const c="Excessive alias count indicates a resource exhaustion attack";throw new ReferenceError(c)}return l.res}toString(e,s,n){const i=`*${this.source}`;if(e){if(qv(this.source),e.options.verifyAliasOrder&&!e.anchors.has(this.source)){const a=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new Error(a)}if(e.implicitKey)return`${i} `}return i}}function nu(t,e,s){if(ai(e)){const n=e.resolve(t),i=s&&n&&s.get(n);return i?i.count*i.aliasCount:0}else if(Xe(e)){let n=0;for(const i of e.items){const a=nu(t,i,s);a>n&&(n=a)}return n}else if(Qe(e)){const n=nu(t,e.key,s),i=nu(t,e.value,s);return Math.max(n,i)}return 1}const Wv=t=>!t||typeof t!="function"&&typeof t!="object";class fe extends lx{constructor(e){super(On),this.value=e}toJSON(e,s){return s?.keep?this.value:Js(this.value,e,s)}toString(){return String(this.value)}}fe.BLOCK_FOLDED="BLOCK_FOLDED";fe.BLOCK_LITERAL="BLOCK_LITERAL";fe.PLAIN="PLAIN";fe.QUOTE_DOUBLE="QUOTE_DOUBLE";fe.QUOTE_SINGLE="QUOTE_SINGLE";const yD="tag:yaml.org,2002:";function bD(t,e,s){if(e){const n=s.filter(a=>a.tag===e),i=n.find(a=>!a.format)??n[0];if(!i)throw new Error(`Tag ${e} not found`);return i}return s.find(n=>n.identify?.(t)&&!n.format)}function vl(t,e,s){if(Zi(t)&&(t=t.contents),nt(t))return t;if(Qe(t)){const h=s.schema[Ur].createNode?.(s.schema,null,s);return h.items.push(t),h}(t instanceof String||t instanceof Number||t instanceof Boolean||typeof BigInt<"u"&&t instanceof BigInt)&&(t=t.valueOf());const{aliasDuplicateObjects:n,onAnchor:i,onTagObj:a,schema:o,sourceObjects:l}=s;let c;if(n&&t&&typeof t=="object"){if(c=l.get(t),c)return c.anchor??(c.anchor=i(t)),new th(c.anchor);c={anchor:null,node:null},l.set(t,c)}e?.startsWith("!!")&&(e=yD+e.slice(2));let u=bD(t,e,o.tags);if(!u){if(t&&typeof t.toJSON=="function"&&(t=t.toJSON()),!t||typeof t!="object"){const h=new fe(t);return c&&(c.node=h),h}u=t instanceof Map?o[Ur]:Symbol.iterator in Object(t)?o[fo]:o[Ur]}a&&(a(u),delete s.onTagObj);const d=u?.createNode?u.createNode(s.schema,t,s):typeof u?.nodeClass?.from=="function"?u.nodeClass.from(s.schema,t,s):new fe(t);return e?d.tag=e:u.default||(d.tag=u.tag),c&&(c.node=d),d}function _u(t,e,s){let n=s;for(let i=e.length-1;i>=0;--i){const a=e[i];if(typeof a=="number"&&Number.isInteger(a)&&a>=0){const o=[];o[a]=n,n=o}else n=new Map([[a,n]])}return vl(n,void 0,{aliasDuplicateObjects:!1,keepUndefined:!1,onAnchor:()=>{throw new Error("This should not happen, please report a bug.")},schema:t,sourceObjects:new Map})}const qo=t=>t==null||typeof t=="object"&&!!t[Symbol.iterator]().next().done;let Kv=class extends lx{constructor(e,s){super(e),Object.defineProperty(this,"schema",{value:s,configurable:!0,enumerable:!1,writable:!0})}clone(e){const s=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return e&&(s.schema=e),s.items=s.items.map(n=>nt(n)||Qe(n)?n.clone(e):n),this.range&&(s.range=this.range.slice()),s}addIn(e,s){if(qo(e))this.add(s);else{const[n,...i]=e,a=this.get(n,!0);if(Xe(a))a.addIn(i,s);else if(a===void 0&&this.schema)this.set(n,_u(this.schema,i,s));else throw new Error(`Expected YAML collection at ${n}. Remaining path: ${i}`)}}deleteIn(e){const[s,...n]=e;if(n.length===0)return this.delete(s);const i=this.get(s,!0);if(Xe(i))return i.deleteIn(n);throw new Error(`Expected YAML collection at ${s}. Remaining path: ${n}`)}getIn(e,s){const[n,...i]=e,a=this.get(n,!0);return i.length===0?!s&&Oe(a)?a.value:a:Xe(a)?a.getIn(i,s):void 0}hasAllNullValues(e){return this.items.every(s=>{if(!Qe(s))return!1;const n=s.value;return n==null||e&&Oe(n)&&n.value==null&&!n.commentBefore&&!n.comment&&!n.tag})}hasIn(e){const[s,...n]=e;if(n.length===0)return this.has(s);const i=this.get(s,!0);return Xe(i)?i.hasIn(n):!1}setIn(e,s){const[n,...i]=e;if(i.length===0)this.set(n,s);else{const a=this.get(n,!0);if(Xe(a))a.setIn(i,s);else if(a===void 0&&this.schema)this.set(n,_u(this.schema,i,s));else throw new Error(`Expected YAML collection at ${n}. Remaining path: ${i}`)}}};const jD=t=>t.replace(/^(?!$)(?: $)?/gm,"#");function sr(t,e){return/^\n+$/.test(t)?t.substring(1):e?t.replace(/^(?! *$)/gm,e):t}const yi=(t,e,s)=>t.endsWith(`
`)?sr(s,e):s.includes(`
`)?`
`+sr(s,e):(t.endsWith(" ")?"":" ")+s,Hv="flow",Sm="block",ru="quoted";function sh(t,e,s="flow",{indentAtStart:n,lineWidth:i=80,minContentWidth:a=20,onFold:o,onOverflow:l}={}){if(!i||i<0)return t;i<a&&(a=0);const c=Math.max(1+a,1+i-e.length);if(t.length<=c)return t;const u=[],d={};let h=i-e.length;typeof n=="number"&&(n>i-Math.max(2,a)?u.push(0):h=i-n);let f,m,p=!1,x=-1,g=-1,y=-1;s===Sm&&(x=W0(t,x,e.length),x!==-1&&(h=x+c));for(let w;w=t[x+=1];){if(s===ru&&w==="\\"){switch(g=x,t[x+1]){case"x":x+=3;break;case"u":x+=5;break;case"U":x+=9;break;default:x+=1}y=x}if(w===`
`)s===Sm&&(x=W0(t,x,e.length)),h=x+e.length+c,f=void 0;else{if(w===" "&&m&&m!==" "&&m!==`
`&&m!=="	"){const S=t[x+1];S&&S!==" "&&S!==`
`&&S!=="	"&&(f=x)}if(x>=h)if(f)u.push(f),h=f+c,f=void 0;else if(s===ru){for(;m===" "||m==="	";)m=w,w=t[x+=1],p=!0;const S=x>y+1?x-2:g-1;if(d[S])return t;u.push(S),d[S]=!0,h=S+c,f=void 0}else p=!0}m=w}if(p&&l&&l(),u.length===0)return t;o&&o();let b=t.slice(0,u[0]);for(let w=0;w<u.length;++w){const S=u[w],z=u[w+1]||t.length;S===0?b=`
${e}${t.slice(0,z)}`:(s===ru&&d[S]&&(b+=`${t[S]}\\`),b+=`
${e}${t.slice(S+1,z)}`)}return b}function W0(t,e,s){let n=e,i=e+1,a=t[i];for(;a===" "||a==="	";)if(e<i+s)a=t[++e];else{do a=t[++e];while(a&&a!==`
`);n=e,i=e+1,a=t[i]}return n}const nh=(t,e)=>({indentAtStart:e?t.indent.length:t.indentAtStart,lineWidth:t.options.lineWidth,minContentWidth:t.options.minContentWidth}),rh=t=>/^(%|---|\.\.\.)/m.test(t);function wD(t,e,s){if(!e||e<0)return!1;const n=e-s,i=t.length;if(i<=n)return!1;for(let a=0,o=0;a<i;++a)if(t[a]===`
`){if(a-o>n)return!0;if(o=a+1,i-o<=n)return!1}return!0}function Zo(t,e){const s=JSON.stringify(t);if(e.options.doubleQuotedAsJSON)return s;const{implicitKey:n}=e,i=e.options.doubleQuotedMinMultiLineLength,a=e.indent||(rh(t)?"  ":"");let o="",l=0;for(let c=0,u=s[c];u;u=s[++c])if(u===" "&&s[c+1]==="\\"&&s[c+2]==="n"&&(o+=s.slice(l,c)+"\\ ",c+=1,l=c,u="\\"),u==="\\")switch(s[c+1]){case"u":{o+=s.slice(l,c);const d=s.substr(c+2,4);switch(d){case"0000":o+="\\0";break;case"0007":o+="\\a";break;case"000b":o+="\\v";break;case"001b":o+="\\e";break;case"0085":o+="\\N";break;case"00a0":o+="\\_";break;case"2028":o+="\\L";break;case"2029":o+="\\P";break;default:d.substr(0,2)==="00"?o+="\\x"+d.substr(2):o+=s.substr(c,6)}c+=5,l=c+1}break;case"n":if(n||s[c+2]==='"'||s.length<i)c+=1;else{for(o+=s.slice(l,c)+`

`;s[c+2]==="\\"&&s[c+3]==="n"&&s[c+4]!=='"';)o+=`
`,c+=2;o+=a,s[c+2]===" "&&(o+="\\"),c+=1,l=c+1}break;default:c+=1}return o=l?o+s.slice(l):s,n?o:sh(o,a,ru,nh(e,!1))}function Cm(t,e){if(e.options.singleQuote===!1||e.implicitKey&&t.includes(`
`)||/[ \t]\n|\n[ \t]/.test(t))return Zo(t,e);const s=e.indent||(rh(t)?"  ":""),n="'"+t.replace(/'/g,"''").replace(/\n+/g,`$&
${s}`)+"'";return e.implicitKey?n:sh(n,s,Hv,nh(e,!1))}function Sa(t,e){const{singleQuote:s}=e.options;let n;if(s===!1)n=Zo;else{const i=t.includes('"'),a=t.includes("'");i&&!a?n=Cm:a&&!i?n=Zo:n=s?Cm:Zo}return n(t,e)}let zm;try{zm=new RegExp(`(^|(?<!
))
+(?!
|$)`,"g")}catch{zm=/\n+(?!\n|$)/g}function iu({comment:t,type:e,value:s},n,i,a){const{blockQuote:o,commentString:l,lineWidth:c}=n.options;if(!o||/\n[\t ]+$/.test(s)||/^\s*$/.test(s))return Sa(s,n);const u=n.indent||(n.forceBlockIndent||rh(s)?"  ":""),d=o==="literal"?!0:o==="folded"||e===fe.BLOCK_FOLDED?!1:e===fe.BLOCK_LITERAL?!0:!wD(s,c,u.length);if(!s)return d?`|
`:`>
`;let h,f;for(f=s.length;f>0;--f){const z=s[f-1];if(z!==`
`&&z!=="	"&&z!==" ")break}let m=s.substring(f);const p=m.indexOf(`
`);p===-1?h="-":s===m||p!==m.length-1?(h="+",a&&a()):h="",m&&(s=s.slice(0,-m.length),m[m.length-1]===`
`&&(m=m.slice(0,-1)),m=m.replace(zm,`$&${u}`));let x=!1,g,y=-1;for(g=0;g<s.length;++g){const z=s[g];if(z===" ")x=!0;else if(z===`
`)y=g;else break}let b=s.substring(0,y<g?y+1:g);b&&(s=s.substring(b.length),b=b.replace(/\n+/g,`$&${u}`));let S=(x?u?"2":"1":"")+h;if(t&&(S+=" "+l(t.replace(/ ?[\r\n]+/g," ")),i&&i()),!d){const z=s.replace(/\n+/g,`
$&`).replace(/(?:^|\n)([\t ].*)(?:([\n\t ]*)\n(?![\n\t ]))?/g,"$1$2").replace(/\n+/g,`$&${u}`);let N=!1;const k=nh(n,!0);o!=="folded"&&e!==fe.BLOCK_FOLDED&&(k.onOverflow=()=>{N=!0});const C=sh(`${b}${z}${m}`,u,Sm,k);if(!N)return`>${S}
${u}${C}`}return s=s.replace(/\n+/g,`$&${u}`),`|${S}
${u}${b}${s}${m}`}function vD(t,e,s,n){const{type:i,value:a}=t,{actualString:o,implicitKey:l,indent:c,indentStep:u,inFlow:d}=e;if(l&&a.includes(`
`)||d&&/[[\]{},]/.test(a))return Sa(a,e);if(/^[\n\t ,[\]{}#&*!|>'"%@`]|^[?-]$|^[?-][ \t]|[\n:][ \t]|[ \t]\n|[\n\t ]#|[\n\t :]$/.test(a))return l||d||!a.includes(`
`)?Sa(a,e):iu(t,e,s,n);if(!l&&!d&&i!==fe.PLAIN&&a.includes(`
`))return iu(t,e,s,n);if(rh(a)){if(c==="")return e.forceBlockIndent=!0,iu(t,e,s,n);if(l&&c===u)return Sa(a,e)}const h=a.replace(/\n+/g,`$&
${c}`);if(o){const f=x=>x.default&&x.tag!=="tag:yaml.org,2002:str"&&x.test?.test(h),{compat:m,tags:p}=e.doc.schema;if(p.some(f)||m?.some(f))return Sa(a,e)}return l?h:sh(h,c,Hv,nh(e,!1))}function nc(t,e,s,n){const{implicitKey:i,inFlow:a}=e,o=typeof t.value=="string"?t:Object.assign({},t,{value:String(t.value)});let{type:l}=t;l!==fe.QUOTE_DOUBLE&&/[\x00-\x08\x0b-\x1f\x7f-\x9f\u{D800}-\u{DFFF}]/u.test(o.value)&&(l=fe.QUOTE_DOUBLE);const c=d=>{switch(d){case fe.BLOCK_FOLDED:case fe.BLOCK_LITERAL:return i||a?Sa(o.value,e):iu(o,e,s,n);case fe.QUOTE_DOUBLE:return Zo(o.value,e);case fe.QUOTE_SINGLE:return Cm(o.value,e);case fe.PLAIN:return vD(o,e,s,n);default:return null}};let u=c(l);if(u===null){const{defaultKeyType:d,defaultStringType:h}=e.options,f=i&&d||h;if(u=c(f),u===null)throw new Error(`Unsupported default string type ${f}`)}return u}function Gv(t,e){const s=Object.assign({blockQuote:!0,commentString:jD,defaultKeyType:null,defaultStringType:"PLAIN",directives:null,doubleQuotedAsJSON:!1,doubleQuotedMinMultiLineLength:40,falseStr:"false",flowCollectionPadding:!0,indentSeq:!0,lineWidth:80,minContentWidth:20,nullStr:"null",simpleKeys:!1,singleQuote:null,trueStr:"true",verifyAliasOrder:!0},t.schema.toStringOptions,e);let n;switch(s.collectionStyle){case"block":n=!1;break;case"flow":n=!0;break;default:n=null}return{anchors:new Set,doc:t,flowCollectionPadding:s.flowCollectionPadding?" ":"",indent:"",indentStep:typeof s.indent=="number"?" ".repeat(s.indent):"  ",inFlow:n,options:s}}function kD(t,e){if(e.tag){const i=t.filter(a=>a.tag===e.tag);if(i.length>0)return i.find(a=>a.format===e.format)??i[0]}let s,n;if(Oe(e)){n=e.value;let i=t.filter(a=>a.identify?.(n));if(i.length>1){const a=i.filter(o=>o.test);a.length>0&&(i=a)}s=i.find(a=>a.format===e.format)??i.find(a=>!a.format)}else n=e,s=t.find(i=>i.nodeClass&&n instanceof i.nodeClass);if(!s){const i=n?.constructor?.name??(n===null?"null":typeof n);throw new Error(`Tag not resolved for ${i} value`)}return s}function ND(t,e,{anchors:s,doc:n}){if(!n.directives)return"";const i=[],a=(Oe(t)||Xe(t))&&t.anchor;a&&qv(a)&&(s.add(a),i.push(`&${a}`));const o=t.tag??(e.default?null:e.tag);return o&&i.push(n.directives.tagString(o)),i.join(" ")}function Ja(t,e,s,n){if(Qe(t))return t.toString(e,s,n);if(ai(t)){if(e.doc.directives)return t.toString(e);if(e.resolvedAliases?.has(t))throw new TypeError("Cannot stringify circular structure without alias nodes");e.resolvedAliases?e.resolvedAliases.add(t):e.resolvedAliases=new Set([t]),t=t.resolve(e.doc)}let i;const a=nt(t)?t:e.doc.createNode(t,{onTagObj:c=>i=c});i??(i=kD(e.doc.schema.tags,a));const o=ND(a,i,e);o.length>0&&(e.indentAtStart=(e.indentAtStart??0)+o.length+1);const l=typeof i.stringify=="function"?i.stringify(a,e,s,n):Oe(a)?nc(a,e,s,n):a.toString(e,s,n);return o?Oe(a)||l[0]==="{"||l[0]==="["?`${o} ${l}`:`${o}
${e.indent}${l}`:l}function SD({key:t,value:e},s,n,i){const{allNullValues:a,doc:o,indent:l,indentStep:c,options:{commentString:u,indentSeq:d,simpleKeys:h}}=s;let f=nt(t)&&t.comment||null;if(h){if(f)throw new Error("With simple keys, key nodes cannot have comments");if(Xe(t)||!nt(t)&&typeof t=="object"){const k="With simple keys, collection cannot be used as a key value";throw new Error(k)}}let m=!h&&(!t||f&&e==null&&!s.inFlow||Xe(t)||(Oe(t)?t.type===fe.BLOCK_FOLDED||t.type===fe.BLOCK_LITERAL:typeof t=="object"));s=Object.assign({},s,{allNullValues:!1,implicitKey:!m&&(h||!a),indent:l+c});let p=!1,x=!1,g=Ja(t,s,()=>p=!0,()=>x=!0);if(!m&&!s.inFlow&&g.length>1024){if(h)throw new Error("With simple keys, single line scalar must not span more than 1024 characters");m=!0}if(s.inFlow){if(a||e==null)return p&&n&&n(),g===""?"?":m?`? ${g}`:g}else if(a&&!h||e==null&&m)return g=`? ${g}`,f&&!p?g+=yi(g,s.indent,u(f)):x&&i&&i(),g;p&&(f=null),m?(f&&(g+=yi(g,s.indent,u(f))),g=`? ${g}
${l}:`):(g=`${g}:`,f&&(g+=yi(g,s.indent,u(f))));let y,b,w;nt(e)?(y=!!e.spaceBefore,b=e.commentBefore,w=e.comment):(y=!1,b=null,w=null,e&&typeof e=="object"&&(e=o.createNode(e))),s.implicitKey=!1,!m&&!f&&Oe(e)&&(s.indentAtStart=g.length+1),x=!1,!d&&c.length>=2&&!s.inFlow&&!m&&po(e)&&!e.flow&&!e.tag&&!e.anchor&&(s.indent=s.indent.substring(2));let S=!1;const z=Ja(e,s,()=>S=!0,()=>x=!0);let N=" ";if(f||y||b){if(N=y?`
`:"",b){const k=u(b);N+=`
${sr(k,s.indent)}`}z===""&&!s.inFlow?N===`
`&&(N=`

`):N+=`
${s.indent}`}else if(!m&&Xe(e)){const k=z[0],C=z.indexOf(`
`),T=C!==-1,v=s.inFlow??e.flow??e.items.length===0;if(T||!v){let _=!1;if(T&&(k==="&"||k==="!")){let A=z.indexOf(" ");k==="&"&&A!==-1&&A<C&&z[A+1]==="!"&&(A=z.indexOf(" ",A+1)),(A===-1||C<A)&&(_=!0)}_||(N=`
${s.indent}`)}}else(z===""||z[0]===`
`)&&(N="");return g+=N+z,s.inFlow?S&&n&&n():w&&!S?g+=yi(g,s.indent,u(w)):x&&i&&i(),g}function Jv(t,e){(t==="debug"||t==="warn")&&console.warn(e)}const _c="<<",rr={identify:t=>t===_c||typeof t=="symbol"&&t.description===_c,default:"key",tag:"tag:yaml.org,2002:merge",test:/^<<$/,resolve:()=>Object.assign(new fe(Symbol(_c)),{addToJSMap:Zv}),stringify:()=>_c},CD=(t,e)=>(rr.identify(e)||Oe(e)&&(!e.type||e.type===fe.PLAIN)&&rr.identify(e.value))&&t?.doc.schema.tags.some(s=>s.tag===rr.tag&&s.default);function Zv(t,e,s){if(s=t&&ai(s)?s.resolve(t.doc):s,po(s))for(const n of s.items)rf(t,e,n);else if(Array.isArray(s))for(const n of s)rf(t,e,n);else rf(t,e,s)}function rf(t,e,s){const n=t&&ai(s)?s.resolve(t.doc):s;if(!mo(n))throw new Error("Merge sources must be maps or map aliases");const i=n.toJSON(null,t,Map);for(const[a,o]of i)e instanceof Map?e.has(a)||e.set(a,o):e instanceof Set?e.add(a):Object.prototype.hasOwnProperty.call(e,a)||Object.defineProperty(e,a,{value:o,writable:!0,enumerable:!0,configurable:!0});return e}function Qv(t,e,{key:s,value:n}){if(nt(s)&&s.addToJSMap)s.addToJSMap(t,e,n);else if(CD(t,s))Zv(t,e,n);else{const i=Js(s,"",t);if(e instanceof Map)e.set(i,Js(n,i,t));else if(e instanceof Set)e.add(i);else{const a=zD(s,i,t),o=Js(n,a,t);a in e?Object.defineProperty(e,a,{value:o,writable:!0,enumerable:!0,configurable:!0}):e[a]=o}}return e}function zD(t,e,s){if(e===null)return"";if(typeof e!="object")return String(e);if(nt(t)&&s?.doc){const n=Gv(s.doc,{});n.anchors=new Set;for(const a of s.anchors.keys())n.anchors.add(a.anchor);n.inFlow=!0,n.inStringifyKey=!0;const i=t.toString(n);if(!s.mapKeyWarned){let a=JSON.stringify(i);a.length>40&&(a=a.substring(0,36)+'..."'),Jv(s.doc.options.logLevel,`Keys with collection values will be stringified due to JS Object restrictions: ${a}. Set mapAsMap: true to use object keys.`),s.mapKeyWarned=!0}return i}return JSON.stringify(e)}function cx(t,e,s){const n=vl(t,void 0,s),i=vl(e,void 0,s);return new Gt(n,i)}class Gt{constructor(e,s=null){Object.defineProperty(this,nn,{value:Ov}),this.key=e,this.value=s}clone(e){let{key:s,value:n}=this;return nt(s)&&(s=s.clone(e)),nt(n)&&(n=n.clone(e)),new Gt(s,n)}toJSON(e,s){const n=s?.mapAsMap?new Map:{};return Qv(s,n,this)}toString(e,s,n){return e?.doc?SD(this,e,s,n):JSON.stringify(this)}}function Yv(t,e,s){return(e.inFlow??t.flow?AD:_D)(t,e,s)}function _D({comment:t,items:e},s,{blockItemPrefix:n,flowChars:i,itemIndent:a,onChompKeep:o,onComment:l}){const{indent:c,options:{commentString:u}}=s,d=Object.assign({},s,{indent:a,type:null});let h=!1;const f=[];for(let p=0;p<e.length;++p){const x=e[p];let g=null;if(nt(x))!h&&x.spaceBefore&&f.push(""),Au(s,f,x.commentBefore,h),x.comment&&(g=x.comment);else if(Qe(x)){const b=nt(x.key)?x.key:null;b&&(!h&&b.spaceBefore&&f.push(""),Au(s,f,b.commentBefore,h))}h=!1;let y=Ja(x,d,()=>g=null,()=>h=!0);g&&(y+=yi(y,a,u(g))),h&&g&&(h=!1),f.push(n+y)}let m;if(f.length===0)m=i.start+i.end;else{m=f[0];for(let p=1;p<f.length;++p){const x=f[p];m+=x?`
${c}${x}`:`
`}}return t?(m+=`
`+sr(u(t),c),l&&l()):h&&o&&o(),m}function AD({items:t},e,{flowChars:s,itemIndent:n}){const{indent:i,indentStep:a,flowCollectionPadding:o,options:{commentString:l}}=e;n+=a;const c=Object.assign({},e,{indent:n,inFlow:!0,type:null});let u=!1,d=0;const h=[];for(let p=0;p<t.length;++p){const x=t[p];let g=null;if(nt(x))x.spaceBefore&&h.push(""),Au(e,h,x.commentBefore,!1),x.comment&&(g=x.comment);else if(Qe(x)){const b=nt(x.key)?x.key:null;b&&(b.spaceBefore&&h.push(""),Au(e,h,b.commentBefore,!1),b.comment&&(u=!0));const w=nt(x.value)?x.value:null;w?(w.comment&&(g=w.comment),w.commentBefore&&(u=!0)):x.value==null&&b?.comment&&(g=b.comment)}g&&(u=!0);let y=Ja(x,c,()=>g=null);p<t.length-1&&(y+=","),g&&(y+=yi(y,n,l(g))),!u&&(h.length>d||y.includes(`
`))&&(u=!0),h.push(y),d=h.length}const{start:f,end:m}=s;if(h.length===0)return f+m;if(!u){const p=h.reduce((x,g)=>x+g.length+2,2);u=e.options.lineWidth>0&&p>e.options.lineWidth}if(u){let p=f;for(const x of h)p+=x?`
${a}${i}${x}`:`
`;return`${p}
${i}${m}`}else return`${f}${o}${h.join(" ")}${o}${m}`}function Au({indent:t,options:{commentString:e}},s,n,i){if(n&&i&&(n=n.replace(/^\n+/,"")),n){const a=sr(e(n),t);s.push(a.trimStart())}}function bi(t,e){const s=Oe(e)?e.value:e;for(const n of t)if(Qe(n)&&(n.key===e||n.key===s||Oe(n.key)&&n.key.value===s))return n}class As extends Kv{static get tagName(){return"tag:yaml.org,2002:map"}constructor(e){super(Ur,e),this.items=[]}static from(e,s,n){const{keepUndefined:i,replacer:a}=n,o=new this(e),l=(c,u)=>{if(typeof a=="function")u=a.call(s,c,u);else if(Array.isArray(a)&&!a.includes(c))return;(u!==void 0||i)&&o.items.push(cx(c,u,n))};if(s instanceof Map)for(const[c,u]of s)l(c,u);else if(s&&typeof s=="object")for(const c of Object.keys(s))l(c,s[c]);return typeof e.sortMapEntries=="function"&&o.items.sort(e.sortMapEntries),o}add(e,s){let n;Qe(e)?n=e:!e||typeof e!="object"||!("key"in e)?n=new Gt(e,e?.value):n=new Gt(e.key,e.value);const i=bi(this.items,n.key),a=this.schema?.sortMapEntries;if(i){if(!s)throw new Error(`Key ${n.key} already set`);Oe(i.value)&&Wv(n.value)?i.value.value=n.value:i.value=n.value}else if(a){const o=this.items.findIndex(l=>a(n,l)<0);o===-1?this.items.push(n):this.items.splice(o,0,n)}else this.items.push(n)}delete(e){const s=bi(this.items,e);return s?this.items.splice(this.items.indexOf(s),1).length>0:!1}get(e,s){const i=bi(this.items,e)?.value;return(!s&&Oe(i)?i.value:i)??void 0}has(e){return!!bi(this.items,e)}set(e,s){this.add(new Gt(e,s),!0)}toJSON(e,s,n){const i=n?new n:s?.mapAsMap?new Map:{};s?.onCreate&&s.onCreate(i);for(const a of this.items)Qv(s,i,a);return i}toString(e,s,n){if(!e)return JSON.stringify(this);for(const i of this.items)if(!Qe(i))throw new Error(`Map items must all be pairs; found ${JSON.stringify(i)} instead`);return!e.allNullValues&&this.hasAllNullValues(!1)&&(e=Object.assign({},e,{allNullValues:!0})),Yv(this,e,{blockItemPrefix:"",flowChars:{start:"{",end:"}"},itemIndent:e.indent||"",onChompKeep:n,onComment:s})}}const xo={collection:"map",default:!0,nodeClass:As,tag:"tag:yaml.org,2002:map",resolve(t,e){return mo(t)||e("Expected a mapping for this tag"),t},createNode:(t,e,s)=>As.from(t,e,s)};class Qr extends Kv{static get tagName(){return"tag:yaml.org,2002:seq"}constructor(e){super(fo,e),this.items=[]}add(e){this.items.push(e)}delete(e){const s=Ac(e);return typeof s!="number"?!1:this.items.splice(s,1).length>0}get(e,s){const n=Ac(e);if(typeof n!="number")return;const i=this.items[n];return!s&&Oe(i)?i.value:i}has(e){const s=Ac(e);return typeof s=="number"&&s<this.items.length}set(e,s){const n=Ac(e);if(typeof n!="number")throw new Error(`Expected a valid index, not ${e}.`);const i=this.items[n];Oe(i)&&Wv(s)?i.value=s:this.items[n]=s}toJSON(e,s){const n=[];s?.onCreate&&s.onCreate(n);let i=0;for(const a of this.items)n.push(Js(a,String(i++),s));return n}toString(e,s,n){return e?Yv(this,e,{blockItemPrefix:"- ",flowChars:{start:"[",end:"]"},itemIndent:(e.indent||"")+"  ",onChompKeep:n,onComment:s}):JSON.stringify(this)}static from(e,s,n){const{replacer:i}=n,a=new this(e);if(s&&Symbol.iterator in Object(s)){let o=0;for(let l of s){if(typeof i=="function"){const c=s instanceof Set?l:String(o++);l=i.call(s,c,l)}a.items.push(vl(l,void 0,n))}}return a}}function Ac(t){let e=Oe(t)?t.value:t;return e&&typeof e=="string"&&(e=Number(e)),typeof e=="number"&&Number.isInteger(e)&&e>=0?e:null}const go={collection:"seq",default:!0,nodeClass:Qr,tag:"tag:yaml.org,2002:seq",resolve(t,e){return po(t)||e("Expected a sequence for this tag"),t},createNode:(t,e,s)=>Qr.from(t,e,s)},ih={identify:t=>typeof t=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:t=>t,stringify(t,e,s,n){return e=Object.assign({actualString:!0},e),nc(t,e,s,n)}},ah={identify:t=>t==null,createNode:()=>new fe(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:()=>new fe(null),stringify:({source:t},e)=>typeof t=="string"&&ah.test.test(t)?t:e.options.nullStr},ux={identify:t=>typeof t=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,resolve:t=>new fe(t[0]==="t"||t[0]==="T"),stringify({source:t,value:e},s){if(t&&ux.test.test(t)){const n=t[0]==="t"||t[0]==="T";if(e===n)return t}return e?s.options.trueStr:s.options.falseStr}};function yn({format:t,minFractionDigits:e,tag:s,value:n}){if(typeof n=="bigint")return String(n);const i=typeof n=="number"?n:Number(n);if(!isFinite(i))return isNaN(i)?".nan":i<0?"-.inf":".inf";let a=JSON.stringify(n);if(!t&&e&&(!s||s==="tag:yaml.org,2002:float")&&/^\d/.test(a)){let o=a.indexOf(".");o<0&&(o=a.length,a+=".");let l=e-(a.length-o-1);for(;l-- >0;)a+="0"}return a}const Xv={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:t=>t.slice(-3).toLowerCase()==="nan"?NaN:t[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:yn},ek={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:\.[0-9]+|[0-9]+(?:\.[0-9]*)?)[eE][-+]?[0-9]+$/,resolve:t=>parseFloat(t),stringify(t){const e=Number(t.value);return isFinite(e)?e.toExponential():yn(t)}},tk={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:\.[0-9]+|[0-9]+\.[0-9]*)$/,resolve(t){const e=new fe(parseFloat(t)),s=t.indexOf(".");return s!==-1&&t[t.length-1]==="0"&&(e.minFractionDigits=t.length-s-1),e},stringify:yn},oh=t=>typeof t=="bigint"||Number.isInteger(t),dx=(t,e,s,{intAsBigInt:n})=>n?BigInt(t):parseInt(t.substring(e),s);function sk(t,e,s){const{value:n}=t;return oh(n)&&n>=0?s+n.toString(e):yn(t)}const nk={identify:t=>oh(t)&&t>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^0o[0-7]+$/,resolve:(t,e,s)=>dx(t,2,8,s),stringify:t=>sk(t,8,"0o")},rk={identify:oh,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9]+$/,resolve:(t,e,s)=>dx(t,0,10,s),stringify:yn},ik={identify:t=>oh(t)&&t>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^0x[0-9a-fA-F]+$/,resolve:(t,e,s)=>dx(t,2,16,s),stringify:t=>sk(t,16,"0x")},TD=[xo,go,ih,ah,ux,nk,rk,ik,Xv,ek,tk];function K0(t){return typeof t=="bigint"||Number.isInteger(t)}const Tc=({value:t})=>JSON.stringify(t),ED=[{identify:t=>typeof t=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:t=>t,stringify:Tc},{identify:t=>t==null,createNode:()=>new fe(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^null$/,resolve:()=>null,stringify:Tc},{identify:t=>typeof t=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^true$|^false$/,resolve:t=>t==="true",stringify:Tc},{identify:K0,default:!0,tag:"tag:yaml.org,2002:int",test:/^-?(?:0|[1-9][0-9]*)$/,resolve:(t,e,{intAsBigInt:s})=>s?BigInt(t):parseInt(t,10),stringify:({value:t})=>K0(t)?t.toString():JSON.stringify(t)},{identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^-?(?:0|[1-9][0-9]*)(?:\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,resolve:t=>parseFloat(t),stringify:Tc}],DD={default:!0,tag:"",test:/^/,resolve(t,e){return e(`Unresolved plain scalar ${JSON.stringify(t)}`),t}},MD=[xo,go].concat(ED,DD),hx={identify:t=>t instanceof Uint8Array,default:!1,tag:"tag:yaml.org,2002:binary",resolve(t,e){if(typeof atob=="function"){const s=atob(t.replace(/[\n\r]/g,"")),n=new Uint8Array(s.length);for(let i=0;i<s.length;++i)n[i]=s.charCodeAt(i);return n}else return e("This environment does not support reading binary tags; either Buffer or atob is required"),t},stringify({comment:t,type:e,value:s},n,i,a){if(!s)return"";const o=s;let l;if(typeof btoa=="function"){let c="";for(let u=0;u<o.length;++u)c+=String.fromCharCode(o[u]);l=btoa(c)}else throw new Error("This environment does not support writing binary tags; either Buffer or btoa is required");if(e??(e=fe.BLOCK_LITERAL),e!==fe.QUOTE_DOUBLE){const c=Math.max(n.options.lineWidth-n.indent.length,n.options.minContentWidth),u=Math.ceil(l.length/c),d=new Array(u);for(let h=0,f=0;h<u;++h,f+=c)d[h]=l.substr(f,c);l=d.join(e===fe.BLOCK_LITERAL?`
`:" ")}return nc({comment:t,type:e,value:l},n,i,a)}};function ak(t,e){if(po(t))for(let s=0;s<t.items.length;++s){let n=t.items[s];if(!Qe(n)){if(mo(n)){n.items.length>1&&e("Each pair must have its own sequence indicator");const i=n.items[0]||new Gt(new fe(null));if(n.commentBefore&&(i.key.commentBefore=i.key.commentBefore?`${n.commentBefore}
${i.key.commentBefore}`:n.commentBefore),n.comment){const a=i.value??i.key;a.comment=a.comment?`${n.comment}
${a.comment}`:n.comment}n=i}t.items[s]=Qe(n)?n:new Gt(n)}}else e("Expected a sequence for this tag");return t}function ok(t,e,s){const{replacer:n}=s,i=new Qr(t);i.tag="tag:yaml.org,2002:pairs";let a=0;if(e&&Symbol.iterator in Object(e))for(let o of e){typeof n=="function"&&(o=n.call(e,String(a++),o));let l,c;if(Array.isArray(o))if(o.length===2)l=o[0],c=o[1];else throw new TypeError(`Expected [key, value] tuple: ${o}`);else if(o&&o instanceof Object){const u=Object.keys(o);if(u.length===1)l=u[0],c=o[l];else throw new TypeError(`Expected tuple with one key, not ${u.length} keys`)}else l=o;i.items.push(cx(l,c,s))}return i}const fx={collection:"seq",default:!1,tag:"tag:yaml.org,2002:pairs",resolve:ak,createNode:ok};class Pa extends Qr{constructor(){super(),this.add=As.prototype.add.bind(this),this.delete=As.prototype.delete.bind(this),this.get=As.prototype.get.bind(this),this.has=As.prototype.has.bind(this),this.set=As.prototype.set.bind(this),this.tag=Pa.tag}toJSON(e,s){if(!s)return super.toJSON(e);const n=new Map;s?.onCreate&&s.onCreate(n);for(const i of this.items){let a,o;if(Qe(i)?(a=Js(i.key,"",s),o=Js(i.value,a,s)):a=Js(i,"",s),n.has(a))throw new Error("Ordered maps must not include duplicate keys");n.set(a,o)}return n}static from(e,s,n){const i=ok(e,s,n),a=new this;return a.items=i.items,a}}Pa.tag="tag:yaml.org,2002:omap";const mx={collection:"seq",identify:t=>t instanceof Map,nodeClass:Pa,default:!1,tag:"tag:yaml.org,2002:omap",resolve(t,e){const s=ak(t,e),n=[];for(const{key:i}of s.items)Oe(i)&&(n.includes(i.value)?e(`Ordered maps must not include duplicate keys: ${i.value}`):n.push(i.value));return Object.assign(new Pa,s)},createNode:(t,e,s)=>Pa.from(t,e,s)};function lk({value:t,source:e},s){return e&&(t?ck:uk).test.test(e)?e:t?s.options.trueStr:s.options.falseStr}const ck={identify:t=>t===!0,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,resolve:()=>new fe(!0),stringify:lk},uk={identify:t=>t===!1,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/,resolve:()=>new fe(!1),stringify:lk},PD={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:t=>t.slice(-3).toLowerCase()==="nan"?NaN:t[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:yn},ID={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:[0-9][0-9_]*)?(?:\.[0-9_]*)?[eE][-+]?[0-9]+$/,resolve:t=>parseFloat(t.replace(/_/g,"")),stringify(t){const e=Number(t.value);return isFinite(e)?e.toExponential():yn(t)}},OD={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:[0-9][0-9_]*)?\.[0-9_]*$/,resolve(t){const e=new fe(parseFloat(t.replace(/_/g,""))),s=t.indexOf(".");if(s!==-1){const n=t.substring(s+1).replace(/_/g,"");n[n.length-1]==="0"&&(e.minFractionDigits=n.length)}return e},stringify:yn},rc=t=>typeof t=="bigint"||Number.isInteger(t);function lh(t,e,s,{intAsBigInt:n}){const i=t[0];if((i==="-"||i==="+")&&(e+=1),t=t.substring(e).replace(/_/g,""),n){switch(s){case 2:t=`0b${t}`;break;case 8:t=`0o${t}`;break;case 16:t=`0x${t}`;break}const o=BigInt(t);return i==="-"?BigInt(-1)*o:o}const a=parseInt(t,s);return i==="-"?-1*a:a}function px(t,e,s){const{value:n}=t;if(rc(n)){const i=n.toString(e);return n<0?"-"+s+i.substr(1):s+i}return yn(t)}const RD={identify:rc,default:!0,tag:"tag:yaml.org,2002:int",format:"BIN",test:/^[-+]?0b[0-1_]+$/,resolve:(t,e,s)=>lh(t,2,2,s),stringify:t=>px(t,2,"0b")},LD={identify:rc,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^[-+]?0[0-7_]+$/,resolve:(t,e,s)=>lh(t,1,8,s),stringify:t=>px(t,8,"0")},FD={identify:rc,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9][0-9_]*$/,resolve:(t,e,s)=>lh(t,0,10,s),stringify:yn},$D={identify:rc,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^[-+]?0x[0-9a-fA-F_]+$/,resolve:(t,e,s)=>lh(t,2,16,s),stringify:t=>px(t,16,"0x")};class Ia extends As{constructor(e){super(e),this.tag=Ia.tag}add(e){let s;Qe(e)?s=e:e&&typeof e=="object"&&"key"in e&&"value"in e&&e.value===null?s=new Gt(e.key,null):s=new Gt(e,null),bi(this.items,s.key)||this.items.push(s)}get(e,s){const n=bi(this.items,e);return!s&&Qe(n)?Oe(n.key)?n.key.value:n.key:n}set(e,s){if(typeof s!="boolean")throw new Error(`Expected boolean value for set(key, value) in a YAML set, not ${typeof s}`);const n=bi(this.items,e);n&&!s?this.items.splice(this.items.indexOf(n),1):!n&&s&&this.items.push(new Gt(e))}toJSON(e,s){return super.toJSON(e,s,Set)}toString(e,s,n){if(!e)return JSON.stringify(this);if(this.hasAllNullValues(!0))return super.toString(Object.assign({},e,{allNullValues:!0}),s,n);throw new Error("Set items must all have null values")}static from(e,s,n){const{replacer:i}=n,a=new this(e);if(s&&Symbol.iterator in Object(s))for(let o of s)typeof i=="function"&&(o=i.call(s,o,o)),a.items.push(cx(o,null,n));return a}}Ia.tag="tag:yaml.org,2002:set";const xx={collection:"map",identify:t=>t instanceof Set,nodeClass:Ia,default:!1,tag:"tag:yaml.org,2002:set",createNode:(t,e,s)=>Ia.from(t,e,s),resolve(t,e){if(mo(t)){if(t.hasAllNullValues(!0))return Object.assign(new Ia,t);e("Set items must all have null values")}else e("Expected a mapping for this tag");return t}};function gx(t,e){const s=t[0],n=s==="-"||s==="+"?t.substring(1):t,i=o=>e?BigInt(o):Number(o),a=n.replace(/_/g,"").split(":").reduce((o,l)=>o*i(60)+i(l),i(0));return s==="-"?i(-1)*a:a}function dk(t){let{value:e}=t,s=o=>o;if(typeof e=="bigint")s=o=>BigInt(o);else if(isNaN(e)||!isFinite(e))return yn(t);let n="";e<0&&(n="-",e*=s(-1));const i=s(60),a=[e%i];return e<60?a.unshift(0):(e=(e-a[0])/i,a.unshift(e%i),e>=60&&(e=(e-a[0])/i,a.unshift(e))),n+a.map(o=>String(o).padStart(2,"0")).join(":").replace(/000000\d*$/,"")}const hk={identify:t=>typeof t=="bigint"||Number.isInteger(t),default:!0,tag:"tag:yaml.org,2002:int",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,resolve:(t,e,{intAsBigInt:s})=>gx(t,s),stringify:dk},fk={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\.[0-9_]*$/,resolve:t=>gx(t,!1),stringify:dk},ch={identify:t=>t instanceof Date,default:!0,tag:"tag:yaml.org,2002:timestamp",test:RegExp("^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})(?:(?:t|T|[ \\t]+)([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\.[0-9]+)?)(?:[ \\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?)?$"),resolve(t){const e=t.match(ch.test);if(!e)throw new Error("!!timestamp expects a date, starting with yyyy-mm-dd");const[,s,n,i,a,o,l]=e.map(Number),c=e[7]?Number((e[7]+"00").substr(1,3)):0;let u=Date.UTC(s,n-1,i,a||0,o||0,l||0,c);const d=e[8];if(d&&d!=="Z"){let h=gx(d,!1);Math.abs(h)<30&&(h*=60),u-=6e4*h}return new Date(u)},stringify:({value:t})=>t?.toISOString().replace(/(T00:00:00)?\.000Z$/,"")??""},H0=[xo,go,ih,ah,ck,uk,RD,LD,FD,$D,PD,ID,OD,hx,rr,mx,fx,xx,hk,fk,ch],G0=new Map([["core",TD],["failsafe",[xo,go,ih]],["json",MD],["yaml11",H0],["yaml-1.1",H0]]),J0={binary:hx,bool:ux,float:tk,floatExp:ek,floatNaN:Xv,floatTime:fk,int:rk,intHex:ik,intOct:nk,intTime:hk,map:xo,merge:rr,null:ah,omap:mx,pairs:fx,seq:go,set:xx,timestamp:ch},BD={"tag:yaml.org,2002:binary":hx,"tag:yaml.org,2002:merge":rr,"tag:yaml.org,2002:omap":mx,"tag:yaml.org,2002:pairs":fx,"tag:yaml.org,2002:set":xx,"tag:yaml.org,2002:timestamp":ch};function af(t,e,s){const n=G0.get(e);if(n&&!t)return s&&!n.includes(rr)?n.concat(rr):n.slice();let i=n;if(!i)if(Array.isArray(t))i=[];else{const a=Array.from(G0.keys()).filter(o=>o!=="yaml11").map(o=>JSON.stringify(o)).join(", ");throw new Error(`Unknown schema "${e}"; use one of ${a} or define customTags array`)}if(Array.isArray(t))for(const a of t)i=i.concat(a);else typeof t=="function"&&(i=t(i.slice()));return s&&(i=i.concat(rr)),i.reduce((a,o)=>{const l=typeof o=="string"?J0[o]:o;if(!l){const c=JSON.stringify(o),u=Object.keys(J0).map(d=>JSON.stringify(d)).join(", ");throw new Error(`Unknown custom tag ${c}; use one of ${u}`)}return a.includes(l)||a.push(l),a},[])}const qD=(t,e)=>t.key<e.key?-1:t.key>e.key?1:0;let mk=class pk{constructor({compat:e,customTags:s,merge:n,resolveKnownTags:i,schema:a,sortMapEntries:o,toStringDefaults:l}){this.compat=Array.isArray(e)?af(e,"compat"):e?af(null,e):null,this.name=typeof a=="string"&&a||"core",this.knownTags=i?BD:{},this.tags=af(s,this.name,n),this.toStringOptions=l??null,Object.defineProperty(this,Ur,{value:xo}),Object.defineProperty(this,On,{value:ih}),Object.defineProperty(this,fo,{value:go}),this.sortMapEntries=typeof o=="function"?o:o===!0?qD:null}clone(){const e=Object.create(pk.prototype,Object.getOwnPropertyDescriptors(this));return e.tags=this.tags.slice(),e}};function VD(t,e){const s=[];let n=e.directives===!0;if(e.directives!==!1&&t.directives){const c=t.directives.toString(t);c?(s.push(c),n=!0):t.directives.docStart&&(n=!0)}n&&s.push("---");const i=Gv(t,e),{commentString:a}=i.options;if(t.commentBefore){s.length!==1&&s.unshift("");const c=a(t.commentBefore);s.unshift(sr(c,""))}let o=!1,l=null;if(t.contents){if(nt(t.contents)){if(t.contents.spaceBefore&&n&&s.push(""),t.contents.commentBefore){const d=a(t.contents.commentBefore);s.push(sr(d,""))}i.forceBlockIndent=!!t.comment,l=t.contents.comment}const c=l?void 0:()=>o=!0;let u=Ja(t.contents,i,()=>l=null,c);l&&(u+=yi(u,"",a(l))),(u[0]==="|"||u[0]===">")&&s[s.length-1]==="---"?s[s.length-1]=`--- ${u}`:s.push(u)}else s.push(Ja(t.contents,i));if(t.directives?.docEnd)if(t.comment){const c=a(t.comment);c.includes(`
`)?(s.push("..."),s.push(sr(c,""))):s.push(`... ${c}`)}else s.push("...");else{let c=t.comment;c&&o&&(c=c.replace(/^\n+/,"")),c&&((!o||l)&&s[s.length-1]!==""&&s.push(""),s.push(sr(a(c),"")))}return s.join(`
`)+`
`}let uh=class xk{constructor(e,s,n){this.commentBefore=null,this.comment=null,this.errors=[],this.warnings=[],Object.defineProperty(this,nn,{value:Nm});let i=null;typeof s=="function"||Array.isArray(s)?i=s:n===void 0&&s&&(n=s,s=void 0);const a=Object.assign({intAsBigInt:!1,keepSourceTokens:!1,logLevel:"warn",prettyErrors:!0,strict:!0,stringKeys:!1,uniqueKeys:!0,version:"1.2"},n);this.options=a;let{version:o}=a;n?._directives?(this.directives=n._directives.atDocument(),this.directives.yaml.explicit&&(o=this.directives.yaml.version)):this.directives=new ns({version:o}),this.setSchema(o,n),this.contents=e===void 0?null:this.createNode(e,i,n)}clone(){const e=Object.create(xk.prototype,{[nn]:{value:Nm}});return e.commentBefore=this.commentBefore,e.comment=this.comment,e.errors=this.errors.slice(),e.warnings=this.warnings.slice(),e.options=Object.assign({},this.options),this.directives&&(e.directives=this.directives.clone()),e.schema=this.schema.clone(),e.contents=nt(this.contents)?this.contents.clone(e.schema):this.contents,this.range&&(e.range=this.range.slice()),e}add(e){la(this.contents)&&this.contents.add(e)}addIn(e,s){la(this.contents)&&this.contents.addIn(e,s)}createAlias(e,s){if(!e.anchor){const n=Vv(this);e.anchor=!s||n.has(s)?Uv(s||"a",n):s}return new th(e.anchor)}createNode(e,s,n){let i;if(typeof s=="function")e=s.call({"":e},"",e),i=s;else if(Array.isArray(s)){const g=b=>typeof b=="number"||b instanceof String||b instanceof Number,y=s.filter(g).map(String);y.length>0&&(s=s.concat(y)),i=s}else n===void 0&&s&&(n=s,s=void 0);const{aliasDuplicateObjects:a,anchorPrefix:o,flow:l,keepUndefined:c,onTagObj:u,tag:d}=n??{},{onAnchor:h,setAnchors:f,sourceObjects:m}=gD(this,o||"a"),p={aliasDuplicateObjects:a??!0,keepUndefined:c??!1,onAnchor:h,onTagObj:u,replacer:i,schema:this.schema,sourceObjects:m},x=vl(e,d,p);return l&&Xe(x)&&(x.flow=!0),f(),x}createPair(e,s,n={}){const i=this.createNode(e,null,n),a=this.createNode(s,null,n);return new Gt(i,a)}delete(e){return la(this.contents)?this.contents.delete(e):!1}deleteIn(e){return qo(e)?this.contents==null?!1:(this.contents=null,!0):la(this.contents)?this.contents.deleteIn(e):!1}get(e,s){return Xe(this.contents)?this.contents.get(e,s):void 0}getIn(e,s){return qo(e)?!s&&Oe(this.contents)?this.contents.value:this.contents:Xe(this.contents)?this.contents.getIn(e,s):void 0}has(e){return Xe(this.contents)?this.contents.has(e):!1}hasIn(e){return qo(e)?this.contents!==void 0:Xe(this.contents)?this.contents.hasIn(e):!1}set(e,s){this.contents==null?this.contents=_u(this.schema,[e],s):la(this.contents)&&this.contents.set(e,s)}setIn(e,s){qo(e)?this.contents=s:this.contents==null?this.contents=_u(this.schema,Array.from(e),s):la(this.contents)&&this.contents.setIn(e,s)}setSchema(e,s={}){typeof e=="number"&&(e=String(e));let n;switch(e){case"1.1":this.directives?this.directives.yaml.version="1.1":this.directives=new ns({version:"1.1"}),n={resolveKnownTags:!1,schema:"yaml-1.1"};break;case"1.2":case"next":this.directives?this.directives.yaml.version=e:this.directives=new ns({version:e}),n={resolveKnownTags:!0,schema:"core"};break;case null:this.directives&&delete this.directives,n=null;break;default:{const i=JSON.stringify(e);throw new Error(`Expected '1.1', '1.2' or null as first argument, but found: ${i}`)}}if(s.schema instanceof Object)this.schema=s.schema;else if(n)this.schema=new mk(Object.assign(n,s));else throw new Error("With a null YAML version, the { schema: Schema } option is required")}toJS({json:e,jsonArg:s,mapAsMap:n,maxAliasCount:i,onAnchor:a,reviver:o}={}){const l={anchors:new Map,doc:this,keep:!e,mapAsMap:n===!0,mapKeyWarned:!1,maxAliasCount:typeof i=="number"?i:100},c=Js(this.contents,s??"",l);if(typeof a=="function")for(const{count:u,res:d}of l.anchors.values())a(d,u);return typeof o=="function"?Na(o,{"":c},"",c):c}toJSON(e,s){return this.toJS({json:!0,jsonArg:e,mapAsMap:!1,onAnchor:s})}toString(e={}){if(this.errors.length>0)throw new Error("Document with errors cannot be stringified");if("indent"in e&&(!Number.isInteger(e.indent)||Number(e.indent)<=0)){const s=JSON.stringify(e.indent);throw new Error(`"indent" option must be a positive integer, not ${s}`)}return VD(this,e)}};function la(t){if(Xe(t))return!0;throw new Error("Expected a YAML collection as document contents")}class yx extends Error{constructor(e,s,n,i){super(),this.name=e,this.code=n,this.message=i,this.pos=s}}class ji extends yx{constructor(e,s,n){super("YAMLParseError",e,s,n)}}class gk extends yx{constructor(e,s,n){super("YAMLWarning",e,s,n)}}const Tu=(t,e)=>s=>{if(s.pos[0]===-1)return;s.linePos=s.pos.map(l=>e.linePos(l));const{line:n,col:i}=s.linePos[0];s.message+=` at line ${n}, column ${i}`;let a=i-1,o=t.substring(e.lineStarts[n-1],e.lineStarts[n]).replace(/[\n\r]+$/,"");if(a>=60&&o.length>80){const l=Math.min(a-39,o.length-79);o="…"+o.substring(l),a-=l-1}if(o.length>80&&(o=o.substring(0,79)+"…"),n>1&&/^ *$/.test(o.substring(0,a))){let l=t.substring(e.lineStarts[n-2],e.lineStarts[n-1]);l.length>80&&(l=l.substring(0,79)+`…
`),o=l+o}if(/[^ ]/.test(o)){let l=1;const c=s.linePos[1];c&&c.line===n&&c.col>i&&(l=Math.max(1,Math.min(c.col-i,80-a)));const u=" ".repeat(a)+"^".repeat(l);s.message+=`:

${o}
${u}
`}};function Za(t,{flow:e,indicator:s,next:n,offset:i,onError:a,parentIndent:o,startOnNewline:l}){let c=!1,u=l,d=l,h="",f="",m=!1,p=!1,x=null,g=null,y=null,b=null,w=null,S=null,z=null;for(const C of t)switch(p&&(C.type!=="space"&&C.type!=="newline"&&C.type!=="comma"&&a(C.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),p=!1),x&&(u&&C.type!=="comment"&&C.type!=="newline"&&a(x,"TAB_AS_INDENT","Tabs are not allowed as indentation"),x=null),C.type){case"space":!e&&(s!=="doc-start"||n?.type!=="flow-collection")&&C.source.includes("	")&&(x=C),d=!0;break;case"comment":{d||a(C,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const T=C.source.substring(1)||" ";h?h+=f+T:h=T,f="",u=!1;break}case"newline":u?h?h+=C.source:(!S||s!=="seq-item-ind")&&(c=!0):f+=C.source,u=!0,m=!0,(g||y)&&(b=C),d=!0;break;case"anchor":g&&a(C,"MULTIPLE_ANCHORS","A node can have at most one anchor"),C.source.endsWith(":")&&a(C.offset+C.source.length-1,"BAD_ALIAS","Anchor ending in : is ambiguous",!0),g=C,z??(z=C.offset),u=!1,d=!1,p=!0;break;case"tag":{y&&a(C,"MULTIPLE_TAGS","A node can have at most one tag"),y=C,z??(z=C.offset),u=!1,d=!1,p=!0;break}case s:(g||y)&&a(C,"BAD_PROP_ORDER",`Anchors and tags must be after the ${C.source} indicator`),S&&a(C,"UNEXPECTED_TOKEN",`Unexpected ${C.source} in ${e??"collection"}`),S=C,u=s==="seq-item-ind"||s==="explicit-key-ind",d=!1;break;case"comma":if(e){w&&a(C,"UNEXPECTED_TOKEN",`Unexpected , in ${e}`),w=C,u=!1,d=!1;break}default:a(C,"UNEXPECTED_TOKEN",`Unexpected ${C.type} token`),u=!1,d=!1}const N=t[t.length-1],k=N?N.offset+N.source.length:i;return p&&n&&n.type!=="space"&&n.type!=="newline"&&n.type!=="comma"&&(n.type!=="scalar"||n.source!=="")&&a(n.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),x&&(u&&x.indent<=o||n?.type==="block-map"||n?.type==="block-seq")&&a(x,"TAB_AS_INDENT","Tabs are not allowed as indentation"),{comma:w,found:S,spaceBefore:c,comment:h,hasNewline:m,anchor:g,tag:y,newlineAfterProp:b,end:k,start:z??k}}function kl(t){if(!t)return null;switch(t.type){case"alias":case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":if(t.source.includes(`
`))return!0;if(t.end){for(const e of t.end)if(e.type==="newline")return!0}return!1;case"flow-collection":for(const e of t.items){for(const s of e.start)if(s.type==="newline")return!0;if(e.sep){for(const s of e.sep)if(s.type==="newline")return!0}if(kl(e.key)||kl(e.value))return!0}return!1;default:return!0}}function _m(t,e,s){if(e?.type==="flow-collection"){const n=e.end[0];n.indent===t&&(n.source==="]"||n.source==="}")&&kl(e)&&s(n,"BAD_INDENT","Flow end indicator should be more indented than parent",!0)}}function yk(t,e,s){const{uniqueKeys:n}=t.options;if(n===!1)return!1;const i=typeof n=="function"?n:(a,o)=>a===o||Oe(a)&&Oe(o)&&a.value===o.value;return e.some(a=>i(a.key,s))}const Z0="All mapping items must start at the same column";function UD({composeNode:t,composeEmptyNode:e},s,n,i,a){const o=a?.nodeClass??As,l=new o(s.schema);s.atRoot&&(s.atRoot=!1);let c=n.offset,u=null;for(const d of n.items){const{start:h,key:f,sep:m,value:p}=d,x=Za(h,{indicator:"explicit-key-ind",next:f??m?.[0],offset:c,onError:i,parentIndent:n.indent,startOnNewline:!0}),g=!x.found;if(g){if(f&&(f.type==="block-seq"?i(c,"BLOCK_AS_IMPLICIT_KEY","A block sequence may not be used as an implicit map key"):"indent"in f&&f.indent!==n.indent&&i(c,"BAD_INDENT",Z0)),!x.anchor&&!x.tag&&!m){u=x.end,x.comment&&(l.comment?l.comment+=`
`+x.comment:l.comment=x.comment);continue}(x.newlineAfterProp||kl(f))&&i(f??h[h.length-1],"MULTILINE_IMPLICIT_KEY","Implicit keys need to be on a single line")}else x.found?.indent!==n.indent&&i(c,"BAD_INDENT",Z0);s.atKey=!0;const y=x.end,b=f?t(s,f,x,i):e(s,y,h,null,x,i);s.schema.compat&&_m(n.indent,f,i),s.atKey=!1,yk(s,l.items,b)&&i(y,"DUPLICATE_KEY","Map keys must be unique");const w=Za(m??[],{indicator:"map-value-ind",next:p,offset:b.range[2],onError:i,parentIndent:n.indent,startOnNewline:!f||f.type==="block-scalar"});if(c=w.end,w.found){g&&(p?.type==="block-map"&&!w.hasNewline&&i(c,"BLOCK_AS_IMPLICIT_KEY","Nested mappings are not allowed in compact mappings"),s.options.strict&&x.start<w.found.offset-1024&&i(b.range,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit block mapping key"));const S=p?t(s,p,w,i):e(s,c,m,null,w,i);s.schema.compat&&_m(n.indent,p,i),c=S.range[2];const z=new Gt(b,S);s.options.keepSourceTokens&&(z.srcToken=d),l.items.push(z)}else{g&&i(b.range,"MISSING_CHAR","Implicit map keys need to be followed by map values"),w.comment&&(b.comment?b.comment+=`
`+w.comment:b.comment=w.comment);const S=new Gt(b);s.options.keepSourceTokens&&(S.srcToken=d),l.items.push(S)}}return u&&u<c&&i(u,"IMPOSSIBLE","Map comment with trailing content"),l.range=[n.offset,c,u??c],l}function WD({composeNode:t,composeEmptyNode:e},s,n,i,a){const o=a?.nodeClass??Qr,l=new o(s.schema);s.atRoot&&(s.atRoot=!1),s.atKey&&(s.atKey=!1);let c=n.offset,u=null;for(const{start:d,value:h}of n.items){const f=Za(d,{indicator:"seq-item-ind",next:h,offset:c,onError:i,parentIndent:n.indent,startOnNewline:!0});if(!f.found)if(f.anchor||f.tag||h)h&&h.type==="block-seq"?i(f.end,"BAD_INDENT","All sequence items must start at the same column"):i(c,"MISSING_CHAR","Sequence item without - indicator");else{u=f.end,f.comment&&(l.comment=f.comment);continue}const m=h?t(s,h,f,i):e(s,f.end,d,null,f,i);s.schema.compat&&_m(n.indent,h,i),c=m.range[2],l.items.push(m)}return l.range=[n.offset,c,u??c],l}function ic(t,e,s,n){let i="";if(t){let a=!1,o="";for(const l of t){const{source:c,type:u}=l;switch(u){case"space":a=!0;break;case"comment":{s&&!a&&n(l,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const d=c.substring(1)||" ";i?i+=o+d:i=d,o="";break}case"newline":i&&(o+=c),a=!0;break;default:n(l,"UNEXPECTED_TOKEN",`Unexpected ${u} at node end`)}e+=c.length}}return{comment:i,offset:e}}const of="Block collections are not allowed within flow collections",lf=t=>t&&(t.type==="block-map"||t.type==="block-seq");function KD({composeNode:t,composeEmptyNode:e},s,n,i,a){const o=n.start.source==="{",l=o?"flow map":"flow sequence",c=a?.nodeClass??(o?As:Qr),u=new c(s.schema);u.flow=!0;const d=s.atRoot;d&&(s.atRoot=!1),s.atKey&&(s.atKey=!1);let h=n.offset+n.start.source.length;for(let g=0;g<n.items.length;++g){const y=n.items[g],{start:b,key:w,sep:S,value:z}=y,N=Za(b,{flow:l,indicator:"explicit-key-ind",next:w??S?.[0],offset:h,onError:i,parentIndent:n.indent,startOnNewline:!1});if(!N.found){if(!N.anchor&&!N.tag&&!S&&!z){g===0&&N.comma?i(N.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${l}`):g<n.items.length-1&&i(N.start,"UNEXPECTED_TOKEN",`Unexpected empty item in ${l}`),N.comment&&(u.comment?u.comment+=`
`+N.comment:u.comment=N.comment),h=N.end;continue}!o&&s.options.strict&&kl(w)&&i(w,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line")}if(g===0)N.comma&&i(N.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${l}`);else if(N.comma||i(N.start,"MISSING_CHAR",`Missing , between ${l} items`),N.comment){let k="";e:for(const C of b)switch(C.type){case"comma":case"space":break;case"comment":k=C.source.substring(1);break e;default:break e}if(k){let C=u.items[u.items.length-1];Qe(C)&&(C=C.value??C.key),C.comment?C.comment+=`
`+k:C.comment=k,N.comment=N.comment.substring(k.length+1)}}if(!o&&!S&&!N.found){const k=z?t(s,z,N,i):e(s,N.end,S,null,N,i);u.items.push(k),h=k.range[2],lf(z)&&i(k.range,"BLOCK_IN_FLOW",of)}else{s.atKey=!0;const k=N.end,C=w?t(s,w,N,i):e(s,k,b,null,N,i);lf(w)&&i(C.range,"BLOCK_IN_FLOW",of),s.atKey=!1;const T=Za(S??[],{flow:l,indicator:"map-value-ind",next:z,offset:C.range[2],onError:i,parentIndent:n.indent,startOnNewline:!1});if(T.found){if(!o&&!N.found&&s.options.strict){if(S)for(const A of S){if(A===T.found)break;if(A.type==="newline"){i(A,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line");break}}N.start<T.found.offset-1024&&i(T.found,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit flow sequence key")}}else z&&("source"in z&&z.source&&z.source[0]===":"?i(z,"MISSING_CHAR",`Missing space after : in ${l}`):i(T.start,"MISSING_CHAR",`Missing , or : between ${l} items`));const v=z?t(s,z,T,i):T.found?e(s,T.end,S,null,T,i):null;v?lf(z)&&i(v.range,"BLOCK_IN_FLOW",of):T.comment&&(C.comment?C.comment+=`
`+T.comment:C.comment=T.comment);const _=new Gt(C,v);if(s.options.keepSourceTokens&&(_.srcToken=y),o){const A=u;yk(s,A.items,C)&&i(k,"DUPLICATE_KEY","Map keys must be unique"),A.items.push(_)}else{const A=new As(s.schema);A.flow=!0,A.items.push(_);const E=(v??C).range;A.range=[C.range[0],E[1],E[2]],u.items.push(A)}h=v?v.range[2]:T.end}}const f=o?"}":"]",[m,...p]=n.end;let x=h;if(m&&m.source===f)x=m.offset+m.source.length;else{const g=l[0].toUpperCase()+l.substring(1),y=d?`${g} must end with a ${f}`:`${g} in block collection must be sufficiently indented and end with a ${f}`;i(h,d?"MISSING_CHAR":"BAD_INDENT",y),m&&m.source.length!==1&&p.unshift(m)}if(p.length>0){const g=ic(p,x,s.options.strict,i);g.comment&&(u.comment?u.comment+=`
`+g.comment:u.comment=g.comment),u.range=[n.offset,x,g.offset]}else u.range=[n.offset,x,x];return u}function cf(t,e,s,n,i,a){const o=s.type==="block-map"?UD(t,e,s,n,a):s.type==="block-seq"?WD(t,e,s,n,a):KD(t,e,s,n,a),l=o.constructor;return i==="!"||i===l.tagName?(o.tag=l.tagName,o):(i&&(o.tag=i),o)}function HD(t,e,s,n,i){const a=n.tag,o=a?e.directives.tagName(a.source,f=>i(a,"TAG_RESOLVE_FAILED",f)):null;if(s.type==="block-seq"){const{anchor:f,newlineAfterProp:m}=n,p=f&&a?f.offset>a.offset?f:a:f??a;p&&(!m||m.offset<p.offset)&&i(p,"MISSING_CHAR","Missing newline after block sequence props")}const l=s.type==="block-map"?"map":s.type==="block-seq"?"seq":s.start.source==="{"?"map":"seq";if(!a||!o||o==="!"||o===As.tagName&&l==="map"||o===Qr.tagName&&l==="seq")return cf(t,e,s,i,o);let c=e.schema.tags.find(f=>f.tag===o&&f.collection===l);if(!c){const f=e.schema.knownTags[o];if(f&&f.collection===l)e.schema.tags.push(Object.assign({},f,{default:!1})),c=f;else return f?i(a,"BAD_COLLECTION_TYPE",`${f.tag} used for ${l} collection, but expects ${f.collection??"scalar"}`,!0):i(a,"TAG_RESOLVE_FAILED",`Unresolved tag: ${o}`,!0),cf(t,e,s,i,o)}const u=cf(t,e,s,i,o,c),d=c.resolve?.(u,f=>i(a,"TAG_RESOLVE_FAILED",f),e.options)??u,h=nt(d)?d:new fe(d);return h.range=u.range,h.tag=o,c?.format&&(h.format=c.format),h}function bk(t,e,s){const n=e.offset,i=GD(e,t.options.strict,s);if(!i)return{value:"",type:null,comment:"",range:[n,n,n]};const a=i.mode===">"?fe.BLOCK_FOLDED:fe.BLOCK_LITERAL,o=e.source?JD(e.source):[];let l=o.length;for(let x=o.length-1;x>=0;--x){const g=o[x][1];if(g===""||g==="\r")l=x;else break}if(l===0){const x=i.chomp==="+"&&o.length>0?`
`.repeat(Math.max(1,o.length-1)):"";let g=n+i.length;return e.source&&(g+=e.source.length),{value:x,type:a,comment:i.comment,range:[n,g,g]}}let c=e.indent+i.indent,u=e.offset+i.length,d=0;for(let x=0;x<l;++x){const[g,y]=o[x];if(y===""||y==="\r")i.indent===0&&g.length>c&&(c=g.length);else{g.length<c&&s(u+g.length,"MISSING_CHAR","Block scalars with more-indented leading empty lines must use an explicit indentation indicator"),i.indent===0&&(c=g.length),d=x,c===0&&!t.atRoot&&s(u,"BAD_INDENT","Block scalar values in collections must be indented");break}u+=g.length+y.length+1}for(let x=o.length-1;x>=l;--x)o[x][0].length>c&&(l=x+1);let h="",f="",m=!1;for(let x=0;x<d;++x)h+=o[x][0].slice(c)+`
`;for(let x=d;x<l;++x){let[g,y]=o[x];u+=g.length+y.length+1;const b=y[y.length-1]==="\r";if(b&&(y=y.slice(0,-1)),y&&g.length<c){const S=`Block scalar lines must not be less indented than their ${i.indent?"explicit indentation indicator":"first line"}`;s(u-y.length-(b?2:1),"BAD_INDENT",S),g=""}a===fe.BLOCK_LITERAL?(h+=f+g.slice(c)+y,f=`
`):g.length>c||y[0]==="	"?(f===" "?f=`
`:!m&&f===`
`&&(f=`

`),h+=f+g.slice(c)+y,f=`
`,m=!0):y===""?f===`
`?h+=`
`:f=`
`:(h+=f+y,f=" ",m=!1)}switch(i.chomp){case"-":break;case"+":for(let x=l;x<o.length;++x)h+=`
`+o[x][0].slice(c);h[h.length-1]!==`
`&&(h+=`
`);break;default:h+=`
`}const p=n+i.length+e.source.length;return{value:h,type:a,comment:i.comment,range:[n,p,p]}}function GD({offset:t,props:e},s,n){if(e[0].type!=="block-scalar-header")return n(e[0],"IMPOSSIBLE","Block scalar header not found"),null;const{source:i}=e[0],a=i[0];let o=0,l="",c=-1;for(let f=1;f<i.length;++f){const m=i[f];if(!l&&(m==="-"||m==="+"))l=m;else{const p=Number(m);!o&&p?o=p:c===-1&&(c=t+f)}}c!==-1&&n(c,"UNEXPECTED_TOKEN",`Block scalar header includes extra characters: ${i}`);let u=!1,d="",h=i.length;for(let f=1;f<e.length;++f){const m=e[f];switch(m.type){case"space":u=!0;case"newline":h+=m.source.length;break;case"comment":s&&!u&&n(m,"MISSING_CHAR","Comments must be separated from other tokens by white space characters"),h+=m.source.length,d=m.source.substring(1);break;case"error":n(m,"UNEXPECTED_TOKEN",m.message),h+=m.source.length;break;default:{const p=`Unexpected token in block scalar header: ${m.type}`;n(m,"UNEXPECTED_TOKEN",p);const x=m.source;x&&typeof x=="string"&&(h+=x.length)}}}return{mode:a,indent:o,chomp:l,comment:d,length:h}}function JD(t){const e=t.split(/\n( *)/),s=e[0],n=s.match(/^( *)/),a=[n?.[1]?[n[1],s.slice(n[1].length)]:["",s]];for(let o=1;o<e.length;o+=2)a.push([e[o],e[o+1]]);return a}function jk(t,e,s){const{offset:n,type:i,source:a,end:o}=t;let l,c;const u=(f,m,p)=>s(n+f,m,p);switch(i){case"scalar":l=fe.PLAIN,c=ZD(a,u);break;case"single-quoted-scalar":l=fe.QUOTE_SINGLE,c=QD(a,u);break;case"double-quoted-scalar":l=fe.QUOTE_DOUBLE,c=YD(a,u);break;default:return s(t,"UNEXPECTED_TOKEN",`Expected a flow scalar value, but found: ${i}`),{value:"",type:null,comment:"",range:[n,n+a.length,n+a.length]}}const d=n+a.length,h=ic(o,d,e,s);return{value:c,type:l,comment:h.comment,range:[n,d,h.offset]}}function ZD(t,e){let s="";switch(t[0]){case"	":s="a tab character";break;case",":s="flow indicator character ,";break;case"%":s="directive indicator character %";break;case"|":case">":{s=`block scalar indicator ${t[0]}`;break}case"@":case"`":{s=`reserved character ${t[0]}`;break}}return s&&e(0,"BAD_SCALAR_START",`Plain value cannot start with ${s}`),wk(t)}function QD(t,e){return(t[t.length-1]!=="'"||t.length===1)&&e(t.length,"MISSING_CHAR","Missing closing 'quote"),wk(t.slice(1,-1)).replace(/''/g,"'")}function wk(t){let e,s;try{e=new RegExp(`(.*?)(?<![ 	])[ 	]*\r?
`,"sy"),s=new RegExp(`[ 	]*(.*?)(?:(?<![ 	])[ 	]*)?\r?
`,"sy")}catch{e=/(.*?)[ \t]*\r?\n/sy,s=/[ \t]*(.*?)[ \t]*\r?\n/sy}let n=e.exec(t);if(!n)return t;let i=n[1],a=" ",o=e.lastIndex;for(s.lastIndex=o;n=s.exec(t);)n[1]===""?a===`
`?i+=a:a=`
`:(i+=a+n[1],a=" "),o=s.lastIndex;const l=/[ \t]*(.*)/sy;return l.lastIndex=o,n=l.exec(t),i+a+(n?.[1]??"")}function YD(t,e){let s="";for(let n=1;n<t.length-1;++n){const i=t[n];if(!(i==="\r"&&t[n+1]===`
`))if(i===`
`){const{fold:a,offset:o}=XD(t,n);s+=a,n=o}else if(i==="\\"){let a=t[++n];const o=eM[a];if(o)s+=o;else if(a===`
`)for(a=t[n+1];a===" "||a==="	";)a=t[++n+1];else if(a==="\r"&&t[n+1]===`
`)for(a=t[++n+1];a===" "||a==="	";)a=t[++n+1];else if(a==="x"||a==="u"||a==="U"){const l={x:2,u:4,U:8}[a];s+=tM(t,n+1,l,e),n+=l}else{const l=t.substr(n-1,2);e(n-1,"BAD_DQ_ESCAPE",`Invalid escape sequence ${l}`),s+=l}}else if(i===" "||i==="	"){const a=n;let o=t[n+1];for(;o===" "||o==="	";)o=t[++n+1];o!==`
`&&!(o==="\r"&&t[n+2]===`
`)&&(s+=n>a?t.slice(a,n+1):i)}else s+=i}return(t[t.length-1]!=='"'||t.length===1)&&e(t.length,"MISSING_CHAR",'Missing closing "quote'),s}function XD(t,e){let s="",n=t[e+1];for(;(n===" "||n==="	"||n===`
`||n==="\r")&&!(n==="\r"&&t[e+2]!==`
`);)n===`
`&&(s+=`
`),e+=1,n=t[e+1];return s||(s=" "),{fold:s,offset:e}}const eM={0:"\0",a:"\x07",b:"\b",e:"\x1B",f:"\f",n:`
`,r:"\r",t:"	",v:"\v",N:"",_:" ",L:"\u2028",P:"\u2029"," ":" ",'"':'"',"/":"/","\\":"\\","	":"	"};function tM(t,e,s,n){const i=t.substr(e,s),o=i.length===s&&/^[0-9a-fA-F]+$/.test(i)?parseInt(i,16):NaN;if(isNaN(o)){const l=t.substr(e-2,s+2);return n(e-2,"BAD_DQ_ESCAPE",`Invalid escape sequence ${l}`),l}return String.fromCodePoint(o)}function vk(t,e,s,n){const{value:i,type:a,comment:o,range:l}=e.type==="block-scalar"?bk(t,e,n):jk(e,t.options.strict,n),c=s?t.directives.tagName(s.source,h=>n(s,"TAG_RESOLVE_FAILED",h)):null;let u;t.options.stringKeys&&t.atKey?u=t.schema[On]:c?u=sM(t.schema,i,c,s,n):e.type==="scalar"?u=nM(t,i,e,n):u=t.schema[On];let d;try{const h=u.resolve(i,f=>n(s??e,"TAG_RESOLVE_FAILED",f),t.options);d=Oe(h)?h:new fe(h)}catch(h){const f=h instanceof Error?h.message:String(h);n(s??e,"TAG_RESOLVE_FAILED",f),d=new fe(i)}return d.range=l,d.source=i,a&&(d.type=a),c&&(d.tag=c),u.format&&(d.format=u.format),o&&(d.comment=o),d}function sM(t,e,s,n,i){if(s==="!")return t[On];const a=[];for(const l of t.tags)if(!l.collection&&l.tag===s)if(l.default&&l.test)a.push(l);else return l;for(const l of a)if(l.test?.test(e))return l;const o=t.knownTags[s];return o&&!o.collection?(t.tags.push(Object.assign({},o,{default:!1,test:void 0})),o):(i(n,"TAG_RESOLVE_FAILED",`Unresolved tag: ${s}`,s!=="tag:yaml.org,2002:str"),t[On])}function nM({atKey:t,directives:e,schema:s},n,i,a){const o=s.tags.find(l=>(l.default===!0||t&&l.default==="key")&&l.test?.test(n))||s[On];if(s.compat){const l=s.compat.find(c=>c.default&&c.test?.test(n))??s[On];if(o.tag!==l.tag){const c=e.tagString(o.tag),u=e.tagString(l.tag),d=`Value may be parsed as either ${c} or ${u}`;a(i,"TAG_RESOLVE_FAILED",d,!0)}}return o}function rM(t,e,s){if(e){s??(s=e.length);for(let n=s-1;n>=0;--n){let i=e[n];switch(i.type){case"space":case"comment":case"newline":t-=i.source.length;continue}for(i=e[++n];i?.type==="space";)t+=i.source.length,i=e[++n];break}}return t}const iM={composeNode:kk,composeEmptyNode:bx};function kk(t,e,s,n){const i=t.atKey,{spaceBefore:a,comment:o,anchor:l,tag:c}=s;let u,d=!0;switch(e.type){case"alias":u=aM(t,e,n),(l||c)&&n(e,"ALIAS_PROPS","An alias node must not specify any properties");break;case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"block-scalar":u=vk(t,e,c,n),l&&(u.anchor=l.source.substring(1));break;case"block-map":case"block-seq":case"flow-collection":u=HD(iM,t,e,s,n),l&&(u.anchor=l.source.substring(1));break;default:{const h=e.type==="error"?e.message:`Unsupported token (type: ${e.type})`;n(e,"UNEXPECTED_TOKEN",h),u=bx(t,e.offset,void 0,null,s,n),d=!1}}return l&&u.anchor===""&&n(l,"BAD_ALIAS","Anchor cannot be an empty string"),i&&t.options.stringKeys&&(!Oe(u)||typeof u.value!="string"||u.tag&&u.tag!=="tag:yaml.org,2002:str")&&n(c??e,"NON_STRING_KEY","With stringKeys, all keys must be strings"),a&&(u.spaceBefore=!0),o&&(e.type==="scalar"&&e.source===""?u.comment=o:u.commentBefore=o),t.options.keepSourceTokens&&d&&(u.srcToken=e),u}function bx(t,e,s,n,{spaceBefore:i,comment:a,anchor:o,tag:l,end:c},u){const d={type:"scalar",offset:rM(e,s,n),indent:-1,source:""},h=vk(t,d,l,u);return o&&(h.anchor=o.source.substring(1),h.anchor===""&&u(o,"BAD_ALIAS","Anchor cannot be an empty string")),i&&(h.spaceBefore=!0),a&&(h.comment=a,h.range[2]=c),h}function aM({options:t},{offset:e,source:s,end:n},i){const a=new th(s.substring(1));a.source===""&&i(e,"BAD_ALIAS","Alias cannot be an empty string"),a.source.endsWith(":")&&i(e+s.length-1,"BAD_ALIAS","Alias ending in : is ambiguous",!0);const o=e+s.length,l=ic(n,o,t.strict,i);return a.range=[e,o,l.offset],l.comment&&(a.comment=l.comment),a}function oM(t,e,{offset:s,start:n,value:i,end:a},o){const l=Object.assign({_directives:e},t),c=new uh(void 0,l),u={atKey:!1,atRoot:!0,directives:c.directives,options:c.options,schema:c.schema},d=Za(n,{indicator:"doc-start",next:i??a?.[0],offset:s,onError:o,parentIndent:0,startOnNewline:!0});d.found&&(c.directives.docStart=!0,i&&(i.type==="block-map"||i.type==="block-seq")&&!d.hasNewline&&o(d.end,"MISSING_CHAR","Block collection cannot start on same line with directives-end marker")),c.contents=i?kk(u,i,d,o):bx(u,d.end,n,null,d,o);const h=c.contents.range[2],f=ic(a,h,!1,o);return f.comment&&(c.comment=f.comment),c.range=[s,h,f.offset],c}function Mo(t){if(typeof t=="number")return[t,t+1];if(Array.isArray(t))return t.length===2?t:[t[0],t[1]];const{offset:e,source:s}=t;return[e,e+(typeof s=="string"?s.length:1)]}function Q0(t){let e="",s=!1,n=!1;for(let i=0;i<t.length;++i){const a=t[i];switch(a[0]){case"#":e+=(e===""?"":n?`

`:`
`)+(a.substring(1)||" "),s=!0,n=!1;break;case"%":t[i+1]?.[0]!=="#"&&(i+=1),s=!1;break;default:s||(n=!0),s=!1}}return{comment:e,afterEmptyLine:n}}class jx{constructor(e={}){this.doc=null,this.atDirectives=!1,this.prelude=[],this.errors=[],this.warnings=[],this.onError=(s,n,i,a)=>{const o=Mo(s);a?this.warnings.push(new gk(o,n,i)):this.errors.push(new ji(o,n,i))},this.directives=new ns({version:e.version||"1.2"}),this.options=e}decorate(e,s){const{comment:n,afterEmptyLine:i}=Q0(this.prelude);if(n){const a=e.contents;if(s)e.comment=e.comment?`${e.comment}
${n}`:n;else if(i||e.directives.docStart||!a)e.commentBefore=n;else if(Xe(a)&&!a.flow&&a.items.length>0){let o=a.items[0];Qe(o)&&(o=o.key);const l=o.commentBefore;o.commentBefore=l?`${n}
${l}`:n}else{const o=a.commentBefore;a.commentBefore=o?`${n}
${o}`:n}}s?(Array.prototype.push.apply(e.errors,this.errors),Array.prototype.push.apply(e.warnings,this.warnings)):(e.errors=this.errors,e.warnings=this.warnings),this.prelude=[],this.errors=[],this.warnings=[]}streamInfo(){return{comment:Q0(this.prelude).comment,directives:this.directives,errors:this.errors,warnings:this.warnings}}*compose(e,s=!1,n=-1){for(const i of e)yield*this.next(i);yield*this.end(s,n)}*next(e){switch(e.type){case"directive":this.directives.add(e.source,(s,n,i)=>{const a=Mo(e);a[0]+=s,this.onError(a,"BAD_DIRECTIVE",n,i)}),this.prelude.push(e.source),this.atDirectives=!0;break;case"document":{const s=oM(this.options,this.directives,e,this.onError);this.atDirectives&&!s.directives.docStart&&this.onError(e,"MISSING_CHAR","Missing directives-end/doc-start indicator line"),this.decorate(s,!1),this.doc&&(yield this.doc),this.doc=s,this.atDirectives=!1;break}case"byte-order-mark":case"space":break;case"comment":case"newline":this.prelude.push(e.source);break;case"error":{const s=e.source?`${e.message}: ${JSON.stringify(e.source)}`:e.message,n=new ji(Mo(e),"UNEXPECTED_TOKEN",s);this.atDirectives||!this.doc?this.errors.push(n):this.doc.errors.push(n);break}case"doc-end":{if(!this.doc){const n="Unexpected doc-end without preceding document";this.errors.push(new ji(Mo(e),"UNEXPECTED_TOKEN",n));break}this.doc.directives.docEnd=!0;const s=ic(e.end,e.offset+e.source.length,this.doc.options.strict,this.onError);if(this.decorate(this.doc,!0),s.comment){const n=this.doc.comment;this.doc.comment=n?`${n}
${s.comment}`:s.comment}this.doc.range[2]=s.offset;break}default:this.errors.push(new ji(Mo(e),"UNEXPECTED_TOKEN",`Unsupported token ${e.type}`))}}*end(e=!1,s=-1){if(this.doc)this.decorate(this.doc,!0),yield this.doc,this.doc=null;else if(e){const n=Object.assign({_directives:this.directives},this.options),i=new uh(void 0,n);this.atDirectives&&this.onError(s,"MISSING_CHAR","Missing directives-end indicator line"),i.range=[0,s,s],this.decorate(i,!1),yield i}}}function lM(t,e=!0,s){if(t){const n=(i,a,o)=>{const l=typeof i=="number"?i:Array.isArray(i)?i[0]:i.offset;if(s)s(l,a,o);else throw new ji([l,l+1],a,o)};switch(t.type){case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return jk(t,e,n);case"block-scalar":return bk({options:{strict:e}},t,n)}}return null}function cM(t,e){const{implicitKey:s=!1,indent:n,inFlow:i=!1,offset:a=-1,type:o="PLAIN"}=e,l=nc({type:o,value:t},{implicitKey:s,indent:n>0?" ".repeat(n):"",inFlow:i,options:{blockQuote:!0,lineWidth:-1}}),c=e.end??[{type:"newline",offset:-1,indent:n,source:`
`}];switch(l[0]){case"|":case">":{const u=l.indexOf(`
`),d=l.substring(0,u),h=l.substring(u+1)+`
`,f=[{type:"block-scalar-header",offset:a,indent:n,source:d}];return Nk(f,c)||f.push({type:"newline",offset:-1,indent:n,source:`
`}),{type:"block-scalar",offset:a,indent:n,props:f,source:h}}case'"':return{type:"double-quoted-scalar",offset:a,indent:n,source:l,end:c};case"'":return{type:"single-quoted-scalar",offset:a,indent:n,source:l,end:c};default:return{type:"scalar",offset:a,indent:n,source:l,end:c}}}function uM(t,e,s={}){let{afterKey:n=!1,implicitKey:i=!1,inFlow:a=!1,type:o}=s,l="indent"in t?t.indent:null;if(n&&typeof l=="number"&&(l+=2),!o)switch(t.type){case"single-quoted-scalar":o="QUOTE_SINGLE";break;case"double-quoted-scalar":o="QUOTE_DOUBLE";break;case"block-scalar":{const u=t.props[0];if(u.type!=="block-scalar-header")throw new Error("Invalid block scalar header");o=u.source[0]===">"?"BLOCK_FOLDED":"BLOCK_LITERAL";break}default:o="PLAIN"}const c=nc({type:o,value:e},{implicitKey:i||l===null,indent:l!==null&&l>0?" ".repeat(l):"",inFlow:a,options:{blockQuote:!0,lineWidth:-1}});switch(c[0]){case"|":case">":dM(t,c);break;case'"':uf(t,c,"double-quoted-scalar");break;case"'":uf(t,c,"single-quoted-scalar");break;default:uf(t,c,"scalar")}}function dM(t,e){const s=e.indexOf(`
`),n=e.substring(0,s),i=e.substring(s+1)+`
`;if(t.type==="block-scalar"){const a=t.props[0];if(a.type!=="block-scalar-header")throw new Error("Invalid block scalar header");a.source=n,t.source=i}else{const{offset:a}=t,o="indent"in t?t.indent:-1,l=[{type:"block-scalar-header",offset:a,indent:o,source:n}];Nk(l,"end"in t?t.end:void 0)||l.push({type:"newline",offset:-1,indent:o,source:`
`});for(const c of Object.keys(t))c!=="type"&&c!=="offset"&&delete t[c];Object.assign(t,{type:"block-scalar",indent:o,props:l,source:i})}}function Nk(t,e){if(e)for(const s of e)switch(s.type){case"space":case"comment":t.push(s);break;case"newline":return t.push(s),!0}return!1}function uf(t,e,s){switch(t.type){case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":t.type=s,t.source=e;break;case"block-scalar":{const n=t.props.slice(1);let i=e.length;t.props[0].type==="block-scalar-header"&&(i-=t.props[0].source.length);for(const a of n)a.offset+=i;delete t.props,Object.assign(t,{type:s,source:e,end:n});break}case"block-map":case"block-seq":{const i={type:"newline",offset:t.offset+e.length,indent:t.indent,source:`
`};delete t.items,Object.assign(t,{type:s,source:e,end:[i]});break}default:{const n="indent"in t?t.indent:-1,i="end"in t&&Array.isArray(t.end)?t.end.filter(a=>a.type==="space"||a.type==="comment"||a.type==="newline"):[];for(const a of Object.keys(t))a!=="type"&&a!=="offset"&&delete t[a];Object.assign(t,{type:s,indent:n,source:e,end:i})}}}const hM=t=>"type"in t?Eu(t):au(t);function Eu(t){switch(t.type){case"block-scalar":{let e="";for(const s of t.props)e+=Eu(s);return e+t.source}case"block-map":case"block-seq":{let e="";for(const s of t.items)e+=au(s);return e}case"flow-collection":{let e=t.start.source;for(const s of t.items)e+=au(s);for(const s of t.end)e+=s.source;return e}case"document":{let e=au(t);if(t.end)for(const s of t.end)e+=s.source;return e}default:{let e=t.source;if("end"in t&&t.end)for(const s of t.end)e+=s.source;return e}}}function au({start:t,key:e,sep:s,value:n}){let i="";for(const a of t)i+=a.source;if(e&&(i+=Eu(e)),s)for(const a of s)i+=a.source;return n&&(i+=Eu(n)),i}const Am=Symbol("break visit"),fM=Symbol("skip children"),Sk=Symbol("remove item");function Ri(t,e){"type"in t&&t.type==="document"&&(t={start:t.start,value:t.value}),Ck(Object.freeze([]),t,e)}Ri.BREAK=Am;Ri.SKIP=fM;Ri.REMOVE=Sk;Ri.itemAtPath=(t,e)=>{let s=t;for(const[n,i]of e){const a=s?.[n];if(a&&"items"in a)s=a.items[i];else return}return s};Ri.parentCollection=(t,e)=>{const s=Ri.itemAtPath(t,e.slice(0,-1)),n=e[e.length-1][0],i=s?.[n];if(i&&"items"in i)return i;throw new Error("Parent collection not found")};function Ck(t,e,s){let n=s(e,t);if(typeof n=="symbol")return n;for(const i of["key","value"]){const a=e[i];if(a&&"items"in a){for(let o=0;o<a.items.length;++o){const l=Ck(Object.freeze(t.concat([[i,o]])),a.items[o],s);if(typeof l=="number")o=l-1;else{if(l===Am)return Am;l===Sk&&(a.items.splice(o,1),o-=1)}}typeof n=="function"&&i==="key"&&(n=n(e,t))}}return typeof n=="function"?n(e,t):n}const dh="\uFEFF",hh="",fh="",Nl="",mM=t=>!!t&&"items"in t,pM=t=>!!t&&(t.type==="scalar"||t.type==="single-quoted-scalar"||t.type==="double-quoted-scalar"||t.type==="block-scalar");function xM(t){switch(t){case dh:return"<BOM>";case hh:return"<DOC>";case fh:return"<FLOW_END>";case Nl:return"<SCALAR>";default:return JSON.stringify(t)}}function zk(t){switch(t){case dh:return"byte-order-mark";case hh:return"doc-mode";case fh:return"flow-error-end";case Nl:return"scalar";case"---":return"doc-start";case"...":return"doc-end";case"":case`
`:case`\r
`:return"newline";case"-":return"seq-item-ind";case"?":return"explicit-key-ind";case":":return"map-value-ind";case"{":return"flow-map-start";case"}":return"flow-map-end";case"[":return"flow-seq-start";case"]":return"flow-seq-end";case",":return"comma"}switch(t[0]){case" ":case"	":return"space";case"#":return"comment";case"%":return"directive-line";case"*":return"alias";case"&":return"anchor";case"!":return"tag";case"'":return"single-quoted-scalar";case'"':return"double-quoted-scalar";case"|":case">":return"block-scalar-header"}return null}const gM=Object.freeze(Object.defineProperty({__proto__:null,BOM:dh,DOCUMENT:hh,FLOW_END:fh,SCALAR:Nl,createScalarToken:cM,isCollection:mM,isScalar:pM,prettyToken:xM,resolveAsScalar:lM,setScalarValue:uM,stringify:hM,tokenType:zk,visit:Ri},Symbol.toStringTag,{value:"Module"}));function an(t){switch(t){case void 0:case" ":case`
`:case"\r":case"	":return!0;default:return!1}}const Y0=new Set("0123456789ABCDEFabcdef"),yM=new Set("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-#;/?:@&=+$_.!~*'()"),Ec=new Set(",[]{}"),bM=new Set(` ,[]{}
\r	`),df=t=>!t||bM.has(t);class _k{constructor(){this.atEnd=!1,this.blockScalarIndent=-1,this.blockScalarKeep=!1,this.buffer="",this.flowKey=!1,this.flowLevel=0,this.indentNext=0,this.indentValue=0,this.lineEndPos=null,this.next=null,this.pos=0}*lex(e,s=!1){if(e){if(typeof e!="string")throw TypeError("source is not a string");this.buffer=this.buffer?this.buffer+e:e,this.lineEndPos=null}this.atEnd=!s;let n=this.next??"stream";for(;n&&(s||this.hasChars(1));)n=yield*this.parseNext(n)}atLineEnd(){let e=this.pos,s=this.buffer[e];for(;s===" "||s==="	";)s=this.buffer[++e];return!s||s==="#"||s===`
`?!0:s==="\r"?this.buffer[e+1]===`
`:!1}charAt(e){return this.buffer[this.pos+e]}continueScalar(e){let s=this.buffer[e];if(this.indentNext>0){let n=0;for(;s===" ";)s=this.buffer[++n+e];if(s==="\r"){const i=this.buffer[n+e+1];if(i===`
`||!i&&!this.atEnd)return e+n+1}return s===`
`||n>=this.indentNext||!s&&!this.atEnd?e+n:-1}if(s==="-"||s==="."){const n=this.buffer.substr(e,3);if((n==="---"||n==="...")&&an(this.buffer[e+3]))return-1}return e}getLine(){let e=this.lineEndPos;return(typeof e!="number"||e!==-1&&e<this.pos)&&(e=this.buffer.indexOf(`
`,this.pos),this.lineEndPos=e),e===-1?this.atEnd?this.buffer.substring(this.pos):null:(this.buffer[e-1]==="\r"&&(e-=1),this.buffer.substring(this.pos,e))}hasChars(e){return this.pos+e<=this.buffer.length}setNext(e){return this.buffer=this.buffer.substring(this.pos),this.pos=0,this.lineEndPos=null,this.next=e,null}peek(e){return this.buffer.substr(this.pos,e)}*parseNext(e){switch(e){case"stream":return yield*this.parseStream();case"line-start":return yield*this.parseLineStart();case"block-start":return yield*this.parseBlockStart();case"doc":return yield*this.parseDocument();case"flow":return yield*this.parseFlowCollection();case"quoted-scalar":return yield*this.parseQuotedScalar();case"block-scalar":return yield*this.parseBlockScalar();case"plain-scalar":return yield*this.parsePlainScalar()}}*parseStream(){let e=this.getLine();if(e===null)return this.setNext("stream");if(e[0]===dh&&(yield*this.pushCount(1),e=e.substring(1)),e[0]==="%"){let s=e.length,n=e.indexOf("#");for(;n!==-1;){const a=e[n-1];if(a===" "||a==="	"){s=n-1;break}else n=e.indexOf("#",n+1)}for(;;){const a=e[s-1];if(a===" "||a==="	")s-=1;else break}const i=(yield*this.pushCount(s))+(yield*this.pushSpaces(!0));return yield*this.pushCount(e.length-i),this.pushNewline(),"stream"}if(this.atLineEnd()){const s=yield*this.pushSpaces(!0);return yield*this.pushCount(e.length-s),yield*this.pushNewline(),"stream"}return yield hh,yield*this.parseLineStart()}*parseLineStart(){const e=this.charAt(0);if(!e&&!this.atEnd)return this.setNext("line-start");if(e==="-"||e==="."){if(!this.atEnd&&!this.hasChars(4))return this.setNext("line-start");const s=this.peek(3);if((s==="---"||s==="...")&&an(this.charAt(3)))return yield*this.pushCount(3),this.indentValue=0,this.indentNext=0,s==="---"?"doc":"stream"}return this.indentValue=yield*this.pushSpaces(!1),this.indentNext>this.indentValue&&!an(this.charAt(1))&&(this.indentNext=this.indentValue),yield*this.parseBlockStart()}*parseBlockStart(){const[e,s]=this.peek(2);if(!s&&!this.atEnd)return this.setNext("block-start");if((e==="-"||e==="?"||e===":")&&an(s)){const n=(yield*this.pushCount(1))+(yield*this.pushSpaces(!0));return this.indentNext=this.indentValue+1,this.indentValue+=n,yield*this.parseBlockStart()}return"doc"}*parseDocument(){yield*this.pushSpaces(!0);const e=this.getLine();if(e===null)return this.setNext("doc");let s=yield*this.pushIndicators();switch(e[s]){case"#":yield*this.pushCount(e.length-s);case void 0:return yield*this.pushNewline(),yield*this.parseLineStart();case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel=1,"flow";case"}":case"]":return yield*this.pushCount(1),"doc";case"*":return yield*this.pushUntil(df),"doc";case'"':case"'":return yield*this.parseQuotedScalar();case"|":case">":return s+=yield*this.parseBlockScalarHeader(),s+=yield*this.pushSpaces(!0),yield*this.pushCount(e.length-s),yield*this.pushNewline(),yield*this.parseBlockScalar();default:return yield*this.parsePlainScalar()}}*parseFlowCollection(){let e,s,n=-1;do e=yield*this.pushNewline(),e>0?(s=yield*this.pushSpaces(!1),this.indentValue=n=s):s=0,s+=yield*this.pushSpaces(!0);while(e+s>0);const i=this.getLine();if(i===null)return this.setNext("flow");if((n!==-1&&n<this.indentNext&&i[0]!=="#"||n===0&&(i.startsWith("---")||i.startsWith("..."))&&an(i[3]))&&!(n===this.indentNext-1&&this.flowLevel===1&&(i[0]==="]"||i[0]==="}")))return this.flowLevel=0,yield fh,yield*this.parseLineStart();let a=0;for(;i[a]===",";)a+=yield*this.pushCount(1),a+=yield*this.pushSpaces(!0),this.flowKey=!1;switch(a+=yield*this.pushIndicators(),i[a]){case void 0:return"flow";case"#":return yield*this.pushCount(i.length-a),"flow";case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel+=1,"flow";case"}":case"]":return yield*this.pushCount(1),this.flowKey=!0,this.flowLevel-=1,this.flowLevel?"flow":"doc";case"*":return yield*this.pushUntil(df),"flow";case'"':case"'":return this.flowKey=!0,yield*this.parseQuotedScalar();case":":{const o=this.charAt(1);if(this.flowKey||an(o)||o===",")return this.flowKey=!1,yield*this.pushCount(1),yield*this.pushSpaces(!0),"flow"}default:return this.flowKey=!1,yield*this.parsePlainScalar()}}*parseQuotedScalar(){const e=this.charAt(0);let s=this.buffer.indexOf(e,this.pos+1);if(e==="'")for(;s!==-1&&this.buffer[s+1]==="'";)s=this.buffer.indexOf("'",s+2);else for(;s!==-1;){let a=0;for(;this.buffer[s-1-a]==="\\";)a+=1;if(a%2===0)break;s=this.buffer.indexOf('"',s+1)}const n=this.buffer.substring(0,s);let i=n.indexOf(`
`,this.pos);if(i!==-1){for(;i!==-1;){const a=this.continueScalar(i+1);if(a===-1)break;i=n.indexOf(`
`,a)}i!==-1&&(s=i-(n[i-1]==="\r"?2:1))}if(s===-1){if(!this.atEnd)return this.setNext("quoted-scalar");s=this.buffer.length}return yield*this.pushToIndex(s+1,!1),this.flowLevel?"flow":"doc"}*parseBlockScalarHeader(){this.blockScalarIndent=-1,this.blockScalarKeep=!1;let e=this.pos;for(;;){const s=this.buffer[++e];if(s==="+")this.blockScalarKeep=!0;else if(s>"0"&&s<="9")this.blockScalarIndent=Number(s)-1;else if(s!=="-")break}return yield*this.pushUntil(s=>an(s)||s==="#")}*parseBlockScalar(){let e=this.pos-1,s=0,n;e:for(let a=this.pos;n=this.buffer[a];++a)switch(n){case" ":s+=1;break;case`
`:e=a,s=0;break;case"\r":{const o=this.buffer[a+1];if(!o&&!this.atEnd)return this.setNext("block-scalar");if(o===`
`)break}default:break e}if(!n&&!this.atEnd)return this.setNext("block-scalar");if(s>=this.indentNext){this.blockScalarIndent===-1?this.indentNext=s:this.indentNext=this.blockScalarIndent+(this.indentNext===0?1:this.indentNext);do{const a=this.continueScalar(e+1);if(a===-1)break;e=this.buffer.indexOf(`
`,a)}while(e!==-1);if(e===-1){if(!this.atEnd)return this.setNext("block-scalar");e=this.buffer.length}}let i=e+1;for(n=this.buffer[i];n===" ";)n=this.buffer[++i];if(n==="	"){for(;n==="	"||n===" "||n==="\r"||n===`
`;)n=this.buffer[++i];e=i-1}else if(!this.blockScalarKeep)do{let a=e-1,o=this.buffer[a];o==="\r"&&(o=this.buffer[--a]);const l=a;for(;o===" ";)o=this.buffer[--a];if(o===`
`&&a>=this.pos&&a+1+s>l)e=a;else break}while(!0);return yield Nl,yield*this.pushToIndex(e+1,!0),yield*this.parseLineStart()}*parsePlainScalar(){const e=this.flowLevel>0;let s=this.pos-1,n=this.pos-1,i;for(;i=this.buffer[++n];)if(i===":"){const a=this.buffer[n+1];if(an(a)||e&&Ec.has(a))break;s=n}else if(an(i)){let a=this.buffer[n+1];if(i==="\r"&&(a===`
`?(n+=1,i=`
`,a=this.buffer[n+1]):s=n),a==="#"||e&&Ec.has(a))break;if(i===`
`){const o=this.continueScalar(n+1);if(o===-1)break;n=Math.max(n,o-2)}}else{if(e&&Ec.has(i))break;s=n}return!i&&!this.atEnd?this.setNext("plain-scalar"):(yield Nl,yield*this.pushToIndex(s+1,!0),e?"flow":"doc")}*pushCount(e){return e>0?(yield this.buffer.substr(this.pos,e),this.pos+=e,e):0}*pushToIndex(e,s){const n=this.buffer.slice(this.pos,e);return n?(yield n,this.pos+=n.length,n.length):(s&&(yield""),0)}*pushIndicators(){switch(this.charAt(0)){case"!":return(yield*this.pushTag())+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"&":return(yield*this.pushUntil(df))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"-":case"?":case":":{const e=this.flowLevel>0,s=this.charAt(1);if(an(s)||e&&Ec.has(s))return e?this.flowKey&&(this.flowKey=!1):this.indentNext=this.indentValue+1,(yield*this.pushCount(1))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators())}}return 0}*pushTag(){if(this.charAt(1)==="<"){let e=this.pos+2,s=this.buffer[e];for(;!an(s)&&s!==">";)s=this.buffer[++e];return yield*this.pushToIndex(s===">"?e+1:e,!1)}else{let e=this.pos+1,s=this.buffer[e];for(;s;)if(yM.has(s))s=this.buffer[++e];else if(s==="%"&&Y0.has(this.buffer[e+1])&&Y0.has(this.buffer[e+2]))s=this.buffer[e+=3];else break;return yield*this.pushToIndex(e,!1)}}*pushNewline(){const e=this.buffer[this.pos];return e===`
`?yield*this.pushCount(1):e==="\r"&&this.charAt(1)===`
`?yield*this.pushCount(2):0}*pushSpaces(e){let s=this.pos-1,n;do n=this.buffer[++s];while(n===" "||e&&n==="	");const i=s-this.pos;return i>0&&(yield this.buffer.substr(this.pos,i),this.pos=s),i}*pushUntil(e){let s=this.pos,n=this.buffer[s];for(;!e(n);)n=this.buffer[++s];return yield*this.pushToIndex(s,!1)}}class Ak{constructor(){this.lineStarts=[],this.addNewLine=e=>this.lineStarts.push(e),this.linePos=e=>{let s=0,n=this.lineStarts.length;for(;s<n;){const a=s+n>>1;this.lineStarts[a]<e?s=a+1:n=a}if(this.lineStarts[s]===e)return{line:s+1,col:1};if(s===0)return{line:0,col:e};const i=this.lineStarts[s-1];return{line:s,col:e-i+1}}}}function Cr(t,e){for(let s=0;s<t.length;++s)if(t[s].type===e)return!0;return!1}function X0(t){for(let e=0;e<t.length;++e)switch(t[e].type){case"space":case"comment":case"newline":break;default:return e}return-1}function Tk(t){switch(t?.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"flow-collection":return!0;default:return!1}}function Dc(t){switch(t.type){case"document":return t.start;case"block-map":{const e=t.items[t.items.length-1];return e.sep??e.start}case"block-seq":return t.items[t.items.length-1].start;default:return[]}}function ca(t){if(t.length===0)return[];let e=t.length;e:for(;--e>=0;)switch(t[e].type){case"doc-start":case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":case"newline":break e}for(;t[++e]?.type==="space";);return t.splice(e,t.length)}function ey(t){if(t.start.type==="flow-seq-start")for(const e of t.items)e.sep&&!e.value&&!Cr(e.start,"explicit-key-ind")&&!Cr(e.sep,"map-value-ind")&&(e.key&&(e.value=e.key),delete e.key,Tk(e.value)?e.value.end?Array.prototype.push.apply(e.value.end,e.sep):e.value.end=e.sep:Array.prototype.push.apply(e.start,e.sep),delete e.sep)}class wx{constructor(e){this.atNewLine=!0,this.atScalar=!1,this.indent=0,this.offset=0,this.onKeyLine=!1,this.stack=[],this.source="",this.type="",this.lexer=new _k,this.onNewLine=e}*parse(e,s=!1){this.onNewLine&&this.offset===0&&this.onNewLine(0);for(const n of this.lexer.lex(e,s))yield*this.next(n);s||(yield*this.end())}*next(e){if(this.source=e,this.atScalar){this.atScalar=!1,yield*this.step(),this.offset+=e.length;return}const s=zk(e);if(s)if(s==="scalar")this.atNewLine=!1,this.atScalar=!0,this.type="scalar";else{switch(this.type=s,yield*this.step(),s){case"newline":this.atNewLine=!0,this.indent=0,this.onNewLine&&this.onNewLine(this.offset+e.length);break;case"space":this.atNewLine&&e[0]===" "&&(this.indent+=e.length);break;case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":this.atNewLine&&(this.indent+=e.length);break;case"doc-mode":case"flow-error-end":return;default:this.atNewLine=!1}this.offset+=e.length}else{const n=`Not a YAML token: ${e}`;yield*this.pop({type:"error",offset:this.offset,message:n,source:e}),this.offset+=e.length}}*end(){for(;this.stack.length>0;)yield*this.pop()}get sourceToken(){return{type:this.type,offset:this.offset,indent:this.indent,source:this.source}}*step(){const e=this.peek(1);if(this.type==="doc-end"&&(!e||e.type!=="doc-end")){for(;this.stack.length>0;)yield*this.pop();this.stack.push({type:"doc-end",offset:this.offset,source:this.source});return}if(!e)return yield*this.stream();switch(e.type){case"document":return yield*this.document(e);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return yield*this.scalar(e);case"block-scalar":return yield*this.blockScalar(e);case"block-map":return yield*this.blockMap(e);case"block-seq":return yield*this.blockSequence(e);case"flow-collection":return yield*this.flowCollection(e);case"doc-end":return yield*this.documentEnd(e)}yield*this.pop()}peek(e){return this.stack[this.stack.length-e]}*pop(e){const s=e??this.stack.pop();if(!s)yield{type:"error",offset:this.offset,source:"",message:"Tried to pop an empty stack"};else if(this.stack.length===0)yield s;else{const n=this.peek(1);switch(s.type==="block-scalar"?s.indent="indent"in n?n.indent:0:s.type==="flow-collection"&&n.type==="document"&&(s.indent=0),s.type==="flow-collection"&&ey(s),n.type){case"document":n.value=s;break;case"block-scalar":n.props.push(s);break;case"block-map":{const i=n.items[n.items.length-1];if(i.value){n.items.push({start:[],key:s,sep:[]}),this.onKeyLine=!0;return}else if(i.sep)i.value=s;else{Object.assign(i,{key:s,sep:[]}),this.onKeyLine=!i.explicitKey;return}break}case"block-seq":{const i=n.items[n.items.length-1];i.value?n.items.push({start:[],value:s}):i.value=s;break}case"flow-collection":{const i=n.items[n.items.length-1];!i||i.value?n.items.push({start:[],key:s,sep:[]}):i.sep?i.value=s:Object.assign(i,{key:s,sep:[]});return}default:yield*this.pop(),yield*this.pop(s)}if((n.type==="document"||n.type==="block-map"||n.type==="block-seq")&&(s.type==="block-map"||s.type==="block-seq")){const i=s.items[s.items.length-1];i&&!i.sep&&!i.value&&i.start.length>0&&X0(i.start)===-1&&(s.indent===0||i.start.every(a=>a.type!=="comment"||a.indent<s.indent))&&(n.type==="document"?n.end=i.start:n.items.push({start:i.start}),s.items.splice(-1,1))}}}*stream(){switch(this.type){case"directive-line":yield{type:"directive",offset:this.offset,source:this.source};return;case"byte-order-mark":case"space":case"comment":case"newline":yield this.sourceToken;return;case"doc-mode":case"doc-start":{const e={type:"document",offset:this.offset,start:[]};this.type==="doc-start"&&e.start.push(this.sourceToken),this.stack.push(e);return}}yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML stream`,source:this.source}}*document(e){if(e.value)return yield*this.lineEnd(e);switch(this.type){case"doc-start":{X0(e.start)!==-1?(yield*this.pop(),yield*this.step()):e.start.push(this.sourceToken);return}case"anchor":case"tag":case"space":case"comment":case"newline":e.start.push(this.sourceToken);return}const s=this.startBlockValue(e);s?this.stack.push(s):yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML document`,source:this.source}}*scalar(e){if(this.type==="map-value-ind"){const s=Dc(this.peek(2)),n=ca(s);let i;e.end?(i=e.end,i.push(this.sourceToken),delete e.end):i=[this.sourceToken];const a={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:n,key:e,sep:i}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=a}else yield*this.lineEnd(e)}*blockScalar(e){switch(this.type){case"space":case"comment":case"newline":e.props.push(this.sourceToken);return;case"scalar":if(e.source=this.source,this.atNewLine=!0,this.indent=0,this.onNewLine){let s=this.source.indexOf(`
`)+1;for(;s!==0;)this.onNewLine(this.offset+s),s=this.source.indexOf(`
`,s)+1}yield*this.pop();break;default:yield*this.pop(),yield*this.step()}}*blockMap(e){const s=e.items[e.items.length-1];switch(this.type){case"newline":if(this.onKeyLine=!1,s.value){const n="end"in s.value?s.value.end:void 0;(Array.isArray(n)?n[n.length-1]:void 0)?.type==="comment"?n?.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else s.sep?s.sep.push(this.sourceToken):s.start.push(this.sourceToken);return;case"space":case"comment":if(s.value)e.items.push({start:[this.sourceToken]});else if(s.sep)s.sep.push(this.sourceToken);else{if(this.atIndentedComment(s.start,e.indent)){const i=e.items[e.items.length-2]?.value?.end;if(Array.isArray(i)){Array.prototype.push.apply(i,s.start),i.push(this.sourceToken),e.items.pop();return}}s.start.push(this.sourceToken)}return}if(this.indent>=e.indent){const n=!this.onKeyLine&&this.indent===e.indent,i=n&&(s.sep||s.explicitKey)&&this.type!=="seq-item-ind";let a=[];if(i&&s.sep&&!s.value){const o=[];for(let l=0;l<s.sep.length;++l){const c=s.sep[l];switch(c.type){case"newline":o.push(l);break;case"space":break;case"comment":c.indent>e.indent&&(o.length=0);break;default:o.length=0}}o.length>=2&&(a=s.sep.splice(o[1]))}switch(this.type){case"anchor":case"tag":i||s.value?(a.push(this.sourceToken),e.items.push({start:a}),this.onKeyLine=!0):s.sep?s.sep.push(this.sourceToken):s.start.push(this.sourceToken);return;case"explicit-key-ind":!s.sep&&!s.explicitKey?(s.start.push(this.sourceToken),s.explicitKey=!0):i||s.value?(a.push(this.sourceToken),e.items.push({start:a,explicitKey:!0})):this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken],explicitKey:!0}]}),this.onKeyLine=!0;return;case"map-value-ind":if(s.explicitKey)if(s.sep)if(s.value)e.items.push({start:[],key:null,sep:[this.sourceToken]});else if(Cr(s.sep,"map-value-ind"))this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:a,key:null,sep:[this.sourceToken]}]});else if(Tk(s.key)&&!Cr(s.sep,"newline")){const o=ca(s.start),l=s.key,c=s.sep;c.push(this.sourceToken),delete s.key,delete s.sep,this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:o,key:l,sep:c}]})}else a.length>0?s.sep=s.sep.concat(a,this.sourceToken):s.sep.push(this.sourceToken);else if(Cr(s.start,"newline"))Object.assign(s,{key:null,sep:[this.sourceToken]});else{const o=ca(s.start);this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:o,key:null,sep:[this.sourceToken]}]})}else s.sep?s.value||i?e.items.push({start:a,key:null,sep:[this.sourceToken]}):Cr(s.sep,"map-value-ind")?this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[],key:null,sep:[this.sourceToken]}]}):s.sep.push(this.sourceToken):Object.assign(s,{key:null,sep:[this.sourceToken]});this.onKeyLine=!0;return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const o=this.flowScalar(this.type);i||s.value?(e.items.push({start:a,key:o,sep:[]}),this.onKeyLine=!0):s.sep?this.stack.push(o):(Object.assign(s,{key:o,sep:[]}),this.onKeyLine=!0);return}default:{const o=this.startBlockValue(e);if(o){if(o.type==="block-seq"){if(!s.explicitKey&&s.sep&&!Cr(s.sep,"newline")){yield*this.pop({type:"error",offset:this.offset,message:"Unexpected block-seq-ind on same line with key",source:this.source});return}}else n&&e.items.push({start:a});this.stack.push(o);return}}}}yield*this.pop(),yield*this.step()}*blockSequence(e){const s=e.items[e.items.length-1];switch(this.type){case"newline":if(s.value){const n="end"in s.value?s.value.end:void 0;(Array.isArray(n)?n[n.length-1]:void 0)?.type==="comment"?n?.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else s.start.push(this.sourceToken);return;case"space":case"comment":if(s.value)e.items.push({start:[this.sourceToken]});else{if(this.atIndentedComment(s.start,e.indent)){const i=e.items[e.items.length-2]?.value?.end;if(Array.isArray(i)){Array.prototype.push.apply(i,s.start),i.push(this.sourceToken),e.items.pop();return}}s.start.push(this.sourceToken)}return;case"anchor":case"tag":if(s.value||this.indent<=e.indent)break;s.start.push(this.sourceToken);return;case"seq-item-ind":if(this.indent!==e.indent)break;s.value||Cr(s.start,"seq-item-ind")?e.items.push({start:[this.sourceToken]}):s.start.push(this.sourceToken);return}if(this.indent>e.indent){const n=this.startBlockValue(e);if(n){this.stack.push(n);return}}yield*this.pop(),yield*this.step()}*flowCollection(e){const s=e.items[e.items.length-1];if(this.type==="flow-error-end"){let n;do yield*this.pop(),n=this.peek(1);while(n&&n.type==="flow-collection")}else if(e.end.length===0){switch(this.type){case"comma":case"explicit-key-ind":!s||s.sep?e.items.push({start:[this.sourceToken]}):s.start.push(this.sourceToken);return;case"map-value-ind":!s||s.value?e.items.push({start:[],key:null,sep:[this.sourceToken]}):s.sep?s.sep.push(this.sourceToken):Object.assign(s,{key:null,sep:[this.sourceToken]});return;case"space":case"comment":case"newline":case"anchor":case"tag":!s||s.value?e.items.push({start:[this.sourceToken]}):s.sep?s.sep.push(this.sourceToken):s.start.push(this.sourceToken);return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const i=this.flowScalar(this.type);!s||s.value?e.items.push({start:[],key:i,sep:[]}):s.sep?this.stack.push(i):Object.assign(s,{key:i,sep:[]});return}case"flow-map-end":case"flow-seq-end":e.end.push(this.sourceToken);return}const n=this.startBlockValue(e);n?this.stack.push(n):(yield*this.pop(),yield*this.step())}else{const n=this.peek(2);if(n.type==="block-map"&&(this.type==="map-value-ind"&&n.indent===e.indent||this.type==="newline"&&!n.items[n.items.length-1].sep))yield*this.pop(),yield*this.step();else if(this.type==="map-value-ind"&&n.type!=="flow-collection"){const i=Dc(n),a=ca(i);ey(e);const o=e.end.splice(1,e.end.length);o.push(this.sourceToken);const l={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:a,key:e,sep:o}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=l}else yield*this.lineEnd(e)}}flowScalar(e){if(this.onNewLine){let s=this.source.indexOf(`
`)+1;for(;s!==0;)this.onNewLine(this.offset+s),s=this.source.indexOf(`
`,s)+1}return{type:e,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(e){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken],source:""};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":{this.onKeyLine=!0;const s=Dc(e),n=ca(s);return n.push(this.sourceToken),{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:n,explicitKey:!0}]}}case"map-value-ind":{this.onKeyLine=!0;const s=Dc(e),n=ca(s);return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:n,key:null,sep:[this.sourceToken]}]}}}return null}atIndentedComment(e,s){return this.type!=="comment"||this.indent<=s?!1:e.every(n=>n.type==="newline"||n.type==="space")}*documentEnd(e){this.type!=="doc-mode"&&(e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop()))}*lineEnd(e){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":yield*this.pop(),yield*this.step();break;case"newline":this.onKeyLine=!1;case"space":case"comment":default:e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop())}}}function Ek(t){const e=t.prettyErrors!==!1;return{lineCounter:t.lineCounter||e&&new Ak||null,prettyErrors:e}}function jM(t,e={}){const{lineCounter:s,prettyErrors:n}=Ek(e),i=new wx(s?.addNewLine),a=new jx(e),o=Array.from(a.compose(i.parse(t)));if(n&&s)for(const l of o)l.errors.forEach(Tu(t,s)),l.warnings.forEach(Tu(t,s));return o.length>0?o:Object.assign([],{empty:!0},a.streamInfo())}function Dk(t,e={}){const{lineCounter:s,prettyErrors:n}=Ek(e),i=new wx(s?.addNewLine),a=new jx(e);let o=null;for(const l of a.compose(i.parse(t),!0,t.length))if(!o)o=l;else if(o.options.logLevel!=="silent"){o.errors.push(new ji(l.range.slice(0,2),"MULTIPLE_DOCS","Source contains multiple documents; please use YAML.parseAllDocuments()"));break}return n&&s&&(o.errors.forEach(Tu(t,s)),o.warnings.forEach(Tu(t,s))),o}function wM(t,e,s){let n;typeof e=="function"?n=e:s===void 0&&e&&typeof e=="object"&&(s=e);const i=Dk(t,s);if(!i)return null;if(i.warnings.forEach(a=>Jv(i.options.logLevel,a)),i.errors.length>0){if(i.options.logLevel!=="silent")throw i.errors[0];i.errors=[]}return i.toJS(Object.assign({reviver:n},s))}function vM(t,e,s){let n=null;if(typeof e=="function"||Array.isArray(e)?n=e:s===void 0&&e&&(s=e),typeof s=="string"&&(s=s.length),typeof s=="number"){const i=Math.round(s);s=i<1?void 0:i>8?{indent:8}:{indent:i}}if(t===void 0){const{keepUndefined:i}=s??e??{};if(!i)return}return Zi(t)&&!n?t.toString(s):new uh(t,n,s).toString(s)}const Mk=Object.freeze(Object.defineProperty({__proto__:null,Alias:th,CST:gM,Composer:jx,Document:uh,Lexer:_k,LineCounter:Ak,Pair:Gt,Parser:wx,Scalar:fe,Schema:mk,YAMLError:yx,YAMLMap:As,YAMLParseError:ji,YAMLSeq:Qr,YAMLWarning:gk,isAlias:ai,isCollection:Xe,isDocument:Zi,isMap:mo,isNode:nt,isPair:Qe,isScalar:Oe,isSeq:po,parse:wM,parseAllDocuments:jM,parseDocument:Dk,stringify:vM,visit:Qi,visitAsync:eh},Symbol.toStringTag,{value:"Module"})),kM={type:"object",properties:{question:{type:"string",required:!0},options:{type:"array",items:{type:"string"},minItems:4,maxItems:4,required:!0},answerIndex:{type:"number",minimum:0,maximum:3,required:!0},explanation:{type:"string"}}};function NM(){const t=pe(),{mutate:e}=Hi(),[s,n]=j.useState(null),[i,a]=j.useState(null),[o,l]=j.useState(null),[c,u]=j.useState({}),[d,h]=j.useState({activityId:null,sectionId:null}),[f,m]=j.useState(null),[p,x]=j.useState({open:!1,activity:null}),[g,y]=j.useState({open:!1,quiz:null,activityId:null,sectionId:null,sectionTitle:null,sectionContent:null}),{data:b}=Y({resource:"topics",filters:s?[{field:"course_id",operator:"eq",value:s}]:[],sorters:[{field:"position",order:"asc"}],pagination:{pageSize:500},queryOptions:{enabled:!!s}}),{data:w,refetch:S}=Y({resource:"activities",filters:i?[{field:"topic_id",operator:"eq",value:i},{field:"type",operator:"eq",value:"material"}]:[],sorters:[{field:"position",order:"asc"}],pagination:{pageSize:100},meta:{select:"*, topics(title, position, courses(title))"},queryOptions:{enabled:!!i}}),z=_=>_.split(/\n(?=##\s+)/g).map((E,M)=>{const O=E.match(/^##\s+(.+?)$/m),R=O?O[1].trim():`Sekcja ${M+1}`,B=E.replace(/^##\s+.+?\n/,"").trim(),K=R.toLowerCase().replace(/[^\p{Letter}\p{Number}]+/gu,"-").replace(/(^-|-$)/g,"")||`section-${M}`,$=/```quiz[\s\S]*?```/g.test(B);return{id:K,title:R,content:B,hasQuiz:$}}),N=_=>{const A=_.match(/```quiz\s*?\n([\s\S]*?)```/);if(!A)return null;try{const E=A[1],M=Mk.parse(E);if(M.question&&Array.isArray(M.options)&&typeof M.answerIndex=="number")return M}catch(E){console.error("Failed to parse quiz:",E)}return null},k=(_,A)=>{u(E=>({...E,[_]:E[_]===A?null:A}))},C=async(_,A,E,M)=>{h({activityId:_.id,sectionId:A});try{const O=`
Jesteś ekspertem od tworzenia pytań kontrolnych do materiałów edukacyjnych.

KONTEKST LEKCJI:
- Tytuł materiału: ${_.title}
- Kurs: ${_.topics?.courses?.title||"Kurs"}
- Temat: ${_.topics?.title||"Temat"}

SEKCJA DO KTÓREJ TWORZYSZ PYTANIE:
- Tytuł sekcji: ${E}
- Treść sekcji:
"""
${M}
"""

WYTYCZNE:
1. Pytanie MUSI sprawdzać zrozumienie KLUCZOWEGO konceptu z tej konkretnej sekcji
2. Pytanie powinno być jasne i jednoznaczne
3. Opcje odpowiedzi powinny być wiarygodne (dystraktory podobne do poprawnej odpowiedzi)
4. Poziom trudności: średni (nie za łatwe, nie za trudne)
5. Unikaj pytań typu "wszystkie powyższe" lub "żadne z powyższych"
6. Pytanie powinno testować ZROZUMIENIE, nie pamięć faktów
7. Język pytania dopasuj do wieku uczniów (liceum/technikum)

WAŻNE:
- answerIndex to indeks poprawnej odpowiedzi (0-3)
- options to dokładnie 4 opcje odpowiedzi
- explanation to krótkie wyjaśnienie dlaczego ta odpowiedź jest poprawna

Wygeneruj jedno pytanie kontrolne w formacie JSON.
      `.trim(),R=await Ji(O,kM);if(R&&R.question&&R.options&&typeof R.answerIndex=="number")y({open:!0,quiz:{question:R.question,options:R.options,answerIndex:R.answerIndex},activityId:_.id,sectionId:A,sectionTitle:E,sectionContent:M});else throw new Error("Nieprawidłowa struktura wygenerowanego pytania")}catch(O){console.error("Error generating quiz:",O),G.error("Nie udało się wygenerować pytania")}finally{h({activityId:null,sectionId:null})}},T=async()=>{if(!(!g.quiz||!g.activityId||!g.sectionId)){m(g.activityId);try{const _=w?.data?.find(B=>B.id===g.activityId);if(!_)throw new Error("Nie znaleziono aktywności");const E=z(_.content).findIndex(B=>B.id===g.sectionId);if(E===-1)throw new Error("Nie znaleziono sekcji");const M=`\`\`\`quiz
question: "${g.quiz.question}"
options:
${g.quiz.options.map(B=>`  - "${B}"`).join(`
`)}
answerIndex: ${g.quiz.answerIndex}
\`\`\``;let O=_.content;const R=O.split(/\n(?=##\s+)/g);R[E]&&(R[E]=R[E].replace(/```quiz[\s\S]*?```/g,""),R[E]=R[E].trim()+`

`+M),O=R.join(`
`),await new Promise((B,K)=>{e({resource:"activities",id:g.activityId.toString(),values:{content:O}},{onSuccess:()=>{G.success("Pytanie kontrolne zostało dodane!"),y({open:!1,quiz:null,activityId:null,sectionId:null,sectionTitle:null,sectionContent:null}),S(),B()},onError:$=>{console.error("Error updating activity:",$),K($)}})})}catch(_){console.error("Error saving quiz:",_),G.error("Nie udało się zapisać pytania")}finally{m(null)}}},v=_=>{x({open:!0,activity:_})};return r.jsxs(X,{children:[r.jsx(je,{title:"Krok 4 (opcjonalny)",description:"Dodaj pytania kontrolne do wygenerowanych materiałów"}),r.jsxs("div",{className:"grid gap-6 lg:grid-cols-[300px,1fr]",children:[r.jsxs(P,{className:"h-fit",children:[r.jsx(F,{children:r.jsx(L,{className:"text-base",children:"Wybór materiałów"})}),r.jsxs(I,{className:"space-y-4",children:[r.jsx(hv,{value:s,onChange:_=>{n(_),a(null),l(null),u({})},label:"Kurs",showAlert:!1}),s&&r.jsxs("div",{children:[r.jsx("label",{className:"text-xs font-medium mb-1 block",children:"Temat"}),r.jsxs("select",{value:i||"",onChange:_=>{a(_.target.value?Number(_.target.value):null),l(null),u({})},className:"w-full rounded-md border px-3 py-2 text-sm",children:[r.jsx("option",{value:"",children:"Wybierz temat"}),(b?.data||[]).map(_=>r.jsxs("option",{value:_.id,children:[_.position,". ",_.title]},_.id))]})]}),i&&w?.data&&r.jsxs(we,{children:[r.jsx(cs,{className:"h-4 w-4"}),r.jsxs(ve,{className:"text-xs",children:["Znaleziono ",r.jsx("strong",{children:w.data.length})," materiałów"]})]}),r.jsx(D,{variant:"outline",onClick:()=>t("/admin/educational-material"),className:"w-full",size:"sm",children:"Powrót do panelu"})]})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center gap-2",children:[r.jsx(dt,{className:"w-5 h-5"}),"Materiały do uzupełnienia"]})}),r.jsx(I,{children:i?w?.data?.length?r.jsx("div",{className:"space-y-4",children:w.data.map(_=>{const A=z(_.content),E=A.filter(O=>O.hasQuiz).length,M=o===_.id;return r.jsxs("div",{className:"rounded-lg border overflow-hidden",children:[r.jsx("button",{onClick:()=>l(M?null:_.id),className:"w-full p-4 text-left hover:bg-muted/50 transition-colors",children:r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium",children:_.title}),r.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[r.jsxs("span",{className:"text-xs text-muted-foreground",children:[A.length," sekcji"]}),E>0&&r.jsxs(V,{variant:"secondary",className:"text-xs",children:[r.jsx(dt,{className:"w-3 h-3 mr-1"}),E," ",E===1?"pytanie":"pytań"]}),_.is_published&&r.jsxs(V,{variant:"default",className:"text-xs",children:[r.jsx(Tt,{className:"w-3 h-3 mr-1"}),"Opublikowany"]})]})]}),r.jsx(He,{className:`w-5 h-5 text-muted-foreground transition-transform ${M?"rotate-90":""}`})]})}),M&&r.jsx("div",{className:"border-t",children:r.jsxs(tx,{defaultValue:"sections",className:"w-full",children:[r.jsxs(Qd,{className:"w-full justify-start rounded-none border-b",children:[r.jsx(Ks,{value:"sections",children:"Sekcje i pytania"}),r.jsx(Ks,{value:"preview",children:"Podgląd"})]}),r.jsx(Hs,{value:"sections",className:"p-4 space-y-3",children:A.map(O=>{const R=N(O.content),B=d.activityId===_.id&&d.sectionId===O.id,K=c[_.id]===O.id;return r.jsxs("div",{className:"rounded-lg border overflow-hidden",children:[r.jsxs("div",{className:"flex items-start justify-between p-3 gap-3",children:[r.jsxs("button",{onClick:()=>k(_.id,O.id),className:"flex-1 flex items-start gap-2 text-left hover:opacity-70 transition-opacity",children:[K?r.jsx(ls,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-muted-foreground"}):r.jsx(He,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-muted-foreground"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h4",{className:"font-medium text-sm",children:O.title}),R&&r.jsxs(V,{variant:"secondary",className:"text-xs mt-1",children:[r.jsx(dt,{className:"w-3 h-3 mr-1"}),"Zawiera pytanie"]})]})]}),r.jsx("div",{className:"flex-shrink-0",children:R?r.jsxs(D,{size:"sm",variant:"outline",onClick:()=>C(_,O.id,O.title,O.content),disabled:B,children:[B?r.jsx(qt,{className:"w-3 h-3 animate-spin"}):r.jsx(yl,{className:"w-3 h-3"}),r.jsx("span",{className:"ml-1",children:"Zamień"})]}):r.jsxs(D,{size:"sm",onClick:()=>C(_,O.id,O.title,O.content),disabled:B,children:[B?r.jsx(qt,{className:"w-3 h-3 animate-spin"}):r.jsx(Je,{className:"w-3 h-3"}),r.jsx("span",{className:"ml-1",children:"Dodaj pytanie"})]})})]}),K&&r.jsx("div",{className:"border-t bg-muted/30",children:r.jsx(bt,{className:"max-h-[300px]",children:r.jsxs("div",{className:"p-4",children:[r.jsx("div",{className:"prose prose-sm max-w-none dark:prose-invert",children:r.jsx(Va,{remarkPlugins:[Ga],children:O.content.replace(/```quiz[\s\S]*?```/g,"")})}),R&&r.jsx("div",{className:"mt-4 p-3 bg-background rounded-lg border",children:r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx(dt,{className:"w-4 h-4 mt-0.5 text-primary flex-shrink-0"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("p",{className:"font-medium text-sm mb-2",children:R.question}),r.jsx("div",{className:"space-y-1",children:R.options.map(($,J)=>r.jsxs("div",{className:`text-xs p-2 rounded ${J===R.answerIndex?"bg-green-100 dark:bg-green-900/30 text-green-900 dark:text-green-100 font-medium":"bg-muted"}`,children:[J+1,". ",$,J===R.answerIndex&&" ✓"]},J))})]})]})})]})})})]},O.id)})}),r.jsxs(Hs,{value:"preview",className:"p-4",children:[r.jsxs(D,{variant:"outline",className:"w-full mb-4",onClick:()=>v(_),children:[r.jsx(Tt,{className:"w-4 h-4 mr-2"}),"Otwórz podgląd w pełnym oknie"]}),r.jsx(bt,{className:"h-[400px] rounded-lg border p-4",children:r.jsx("div",{className:"prose prose-sm max-w-none dark:prose-invert",children:r.jsx(Va,{remarkPlugins:[Ga],children:_.content})})})]})]})})]},_.id)})}):r.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[r.jsx(cs,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),r.jsx("p",{className:"text-sm",children:"Brak materiałów w wybranym temacie"})]}):r.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[r.jsx(dt,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),r.jsx("p",{className:"text-sm",children:"Wybierz kurs i temat aby zobaczyć materiały"})]})})]})]}),r.jsx(pn,{open:p.open,onOpenChange:_=>{_||x({open:!1,activity:null})},children:r.jsxs(en,{className:"max-w-4xl max-h-[90vh]",children:[r.jsxs(tn,{children:[r.jsx(sn,{children:p.activity?.title}),r.jsxs(Ha,{children:[p.activity?.topics?.courses?.title," → ",p.activity?.topics?.title]})]}),p.activity&&r.jsx(Xd,{content:p.activity.content,metadata:{duration_min:p.activity.duration_min,position:p.activity.position,created_at:p.activity.created_at,updated_at:p.activity.updated_at},showMetadata:!0,height:"500px"})]})}),r.jsx(pn,{open:g.open,onOpenChange:_=>{!_&&!f&&y({open:!1,quiz:null,activityId:null,sectionId:null,sectionTitle:null,sectionContent:null})},children:r.jsxs(en,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[r.jsxs(tn,{children:[r.jsx(sn,{children:"Wygenerowane pytanie kontrolne"}),r.jsxs(Ha,{children:["Sekcja: ",g.sectionTitle]})]}),g.quiz&&r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"rounded-lg border p-4 bg-muted/50",children:[r.jsx("p",{className:"font-medium mb-3 break-words",children:g.quiz.question}),r.jsx("div",{className:"space-y-2",children:g.quiz.options.map((_,A)=>r.jsxs("div",{className:`flex items-center gap-2 p-2 rounded ${A===g.quiz?.answerIndex?"bg-green-100 dark:bg-green-900/30 border border-green-300":""}`,children:[r.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center flex-shrink-0 ${A===g.quiz?.answerIndex?"border-green-500 bg-green-500":"border-gray-300"}`,children:A===g.quiz?.answerIndex&&r.jsx(ws,{className:"w-3 h-3 text-white"})}),r.jsx("span",{className:"text-sm break-words",children:_})]},A))})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium mb-2",children:"Kod YAML (do wstawienia):"}),r.jsx("div",{className:"rounded-lg border bg-background p-3 font-mono text-xs max-h-[300px] overflow-auto",children:r.jsx("pre",{className:"whitespace-pre-wrap break-words",children:`\`\`\`quiz
question: "${g.quiz.question}"
options:
${g.quiz.options.map(_=>`  - "${_}"`).join(`
`)}
answerIndex: ${g.quiz.answerIndex}
\`\`\``})})]}),r.jsxs("div",{className:"flex justify-end gap-2",children:[r.jsx(D,{variant:"outline",onClick:()=>y({open:!1,quiz:null,activityId:null,sectionId:null,sectionTitle:null,sectionContent:null}),disabled:f!==null,children:"Anuluj"}),r.jsxs(D,{variant:"outline",onClick:()=>{if(g.activityId&&g.sectionId&&g.sectionTitle&&g.sectionContent){const _=w?.data?.find(A=>A.id===g.activityId);_&&C(_,g.sectionId,g.sectionTitle,g.sectionContent)}},disabled:f!==null,children:[r.jsx(yl,{className:"w-4 h-4 mr-1"}),"Wygeneruj ponownie"]}),r.jsx(D,{onClick:T,disabled:f!==null,children:f?r.jsxs(r.Fragment,{children:[r.jsx(qt,{className:"w-4 h-4 mr-1 animate-spin"}),"Zapisywanie..."]}):r.jsxs(r.Fragment,{children:[r.jsx(Jr,{className:"w-4 h-4 mr-1"}),"Zapisz pytanie"]})})]})]})]})})]})}const SM=[r.jsx(Z,{path:"/educational-material",element:r.jsx(YT,{})},"em-dashboard"),r.jsx(Z,{path:"/educational-material/step1",element:r.jsx(lD,{})},"em-step1"),r.jsx(Z,{path:"/educational-material/step2",element:r.jsx(fD,{})},"em-step2"),r.jsx(Z,{path:"/educational-material/step3",element:r.jsx(mD,{})},"em-step3"),r.jsx(Z,{path:"/educational-material/step4",element:r.jsx(NM,{})},"em-step4")],ty={name:"educational-material",list:"/educational-material",create:"/educational-material/step1",meta:{canDelete:!1,label:"Kreator materiałów",icon:r.jsx(Se,{className:"h-4 w-4"})}};function CM(){return r.jsxs(X,{children:[r.jsx(je,{title:"Kreator quizów — panel",description:"Wygeneruj pytania na podstawie istniejących materiałów edukacyjnych"}),r.jsxs("div",{className:"relative overflow-hidden rounded-2xl border mb-6",children:[r.jsx("div",{className:"absolute inset-0 bg-cyan-50"}),r.jsxs("div",{className:"relative px-6 py-8 flex items-center gap-3",children:[r.jsx("div",{className:"shrink-0 inline-flex h-10 w-10 items-center justify-center rounded-xl bg-black text-white",children:r.jsx(ri,{className:"w-5 h-5"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h1",{className:"text-xl sm:text-2xl font-semibold leading-tight",children:"Kreator quizów"}),r.jsx("p",{className:"text-sm text-zinc-600",children:"Wybierz kurs, temat i materiał, a potem wygeneruj zestaw pytań wielokrotnego wyboru z poprawnymi odpowiedziami i wyjaśnieniami."})]}),r.jsx("div",{className:"hidden md:block",children:r.jsx(D,{asChild:!0,children:r.jsxs(Ke,{to:"/admin/quiz-wizard/step1",className:"inline-flex items-center gap-2",children:["Nowa sesja",r.jsx(He,{className:"w-4 h-4"})]})})})]})]}),r.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[r.jsxs(P,{children:[r.jsxs(F,{children:[r.jsxs(L,{className:"flex items-center gap-2",children:[r.jsx(Jt,{className:"w-5 h-5"}),"Szybki start"]}),r.jsx(Jd,{children:"3 kroki do gotowego quizu"})]}),r.jsxs(I,{className:"space-y-3 text-sm",children:[r.jsxs("ol",{className:"list-decimal list-inside space-y-1 text-zinc-700",children:[r.jsx("li",{children:"Wybierz kurs → temat → materiał (Markdown)."}),r.jsx("li",{children:"Ustaw parametry (liczba pytań, poziom trudności, wyjaśnienia)."}),r.jsxs("li",{children:["Wygeneruj pytania i zapisz quiz do bazy (Supabase) jako aktywność typu ",r.jsx("code",{children:"quiz"}),"."]})]}),r.jsx(D,{asChild:!0,className:"w-full",children:r.jsxs(Ke,{to:"/admin/quiz-wizard/step1",className:"inline-flex items-center gap-2",children:["Przejdź do kroku 1",r.jsx(He,{className:"w-4 h-4"})]})})]})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center gap-2",children:[r.jsx(dt,{className:"w-5 h-5"}),"Jak generujemy pytania?"]})}),r.jsxs(I,{className:"space-y-3 text-sm text-muted-foreground",children:[r.jsx("p",{children:"Model analizuje treść materiału i tworzy pytania sprawdzające zrozumienie kluczowych koncepcji."}),r.jsx("p",{children:"Format generatu: JSON → zapis w treści aktywności jako YAML (lista pytań)."}),r.jsxs(we,{children:[r.jsx(Gi,{className:"h-4 w-4"}),r.jsx(ve,{className:"text-xs",children:"Quiz jest tworzony w tym samym temacie co materiał. Możesz go później przypisać do grup uczniów."})]})]})]})]})]})}function zM({topicId:t,selectedMaterialId:e,onSelectMaterial:s,showPreview:n=!1,showMaterialCount:i=!1,highlightColor:a="blue",className:o=""}){const[l,c]=j.useState(""),[u,d]=j.useState({open:!1,material:null}),{data:h,isLoading:f}=Y({resource:"activities",filters:t?[{field:"topic_id",operator:"eq",value:t},{field:"type",operator:"eq",value:"material"}]:[],sorters:[{field:"position",order:"asc"}],pagination:{pageSize:1e3},meta:{select:n?"id,topic_id,title,position,is_published,content,duration_min,created_at":"id,topic_id,title,position,is_published"},queryOptions:{enabled:!!t}}),m=j.useMemo(()=>{const y=h?.data||[];if(!l.trim())return y;const b=l.toLowerCase();return y.filter(w=>String(w.title).toLowerCase().includes(b)||String(w.position).includes(b))},[h?.data,l]),p=(y,b)=>{b.stopPropagation(),n&&d({open:!0,material:y})},g={blue:{selected:"bg-blue-50/60 ring-1 ring-blue-200",radio:"bg-blue-500 border-blue-500"},cyan:{selected:"bg-cyan-50/60 ring-1 ring-cyan-200",radio:"bg-cyan-500 border-cyan-500"}}[a];return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:`rounded-lg border ${o}`,children:[r.jsxs("div",{className:"flex items-center gap-2 p-2 border-b bg-muted/40",children:[r.jsx(uo,{className:"w-4 h-4 text-muted-foreground"}),r.jsx(te,{value:l,onChange:y=>c(y.target.value),placeholder:"Filtruj materiały…",className:"h-8"})]}),r.jsxs("div",{className:"divide-y",children:[f&&r.jsx("div",{className:"p-3 text-xs text-muted-foreground",children:"Ładowanie materiałów…"}),!f&&m.length===0&&r.jsx("div",{className:"p-3 text-xs text-muted-foreground",children:l?"Brak wyników dla filtru.":"Brak materiałów w tym temacie."}),m.map(y=>{const b=e===y.id;return r.jsx("button",{type:"button",onClick:()=>s(y.id),className:["w-full text-left p-3 hover:bg-muted/50 transition",b?g.selected:""].join(" "),children:r.jsxs("div",{className:"flex items-start justify-between gap-3",children:[r.jsxs("div",{className:"min-w-0 flex-1",children:[r.jsxs("div",{className:"text-sm font-medium flex items-center gap-2",children:[r.jsx("span",{className:"shrink-0 inline-flex items-center justify-center w-5 h-5 rounded-full bg-primary/10 text-xs font-semibold",children:y.position}),r.jsx("span",{className:"truncate",children:y.title}),!y.is_published&&r.jsx(V,{variant:"outline",className:"text-xs shrink-0",children:r.jsx(ii,{className:"w-3 h-3"})})]}),n&&r.jsxs("button",{onClick:w=>p(y,w),className:"mt-1 ml-7 text-xs text-primary/70 hover:text-primary hover:underline inline-flex items-center gap-1",children:[r.jsx(Tt,{className:"w-3 h-3"}),"Zobacz treść"]}),i&&y.duration_min&&r.jsxs("div",{className:"mt-1 ml-7 text-xs text-muted-foreground",children:[r.jsx(cs,{className:"w-3 h-3 inline mr-1"}),y.duration_min," min"]})]}),r.jsx("div",{className:["shrink-0 w-3 h-3 rounded-full border mt-1",b?g.radio:"bg-white"].join(" "),"aria-hidden":!0})]})},y.id)})]}),r.jsxs("div",{className:"p-2 border-t text-[11px] text-muted-foreground",children:["Kliknij materiał",n?" lub zobacz treść":"",", aby go wybrać."]})]}),n&&r.jsx(pn,{open:u.open,onOpenChange:y=>{y||d({open:!1,material:null})},children:r.jsxs(en,{className:"max-w-6xl max-h-[90vh]",children:[r.jsxs(tn,{children:[r.jsxs(sn,{className:"flex items-center gap-2",children:[r.jsx(Tt,{className:"w-5 h-5"}),u.material?.title]}),r.jsxs(Ha,{children:["Podgląd materiału • ",u.material?.duration_min||20," min"]})]}),u.material&&r.jsx(Xd,{content:u.material.content,metadata:{duration_min:u.material.duration_min,position:u.material.position,created_at:u.material.created_at},showMetadata:!0,height:"500px"})]})})]})}const _M={type:"object",properties:{courseId:{type:"number",required:!0},topicId:{type:"number",required:!0},materialId:{type:"number",required:!0},count:{type:"number"},difficulty:{type:"string"},includeExplanations:{type:"boolean"},randomized:{type:"boolean"},passingScore:{type:"number"},timeLimit:{type:"number"},maxAttempts:{type:"number"}}};function AM(){const{registerStep:t,setStepData:e,getStepData:s}=In(),n=pe(),i=s("qw_step1")||{},[a,o]=j.useState(!0);j.useEffect(()=>{t("qw_step1",_M),i.count||e("qw_step1",{count:10,difficulty:"mixed",includeExplanations:!0,randomized:!0,passingScore:70,timeLimit:void 0,maxAttempts:void 0})},[]);const{data:l}=Y({resource:"courses",filters:a?[{field:"is_published",operator:"eq",value:!0}]:[],sorters:[{field:"created_at",order:"desc"}],pagination:{pageSize:100}}),{data:c}=Y({resource:"topics",filters:[{field:"course_id",operator:"eq",value:i.courseId||-1}],sorters:[{field:"position",order:"asc"}],pagination:{pageSize:500},queryOptions:{enabled:!!i.courseId}}),u=!!i.courseId&&!!i.topicId&&!!i.materialId;return r.jsxs(X,{children:[r.jsx(je,{title:"Krok 1",description:"Wybór materiału oraz parametrów quizu"}),r.jsxs("div",{className:"grid gap-6 lg:grid-cols-[1.2fr,0.8fr]",children:[r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Kurs → temat → materiał"})}),r.jsxs(I,{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted rounded-lg",children:[r.jsx(mt,{checked:a,onCheckedChange:d=>o(!!d)}),r.jsx("label",{className:"text-sm cursor-pointer",children:"Tylko opublikowane kursy"})]}),r.jsxs(Ee,{value:i.courseId?String(i.courseId):"",onValueChange:d=>e("qw_step1",{courseId:Number(d),topicId:void 0,materialId:void 0}),children:[r.jsx(_e,{children:r.jsx(De,{placeholder:"Wybierz kurs"})}),r.jsx(Ae,{children:(l?.data||[]).map(d=>r.jsx(ee,{value:String(d.id),children:r.jsxs("div",{className:"flex items-center gap-2",children:[d.icon_emoji?`${d.icon_emoji} `:"📚 ",r.jsx("span",{children:d.title}),!d.is_published&&r.jsxs(V,{variant:"outline",className:"ml-2 text-xs",children:[r.jsx(ii,{className:"w-3 h-3"}),"Szkic"]})]})},d.id))})]}),r.jsxs(Ee,{value:i.topicId?String(i.topicId):"",onValueChange:d=>e("qw_step1",{topicId:Number(d),materialId:void 0}),disabled:!i.courseId,children:[r.jsx(_e,{children:r.jsx(De,{placeholder:"Wybierz temat"})}),r.jsx(Ae,{children:(c?.data||[]).map(d=>r.jsxs(ee,{value:String(d.id),children:[d.position,". ",d.title]},d.id))})]}),i.topicId&&r.jsx(zM,{topicId:i.topicId,selectedMaterialId:i.materialId||null,onSelectMaterial:d=>e("qw_step1",{materialId:d}),showPreview:!0,highlightColor:"cyan"})]})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Parametry generowania"})}),r.jsxs(I,{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(k_,{className:"w-4 h-4 text-muted-foreground"}),r.jsx("span",{className:"text-sm text-muted-foreground",children:"Steruj zakresem i poziomem pytań"})]}),r.jsxs("div",{children:[r.jsx("div",{className:"text-xs mb-1",children:"Liczba pytań"}),r.jsx(te,{type:"number",min:3,max:30,value:i.count??10,onChange:d=>e("qw_step1",{count:Number(d.target.value)})})]}),r.jsxs("div",{children:[r.jsx("div",{className:"text-xs mb-1",children:"Poziom trudności"}),r.jsxs(Ee,{value:i.difficulty||"mixed",onValueChange:d=>e("qw_step1",{difficulty:d}),children:[r.jsx(_e,{children:r.jsx(De,{placeholder:"Wybierz poziom"})}),r.jsxs(Ae,{children:[r.jsx(ee,{value:"mixed",children:"Mieszany"}),r.jsx(ee,{value:"easy",children:"Łatwy"}),r.jsx(ee,{value:"medium",children:"Średni"}),r.jsx(ee,{value:"hard",children:"Trudny"})]})]})]}),r.jsxs("div",{className:"border-t pt-3 space-y-3",children:[r.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Parametry quizu"}),r.jsxs("div",{children:[r.jsxs("div",{className:"text-xs mb-1",children:["Wynik zaliczający (%)",r.jsx("span",{className:"text-muted-foreground ml-1",children:"domyślnie: 70%"})]}),r.jsx(te,{type:"number",min:0,max:100,value:i.passingScore??70,onChange:d=>e("qw_step1",{passingScore:Number(d.target.value)})})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"text-xs mb-1",children:["Limit czasu (minuty)",r.jsx("span",{className:"text-muted-foreground ml-1",children:"opcjonalne"})]}),r.jsx(te,{type:"number",min:1,max:180,placeholder:"Brak limitu",value:i.timeLimit??"",onChange:d=>e("qw_step1",{timeLimit:d.target.value?Number(d.target.value):void 0})})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"text-xs mb-1",children:["Max. liczba prób",r.jsx("span",{className:"text-muted-foreground ml-1",children:"opcjonalne"})]}),r.jsx(te,{type:"number",min:1,max:10,placeholder:"Bez limitu",value:i.maxAttempts??"",onChange:d=>e("qw_step1",{maxAttempts:d.target.value?Number(d.target.value):void 0})})]})]}),r.jsxs("div",{className:"border-t pt-3 space-y-2",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(mt,{checked:i.includeExplanations??!0,onCheckedChange:d=>e("qw_step1",{includeExplanations:!!d})}),r.jsx("span",{className:"text-sm",children:"Dodaj wyjaśnienia do poprawnych odpowiedzi"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(mt,{checked:i.randomized??!0,onCheckedChange:d=>e("qw_step1",{randomized:!!d})}),r.jsx("span",{className:"text-sm",children:"Losuj kolejność odpowiedzi"})]})]}),r.jsxs(we,{children:[r.jsx(Gi,{className:"h-4 w-4"}),r.jsx(ve,{className:"text-xs",children:"Pytania będą tworzone na podstawie treści wybranego materiału. Upewnij się, że materiał jest kompletny."})]}),r.jsxs(D,{disabled:!u,className:"w-full",onClick:()=>n("/admin/quiz-wizard/step2"),children:["Kontynuuj",r.jsx(He,{className:"w-4 h-4 ml-1"})]}),!u&&r.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Wybierz kurs, temat i materiał aby kontynuować"})]})]})]})]})}const TM={type:"object",properties:{items:{type:"array",minItems:3,items:{type:"object",properties:{question:{type:"string",required:!0},options:{type:"array",items:{type:"string"},minItems:4,maxItems:4,required:!0},answerIndex:{type:"number",minimum:0,maximum:3,required:!0},explanation:{type:"string"}}},required:!0}}};function EM(){const{getStepData:t,setStepData:e}=In(),s=pe(),n=t("qw_step1"),i=n?.materialId,a=n?.topicId,[o,l]=j.useState(null),[c,u]=j.useState(!1),[d,h]=j.useState(null),[f,m]=j.useState(null),[p,x]=j.useState(!1);j.useEffect(()=>{(!i||!a)&&s("/admin/quiz-wizard/step1")},[i,a,s]);const{data:g}=tt({resource:"activities",id:String(i||""),meta:{select:"*"},queryOptions:{enabled:!!i}}),y=async()=>{if(!g?.data)return;h(null),m(null),x(!1),u(!0),e("qw_step2",{isGenerating:!0});const w=`
Jesteś nauczycielem tworzącym pytania testowe na podstawie materiału edukacyjnego (Markdown).

PARAMETRY QUIZU:
- liczba pytań: ${n.count??10}
- poziom trudności: ${n.difficulty??"mixed"}
- losuj kolejność odpowiedzi: ${n.randomized?"tak":"nie"}
- dodawaj wyjaśnienia: ${n.includeExplanations?"tak":"nie"}

MATERIAŁ (źródło, Markdown):
"""
${g.data.content}
"""

WYTYCZNE:
1) Pytania muszą testować zrozumienie kluczowych idei z materiału (nie pamięciówka).
2) Każde pytanie ma DOKŁADNIE 4 opcje odpowiedzi.
3) answerIndex wskazuje poprawną odpowiedź (0-3).
4) Unikaj opcji "wszystkie/żadne z powyższych".
5) Jeśli "dodawaj wyjaśnienia" = tak → pole explanation ma krótkie uzasadnienie odpowiedzi.
6) Zweryfikuj spójność logiczną i brak wieloznaczności.

ZWRÓĆ WYŁĄCZNIE JSON ze strukturą:
{
  "items": [
    { "question": "...", "options": ["A","B","C","D"], "answerIndex": 0, "explanation": "..." }
  ]
}
    `.trim();try{const S=await Ji(w,TM),z=Array.isArray(S.items)?S.items:[];if(z.length<3)throw new Error("Za mało poprawnych pytań w odpowiedzi modelu.");const N={material_id:g.data.id,topic_id:g.data.topic_id,title:`${g.data.title} — Quiz`,items:z};l(N)}catch(S){const z=S?.message?.toString()?.includes("503")||S?.details?.toString()?.includes?.("503")?"Błąd komunikacji z modelem (503)":S?.message||"Nie udało się wygenerować quizu.";h(z);const N=S?.info??S?.response??{message:S?.message,status:S?.status||S?.statusCode,details:S?.details,raw:S};m(N)}finally{u(!1),e("qw_step2",{isGenerating:!1})}},b=()=>{o&&s("/admin/quiz-wizard/step3",{state:{item:o}})};return r.jsxs(X,{children:[r.jsx(je,{title:"Krok 2",description:"Generowanie pytań na podstawie materiału"}),r.jsxs("div",{className:"grid gap-6 lg:grid-cols-[0.9fr,1.1fr]",children:[r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center gap-2",children:[r.jsx(pt,{className:"w-5 h-5"}),"Panel generowania"]})}),r.jsxs(I,{className:"space-y-4",children:[r.jsxs("div",{className:"rounded-lg bg-muted p-4 space-y-2",children:[r.jsxs("div",{className:"text-sm",children:[r.jsx("span",{className:"text-muted-foreground",children:"Materiał:"})," ",r.jsx("span",{className:"font-medium",children:g?.data?.title||"-"})]}),r.jsxs("div",{className:"flex gap-2 mt-3",children:[r.jsx(V,{variant:"outline",children:n.difficulty??"mixed"}),r.jsx(V,{variant:"outline",children:(n.count??10)+" pytań"}),n.includeExplanations&&r.jsx(V,{variant:"default",children:"Wyjaśnienia"})]})]}),r.jsxs(we,{children:[r.jsx(Se,{className:"h-4 w-4"}),r.jsx(ve,{className:"text-xs",children:"Pytania będą dotyczyły treści wybranego materiału. Możesz je później edytować przed zapisem."})]}),r.jsxs("div",{className:"flex flex-col gap-2",children:[r.jsx(D,{onClick:y,disabled:c,className:"w-full",size:"lg",children:c?r.jsxs(r.Fragment,{children:[r.jsx(qt,{className:"w-4 h-4 mr-2 animate-spin"}),"Generowanie pytań..."]}):r.jsxs(r.Fragment,{children:[r.jsx(Jt,{className:"w-4 h-4 mr-2"}),"Wygeneruj pytania"]})}),r.jsxs(D,{variant:"default",onClick:b,disabled:!o||c,className:"w-full",children:["Przejdź do zapisu",r.jsx(He,{className:"w-4 h-4 ml-1"})]})]}),d&&r.jsxs("div",{className:"space-y-2",children:[r.jsxs(we,{variant:"destructive",children:[r.jsx(st,{className:"h-4 w-4"}),r.jsx(ve,{children:d})]}),f&&r.jsxs(P,{children:[r.jsx(F,{className:"py-3",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx(L,{className:"text-sm",children:"Szczegóły błędu"}),r.jsx(D,{variant:"ghost",size:"sm",onClick:()=>x(w=>!w),className:"h-7",children:p?r.jsx(Ua,{className:"w-4 h-4"}):r.jsx(ls,{className:"w-4 h-4"})})]})}),p&&r.jsx(I,{className:"pt-0",children:r.jsx(mn,{className:"font-mono text-xs h-40",readOnly:!0,value:(()=>{try{return JSON.stringify(f,null,2)}catch{return String(f)}})()})})]})]}),c&&r.jsxs("div",{className:"text-center text-sm text-muted-foreground space-y-1",children:[r.jsx("p",{children:"Analizuję materiał i tworzę pytania..."}),r.jsx("p",{className:"text-xs",children:"To może potrwać kilkanaście sekund"})]})]})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Podgląd pytań"})}),r.jsx(I,{children:o?r.jsx(bt,{className:"h-[500px] rounded-lg border p-4",children:r.jsx("div",{className:"space-y-4",children:o.items.map((w,S)=>r.jsxs("div",{className:"rounded-lg border p-3",children:[r.jsxs("div",{className:"text-sm font-medium mb-2",children:[S+1,". ",w.question]}),r.jsx("ul",{className:"text-sm space-y-1",children:w.options.map((z,N)=>r.jsxs("li",{className:N===w.answerIndex?"font-medium":"",children:[String.fromCharCode(65+N),". ",z," ",N===w.answerIndex?"✓":""]},N))}),w.explanation&&r.jsxs("div",{className:"mt-2 text-xs text-muted-foreground",children:[r.jsx("span",{className:"font-medium",children:"Wyjaśnienie: "}),w.explanation]})]},S))})}):r.jsx("div",{className:"flex flex-col items-center justify-center py-16 text-muted-foreground",children:c?r.jsxs(r.Fragment,{children:[r.jsx(qt,{className:"w-8 h-8 mb-3 animate-spin"}),r.jsx("div",{className:"text-sm",children:"Generowanie pytań..."})]}):r.jsxs(r.Fragment,{children:[r.jsx(Se,{className:"w-8 h-8 mb-3 opacity-50"}),r.jsx("div",{className:"text-sm",children:"Brak wygenerowanych pytań"}),r.jsx("div",{className:"text-xs mt-1",children:'Kliknij "Wygeneruj pytania"'})]})})})]})]})]})}function DM(){const t=pe(),e=gn(),{mutate:s}=hn(),{mutate:n}=hn(),i=j.useMemo(()=>e?.state?.item??null,[e?.state?.item]),a=j.useMemo(()=>{try{const N=localStorage.getItem("formWizard_qw_step1");if(N)return JSON.parse(N)}catch(N){console.error("Failed to parse step1 data:",N)}return{}},[]),[o,l]=j.useState(i?.title??""),[c,u]=j.useState(!1),[d,h]=j.useState(i?.items??[]),[f,m]=j.useState(!1),[p,x]=j.useState(null),[g,y]=j.useState(""),{data:b}=Y({resource:"activities",filters:i?[{field:"topic_id",operator:"eq",value:i.topic_id}]:[],sorters:[{field:"position",order:"desc"}],pagination:{pageSize:1},queryOptions:{enabled:!!i?.topic_id}});j.useEffect(()=>{i||t("/admin/quiz-wizard/step2")},[i,t]);const w=N=>{h(k=>k.filter((C,T)=>T!==N))},S=(N,k,C)=>{h(T=>T.map((v,_)=>_===N?{...v,[k]:C}:v))},z=async()=>{if(i){if(!o||o.trim().length<3){x("Tytuł musi mieć minimum 3 znaki.");return}if(d.length===0){x("Quiz musi mieć przynajmniej jedno pytanie.");return}for(let N=0;N<d.length;N++){const k=d[N];if(!k.question||k.question.trim().length<5){x(`Pytanie ${N+1}: treść pytania jest za krótka (min. 5 znaków).`);return}if(!k.options||k.options.length!==4){x(`Pytanie ${N+1}: musi mieć dokładnie 4 opcje odpowiedzi.`);return}if(k.answerIndex<0||k.answerIndex>3){x(`Pytanie ${N+1}: nieprawidłowy indeks poprawnej odpowiedzi.`);return}for(let C=0;C<k.options.length;C++)if(!k.options[C]||k.options[C].trim().length<1){x(`Pytanie ${N+1}, opcja ${C+1}: nie może być pusta.`);return}}m(!0),x(null),y("Tworzenie aktywności quizu...");try{const N=Number(i.topic_id),k=b?.data?.[0],C=k?.position?Number(k.position)+1:1,T=a.passingScore??70,v=a.timeLimit??null,_=a.maxAttempts??null,A=Math.ceil(d.length*1.5);y("Zapisywanie aktywności...");const E=await new Promise((M,O)=>{s({resource:"activities",values:{topic_id:N,type:"quiz",title:o.trim(),content:null,duration_min:A,passing_score:T,time_limit:v,max_attempts:_,position:C,is_published:c}},{onSuccess:R=>{const B=R?.data?.id;if(B){const K=typeof B=="string"?parseInt(B,10):B;M(K)}else O(new Error("Nie otrzymano ID aktywności"))},onError:R=>O(R)})});y(`Zapisywanie pytań (0/${d.length})...`);for(let M=0;M<d.length;M++){const O=d[M],R=M+1,B=O.question.substring(0,40)+(O.question.length>40?"...":"");y(`Zapisywanie pytania ${R}/${d.length}: "${B}"`);const K=O.options.map(($,J)=>({id:J+1,text:$.trim(),is_correct:J===O.answerIndex}));await new Promise(($,J)=>{n({resource:"questions",values:{activity_id:E,question:O.question.trim(),options:K,points:O.points??1,position:R,explanation:O.explanation?.trim()||null}},{onSuccess:()=>{console.log(`✓ Zapisano pytanie ${R}/${d.length}`),$()},onError:ie=>{console.error(`✗ Błąd zapisu pytania ${R}:`,ie),J(ie)}})}),await new Promise($=>setTimeout($,150))}y(`✓ Zapisano wszystkie pytania (${d.length}/${d.length})`),setTimeout(()=>{t("/admin/quiz-wizard/step4",{state:{activityId:E,title:o,questionsCount:d.length,topicId:N,isPublished:c,passingScore:T,timeLimit:v,maxAttempts:_}})},1500)}catch(N){console.error("Save error:",N),N?.code==="23505"?x("Quiz o tym tytule już istnieje w tym temacie. Zmień tytuł."):N?.code==="23503"?x("Nieprawidłowy temat lub aktywność. Odśwież stronę i spróbuj ponownie."):N?.message?x(N.message):x("Nie udało się zapisać quizu. Spróbuj ponownie."),m(!1),y("")}}};return i?r.jsxs(X,{children:[r.jsx(je,{title:"Krok 3",description:"Edycja i zapis quizu do bazy"}),r.jsxs("div",{className:"grid gap-6 lg:grid-cols-[0.7fr,1.3fr]",children:[r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Ustawienia zapisu"})}),r.jsxs(I,{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium mb-2",children:["Tytuł quizu ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx(te,{value:o,onChange:N=>l(N.target.value),placeholder:"np. Quiz do materiału: Wprowadzenie do ...",disabled:f}),r.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Tytuł będzie widoczny dla uczniów"})]}),r.jsxs("div",{className:"rounded-lg border p-3 space-y-2 text-xs",children:[r.jsx("div",{className:"font-medium",children:"Parametry quizu:"}),r.jsxs("div",{className:"grid grid-cols-2 gap-2 text-muted-foreground",children:[r.jsx("div",{children:"Wynik zaliczający:"}),r.jsxs("div",{className:"font-medium text-foreground",children:[a.passingScore??70,"%"]}),r.jsx("div",{children:"Limit czasu:"}),r.jsx("div",{className:"font-medium text-foreground",children:a.timeLimit?`${a.timeLimit} min`:"Brak"}),r.jsx("div",{children:"Max. prób:"}),r.jsx("div",{className:"font-medium text-foreground",children:a.maxAttempts??"Bez limitu"}),r.jsx("div",{children:"Liczba pytań:"}),r.jsx("div",{className:"font-medium text-foreground",children:d.length})]})]}),r.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[r.jsxs("div",{className:"text-sm",children:[r.jsx("div",{className:"font-medium",children:"Opublikuj od razu"}),r.jsx("div",{className:"text-xs text-muted-foreground",children:"Quiz będzie widoczny dla uczniów"})]}),r.jsx(fs,{checked:c,onCheckedChange:u,disabled:f})]}),p&&r.jsxs(we,{variant:"destructive",children:[r.jsx(st,{className:"h-4 w-4"}),r.jsx(ve,{children:p})]}),g&&r.jsxs(we,{className:"border-blue-200 bg-blue-50",children:[r.jsx(qt,{className:"h-4 w-4 text-blue-600 animate-spin"}),r.jsx(ve,{className:"text-blue-900 text-sm",children:g})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(D,{onClick:z,disabled:f||!o.trim()||d.length===0,className:"flex-1",children:f?r.jsxs(r.Fragment,{children:[r.jsx(qt,{className:"w-4 h-4 mr-2 animate-spin"}),"Zapisywanie..."]}):r.jsxs(r.Fragment,{children:[r.jsx(Jr,{className:"w-4 h-4 mr-2"}),"Zapisz quiz"]})}),r.jsx(D,{asChild:!0,variant:"outline",disabled:f,children:r.jsxs(Ke,{to:"/admin/quiz-wizard/step2",children:[r.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Wróć"]})})]})]})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center justify-between",children:[r.jsxs("span",{children:["Edycja pytań (",d.length,")"]}),r.jsxs(V,{variant:"outline",children:[d.length," pytań"]})]})}),r.jsxs(I,{children:[r.jsx(bt,{className:"h-[600px] pr-4",children:r.jsx("div",{className:"space-y-4",children:d.length===0?r.jsxs(we,{children:[r.jsx(st,{className:"h-4 w-4"}),r.jsx(ve,{children:"Brak pytań w quizie. Wróć do kroku 2 i wygeneruj pytania."})]}):d.map((N,k)=>r.jsxs("div",{className:"rounded-lg border p-4 space-y-3",children:[r.jsxs("div",{className:"flex items-start justify-between gap-2",children:[r.jsxs("div",{className:"flex-1",children:[r.jsxs("label",{className:"text-xs text-muted-foreground",children:["Pytanie ",k+1]}),r.jsx(te,{value:N.question,onChange:C=>S(k,"question",C.target.value),disabled:f,className:"mt-1"})]}),r.jsx(D,{variant:"ghost",size:"sm",onClick:()=>w(k),disabled:f,className:"shrink-0 text-destructive hover:text-destructive",children:r.jsx(St,{className:"w-4 h-4"})})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-xs text-muted-foreground",children:"Odpowiedzi"}),N.options.map((C,T)=>r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:["shrink-0 w-4 h-4 rounded-full border-2 flex items-center justify-center",T===N.answerIndex?"border-green-500 bg-green-500":"border-gray-300"].join(" "),children:T===N.answerIndex&&r.jsx(ws,{className:"w-3 h-3 text-white"})}),r.jsx(te,{value:C,onChange:v=>{const _=[...N.options];_[T]=v.target.value,S(k,"options",_)},disabled:f,className:"flex-1",placeholder:`Opcja ${String.fromCharCode(65+T)}`}),r.jsx(D,{variant:"ghost",size:"sm",onClick:()=>S(k,"answerIndex",T),disabled:f,className:T===N.answerIndex?"text-green-600":"",children:T===N.answerIndex?"✓ Poprawna":"Ustaw"})]},T))]}),N.explanation&&r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-muted-foreground",children:"Wyjaśnienie"}),r.jsx(te,{value:N.explanation,onChange:C=>S(k,"explanation",C.target.value),disabled:f,className:"mt-1"})]}),r.jsxs("div",{className:"flex items-center gap-3 pt-2 border-t",children:[r.jsx("label",{className:"text-xs text-muted-foreground",children:"Punkty:"}),r.jsx(te,{type:"number",min:1,max:10,value:N.points??1,onChange:C=>S(k,"points",Number(C.target.value)),disabled:f,className:"w-20"})]})]},k))})}),r.jsxs("div",{className:"mt-4 text-xs text-muted-foreground",children:["Pytania zostaną zapisane do tabeli ",r.jsx("code",{className:"bg-muted px-1 py-0.5 rounded",children:"questions"})," z referencją do aktywności. Każda opcja będzie miała flagę ",r.jsx("code",{className:"bg-muted px-1 py-0.5 rounded",children:"is_correct"}),"."]})]})]})]})]}):r.jsxs(X,{children:[r.jsx(je,{title:"Krok 3",description:"Zapis quizu"}),r.jsx(P,{children:r.jsx(I,{className:"pt-6",children:r.jsxs(we,{variant:"destructive",children:[r.jsx(st,{className:"h-4 w-4"}),r.jsxs(ve,{children:["Brak danych z poprzedniego kroku.",r.jsx(Ke,{to:"/admin/quiz-wizard/step2",className:"underline ml-1",children:"Wróć do kroku 2"})]})]})})})]})}function MM(){const t=pe(),s=gn()?.state,{data:n}=tt({resource:"topics",id:String(s?.topicId||""),meta:{select:"*, courses(title, icon_emoji)"},queryOptions:{enabled:!!s?.topicId}});if(j.useEffect(()=>{(!s||!s.activityId)&&t("/admin/quiz-wizard")},[s,t]),!s)return r.jsxs(X,{children:[r.jsx(je,{title:"Podsumowanie",description:"Brak danych"}),r.jsx(P,{children:r.jsx(I,{className:"pt-6",children:r.jsx(we,{variant:"destructive",children:r.jsxs(ve,{children:["Brak danych podsumowania.",r.jsx(Ke,{to:"/admin/quiz-wizard",className:"underline ml-1",children:"Wróć do panelu"})]})})})})]});const i=n?.data?.courses,a=n?.data;return r.jsxs(X,{children:[r.jsx(je,{title:"✓ Quiz został zapisany!",description:"Podsumowanie utworzonego quizu"}),r.jsxs("div",{className:"grid gap-6 lg:grid-cols-[1fr,1fr]",children:[r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center gap-2",children:[r.jsx(ws,{className:"w-5 h-5 text-green-600"}),"Informacje o quizie"]})}),r.jsxs(I,{className:"space-y-4",children:[r.jsx("div",{className:"rounded-lg bg-green-50 border border-green-200 p-4",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(ws,{className:"w-6 h-6 text-green-600 shrink-0 mt-0.5"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"font-medium text-green-900 mb-1",children:"Quiz został pomyślnie zapisany"}),r.jsx("div",{className:"text-sm text-green-700",children:"Wszystkie pytania zostały zapisane do bazy danych"})]})]})}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between py-2 border-b",children:[r.jsx("span",{className:"text-sm text-muted-foreground",children:"ID aktywności:"}),r.jsx("code",{className:"text-sm font-mono bg-muted px-2 py-1 rounded",children:s.activityId})]}),r.jsxs("div",{className:"flex items-start justify-between py-2 border-b",children:[r.jsx("span",{className:"text-sm text-muted-foreground",children:"Tytuł:"}),r.jsx("span",{className:"text-sm font-medium text-right max-w-[60%]",children:s.title})]}),r.jsxs("div",{className:"flex items-center justify-between py-2 border-b",children:[r.jsx("span",{className:"text-sm text-muted-foreground",children:"Status:"}),r.jsx(V,{variant:s.isPublished?"default":"outline",children:s.isPublished?"Opublikowany":"Szkic"})]}),i&&a&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"flex items-center justify-between py-2 border-b",children:[r.jsx("span",{className:"text-sm text-muted-foreground",children:"Kurs:"}),r.jsxs("span",{className:"text-sm font-medium",children:[i.icon_emoji," ",i.title]})]}),r.jsxs("div",{className:"flex items-center justify-between py-2 border-b",children:[r.jsx("span",{className:"text-sm text-muted-foreground",children:"Temat:"}),r.jsx("span",{className:"text-sm font-medium",children:a.title})]})]})]})]})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center gap-2",children:[r.jsx(pt,{className:"w-5 h-5"}),"Parametry quizu"]})}),r.jsxs(I,{className:"space-y-4",children:[r.jsxs("div",{className:"grid gap-3",children:[r.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted",children:[r.jsx(Se,{className:"w-5 h-5 text-muted-foreground"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"text-xs text-muted-foreground",children:"Liczba pytań"}),r.jsx("div",{className:"text-lg font-semibold",children:s.questionsCount})]})]}),r.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted",children:[r.jsx(ft,{className:"w-5 h-5 text-muted-foreground"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"text-xs text-muted-foreground",children:"Wynik zaliczający"}),r.jsxs("div",{className:"text-lg font-semibold",children:[s.passingScore,"%"]})]})]}),s.timeLimit&&r.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted",children:[r.jsx(Ze,{className:"w-5 h-5 text-muted-foreground"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"text-xs text-muted-foreground",children:"Limit czasu"}),r.jsxs("div",{className:"text-lg font-semibold",children:[s.timeLimit," min"]})]})]}),s.maxAttempts&&r.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted",children:[r.jsx(N_,{className:"w-5 h-5 text-muted-foreground"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"text-xs text-muted-foreground",children:"Maksymalna liczba prób"}),r.jsx("div",{className:"text-lg font-semibold",children:s.maxAttempts})]})]}),!s.timeLimit&&!s.maxAttempts&&r.jsx(we,{children:r.jsx(ve,{className:"text-xs",children:"Quiz nie ma limitów czasowych ani prób — uczniowie mogą podejść dowolną liczbę razy."})})]}),r.jsxs("div",{className:"pt-4 border-t space-y-2",children:[r.jsx("div",{className:"text-sm font-medium mb-3",children:"Co dalej?"}),r.jsx(D,{asChild:!0,variant:"default",className:"w-full",children:r.jsxs(Ke,{to:"/admin/quiz-wizard/step1",children:[r.jsx(S_,{className:"w-4 h-4 mr-2"}),"Utwórz kolejny quiz"]})}),r.jsx(D,{asChild:!0,variant:"outline",className:"w-full",children:r.jsxs(Ke,{to:"/admin/quiz-wizard",children:[r.jsx(R1,{className:"w-4 h-4 mr-2"}),"Wróć do panelu"]})})]})]})]})]})]})}const PM=[r.jsx(Z,{path:"/quiz-wizard",element:r.jsx(CM,{})},"quiz-dashboard"),r.jsx(Z,{path:"/quiz-wizard/step1",element:r.jsx(AM,{})},"quiz-step1"),r.jsx(Z,{path:"/quiz-wizard/step2",element:r.jsx(EM,{})},"quiz-step2"),r.jsx(Z,{path:"/quiz-wizard/step3",element:r.jsx(DM,{})},"quiz-step3"),r.jsx(Z,{path:"/quiz-wizard/step4",element:r.jsx(MM,{})},"quiz-step4")],sy={name:"quiz-wizard",list:"/quiz-wizard",create:"/quiz-wizard/step1",meta:{canDelete:!1,label:"Kreator quizów",icon:r.jsx(ri,{className:"h-4 w-4"})}},IM=[...lT,...kT,..._T,...QT,...GT,...SM,...PM],OM=()=>r.jsx(Ld,{children:r.jsxs(Z,{element:r.jsx(aT,{children:r.jsx(Kp,{})}),children:[r.jsx(Z,{index:!0,element:r.jsx(dn,{to:"dashboard/overview",replace:!0})}),r.jsx(Z,{path:"dashboard",element:r.jsx(dn,{to:"dashboard/overview",replace:!0})}),IM]})}),RM=j.lazy(()=>Promise.resolve({default:OM})),Pk=({text:t,colorClass:e})=>r.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-background",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:`inline-block h-12 w-12 animate-spin rounded-full border-4 border-current border-r-transparent ${e}`}),r.jsx("p",{className:"mt-4 text-muted-foreground",children:t})]})}),LM=({children:t})=>{const{data:e,isLoading:s}=wt();if(s||!e)return r.jsx(Pk,{text:"Sprawdzanie uprawnień...",colorClass:"border-red-600"});if(e.role!=="admin"){const n=e.role==="teacher"?"/teacher/dashboard":"/student/dashboard";return r.jsx(dn,{to:n,replace:!0})}return r.jsx(r.Fragment,{children:t})},FM=r.jsx(Z,{path:"/admin/*",element:r.jsx(Jp,{fallback:r.jsx(Zp,{to:"/login"}),children:r.jsx(LM,{children:r.jsx(j.Suspense,{fallback:r.jsx(Pk,{text:"Ładowanie panelu administratora...",colorClass:"border-red-600"}),children:r.jsx(RM,{})})})},"admin-auth")}),$M=({onClose:t})=>{const{mutate:e}=$d(),{menuItems:s}=E1(),{data:n}=wt(),i=()=>{t&&t()};return r.jsxs("div",{className:"flex h-full w-64 flex-col border-r bg-background",children:[r.jsxs("div",{className:"flex h-16 items-center justify-between border-b px-6",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(ec,{className:"h-6 w-6 mr-2"}),r.jsx("span",{className:"font-semibold",children:"Smart Up"})]}),t&&r.jsx(D,{variant:"ghost",size:"sm",onClick:t,className:"lg:hidden",children:r.jsx(fn,{className:"h-4 w-4"})})]}),r.jsx(bt,{className:"flex-1 px-3 py-4",children:r.jsx("nav",{className:"space-y-4",children:s.map(a=>r.jsxs("div",{className:"space-y-2",children:[r.jsxs(Ba,{to:a.route??"/",onClick:i,className:({isActive:o})=>U("flex items-center justify-between rounded-md px-3 py-2 text-sm font-semibold transition-colors hover:bg-accent hover:text-accent-foreground",o?"bg-accent text-accent-foreground":"text-foreground"),children:[r.jsxs("span",{className:"flex items-center",children:[a.icon&&r.jsx("span",{className:"mr-3",children:a.icon}),a.label]}),r.jsx(ls,{className:"h-4 w-4 opacity-60"})]}),a.children&&a.children.length>0&&r.jsx("div",{className:"ml-3 border-l pl-3 space-y-1",children:a.children.map(o=>r.jsxs(Ba,{to:o.route??"/",onClick:i,className:({isActive:l})=>U("flex items-center rounded-md px-3 py-2 text-sm transition-colors hover:bg-accent hover:text-accent-foreground",l?"bg-accent text-accent-foreground":"text-muted-foreground"),children:[o.icon&&r.jsx("span",{className:"mr-3",children:o.icon}),o.label]},o.key))})]},a.key))})}),r.jsx(Zd,{}),r.jsx(Y1,{className:"border-b"}),r.jsx("div",{className:"p-4",children:r.jsxs(D,{variant:"outline",size:"sm",onClick:()=>{e(),t&&t()},className:"w-full justify-start",children:[r.jsx(Wd,{className:"mr-2 h-4 w-4"}),"Logout"]})})]})},BM=({children:t})=>{const[e,s]=j.useState(!1),n=()=>{s(!e)};return r.jsx("div",{className:"min-h-screen bg-stone-200 relative overflow-x-hidden",children:r.jsxs("div",{className:"flex relative",children:[e&&r.jsx("div",{className:"fixed inset-0 z-40 bg-purple-900/20 backdrop-blur-sm lg:hidden",onClick:()=>s(!1)}),r.jsx("aside",{className:`
            h-screen w-64 transform transition-transform duration-300 ease-in-out
            fixed left-0 top-0 z-50
            ${e?"translate-x-0":"-translate-x-full"}
            lg:translate-x-0
            bg-background/95 backdrop-blur-md border-r border-purple-200/20
          `,children:r.jsx($M,{onClose:()=>s(!1)})}),r.jsxs("main",{className:"flex-1 lg:ml-64 min-w-0 relative z-10",children:[r.jsxs("div",{className:"sticky top-0 z-30 flex h-16 items-center border-b border-purple-200/20 bg-background/80 backdrop-blur-md px-4 lg:hidden",children:[r.jsx(D,{variant:"ghost",size:"sm",onClick:n,className:"mr-2 hover:bg-purple-100/20 hover:text-purple-700",children:r.jsx(ec,{className:"h-6 w-6"})}),r.jsx("span",{className:"font-semibold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:"Smart Up"})]}),t]})]})})},qM=()=>{const{data:t}=wt(),e=pe(),{data:s}=Y({resource:"groups",filters:[{field:"vendor_id",operator:"eq",value:t?.vendor_id}],pagination:{current:1,pageSize:5}}),{data:n}=Y({resource:"courses",filters:[{field:"vendor_id",operator:"eq",value:t?.vendor_id}],pagination:{current:1,pageSize:5}}),{data:i}=Y({resource:"users",filters:[{field:"vendor_id",operator:"eq",value:t?.vendor_id},{field:"role",operator:"eq",value:"student"}],pagination:{current:1,pageSize:5}});return r.jsxs(X,{children:[r.jsx(je,{title:`Witaj, ${t?.full_name||"Nauczycielu"}!`,description:"Szybki przegląd systemu"}),r.jsxs(Pt,{variant:"1-2-3",children:[r.jsxs(P,{children:[r.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(L,{className:"text-sm font-medium",children:"Grupy"}),r.jsx(ge,{className:"h-4 w-4 text-muted-foreground"})]}),r.jsxs(I,{children:[r.jsx("div",{className:"text-2xl font-bold",children:s?.total||0}),r.jsxs(D,{variant:"link",size:"sm",className:"px-0 h-auto text-xs",onClick:()=>e("/teacher/groups"),children:["Zarządzaj grupami",r.jsx(Ue,{className:"w-3 h-3 ml-1"})]})]})]}),r.jsxs(P,{children:[r.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(L,{className:"text-sm font-medium",children:"Kursy"}),r.jsx(Se,{className:"h-4 w-4 text-muted-foreground"})]}),r.jsxs(I,{children:[r.jsx("div",{className:"text-2xl font-bold",children:n?.total||0}),r.jsxs(D,{variant:"link",size:"sm",className:"px-0 h-auto text-xs",onClick:()=>e("/teacher/courses"),children:["Przeglądaj kursy",r.jsx(Ue,{className:"w-3 h-3 ml-1"})]})]})]}),r.jsxs(P,{children:[r.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(L,{className:"text-sm font-medium",children:"Uczniowie"}),r.jsx(cr,{className:"h-4 w-4 text-muted-foreground"})]}),r.jsxs(I,{children:[r.jsx("div",{className:"text-2xl font-bold",children:i?.total||0}),r.jsxs(D,{variant:"link",size:"sm",className:"px-0 h-auto text-xs",onClick:()=>e("/teacher/users"),children:["Zobacz uczniów",r.jsx(Ue,{className:"w-3 h-3 ml-1"})]})]})]})]}),r.jsxs(Pt,{variant:"1-2-2",children:[s?.data&&s.data.length>0&&r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Twoje grupy"})}),r.jsx(I,{children:r.jsx("div",{className:"space-y-2",children:s.data.slice(0,5).map(a=>r.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 cursor-pointer transition-colors",onClick:()=>e(`/teacher/groups/show/${a.id}`),children:[r.jsxs("div",{children:[r.jsx("div",{className:"font-medium",children:a.name}),r.jsx("div",{className:"text-sm text-muted-foreground",children:a.academic_year})]}),r.jsx(Ue,{className:"w-4 h-4 text-muted-foreground"})]},a.id))})})]}),n?.data&&n.data.length>0&&r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Twoje kursy"})}),r.jsx(I,{children:r.jsx("div",{className:"space-y-2",children:n.data.slice(0,5).map(a=>r.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 cursor-pointer transition-colors",onClick:()=>e(`/teacher/courses/show/${a.id}`),children:[r.jsxs("div",{className:"flex items-center gap-3",children:[a.icon_emoji&&r.jsx("span",{className:"text-2xl",children:a.icon_emoji}),r.jsxs("div",{children:[r.jsx("div",{className:"font-medium",children:a.title}),r.jsx("div",{className:"text-sm text-muted-foreground",children:a.is_published?"Opublikowany":"Szkic"})]})]}),r.jsx(Ue,{className:"w-4 h-4 text-muted-foreground"})]},a.id))})})]})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Szybkie akcje"})}),r.jsxs(I,{className:"grid gap-3",children:[r.jsxs(D,{variant:"outline",className:"justify-start h-auto py-3",onClick:()=>e("/teacher/courses/create"),children:[r.jsx(Je,{className:"w-4 h-4 mr-2"}),r.jsxs("div",{className:"text-left",children:[r.jsx("div",{className:"font-medium",children:"Utwórz nowy kurs"}),r.jsx("div",{className:"text-xs text-muted-foreground",children:"Dodaj materiały i quizy dla uczniów"})]})]}),r.jsxs(D,{variant:"outline",className:"justify-start h-auto py-3",onClick:()=>e("/teacher/groups/create"),children:[r.jsx(Je,{className:"w-4 h-4 mr-2"}),r.jsxs("div",{className:"text-left",children:[r.jsx("div",{className:"font-medium",children:"Utwórz nową grupę"}),r.jsx("div",{className:"text-xs text-muted-foreground",children:"Zorganizuj uczniów i przypisz kursy"})]})]})]})]})]})},VM=[r.jsx(Z,{path:"/dashboard/overview",element:r.jsx(qM,{})},"dashboard")];var UM="DismissableLayer",Tm="dismissableLayer.update",WM="dismissableLayer.pointerDownOutside",KM="dismissableLayer.focusOutside",ny,Ik=j.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Ok=j.forwardRef((t,e)=>{const{disableOutsidePointerEvents:s=!1,onEscapeKeyDown:n,onPointerDownOutside:i,onFocusOutside:a,onInteractOutside:o,onDismiss:l,...c}=t,u=j.useContext(Ik),[d,h]=j.useState(null),f=d?.ownerDocument??globalThis?.document,[,m]=j.useState({}),p=hr(e,k=>h(k)),x=Array.from(u.layers),[g]=[...u.layersWithOutsidePointerEventsDisabled].slice(-1),y=x.indexOf(g),b=d?x.indexOf(d):-1,w=u.layersWithOutsidePointerEventsDisabled.size>0,S=b>=y,z=JM(k=>{const C=k.target,T=[...u.branches].some(v=>v.contains(C));!S||T||(i?.(k),o?.(k),k.defaultPrevented||l?.())},f),N=ZM(k=>{const C=k.target;[...u.branches].some(v=>v.contains(C))||(a?.(k),o?.(k),k.defaultPrevented||l?.())},f);return I4(k=>{b===u.layers.size-1&&(n?.(k),!k.defaultPrevented&&l&&(k.preventDefault(),l()))},f),j.useEffect(()=>{if(d)return s&&(u.layersWithOutsidePointerEventsDisabled.size===0&&(ny=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),u.layersWithOutsidePointerEventsDisabled.add(d)),u.layers.add(d),ry(),()=>{s&&u.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=ny)}},[d,f,s,u]),j.useEffect(()=>()=>{d&&(u.layers.delete(d),u.layersWithOutsidePointerEventsDisabled.delete(d),ry())},[d,u]),j.useEffect(()=>{const k=()=>m({});return document.addEventListener(Tm,k),()=>document.removeEventListener(Tm,k)},[]),r.jsx($n.div,{...c,ref:p,style:{pointerEvents:w?S?"auto":"none":void 0,...t.style},onFocusCapture:Te(t.onFocusCapture,N.onFocusCapture),onBlurCapture:Te(t.onBlurCapture,N.onBlurCapture),onPointerDownCapture:Te(t.onPointerDownCapture,z.onPointerDownCapture)})});Ok.displayName=UM;var HM="DismissableLayerBranch",GM=j.forwardRef((t,e)=>{const s=j.useContext(Ik),n=j.useRef(null),i=hr(e,n);return j.useEffect(()=>{const a=n.current;if(a)return s.branches.add(a),()=>{s.branches.delete(a)}},[s.branches]),r.jsx($n.div,{...t,ref:i})});GM.displayName=HM;function JM(t,e=globalThis?.document){const s=Od(t),n=j.useRef(!1),i=j.useRef(()=>{});return j.useEffect(()=>{const a=l=>{if(l.target&&!n.current){let c=function(){Rk(WM,s,u,{discrete:!0})};const u={originalEvent:l};l.pointerType==="touch"?(e.removeEventListener("click",i.current),i.current=c,e.addEventListener("click",i.current,{once:!0})):c()}else e.removeEventListener("click",i.current);n.current=!1},o=window.setTimeout(()=>{e.addEventListener("pointerdown",a)},0);return()=>{window.clearTimeout(o),e.removeEventListener("pointerdown",a),e.removeEventListener("click",i.current)}},[e,s]),{onPointerDownCapture:()=>n.current=!0}}function ZM(t,e=globalThis?.document){const s=Od(t),n=j.useRef(!1);return j.useEffect(()=>{const i=a=>{a.target&&!n.current&&Rk(KM,s,{originalEvent:a},{discrete:!1})};return e.addEventListener("focusin",i),()=>e.removeEventListener("focusin",i)},[e,s]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function ry(){const t=new CustomEvent(Tm);document.dispatchEvent(t)}function Rk(t,e,s,{discrete:n}){const i=s.originalEvent.target,a=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:s});e&&i.addEventListener(t,e,{once:!0}),n?k1(i,a):i.dispatchEvent(a)}var hf=0;function QM(){j.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??iy()),document.body.insertAdjacentElement("beforeend",t[1]??iy()),hf++,()=>{hf===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),hf--}},[])}function iy(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var Em=["Enter"," "],YM=["ArrowDown","PageUp","Home"],Lk=["ArrowUp","PageDown","End"],XM=[...YM,...Lk],e5={ltr:[...Em,"ArrowRight"],rtl:[...Em,"ArrowLeft"]},t5={ltr:["ArrowLeft"],rtl:["ArrowRight"]},ac="Menu",[Sl,s5,n5]=O4(ac),[Yi,Fk]=Wp(ac,[n5,N1,S1]),mh=N1(),$k=S1(),[r5,Xi]=Yi(ac),[i5,oc]=Yi(ac),Bk=t=>{const{__scopeMenu:e,open:s=!1,children:n,dir:i,onOpenChange:a,modal:o=!0}=t,l=mh(e),[c,u]=j.useState(null),d=j.useRef(!1),h=Od(a),f=K4(i);return j.useEffect(()=>{const m=()=>{d.current=!0,document.addEventListener("pointerdown",p,{capture:!0,once:!0}),document.addEventListener("pointermove",p,{capture:!0,once:!0})},p=()=>d.current=!1;return document.addEventListener("keydown",m,{capture:!0}),()=>{document.removeEventListener("keydown",m,{capture:!0}),document.removeEventListener("pointerdown",p,{capture:!0}),document.removeEventListener("pointermove",p,{capture:!0})}},[]),r.jsx(H4,{...l,children:r.jsx(r5,{scope:e,open:s,onOpenChange:h,content:c,onContentChange:u,children:r.jsx(i5,{scope:e,onClose:j.useCallback(()=>h(!1),[h]),isUsingKeyboardRef:d,dir:f,modal:o,children:n})})})};Bk.displayName=ac;var a5="MenuAnchor",vx=j.forwardRef((t,e)=>{const{__scopeMenu:s,...n}=t,i=mh(s);return r.jsx(L4,{...i,...n,ref:e})});vx.displayName=a5;var kx="MenuPortal",[o5,qk]=Yi(kx,{forceMount:void 0}),Vk=t=>{const{__scopeMenu:e,forceMount:s,children:n,container:i}=t,a=Xi(kx,e);return r.jsx(o5,{scope:e,forceMount:s,children:r.jsx(Rd,{present:s||a.open,children:r.jsx(R4,{asChild:!0,container:i,children:n})})})};Vk.displayName=kx;var Zs="MenuContent",[l5,Nx]=Yi(Zs),Uk=j.forwardRef((t,e)=>{const s=qk(Zs,t.__scopeMenu),{forceMount:n=s.forceMount,...i}=t,a=Xi(Zs,t.__scopeMenu),o=oc(Zs,t.__scopeMenu);return r.jsx(Sl.Provider,{scope:t.__scopeMenu,children:r.jsx(Rd,{present:n||a.open,children:r.jsx(Sl.Slot,{scope:t.__scopeMenu,children:o.modal?r.jsx(c5,{...i,ref:e}):r.jsx(u5,{...i,ref:e})})})})}),c5=j.forwardRef((t,e)=>{const s=Xi(Zs,t.__scopeMenu),n=j.useRef(null),i=hr(e,n);return j.useEffect(()=>{const a=n.current;if(a)return W4(a)},[]),r.jsx(Sx,{...t,ref:i,trapFocus:s.open,disableOutsidePointerEvents:s.open,disableOutsideScroll:!0,onFocusOutside:Te(t.onFocusOutside,a=>a.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>s.onOpenChange(!1)})}),u5=j.forwardRef((t,e)=>{const s=Xi(Zs,t.__scopeMenu);return r.jsx(Sx,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>s.onOpenChange(!1)})}),d5=B4("MenuContent.ScrollLock"),Sx=j.forwardRef((t,e)=>{const{__scopeMenu:s,loop:n=!1,trapFocus:i,onOpenAutoFocus:a,onCloseAutoFocus:o,disableOutsidePointerEvents:l,onEntryFocus:c,onEscapeKeyDown:u,onPointerDownOutside:d,onFocusOutside:h,onInteractOutside:f,onDismiss:m,disableOutsideScroll:p,...x}=t,g=Xi(Zs,s),y=oc(Zs,s),b=mh(s),w=$k(s),S=s5(s),[z,N]=j.useState(null),k=j.useRef(null),C=hr(e,k,g.onContentChange),T=j.useRef(0),v=j.useRef(""),_=j.useRef(0),A=j.useRef(null),E=j.useRef("right"),M=j.useRef(0),O=p?$4:j.Fragment,R=p?{as:d5,allowPinchZoom:!0}:void 0,B=$=>{const J=v.current+$,ie=S().filter(ke=>!ke.disabled),W=document.activeElement,me=ie.find(ke=>ke.ref.current===W)?.textValue,Ve=ie.map(ke=>ke.textValue),It=k5(Ve,J,me),Re=ie.find(ke=>ke.textValue===It)?.ref.current;(function ke(es){v.current=es,window.clearTimeout(T.current),es!==""&&(T.current=window.setTimeout(()=>ke(""),1e3))})(J),Re&&setTimeout(()=>Re.focus())};j.useEffect(()=>()=>window.clearTimeout(T.current),[]),QM();const K=j.useCallback($=>E.current===A.current?.side&&S5($,A.current?.area),[]);return r.jsx(l5,{scope:s,searchRef:v,onItemEnter:j.useCallback($=>{K($)&&$.preventDefault()},[K]),onItemLeave:j.useCallback($=>{K($)||(k.current?.focus(),N(null))},[K]),onTriggerLeave:j.useCallback($=>{K($)&&$.preventDefault()},[K]),pointerGraceTimerRef:_,onPointerGraceIntentChange:j.useCallback($=>{A.current=$},[]),children:r.jsx(O,{...R,children:r.jsx(q4,{asChild:!0,trapped:i,onMountAutoFocus:Te(a,$=>{$.preventDefault(),k.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:r.jsx(Ok,{asChild:!0,disableOutsidePointerEvents:l,onEscapeKeyDown:u,onPointerDownOutside:d,onFocusOutside:h,onInteractOutside:f,onDismiss:m,children:r.jsx(V4,{asChild:!0,...w,dir:y.dir,orientation:"vertical",loop:n,currentTabStopId:z,onCurrentTabStopIdChange:N,onEntryFocus:Te(c,$=>{y.isUsingKeyboardRef.current||$.preventDefault()}),preventScrollOnEntryFocus:!0,children:r.jsx(U4,{role:"menu","aria-orientation":"vertical","data-state":aN(g.open),"data-radix-menu-content":"",dir:y.dir,...b,...x,ref:C,style:{outline:"none",...x.style},onKeyDown:Te(x.onKeyDown,$=>{const ie=$.target.closest("[data-radix-menu-content]")===$.currentTarget,W=$.ctrlKey||$.altKey||$.metaKey,me=$.key.length===1;ie&&($.key==="Tab"&&$.preventDefault(),!W&&me&&B($.key));const Ve=k.current;if($.target!==Ve||!XM.includes($.key))return;$.preventDefault();const Re=S().filter(ke=>!ke.disabled).map(ke=>ke.ref.current);Lk.includes($.key)&&Re.reverse(),w5(Re)}),onBlur:Te(t.onBlur,$=>{$.currentTarget.contains($.target)||(window.clearTimeout(T.current),v.current="")}),onPointerMove:Te(t.onPointerMove,Cl($=>{const J=$.target,ie=M.current!==$.clientX;if($.currentTarget.contains(J)&&ie){const W=$.clientX>M.current?"right":"left";E.current=W,M.current=$.clientX}}))})})})})})})});Uk.displayName=Zs;var h5="MenuGroup",Cx=j.forwardRef((t,e)=>{const{__scopeMenu:s,...n}=t;return r.jsx($n.div,{role:"group",...n,ref:e})});Cx.displayName=h5;var f5="MenuLabel",Wk=j.forwardRef((t,e)=>{const{__scopeMenu:s,...n}=t;return r.jsx($n.div,{...n,ref:e})});Wk.displayName=f5;var Du="MenuItem",ay="menu.itemSelect",ph=j.forwardRef((t,e)=>{const{disabled:s=!1,onSelect:n,...i}=t,a=j.useRef(null),o=oc(Du,t.__scopeMenu),l=Nx(Du,t.__scopeMenu),c=hr(e,a),u=j.useRef(!1),d=()=>{const h=a.current;if(!s&&h){const f=new CustomEvent(ay,{bubbles:!0,cancelable:!0});h.addEventListener(ay,m=>n?.(m),{once:!0}),k1(h,f),f.defaultPrevented?u.current=!1:o.onClose()}};return r.jsx(Kk,{...i,ref:c,disabled:s,onClick:Te(t.onClick,d),onPointerDown:h=>{t.onPointerDown?.(h),u.current=!0},onPointerUp:Te(t.onPointerUp,h=>{u.current||h.currentTarget?.click()}),onKeyDown:Te(t.onKeyDown,h=>{const f=l.searchRef.current!=="";s||f&&h.key===" "||Em.includes(h.key)&&(h.currentTarget.click(),h.preventDefault())})})});ph.displayName=Du;var Kk=j.forwardRef((t,e)=>{const{__scopeMenu:s,disabled:n=!1,textValue:i,...a}=t,o=Nx(Du,s),l=$k(s),c=j.useRef(null),u=hr(e,c),[d,h]=j.useState(!1),[f,m]=j.useState("");return j.useEffect(()=>{const p=c.current;p&&m((p.textContent??"").trim())},[a.children]),r.jsx(Sl.ItemSlot,{scope:s,disabled:n,textValue:i??f,children:r.jsx(F4,{asChild:!0,...l,focusable:!n,children:r.jsx($n.div,{role:"menuitem","data-highlighted":d?"":void 0,"aria-disabled":n||void 0,"data-disabled":n?"":void 0,...a,ref:u,onPointerMove:Te(t.onPointerMove,Cl(p=>{n?o.onItemLeave(p):(o.onItemEnter(p),p.defaultPrevented||p.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Te(t.onPointerLeave,Cl(p=>o.onItemLeave(p))),onFocus:Te(t.onFocus,()=>h(!0)),onBlur:Te(t.onBlur,()=>h(!1))})})})}),m5="MenuCheckboxItem",Hk=j.forwardRef((t,e)=>{const{checked:s=!1,onCheckedChange:n,...i}=t;return r.jsx(Yk,{scope:t.__scopeMenu,checked:s,children:r.jsx(ph,{role:"menuitemcheckbox","aria-checked":Mu(s)?"mixed":s,...i,ref:e,"data-state":_x(s),onSelect:Te(i.onSelect,()=>n?.(Mu(s)?!0:!s),{checkForDefaultPrevented:!1})})})});Hk.displayName=m5;var Gk="MenuRadioGroup",[p5,x5]=Yi(Gk,{value:void 0,onValueChange:()=>{}}),Jk=j.forwardRef((t,e)=>{const{value:s,onValueChange:n,...i}=t,a=Od(n);return r.jsx(p5,{scope:t.__scopeMenu,value:s,onValueChange:a,children:r.jsx(Cx,{...i,ref:e})})});Jk.displayName=Gk;var Zk="MenuRadioItem",Qk=j.forwardRef((t,e)=>{const{value:s,...n}=t,i=x5(Zk,t.__scopeMenu),a=s===i.value;return r.jsx(Yk,{scope:t.__scopeMenu,checked:a,children:r.jsx(ph,{role:"menuitemradio","aria-checked":a,...n,ref:e,"data-state":_x(a),onSelect:Te(n.onSelect,()=>i.onValueChange?.(s),{checkForDefaultPrevented:!1})})})});Qk.displayName=Zk;var zx="MenuItemIndicator",[Yk,g5]=Yi(zx,{checked:!1}),Xk=j.forwardRef((t,e)=>{const{__scopeMenu:s,forceMount:n,...i}=t,a=g5(zx,s);return r.jsx(Rd,{present:n||Mu(a.checked)||a.checked===!0,children:r.jsx($n.span,{...i,ref:e,"data-state":_x(a.checked)})})});Xk.displayName=zx;var y5="MenuSeparator",eN=j.forwardRef((t,e)=>{const{__scopeMenu:s,...n}=t;return r.jsx($n.div,{role:"separator","aria-orientation":"horizontal",...n,ref:e})});eN.displayName=y5;var b5="MenuArrow",tN=j.forwardRef((t,e)=>{const{__scopeMenu:s,...n}=t,i=mh(s);return r.jsx(G4,{...i,...n,ref:e})});tN.displayName=b5;var j5="MenuSub",[aY,sN]=Yi(j5),Vo="MenuSubTrigger",nN=j.forwardRef((t,e)=>{const s=Xi(Vo,t.__scopeMenu),n=oc(Vo,t.__scopeMenu),i=sN(Vo,t.__scopeMenu),a=Nx(Vo,t.__scopeMenu),o=j.useRef(null),{pointerGraceTimerRef:l,onPointerGraceIntentChange:c}=a,u={__scopeMenu:t.__scopeMenu},d=j.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return j.useEffect(()=>d,[d]),j.useEffect(()=>{const h=l.current;return()=>{window.clearTimeout(h),c(null)}},[l,c]),r.jsx(vx,{asChild:!0,...u,children:r.jsx(Kk,{id:i.triggerId,"aria-haspopup":"menu","aria-expanded":s.open,"aria-controls":i.contentId,"data-state":aN(s.open),...t,ref:C1(e,i.onTriggerChange),onClick:h=>{t.onClick?.(h),!(t.disabled||h.defaultPrevented)&&(h.currentTarget.focus(),s.open||s.onOpenChange(!0))},onPointerMove:Te(t.onPointerMove,Cl(h=>{a.onItemEnter(h),!h.defaultPrevented&&!t.disabled&&!s.open&&!o.current&&(a.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{s.onOpenChange(!0),d()},100))})),onPointerLeave:Te(t.onPointerLeave,Cl(h=>{d();const f=s.content?.getBoundingClientRect();if(f){const m=s.content?.dataset.side,p=m==="right",x=p?-5:5,g=f[p?"left":"right"],y=f[p?"right":"left"];a.onPointerGraceIntentChange({area:[{x:h.clientX+x,y:h.clientY},{x:g,y:f.top},{x:y,y:f.top},{x:y,y:f.bottom},{x:g,y:f.bottom}],side:m}),window.clearTimeout(l.current),l.current=window.setTimeout(()=>a.onPointerGraceIntentChange(null),300)}else{if(a.onTriggerLeave(h),h.defaultPrevented)return;a.onPointerGraceIntentChange(null)}})),onKeyDown:Te(t.onKeyDown,h=>{const f=a.searchRef.current!=="";t.disabled||f&&h.key===" "||e5[n.dir].includes(h.key)&&(s.onOpenChange(!0),s.content?.focus(),h.preventDefault())})})})});nN.displayName=Vo;var rN="MenuSubContent",iN=j.forwardRef((t,e)=>{const s=qk(Zs,t.__scopeMenu),{forceMount:n=s.forceMount,...i}=t,a=Xi(Zs,t.__scopeMenu),o=oc(Zs,t.__scopeMenu),l=sN(rN,t.__scopeMenu),c=j.useRef(null),u=hr(e,c);return r.jsx(Sl.Provider,{scope:t.__scopeMenu,children:r.jsx(Rd,{present:n||a.open,children:r.jsx(Sl.Slot,{scope:t.__scopeMenu,children:r.jsx(Sx,{id:l.contentId,"aria-labelledby":l.triggerId,...i,ref:u,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:d=>{o.isUsingKeyboardRef.current&&c.current?.focus(),d.preventDefault()},onCloseAutoFocus:d=>d.preventDefault(),onFocusOutside:Te(t.onFocusOutside,d=>{d.target!==l.trigger&&a.onOpenChange(!1)}),onEscapeKeyDown:Te(t.onEscapeKeyDown,d=>{o.onClose(),d.preventDefault()}),onKeyDown:Te(t.onKeyDown,d=>{const h=d.currentTarget.contains(d.target),f=t5[o.dir].includes(d.key);h&&f&&(a.onOpenChange(!1),l.trigger?.focus(),d.preventDefault())})})})})})});iN.displayName=rN;function aN(t){return t?"open":"closed"}function Mu(t){return t==="indeterminate"}function _x(t){return Mu(t)?"indeterminate":t?"checked":"unchecked"}function w5(t){const e=document.activeElement;for(const s of t)if(s===e||(s.focus(),document.activeElement!==e))return}function v5(t,e){return t.map((s,n)=>t[(e+n)%t.length])}function k5(t,e,s){const i=e.length>1&&Array.from(e).every(u=>u===e[0])?e[0]:e,a=s?t.indexOf(s):-1;let o=v5(t,Math.max(a,0));i.length===1&&(o=o.filter(u=>u!==s));const c=o.find(u=>u.toLowerCase().startsWith(i.toLowerCase()));return c!==s?c:void 0}function N5(t,e){const{x:s,y:n}=t;let i=!1;for(let a=0,o=e.length-1;a<e.length;o=a++){const l=e[a],c=e[o],u=l.x,d=l.y,h=c.x,f=c.y;d>n!=f>n&&s<(h-u)*(n-d)/(f-d)+u&&(i=!i)}return i}function S5(t,e){if(!e)return!1;const s={x:t.clientX,y:t.clientY};return N5(s,e)}function Cl(t){return e=>e.pointerType==="mouse"?t(e):void 0}var C5=Bk,z5=vx,_5=Vk,A5=Uk,T5=Cx,E5=Wk,D5=ph,M5=Hk,P5=Jk,I5=Qk,O5=Xk,R5=eN,L5=tN,F5=nN,$5=iN,xh="DropdownMenu",[B5,oY]=Wp(xh,[Fk]),ms=Fk(),[q5,oN]=B5(xh),lN=t=>{const{__scopeDropdownMenu:e,children:s,dir:n,open:i,defaultOpen:a,onOpenChange:o,modal:l=!0}=t,c=ms(e),u=j.useRef(null),[d,h]=x1({prop:i,defaultProp:a??!1,onChange:o,caller:xh});return r.jsx(q5,{scope:e,triggerId:w0(),triggerRef:u,contentId:w0(),open:d,onOpenChange:h,onOpenToggle:j.useCallback(()=>h(f=>!f),[h]),modal:l,children:r.jsx(C5,{...c,open:d,onOpenChange:h,dir:n,modal:l,children:s})})};lN.displayName=xh;var cN="DropdownMenuTrigger",uN=j.forwardRef((t,e)=>{const{__scopeDropdownMenu:s,disabled:n=!1,...i}=t,a=oN(cN,s),o=ms(s);return r.jsx(z5,{asChild:!0,...o,children:r.jsx($n.button,{type:"button",id:a.triggerId,"aria-haspopup":"menu","aria-expanded":a.open,"aria-controls":a.open?a.contentId:void 0,"data-state":a.open?"open":"closed","data-disabled":n?"":void 0,disabled:n,...i,ref:C1(e,a.triggerRef),onPointerDown:Te(t.onPointerDown,l=>{!n&&l.button===0&&l.ctrlKey===!1&&(a.onOpenToggle(),a.open||l.preventDefault())}),onKeyDown:Te(t.onKeyDown,l=>{n||(["Enter"," "].includes(l.key)&&a.onOpenToggle(),l.key==="ArrowDown"&&a.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(l.key)&&l.preventDefault())})})})});uN.displayName=cN;var V5="DropdownMenuPortal",dN=t=>{const{__scopeDropdownMenu:e,...s}=t,n=ms(e);return r.jsx(_5,{...n,...s})};dN.displayName=V5;var hN="DropdownMenuContent",fN=j.forwardRef((t,e)=>{const{__scopeDropdownMenu:s,...n}=t,i=oN(hN,s),a=ms(s),o=j.useRef(!1);return r.jsx(A5,{id:i.contentId,"aria-labelledby":i.triggerId,...a,...n,ref:e,onCloseAutoFocus:Te(t.onCloseAutoFocus,l=>{o.current||i.triggerRef.current?.focus(),o.current=!1,l.preventDefault()}),onInteractOutside:Te(t.onInteractOutside,l=>{const c=l.detail.originalEvent,u=c.button===0&&c.ctrlKey===!0,d=c.button===2||u;(!i.modal||d)&&(o.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});fN.displayName=hN;var U5="DropdownMenuGroup",W5=j.forwardRef((t,e)=>{const{__scopeDropdownMenu:s,...n}=t,i=ms(s);return r.jsx(T5,{...i,...n,ref:e})});W5.displayName=U5;var K5="DropdownMenuLabel",mN=j.forwardRef((t,e)=>{const{__scopeDropdownMenu:s,...n}=t,i=ms(s);return r.jsx(E5,{...i,...n,ref:e})});mN.displayName=K5;var H5="DropdownMenuItem",pN=j.forwardRef((t,e)=>{const{__scopeDropdownMenu:s,...n}=t,i=ms(s);return r.jsx(D5,{...i,...n,ref:e})});pN.displayName=H5;var G5="DropdownMenuCheckboxItem",xN=j.forwardRef((t,e)=>{const{__scopeDropdownMenu:s,...n}=t,i=ms(s);return r.jsx(M5,{...i,...n,ref:e})});xN.displayName=G5;var J5="DropdownMenuRadioGroup",Z5=j.forwardRef((t,e)=>{const{__scopeDropdownMenu:s,...n}=t,i=ms(s);return r.jsx(P5,{...i,...n,ref:e})});Z5.displayName=J5;var Q5="DropdownMenuRadioItem",gN=j.forwardRef((t,e)=>{const{__scopeDropdownMenu:s,...n}=t,i=ms(s);return r.jsx(I5,{...i,...n,ref:e})});gN.displayName=Q5;var Y5="DropdownMenuItemIndicator",yN=j.forwardRef((t,e)=>{const{__scopeDropdownMenu:s,...n}=t,i=ms(s);return r.jsx(O5,{...i,...n,ref:e})});yN.displayName=Y5;var X5="DropdownMenuSeparator",bN=j.forwardRef((t,e)=>{const{__scopeDropdownMenu:s,...n}=t,i=ms(s);return r.jsx(R5,{...i,...n,ref:e})});bN.displayName=X5;var eP="DropdownMenuArrow",tP=j.forwardRef((t,e)=>{const{__scopeDropdownMenu:s,...n}=t,i=ms(s);return r.jsx(L5,{...i,...n,ref:e})});tP.displayName=eP;var sP="DropdownMenuSubTrigger",jN=j.forwardRef((t,e)=>{const{__scopeDropdownMenu:s,...n}=t,i=ms(s);return r.jsx(F5,{...i,...n,ref:e})});jN.displayName=sP;var nP="DropdownMenuSubContent",wN=j.forwardRef((t,e)=>{const{__scopeDropdownMenu:s,...n}=t,i=ms(s);return r.jsx($5,{...i,...n,ref:e,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});wN.displayName=nP;var rP=lN,iP=uN,aP=dN,vN=fN,kN=mN,NN=pN,SN=xN,CN=gN,zN=yN,_N=bN,AN=jN,TN=wN;const Qa=rP,Ya=iP,oP=j.forwardRef(({className:t,inset:e,children:s,...n},i)=>r.jsxs(AN,{ref:i,className:U("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e&&"pl-8",t),...n,children:[s,r.jsx(He,{className:"ml-auto"})]}));oP.displayName=AN.displayName;const lP=j.forwardRef(({className:t,...e},s)=>r.jsx(TN,{ref:s,className:U("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...e}));lP.displayName=TN.displayName;const Li=j.forwardRef(({className:t,sideOffset:e=4,...s},n)=>r.jsx(aP,{children:r.jsx(vN,{ref:n,sideOffset:e,className:U("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...s})}));Li.displayName=vN.displayName;const We=j.forwardRef(({className:t,inset:e,...s},n)=>r.jsx(NN,{ref:n,className:U("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",e&&"pl-8",t),...s}));We.displayName=NN.displayName;const cP=j.forwardRef(({className:t,children:e,checked:s,...n},i)=>r.jsxs(SN,{ref:i,className:U("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:s,...n,children:[r.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:r.jsx(zN,{children:r.jsx(Ds,{className:"h-4 w-4"})})}),e]}));cP.displayName=SN.displayName;const uP=j.forwardRef(({className:t,children:e,...s},n)=>r.jsxs(CN,{ref:n,className:U("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...s,children:[r.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:r.jsx(zN,{children:r.jsx(Jo,{className:"h-2 w-2 fill-current"})})}),e]}));uP.displayName=CN.displayName;const EN=j.forwardRef(({className:t,inset:e,...s},n)=>r.jsx(kN,{ref:n,className:U("px-2 py-1.5 text-sm font-semibold",e&&"pl-8",t),...s}));EN.displayName=kN.displayName;const as=j.forwardRef(({className:t,...e},s)=>r.jsx(_N,{ref:s,className:U("-mx-1 my-1 h-px bg-muted",t),...e}));as.displayName=_N.displayName;const dP=()=>{const t=pe(),e=gn(),s=()=>{const o=`${e.pathname}${e.search}`;sessionStorage.setItem("returnUrl",o)};return{navigateWithReturn:o=>{s(),t(o)},goBack:o=>{const l=sessionStorage.getItem("returnUrl");l?(sessionStorage.removeItem("returnUrl"),t(l)):t(o||-1)},saveReturnUrl:s,navigateToWizard:(o,l)=>{l&&sessionStorage.setItem("wizardContext",JSON.stringify(l)),s(),t(o)},currentUrl:`${e.pathname}${e.search}`}},Dm=t=>{const{mutate:e,isLoading:s}=Hi();return{togglePublish:async(i,a,o,l)=>{e({resource:t,id:i,values:{is_published:!a}},{onSuccess:()=>{G.success(a?`${o} został ukryty`:`${o} został opublikowany`),l?.()},onError:c=>{G.error("Nie udało się zmienić statusu publikacji"),console.error("Publish toggle error:",c)}})},isToggling:s}},oy=t=>{const{mutate:e}=Hi(),s=M1(),[n,i]=j.useState(!1);return{updatePosition:j.useCallback(async(o,l)=>{if(!n){i(!0);try{await new Promise((c,u)=>{e({resource:t,id:o,values:{position:l},mutationMode:"optimistic"},{onSuccess:()=>{console.log(`Updated position for ${t} ${o} to ${l}`),c()},onError:d=>u(d)})}),setTimeout(()=>{s({resource:t,invalidates:["list"]})},1e3)}catch(c){console.error("Position update error:",c),G.error("Nie udało się zaktualizować pozycji"),await s({resource:t,invalidates:["list"]})}finally{i(!1)}}},[t,e,s,n]),isUpdating:n}},hP=t=>{const{data:e,isLoading:s}=tt({resource:"courses",id:t,queryOptions:{enabled:!!t}}),{data:n,isLoading:i,refetch:a}=Y({resource:"topics",filters:[{field:"course_id",operator:"eq",value:t}],sorters:[{field:"position",order:"asc"}],pagination:{mode:"off"},meta:{select:"*, activities(count)"},queryOptions:{enabled:!!t}}),{data:o,refetch:l}=Y({resource:"activities",filters:[{field:"topic_id",operator:"in",value:n?.data?.map(g=>g.id)||[]}],sorters:[{field:"position",order:"asc"}],pagination:{mode:"off"},meta:{select:"*, questions(count)"},queryOptions:{enabled:!!n?.data?.length}}),{data:c}=Y({resource:"course_access",filters:[{field:"course_id",operator:"eq",value:t}],queryOptions:{enabled:!!t}}),u=c?.data?.filter(g=>g.group_id).map(g=>g.group_id)||[],{data:d}=Y({resource:"groups",filters:u.length>0?[{field:"id",operator:"in",value:u}]:[],pagination:{mode:"off"},queryOptions:{enabled:u.length>0}}),{data:h}=Y({resource:"group_members",filters:u.length>0?[{field:"group_id",operator:"in",value:u}]:[],pagination:{mode:"off"},meta:{select:"group_id"},queryOptions:{enabled:u.length>0}}),f=s||i,m={topicsCount:n?.total||0,activitiesCount:o?.total||0,accessCount:c?.total||0},p=g=>o?.data?.filter(y=>y.topic_id===g)||[],x=g=>h?.data?.filter(y=>y.group_id===g).length||0;return{course:e?.data,topics:n?.data||[],activities:o?.data||[],groups:d?.data||[],access:c?.data||[],stats:m,isLoading:f,refetchTopics:a,refetchActivities:l,getActivitiesForTopic:p,getMembersCountForGroup:x}},fP=()=>{const{create:t,edit:e,show:s}=Yt(),{mutate:n}=lr(),{togglePublish:i}=Dm("courses"),{data:a}=wt(),[o,l]=j.useState(""),{data:c,isLoading:u,isError:d,refetch:h}=Y({resource:"courses",pagination:{mode:"off"},sorters:[{field:"created_at",order:"desc"}]}),{data:f,isLoading:m}=Y({resource:"course_access",filters:a?.role==="teacher"?[{field:"teacher_id",operator:"eq",value:a?.id}]:[],pagination:{mode:"off"},queryOptions:{enabled:!!a?.id&&a?.role==="teacher"}}),{data:p}=Y({resource:"topics",pagination:{mode:"off"},meta:{select:"course_id"}}),{data:x}=Y({resource:"course_access",pagination:{mode:"off"},meta:{select:"course_id"}}),g=j.useMemo(()=>f?.data?.map(v=>v.course_id)||[],[f?.data]),y=j.useMemo(()=>{let v=c?.data||[];return a?.role==="teacher"&&(v=v.filter(_=>g.includes(_.id))),o&&(v=v.filter(_=>_.title.toLowerCase().includes(o.toLowerCase()))),v},[c?.data,g,a?.role,o]),b=v=>{const _=p?.data?.filter(E=>E.course_id===v).length||0,A=x?.data?.filter(E=>E.course_id===v).length||0;return{topicsCount:_,accessCount:A}},w=(v,_)=>{confirm(`Czy na pewno chcesz usunąć kurs "${_}"?`)&&n({resource:"courses",id:v},{onSuccess:()=>{G.success("Kurs został usunięty"),h()}})},S=(v,_,A)=>{window.location.href=v},z=u||a?.role==="teacher"&&m,k=ex({isLoading:z,isError:d});if(k)return k;const C=a?.role==="teacher",T=a?.role==="admin";return r.jsxs(X,{children:[r.jsxs(he,{children:[r.jsx(je,{title:"Moje kursy",description:T?"Zarządzaj wszystkimi kursami w systemie":"Kursy, które prowadzisz"}),T&&r.jsxs("div",{className:"flex gap-2",children:[r.jsx(ba,{children:r.jsxs(ja,{children:[r.jsx(wa,{asChild:!0,children:r.jsxs(D,{variant:"outline",onClick:()=>S("/teacher/course-structure/step1"),children:[r.jsx(vu,{className:"w-4 h-4 mr-2"}),r.jsx(Jt,{className:"w-3 h-3"})]})}),r.jsx(gi,{children:r.jsx("p",{children:"Stwórz kurs z pomocą AI"})})]})}),r.jsxs(D,{onClick:()=>t("courses"),children:[r.jsx(Je,{className:"w-4 h-4 mr-2"}),"Dodaj kurs"]})]})]}),r.jsxs(he,{children:[r.jsx(te,{placeholder:"Szukaj kursów...",className:"max-w-sm",value:o,onChange:v=>l(v.target.value)}),C&&r.jsx(V,{variant:"outline",children:"Pokazuję tylko kursy, które prowadzisz"})]}),r.jsx(Pt,{children:y.map(v=>{const _=b(v.id);return r.jsxs(P,{className:`relative cursor-pointer transition-all duration-200 ${v.is_published?"hover:shadow-lg":"opacity-80 hover:opacity-90 "}`,onClick:A=>{A.target.closest('[role="menu"]')||s("courses",v.id)},children:[r.jsx(F,{children:r.jsxs(he,{children:[r.jsxs(L,{className:"flex items-center gap-2 min-w-0",children:[r.jsx("span",{className:"flex-shrink-0",children:v.icon_emoji?r.jsx("span",{className:"text-2xl",children:v.icon_emoji}):r.jsx(Se,{className:"w-5 h-5"})}),r.jsx(ba,{delayDuration:200,children:r.jsxs(ja,{children:[r.jsx(wa,{asChild:!0,children:r.jsx("span",{className:"truncate",children:v.title})}),v.title.length>30&&r.jsx(gi,{children:r.jsx("p",{className:"max-w-xs",children:v.title})})]})})]}),r.jsxs(Qa,{children:[r.jsx(Ya,{asChild:!0,children:r.jsx(D,{variant:"ghost",size:"sm",onClick:A=>A.stopPropagation(),children:r.jsx(Kd,{className:"h-4 w-4"})})}),r.jsxs(Li,{align:"end",children:[r.jsxs(We,{onClick:()=>s("courses",v.id),children:[r.jsx(Tt,{className:"mr-2 h-4 w-4"}),"Podgląd"]}),T&&r.jsxs(r.Fragment,{children:[r.jsxs(We,{onClick:()=>e("courses",v.id),children:[r.jsx(Bn,{className:"mr-2 h-4 w-4"}),"Edytuj"]}),r.jsx(as,{}),r.jsx(We,{onClick:()=>i(v.id,v.is_published,v.title,h),children:v.is_published?r.jsxs(r.Fragment,{children:[r.jsx(ii,{className:"mr-2 h-4 w-4"}),"Ukryj kurs"]}):r.jsxs(r.Fragment,{children:[r.jsx(Tt,{className:"mr-2 h-4 w-4"}),"Opublikuj kurs"]})})]}),r.jsx(as,{}),T&&r.jsxs(r.Fragment,{children:[r.jsx(as,{}),r.jsxs(We,{onClick:()=>w(v.id,v.title),className:"text-red-600 focus:text-red-600",children:[r.jsx(St,{className:"mr-2 h-4 w-4"}),"Usuń"]})]})]})]})]})}),r.jsxs(I,{children:[v.description&&r.jsx("p",{className:"text-sm text-muted-foreground mb-3 line-clamp-2",children:v.description}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("div",{className:"flex gap-2",children:r.jsx(V,{variant:v.is_published?"default":"secondary",className:v.is_published?"bg-green-600":"",children:v.is_published?"Opublikowany":"Szkic"})}),r.jsxs("div",{className:"flex gap-3 text-sm text-muted-foreground",children:[r.jsx(ba,{children:r.jsxs(ja,{children:[r.jsx(wa,{asChild:!0,children:r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx(cs,{className:"w-3 h-3"}),_.topicsCount]})}),r.jsx(gi,{children:r.jsx("p",{children:"Liczba tematów"})})]})}),r.jsx(ba,{children:r.jsxs(ja,{children:[r.jsx(wa,{asChild:!0,children:r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx(ge,{className:"w-3 h-3"}),_.accessCount]})}),r.jsx(gi,{children:r.jsx("p",{children:"Liczba przypisań"})})]})})]})]}),v.created_at&&r.jsxs("div",{className:"flex items-center gap-1 mt-2 text-xs text-muted-foreground",children:[r.jsx(Ze,{className:"w-3 h-3"}),r.jsxs("span",{children:["Utworzono:"," ",new Date(v.created_at).toLocaleDateString("pl-PL")]})]})]})]},v.id)})}),y.length===0&&r.jsx(P,{className:"border-dashed border-2",children:r.jsx(I,{className:"text-center py-12",children:C?r.jsxs(r.Fragment,{children:[r.jsx(st,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),r.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Nie prowadzisz jeszcze żadnych kursów"}),r.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:"Operator systemu tworzy kursy i przypisuje do nich nauczycieli. Skontaktuj się z operatorem, aby uzyskać dostęp do kursów, które będziesz prowadzić."}),r.jsx("div",{className:"flex gap-3 justify-center",children:r.jsxs(D,{variant:"outline",disabled:!0,children:[r.jsx(st,{className:"w-4 h-4 mr-2"}),"Kursy tworzy operator"]})})]}):r.jsxs(r.Fragment,{children:[r.jsx(vu,{className:"w-12 h-12 mx-auto mb-4 text-indigo-600"}),r.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Brak kursów"}),r.jsx("p",{className:"text-muted-foreground mb-6",children:"Rozpocznij od stworzenia pierwszego kursu"}),r.jsxs("div",{className:"flex gap-3 justify-center",children:[r.jsxs(D,{variant:"outline",onClick:()=>t("courses"),children:[r.jsx(Je,{className:"w-4 h-4 mr-2"}),"Dodaj ręcznie"]}),r.jsxs(D,{onClick:()=>S("/teacher/course-structure/step1"),className:"bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700",children:[r.jsx(Jt,{className:"w-4 h-4 mr-2"}),"Wygeneruj z AI"]})]})]})})})]})},oi=({children:t,onSubmit:e,className:s="",...n})=>{const i="space-y-6",a=s?`${i} ${s}`:i;return r.jsx("form",{onSubmit:e,className:a,...n,children:t})},ye=({children:t,label:e,htmlFor:s,error:n,required:i=!1,className:a="",hint:o})=>{const l="space-y-2",c=a?`${l} ${a}`:l,u=()=>e?typeof e=="string"?r.jsxs(Oi,{htmlFor:s,children:[e,i&&r.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}):r.jsxs(Oi,{htmlFor:s,className:"flex items-center",children:[e,i&&r.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}):null,d=j.isValidElement(t)?j.cloneElement(t,{className:`${t.props.className||""} ${n?"border-red-500 ring-1 ring-red-500":""}`.trim()}):t;return r.jsxs("div",{className:c,children:[u(),d,o&&!n&&r.jsx("p",{className:"text-sm text-muted-foreground",children:o}),n&&r.jsx("p",{className:"text-sm text-red-500",children:n})]})},li=({children:t,className:e=""})=>{const s="flex justify-end items-center gap-4 pt-6 border-t",n=e?`${s} ${e}`:s;return r.jsx("div",{className:n,children:t})},mP=["📚","🎓","💡","🚀","⭐","🏆","🎯","📖","✏️","🧮"],pP=()=>{const{list:t}=Yt(),{data:e}=wt(),[s,n]=j.useState(!1),{refineCore:{onFinish:i},register:a,handleSubmit:o,setValue:l,watch:c,formState:{errors:u,isSubmitting:d}}=ni({defaultValues:{title:"",description:"",vendor_id:e?.vendor_id||0,is_published:!1,icon_emoji:"📚"}}),h=c("icon_emoji");return r.jsxs(X,{children:[r.jsxs(D,{variant:"outline",size:"sm",onClick:()=>t("courses"),children:[r.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),r.jsx(he,{children:r.jsx(je,{title:"Dodaj kurs",description:"Utwórz nowy kurs w systemie"})}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Informacje o kursie"})}),r.jsx(I,{children:r.jsxs(oi,{onSubmit:o(i),children:[r.jsxs(Pt,{variant:"1-2-2",children:[r.jsx(ye,{label:"Tytuł kursu",htmlFor:"title",error:u.title?.message?.toString(),required:!0,children:r.jsx(te,{id:"title",placeholder:"np. Podstawy programowania",...a("title",{required:"Tytuł kursu jest wymagany",minLength:{value:3,message:"Tytuł musi mieć minimum 3 znaki"}})})}),r.jsx(ye,{label:"Ikona kursu",htmlFor:"icon_emoji",children:r.jsxs("div",{className:"relative",children:[r.jsxs(D,{type:"button",variant:"outline",className:"w-full justify-start",onClick:()=>n(!s),children:[r.jsx("span",{className:"text-2xl mr-2",children:h||"📚"}),"Wybierz ikonę"]}),s&&r.jsx("div",{className:"absolute top-full mt-2 p-2 bg-white border rounded-lg shadow-lg z-10",children:r.jsx("div",{className:"grid grid-cols-5 gap-2",children:mP.map(f=>r.jsx("button",{type:"button",className:"p-2 hover:bg-gray-100 rounded text-2xl",onClick:()=>{l("icon_emoji",f),n(!1)},children:f},f))})})]})})]}),r.jsx(ye,{label:"Opis kursu",htmlFor:"description",error:u.description?.message?.toString(),children:r.jsx(mn,{id:"description",placeholder:"Opisz czego uczniowie nauczą się na tym kursie...",rows:4,...a("description")})}),r.jsx(ye,{label:"Status publikacji",children:r.jsxs(he,{variant:"start",children:[r.jsx(fs,{checked:c("is_published")||!1,onCheckedChange:f=>l("is_published",f)}),r.jsx("span",{className:"text-sm text-muted-foreground",children:"Opublikuj kurs od razu (możesz to zmienić później)"})]})}),r.jsxs(li,{children:[r.jsx(D,{type:"button",variant:"outline",onClick:()=>t("courses"),children:"Anuluj"}),r.jsx(D,{type:"submit",disabled:d,children:d?"Tworzenie...":"Utwórz kurs"})]})]})})]})]})},xP=["📚","🎓","💡","🚀","⭐","🏆","🎯","📖","✏️","🧮"],gP=()=>{const{list:t}=Yt(),{id:e}=Qt(),[s,n]=j.useState(!1),{data:i,isLoading:a}=tt({resource:"courses",id:e,liveMode:"off"}),{refineCore:{onFinish:o},register:l,handleSubmit:c,setValue:u,watch:d,formState:{errors:h,isSubmitting:f}}=ni({refineCoreProps:{resource:"courses",id:e,liveMode:"off"}}),m=d("icon_emoji");return a?r.jsx(X,{children:r.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):r.jsxs(X,{children:[r.jsxs(D,{variant:"outline",size:"sm",onClick:()=>t("courses"),children:[r.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),r.jsx(he,{children:r.jsx(je,{title:"Edytuj kurs",description:`Edycja kursu: ${i?.data?.title}`})}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Informacje o kursie"})}),r.jsx(I,{children:r.jsxs(oi,{onSubmit:c(o),children:[r.jsxs(Pt,{variant:"1-2-2",children:[r.jsx(ye,{label:"Tytuł kursu",htmlFor:"title",error:h.title?.message,required:!0,children:r.jsx(te,{id:"title",placeholder:"np. Podstawy programowania",...l("title",{required:"Tytuł kursu jest wymagany",minLength:{value:3,message:"Tytuł musi mieć minimum 3 znaki"}})})}),r.jsx(ye,{label:"Ikona kursu",htmlFor:"icon_emoji",children:r.jsxs("div",{className:"relative",children:[r.jsxs(D,{type:"button",variant:"outline",className:"w-full justify-start",onClick:()=>n(!s),children:[r.jsx("span",{className:"text-2xl mr-2",children:m||"📚"}),"Wybierz ikonę"]}),s&&r.jsx("div",{className:"absolute top-full mt-2 p-2 bg-white border rounded-lg shadow-lg z-10",children:r.jsx("div",{className:"grid grid-cols-5 gap-2",children:xP.map(p=>r.jsx("button",{type:"button",className:"p-2 hover:bg-gray-100 rounded text-2xl",onClick:()=>{u("icon_emoji",p),n(!1)},children:p},p))})})]})})]}),r.jsx(ye,{label:"Opis kursu",htmlFor:"description",error:h.description?.message,children:r.jsx(mn,{id:"description",placeholder:"Opisz czego uczniowie nauczą się na tym kursie...",rows:4,...l("description")})}),r.jsx(ye,{label:"Status publikacji",children:r.jsxs(he,{variant:"start",children:[r.jsx(fs,{checked:d("is_published")||!1,onCheckedChange:p=>u("is_published",p)}),r.jsx("span",{className:"text-sm text-muted-foreground",children:"Kurs jest opublikowany i widoczny dla uczniów"})]})}),r.jsxs(li,{children:[r.jsx(D,{type:"button",variant:"outline",onClick:()=>t("courses"),children:"Anuluj"}),r.jsx(D,{type:"submit",disabled:f,children:f?"Zapisywanie...":"Zapisz zmiany"})]})]})})]})]})},yP=({topic:t,isExpanded:e,onToggle:s,onDelete:n,onEdit:i,onTogglePublish:a,onNavigateToWizard:o,courseId:l,courseTitle:c,children:u,activitiesCount:d,dragHandleProps:h})=>{const f=pe(),m=x=>{const g=window.location.pathname+window.location.search;sessionStorage.setItem("returnUrl",g),f(x)},p=(x,g)=>{o&&o(x,{courseId:l,courseTitle:c,topicId:t.id,topicTitle:t.title,...g})};return r.jsxs("div",{className:`border-2 rounded-lg overflow-hidden group ${e?"shadow-lg border-primary":"border-border hover:border-primary/50"}`,children:[r.jsx("div",{className:`p-4 ${e?"bg-primary text-primary-foreground":"bg-background hover:bg-muted"}`,children:r.jsxs(he,{children:[r.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[r.jsx("button",{onClick:s,className:`p-1 rounded ${e?"text-primary-foreground hover:bg-primary-foreground/20":"hover:bg-muted"}`,"aria-label":e?"Zwiń temat":"Rozwiń temat",children:e?r.jsx(ls,{className:"w-5 h-5"}):r.jsx(He,{className:"w-5 h-5"})}),r.jsx("div",{className:"cursor-move",...h,children:r.jsx(L1,{className:`w-4 h-4 ${e?"text-primary-foreground/70":"text-muted-foreground"}`})}),r.jsxs("div",{className:"flex-1 cursor-pointer group",onClick:s,children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs("h4",{className:`font-semibold text-base ${e?"text-primary-foreground":"group-hover:text-primary"}`,children:["Temat ",t.position,": ",t.title]}),r.jsx(V,{variant:t.is_published?e?"secondary":"default":"outline",className:e?"bg-primary-foreground/20 text-primary-foreground border-primary-foreground/30":"",children:t.is_published?"Opublikowany":"Szkic"})]}),r.jsx("div",{className:"flex items-center gap-4 mt-1",children:r.jsxs("span",{className:`text-sm flex items-center gap-1 ${e?"text-primary-foreground/80":"text-muted-foreground"}`,children:[r.jsx(cs,{className:"w-3 h-3"}),d," ",d===1?"aktywność":"aktywności"]})})]})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsxs(Qa,{children:[r.jsx(Ya,{asChild:!0,children:r.jsx(D,{size:"sm",variant:e?"secondary":"ghost",title:"Dodaj aktywność",className:`h-8 w-8 p-0 ${e?"bg-primary-foreground/20 hover:bg-primary-foreground/30 text-primary-foreground":""}`,children:r.jsx(Je,{className:"h-4 w-4"})})}),r.jsxs(Li,{align:"end",children:[r.jsx(EN,{children:"Dodaj treść"}),r.jsxs(We,{onClick:()=>m(`/activities/create?topic_id=${t.id}`),children:[r.jsx(Je,{className:"mr-2 h-4 w-4"}),"Dodaj ręcznie"]}),r.jsx(as,{}),r.jsxs(We,{onClick:()=>p("/teacher/educational-material/step1"),className:"text-purple-600 focus:text-purple-600",children:[r.jsx(Jt,{className:"mr-2 h-4 w-4"}),"Generuj materiał z AI"]}),r.jsxs(We,{onClick:()=>p("/teacher/quiz-wizard/step1"),className:"text-blue-600 focus:text-blue-600",children:[r.jsx(ri,{className:"mr-2 h-4 w-4"}),"Generuj quiz z AI"]})]})]}),r.jsxs(Qa,{children:[r.jsx(Ya,{asChild:!0,children:r.jsx(D,{variant:e?"secondary":"ghost",size:"sm",className:`h-8 w-8 p-0 ${e?"bg-primary-foreground/20 hover:bg-primary-foreground/30 text-primary-foreground":""}`,children:r.jsx(Kd,{className:"h-4 w-4"})})}),r.jsxs(Li,{align:"end",children:[r.jsxs(We,{onClick:()=>i("teacher/topics",t.id),children:[r.jsx(Bn,{className:"mr-2 h-4 w-4"}),"Edytuj temat"]}),r.jsx(as,{}),r.jsx(We,{onClick:()=>a(t.id,t.is_published,t.title),children:t.is_published?r.jsxs(r.Fragment,{children:[r.jsx(ii,{className:"mr-2 h-4 w-4"}),"Ukryj temat"]}):r.jsxs(r.Fragment,{children:[r.jsx(Tt,{className:"mr-2 h-4 w-4"}),"Opublikuj temat"]})}),r.jsx(as,{}),r.jsxs(We,{onClick:()=>n(t.id,t.title),className:"text-red-600 focus:text-red-600",children:[r.jsx(St,{className:"mr-2 h-4 w-4"}),"Usuń temat"]})]})]})]})]})}),e&&r.jsx("div",{className:"p-4 bg-muted/20 border-t-2 border-primary",children:r.jsx("div",{className:"space-y-2",children:u})})]})},bP=({activity:t,topicPosition:e,onDelete:s,onEdit:n,onTogglePublish:i,dragHandleProps:a})=>{const o=pe(),l=()=>t.type==="quiz"?r.jsx("div",{className:"p-2 bg-blue-600 rounded-lg",children:r.jsx(dt,{className:"w-5 h-5 text-white"})}):r.jsx("div",{className:"p-2 bg-green-600 rounded-lg",children:r.jsx(cs,{className:"w-5 h-5 text-white"})}),c=()=>t.type==="quiz"?"Quiz":"Materiał";return r.jsxs("div",{className:"group flex items-center gap-4 p-4 bg-white border-2 rounded-lg hover:border-primary/50 transition-all duration-200",children:[r.jsx("div",{className:"cursor-move opacity-0 group-hover:opacity-100 transition-opacity",...a,children:r.jsx(L1,{className:"w-4 h-4 text-muted-foreground"})}),l(),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[r.jsxs("h5",{className:"font-semibold text-sm text-foreground",children:[e,".",t.position," ",t.title]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(V,{variant:t.type==="quiz"?"default":"secondary",className:"text-xs font-medium",children:c()}),t.type==="quiz"&&t._count?.questions!==void 0&&r.jsxs(V,{variant:"outline",className:"text-xs font-medium border-2",children:[r.jsx(qr,{className:"w-3 h-3 mr-1"}),t._count.questions," ",t._count.questions===1?"pytanie":"pytań"]}),r.jsx(V,{variant:t.is_published?"default":"outline",className:`text-xs font-medium ${t.is_published?"bg-green-600 hover:bg-green-700":"border-2"}`,children:t.is_published?r.jsxs(r.Fragment,{children:[r.jsx(ho,{className:"w-3 h-3 mr-1"}),"Opublikowany"]}):"Szkic"})]})]}),r.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-muted-foreground",children:[t.duration_min&&r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(Ze,{className:"w-3 h-3"}),r.jsxs("span",{children:[t.duration_min," min"]})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(ge,{className:"w-3 h-3"}),r.jsx("span",{children:"0 ukończeń"})]})]})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[t.type==="quiz"&&r.jsx(D,{size:"sm",variant:"ghost",onClick:()=>o(`/teacher/questions/manage/${t.id}`),title:"Zarządzaj pytaniami",className:"h-8 w-8 p-0",children:r.jsx(qr,{className:"h-4 w-4"})}),r.jsx(D,{size:"sm",variant:"ghost",onClick:()=>o(`/teacher/activities/show/${t.id}`),title:"Podgląd",className:"h-8 w-8 p-0",children:r.jsx(Tt,{className:"h-4 w-4"})}),r.jsxs(Qa,{children:[r.jsx(Ya,{asChild:!0,children:r.jsx(D,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:r.jsx(Kd,{className:"h-4 w-4"})})}),r.jsxs(Li,{align:"end",children:[r.jsxs(We,{onClick:()=>o(`/teacher/activities/show/${t.id}`),children:[r.jsx(Tt,{className:"mr-2 h-4 w-4"}),"Podgląd"]}),r.jsxs(We,{onClick:()=>n("teacher/activities",t.id),children:[r.jsx(Bn,{className:"mr-2 h-4 w-4"}),"Edytuj"]}),r.jsx(as,{}),r.jsx(We,{onClick:()=>i(t.id,t.is_published,t.title),children:t.is_published?r.jsxs(r.Fragment,{children:[r.jsx(ii,{className:"mr-2 h-4 w-4"}),"Ukryj aktywność"]}):r.jsxs(r.Fragment,{children:[r.jsx(Tt,{className:"mr-2 h-4 w-4"}),"Opublikuj aktywność"]})}),t.type==="quiz"&&r.jsxs(r.Fragment,{children:[r.jsx(as,{}),r.jsxs(We,{onClick:()=>o(`/teacher/questions/manage/${t.id}`),className:"text-blue-600 focus:text-blue-600",children:[r.jsx(qr,{className:"mr-2 h-4 w-4"}),"Zarządzaj pytaniami"]}),r.jsxs(We,{onClick:()=>o(`/teacher/questions/create?activity_id=${t.id}`),className:"text-blue-600 focus:text-blue-600",children:[r.jsx(Je,{className:"mr-2 h-4 w-4"}),"Dodaj pytanie"]})]}),r.jsx(as,{}),r.jsxs(We,{onClick:()=>s(t.id,t.title),className:"text-red-600 focus:text-red-600",children:[r.jsx(St,{className:"mr-2 h-4 w-4"}),"Usuń"]})]})]})]})]})},jP=({course:t})=>t?r.jsx(P,{className:"flex-1",children:r.jsx(I,{className:"pt-6",children:r.jsxs("div",{className:"flex items-start gap-4",children:[t.icon_emoji&&r.jsx("div",{className:"flex-shrink-0",children:r.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-lg flex items-center justify-center",children:r.jsx("span",{className:"text-3xl",children:t.icon_emoji})})}),r.jsxs("div",{className:"flex-1 space-y-3",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-semibold",children:t.title}),r.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[r.jsx("span",{className:"text-sm text-muted-foreground",children:t.is_published?"Opublikowany":"Szkic"}),t.created_at&&r.jsxs("span",{className:"text-sm text-muted-foreground",children:["Utworzony: ",new Date(t.created_at).toLocaleDateString("pl-PL")]})]})]}),t.description&&r.jsx("div",{className:"prose prose-sm max-w-none",children:r.jsx("p",{className:"text-muted-foreground leading-relaxed whitespace-pre-wrap",children:t.description})})]})]})})}):null,wP=({group:t,membersCount:e,courseId:s})=>{const n=pe();return r.jsx(P,{className:"hover:shadow-md transition-shadow",children:r.jsxs(I,{className:"pt-6",children:[r.jsxs("div",{className:"flex items-start justify-between mb-3",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("h4",{className:"font-semibold text-base mb-1",children:t.name}),r.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx(js,{className:"w-3 h-3"}),t.academic_year]}),r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx(ge,{className:"w-3 h-3"}),e," ",e===1?"uczeń":"uczniów"]})]})]}),r.jsx("div",{className:"flex flex-col gap-2",children:r.jsx(V,{variant:t.is_active?"default":"secondary",children:t.is_active?"Aktywna":"Nieaktywna"})})]}),r.jsxs(D,{size:"sm",variant:"outline",onClick:i=>{i.stopPropagation(),n(`/teacher/groups/${t.id}/courses/${s}/activity`)},children:[r.jsx(Tt,{className:"w-3 h-3 mr-1"}),"Zobacz postępy"]})]})})};function vP(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return j.useMemo(()=>n=>{e.forEach(i=>i(n))},e)}const gh=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function yo(t){const e=Object.prototype.toString.call(t);return e==="[object Window]"||e==="[object global]"}function Ax(t){return"nodeType"in t}function Ns(t){var e,s;return t?yo(t)?t:Ax(t)&&(e=(s=t.ownerDocument)==null?void 0:s.defaultView)!=null?e:window:window}function Tx(t){const{Document:e}=Ns(t);return t instanceof e}function lc(t){return yo(t)?!1:t instanceof Ns(t).HTMLElement}function DN(t){return t instanceof Ns(t).SVGElement}function bo(t){return t?yo(t)?t.document:Ax(t)?Tx(t)?t:lc(t)||DN(t)?t.ownerDocument:document:document:document}const Rn=gh?j.useLayoutEffect:j.useEffect;function Ex(t){const e=j.useRef(t);return Rn(()=>{e.current=t}),j.useCallback(function(){for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];return e.current==null?void 0:e.current(...n)},[])}function kP(){const t=j.useRef(null),e=j.useCallback((n,i)=>{t.current=setInterval(n,i)},[]),s=j.useCallback(()=>{t.current!==null&&(clearInterval(t.current),t.current=null)},[]);return[e,s]}function zl(t,e){e===void 0&&(e=[t]);const s=j.useRef(t);return Rn(()=>{s.current!==t&&(s.current=t)},e),s}function cc(t,e){const s=j.useRef();return j.useMemo(()=>{const n=t(s.current);return s.current=n,n},[...e])}function Pu(t){const e=Ex(t),s=j.useRef(null),n=j.useCallback(i=>{i!==s.current&&e?.(i,s.current),s.current=i},[]);return[s,n]}function Mm(t){const e=j.useRef();return j.useEffect(()=>{e.current=t},[t]),e.current}let ff={};function uc(t,e){return j.useMemo(()=>{if(e)return e;const s=ff[t]==null?0:ff[t]+1;return ff[t]=s,t+"-"+s},[t,e])}function MN(t){return function(e){for(var s=arguments.length,n=new Array(s>1?s-1:0),i=1;i<s;i++)n[i-1]=arguments[i];return n.reduce((a,o)=>{const l=Object.entries(o);for(const[c,u]of l){const d=a[c];d!=null&&(a[c]=d+t*u)}return a},{...e})}}const Oa=MN(1),_l=MN(-1);function NP(t){return"clientX"in t&&"clientY"in t}function Dx(t){if(!t)return!1;const{KeyboardEvent:e}=Ns(t.target);return e&&t instanceof e}function SP(t){if(!t)return!1;const{TouchEvent:e}=Ns(t.target);return e&&t instanceof e}function Pm(t){if(SP(t)){if(t.touches&&t.touches.length){const{clientX:e,clientY:s}=t.touches[0];return{x:e,y:s}}else if(t.changedTouches&&t.changedTouches.length){const{clientX:e,clientY:s}=t.changedTouches[0];return{x:e,y:s}}}return NP(t)?{x:t.clientX,y:t.clientY}:null}const Al=Object.freeze({Translate:{toString(t){if(!t)return;const{x:e,y:s}=t;return"translate3d("+(e?Math.round(e):0)+"px, "+(s?Math.round(s):0)+"px, 0)"}},Scale:{toString(t){if(!t)return;const{scaleX:e,scaleY:s}=t;return"scaleX("+e+") scaleY("+s+")"}},Transform:{toString(t){if(t)return[Al.Translate.toString(t),Al.Scale.toString(t)].join(" ")}},Transition:{toString(t){let{property:e,duration:s,easing:n}=t;return e+" "+s+"ms "+n}}}),ly="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function CP(t){return t.matches(ly)?t:t.querySelector(ly)}const zP={display:"none"};function _P(t){let{id:e,value:s}=t;return ae.createElement("div",{id:e,style:zP},s)}function AP(t){let{id:e,announcement:s,ariaLiveType:n="assertive"}=t;const i={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return ae.createElement("div",{id:e,style:i,role:"status","aria-live":n,"aria-atomic":!0},s)}function TP(){const[t,e]=j.useState("");return{announce:j.useCallback(n=>{n!=null&&e(n)},[]),announcement:t}}const PN=j.createContext(null);function EP(t){const e=j.useContext(PN);j.useEffect(()=>{if(!e)throw new Error("useDndMonitor must be used within a children of <DndContext>");return e(t)},[t,e])}function DP(){const[t]=j.useState(()=>new Set),e=j.useCallback(n=>(t.add(n),()=>t.delete(n)),[t]);return[j.useCallback(n=>{let{type:i,event:a}=n;t.forEach(o=>{var l;return(l=o[i])==null?void 0:l.call(o,a)})},[t]),e]}const MP={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},PP={onDragStart(t){let{active:e}=t;return"Picked up draggable item "+e.id+"."},onDragOver(t){let{active:e,over:s}=t;return s?"Draggable item "+e.id+" was moved over droppable area "+s.id+".":"Draggable item "+e.id+" is no longer over a droppable area."},onDragEnd(t){let{active:e,over:s}=t;return s?"Draggable item "+e.id+" was dropped over droppable area "+s.id:"Draggable item "+e.id+" was dropped."},onDragCancel(t){let{active:e}=t;return"Dragging was cancelled. Draggable item "+e.id+" was dropped."}};function IP(t){let{announcements:e=PP,container:s,hiddenTextDescribedById:n,screenReaderInstructions:i=MP}=t;const{announce:a,announcement:o}=TP(),l=uc("DndLiveRegion"),[c,u]=j.useState(!1);if(j.useEffect(()=>{u(!0)},[]),EP(j.useMemo(()=>({onDragStart(h){let{active:f}=h;a(e.onDragStart({active:f}))},onDragMove(h){let{active:f,over:m}=h;e.onDragMove&&a(e.onDragMove({active:f,over:m}))},onDragOver(h){let{active:f,over:m}=h;a(e.onDragOver({active:f,over:m}))},onDragEnd(h){let{active:f,over:m}=h;a(e.onDragEnd({active:f,over:m}))},onDragCancel(h){let{active:f,over:m}=h;a(e.onDragCancel({active:f,over:m}))}}),[a,e])),!c)return null;const d=ae.createElement(ae.Fragment,null,ae.createElement(_P,{id:n,value:i.draggable}),ae.createElement(AP,{id:l,announcement:o}));return s?$o.createPortal(d,s):d}var vt;(function(t){t.DragStart="dragStart",t.DragMove="dragMove",t.DragEnd="dragEnd",t.DragCancel="dragCancel",t.DragOver="dragOver",t.RegisterDroppable="registerDroppable",t.SetDroppableDisabled="setDroppableDisabled",t.UnregisterDroppable="unregisterDroppable"})(vt||(vt={}));function Iu(){}function cy(t,e){return j.useMemo(()=>({sensor:t,options:e??{}}),[t,e])}function OP(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return j.useMemo(()=>[...e].filter(n=>n!=null),[...e])}const xn=Object.freeze({x:0,y:0});function IN(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function ON(t,e){let{data:{value:s}}=t,{data:{value:n}}=e;return s-n}function RP(t,e){let{data:{value:s}}=t,{data:{value:n}}=e;return n-s}function uy(t){let{left:e,top:s,height:n,width:i}=t;return[{x:e,y:s},{x:e+i,y:s},{x:e,y:s+n},{x:e+i,y:s+n}]}function RN(t,e){if(!t||t.length===0)return null;const[s]=t;return s[e]}function dy(t,e,s){return e===void 0&&(e=t.left),s===void 0&&(s=t.top),{x:e+t.width*.5,y:s+t.height*.5}}const LP=t=>{let{collisionRect:e,droppableRects:s,droppableContainers:n}=t;const i=dy(e,e.left,e.top),a=[];for(const o of n){const{id:l}=o,c=s.get(l);if(c){const u=IN(dy(c),i);a.push({id:l,data:{droppableContainer:o,value:u}})}}return a.sort(ON)},FP=t=>{let{collisionRect:e,droppableRects:s,droppableContainers:n}=t;const i=uy(e),a=[];for(const o of n){const{id:l}=o,c=s.get(l);if(c){const u=uy(c),d=i.reduce((f,m,p)=>f+IN(u[p],m),0),h=Number((d/4).toFixed(4));a.push({id:l,data:{droppableContainer:o,value:h}})}}return a.sort(ON)};function $P(t,e){const s=Math.max(e.top,t.top),n=Math.max(e.left,t.left),i=Math.min(e.left+e.width,t.left+t.width),a=Math.min(e.top+e.height,t.top+t.height),o=i-n,l=a-s;if(n<i&&s<a){const c=e.width*e.height,u=t.width*t.height,d=o*l,h=d/(c+u-d);return Number(h.toFixed(4))}return 0}const BP=t=>{let{collisionRect:e,droppableRects:s,droppableContainers:n}=t;const i=[];for(const a of n){const{id:o}=a,l=s.get(o);if(l){const c=$P(l,e);c>0&&i.push({id:o,data:{droppableContainer:a,value:c}})}}return i.sort(RP)};function qP(t,e,s){return{...t,scaleX:e&&s?e.width/s.width:1,scaleY:e&&s?e.height/s.height:1}}function LN(t,e){return t&&e?{x:t.left-e.left,y:t.top-e.top}:xn}function VP(t){return function(s){for(var n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];return i.reduce((o,l)=>({...o,top:o.top+t*l.y,bottom:o.bottom+t*l.y,left:o.left+t*l.x,right:o.right+t*l.x}),{...s})}}const UP=VP(1);function WP(t){if(t.startsWith("matrix3d(")){const e=t.slice(9,-1).split(/, /);return{x:+e[12],y:+e[13],scaleX:+e[0],scaleY:+e[5]}}else if(t.startsWith("matrix(")){const e=t.slice(7,-1).split(/, /);return{x:+e[4],y:+e[5],scaleX:+e[0],scaleY:+e[3]}}return null}function KP(t,e,s){const n=WP(e);if(!n)return t;const{scaleX:i,scaleY:a,x:o,y:l}=n,c=t.left-o-(1-i)*parseFloat(s),u=t.top-l-(1-a)*parseFloat(s.slice(s.indexOf(" ")+1)),d=i?t.width/i:t.width,h=a?t.height/a:t.height;return{width:d,height:h,top:u,right:c+d,bottom:u+h,left:c}}const HP={ignoreTransform:!1};function jo(t,e){e===void 0&&(e=HP);let s=t.getBoundingClientRect();if(e.ignoreTransform){const{transform:u,transformOrigin:d}=Ns(t).getComputedStyle(t);u&&(s=KP(s,u,d))}const{top:n,left:i,width:a,height:o,bottom:l,right:c}=s;return{top:n,left:i,width:a,height:o,bottom:l,right:c}}function hy(t){return jo(t,{ignoreTransform:!0})}function GP(t){const e=t.innerWidth,s=t.innerHeight;return{top:0,left:0,right:e,bottom:s,width:e,height:s}}function JP(t,e){return e===void 0&&(e=Ns(t).getComputedStyle(t)),e.position==="fixed"}function ZP(t,e){e===void 0&&(e=Ns(t).getComputedStyle(t));const s=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(i=>{const a=e[i];return typeof a=="string"?s.test(a):!1})}function yh(t,e){const s=[];function n(i){if(e!=null&&s.length>=e||!i)return s;if(Tx(i)&&i.scrollingElement!=null&&!s.includes(i.scrollingElement))return s.push(i.scrollingElement),s;if(!lc(i)||DN(i)||s.includes(i))return s;const a=Ns(t).getComputedStyle(i);return i!==t&&ZP(i,a)&&s.push(i),JP(i,a)?s:n(i.parentNode)}return t?n(t):s}function FN(t){const[e]=yh(t,1);return e??null}function mf(t){return!gh||!t?null:yo(t)?t:Ax(t)?Tx(t)||t===bo(t).scrollingElement?window:lc(t)?t:null:null}function $N(t){return yo(t)?t.scrollX:t.scrollLeft}function BN(t){return yo(t)?t.scrollY:t.scrollTop}function Im(t){return{x:$N(t),y:BN(t)}}var zt;(function(t){t[t.Forward=1]="Forward",t[t.Backward=-1]="Backward"})(zt||(zt={}));function qN(t){return!gh||!t?!1:t===document.scrollingElement}function VN(t){const e={x:0,y:0},s=qN(t)?{height:window.innerHeight,width:window.innerWidth}:{height:t.clientHeight,width:t.clientWidth},n={x:t.scrollWidth-s.width,y:t.scrollHeight-s.height},i=t.scrollTop<=e.y,a=t.scrollLeft<=e.x,o=t.scrollTop>=n.y,l=t.scrollLeft>=n.x;return{isTop:i,isLeft:a,isBottom:o,isRight:l,maxScroll:n,minScroll:e}}const QP={x:.2,y:.2};function YP(t,e,s,n,i){let{top:a,left:o,right:l,bottom:c}=s;n===void 0&&(n=10),i===void 0&&(i=QP);const{isTop:u,isBottom:d,isLeft:h,isRight:f}=VN(t),m={x:0,y:0},p={x:0,y:0},x={height:e.height*i.y,width:e.width*i.x};return!u&&a<=e.top+x.height?(m.y=zt.Backward,p.y=n*Math.abs((e.top+x.height-a)/x.height)):!d&&c>=e.bottom-x.height&&(m.y=zt.Forward,p.y=n*Math.abs((e.bottom-x.height-c)/x.height)),!f&&l>=e.right-x.width?(m.x=zt.Forward,p.x=n*Math.abs((e.right-x.width-l)/x.width)):!h&&o<=e.left+x.width&&(m.x=zt.Backward,p.x=n*Math.abs((e.left+x.width-o)/x.width)),{direction:m,speed:p}}function XP(t){if(t===document.scrollingElement){const{innerWidth:a,innerHeight:o}=window;return{top:0,left:0,right:a,bottom:o,width:a,height:o}}const{top:e,left:s,right:n,bottom:i}=t.getBoundingClientRect();return{top:e,left:s,right:n,bottom:i,width:t.clientWidth,height:t.clientHeight}}function UN(t){return t.reduce((e,s)=>Oa(e,Im(s)),xn)}function eI(t){return t.reduce((e,s)=>e+$N(s),0)}function tI(t){return t.reduce((e,s)=>e+BN(s),0)}function sI(t,e){if(e===void 0&&(e=jo),!t)return;const{top:s,left:n,bottom:i,right:a}=e(t);FN(t)&&(i<=0||a<=0||s>=window.innerHeight||n>=window.innerWidth)&&t.scrollIntoView({block:"center",inline:"center"})}const nI=[["x",["left","right"],eI],["y",["top","bottom"],tI]];class Mx{constructor(e,s){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const n=yh(s),i=UN(n);this.rect={...e},this.width=e.width,this.height=e.height;for(const[a,o,l]of nI)for(const c of o)Object.defineProperty(this,c,{get:()=>{const u=l(n),d=i[a]-u;return this.rect[c]+d},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Qo{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(s=>{var n;return(n=this.target)==null?void 0:n.removeEventListener(...s)})},this.target=e}add(e,s,n){var i;(i=this.target)==null||i.addEventListener(e,s,n),this.listeners.push([e,s,n])}}function rI(t){const{EventTarget:e}=Ns(t);return t instanceof e?t:bo(t)}function pf(t,e){const s=Math.abs(t.x),n=Math.abs(t.y);return typeof e=="number"?Math.sqrt(s**2+n**2)>e:"x"in e&&"y"in e?s>e.x&&n>e.y:"x"in e?s>e.x:"y"in e?n>e.y:!1}var Us;(function(t){t.Click="click",t.DragStart="dragstart",t.Keydown="keydown",t.ContextMenu="contextmenu",t.Resize="resize",t.SelectionChange="selectionchange",t.VisibilityChange="visibilitychange"})(Us||(Us={}));function fy(t){t.preventDefault()}function iI(t){t.stopPropagation()}var be;(function(t){t.Space="Space",t.Down="ArrowDown",t.Right="ArrowRight",t.Left="ArrowLeft",t.Up="ArrowUp",t.Esc="Escape",t.Enter="Enter",t.Tab="Tab"})(be||(be={}));const WN={start:[be.Space,be.Enter],cancel:[be.Esc],end:[be.Space,be.Enter,be.Tab]},aI=(t,e)=>{let{currentCoordinates:s}=e;switch(t.code){case be.Right:return{...s,x:s.x+25};case be.Left:return{...s,x:s.x-25};case be.Down:return{...s,y:s.y+25};case be.Up:return{...s,y:s.y-25}}};class Px{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:s}}=e;this.props=e,this.listeners=new Qo(bo(s)),this.windowListeners=new Qo(Ns(s)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Us.Resize,this.handleCancel),this.windowListeners.add(Us.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Us.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:s}=this.props,n=e.node.current;n&&sI(n),s(xn)}handleKeyDown(e){if(Dx(e)){const{active:s,context:n,options:i}=this.props,{keyboardCodes:a=WN,coordinateGetter:o=aI,scrollBehavior:l="smooth"}=i,{code:c}=e;if(a.end.includes(c)){this.handleEnd(e);return}if(a.cancel.includes(c)){this.handleCancel(e);return}const{collisionRect:u}=n.current,d=u?{x:u.left,y:u.top}:xn;this.referenceCoordinates||(this.referenceCoordinates=d);const h=o(e,{active:s,context:n.current,currentCoordinates:d});if(h){const f=_l(h,d),m={x:0,y:0},{scrollableAncestors:p}=n.current;for(const x of p){const g=e.code,{isTop:y,isRight:b,isLeft:w,isBottom:S,maxScroll:z,minScroll:N}=VN(x),k=XP(x),C={x:Math.min(g===be.Right?k.right-k.width/2:k.right,Math.max(g===be.Right?k.left:k.left+k.width/2,h.x)),y:Math.min(g===be.Down?k.bottom-k.height/2:k.bottom,Math.max(g===be.Down?k.top:k.top+k.height/2,h.y))},T=g===be.Right&&!b||g===be.Left&&!w,v=g===be.Down&&!S||g===be.Up&&!y;if(T&&C.x!==h.x){const _=x.scrollLeft+f.x,A=g===be.Right&&_<=z.x||g===be.Left&&_>=N.x;if(A&&!f.y){x.scrollTo({left:_,behavior:l});return}A?m.x=x.scrollLeft-_:m.x=g===be.Right?x.scrollLeft-z.x:x.scrollLeft-N.x,m.x&&x.scrollBy({left:-m.x,behavior:l});break}else if(v&&C.y!==h.y){const _=x.scrollTop+f.y,A=g===be.Down&&_<=z.y||g===be.Up&&_>=N.y;if(A&&!f.x){x.scrollTo({top:_,behavior:l});return}A?m.y=x.scrollTop-_:m.y=g===be.Down?x.scrollTop-z.y:x.scrollTop-N.y,m.y&&x.scrollBy({top:-m.y,behavior:l});break}}this.handleMove(e,Oa(_l(h,this.referenceCoordinates),m))}}}handleMove(e,s){const{onMove:n}=this.props;e.preventDefault(),n(s)}handleEnd(e){const{onEnd:s}=this.props;e.preventDefault(),this.detach(),s()}handleCancel(e){const{onCancel:s}=this.props;e.preventDefault(),this.detach(),s()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Px.activators=[{eventName:"onKeyDown",handler:(t,e,s)=>{let{keyboardCodes:n=WN,onActivation:i}=e,{active:a}=s;const{code:o}=t.nativeEvent;if(n.start.includes(o)){const l=a.activatorNode.current;return l&&t.target!==l?!1:(t.preventDefault(),i?.({event:t.nativeEvent}),!0)}return!1}}];function my(t){return!!(t&&"distance"in t)}function py(t){return!!(t&&"delay"in t)}class Ix{constructor(e,s,n){var i;n===void 0&&(n=rI(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=s;const{event:a}=e,{target:o}=a;this.props=e,this.events=s,this.document=bo(o),this.documentListeners=new Qo(this.document),this.listeners=new Qo(n),this.windowListeners=new Qo(Ns(o)),this.initialCoordinates=(i=Pm(a))!=null?i:xn,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:s,bypassActivationConstraint:n}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(Us.Resize,this.handleCancel),this.windowListeners.add(Us.DragStart,fy),this.windowListeners.add(Us.VisibilityChange,this.handleCancel),this.windowListeners.add(Us.ContextMenu,fy),this.documentListeners.add(Us.Keydown,this.handleKeydown),s){if(n!=null&&n({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(py(s)){this.timeoutId=setTimeout(this.handleStart,s.delay),this.handlePending(s);return}if(my(s)){this.handlePending(s);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,s){const{active:n,onPending:i}=this.props;i(n,e,this.initialCoordinates,s)}handleStart(){const{initialCoordinates:e}=this,{onStart:s}=this.props;e&&(this.activated=!0,this.documentListeners.add(Us.Click,iI,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Us.SelectionChange,this.removeTextSelection),s(e))}handleMove(e){var s;const{activated:n,initialCoordinates:i,props:a}=this,{onMove:o,options:{activationConstraint:l}}=a;if(!i)return;const c=(s=Pm(e))!=null?s:xn,u=_l(i,c);if(!n&&l){if(my(l)){if(l.tolerance!=null&&pf(u,l.tolerance))return this.handleCancel();if(pf(u,l.distance))return this.handleStart()}if(py(l)&&pf(u,l.tolerance))return this.handleCancel();this.handlePending(l,u);return}e.cancelable&&e.preventDefault(),o(c)}handleEnd(){const{onAbort:e,onEnd:s}=this.props;this.detach(),this.activated||e(this.props.active),s()}handleCancel(){const{onAbort:e,onCancel:s}=this.props;this.detach(),this.activated||e(this.props.active),s()}handleKeydown(e){e.code===be.Esc&&this.handleCancel()}removeTextSelection(){var e;(e=this.document.getSelection())==null||e.removeAllRanges()}}const oI={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Ox extends Ix{constructor(e){const{event:s}=e,n=bo(s.target);super(e,oI,n)}}Ox.activators=[{eventName:"onPointerDown",handler:(t,e)=>{let{nativeEvent:s}=t,{onActivation:n}=e;return!s.isPrimary||s.button!==0?!1:(n?.({event:s}),!0)}}];const lI={move:{name:"mousemove"},end:{name:"mouseup"}};var Om;(function(t){t[t.RightClick=2]="RightClick"})(Om||(Om={}));class cI extends Ix{constructor(e){super(e,lI,bo(e.event.target))}}cI.activators=[{eventName:"onMouseDown",handler:(t,e)=>{let{nativeEvent:s}=t,{onActivation:n}=e;return s.button===Om.RightClick?!1:(n?.({event:s}),!0)}}];const xf={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class uI extends Ix{constructor(e){super(e,xf)}static setup(){return window.addEventListener(xf.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(xf.move.name,e)};function e(){}}}uI.activators=[{eventName:"onTouchStart",handler:(t,e)=>{let{nativeEvent:s}=t,{onActivation:n}=e;const{touches:i}=s;return i.length>1?!1:(n?.({event:s}),!0)}}];var Yo;(function(t){t[t.Pointer=0]="Pointer",t[t.DraggableRect=1]="DraggableRect"})(Yo||(Yo={}));var Ou;(function(t){t[t.TreeOrder=0]="TreeOrder",t[t.ReversedTreeOrder=1]="ReversedTreeOrder"})(Ou||(Ou={}));function dI(t){let{acceleration:e,activator:s=Yo.Pointer,canScroll:n,draggingRect:i,enabled:a,interval:o=5,order:l=Ou.TreeOrder,pointerCoordinates:c,scrollableAncestors:u,scrollableAncestorRects:d,delta:h,threshold:f}=t;const m=fI({delta:h,disabled:!a}),[p,x]=kP(),g=j.useRef({x:0,y:0}),y=j.useRef({x:0,y:0}),b=j.useMemo(()=>{switch(s){case Yo.Pointer:return c?{top:c.y,bottom:c.y,left:c.x,right:c.x}:null;case Yo.DraggableRect:return i}},[s,i,c]),w=j.useRef(null),S=j.useCallback(()=>{const N=w.current;if(!N)return;const k=g.current.x*y.current.x,C=g.current.y*y.current.y;N.scrollBy(k,C)},[]),z=j.useMemo(()=>l===Ou.TreeOrder?[...u].reverse():u,[l,u]);j.useEffect(()=>{if(!a||!u.length||!b){x();return}for(const N of z){if(n?.(N)===!1)continue;const k=u.indexOf(N),C=d[k];if(!C)continue;const{direction:T,speed:v}=YP(N,C,b,e,f);for(const _ of["x","y"])m[_][T[_]]||(v[_]=0,T[_]=0);if(v.x>0||v.y>0){x(),w.current=N,p(S,o),g.current=v,y.current=T;return}}g.current={x:0,y:0},y.current={x:0,y:0},x()},[e,S,n,x,a,o,JSON.stringify(b),JSON.stringify(m),p,u,z,d,JSON.stringify(f)])}const hI={x:{[zt.Backward]:!1,[zt.Forward]:!1},y:{[zt.Backward]:!1,[zt.Forward]:!1}};function fI(t){let{delta:e,disabled:s}=t;const n=Mm(e);return cc(i=>{if(s||!n||!i)return hI;const a={x:Math.sign(e.x-n.x),y:Math.sign(e.y-n.y)};return{x:{[zt.Backward]:i.x[zt.Backward]||a.x===-1,[zt.Forward]:i.x[zt.Forward]||a.x===1},y:{[zt.Backward]:i.y[zt.Backward]||a.y===-1,[zt.Forward]:i.y[zt.Forward]||a.y===1}}},[s,e,n])}function mI(t,e){const s=e!=null?t.get(e):void 0,n=s?s.node.current:null;return cc(i=>{var a;return e==null?null:(a=n??i)!=null?a:null},[n,e])}function pI(t,e){return j.useMemo(()=>t.reduce((s,n)=>{const{sensor:i}=n,a=i.activators.map(o=>({eventName:o.eventName,handler:e(o.handler,n)}));return[...s,...a]},[]),[t,e])}var Tl;(function(t){t[t.Always=0]="Always",t[t.BeforeDragging=1]="BeforeDragging",t[t.WhileDragging=2]="WhileDragging"})(Tl||(Tl={}));var Rm;(function(t){t.Optimized="optimized"})(Rm||(Rm={}));const xy=new Map;function xI(t,e){let{dragging:s,dependencies:n,config:i}=e;const[a,o]=j.useState(null),{frequency:l,measure:c,strategy:u}=i,d=j.useRef(t),h=g(),f=zl(h),m=j.useCallback(function(y){y===void 0&&(y=[]),!f.current&&o(b=>b===null?y:b.concat(y.filter(w=>!b.includes(w))))},[f]),p=j.useRef(null),x=cc(y=>{if(h&&!s)return xy;if(!y||y===xy||d.current!==t||a!=null){const b=new Map;for(let w of t){if(!w)continue;if(a&&a.length>0&&!a.includes(w.id)&&w.rect.current){b.set(w.id,w.rect.current);continue}const S=w.node.current,z=S?new Mx(c(S),S):null;w.rect.current=z,z&&b.set(w.id,z)}return b}return y},[t,a,s,h,c]);return j.useEffect(()=>{d.current=t},[t]),j.useEffect(()=>{h||m()},[s,h]),j.useEffect(()=>{a&&a.length>0&&o(null)},[JSON.stringify(a)]),j.useEffect(()=>{h||typeof l!="number"||p.current!==null||(p.current=setTimeout(()=>{m(),p.current=null},l))},[l,h,m,...n]),{droppableRects:x,measureDroppableContainers:m,measuringScheduled:a!=null};function g(){switch(u){case Tl.Always:return!1;case Tl.BeforeDragging:return s;default:return!s}}}function KN(t,e){return cc(s=>t?s||(typeof e=="function"?e(t):t):null,[e,t])}function gI(t,e){return KN(t,e)}function yI(t){let{callback:e,disabled:s}=t;const n=Ex(e),i=j.useMemo(()=>{if(s||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:a}=window;return new a(n)},[n,s]);return j.useEffect(()=>()=>i?.disconnect(),[i]),i}function bh(t){let{callback:e,disabled:s}=t;const n=Ex(e),i=j.useMemo(()=>{if(s||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:a}=window;return new a(n)},[s]);return j.useEffect(()=>()=>i?.disconnect(),[i]),i}function bI(t){return new Mx(jo(t),t)}function gy(t,e,s){e===void 0&&(e=bI);const[n,i]=j.useState(null);function a(){i(c=>{if(!t)return null;if(t.isConnected===!1){var u;return(u=c??s)!=null?u:null}const d=e(t);return JSON.stringify(c)===JSON.stringify(d)?c:d})}const o=yI({callback(c){if(t)for(const u of c){const{type:d,target:h}=u;if(d==="childList"&&h instanceof HTMLElement&&h.contains(t)){a();break}}}}),l=bh({callback:a});return Rn(()=>{a(),t?(l?.observe(t),o?.observe(document.body,{childList:!0,subtree:!0})):(l?.disconnect(),o?.disconnect())},[t]),n}function jI(t){const e=KN(t);return LN(t,e)}const yy=[];function wI(t){const e=j.useRef(t),s=cc(n=>t?n&&n!==yy&&t&&e.current&&t.parentNode===e.current.parentNode?n:yh(t):yy,[t]);return j.useEffect(()=>{e.current=t},[t]),s}function vI(t){const[e,s]=j.useState(null),n=j.useRef(t),i=j.useCallback(a=>{const o=mf(a.target);o&&s(l=>l?(l.set(o,Im(o)),new Map(l)):null)},[]);return j.useEffect(()=>{const a=n.current;if(t!==a){o(a);const l=t.map(c=>{const u=mf(c);return u?(u.addEventListener("scroll",i,{passive:!0}),[u,Im(u)]):null}).filter(c=>c!=null);s(l.length?new Map(l):null),n.current=t}return()=>{o(t),o(a)};function o(l){l.forEach(c=>{const u=mf(c);u?.removeEventListener("scroll",i)})}},[i,t]),j.useMemo(()=>t.length?e?Array.from(e.values()).reduce((a,o)=>Oa(a,o),xn):UN(t):xn,[t,e])}function by(t,e){e===void 0&&(e=[]);const s=j.useRef(null);return j.useEffect(()=>{s.current=null},e),j.useEffect(()=>{const n=t!==xn;n&&!s.current&&(s.current=t),!n&&s.current&&(s.current=null)},[t]),s.current?_l(t,s.current):xn}function kI(t){j.useEffect(()=>{if(!gh)return;const e=t.map(s=>{let{sensor:n}=s;return n.setup==null?void 0:n.setup()});return()=>{for(const s of e)s?.()}},t.map(e=>{let{sensor:s}=e;return s}))}function NI(t,e){return j.useMemo(()=>t.reduce((s,n)=>{let{eventName:i,handler:a}=n;return s[i]=o=>{a(o,e)},s},{}),[t,e])}function HN(t){return j.useMemo(()=>t?GP(t):null,[t])}const jy=[];function SI(t,e){e===void 0&&(e=jo);const[s]=t,n=HN(s?Ns(s):null),[i,a]=j.useState(jy);function o(){a(()=>t.length?t.map(c=>qN(c)?n:new Mx(e(c),c)):jy)}const l=bh({callback:o});return Rn(()=>{l?.disconnect(),o(),t.forEach(c=>l?.observe(c))},[t]),i}function CI(t){if(!t)return null;if(t.children.length>1)return t;const e=t.children[0];return lc(e)?e:t}function zI(t){let{measure:e}=t;const[s,n]=j.useState(null),i=j.useCallback(u=>{for(const{target:d}of u)if(lc(d)){n(h=>{const f=e(d);return h?{...h,width:f.width,height:f.height}:f});break}},[e]),a=bh({callback:i}),o=j.useCallback(u=>{const d=CI(u);a?.disconnect(),d&&a?.observe(d),n(d?e(d):null)},[e,a]),[l,c]=Pu(o);return j.useMemo(()=>({nodeRef:l,rect:s,setRef:c}),[s,l,c])}const _I=[{sensor:Ox,options:{}},{sensor:Px,options:{}}],AI={current:{}},ou={draggable:{measure:hy},droppable:{measure:hy,strategy:Tl.WhileDragging,frequency:Rm.Optimized},dragOverlay:{measure:jo}};class Xo extends Map{get(e){var s;return e!=null&&(s=super.get(e))!=null?s:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:s}=e;return!s})}getNodeFor(e){var s,n;return(s=(n=this.get(e))==null?void 0:n.node.current)!=null?s:void 0}}const TI={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Xo,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Iu},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:ou,measureDroppableContainers:Iu,windowRect:null,measuringScheduled:!1},EI={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Iu,draggableNodes:new Map,over:null,measureDroppableContainers:Iu},jh=j.createContext(EI),GN=j.createContext(TI);function DI(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Xo}}}function MI(t,e){switch(e.type){case vt.DragStart:return{...t,draggable:{...t.draggable,initialCoordinates:e.initialCoordinates,active:e.active}};case vt.DragMove:return t.draggable.active==null?t:{...t,draggable:{...t.draggable,translate:{x:e.coordinates.x-t.draggable.initialCoordinates.x,y:e.coordinates.y-t.draggable.initialCoordinates.y}}};case vt.DragEnd:case vt.DragCancel:return{...t,draggable:{...t.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case vt.RegisterDroppable:{const{element:s}=e,{id:n}=s,i=new Xo(t.droppable.containers);return i.set(n,s),{...t,droppable:{...t.droppable,containers:i}}}case vt.SetDroppableDisabled:{const{id:s,key:n,disabled:i}=e,a=t.droppable.containers.get(s);if(!a||n!==a.key)return t;const o=new Xo(t.droppable.containers);return o.set(s,{...a,disabled:i}),{...t,droppable:{...t.droppable,containers:o}}}case vt.UnregisterDroppable:{const{id:s,key:n}=e,i=t.droppable.containers.get(s);if(!i||n!==i.key)return t;const a=new Xo(t.droppable.containers);return a.delete(s),{...t,droppable:{...t.droppable,containers:a}}}default:return t}}function PI(t){let{disabled:e}=t;const{active:s,activatorEvent:n,draggableNodes:i}=j.useContext(jh),a=Mm(n),o=Mm(s?.id);return j.useEffect(()=>{if(!e&&!n&&a&&o!=null){if(!Dx(a)||document.activeElement===a.target)return;const l=i.get(o);if(!l)return;const{activatorNode:c,node:u}=l;if(!c.current&&!u.current)return;requestAnimationFrame(()=>{for(const d of[c.current,u.current]){if(!d)continue;const h=CP(d);if(h){h.focus();break}}})}},[n,e,i,o,a]),null}function II(t,e){let{transform:s,...n}=e;return t!=null&&t.length?t.reduce((i,a)=>a({transform:i,...n}),s):s}function OI(t){return j.useMemo(()=>({draggable:{...ou.draggable,...t?.draggable},droppable:{...ou.droppable,...t?.droppable},dragOverlay:{...ou.dragOverlay,...t?.dragOverlay}}),[t?.draggable,t?.droppable,t?.dragOverlay])}function RI(t){let{activeNode:e,measure:s,initialRect:n,config:i=!0}=t;const a=j.useRef(!1),{x:o,y:l}=typeof i=="boolean"?{x:i,y:i}:i;Rn(()=>{if(!o&&!l||!e){a.current=!1;return}if(a.current||!n)return;const u=e?.node.current;if(!u||u.isConnected===!1)return;const d=s(u),h=LN(d,n);if(o||(h.x=0),l||(h.y=0),a.current=!0,Math.abs(h.x)>0||Math.abs(h.y)>0){const f=FN(u);f&&f.scrollBy({top:h.y,left:h.x})}},[e,o,l,n,s])}const JN=j.createContext({...xn,scaleX:1,scaleY:1});var zr;(function(t){t[t.Uninitialized=0]="Uninitialized",t[t.Initializing=1]="Initializing",t[t.Initialized=2]="Initialized"})(zr||(zr={}));const LI=j.memo(function(e){var s,n,i,a;let{id:o,accessibility:l,autoScroll:c=!0,children:u,sensors:d=_I,collisionDetection:h=BP,measuring:f,modifiers:m,...p}=e;const x=j.useReducer(MI,void 0,DI),[g,y]=x,[b,w]=DP(),[S,z]=j.useState(zr.Uninitialized),N=S===zr.Initialized,{draggable:{active:k,nodes:C,translate:T},droppable:{containers:v}}=g,_=k!=null?C.get(k):null,A=j.useRef({initial:null,translated:null}),E=j.useMemo(()=>{var Ut;return k!=null?{id:k,data:(Ut=_?.data)!=null?Ut:AI,rect:A}:null},[k,_]),M=j.useRef(null),[O,R]=j.useState(null),[B,K]=j.useState(null),$=zl(p,Object.values(p)),J=uc("DndDescribedBy",o),ie=j.useMemo(()=>v.getEnabled(),[v]),W=OI(f),{droppableRects:me,measureDroppableContainers:Ve,measuringScheduled:It}=xI(ie,{dragging:N,dependencies:[T.x,T.y],config:W.droppable}),Re=mI(C,k),ke=j.useMemo(()=>B?Pm(B):null,[B]),es=c4(),ts=gI(Re,W.draggable.measure);RI({activeNode:k!=null?C.get(k):null,config:es.layoutShiftCompensation,initialRect:ts,measure:W.draggable.measure});const Me=gy(Re,W.draggable.measure,ts),_o=gy(Re?Re.parentElement:null),wn=j.useRef({activatorEvent:null,active:null,activeNode:Re,collisionRect:null,collisions:null,droppableRects:me,draggableNodes:C,draggingNode:null,draggingNodeRect:null,droppableContainers:v,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),sa=v.getNodeFor((s=wn.current.over)==null?void 0:s.id),Hn=zI({measure:W.dragOverlay.measure}),na=(n=Hn.nodeRef.current)!=null?n:Re,ra=N?(i=Hn.rect)!=null?i:Me:null,f0=!!(Hn.nodeRef.current&&Hn.rect),m0=jI(f0?null:Me),Hh=HN(na?Ns(na):null),yr=wI(N?sa??Re:null),Nc=SI(yr),Sc=II(m,{transform:{x:T.x-m0.x,y:T.y-m0.y,scaleX:1,scaleY:1},activatorEvent:B,active:E,activeNodeRect:Me,containerNodeRect:_o,draggingNodeRect:ra,over:wn.current.over,overlayNodeRect:Hn.rect,scrollableAncestors:yr,scrollableAncestorRects:Nc,windowRect:Hh}),p0=ke?Oa(ke,T):null,x0=vI(yr),s4=by(x0),n4=by(x0,[Me]),ia=Oa(Sc,s4),aa=ra?UP(ra,Sc):null,Ao=E&&aa?h({active:E,collisionRect:aa,droppableRects:me,droppableContainers:ie,pointerCoordinates:p0}):null,g0=RN(Ao,"id"),[br,y0]=j.useState(null),r4=f0?Sc:Oa(Sc,n4),i4=qP(r4,(a=br?.rect)!=null?a:null,Me),Gh=j.useRef(null),b0=j.useCallback((Ut,Ss)=>{let{sensor:Cs,options:jr}=Ss;if(M.current==null)return;const Fs=C.get(M.current);if(!Fs)return;const zs=Ut.nativeEvent,vn=new Cs({active:M.current,activeNode:Fs,event:zs,options:jr,context:wn,onAbort(Ot){if(!C.get(Ot))return;const{onDragAbort:kn}=$.current,Gn={id:Ot};kn?.(Gn),b({type:"onDragAbort",event:Gn})},onPending(Ot,wr,kn,Gn){if(!C.get(Ot))return;const{onDragPending:Eo}=$.current,vr={id:Ot,constraint:wr,initialCoordinates:kn,offset:Gn};Eo?.(vr),b({type:"onDragPending",event:vr})},onStart(Ot){const wr=M.current;if(wr==null)return;const kn=C.get(wr);if(!kn)return;const{onDragStart:Gn}=$.current,To={activatorEvent:zs,active:{id:wr,data:kn.data,rect:A}};$o.unstable_batchedUpdates(()=>{Gn?.(To),z(zr.Initializing),y({type:vt.DragStart,initialCoordinates:Ot,active:wr}),b({type:"onDragStart",event:To}),R(Gh.current),K(zs)})},onMove(Ot){y({type:vt.DragMove,coordinates:Ot})},onEnd:oa(vt.DragEnd),onCancel:oa(vt.DragCancel)});Gh.current=vn;function oa(Ot){return async function(){const{active:kn,collisions:Gn,over:To,scrollAdjustedTranslate:Eo}=wn.current;let vr=null;if(kn&&Eo){const{cancelDrop:Do}=$.current;vr={activatorEvent:zs,active:kn,collisions:Gn,delta:Eo,over:To},Ot===vt.DragEnd&&typeof Do=="function"&&await Promise.resolve(Do(vr))&&(Ot=vt.DragCancel)}M.current=null,$o.unstable_batchedUpdates(()=>{y({type:Ot}),z(zr.Uninitialized),y0(null),R(null),K(null),Gh.current=null;const Do=Ot===vt.DragEnd?"onDragEnd":"onDragCancel";if(vr){const Jh=$.current[Do];Jh?.(vr),b({type:Do,event:vr})}})}}},[C]),a4=j.useCallback((Ut,Ss)=>(Cs,jr)=>{const Fs=Cs.nativeEvent,zs=C.get(jr);if(M.current!==null||!zs||Fs.dndKit||Fs.defaultPrevented)return;const vn={active:zs};Ut(Cs,Ss.options,vn)===!0&&(Fs.dndKit={capturedBy:Ss.sensor},M.current=jr,b0(Cs,Ss))},[C,b0]),j0=pI(d,a4);kI(d),Rn(()=>{Me&&S===zr.Initializing&&z(zr.Initialized)},[Me,S]),j.useEffect(()=>{const{onDragMove:Ut}=$.current,{active:Ss,activatorEvent:Cs,collisions:jr,over:Fs}=wn.current;if(!Ss||!Cs)return;const zs={active:Ss,activatorEvent:Cs,collisions:jr,delta:{x:ia.x,y:ia.y},over:Fs};$o.unstable_batchedUpdates(()=>{Ut?.(zs),b({type:"onDragMove",event:zs})})},[ia.x,ia.y]),j.useEffect(()=>{const{active:Ut,activatorEvent:Ss,collisions:Cs,droppableContainers:jr,scrollAdjustedTranslate:Fs}=wn.current;if(!Ut||M.current==null||!Ss||!Fs)return;const{onDragOver:zs}=$.current,vn=jr.get(g0),oa=vn&&vn.rect.current?{id:vn.id,rect:vn.rect.current,data:vn.data,disabled:vn.disabled}:null,Ot={active:Ut,activatorEvent:Ss,collisions:Cs,delta:{x:Fs.x,y:Fs.y},over:oa};$o.unstable_batchedUpdates(()=>{y0(oa),zs?.(Ot),b({type:"onDragOver",event:Ot})})},[g0]),Rn(()=>{wn.current={activatorEvent:B,active:E,activeNode:Re,collisionRect:aa,collisions:Ao,droppableRects:me,draggableNodes:C,draggingNode:na,draggingNodeRect:ra,droppableContainers:v,over:br,scrollableAncestors:yr,scrollAdjustedTranslate:ia},A.current={initial:ra,translated:aa}},[E,Re,Ao,aa,C,na,ra,me,v,br,yr,ia]),dI({...es,delta:T,draggingRect:aa,pointerCoordinates:p0,scrollableAncestors:yr,scrollableAncestorRects:Nc});const o4=j.useMemo(()=>({active:E,activeNode:Re,activeNodeRect:Me,activatorEvent:B,collisions:Ao,containerNodeRect:_o,dragOverlay:Hn,draggableNodes:C,droppableContainers:v,droppableRects:me,over:br,measureDroppableContainers:Ve,scrollableAncestors:yr,scrollableAncestorRects:Nc,measuringConfiguration:W,measuringScheduled:It,windowRect:Hh}),[E,Re,Me,B,Ao,_o,Hn,C,v,me,br,Ve,yr,Nc,W,It,Hh]),l4=j.useMemo(()=>({activatorEvent:B,activators:j0,active:E,activeNodeRect:Me,ariaDescribedById:{draggable:J},dispatch:y,draggableNodes:C,over:br,measureDroppableContainers:Ve}),[B,j0,E,Me,y,J,C,br,Ve]);return ae.createElement(PN.Provider,{value:w},ae.createElement(jh.Provider,{value:l4},ae.createElement(GN.Provider,{value:o4},ae.createElement(JN.Provider,{value:i4},u)),ae.createElement(PI,{disabled:l?.restoreFocus===!1})),ae.createElement(IP,{...l,hiddenTextDescribedById:J}));function c4(){const Ut=O?.autoScrollEnabled===!1,Ss=typeof c=="object"?c.enabled===!1:c===!1,Cs=N&&!Ut&&!Ss;return typeof c=="object"?{...c,enabled:Cs}:{enabled:Cs}}}),FI=j.createContext(null),wy="button",$I="Draggable";function BI(t){let{id:e,data:s,disabled:n=!1,attributes:i}=t;const a=uc($I),{activators:o,activatorEvent:l,active:c,activeNodeRect:u,ariaDescribedById:d,draggableNodes:h,over:f}=j.useContext(jh),{role:m=wy,roleDescription:p="draggable",tabIndex:x=0}=i??{},g=c?.id===e,y=j.useContext(g?JN:FI),[b,w]=Pu(),[S,z]=Pu(),N=NI(o,e),k=zl(s);Rn(()=>(h.set(e,{id:e,key:a,node:b,activatorNode:S,data:k}),()=>{const T=h.get(e);T&&T.key===a&&h.delete(e)}),[h,e]);const C=j.useMemo(()=>({role:m,tabIndex:x,"aria-disabled":n,"aria-pressed":g&&m===wy?!0:void 0,"aria-roledescription":p,"aria-describedby":d.draggable}),[n,m,x,g,p,d.draggable]);return{active:c,activatorEvent:l,activeNodeRect:u,attributes:C,isDragging:g,listeners:n?void 0:N,node:b,over:f,setNodeRef:w,setActivatorNodeRef:z,transform:y}}function qI(){return j.useContext(GN)}const VI="Droppable",UI={timeout:25};function WI(t){let{data:e,disabled:s=!1,id:n,resizeObserverConfig:i}=t;const a=uc(VI),{active:o,dispatch:l,over:c,measureDroppableContainers:u}=j.useContext(jh),d=j.useRef({disabled:s}),h=j.useRef(!1),f=j.useRef(null),m=j.useRef(null),{disabled:p,updateMeasurementsFor:x,timeout:g}={...UI,...i},y=zl(x??n),b=j.useCallback(()=>{if(!h.current){h.current=!0;return}m.current!=null&&clearTimeout(m.current),m.current=setTimeout(()=>{u(Array.isArray(y.current)?y.current:[y.current]),m.current=null},g)},[g]),w=bh({callback:b,disabled:p||!o}),S=j.useCallback((C,T)=>{w&&(T&&(w.unobserve(T),h.current=!1),C&&w.observe(C))},[w]),[z,N]=Pu(S),k=zl(e);return j.useEffect(()=>{!w||!z.current||(w.disconnect(),h.current=!1,w.observe(z.current))},[z,w]),j.useEffect(()=>(l({type:vt.RegisterDroppable,element:{id:n,key:a,disabled:s,node:z,rect:f,data:k}}),()=>l({type:vt.UnregisterDroppable,key:a,id:n})),[n]),j.useEffect(()=>{s!==d.current.disabled&&(l({type:vt.SetDroppableDisabled,id:n,key:a,disabled:s}),d.current.disabled=s)},[n,a,s,l]),{active:o,rect:f,isOver:c?.id===n,node:z,over:c,setNodeRef:N}}function Rx(t,e,s){const n=t.slice();return n.splice(s<0?n.length+s:s,0,n.splice(e,1)[0]),n}function KI(t,e){return t.reduce((s,n,i)=>{const a=e.get(n);return a&&(s[i]=a),s},Array(t.length))}function Mc(t){return t!==null&&t>=0}function HI(t,e){if(t===e)return!0;if(t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(t[s]!==e[s])return!1;return!0}function GI(t){return typeof t=="boolean"?{draggable:t,droppable:t}:t}const ZN=t=>{let{rects:e,activeIndex:s,overIndex:n,index:i}=t;const a=Rx(e,n,s),o=e[i],l=a[i];return!l||!o?null:{x:l.left-o.left,y:l.top-o.top,scaleX:l.width/o.width,scaleY:l.height/o.height}},Pc={scaleX:1,scaleY:1},JI=t=>{var e;let{activeIndex:s,activeNodeRect:n,index:i,rects:a,overIndex:o}=t;const l=(e=a[s])!=null?e:n;if(!l)return null;if(i===s){const u=a[o];return u?{x:0,y:s<o?u.top+u.height-(l.top+l.height):u.top-l.top,...Pc}:null}const c=ZI(a,i,s);return i>s&&i<=o?{x:0,y:-l.height-c,...Pc}:i<s&&i>=o?{x:0,y:l.height+c,...Pc}:{x:0,y:0,...Pc}};function ZI(t,e,s){const n=t[e],i=t[e-1],a=t[e+1];return n?s<e?i?n.top-(i.top+i.height):a?a.top-(n.top+n.height):0:a?a.top-(n.top+n.height):i?n.top-(i.top+i.height):0:0}const QN="Sortable",YN=ae.createContext({activeIndex:-1,containerId:QN,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:ZN,disabled:{draggable:!1,droppable:!1}});function QI(t){let{children:e,id:s,items:n,strategy:i=ZN,disabled:a=!1}=t;const{active:o,dragOverlay:l,droppableRects:c,over:u,measureDroppableContainers:d}=qI(),h=uc(QN,s),f=l.rect!==null,m=j.useMemo(()=>n.map(N=>typeof N=="object"&&"id"in N?N.id:N),[n]),p=o!=null,x=o?m.indexOf(o.id):-1,g=u?m.indexOf(u.id):-1,y=j.useRef(m),b=!HI(m,y.current),w=g!==-1&&x===-1||b,S=GI(a);Rn(()=>{b&&p&&d(m)},[b,m,p,d]),j.useEffect(()=>{y.current=m},[m]);const z=j.useMemo(()=>({activeIndex:x,containerId:h,disabled:S,disableTransforms:w,items:m,overIndex:g,useDragOverlay:f,sortedRects:KI(m,c),strategy:i}),[x,h,S.draggable,S.droppable,w,m,g,c,f,i]);return ae.createElement(YN.Provider,{value:z},e)}const YI=t=>{let{id:e,items:s,activeIndex:n,overIndex:i}=t;return Rx(s,n,i).indexOf(e)},XI=t=>{let{containerId:e,isSorting:s,wasDragging:n,index:i,items:a,newIndex:o,previousItems:l,previousContainerId:c,transition:u}=t;return!u||!n||l!==a&&i===o?!1:s?!0:o!==i&&e===c},eO={duration:200,easing:"ease"},XN="transform",tO=Al.Transition.toString({property:XN,duration:0,easing:"linear"}),sO={roleDescription:"sortable"};function nO(t){let{disabled:e,index:s,node:n,rect:i}=t;const[a,o]=j.useState(null),l=j.useRef(s);return Rn(()=>{if(!e&&s!==l.current&&n.current){const c=i.current;if(c){const u=jo(n.current,{ignoreTransform:!0}),d={x:c.left-u.left,y:c.top-u.top,scaleX:c.width/u.width,scaleY:c.height/u.height};(d.x||d.y)&&o(d)}}s!==l.current&&(l.current=s)},[e,s,n,i]),j.useEffect(()=>{a&&o(null)},[a]),a}function rO(t){let{animateLayoutChanges:e=XI,attributes:s,disabled:n,data:i,getNewIndex:a=YI,id:o,strategy:l,resizeObserverConfig:c,transition:u=eO}=t;const{items:d,containerId:h,activeIndex:f,disabled:m,disableTransforms:p,sortedRects:x,overIndex:g,useDragOverlay:y,strategy:b}=j.useContext(YN),w=iO(n,m),S=d.indexOf(o),z=j.useMemo(()=>({sortable:{containerId:h,index:S,items:d},...i}),[h,i,S,d]),N=j.useMemo(()=>d.slice(d.indexOf(o)),[d,o]),{rect:k,node:C,isOver:T,setNodeRef:v}=WI({id:o,data:z,disabled:w.droppable,resizeObserverConfig:{updateMeasurementsFor:N,...c}}),{active:_,activatorEvent:A,activeNodeRect:E,attributes:M,setNodeRef:O,listeners:R,isDragging:B,over:K,setActivatorNodeRef:$,transform:J}=BI({id:o,data:z,attributes:{...sO,...s},disabled:w.draggable}),ie=vP(v,O),W=!!_,me=W&&!p&&Mc(f)&&Mc(g),Ve=!y&&B,It=Ve&&me?J:null,ke=me?It??(l??b)({rects:x,activeNodeRect:E,activeIndex:f,overIndex:g,index:S}):null,es=Mc(f)&&Mc(g)?a({id:o,items:d,activeIndex:f,overIndex:g}):S,ts=_?.id,Me=j.useRef({activeId:ts,items:d,newIndex:es,containerId:h}),_o=d!==Me.current.items,wn=e({active:_,containerId:h,isDragging:B,isSorting:W,id:o,index:S,items:d,newIndex:Me.current.newIndex,previousItems:Me.current.items,previousContainerId:Me.current.containerId,transition:u,wasDragging:Me.current.activeId!=null}),sa=nO({disabled:!wn,index:S,node:C,rect:k});return j.useEffect(()=>{W&&Me.current.newIndex!==es&&(Me.current.newIndex=es),h!==Me.current.containerId&&(Me.current.containerId=h),d!==Me.current.items&&(Me.current.items=d)},[W,es,h,d]),j.useEffect(()=>{if(ts===Me.current.activeId)return;if(ts!=null&&Me.current.activeId==null){Me.current.activeId=ts;return}const na=setTimeout(()=>{Me.current.activeId=ts},50);return()=>clearTimeout(na)},[ts]),{active:_,activeIndex:f,attributes:M,data:z,rect:k,index:S,newIndex:es,items:d,isOver:T,isSorting:W,isDragging:B,listeners:R,node:C,overIndex:g,over:K,setNodeRef:ie,setActivatorNodeRef:$,setDroppableNodeRef:v,setDraggableNodeRef:O,transform:sa??ke,transition:Hn()};function Hn(){if(sa||_o&&Me.current.newIndex===S)return tO;if(!(Ve&&!Dx(A)||!u)&&(W||wn))return Al.Transition.toString({...u,property:XN})}}function iO(t,e){var s,n;return typeof t=="boolean"?{draggable:t,droppable:!1}:{draggable:(s=t?.draggable)!=null?s:e.draggable,droppable:(n=t?.droppable)!=null?n:e.droppable}}function Ru(t){if(!t)return!1;const e=t.data.current;return!!(e&&"sortable"in e&&typeof e.sortable=="object"&&"containerId"in e.sortable&&"items"in e.sortable&&"index"in e.sortable)}const aO=[be.Down,be.Right,be.Up,be.Left],oO=(t,e)=>{let{context:{active:s,collisionRect:n,droppableRects:i,droppableContainers:a,over:o,scrollableAncestors:l}}=e;if(aO.includes(t.code)){if(t.preventDefault(),!s||!n)return;const c=[];a.getEnabled().forEach(h=>{if(!h||h!=null&&h.disabled)return;const f=i.get(h.id);if(f)switch(t.code){case be.Down:n.top<f.top&&c.push(h);break;case be.Up:n.top>f.top&&c.push(h);break;case be.Left:n.left>f.left&&c.push(h);break;case be.Right:n.left<f.left&&c.push(h);break}});const u=FP({collisionRect:n,droppableRects:i,droppableContainers:c});let d=RN(u,"id");if(d===o?.id&&u.length>1&&(d=u[1].id),d!=null){const h=a.get(s.id),f=a.get(d),m=f?i.get(f.id):null,p=f?.node.current;if(p&&m&&h&&f){const g=yh(p).some((N,k)=>l[k]!==N),y=e2(h,f),b=lO(h,f),w=g||!y?{x:0,y:0}:{x:b?n.width-m.width:0,y:b?n.height-m.height:0},S={x:m.left,y:m.top};return w.x&&w.y?S:_l(S,w)}}}};function e2(t,e){return!Ru(t)||!Ru(e)?!1:t.data.current.sortable.containerId===e.data.current.sortable.containerId}function lO(t,e){return!Ru(t)||!Ru(e)||!e2(t,e)?!1:t.data.current.sortable.index<e.data.current.sortable.index}const cO=()=>r.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}),uO=({course:t,topicsCount:e,activitiesCount:s,accessCount:n})=>r.jsxs(Pt,{variant:"2-2-4",children:[r.jsxs(P,{children:[r.jsx(F,{className:"pb-2",children:r.jsx(L,{className:"text-sm font-medium",children:"Status"})}),r.jsx(I,{children:r.jsx(V,{variant:t?.is_published?"default":"secondary",children:t?.is_published?"Opublikowany":"Szkic"})})]}),r.jsxs(P,{children:[r.jsx(F,{className:"pb-2",children:r.jsx(L,{className:"text-sm font-medium",children:"Tematy"})}),r.jsx(I,{children:r.jsx("div",{className:"text-2xl font-bold",children:e})})]}),r.jsxs(P,{children:[r.jsx(F,{className:"pb-2",children:r.jsx(L,{className:"text-sm font-medium",children:"Aktywności"})}),r.jsx(I,{children:r.jsx("div",{className:"text-2xl font-bold",children:s})})]}),r.jsxs(P,{children:[r.jsx(F,{className:"pb-2",children:r.jsx(L,{className:"text-sm font-medium",children:"Uczestników"})}),r.jsx(I,{children:r.jsx("div",{className:"text-2xl font-bold",children:n})})]})]}),dO=({id:t,disabled:e=!1,children:s})=>{const{attributes:n,listeners:i,setNodeRef:a,transform:o,transition:l,isDragging:c}=rO({id:t,disabled:e}),u={transform:Al.Transform.toString(o),transition:l,opacity:c?.5:1,cursor:c?"grabbing":"grab"},d=e?{}:{...n,...i,style:{cursor:c?"grabbing":"grab"}};return r.jsx("div",{ref:a,style:u,className:c?"z-50":"",children:s({dragHandleProps:d,isDragging:c})})},vy=({items:t,renderItem:e,onReorder:s,className:n="space-y-2",disabled:i=!1})=>{const[a,o]=j.useState(t),[l,c]=j.useState(null),[u,d]=j.useState(null);j.useEffect(()=>{if(!u)o(t);else{const p=a.map(x=>{const g=t.find(y=>y.id===x.id);return g?{...g,position:x.position}:x});o(p)}},[t]);const h=OP(cy(Ox,{activationConstraint:{distance:8}}),cy(Px,{coordinateGetter:oO})),f=p=>{c(Number(p.active.id))},m=p=>{const{active:x,over:g}=p;if(c(null),g&&x.id!==g.id){const y=a.findIndex(w=>w.id===Number(x.id)),b=a.findIndex(w=>w.id===Number(g.id));if(y!==-1&&b!==-1&&y!==b){let w;const S=a[y];if(b===0)w=a[0].position/2;else if(b===a.length-1)w=a[a.length-1].position+1e3;else if(y<b){const k=a[b],C=b+1<a.length?a[b+1]:null;C?w=(k.position+C.position)/2:w=k.position+1e3}else{const k=b>0?a[b-1]:null,C=a[b];k?w=(k.position+C.position)/2:w=C.position/2}const N=Rx(a,y,b).map(k=>k.id===S.id?{...k,position:w}:k);o(N),d({id:S.id,position:w}),s(S.id,w),setTimeout(()=>d(null),2e3)}}};return r.jsx(LI,{sensors:h,collisionDetection:LP,onDragStart:f,onDragEnd:m,children:r.jsx(QI,{items:a.map(p=>p.id),strategy:JI,children:r.jsx("div",{className:n,children:a.map((p,x)=>r.jsx(dO,{id:p.id,disabled:i||u!==null&&u.id!==p.id,children:g=>e(p,x,g.dragHandleProps)},p.id))})})})},hO=()=>{const{list:t,edit:e}=Yt(),{id:s}=Qt(),[n,i]=Fd(),{data:a}=wt(),o=a?.role==="admin",{navigateWithReturn:l,navigateToWizard:c}=dP(),{course:u,topics:d,groups:h,stats:f,isLoading:m,refetchTopics:p,refetchActivities:x,getActivitiesForTopic:g,getMembersCountForGroup:y}=hP(s),{togglePublish:b}=Dm("topics"),{togglePublish:w}=Dm("activities"),{updatePosition:S,isUpdating:z}=oy("topics"),{updatePosition:N,isUpdating:k}=oy("activities"),{mutate:C}=lr(),{mutate:T}=lr(),v=n.get("expanded");if(m)return r.jsx(cO,{});if(!u)return r.jsx(X,{children:r.jsx("div",{className:"text-center py-12",children:r.jsx("p",{className:"text-muted-foreground",children:"Nie znaleziono kursu"})})});const _=R=>{v===R.toString()?(n.delete("expanded"),i(n)):i({expanded:R.toString()})},A=(R,B)=>{confirm(`Czy na pewno chcesz usunąć temat "${B}" wraz ze wszystkimi aktywnościami?`)&&C({resource:"topics",id:R},{onSuccess:()=>{G.success("Temat został usunięty"),p(),x(),v===R.toString()&&(n.delete("expanded"),i(n))}})},E=(R,B)=>{confirm(`Czy na pewno chcesz usunąć aktywność "${B}"?`)&&T({resource:"activities",id:R},{onSuccess:()=>{G.success("Aktywność została usunięta"),x(),p()}})},M=async(R,B)=>{try{await S(R,B)}catch(K){console.error("Failed to reorder topic:",K)}},O=async(R,B)=>{try{await N(R,B)}catch(K){console.error("Failed to reorder activity:",K)}};return r.jsxs(X,{children:[r.jsxs(D,{variant:"outline",size:"sm",onClick:()=>t("courses"),children:[r.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h1",{className:"text-2xl font-bold",children:"Szczegóły kursu"}),r.jsx("div",{className:"flex gap-2",children:o&&r.jsxs(D,{onClick:()=>e("courses",u?.id??0),size:"sm",children:[r.jsx(Bn,{className:"w-4 h-4 mr-2"}),"Edytuj kurs"]})})]}),r.jsx(jP,{course:u})]}),r.jsx(uO,{course:u,topicsCount:f.topicsCount,activitiesCount:f.activitiesCount,accessCount:f.accessCount}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(he,{children:[r.jsxs(L,{className:"flex items-center gap-2",children:["Struktura kursu",(z||k)&&r.jsxs("span",{className:"text-sm font-normal text-muted-foreground flex items-center gap-1",children:[r.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),"Zapisywanie..."]})]}),r.jsx("div",{className:"flex gap-2",children:r.jsxs(D,{size:"sm",onClick:()=>l(`/teacher/topics/create?course_id=${s}`),children:[r.jsx(Je,{className:"w-4 h-4 mr-2"}),"Dodaj temat"]})})]})}),r.jsx(I,{children:d.length>0?r.jsx(vy,{items:d,onReorder:M,disabled:z||k,renderItem:(R,B,K)=>{const $=g(R.id),J=v===R.id.toString();return r.jsx(yP,{topic:{...R,position:B+1},isExpanded:J,onToggle:()=>_(R.id),onDelete:A,onEdit:(ie,W)=>l(`/${ie}/edit/${W}`),onTogglePublish:(ie,W,me)=>b(ie,W,me,p),activitiesCount:$.length,onNavigateToWizard:c,courseId:Number(u?.id),courseTitle:u?.title,dragHandleProps:K,children:$.length>0?r.jsx(vy,{items:$,onReorder:O,disabled:k,renderItem:(ie,W,me)=>r.jsx(bP,{activity:{...ie,position:W+1},topicPosition:B+1,onDelete:E,onEdit:(Ve,It)=>l(`/${Ve}/edit/${It}`),onTogglePublish:(Ve,It,Re)=>w(Ve,It,Re,x),dragHandleProps:me},ie.id)}):r.jsxs("div",{className:"text-center py-6 text-muted-foreground",children:[r.jsx("p",{children:"Brak aktywności w tym temacie"}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-center mt-4",children:[r.jsxs(D,{size:"sm",variant:"outline",onClick:()=>l(`/activities/create?topic_id=${R.id}`),children:[r.jsx(Je,{className:"w-4 h-4 mr-2"}),"Dodaj ręcznie"]}),r.jsxs(D,{size:"sm",onClick:()=>c("/teacher/educational-material/step1",{courseId:u?.id,courseTitle:u?.title,topicId:R.id,topicTitle:R.title}),children:[r.jsx(Jt,{className:"w-4 h-4 mr-2"}),"Generuj materiał z AI"]}),r.jsxs(D,{size:"sm",variant:"secondary",onClick:()=>c("/teacher/quiz-wizard/step1",{courseId:u?.id,courseTitle:u?.title,topicId:R.id,topicTitle:R.title}),children:[r.jsx(ri,{className:"w-4 h-4 mr-2"}),"Generuj quiz z AI"]})]})]})},R.id)}}):r.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[r.jsx(cs,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),r.jsx("p",{children:"Brak tematów w tym kursie"}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center mt-4",children:[r.jsxs(D,{onClick:()=>l(`/topics/create?course_id=${s}`),children:[r.jsx(Je,{className:"w-4 h-4 mr-2"}),"Dodaj pierwszy temat"]}),r.jsxs(D,{variant:"secondary",onClick:()=>l(`/teacher/course-structure/edit/${u?.id}`),children:[r.jsx(vu,{className:"w-4 h-4 mr-2"}),"Wygeneruj strukturę z AI"]})]})]})})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(he,{children:[r.jsxs(L,{className:"flex items-center gap-2",children:[r.jsx(ge,{className:"w-5 h-5"}),"Grupy z dostępem"]}),r.jsxs(V,{variant:"outline",children:[h.length," ",h.length===1?"grupa":"grup"]})]})}),r.jsx(I,{children:h.length>0?r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:h.map(R=>r.jsx(wP,{group:R,membersCount:y(R.id),courseId:Number(s)},R.id))}):r.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[r.jsx(ge,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),r.jsx("p",{children:"Brak przypisanych grup do tego kursu"}),r.jsx("p",{className:"text-sm mt-2",children:"Administrator może przypisać grupy w ustawieniach kursu"})]})})]})]})},ky={name:"courses",list:"/teacher/courses",create:"/teacher/courses/create",edit:"/teacher/courses/edit/:id",show:"/teacher/courses/show/:id",meta:{label:"Kursy",icon:r.jsx(Se,{className:"h-4 w-4"})}},fO=[r.jsx(Z,{path:"courses",element:r.jsx(fP,{})},"courses-list"),r.jsx(Z,{path:"courses/create",element:r.jsx(pP,{})},"courses-create"),r.jsx(Z,{path:"courses/edit/:id",element:r.jsx(gP,{})},"courses-edit"),r.jsx(Z,{path:"courses/show/:id",element:r.jsx(hO,{})},"courses-show")],mO=()=>{const{edit:t,list:e}=Yt(),{mutate:s}=Hi(),{mutate:n}=lr(),[i,a]=j.useState("all"),[o,l]=j.useState(!1),[c,u]=j.useState(null),d=i!=="all"?[{field:"course_id",operator:"eq",value:i}]:[],{data:h,isLoading:f,refetch:m}=Y({resource:"topics",meta:{populate:["courses"]},filters:d,pagination:{pageSize:20},sorters:[{field:"courses.title",order:"asc"},{field:"position",order:"asc"}]}),{data:p}=Y({resource:"courses",pagination:{pageSize:100},sorters:[{field:"title",order:"asc"}]}),x=h?.data||[],g=p?.data||[],y=async w=>{await s({resource:"topics",id:w.id,values:{is_published:!w.is_published},successNotification:()=>({message:w.is_published?"Temat został ukryty":"Temat został opublikowany",type:"success"})}),m()},b=w=>{u(w),l(!0)};return r.jsxs(X,{children:[r.jsxs(he,{children:[r.jsx(je,{title:"Tematy",description:"Zarządzaj tematami kursów"}),r.jsxs(he,{variant:"start",className:"gap-2",children:[g.length>0&&r.jsxs(Ee,{value:i,onValueChange:a,children:[r.jsxs(_e,{className:"w-[250px]",children:[r.jsx(C_,{className:"h-4 w-4 mr-2"}),r.jsx(De,{placeholder:"Filtruj po kursie"})]}),r.jsxs(Ae,{children:[r.jsx(ee,{value:"all",children:"Filtrowanie: Wszystkie kursy"}),r.jsx(as,{}),g.map(w=>r.jsx(ee,{value:w.id.toString(),children:w.title},w.id))]})]}),r.jsxs(D,{onClick:()=>e("courses"),children:[r.jsx(Se,{className:"h-4 w-4 mr-2"}),"Przejdź do kursów"]})]})]}),r.jsx(P,{children:r.jsx(I,{className:"p-0",children:f?r.jsx("div",{className:"p-8",children:r.jsx("div",{className:"space-y-3",children:[...Array(5)].map((w,S)=>r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsx(_s,{className:"h-12 w-12"}),r.jsxs("div",{className:"space-y-2 flex-1",children:[r.jsx(_s,{className:"h-4 w-3/4"}),r.jsx(_s,{className:"h-4 w-1/2"})]})]},S))})}):x.length===0?r.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[r.jsx(Se,{className:"h-12 w-12 text-muted-foreground mb-4"}),r.jsx("p",{className:"text-lg font-medium text-muted-foreground",children:i!=="all"?"Brak tematów w wybranym kursie":"Brak tematów"}),r.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Aby dodać temat, przejdź do kursu"}),r.jsxs(D,{onClick:()=>e("courses"),children:[r.jsx(Se,{className:"h-4 w-4 mr-2"}),"Przejdź do kursów"]})]}):r.jsxs(fr,{children:[r.jsx(mr,{children:r.jsxs(Nt,{children:[r.jsx(de,{className:"w-[50px]",children:"#"}),r.jsx(de,{children:"Tytuł"}),r.jsx(de,{className:"w-[200px]",children:"Kurs"}),r.jsx(de,{className:"w-[120px]",children:"Status"}),r.jsx(de,{className:"w-[140px]",children:"Data utworzenia"}),r.jsx(de,{className:"text-right w-[80px]",children:"Akcje"})]})}),r.jsx(pr,{children:x.map(w=>r.jsxs(Nt,{children:[r.jsx(ue,{className:"font-medium",children:r.jsx(V,{variant:"outline",className:"w-12 justify-center",children:w.position})}),r.jsx(ue,{children:r.jsx("div",{className:"font-medium",children:w.title})}),r.jsx(ue,{className:"max-w-[200px]",children:r.jsxs("div",{className:"flex items-center text-sm",children:[r.jsx(Se,{className:"h-4 w-4 mr-2 text-muted-foreground shrink-0"}),r.jsx("span",{className:"truncate block",title:w.courses?.title||"Brak kursu",children:w.courses?.title||"Brak kursu"})]})}),r.jsx(ue,{children:r.jsx(V,{variant:w.is_published?"default":"secondary",children:w.is_published?"Opublikowany":"Szkic"})}),r.jsx(ue,{children:r.jsxs("div",{className:"flex items-center text-sm text-muted-foreground",children:[r.jsx(Ze,{className:"h-4 w-4 mr-2"}),new Date(w.created_at).toLocaleDateString("pl-PL")]})}),r.jsx(ue,{className:"text-right",children:r.jsxs(Qa,{children:[r.jsx(Ya,{asChild:!0,children:r.jsxs(D,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:[r.jsx("span",{className:"sr-only",children:"Otwórz menu"}),r.jsx(z_,{className:"h-4 w-4"})]})}),r.jsxs(Li,{align:"end",children:[r.jsxs(We,{onClick:()=>t("topics",w.id),children:[r.jsx(Bn,{className:"mr-2 h-4 w-4"}),"Edytuj"]}),r.jsx(as,{}),r.jsx(We,{onClick:()=>y(w),children:w.is_published?r.jsxs(r.Fragment,{children:[r.jsx(Da,{className:"mr-2 h-4 w-4"}),"Ukryj temat"]}):r.jsxs(r.Fragment,{children:[r.jsx(__,{className:"mr-2 h-4 w-4"}),"Opublikuj temat"]})}),r.jsx(as,{}),r.jsxs(We,{onClick:()=>b(w),className:"text-destructive focus:text-destructive",children:[r.jsx(St,{className:"mr-2 h-4 w-4"}),"Usuń temat"]})]})]})})]},w.id))})]})})})]})},pO=()=>{const{show:t}=Yt(),e=pe(),[s]=Fd(),n=s.get("course_id"),{data:i}=tt({resource:"courses",id:n,queryOptions:{enabled:!!n}}),{data:a,isLoading:o}=Y({resource:"topics",filters:[{field:"course_id",operator:"eq",value:n}],sorters:[{field:"position",order:"desc"}],pagination:{pageSize:1},queryOptions:{enabled:!!n}}),{refineCore:{onFinish:l},register:c,handleSubmit:u,setValue:d,watch:h,formState:{errors:f,isSubmitting:m}}=ni({defaultValues:{course_id:n?parseInt(n):void 0,is_published:!1,position:1},refineCoreProps:{successNotification:()=>({message:"Temat został utworzony",type:"success"}),redirect:!1,onMutationSuccess:()=>{n?t("courses",n):e("/courses")}}});j.useEffect(()=>{if(!o&&a&&a.data.length>0){const x=a.data[0].position+1;d("position",x)}},[a,o,d]);const p=()=>{n?t("courses",n):e("/courses")};return r.jsxs(X,{children:[r.jsxs(D,{variant:"outline",size:"sm",onClick:p,children:[r.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Powrót do kursu"]}),r.jsx(he,{children:r.jsx(je,{title:"Dodaj temat",description:i?.data?`Do kursu: ${i.data.title}`:"Utwórz nowy temat"})}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Informacje o temacie"})}),r.jsx(I,{children:r.jsxs(oi,{onSubmit:u(l),children:[r.jsx("input",{type:"hidden",...c("course_id")}),r.jsx(ye,{label:"Tytuł tematu",htmlFor:"title",error:f.title?.message,required:!0,children:r.jsx(te,{id:"title",placeholder:"np. Wprowadzenie do zmiennych",...c("title",{required:"Tytuł tematu jest wymagany",minLength:{value:3,message:"Tytuł musi mieć minimum 3 znaki"}})})}),r.jsx(ye,{label:"Pozycja",htmlFor:"position",error:f.position?.message,required:!0,children:r.jsx(te,{id:"position",type:"number",min:"1",disabled:!0,className:"bg-muted",...c("position",{required:"Pozycja jest wymagana",min:{value:1,message:"Pozycja musi być większa od 0"},valueAsNumber:!0})})}),r.jsx(ye,{label:"Status publikacji",children:r.jsxs(he,{variant:"start",children:[r.jsx(fs,{checked:h("is_published")||!1,onCheckedChange:x=>d("is_published",x)}),r.jsx("span",{className:"text-sm text-muted-foreground",children:"Opublikuj temat od razu"})]})}),r.jsxs(li,{children:[r.jsx(D,{type:"button",variant:"outline",onClick:p,children:"Anuluj"}),r.jsx(D,{type:"submit",disabled:m||!n,children:m?"Tworzenie...":"Utwórz temat"})]})]})})]})]})},Fi=({variant:t="outline",size:e="sm",children:s="Powrót do kursu"})=>{const n=pe(),i=gn(),a=()=>{const o=sessionStorage.getItem("returnUrl");if(o){sessionStorage.removeItem("returnUrl"),n(o);return}const c=new URLSearchParams(i.search).get("returnUrl");if(c){n(decodeURIComponent(c));return}n(-1)};return r.jsxs(D,{variant:t,size:e,onClick:a,children:[r.jsx(Pe,{className:"w-4 h-4 mr-2"}),s]})},xO=()=>{const{show:t}=Yt(),{id:e}=Qt(),s=pe(),{data:n,isLoading:i}=tt({resource:"topics",id:e,liveMode:"off"}),a=n?.data,o=a?.course_id,{refineCore:{onFinish:l},register:c,handleSubmit:u,setValue:d,watch:h,formState:{errors:f,isSubmitting:m}}=ni({refineCoreProps:{resource:"topics",id:e,liveMode:"off",successNotification:()=>({message:"Temat został zaktualizowany",type:"success"}),redirect:!1,onMutationSuccess:()=>{const x=sessionStorage.getItem("returnUrl");x?(sessionStorage.removeItem("returnUrl"),s(x)):o&&s(`/teacher/courses/show/${o}?expanded=${e}`)}}}),p=()=>{const x=sessionStorage.getItem("returnUrl");x?(sessionStorage.removeItem("returnUrl"),s(x)):o?s(`/teacher/courses/show/${o}?expanded=${e}`):t("courses","")};return i?r.jsx(X,{children:r.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):r.jsxs(X,{children:[r.jsx(Fi,{}),r.jsx(he,{children:r.jsx(je,{title:"Edytuj temat",description:`Edycja: ${a?.title}`})}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Informacje o temacie"})}),r.jsx(I,{children:r.jsxs(oi,{onSubmit:u(l),children:[r.jsx(ye,{label:"Tytuł tematu",htmlFor:"title",error:f.title?.message,required:!0,children:r.jsx(te,{id:"title",placeholder:"np. Wprowadzenie do zmiennych",...c("title",{required:"Tytuł tematu jest wymagany",minLength:{value:3,message:"Tytuł musi mieć minimum 3 znaki"}})})}),r.jsx(ye,{label:"Pozycja",htmlFor:"position",error:f.position?.message,required:!0,children:r.jsx(te,{id:"position",type:"number",min:"1",...c("position",{required:"Pozycja jest wymagana",min:{value:1,message:"Pozycja musi być większa od 0"},valueAsNumber:!0})})}),r.jsx(ye,{label:"Status publikacji",children:r.jsxs(he,{variant:"start",children:[r.jsx(fs,{checked:h("is_published")||!1,onCheckedChange:x=>d("is_published",x)}),r.jsx("span",{className:"text-sm text-muted-foreground",children:"Temat jest opublikowany"})]})}),r.jsxs(li,{children:[r.jsx(D,{type:"button",variant:"outline",onClick:p,children:"Anuluj"}),r.jsx(D,{type:"submit",disabled:m,children:m?"Zapisywanie...":"Zapisz zmiany"})]})]})})]})]})},gO=[r.jsx(Z,{path:"topics",element:r.jsx(mO,{})},"topics-list"),r.jsx(Z,{path:"topics/create",element:r.jsx(pO,{})},"topics-create"),r.jsx(Z,{path:"topics/edit/:id",element:r.jsx(xO,{})},"topics-edit")];function Rt(t){this.content=t}Rt.prototype={constructor:Rt,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,s){var n=s&&s!=t?this.remove(s):this,i=n.find(t),a=n.content.slice();return i==-1?a.push(s||t,e):(a[i+1]=e,s&&(a[i]=s)),new Rt(a)},remove:function(t){var e=this.find(t);if(e==-1)return this;var s=this.content.slice();return s.splice(e,2),new Rt(s)},addToStart:function(t,e){return new Rt([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var s=this.remove(t).content.slice();return s.push(t,e),new Rt(s)},addBefore:function(t,e,s){var n=this.remove(e),i=n.content.slice(),a=n.find(t);return i.splice(a==-1?i.length:a,0,e,s),new Rt(i)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=Rt.from(t),t.size?new Rt(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=Rt.from(t),t.size?new Rt(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=Rt.from(t);for(var s=0;s<t.content.length;s+=2)e=e.remove(t.content[s]);return e},toObject:function(){var t={};return this.forEach(function(e,s){t[e]=s}),t},get size(){return this.content.length>>1}};Rt.from=function(t){if(t instanceof Rt)return t;var e=[];if(t)for(var s in t)e.push(s,t[s]);return new Rt(e)};function t2(t,e,s){for(let n=0;;n++){if(n==t.childCount||n==e.childCount)return t.childCount==e.childCount?null:s;let i=t.child(n),a=e.child(n);if(i==a){s+=i.nodeSize;continue}if(!i.sameMarkup(a))return s;if(i.isText&&i.text!=a.text){for(let o=0;i.text[o]==a.text[o];o++)s++;return s}if(i.content.size||a.content.size){let o=t2(i.content,a.content,s+1);if(o!=null)return o}s+=i.nodeSize}}function s2(t,e,s,n){for(let i=t.childCount,a=e.childCount;;){if(i==0||a==0)return i==a?null:{a:s,b:n};let o=t.child(--i),l=e.child(--a),c=o.nodeSize;if(o==l){s-=c,n-=c;continue}if(!o.sameMarkup(l))return{a:s,b:n};if(o.isText&&o.text!=l.text){let u=0,d=Math.min(o.text.length,l.text.length);for(;u<d&&o.text[o.text.length-u-1]==l.text[l.text.length-u-1];)u++,s--,n--;return{a:s,b:n}}if(o.content.size||l.content.size){let u=s2(o.content,l.content,s-1,n-1);if(u)return u}s-=c,n-=c}}class q{constructor(e,s){if(this.content=e,this.size=s||0,s==null)for(let n=0;n<e.length;n++)this.size+=e[n].nodeSize}nodesBetween(e,s,n,i=0,a){for(let o=0,l=0;l<s;o++){let c=this.content[o],u=l+c.nodeSize;if(u>e&&n(c,i+l,a||null,o)!==!1&&c.content.size){let d=l+1;c.nodesBetween(Math.max(0,e-d),Math.min(c.content.size,s-d),n,i+d)}l=u}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,s,n,i){let a="",o=!0;return this.nodesBetween(e,s,(l,c)=>{let u=l.isText?l.text.slice(Math.max(e,c)-c,s-c):l.isLeaf?i?typeof i=="function"?i(l):i:l.type.spec.leafText?l.type.spec.leafText(l):"":"";l.isBlock&&(l.isLeaf&&u||l.isTextblock)&&n&&(o?o=!1:a+=n),a+=u},0),a}append(e){if(!e.size)return this;if(!this.size)return e;let s=this.lastChild,n=e.firstChild,i=this.content.slice(),a=0;for(s.isText&&s.sameMarkup(n)&&(i[i.length-1]=s.withText(s.text+n.text),a=1);a<e.content.length;a++)i.push(e.content[a]);return new q(i,this.size+e.size)}cut(e,s=this.size){if(e==0&&s==this.size)return this;let n=[],i=0;if(s>e)for(let a=0,o=0;o<s;a++){let l=this.content[a],c=o+l.nodeSize;c>e&&((o<e||c>s)&&(l.isText?l=l.cut(Math.max(0,e-o),Math.min(l.text.length,s-o)):l=l.cut(Math.max(0,e-o-1),Math.min(l.content.size,s-o-1))),n.push(l),i+=l.nodeSize),o=c}return new q(n,i)}cutByIndex(e,s){return e==s?q.empty:e==0&&s==this.content.length?this:new q(this.content.slice(e,s))}replaceChild(e,s){let n=this.content[e];if(n==s)return this;let i=this.content.slice(),a=this.size+s.nodeSize-n.nodeSize;return i[e]=s,new q(i,a)}addToStart(e){return new q([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new q(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let s=0;s<this.content.length;s++)if(!this.content[s].eq(e.content[s]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let s=this.content[e];if(!s)throw new RangeError("Index "+e+" out of range for "+this);return s}maybeChild(e){return this.content[e]||null}forEach(e){for(let s=0,n=0;s<this.content.length;s++){let i=this.content[s];e(i,n,s),n+=i.nodeSize}}findDiffStart(e,s=0){return t2(this,e,s)}findDiffEnd(e,s=this.size,n=e.size){return s2(this,e,s,n)}findIndex(e){if(e==0)return Ic(0,e);if(e==this.size)return Ic(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let s=0,n=0;;s++){let i=this.child(s),a=n+i.nodeSize;if(a>=e)return a==e?Ic(s+1,a):Ic(s,n);n=a}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,s){if(!s)return q.empty;if(!Array.isArray(s))throw new RangeError("Invalid input for Fragment.fromJSON");return new q(s.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return q.empty;let s,n=0;for(let i=0;i<e.length;i++){let a=e[i];n+=a.nodeSize,i&&a.isText&&e[i-1].sameMarkup(a)?(s||(s=e.slice(0,i)),s[s.length-1]=a.withText(s[s.length-1].text+a.text)):s&&s.push(a)}return new q(s||e,n)}static from(e){if(!e)return q.empty;if(e instanceof q)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new q([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}q.empty=new q([],0);const gf={index:0,offset:0};function Ic(t,e){return gf.index=t,gf.offset=e,gf}function Lu(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let s=Array.isArray(t);if(Array.isArray(e)!=s)return!1;if(s){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!Lu(t[n],e[n]))return!1}else{for(let n in t)if(!(n in e)||!Lu(t[n],e[n]))return!1;for(let n in e)if(!(n in t))return!1}return!0}let ze=class Lm{constructor(e,s){this.type=e,this.attrs=s}addToSet(e){let s,n=!1;for(let i=0;i<e.length;i++){let a=e[i];if(this.eq(a))return e;if(this.type.excludes(a.type))s||(s=e.slice(0,i));else{if(a.type.excludes(this.type))return e;!n&&a.type.rank>this.type.rank&&(s||(s=e.slice(0,i)),s.push(this),n=!0),s&&s.push(a)}}return s||(s=e.slice()),n||s.push(this),s}removeFromSet(e){for(let s=0;s<e.length;s++)if(this.eq(e[s]))return e.slice(0,s).concat(e.slice(s+1));return e}isInSet(e){for(let s=0;s<e.length;s++)if(this.eq(e[s]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Lu(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let s in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,s){if(!s)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[s.type];if(!n)throw new RangeError(`There is no mark type ${s.type} in this schema`);let i=n.create(s.attrs);return n.checkAttrs(i.attrs),i}static sameSet(e,s){if(e==s)return!0;if(e.length!=s.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(s[n]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return Lm.none;if(e instanceof Lm)return[e];let s=e.slice();return s.sort((n,i)=>n.type.rank-i.type.rank),s}};ze.none=[];class Fu extends Error{}class Q{constructor(e,s,n){this.content=e,this.openStart=s,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,s){let n=r2(this.content,e+this.openStart,s);return n&&new Q(n,this.openStart,this.openEnd)}removeBetween(e,s){return new Q(n2(this.content,e+this.openStart,s+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,s){if(!s)return Q.empty;let n=s.openStart||0,i=s.openEnd||0;if(typeof n!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Q(q.fromJSON(e,s.content),n,i)}static maxOpen(e,s=!0){let n=0,i=0;for(let a=e.firstChild;a&&!a.isLeaf&&(s||!a.type.spec.isolating);a=a.firstChild)n++;for(let a=e.lastChild;a&&!a.isLeaf&&(s||!a.type.spec.isolating);a=a.lastChild)i++;return new Q(e,n,i)}}Q.empty=new Q(q.empty,0,0);function n2(t,e,s){let{index:n,offset:i}=t.findIndex(e),a=t.maybeChild(n),{index:o,offset:l}=t.findIndex(s);if(i==e||a.isText){if(l!=s&&!t.child(o).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(s))}if(n!=o)throw new RangeError("Removing non-flat range");return t.replaceChild(n,a.copy(n2(a.content,e-i-1,s-i-1)))}function r2(t,e,s,n){let{index:i,offset:a}=t.findIndex(e),o=t.maybeChild(i);if(a==e||o.isText)return n&&!n.canReplace(i,i,s)?null:t.cut(0,e).append(s).append(t.cut(e));let l=r2(o.content,e-a-1,s,o);return l&&t.replaceChild(i,o.copy(l))}function yO(t,e,s){if(s.openStart>t.depth)throw new Fu("Inserted content deeper than insertion position");if(t.depth-s.openStart!=e.depth-s.openEnd)throw new Fu("Inconsistent open depths");return i2(t,e,s,0)}function i2(t,e,s,n){let i=t.index(n),a=t.node(n);if(i==e.index(n)&&n<t.depth-s.openStart){let o=i2(t,e,s,n+1);return a.copy(a.content.replaceChild(i,o))}else if(s.content.size)if(!s.openStart&&!s.openEnd&&t.depth==n&&e.depth==n){let o=t.parent,l=o.content;return _i(o,l.cut(0,t.parentOffset).append(s.content).append(l.cut(e.parentOffset)))}else{let{start:o,end:l}=bO(s,t);return _i(a,o2(t,o,l,e,n))}else return _i(a,$u(t,e,n))}function a2(t,e){if(!e.type.compatibleContent(t.type))throw new Fu("Cannot join "+e.type.name+" onto "+t.type.name)}function Fm(t,e,s){let n=t.node(s);return a2(n,e.node(s)),n}function zi(t,e){let s=e.length-1;s>=0&&t.isText&&t.sameMarkup(e[s])?e[s]=t.withText(e[s].text+t.text):e.push(t)}function el(t,e,s,n){let i=(e||t).node(s),a=0,o=e?e.index(s):i.childCount;t&&(a=t.index(s),t.depth>s?a++:t.textOffset&&(zi(t.nodeAfter,n),a++));for(let l=a;l<o;l++)zi(i.child(l),n);e&&e.depth==s&&e.textOffset&&zi(e.nodeBefore,n)}function _i(t,e){return t.type.checkContent(e),t.copy(e)}function o2(t,e,s,n,i){let a=t.depth>i&&Fm(t,e,i+1),o=n.depth>i&&Fm(s,n,i+1),l=[];return el(null,t,i,l),a&&o&&e.index(i)==s.index(i)?(a2(a,o),zi(_i(a,o2(t,e,s,n,i+1)),l)):(a&&zi(_i(a,$u(t,e,i+1)),l),el(e,s,i,l),o&&zi(_i(o,$u(s,n,i+1)),l)),el(n,null,i,l),new q(l)}function $u(t,e,s){let n=[];if(el(null,t,s,n),t.depth>s){let i=Fm(t,e,s+1);zi(_i(i,$u(t,e,s+1)),n)}return el(e,null,s,n),new q(n)}function bO(t,e){let s=e.depth-t.openStart,i=e.node(s).copy(t.content);for(let a=s-1;a>=0;a--)i=e.node(a).copy(q.from(i));return{start:i.resolveNoCache(t.openStart+s),end:i.resolveNoCache(i.content.size-t.openEnd-s)}}class El{constructor(e,s,n){this.pos=e,this.path=s,this.parentOffset=n,this.depth=s.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,s=this.index(this.depth);if(s==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],i=e.child(s);return n?e.child(s).cut(n):i}get nodeBefore(){let e=this.index(this.depth),s=this.pos-this.path[this.path.length-1];return s?this.parent.child(e).cut(0,s):e==0?null:this.parent.child(e-1)}posAtIndex(e,s){s=this.resolveDepth(s);let n=this.path[s*3],i=s==0?0:this.path[s*3-1]+1;for(let a=0;a<e;a++)i+=n.child(a).nodeSize;return i}marks(){let e=this.parent,s=this.index();if(e.content.size==0)return ze.none;if(this.textOffset)return e.child(s).marks;let n=e.maybeChild(s-1),i=e.maybeChild(s);if(!n){let l=n;n=i,i=l}let a=n.marks;for(var o=0;o<a.length;o++)a[o].type.spec.inclusive===!1&&(!i||!a[o].isInSet(i.marks))&&(a=a[o--].removeFromSet(a));return a}marksAcross(e){let s=this.parent.maybeChild(this.index());if(!s||!s.isInline)return null;let n=s.marks,i=e.parent.maybeChild(e.index());for(var a=0;a<n.length;a++)n[a].type.spec.inclusive===!1&&(!i||!n[a].isInSet(i.marks))&&(n=n[a--].removeFromSet(n));return n}sharedDepth(e){for(let s=this.depth;s>0;s--)if(this.start(s)<=e&&this.end(s)>=e)return s;return 0}blockRange(e=this,s){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!s||s(this.node(n))))return new Bu(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let s=1;s<=this.depth;s++)e+=(e?"/":"")+this.node(s).type.name+"_"+this.index(s-1);return e+":"+this.parentOffset}static resolve(e,s){if(!(s>=0&&s<=e.content.size))throw new RangeError("Position "+s+" out of range");let n=[],i=0,a=s;for(let o=e;;){let{index:l,offset:c}=o.content.findIndex(a),u=a-c;if(n.push(o,l,i+c),!u||(o=o.child(l),o.isText))break;a=u-1,i+=c+1}return new El(s,n,a)}static resolveCached(e,s){let n=Ny.get(e);if(n)for(let a=0;a<n.elts.length;a++){let o=n.elts[a];if(o.pos==s)return o}else Ny.set(e,n=new jO);let i=n.elts[n.i]=El.resolve(e,s);return n.i=(n.i+1)%wO,i}}class jO{constructor(){this.elts=[],this.i=0}}const wO=12,Ny=new WeakMap;class Bu{constructor(e,s,n){this.$from=e,this.$to=s,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const vO=Object.create(null);let Wr=class $m{constructor(e,s,n,i=ze.none){this.type=e,this.attrs=s,this.marks=i,this.content=n||q.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,s,n,i=0){this.content.nodesBetween(e,s,n,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,s,n,i){return this.content.textBetween(e,s,n,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,s,n){return this.type==e&&Lu(this.attrs,s||e.defaultAttrs||vO)&&ze.sameSet(this.marks,n||ze.none)}copy(e=null){return e==this.content?this:new $m(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new $m(this.type,this.attrs,this.content,e)}cut(e,s=this.content.size){return e==0&&s==this.content.size?this:this.copy(this.content.cut(e,s))}slice(e,s=this.content.size,n=!1){if(e==s)return Q.empty;let i=this.resolve(e),a=this.resolve(s),o=n?0:i.sharedDepth(s),l=i.start(o),u=i.node(o).content.cut(i.pos-l,a.pos-l);return new Q(u,i.depth-o,a.depth-o)}replace(e,s,n){return yO(this.resolve(e),this.resolve(s),n)}nodeAt(e){for(let s=this;;){let{index:n,offset:i}=s.content.findIndex(e);if(s=s.maybeChild(n),!s)return null;if(i==e||s.isText)return s;e-=i+1}}childAfter(e){let{index:s,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(s),index:s,offset:n}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:s,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(s),index:s,offset:n};let i=this.content.child(s-1);return{node:i,index:s-1,offset:n-i.nodeSize}}resolve(e){return El.resolveCached(this,e)}resolveNoCache(e){return El.resolve(this,e)}rangeHasMark(e,s,n){let i=!1;return s>e&&this.nodesBetween(e,s,a=>(n.isInSet(a.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),l2(this.marks,e)}contentMatchAt(e){let s=this.type.contentMatch.matchFragment(this.content,0,e);if(!s)throw new Error("Called contentMatchAt on a node with invalid content");return s}canReplace(e,s,n=q.empty,i=0,a=n.childCount){let o=this.contentMatchAt(e).matchFragment(n,i,a),l=o&&o.matchFragment(this.content,s);if(!l||!l.validEnd)return!1;for(let c=i;c<a;c++)if(!this.type.allowsMarks(n.child(c).marks))return!1;return!0}canReplaceWith(e,s,n,i){if(i&&!this.type.allowsMarks(i))return!1;let a=this.contentMatchAt(e).matchType(n),o=a&&a.matchFragment(this.content,s);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=ze.none;for(let s=0;s<this.marks.length;s++){let n=this.marks[s];n.type.checkAttrs(n.attrs),e=n.addToSet(e)}if(!ze.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(s=>s.type.name)}`);this.content.forEach(s=>s.check())}toJSON(){let e={type:this.type.name};for(let s in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(s=>s.toJSON())),e}static fromJSON(e,s){if(!s)throw new RangeError("Invalid input for Node.fromJSON");let n;if(s.marks){if(!Array.isArray(s.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=s.marks.map(e.markFromJSON)}if(s.type=="text"){if(typeof s.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(s.text,n)}let i=q.fromJSON(e,s.content),a=e.nodeType(s.type).create(s.attrs,i,n);return a.type.checkAttrs(a.attrs),a}};Wr.prototype.text=void 0;class qu extends Wr{constructor(e,s,n,i){if(super(e,s,null,i),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):l2(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,s){return this.text.slice(e,s)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new qu(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new qu(this.type,this.attrs,e,this.marks)}cut(e=0,s=this.text.length){return e==0&&s==this.text.length?this:this.withText(this.text.slice(e,s))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function l2(t,e){for(let s=t.length-1;s>=0;s--)e=t[s].type.name+"("+e+")";return e}class $i{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,s){let n=new kO(e,s);if(n.next==null)return $i.empty;let i=c2(n);n.next&&n.err("Unexpected trailing text");let a=TO(AO(i));return EO(a,n),a}matchType(e){for(let s=0;s<this.next.length;s++)if(this.next[s].type==e)return this.next[s].next;return null}matchFragment(e,s=0,n=e.childCount){let i=this;for(let a=s;i&&a<n;a++)i=i.matchType(e.child(a).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:s}=this.next[e];if(!(s.isText||s.hasRequiredAttrs()))return s}return null}compatible(e){for(let s=0;s<this.next.length;s++)for(let n=0;n<e.next.length;n++)if(this.next[s].type==e.next[n].type)return!0;return!1}fillBefore(e,s=!1,n=0){let i=[this];function a(o,l){let c=o.matchFragment(e,n);if(c&&(!s||c.validEnd))return q.from(l.map(u=>u.createAndFill()));for(let u=0;u<o.next.length;u++){let{type:d,next:h}=o.next[u];if(!(d.isText||d.hasRequiredAttrs())&&i.indexOf(h)==-1){i.push(h);let f=a(h,l.concat(d));if(f)return f}}return null}return a(this,[])}findWrapping(e){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==e)return this.wrapCache[n+1];let s=this.computeWrapping(e);return this.wrapCache.push(e,s),s}computeWrapping(e){let s=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let i=n.shift(),a=i.match;if(a.matchType(e)){let o=[];for(let l=i;l.type;l=l.via)o.push(l.type);return o.reverse()}for(let o=0;o<a.next.length;o++){let{type:l,next:c}=a.next[o];!l.isLeaf&&!l.hasRequiredAttrs()&&!(l.name in s)&&(!i.type||c.validEnd)&&(n.push({match:l.contentMatch,type:l,via:i}),s[l.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function s(n){e.push(n);for(let i=0;i<n.next.length;i++)e.indexOf(n.next[i].next)==-1&&s(n.next[i].next)}return s(this),e.map((n,i)=>{let a=i+(n.validEnd?"*":" ")+" ";for(let o=0;o<n.next.length;o++)a+=(o?", ":"")+n.next[o].type.name+"->"+e.indexOf(n.next[o].next);return a}).join(`
`)}}$i.empty=new $i(!0);class kO{constructor(e,s){this.string=e,this.nodeTypes=s,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function c2(t){let e=[];do e.push(NO(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function NO(t){let e=[];do e.push(SO(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function SO(t){let e=_O(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=CO(t,e);else break;return e}function Sy(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function CO(t,e){let s=Sy(t),n=s;return t.eat(",")&&(t.next!="}"?n=Sy(t):n=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:s,max:n,expr:e}}function zO(t,e){let s=t.nodeTypes,n=s[e];if(n)return[n];let i=[];for(let a in s){let o=s[a];o.isInGroup(e)&&i.push(o)}return i.length==0&&t.err("No node type or group '"+e+"' found"),i}function _O(t){if(t.eat("(")){let e=c2(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=zO(t,t.next).map(s=>(t.inline==null?t.inline=s.isInline:t.inline!=s.isInline&&t.err("Mixing inline and block content"),{type:"name",value:s}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function AO(t){let e=[[]];return i(a(t,0),s()),e;function s(){return e.push([])-1}function n(o,l,c){let u={term:c,to:l};return e[o].push(u),u}function i(o,l){o.forEach(c=>c.to=l)}function a(o,l){if(o.type=="choice")return o.exprs.reduce((c,u)=>c.concat(a(u,l)),[]);if(o.type=="seq")for(let c=0;;c++){let u=a(o.exprs[c],l);if(c==o.exprs.length-1)return u;i(u,l=s())}else if(o.type=="star"){let c=s();return n(l,c),i(a(o.expr,c),c),[n(c)]}else if(o.type=="plus"){let c=s();return i(a(o.expr,l),c),i(a(o.expr,c),c),[n(c)]}else{if(o.type=="opt")return[n(l)].concat(a(o.expr,l));if(o.type=="range"){let c=l;for(let u=0;u<o.min;u++){let d=s();i(a(o.expr,c),d),c=d}if(o.max==-1)i(a(o.expr,c),c);else for(let u=o.min;u<o.max;u++){let d=s();n(c,d),i(a(o.expr,c),d),c=d}return[n(c)]}else{if(o.type=="name")return[n(l,void 0,o.value)];throw new Error("Unknown expr type")}}}}function u2(t,e){return e-t}function Cy(t,e){let s=[];return n(e),s.sort(u2);function n(i){let a=t[i];if(a.length==1&&!a[0].term)return n(a[0].to);s.push(i);for(let o=0;o<a.length;o++){let{term:l,to:c}=a[o];!l&&s.indexOf(c)==-1&&n(c)}}}function TO(t){let e=Object.create(null);return s(Cy(t,0));function s(n){let i=[];n.forEach(o=>{t[o].forEach(({term:l,to:c})=>{if(!l)return;let u;for(let d=0;d<i.length;d++)i[d][0]==l&&(u=i[d][1]);Cy(t,c).forEach(d=>{u||i.push([l,u=[]]),u.indexOf(d)==-1&&u.push(d)})})});let a=e[n.join(",")]=new $i(n.indexOf(t.length-1)>-1);for(let o=0;o<i.length;o++){let l=i[o][1].sort(u2);a.next.push({type:i[o][0],next:e[l.join(",")]||s(l)})}return a}}function EO(t,e){for(let s=0,n=[t];s<n.length;s++){let i=n[s],a=!i.validEnd,o=[];for(let l=0;l<i.next.length;l++){let{type:c,next:u}=i.next[l];o.push(c.name),a&&!(c.isText||c.hasRequiredAttrs())&&(a=!1),n.indexOf(u)==-1&&n.push(u)}a&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function d2(t){let e=Object.create(null);for(let s in t){let n=t[s];if(!n.hasDefault)return null;e[s]=n.default}return e}function h2(t,e){let s=Object.create(null);for(let n in t){let i=e&&e[n];if(i===void 0){let a=t[n];if(a.hasDefault)i=a.default;else throw new RangeError("No value supplied for attribute "+n)}s[n]=i}return s}function f2(t,e,s,n){for(let i in e)if(!(i in t))throw new RangeError(`Unsupported attribute ${i} for ${s} of type ${i}`);for(let i in t){let a=t[i];a.validate&&a.validate(e[i])}}function m2(t,e){let s=Object.create(null);if(e)for(let n in e)s[n]=new MO(t,n,e[n]);return s}let zy=class p2{constructor(e,s,n){this.name=e,this.schema=s,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=m2(e,n.attrs),this.defaultAttrs=d2(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==$i.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:h2(this.attrs,e)}create(e=null,s,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Wr(this,this.computeAttrs(e),q.from(s),ze.setFrom(n))}createChecked(e=null,s,n){return s=q.from(s),this.checkContent(s),new Wr(this,this.computeAttrs(e),s,ze.setFrom(n))}createAndFill(e=null,s,n){if(e=this.computeAttrs(e),s=q.from(s),s.size){let o=this.contentMatch.fillBefore(s);if(!o)return null;s=o.append(s)}let i=this.contentMatch.matchFragment(s),a=i&&i.fillBefore(q.empty,!0);return a?new Wr(this,e,s.append(a),ze.setFrom(n)):null}validContent(e){let s=this.contentMatch.matchFragment(e);if(!s||!s.validEnd)return!1;for(let n=0;n<e.childCount;n++)if(!this.allowsMarks(e.child(n).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){f2(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let s=0;s<e.length;s++)if(!this.allowsMarkType(e[s].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let s;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?s&&s.push(e[n]):s||(s=e.slice(0,n));return s?s.length?s:ze.none:e}static compile(e,s){let n=Object.create(null);e.forEach((a,o)=>n[a]=new p2(a,s,o));let i=s.spec.topNode||"doc";if(!n[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let a in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}};function DO(t,e,s){let n=s.split("|");return i=>{let a=i===null?"null":typeof i;if(n.indexOf(a)<0)throw new RangeError(`Expected value of type ${n} for attribute ${e} on type ${t}, got ${a}`)}}class MO{constructor(e,s,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate=typeof n.validate=="string"?DO(e,s,n.validate):n.validate}get isRequired(){return!this.hasDefault}}class wh{constructor(e,s,n,i){this.name=e,this.rank=s,this.schema=n,this.spec=i,this.attrs=m2(e,i.attrs),this.excluded=null;let a=d2(this.attrs);this.instance=a?new ze(this,a):null}create(e=null){return!e&&this.instance?this.instance:new ze(this,h2(this.attrs,e))}static compile(e,s){let n=Object.create(null),i=0;return e.forEach((a,o)=>n[a]=new wh(a,i++,s,o)),n}removeFromSet(e){for(var s=0;s<e.length;s++)e[s].type==this&&(e=e.slice(0,s).concat(e.slice(s+1)),s--);return e}isInSet(e){for(let s=0;s<e.length;s++)if(e[s].type==this)return e[s]}checkAttrs(e){f2(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class Lx{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let s=this.spec={};for(let i in e)s[i]=e[i];s.nodes=Rt.from(e.nodes),s.marks=Rt.from(e.marks||{}),this.nodes=zy.compile(this.spec.nodes,this),this.marks=wh.compile(this.spec.marks,this);let n=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let a=this.nodes[i],o=a.spec.content||"",l=a.spec.marks;if(a.contentMatch=n[o]||(n[o]=$i.parse(o,this.nodes)),a.inlineContent=a.contentMatch.inlineContent,a.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!a.isInline||!a.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=a}a.markSet=l=="_"?null:l?_y(this,l.split(" ")):l==""||!a.inlineContent?[]:null}for(let i in this.marks){let a=this.marks[i],o=a.spec.excludes;a.excluded=o==null?[a]:o==""?[]:_y(this,o.split(" "))}this.nodeFromJSON=i=>Wr.fromJSON(this,i),this.markFromJSON=i=>ze.fromJSON(this,i),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,s=null,n,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof zy){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(s,n,i)}text(e,s){let n=this.nodes.text;return new qu(n,n.defaultAttrs,e,ze.setFrom(s))}mark(e,s){return typeof e=="string"&&(e=this.marks[e]),e.create(s)}nodeType(e){let s=this.nodes[e];if(!s)throw new RangeError("Unknown node type: "+e);return s}}function _y(t,e){let s=[];for(let n=0;n<e.length;n++){let i=e[n],a=t.marks[i],o=a;if(a)s.push(a);else for(let l in t.marks){let c=t.marks[l];(i=="_"||c.spec.group&&c.spec.group.split(" ").indexOf(i)>-1)&&s.push(o=c)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[n]+"'")}return s}function PO(t){return t.tag!=null}function IO(t){return t.style!=null}class ir{constructor(e,s){this.schema=e,this.rules=s,this.tags=[],this.styles=[];let n=this.matchedStyles=[];s.forEach(i=>{if(PO(i))this.tags.push(i);else if(IO(i)){let a=/[^=]*/.exec(i.style)[0];n.indexOf(a)<0&&n.push(a),this.styles.push(i)}}),this.normalizeLists=!this.tags.some(i=>{if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;let a=e.nodes[i.node];return a.contentMatch.matchType(a)})}parse(e,s={}){let n=new Ty(this,s,!1);return n.addAll(e,ze.none,s.from,s.to),n.finish()}parseSlice(e,s={}){let n=new Ty(this,s,!0);return n.addAll(e,ze.none,s.from,s.to),Q.maxOpen(n.finish())}matchTag(e,s,n){for(let i=n?this.tags.indexOf(n)+1:0;i<this.tags.length;i++){let a=this.tags[i];if(LO(e,a.tag)&&(a.namespace===void 0||e.namespaceURI==a.namespace)&&(!a.context||s.matchesContext(a.context))){if(a.getAttrs){let o=a.getAttrs(e);if(o===!1)continue;a.attrs=o||void 0}return a}}}matchStyle(e,s,n,i){for(let a=i?this.styles.indexOf(i)+1:0;a<this.styles.length;a++){let o=this.styles[a],l=o.style;if(!(l.indexOf(e)!=0||o.context&&!n.matchesContext(o.context)||l.length>e.length&&(l.charCodeAt(e.length)!=61||l.slice(e.length+1)!=s))){if(o.getAttrs){let c=o.getAttrs(s);if(c===!1)continue;o.attrs=c||void 0}return o}}}static schemaRules(e){let s=[];function n(i){let a=i.priority==null?50:i.priority,o=0;for(;o<s.length;o++){let l=s[o];if((l.priority==null?50:l.priority)<a)break}s.splice(o,0,i)}for(let i in e.marks){let a=e.marks[i].spec.parseDOM;a&&a.forEach(o=>{n(o=Ey(o)),o.mark||o.ignore||o.clearMark||(o.mark=i)})}for(let i in e.nodes){let a=e.nodes[i].spec.parseDOM;a&&a.forEach(o=>{n(o=Ey(o)),o.node||o.ignore||o.mark||(o.node=i)})}return s}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new ir(e,ir.schemaRules(e)))}}const x2={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},OO={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},g2={ol:!0,ul:!0},Dl=1,Bm=2,tl=4;function Ay(t,e,s){return e!=null?(e?Dl:0)|(e==="full"?Bm:0):t&&t.whitespace=="pre"?Dl|Bm:s&~tl}class Oc{constructor(e,s,n,i,a,o){this.type=e,this.attrs=s,this.marks=n,this.solid=i,this.options=o,this.content=[],this.activeMarks=ze.none,this.match=a||(o&tl?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let s=this.type.contentMatch.fillBefore(q.from(e));if(s)this.match=this.type.contentMatch.matchFragment(s);else{let n=this.type.contentMatch,i;return(i=n.findWrapping(e.type))?(this.match=n,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&Dl)){let n=this.content[this.content.length-1],i;if(n&&n.isText&&(i=/[ \t\r\n\u000c]+$/.exec(n.text))){let a=n;n.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=a.withText(a.text.slice(0,a.text.length-i[0].length))}}let s=q.from(this.content);return!e&&this.match&&(s=s.append(this.match.fillBefore(q.empty,!0))),this.type?this.type.create(this.attrs,s,this.marks):s}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!x2.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class Ty{constructor(e,s,n){this.parser=e,this.options=s,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let i=s.topNode,a,o=Ay(null,s.preserveWhitespace,0)|(n?tl:0);i?a=new Oc(i.type,i.attrs,ze.none,!0,s.topMatch||i.type.contentMatch,o):n?a=new Oc(null,null,ze.none,!0,null,o):a=new Oc(e.schema.topNodeType,null,ze.none,!0,null,o),this.nodes=[a],this.find=s.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,s){e.nodeType==3?this.addTextNode(e,s):e.nodeType==1&&this.addElement(e,s)}addTextNode(e,s){let n=e.nodeValue,i=this.top,a=i.options&Bm?"full":this.localPreserveWS||(i.options&Dl)>0;if(a==="full"||i.inlineContext(e)||/[^ \t\r\n\u000c]/.test(n)){if(a)a!=="full"?n=n.replace(/\r?\n|\r/g," "):n=n.replace(/\r\n?/g,`
`);else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let o=i.content[i.content.length-1],l=e.previousSibling;(!o||l&&l.nodeName=="BR"||o.isText&&/[ \t\r\n\u000c]$/.test(o.text))&&(n=n.slice(1))}n&&this.insertNode(this.parser.schema.text(n),s,!/\S/.test(n)),this.findInText(e)}else this.findInside(e)}addElement(e,s,n){let i=this.localPreserveWS,a=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),l;g2.hasOwnProperty(o)&&this.parser.normalizeLists&&RO(e);let c=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(l=this.parser.matchTag(e,this,n));e:if(c?c.ignore:OO.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,s);else if(!c||c.skip||c.closeParent){c&&c.closeParent?this.open=Math.max(0,this.open-1):c&&c.skip.nodeType&&(e=c.skip);let u,d=this.needsBlock;if(x2.hasOwnProperty(o))a.content.length&&a.content[0].isInline&&this.open&&(this.open--,a=this.top),u=!0,a.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,s);break e}let h=c&&c.skip?s:this.readStyles(e,s);h&&this.addAll(e,h),u&&this.sync(a),this.needsBlock=d}else{let u=this.readStyles(e,s);u&&this.addElementByRule(e,c,u,c.consuming===!1?l:void 0)}this.localPreserveWS=i}leafFallback(e,s){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),s)}ignoreFallback(e,s){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),s,!0)}readStyles(e,s){let n=e.style;if(n&&n.length)for(let i=0;i<this.parser.matchedStyles.length;i++){let a=this.parser.matchedStyles[i],o=n.getPropertyValue(a);if(o)for(let l=void 0;;){let c=this.parser.matchStyle(a,o,this,l);if(!c)break;if(c.ignore)return null;if(c.clearMark?s=s.filter(u=>!c.clearMark(u)):s=s.concat(this.parser.schema.marks[c.mark].create(c.attrs)),c.consuming===!1)l=c;else break}}return s}addElementByRule(e,s,n,i){let a,o;if(s.node)if(o=this.parser.schema.nodes[s.node],o.isLeaf)this.insertNode(o.create(s.attrs),n,e.nodeName=="BR")||this.leafFallback(e,n);else{let c=this.enter(o,s.attrs||null,n,s.preserveWhitespace);c&&(a=!0,n=c)}else{let c=this.parser.schema.marks[s.mark];n=n.concat(c.create(s.attrs))}let l=this.top;if(o&&o.isLeaf)this.findInside(e);else if(i)this.addElement(e,n,i);else if(s.getContent)this.findInside(e),s.getContent(e,this.parser.schema).forEach(c=>this.insertNode(c,n,!1));else{let c=e;typeof s.contentElement=="string"?c=e.querySelector(s.contentElement):typeof s.contentElement=="function"?c=s.contentElement(e):s.contentElement&&(c=s.contentElement),this.findAround(e,c,!0),this.addAll(c,n),this.findAround(e,c,!1)}a&&this.sync(l)&&this.open--}addAll(e,s,n,i){let a=n||0;for(let o=n?e.childNodes[n]:e.firstChild,l=i==null?null:e.childNodes[i];o!=l;o=o.nextSibling,++a)this.findAtPoint(e,a),this.addDOM(o,s);this.findAtPoint(e,a)}findPlace(e,s,n){let i,a;for(let o=this.open,l=0;o>=0;o--){let c=this.nodes[o],u=c.findWrapping(e);if(u&&(!i||i.length>u.length+l)&&(i=u,a=c,!u.length))break;if(c.solid){if(n)break;l+=2}}if(!i)return null;this.sync(a);for(let o=0;o<i.length;o++)s=this.enterInner(i[o],null,s,!1);return s}insertNode(e,s,n){if(e.isInline&&this.needsBlock&&!this.top.type){let a=this.textblockFromContext();a&&(s=this.enterInner(a,null,s))}let i=this.findPlace(e,s,n);if(i){this.closeExtra();let a=this.top;a.match&&(a.match=a.match.matchType(e.type));let o=ze.none;for(let l of i.concat(e.marks))(a.type?a.type.allowsMarkType(l.type):Dy(l.type,e.type))&&(o=l.addToSet(o));return a.content.push(e.mark(o)),!0}return!1}enter(e,s,n,i){let a=this.findPlace(e.create(s),n,!1);return a&&(a=this.enterInner(e,s,n,!0,i)),a}enterInner(e,s,n,i=!1,a){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let l=Ay(e,a,o.options);o.options&tl&&o.content.length==0&&(l|=tl);let c=ze.none;return n=n.filter(u=>(o.type?o.type.allowsMarkType(u.type):Dy(u.type,e))?(c=u.addToSet(c),!1):!0),this.nodes.push(new Oc(e,s,c,i,null,l)),this.open++,n}closeExtra(e=!1){let s=this.nodes.length-1;if(s>this.open){for(;s>this.open;s--)this.nodes[s-1].content.push(this.nodes[s].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let s=this.open;s>=0;s--){if(this.nodes[s]==e)return this.open=s,!0;this.localPreserveWS&&(this.nodes[s].options|=Dl)}return!1}get currentPos(){this.closeExtra();let e=0;for(let s=this.open;s>=0;s--){let n=this.nodes[s].content;for(let i=n.length-1;i>=0;i--)e+=n[i].nodeSize;s&&e++}return e}findAtPoint(e,s){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==s&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let s=0;s<this.find.length;s++)this.find[s].pos==null&&e.nodeType==1&&e.contains(this.find[s].node)&&(this.find[s].pos=this.currentPos)}findAround(e,s,n){if(e!=s&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&s.compareDocumentPosition(this.find[i].node)&(n?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let s=0;s<this.find.length;s++)this.find[s].node==e&&(this.find[s].pos=this.currentPos-(e.nodeValue.length-this.find[s].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let s=e.split("/"),n=this.options.context,i=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),a=-(n?n.depth+1:0)+(i?0:1),o=(l,c)=>{for(;l>=0;l--){let u=s[l];if(u==""){if(l==s.length-1||l==0)continue;for(;c>=a;c--)if(o(l-1,c))return!0;return!1}else{let d=c>0||c==0&&i?this.nodes[c].type:n&&c>=a?n.node(c-a).type:null;if(!d||d.name!=u&&!d.isInGroup(u))return!1;c--}}return!0};return o(s.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let s=e.depth;s>=0;s--){let n=e.node(s).contentMatchAt(e.indexAfter(s)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let s in this.parser.schema.nodes){let n=this.parser.schema.nodes[s];if(n.isTextblock&&n.defaultAttrs)return n}}}function RO(t){for(let e=t.firstChild,s=null;e;e=e.nextSibling){let n=e.nodeType==1?e.nodeName.toLowerCase():null;n&&g2.hasOwnProperty(n)&&s?(s.appendChild(e),e=s):n=="li"?s=e:n&&(s=null)}}function LO(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function Ey(t){let e={};for(let s in t)e[s]=t[s];return e}function Dy(t,e){let s=e.schema.nodes;for(let n in s){let i=s[n];if(!i.allowsMarkType(t))continue;let a=[],o=l=>{a.push(l);for(let c=0;c<l.edgeCount;c++){let{type:u,next:d}=l.edge(c);if(u==e||a.indexOf(d)<0&&o(d))return!0}};if(o(i.contentMatch))return!0}}class ea{constructor(e,s){this.nodes=e,this.marks=s}serializeFragment(e,s={},n){n||(n=yf(s).createDocumentFragment());let i=n,a=[];return e.forEach(o=>{if(a.length||o.marks.length){let l=0,c=0;for(;l<a.length&&c<o.marks.length;){let u=o.marks[c];if(!this.marks[u.type.name]){c++;continue}if(!u.eq(a[l][0])||u.type.spec.spanning===!1)break;l++,c++}for(;l<a.length;)i=a.pop()[1];for(;c<o.marks.length;){let u=o.marks[c++],d=this.serializeMark(u,o.isInline,s);d&&(a.push([u,i]),i.appendChild(d.dom),i=d.contentDOM||d.dom)}}i.appendChild(this.serializeNodeInner(o,s))}),n}serializeNodeInner(e,s){let{dom:n,contentDOM:i}=lu(yf(s),this.nodes[e.type.name](e),null,e.attrs);if(i){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,s,i)}return n}serializeNode(e,s={}){let n=this.serializeNodeInner(e,s);for(let i=e.marks.length-1;i>=0;i--){let a=this.serializeMark(e.marks[i],e.isInline,s);a&&((a.contentDOM||a.dom).appendChild(n),n=a.dom)}return n}serializeMark(e,s,n={}){let i=this.marks[e.type.name];return i&&lu(yf(n),i(e,s),null,e.attrs)}static renderSpec(e,s,n=null,i){return lu(e,s,n,i)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new ea(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let s=My(e.nodes);return s.text||(s.text=n=>n.text),s}static marksFromSchema(e){return My(e.marks)}}function My(t){let e={};for(let s in t){let n=t[s].spec.toDOM;n&&(e[s]=n)}return e}function yf(t){return t.document||window.document}const Py=new WeakMap;function FO(t){let e=Py.get(t);return e===void 0&&Py.set(t,e=$O(t)),e}function $O(t){let e=null;function s(n){if(n&&typeof n=="object")if(Array.isArray(n))if(typeof n[0]=="string")e||(e=[]),e.push(n);else for(let i=0;i<n.length;i++)s(n[i]);else for(let i in n)s(n[i])}return s(t),e}function lu(t,e,s,n){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let i=e[0],a;if(typeof i!="string")throw new RangeError("Invalid array passed to renderSpec");if(n&&(a=FO(n))&&a.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=i.indexOf(" ");o>0&&(s=i.slice(0,o),i=i.slice(o+1));let l,c=s?t.createElementNS(s,i):t.createElement(i),u=e[1],d=1;if(u&&typeof u=="object"&&u.nodeType==null&&!Array.isArray(u)){d=2;for(let h in u)if(u[h]!=null){let f=h.indexOf(" ");f>0?c.setAttributeNS(h.slice(0,f),h.slice(f+1),u[h]):h=="style"&&c.style?c.style.cssText=u[h]:c.setAttribute(h,u[h])}}for(let h=d;h<e.length;h++){let f=e[h];if(f===0){if(h<e.length-1||h>d)throw new RangeError("Content hole must be the only child of its parent node");return{dom:c,contentDOM:c}}else{let{dom:m,contentDOM:p}=lu(t,f,s,n);if(c.appendChild(m),p){if(l)throw new RangeError("Multiple content holes");l=p}}}return{dom:c,contentDOM:l}}const y2=65535,b2=Math.pow(2,16);function BO(t,e){return t+e*b2}function Iy(t){return t&y2}function qO(t){return(t-(t&y2))/b2}const j2=1,w2=2,cu=4,v2=8;class qm{constructor(e,s,n){this.pos=e,this.delInfo=s,this.recover=n}get deleted(){return(this.delInfo&v2)>0}get deletedBefore(){return(this.delInfo&(j2|cu))>0}get deletedAfter(){return(this.delInfo&(w2|cu))>0}get deletedAcross(){return(this.delInfo&cu)>0}}class Ts{constructor(e,s=!1){if(this.ranges=e,this.inverted=s,!e.length&&Ts.empty)return Ts.empty}recover(e){let s=0,n=Iy(e);if(!this.inverted)for(let i=0;i<n;i++)s+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[n*3]+s+qO(e)}mapResult(e,s=1){return this._map(e,s,!1)}map(e,s=1){return this._map(e,s,!0)}_map(e,s,n){let i=0,a=this.inverted?2:1,o=this.inverted?1:2;for(let l=0;l<this.ranges.length;l+=3){let c=this.ranges[l]-(this.inverted?i:0);if(c>e)break;let u=this.ranges[l+a],d=this.ranges[l+o],h=c+u;if(e<=h){let f=u?e==c?-1:e==h?1:s:s,m=c+i+(f<0?0:d);if(n)return m;let p=e==(s<0?c:h)?null:BO(l/3,e-c),x=e==c?w2:e==h?j2:cu;return(s<0?e!=c:e!=h)&&(x|=v2),new qm(m,x,p)}i+=d-u}return n?e+i:new qm(e+i,0,null)}touches(e,s){let n=0,i=Iy(s),a=this.inverted?2:1,o=this.inverted?1:2;for(let l=0;l<this.ranges.length;l+=3){let c=this.ranges[l]-(this.inverted?n:0);if(c>e)break;let u=this.ranges[l+a],d=c+u;if(e<=d&&l==i*3)return!0;n+=this.ranges[l+o]-u}return!1}forEach(e){let s=this.inverted?2:1,n=this.inverted?1:2;for(let i=0,a=0;i<this.ranges.length;i+=3){let o=this.ranges[i],l=o-(this.inverted?a:0),c=o+(this.inverted?0:a),u=this.ranges[i+s],d=this.ranges[i+n];e(l,l+u,c,c+d),a+=d-u}}invert(){return new Ts(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?Ts.empty:new Ts(e<0?[0,-e,0]:[0,0,e])}}Ts.empty=new Ts([]);class Ml{constructor(e,s,n=0,i=e?e.length:0){this.mirror=s,this.from=n,this.to=i,this._maps=e||[],this.ownData=!(e||s)}get maps(){return this._maps}slice(e=0,s=this.maps.length){return new Ml(this._maps,this.mirror,e,s)}appendMap(e,s){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),s!=null&&this.setMirror(this._maps.length-1,s)}appendMapping(e){for(let s=0,n=this._maps.length;s<e._maps.length;s++){let i=e.getMirror(s);this.appendMap(e._maps[s],i!=null&&i<s?n+i:void 0)}}getMirror(e){if(this.mirror){for(let s=0;s<this.mirror.length;s++)if(this.mirror[s]==e)return this.mirror[s+(s%2?-1:1)]}}setMirror(e,s){this.mirror||(this.mirror=[]),this.mirror.push(e,s)}appendMappingInverted(e){for(let s=e.maps.length-1,n=this._maps.length+e._maps.length;s>=0;s--){let i=e.getMirror(s);this.appendMap(e._maps[s].invert(),i!=null&&i>s?n-i-1:void 0)}}invert(){let e=new Ml;return e.appendMappingInverted(this),e}map(e,s=1){if(this.mirror)return this._map(e,s,!0);for(let n=this.from;n<this.to;n++)e=this._maps[n].map(e,s);return e}mapResult(e,s=1){return this._map(e,s,!1)}_map(e,s,n){let i=0;for(let a=this.from;a<this.to;a++){let o=this._maps[a],l=o.mapResult(e,s);if(l.recover!=null){let c=this.getMirror(a);if(c!=null&&c>a&&c<this.to){a=c,e=this._maps[c].recover(l.recover);continue}}i|=l.delInfo,e=l.pos}return n?e:new qm(e,i,null)}}const bf=Object.create(null);class Xt{getMap(){return Ts.empty}merge(e){return null}static fromJSON(e,s){if(!s||!s.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=bf[s.stepType];if(!n)throw new RangeError(`No step type ${s.stepType} defined`);return n.fromJSON(e,s)}static jsonID(e,s){if(e in bf)throw new RangeError("Duplicate use of step JSON ID "+e);return bf[e]=s,s.prototype.jsonID=e,s}}class yt{constructor(e,s){this.doc=e,this.failed=s}static ok(e){return new yt(e,null)}static fail(e){return new yt(null,e)}static fromReplace(e,s,n,i){try{return yt.ok(e.replace(s,n,i))}catch(a){if(a instanceof Fu)return yt.fail(a.message);throw a}}}function Fx(t,e,s){let n=[];for(let i=0;i<t.childCount;i++){let a=t.child(i);a.content.size&&(a=a.copy(Fx(a.content,e,a))),a.isInline&&(a=e(a,s,i)),n.push(a)}return q.fromArray(n)}class Lr extends Xt{constructor(e,s,n){super(),this.from=e,this.to=s,this.mark=n}apply(e){let s=e.slice(this.from,this.to),n=e.resolve(this.from),i=n.node(n.sharedDepth(this.to)),a=new Q(Fx(s.content,(o,l)=>!o.isAtom||!l.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),i),s.openStart,s.openEnd);return yt.fromReplace(e,this.from,this.to,a)}invert(){return new cn(this.from,this.to,this.mark)}map(e){let s=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return s.deleted&&n.deleted||s.pos>=n.pos?null:new Lr(s.pos,n.pos,this.mark)}merge(e){return e instanceof Lr&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Lr(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,s){if(typeof s.from!="number"||typeof s.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Lr(s.from,s.to,e.markFromJSON(s.mark))}}Xt.jsonID("addMark",Lr);class cn extends Xt{constructor(e,s,n){super(),this.from=e,this.to=s,this.mark=n}apply(e){let s=e.slice(this.from,this.to),n=new Q(Fx(s.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),s.openStart,s.openEnd);return yt.fromReplace(e,this.from,this.to,n)}invert(){return new Lr(this.from,this.to,this.mark)}map(e){let s=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return s.deleted&&n.deleted||s.pos>=n.pos?null:new cn(s.pos,n.pos,this.mark)}merge(e){return e instanceof cn&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new cn(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,s){if(typeof s.from!="number"||typeof s.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new cn(s.from,s.to,e.markFromJSON(s.mark))}}Xt.jsonID("removeMark",cn);class Fr extends Xt{constructor(e,s){super(),this.pos=e,this.mark=s}apply(e){let s=e.nodeAt(this.pos);if(!s)return yt.fail("No node at mark step's position");let n=s.type.create(s.attrs,null,this.mark.addToSet(s.marks));return yt.fromReplace(e,this.pos,this.pos+1,new Q(q.from(n),0,s.isLeaf?0:1))}invert(e){let s=e.nodeAt(this.pos);if(s){let n=this.mark.addToSet(s.marks);if(n.length==s.marks.length){for(let i=0;i<s.marks.length;i++)if(!s.marks[i].isInSet(n))return new Fr(this.pos,s.marks[i]);return new Fr(this.pos,this.mark)}}return new Bi(this.pos,this.mark)}map(e){let s=e.mapResult(this.pos,1);return s.deletedAfter?null:new Fr(s.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,s){if(typeof s.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Fr(s.pos,e.markFromJSON(s.mark))}}Xt.jsonID("addNodeMark",Fr);class Bi extends Xt{constructor(e,s){super(),this.pos=e,this.mark=s}apply(e){let s=e.nodeAt(this.pos);if(!s)return yt.fail("No node at mark step's position");let n=s.type.create(s.attrs,null,this.mark.removeFromSet(s.marks));return yt.fromReplace(e,this.pos,this.pos+1,new Q(q.from(n),0,s.isLeaf?0:1))}invert(e){let s=e.nodeAt(this.pos);return!s||!this.mark.isInSet(s.marks)?this:new Fr(this.pos,this.mark)}map(e){let s=e.mapResult(this.pos,1);return s.deletedAfter?null:new Bi(s.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,s){if(typeof s.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new Bi(s.pos,e.markFromJSON(s.mark))}}Xt.jsonID("removeNodeMark",Bi);class _t extends Xt{constructor(e,s,n,i=!1){super(),this.from=e,this.to=s,this.slice=n,this.structure=i}apply(e){return this.structure&&Vm(e,this.from,this.to)?yt.fail("Structure replace would overwrite content"):yt.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new Ts([this.from,this.to-this.from,this.slice.size])}invert(e){return new _t(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let s=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return s.deletedAcross&&n.deletedAcross?null:new _t(s.pos,Math.max(s.pos,n.pos),this.slice,this.structure)}merge(e){if(!(e instanceof _t)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let s=this.slice.size+e.slice.size==0?Q.empty:new Q(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new _t(this.from,this.to+(e.to-e.from),s,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let s=this.slice.size+e.slice.size==0?Q.empty:new Q(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new _t(e.from,this.to,s,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,s){if(typeof s.from!="number"||typeof s.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new _t(s.from,s.to,Q.fromJSON(e,s.slice),!!s.structure)}}Xt.jsonID("replace",_t);class Dt extends Xt{constructor(e,s,n,i,a,o,l=!1){super(),this.from=e,this.to=s,this.gapFrom=n,this.gapTo=i,this.slice=a,this.insert=o,this.structure=l}apply(e){if(this.structure&&(Vm(e,this.from,this.gapFrom)||Vm(e,this.gapTo,this.to)))return yt.fail("Structure gap-replace would overwrite content");let s=e.slice(this.gapFrom,this.gapTo);if(s.openStart||s.openEnd)return yt.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,s.content);return n?yt.fromReplace(e,this.from,this.to,n):yt.fail("Content does not fit in gap")}getMap(){return new Ts([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let s=this.gapTo-this.gapFrom;return new Dt(this.from,this.from+this.slice.size+s,this.from+this.insert,this.from+this.insert+s,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let s=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),i=this.from==this.gapFrom?s.pos:e.map(this.gapFrom,-1),a=this.to==this.gapTo?n.pos:e.map(this.gapTo,1);return s.deletedAcross&&n.deletedAcross||i<s.pos||a>n.pos?null:new Dt(s.pos,n.pos,i,a,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,s){if(typeof s.from!="number"||typeof s.to!="number"||typeof s.gapFrom!="number"||typeof s.gapTo!="number"||typeof s.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Dt(s.from,s.to,s.gapFrom,s.gapTo,Q.fromJSON(e,s.slice),s.insert,!!s.structure)}}Xt.jsonID("replaceAround",Dt);function Vm(t,e,s){let n=t.resolve(e),i=s-e,a=n.depth;for(;i>0&&a>0&&n.indexAfter(a)==n.node(a).childCount;)a--,i--;if(i>0){let o=n.node(a).maybeChild(n.indexAfter(a));for(;i>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,i--}}return!1}function VO(t,e,s,n){let i=[],a=[],o,l;t.doc.nodesBetween(e,s,(c,u,d)=>{if(!c.isInline)return;let h=c.marks;if(!n.isInSet(h)&&d.type.allowsMarkType(n.type)){let f=Math.max(u,e),m=Math.min(u+c.nodeSize,s),p=n.addToSet(h);for(let x=0;x<h.length;x++)h[x].isInSet(p)||(o&&o.to==f&&o.mark.eq(h[x])?o.to=m:i.push(o=new cn(f,m,h[x])));l&&l.to==f?l.to=m:a.push(l=new Lr(f,m,n))}}),i.forEach(c=>t.step(c)),a.forEach(c=>t.step(c))}function UO(t,e,s,n){let i=[],a=0;t.doc.nodesBetween(e,s,(o,l)=>{if(!o.isInline)return;a++;let c=null;if(n instanceof wh){let u=o.marks,d;for(;d=n.isInSet(u);)(c||(c=[])).push(d),u=d.removeFromSet(u)}else n?n.isInSet(o.marks)&&(c=[n]):c=o.marks;if(c&&c.length){let u=Math.min(l+o.nodeSize,s);for(let d=0;d<c.length;d++){let h=c[d],f;for(let m=0;m<i.length;m++){let p=i[m];p.step==a-1&&h.eq(i[m].style)&&(f=p)}f?(f.to=u,f.step=a):i.push({style:h,from:Math.max(l,e),to:u,step:a})}}}),i.forEach(o=>t.step(new cn(o.from,o.to,o.style)))}function $x(t,e,s,n=s.contentMatch,i=!0){let a=t.doc.nodeAt(e),o=[],l=e+1;for(let c=0;c<a.childCount;c++){let u=a.child(c),d=l+u.nodeSize,h=n.matchType(u.type);if(!h)o.push(new _t(l,d,Q.empty));else{n=h;for(let f=0;f<u.marks.length;f++)s.allowsMarkType(u.marks[f].type)||t.step(new cn(l,d,u.marks[f]));if(i&&u.isText&&s.whitespace!="pre"){let f,m=/\r?\n|\r/g,p;for(;f=m.exec(u.text);)p||(p=new Q(q.from(s.schema.text(" ",s.allowedMarks(u.marks))),0,0)),o.push(new _t(l+f.index,l+f.index+f[0].length,p))}}l=d}if(!n.validEnd){let c=n.fillBefore(q.empty,!0);t.replace(l,l,new Q(c,0,0))}for(let c=o.length-1;c>=0;c--)t.step(o[c])}function WO(t,e,s){return(e==0||t.canReplace(e,t.childCount))&&(s==t.childCount||t.canReplace(0,s))}function wo(t){let s=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let n=t.depth;;--n){let i=t.$from.node(n),a=t.$from.index(n),o=t.$to.indexAfter(n);if(n<t.depth&&i.canReplace(a,o,s))return n;if(n==0||i.type.spec.isolating||!WO(i,a,o))break}return null}function KO(t,e,s){let{$from:n,$to:i,depth:a}=e,o=n.before(a+1),l=i.after(a+1),c=o,u=l,d=q.empty,h=0;for(let p=a,x=!1;p>s;p--)x||n.index(p)>0?(x=!0,d=q.from(n.node(p).copy(d)),h++):c--;let f=q.empty,m=0;for(let p=a,x=!1;p>s;p--)x||i.after(p+1)<i.end(p)?(x=!0,f=q.from(i.node(p).copy(f)),m++):u++;t.step(new Dt(c,u,o,l,new Q(d.append(f),h,m),d.size-h,!0))}function Bx(t,e,s=null,n=t){let i=HO(t,e),a=i&&GO(n,e);return a?i.map(Oy).concat({type:e,attrs:s}).concat(a.map(Oy)):null}function Oy(t){return{type:t,attrs:null}}function HO(t,e){let{parent:s,startIndex:n,endIndex:i}=t,a=s.contentMatchAt(n).findWrapping(e);if(!a)return null;let o=a.length?a[0]:e;return s.canReplaceWith(n,i,o)?a:null}function GO(t,e){let{parent:s,startIndex:n,endIndex:i}=t,a=s.child(n),o=e.contentMatch.findWrapping(a.type);if(!o)return null;let c=(o.length?o[o.length-1]:e).contentMatch;for(let u=n;c&&u<i;u++)c=c.matchType(s.child(u).type);return!c||!c.validEnd?null:o}function JO(t,e,s){let n=q.empty;for(let o=s.length-1;o>=0;o--){if(n.size){let l=s[o].type.contentMatch.matchFragment(n);if(!l||!l.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}n=q.from(s[o].type.create(s[o].attrs,n))}let i=e.start,a=e.end;t.step(new Dt(i,a,i,a,new Q(n,0,0),s.length,!0))}function ZO(t,e,s,n,i){if(!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let a=t.steps.length;t.doc.nodesBetween(e,s,(o,l)=>{let c=typeof i=="function"?i(o):i;if(o.isTextblock&&!o.hasMarkup(n,c)&&QO(t.doc,t.mapping.slice(a).map(l),n)){let u=null;if(n.schema.linebreakReplacement){let m=n.whitespace=="pre",p=!!n.contentMatch.matchType(n.schema.linebreakReplacement);m&&!p?u=!1:!m&&p&&(u=!0)}u===!1&&N2(t,o,l,a),$x(t,t.mapping.slice(a).map(l,1),n,void 0,u===null);let d=t.mapping.slice(a),h=d.map(l,1),f=d.map(l+o.nodeSize,1);return t.step(new Dt(h,f,h+1,f-1,new Q(q.from(n.create(c,null,o.marks)),0,0),1,!0)),u===!0&&k2(t,o,l,a),!1}})}function k2(t,e,s,n){e.forEach((i,a)=>{if(i.isText){let o,l=/\r?\n|\r/g;for(;o=l.exec(i.text);){let c=t.mapping.slice(n).map(s+1+a+o.index);t.replaceWith(c,c+1,e.type.schema.linebreakReplacement.create())}}})}function N2(t,e,s,n){e.forEach((i,a)=>{if(i.type==i.type.schema.linebreakReplacement){let o=t.mapping.slice(n).map(s+1+a);t.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function QO(t,e,s){let n=t.resolve(e),i=n.index();return n.parent.canReplaceWith(i,i+1,s)}function YO(t,e,s,n,i){let a=t.doc.nodeAt(e);if(!a)throw new RangeError("No node at given position");s||(s=a.type);let o=s.create(n,null,i||a.marks);if(a.isLeaf)return t.replaceWith(e,e+a.nodeSize,o);if(!s.validContent(a.content))throw new RangeError("Invalid content for node type "+s.name);t.step(new Dt(e,e+a.nodeSize,e+1,e+a.nodeSize-1,new Q(q.from(o),0,0),1,!0))}function ar(t,e,s=1,n){let i=t.resolve(e),a=i.depth-s,o=n&&n[n.length-1]||i.parent;if(a<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let u=i.depth-1,d=s-2;u>a;u--,d--){let h=i.node(u),f=i.index(u);if(h.type.spec.isolating)return!1;let m=h.content.cutByIndex(f,h.childCount),p=n&&n[d+1];p&&(m=m.replaceChild(0,p.type.create(p.attrs)));let x=n&&n[d]||h;if(!h.canReplace(f+1,h.childCount)||!x.type.validContent(m))return!1}let l=i.indexAfter(a),c=n&&n[0];return i.node(a).canReplaceWith(l,l,c?c.type:i.node(a+1).type)}function XO(t,e,s=1,n){let i=t.doc.resolve(e),a=q.empty,o=q.empty;for(let l=i.depth,c=i.depth-s,u=s-1;l>c;l--,u--){a=q.from(i.node(l).copy(a));let d=n&&n[u];o=q.from(d?d.type.create(d.attrs,o):i.node(l).copy(o))}t.step(new _t(e,e,new Q(a.append(o),s,s),!0))}function ci(t,e){let s=t.resolve(e),n=s.index();return S2(s.nodeBefore,s.nodeAfter)&&s.parent.canReplace(n,n+1)}function eR(t,e){e.content.size||t.type.compatibleContent(e.type);let s=t.contentMatchAt(t.childCount),{linebreakReplacement:n}=t.type.schema;for(let i=0;i<e.childCount;i++){let a=e.child(i),o=a.type==n?t.type.schema.nodes.text:a.type;if(s=s.matchType(o),!s||!t.type.allowsMarks(a.marks))return!1}return s.validEnd}function S2(t,e){return!!(t&&e&&!t.isLeaf&&eR(t,e))}function vh(t,e,s=-1){let n=t.resolve(e);for(let i=n.depth;;i--){let a,o,l=n.index(i);if(i==n.depth?(a=n.nodeBefore,o=n.nodeAfter):s>0?(a=n.node(i+1),l++,o=n.node(i).maybeChild(l)):(a=n.node(i).maybeChild(l-1),o=n.node(i+1)),a&&!a.isTextblock&&S2(a,o)&&n.node(i).canReplace(l,l+1))return e;if(i==0)break;e=s<0?n.before(i):n.after(i)}}function tR(t,e,s){let n=null,{linebreakReplacement:i}=t.doc.type.schema,a=t.doc.resolve(e-s),o=a.node().type;if(i&&o.inlineContent){let d=o.whitespace=="pre",h=!!o.contentMatch.matchType(i);d&&!h?n=!1:!d&&h&&(n=!0)}let l=t.steps.length;if(n===!1){let d=t.doc.resolve(e+s);N2(t,d.node(),d.before(),l)}o.inlineContent&&$x(t,e+s-1,o,a.node().contentMatchAt(a.index()),n==null);let c=t.mapping.slice(l),u=c.map(e-s);if(t.step(new _t(u,c.map(e+s,-1),Q.empty,!0)),n===!0){let d=t.doc.resolve(u);k2(t,d.node(),d.before(),t.steps.length)}return t}function sR(t,e,s){let n=t.resolve(e);if(n.parent.canReplaceWith(n.index(),n.index(),s))return e;if(n.parentOffset==0)for(let i=n.depth-1;i>=0;i--){let a=n.index(i);if(n.node(i).canReplaceWith(a,a,s))return n.before(i+1);if(a>0)return null}if(n.parentOffset==n.parent.content.size)for(let i=n.depth-1;i>=0;i--){let a=n.indexAfter(i);if(n.node(i).canReplaceWith(a,a,s))return n.after(i+1);if(a<n.node(i).childCount)return null}return null}function C2(t,e,s){let n=t.resolve(e);if(!s.content.size)return e;let i=s.content;for(let a=0;a<s.openStart;a++)i=i.firstChild.content;for(let a=1;a<=(s.openStart==0&&s.size?2:1);a++)for(let o=n.depth;o>=0;o--){let l=o==n.depth?0:n.pos<=(n.start(o+1)+n.end(o+1))/2?-1:1,c=n.index(o)+(l>0?1:0),u=n.node(o),d=!1;if(a==1)d=u.canReplace(c,c,i);else{let h=u.contentMatchAt(c).findWrapping(i.firstChild.type);d=h&&u.canReplaceWith(c,c,h[0])}if(d)return l==0?n.pos:l<0?n.before(o+1):n.after(o+1)}return null}function kh(t,e,s=e,n=Q.empty){if(e==s&&!n.size)return null;let i=t.resolve(e),a=t.resolve(s);return z2(i,a,n)?new _t(e,s,n):new nR(i,a,n).fit()}function z2(t,e,s){return!s.openStart&&!s.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),s.content)}class nR{constructor(e,s,n){this.$from=e,this.$to=s,this.unplaced=n,this.frontier=[],this.placed=q.empty;for(let i=0;i<=e.depth;i++){let a=e.node(i);this.frontier.push({type:a.type,match:a.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=q.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let u=this.findFittable();u?this.placeNodes(u):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),s=this.placed.size-this.depth-this.$from.depth,n=this.$from,i=this.close(e<0?this.$to:n.doc.resolve(e));if(!i)return null;let a=this.placed,o=n.depth,l=i.depth;for(;o&&l&&a.childCount==1;)a=a.firstChild.content,o--,l--;let c=new Q(a,o,l);return e>-1?new Dt(n.pos,e,this.$to.pos,this.$to.end(),c,s):c.size||n.pos!=this.$to.pos?new _t(n.pos,i.pos,c):null}findFittable(){let e=this.unplaced.openStart;for(let s=this.unplaced.content,n=0,i=this.unplaced.openEnd;n<e;n++){let a=s.firstChild;if(s.childCount>1&&(i=0),a.type.spec.isolating&&i<=n){e=n;break}s=a.content}for(let s=1;s<=2;s++)for(let n=s==1?e:this.unplaced.openStart;n>=0;n--){let i,a=null;n?(a=jf(this.unplaced.content,n-1).firstChild,i=a.content):i=this.unplaced.content;let o=i.firstChild;for(let l=this.depth;l>=0;l--){let{type:c,match:u}=this.frontier[l],d,h=null;if(s==1&&(o?u.matchType(o.type)||(h=u.fillBefore(q.from(o),!1)):a&&c.compatibleContent(a.type)))return{sliceDepth:n,frontierDepth:l,parent:a,inject:h};if(s==2&&o&&(d=u.findWrapping(o.type)))return{sliceDepth:n,frontierDepth:l,parent:a,wrap:d};if(a&&u.matchType(a.type))break}}}openMore(){let{content:e,openStart:s,openEnd:n}=this.unplaced,i=jf(e,s);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new Q(e,s+1,Math.max(n,i.size+s>=e.size-n?s+1:0)),!0)}dropNode(){let{content:e,openStart:s,openEnd:n}=this.unplaced,i=jf(e,s);if(i.childCount<=1&&s>0){let a=e.size-s<=s+i.size;this.unplaced=new Q(Uo(e,s-1,1),s-1,a?s-1:n)}else this.unplaced=new Q(Uo(e,s,1),s,n)}placeNodes({sliceDepth:e,frontierDepth:s,parent:n,inject:i,wrap:a}){for(;this.depth>s;)this.closeFrontierNode();if(a)for(let x=0;x<a.length;x++)this.openFrontierNode(a[x]);let o=this.unplaced,l=n?n.content:o.content,c=o.openStart-e,u=0,d=[],{match:h,type:f}=this.frontier[s];if(i){for(let x=0;x<i.childCount;x++)d.push(i.child(x));h=h.matchFragment(i)}let m=l.size+e-(o.content.size-o.openEnd);for(;u<l.childCount;){let x=l.child(u),g=h.matchType(x.type);if(!g)break;u++,(u>1||c==0||x.content.size)&&(h=g,d.push(_2(x.mark(f.allowedMarks(x.marks)),u==1?c:0,u==l.childCount?m:-1)))}let p=u==l.childCount;p||(m=-1),this.placed=Wo(this.placed,s,q.from(d)),this.frontier[s].match=h,p&&m<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let x=0,g=l;x<m;x++){let y=g.lastChild;this.frontier.push({type:y.type,match:y.contentMatchAt(y.childCount)}),g=y.content}this.unplaced=p?e==0?Q.empty:new Q(Uo(o.content,e-1,1),e-1,m<0?o.openEnd:e-1):new Q(Uo(o.content,e,u),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],s;if(!e.type.isTextblock||!wf(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(s=this.findCloseLevel(this.$to))&&s.depth==this.depth)return-1;let{depth:n}=this.$to,i=this.$to.after(n);for(;n>1&&i==this.$to.end(--n);)++i;return i}findCloseLevel(e){e:for(let s=Math.min(this.depth,e.depth);s>=0;s--){let{match:n,type:i}=this.frontier[s],a=s<e.depth&&e.end(s+1)==e.pos+(e.depth-(s+1)),o=wf(e,s,i,n,a);if(o){for(let l=s-1;l>=0;l--){let{match:c,type:u}=this.frontier[l],d=wf(e,l,u,c,!0);if(!d||d.childCount)continue e}return{depth:s,fit:o,move:a?e.doc.resolve(e.after(s+1)):e}}}}close(e){let s=this.findCloseLevel(e);if(!s)return null;for(;this.depth>s.depth;)this.closeFrontierNode();s.fit.childCount&&(this.placed=Wo(this.placed,s.depth,s.fit)),e=s.move;for(let n=s.depth+1;n<=e.depth;n++){let i=e.node(n),a=i.type.contentMatch.fillBefore(i.content,!0,e.index(n));this.openFrontierNode(i.type,i.attrs,a)}return e}openFrontierNode(e,s=null,n){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=Wo(this.placed,this.depth,q.from(e.create(s,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let s=this.frontier.pop().match.fillBefore(q.empty,!0);s.childCount&&(this.placed=Wo(this.placed,this.frontier.length,s))}}function Uo(t,e,s){return e==0?t.cutByIndex(s,t.childCount):t.replaceChild(0,t.firstChild.copy(Uo(t.firstChild.content,e-1,s)))}function Wo(t,e,s){return e==0?t.append(s):t.replaceChild(t.childCount-1,t.lastChild.copy(Wo(t.lastChild.content,e-1,s)))}function jf(t,e){for(let s=0;s<e;s++)t=t.firstChild.content;return t}function _2(t,e,s){if(e<=0)return t;let n=t.content;return e>1&&(n=n.replaceChild(0,_2(n.firstChild,e-1,n.childCount==1?s-1:0))),e>0&&(n=t.type.contentMatch.fillBefore(n).append(n),s<=0&&(n=n.append(t.type.contentMatch.matchFragment(n).fillBefore(q.empty,!0)))),t.copy(n)}function wf(t,e,s,n,i){let a=t.node(e),o=i?t.indexAfter(e):t.index(e);if(o==a.childCount&&!s.compatibleContent(a.type))return null;let l=n.fillBefore(a.content,!0,o);return l&&!rR(s,a.content,o)?l:null}function rR(t,e,s){for(let n=s;n<e.childCount;n++)if(!t.allowsMarks(e.child(n).marks))return!0;return!1}function iR(t){return t.spec.defining||t.spec.definingForContent}function aR(t,e,s,n){if(!n.size)return t.deleteRange(e,s);let i=t.doc.resolve(e),a=t.doc.resolve(s);if(z2(i,a,n))return t.step(new _t(e,s,n));let o=T2(i,t.doc.resolve(s));o[o.length-1]==0&&o.pop();let l=-(i.depth+1);o.unshift(l);for(let f=i.depth,m=i.pos-1;f>0;f--,m--){let p=i.node(f).type.spec;if(p.defining||p.definingAsContext||p.isolating)break;o.indexOf(f)>-1?l=f:i.before(f)==m&&o.splice(1,0,-f)}let c=o.indexOf(l),u=[],d=n.openStart;for(let f=n.content,m=0;;m++){let p=f.firstChild;if(u.push(p),m==n.openStart)break;f=p.content}for(let f=d-1;f>=0;f--){let m=u[f],p=iR(m.type);if(p&&!m.sameMarkup(i.node(Math.abs(l)-1)))d=f;else if(p||!m.type.isTextblock)break}for(let f=n.openStart;f>=0;f--){let m=(f+d+1)%(n.openStart+1),p=u[m];if(p)for(let x=0;x<o.length;x++){let g=o[(x+c)%o.length],y=!0;g<0&&(y=!1,g=-g);let b=i.node(g-1),w=i.index(g-1);if(b.canReplaceWith(w,w,p.type,p.marks))return t.replace(i.before(g),y?a.after(g):s,new Q(A2(n.content,0,n.openStart,m),m,n.openEnd))}}let h=t.steps.length;for(let f=o.length-1;f>=0&&(t.replace(e,s,n),!(t.steps.length>h));f--){let m=o[f];m<0||(e=i.before(m),s=a.after(m))}}function A2(t,e,s,n,i){if(e<s){let a=t.firstChild;t=t.replaceChild(0,a.copy(A2(a.content,e+1,s,n,a)))}if(e>n){let a=i.contentMatchAt(0),o=a.fillBefore(t).append(t);t=o.append(a.matchFragment(o).fillBefore(q.empty,!0))}return t}function oR(t,e,s,n){if(!n.isInline&&e==s&&t.doc.resolve(e).parent.content.size){let i=sR(t.doc,e,n.type);i!=null&&(e=s=i)}t.replaceRange(e,s,new Q(q.from(n),0,0))}function lR(t,e,s){let n=t.doc.resolve(e),i=t.doc.resolve(s),a=T2(n,i);for(let o=0;o<a.length;o++){let l=a[o],c=o==a.length-1;if(c&&l==0||n.node(l).type.contentMatch.validEnd)return t.delete(n.start(l),i.end(l));if(l>0&&(c||n.node(l-1).canReplace(n.index(l-1),i.indexAfter(l-1))))return t.delete(n.before(l),i.after(l))}for(let o=1;o<=n.depth&&o<=i.depth;o++)if(e-n.start(o)==n.depth-o&&s>n.end(o)&&i.end(o)-s!=i.depth-o&&n.start(o-1)==i.start(o-1)&&n.node(o-1).canReplace(n.index(o-1),i.index(o-1)))return t.delete(n.before(o),s);t.delete(e,s)}function T2(t,e){let s=[],n=Math.min(t.depth,e.depth);for(let i=n;i>=0;i--){let a=t.start(i);if(a<t.pos-(t.depth-i)||e.end(i)>e.pos+(e.depth-i)||t.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(a==e.start(i)||i==t.depth&&i==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==a-1)&&s.push(i)}return s}class Ra extends Xt{constructor(e,s,n){super(),this.pos=e,this.attr=s,this.value=n}apply(e){let s=e.nodeAt(this.pos);if(!s)return yt.fail("No node at attribute step's position");let n=Object.create(null);for(let a in s.attrs)n[a]=s.attrs[a];n[this.attr]=this.value;let i=s.type.create(n,null,s.marks);return yt.fromReplace(e,this.pos,this.pos+1,new Q(q.from(i),0,s.isLeaf?0:1))}getMap(){return Ts.empty}invert(e){return new Ra(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let s=e.mapResult(this.pos,1);return s.deletedAfter?null:new Ra(s.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,s){if(typeof s.pos!="number"||typeof s.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new Ra(s.pos,s.attr,s.value)}}Xt.jsonID("attr",Ra);class Pl extends Xt{constructor(e,s){super(),this.attr=e,this.value=s}apply(e){let s=Object.create(null);for(let i in e.attrs)s[i]=e.attrs[i];s[this.attr]=this.value;let n=e.type.create(s,e.content,e.marks);return yt.ok(n)}getMap(){return Ts.empty}invert(e){return new Pl(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,s){if(typeof s.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new Pl(s.attr,s.value)}}Xt.jsonID("docAttr",Pl);let Xa=class extends Error{};Xa=function t(e){let s=Error.call(this,e);return s.__proto__=t.prototype,s};Xa.prototype=Object.create(Error.prototype);Xa.prototype.constructor=Xa;Xa.prototype.name="TransformError";class qx{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Ml}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let s=this.maybeStep(e);if(s.failed)throw new Xa(s.failed);return this}maybeStep(e){let s=e.apply(this.doc);return s.failed||this.addStep(e,s.doc),s}get docChanged(){return this.steps.length>0}addStep(e,s){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=s}replace(e,s=e,n=Q.empty){let i=kh(this.doc,e,s,n);return i&&this.step(i),this}replaceWith(e,s,n){return this.replace(e,s,new Q(q.from(n),0,0))}delete(e,s){return this.replace(e,s,Q.empty)}insert(e,s){return this.replaceWith(e,e,s)}replaceRange(e,s,n){return aR(this,e,s,n),this}replaceRangeWith(e,s,n){return oR(this,e,s,n),this}deleteRange(e,s){return lR(this,e,s),this}lift(e,s){return KO(this,e,s),this}join(e,s=1){return tR(this,e,s),this}wrap(e,s){return JO(this,e,s),this}setBlockType(e,s=e,n,i=null){return ZO(this,e,s,n,i),this}setNodeMarkup(e,s,n=null,i){return YO(this,e,s,n,i),this}setNodeAttribute(e,s,n){return this.step(new Ra(e,s,n)),this}setDocAttribute(e,s){return this.step(new Pl(e,s)),this}addNodeMark(e,s){return this.step(new Fr(e,s)),this}removeNodeMark(e,s){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(s instanceof ze)s.isInSet(n.marks)&&this.step(new Bi(e,s));else{let i=n.marks,a,o=[];for(;a=s.isInSet(i);)o.push(new Bi(e,a)),i=a.removeFromSet(i);for(let l=o.length-1;l>=0;l--)this.step(o[l])}return this}split(e,s=1,n){return XO(this,e,s,n),this}addMark(e,s,n){return VO(this,e,s,n),this}removeMark(e,s,n){return UO(this,e,s,n),this}clearIncompatible(e,s,n){return $x(this,e,s,n),this}}const vf=Object.create(null);class le{constructor(e,s,n){this.$anchor=e,this.$head=s,this.ranges=n||[new E2(e.min(s),e.max(s))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let s=0;s<e.length;s++)if(e[s].$from.pos!=e[s].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,s=Q.empty){let n=s.content.lastChild,i=null;for(let l=0;l<s.openEnd;l++)i=n,n=n.lastChild;let a=e.steps.length,o=this.ranges;for(let l=0;l<o.length;l++){let{$from:c,$to:u}=o[l],d=e.mapping.slice(a);e.replaceRange(d.map(c.pos),d.map(u.pos),l?Q.empty:s),l==0&&Fy(e,a,(n?n.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,s){let n=e.steps.length,i=this.ranges;for(let a=0;a<i.length;a++){let{$from:o,$to:l}=i[a],c=e.mapping.slice(n),u=c.map(o.pos),d=c.map(l.pos);a?e.deleteRange(u,d):(e.replaceRangeWith(u,d,s),Fy(e,n,s.isInline?-1:1))}}static findFrom(e,s,n=!1){let i=e.parent.inlineContent?new re(e):pa(e.node(0),e.parent,e.pos,e.index(),s,n);if(i)return i;for(let a=e.depth-1;a>=0;a--){let o=s<0?pa(e.node(0),e.node(a),e.before(a+1),e.index(a),s,n):pa(e.node(0),e.node(a),e.after(a+1),e.index(a)+1,s,n);if(o)return o}return null}static near(e,s=1){return this.findFrom(e,s)||this.findFrom(e,-s)||new Ps(e.node(0))}static atStart(e){return pa(e,e,0,0,1)||new Ps(e)}static atEnd(e){return pa(e,e,e.content.size,e.childCount,-1)||new Ps(e)}static fromJSON(e,s){if(!s||!s.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=vf[s.type];if(!n)throw new RangeError(`No selection type ${s.type} defined`);return n.fromJSON(e,s)}static jsonID(e,s){if(e in vf)throw new RangeError("Duplicate use of selection JSON ID "+e);return vf[e]=s,s.prototype.jsonID=e,s}getBookmark(){return re.between(this.$anchor,this.$head).getBookmark()}}le.prototype.visible=!0;class E2{constructor(e,s){this.$from=e,this.$to=s}}let Ry=!1;function Ly(t){!Ry&&!t.parent.inlineContent&&(Ry=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class re extends le{constructor(e,s=e){Ly(e),Ly(s),super(e,s)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,s){let n=e.resolve(s.map(this.head));if(!n.parent.inlineContent)return le.near(n);let i=e.resolve(s.map(this.anchor));return new re(i.parent.inlineContent?i:n,n)}replace(e,s=Q.empty){if(super.replace(e,s),s==Q.empty){let n=this.$from.marksAcross(this.$to);n&&e.ensureMarks(n)}}eq(e){return e instanceof re&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new Nh(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,s){if(typeof s.anchor!="number"||typeof s.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new re(e.resolve(s.anchor),e.resolve(s.head))}static create(e,s,n=s){let i=e.resolve(s);return new this(i,n==s?i:e.resolve(n))}static between(e,s,n){let i=e.pos-s.pos;if((!n||i)&&(n=i>=0?1:-1),!s.parent.inlineContent){let a=le.findFrom(s,n,!0)||le.findFrom(s,-n,!0);if(a)s=a.$head;else return le.near(s,n)}return e.parent.inlineContent||(i==0?e=s:(e=(le.findFrom(e,-n,!0)||le.findFrom(e,n,!0)).$anchor,e.pos<s.pos!=i<0&&(e=s))),new re(e,s)}}le.jsonID("text",re);class Nh{constructor(e,s){this.anchor=e,this.head=s}map(e){return new Nh(e.map(this.anchor),e.map(this.head))}resolve(e){return re.between(e.resolve(this.anchor),e.resolve(this.head))}}class ne extends le{constructor(e){let s=e.nodeAfter,n=e.node(0).resolve(e.pos+s.nodeSize);super(e,n),this.node=s}map(e,s){let{deleted:n,pos:i}=s.mapResult(this.anchor),a=e.resolve(i);return n?le.near(a):new ne(a)}content(){return new Q(q.from(this.node),0,0)}eq(e){return e instanceof ne&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new Vx(this.anchor)}static fromJSON(e,s){if(typeof s.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new ne(e.resolve(s.anchor))}static create(e,s){return new ne(e.resolve(s))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}ne.prototype.visible=!1;le.jsonID("node",ne);class Vx{constructor(e){this.anchor=e}map(e){let{deleted:s,pos:n}=e.mapResult(this.anchor);return s?new Nh(n,n):new Vx(n)}resolve(e){let s=e.resolve(this.anchor),n=s.nodeAfter;return n&&ne.isSelectable(n)?new ne(s):le.near(s)}}class Ps extends le{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,s=Q.empty){if(s==Q.empty){e.delete(0,e.doc.content.size);let n=le.atStart(e.doc);n.eq(e.selection)||e.setSelection(n)}else super.replace(e,s)}toJSON(){return{type:"all"}}static fromJSON(e){return new Ps(e)}map(e){return new Ps(e)}eq(e){return e instanceof Ps}getBookmark(){return cR}}le.jsonID("all",Ps);const cR={map(){return this},resolve(t){return new Ps(t)}};function pa(t,e,s,n,i,a=!1){if(e.inlineContent)return re.create(t,s);for(let o=n-(i>0?0:1);i>0?o<e.childCount:o>=0;o+=i){let l=e.child(o);if(l.isAtom){if(!a&&ne.isSelectable(l))return ne.create(t,s-(i<0?l.nodeSize:0))}else{let c=pa(t,l,s+i,i<0?l.childCount:0,i,a);if(c)return c}s+=l.nodeSize*i}return null}function Fy(t,e,s){let n=t.steps.length-1;if(n<e)return;let i=t.steps[n];if(!(i instanceof _t||i instanceof Dt))return;let a=t.mapping.maps[n],o;a.forEach((l,c,u,d)=>{o==null&&(o=d)}),t.setSelection(le.near(t.doc.resolve(o),s))}const $y=1,Rc=2,By=4;class uR extends qx{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|$y)&~Rc,this.storedMarks=null,this}get selectionSet(){return(this.updated&$y)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=Rc,this}ensureMarks(e){return ze.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Rc)>0}addStep(e,s){super.addStep(e,s),this.updated=this.updated&~Rc,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,s=!0){let n=this.selection;return s&&(e=e.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||ze.none))),n.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,s,n){let i=this.doc.type.schema;if(s==null)return e?this.replaceSelectionWith(i.text(e),!0):this.deleteSelection();{if(n==null&&(n=s),n=n??s,!e)return this.deleteRange(s,n);let a=this.storedMarks;if(!a){let o=this.doc.resolve(s);a=n==s?o.marks():o.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(s,n,i.text(e,a)),this.selection.empty||this.setSelection(le.near(this.selection.$to)),this}}setMeta(e,s){return this.meta[typeof e=="string"?e:e.key]=s,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=By,this}get scrolledIntoView(){return(this.updated&By)>0}}function qy(t,e){return!e||!t?t:t.bind(e)}class Ko{constructor(e,s,n){this.name=e,this.init=qy(s.init,n),this.apply=qy(s.apply,n)}}const dR=[new Ko("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new Ko("selection",{init(t,e){return t.selection||le.atStart(e.doc)},apply(t){return t.selection}}),new Ko("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,s,n){return n.selection.$cursor?t.storedMarks:null}}),new Ko("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class kf{constructor(e,s){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=dR.slice(),s&&s.forEach(n=>{if(this.pluginsByKey[n.key])throw new RangeError("Adding different instances of a keyed plugin ("+n.key+")");this.plugins.push(n),this.pluginsByKey[n.key]=n,n.spec.state&&this.fields.push(new Ko(n.key,n.spec.state,n))})}}class Ca{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,s=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=s){let i=this.config.plugins[n];if(i.spec.filterTransaction&&!i.spec.filterTransaction.call(i,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let s=[e],n=this.applyInner(e),i=null;for(;;){let a=!1;for(let o=0;o<this.config.plugins.length;o++){let l=this.config.plugins[o];if(l.spec.appendTransaction){let c=i?i[o].n:0,u=i?i[o].state:this,d=c<s.length&&l.spec.appendTransaction.call(l,c?s.slice(c):s,u,n);if(d&&n.filterTransaction(d,o)){if(d.setMeta("appendedTransaction",e),!i){i=[];for(let h=0;h<this.config.plugins.length;h++)i.push(h<o?{state:n,n:s.length}:{state:this,n:0})}s.push(d),n=n.applyInner(d),a=!0}i&&(i[o]={state:n,n:s.length})}}if(!a)return{state:n,transactions:s}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let s=new Ca(this.config),n=this.config.fields;for(let i=0;i<n.length;i++){let a=n[i];s[a.name]=a.apply(e,this[a.name],this,s)}return s}get tr(){return new uR(this)}static create(e){let s=new kf(e.doc?e.doc.type.schema:e.schema,e.plugins),n=new Ca(s);for(let i=0;i<s.fields.length;i++)n[s.fields[i].name]=s.fields[i].init(e,n);return n}reconfigure(e){let s=new kf(this.schema,e.plugins),n=s.fields,i=new Ca(s);for(let a=0;a<n.length;a++){let o=n[a].name;i[o]=this.hasOwnProperty(o)?this[o]:n[a].init(e,i)}return i}toJSON(e){let s={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(s.storedMarks=this.storedMarks.map(n=>n.toJSON())),e&&typeof e=="object")for(let n in e){if(n=="doc"||n=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let i=e[n],a=i.spec.state;a&&a.toJSON&&(s[n]=a.toJSON.call(i,this[i.key]))}return s}static fromJSON(e,s,n){if(!s)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let i=new kf(e.schema,e.plugins),a=new Ca(i);return i.fields.forEach(o=>{if(o.name=="doc")a.doc=Wr.fromJSON(e.schema,s.doc);else if(o.name=="selection")a.selection=le.fromJSON(a.doc,s.selection);else if(o.name=="storedMarks")s.storedMarks&&(a.storedMarks=s.storedMarks.map(e.schema.markFromJSON));else{if(n)for(let l in n){let c=n[l],u=c.spec.state;if(c.key==o.name&&u&&u.fromJSON&&Object.prototype.hasOwnProperty.call(s,l)){a[o.name]=u.fromJSON.call(c,e,s[l],a);return}}a[o.name]=o.init(e,a)}}),a}}function D2(t,e,s){for(let n in t){let i=t[n];i instanceof Function?i=i.bind(e):n=="handleDOMEvents"&&(i=D2(i,e,{})),s[n]=i}return s}class $e{constructor(e){this.spec=e,this.props={},e.props&&D2(e.props,this,this.props),this.key=e.key?e.key.key:M2("plugin")}getState(e){return e[this.key]}}const Nf=Object.create(null);function M2(t){return t in Nf?t+"$"+ ++Nf[t]:(Nf[t]=0,t+"$")}class ct{constructor(e="key"){this.key=M2(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const $t=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},eo=function(t){let e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e};let Um=null;const er=function(t,e,s){let n=Um||(Um=document.createRange());return n.setEnd(t,s??t.nodeValue.length),n.setStart(t,e||0),n},hR=function(){Um=null},qi=function(t,e,s,n){return s&&(Vy(t,e,s,n,-1)||Vy(t,e,s,n,1))},fR=/^(img|br|input|textarea|hr)$/i;function Vy(t,e,s,n,i){for(var a;;){if(t==s&&e==n)return!0;if(e==(i<0?0:Gs(t))){let o=t.parentNode;if(!o||o.nodeType!=1||dc(t)||fR.test(t.nodeName)||t.contentEditable=="false")return!1;e=$t(t)+(i<0?0:1),t=o}else if(t.nodeType==1){let o=t.childNodes[e+(i<0?-1:0)];if(o.nodeType==1&&o.contentEditable=="false")if(!((a=o.pmViewDesc)===null||a===void 0)&&a.ignoreForSelection)e+=i;else return!1;else t=o,e=i<0?Gs(t):0}else return!1}}function Gs(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function mR(t,e){for(;;){if(t.nodeType==3&&e)return t;if(t.nodeType==1&&e>0){if(t.contentEditable=="false")return null;t=t.childNodes[e-1],e=Gs(t)}else if(t.parentNode&&!dc(t))e=$t(t),t=t.parentNode;else return null}}function pR(t,e){for(;;){if(t.nodeType==3&&e<t.nodeValue.length)return t;if(t.nodeType==1&&e<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[e],e=0}else if(t.parentNode&&!dc(t))e=$t(t)+1,t=t.parentNode;else return null}}function xR(t,e,s){for(let n=e==0,i=e==Gs(t);n||i;){if(t==s)return!0;let a=$t(t);if(t=t.parentNode,!t)return!1;n=n&&a==0,i=i&&a==Gs(t)}}function dc(t){let e;for(let s=t;s&&!(e=s.pmViewDesc);s=s.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const Sh=function(t){return t.focusNode&&qi(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function xi(t,e){let s=document.createEvent("Event");return s.initEvent("keydown",!0,!0),s.keyCode=t,s.key=s.code=e,s}function gR(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function yR(t,e,s){if(t.caretPositionFromPoint)try{let n=t.caretPositionFromPoint(e,s);if(n)return{node:n.offsetNode,offset:Math.min(Gs(n.offsetNode),n.offset)}}catch{}if(t.caretRangeFromPoint){let n=t.caretRangeFromPoint(e,s);if(n)return{node:n.startContainer,offset:Math.min(Gs(n.startContainer),n.startOffset)}}}const Ln=typeof navigator<"u"?navigator:null,Uy=typeof document<"u"?document:null,ui=Ln&&Ln.userAgent||"",Wm=/Edge\/(\d+)/.exec(ui),P2=/MSIE \d/.exec(ui),Km=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(ui),bs=!!(P2||Km||Wm),Kr=P2?document.documentMode:Km?+Km[1]:Wm?+Wm[1]:0,Qs=!bs&&/gecko\/(\d+)/i.test(ui);Qs&&+(/Firefox\/(\d+)/.exec(ui)||[0,0])[1];const Hm=!bs&&/Chrome\/(\d+)/.exec(ui),Kt=!!Hm,I2=Hm?+Hm[1]:0,us=!bs&&!!Ln&&/Apple Computer/.test(Ln.vendor),to=us&&(/Mobile\/\w+/.test(ui)||!!Ln&&Ln.maxTouchPoints>2),Ws=to||(Ln?/Mac/.test(Ln.platform):!1),bR=Ln?/Win/.test(Ln.platform):!1,nr=/Android \d/.test(ui),hc=!!Uy&&"webkitFontSmoothing"in Uy.documentElement.style,jR=hc?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function wR(t){let e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function Jn(t,e){return typeof t=="number"?t:t[e]}function vR(t){let e=t.getBoundingClientRect(),s=e.width/t.offsetWidth||1,n=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*s,top:e.top,bottom:e.top+t.clientHeight*n}}function Wy(t,e,s){let n=t.someProp("scrollThreshold")||0,i=t.someProp("scrollMargin")||5,a=t.dom.ownerDocument;for(let o=s||t.dom;o;){if(o.nodeType!=1){o=eo(o);continue}let l=o,c=l==a.body,u=c?wR(a):vR(l),d=0,h=0;if(e.top<u.top+Jn(n,"top")?h=-(u.top-e.top+Jn(i,"top")):e.bottom>u.bottom-Jn(n,"bottom")&&(h=e.bottom-e.top>u.bottom-u.top?e.top+Jn(i,"top")-u.top:e.bottom-u.bottom+Jn(i,"bottom")),e.left<u.left+Jn(n,"left")?d=-(u.left-e.left+Jn(i,"left")):e.right>u.right-Jn(n,"right")&&(d=e.right-u.right+Jn(i,"right")),d||h)if(c)a.defaultView.scrollBy(d,h);else{let m=l.scrollLeft,p=l.scrollTop;h&&(l.scrollTop+=h),d&&(l.scrollLeft+=d);let x=l.scrollLeft-m,g=l.scrollTop-p;e={left:e.left-x,top:e.top-g,right:e.right-x,bottom:e.bottom-g}}let f=c?"fixed":getComputedStyle(o).position;if(/^(fixed|sticky)$/.test(f))break;o=f=="absolute"?o.offsetParent:eo(o)}}function kR(t){let e=t.dom.getBoundingClientRect(),s=Math.max(0,e.top),n,i;for(let a=(e.left+e.right)/2,o=s+1;o<Math.min(innerHeight,e.bottom);o+=5){let l=t.root.elementFromPoint(a,o);if(!l||l==t.dom||!t.dom.contains(l))continue;let c=l.getBoundingClientRect();if(c.top>=s-20){n=l,i=c.top;break}}return{refDOM:n,refTop:i,stack:O2(t.dom)}}function O2(t){let e=[],s=t.ownerDocument;for(let n=t;n&&(e.push({dom:n,top:n.scrollTop,left:n.scrollLeft}),t!=s);n=eo(n));return e}function NR({refDOM:t,refTop:e,stack:s}){let n=t?t.getBoundingClientRect().top:0;R2(s,n==0?0:n-e)}function R2(t,e){for(let s=0;s<t.length;s++){let{dom:n,top:i,left:a}=t[s];n.scrollTop!=i+e&&(n.scrollTop=i+e),n.scrollLeft!=a&&(n.scrollLeft=a)}}let ua=null;function SR(t){if(t.setActive)return t.setActive();if(ua)return t.focus(ua);let e=O2(t);t.focus(ua==null?{get preventScroll(){return ua={preventScroll:!0},!0}}:void 0),ua||(ua=!1,R2(e,0))}function L2(t,e){let s,n=2e8,i,a=0,o=e.top,l=e.top,c,u;for(let d=t.firstChild,h=0;d;d=d.nextSibling,h++){let f;if(d.nodeType==1)f=d.getClientRects();else if(d.nodeType==3)f=er(d).getClientRects();else continue;for(let m=0;m<f.length;m++){let p=f[m];if(p.top<=o&&p.bottom>=l){o=Math.max(p.bottom,o),l=Math.min(p.top,l);let x=p.left>e.left?p.left-e.left:p.right<e.left?e.left-p.right:0;if(x<n){s=d,n=x,i=x&&s.nodeType==3?{left:p.right<e.left?p.right:p.left,top:e.top}:e,d.nodeType==1&&x&&(a=h+(e.left>=(p.left+p.right)/2?1:0));continue}}else p.top>e.top&&!c&&p.left<=e.left&&p.right>=e.left&&(c=d,u={left:Math.max(p.left,Math.min(p.right,e.left)),top:p.top});!s&&(e.left>=p.right&&e.top>=p.top||e.left>=p.left&&e.top>=p.bottom)&&(a=h+1)}}return!s&&c&&(s=c,i=u,n=0),s&&s.nodeType==3?CR(s,i):!s||n&&s.nodeType==1?{node:t,offset:a}:L2(s,i)}function CR(t,e){let s=t.nodeValue.length,n=document.createRange();for(let i=0;i<s;i++){n.setEnd(t,i+1),n.setStart(t,i);let a=Nr(n,1);if(a.top!=a.bottom&&Ux(e,a))return{node:t,offset:i+(e.left>=(a.left+a.right)/2?1:0)}}return{node:t,offset:0}}function Ux(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function zR(t,e){let s=t.parentNode;return s&&/^li$/i.test(s.nodeName)&&e.left<t.getBoundingClientRect().left?s:t}function _R(t,e,s){let{node:n,offset:i}=L2(e,s),a=-1;if(n.nodeType==1&&!n.firstChild){let o=n.getBoundingClientRect();a=o.left!=o.right&&s.left>(o.left+o.right)/2?1:-1}return t.docView.posFromDOM(n,i,a)}function AR(t,e,s,n){let i=-1;for(let a=e,o=!1;a!=t.dom;){let l=t.docView.nearestDesc(a,!0),c;if(!l)return null;if(l.dom.nodeType==1&&(l.node.isBlock&&l.parent||!l.contentDOM)&&((c=l.dom.getBoundingClientRect()).width||c.height)&&(l.node.isBlock&&l.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(l.dom.nodeName)&&(!o&&c.left>n.left||c.top>n.top?i=l.posBefore:(!o&&c.right<n.left||c.bottom<n.top)&&(i=l.posAfter),o=!0),!l.contentDOM&&i<0&&!l.node.isText))return(l.node.isBlock?n.top<(c.top+c.bottom)/2:n.left<(c.left+c.right)/2)?l.posBefore:l.posAfter;a=l.dom.parentNode}return i>-1?i:t.docView.posFromDOM(e,s,-1)}function F2(t,e,s){let n=t.childNodes.length;if(n&&s.top<s.bottom)for(let i=Math.max(0,Math.min(n-1,Math.floor(n*(e.top-s.top)/(s.bottom-s.top))-2)),a=i;;){let o=t.childNodes[a];if(o.nodeType==1){let l=o.getClientRects();for(let c=0;c<l.length;c++){let u=l[c];if(Ux(e,u))return F2(o,e,u)}}if((a=(a+1)%n)==i)break}return t}function TR(t,e){let s=t.dom.ownerDocument,n,i=0,a=yR(s,e.left,e.top);a&&({node:n,offset:i}=a);let o=(t.root.elementFromPoint?t.root:s).elementFromPoint(e.left,e.top),l;if(!o||!t.dom.contains(o.nodeType!=1?o.parentNode:o)){let u=t.dom.getBoundingClientRect();if(!Ux(e,u)||(o=F2(t.dom,e,u),!o))return null}if(us)for(let u=o;n&&u;u=eo(u))u.draggable&&(n=void 0);if(o=zR(o,e),n){if(Qs&&n.nodeType==1&&(i=Math.min(i,n.childNodes.length),i<n.childNodes.length)){let d=n.childNodes[i],h;d.nodeName=="IMG"&&(h=d.getBoundingClientRect()).right<=e.left&&h.bottom>e.top&&i++}let u;hc&&i&&n.nodeType==1&&(u=n.childNodes[i-1]).nodeType==1&&u.contentEditable=="false"&&u.getBoundingClientRect().top>=e.top&&i--,n==t.dom&&i==n.childNodes.length-1&&n.lastChild.nodeType==1&&e.top>n.lastChild.getBoundingClientRect().bottom?l=t.state.doc.content.size:(i==0||n.nodeType!=1||n.childNodes[i-1].nodeName!="BR")&&(l=AR(t,n,i,e))}l==null&&(l=_R(t,o,e));let c=t.docView.nearestDesc(o,!0);return{pos:l,inside:c?c.posAtStart-c.border:-1}}function Ky(t){return t.top<t.bottom||t.left<t.right}function Nr(t,e){let s=t.getClientRects();if(s.length){let n=s[e<0?0:s.length-1];if(Ky(n))return n}return Array.prototype.find.call(s,Ky)||t.getBoundingClientRect()}const ER=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function $2(t,e,s){let{node:n,offset:i,atom:a}=t.docView.domFromPos(e,s<0?-1:1),o=hc||Qs;if(n.nodeType==3)if(o&&(ER.test(n.nodeValue)||(s<0?!i:i==n.nodeValue.length))){let c=Nr(er(n,i,i),s);if(Qs&&i&&/\s/.test(n.nodeValue[i-1])&&i<n.nodeValue.length){let u=Nr(er(n,i-1,i-1),-1);if(u.top==c.top){let d=Nr(er(n,i,i+1),-1);if(d.top!=c.top)return Po(d,d.left<u.left)}}return c}else{let c=i,u=i,d=s<0?1:-1;return s<0&&!i?(u++,d=-1):s>=0&&i==n.nodeValue.length?(c--,d=1):s<0?c--:u++,Po(Nr(er(n,c,u),d),d<0)}if(!t.state.doc.resolve(e-(a||0)).parent.inlineContent){if(a==null&&i&&(s<0||i==Gs(n))){let c=n.childNodes[i-1];if(c.nodeType==1)return Sf(c.getBoundingClientRect(),!1)}if(a==null&&i<Gs(n)){let c=n.childNodes[i];if(c.nodeType==1)return Sf(c.getBoundingClientRect(),!0)}return Sf(n.getBoundingClientRect(),s>=0)}if(a==null&&i&&(s<0||i==Gs(n))){let c=n.childNodes[i-1],u=c.nodeType==3?er(c,Gs(c)-(o?0:1)):c.nodeType==1&&(c.nodeName!="BR"||!c.nextSibling)?c:null;if(u)return Po(Nr(u,1),!1)}if(a==null&&i<Gs(n)){let c=n.childNodes[i];for(;c.pmViewDesc&&c.pmViewDesc.ignoreForCoords;)c=c.nextSibling;let u=c?c.nodeType==3?er(c,0,o?0:1):c.nodeType==1?c:null:null;if(u)return Po(Nr(u,-1),!0)}return Po(Nr(n.nodeType==3?er(n):n,-s),s>=0)}function Po(t,e){if(t.width==0)return t;let s=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:s,right:s}}function Sf(t,e){if(t.height==0)return t;let s=e?t.top:t.bottom;return{top:s,bottom:s,left:t.left,right:t.right}}function B2(t,e,s){let n=t.state,i=t.root.activeElement;n!=e&&t.updateState(e),i!=t.dom&&t.focus();try{return s()}finally{n!=e&&t.updateState(n),i!=t.dom&&i&&i.focus()}}function DR(t,e,s){let n=e.selection,i=s=="up"?n.$from:n.$to;return B2(t,e,()=>{let{node:a}=t.docView.domFromPos(i.pos,s=="up"?-1:1);for(;;){let l=t.docView.nearestDesc(a,!0);if(!l)break;if(l.node.isBlock){a=l.contentDOM||l.dom;break}a=l.dom.parentNode}let o=$2(t,i.pos,1);for(let l=a.firstChild;l;l=l.nextSibling){let c;if(l.nodeType==1)c=l.getClientRects();else if(l.nodeType==3)c=er(l,0,l.nodeValue.length).getClientRects();else continue;for(let u=0;u<c.length;u++){let d=c[u];if(d.bottom>d.top+1&&(s=="up"?o.top-d.top>(d.bottom-o.top)*2:d.bottom-o.bottom>(o.bottom-d.top)*2))return!1}}return!0})}const MR=/[\u0590-\u08ac]/;function PR(t,e,s){let{$head:n}=e.selection;if(!n.parent.isTextblock)return!1;let i=n.parentOffset,a=!i,o=i==n.parent.content.size,l=t.domSelection();return l?!MR.test(n.parent.textContent)||!l.modify?s=="left"||s=="backward"?a:o:B2(t,e,()=>{let{focusNode:c,focusOffset:u,anchorNode:d,anchorOffset:h}=t.domSelectionRange(),f=l.caretBidiLevel;l.modify("move",s,"character");let m=n.depth?t.docView.domAfterPos(n.before()):t.dom,{focusNode:p,focusOffset:x}=t.domSelectionRange(),g=p&&!m.contains(p.nodeType==1?p:p.parentNode)||c==p&&u==x;try{l.collapse(d,h),c&&(c!=d||u!=h)&&l.extend&&l.extend(c,u)}catch{}return f!=null&&(l.caretBidiLevel=f),g}):n.pos==n.start()||n.pos==n.end()}let Hy=null,Gy=null,Jy=!1;function IR(t,e,s){return Hy==e&&Gy==s?Jy:(Hy=e,Gy=s,Jy=s=="up"||s=="down"?DR(t,e,s):PR(t,e,s))}const Ys=0,Zy=1,wi=2,Fn=3;class fc{constructor(e,s,n,i){this.parent=e,this.children=s,this.dom=n,this.contentDOM=i,this.dirty=Ys,n.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,s,n){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let s=0;s<this.children.length;s++)e+=this.children[s].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let s=0,n=this.posAtStart;;s++){let i=this.children[s];if(i==e)return n;n+=i.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,s,n){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(n<0){let a,o;if(e==this.contentDOM)a=e.childNodes[s-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;a=e.previousSibling}for(;a&&!((o=a.pmViewDesc)&&o.parent==this);)a=a.previousSibling;return a?this.posBeforeChild(o)+o.size:this.posAtStart}else{let a,o;if(e==this.contentDOM)a=e.childNodes[s];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;a=e.nextSibling}for(;a&&!((o=a.pmViewDesc)&&o.parent==this);)a=a.nextSibling;return a?this.posBeforeChild(o):this.posAtEnd}let i;if(e==this.dom&&this.contentDOM)i=s>$t(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))i=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(s==0)for(let a=e;;a=a.parentNode){if(a==this.dom){i=!1;break}if(a.previousSibling)break}if(i==null&&s==e.childNodes.length)for(let a=e;;a=a.parentNode){if(a==this.dom){i=!0;break}if(a.nextSibling)break}}return i??n>0?this.posAtEnd:this.posAtStart}nearestDesc(e,s=!1){for(let n=!0,i=e;i;i=i.parentNode){let a=this.getDesc(i),o;if(a&&(!s||a.node))if(n&&(o=a.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))n=!1;else return a}}getDesc(e){let s=e.pmViewDesc;for(let n=s;n;n=n.parent)if(n==this)return s}posFromDOM(e,s,n){for(let i=e;i;i=i.parentNode){let a=this.getDesc(i);if(a)return a.localPosFromDOM(e,s,n)}return-1}descAt(e){for(let s=0,n=0;s<this.children.length;s++){let i=this.children[s],a=n+i.size;if(n==e&&a!=n){for(;!i.border&&i.children.length;)for(let o=0;o<i.children.length;o++){let l=i.children[o];if(l.size){i=l;break}}return i}if(e<a)return i.descAt(e-n-i.border);n=a}}domFromPos(e,s){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let n=0,i=0;for(let a=0;n<this.children.length;n++){let o=this.children[n],l=a+o.size;if(l>e||o instanceof V2){i=e-a;break}a=l}if(i)return this.children[n].domFromPos(i-this.children[n].border,s);for(let a;n&&!(a=this.children[n-1]).size&&a instanceof q2&&a.side>=0;n--);if(s<=0){let a,o=!0;for(;a=n?this.children[n-1]:null,!(!a||a.dom.parentNode==this.contentDOM);n--,o=!1);return a&&s&&o&&!a.border&&!a.domAtom?a.domFromPos(a.size,s):{node:this.contentDOM,offset:a?$t(a.dom)+1:0}}else{let a,o=!0;for(;a=n<this.children.length?this.children[n]:null,!(!a||a.dom.parentNode==this.contentDOM);n++,o=!1);return a&&o&&!a.border&&!a.domAtom?a.domFromPos(0,s):{node:this.contentDOM,offset:a?$t(a.dom):this.contentDOM.childNodes.length}}}parseRange(e,s,n=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:s,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let i=-1,a=-1;for(let o=n,l=0;;l++){let c=this.children[l],u=o+c.size;if(i==-1&&e<=u){let d=o+c.border;if(e>=d&&s<=u-c.border&&c.node&&c.contentDOM&&this.contentDOM.contains(c.contentDOM))return c.parseRange(e,s,d);e=o;for(let h=l;h>0;h--){let f=this.children[h-1];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(1)){i=$t(f.dom)+1;break}e-=f.size}i==-1&&(i=0)}if(i>-1&&(u>s||l==this.children.length-1)){s=u;for(let d=l+1;d<this.children.length;d++){let h=this.children[d];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(-1)){a=$t(h.dom);break}s+=h.size}a==-1&&(a=this.contentDOM.childNodes.length);break}o=u}return{node:this.contentDOM,from:e,to:s,fromOffset:i,toOffset:a}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let s=this.children[e<0?0:this.children.length-1];return s.size==0||s.emptyChildAt(e)}domAfterPos(e){let{node:s,offset:n}=this.domFromPos(e,0);if(s.nodeType!=1||n==s.childNodes.length)throw new RangeError("No node after pos "+e);return s.childNodes[n]}setSelection(e,s,n,i=!1){let a=Math.min(e,s),o=Math.max(e,s);for(let m=0,p=0;m<this.children.length;m++){let x=this.children[m],g=p+x.size;if(a>p&&o<g)return x.setSelection(e-p-x.border,s-p-x.border,n,i);p=g}let l=this.domFromPos(e,e?-1:1),c=s==e?l:this.domFromPos(s,s?-1:1),u=n.root.getSelection(),d=n.domSelectionRange(),h=!1;if((Qs||us)&&e==s){let{node:m,offset:p}=l;if(m.nodeType==3){if(h=!!(p&&m.nodeValue[p-1]==`
`),h&&p==m.nodeValue.length)for(let x=m,g;x;x=x.parentNode){if(g=x.nextSibling){g.nodeName=="BR"&&(l=c={node:g.parentNode,offset:$t(g)+1});break}let y=x.pmViewDesc;if(y&&y.node&&y.node.isBlock)break}}else{let x=m.childNodes[p-1];h=x&&(x.nodeName=="BR"||x.contentEditable=="false")}}if(Qs&&d.focusNode&&d.focusNode!=c.node&&d.focusNode.nodeType==1){let m=d.focusNode.childNodes[d.focusOffset];m&&m.contentEditable=="false"&&(i=!0)}if(!(i||h&&us)&&qi(l.node,l.offset,d.anchorNode,d.anchorOffset)&&qi(c.node,c.offset,d.focusNode,d.focusOffset))return;let f=!1;if((u.extend||e==s)&&!(h&&Qs)){u.collapse(l.node,l.offset);try{e!=s&&u.extend(c.node,c.offset),f=!0}catch{}}if(!f){if(e>s){let p=l;l=c,c=p}let m=document.createRange();m.setEnd(c.node,c.offset),m.setStart(l.node,l.offset),u.removeAllRanges(),u.addRange(m)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,s){for(let n=0,i=0;i<this.children.length;i++){let a=this.children[i],o=n+a.size;if(n==o?e<=o&&s>=n:e<o&&s>n){let l=n+a.border,c=o-a.border;if(e>=l&&s<=c){this.dirty=e==n||s==o?wi:Zy,e==l&&s==c&&(a.contentLost||a.dom.parentNode!=this.contentDOM)?a.dirty=Fn:a.markDirty(e-l,s-l);return}else a.dirty=a.dom==a.contentDOM&&a.dom.parentNode==this.contentDOM&&!a.children.length?wi:Fn}n=o}this.dirty=wi}markParentsDirty(){let e=1;for(let s=this.parent;s;s=s.parent,e++){let n=e==1?wi:Zy;s.dirty<n&&(s.dirty=n)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class q2 extends fc{constructor(e,s,n,i){let a,o=s.type.toDOM;if(typeof o=="function"&&(o=o(n,()=>{if(!a)return i;if(a.parent)return a.parent.posBeforeChild(a)})),!s.type.spec.raw){if(o.nodeType!=1){let l=document.createElement("span");l.appendChild(o),o=l}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=s,this.widget=s,a=this}matchesWidget(e){return this.dirty==Ys&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let s=this.widget.spec.stopEvent;return s?s(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class OR extends fc{constructor(e,s,n,i){super(e,[],s,null),this.textDOM=n,this.text=i}get size(){return this.text.length}localPosFromDOM(e,s){return e!=this.textDOM?this.posAtStart+(s?this.size:0):this.posAtStart+s}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class Vi extends fc{constructor(e,s,n,i,a){super(e,[],n,i),this.mark=s,this.spec=a}static create(e,s,n,i){let a=i.nodeViews[s.type.name],o=a&&a(s,i,n);return(!o||!o.dom)&&(o=ea.renderSpec(document,s.type.spec.toDOM(s,n),null,s.attrs)),new Vi(e,s,o.dom,o.contentDOM||o.dom,o)}parseRule(){return this.dirty&Fn||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=Fn&&this.mark.eq(e)}markDirty(e,s){if(super.markDirty(e,s),this.dirty!=Ys){let n=this.parent;for(;!n.node;)n=n.parent;n.dirty<this.dirty&&(n.dirty=this.dirty),this.dirty=Ys}}slice(e,s,n){let i=Vi.create(this.parent,this.mark,!0,n),a=this.children,o=this.size;s<o&&(a=Jm(a,s,o,n)),e>0&&(a=Jm(a,0,e,n));for(let l=0;l<a.length;l++)a[l].parent=i;return i.children=a,i}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class Hr extends fc{constructor(e,s,n,i,a,o,l,c,u){super(e,[],a,o),this.node=s,this.outerDeco=n,this.innerDeco=i,this.nodeDOM=l}static create(e,s,n,i,a,o){let l=a.nodeViews[s.type.name],c,u=l&&l(s,a,()=>{if(!c)return o;if(c.parent)return c.parent.posBeforeChild(c)},n,i),d=u&&u.dom,h=u&&u.contentDOM;if(s.isText){if(!d)d=document.createTextNode(s.text);else if(d.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else d||({dom:d,contentDOM:h}=ea.renderSpec(document,s.type.spec.toDOM(s),null,s.attrs));!h&&!s.isText&&d.nodeName!="BR"&&(d.hasAttribute("contenteditable")||(d.contentEditable="false"),s.type.spec.draggable&&(d.draggable=!0));let f=d;return d=K2(d,n,s),u?c=new RR(e,s,n,i,d,h||null,f,u,a,o+1):s.isText?new Ch(e,s,n,i,d,f,a):new Hr(e,s,n,i,d,h||null,f,a,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let s=this.children.length-1;s>=0;s--){let n=this.children[s];if(this.dom.contains(n.dom.parentNode)){e.contentElement=n.dom.parentNode;break}}e.contentElement||(e.getContent=()=>q.empty)}return e}matchesNode(e,s,n){return this.dirty==Ys&&e.eq(this.node)&&Vu(s,this.outerDeco)&&n.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,s){let n=this.node.inlineContent,i=s,a=e.composing?this.localCompositionInfo(e,s):null,o=a&&a.pos>-1?a:null,l=a&&a.pos<0,c=new FR(this,o&&o.node,e);qR(this.node,this.innerDeco,(u,d,h)=>{u.spec.marks?c.syncToMarks(u.spec.marks,n,e):u.type.side>=0&&!h&&c.syncToMarks(d==this.node.childCount?ze.none:this.node.child(d).marks,n,e),c.placeWidget(u,e,i)},(u,d,h,f)=>{c.syncToMarks(u.marks,n,e);let m;c.findNodeMatch(u,d,h,f)||l&&e.state.selection.from>i&&e.state.selection.to<i+u.nodeSize&&(m=c.findIndexWithChild(a.node))>-1&&c.updateNodeAt(u,d,h,m,e)||c.updateNextNode(u,d,h,e,f,i)||c.addNode(u,d,h,e,i),i+=u.nodeSize}),c.syncToMarks([],n,e),this.node.isTextblock&&c.addTextblockHacks(),c.destroyRest(),(c.changed||this.dirty==wi)&&(o&&this.protectLocalComposition(e,o),U2(this.contentDOM,this.children,e),to&&VR(this.dom))}localCompositionInfo(e,s){let{from:n,to:i}=e.state.selection;if(!(e.state.selection instanceof re)||n<s||i>s+this.node.content.size)return null;let a=e.input.compositionNode;if(!a||!this.dom.contains(a.parentNode))return null;if(this.node.inlineContent){let o=a.nodeValue,l=UR(this.node.content,o,n-s,i-s);return l<0?null:{node:a,pos:l,text:o}}else return{node:a,pos:-1,text:""}}protectLocalComposition(e,{node:s,pos:n,text:i}){if(this.getDesc(s))return;let a=s;for(;a.parentNode!=this.contentDOM;a=a.parentNode){for(;a.previousSibling;)a.parentNode.removeChild(a.previousSibling);for(;a.nextSibling;)a.parentNode.removeChild(a.nextSibling);a.pmViewDesc&&(a.pmViewDesc=void 0)}let o=new OR(this,a,s,i);e.input.compositionNodes.push(o),this.children=Jm(this.children,n,n+i.length,e,o)}update(e,s,n,i){return this.dirty==Fn||!e.sameMarkup(this.node)?!1:(this.updateInner(e,s,n,i),!0)}updateInner(e,s,n,i){this.updateOuterDeco(s),this.node=e,this.innerDeco=n,this.contentDOM&&this.updateChildren(i,this.posAtStart),this.dirty=Ys}updateOuterDeco(e){if(Vu(e,this.outerDeco))return;let s=this.nodeDOM.nodeType!=1,n=this.dom;this.dom=W2(this.dom,this.nodeDOM,Gm(this.outerDeco,this.node,s),Gm(e,this.node,s)),this.dom!=n&&(n.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function Qy(t,e,s,n,i){K2(n,e,t);let a=new Hr(void 0,t,e,s,n,n,n,i,0);return a.contentDOM&&a.updateChildren(i,0),a}class Ch extends Hr{constructor(e,s,n,i,a,o,l){super(e,s,n,i,a,null,o,l,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,s,n,i){return this.dirty==Fn||this.dirty!=Ys&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(s),(this.dirty!=Ys||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,i.trackWrites==this.nodeDOM&&(i.trackWrites=null)),this.node=e,this.dirty=Ys,!0)}inParent(){let e=this.parent.contentDOM;for(let s=this.nodeDOM;s;s=s.parentNode)if(s==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,s,n){return e==this.nodeDOM?this.posAtStart+Math.min(s,this.node.text.length):super.localPosFromDOM(e,s,n)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,s,n){let i=this.node.cut(e,s),a=document.createTextNode(i.text);return new Ch(this.parent,i,this.outerDeco,this.innerDeco,a,a,n)}markDirty(e,s){super.markDirty(e,s),this.dom!=this.nodeDOM&&(e==0||s==this.nodeDOM.nodeValue.length)&&(this.dirty=Fn)}get domAtom(){return!1}isText(e){return this.node.text==e}}class V2 extends fc{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==Ys&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class RR extends Hr{constructor(e,s,n,i,a,o,l,c,u,d){super(e,s,n,i,a,o,l,u,d),this.spec=c}update(e,s,n,i){if(this.dirty==Fn)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let a=this.spec.update(e,s,n);return a&&this.updateInner(e,s,n,i),a}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,s,n,i)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,s,n,i){this.spec.setSelection?this.spec.setSelection(e,s,n.root):super.setSelection(e,s,n,i)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function U2(t,e,s){let n=t.firstChild,i=!1;for(let a=0;a<e.length;a++){let o=e[a],l=o.dom;if(l.parentNode==t){for(;l!=n;)n=Yy(n),i=!0;n=n.nextSibling}else i=!0,t.insertBefore(l,n);if(o instanceof Vi){let c=n?n.previousSibling:t.lastChild;U2(o.contentDOM,o.children,s),n=c?c.nextSibling:t.firstChild}}for(;n;)n=Yy(n),i=!0;i&&s.trackWrites==t&&(s.trackWrites=null)}const sl=function(t){t&&(this.nodeName=t)};sl.prototype=Object.create(null);const vi=[new sl];function Gm(t,e,s){if(t.length==0)return vi;let n=s?vi[0]:new sl,i=[n];for(let a=0;a<t.length;a++){let o=t[a].type.attrs;if(o){o.nodeName&&i.push(n=new sl(o.nodeName));for(let l in o){let c=o[l];c!=null&&(s&&i.length==1&&i.push(n=new sl(e.isInline?"span":"div")),l=="class"?n.class=(n.class?n.class+" ":"")+c:l=="style"?n.style=(n.style?n.style+";":"")+c:l!="nodeName"&&(n[l]=c))}}}return i}function W2(t,e,s,n){if(s==vi&&n==vi)return e;let i=e;for(let a=0;a<n.length;a++){let o=n[a],l=s[a];if(a){let c;l&&l.nodeName==o.nodeName&&i!=t&&(c=i.parentNode)&&c.nodeName.toLowerCase()==o.nodeName||(c=document.createElement(o.nodeName),c.pmIsDeco=!0,c.appendChild(i),l=vi[0]),i=c}LR(i,l||vi[0],o)}return i}function LR(t,e,s){for(let n in e)n!="class"&&n!="style"&&n!="nodeName"&&!(n in s)&&t.removeAttribute(n);for(let n in s)n!="class"&&n!="style"&&n!="nodeName"&&s[n]!=e[n]&&t.setAttribute(n,s[n]);if(e.class!=s.class){let n=e.class?e.class.split(" ").filter(Boolean):[],i=s.class?s.class.split(" ").filter(Boolean):[];for(let a=0;a<n.length;a++)i.indexOf(n[a])==-1&&t.classList.remove(n[a]);for(let a=0;a<i.length;a++)n.indexOf(i[a])==-1&&t.classList.add(i[a]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=s.style){if(e.style){let n=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,i;for(;i=n.exec(e.style);)t.style.removeProperty(i[1])}s.style&&(t.style.cssText+=s.style)}}function K2(t,e,s){return W2(t,t,vi,Gm(e,s,t.nodeType!=1))}function Vu(t,e){if(t.length!=e.length)return!1;for(let s=0;s<t.length;s++)if(!t[s].type.eq(e[s].type))return!1;return!0}function Yy(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class FR{constructor(e,s,n){this.lock=s,this.view=n,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=$R(e.node.content,e)}destroyBetween(e,s){if(e!=s){for(let n=e;n<s;n++)this.top.children[n].destroy();this.top.children.splice(e,s-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,s,n){let i=0,a=this.stack.length>>1,o=Math.min(a,e.length);for(;i<o&&(i==a-1?this.top:this.stack[i+1<<1]).matchesMark(e[i])&&e[i].type.spec.spanning!==!1;)i++;for(;i<a;)this.destroyRest(),this.top.dirty=Ys,this.index=this.stack.pop(),this.top=this.stack.pop(),a--;for(;a<e.length;){this.stack.push(this.top,this.index+1);let l=-1;for(let c=this.index;c<Math.min(this.index+3,this.top.children.length);c++){let u=this.top.children[c];if(u.matchesMark(e[a])&&!this.isLocked(u.dom)){l=c;break}}if(l>-1)l>this.index&&(this.changed=!0,this.destroyBetween(this.index,l)),this.top=this.top.children[this.index];else{let c=Vi.create(this.top,e[a],s,n);this.top.children.splice(this.index,0,c),this.top=c,this.changed=!0}this.index=0,a++}}findNodeMatch(e,s,n,i){let a=-1,o;if(i>=this.preMatch.index&&(o=this.preMatch.matches[i-this.preMatch.index]).parent==this.top&&o.matchesNode(e,s,n))a=this.top.children.indexOf(o,this.index);else for(let l=this.index,c=Math.min(this.top.children.length,l+5);l<c;l++){let u=this.top.children[l];if(u.matchesNode(e,s,n)&&!this.preMatch.matched.has(u)){a=l;break}}return a<0?!1:(this.destroyBetween(this.index,a),this.index++,!0)}updateNodeAt(e,s,n,i,a){let o=this.top.children[i];return o.dirty==Fn&&o.dom==o.contentDOM&&(o.dirty=wi),o.update(e,s,n,a)?(this.destroyBetween(this.index,i),this.index++,!0):!1}findIndexWithChild(e){for(;;){let s=e.parentNode;if(!s)return-1;if(s==this.top.contentDOM){let n=e.pmViewDesc;if(n){for(let i=this.index;i<this.top.children.length;i++)if(this.top.children[i]==n)return i}return-1}e=s}}updateNextNode(e,s,n,i,a,o){for(let l=this.index;l<this.top.children.length;l++){let c=this.top.children[l];if(c instanceof Hr){let u=this.preMatch.matched.get(c);if(u!=null&&u!=a)return!1;let d=c.dom,h,f=this.isLocked(d)&&!(e.isText&&c.node&&c.node.isText&&c.nodeDOM.nodeValue==e.text&&c.dirty!=Fn&&Vu(s,c.outerDeco));if(!f&&c.update(e,s,n,i))return this.destroyBetween(this.index,l),c.dom!=d&&(this.changed=!0),this.index++,!0;if(!f&&(h=this.recreateWrapper(c,e,s,n,i,o)))return this.destroyBetween(this.index,l),this.top.children[this.index]=h,h.contentDOM&&(h.dirty=wi,h.updateChildren(i,o+1),h.dirty=Ys),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,s,n,i,a,o){if(e.dirty||s.isAtom||!e.children.length||!e.node.content.eq(s.content)||!Vu(n,e.outerDeco)||!i.eq(e.innerDeco))return null;let l=Hr.create(this.top,s,n,i,a,o);if(l.contentDOM){l.children=e.children,e.children=[];for(let c of l.children)c.parent=l}return e.destroy(),l}addNode(e,s,n,i,a){let o=Hr.create(this.top,e,s,n,i,a);o.contentDOM&&o.updateChildren(i,a+1),this.top.children.splice(this.index++,0,o),this.changed=!0}placeWidget(e,s,n){let i=this.index<this.top.children.length?this.top.children[this.index]:null;if(i&&i.matchesWidget(e)&&(e==i.widget||!i.widget.type.toDOM.parentNode))this.index++;else{let a=new q2(this.top,e,s,n);this.top.children.splice(this.index++,0,a),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],s=this.top;for(;e instanceof Vi;)s=e,e=s.children[s.children.length-1];(!e||!(e instanceof Ch)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((us||Kt)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",s),this.addHackNode("BR",this.top))}addHackNode(e,s){if(s==this.top&&this.index<s.children.length&&s.children[this.index].matchesHack(e))this.index++;else{let n=document.createElement(e);e=="IMG"&&(n.className="ProseMirror-separator",n.alt=""),e=="BR"&&(n.className="ProseMirror-trailingBreak");let i=new V2(this.top,[],n,null);s!=this.top?s.children.push(i):s.children.splice(this.index++,0,i),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function $R(t,e){let s=e,n=s.children.length,i=t.childCount,a=new Map,o=[];e:for(;i>0;){let l;for(;;)if(n){let u=s.children[n-1];if(u instanceof Vi)s=u,n=u.children.length;else{l=u,n--;break}}else{if(s==e)break e;n=s.parent.children.indexOf(s),s=s.parent}let c=l.node;if(c){if(c!=t.child(i-1))break;--i,a.set(l,i),o.push(l)}}return{index:i,matched:a,matches:o.reverse()}}function BR(t,e){return t.type.side-e.type.side}function qR(t,e,s,n){let i=e.locals(t),a=0;if(i.length==0){for(let u=0;u<t.childCount;u++){let d=t.child(u);n(d,i,e.forChild(a,d),u),a+=d.nodeSize}return}let o=0,l=[],c=null;for(let u=0;;){let d,h;for(;o<i.length&&i[o].to==a;){let g=i[o++];g.widget&&(d?(h||(h=[d])).push(g):d=g)}if(d)if(h){h.sort(BR);for(let g=0;g<h.length;g++)s(h[g],u,!!c)}else s(d,u,!!c);let f,m;if(c)m=-1,f=c,c=null;else if(u<t.childCount)m=u,f=t.child(u++);else break;for(let g=0;g<l.length;g++)l[g].to<=a&&l.splice(g--,1);for(;o<i.length&&i[o].from<=a&&i[o].to>a;)l.push(i[o++]);let p=a+f.nodeSize;if(f.isText){let g=p;o<i.length&&i[o].from<g&&(g=i[o].from);for(let y=0;y<l.length;y++)l[y].to<g&&(g=l[y].to);g<p&&(c=f.cut(g-a),f=f.cut(0,g-a),p=g,m=-1)}else for(;o<i.length&&i[o].to<p;)o++;let x=f.isInline&&!f.isLeaf?l.filter(g=>!g.inline):l.slice();n(f,x,e.forChild(a,f),m),a=p}}function VR(t){if(t.nodeName=="UL"||t.nodeName=="OL"){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function UR(t,e,s,n){for(let i=0,a=0;i<t.childCount&&a<=n;){let o=t.child(i++),l=a;if(a+=o.nodeSize,!o.isText)continue;let c=o.text;for(;i<t.childCount;){let u=t.child(i++);if(a+=u.nodeSize,!u.isText)break;c+=u.text}if(a>=s){if(a>=n&&c.slice(n-e.length-l,n-l)==e)return n-e.length;let u=l<n?c.lastIndexOf(e,n-l-1):-1;if(u>=0&&u+e.length+l>=s)return l+u;if(s==n&&c.length>=n+e.length-l&&c.slice(n-l,n-l+e.length)==e)return n}}return-1}function Jm(t,e,s,n,i){let a=[];for(let o=0,l=0;o<t.length;o++){let c=t[o],u=l,d=l+=c.size;u>=s||d<=e?a.push(c):(u<e&&a.push(c.slice(0,e-u,n)),i&&(a.push(i),i=void 0),d>s&&a.push(c.slice(s-u,c.size,n)))}return a}function Wx(t,e=null){let s=t.domSelectionRange(),n=t.state.doc;if(!s.focusNode)return null;let i=t.docView.nearestDesc(s.focusNode),a=i&&i.size==0,o=t.docView.posFromDOM(s.focusNode,s.focusOffset,1);if(o<0)return null;let l=n.resolve(o),c,u;if(Sh(s)){for(c=o;i&&!i.node;)i=i.parent;let h=i.node;if(i&&h.isAtom&&ne.isSelectable(h)&&i.parent&&!(h.isInline&&xR(s.focusNode,s.focusOffset,i.dom))){let f=i.posBefore;u=new ne(o==f?l:n.resolve(f))}}else{if(s instanceof t.dom.ownerDocument.defaultView.Selection&&s.rangeCount>1){let h=o,f=o;for(let m=0;m<s.rangeCount;m++){let p=s.getRangeAt(m);h=Math.min(h,t.docView.posFromDOM(p.startContainer,p.startOffset,1)),f=Math.max(f,t.docView.posFromDOM(p.endContainer,p.endOffset,-1))}if(h<0)return null;[c,o]=f==t.state.selection.anchor?[f,h]:[h,f],l=n.resolve(o)}else c=t.docView.posFromDOM(s.anchorNode,s.anchorOffset,1);if(c<0)return null}let d=n.resolve(c);if(!u){let h=e=="pointer"||t.state.selection.head<l.pos&&!a?1:-1;u=Kx(t,d,l,h)}return u}function H2(t){return t.editable?t.hasFocus():J2(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function or(t,e=!1){let s=t.state.selection;if(G2(t,s),!!H2(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&Kt){let n=t.domSelectionRange(),i=t.domObserver.currentSelection;if(n.anchorNode&&i.anchorNode&&qi(n.anchorNode,n.anchorOffset,i.anchorNode,i.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)KR(t);else{let{anchor:n,head:i}=s,a,o;Xy&&!(s instanceof re)&&(s.$from.parent.inlineContent||(a=eb(t,s.from)),!s.empty&&!s.$from.parent.inlineContent&&(o=eb(t,s.to))),t.docView.setSelection(n,i,t,e),Xy&&(a&&tb(a),o&&tb(o)),s.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&WR(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const Xy=us||Kt&&I2<63;function eb(t,e){let{node:s,offset:n}=t.docView.domFromPos(e,0),i=n<s.childNodes.length?s.childNodes[n]:null,a=n?s.childNodes[n-1]:null;if(us&&i&&i.contentEditable=="false")return Cf(i);if((!i||i.contentEditable=="false")&&(!a||a.contentEditable=="false")){if(i)return Cf(i);if(a)return Cf(a)}}function Cf(t){return t.contentEditable="true",us&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function tb(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function WR(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let s=t.domSelectionRange(),n=s.anchorNode,i=s.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(s.anchorNode!=n||s.anchorOffset!=i)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!H2(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function KR(t){let e=t.domSelection();if(!e)return;let s=t.cursorWrapper.dom,n=s.nodeName=="IMG";n?e.collapse(s.parentNode,$t(s)+1):e.collapse(s,0),!n&&!t.state.selection.visible&&bs&&Kr<=11&&(s.disabled=!0,s.disabled=!1)}function G2(t,e){if(e instanceof ne){let s=t.docView.descAt(e.from);s!=t.lastSelectedViewDesc&&(sb(t),s&&s.selectNode(),t.lastSelectedViewDesc=s)}else sb(t)}function sb(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function Kx(t,e,s,n){return t.someProp("createSelectionBetween",i=>i(t,e,s))||re.between(e,s,n)}function nb(t){return t.editable&&!t.hasFocus()?!1:J2(t)}function J2(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function HR(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),s=t.domSelectionRange();return qi(e.node,e.offset,s.anchorNode,s.anchorOffset)}function Zm(t,e){let{$anchor:s,$head:n}=t.selection,i=e>0?s.max(n):s.min(n),a=i.parent.inlineContent?i.depth?t.doc.resolve(e>0?i.after():i.before()):null:i;return a&&le.findFrom(a,e)}function _r(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function rb(t,e,s){let n=t.state.selection;if(n instanceof re)if(s.indexOf("s")>-1){let{$head:i}=n,a=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter;if(!a||a.isText||!a.isLeaf)return!1;let o=t.state.doc.resolve(i.pos+a.nodeSize*(e<0?-1:1));return _r(t,new re(n.$anchor,o))}else if(n.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let i=Zm(t.state,e);return i&&i instanceof ne?_r(t,i):!1}else if(!(Ws&&s.indexOf("m")>-1)){let i=n.$head,a=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter,o;if(!a||a.isText)return!1;let l=e<0?i.pos-a.nodeSize:i.pos;return a.isAtom||(o=t.docView.descAt(l))&&!o.contentDOM?ne.isSelectable(a)?_r(t,new ne(e<0?t.state.doc.resolve(i.pos-a.nodeSize):i)):hc?_r(t,new re(t.state.doc.resolve(e<0?l:l+a.nodeSize))):!1:!1}}else return!1;else{if(n instanceof ne&&n.node.isInline)return _r(t,new re(e>0?n.$to:n.$from));{let i=Zm(t.state,e);return i?_r(t,i):!1}}}function Uu(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function nl(t,e){let s=t.pmViewDesc;return s&&s.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function da(t,e){return e<0?GR(t):JR(t)}function GR(t){let e=t.domSelectionRange(),s=e.focusNode,n=e.focusOffset;if(!s)return;let i,a,o=!1;for(Qs&&s.nodeType==1&&n<Uu(s)&&nl(s.childNodes[n],-1)&&(o=!0);;)if(n>0){if(s.nodeType!=1)break;{let l=s.childNodes[n-1];if(nl(l,-1))i=s,a=--n;else if(l.nodeType==3)s=l,n=s.nodeValue.length;else break}}else{if(Z2(s))break;{let l=s.previousSibling;for(;l&&nl(l,-1);)i=s.parentNode,a=$t(l),l=l.previousSibling;if(l)s=l,n=Uu(s);else{if(s=s.parentNode,s==t.dom)break;n=0}}}o?Qm(t,s,n):i&&Qm(t,i,a)}function JR(t){let e=t.domSelectionRange(),s=e.focusNode,n=e.focusOffset;if(!s)return;let i=Uu(s),a,o;for(;;)if(n<i){if(s.nodeType!=1)break;let l=s.childNodes[n];if(nl(l,1))a=s,o=++n;else break}else{if(Z2(s))break;{let l=s.nextSibling;for(;l&&nl(l,1);)a=l.parentNode,o=$t(l)+1,l=l.nextSibling;if(l)s=l,n=0,i=Uu(s);else{if(s=s.parentNode,s==t.dom)break;n=i=0}}}a&&Qm(t,a,o)}function Z2(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function ZR(t,e){for(;t&&e==t.childNodes.length&&!dc(t);)e=$t(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let s=t.childNodes[e];if(s.nodeType==3)return s;if(s.nodeType==1&&s.contentEditable=="false")break;t=s,e=0}}function QR(t,e){for(;t&&!e&&!dc(t);)e=$t(t),t=t.parentNode;for(;t&&e;){let s=t.childNodes[e-1];if(s.nodeType==3)return s;if(s.nodeType==1&&s.contentEditable=="false")break;t=s,e=t.childNodes.length}}function Qm(t,e,s){if(e.nodeType!=3){let a,o;(o=ZR(e,s))?(e=o,s=0):(a=QR(e,s))&&(e=a,s=a.nodeValue.length)}let n=t.domSelection();if(!n)return;if(Sh(n)){let a=document.createRange();a.setEnd(e,s),a.setStart(e,s),n.removeAllRanges(),n.addRange(a)}else n.extend&&n.extend(e,s);t.domObserver.setCurSelection();let{state:i}=t;setTimeout(()=>{t.state==i&&or(t)},50)}function ib(t,e){let s=t.state.doc.resolve(e);if(!(Kt||bR)&&s.parent.inlineContent){let i=t.coordsAtPos(e);if(e>s.start()){let a=t.coordsAtPos(e-1),o=(a.top+a.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(a.left-i.left)>1)return a.left<i.left?"ltr":"rtl"}if(e<s.end()){let a=t.coordsAtPos(e+1),o=(a.top+a.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(a.left-i.left)>1)return a.left>i.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function ab(t,e,s){let n=t.state.selection;if(n instanceof re&&!n.empty||s.indexOf("s")>-1||Ws&&s.indexOf("m")>-1)return!1;let{$from:i,$to:a}=n;if(!i.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let o=Zm(t.state,e);if(o&&o instanceof ne)return _r(t,o)}if(!i.parent.inlineContent){let o=e<0?i:a,l=n instanceof Ps?le.near(o,e):le.findFrom(o,e);return l?_r(t,l):!1}return!1}function ob(t,e){if(!(t.state.selection instanceof re))return!0;let{$head:s,$anchor:n,empty:i}=t.state.selection;if(!s.sameParent(n))return!0;if(!i)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let a=!s.textOffset&&(e<0?s.nodeBefore:s.nodeAfter);if(a&&!a.isText){let o=t.state.tr;return e<0?o.delete(s.pos-a.nodeSize,s.pos):o.delete(s.pos,s.pos+a.nodeSize),t.dispatch(o),!0}return!1}function lb(t,e,s){t.domObserver.stop(),e.contentEditable=s,t.domObserver.start()}function YR(t){if(!us||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:s}=t.domSelectionRange();if(e&&e.nodeType==1&&s==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let n=e.firstChild;lb(t,n,"true"),setTimeout(()=>lb(t,n,"false"),20)}return!1}function XR(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function e8(t,e){let s=e.keyCode,n=XR(e);if(s==8||Ws&&s==72&&n=="c")return ob(t,-1)||da(t,-1);if(s==46&&!e.shiftKey||Ws&&s==68&&n=="c")return ob(t,1)||da(t,1);if(s==13||s==27)return!0;if(s==37||Ws&&s==66&&n=="c"){let i=s==37?ib(t,t.state.selection.from)=="ltr"?-1:1:-1;return rb(t,i,n)||da(t,i)}else if(s==39||Ws&&s==70&&n=="c"){let i=s==39?ib(t,t.state.selection.from)=="ltr"?1:-1:1;return rb(t,i,n)||da(t,i)}else{if(s==38||Ws&&s==80&&n=="c")return ab(t,-1,n)||da(t,-1);if(s==40||Ws&&s==78&&n=="c")return YR(t)||ab(t,1,n)||da(t,1);if(n==(Ws?"m":"c")&&(s==66||s==73||s==89||s==90))return!0}return!1}function Hx(t,e){t.someProp("transformCopied",m=>{e=m(e,t)});let s=[],{content:n,openStart:i,openEnd:a}=e;for(;i>1&&a>1&&n.childCount==1&&n.firstChild.childCount==1;){i--,a--;let m=n.firstChild;s.push(m.type.name,m.attrs!=m.type.defaultAttrs?m.attrs:null),n=m.content}let o=t.someProp("clipboardSerializer")||ea.fromSchema(t.state.schema),l=sS(),c=l.createElement("div");c.appendChild(o.serializeFragment(n,{document:l}));let u=c.firstChild,d,h=0;for(;u&&u.nodeType==1&&(d=tS[u.nodeName.toLowerCase()]);){for(let m=d.length-1;m>=0;m--){let p=l.createElement(d[m]);for(;c.firstChild;)p.appendChild(c.firstChild);c.appendChild(p),h++}u=c.firstChild}u&&u.nodeType==1&&u.setAttribute("data-pm-slice",`${i} ${a}${h?` -${h}`:""} ${JSON.stringify(s)}`);let f=t.someProp("clipboardTextSerializer",m=>m(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:c,text:f,slice:e}}function Q2(t,e,s,n,i){let a=i.parent.type.spec.code,o,l;if(!s&&!e)return null;let c=!!e&&(n||a||!s);if(c){if(t.someProp("transformPastedText",f=>{e=f(e,a||n,t)}),a)return l=new Q(q.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),t.someProp("transformPasted",f=>{l=f(l,t,!0)}),l;let h=t.someProp("clipboardTextParser",f=>f(e,i,n,t));if(h)l=h;else{let f=i.marks(),{schema:m}=t.state,p=ea.fromSchema(m);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(x=>{let g=o.appendChild(document.createElement("p"));x&&g.appendChild(p.serializeNode(m.text(x,f)))})}}else t.someProp("transformPastedHTML",h=>{s=h(s,t)}),o=r8(s),hc&&i8(o);let u=o&&o.querySelector("[data-pm-slice]"),d=u&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(u.getAttribute("data-pm-slice")||"");if(d&&d[3])for(let h=+d[3];h>0;h--){let f=o.firstChild;for(;f&&f.nodeType!=1;)f=f.nextSibling;if(!f)break;o=f}if(l||(l=(t.someProp("clipboardParser")||t.someProp("domParser")||ir.fromSchema(t.state.schema)).parseSlice(o,{preserveWhitespace:!!(c||d),context:i,ruleFromNode(f){return f.nodeName=="BR"&&!f.nextSibling&&f.parentNode&&!t8.test(f.parentNode.nodeName)?{ignore:!0}:null}})),d)l=a8(cb(l,+d[1],+d[2]),d[4]);else if(l=Q.maxOpen(s8(l.content,i),!0),l.openStart||l.openEnd){let h=0,f=0;for(let m=l.content.firstChild;h<l.openStart&&!m.type.spec.isolating;h++,m=m.firstChild);for(let m=l.content.lastChild;f<l.openEnd&&!m.type.spec.isolating;f++,m=m.lastChild);l=cb(l,h,f)}return t.someProp("transformPasted",h=>{l=h(l,t,c)}),l}const t8=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function s8(t,e){if(t.childCount<2)return t;for(let s=e.depth;s>=0;s--){let i=e.node(s).contentMatchAt(e.index(s)),a,o=[];if(t.forEach(l=>{if(!o)return;let c=i.findWrapping(l.type),u;if(!c)return o=null;if(u=o.length&&a.length&&X2(c,a,l,o[o.length-1],0))o[o.length-1]=u;else{o.length&&(o[o.length-1]=eS(o[o.length-1],a.length));let d=Y2(l,c);o.push(d),i=i.matchType(d.type),a=c}}),o)return q.from(o)}return t}function Y2(t,e,s=0){for(let n=e.length-1;n>=s;n--)t=e[n].create(null,q.from(t));return t}function X2(t,e,s,n,i){if(i<t.length&&i<e.length&&t[i]==e[i]){let a=X2(t,e,s,n.lastChild,i+1);if(a)return n.copy(n.content.replaceChild(n.childCount-1,a));if(n.contentMatchAt(n.childCount).matchType(i==t.length-1?s.type:t[i+1]))return n.copy(n.content.append(q.from(Y2(s,t,i+1))))}}function eS(t,e){if(e==0)return t;let s=t.content.replaceChild(t.childCount-1,eS(t.lastChild,e-1)),n=t.contentMatchAt(t.childCount).fillBefore(q.empty,!0);return t.copy(s.append(n))}function Ym(t,e,s,n,i,a){let o=e<0?t.firstChild:t.lastChild,l=o.content;return t.childCount>1&&(a=0),i<n-1&&(l=Ym(l,e,s,n,i+1,a)),i>=s&&(l=e<0?o.contentMatchAt(0).fillBefore(l,a<=i).append(l):l.append(o.contentMatchAt(o.childCount).fillBefore(q.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,o.copy(l))}function cb(t,e,s){return e<t.openStart&&(t=new Q(Ym(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),s<t.openEnd&&(t=new Q(Ym(t.content,1,s,t.openEnd,0,0),t.openStart,s)),t}const tS={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let ub=null;function sS(){return ub||(ub=document.implementation.createHTMLDocument("title"))}let zf=null;function n8(t){let e=window.trustedTypes;return e?(zf||(zf=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:s=>s})),zf.createHTML(t)):t}function r8(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let s=sS().createElement("div"),n=/<([a-z][^>\s]+)/i.exec(t),i;if((i=n&&tS[n[1].toLowerCase()])&&(t=i.map(a=>"<"+a+">").join("")+t+i.map(a=>"</"+a+">").reverse().join("")),s.innerHTML=n8(t),i)for(let a=0;a<i.length;a++)s=s.querySelector(i[a])||s;return s}function i8(t){let e=t.querySelectorAll(Kt?"span:not([class]):not([style])":"span.Apple-converted-space");for(let s=0;s<e.length;s++){let n=e[s];n.childNodes.length==1&&n.textContent==" "&&n.parentNode&&n.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),n)}}function a8(t,e){if(!t.size)return t;let s=t.content.firstChild.type.schema,n;try{n=JSON.parse(e)}catch{return t}let{content:i,openStart:a,openEnd:o}=t;for(let l=n.length-2;l>=0;l-=2){let c=s.nodes[n[l]];if(!c||c.hasRequiredAttrs())break;i=q.from(c.create(n[l+1],i)),a++,o++}return new Q(i,a,o)}const ds={},hs={},o8={touchstart:!0,touchmove:!0};class l8{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function c8(t){for(let e in ds){let s=ds[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=n=>{d8(t,n)&&!Gx(t,n)&&(t.editable||!(n.type in hs))&&s(t,n)},o8[e]?{passive:!0}:void 0)}us&&t.dom.addEventListener("input",()=>null),Xm(t)}function $r(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function u8(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function Xm(t){t.someProp("handleDOMEvents",e=>{for(let s in e)t.input.eventHandlers[s]||t.dom.addEventListener(s,t.input.eventHandlers[s]=n=>Gx(t,n))})}function Gx(t,e){return t.someProp("handleDOMEvents",s=>{let n=s[e.type];return n?n(t,e)||e.defaultPrevented:!1})}function d8(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let s=e.target;s!=t.dom;s=s.parentNode)if(!s||s.nodeType==11||s.pmViewDesc&&s.pmViewDesc.stopEvent(e))return!1;return!0}function h8(t,e){!Gx(t,e)&&ds[e.type]&&(t.editable||!(e.type in hs))&&ds[e.type](t,e)}hs.keydown=(t,e)=>{let s=e;if(t.input.shiftKey=s.keyCode==16||s.shiftKey,!rS(t,s)&&(t.input.lastKeyCode=s.keyCode,t.input.lastKeyCodeTime=Date.now(),!(nr&&Kt&&s.keyCode==13)))if(s.keyCode!=229&&t.domObserver.forceFlush(),to&&s.keyCode==13&&!s.ctrlKey&&!s.altKey&&!s.metaKey){let n=Date.now();t.input.lastIOSEnter=n,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==n&&(t.someProp("handleKeyDown",i=>i(t,xi(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",n=>n(t,s))||e8(t,s)?s.preventDefault():$r(t,"key")};hs.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)};hs.keypress=(t,e)=>{let s=e;if(rS(t,s)||!s.charCode||s.ctrlKey&&!s.altKey||Ws&&s.metaKey)return;if(t.someProp("handleKeyPress",i=>i(t,s))){s.preventDefault();return}let n=t.state.selection;if(!(n instanceof re)||!n.$from.sameParent(n.$to)){let i=String.fromCharCode(s.charCode),a=()=>t.state.tr.insertText(i).scrollIntoView();!/[\r\n]/.test(i)&&!t.someProp("handleTextInput",o=>o(t,n.$from.pos,n.$to.pos,i,a))&&t.dispatch(a()),s.preventDefault()}};function zh(t){return{left:t.clientX,top:t.clientY}}function f8(t,e){let s=e.x-t.clientX,n=e.y-t.clientY;return s*s+n*n<100}function Jx(t,e,s,n,i){if(n==-1)return!1;let a=t.state.doc.resolve(n);for(let o=a.depth+1;o>0;o--)if(t.someProp(e,l=>o>a.depth?l(t,s,a.nodeAfter,a.before(o),i,!0):l(t,s,a.node(o),a.before(o),i,!1)))return!0;return!1}function La(t,e,s){if(t.focused||t.focus(),t.state.selection.eq(e))return;let n=t.state.tr.setSelection(e);n.setMeta("pointer",!0),t.dispatch(n)}function m8(t,e){if(e==-1)return!1;let s=t.state.doc.resolve(e),n=s.nodeAfter;return n&&n.isAtom&&ne.isSelectable(n)?(La(t,new ne(s)),!0):!1}function p8(t,e){if(e==-1)return!1;let s=t.state.selection,n,i;s instanceof ne&&(n=s.node);let a=t.state.doc.resolve(e);for(let o=a.depth+1;o>0;o--){let l=o>a.depth?a.nodeAfter:a.node(o);if(ne.isSelectable(l)){n&&s.$from.depth>0&&o>=s.$from.depth&&a.before(s.$from.depth+1)==s.$from.pos?i=a.before(s.$from.depth):i=a.before(o);break}}return i!=null?(La(t,ne.create(t.state.doc,i)),!0):!1}function x8(t,e,s,n,i){return Jx(t,"handleClickOn",e,s,n)||t.someProp("handleClick",a=>a(t,e,n))||(i?p8(t,s):m8(t,s))}function g8(t,e,s,n){return Jx(t,"handleDoubleClickOn",e,s,n)||t.someProp("handleDoubleClick",i=>i(t,e,n))}function y8(t,e,s,n){return Jx(t,"handleTripleClickOn",e,s,n)||t.someProp("handleTripleClick",i=>i(t,e,n))||b8(t,s,n)}function b8(t,e,s){if(s.button!=0)return!1;let n=t.state.doc;if(e==-1)return n.inlineContent?(La(t,re.create(n,0,n.content.size)),!0):!1;let i=n.resolve(e);for(let a=i.depth+1;a>0;a--){let o=a>i.depth?i.nodeAfter:i.node(a),l=i.before(a);if(o.inlineContent)La(t,re.create(n,l+1,l+1+o.content.size));else if(ne.isSelectable(o))La(t,ne.create(n,l));else continue;return!0}}function Zx(t){return Wu(t)}const nS=Ws?"metaKey":"ctrlKey";ds.mousedown=(t,e)=>{let s=e;t.input.shiftKey=s.shiftKey;let n=Zx(t),i=Date.now(),a="singleClick";i-t.input.lastClick.time<500&&f8(s,t.input.lastClick)&&!s[nS]&&t.input.lastClick.button==s.button&&(t.input.lastClick.type=="singleClick"?a="doubleClick":t.input.lastClick.type=="doubleClick"&&(a="tripleClick")),t.input.lastClick={time:i,x:s.clientX,y:s.clientY,type:a,button:s.button};let o=t.posAtCoords(zh(s));o&&(a=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new j8(t,o,s,!!n)):(a=="doubleClick"?g8:y8)(t,o.pos,o.inside,s)?s.preventDefault():$r(t,"pointer"))};class j8{constructor(e,s,n,i){this.view=e,this.pos=s,this.event=n,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!n[nS],this.allowDefault=n.shiftKey;let a,o;if(s.inside>-1)a=e.state.doc.nodeAt(s.inside),o=s.inside;else{let d=e.state.doc.resolve(s.pos);a=d.parent,o=d.depth?d.before():0}const l=i?null:n.target,c=l?e.docView.nearestDesc(l,!0):null;this.target=c&&c.nodeDOM.nodeType==1?c.nodeDOM:null;let{selection:u}=e.state;(n.button==0&&a.type.spec.draggable&&a.type.spec.selectable!==!1||u instanceof ne&&u.from<=o&&u.to>o)&&(this.mightDrag={node:a,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&Qs&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),$r(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>or(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let s=this.pos;this.view.state.doc!=this.startDoc&&(s=this.view.posAtCoords(zh(e))),this.updateAllowDefault(e),this.allowDefault||!s?$r(this.view,"pointer"):x8(this.view,s.pos,s.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||us&&this.mightDrag&&!this.mightDrag.node.isAtom||Kt&&!this.view.state.selection.visible&&Math.min(Math.abs(s.pos-this.view.state.selection.from),Math.abs(s.pos-this.view.state.selection.to))<=2)?(La(this.view,le.near(this.view.state.doc.resolve(s.pos))),e.preventDefault()):$r(this.view,"pointer")}move(e){this.updateAllowDefault(e),$r(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}ds.touchstart=t=>{t.input.lastTouch=Date.now(),Zx(t),$r(t,"pointer")};ds.touchmove=t=>{t.input.lastTouch=Date.now(),$r(t,"pointer")};ds.contextmenu=t=>Zx(t);function rS(t,e){return t.composing?!0:us&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const w8=nr?5e3:-1;hs.compositionstart=hs.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,s=e.selection.$to;if(e.selection instanceof re&&(e.storedMarks||!s.textOffset&&s.parentOffset&&s.nodeBefore.marks.some(n=>n.type.spec.inclusive===!1)))t.markCursor=t.state.storedMarks||s.marks(),Wu(t,!0),t.markCursor=null;else if(Wu(t,!e.selection.empty),Qs&&e.selection.empty&&s.parentOffset&&!s.textOffset&&s.nodeBefore.marks.length){let n=t.domSelectionRange();for(let i=n.focusNode,a=n.focusOffset;i&&i.nodeType==1&&a!=0;){let o=a<0?i.lastChild:i.childNodes[a-1];if(!o)break;if(o.nodeType==3){let l=t.domSelection();l&&l.collapse(o,o.nodeValue.length);break}else i=o,a=-1}}t.input.composing=!0}iS(t,w8)};hs.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,iS(t,20))};function iS(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>Wu(t),e))}function aS(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=k8());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function v8(t){let e=t.domSelectionRange();if(!e.focusNode)return null;let s=mR(e.focusNode,e.focusOffset),n=pR(e.focusNode,e.focusOffset);if(s&&n&&s!=n){let i=n.pmViewDesc,a=t.domObserver.lastChangedTextNode;if(s==a||n==a)return a;if(!i||!i.isText(n.nodeValue))return n;if(t.input.compositionNode==n){let o=s.pmViewDesc;if(!(!o||!o.isText(s.nodeValue)))return n}}return s||n}function k8(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function Wu(t,e=!1){if(!(nr&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),aS(t),e||t.docView&&t.docView.dirty){let s=Wx(t),n=t.state.selection;return s&&!s.eq(n)?t.dispatch(t.state.tr.setSelection(s)):(t.markCursor||e)&&!n.$from.node(n.$from.sharedDepth(n.to)).inlineContent?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function N8(t,e){if(!t.dom.parentNode)return;let s=t.dom.parentNode.appendChild(document.createElement("div"));s.appendChild(e),s.style.cssText="position: fixed; left: -10000px; top: 10px";let n=getSelection(),i=document.createRange();i.selectNodeContents(e),t.dom.blur(),n.removeAllRanges(),n.addRange(i),setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s),t.focus()},50)}const Il=bs&&Kr<15||to&&jR<604;ds.copy=hs.cut=(t,e)=>{let s=e,n=t.state.selection,i=s.type=="cut";if(n.empty)return;let a=Il?null:s.clipboardData,o=n.content(),{dom:l,text:c}=Hx(t,o);a?(s.preventDefault(),a.clearData(),a.setData("text/html",l.innerHTML),a.setData("text/plain",c)):N8(t,l),i&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function S8(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function C8(t,e){if(!t.dom.parentNode)return;let s=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,n=t.dom.parentNode.appendChild(document.createElement(s?"textarea":"div"));s||(n.contentEditable="true"),n.style.cssText="position: fixed; left: -10000px; top: 10px",n.focus();let i=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),n.parentNode&&n.parentNode.removeChild(n),s?Ol(t,n.value,null,i,e):Ol(t,n.textContent,n.innerHTML,i,e)},50)}function Ol(t,e,s,n,i){let a=Q2(t,e,s,n,t.state.selection.$from);if(t.someProp("handlePaste",c=>c(t,i,a||Q.empty)))return!0;if(!a)return!1;let o=S8(a),l=o?t.state.tr.replaceSelectionWith(o,n):t.state.tr.replaceSelection(a);return t.dispatch(l.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function oS(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let s=t.getData("text/uri-list");return s?s.replace(/\r?\n/g," "):""}hs.paste=(t,e)=>{let s=e;if(t.composing&&!nr)return;let n=Il?null:s.clipboardData,i=t.input.shiftKey&&t.input.lastKeyCode!=45;n&&Ol(t,oS(n),n.getData("text/html"),i,s)?s.preventDefault():C8(t,s)};class lS{constructor(e,s,n){this.slice=e,this.move=s,this.node=n}}const z8=Ws?"altKey":"ctrlKey";function cS(t,e){let s=t.someProp("dragCopies",n=>!n(e));return s??!e[z8]}ds.dragstart=(t,e)=>{let s=e,n=t.input.mouseDown;if(n&&n.done(),!s.dataTransfer)return;let i=t.state.selection,a=i.empty?null:t.posAtCoords(zh(s)),o;if(!(a&&a.pos>=i.from&&a.pos<=(i instanceof ne?i.to-1:i.to))){if(n&&n.mightDrag)o=ne.create(t.state.doc,n.mightDrag.pos);else if(s.target&&s.target.nodeType==1){let h=t.docView.nearestDesc(s.target,!0);h&&h.node.type.spec.draggable&&h!=t.docView&&(o=ne.create(t.state.doc,h.posBefore))}}let l=(o||t.state.selection).content(),{dom:c,text:u,slice:d}=Hx(t,l);(!s.dataTransfer.files.length||!Kt||I2>120)&&s.dataTransfer.clearData(),s.dataTransfer.setData(Il?"Text":"text/html",c.innerHTML),s.dataTransfer.effectAllowed="copyMove",Il||s.dataTransfer.setData("text/plain",u),t.dragging=new lS(d,cS(t,s),o)};ds.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)};hs.dragover=hs.dragenter=(t,e)=>e.preventDefault();hs.drop=(t,e)=>{let s=e,n=t.dragging;if(t.dragging=null,!s.dataTransfer)return;let i=t.posAtCoords(zh(s));if(!i)return;let a=t.state.doc.resolve(i.pos),o=n&&n.slice;o?t.someProp("transformPasted",p=>{o=p(o,t,!1)}):o=Q2(t,oS(s.dataTransfer),Il?null:s.dataTransfer.getData("text/html"),!1,a);let l=!!(n&&cS(t,s));if(t.someProp("handleDrop",p=>p(t,s,o||Q.empty,l))){s.preventDefault();return}if(!o)return;s.preventDefault();let c=o?C2(t.state.doc,a.pos,o):a.pos;c==null&&(c=a.pos);let u=t.state.tr;if(l){let{node:p}=n;p?p.replace(u):u.deleteSelection()}let d=u.mapping.map(c),h=o.openStart==0&&o.openEnd==0&&o.content.childCount==1,f=u.doc;if(h?u.replaceRangeWith(d,d,o.content.firstChild):u.replaceRange(d,d,o),u.doc.eq(f))return;let m=u.doc.resolve(d);if(h&&ne.isSelectable(o.content.firstChild)&&m.nodeAfter&&m.nodeAfter.sameMarkup(o.content.firstChild))u.setSelection(new ne(m));else{let p=u.mapping.map(c);u.mapping.maps[u.mapping.maps.length-1].forEach((x,g,y,b)=>p=b),u.setSelection(Kx(t,m,u.doc.resolve(p)))}t.focus(),t.dispatch(u.setMeta("uiEvent","drop"))};ds.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&or(t)},20))};ds.blur=(t,e)=>{let s=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),s.relatedTarget&&t.dom.contains(s.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};ds.beforeinput=(t,e)=>{if(Kt&&nr&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:n}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=n||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",a=>a(t,xi(8,"Backspace")))))return;let{$cursor:i}=t.state.selection;i&&i.pos>0&&t.dispatch(t.state.tr.delete(i.pos-1,i.pos).scrollIntoView())},50)}};for(let t in hs)ds[t]=hs[t];function Rl(t,e){if(t==e)return!0;for(let s in t)if(t[s]!==e[s])return!1;for(let s in e)if(!(s in t))return!1;return!0}class Ku{constructor(e,s){this.toDOM=e,this.spec=s||Ai,this.side=this.spec.side||0}map(e,s,n,i){let{pos:a,deleted:o}=e.mapResult(s.from+i,this.side<0?-1:1);return o?null:new kt(a-n,a-n,this)}valid(){return!0}eq(e){return this==e||e instanceof Ku&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Rl(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Gr{constructor(e,s){this.attrs=e,this.spec=s||Ai}map(e,s,n,i){let a=e.map(s.from+i,this.spec.inclusiveStart?-1:1)-n,o=e.map(s.to+i,this.spec.inclusiveEnd?1:-1)-n;return a>=o?null:new kt(a,o,this)}valid(e,s){return s.from<s.to}eq(e){return this==e||e instanceof Gr&&Rl(this.attrs,e.attrs)&&Rl(this.spec,e.spec)}static is(e){return e.type instanceof Gr}destroy(){}}class Qx{constructor(e,s){this.attrs=e,this.spec=s||Ai}map(e,s,n,i){let a=e.mapResult(s.from+i,1);if(a.deleted)return null;let o=e.mapResult(s.to+i,-1);return o.deleted||o.pos<=a.pos?null:new kt(a.pos-n,o.pos-n,this)}valid(e,s){let{index:n,offset:i}=e.content.findIndex(s.from),a;return i==s.from&&!(a=e.child(n)).isText&&i+a.nodeSize==s.to}eq(e){return this==e||e instanceof Qx&&Rl(this.attrs,e.attrs)&&Rl(this.spec,e.spec)}destroy(){}}class kt{constructor(e,s,n){this.from=e,this.to=s,this.type=n}copy(e,s){return new kt(e,s,this.type)}eq(e,s=0){return this.type.eq(e.type)&&this.from+s==e.from&&this.to+s==e.to}map(e,s,n){return this.type.map(e,this,s,n)}static widget(e,s,n){return new kt(e,e,new Ku(s,n))}static inline(e,s,n,i){return new kt(e,s,new Gr(n,i))}static node(e,s,n,i){return new kt(e,s,new Qx(n,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof Gr}get widget(){return this.type instanceof Ku}}const xa=[],Ai={};class Ie{constructor(e,s){this.local=e.length?e:xa,this.children=s.length?s:xa}static create(e,s){return s.length?Hu(s,e,0,Ai):Wt}find(e,s,n){let i=[];return this.findInner(e??0,s??1e9,i,0,n),i}findInner(e,s,n,i,a){for(let o=0;o<this.local.length;o++){let l=this.local[o];l.from<=s&&l.to>=e&&(!a||a(l.spec))&&n.push(l.copy(l.from+i,l.to+i))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<s&&this.children[o+1]>e){let l=this.children[o]+1;this.children[o+2].findInner(e-l,s-l,n,i+l,a)}}map(e,s,n){return this==Wt||e.maps.length==0?this:this.mapInner(e,s,0,0,n||Ai)}mapInner(e,s,n,i,a){let o;for(let l=0;l<this.local.length;l++){let c=this.local[l].map(e,n,i);c&&c.type.valid(s,c)?(o||(o=[])).push(c):a.onRemove&&a.onRemove(this.local[l].spec)}return this.children.length?_8(this.children,o||[],e,s,n,i,a):o?new Ie(o.sort(Ti),xa):Wt}add(e,s){return s.length?this==Wt?Ie.create(e,s):this.addInner(e,s,0):this}addInner(e,s,n){let i,a=0;e.forEach((l,c)=>{let u=c+n,d;if(d=dS(s,l,u)){for(i||(i=this.children.slice());a<i.length&&i[a]<c;)a+=3;i[a]==c?i[a+2]=i[a+2].addInner(l,d,u+1):i.splice(a,0,c,c+l.nodeSize,Hu(d,l,u+1,Ai)),a+=3}});let o=uS(a?hS(s):s,-n);for(let l=0;l<o.length;l++)o[l].type.valid(e,o[l])||o.splice(l--,1);return new Ie(o.length?this.local.concat(o).sort(Ti):this.local,i||this.children)}remove(e){return e.length==0||this==Wt?this:this.removeInner(e,0)}removeInner(e,s){let n=this.children,i=this.local;for(let a=0;a<n.length;a+=3){let o,l=n[a]+s,c=n[a+1]+s;for(let d=0,h;d<e.length;d++)(h=e[d])&&h.from>l&&h.to<c&&(e[d]=null,(o||(o=[])).push(h));if(!o)continue;n==this.children&&(n=this.children.slice());let u=n[a+2].removeInner(o,l+1);u!=Wt?n[a+2]=u:(n.splice(a,3),a-=3)}if(i.length){for(let a=0,o;a<e.length;a++)if(o=e[a])for(let l=0;l<i.length;l++)i[l].eq(o,s)&&(i==this.local&&(i=this.local.slice()),i.splice(l--,1))}return n==this.children&&i==this.local?this:i.length||n.length?new Ie(i,n):Wt}forChild(e,s){if(this==Wt)return this;if(s.isLeaf)return Ie.empty;let n,i;for(let l=0;l<this.children.length;l+=3)if(this.children[l]>=e){this.children[l]==e&&(n=this.children[l+2]);break}let a=e+1,o=a+s.content.size;for(let l=0;l<this.local.length;l++){let c=this.local[l];if(c.from<o&&c.to>a&&c.type instanceof Gr){let u=Math.max(a,c.from)-a,d=Math.min(o,c.to)-a;u<d&&(i||(i=[])).push(c.copy(u,d))}}if(i){let l=new Ie(i.sort(Ti),xa);return n?new Mr([l,n]):l}return n||Wt}eq(e){if(this==e)return!0;if(!(e instanceof Ie)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let s=0;s<this.local.length;s++)if(!this.local[s].eq(e.local[s]))return!1;for(let s=0;s<this.children.length;s+=3)if(this.children[s]!=e.children[s]||this.children[s+1]!=e.children[s+1]||!this.children[s+2].eq(e.children[s+2]))return!1;return!0}locals(e){return Yx(this.localsInner(e))}localsInner(e){if(this==Wt)return xa;if(e.inlineContent||!this.local.some(Gr.is))return this.local;let s=[];for(let n=0;n<this.local.length;n++)this.local[n].type instanceof Gr||s.push(this.local[n]);return s}forEachSet(e){e(this)}}Ie.empty=new Ie([],[]);Ie.removeOverlap=Yx;const Wt=Ie.empty;class Mr{constructor(e){this.members=e}map(e,s){const n=this.members.map(i=>i.map(e,s,Ai));return Mr.from(n)}forChild(e,s){if(s.isLeaf)return Ie.empty;let n=[];for(let i=0;i<this.members.length;i++){let a=this.members[i].forChild(e,s);a!=Wt&&(a instanceof Mr?n=n.concat(a.members):n.push(a))}return Mr.from(n)}eq(e){if(!(e instanceof Mr)||e.members.length!=this.members.length)return!1;for(let s=0;s<this.members.length;s++)if(!this.members[s].eq(e.members[s]))return!1;return!0}locals(e){let s,n=!0;for(let i=0;i<this.members.length;i++){let a=this.members[i].localsInner(e);if(a.length)if(!s)s=a;else{n&&(s=s.slice(),n=!1);for(let o=0;o<a.length;o++)s.push(a[o])}}return s?Yx(n?s:s.sort(Ti)):xa}static from(e){switch(e.length){case 0:return Wt;case 1:return e[0];default:return new Mr(e.every(s=>s instanceof Ie)?e:e.reduce((s,n)=>s.concat(n instanceof Ie?n:n.members),[]))}}forEachSet(e){for(let s=0;s<this.members.length;s++)this.members[s].forEachSet(e)}}function _8(t,e,s,n,i,a,o){let l=t.slice();for(let u=0,d=a;u<s.maps.length;u++){let h=0;s.maps[u].forEach((f,m,p,x)=>{let g=x-p-(m-f);for(let y=0;y<l.length;y+=3){let b=l[y+1];if(b<0||f>b+d-h)continue;let w=l[y]+d-h;m>=w?l[y+1]=f<=w?-2:-1:f>=d&&g&&(l[y]+=g,l[y+1]+=g)}h+=g}),d=s.maps[u].map(d,-1)}let c=!1;for(let u=0;u<l.length;u+=3)if(l[u+1]<0){if(l[u+1]==-2){c=!0,l[u+1]=-1;continue}let d=s.map(t[u]+a),h=d-i;if(h<0||h>=n.content.size){c=!0;continue}let f=s.map(t[u+1]+a,-1),m=f-i,{index:p,offset:x}=n.content.findIndex(h),g=n.maybeChild(p);if(g&&x==h&&x+g.nodeSize==m){let y=l[u+2].mapInner(s,g,d+1,t[u]+a+1,o);y!=Wt?(l[u]=h,l[u+1]=m,l[u+2]=y):(l[u+1]=-2,c=!0)}else c=!0}if(c){let u=A8(l,t,e,s,i,a,o),d=Hu(u,n,0,o);e=d.local;for(let h=0;h<l.length;h+=3)l[h+1]<0&&(l.splice(h,3),h-=3);for(let h=0,f=0;h<d.children.length;h+=3){let m=d.children[h];for(;f<l.length&&l[f]<m;)f+=3;l.splice(f,0,d.children[h],d.children[h+1],d.children[h+2])}}return new Ie(e.sort(Ti),l)}function uS(t,e){if(!e||!t.length)return t;let s=[];for(let n=0;n<t.length;n++){let i=t[n];s.push(new kt(i.from+e,i.to+e,i.type))}return s}function A8(t,e,s,n,i,a,o){function l(c,u){for(let d=0;d<c.local.length;d++){let h=c.local[d].map(n,i,u);h?s.push(h):o.onRemove&&o.onRemove(c.local[d].spec)}for(let d=0;d<c.children.length;d+=3)l(c.children[d+2],c.children[d]+u+1)}for(let c=0;c<t.length;c+=3)t[c+1]==-1&&l(t[c+2],e[c]+a+1);return s}function dS(t,e,s){if(e.isLeaf)return null;let n=s+e.nodeSize,i=null;for(let a=0,o;a<t.length;a++)(o=t[a])&&o.from>s&&o.to<n&&((i||(i=[])).push(o),t[a]=null);return i}function hS(t){let e=[];for(let s=0;s<t.length;s++)t[s]!=null&&e.push(t[s]);return e}function Hu(t,e,s,n){let i=[],a=!1;e.forEach((l,c)=>{let u=dS(t,l,c+s);if(u){a=!0;let d=Hu(u,l,s+c+1,n);d!=Wt&&i.push(c,c+l.nodeSize,d)}});let o=uS(a?hS(t):t,-s).sort(Ti);for(let l=0;l<o.length;l++)o[l].type.valid(e,o[l])||(n.onRemove&&n.onRemove(o[l].spec),o.splice(l--,1));return o.length||i.length?new Ie(o,i):Wt}function Ti(t,e){return t.from-e.from||t.to-e.to}function Yx(t){let e=t;for(let s=0;s<e.length-1;s++){let n=e[s];if(n.from!=n.to)for(let i=s+1;i<e.length;i++){let a=e[i];if(a.from==n.from){a.to!=n.to&&(e==t&&(e=t.slice()),e[i]=a.copy(a.from,n.to),db(e,i+1,a.copy(n.to,a.to)));continue}else{a.from<n.to&&(e==t&&(e=t.slice()),e[s]=n.copy(n.from,a.from),db(e,i,n.copy(a.from,n.to)));break}}}return e}function db(t,e,s){for(;e<t.length&&Ti(s,t[e])>0;)e++;t.splice(e,0,s)}function _f(t){let e=[];return t.someProp("decorations",s=>{let n=s(t.state);n&&n!=Wt&&e.push(n)}),t.cursorWrapper&&e.push(Ie.create(t.state.doc,[t.cursorWrapper.deco])),Mr.from(e)}const T8={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},E8=bs&&Kr<=11;class D8{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class M8{constructor(e,s){this.view=e,this.handleDOMChange=s,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new D8,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(n=>{for(let i=0;i<n.length;i++)this.queue.push(n[i]);bs&&Kr<=11&&n.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():this.flush()}),E8&&(this.onCharData=n=>{this.queue.push({target:n.target,type:"characterData",oldValue:n.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,T8)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let s=0;s<e.length;s++)this.queue.push(e[s]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(nb(this.view)){if(this.suppressingSelectionUpdates)return or(this.view);if(bs&&Kr<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&qi(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let s=new Set,n;for(let a=e.focusNode;a;a=eo(a))s.add(a);for(let a=e.anchorNode;a;a=eo(a))if(s.has(a)){n=a;break}let i=n&&this.view.docView.nearestDesc(n);if(i&&i.ignoreMutation({type:"selection",target:n.nodeType==3?n.parentNode:n}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let s=this.pendingRecords();s.length&&(this.queue=[]);let n=e.domSelectionRange(),i=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&nb(e)&&!this.ignoreSelectionChange(n),a=-1,o=-1,l=!1,c=[];if(e.editable)for(let d=0;d<s.length;d++){let h=this.registerMutation(s[d],c);h&&(a=a<0?h.from:Math.min(h.from,a),o=o<0?h.to:Math.max(h.to,o),h.typeOver&&(l=!0))}if(Qs&&c.length){let d=c.filter(h=>h.nodeName=="BR");if(d.length==2){let[h,f]=d;h.parentNode&&h.parentNode.parentNode==f.parentNode?f.remove():h.remove()}else{let{focusNode:h}=this.currentSelection;for(let f of d){let m=f.parentNode;m&&m.nodeName=="LI"&&(!h||O8(e,h)!=m)&&f.remove()}}}let u=null;a<0&&i&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&Sh(n)&&(u=Wx(e))&&u.eq(le.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,or(e),this.currentSelection.set(n),e.scrollToSelection()):(a>-1||i)&&(a>-1&&(e.docView.markDirty(a,o),P8(e)),this.handleDOMChange(a,o,l,c),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(n)||or(e),this.currentSelection.set(n))}registerMutation(e,s){if(s.indexOf(e.target)>-1)return null;let n=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(n==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!n||n.ignoreMutation(e))return null;if(e.type=="childList"){for(let d=0;d<e.addedNodes.length;d++){let h=e.addedNodes[d];s.push(h),h.nodeType==3&&(this.lastChangedTextNode=h)}if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(e.target))return{from:n.posBefore,to:n.posAfter};let i=e.previousSibling,a=e.nextSibling;if(bs&&Kr<=11&&e.addedNodes.length)for(let d=0;d<e.addedNodes.length;d++){let{previousSibling:h,nextSibling:f}=e.addedNodes[d];(!h||Array.prototype.indexOf.call(e.addedNodes,h)<0)&&(i=h),(!f||Array.prototype.indexOf.call(e.addedNodes,f)<0)&&(a=f)}let o=i&&i.parentNode==e.target?$t(i)+1:0,l=n.localPosFromDOM(e.target,o,-1),c=a&&a.parentNode==e.target?$t(a):e.target.childNodes.length,u=n.localPosFromDOM(e.target,c,1);return{from:l,to:u}}else return e.type=="attributes"?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:(this.lastChangedTextNode=e.target,{from:n.posAtStart,to:n.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let hb=new WeakMap,fb=!1;function P8(t){if(!hb.has(t)&&(hb.set(t,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)!==-1)){if(t.requiresGeckoHackNode=Qs,fb)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),fb=!0}}function mb(t,e){let s=e.startContainer,n=e.startOffset,i=e.endContainer,a=e.endOffset,o=t.domAtPos(t.state.selection.anchor);return qi(o.node,o.offset,i,a)&&([s,n,i,a]=[i,a,s,n]),{anchorNode:s,anchorOffset:n,focusNode:i,focusOffset:a}}function I8(t,e){if(e.getComposedRanges){let i=e.getComposedRanges(t.root)[0];if(i)return mb(t,i)}let s;function n(i){i.preventDefault(),i.stopImmediatePropagation(),s=i.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",n,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",n,!0),s?mb(t,s):null}function O8(t,e){for(let s=e.parentNode;s&&s!=t.dom;s=s.parentNode){let n=t.docView.nearestDesc(s,!0);if(n&&n.node.isBlock)return s}return null}function R8(t,e,s){let{node:n,fromOffset:i,toOffset:a,from:o,to:l}=t.docView.parseRange(e,s),c=t.domSelectionRange(),u,d=c.anchorNode;if(d&&t.dom.contains(d.nodeType==1?d:d.parentNode)&&(u=[{node:d,offset:c.anchorOffset}],Sh(c)||u.push({node:c.focusNode,offset:c.focusOffset})),Kt&&t.input.lastKeyCode===8)for(let g=a;g>i;g--){let y=n.childNodes[g-1],b=y.pmViewDesc;if(y.nodeName=="BR"&&!b){a=g;break}if(!b||b.size)break}let h=t.state.doc,f=t.someProp("domParser")||ir.fromSchema(t.state.schema),m=h.resolve(o),p=null,x=f.parse(n,{topNode:m.parent,topMatch:m.parent.contentMatchAt(m.index()),topOpen:!0,from:i,to:a,preserveWhitespace:m.parent.type.whitespace=="pre"?"full":!0,findPositions:u,ruleFromNode:L8,context:m});if(u&&u[0].pos!=null){let g=u[0].pos,y=u[1]&&u[1].pos;y==null&&(y=g),p={anchor:g+o,head:y+o}}return{doc:x,sel:p,from:o,to:l}}function L8(t){let e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(us&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let s=document.createElement("div");return s.appendChild(document.createElement("li")),{skip:s}}else if(t.parentNode.lastChild==t||us&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const F8=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function $8(t,e,s,n,i){let a=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let k=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,C=Wx(t,k);if(C&&!t.state.selection.eq(C)){if(Kt&&nr&&t.input.lastKeyCode===13&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",v=>v(t,xi(13,"Enter"))))return;let T=t.state.tr.setSelection(C);k=="pointer"?T.setMeta("pointer",!0):k=="key"&&T.scrollIntoView(),a&&T.setMeta("composition",a),t.dispatch(T)}return}let o=t.state.doc.resolve(e),l=o.sharedDepth(s);e=o.before(l+1),s=t.state.doc.resolve(s).after(l+1);let c=t.state.selection,u=R8(t,e,s),d=t.state.doc,h=d.slice(u.from,u.to),f,m;t.input.lastKeyCode===8&&Date.now()-100<t.input.lastKeyCodeTime?(f=t.state.selection.to,m="end"):(f=t.state.selection.from,m="start"),t.input.lastKeyCode=null;let p=V8(h.content,u.doc.content,u.from,f,m);if(p&&t.input.domChangeCount++,(to&&t.input.lastIOSEnter>Date.now()-225||nr)&&i.some(k=>k.nodeType==1&&!F8.test(k.nodeName))&&(!p||p.endA>=p.endB)&&t.someProp("handleKeyDown",k=>k(t,xi(13,"Enter")))){t.input.lastIOSEnter=0;return}if(!p)if(n&&c instanceof re&&!c.empty&&c.$head.sameParent(c.$anchor)&&!t.composing&&!(u.sel&&u.sel.anchor!=u.sel.head))p={start:c.from,endA:c.to,endB:c.to};else{if(u.sel){let k=pb(t,t.state.doc,u.sel);if(k&&!k.eq(t.state.selection)){let C=t.state.tr.setSelection(k);a&&C.setMeta("composition",a),t.dispatch(C)}}return}t.state.selection.from<t.state.selection.to&&p.start==p.endB&&t.state.selection instanceof re&&(p.start>t.state.selection.from&&p.start<=t.state.selection.from+2&&t.state.selection.from>=u.from?p.start=t.state.selection.from:p.endA<t.state.selection.to&&p.endA>=t.state.selection.to-2&&t.state.selection.to<=u.to&&(p.endB+=t.state.selection.to-p.endA,p.endA=t.state.selection.to)),bs&&Kr<=11&&p.endB==p.start+1&&p.endA==p.start&&p.start>u.from&&u.doc.textBetween(p.start-u.from-1,p.start-u.from+1)=="  "&&(p.start--,p.endA--,p.endB--);let x=u.doc.resolveNoCache(p.start-u.from),g=u.doc.resolveNoCache(p.endB-u.from),y=d.resolve(p.start),b=x.sameParent(g)&&x.parent.inlineContent&&y.end()>=p.endA;if((to&&t.input.lastIOSEnter>Date.now()-225&&(!b||i.some(k=>k.nodeName=="DIV"||k.nodeName=="P"))||!b&&x.pos<u.doc.content.size&&(!x.sameParent(g)||!x.parent.inlineContent)&&x.pos<g.pos&&!/\S/.test(u.doc.textBetween(x.pos,g.pos,"","")))&&t.someProp("handleKeyDown",k=>k(t,xi(13,"Enter")))){t.input.lastIOSEnter=0;return}if(t.state.selection.anchor>p.start&&q8(d,p.start,p.endA,x,g)&&t.someProp("handleKeyDown",k=>k(t,xi(8,"Backspace")))){nr&&Kt&&t.domObserver.suppressSelectionUpdates();return}Kt&&p.endB==p.start&&(t.input.lastChromeDelete=Date.now()),nr&&!b&&x.start()!=g.start()&&g.parentOffset==0&&x.depth==g.depth&&u.sel&&u.sel.anchor==u.sel.head&&u.sel.head==p.endA&&(p.endB-=2,g=u.doc.resolveNoCache(p.endB-u.from),setTimeout(()=>{t.someProp("handleKeyDown",function(k){return k(t,xi(13,"Enter"))})},20));let w=p.start,S=p.endA,z=k=>{let C=k||t.state.tr.replace(w,S,u.doc.slice(p.start-u.from,p.endB-u.from));if(u.sel){let T=pb(t,C.doc,u.sel);T&&!(Kt&&t.composing&&T.empty&&(p.start!=p.endB||t.input.lastChromeDelete<Date.now()-100)&&(T.head==w||T.head==C.mapping.map(S)-1)||bs&&T.empty&&T.head==w)&&C.setSelection(T)}return a&&C.setMeta("composition",a),C.scrollIntoView()},N;if(b)if(x.pos==g.pos){bs&&Kr<=11&&x.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>or(t),20));let k=z(t.state.tr.delete(w,S)),C=d.resolve(p.start).marksAcross(d.resolve(p.endA));C&&k.ensureMarks(C),t.dispatch(k)}else if(p.endA==p.endB&&(N=B8(x.parent.content.cut(x.parentOffset,g.parentOffset),y.parent.content.cut(y.parentOffset,p.endA-y.start())))){let k=z(t.state.tr);N.type=="add"?k.addMark(w,S,N.mark):k.removeMark(w,S,N.mark),t.dispatch(k)}else if(x.parent.child(x.index()).isText&&x.index()==g.index()-(g.textOffset?0:1)){let k=x.parent.textBetween(x.parentOffset,g.parentOffset),C=()=>z(t.state.tr.insertText(k,w,S));t.someProp("handleTextInput",T=>T(t,w,S,k,C))||t.dispatch(C())}else t.dispatch(z());else t.dispatch(z())}function pb(t,e,s){return Math.max(s.anchor,s.head)>e.content.size?null:Kx(t,e.resolve(s.anchor),e.resolve(s.head))}function B8(t,e){let s=t.firstChild.marks,n=e.firstChild.marks,i=s,a=n,o,l,c;for(let d=0;d<n.length;d++)i=n[d].removeFromSet(i);for(let d=0;d<s.length;d++)a=s[d].removeFromSet(a);if(i.length==1&&a.length==0)l=i[0],o="add",c=d=>d.mark(l.addToSet(d.marks));else if(i.length==0&&a.length==1)l=a[0],o="remove",c=d=>d.mark(l.removeFromSet(d.marks));else return null;let u=[];for(let d=0;d<e.childCount;d++)u.push(c(e.child(d)));if(q.from(u).eq(t))return{mark:l,type:o}}function q8(t,e,s,n,i){if(s-e<=i.pos-n.pos||Af(n,!0,!1)<i.pos)return!1;let a=t.resolve(e);if(!n.parent.isTextblock){let l=a.nodeAfter;return l!=null&&s==e+l.nodeSize}if(a.parentOffset<a.parent.content.size||!a.parent.isTextblock)return!1;let o=t.resolve(Af(a,!0,!0));return!o.parent.isTextblock||o.pos>s||Af(o,!0,!1)<s?!1:n.parent.content.cut(n.parentOffset).eq(o.parent.content)}function Af(t,e,s){let n=t.depth,i=e?t.end():t.pos;for(;n>0&&(e||t.indexAfter(n)==t.node(n).childCount);)n--,i++,e=!1;if(s){let a=t.node(n).maybeChild(t.indexAfter(n));for(;a&&!a.isLeaf;)a=a.firstChild,i++}return i}function V8(t,e,s,n,i){let a=t.findDiffStart(e,s);if(a==null)return null;let{a:o,b:l}=t.findDiffEnd(e,s+t.size,s+e.size);if(i=="end"){let c=Math.max(0,a-Math.min(o,l));n-=o+c-a}if(o<a&&t.size<e.size){let c=n<=a&&n>=o?a-n:0;a-=c,a&&a<e.size&&xb(e.textBetween(a-1,a+1))&&(a+=c?1:-1),l=a+(l-o),o=a}else if(l<a){let c=n<=a&&n>=l?a-n:0;a-=c,a&&a<t.size&&xb(t.textBetween(a-1,a+1))&&(a+=c?1:-1),o=a+(o-l),l=a}return{start:a,endA:o,endB:l}}function xb(t){if(t.length!=2)return!1;let e=t.charCodeAt(0),s=t.charCodeAt(1);return e>=56320&&e<=57343&&s>=55296&&s<=56319}class fS{constructor(e,s){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new l8,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=s,this.state=s.state,this.directPlugins=s.plugins||[],this.directPlugins.forEach(wb),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=bb(this),yb(this),this.nodeViews=jb(this),this.docView=Qy(this.state.doc,gb(this),_f(this),this.dom,this),this.domObserver=new M8(this,(n,i,a,o)=>$8(this,n,i,a,o)),this.domObserver.start(),c8(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let s in e)this._props[s]=e[s];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&Xm(this);let s=this._props;this._props=e,e.plugins&&(e.plugins.forEach(wb),this.directPlugins=e.plugins),this.updateStateInner(e.state,s)}setProps(e){let s={};for(let n in this._props)s[n]=this._props[n];s.state=this.state;for(let n in e)s[n]=e[n];this.update(s)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,s){var n;let i=this.state,a=!1,o=!1;e.storedMarks&&this.composing&&(aS(this),o=!0),this.state=e;let l=i.plugins!=e.plugins||this._props.plugins!=s.plugins;if(l||this._props.plugins!=s.plugins||this._props.nodeViews!=s.nodeViews){let m=jb(this);W8(m,this.nodeViews)&&(this.nodeViews=m,a=!0)}(l||s.handleDOMEvents!=this._props.handleDOMEvents)&&Xm(this),this.editable=bb(this),yb(this);let c=_f(this),u=gb(this),d=i.plugins!=e.plugins&&!i.doc.eq(e.doc)?"reset":e.scrollToSelection>i.scrollToSelection?"to selection":"preserve",h=a||!this.docView.matchesNode(e.doc,u,c);(h||!e.selection.eq(i.selection))&&(o=!0);let f=d=="preserve"&&o&&this.dom.style.overflowAnchor==null&&kR(this);if(o){this.domObserver.stop();let m=h&&(bs||Kt)&&!this.composing&&!i.selection.empty&&!e.selection.empty&&U8(i.selection,e.selection);if(h){let p=Kt?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=v8(this)),(a||!this.docView.update(e.doc,u,c,this))&&(this.docView.updateOuterDeco(u),this.docView.destroy(),this.docView=Qy(e.doc,u,c,this.dom,this)),p&&!this.trackWrites&&(m=!0)}m||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&HR(this))?or(this,m):(G2(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(i),!((n=this.dragging)===null||n===void 0)&&n.node&&!i.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,i),d=="reset"?this.dom.scrollTop=0:d=="to selection"?this.scrollToSelection():f&&NR(f)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",s=>s(this)))if(this.state.selection instanceof ne){let s=this.docView.domAfterPos(this.state.selection.from);s.nodeType==1&&Wy(this,s.getBoundingClientRect(),e)}else Wy(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let s=0;s<this.directPlugins.length;s++){let n=this.directPlugins[s];n.spec.view&&this.pluginViews.push(n.spec.view(this))}for(let s=0;s<this.state.plugins.length;s++){let n=this.state.plugins[s];n.spec.view&&this.pluginViews.push(n.spec.view(this))}}else for(let s=0;s<this.pluginViews.length;s++){let n=this.pluginViews[s];n.update&&n.update(this,e)}}updateDraggedNode(e,s){let n=e.node,i=-1;if(this.state.doc.nodeAt(n.from)==n.node)i=n.from;else{let a=n.from+(this.state.doc.content.size-s.doc.content.size);(a>0&&this.state.doc.nodeAt(a))==n.node&&(i=a)}this.dragging=new lS(e.slice,e.move,i<0?void 0:ne.create(this.state.doc,i))}someProp(e,s){let n=this._props&&this._props[e],i;if(n!=null&&(i=s?s(n):n))return i;for(let o=0;o<this.directPlugins.length;o++){let l=this.directPlugins[o].props[e];if(l!=null&&(i=s?s(l):l))return i}let a=this.state.plugins;if(a)for(let o=0;o<a.length;o++){let l=a[o].props[e];if(l!=null&&(i=s?s(l):l))return i}}hasFocus(){if(bs){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&SR(this.dom),or(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let s=this.dom.parentNode;s;s=s.parentNode)if(s.nodeType==9||s.nodeType==11&&s.host)return s.getSelection||(Object.getPrototypeOf(s).getSelection=()=>s.ownerDocument.getSelection()),this._root=s}return e||document}updateRoot(){this._root=null}posAtCoords(e){return TR(this,e)}coordsAtPos(e,s=1){return $2(this,e,s)}domAtPos(e,s=0){return this.docView.domFromPos(e,s)}nodeDOM(e){let s=this.docView.descAt(e);return s?s.nodeDOM:null}posAtDOM(e,s,n=-1){let i=this.docView.posFromDOM(e,s,n);if(i==null)throw new RangeError("DOM position not inside the editor");return i}endOfTextblock(e,s){return IR(this,s||this.state,e)}pasteHTML(e,s){return Ol(this,"",e,!1,s||new ClipboardEvent("paste"))}pasteText(e,s){return Ol(this,e,null,!0,s||new ClipboardEvent("paste"))}serializeForClipboard(e){return Hx(this,e)}destroy(){this.docView&&(u8(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],_f(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,hR())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return h8(this,e)}domSelectionRange(){let e=this.domSelection();return e?us&&this.root.nodeType===11&&gR(this.dom.ownerDocument)==this.dom&&I8(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}fS.prototype.dispatch=function(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))};function gb(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",s=>{if(typeof s=="function"&&(s=s(t.state)),s)for(let n in s)n=="class"?e.class+=" "+s[n]:n=="style"?e.style=(e.style?e.style+";":"")+s[n]:!e[n]&&n!="contenteditable"&&n!="nodeName"&&(e[n]=String(s[n]))}),e.translate||(e.translate="no"),[kt.node(0,t.state.doc.content.size,e)]}function yb(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:kt.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function bb(t){return!t.someProp("editable",e=>e(t.state)===!1)}function U8(t,e){let s=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(s)!=e.$anchor.start(s)}function jb(t){let e=Object.create(null);function s(n){for(let i in n)Object.prototype.hasOwnProperty.call(e,i)||(e[i]=n[i])}return t.someProp("nodeViews",s),t.someProp("markViews",s),e}function W8(t,e){let s=0,n=0;for(let i in t){if(t[i]!=e[i])return!0;s++}for(let i in e)n++;return s!=n}function wb(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var Yr={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Gu={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},K8=typeof navigator<"u"&&/Mac/.test(navigator.platform),H8=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Bt=0;Bt<10;Bt++)Yr[48+Bt]=Yr[96+Bt]=String(Bt);for(var Bt=1;Bt<=24;Bt++)Yr[Bt+111]="F"+Bt;for(var Bt=65;Bt<=90;Bt++)Yr[Bt]=String.fromCharCode(Bt+32),Gu[Bt]=String.fromCharCode(Bt);for(var Tf in Yr)Gu.hasOwnProperty(Tf)||(Gu[Tf]=Yr[Tf]);function G8(t){var e=K8&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||H8&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",s=!e&&t.key||(t.shiftKey?Gu:Yr)[t.keyCode]||t.key||"Unidentified";return s=="Esc"&&(s="Escape"),s=="Del"&&(s="Delete"),s=="Left"&&(s="ArrowLeft"),s=="Up"&&(s="ArrowUp"),s=="Right"&&(s="ArrowRight"),s=="Down"&&(s="ArrowDown"),s}const J8=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),Z8=typeof navigator<"u"&&/Win/.test(navigator.platform);function Q8(t){let e=t.split(/-(?!$)/),s=e[e.length-1];s=="Space"&&(s=" ");let n,i,a,o;for(let l=0;l<e.length-1;l++){let c=e[l];if(/^(cmd|meta|m)$/i.test(c))o=!0;else if(/^a(lt)?$/i.test(c))n=!0;else if(/^(c|ctrl|control)$/i.test(c))i=!0;else if(/^s(hift)?$/i.test(c))a=!0;else if(/^mod$/i.test(c))J8?o=!0:i=!0;else throw new Error("Unrecognized modifier name: "+c)}return n&&(s="Alt-"+s),i&&(s="Ctrl-"+s),o&&(s="Meta-"+s),a&&(s="Shift-"+s),s}function Y8(t){let e=Object.create(null);for(let s in t)e[Q8(s)]=t[s];return e}function Ef(t,e,s=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),s&&e.shiftKey&&(t="Shift-"+t),t}function X8(t){return new $e({props:{handleKeyDown:Xx(t)}})}function Xx(t){let e=Y8(t);return function(s,n){let i=G8(n),a,o=e[Ef(i,n)];if(o&&o(s.state,s.dispatch,s))return!0;if(i.length==1&&i!=" "){if(n.shiftKey){let l=e[Ef(i,n,!1)];if(l&&l(s.state,s.dispatch,s))return!0}if((n.altKey||n.metaKey||n.ctrlKey)&&!(Z8&&n.ctrlKey&&n.altKey)&&(a=Yr[n.keyCode])&&a!=i){let l=e[Ef(a,n)];if(l&&l(s.state,s.dispatch,s))return!0}}return!1}}const eg=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function mS(t,e){let{$cursor:s}=t.selection;return!s||(e?!e.endOfTextblock("backward",t):s.parentOffset>0)?null:s}const pS=(t,e,s)=>{let n=mS(t,s);if(!n)return!1;let i=tg(n);if(!i){let o=n.blockRange(),l=o&&wo(o);return l==null?!1:(e&&e(t.tr.lift(o,l).scrollIntoView()),!0)}let a=i.nodeBefore;if(NS(t,i,e,-1))return!0;if(n.parent.content.size==0&&(so(a,"end")||ne.isSelectable(a)))for(let o=n.depth;;o--){let l=kh(t.doc,n.before(o),n.after(o),Q.empty);if(l&&l.slice.size<l.to-l.from){if(e){let c=t.tr.step(l);c.setSelection(so(a,"end")?le.findFrom(c.doc.resolve(c.mapping.map(i.pos,-1)),-1):ne.create(c.doc,i.pos-a.nodeSize)),e(c.scrollIntoView())}return!0}if(o==1||n.node(o-1).childCount>1)break}return a.isAtom&&i.depth==n.depth-1?(e&&e(t.tr.delete(i.pos-a.nodeSize,i.pos).scrollIntoView()),!0):!1},eL=(t,e,s)=>{let n=mS(t,s);if(!n)return!1;let i=tg(n);return i?xS(t,i,e):!1},tL=(t,e,s)=>{let n=yS(t,s);if(!n)return!1;let i=sg(n);return i?xS(t,i,e):!1};function xS(t,e,s){let n=e.nodeBefore,i=n,a=e.pos-1;for(;!i.isTextblock;a--){if(i.type.spec.isolating)return!1;let d=i.lastChild;if(!d)return!1;i=d}let o=e.nodeAfter,l=o,c=e.pos+1;for(;!l.isTextblock;c++){if(l.type.spec.isolating)return!1;let d=l.firstChild;if(!d)return!1;l=d}let u=kh(t.doc,a,c,Q.empty);if(!u||u.from!=a||u instanceof _t&&u.slice.size>=c-a)return!1;if(s){let d=t.tr.step(u);d.setSelection(re.create(d.doc,a)),s(d.scrollIntoView())}return!0}function so(t,e,s=!1){for(let n=t;n;n=e=="start"?n.firstChild:n.lastChild){if(n.isTextblock)return!0;if(s&&n.childCount!=1)return!1}return!1}const gS=(t,e,s)=>{let{$head:n,empty:i}=t.selection,a=n;if(!i)return!1;if(n.parent.isTextblock){if(s?!s.endOfTextblock("backward",t):n.parentOffset>0)return!1;a=tg(n)}let o=a&&a.nodeBefore;return!o||!ne.isSelectable(o)?!1:(e&&e(t.tr.setSelection(ne.create(t.doc,a.pos-o.nodeSize)).scrollIntoView()),!0)};function tg(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function yS(t,e){let{$cursor:s}=t.selection;return!s||(e?!e.endOfTextblock("forward",t):s.parentOffset<s.parent.content.size)?null:s}const bS=(t,e,s)=>{let n=yS(t,s);if(!n)return!1;let i=sg(n);if(!i)return!1;let a=i.nodeAfter;if(NS(t,i,e,1))return!0;if(n.parent.content.size==0&&(so(a,"start")||ne.isSelectable(a))){let o=kh(t.doc,n.before(),n.after(),Q.empty);if(o&&o.slice.size<o.to-o.from){if(e){let l=t.tr.step(o);l.setSelection(so(a,"start")?le.findFrom(l.doc.resolve(l.mapping.map(i.pos)),1):ne.create(l.doc,l.mapping.map(i.pos))),e(l.scrollIntoView())}return!0}}return a.isAtom&&i.depth==n.depth-1?(e&&e(t.tr.delete(i.pos,i.pos+a.nodeSize).scrollIntoView()),!0):!1},jS=(t,e,s)=>{let{$head:n,empty:i}=t.selection,a=n;if(!i)return!1;if(n.parent.isTextblock){if(s?!s.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)return!1;a=sg(n)}let o=a&&a.nodeAfter;return!o||!ne.isSelectable(o)?!1:(e&&e(t.tr.setSelection(ne.create(t.doc,a.pos)).scrollIntoView()),!0)};function sg(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let s=t.node(e);if(t.index(e)+1<s.childCount)return t.doc.resolve(t.after(e+1));if(s.type.spec.isolating)break}return null}const sL=(t,e)=>{let s=t.selection,n=s instanceof ne,i;if(n){if(s.node.isTextblock||!ci(t.doc,s.from))return!1;i=s.from}else if(i=vh(t.doc,s.from,-1),i==null)return!1;if(e){let a=t.tr.join(i);n&&a.setSelection(ne.create(a.doc,i-t.doc.resolve(i).nodeBefore.nodeSize)),e(a.scrollIntoView())}return!0},nL=(t,e)=>{let s=t.selection,n;if(s instanceof ne){if(s.node.isTextblock||!ci(t.doc,s.to))return!1;n=s.to}else if(n=vh(t.doc,s.to,1),n==null)return!1;return e&&e(t.tr.join(n).scrollIntoView()),!0},rL=(t,e)=>{let{$from:s,$to:n}=t.selection,i=s.blockRange(n),a=i&&wo(i);return a==null?!1:(e&&e(t.tr.lift(i,a).scrollIntoView()),!0)},wS=(t,e)=>{let{$head:s,$anchor:n}=t.selection;return!s.parent.type.spec.code||!s.sameParent(n)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function ng(t){for(let e=0;e<t.edgeCount;e++){let{type:s}=t.edge(e);if(s.isTextblock&&!s.hasRequiredAttrs())return s}return null}const iL=(t,e)=>{let{$head:s,$anchor:n}=t.selection;if(!s.parent.type.spec.code||!s.sameParent(n))return!1;let i=s.node(-1),a=s.indexAfter(-1),o=ng(i.contentMatchAt(a));if(!o||!i.canReplaceWith(a,a,o))return!1;if(e){let l=s.after(),c=t.tr.replaceWith(l,l,o.createAndFill());c.setSelection(le.near(c.doc.resolve(l),1)),e(c.scrollIntoView())}return!0},vS=(t,e)=>{let s=t.selection,{$from:n,$to:i}=s;if(s instanceof Ps||n.parent.inlineContent||i.parent.inlineContent)return!1;let a=ng(i.parent.contentMatchAt(i.indexAfter()));if(!a||!a.isTextblock)return!1;if(e){let o=(!n.parentOffset&&i.index()<i.parent.childCount?n:i).pos,l=t.tr.insert(o,a.createAndFill());l.setSelection(re.create(l.doc,o+1)),e(l.scrollIntoView())}return!0},kS=(t,e)=>{let{$cursor:s}=t.selection;if(!s||s.parent.content.size)return!1;if(s.depth>1&&s.after()!=s.end(-1)){let a=s.before();if(ar(t.doc,a))return e&&e(t.tr.split(a).scrollIntoView()),!0}let n=s.blockRange(),i=n&&wo(n);return i==null?!1:(e&&e(t.tr.lift(n,i).scrollIntoView()),!0)};function aL(t){return(e,s)=>{let{$from:n,$to:i}=e.selection;if(e.selection instanceof ne&&e.selection.node.isBlock)return!n.parentOffset||!ar(e.doc,n.pos)?!1:(s&&s(e.tr.split(n.pos).scrollIntoView()),!0);if(!n.depth)return!1;let a=[],o,l,c=!1,u=!1;for(let m=n.depth;;m--)if(n.node(m).isBlock){c=n.end(m)==n.pos+(n.depth-m),u=n.start(m)==n.pos-(n.depth-m),l=ng(n.node(m-1).contentMatchAt(n.indexAfter(m-1))),a.unshift(c&&l?{type:l}:null),o=m;break}else{if(m==1)return!1;a.unshift(null)}let d=e.tr;(e.selection instanceof re||e.selection instanceof Ps)&&d.deleteSelection();let h=d.mapping.map(n.pos),f=ar(d.doc,h,a.length,a);if(f||(a[0]=l?{type:l}:null,f=ar(d.doc,h,a.length,a)),!f)return!1;if(d.split(h,a.length,a),!c&&u&&n.node(o).type!=l){let m=d.mapping.map(n.before(o)),p=d.doc.resolve(m);l&&n.node(o-1).canReplaceWith(p.index(),p.index()+1,l)&&d.setNodeMarkup(d.mapping.map(n.before(o)),l)}return s&&s(d.scrollIntoView()),!0}}const oL=aL(),lL=(t,e)=>{let{$from:s,to:n}=t.selection,i,a=s.sharedDepth(n);return a==0?!1:(i=s.before(a),e&&e(t.tr.setSelection(ne.create(t.doc,i))),!0)};function cL(t,e,s){let n=e.nodeBefore,i=e.nodeAfter,a=e.index();return!n||!i||!n.type.compatibleContent(i.type)?!1:!n.content.size&&e.parent.canReplace(a-1,a)?(s&&s(t.tr.delete(e.pos-n.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(a,a+1)||!(i.isTextblock||ci(t.doc,e.pos))?!1:(s&&s(t.tr.join(e.pos).scrollIntoView()),!0)}function NS(t,e,s,n){let i=e.nodeBefore,a=e.nodeAfter,o,l,c=i.type.spec.isolating||a.type.spec.isolating;if(!c&&cL(t,e,s))return!0;let u=!c&&e.parent.canReplace(e.index(),e.index()+1);if(u&&(o=(l=i.contentMatchAt(i.childCount)).findWrapping(a.type))&&l.matchType(o[0]||a.type).validEnd){if(s){let m=e.pos+a.nodeSize,p=q.empty;for(let y=o.length-1;y>=0;y--)p=q.from(o[y].create(null,p));p=q.from(i.copy(p));let x=t.tr.step(new Dt(e.pos-1,m,e.pos,m,new Q(p,1,0),o.length,!0)),g=x.doc.resolve(m+2*o.length);g.nodeAfter&&g.nodeAfter.type==i.type&&ci(x.doc,g.pos)&&x.join(g.pos),s(x.scrollIntoView())}return!0}let d=a.type.spec.isolating||n>0&&c?null:le.findFrom(e,1),h=d&&d.$from.blockRange(d.$to),f=h&&wo(h);if(f!=null&&f>=e.depth)return s&&s(t.tr.lift(h,f).scrollIntoView()),!0;if(u&&so(a,"start",!0)&&so(i,"end")){let m=i,p=[];for(;p.push(m),!m.isTextblock;)m=m.lastChild;let x=a,g=1;for(;!x.isTextblock;x=x.firstChild)g++;if(m.canReplace(m.childCount,m.childCount,x.content)){if(s){let y=q.empty;for(let w=p.length-1;w>=0;w--)y=q.from(p[w].copy(y));let b=t.tr.step(new Dt(e.pos-p.length,e.pos+a.nodeSize,e.pos+g,e.pos+a.nodeSize-g,new Q(y,p.length,0),0,!0));s(b.scrollIntoView())}return!0}}return!1}function SS(t){return function(e,s){let n=e.selection,i=t<0?n.$from:n.$to,a=i.depth;for(;i.node(a).isInline;){if(!a)return!1;a--}return i.node(a).isTextblock?(s&&s(e.tr.setSelection(re.create(e.doc,t<0?i.start(a):i.end(a)))),!0):!1}}const uL=SS(-1),dL=SS(1);function hL(t,e=null){return function(s,n){let{$from:i,$to:a}=s.selection,o=i.blockRange(a),l=o&&Bx(o,t,e);return l?(n&&n(s.tr.wrap(o,l).scrollIntoView()),!0):!1}}function vb(t,e=null){return function(s,n){let i=!1;for(let a=0;a<s.selection.ranges.length&&!i;a++){let{$from:{pos:o},$to:{pos:l}}=s.selection.ranges[a];s.doc.nodesBetween(o,l,(c,u)=>{if(i)return!1;if(!(!c.isTextblock||c.hasMarkup(t,e)))if(c.type==t)i=!0;else{let d=s.doc.resolve(u),h=d.index();i=d.parent.canReplaceWith(h,h+1,t)}})}if(!i)return!1;if(n){let a=s.tr;for(let o=0;o<s.selection.ranges.length;o++){let{$from:{pos:l},$to:{pos:c}}=s.selection.ranges[o];a.setBlockType(l,c,t,e)}n(a.scrollIntoView())}return!0}}function rg(...t){return function(e,s,n){for(let i=0;i<t.length;i++)if(t[i](e,s,n))return!0;return!1}}rg(eg,pS,gS);rg(eg,bS,jS);rg(wS,vS,kS,oL);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function fL(t,e=null){return function(s,n){let{$from:i,$to:a}=s.selection,o=i.blockRange(a);if(!o)return!1;let l=n?s.tr:null;return mL(l,o,t,e)?(n&&n(l.scrollIntoView()),!0):!1}}function mL(t,e,s,n=null){let i=!1,a=e,o=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(s)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let c=o.resolve(e.start-2);a=new Bu(c,c,e.depth),e.endIndex<e.parent.childCount&&(e=new Bu(e.$from,o.resolve(e.$to.end(e.depth)),e.depth)),i=!0}let l=Bx(a,s,n,e);return l?(t&&pL(t,e,l,i,s),!0):!1}function pL(t,e,s,n,i){let a=q.empty;for(let d=s.length-1;d>=0;d--)a=q.from(s[d].type.create(s[d].attrs,a));t.step(new Dt(e.start-(n?2:0),e.end,e.start,e.end,new Q(a,0,0),s.length,!0));let o=0;for(let d=0;d<s.length;d++)s[d].type==i&&(o=d+1);let l=s.length-o,c=e.start+s.length-(n?2:0),u=e.parent;for(let d=e.startIndex,h=e.endIndex,f=!0;d<h;d++,f=!1)!f&&ar(t.doc,c,l)&&(t.split(c,l),c+=2*l),c+=u.child(d).nodeSize;return t}function xL(t){return function(e,s){let{$from:n,$to:i}=e.selection,a=n.blockRange(i,o=>o.childCount>0&&o.firstChild.type==t);return a?s?n.node(a.depth-1).type==t?gL(e,s,t,a):yL(e,s,a):!0:!1}}function gL(t,e,s,n){let i=t.tr,a=n.end,o=n.$to.end(n.depth);a<o&&(i.step(new Dt(a-1,o,a,o,new Q(q.from(s.create(null,n.parent.copy())),1,0),1,!0)),n=new Bu(i.doc.resolve(n.$from.pos),i.doc.resolve(o),n.depth));const l=wo(n);if(l==null)return!1;i.lift(n,l);let c=i.doc.resolve(i.mapping.map(a,-1)-1);return ci(i.doc,c.pos)&&c.nodeBefore.type==c.nodeAfter.type&&i.join(c.pos),e(i.scrollIntoView()),!0}function yL(t,e,s){let n=t.tr,i=s.parent;for(let m=s.end,p=s.endIndex-1,x=s.startIndex;p>x;p--)m-=i.child(p).nodeSize,n.delete(m-1,m+1);let a=n.doc.resolve(s.start),o=a.nodeAfter;if(n.mapping.map(s.end)!=s.start+a.nodeAfter.nodeSize)return!1;let l=s.startIndex==0,c=s.endIndex==i.childCount,u=a.node(-1),d=a.index(-1);if(!u.canReplace(d+(l?0:1),d+1,o.content.append(c?q.empty:q.from(i))))return!1;let h=a.pos,f=h+o.nodeSize;return n.step(new Dt(h-(l?1:0),f+(c?1:0),h+1,f-1,new Q((l?q.empty:q.from(i.copy(q.empty))).append(c?q.empty:q.from(i.copy(q.empty))),l?0:1,c?0:1),l?0:1)),e(n.scrollIntoView()),!0}function bL(t){return function(e,s){let{$from:n,$to:i}=e.selection,a=n.blockRange(i,u=>u.childCount>0&&u.firstChild.type==t);if(!a)return!1;let o=a.startIndex;if(o==0)return!1;let l=a.parent,c=l.child(o-1);if(c.type!=t)return!1;if(s){let u=c.lastChild&&c.lastChild.type==l.type,d=q.from(u?t.create():null),h=new Q(q.from(t.create(null,q.from(l.type.create(null,d)))),u?3:1,0),f=a.start,m=a.end;s(e.tr.step(new Dt(f-(u?3:1),m,f,m,h,1,!0)).scrollIntoView())}return!0}}var jL=Object.defineProperty,CS=(t,e)=>{for(var s in e)jL(t,s,{get:e[s],enumerable:!0})};function _h(t){const{state:e,transaction:s}=t;let{selection:n}=s,{doc:i}=s,{storedMarks:a}=s;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return a},get selection(){return n},get doc(){return i},get tr(){return n=s.selection,i=s.doc,a=s.storedMarks,s}}}var Ah=class{constructor(t){this.editor=t.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=t.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:t,editor:e,state:s}=this,{view:n}=e,{tr:i}=s,a=this.buildProps(i);return Object.fromEntries(Object.entries(t).map(([o,l])=>[o,(...u)=>{const d=l(...u)(a);return!i.getMeta("preventDispatch")&&!this.hasCustomState&&n.dispatch(i),d}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(t,e=!0){const{rawCommands:s,editor:n,state:i}=this,{view:a}=n,o=[],l=!!t,c=t||i.tr,u=()=>(!l&&e&&!c.getMeta("preventDispatch")&&!this.hasCustomState&&a.dispatch(c),o.every(h=>h===!0)),d={...Object.fromEntries(Object.entries(s).map(([h,f])=>[h,(...p)=>{const x=this.buildProps(c,e),g=f(...p)(x);return o.push(g),d}])),run:u};return d}createCan(t){const{rawCommands:e,state:s}=this,n=!1,i=t||s.tr,a=this.buildProps(i,n);return{...Object.fromEntries(Object.entries(e).map(([l,c])=>[l,(...u)=>c(...u)({...a,dispatch:void 0})])),chain:()=>this.createChain(i,n)}}buildProps(t,e=!0){const{rawCommands:s,editor:n,state:i}=this,{view:a}=n,o={tr:t,editor:n,view:a,state:_h({state:i,transaction:t}),dispatch:e?()=>{}:void 0,chain:()=>this.createChain(t,e),can:()=>this.createCan(t),get commands(){return Object.fromEntries(Object.entries(s).map(([l,c])=>[l,(...u)=>c(...u)(o)]))}};return o}},wL=class{constructor(){this.callbacks={}}on(t,e){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e),this}emit(t,...e){const s=this.callbacks[t];return s&&s.forEach(n=>n.apply(this,e)),this}off(t,e){const s=this.callbacks[t];return s&&(e?this.callbacks[t]=s.filter(n=>n!==e):delete this.callbacks[t]),this}once(t,e){const s=(...n)=>{this.off(t,s),e.apply(this,n)};return this.on(t,s)}removeAllListeners(){this.callbacks={}}};function zS(t,e){const s=new qx(t);return e.forEach(n=>{n.steps.forEach(i=>{s.step(i)})}),s}var _S=t=>{const e=t.childNodes;for(let s=e.length-1;s>=0;s-=1){const n=e[s];n.nodeType===3&&n.nodeValue&&/^(\n\s\s|\n)$/.test(n.nodeValue)?t.removeChild(n):n.nodeType===1&&_S(n)}return t};function Lc(t){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${t}</body>`,s=new window.DOMParser().parseFromString(e,"text/html").body;return _S(s)}function Ll(t,e,s){if(t instanceof Wr||t instanceof q)return t;s={slice:!0,parseOptions:{},...s};const n=typeof t=="object"&&t!==null,i=typeof t=="string";if(n)try{if(Array.isArray(t)&&t.length>0)return q.fromArray(t.map(l=>e.nodeFromJSON(l)));const o=e.nodeFromJSON(t);return s.errorOnInvalidContent&&o.check(),o}catch(a){if(s.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:a});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",a),Ll("",e,s)}if(i){if(s.errorOnInvalidContent){let o=!1,l="";const c=new Lx({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:u=>(o=!0,l=typeof u=="string"?u:u.outerHTML,null)}]}})});if(s.slice?ir.fromSchema(c).parseSlice(Lc(t),s.parseOptions):ir.fromSchema(c).parse(Lc(t),s.parseOptions),s.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${l}`)})}const a=ir.fromSchema(e);return s.slice?a.parseSlice(Lc(t),s.parseOptions).content:a.parse(Lc(t),s.parseOptions)}return Ll("",e,s)}function ep(t,e,s={},n={}){return Ll(t,e,{slice:!1,parseOptions:s,errorOnInvalidContent:n.errorOnInvalidContent})}function vL(t){for(let e=0;e<t.edgeCount;e+=1){const{type:s}=t.edge(e);if(s.isTextblock&&!s.hasRequiredAttrs())return s}return null}function kL(t,e,s){const n=[];return t.nodesBetween(e.from,e.to,(i,a)=>{s(i)&&n.push({node:i,pos:a})}),n}function AS(t,e){for(let s=t.depth;s>0;s-=1){const n=t.node(s);if(e(n))return{pos:s>0?t.before(s):0,start:t.start(s),depth:s,node:n}}}function Th(t){return e=>AS(e.$from,t)}function se(t,e,s){return t.config[e]===void 0&&t.parent?se(t.parent,e,s):typeof t.config[e]=="function"?t.config[e].bind({...s,parent:t.parent?se(t.parent,e,s):null}):t.config[e]}function ig(t){return t.map(e=>{const s={name:e.name,options:e.options,storage:e.storage},n=se(e,"addExtensions",s);return n?[e,...ig(n())]:e}).flat(10)}function mc(t,e){const s=ea.fromSchema(e).serializeFragment(t),i=document.implementation.createHTMLDocument().createElement("div");return i.appendChild(s),i.innerHTML}function TS(t){return typeof t=="function"}function Ce(t,e=void 0,...s){return TS(t)?e?t.bind(e)(...s):t(...s):t}function NL(t={}){return Object.keys(t).length===0&&t.constructor===Object}function Fl(t){const e=t.filter(i=>i.type==="extension"),s=t.filter(i=>i.type==="node"),n=t.filter(i=>i.type==="mark");return{baseExtensions:e,nodeExtensions:s,markExtensions:n}}function ES(t){const e=[],{nodeExtensions:s,markExtensions:n}=Fl(t),i=[...s,...n],a={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(o=>{const l={name:o.name,options:o.options,storage:o.storage,extensions:i},c=se(o,"addGlobalAttributes",l);if(!c)return;c().forEach(d=>{d.types.forEach(h=>{Object.entries(d.attributes).forEach(([f,m])=>{e.push({type:h,name:f,attribute:{...a,...m}})})})})}),i.forEach(o=>{const l={name:o.name,options:o.options,storage:o.storage},c=se(o,"addAttributes",l);if(!c)return;const u=c();Object.entries(u).forEach(([d,h])=>{const f={...a,...h};typeof f?.default=="function"&&(f.default=f.default()),f?.isRequired&&f?.default===void 0&&delete f.default,e.push({type:o.name,name:d,attribute:f})})}),e}function Ye(...t){return t.filter(e=>!!e).reduce((e,s)=>{const n={...e};return Object.entries(s).forEach(([i,a])=>{if(!n[i]){n[i]=a;return}if(i==="class"){const l=a?String(a).split(" "):[],c=n[i]?n[i].split(" "):[],u=l.filter(d=>!c.includes(d));n[i]=[...c,...u].join(" ")}else if(i==="style"){const l=a?a.split(";").map(d=>d.trim()).filter(Boolean):[],c=n[i]?n[i].split(";").map(d=>d.trim()).filter(Boolean):[],u=new Map;c.forEach(d=>{const[h,f]=d.split(":").map(m=>m.trim());u.set(h,f)}),l.forEach(d=>{const[h,f]=d.split(":").map(m=>m.trim());u.set(h,f)}),n[i]=Array.from(u.entries()).map(([d,h])=>`${d}: ${h}`).join("; ")}else n[i]=a}),n},{})}function Ju(t,e){return e.filter(s=>s.type===t.type.name).filter(s=>s.attribute.rendered).map(s=>s.attribute.renderHTML?s.attribute.renderHTML(t.attrs)||{}:{[s.name]:t.attrs[s.name]}).reduce((s,n)=>Ye(s,n),{})}function SL(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function kb(t,e){return"style"in t?t:{...t,getAttrs:s=>{const n=t.getAttrs?t.getAttrs(s):t.attrs;if(n===!1)return!1;const i=e.reduce((a,o)=>{const l=o.attribute.parseHTML?o.attribute.parseHTML(s):SL(s.getAttribute(o.name));return l==null?a:{...a,[o.name]:l}},{});return{...n,...i}}}}function Nb(t){return Object.fromEntries(Object.entries(t).filter(([e,s])=>e==="attrs"&&NL(s)?!1:s!=null))}function CL(t,e){var s;const n=ES(t),{nodeExtensions:i,markExtensions:a}=Fl(t),o=(s=i.find(u=>se(u,"topNode")))==null?void 0:s.name,l=Object.fromEntries(i.map(u=>{const d=n.filter(y=>y.type===u.name),h={name:u.name,options:u.options,storage:u.storage,editor:e},f=t.reduce((y,b)=>{const w=se(b,"extendNodeSchema",h);return{...y,...w?w(u):{}}},{}),m=Nb({...f,content:Ce(se(u,"content",h)),marks:Ce(se(u,"marks",h)),group:Ce(se(u,"group",h)),inline:Ce(se(u,"inline",h)),atom:Ce(se(u,"atom",h)),selectable:Ce(se(u,"selectable",h)),draggable:Ce(se(u,"draggable",h)),code:Ce(se(u,"code",h)),whitespace:Ce(se(u,"whitespace",h)),linebreakReplacement:Ce(se(u,"linebreakReplacement",h)),defining:Ce(se(u,"defining",h)),isolating:Ce(se(u,"isolating",h)),attrs:Object.fromEntries(d.map(y=>{var b,w;return[y.name,{default:(b=y?.attribute)==null?void 0:b.default,validate:(w=y?.attribute)==null?void 0:w.validate}]}))}),p=Ce(se(u,"parseHTML",h));p&&(m.parseDOM=p.map(y=>kb(y,d)));const x=se(u,"renderHTML",h);x&&(m.toDOM=y=>x({node:y,HTMLAttributes:Ju(y,d)}));const g=se(u,"renderText",h);return g&&(m.toText=g),[u.name,m]})),c=Object.fromEntries(a.map(u=>{const d=n.filter(g=>g.type===u.name),h={name:u.name,options:u.options,storage:u.storage,editor:e},f=t.reduce((g,y)=>{const b=se(y,"extendMarkSchema",h);return{...g,...b?b(u):{}}},{}),m=Nb({...f,inclusive:Ce(se(u,"inclusive",h)),excludes:Ce(se(u,"excludes",h)),group:Ce(se(u,"group",h)),spanning:Ce(se(u,"spanning",h)),code:Ce(se(u,"code",h)),attrs:Object.fromEntries(d.map(g=>{var y,b;return[g.name,{default:(y=g?.attribute)==null?void 0:y.default,validate:(b=g?.attribute)==null?void 0:b.validate}]}))}),p=Ce(se(u,"parseHTML",h));p&&(m.parseDOM=p.map(g=>kb(g,d)));const x=se(u,"renderHTML",h);return x&&(m.toDOM=g=>x({mark:g,HTMLAttributes:Ju(g,d)})),[u.name,m]}));return new Lx({topNode:o,nodes:l,marks:c})}function zL(t){const e=t.filter((s,n)=>t.indexOf(s)!==n);return Array.from(new Set(e))}function ag(t){return t.sort((s,n)=>{const i=se(s,"priority")||100,a=se(n,"priority")||100;return i>a?-1:i<a?1:0})}function DS(t){const e=ag(ig(t)),s=zL(e.map(n=>n.name));return s.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${s.map(n=>`'${n}'`).join(", ")}]. This can lead to issues.`),e}function MS(t,e,s){const{from:n,to:i}=e,{blockSeparator:a=`

`,textSerializers:o={}}=s||{};let l="";return t.nodesBetween(n,i,(c,u,d,h)=>{var f;c.isBlock&&u>n&&(l+=a);const m=o?.[c.type.name];if(m)return d&&(l+=m({node:c,pos:u,parent:d,index:h,range:e})),!1;c.isText&&(l+=(f=c?.text)==null?void 0:f.slice(Math.max(n,u)-u,i-u))}),l}function _L(t,e){const s={from:0,to:t.content.size};return MS(t,s,e)}function PS(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,s])=>[e,s.spec.toText]))}function gr(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}function IS(t,e){const s=gr(e,t.schema),{from:n,to:i,empty:a}=t.selection,o=[];a?(t.storedMarks&&o.push(...t.storedMarks),o.push(...t.selection.$head.marks())):t.doc.nodesBetween(n,i,c=>{o.push(...c.marks)});const l=o.find(c=>c.type.name===s.name);return l?{...l.attrs}:{}}function jt(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}function AL(t,e){const s=jt(e,t.schema),{from:n,to:i}=t.selection,a=[];t.doc.nodesBetween(n,i,l=>{a.push(l)});const o=a.reverse().find(l=>l.type.name===s.name);return o?{...o.attrs}:{}}function Eh(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function OS(t,e){const s=Eh(typeof e=="string"?e:e.name,t.schema);return s==="node"?AL(t,e):s==="mark"?IS(t,e):{}}function TL(t,e=JSON.stringify){const s={};return t.filter(n=>{const i=e(n);return Object.prototype.hasOwnProperty.call(s,i)?!1:s[i]=!0})}function EL(t){const e=TL(t);return e.length===1?e:e.filter((s,n)=>!e.filter((a,o)=>o!==n).some(a=>s.oldRange.from>=a.oldRange.from&&s.oldRange.to<=a.oldRange.to&&s.newRange.from>=a.newRange.from&&s.newRange.to<=a.newRange.to))}function RS(t){const{mapping:e,steps:s}=t,n=[];return e.maps.forEach((i,a)=>{const o=[];if(i.ranges.length)i.forEach((l,c)=>{o.push({from:l,to:c})});else{const{from:l,to:c}=s[a];if(l===void 0||c===void 0)return;o.push({from:l,to:c})}o.forEach(({from:l,to:c})=>{const u=e.slice(a).map(l,-1),d=e.slice(a).map(c),h=e.invert().map(u,-1),f=e.invert().map(d);n.push({oldRange:{from:h,to:f},newRange:{from:u,to:d}})})}),EL(n)}function og(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function Zu(t,e,s={strict:!0}){const n=Object.keys(e);return n.length?n.every(i=>s.strict?e[i]===t[i]:og(e[i])?e[i].test(t[i]):e[i]===t[i]):!0}function LS(t,e,s={}){return t.find(n=>n.type===e&&Zu(Object.fromEntries(Object.keys(s).map(i=>[i,n.attrs[i]])),s))}function Sb(t,e,s={}){return!!LS(t,e,s)}function lg(t,e,s){var n;if(!t||!e)return;let i=t.parent.childAfter(t.parentOffset);if((!i.node||!i.node.marks.some(d=>d.type===e))&&(i=t.parent.childBefore(t.parentOffset)),!i.node||!i.node.marks.some(d=>d.type===e)||(s=s||((n=i.node.marks[0])==null?void 0:n.attrs),!LS([...i.node.marks],e,s)))return;let o=i.index,l=t.start()+i.offset,c=o+1,u=l+i.node.nodeSize;for(;o>0&&Sb([...t.parent.child(o-1).marks],e,s);)o-=1,l-=t.parent.child(o).nodeSize;for(;c<t.parent.childCount&&Sb([...t.parent.child(c).marks],e,s);)u+=t.parent.child(c).nodeSize,c+=1;return{from:l,to:u}}function cg(t,e,s){const n=[];return t===e?s.resolve(t).marks().forEach(i=>{const a=s.resolve(t),o=lg(a,i.type);o&&n.push({mark:i,...o})}):s.nodesBetween(t,e,(i,a)=>{!i||i?.nodeSize===void 0||n.push(...i.marks.map(o=>({from:a,to:a+i.nodeSize,mark:o})))}),n}var DL=(t,e,s,n=20)=>{const i=t.doc.resolve(s);let a=n,o=null;for(;a>0&&o===null;){const l=i.node(a);l?.type.name===e?o=l:a-=1}return[o,a]};function Df(t,e){return e.nodes[t]||e.marks[t]||null}function uu(t,e,s){return Object.fromEntries(Object.entries(s).filter(([n])=>{const i=t.find(a=>a.type===e&&a.name===n);return i?i.attribute.keepOnSplit:!1}))}var ML=(t,e=500)=>{let s="";const n=t.parentOffset;return t.parent.nodesBetween(Math.max(0,n-e),n,(i,a,o,l)=>{var c,u;const d=((u=(c=i.type.spec).toText)==null?void 0:u.call(c,{node:i,pos:a,parent:o,index:l}))||i.textContent||"%leaf%";s+=i.isAtom&&!i.isText?d:d.slice(0,Math.max(0,n-a))}),s};function tp(t,e,s={}){const{empty:n,ranges:i}=t.selection,a=e?gr(e,t.schema):null;if(n)return!!(t.storedMarks||t.selection.$from.marks()).filter(h=>a?a.name===h.type.name:!0).find(h=>Zu(h.attrs,s,{strict:!1}));let o=0;const l=[];if(i.forEach(({$from:h,$to:f})=>{const m=h.pos,p=f.pos;t.doc.nodesBetween(m,p,(x,g)=>{if(!x.isText&&!x.marks.length)return;const y=Math.max(m,g),b=Math.min(p,g+x.nodeSize),w=b-y;o+=w,l.push(...x.marks.map(S=>({mark:S,from:y,to:b})))})}),o===0)return!1;const c=l.filter(h=>a?a.name===h.mark.type.name:!0).filter(h=>Zu(h.mark.attrs,s,{strict:!1})).reduce((h,f)=>h+f.to-f.from,0),u=l.filter(h=>a?h.mark.type!==a&&h.mark.type.excludes(a):!0).reduce((h,f)=>h+f.to-f.from,0);return(c>0?c+u:c)>=o}function Xr(t,e,s={}){const{from:n,to:i,empty:a}=t.selection,o=e?jt(e,t.schema):null,l=[];t.doc.nodesBetween(n,i,(h,f)=>{if(h.isText)return;const m=Math.max(n,f),p=Math.min(i,f+h.nodeSize);l.push({node:h,from:m,to:p})});const c=i-n,u=l.filter(h=>o?o.name===h.node.type.name:!0).filter(h=>Zu(h.node.attrs,s,{strict:!1}));return a?!!u.length:u.reduce((h,f)=>h+f.to-f.from,0)>=c}function PL(t,e,s={}){if(!e)return Xr(t,null,s)||tp(t,null,s);const n=Eh(e,t.schema);return n==="node"?Xr(t,e,s):n==="mark"?tp(t,e,s):!1}var IL=(t,e)=>{const{$from:s,$to:n,$anchor:i}=t.selection;if(e){const a=Th(l=>l.type.name===e)(t.selection);if(!a)return!1;const o=t.doc.resolve(a.pos+1);return i.pos+1===o.end()}return!(n.parentOffset<n.parent.nodeSize-2||s.pos!==n.pos)},OL=t=>{const{$from:e,$to:s}=t.selection;return!(e.parentOffset>0||e.pos!==s.pos)};function Cb(t,e){return Array.isArray(e)?e.some(s=>(typeof s=="string"?s:s.name)===t.name):e}function zb(t,e){const{nodeExtensions:s}=Fl(e),n=s.find(o=>o.name===t);if(!n)return!1;const i={name:n.name,options:n.options,storage:n.storage},a=Ce(se(n,"group",i));return typeof a!="string"?!1:a.split(" ").includes("list")}function Dh(t,{checkChildren:e=!0,ignoreWhitespace:s=!1}={}){var n;if(s){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((n=t.text)!=null?n:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let i=!0;return t.content.forEach(a=>{i!==!1&&(Dh(a,{ignoreWhitespace:s,checkChildren:e})||(i=!1))}),i}return!1}function FS(t){return t instanceof ne}function $S(t){return t instanceof re}function ki(t=0,e=0,s=0){return Math.min(Math.max(t,e),s)}function BS(t,e=null){if(!e)return null;const s=le.atStart(t),n=le.atEnd(t);if(e==="start"||e===!0)return s;if(e==="end")return n;const i=s.from,a=n.to;return e==="all"?re.create(t,ki(0,i,a),ki(t.content.size,i,a)):re.create(t,ki(e,i,a),ki(e,i,a))}function RL(t,e,s){const n=t.steps.length-1;if(n<e)return;const i=t.steps[n];if(!(i instanceof _t||i instanceof Dt))return;const a=t.mapping.maps[n];let o=0;a.forEach((l,c,u,d)=>{o===0&&(o=d)}),t.setSelection(le.near(t.doc.resolve(o),s))}var Mh=class{constructor(t){var e;this.find=t.find,this.handler=t.handler,this.undoable=(e=t.undoable)!=null?e:!0}},LL=(t,e)=>{if(og(e))return e.exec(t);const s=e(t);if(!s)return null;const n=[s.text];return n.index=s.index,n.input=t,n.data=s.data,s.replaceWith&&(s.text.includes(s.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),n.push(s.replaceWith)),n};function Fc(t){var e;const{editor:s,from:n,to:i,text:a,rules:o,plugin:l}=t,{view:c}=s;if(c.composing)return!1;const u=c.state.doc.resolve(n);if(u.parent.type.spec.code||(e=u.nodeBefore||u.nodeAfter)!=null&&e.marks.find(f=>f.type.spec.code))return!1;let d=!1;const h=ML(u)+a;return o.forEach(f=>{if(d)return;const m=LL(h,f.find);if(!m)return;const p=c.state.tr,x=_h({state:c.state,transaction:p}),g={from:n-(m[0].length-a.length),to:i},{commands:y,chain:b,can:w}=new Ah({editor:s,state:x});f.handler({state:x,range:g,match:m,commands:y,chain:b,can:w})===null||!p.steps.length||(f.undoable&&p.setMeta(l,{transform:p,from:n,to:i,text:a}),c.dispatch(p),d=!0)}),d}function FL(t){const{editor:e,rules:s}=t,n=new $e({state:{init(){return null},apply(i,a,o){const l=i.getMeta(n);if(l)return l;const c=i.getMeta("applyInputRules");return!!c&&setTimeout(()=>{let{text:d}=c;typeof d=="string"?d=d:d=mc(q.from(d),o.schema);const{from:h}=c,f=h+d.length;Fc({editor:e,from:h,to:f,text:d,rules:s,plugin:n})}),i.selectionSet||i.docChanged?null:a}},props:{handleTextInput(i,a,o,l){return Fc({editor:e,from:a,to:o,text:l,rules:s,plugin:n})},handleDOMEvents:{compositionend:i=>(setTimeout(()=>{const{$cursor:a}=i.state.selection;a&&Fc({editor:e,from:a.pos,to:a.pos,text:"",rules:s,plugin:n})}),!1)},handleKeyDown(i,a){if(a.key!=="Enter")return!1;const{$cursor:o}=i.state.selection;return o?Fc({editor:e,from:o.pos,to:o.pos,text:`
`,rules:s,plugin:n}):!1}},isInputRules:!0});return n}function $L(t){return Object.prototype.toString.call(t).slice(8,-1)}function $c(t){return $L(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function qS(t,e){const s={...t};return $c(t)&&$c(e)&&Object.keys(e).forEach(n=>{$c(e[n])&&$c(t[n])?s[n]=qS(t[n],e[n]):s[n]=e[n]}),s}var ug=class{constructor(t={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...t},this.name=this.config.name}get options(){return{...Ce(se(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...Ce(se(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(t={}){const e=this.extend({...this.config,addOptions:()=>qS(this.options,t)});return e.name=this.name,e.parent=this.parent,e}extend(t={}){const e=new this.constructor({...this.config,...t});return e.parent=this,this.child=e,e.name="name"in t?t.name:e.parent.name,e}},Ls=class VS extends ug{constructor(){super(...arguments),this.type="mark"}static create(e={}){const s=typeof e=="function"?e():e;return new VS(s)}static handleExit({editor:e,mark:s}){const{tr:n}=e.state,i=e.state.selection.$from;if(i.pos===i.end()){const o=i.marks();if(!!!o.find(u=>u?.type.name===s.name))return!1;const c=o.find(u=>u?.type.name===s.name);return c&&n.removeStoredMark(c),n.insertText(" ",i.pos),e.view.dispatch(n),!0}return!1}configure(e){return super.configure(e)}extend(e){const s=typeof e=="function"?e():e;return super.extend(s)}};function BL(t){return typeof t=="number"}var qL=class{constructor(t){this.find=t.find,this.handler=t.handler}},VL=(t,e,s)=>{if(og(e))return[...t.matchAll(e)];const n=e(t,s);return n?n.map(i=>{const a=[i.text];return a.index=i.index,a.input=t,a.data=i.data,i.replaceWith&&(i.text.includes(i.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),a.push(i.replaceWith)),a}):[]};function UL(t){const{editor:e,state:s,from:n,to:i,rule:a,pasteEvent:o,dropEvent:l}=t,{commands:c,chain:u,can:d}=new Ah({editor:e,state:s}),h=[];return s.doc.nodesBetween(n,i,(m,p)=>{var x,g,y,b,w;if((g=(x=m.type)==null?void 0:x.spec)!=null&&g.code||!(m.isText||m.isTextblock||m.isInline))return;const S=(w=(b=(y=m.content)==null?void 0:y.size)!=null?b:m.nodeSize)!=null?w:0,z=Math.max(n,p),N=Math.min(i,p+S);if(z>=N)return;const k=m.isText?m.text||"":m.textBetween(z-p,N-p,void 0,"￼");VL(k,a.find,o).forEach(T=>{if(T.index===void 0)return;const v=z+T.index+1,_=v+T[0].length,A={from:s.tr.mapping.map(v),to:s.tr.mapping.map(_)},E=a.handler({state:s,range:A,match:T,commands:c,chain:u,can:d,pasteEvent:o,dropEvent:l});h.push(E)})}),h.every(m=>m!==null)}var Bc=null,WL=t=>{var e;const s=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=s.clipboardData)==null||e.setData("text/html",t),s};function KL(t){const{editor:e,rules:s}=t;let n=null,i=!1,a=!1,o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,l;try{l=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{l=null}const c=({state:d,from:h,to:f,rule:m,pasteEvt:p})=>{const x=d.tr,g=_h({state:d,transaction:x});if(!(!UL({editor:e,state:g,from:Math.max(h-1,0),to:f.b-1,rule:m,pasteEvent:p,dropEvent:l})||!x.steps.length)){try{l=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{l=null}return o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,x}};return s.map(d=>new $e({view(h){const f=p=>{var x;n=(x=h.dom.parentElement)!=null&&x.contains(p.target)?h.dom.parentElement:null,n&&(Bc=e)},m=()=>{Bc&&(Bc=null)};return window.addEventListener("dragstart",f),window.addEventListener("dragend",m),{destroy(){window.removeEventListener("dragstart",f),window.removeEventListener("dragend",m)}}},props:{handleDOMEvents:{drop:(h,f)=>{if(a=n===h.dom.parentElement,l=f,!a){const m=Bc;m?.isEditable&&setTimeout(()=>{const p=m.state.selection;p&&m.commands.deleteRange({from:p.from,to:p.to})},10)}return!1},paste:(h,f)=>{var m;const p=(m=f.clipboardData)==null?void 0:m.getData("text/html");return o=f,i=!!p?.includes("data-pm-slice"),!1}}},appendTransaction:(h,f,m)=>{const p=h[0],x=p.getMeta("uiEvent")==="paste"&&!i,g=p.getMeta("uiEvent")==="drop"&&!a,y=p.getMeta("applyPasteRules"),b=!!y;if(!x&&!g&&!b)return;if(b){let{text:z}=y;typeof z=="string"?z=z:z=mc(q.from(z),m.schema);const{from:N}=y,k=N+z.length,C=WL(z);return c({rule:d,state:m,from:N,to:{b:k},pasteEvt:C})}const w=f.doc.content.findDiffStart(m.doc.content),S=f.doc.content.findDiffEnd(m.doc.content);if(!(!BL(w)||!S||w===S.b))return c({rule:d,state:m,from:w,to:S,pasteEvt:o})}}))}var Ph=class{constructor(t,e){this.splittableMarks=[],this.editor=e,this.extensions=DS(t),this.schema=CL(this.extensions,e),this.setupExtensions()}get commands(){return this.extensions.reduce((t,e)=>{const s={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:Df(e.name,this.schema)},n=se(e,"addCommands",s);return n?{...t,...n()}:t},{})}get plugins(){const{editor:t}=this;return ag([...this.extensions].reverse()).flatMap(n=>{const i={name:n.name,options:n.options,storage:this.editor.extensionStorage[n.name],editor:t,type:Df(n.name,this.schema)},a=[],o=se(n,"addKeyboardShortcuts",i);let l={};if(n.type==="mark"&&se(n,"exitable",i)&&(l.ArrowRight=()=>Ls.handleExit({editor:t,mark:n})),o){const f=Object.fromEntries(Object.entries(o()).map(([m,p])=>[m,()=>p({editor:t})]));l={...l,...f}}const c=X8(l);a.push(c);const u=se(n,"addInputRules",i);if(Cb(n,t.options.enableInputRules)&&u){const f=u();if(f&&f.length){const m=FL({editor:t,rules:f}),p=Array.isArray(m)?m:[m];a.push(...p)}}const d=se(n,"addPasteRules",i);if(Cb(n,t.options.enablePasteRules)&&d){const f=d();if(f&&f.length){const m=KL({editor:t,rules:f});a.push(...m)}}const h=se(n,"addProseMirrorPlugins",i);if(h){const f=h();a.push(...f)}return a})}get attributes(){return ES(this.extensions)}get nodeViews(){const{editor:t}=this,{nodeExtensions:e}=Fl(this.extensions);return Object.fromEntries(e.filter(s=>!!se(s,"addNodeView")).map(s=>{const n=this.attributes.filter(l=>l.type===s.name),i={name:s.name,options:s.options,storage:this.editor.extensionStorage[s.name],editor:t,type:jt(s.name,this.schema)},a=se(s,"addNodeView",i);if(!a)return[];const o=(l,c,u,d,h)=>{const f=Ju(l,n);return a()({node:l,view:c,getPos:u,decorations:d,innerDecorations:h,editor:t,extension:s,HTMLAttributes:f})};return[s.name,o]}))}get markViews(){const{editor:t}=this,{markExtensions:e}=Fl(this.extensions);return Object.fromEntries(e.filter(s=>!!se(s,"addMarkView")).map(s=>{const n=this.attributes.filter(l=>l.type===s.name),i={name:s.name,options:s.options,storage:this.editor.extensionStorage[s.name],editor:t,type:gr(s.name,this.schema)},a=se(s,"addMarkView",i);if(!a)return[];const o=(l,c,u)=>{const d=Ju(l,n);return a()({mark:l,view:c,inline:u,editor:t,extension:s,HTMLAttributes:d,updateAttributes:h=>{o9(l,t,h)}})};return[s.name,o]}))}setupExtensions(){const t=this.extensions;this.editor.extensionStorage=Object.fromEntries(t.map(e=>[e.name,e.storage])),t.forEach(e=>{var s;const n={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:Df(e.name,this.schema)};e.type==="mark"&&((s=Ce(se(e,"keepOnSplit",n)))==null||s)&&this.splittableMarks.push(e.name);const i=se(e,"onBeforeCreate",n),a=se(e,"onCreate",n),o=se(e,"onUpdate",n),l=se(e,"onSelectionUpdate",n),c=se(e,"onTransaction",n),u=se(e,"onFocus",n),d=se(e,"onBlur",n),h=se(e,"onDestroy",n);i&&this.editor.on("beforeCreate",i),a&&this.editor.on("create",a),o&&this.editor.on("update",o),l&&this.editor.on("selectionUpdate",l),c&&this.editor.on("transaction",c),u&&this.editor.on("focus",u),d&&this.editor.on("blur",d),h&&this.editor.on("destroy",h)})}};Ph.resolve=DS;Ph.sort=ag;Ph.flatten=ig;var US={};CS(US,{ClipboardTextSerializer:()=>KS,Commands:()=>JS,Delete:()=>ZS,Drop:()=>QS,Editable:()=>YS,FocusEvents:()=>eC,Keymap:()=>tC,Paste:()=>sC,Tabindex:()=>nC,focusEventsPluginKey:()=>XS});var qe=class WS extends ug{constructor(){super(...arguments),this.type="extension"}static create(e={}){const s=typeof e=="function"?e():e;return new WS(s)}configure(e){return super.configure(e)}extend(e){const s=typeof e=="function"?e():e;return super.extend(s)}},KS=qe.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new $e({key:new ct("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:s}=t,{doc:n,selection:i}=e,{ranges:a}=i,o=Math.min(...a.map(d=>d.$from.pos)),l=Math.max(...a.map(d=>d.$to.pos)),c=PS(s);return MS(n,{from:o,to:l},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:c})}}})]}}),HS={};CS(HS,{blur:()=>HL,clearContent:()=>GL,clearNodes:()=>JL,command:()=>ZL,createParagraphNear:()=>QL,cut:()=>YL,deleteCurrentNode:()=>XL,deleteNode:()=>eF,deleteRange:()=>tF,deleteSelection:()=>sF,enter:()=>nF,exitCode:()=>rF,extendMarkRange:()=>iF,first:()=>aF,focus:()=>lF,forEach:()=>cF,insertContent:()=>uF,insertContentAt:()=>hF,joinBackward:()=>pF,joinDown:()=>mF,joinForward:()=>xF,joinItemBackward:()=>gF,joinItemForward:()=>yF,joinTextblockBackward:()=>bF,joinTextblockForward:()=>jF,joinUp:()=>fF,keyboardShortcut:()=>vF,lift:()=>kF,liftEmptyBlock:()=>NF,liftListItem:()=>SF,newlineInCode:()=>CF,resetAttributes:()=>zF,scrollIntoView:()=>_F,selectAll:()=>AF,selectNodeBackward:()=>TF,selectNodeForward:()=>EF,selectParentNode:()=>DF,selectTextblockEnd:()=>MF,selectTextblockStart:()=>PF,setContent:()=>IF,setMark:()=>RF,setMeta:()=>LF,setNode:()=>FF,setNodeSelection:()=>$F,setTextSelection:()=>BF,sinkListItem:()=>qF,splitBlock:()=>VF,splitListItem:()=>UF,toggleList:()=>WF,toggleMark:()=>KF,toggleNode:()=>HF,toggleWrap:()=>GF,undoInputRule:()=>JF,unsetAllMarks:()=>ZF,unsetMark:()=>QF,updateAttributes:()=>YF,wrapIn:()=>XF,wrapInList:()=>e9});var HL=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var s;t.isDestroyed||(e.dom.blur(),(s=window?.getSelection())==null||s.removeAllRanges())}),!0),GL=(t=!0)=>({commands:e})=>e.setContent("",{emitUpdate:t}),JL=()=>({state:t,tr:e,dispatch:s})=>{const{selection:n}=e,{ranges:i}=n;return s&&i.forEach(({$from:a,$to:o})=>{t.doc.nodesBetween(a.pos,o.pos,(l,c)=>{if(l.type.isText)return;const{doc:u,mapping:d}=e,h=u.resolve(d.map(c)),f=u.resolve(d.map(c+l.nodeSize)),m=h.blockRange(f);if(!m)return;const p=wo(m);if(l.type.isTextblock){const{defaultType:x}=h.parent.contentMatchAt(h.index());e.setNodeMarkup(m.start,x)}(p||p===0)&&e.lift(m,p)})}),!0},ZL=t=>e=>t(e),QL=()=>({state:t,dispatch:e})=>vS(t,e),YL=(t,e)=>({editor:s,tr:n})=>{const{state:i}=s,a=i.doc.slice(t.from,t.to);n.deleteRange(t.from,t.to);const o=n.mapping.map(e);return n.insert(o,a.content),n.setSelection(new re(n.doc.resolve(Math.max(o-1,0)))),!0},XL=()=>({tr:t,dispatch:e})=>{const{selection:s}=t,n=s.$anchor.node();if(n.content.size>0)return!1;const i=t.selection.$anchor;for(let a=i.depth;a>0;a-=1)if(i.node(a).type===n.type){if(e){const l=i.before(a),c=i.after(a);t.delete(l,c).scrollIntoView()}return!0}return!1},eF=t=>({tr:e,state:s,dispatch:n})=>{const i=jt(t,s.schema),a=e.selection.$anchor;for(let o=a.depth;o>0;o-=1)if(a.node(o).type===i){if(n){const c=a.before(o),u=a.after(o);e.delete(c,u).scrollIntoView()}return!0}return!1},tF=t=>({tr:e,dispatch:s})=>{const{from:n,to:i}=t;return s&&e.delete(n,i),!0},sF=()=>({state:t,dispatch:e})=>eg(t,e),nF=()=>({commands:t})=>t.keyboardShortcut("Enter"),rF=()=>({state:t,dispatch:e})=>iL(t,e),iF=(t,e={})=>({tr:s,state:n,dispatch:i})=>{const a=gr(t,n.schema),{doc:o,selection:l}=s,{$from:c,from:u,to:d}=l;if(i){const h=lg(c,a,e);if(h&&h.from<=u&&h.to>=d){const f=re.create(o,h.from,h.to);s.setSelection(f)}}return!0},aF=t=>e=>{const s=typeof t=="function"?t(e):t;for(let n=0;n<s.length;n+=1)if(s[n](e))return!0;return!1};function oF(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function dg(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var lF=(t=null,e={})=>({editor:s,view:n,tr:i,dispatch:a})=>{e={scrollIntoView:!0,...e};const o=()=>{(dg()||oF())&&n.dom.focus(),requestAnimationFrame(()=>{s.isDestroyed||(n.focus(),e?.scrollIntoView&&s.commands.scrollIntoView())})};if(n.hasFocus()&&t===null||t===!1)return!0;if(a&&t===null&&!$S(s.state.selection))return o(),!0;const l=BS(i.doc,t)||s.state.selection,c=s.state.selection.eq(l);return a&&(c||i.setSelection(l),c&&i.storedMarks&&i.setStoredMarks(i.storedMarks),o()),!0},cF=(t,e)=>s=>t.every((n,i)=>e(n,{...s,index:i})),uF=(t,e)=>({tr:s,commands:n})=>n.insertContentAt({from:s.selection.from,to:s.selection.to},t,e),dF=t=>!("type"in t),hF=(t,e,s)=>({tr:n,dispatch:i,editor:a})=>{var o;if(i){s={parseOptions:a.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...s};let l;const c=g=>{a.emit("contentError",{editor:a,error:g,disableCollaboration:()=>{"collaboration"in a.storage&&typeof a.storage.collaboration=="object"&&a.storage.collaboration&&(a.storage.collaboration.isDisabled=!0)}})},u={preserveWhitespace:"full",...s.parseOptions};if(!s.errorOnInvalidContent&&!a.options.enableContentCheck&&a.options.emitContentError)try{Ll(e,a.schema,{parseOptions:u,errorOnInvalidContent:!0})}catch(g){c(g)}try{l=Ll(e,a.schema,{parseOptions:u,errorOnInvalidContent:(o=s.errorOnInvalidContent)!=null?o:a.options.enableContentCheck})}catch(g){return c(g),!1}let{from:d,to:h}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},f=!0,m=!0;if((dF(l)?l:[l]).forEach(g=>{g.check(),f=f?g.isText&&g.marks.length===0:!1,m=m?g.isBlock:!1}),d===h&&m){const{parent:g}=n.doc.resolve(d);g.isTextblock&&!g.type.spec.code&&!g.childCount&&(d-=1,h+=1)}let x;if(f){if(Array.isArray(e))x=e.map(g=>g.text||"").join("");else if(e instanceof q){let g="";e.forEach(y=>{y.text&&(g+=y.text)}),x=g}else typeof e=="object"&&e&&e.text?x=e.text:x=e;n.insertText(x,d,h)}else{x=l;const g=n.doc.resolve(d),y=g.node(),b=g.parentOffset===0,w=y.isText||y.isTextblock,S=y.content.size>0;b&&w&&S&&(d=Math.max(0,d-1)),n.replaceWith(d,h,x)}s.updateSelection&&RL(n,n.steps.length-1,-1),s.applyInputRules&&n.setMeta("applyInputRules",{from:d,text:x}),s.applyPasteRules&&n.setMeta("applyPasteRules",{from:d,text:x})}return!0},fF=()=>({state:t,dispatch:e})=>sL(t,e),mF=()=>({state:t,dispatch:e})=>nL(t,e),pF=()=>({state:t,dispatch:e})=>pS(t,e),xF=()=>({state:t,dispatch:e})=>bS(t,e),gF=()=>({state:t,dispatch:e,tr:s})=>{try{const n=vh(t.doc,t.selection.$from.pos,-1);return n==null?!1:(s.join(n,2),e&&e(s),!0)}catch{return!1}},yF=()=>({state:t,dispatch:e,tr:s})=>{try{const n=vh(t.doc,t.selection.$from.pos,1);return n==null?!1:(s.join(n,2),e&&e(s),!0)}catch{return!1}},bF=()=>({state:t,dispatch:e})=>eL(t,e),jF=()=>({state:t,dispatch:e})=>tL(t,e);function GS(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function wF(t){const e=t.split(/-(?!$)/);let s=e[e.length-1];s==="Space"&&(s=" ");let n,i,a,o;for(let l=0;l<e.length-1;l+=1){const c=e[l];if(/^(cmd|meta|m)$/i.test(c))o=!0;else if(/^a(lt)?$/i.test(c))n=!0;else if(/^(c|ctrl|control)$/i.test(c))i=!0;else if(/^s(hift)?$/i.test(c))a=!0;else if(/^mod$/i.test(c))dg()||GS()?o=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${c}`)}return n&&(s=`Alt-${s}`),i&&(s=`Ctrl-${s}`),o&&(s=`Meta-${s}`),a&&(s=`Shift-${s}`),s}var vF=t=>({editor:e,view:s,tr:n,dispatch:i})=>{const a=wF(t).split(/-(?!$)/),o=a.find(u=>!["Alt","Ctrl","Meta","Shift"].includes(u)),l=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:a.includes("Alt"),ctrlKey:a.includes("Ctrl"),metaKey:a.includes("Meta"),shiftKey:a.includes("Shift"),bubbles:!0,cancelable:!0}),c=e.captureTransaction(()=>{s.someProp("handleKeyDown",u=>u(s,l))});return c?.steps.forEach(u=>{const d=u.map(n.mapping);d&&i&&n.maybeStep(d)}),!0},kF=(t,e={})=>({state:s,dispatch:n})=>{const i=jt(t,s.schema);return Xr(s,i,e)?rL(s,n):!1},NF=()=>({state:t,dispatch:e})=>kS(t,e),SF=t=>({state:e,dispatch:s})=>{const n=jt(t,e.schema);return xL(n)(e,s)},CF=()=>({state:t,dispatch:e})=>wS(t,e);function _b(t,e){const s=typeof e=="string"?[e]:e;return Object.keys(t).reduce((n,i)=>(s.includes(i)||(n[i]=t[i]),n),{})}var zF=(t,e)=>({tr:s,state:n,dispatch:i})=>{let a=null,o=null;const l=Eh(typeof t=="string"?t:t.name,n.schema);return l?(l==="node"&&(a=jt(t,n.schema)),l==="mark"&&(o=gr(t,n.schema)),i&&s.selection.ranges.forEach(c=>{n.doc.nodesBetween(c.$from.pos,c.$to.pos,(u,d)=>{a&&a===u.type&&s.setNodeMarkup(d,void 0,_b(u.attrs,e)),o&&u.marks.length&&u.marks.forEach(h=>{o===h.type&&s.addMark(d,d+u.nodeSize,o.create(_b(h.attrs,e)))})})}),!0):!1},_F=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),AF=()=>({tr:t,dispatch:e})=>{if(e){const s=new Ps(t.doc);t.setSelection(s)}return!0},TF=()=>({state:t,dispatch:e})=>gS(t,e),EF=()=>({state:t,dispatch:e})=>jS(t,e),DF=()=>({state:t,dispatch:e})=>lL(t,e),MF=()=>({state:t,dispatch:e})=>dL(t,e),PF=()=>({state:t,dispatch:e})=>uL(t,e),IF=(t,{errorOnInvalidContent:e,emitUpdate:s=!0,parseOptions:n={}}={})=>({editor:i,tr:a,dispatch:o,commands:l})=>{const{doc:c}=a;if(n.preserveWhitespace!=="full"){const u=ep(t,i.schema,n,{errorOnInvalidContent:e??i.options.enableContentCheck});return o&&a.replaceWith(0,c.content.size,u).setMeta("preventUpdate",!s),!0}return o&&a.setMeta("preventUpdate",!s),l.insertContentAt({from:0,to:c.content.size},t,{parseOptions:n,errorOnInvalidContent:e??i.options.enableContentCheck})};function OF(t,e,s){var n;const{selection:i}=e;let a=null;if($S(i)&&(a=i.$cursor),a){const l=(n=t.storedMarks)!=null?n:a.marks();return a.parent.type.allowsMarkType(s)&&(!!s.isInSet(l)||!l.some(u=>u.type.excludes(s)))}const{ranges:o}=i;return o.some(({$from:l,$to:c})=>{let u=l.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(s):!1;return t.doc.nodesBetween(l.pos,c.pos,(d,h,f)=>{if(u)return!1;if(d.isInline){const m=!f||f.type.allowsMarkType(s),p=!!s.isInSet(d.marks)||!d.marks.some(x=>x.type.excludes(s));u=m&&p}return!u}),u})}var RF=(t,e={})=>({tr:s,state:n,dispatch:i})=>{const{selection:a}=s,{empty:o,ranges:l}=a,c=gr(t,n.schema);if(i)if(o){const u=IS(n,c);s.addStoredMark(c.create({...u,...e}))}else l.forEach(u=>{const d=u.$from.pos,h=u.$to.pos;n.doc.nodesBetween(d,h,(f,m)=>{const p=Math.max(m,d),x=Math.min(m+f.nodeSize,h);f.marks.find(y=>y.type===c)?f.marks.forEach(y=>{c===y.type&&s.addMark(p,x,c.create({...y.attrs,...e}))}):s.addMark(p,x,c.create(e))})});return OF(n,s,c)},LF=(t,e)=>({tr:s})=>(s.setMeta(t,e),!0),FF=(t,e={})=>({state:s,dispatch:n,chain:i})=>{const a=jt(t,s.schema);let o;return s.selection.$anchor.sameParent(s.selection.$head)&&(o=s.selection.$anchor.parent.attrs),a.isTextblock?i().command(({commands:l})=>vb(a,{...o,...e})(s)?!0:l.clearNodes()).command(({state:l})=>vb(a,{...o,...e})(l,n)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},$F=t=>({tr:e,dispatch:s})=>{if(s){const{doc:n}=e,i=ki(t,0,n.content.size),a=ne.create(n,i);e.setSelection(a)}return!0},BF=t=>({tr:e,dispatch:s})=>{if(s){const{doc:n}=e,{from:i,to:a}=typeof t=="number"?{from:t,to:t}:t,o=re.atStart(n).from,l=re.atEnd(n).to,c=ki(i,o,l),u=ki(a,o,l),d=re.create(n,c,u);e.setSelection(d)}return!0},qF=t=>({state:e,dispatch:s})=>{const n=jt(t,e.schema);return bL(n)(e,s)};function Ab(t,e){const s=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(s){const n=s.filter(i=>e?.includes(i.type.name));t.tr.ensureMarks(n)}}var VF=({keepMarks:t=!0}={})=>({tr:e,state:s,dispatch:n,editor:i})=>{const{selection:a,doc:o}=e,{$from:l,$to:c}=a,u=i.extensionManager.attributes,d=uu(u,l.node().type.name,l.node().attrs);if(a instanceof ne&&a.node.isBlock)return!l.parentOffset||!ar(o,l.pos)?!1:(n&&(t&&Ab(s,i.extensionManager.splittableMarks),e.split(l.pos).scrollIntoView()),!0);if(!l.parent.isBlock)return!1;const h=c.parentOffset===c.parent.content.size,f=l.depth===0?void 0:vL(l.node(-1).contentMatchAt(l.indexAfter(-1)));let m=h&&f?[{type:f,attrs:d}]:void 0,p=ar(e.doc,e.mapping.map(l.pos),1,m);if(!m&&!p&&ar(e.doc,e.mapping.map(l.pos),1,f?[{type:f}]:void 0)&&(p=!0,m=f?[{type:f,attrs:d}]:void 0),n){if(p&&(a instanceof re&&e.deleteSelection(),e.split(e.mapping.map(l.pos),1,m),f&&!h&&!l.parentOffset&&l.parent.type!==f)){const x=e.mapping.map(l.before()),g=e.doc.resolve(x);l.node(-1).canReplaceWith(g.index(),g.index()+1,f)&&e.setNodeMarkup(e.mapping.map(l.before()),f)}t&&Ab(s,i.extensionManager.splittableMarks),e.scrollIntoView()}return p},UF=(t,e={})=>({tr:s,state:n,dispatch:i,editor:a})=>{var o;const l=jt(t,n.schema),{$from:c,$to:u}=n.selection,d=n.selection.node;if(d&&d.isBlock||c.depth<2||!c.sameParent(u))return!1;const h=c.node(-1);if(h.type!==l)return!1;const f=a.extensionManager.attributes;if(c.parent.content.size===0&&c.node(-1).childCount===c.indexAfter(-1)){if(c.depth===2||c.node(-3).type!==l||c.index(-2)!==c.node(-2).childCount-1)return!1;if(i){let y=q.empty;const b=c.index(-1)?1:c.index(-2)?2:3;for(let C=c.depth-b;C>=c.depth-3;C-=1)y=q.from(c.node(C).copy(y));const w=c.indexAfter(-1)<c.node(-2).childCount?1:c.indexAfter(-2)<c.node(-3).childCount?2:3,S={...uu(f,c.node().type.name,c.node().attrs),...e},z=((o=l.contentMatch.defaultType)==null?void 0:o.createAndFill(S))||void 0;y=y.append(q.from(l.createAndFill(null,z)||void 0));const N=c.before(c.depth-(b-1));s.replace(N,c.after(-w),new Q(y,4-b,0));let k=-1;s.doc.nodesBetween(N,s.doc.content.size,(C,T)=>{if(k>-1)return!1;C.isTextblock&&C.content.size===0&&(k=T+1)}),k>-1&&s.setSelection(re.near(s.doc.resolve(k))),s.scrollIntoView()}return!0}const m=u.pos===c.end()?h.contentMatchAt(0).defaultType:null,p={...uu(f,h.type.name,h.attrs),...e},x={...uu(f,c.node().type.name,c.node().attrs),...e};s.delete(c.pos,u.pos);const g=m?[{type:l,attrs:p},{type:m,attrs:x}]:[{type:l,attrs:p}];if(!ar(s.doc,c.pos,2))return!1;if(i){const{selection:y,storedMarks:b}=n,{splittableMarks:w}=a.extensionManager,S=b||y.$to.parentOffset&&y.$from.marks();if(s.split(c.pos,2,g).scrollIntoView(),!S||!i)return!0;const z=S.filter(N=>w.includes(N.type.name));s.ensureMarks(z)}return!0},Mf=(t,e)=>{const s=Th(o=>o.type===e)(t.selection);if(!s)return!0;const n=t.doc.resolve(Math.max(0,s.pos-1)).before(s.depth);if(n===void 0)return!0;const i=t.doc.nodeAt(n);return s.node.type===i?.type&&ci(t.doc,s.pos)&&t.join(s.pos),!0},Pf=(t,e)=>{const s=Th(o=>o.type===e)(t.selection);if(!s)return!0;const n=t.doc.resolve(s.start).after(s.depth);if(n===void 0)return!0;const i=t.doc.nodeAt(n);return s.node.type===i?.type&&ci(t.doc,n)&&t.join(n),!0},WF=(t,e,s,n={})=>({editor:i,tr:a,state:o,dispatch:l,chain:c,commands:u,can:d})=>{const{extensions:h,splittableMarks:f}=i.extensionManager,m=jt(t,o.schema),p=jt(e,o.schema),{selection:x,storedMarks:g}=o,{$from:y,$to:b}=x,w=y.blockRange(b),S=g||x.$to.parentOffset&&x.$from.marks();if(!w)return!1;const z=Th(N=>zb(N.type.name,h))(x);if(w.depth>=1&&z&&w.depth-z.depth<=1){if(z.node.type===m)return u.liftListItem(p);if(zb(z.node.type.name,h)&&m.validContent(z.node.content)&&l)return c().command(()=>(a.setNodeMarkup(z.pos,m),!0)).command(()=>Mf(a,m)).command(()=>Pf(a,m)).run()}return!s||!S||!l?c().command(()=>d().wrapInList(m,n)?!0:u.clearNodes()).wrapInList(m,n).command(()=>Mf(a,m)).command(()=>Pf(a,m)).run():c().command(()=>{const N=d().wrapInList(m,n),k=S.filter(C=>f.includes(C.type.name));return a.ensureMarks(k),N?!0:u.clearNodes()}).wrapInList(m,n).command(()=>Mf(a,m)).command(()=>Pf(a,m)).run()},KF=(t,e={},s={})=>({state:n,commands:i})=>{const{extendEmptyMarkRange:a=!1}=s,o=gr(t,n.schema);return tp(n,o,e)?i.unsetMark(o,{extendEmptyMarkRange:a}):i.setMark(o,e)},HF=(t,e,s={})=>({state:n,commands:i})=>{const a=jt(t,n.schema),o=jt(e,n.schema),l=Xr(n,a,s);let c;return n.selection.$anchor.sameParent(n.selection.$head)&&(c=n.selection.$anchor.parent.attrs),l?i.setNode(o,c):i.setNode(a,{...c,...s})},GF=(t,e={})=>({state:s,commands:n})=>{const i=jt(t,s.schema);return Xr(s,i,e)?n.lift(i):n.wrapIn(i,e)},JF=()=>({state:t,dispatch:e})=>{const s=t.plugins;for(let n=0;n<s.length;n+=1){const i=s[n];let a;if(i.spec.isInputRules&&(a=i.getState(t))){if(e){const o=t.tr,l=a.transform;for(let c=l.steps.length-1;c>=0;c-=1)o.step(l.steps[c].invert(l.docs[c]));if(a.text){const c=o.doc.resolve(a.from).marks();o.replaceWith(a.from,a.to,t.schema.text(a.text,c))}else o.delete(a.from,a.to)}return!0}}return!1},ZF=()=>({tr:t,dispatch:e})=>{const{selection:s}=t,{empty:n,ranges:i}=s;return n||e&&i.forEach(a=>{t.removeMark(a.$from.pos,a.$to.pos)}),!0},QF=(t,e={})=>({tr:s,state:n,dispatch:i})=>{var a;const{extendEmptyMarkRange:o=!1}=e,{selection:l}=s,c=gr(t,n.schema),{$from:u,empty:d,ranges:h}=l;if(!i)return!0;if(d&&o){let{from:f,to:m}=l;const p=(a=u.marks().find(g=>g.type===c))==null?void 0:a.attrs,x=lg(u,c,p);x&&(f=x.from,m=x.to),s.removeMark(f,m,c)}else h.forEach(f=>{s.removeMark(f.$from.pos,f.$to.pos,c)});return s.removeStoredMark(c),!0},YF=(t,e={})=>({tr:s,state:n,dispatch:i})=>{let a=null,o=null;const l=Eh(typeof t=="string"?t:t.name,n.schema);return l?(l==="node"&&(a=jt(t,n.schema)),l==="mark"&&(o=gr(t,n.schema)),i&&s.selection.ranges.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;let h,f,m,p;s.selection.empty?n.doc.nodesBetween(u,d,(x,g)=>{a&&a===x.type&&(m=Math.max(g,u),p=Math.min(g+x.nodeSize,d),h=g,f=x)}):n.doc.nodesBetween(u,d,(x,g)=>{g<u&&a&&a===x.type&&(m=Math.max(g,u),p=Math.min(g+x.nodeSize,d),h=g,f=x),g>=u&&g<=d&&(a&&a===x.type&&s.setNodeMarkup(g,void 0,{...x.attrs,...e}),o&&x.marks.length&&x.marks.forEach(y=>{if(o===y.type){const b=Math.max(g,u),w=Math.min(g+x.nodeSize,d);s.addMark(b,w,o.create({...y.attrs,...e}))}}))}),f&&(h!==void 0&&s.setNodeMarkup(h,void 0,{...f.attrs,...e}),o&&f.marks.length&&f.marks.forEach(x=>{o===x.type&&s.addMark(m,p,o.create({...x.attrs,...e}))}))}),!0):!1},XF=(t,e={})=>({state:s,dispatch:n})=>{const i=jt(t,s.schema);return hL(i,e)(s,n)},e9=(t,e={})=>({state:s,dispatch:n})=>{const i=jt(t,s.schema);return fL(i,e)(s,n)},JS=qe.create({name:"commands",addCommands(){return{...HS}}}),ZS=qe.create({name:"delete",onUpdate({transaction:t,appendedTransactions:e}){var s,n,i;const a=()=>{var o,l,c,u;if((u=(c=(l=(o=this.editor.options.coreExtensionOptions)==null?void 0:o.delete)==null?void 0:l.filterTransaction)==null?void 0:c.call(l,t))!=null?u:t.getMeta("y-sync$"))return;const d=zS(t.before,[t,...e]);RS(d).forEach(m=>{d.mapping.mapResult(m.oldRange.from).deletedAfter&&d.mapping.mapResult(m.oldRange.to).deletedBefore&&d.before.nodesBetween(m.oldRange.from,m.oldRange.to,(p,x)=>{const g=x+p.nodeSize-2,y=m.oldRange.from<=x&&g<=m.oldRange.to;this.editor.emit("delete",{type:"node",node:p,from:x,to:g,newFrom:d.mapping.map(x),newTo:d.mapping.map(g),deletedRange:m.oldRange,newRange:m.newRange,partial:!y,editor:this.editor,transaction:t,combinedTransform:d})})});const f=d.mapping;d.steps.forEach((m,p)=>{var x,g;if(m instanceof cn){const y=f.slice(p).map(m.from,-1),b=f.slice(p).map(m.to),w=f.invert().map(y,-1),S=f.invert().map(b),z=(x=d.doc.nodeAt(y-1))==null?void 0:x.marks.some(k=>k.eq(m.mark)),N=(g=d.doc.nodeAt(b))==null?void 0:g.marks.some(k=>k.eq(m.mark));this.editor.emit("delete",{type:"mark",mark:m.mark,from:m.from,to:m.to,deletedRange:{from:w,to:S},newRange:{from:y,to:b},partial:!!(N||z),editor:this.editor,transaction:t,combinedTransform:d})}})};(i=(n=(s=this.editor.options.coreExtensionOptions)==null?void 0:s.delete)==null?void 0:n.async)==null||i?setTimeout(a,0):a()}}),QS=qe.create({name:"drop",addProseMirrorPlugins(){return[new $e({key:new ct("tiptapDrop"),props:{handleDrop:(t,e,s,n)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:s,moved:n})}}})]}}),YS=qe.create({name:"editable",addProseMirrorPlugins(){return[new $e({key:new ct("editable"),props:{editable:()=>this.editor.options.editable}})]}}),XS=new ct("focusEvents"),eC=qe.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new $e({key:XS,props:{handleDOMEvents:{focus:(e,s)=>{t.isFocused=!0;const n=t.state.tr.setMeta("focus",{event:s}).setMeta("addToHistory",!1);return e.dispatch(n),!1},blur:(e,s)=>{t.isFocused=!1;const n=t.state.tr.setMeta("blur",{event:s}).setMeta("addToHistory",!1);return e.dispatch(n),!1}}}})]}}),tC=qe.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:l})=>{const{selection:c,doc:u}=l,{empty:d,$anchor:h}=c,{pos:f,parent:m}=h,p=h.parent.isTextblock&&f>0?l.doc.resolve(f-1):h,x=p.parent.type.spec.isolating,g=h.pos-h.parentOffset,y=x&&p.parent.childCount===1?g===h.pos:le.atStart(u).from===f;return!d||!m.type.isTextblock||m.textContent.length||!y||y&&h.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),n={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},i={...n},a={...n,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return dg()||GS()?a:i},addProseMirrorPlugins(){return[new $e({key:new ct("clearDocument"),appendTransaction:(t,e,s)=>{if(t.some(x=>x.getMeta("composition")))return;const n=t.some(x=>x.docChanged)&&!e.doc.eq(s.doc),i=t.some(x=>x.getMeta("preventClearDocument"));if(!n||i)return;const{empty:a,from:o,to:l}=e.selection,c=le.atStart(e.doc).from,u=le.atEnd(e.doc).to;if(a||!(o===c&&l===u)||!Dh(s.doc))return;const f=s.tr,m=_h({state:s,transaction:f}),{commands:p}=new Ah({editor:this.editor,state:m});if(p.clearNodes(),!!f.steps.length)return f}})]}}),sC=qe.create({name:"paste",addProseMirrorPlugins(){return[new $e({key:new ct("tiptapPaste"),props:{handlePaste:(t,e,s)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:s})}}})]}}),nC=qe.create({name:"tabindex",addProseMirrorPlugins(){return[new $e({key:new ct("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),t9=class ga{constructor(e,s,n=!1,i=null){this.currentNode=null,this.actualDepth=null,this.isBlock=n,this.resolvedPos=e,this.editor=s,this.currentNode=i}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!=null?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let s=this.from,n=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You can’t set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}s=this.from+1,n=this.to-1}this.editor.commands.insertContentAt({from:s,to:n},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),s=this.resolvedPos.doc.resolve(e);return new ga(s,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new ga(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new ga(e,this.editor)}get children(){const e=[];return this.node.content.forEach((s,n)=>{const i=s.isBlock&&!s.isTextblock,a=s.isAtom&&!s.isText,o=this.pos+n+(a?0:1);if(o<0||o>this.resolvedPos.doc.nodeSize-2)return;const l=this.resolvedPos.doc.resolve(o);if(!i&&l.depth<=this.depth)return;const c=new ga(l,this.editor,i,i?s:null);i&&(c.actualDepth=this.depth+1),e.push(new ga(l,this.editor,i,i?s:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,s={}){let n=null,i=this.parent;for(;i&&!n;){if(i.node.type.name===e)if(Object.keys(s).length>0){const a=i.node.attrs,o=Object.keys(s);for(let l=0;l<o.length;l+=1){const c=o[l];if(a[c]!==s[c])break}}else n=i;i=i.parent}return n}querySelector(e,s={}){return this.querySelectorAll(e,s,!0)[0]||null}querySelectorAll(e,s={},n=!1){let i=[];if(!this.children||this.children.length===0)return i;const a=Object.keys(s);return this.children.forEach(o=>{n&&i.length>0||(o.node.type.name===e&&a.every(c=>s[c]===o.node.attrs[c])&&i.push(o),!(n&&i.length>0)&&(i=i.concat(o.querySelectorAll(e,s,n))))}),i}setAttribute(e){const{tr:s}=this.editor.state;s.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(s)}},s9=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}`;function n9(t,e,s){const n=document.querySelector("style[data-tiptap-style]");if(n!==null)return n;const i=document.createElement("style");return e&&i.setAttribute("nonce",e),i.setAttribute("data-tiptap-style",""),i.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(i),i}var r9=class extends wL{constructor(t={}){super(),this.css=null,this.editorView=null,this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.instanceId=Math.random().toString(36).slice(2,9),this.options={element:typeof document<"u"?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onMount:()=>null,onUnmount:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:n})=>{throw n},onPaste:()=>null,onDrop:()=>null,onDelete:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(t),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("mount",this.options.onMount),this.on("unmount",this.options.onUnmount),this.on("contentError",this.options.onContentError),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:n,slice:i,moved:a})=>this.options.onDrop(n,i,a)),this.on("paste",({event:n,slice:i})=>this.options.onPaste(n,i)),this.on("delete",this.options.onDelete);const e=this.createDoc(),s=BS(e,this.options.autofocus);this.editorState=Ca.create({doc:e,schema:this.schema,selection:s||void 0}),this.options.element&&this.mount(this.options.element)}mount(t){if(typeof document>"u")throw new Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(t),this.emit("mount",{editor:this}),this.css&&!document.head.contains(this.css)&&document.head.appendChild(this.css),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}unmount(){if(this.editorView){const t=this.editorView.dom;t?.editor&&delete t.editor,this.editorView.destroy()}if(this.editorView=null,this.isInitialized=!1,this.css)try{typeof this.css.remove=="function"?this.css.remove():this.css.parentNode&&this.css.parentNode.removeChild(this.css)}catch(t){console.warn("Failed to remove CSS element:",t)}this.css=null,this.emit("unmount",{editor:this})}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&typeof document<"u"&&(this.css=n9(s9,this.options.injectNonce))}setOptions(t={}){this.options={...this.options,...t},!(!this.editorView||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(t,e=!0){this.setOptions({editable:t}),e&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get view(){return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:t=>{this.editorState=t},dispatch:t=>{this.dispatchTransaction(t)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:(t,e)=>{if(this.editorView)return this.editorView[e];if(e==="state")return this.editorState;if(e in t)return Reflect.get(t,e);throw new Error(`[tiptap error]: The editor view is not available. Cannot access view['${e}']. The editor may not be mounted yet.`)}})}get state(){return this.editorView&&(this.editorState=this.view.state),this.editorState}registerPlugin(t,e){const s=TS(e)?e(t,[...this.state.plugins]):[...this.state.plugins,t],n=this.state.reconfigure({plugins:s});return this.view.updateState(n),n}unregisterPlugin(t){if(this.isDestroyed)return;const e=this.state.plugins;let s=e;if([].concat(t).forEach(i=>{const a=typeof i=="string"?`${i}$`:i.key;s=s.filter(o=>!o.key.startsWith(a))}),e.length===s.length)return;const n=this.state.reconfigure({plugins:s});return this.view.updateState(n),n}createExtensionManager(){var t,e;const n=[...this.options.enableCoreExtensions?[YS,KS.configure({blockSeparator:(e=(t=this.options.coreExtensionOptions)==null?void 0:t.clipboardTextSerializer)==null?void 0:e.blockSeparator}),JS,eC,tC,nC,QS,sC,ZS].filter(i=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[i.name]!==!1:!0):[],...this.options.extensions].filter(i=>["extension","node","mark"].includes(i?.type));this.extensionManager=new Ph(n,this)}createCommandManager(){this.commandManager=new Ah({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createDoc(){let t;try{t=ep(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(e){if(!(e instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(e.message))throw e;this.emit("contentError",{editor:this,error:e,disableCollaboration:()=>{"collaboration"in this.storage&&typeof this.storage.collaboration=="object"&&this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(s=>s.name!=="collaboration"),this.createExtensionManager()}}),t=ep(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return t}createView(t){var e;this.editorView=new fS(t,{...this.options.editorProps,attributes:{role:"textbox",...(e=this.options.editorProps)==null?void 0:e.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:this.editorState,markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews});const s=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(s),this.prependClass(),this.injectCSS();const n=this.view.dom;n.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(t){this.isCapturingTransaction=!0,t(),this.isCapturingTransaction=!1;const e=this.capturedTransaction;return this.capturedTransaction=null,e}dispatchTransaction(t){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=t;return}t.steps.forEach(u=>{var d;return(d=this.capturedTransaction)==null?void 0:d.step(u)});return}const{state:e,transactions:s}=this.state.applyTransaction(t),n=!this.state.selection.eq(e.selection),i=s.includes(t),a=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:t,nextState:e}),!i)return;this.view.updateState(e),this.emit("transaction",{editor:this,transaction:t,appendedTransactions:s.slice(1)}),n&&this.emit("selectionUpdate",{editor:this,transaction:t});const o=s.findLast(u=>u.getMeta("focus")||u.getMeta("blur")),l=o?.getMeta("focus"),c=o?.getMeta("blur");l&&this.emit("focus",{editor:this,event:l.event,transaction:o}),c&&this.emit("blur",{editor:this,event:c.event,transaction:o}),!(t.getMeta("preventUpdate")||!s.some(u=>u.docChanged)||a.doc.eq(e.doc))&&this.emit("update",{editor:this,transaction:t,appendedTransactions:s.slice(1)})}getAttributes(t){return OS(this.state,t)}isActive(t,e){const s=typeof t=="string"?t:null,n=typeof t=="string"?e:t;return PL(this.state,s,n)}getJSON(){return this.state.doc.toJSON()}getHTML(){return mc(this.state.doc.content,this.schema)}getText(t){const{blockSeparator:e=`

`,textSerializers:s={}}=t||{};return _L(this.state.doc,{blockSeparator:e,textSerializers:{...PS(this.schema),...s}})}get isEmpty(){return Dh(this.state.doc)}destroy(){this.emit("destroy"),this.unmount(),this.removeAllListeners()}get isDestroyed(){var t,e;return(e=(t=this.editorView)==null?void 0:t.isDestroyed)!=null?e:!0}$node(t,e){var s;return((s=this.$doc)==null?void 0:s.querySelector(t,e))||null}$nodes(t,e){var s;return((s=this.$doc)==null?void 0:s.querySelectorAll(t,e))||null}$pos(t){const e=this.state.doc.resolve(t);return new t9(e,this)}get $doc(){return this.$pos(0)}};function no(t){return new Mh({find:t.find,handler:({state:e,range:s,match:n})=>{const i=Ce(t.getAttributes,void 0,n);if(i===!1||i===null)return null;const{tr:a}=e,o=n[n.length-1],l=n[0];if(o){const c=l.search(/\S/),u=s.from+l.indexOf(o),d=u+o.length;if(cg(s.from,s.to,e.doc).filter(m=>m.mark.type.excluded.find(x=>x===t.type&&x!==m.mark.type)).filter(m=>m.to>u).length)return null;d<s.to&&a.delete(d,s.to),u>s.from&&a.delete(s.from+c,u);const f=s.from+c+o.length;a.addMark(s.from+c,f,t.type.create(i||{})),a.removeStoredMark(t.type)}},undoable:t.undoable})}function i9(t){return new Mh({find:t.find,handler:({state:e,range:s,match:n})=>{const i=Ce(t.getAttributes,void 0,n)||{},{tr:a}=e,o=s.from;let l=s.to;const c=t.type.create(i);if(n[1]){const u=n[0].lastIndexOf(n[1]);let d=o+u;d>l?d=l:l=d+n[1].length;const h=n[0][n[0].length-1];a.insertText(h,o+n[0].length-1),a.replaceWith(d,l,c)}else if(n[0]){const u=t.type.isInline?o:o-1;a.insert(u,t.type.create(i)).delete(a.mapping.map(o),a.mapping.map(l))}a.scrollIntoView()},undoable:t.undoable})}function sp(t){return new Mh({find:t.find,handler:({state:e,range:s,match:n})=>{const i=e.doc.resolve(s.from),a=Ce(t.getAttributes,void 0,n)||{};if(!i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),t.type))return null;e.tr.delete(s.from,s.to).setBlockType(s.from,s.from,t.type,a)},undoable:t.undoable})}function ro(t){return new Mh({find:t.find,handler:({state:e,range:s,match:n,chain:i})=>{const a=Ce(t.getAttributes,void 0,n)||{},o=e.tr.delete(s.from,s.to),c=o.doc.resolve(s.from).blockRange(),u=c&&Bx(c,t.type,a);if(!u)return null;if(o.wrap(c,u),t.keepMarks&&t.editor){const{selection:h,storedMarks:f}=e,{splittableMarks:m}=t.editor.extensionManager,p=f||h.$to.parentOffset&&h.$from.marks();if(p){const x=p.filter(g=>m.includes(g.type.name));o.ensureMarks(x)}}if(t.keepAttributes){const h=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";i().updateAttributes(h,a).run()}const d=o.doc.resolve(s.from-1).nodeBefore;d&&d.type===t.type&&ci(o.doc,s.from-1)&&(!t.joinPredicate||t.joinPredicate(n,d))&&o.join(s.from-1)},undoable:t.undoable})}function a9(t,e){const{selection:s}=t,{$from:n}=s;if(s instanceof ne){const a=n.index();return n.parent.canReplaceWith(a,a+1,e)}let i=n.depth;for(;i>=0;){const a=n.index(i);if(n.node(i).contentMatchAt(a).matchType(e))return!0;i-=1}return!1}function o9(t,e,s={}){const{state:n}=e,{doc:i,tr:a}=n,o=t;i.descendants((l,c)=>{const u=a.mapping.map(c),d=a.mapping.map(c)+l.nodeSize;let h=null;if(l.marks.forEach(m=>{if(m!==o)return!1;h=m}),!h)return;let f=!1;if(Object.keys(s).forEach(m=>{s[m]!==h.attrs[m]&&(f=!0)}),f){const m=t.type.create({...t.attrs,...s});a.removeMark(u,d,t.type),a.addMark(u,d,m)}}),a.docChanged&&e.view.dispatch(a)}var Ne=class rC extends ug{constructor(){super(...arguments),this.type="node"}static create(e={}){const s=typeof e=="function"?e():e;return new rC(s)}configure(e){return super.configure(e)}extend(e){const s=typeof e=="function"?e():e;return super.extend(s)}};function Ui(t){return new qL({find:t.find,handler:({state:e,range:s,match:n,pasteEvent:i})=>{const a=Ce(t.getAttributes,void 0,n,i);if(a===!1||a===null)return null;const{tr:o}=e,l=n[n.length-1],c=n[0];let u=s.to;if(l){const d=c.search(/\S/),h=s.from+c.indexOf(l),f=h+l.length;if(cg(s.from,s.to,e.doc).filter(p=>p.mark.type.excluded.find(g=>g===t.type&&g!==p.mark.type)).filter(p=>p.to>h).length)return null;f<s.to&&o.delete(f,s.to),h>s.from&&o.delete(s.from+d,h),u=s.from+d+l.length,o.addMark(s.from+d,u,t.type.create(a||{})),o.removeStoredMark(t.type)}}})}var If,Tb;function l9(){return Tb||(Tb=1,If=function t(e,s){if(e===s)return!0;if(e&&s&&typeof e=="object"&&typeof s=="object"){if(e.constructor!==s.constructor)return!1;var n,i,a;if(Array.isArray(e)){if(n=e.length,n!=s.length)return!1;for(i=n;i--!==0;)if(!t(e[i],s[i]))return!1;return!0}if(e instanceof Map&&s instanceof Map){if(e.size!==s.size)return!1;for(i of e.entries())if(!s.has(i[0]))return!1;for(i of e.entries())if(!t(i[1],s.get(i[0])))return!1;return!0}if(e instanceof Set&&s instanceof Set){if(e.size!==s.size)return!1;for(i of e.entries())if(!s.has(i[0]))return!1;return!0}if(ArrayBuffer.isView(e)&&ArrayBuffer.isView(s)){if(n=e.length,n!=s.length)return!1;for(i=n;i--!==0;)if(e[i]!==s[i])return!1;return!0}if(e.constructor===RegExp)return e.source===s.source&&e.flags===s.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===s.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===s.toString();if(a=Object.keys(e),n=a.length,n!==Object.keys(s).length)return!1;for(i=n;i--!==0;)if(!Object.prototype.hasOwnProperty.call(s,a[i]))return!1;for(i=n;i--!==0;){var o=a[i];if(!(o==="_owner"&&e.$$typeof)&&!t(e[o],s[o]))return!1}return!0}return e!==e&&s!==s}),If}var c9=l9();const u9=z1(c9);var d9=(...t)=>e=>{t.forEach(s=>{typeof s=="function"?s(e):s&&(s.current=e)})},h9=({contentComponent:t})=>{const e=P1.useSyncExternalStore(t.subscribe,t.getSnapshot,t.getServerSnapshot);return r.jsx(r.Fragment,{children:Object.values(e)})};function f9(){const t=new Set;let e={};return{subscribe(s){return t.add(s),()=>{t.delete(s)}},getSnapshot(){return e},getServerSnapshot(){return e},setRenderer(s,n){e={...e,[s]:Z4.createPortal(n.reactElement,n.element,s)},t.forEach(i=>i())},removeRenderer(s){const n={...e};delete n[s],e=n,t.forEach(i=>i())}}}var m9=class extends ae.Component{constructor(t){var e;super(t),this.editorContentRef=ae.createRef(),this.initialized=!1,this.state={hasContentComponentInitialized:!!((e=t.editor)!=null&&e.contentComponent)}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){const t=this.props.editor;if(t&&!t.isDestroyed&&t.options.element){if(t.contentComponent)return;const e=this.editorContentRef.current;e.append(t.view.dom),t.setOptions({element:e}),t.contentComponent=f9(),this.state.hasContentComponentInitialized||(this.unsubscribeToContentComponent=t.contentComponent.subscribe(()=>{this.setState(s=>s.hasContentComponentInitialized?s:{hasContentComponentInitialized:!0}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent()})),t.createNodeViews(),this.initialized=!0}}componentWillUnmount(){var t;const e=this.props.editor;if(e){this.initialized=!1,e.isDestroyed||e.view.setProps({nodeViews:{}}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent(),e.contentComponent=null;try{if(!((t=e.view.dom)!=null&&t.firstChild))return;const s=document.createElement("div");s.append(e.view.dom),e.setOptions({element:s})}catch{}}}render(){const{editor:t,innerRef:e,...s}=this.props;return r.jsxs(r.Fragment,{children:[r.jsx("div",{ref:d9(e,this.editorContentRef),...s}),t?.contentComponent&&r.jsx(h9,{contentComponent:t.contentComponent})]})}},p9=j.forwardRef((t,e)=>{const s=ae.useMemo(()=>Math.floor(Math.random()*4294967295).toString(),[t.editor]);return ae.createElement(m9,{key:s,innerRef:e,...t})}),x9=ae.memo(p9),g9=typeof window<"u"?j.useLayoutEffect:j.useEffect,y9=class{constructor(t){this.transactionNumber=0,this.lastTransactionNumber=0,this.subscribers=new Set,this.editor=t,this.lastSnapshot={editor:t,transactionNumber:0},this.getSnapshot=this.getSnapshot.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.watch=this.watch.bind(this),this.subscribe=this.subscribe.bind(this)}getSnapshot(){return this.transactionNumber===this.lastTransactionNumber?this.lastSnapshot:(this.lastTransactionNumber=this.transactionNumber,this.lastSnapshot={editor:this.editor,transactionNumber:this.transactionNumber},this.lastSnapshot)}getServerSnapshot(){return{editor:null,transactionNumber:0}}subscribe(t){return this.subscribers.add(t),()=>{this.subscribers.delete(t)}}watch(t){if(this.editor=t,this.editor){const e=()=>{this.transactionNumber+=1,this.subscribers.forEach(n=>n())},s=this.editor;return s.on("transaction",e),()=>{s.off("transaction",e)}}}};function b9(t){var e;const[s]=j.useState(()=>new y9(t.editor)),n=rA.useSyncExternalStoreWithSelector(s.subscribe,s.getSnapshot,s.getServerSnapshot,t.selector,(e=t.equalityFn)!=null?e:u9);return g9(()=>s.watch(t.editor),[t.editor,s]),j.useDebugValue(n),n}var j9=!1,np=typeof window>"u",w9=np||!!(typeof window<"u"&&window.next),v9=class iC{constructor(e){this.editor=null,this.subscriptions=new Set,this.isComponentMounted=!1,this.previousDeps=null,this.instanceId="",this.options=e,this.subscriptions=new Set,this.setEditor(this.getInitialEditor()),this.scheduleDestroy(),this.getEditor=this.getEditor.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.subscribe=this.subscribe.bind(this),this.refreshEditorInstance=this.refreshEditorInstance.bind(this),this.scheduleDestroy=this.scheduleDestroy.bind(this),this.onRender=this.onRender.bind(this),this.createEditor=this.createEditor.bind(this)}setEditor(e){this.editor=e,this.instanceId=Math.random().toString(36).slice(2,9),this.subscriptions.forEach(s=>s())}getInitialEditor(){return this.options.current.immediatelyRender===void 0?np||w9?null:this.createEditor():(this.options.current.immediatelyRender,this.options.current.immediatelyRender?this.createEditor():null)}createEditor(){const e={...this.options.current,onBeforeCreate:(...n)=>{var i,a;return(a=(i=this.options.current).onBeforeCreate)==null?void 0:a.call(i,...n)},onBlur:(...n)=>{var i,a;return(a=(i=this.options.current).onBlur)==null?void 0:a.call(i,...n)},onCreate:(...n)=>{var i,a;return(a=(i=this.options.current).onCreate)==null?void 0:a.call(i,...n)},onDestroy:(...n)=>{var i,a;return(a=(i=this.options.current).onDestroy)==null?void 0:a.call(i,...n)},onFocus:(...n)=>{var i,a;return(a=(i=this.options.current).onFocus)==null?void 0:a.call(i,...n)},onSelectionUpdate:(...n)=>{var i,a;return(a=(i=this.options.current).onSelectionUpdate)==null?void 0:a.call(i,...n)},onTransaction:(...n)=>{var i,a;return(a=(i=this.options.current).onTransaction)==null?void 0:a.call(i,...n)},onUpdate:(...n)=>{var i,a;return(a=(i=this.options.current).onUpdate)==null?void 0:a.call(i,...n)},onContentError:(...n)=>{var i,a;return(a=(i=this.options.current).onContentError)==null?void 0:a.call(i,...n)},onDrop:(...n)=>{var i,a;return(a=(i=this.options.current).onDrop)==null?void 0:a.call(i,...n)},onPaste:(...n)=>{var i,a;return(a=(i=this.options.current).onPaste)==null?void 0:a.call(i,...n)},onDelete:(...n)=>{var i,a;return(a=(i=this.options.current).onDelete)==null?void 0:a.call(i,...n)}};return new r9(e)}getEditor(){return this.editor}getServerSnapshot(){return null}subscribe(e){return this.subscriptions.add(e),()=>{this.subscriptions.delete(e)}}static compareOptions(e,s){return Object.keys(e).every(n=>["onCreate","onBeforeCreate","onDestroy","onUpdate","onTransaction","onFocus","onBlur","onSelectionUpdate","onContentError","onDrop","onPaste"].includes(n)?!0:n==="extensions"&&e.extensions&&s.extensions?e.extensions.length!==s.extensions.length?!1:e.extensions.every((i,a)=>{var o;return i===((o=s.extensions)==null?void 0:o[a])}):e[n]===s[n])}onRender(e){return()=>(this.isComponentMounted=!0,clearTimeout(this.scheduledDestructionTimeout),this.editor&&!this.editor.isDestroyed&&e.length===0?iC.compareOptions(this.options.current,this.editor.options)||this.editor.setOptions({...this.options.current,editable:this.editor.isEditable}):this.refreshEditorInstance(e),()=>{this.isComponentMounted=!1,this.scheduleDestroy()})}refreshEditorInstance(e){if(this.editor&&!this.editor.isDestroyed){if(this.previousDeps===null){this.previousDeps=e;return}if(this.previousDeps.length===e.length&&this.previousDeps.every((n,i)=>n===e[i]))return}this.editor&&!this.editor.isDestroyed&&this.editor.destroy(),this.setEditor(this.createEditor()),this.previousDeps=e}scheduleDestroy(){const e=this.instanceId,s=this.editor;this.scheduledDestructionTimeout=setTimeout(()=>{if(this.isComponentMounted&&this.instanceId===e){s&&s.setOptions(this.options.current);return}s&&!s.isDestroyed&&(s.destroy(),this.instanceId===e&&this.setEditor(null))},1)}};function k9(t={},e=[]){const s=j.useRef(t);s.current=t;const[n]=j.useState(()=>new v9(s)),i=P1.useSyncExternalStore(n.subscribe,n.getEditor,n.getServerSnapshot);return j.useDebugValue(i),j.useEffect(n.onRender(e)),b9({editor:i,selector:({transactionNumber:a})=>t.shouldRerenderOnTransaction===!1||t.shouldRerenderOnTransaction===void 0?null:t.immediatelyRender&&a===0?0:a+1}),i}var N9=j.createContext({editor:null});N9.Consumer;var S9=j.createContext({onDragStart:()=>{},nodeViewContentChildren:void 0,nodeViewContentRef:()=>{}}),C9=()=>j.useContext(S9);ae.forwardRef((t,e)=>{const{onDragStart:s}=C9(),n=t.as||"div";return r.jsx(n,{...t,ref:e,"data-node-view-wrapper":"",onDragStart:s,style:{whiteSpace:"normal",...t.style}})});ae.createContext({markViewContentRef:()=>{}});var Qu=(t,e)=>{if(t==="slot")return 0;if(t instanceof Function)return t(e);const{children:s,...n}=e??{};if(t==="svg")throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[t,n,s]},z9=/^\s*>\s$/,_9=Ne.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return Qu("blockquote",{...Ye(this.options.HTMLAttributes,t),children:Qu("slot",{})})},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[ro({find:z9,type:this.type})]}}),A9=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,T9=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,E9=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,D9=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,M9=Ls.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return Qu("strong",{...Ye(this.options.HTMLAttributes,t),children:Qu("slot",{})})},addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[no({find:A9,type:this.type}),no({find:E9,type:this.type})]},addPasteRules(){return[Ui({find:T9,type:this.type}),Ui({find:D9,type:this.type})]}}),P9=/(^|[^`])`([^`]+)`(?!`)$/,I9=/(^|[^`])`([^`]+)`(?!`)/g,O9=Ls.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",Ye(this.options.HTMLAttributes,t),0]},addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[no({find:P9,type:this.type})]},addPasteRules(){return[Ui({find:I9,type:this.type})]}}),Of=4,R9=/^```([a-z]+)?[\s\n]$/,L9=/^~~~([a-z]+)?[\s\n]$/,F9=Ne.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:Of,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:s}=this.options;if(!s)return null;const a=[...((e=t.firstElementChild)==null?void 0:e.classList)||[]].filter(o=>o.startsWith(s)).map(o=>o.replace(s,""))[0];return a||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",Ye(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,s=e.pos===1;return!t||e.parent.type.name!==this.name?!1:s||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Tab:({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;const s=(e=this.options.tabSize)!=null?e:Of,{state:n}=t,{selection:i}=n,{$from:a,empty:o}=i;if(a.parent.type!==this.type)return!1;const l=" ".repeat(s);return o?t.commands.insertContent(l):t.commands.command(({tr:c})=>{const{from:u,to:d}=i,m=n.doc.textBetween(u,d,`
`,`
`).split(`
`).map(p=>l+p).join(`
`);return c.replaceWith(u,d,n.schema.text(m)),!0})},"Shift-Tab":({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;const s=(e=this.options.tabSize)!=null?e:Of,{state:n}=t,{selection:i}=n,{$from:a,empty:o}=i;return a.parent.type!==this.type?!1:o?t.commands.command(({tr:l})=>{var c;const{pos:u}=a,d=a.start(),h=a.end(),m=n.doc.textBetween(d,h,`
`,`
`).split(`
`);let p=0,x=0;const g=u-d;for(let N=0;N<m.length;N+=1){if(x+m[N].length>=g){p=N;break}x+=m[N].length+1}const b=((c=m[p].match(/^ */))==null?void 0:c[0])||"",w=Math.min(b.length,s);if(w===0)return!0;let S=d;for(let N=0;N<p;N+=1)S+=m[N].length+1;return l.delete(S,S+w),u-S<=w&&l.setSelection(re.create(l.doc,S)),!0}):t.commands.command(({tr:l})=>{const{from:c,to:u}=i,f=n.doc.textBetween(c,u,`
`,`
`).split(`
`).map(m=>{var p;const x=((p=m.match(/^ */))==null?void 0:p[0])||"",g=Math.min(x.length,s);return m.slice(g)}).join(`
`);return l.replaceWith(c,u,n.schema.text(f)),!0})},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:s}=e,{$from:n,empty:i}=s;if(!i||n.parent.type!==this.type)return!1;const a=n.parentOffset===n.parent.nodeSize-2,o=n.parent.textContent.endsWith(`

`);return!a||!o?!1:t.chain().command(({tr:l})=>(l.delete(n.pos-2,n.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:s,doc:n}=e,{$from:i,empty:a}=s;if(!a||i.parent.type!==this.type||!(i.parentOffset===i.parent.nodeSize-2))return!1;const l=i.after();return l===void 0?!1:n.nodeAt(l)?t.commands.command(({tr:u})=>(u.setSelection(le.near(n.resolve(l))),!0)):t.commands.exitCode()}}},addInputRules(){return[sp({find:R9,type:this.type,getAttributes:t=>({language:t[1]})}),sp({find:L9,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new $e({key:new ct("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const s=e.clipboardData.getData("text/plain"),n=e.clipboardData.getData("vscode-editor-data"),i=n?JSON.parse(n):void 0,a=i?.mode;if(!s||!a)return!1;const{tr:o,schema:l}=t.state,c=l.text(s.replace(/\r\n?/g,`
`));return o.replaceSelectionWith(this.type.create({language:a},c)),o.selection.$from.parent.type!==this.type&&o.setSelection(re.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.setMeta("paste",!0),t.dispatch(o),!0}}})]}}),$9=Ne.create({name:"doc",topNode:!0,content:"block+"}),B9=Ne.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",Ye(this.options.HTMLAttributes,t)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:s,editor:n})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:i,storedMarks:a}=s;if(i.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:l}=n.extensionManager,c=a||i.$to.parentOffset&&i.$from.marks();return e().insertContent({type:this.name}).command(({tr:u,dispatch:d})=>{if(d&&c&&o){const h=c.filter(f=>l.includes(f.type.name));u.ensureMarks(h)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),q9=Ne.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,Ye(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>sp({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}}),V9=Ne.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{},nextNodeType:"paragraph"}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",Ye(this.options.HTMLAttributes,t)]},addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!a9(e,e.schema.nodes[this.name]))return!1;const{selection:s}=e,{$to:n}=s,i=t();return FS(s)?i.insertContentAt(n.pos,{type:this.name}):i.insertContent({type:this.name}),i.command(({state:a,tr:o,dispatch:l})=>{if(l){const{$to:c}=o.selection,u=c.end();if(c.nodeAfter)c.nodeAfter.isTextblock?o.setSelection(re.create(o.doc,c.pos+1)):c.nodeAfter.isBlock?o.setSelection(ne.create(o.doc,c.pos)):o.setSelection(re.create(o.doc,c.pos));else{const d=a.schema.nodes[this.options.nextNodeType]||c.parent.type.contentMatch.defaultType,h=d?.create();h&&(o.insert(u,h),o.setSelection(re.create(o.doc,u+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[i9({find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type})]}}),U9=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,W9=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,K9=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,H9=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,G9=Ls.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",Ye(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[no({find:U9,type:this.type}),no({find:K9,type:this.type})]},addPasteRules(){return[Ui({find:W9,type:this.type}),Ui({find:H9,type:this.type})]}});const J9="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mögensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",Z9="ελ1υ2бг1ел3дети4ею2католик6ом3мкд2он1сква6онлайн5рг3рус2ф2сайт3рб3укр3қаз3հայ3ישראל5קום3ابوظبي5رامكو5لاردن4بحرين5جزائر5سعودية6عليان5مغرب5مارات5یران5بارت2زار4يتك3ھارت5تونس4سودان3رية5شبكة4عراق2ب2مان4فلسطين6قطر3كاثوليك6وم3مصر2ليسيا5وريتانيا7قع4همراه5پاکستان7ڀارت4कॉम3नेट3भारत0म्3ोत5संगठन5বাংলা5ভারত2ৰত4ਭਾਰਤ4ભારત4ଭାରତ4இந்தியா6லங்கை6சிங்கப்பூர்11భారత్5ಭಾರತ4ഭാരതം5ලංකා4คอม3ไทย3ລາວ3გე2みんな3アマゾン4クラウド4グーグル4コム2ストア3セール3ファッション6ポイント4世界2中信1国1國1文网3亚马逊3企业2佛山2信息2健康2八卦2公司1益2台湾1灣2商城1店1标2嘉里0大酒店5在线2大拿2天主教3娱乐2家電2广东2微博2慈善2我爱你3手机2招聘2政务1府2新加坡2闻2时尚2書籍2机构2淡马锡3游戏2澳門2点看2移动2组织机构4网址1店1站1络2联通2谷歌2购物2通販2集团2電訊盈科4飞利浦3食品2餐厅2香格里拉3港2닷넷1컴2삼성2한국2",rp="numeric",ip="ascii",ap="alpha",rl="asciinumeric",Ho="alphanumeric",op="domain",aC="emoji",Q9="scheme",Y9="slashscheme",Rf="whitespace";function X9(t,e){return t in e||(e[t]=[]),e[t]}function Ni(t,e,s){e[rp]&&(e[rl]=!0,e[Ho]=!0),e[ip]&&(e[rl]=!0,e[ap]=!0),e[rl]&&(e[Ho]=!0),e[ap]&&(e[Ho]=!0),e[Ho]&&(e[op]=!0),e[aC]&&(e[op]=!0);for(const n in e){const i=X9(n,s);i.indexOf(t)<0&&i.push(t)}}function e$(t,e){const s={};for(const n in e)e[n].indexOf(t)>=0&&(s[n]=!0);return s}function xs(t=null){this.j={},this.jr=[],this.jd=null,this.t=t}xs.groups={};xs.prototype={accepts(){return!!this.t},go(t){const e=this,s=e.j[t];if(s)return s;for(let n=0;n<e.jr.length;n++){const i=e.jr[n][0],a=e.jr[n][1];if(a&&i.test(t))return a}return e.jd},has(t,e=!1){return e?t in this.j:!!this.go(t)},ta(t,e,s,n){for(let i=0;i<t.length;i++)this.tt(t[i],e,s,n)},tr(t,e,s,n){n=n||xs.groups;let i;return e&&e.j?i=e:(i=new xs(e),s&&n&&Ni(e,s,n)),this.jr.push([t,i]),i},ts(t,e,s,n){let i=this;const a=t.length;if(!a)return i;for(let o=0;o<a-1;o++)i=i.tt(t[o]);return i.tt(t[a-1],e,s,n)},tt(t,e,s,n){n=n||xs.groups;const i=this;if(e&&e.j)return i.j[t]=e,e;const a=e;let o,l=i.go(t);if(l?(o=new xs,Object.assign(o.j,l.j),o.jr.push.apply(o.jr,l.jr),o.jd=l.jd,o.t=l.t):o=new xs,a){if(n)if(o.t&&typeof o.t=="string"){const c=Object.assign(e$(o.t,n),s);Ni(a,c,n)}else s&&Ni(a,s,n);o.t=a}return i.j[t]=o,o}};const xe=(t,e,s,n,i)=>t.ta(e,s,n,i),rt=(t,e,s,n,i)=>t.tr(e,s,n,i),Eb=(t,e,s,n,i)=>t.ts(e,s,n,i),H=(t,e,s,n,i)=>t.tt(e,s,n,i),Yn="WORD",lp="UWORD",oC="ASCIINUMERICAL",lC="ALPHANUMERICAL",$l="LOCALHOST",cp="TLD",up="UTLD",du="SCHEME",ya="SLASH_SCHEME",hg="NUM",dp="WS",fg="NL",il="OPENBRACE",al="CLOSEBRACE",Yu="OPENBRACKET",Xu="CLOSEBRACKET",ed="OPENPAREN",td="CLOSEPAREN",sd="OPENANGLEBRACKET",nd="CLOSEANGLEBRACKET",rd="FULLWIDTHLEFTPAREN",id="FULLWIDTHRIGHTPAREN",ad="LEFTCORNERBRACKET",od="RIGHTCORNERBRACKET",ld="LEFTWHITECORNERBRACKET",cd="RIGHTWHITECORNERBRACKET",ud="FULLWIDTHLESSTHAN",dd="FULLWIDTHGREATERTHAN",hd="AMPERSAND",fd="APOSTROPHE",md="ASTERISK",Ar="AT",pd="BACKSLASH",xd="BACKTICK",gd="CARET",Pr="COLON",mg="COMMA",yd="DOLLAR",Nn="DOT",bd="EQUALS",pg="EXCLAMATION",qs="HYPHEN",ol="PERCENT",jd="PIPE",wd="PLUS",vd="POUND",ll="QUERY",xg="QUOTE",cC="FULLWIDTHMIDDLEDOT",gg="SEMI",Sn="SLASH",cl="TILDE",kd="UNDERSCORE",uC="EMOJI",Nd="SYM";var dC=Object.freeze({__proto__:null,ALPHANUMERICAL:lC,AMPERSAND:hd,APOSTROPHE:fd,ASCIINUMERICAL:oC,ASTERISK:md,AT:Ar,BACKSLASH:pd,BACKTICK:xd,CARET:gd,CLOSEANGLEBRACKET:nd,CLOSEBRACE:al,CLOSEBRACKET:Xu,CLOSEPAREN:td,COLON:Pr,COMMA:mg,DOLLAR:yd,DOT:Nn,EMOJI:uC,EQUALS:bd,EXCLAMATION:pg,FULLWIDTHGREATERTHAN:dd,FULLWIDTHLEFTPAREN:rd,FULLWIDTHLESSTHAN:ud,FULLWIDTHMIDDLEDOT:cC,FULLWIDTHRIGHTPAREN:id,HYPHEN:qs,LEFTCORNERBRACKET:ad,LEFTWHITECORNERBRACKET:ld,LOCALHOST:$l,NL:fg,NUM:hg,OPENANGLEBRACKET:sd,OPENBRACE:il,OPENBRACKET:Yu,OPENPAREN:ed,PERCENT:ol,PIPE:jd,PLUS:wd,POUND:vd,QUERY:ll,QUOTE:xg,RIGHTCORNERBRACKET:od,RIGHTWHITECORNERBRACKET:cd,SCHEME:du,SEMI:gg,SLASH:Sn,SLASH_SCHEME:ya,SYM:Nd,TILDE:cl,TLD:cp,UNDERSCORE:kd,UTLD:up,UWORD:lp,WORD:Yn,WS:dp});const Zn=/[a-z]/,Io=/\p{L}/u,Lf=/\p{Emoji}/u,Qn=/\d/,Ff=/\s/,Db="\r",$f=`
`,t$="️",s$="‍",Bf="￼";let qc=null,Vc=null;function n$(t=[]){const e={};xs.groups=e;const s=new xs;qc==null&&(qc=Mb(J9)),Vc==null&&(Vc=Mb(Z9)),H(s,"'",fd),H(s,"{",il),H(s,"}",al),H(s,"[",Yu),H(s,"]",Xu),H(s,"(",ed),H(s,")",td),H(s,"<",sd),H(s,">",nd),H(s,"（",rd),H(s,"）",id),H(s,"「",ad),H(s,"」",od),H(s,"『",ld),H(s,"』",cd),H(s,"＜",ud),H(s,"＞",dd),H(s,"&",hd),H(s,"*",md),H(s,"@",Ar),H(s,"`",xd),H(s,"^",gd),H(s,":",Pr),H(s,",",mg),H(s,"$",yd),H(s,".",Nn),H(s,"=",bd),H(s,"!",pg),H(s,"-",qs),H(s,"%",ol),H(s,"|",jd),H(s,"+",wd),H(s,"#",vd),H(s,"?",ll),H(s,'"',xg),H(s,"/",Sn),H(s,";",gg),H(s,"~",cl),H(s,"_",kd),H(s,"\\",pd),H(s,"・",cC);const n=rt(s,Qn,hg,{[rp]:!0});rt(n,Qn,n);const i=rt(n,Zn,oC,{[rl]:!0}),a=rt(n,Io,lC,{[Ho]:!0}),o=rt(s,Zn,Yn,{[ip]:!0});rt(o,Qn,i),rt(o,Zn,o),rt(i,Qn,i),rt(i,Zn,i);const l=rt(s,Io,lp,{[ap]:!0});rt(l,Zn),rt(l,Qn,a),rt(l,Io,l),rt(a,Qn,a),rt(a,Zn),rt(a,Io,a);const c=H(s,$f,fg,{[Rf]:!0}),u=H(s,Db,dp,{[Rf]:!0}),d=rt(s,Ff,dp,{[Rf]:!0});H(s,Bf,d),H(u,$f,c),H(u,Bf,d),rt(u,Ff,d),H(d,Db),H(d,$f),rt(d,Ff,d),H(d,Bf,d);const h=rt(s,Lf,uC,{[aC]:!0});H(h,"#"),rt(h,Lf,h),H(h,t$,h);const f=H(h,s$);H(f,"#"),rt(f,Lf,h);const m=[[Zn,o],[Qn,i]],p=[[Zn,null],[Io,l],[Qn,a]];for(let x=0;x<qc.length;x++)kr(s,qc[x],cp,Yn,m);for(let x=0;x<Vc.length;x++)kr(s,Vc[x],up,lp,p);Ni(cp,{tld:!0,ascii:!0},e),Ni(up,{utld:!0,alpha:!0},e),kr(s,"file",du,Yn,m),kr(s,"mailto",du,Yn,m),kr(s,"http",ya,Yn,m),kr(s,"https",ya,Yn,m),kr(s,"ftp",ya,Yn,m),kr(s,"ftps",ya,Yn,m),Ni(du,{scheme:!0,ascii:!0},e),Ni(ya,{slashscheme:!0,ascii:!0},e),t=t.sort((x,g)=>x[0]>g[0]?1:-1);for(let x=0;x<t.length;x++){const g=t[x][0],b=t[x][1]?{[Q9]:!0}:{[Y9]:!0};g.indexOf("-")>=0?b[op]=!0:Zn.test(g)?Qn.test(g)?b[rl]=!0:b[ip]=!0:b[rp]=!0,Eb(s,g,g,b)}return Eb(s,"localhost",$l,{ascii:!0}),s.jd=new xs(Nd),{start:s,tokens:Object.assign({groups:e},dC)}}function hC(t,e){const s=r$(e.replace(/[A-Z]/g,l=>l.toLowerCase())),n=s.length,i=[];let a=0,o=0;for(;o<n;){let l=t,c=null,u=0,d=null,h=-1,f=-1;for(;o<n&&(c=l.go(s[o]));)l=c,l.accepts()?(h=0,f=0,d=l):h>=0&&(h+=s[o].length,f++),u+=s[o].length,a+=s[o].length,o++;a-=h,o-=f,u-=h,i.push({t:d.t,v:e.slice(a-u,a),s:a-u,e:a})}return i}function r$(t){const e=[],s=t.length;let n=0;for(;n<s;){let i=t.charCodeAt(n),a,o=i<55296||i>56319||n+1===s||(a=t.charCodeAt(n+1))<56320||a>57343?t[n]:t.slice(n,n+2);e.push(o),n+=o.length}return e}function kr(t,e,s,n,i){let a;const o=e.length;for(let l=0;l<o-1;l++){const c=e[l];t.j[c]?a=t.j[c]:(a=new xs(n),a.jr=i.slice(),t.j[c]=a),t=a}return a=new xs(s),a.jr=i.slice(),t.j[e[o-1]]=a,a}function Mb(t){const e=[],s=[];let n=0,i="0123456789";for(;n<t.length;){let a=0;for(;i.indexOf(t[n+a])>=0;)a++;if(a>0){e.push(s.join(""));for(let o=parseInt(t.substring(n,n+a),10);o>0;o--)s.pop();n+=a}else s.push(t[n]),n++}return e}const Bl={defaultProtocol:"http",events:null,format:Pb,formatHref:Pb,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function yg(t,e=null){let s=Object.assign({},Bl);t&&(s=Object.assign(s,t instanceof yg?t.o:t));const n=s.ignoreTags,i=[];for(let a=0;a<n.length;a++)i.push(n[a].toUpperCase());this.o=s,e&&(this.defaultRender=e),this.ignoreTags=i}yg.prototype={o:Bl,ignoreTags:[],defaultRender(t){return t},check(t){return this.get("validate",t.toString(),t)},get(t,e,s){const n=e!=null;let i=this.o[t];return i&&(typeof i=="object"?(i=s.t in i?i[s.t]:Bl[t],typeof i=="function"&&n&&(i=i(e,s))):typeof i=="function"&&n&&(i=i(e,s.t,s)),i)},getObj(t,e,s){let n=this.o[t];return typeof n=="function"&&e!=null&&(n=n(e,s.t,s)),n},render(t){const e=t.render(this);return(this.get("render",null,t)||this.defaultRender)(e,t.t,t)}};function Pb(t){return t}function fC(t,e){this.t="token",this.v=t,this.tk=e}fC.prototype={isLink:!1,toString(){return this.v},toHref(t){return this.toString()},toFormattedString(t){const e=this.toString(),s=t.get("truncate",e,this),n=t.get("format",e,this);return s&&n.length>s?n.substring(0,s)+"…":n},toFormattedHref(t){return t.get("formatHref",this.toHref(t.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(t=Bl.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(t),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(t){return{type:this.t,value:this.toFormattedString(t),isLink:this.isLink,href:this.toFormattedHref(t),start:this.startIndex(),end:this.endIndex()}},validate(t){return t.get("validate",this.toString(),this)},render(t){const e=this,s=this.toHref(t.get("defaultProtocol")),n=t.get("formatHref",s,this),i=t.get("tagName",s,e),a=this.toFormattedString(t),o={},l=t.get("className",s,e),c=t.get("target",s,e),u=t.get("rel",s,e),d=t.getObj("attributes",s,e),h=t.getObj("events",s,e);return o.href=n,l&&(o.class=l),c&&(o.target=c),u&&(o.rel=u),d&&Object.assign(o,d),{tagName:i,attributes:o,content:a,eventListeners:h}}};function Ih(t,e){class s extends fC{constructor(i,a){super(i,a),this.t=t}}for(const n in e)s.prototype[n]=e[n];return s.t=t,s}const Ib=Ih("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),Ob=Ih("text"),i$=Ih("nl"),Uc=Ih("url",{isLink:!0,toHref(t=Bl.defaultProtocol){return this.hasProtocol()?this.v:`${t}://${this.v}`},hasProtocol(){const t=this.tk;return t.length>=2&&t[0].t!==$l&&t[1].t===Pr}}),$s=t=>new xs(t);function a$({groups:t}){const e=t.domain.concat([hd,md,Ar,pd,xd,gd,yd,bd,qs,hg,ol,jd,wd,vd,Sn,Nd,cl,kd]),s=[fd,Pr,mg,Nn,pg,ol,ll,xg,gg,sd,nd,il,al,Xu,Yu,ed,td,rd,id,ad,od,ld,cd,ud,dd],n=[hd,fd,md,pd,xd,gd,yd,bd,qs,il,al,ol,jd,wd,vd,ll,Sn,Nd,cl,kd],i=$s(),a=H(i,cl);xe(a,n,a),xe(a,t.domain,a);const o=$s(),l=$s(),c=$s();xe(i,t.domain,o),xe(i,t.scheme,l),xe(i,t.slashscheme,c),xe(o,n,a),xe(o,t.domain,o);const u=H(o,Ar);H(a,Ar,u),H(l,Ar,u),H(c,Ar,u);const d=H(a,Nn);xe(d,n,a),xe(d,t.domain,a);const h=$s();xe(u,t.domain,h),xe(h,t.domain,h);const f=H(h,Nn);xe(f,t.domain,h);const m=$s(Ib);xe(f,t.tld,m),xe(f,t.utld,m),H(u,$l,m);const p=H(h,qs);H(p,qs,p),xe(p,t.domain,h),xe(m,t.domain,h),H(m,Nn,f),H(m,qs,p);const x=H(m,Pr);xe(x,t.numeric,Ib);const g=H(o,qs),y=H(o,Nn);H(g,qs,g),xe(g,t.domain,o),xe(y,n,a),xe(y,t.domain,o);const b=$s(Uc);xe(y,t.tld,b),xe(y,t.utld,b),xe(b,t.domain,o),xe(b,n,a),H(b,Nn,y),H(b,qs,g),H(b,Ar,u);const w=H(b,Pr),S=$s(Uc);xe(w,t.numeric,S);const z=$s(Uc),N=$s();xe(z,e,z),xe(z,s,N),xe(N,e,z),xe(N,s,N),H(b,Sn,z),H(S,Sn,z);const k=H(l,Pr),C=H(c,Pr),T=H(C,Sn),v=H(T,Sn);xe(l,t.domain,o),H(l,Nn,y),H(l,qs,g),xe(c,t.domain,o),H(c,Nn,y),H(c,qs,g),xe(k,t.domain,z),H(k,Sn,z),H(k,ll,z),xe(v,t.domain,z),xe(v,e,z),H(v,Sn,z);const _=[[il,al],[Yu,Xu],[ed,td],[sd,nd],[rd,id],[ad,od],[ld,cd],[ud,dd]];for(let A=0;A<_.length;A++){const[E,M]=_[A],O=H(z,E);H(N,E,O),H(O,M,z);const R=$s(Uc);xe(O,e,R);const B=$s();xe(O,s),xe(R,e,R),xe(R,s,B),xe(B,e,R),xe(B,s,B),H(R,M,z),H(B,M,z)}return H(i,$l,b),H(i,fg,i$),{start:i,tokens:dC}}function o$(t,e,s){let n=s.length,i=0,a=[],o=[];for(;i<n;){let l=t,c=null,u=null,d=0,h=null,f=-1;for(;i<n&&!(c=l.go(s[i].t));)o.push(s[i++]);for(;i<n&&(u=c||l.go(s[i].t));)c=null,l=u,l.accepts()?(f=0,h=l):f>=0&&f++,i++,d++;if(f<0)i-=d,i<n&&(o.push(s[i]),i++);else{o.length>0&&(a.push(qf(Ob,e,o)),o=[]),i-=f,d-=f;const m=h.t,p=s.slice(i-d,i);a.push(qf(m,e,p))}}return o.length>0&&a.push(qf(Ob,e,o)),a}function qf(t,e,s){const n=s[0].s,i=s[s.length-1].e,a=e.slice(n,i);return new t(a,s)}const l$=typeof console<"u"&&console&&console.warn||(()=>{}),c$="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",Be={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function u$(){return xs.groups={},Be.scanner=null,Be.parser=null,Be.tokenQueue=[],Be.pluginQueue=[],Be.customSchemes=[],Be.initialized=!1,Be}function Rb(t,e=!1){if(Be.initialized&&l$(`linkifyjs: already initialized - will not register custom scheme "${t}" ${c$}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(t))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);Be.customSchemes.push([t,e])}function d$(){Be.scanner=n$(Be.customSchemes);for(let t=0;t<Be.tokenQueue.length;t++)Be.tokenQueue[t][1]({scanner:Be.scanner});Be.parser=a$(Be.scanner.tokens);for(let t=0;t<Be.pluginQueue.length;t++)Be.pluginQueue[t][1]({scanner:Be.scanner,parser:Be.parser});return Be.initialized=!0,Be}function bg(t){return Be.initialized||d$(),o$(Be.parser.start,t,hC(Be.scanner.start,t))}bg.scan=hC;function mC(t,e=null,s=null){if(e&&typeof e=="object"){if(s)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);s=e,e=null}const n=new yg(s),i=bg(t),a=[];for(let o=0;o<i.length;o++){const l=i[o];l.isLink&&(!e||l.t===e)&&n.check(l)&&a.push(l.toFormattedObject(n))}return a}var jg="[\0-   ᠎ -\u2029 　]",h$=new RegExp(jg),f$=new RegExp(`${jg}$`),m$=new RegExp(jg,"g");function p$(t){return t.length===1?t[0].isLink:t.length===3&&t[1].isLink?["()","[]"].includes(t[0].value+t[2].value):!1}function x$(t){return new $e({key:new ct("autolink"),appendTransaction:(e,s,n)=>{const i=e.some(u=>u.docChanged)&&!s.doc.eq(n.doc),a=e.some(u=>u.getMeta("preventAutolink"));if(!i||a)return;const{tr:o}=n,l=zS(s.doc,[...e]);if(RS(l).forEach(({newRange:u})=>{const d=kL(n.doc,u,m=>m.isTextblock);let h,f;if(d.length>1)h=d[0],f=n.doc.textBetween(h.pos,h.pos+h.node.nodeSize,void 0," ");else if(d.length){const m=n.doc.textBetween(u.from,u.to," "," ");if(!f$.test(m))return;h=d[0],f=n.doc.textBetween(h.pos,u.to,void 0," ")}if(h&&f){const m=f.split(h$).filter(Boolean);if(m.length<=0)return!1;const p=m[m.length-1],x=h.pos+f.lastIndexOf(p);if(!p)return!1;const g=bg(p).map(y=>y.toObject(t.defaultProtocol));if(!p$(g))return!1;g.filter(y=>y.isLink).map(y=>({...y,from:x+y.start+1,to:x+y.end+1})).filter(y=>n.schema.marks.code?!n.doc.rangeHasMark(y.from,y.to,n.schema.marks.code):!0).filter(y=>t.validate(y.value)).filter(y=>t.shouldAutoLink(y.value)).forEach(y=>{cg(y.from,y.to,n.doc).some(b=>b.mark.type===t.type)||o.addMark(y.from,y.to,t.type.create({href:y.href}))})}}),!!o.steps.length)return o}})}function g$(t){return new $e({key:new ct("handleClickLink"),props:{handleClick:(e,s,n)=>{var i,a;if(n.button!==0||!e.editable)return!1;let o=null;if(n.target instanceof HTMLAnchorElement)o=n.target;else{let d=n.target;const h=[];for(;d.nodeName!=="DIV";)h.push(d),d=d.parentNode;o=h.find(f=>f.nodeName==="A")}if(!o)return!1;const l=OS(e.state,t.type.name),c=(i=o?.href)!=null?i:l.href,u=(a=o?.target)!=null?a:l.target;return t.enableClickSelection&&t.editor.commands.extendMarkRange(t.type.name),o&&c?(window.open(c,u),!0):!1}}})}function y$(t){return new $e({key:new ct("handlePasteLink"),props:{handlePaste:(e,s,n)=>{const{state:i}=e,{selection:a}=i,{empty:o}=a;if(o)return!1;let l="";n.content.forEach(u=>{l+=u.textContent});const c=mC(l,{defaultProtocol:t.defaultProtocol}).find(u=>u.isLink&&u.value===l);return!l||!c?!1:t.editor.commands.setMark(t.type,{href:c.href})}}})}function fi(t,e){const s=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(n=>{const i=typeof n=="string"?n:n.scheme;i&&s.push(i)}),!t||t.replace(m$,"").match(new RegExp(`^(?:(?:${s.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var pC=Ls.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(t=>{if(typeof t=="string"){Rb(t);return}Rb(t.scheme,t.optionalSlashes)})},onDestroy(){u$()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(t,e)=>!!fi(t,e.protocols),validate:t=>!!t,shouldAutoLink:t=>!!t}},addAttributes(){return{href:{default:null,parseHTML(t){return t.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:t=>{const e=t.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:s=>!!fi(s,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:t}){return this.options.isAllowedUri(t.href,{defaultValidate:e=>!!fi(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",Ye(this.options.HTMLAttributes,t),0]:["a",Ye(this.options.HTMLAttributes,{...t,href:""}),0]},addCommands(){return{setLink:t=>({chain:e})=>{const{href:s}=t;return this.options.isAllowedUri(s,{defaultValidate:n=>!!fi(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,t).setMeta("preventAutolink",!0).run():!1},toggleLink:t=>({chain:e})=>{const{href:s}=t||{};return s&&!this.options.isAllowedUri(s,{defaultValidate:n=>!!fi(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[Ui({find:t=>{const e=[];if(t){const{protocols:s,defaultProtocol:n}=this.options,i=mC(t).filter(a=>a.isLink&&this.options.isAllowedUri(a.value,{defaultValidate:o=>!!fi(o,s),protocols:s,defaultProtocol:n}));i.length&&i.forEach(a=>e.push({text:a.value,data:{href:a.href},index:a.start}))}return e},type:this.type,getAttributes:t=>{var e;return{href:(e=t.data)==null?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[],{protocols:e,defaultProtocol:s}=this.options;return this.options.autolink&&t.push(x$({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:n=>this.options.isAllowedUri(n,{defaultValidate:i=>!!fi(i,e),protocols:e,defaultProtocol:s}),shouldAutoLink:this.options.shouldAutoLink})),this.options.openOnClick===!0&&t.push(g$({type:this.type,editor:this.editor,enableClickSelection:this.options.enableClickSelection})),this.options.linkOnPaste&&t.push(y$({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type})),t}}),b$=pC,j$=Object.defineProperty,w$=(t,e)=>{for(var s in e)j$(t,s,{get:e[s],enumerable:!0})},v$="listItem",Lb="textStyle",Fb=/^\s*([-+*])\s$/,xC=Ne.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",Ye(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(v$,this.editor.getAttributes(Lb)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=ro({find:Fb,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=ro({find:Fb,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(Lb),editor:this.editor})),[t]}}),gC=Ne.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",Ye(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),k$={};w$(k$,{findListItemPos:()=>pc,getNextListDepth:()=>wg,handleBackspace:()=>hp,handleDelete:()=>fp,hasListBefore:()=>yC,hasListItemAfter:()=>N$,hasListItemBefore:()=>bC,listItemHasSubList:()=>jC,nextListIsDeeper:()=>wC,nextListIsHigher:()=>vC});var pc=(t,e)=>{const{$from:s}=e.selection,n=jt(t,e.schema);let i=null,a=s.depth,o=s.pos,l=null;for(;a>0&&l===null;)i=s.node(a),i.type===n?l=a:(a-=1,o-=1);return l===null?null:{$pos:e.doc.resolve(o),depth:l}},wg=(t,e)=>{const s=pc(t,e);if(!s)return!1;const[,n]=DL(e,t,s.$pos.pos+4);return n},yC=(t,e,s)=>{const{$anchor:n}=t.selection,i=Math.max(0,n.pos-2),a=t.doc.resolve(i).node();return!(!a||!s.includes(a.type.name))},bC=(t,e)=>{var s;const{$anchor:n}=e.selection,i=e.doc.resolve(n.pos-2);return!(i.index()===0||((s=i.nodeBefore)==null?void 0:s.type.name)!==t)},jC=(t,e,s)=>{if(!s)return!1;const n=jt(t,e.schema);let i=!1;return s.descendants(a=>{a.type===n&&(i=!0)}),i},hp=(t,e,s)=>{if(t.commands.undoInputRule())return!0;if(t.state.selection.from!==t.state.selection.to)return!1;if(!Xr(t.state,e)&&yC(t.state,e,s)){const{$anchor:l}=t.state.selection,c=t.state.doc.resolve(l.before()-1),u=[];c.node().descendants((f,m)=>{f.type.name===e&&u.push({node:f,pos:m})});const d=u.at(-1);if(!d)return!1;const h=t.state.doc.resolve(c.start()+d.pos+1);return t.chain().cut({from:l.start()-1,to:l.end()+1},h.end()).joinForward().run()}if(!Xr(t.state,e)||!OL(t.state))return!1;const n=pc(e,t.state);if(!n)return!1;const a=t.state.doc.resolve(n.$pos.pos-2).node(n.depth),o=jC(e,t.state,a);return bC(e,t.state)&&!o?t.commands.joinItemBackward():t.chain().liftListItem(e).run()},wC=(t,e)=>{const s=wg(t,e),n=pc(t,e);return!n||!s?!1:s>n.depth},vC=(t,e)=>{const s=wg(t,e),n=pc(t,e);return!n||!s?!1:s<n.depth},fp=(t,e)=>{if(!Xr(t.state,e)||!IL(t.state,e))return!1;const{selection:s}=t.state,{$from:n,$to:i}=s;return!s.empty&&n.sameParent(i)?!1:wC(e,t.state)?t.chain().focus(t.state.selection.from+4).lift(e).joinBackward().run():vC(e,t.state)?t.chain().joinForward().joinBackward().run():t.commands.joinItemForward()},N$=(t,e)=>{var s;const{$anchor:n}=e.selection,i=e.doc.resolve(n.pos-n.parentOffset-2);return!(i.index()===i.parent.childCount-1||((s=i.nodeAfter)==null?void 0:s.type.name)!==t)},kC=qe.create({name:"listKeymap",addOptions(){return{listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}},addKeyboardShortcuts(){return{Delete:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:s})=>{t.state.schema.nodes[s]!==void 0&&fp(t,s)&&(e=!0)}),e},"Mod-Delete":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:s})=>{t.state.schema.nodes[s]!==void 0&&fp(t,s)&&(e=!0)}),e},Backspace:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:s,wrapperNames:n})=>{t.state.schema.nodes[s]!==void 0&&hp(t,s,n)&&(e=!0)}),e},"Mod-Backspace":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:s,wrapperNames:n})=>{t.state.schema.nodes[s]!==void 0&&hp(t,s,n)&&(e=!0)}),e}}}}),S$="listItem",$b="textStyle",Bb=/^(\d+)\.\s$/,NC=Ne.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...s}=t;return e===1?["ol",Ye(this.options.HTMLAttributes,s),0]:["ol",Ye(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(S$,this.editor.getAttributes($b)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=ro({find:Bb,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,s)=>s.childCount+s.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=ro({find:Bb,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes($b)}),joinPredicate:(e,s)=>s.childCount+s.attrs.start===+e[1],editor:this.editor})),[t]}}),C$=/^\s*(\[([( |x])?\])\s$/,z$=Ne.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:t=>{const e=t.getAttribute("data-checked");return e===""||e==="true"},renderHTML:t=>({"data-checked":t.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:t,HTMLAttributes:e}){return["li",Ye(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:t.attrs.checked?"checked":null}],["span"]],["div",0]]},addKeyboardShortcuts(){const t={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...t,Tab:()=>this.editor.commands.sinkListItem(this.name)}:t},addNodeView(){return({node:t,HTMLAttributes:e,getPos:s,editor:n})=>{const i=document.createElement("li"),a=document.createElement("label"),o=document.createElement("span"),l=document.createElement("input"),c=document.createElement("div"),u=d=>{var h,f;l.ariaLabel=((f=(h=this.options.a11y)==null?void 0:h.checkboxLabel)==null?void 0:f.call(h,d,l.checked))||`Task item checkbox for ${d.textContent||"empty task item"}`};return u(t),a.contentEditable="false",l.type="checkbox",l.addEventListener("mousedown",d=>d.preventDefault()),l.addEventListener("change",d=>{if(!n.isEditable&&!this.options.onReadOnlyChecked){l.checked=!l.checked;return}const{checked:h}=d.target;n.isEditable&&typeof s=="function"&&n.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:f})=>{const m=s();if(typeof m!="number")return!1;const p=f.doc.nodeAt(m);return f.setNodeMarkup(m,void 0,{...p?.attrs,checked:h}),!0}).run(),!n.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(t,h)||(l.checked=!l.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([d,h])=>{i.setAttribute(d,h)}),i.dataset.checked=t.attrs.checked,l.checked=t.attrs.checked,a.append(l,o),i.append(a,c),Object.entries(e).forEach(([d,h])=>{i.setAttribute(d,h)}),{dom:i,contentDOM:c,update:d=>d.type!==this.type?!1:(i.dataset.checked=d.attrs.checked,l.checked=d.attrs.checked,u(d),!0)}}},addInputRules(){return[ro({find:C$,type:this.type,getAttributes:t=>({checked:t[t.length-1]==="x"})})]}}),_$=Ne.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:t}){return["ul",Ye(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},addCommands(){return{toggleTaskList:()=>({commands:t})=>t.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});qe.create({name:"listKit",addExtensions(){const t=[];return this.options.bulletList!==!1&&t.push(xC.configure(this.options.bulletList)),this.options.listItem!==!1&&t.push(gC.configure(this.options.listItem)),this.options.listKeymap!==!1&&t.push(kC.configure(this.options.listKeymap)),this.options.orderedList!==!1&&t.push(NC.configure(this.options.orderedList)),this.options.taskItem!==!1&&t.push(z$.configure(this.options.taskItem)),this.options.taskList!==!1&&t.push(_$.configure(this.options.taskList)),t}});var A$=Ne.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",Ye(this.options.HTMLAttributes,t),0]},addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),T$=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,E$=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,D$=Ls.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",Ye(this.options.HTMLAttributes,t),0]},addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[no({find:T$,type:this.type})]},addPasteRules(){return[Ui({find:E$,type:this.type})]}}),M$=Ne.create({name:"text",group:"inline"}),SC=Ls.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["u",Ye(this.options.HTMLAttributes,t),0]},addCommands(){return{setUnderline:()=>({commands:t})=>t.setMark(this.name),toggleUnderline:()=>({commands:t})=>t.toggleMark(this.name),unsetUnderline:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}}),P$=SC;function I$(t={}){return new $e({view(e){return new O$(e,t)}})}class O${constructor(e,s){var n;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(n=s.width)!==null&&n!==void 0?n:1,this.color=s.color===!1?void 0:s.color||"black",this.class=s.class,this.handlers=["dragover","dragend","drop","dragleave"].map(i=>{let a=o=>{this[i](o)};return e.dom.addEventListener(i,a),{name:i,handler:a}})}destroy(){this.handlers.forEach(({name:e,handler:s})=>this.editorView.dom.removeEventListener(e,s))}update(e,s){this.cursorPos!=null&&s.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),s=!e.parent.inlineContent,n,i=this.editorView.dom,a=i.getBoundingClientRect(),o=a.width/i.offsetWidth,l=a.height/i.offsetHeight;if(s){let h=e.nodeBefore,f=e.nodeAfter;if(h||f){let m=this.editorView.nodeDOM(this.cursorPos-(h?h.nodeSize:0));if(m){let p=m.getBoundingClientRect(),x=h?p.bottom:p.top;h&&f&&(x=(x+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let g=this.width/2*l;n={left:p.left,right:p.right,top:x-g,bottom:x+g}}}}if(!n){let h=this.editorView.coordsAtPos(this.cursorPos),f=this.width/2*o;n={left:h.left-f,right:h.left+f,top:h.top,bottom:h.bottom}}let c=this.editorView.dom.offsetParent;this.element||(this.element=c.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",s),this.element.classList.toggle("prosemirror-dropcursor-inline",!s);let u,d;if(!c||c==document.body&&getComputedStyle(c).position=="static")u=-pageXOffset,d=-pageYOffset;else{let h=c.getBoundingClientRect(),f=h.width/c.offsetWidth,m=h.height/c.offsetHeight;u=h.left-c.scrollLeft*f,d=h.top-c.scrollTop*m}this.element.style.left=(n.left-u)/o+"px",this.element.style.top=(n.top-d)/l+"px",this.element.style.width=(n.right-n.left)/o+"px",this.element.style.height=(n.bottom-n.top)/l+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let s=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),n=s&&s.inside>=0&&this.editorView.state.doc.nodeAt(s.inside),i=n&&n.type.spec.disableDropCursor,a=typeof i=="function"?i(this.editorView,s,e):i;if(s&&!a){let o=s.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let l=C2(this.editorView.state.doc,o,this.editorView.dragging.slice);l!=null&&(o=l)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}class at extends le{constructor(e){super(e,e)}map(e,s){let n=e.resolve(s.map(this.head));return at.valid(n)?new at(n):le.near(n)}content(){return Q.empty}eq(e){return e instanceof at&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,s){if(typeof s.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new at(e.resolve(s.pos))}getBookmark(){return new vg(this.anchor)}static valid(e){let s=e.parent;if(s.isTextblock||!R$(e)||!L$(e))return!1;let n=s.type.spec.allowGapCursor;if(n!=null)return n;let i=s.contentMatchAt(e.index()).defaultType;return i&&i.isTextblock}static findGapCursorFrom(e,s,n=!1){e:for(;;){if(!n&&at.valid(e))return e;let i=e.pos,a=null;for(let o=e.depth;;o--){let l=e.node(o);if(s>0?e.indexAfter(o)<l.childCount:e.index(o)>0){a=l.child(s>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;i+=s;let c=e.doc.resolve(i);if(at.valid(c))return c}for(;;){let o=s>0?a.firstChild:a.lastChild;if(!o){if(a.isAtom&&!a.isText&&!ne.isSelectable(a)){e=e.doc.resolve(i+a.nodeSize*s),n=!1;continue e}break}a=o,i+=s;let l=e.doc.resolve(i);if(at.valid(l))return l}return null}}}at.prototype.visible=!1;at.findFrom=at.findGapCursorFrom;le.jsonID("gapcursor",at);class vg{constructor(e){this.pos=e}map(e){return new vg(e.map(this.pos))}resolve(e){let s=e.resolve(this.pos);return at.valid(s)?new at(s):le.near(s)}}function R$(t){for(let e=t.depth;e>=0;e--){let s=t.index(e),n=t.node(e);if(s==0){if(n.type.spec.isolating)return!0;continue}for(let i=n.child(s-1);;i=i.lastChild){if(i.childCount==0&&!i.inlineContent||i.isAtom||i.type.spec.isolating)return!0;if(i.inlineContent)return!1}}return!0}function L$(t){for(let e=t.depth;e>=0;e--){let s=t.indexAfter(e),n=t.node(e);if(s==n.childCount){if(n.type.spec.isolating)return!0;continue}for(let i=n.child(s);;i=i.firstChild){if(i.childCount==0&&!i.inlineContent||i.isAtom||i.type.spec.isolating)return!0;if(i.inlineContent)return!1}}return!0}function F$(){return new $e({props:{decorations:V$,createSelectionBetween(t,e,s){return e.pos==s.pos&&at.valid(s)?new at(s):null},handleClick:B$,handleKeyDown:$$,handleDOMEvents:{beforeinput:q$}}})}const $$=Xx({ArrowLeft:Wc("horiz",-1),ArrowRight:Wc("horiz",1),ArrowUp:Wc("vert",-1),ArrowDown:Wc("vert",1)});function Wc(t,e){const s=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(n,i,a){let o=n.selection,l=e>0?o.$to:o.$from,c=o.empty;if(o instanceof re){if(!a.endOfTextblock(s)||l.depth==0)return!1;c=!1,l=n.doc.resolve(e>0?l.after():l.before())}let u=at.findGapCursorFrom(l,e,c);return u?(i&&i(n.tr.setSelection(new at(u))),!0):!1}}function B$(t,e,s){if(!t||!t.editable)return!1;let n=t.state.doc.resolve(e);if(!at.valid(n))return!1;let i=t.posAtCoords({left:s.clientX,top:s.clientY});return i&&i.inside>-1&&ne.isSelectable(t.state.doc.nodeAt(i.inside))?!1:(t.dispatch(t.state.tr.setSelection(new at(n))),!0)}function q$(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof at))return!1;let{$from:s}=t.state.selection,n=s.parent.contentMatchAt(s.index()).findWrapping(t.state.schema.nodes.text);if(!n)return!1;let i=q.empty;for(let o=n.length-1;o>=0;o--)i=q.from(n[o].createAndFill(null,i));let a=t.state.tr.replace(s.pos,s.pos,new Q(i,0,0));return a.setSelection(re.near(a.doc.resolve(s.pos+1))),t.dispatch(a),!1}function V$(t){if(!(t.selection instanceof at))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",Ie.create(t.doc,[kt.widget(t.selection.head,e,{key:"gapcursor"})])}var Sd=200,Mt=function(){};Mt.prototype.append=function(e){return e.length?(e=Mt.from(e),!this.length&&e||e.length<Sd&&this.leafAppend(e)||this.length<Sd&&e.leafPrepend(this)||this.appendInner(e)):this};Mt.prototype.prepend=function(e){return e.length?Mt.from(e).append(this):this};Mt.prototype.appendInner=function(e){return new U$(this,e)};Mt.prototype.slice=function(e,s){return e===void 0&&(e=0),s===void 0&&(s=this.length),e>=s?Mt.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,s))};Mt.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};Mt.prototype.forEach=function(e,s,n){s===void 0&&(s=0),n===void 0&&(n=this.length),s<=n?this.forEachInner(e,s,n,0):this.forEachInvertedInner(e,s,n,0)};Mt.prototype.map=function(e,s,n){s===void 0&&(s=0),n===void 0&&(n=this.length);var i=[];return this.forEach(function(a,o){return i.push(e(a,o))},s,n),i};Mt.from=function(e){return e instanceof Mt?e:e&&e.length?new CC(e):Mt.empty};var CC=function(t){function e(n){t.call(this),this.values=n}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var s={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(i,a){return i==0&&a==this.length?this:new e(this.values.slice(i,a))},e.prototype.getInner=function(i){return this.values[i]},e.prototype.forEachInner=function(i,a,o,l){for(var c=a;c<o;c++)if(i(this.values[c],l+c)===!1)return!1},e.prototype.forEachInvertedInner=function(i,a,o,l){for(var c=a-1;c>=o;c--)if(i(this.values[c],l+c)===!1)return!1},e.prototype.leafAppend=function(i){if(this.length+i.length<=Sd)return new e(this.values.concat(i.flatten()))},e.prototype.leafPrepend=function(i){if(this.length+i.length<=Sd)return new e(i.flatten().concat(this.values))},s.length.get=function(){return this.values.length},s.depth.get=function(){return 0},Object.defineProperties(e.prototype,s),e}(Mt);Mt.empty=new CC([]);var U$=function(t){function e(s,n){t.call(this),this.left=s,this.right=n,this.length=s.length+n.length,this.depth=Math.max(s.depth,n.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(n){return n<this.left.length?this.left.get(n):this.right.get(n-this.left.length)},e.prototype.forEachInner=function(n,i,a,o){var l=this.left.length;if(i<l&&this.left.forEachInner(n,i,Math.min(a,l),o)===!1||a>l&&this.right.forEachInner(n,Math.max(i-l,0),Math.min(this.length,a)-l,o+l)===!1)return!1},e.prototype.forEachInvertedInner=function(n,i,a,o){var l=this.left.length;if(i>l&&this.right.forEachInvertedInner(n,i-l,Math.max(a,l)-l,o+l)===!1||a<l&&this.left.forEachInvertedInner(n,Math.min(i,l),a,o)===!1)return!1},e.prototype.sliceInner=function(n,i){if(n==0&&i==this.length)return this;var a=this.left.length;return i<=a?this.left.slice(n,i):n>=a?this.right.slice(n-a,i-a):this.left.slice(n,a).append(this.right.slice(0,i-a))},e.prototype.leafAppend=function(n){var i=this.right.leafAppend(n);if(i)return new e(this.left,i)},e.prototype.leafPrepend=function(n){var i=this.left.leafPrepend(n);if(i)return new e(i,this.right)},e.prototype.appendInner=function(n){return this.left.depth>=Math.max(this.right.depth,n.depth)+1?new e(this.left,new e(this.right,n)):new e(this,n)},e}(Mt);const W$=500;class ln{constructor(e,s){this.items=e,this.eventCount=s}popEvent(e,s){if(this.eventCount==0)return null;let n=this.items.length;for(;;n--)if(this.items.get(n-1).selection){--n;break}let i,a;s&&(i=this.remapping(n,this.items.length),a=i.maps.length);let o=e.tr,l,c,u=[],d=[];return this.items.forEach((h,f)=>{if(!h.step){i||(i=this.remapping(n,f+1),a=i.maps.length),a--,d.push(h);return}if(i){d.push(new Cn(h.map));let m=h.step.map(i.slice(a)),p;m&&o.maybeStep(m).doc&&(p=o.mapping.maps[o.mapping.maps.length-1],u.push(new Cn(p,void 0,void 0,u.length+d.length))),a--,p&&i.appendMap(p,a)}else o.maybeStep(h.step);if(h.selection)return l=i?h.selection.map(i.slice(a)):h.selection,c=new ln(this.items.slice(0,n).append(d.reverse().concat(u)),this.eventCount-1),!1},this.items.length,0),{remaining:c,transform:o,selection:l}}addTransform(e,s,n,i){let a=[],o=this.eventCount,l=this.items,c=!i&&l.length?l.get(l.length-1):null;for(let d=0;d<e.steps.length;d++){let h=e.steps[d].invert(e.docs[d]),f=new Cn(e.mapping.maps[d],h,s),m;(m=c&&c.merge(f))&&(f=m,d?a.pop():l=l.slice(0,l.length-1)),a.push(f),s&&(o++,s=void 0),i||(c=f)}let u=o-n.depth;return u>H$&&(l=K$(l,u),o-=u),new ln(l.append(a),o)}remapping(e,s){let n=new Ml;return this.items.forEach((i,a)=>{let o=i.mirrorOffset!=null&&a-i.mirrorOffset>=e?n.maps.length-i.mirrorOffset:void 0;n.appendMap(i.map,o)},e,s),n}addMaps(e){return this.eventCount==0?this:new ln(this.items.append(e.map(s=>new Cn(s))),this.eventCount)}rebased(e,s){if(!this.eventCount)return this;let n=[],i=Math.max(0,this.items.length-s),a=e.mapping,o=e.steps.length,l=this.eventCount;this.items.forEach(f=>{f.selection&&l--},i);let c=s;this.items.forEach(f=>{let m=a.getMirror(--c);if(m==null)return;o=Math.min(o,m);let p=a.maps[m];if(f.step){let x=e.steps[m].invert(e.docs[m]),g=f.selection&&f.selection.map(a.slice(c+1,m));g&&l++,n.push(new Cn(p,x,g))}else n.push(new Cn(p))},i);let u=[];for(let f=s;f<o;f++)u.push(new Cn(a.maps[f]));let d=this.items.slice(0,i).append(u).append(n),h=new ln(d,l);return h.emptyItemCount()>W$&&(h=h.compress(this.items.length-n.length)),h}emptyItemCount(){let e=0;return this.items.forEach(s=>{s.step||e++}),e}compress(e=this.items.length){let s=this.remapping(0,e),n=s.maps.length,i=[],a=0;return this.items.forEach((o,l)=>{if(l>=e)i.push(o),o.selection&&a++;else if(o.step){let c=o.step.map(s.slice(n)),u=c&&c.getMap();if(n--,u&&s.appendMap(u,n),c){let d=o.selection&&o.selection.map(s.slice(n));d&&a++;let h=new Cn(u.invert(),c,d),f,m=i.length-1;(f=i.length&&i[m].merge(h))?i[m]=f:i.push(h)}}else o.map&&n--},this.items.length,0),new ln(Mt.from(i.reverse()),a)}}ln.empty=new ln(Mt.empty,0);function K$(t,e){let s;return t.forEach((n,i)=>{if(n.selection&&e--==0)return s=i,!1}),t.slice(s)}class Cn{constructor(e,s,n,i){this.map=e,this.step=s,this.selection=n,this.mirrorOffset=i}merge(e){if(this.step&&e.step&&!e.selection){let s=e.step.merge(this.step);if(s)return new Cn(s.getMap().invert(),s,this.selection)}}}class Tr{constructor(e,s,n,i,a){this.done=e,this.undone=s,this.prevRanges=n,this.prevTime=i,this.prevComposition=a}}const H$=20;function G$(t,e,s,n){let i=s.getMeta(Ei),a;if(i)return i.historyState;s.getMeta(Q$)&&(t=new Tr(t.done,t.undone,null,0,-1));let o=s.getMeta("appendedTransaction");if(s.steps.length==0)return t;if(o&&o.getMeta(Ei))return o.getMeta(Ei).redo?new Tr(t.done.addTransform(s,void 0,n,hu(e)),t.undone,qb(s.mapping.maps),t.prevTime,t.prevComposition):new Tr(t.done,t.undone.addTransform(s,void 0,n,hu(e)),null,t.prevTime,t.prevComposition);if(s.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let l=s.getMeta("composition"),c=t.prevTime==0||!o&&t.prevComposition!=l&&(t.prevTime<(s.time||0)-n.newGroupDelay||!J$(s,t.prevRanges)),u=o?Vf(t.prevRanges,s.mapping):qb(s.mapping.maps);return new Tr(t.done.addTransform(s,c?e.selection.getBookmark():void 0,n,hu(e)),ln.empty,u,s.time,l??t.prevComposition)}else return(a=s.getMeta("rebased"))?new Tr(t.done.rebased(s,a),t.undone.rebased(s,a),Vf(t.prevRanges,s.mapping),t.prevTime,t.prevComposition):new Tr(t.done.addMaps(s.mapping.maps),t.undone.addMaps(s.mapping.maps),Vf(t.prevRanges,s.mapping),t.prevTime,t.prevComposition)}function J$(t,e){if(!e)return!1;if(!t.docChanged)return!0;let s=!1;return t.mapping.maps[0].forEach((n,i)=>{for(let a=0;a<e.length;a+=2)n<=e[a+1]&&i>=e[a]&&(s=!0)}),s}function qb(t){let e=[];for(let s=t.length-1;s>=0&&e.length==0;s--)t[s].forEach((n,i,a,o)=>e.push(a,o));return e}function Vf(t,e){if(!t)return null;let s=[];for(let n=0;n<t.length;n+=2){let i=e.map(t[n],1),a=e.map(t[n+1],-1);i<=a&&s.push(i,a)}return s}function Z$(t,e,s){let n=hu(e),i=Ei.get(e).spec.config,a=(s?t.undone:t.done).popEvent(e,n);if(!a)return null;let o=a.selection.resolve(a.transform.doc),l=(s?t.done:t.undone).addTransform(a.transform,e.selection.getBookmark(),i,n),c=new Tr(s?l:a.remaining,s?a.remaining:l,null,0,-1);return a.transform.setSelection(o).setMeta(Ei,{redo:s,historyState:c})}let Uf=!1,Vb=null;function hu(t){let e=t.plugins;if(Vb!=e){Uf=!1,Vb=e;for(let s=0;s<e.length;s++)if(e[s].spec.historyPreserveItems){Uf=!0;break}}return Uf}const Ei=new ct("history"),Q$=new ct("closeHistory");function Y$(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new $e({key:Ei,state:{init(){return new Tr(ln.empty,ln.empty,null,0,-1)},apply(e,s,n){return G$(s,n,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,s){let n=s.inputType,i=n=="historyUndo"?_C:n=="historyRedo"?AC:null;return i?(s.preventDefault(),i(e.state,e.dispatch)):!1}}}})}function zC(t,e){return(s,n)=>{let i=Ei.getState(s);if(!i||(t?i.undone:i.done).eventCount==0)return!1;if(n){let a=Z$(i,s,t);a&&n(e?a.scrollIntoView():a)}return!0}}const _C=zC(!1,!0),AC=zC(!0,!0);qe.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:t=>t.length,wordCounter:t=>t.split(" ").filter(e=>e!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=t=>{const e=t?.node||this.editor.state.doc;if((t?.mode||this.options.mode)==="textSize"){const n=e.textBetween(0,e.content.size,void 0," ");return this.options.textCounter(n)}return e.nodeSize},this.storage.words=t=>{const e=t?.node||this.editor.state.doc,s=e.textBetween(0,e.content.size," "," ");return this.options.wordCounter(s)}},addProseMirrorPlugins(){let t=!1;return[new $e({key:new ct("characterCount"),appendTransaction:(e,s,n)=>{if(t)return;const i=this.options.limit;if(i==null||i===0){t=!0;return}const a=this.storage.characters({node:n.doc});if(a>i){const o=a-i,l=0,c=o;console.warn(`[CharacterCount] Initial content exceeded limit of ${i} characters. Content was automatically trimmed.`);const u=n.tr.deleteRange(l,c);return t=!0,u}t=!0},filterTransaction:(e,s)=>{const n=this.options.limit;if(!e.docChanged||n===0||n===null||n===void 0)return!0;const i=this.storage.characters({node:s.doc}),a=this.storage.characters({node:e.doc});if(a<=n||i>n&&a>n&&a<=i)return!0;if(i>n&&a>n&&a>i||!e.getMeta("paste"))return!1;const l=e.selection.$head.pos,c=a-n,u=l-c,d=l;return e.deleteRange(u,d),!(this.storage.characters({node:e.doc})>n)}})]}});var X$=qe.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[I$(this.options)]}});qe.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new $e({key:new ct("focus"),props:{decorations:({doc:t,selection:e})=>{const{isEditable:s,isFocused:n}=this.editor,{anchor:i}=e,a=[];if(!s||!n)return Ie.create(t,[]);let o=0;this.options.mode==="deepest"&&t.descendants((c,u)=>{if(c.isText)return;if(!(i>=u&&i<=u+c.nodeSize-1))return!1;o+=1});let l=0;return t.descendants((c,u)=>{if(c.isText||!(i>=u&&i<=u+c.nodeSize-1))return!1;if(l+=1,this.options.mode==="deepest"&&o-l>0||this.options.mode==="shallowest"&&l>1)return this.options.mode==="deepest";a.push(kt.node(u,u+c.nodeSize,{class:this.options.className}))}),Ie.create(t,a)}}})]}});var eB=qe.create({name:"gapCursor",addProseMirrorPlugins(){return[F$()]},extendNodeSchema(t){var e;const s={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=Ce(se(t,"allowGapCursor",s)))!=null?e:null}}}),tB=qe.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something …",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new $e({key:new ct("placeholder"),props:{decorations:({doc:t,selection:e})=>{const s=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:n}=e,i=[];if(!s)return null;const a=this.editor.isEmpty;return t.descendants((o,l)=>{const c=n>=l&&n<=l+o.nodeSize,u=!o.isLeaf&&Dh(o);if((c||!this.options.showOnlyCurrent)&&u){const d=[this.options.emptyNodeClass];a&&d.push(this.options.emptyEditorClass);const h=kt.node(l,l+o.nodeSize,{class:d.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:o,pos:l,hasAnchor:c}):this.options.placeholder});i.push(h)}return this.options.includeChildren}),Ie.create(t,i)}}})]}});qe.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){const{editor:t,options:e}=this;return[new $e({key:new ct("selection"),props:{decorations(s){return s.selection.empty||t.isFocused||!t.isEditable||FS(s.selection)||t.view.dragging?null:Ie.create(s.doc,[kt.inline(s.selection.from,s.selection.to,{class:e.className})])}}})]}});function Ub({types:t,node:e}){return e&&Array.isArray(t)&&t.includes(e.type)||e?.type===t}var sB=qe.create({name:"trailingNode",addOptions(){return{node:"paragraph",notAfter:[]}},addProseMirrorPlugins(){const t=new ct(this.name),e=Object.entries(this.editor.schema.nodes).map(([,s])=>s).filter(s=>(this.options.notAfter||[]).concat(this.options.node).includes(s.name));return[new $e({key:t,appendTransaction:(s,n,i)=>{const{doc:a,tr:o,schema:l}=i,c=t.getState(i),u=a.content.size,d=l.nodes[this.options.node];if(c)return o.insert(u,d.create())},state:{init:(s,n)=>{const i=n.tr.doc.lastChild;return!Ub({node:i,types:e})},apply:(s,n)=>{if(!s.docChanged)return n;const i=s.doc.lastChild;return!Ub({node:i,types:e})}}})]}}),nB=qe.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>_C(t,e),redo:()=>({state:t,dispatch:e})=>AC(t,e)}},addProseMirrorPlugins(){return[Y$(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}}),rB=qe.create({name:"starterKit",addExtensions(){var t,e,s,n;const i=[];return this.options.bold!==!1&&i.push(M9.configure(this.options.bold)),this.options.blockquote!==!1&&i.push(_9.configure(this.options.blockquote)),this.options.bulletList!==!1&&i.push(xC.configure(this.options.bulletList)),this.options.code!==!1&&i.push(O9.configure(this.options.code)),this.options.codeBlock!==!1&&i.push(F9.configure(this.options.codeBlock)),this.options.document!==!1&&i.push($9.configure(this.options.document)),this.options.dropcursor!==!1&&i.push(X$.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&i.push(eB.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&i.push(B9.configure(this.options.hardBreak)),this.options.heading!==!1&&i.push(q9.configure(this.options.heading)),this.options.undoRedo!==!1&&i.push(nB.configure(this.options.undoRedo)),this.options.horizontalRule!==!1&&i.push(V9.configure(this.options.horizontalRule)),this.options.italic!==!1&&i.push(G9.configure(this.options.italic)),this.options.listItem!==!1&&i.push(gC.configure(this.options.listItem)),this.options.listKeymap!==!1&&i.push(kC.configure((t=this.options)==null?void 0:t.listKeymap)),this.options.link!==!1&&i.push(pC.configure((e=this.options)==null?void 0:e.link)),this.options.orderedList!==!1&&i.push(NC.configure(this.options.orderedList)),this.options.paragraph!==!1&&i.push(A$.configure(this.options.paragraph)),this.options.strike!==!1&&i.push(D$.configure(this.options.strike)),this.options.text!==!1&&i.push(M$.configure(this.options.text)),this.options.underline!==!1&&i.push(SC.configure((s=this.options)==null?void 0:s.underline)),this.options.trailingNode!==!1&&i.push(sB.configure((n=this.options)==null?void 0:n.trailingNode)),i}}),iB=rB,aB=tB,mp,pp;if(typeof WeakMap<"u"){let t=new WeakMap;mp=e=>t.get(e),pp=(e,s)=>(t.set(e,s),s)}else{const t=[];let s=0;mp=n=>{for(let i=0;i<t.length;i+=2)if(t[i]==n)return t[i+1]},pp=(n,i)=>(s==10&&(s=0),t[s++]=n,t[s++]=i)}var ot=class{constructor(t,e,s,n){this.width=t,this.height=e,this.map=s,this.problems=n}findCell(t){for(let e=0;e<this.map.length;e++){const s=this.map[e];if(s!=t)continue;const n=e%this.width,i=e/this.width|0;let a=n+1,o=i+1;for(let l=1;a<this.width&&this.map[e+l]==s;l++)a++;for(let l=1;o<this.height&&this.map[e+this.width*l]==s;l++)o++;return{left:n,top:i,right:a,bottom:o}}throw new RangeError(`No cell with offset ${t} found`)}colCount(t){for(let e=0;e<this.map.length;e++)if(this.map[e]==t)return e%this.width;throw new RangeError(`No cell with offset ${t} found`)}nextCell(t,e,s){const{left:n,right:i,top:a,bottom:o}=this.findCell(t);return e=="horiz"?(s<0?n==0:i==this.width)?null:this.map[a*this.width+(s<0?n-1:i)]:(s<0?a==0:o==this.height)?null:this.map[n+this.width*(s<0?a-1:o)]}rectBetween(t,e){const{left:s,right:n,top:i,bottom:a}=this.findCell(t),{left:o,right:l,top:c,bottom:u}=this.findCell(e);return{left:Math.min(s,o),top:Math.min(i,c),right:Math.max(n,l),bottom:Math.max(a,u)}}cellsInRect(t){const e=[],s={};for(let n=t.top;n<t.bottom;n++)for(let i=t.left;i<t.right;i++){const a=n*this.width+i,o=this.map[a];s[o]||(s[o]=!0,!(i==t.left&&i&&this.map[a-1]==o||n==t.top&&n&&this.map[a-this.width]==o)&&e.push(o))}return e}positionAt(t,e,s){for(let n=0,i=0;;n++){const a=i+s.child(n).nodeSize;if(n==t){let o=e+t*this.width;const l=(t+1)*this.width;for(;o<l&&this.map[o]<i;)o++;return o==l?a-1:this.map[o]}i=a}}static get(t){return mp(t)||pp(t,oB(t))}};function oB(t){if(t.type.spec.tableRole!="table")throw new RangeError("Not a table node: "+t.type.name);const e=lB(t),s=t.childCount,n=[];let i=0,a=null;const o=[];for(let u=0,d=e*s;u<d;u++)n[u]=0;for(let u=0,d=0;u<s;u++){const h=t.child(u);d++;for(let p=0;;p++){for(;i<n.length&&n[i]!=0;)i++;if(p==h.childCount)break;const x=h.child(p),{colspan:g,rowspan:y,colwidth:b}=x.attrs;for(let w=0;w<y;w++){if(w+u>=s){(a||(a=[])).push({type:"overlong_rowspan",pos:d,n:y-w});break}const S=i+w*e;for(let z=0;z<g;z++){n[S+z]==0?n[S+z]=d:(a||(a=[])).push({type:"collision",row:u,pos:d,n:g-z});const N=b&&b[z];if(N){const k=(S+z)%e*2,C=o[k];C==null||C!=N&&o[k+1]==1?(o[k]=N,o[k+1]=1):C==N&&o[k+1]++}}}i+=g,d+=x.nodeSize}const f=(u+1)*e;let m=0;for(;i<f;)n[i++]==0&&m++;m&&(a||(a=[])).push({type:"missing",row:u,n:m}),d++}(e===0||s===0)&&(a||(a=[])).push({type:"zero_sized"});const l=new ot(e,s,n,a);let c=!1;for(let u=0;!c&&u<o.length;u+=2)o[u]!=null&&o[u+1]<s&&(c=!0);return c&&cB(l,o,t),l}function lB(t){let e=-1,s=!1;for(let n=0;n<t.childCount;n++){const i=t.child(n);let a=0;if(s)for(let o=0;o<n;o++){const l=t.child(o);for(let c=0;c<l.childCount;c++){const u=l.child(c);o+u.attrs.rowspan>n&&(a+=u.attrs.colspan)}}for(let o=0;o<i.childCount;o++){const l=i.child(o);a+=l.attrs.colspan,l.attrs.rowspan>1&&(s=!0)}e==-1?e=a:e!=a&&(e=Math.max(e,a))}return e}function cB(t,e,s){t.problems||(t.problems=[]);const n={};for(let i=0;i<t.map.length;i++){const a=t.map[i];if(n[a])continue;n[a]=!0;const o=s.nodeAt(a);if(!o)throw new RangeError(`No cell with offset ${a} found`);let l=null;const c=o.attrs;for(let u=0;u<c.colspan;u++){const d=(i+u)%t.width,h=e[d*2];h!=null&&(!c.colwidth||c.colwidth[u]!=h)&&((l||(l=uB(c)))[u]=h)}l&&t.problems.unshift({type:"colwidth mismatch",pos:a,colwidth:l})}}function uB(t){if(t.colwidth)return t.colwidth.slice();const e=[];for(let s=0;s<t.colspan;s++)e.push(0);return e}function Zt(t){let e=t.cached.tableNodeTypes;if(!e){e=t.cached.tableNodeTypes={};for(const s in t.nodes){const n=t.nodes[s],i=n.spec.tableRole;i&&(e[i]=n)}}return e}var Ir=new ct("selectingCells");function vo(t){for(let e=t.depth-1;e>0;e--)if(t.node(e).type.spec.tableRole=="row")return t.node(0).resolve(t.before(e+1));return null}function dB(t){for(let e=t.depth;e>0;e--){const s=t.node(e).type.spec.tableRole;if(s==="cell"||s==="header_cell")return t.node(e)}return null}function bn(t){const e=t.selection.$head;for(let s=e.depth;s>0;s--)if(e.node(s).type.spec.tableRole=="row")return!0;return!1}function Oh(t){const e=t.selection;if("$anchorCell"in e&&e.$anchorCell)return e.$anchorCell.pos>e.$headCell.pos?e.$anchorCell:e.$headCell;if("node"in e&&e.node&&e.node.type.spec.tableRole=="cell")return e.$anchor;const s=vo(e.$head)||hB(e.$head);if(s)return s;throw new RangeError(`No cell found around position ${e.head}`)}function hB(t){for(let e=t.nodeAfter,s=t.pos;e;e=e.firstChild,s++){const n=e.type.spec.tableRole;if(n=="cell"||n=="header_cell")return t.doc.resolve(s)}for(let e=t.nodeBefore,s=t.pos;e;e=e.lastChild,s--){const n=e.type.spec.tableRole;if(n=="cell"||n=="header_cell")return t.doc.resolve(s-e.nodeSize)}}function xp(t){return t.parent.type.spec.tableRole=="row"&&!!t.nodeAfter}function fB(t){return t.node(0).resolve(t.pos+t.nodeAfter.nodeSize)}function kg(t,e){return t.depth==e.depth&&t.pos>=e.start(-1)&&t.pos<=e.end(-1)}function TC(t,e,s){const n=t.node(-1),i=ot.get(n),a=t.start(-1),o=i.nextCell(t.pos-a,e,s);return o==null?null:t.node(0).resolve(a+o)}function Wi(t,e,s=1){const n={...t,colspan:t.colspan-s};return n.colwidth&&(n.colwidth=n.colwidth.slice(),n.colwidth.splice(e,s),n.colwidth.some(i=>i>0)||(n.colwidth=null)),n}function EC(t,e,s=1){const n={...t,colspan:t.colspan+s};if(n.colwidth){n.colwidth=n.colwidth.slice();for(let i=0;i<s;i++)n.colwidth.splice(e,0,0)}return n}function mB(t,e,s){const n=Zt(e.type.schema).header_cell;for(let i=0;i<t.height;i++)if(e.nodeAt(t.map[s+i*t.width]).type!=n)return!1;return!0}var Fe=class Xn extends le{constructor(e,s=e){const n=e.node(-1),i=ot.get(n),a=e.start(-1),o=i.rectBetween(e.pos-a,s.pos-a),l=e.node(0),c=i.cellsInRect(o).filter(d=>d!=s.pos-a);c.unshift(s.pos-a);const u=c.map(d=>{const h=n.nodeAt(d);if(!h)throw RangeError(`No cell with offset ${d} found`);const f=a+d+1;return new E2(l.resolve(f),l.resolve(f+h.content.size))});super(u[0].$from,u[0].$to,u),this.$anchorCell=e,this.$headCell=s}map(e,s){const n=e.resolve(s.map(this.$anchorCell.pos)),i=e.resolve(s.map(this.$headCell.pos));if(xp(n)&&xp(i)&&kg(n,i)){const a=this.$anchorCell.node(-1)!=n.node(-1);return a&&this.isRowSelection()?Xn.rowSelection(n,i):a&&this.isColSelection()?Xn.colSelection(n,i):new Xn(n,i)}return re.between(n,i)}content(){const e=this.$anchorCell.node(-1),s=ot.get(e),n=this.$anchorCell.start(-1),i=s.rectBetween(this.$anchorCell.pos-n,this.$headCell.pos-n),a={},o=[];for(let c=i.top;c<i.bottom;c++){const u=[];for(let d=c*s.width+i.left,h=i.left;h<i.right;h++,d++){const f=s.map[d];if(a[f])continue;a[f]=!0;const m=s.findCell(f);let p=e.nodeAt(f);if(!p)throw RangeError(`No cell with offset ${f} found`);const x=i.left-m.left,g=m.right-i.right;if(x>0||g>0){let y=p.attrs;if(x>0&&(y=Wi(y,0,x)),g>0&&(y=Wi(y,y.colspan-g,g)),m.left<i.left){if(p=p.type.createAndFill(y),!p)throw RangeError(`Could not create cell with attrs ${JSON.stringify(y)}`)}else p=p.type.create(y,p.content)}if(m.top<i.top||m.bottom>i.bottom){const y={...p.attrs,rowspan:Math.min(m.bottom,i.bottom)-Math.max(m.top,i.top)};m.top<i.top?p=p.type.createAndFill(y):p=p.type.create(y,p.content)}u.push(p)}o.push(e.child(c).copy(q.from(u)))}const l=this.isColSelection()&&this.isRowSelection()?e:o;return new Q(q.from(l),1,1)}replace(e,s=Q.empty){const n=e.steps.length,i=this.ranges;for(let o=0;o<i.length;o++){const{$from:l,$to:c}=i[o],u=e.mapping.slice(n);e.replace(u.map(l.pos),u.map(c.pos),o?Q.empty:s)}const a=le.findFrom(e.doc.resolve(e.mapping.slice(n).map(this.to)),-1);a&&e.setSelection(a)}replaceWith(e,s){this.replace(e,new Q(q.from(s),0,0))}forEachCell(e){const s=this.$anchorCell.node(-1),n=ot.get(s),i=this.$anchorCell.start(-1),a=n.cellsInRect(n.rectBetween(this.$anchorCell.pos-i,this.$headCell.pos-i));for(let o=0;o<a.length;o++)e(s.nodeAt(a[o]),i+a[o])}isColSelection(){const e=this.$anchorCell.index(-1),s=this.$headCell.index(-1);if(Math.min(e,s)>0)return!1;const n=e+this.$anchorCell.nodeAfter.attrs.rowspan,i=s+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(n,i)==this.$headCell.node(-1).childCount}static colSelection(e,s=e){const n=e.node(-1),i=ot.get(n),a=e.start(-1),o=i.findCell(e.pos-a),l=i.findCell(s.pos-a),c=e.node(0);return o.top<=l.top?(o.top>0&&(e=c.resolve(a+i.map[o.left])),l.bottom<i.height&&(s=c.resolve(a+i.map[i.width*(i.height-1)+l.right-1]))):(l.top>0&&(s=c.resolve(a+i.map[l.left])),o.bottom<i.height&&(e=c.resolve(a+i.map[i.width*(i.height-1)+o.right-1]))),new Xn(e,s)}isRowSelection(){const e=this.$anchorCell.node(-1),s=ot.get(e),n=this.$anchorCell.start(-1),i=s.colCount(this.$anchorCell.pos-n),a=s.colCount(this.$headCell.pos-n);if(Math.min(i,a)>0)return!1;const o=i+this.$anchorCell.nodeAfter.attrs.colspan,l=a+this.$headCell.nodeAfter.attrs.colspan;return Math.max(o,l)==s.width}eq(e){return e instanceof Xn&&e.$anchorCell.pos==this.$anchorCell.pos&&e.$headCell.pos==this.$headCell.pos}static rowSelection(e,s=e){const n=e.node(-1),i=ot.get(n),a=e.start(-1),o=i.findCell(e.pos-a),l=i.findCell(s.pos-a),c=e.node(0);return o.left<=l.left?(o.left>0&&(e=c.resolve(a+i.map[o.top*i.width])),l.right<i.width&&(s=c.resolve(a+i.map[i.width*(l.top+1)-1]))):(l.left>0&&(s=c.resolve(a+i.map[l.top*i.width])),o.right<i.width&&(e=c.resolve(a+i.map[i.width*(o.top+1)-1]))),new Xn(e,s)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(e,s){return new Xn(e.resolve(s.anchor),e.resolve(s.head))}static create(e,s,n=s){return new Xn(e.resolve(s),e.resolve(n))}getBookmark(){return new pB(this.$anchorCell.pos,this.$headCell.pos)}};Fe.prototype.visible=!1;le.jsonID("cell",Fe);var pB=class DC{constructor(e,s){this.anchor=e,this.head=s}map(e){return new DC(e.map(this.anchor),e.map(this.head))}resolve(e){const s=e.resolve(this.anchor),n=e.resolve(this.head);return s.parent.type.spec.tableRole=="row"&&n.parent.type.spec.tableRole=="row"&&s.index()<s.parent.childCount&&n.index()<n.parent.childCount&&kg(s,n)?new Fe(s,n):le.near(n,1)}};function xB(t){if(!(t.selection instanceof Fe))return null;const e=[];return t.selection.forEachCell((s,n)=>{e.push(kt.node(n,n+s.nodeSize,{class:"selectedCell"}))}),Ie.create(t.doc,e)}function gB({$from:t,$to:e}){if(t.pos==e.pos||t.pos<e.pos-6)return!1;let s=t.pos,n=e.pos,i=t.depth;for(;i>=0&&!(t.after(i+1)<t.end(i));i--,s++);for(let a=e.depth;a>=0&&!(e.before(a+1)>e.start(a));a--,n--);return s==n&&/row|table/.test(t.node(i).type.spec.tableRole)}function yB({$from:t,$to:e}){let s,n;for(let i=t.depth;i>0;i--){const a=t.node(i);if(a.type.spec.tableRole==="cell"||a.type.spec.tableRole==="header_cell"){s=a;break}}for(let i=e.depth;i>0;i--){const a=e.node(i);if(a.type.spec.tableRole==="cell"||a.type.spec.tableRole==="header_cell"){n=a;break}}return s!==n&&e.parentOffset===0}function bB(t,e,s){const n=(e||t).selection,i=(e||t).doc;let a,o;if(n instanceof ne&&(o=n.node.type.spec.tableRole)){if(o=="cell"||o=="header_cell")a=Fe.create(i,n.from);else if(o=="row"){const l=i.resolve(n.from+1);a=Fe.rowSelection(l,l)}else if(!s){const l=ot.get(n.node),c=n.from+1,u=c+l.map[l.width*l.height-1];a=Fe.create(i,c+1,u)}}else n instanceof re&&gB(n)?a=re.create(i,n.from):n instanceof re&&yB(n)&&(a=re.create(i,n.$from.start(),n.$from.end()));return a&&(e||(e=t.tr)).setSelection(a),e}var jB=new ct("fix-tables");function MC(t,e,s,n){const i=t.childCount,a=e.childCount;e:for(let o=0,l=0;o<a;o++){const c=e.child(o);for(let u=l,d=Math.min(i,o+3);u<d;u++)if(t.child(u)==c){l=u+1,s+=c.nodeSize;continue e}n(c,s),l<i&&t.child(l).sameMarkup(c)?MC(t.child(l),c,s+1,n):c.nodesBetween(0,c.content.size,n,s+1),s+=c.nodeSize}}function PC(t,e){let s;const n=(i,a)=>{i.type.spec.tableRole=="table"&&(s=wB(t,i,a,s))};return e?e.doc!=t.doc&&MC(e.doc,t.doc,0,n):t.doc.descendants(n),s}function wB(t,e,s,n){const i=ot.get(e);if(!i.problems)return n;n||(n=t.tr);const a=[];for(let c=0;c<i.height;c++)a.push(0);for(let c=0;c<i.problems.length;c++){const u=i.problems[c];if(u.type=="collision"){const d=e.nodeAt(u.pos);if(!d)continue;const h=d.attrs;for(let f=0;f<h.rowspan;f++)a[u.row+f]+=u.n;n.setNodeMarkup(n.mapping.map(s+1+u.pos),null,Wi(h,h.colspan-u.n,u.n))}else if(u.type=="missing")a[u.row]+=u.n;else if(u.type=="overlong_rowspan"){const d=e.nodeAt(u.pos);if(!d)continue;n.setNodeMarkup(n.mapping.map(s+1+u.pos),null,{...d.attrs,rowspan:d.attrs.rowspan-u.n})}else if(u.type=="colwidth mismatch"){const d=e.nodeAt(u.pos);if(!d)continue;n.setNodeMarkup(n.mapping.map(s+1+u.pos),null,{...d.attrs,colwidth:u.colwidth})}else if(u.type=="zero_sized"){const d=n.mapping.map(s);n.delete(d,d+e.nodeSize)}}let o,l;for(let c=0;c<a.length;c++)a[c]&&(o==null&&(o=c),l=c);for(let c=0,u=s+1;c<i.height;c++){const d=e.child(c),h=u+d.nodeSize,f=a[c];if(f>0){let m="cell";d.firstChild&&(m=d.firstChild.type.spec.tableRole);const p=[];for(let g=0;g<f;g++){const y=Zt(t.schema)[m].createAndFill();y&&p.push(y)}const x=(c==0||o==c-1)&&l==c?u+1:h-1;n.insert(n.mapping.map(x),p)}u=h}return n.setMeta(jB,{fixTables:!0})}function Vn(t){const e=t.selection,s=Oh(t),n=s.node(-1),i=s.start(-1),a=ot.get(n);return{...e instanceof Fe?a.rectBetween(e.$anchorCell.pos-i,e.$headCell.pos-i):a.findCell(s.pos-i),tableStart:i,map:a,table:n}}function IC(t,{map:e,tableStart:s,table:n},i){let a=i>0?-1:0;mB(e,n,i+a)&&(a=i==0||i==e.width?null:0);for(let o=0;o<e.height;o++){const l=o*e.width+i;if(i>0&&i<e.width&&e.map[l-1]==e.map[l]){const c=e.map[l],u=n.nodeAt(c);t.setNodeMarkup(t.mapping.map(s+c),null,EC(u.attrs,i-e.colCount(c))),o+=u.attrs.rowspan-1}else{const c=a==null?Zt(n.type.schema).cell:n.nodeAt(e.map[l+a]).type,u=e.positionAt(o,i,n);t.insert(t.mapping.map(s+u),c.createAndFill())}}return t}function vB(t,e){if(!bn(t))return!1;if(e){const s=Vn(t);e(IC(t.tr,s,s.left))}return!0}function kB(t,e){if(!bn(t))return!1;if(e){const s=Vn(t);e(IC(t.tr,s,s.right))}return!0}function NB(t,{map:e,table:s,tableStart:n},i){const a=t.mapping.maps.length;for(let o=0;o<e.height;){const l=o*e.width+i,c=e.map[l],u=s.nodeAt(c),d=u.attrs;if(i>0&&e.map[l-1]==c||i<e.width-1&&e.map[l+1]==c)t.setNodeMarkup(t.mapping.slice(a).map(n+c),null,Wi(d,i-e.colCount(c)));else{const h=t.mapping.slice(a).map(n+c);t.delete(h,h+u.nodeSize)}o+=d.rowspan}}function SB(t,e){if(!bn(t))return!1;if(e){const s=Vn(t),n=t.tr;if(s.left==0&&s.right==s.map.width)return!1;for(let i=s.right-1;NB(n,s,i),i!=s.left;i--){const a=s.tableStart?n.doc.nodeAt(s.tableStart-1):n.doc;if(!a)throw RangeError("No table found");s.table=a,s.map=ot.get(a)}e(n)}return!0}function CB(t,e,s){var n;const i=Zt(e.type.schema).header_cell;for(let a=0;a<t.width;a++)if(((n=e.nodeAt(t.map[a+s*t.width]))==null?void 0:n.type)!=i)return!1;return!0}function OC(t,{map:e,tableStart:s,table:n},i){var a;let o=s;for(let u=0;u<i;u++)o+=n.child(u).nodeSize;const l=[];let c=i>0?-1:0;CB(e,n,i+c)&&(c=i==0||i==e.height?null:0);for(let u=0,d=e.width*i;u<e.width;u++,d++)if(i>0&&i<e.height&&e.map[d]==e.map[d-e.width]){const h=e.map[d],f=n.nodeAt(h).attrs;t.setNodeMarkup(s+h,null,{...f,rowspan:f.rowspan+1}),u+=f.colspan-1}else{const h=c==null?Zt(n.type.schema).cell:(a=n.nodeAt(e.map[d+c*e.width]))==null?void 0:a.type,f=h?.createAndFill();f&&l.push(f)}return t.insert(o,Zt(n.type.schema).row.create(null,l)),t}function zB(t,e){if(!bn(t))return!1;if(e){const s=Vn(t);e(OC(t.tr,s,s.top))}return!0}function _B(t,e){if(!bn(t))return!1;if(e){const s=Vn(t);e(OC(t.tr,s,s.bottom))}return!0}function AB(t,{map:e,table:s,tableStart:n},i){let a=0;for(let u=0;u<i;u++)a+=s.child(u).nodeSize;const o=a+s.child(i).nodeSize,l=t.mapping.maps.length;t.delete(a+n,o+n);const c=new Set;for(let u=0,d=i*e.width;u<e.width;u++,d++){const h=e.map[d];if(!c.has(h)){if(c.add(h),i>0&&h==e.map[d-e.width]){const f=s.nodeAt(h).attrs;t.setNodeMarkup(t.mapping.slice(l).map(h+n),null,{...f,rowspan:f.rowspan-1}),u+=f.colspan-1}else if(i<e.height&&h==e.map[d+e.width]){const f=s.nodeAt(h),m=f.attrs,p=f.type.create({...m,rowspan:f.attrs.rowspan-1},f.content),x=e.positionAt(i+1,u,s);t.insert(t.mapping.slice(l).map(n+x),p),u+=m.colspan-1}}}}function TB(t,e){if(!bn(t))return!1;if(e){const s=Vn(t),n=t.tr;if(s.top==0&&s.bottom==s.map.height)return!1;for(let i=s.bottom-1;AB(n,s,i),i!=s.top;i--){const a=s.tableStart?n.doc.nodeAt(s.tableStart-1):n.doc;if(!a)throw RangeError("No table found");s.table=a,s.map=ot.get(s.table)}e(n)}return!0}function Wb(t){const e=t.content;return e.childCount==1&&e.child(0).isTextblock&&e.child(0).childCount==0}function EB({width:t,height:e,map:s},n){let i=n.top*t+n.left,a=i,o=(n.bottom-1)*t+n.left,l=i+(n.right-n.left-1);for(let c=n.top;c<n.bottom;c++){if(n.left>0&&s[a]==s[a-1]||n.right<t&&s[l]==s[l+1])return!0;a+=t,l+=t}for(let c=n.left;c<n.right;c++){if(n.top>0&&s[i]==s[i-t]||n.bottom<e&&s[o]==s[o+t])return!0;i++,o++}return!1}function Kb(t,e){const s=t.selection;if(!(s instanceof Fe)||s.$anchorCell.pos==s.$headCell.pos)return!1;const n=Vn(t),{map:i}=n;if(EB(i,n))return!1;if(e){const a=t.tr,o={};let l=q.empty,c,u;for(let d=n.top;d<n.bottom;d++)for(let h=n.left;h<n.right;h++){const f=i.map[d*i.width+h],m=n.table.nodeAt(f);if(!(o[f]||!m))if(o[f]=!0,c==null)c=f,u=m;else{Wb(m)||(l=l.append(m.content));const p=a.mapping.map(f+n.tableStart);a.delete(p,p+m.nodeSize)}}if(c==null||u==null)return!0;if(a.setNodeMarkup(c+n.tableStart,null,{...EC(u.attrs,u.attrs.colspan,n.right-n.left-u.attrs.colspan),rowspan:n.bottom-n.top}),l.size){const d=c+1+u.content.size,h=Wb(u)?c+1:d;a.replaceWith(h+n.tableStart,d+n.tableStart,l)}a.setSelection(new Fe(a.doc.resolve(c+n.tableStart))),e(a)}return!0}function Hb(t,e){const s=Zt(t.schema);return DB(({node:n})=>s[n.type.spec.tableRole])(t,e)}function DB(t){return(e,s)=>{var n;const i=e.selection;let a,o;if(i instanceof Fe){if(i.$anchorCell.pos!=i.$headCell.pos)return!1;a=i.$anchorCell.nodeAfter,o=i.$anchorCell.pos}else{if(a=dB(i.$from),!a)return!1;o=(n=vo(i.$from))==null?void 0:n.pos}if(a==null||o==null||a.attrs.colspan==1&&a.attrs.rowspan==1)return!1;if(s){let l=a.attrs;const c=[],u=l.colwidth;l.rowspan>1&&(l={...l,rowspan:1}),l.colspan>1&&(l={...l,colspan:1});const d=Vn(e),h=e.tr;for(let m=0;m<d.right-d.left;m++)c.push(u?{...l,colwidth:u&&u[m]?[u[m]]:null}:l);let f;for(let m=d.top;m<d.bottom;m++){let p=d.map.positionAt(m,d.left,d.table);m==d.top&&(p+=a.nodeSize);for(let x=d.left,g=0;x<d.right;x++,g++)x==d.left&&m==d.top||h.insert(f=h.mapping.map(p+d.tableStart,1),t({node:a,row:m,col:x}).createAndFill(c[g]))}h.setNodeMarkup(o,t({node:a,row:d.top,col:d.left}),c[0]),i instanceof Fe&&h.setSelection(new Fe(h.doc.resolve(i.$anchorCell.pos),f?h.doc.resolve(f):void 0)),s(h)}return!0}}function MB(t,e){return function(s,n){if(!bn(s))return!1;const i=Oh(s);if(i.nodeAfter.attrs[t]===e)return!1;if(n){const a=s.tr;s.selection instanceof Fe?s.selection.forEachCell((o,l)=>{o.attrs[t]!==e&&a.setNodeMarkup(l,null,{...o.attrs,[t]:e})}):a.setNodeMarkup(i.pos,null,{...i.nodeAfter.attrs,[t]:e}),n(a)}return!0}}function PB(t){return function(e,s){if(!bn(e))return!1;if(s){const n=Zt(e.schema),i=Vn(e),a=e.tr,o=i.map.cellsInRect(t=="column"?{left:i.left,top:0,right:i.right,bottom:i.map.height}:t=="row"?{left:0,top:i.top,right:i.map.width,bottom:i.bottom}:i),l=o.map(c=>i.table.nodeAt(c));for(let c=0;c<o.length;c++)l[c].type==n.header_cell&&a.setNodeMarkup(i.tableStart+o[c],n.cell,l[c].attrs);if(a.steps.length==0)for(let c=0;c<o.length;c++)a.setNodeMarkup(i.tableStart+o[c],n.header_cell,l[c].attrs);s(a)}return!0}}function Gb(t,e,s){const n=e.map.cellsInRect({left:0,top:0,right:t=="row"?e.map.width:1,bottom:t=="column"?e.map.height:1});for(let i=0;i<n.length;i++){const a=e.table.nodeAt(n[i]);if(a&&a.type!==s.header_cell)return!1}return!0}function ql(t,e){return e=e||{useDeprecatedLogic:!1},e.useDeprecatedLogic?PB(t):function(s,n){if(!bn(s))return!1;if(n){const i=Zt(s.schema),a=Vn(s),o=s.tr,l=Gb("row",a,i),c=Gb("column",a,i),d=(t==="column"?l:t==="row"?c:!1)?1:0,h=t=="column"?{left:0,top:d,right:1,bottom:a.map.height}:t=="row"?{left:d,top:0,right:a.map.width,bottom:1}:a,f=t=="column"?c?i.cell:i.header_cell:t=="row"?l?i.cell:i.header_cell:i.cell;a.map.cellsInRect(h).forEach(m=>{const p=m+a.tableStart,x=o.doc.nodeAt(p);x&&o.setNodeMarkup(p,f,x.attrs)}),n(o)}return!0}}ql("row",{useDeprecatedLogic:!0});ql("column",{useDeprecatedLogic:!0});var IB=ql("cell",{useDeprecatedLogic:!0});function OB(t,e){if(e<0){const s=t.nodeBefore;if(s)return t.pos-s.nodeSize;for(let n=t.index(-1)-1,i=t.before();n>=0;n--){const a=t.node(-1).child(n),o=a.lastChild;if(o)return i-1-o.nodeSize;i-=a.nodeSize}}else{if(t.index()<t.parent.childCount-1)return t.pos+t.nodeAfter.nodeSize;const s=t.node(-1);for(let n=t.indexAfter(-1),i=t.after();n<s.childCount;n++){const a=s.child(n);if(a.childCount)return i+1;i+=a.nodeSize}}return null}function Jb(t){return function(e,s){if(!bn(e))return!1;const n=OB(Oh(e),t);if(n==null)return!1;if(s){const i=e.doc.resolve(n);s(e.tr.setSelection(re.between(i,fB(i))).scrollIntoView())}return!0}}function RB(t,e){const s=t.selection.$anchor;for(let n=s.depth;n>0;n--)if(s.node(n).type.spec.tableRole=="table")return e&&e(t.tr.delete(s.before(n),s.after(n)).scrollIntoView()),!0;return!1}function Kc(t,e){const s=t.selection;if(!(s instanceof Fe))return!1;if(e){const n=t.tr,i=Zt(t.schema).cell.createAndFill().content;s.forEachCell((a,o)=>{a.content.eq(i)||n.replace(n.mapping.map(o+1),n.mapping.map(o+a.nodeSize-1),new Q(i,0,0))}),n.docChanged&&e(n)}return!0}function LB(t){if(!t.size)return null;let{content:e,openStart:s,openEnd:n}=t;for(;e.childCount==1&&(s>0&&n>0||e.child(0).type.spec.tableRole=="table");)s--,n--,e=e.child(0).content;const i=e.child(0),a=i.type.spec.tableRole,o=i.type.schema,l=[];if(a=="row")for(let c=0;c<e.childCount;c++){let u=e.child(c).content;const d=c?0:Math.max(0,s-1),h=c<e.childCount-1?0:Math.max(0,n-1);(d||h)&&(u=gp(Zt(o).row,new Q(u,d,h)).content),l.push(u)}else if(a=="cell"||a=="header_cell")l.push(s||n?gp(Zt(o).row,new Q(e,s,n)).content:e);else return null;return FB(o,l)}function FB(t,e){const s=[];for(let i=0;i<e.length;i++){const a=e[i];for(let o=a.childCount-1;o>=0;o--){const{rowspan:l,colspan:c}=a.child(o).attrs;for(let u=i;u<i+l;u++)s[u]=(s[u]||0)+c}}let n=0;for(let i=0;i<s.length;i++)n=Math.max(n,s[i]);for(let i=0;i<s.length;i++)if(i>=e.length&&e.push(q.empty),s[i]<n){const a=Zt(t).cell.createAndFill(),o=[];for(let l=s[i];l<n;l++)o.push(a);e[i]=e[i].append(q.from(o))}return{height:e.length,width:n,rows:e}}function gp(t,e){const s=t.createAndFill();return new qx(s).replace(0,s.content.size,e).doc}function $B({width:t,height:e,rows:s},n,i){if(t!=n){const a=[],o=[];for(let l=0;l<s.length;l++){const c=s[l],u=[];for(let d=a[l]||0,h=0;d<n;h++){let f=c.child(h%c.childCount);d+f.attrs.colspan>n&&(f=f.type.createChecked(Wi(f.attrs,f.attrs.colspan,d+f.attrs.colspan-n),f.content)),u.push(f),d+=f.attrs.colspan;for(let m=1;m<f.attrs.rowspan;m++)a[l+m]=(a[l+m]||0)+f.attrs.colspan}o.push(q.from(u))}s=o,t=n}if(e!=i){const a=[];for(let o=0,l=0;o<i;o++,l++){const c=[],u=s[l%e];for(let d=0;d<u.childCount;d++){let h=u.child(d);o+h.attrs.rowspan>i&&(h=h.type.create({...h.attrs,rowspan:Math.max(1,i-h.attrs.rowspan)},h.content)),c.push(h)}a.push(q.from(c))}s=a,e=i}return{width:t,height:e,rows:s}}function BB(t,e,s,n,i,a,o){const l=t.doc.type.schema,c=Zt(l);let u,d;if(i>e.width)for(let h=0,f=0;h<e.height;h++){const m=s.child(h);f+=m.nodeSize;const p=[];let x;m.lastChild==null||m.lastChild.type==c.cell?x=u||(u=c.cell.createAndFill()):x=d||(d=c.header_cell.createAndFill());for(let g=e.width;g<i;g++)p.push(x);t.insert(t.mapping.slice(o).map(f-1+n),p)}if(a>e.height){const h=[];for(let p=0,x=(e.height-1)*e.width;p<Math.max(e.width,i);p++){const g=p>=e.width?!1:s.nodeAt(e.map[x+p]).type==c.header_cell;h.push(g?d||(d=c.header_cell.createAndFill()):u||(u=c.cell.createAndFill()))}const f=c.row.create(null,q.from(h)),m=[];for(let p=e.height;p<a;p++)m.push(f);t.insert(t.mapping.slice(o).map(n+s.nodeSize-2),m)}return!!(u||d)}function Zb(t,e,s,n,i,a,o,l){if(o==0||o==e.height)return!1;let c=!1;for(let u=i;u<a;u++){const d=o*e.width+u,h=e.map[d];if(e.map[d-e.width]==h){c=!0;const f=s.nodeAt(h),{top:m,left:p}=e.findCell(h);t.setNodeMarkup(t.mapping.slice(l).map(h+n),null,{...f.attrs,rowspan:o-m}),t.insert(t.mapping.slice(l).map(e.positionAt(o,p,s)),f.type.createAndFill({...f.attrs,rowspan:m+f.attrs.rowspan-o})),u+=f.attrs.colspan-1}}return c}function Qb(t,e,s,n,i,a,o,l){if(o==0||o==e.width)return!1;let c=!1;for(let u=i;u<a;u++){const d=u*e.width+o,h=e.map[d];if(e.map[d-1]==h){c=!0;const f=s.nodeAt(h),m=e.colCount(h),p=t.mapping.slice(l).map(h+n);t.setNodeMarkup(p,null,Wi(f.attrs,o-m,f.attrs.colspan-(o-m))),t.insert(p+f.nodeSize,f.type.createAndFill(Wi(f.attrs,0,o-m))),u+=f.attrs.rowspan-1}}return c}function Yb(t,e,s,n,i){let a=s?t.doc.nodeAt(s-1):t.doc;if(!a)throw new Error("No table found");let o=ot.get(a);const{top:l,left:c}=n,u=c+i.width,d=l+i.height,h=t.tr;let f=0;function m(){if(a=s?h.doc.nodeAt(s-1):h.doc,!a)throw new Error("No table found");o=ot.get(a),f=h.mapping.maps.length}BB(h,o,a,s,u,d,f)&&m(),Zb(h,o,a,s,c,u,l,f)&&m(),Zb(h,o,a,s,c,u,d,f)&&m(),Qb(h,o,a,s,l,d,c,f)&&m(),Qb(h,o,a,s,l,d,u,f)&&m();for(let p=l;p<d;p++){const x=o.positionAt(p,c,a),g=o.positionAt(p,u,a);h.replace(h.mapping.slice(f).map(x+s),h.mapping.slice(f).map(g+s),new Q(i.rows[p-l],0,0))}m(),h.setSelection(new Fe(h.doc.resolve(s+o.positionAt(l,c,a)),h.doc.resolve(s+o.positionAt(d-1,u-1,a)))),e(h)}var qB=Xx({ArrowLeft:Hc("horiz",-1),ArrowRight:Hc("horiz",1),ArrowUp:Hc("vert",-1),ArrowDown:Hc("vert",1),"Shift-ArrowLeft":Gc("horiz",-1),"Shift-ArrowRight":Gc("horiz",1),"Shift-ArrowUp":Gc("vert",-1),"Shift-ArrowDown":Gc("vert",1),Backspace:Kc,"Mod-Backspace":Kc,Delete:Kc,"Mod-Delete":Kc});function fu(t,e,s){return s.eq(t.selection)?!1:(e&&e(t.tr.setSelection(s).scrollIntoView()),!0)}function Hc(t,e){return(s,n,i)=>{if(!i)return!1;const a=s.selection;if(a instanceof Fe)return fu(s,n,le.near(a.$headCell,e));if(t!="horiz"&&!a.empty)return!1;const o=RC(i,t,e);if(o==null)return!1;if(t=="horiz")return fu(s,n,le.near(s.doc.resolve(a.head+e),e));{const l=s.doc.resolve(o),c=TC(l,t,e);let u;return c?u=le.near(c,1):e<0?u=le.near(s.doc.resolve(l.before(-1)),-1):u=le.near(s.doc.resolve(l.after(-1)),1),fu(s,n,u)}}}function Gc(t,e){return(s,n,i)=>{if(!i)return!1;const a=s.selection;let o;if(a instanceof Fe)o=a;else{const c=RC(i,t,e);if(c==null)return!1;o=new Fe(s.doc.resolve(c))}const l=TC(o.$headCell,t,e);return l?fu(s,n,new Fe(o.$anchorCell,l)):!1}}function VB(t,e){const s=t.state.doc,n=vo(s.resolve(e));return n?(t.dispatch(t.state.tr.setSelection(new Fe(n))),!0):!1}function UB(t,e,s){if(!bn(t.state))return!1;let n=LB(s);const i=t.state.selection;if(i instanceof Fe){n||(n={width:1,height:1,rows:[q.from(gp(Zt(t.state.schema).cell,s))]});const a=i.$anchorCell.node(-1),o=i.$anchorCell.start(-1),l=ot.get(a).rectBetween(i.$anchorCell.pos-o,i.$headCell.pos-o);return n=$B(n,l.right-l.left,l.bottom-l.top),Yb(t.state,t.dispatch,o,l,n),!0}else if(n){const a=Oh(t.state),o=a.start(-1);return Yb(t.state,t.dispatch,o,ot.get(a.node(-1)).findCell(a.pos-o),n),!0}else return!1}function WB(t,e){var s;if(e.ctrlKey||e.metaKey)return;const n=Xb(t,e.target);let i;if(e.shiftKey&&t.state.selection instanceof Fe)a(t.state.selection.$anchorCell,e),e.preventDefault();else if(e.shiftKey&&n&&(i=vo(t.state.selection.$anchor))!=null&&((s=Wf(t,e))==null?void 0:s.pos)!=i.pos)a(i,e),e.preventDefault();else if(!n)return;function a(c,u){let d=Wf(t,u);const h=Ir.getState(t.state)==null;if(!d||!kg(c,d))if(h)d=c;else return;const f=new Fe(c,d);if(h||!t.state.selection.eq(f)){const m=t.state.tr.setSelection(f);h&&m.setMeta(Ir,c.pos),t.dispatch(m)}}function o(){t.root.removeEventListener("mouseup",o),t.root.removeEventListener("dragstart",o),t.root.removeEventListener("mousemove",l),Ir.getState(t.state)!=null&&t.dispatch(t.state.tr.setMeta(Ir,-1))}function l(c){const u=c,d=Ir.getState(t.state);let h;if(d!=null)h=t.state.doc.resolve(d);else if(Xb(t,u.target)!=n&&(h=Wf(t,e),!h))return o();h&&a(h,u)}t.root.addEventListener("mouseup",o),t.root.addEventListener("dragstart",o),t.root.addEventListener("mousemove",l)}function RC(t,e,s){if(!(t.state.selection instanceof re))return null;const{$head:n}=t.state.selection;for(let i=n.depth-1;i>=0;i--){const a=n.node(i);if((s<0?n.index(i):n.indexAfter(i))!=(s<0?0:a.childCount))return null;if(a.type.spec.tableRole=="cell"||a.type.spec.tableRole=="header_cell"){const l=n.before(i),c=e=="vert"?s>0?"down":"up":s>0?"right":"left";return t.endOfTextblock(c)?l:null}}return null}function Xb(t,e){for(;e&&e!=t.dom;e=e.parentNode)if(e.nodeName=="TD"||e.nodeName=="TH")return e;return null}function Wf(t,e){const s=t.posAtCoords({left:e.clientX,top:e.clientY});return s&&s?vo(t.state.doc.resolve(s.pos)):null}var KB=class{constructor(e,s){this.node=e,this.defaultCellMinWidth=s,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.table.style.setProperty("--default-cell-min-width",`${s}px`),this.colgroup=this.table.appendChild(document.createElement("colgroup")),yp(e,this.colgroup,this.table,s),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type!=this.node.type?!1:(this.node=e,yp(e,this.colgroup,this.table,this.defaultCellMinWidth),!0)}ignoreMutation(e){return e.type=="attributes"&&(e.target==this.table||this.colgroup.contains(e.target))}};function yp(t,e,s,n,i,a){var o;let l=0,c=!0,u=e.firstChild;const d=t.firstChild;if(d){for(let h=0,f=0;h<d.childCount;h++){const{colspan:m,colwidth:p}=d.child(h).attrs;for(let x=0;x<m;x++,f++){const g=i==f?a:p&&p[x],y=g?g+"px":"";if(l+=g||n,g||(c=!1),u)u.style.width!=y&&(u.style.width=y),u=u.nextSibling;else{const b=document.createElement("col");b.style.width=y,e.appendChild(b)}}}for(;u;){const h=u.nextSibling;(o=u.parentNode)==null||o.removeChild(u),u=h}c?(s.style.width=l+"px",s.style.minWidth=""):(s.style.width="",s.style.minWidth=l+"px")}}var Es=new ct("tableColumnResizing");function HB({handleWidth:t=5,cellMinWidth:e=25,defaultCellMinWidth:s=100,View:n=KB,lastColumnResizable:i=!0}={}){const a=new $e({key:Es,state:{init(o,l){var c,u;const d=(u=(c=a.spec)==null?void 0:c.props)==null?void 0:u.nodeViews,h=Zt(l.schema).table.name;return n&&d&&(d[h]=(f,m)=>new n(f,s,m)),new GB(-1,!1)},apply(o,l){return l.apply(o)}},props:{attributes:o=>{const l=Es.getState(o);return l&&l.activeHandle>-1?{class:"resize-cursor"}:{}},handleDOMEvents:{mousemove:(o,l)=>{JB(o,l,t,i)},mouseleave:o=>{ZB(o)},mousedown:(o,l)=>{QB(o,l,e,s)}},decorations:o=>{const l=Es.getState(o);if(l&&l.activeHandle>-1)return s7(o,l.activeHandle)},nodeViews:{}}});return a}var GB=class mu{constructor(e,s){this.activeHandle=e,this.dragging=s}apply(e){const s=this,n=e.getMeta(Es);if(n&&n.setHandle!=null)return new mu(n.setHandle,!1);if(n&&n.setDragging!==void 0)return new mu(s.activeHandle,n.setDragging);if(s.activeHandle>-1&&e.docChanged){let i=e.mapping.map(s.activeHandle,-1);return xp(e.doc.resolve(i))||(i=-1),new mu(i,s.dragging)}return s}};function JB(t,e,s,n){if(!t.editable)return;const i=Es.getState(t.state);if(i&&!i.dragging){const a=XB(e.target);let o=-1;if(a){const{left:l,right:c}=a.getBoundingClientRect();e.clientX-l<=s?o=ej(t,e,"left",s):c-e.clientX<=s&&(o=ej(t,e,"right",s))}if(o!=i.activeHandle){if(!n&&o!==-1){const l=t.state.doc.resolve(o),c=l.node(-1),u=ot.get(c),d=l.start(-1);if(u.colCount(l.pos-d)+l.nodeAfter.attrs.colspan-1==u.width-1)return}LC(t,o)}}}function ZB(t){if(!t.editable)return;const e=Es.getState(t.state);e&&e.activeHandle>-1&&!e.dragging&&LC(t,-1)}function QB(t,e,s,n){var i;if(!t.editable)return!1;const a=(i=t.dom.ownerDocument.defaultView)!=null?i:window,o=Es.getState(t.state);if(!o||o.activeHandle==-1||o.dragging)return!1;const l=t.state.doc.nodeAt(o.activeHandle),c=YB(t,o.activeHandle,l.attrs);t.dispatch(t.state.tr.setMeta(Es,{setDragging:{startX:e.clientX,startWidth:c}}));function u(h){a.removeEventListener("mouseup",u),a.removeEventListener("mousemove",d);const f=Es.getState(t.state);f?.dragging&&(e7(t,f.activeHandle,tj(f.dragging,h,s)),t.dispatch(t.state.tr.setMeta(Es,{setDragging:null})))}function d(h){if(!h.which)return u(h);const f=Es.getState(t.state);if(f&&f.dragging){const m=tj(f.dragging,h,s);sj(t,f.activeHandle,m,n)}}return sj(t,o.activeHandle,c,n),a.addEventListener("mouseup",u),a.addEventListener("mousemove",d),e.preventDefault(),!0}function YB(t,e,{colspan:s,colwidth:n}){const i=n&&n[n.length-1];if(i)return i;const a=t.domAtPos(e);let l=a.node.childNodes[a.offset].offsetWidth,c=s;if(n)for(let u=0;u<s;u++)n[u]&&(l-=n[u],c--);return l/c}function XB(t){for(;t&&t.nodeName!="TD"&&t.nodeName!="TH";)t=t.classList&&t.classList.contains("ProseMirror")?null:t.parentNode;return t}function ej(t,e,s,n){const i=s=="right"?-n:n,a=t.posAtCoords({left:e.clientX+i,top:e.clientY});if(!a)return-1;const{pos:o}=a,l=vo(t.state.doc.resolve(o));if(!l)return-1;if(s=="right")return l.pos;const c=ot.get(l.node(-1)),u=l.start(-1),d=c.map.indexOf(l.pos-u);return d%c.width==0?-1:u+c.map[d-1]}function tj(t,e,s){const n=e.clientX-t.startX;return Math.max(s,t.startWidth+n)}function LC(t,e){t.dispatch(t.state.tr.setMeta(Es,{setHandle:e}))}function e7(t,e,s){const n=t.state.doc.resolve(e),i=n.node(-1),a=ot.get(i),o=n.start(-1),l=a.colCount(n.pos-o)+n.nodeAfter.attrs.colspan-1,c=t.state.tr;for(let u=0;u<a.height;u++){const d=u*a.width+l;if(u&&a.map[d]==a.map[d-a.width])continue;const h=a.map[d],f=i.nodeAt(h).attrs,m=f.colspan==1?0:l-a.colCount(h);if(f.colwidth&&f.colwidth[m]==s)continue;const p=f.colwidth?f.colwidth.slice():t7(f.colspan);p[m]=s,c.setNodeMarkup(o+h,null,{...f,colwidth:p})}c.docChanged&&t.dispatch(c)}function sj(t,e,s,n){const i=t.state.doc.resolve(e),a=i.node(-1),o=i.start(-1),l=ot.get(a).colCount(i.pos-o)+i.nodeAfter.attrs.colspan-1;let c=t.domAtPos(i.start(-1)).node;for(;c&&c.nodeName!="TABLE";)c=c.parentNode;c&&yp(a,c.firstChild,c,n,l,s)}function t7(t){return Array(t).fill(0)}function s7(t,e){var s;const n=[],i=t.doc.resolve(e),a=i.node(-1);if(!a)return Ie.empty;const o=ot.get(a),l=i.start(-1),c=o.colCount(i.pos-l)+i.nodeAfter.attrs.colspan-1;for(let u=0;u<o.height;u++){const d=c+u*o.width;if((c==o.width-1||o.map[d]!=o.map[d+1])&&(u==0||o.map[d]!=o.map[d-o.width])){const h=o.map[d],f=l+h+a.nodeAt(h).nodeSize-1,m=document.createElement("div");m.className="column-resize-handle",(s=Es.getState(t))!=null&&s.dragging&&n.push(kt.node(l+h,l+h+a.nodeAt(h).nodeSize,{class:"column-resize-dragging"})),n.push(kt.widget(f,m))}}return Ie.create(t.doc,n)}function n7({allowTableNodeSelection:t=!1}={}){return new $e({key:Ir,state:{init(){return null},apply(e,s){const n=e.getMeta(Ir);if(n!=null)return n==-1?null:n;if(s==null||!e.docChanged)return s;const{deleted:i,pos:a}=e.mapping.mapResult(s);return i?null:a}},props:{decorations:xB,handleDOMEvents:{mousedown:WB},createSelectionBetween(e){return Ir.getState(e.state)!=null?e.state.selection:null},handleTripleClick:VB,handleKeyDown:qB,handlePaste:UB},appendTransaction(e,s,n){return bB(n,PC(n,s),t)}})}var FC=Ne.create({name:"tableCell",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{var e,s;const n=t.getAttribute("colwidth"),i=n?n.split(",").map(a=>parseInt(a,10)):null;if(!i){const a=(e=t.closest("table"))==null?void 0:e.querySelectorAll("colgroup > col"),o=Array.from(((s=t.parentElement)==null?void 0:s.children)||[]).indexOf(t);if(o&&o>-1&&a&&a[o]){const l=a[o].getAttribute("width");return l?[parseInt(l,10)]:null}}return i}}}},tableRole:"cell",isolating:!0,parseHTML(){return[{tag:"td"}]},renderHTML({HTMLAttributes:t}){return["td",Ye(this.options.HTMLAttributes,t),0]}}),$C=Ne.create({name:"tableHeader",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{const e=t.getAttribute("colwidth");return e?e.split(",").map(n=>parseInt(n,10)):null}}}},tableRole:"header_cell",isolating:!0,parseHTML(){return[{tag:"th"}]},renderHTML({HTMLAttributes:t}){return["th",Ye(this.options.HTMLAttributes,t),0]}}),BC=Ne.create({name:"tableRow",addOptions(){return{HTMLAttributes:{}}},content:"(tableCell | tableHeader)*",tableRole:"row",parseHTML(){return[{tag:"tr"}]},renderHTML({HTMLAttributes:t}){return["tr",Ye(this.options.HTMLAttributes,t),0]}});function bp(t,e){return e?["width",`${Math.max(e,t)}px`]:["min-width",`${t}px`]}function nj(t,e,s,n,i,a){var o;let l=0,c=!0,u=e.firstChild;const d=t.firstChild;if(d!==null)for(let h=0,f=0;h<d.childCount;h+=1){const{colspan:m,colwidth:p}=d.child(h).attrs;for(let x=0;x<m;x+=1,f+=1){const g=i===f?a:p&&p[x],y=g?`${g}px`:"";if(l+=g||n,g||(c=!1),u){if(u.style.width!==y){const[b,w]=bp(n,g);u.style.setProperty(b,w)}u=u.nextSibling}else{const b=document.createElement("col"),[w,S]=bp(n,g);b.style.setProperty(w,S),e.appendChild(b)}}}for(;u;){const h=u.nextSibling;(o=u.parentNode)==null||o.removeChild(u),u=h}c?(s.style.width=`${l}px`,s.style.minWidth=""):(s.style.width="",s.style.minWidth=`${l}px`)}var r7=class{constructor(t,e){this.node=t,this.cellMinWidth=e,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),nj(t,this.colgroup,this.table,e),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(t){return t.type!==this.node.type?!1:(this.node=t,nj(t,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(t){const e=t.target,s=this.dom.contains(e),n=this.contentDOM.contains(e);return!!(s&&!n&&(t.type==="attributes"||t.type==="childList"||t.type==="characterData"))}};function i7(t,e,s,n){let i=0,a=!0;const o=[],l=t.firstChild;if(!l)return{};for(let h=0,f=0;h<l.childCount;h+=1){const{colspan:m,colwidth:p}=l.child(h).attrs;for(let x=0;x<m;x+=1,f+=1){const g=s===f?n:p&&p[x];i+=g||e,g||(a=!1);const[y,b]=bp(e,g);o.push(["col",{style:`${y}: ${b}`}])}}const c=a?`${i}px`:"",u=a?"":`${i}px`;return{colgroup:["colgroup",{},...o],tableWidth:c,tableMinWidth:u}}function rj(t,e){return t.createAndFill()}function a7(t){if(t.cached.tableNodeTypes)return t.cached.tableNodeTypes;const e={};return Object.keys(t.nodes).forEach(s=>{const n=t.nodes[s];n.spec.tableRole&&(e[n.spec.tableRole]=n)}),t.cached.tableNodeTypes=e,e}function o7(t,e,s,n,i){const a=a7(t),o=[],l=[];for(let u=0;u<s;u+=1){const d=rj(a.cell);if(d&&l.push(d),n){const h=rj(a.header_cell);h&&o.push(h)}}const c=[];for(let u=0;u<e;u+=1)c.push(a.row.createChecked(null,n&&u===0?o:l));return a.table.createChecked(null,c)}function l7(t){return t instanceof Fe}var Jc=({editor:t})=>{const{selection:e}=t.state;if(!l7(e))return!1;let s=0;const n=AS(e.ranges[0].$from,a=>a.type.name==="table");return n?.node.descendants(a=>{if(a.type.name==="table")return!1;["tableCell","tableHeader"].includes(a.type.name)&&(s+=1)}),s===e.ranges.length?(t.commands.deleteTable(),!0):!1},qC=Ne.create({name:"table",addOptions(){return{HTMLAttributes:{},resizable:!1,handleWidth:5,cellMinWidth:25,View:r7,lastColumnResizable:!0,allowTableNodeSelection:!1}},content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML(){return[{tag:"table"}]},renderHTML({node:t,HTMLAttributes:e}){const{colgroup:s,tableWidth:n,tableMinWidth:i}=i7(t,this.options.cellMinWidth);return["table",Ye(this.options.HTMLAttributes,e,{style:n?`width: ${n}`:`min-width: ${i}`}),s,["tbody",0]]},addCommands(){return{insertTable:({rows:t=3,cols:e=3,withHeaderRow:s=!0}={})=>({tr:n,dispatch:i,editor:a})=>{const o=o7(a.schema,t,e,s);if(i){const l=n.selection.from+1;n.replaceSelectionWith(o).scrollIntoView().setSelection(re.near(n.doc.resolve(l)))}return!0},addColumnBefore:()=>({state:t,dispatch:e})=>vB(t,e),addColumnAfter:()=>({state:t,dispatch:e})=>kB(t,e),deleteColumn:()=>({state:t,dispatch:e})=>SB(t,e),addRowBefore:()=>({state:t,dispatch:e})=>zB(t,e),addRowAfter:()=>({state:t,dispatch:e})=>_B(t,e),deleteRow:()=>({state:t,dispatch:e})=>TB(t,e),deleteTable:()=>({state:t,dispatch:e})=>RB(t,e),mergeCells:()=>({state:t,dispatch:e})=>Kb(t,e),splitCell:()=>({state:t,dispatch:e})=>Hb(t,e),toggleHeaderColumn:()=>({state:t,dispatch:e})=>ql("column")(t,e),toggleHeaderRow:()=>({state:t,dispatch:e})=>ql("row")(t,e),toggleHeaderCell:()=>({state:t,dispatch:e})=>IB(t,e),mergeOrSplit:()=>({state:t,dispatch:e})=>Kb(t,e)?!0:Hb(t,e),setCellAttribute:(t,e)=>({state:s,dispatch:n})=>MB(t,e)(s,n),goToNextCell:()=>({state:t,dispatch:e})=>Jb(1)(t,e),goToPreviousCell:()=>({state:t,dispatch:e})=>Jb(-1)(t,e),fixTables:()=>({state:t,dispatch:e})=>(e&&PC(t),!0),setCellSelection:t=>({tr:e,dispatch:s})=>{if(s){const n=Fe.create(e.doc,t.anchorCell,t.headCell);e.setSelection(n)}return!0}}},addKeyboardShortcuts(){return{Tab:()=>this.editor.commands.goToNextCell()?!0:this.editor.can().addRowAfter()?this.editor.chain().addRowAfter().goToNextCell().run():!1,"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:Jc,"Mod-Backspace":Jc,Delete:Jc,"Mod-Delete":Jc}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[HB({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,defaultCellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],n7({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema(t){const e={name:t.name,options:t.options,storage:t.storage};return{tableRole:Ce(se(t,"tableRole",e))}}});qe.create({name:"tableKit",addExtensions(){const t=[];return this.options.table!==!1&&t.push(qC.configure(this.options.table)),this.options.tableCell!==!1&&t.push(FC.configure(this.options.tableCell)),this.options.tableHeader!==!1&&t.push($C.configure(this.options.tableHeader)),this.options.tableRow!==!1&&t.push(BC.configure(this.options.tableRow)),t}});const ij={};function c7(t){let e=ij[t];if(e)return e;e=ij[t]=[];for(let s=0;s<128;s++){const n=String.fromCharCode(s);e.push(n)}for(let s=0;s<t.length;s++){const n=t.charCodeAt(s);e[n]="%"+("0"+n.toString(16).toUpperCase()).slice(-2)}return e}function io(t,e){typeof e!="string"&&(e=io.defaultChars);const s=c7(e);return t.replace(/(%[a-f0-9]{2})+/gi,function(n){let i="";for(let a=0,o=n.length;a<o;a+=3){const l=parseInt(n.slice(a+1,a+3),16);if(l<128){i+=s[l];continue}if((l&224)===192&&a+3<o){const c=parseInt(n.slice(a+4,a+6),16);if((c&192)===128){const u=l<<6&1984|c&63;u<128?i+="��":i+=String.fromCharCode(u),a+=3;continue}}if((l&240)===224&&a+6<o){const c=parseInt(n.slice(a+4,a+6),16),u=parseInt(n.slice(a+7,a+9),16);if((c&192)===128&&(u&192)===128){const d=l<<12&61440|c<<6&4032|u&63;d<2048||d>=55296&&d<=57343?i+="���":i+=String.fromCharCode(d),a+=6;continue}}if((l&248)===240&&a+9<o){const c=parseInt(n.slice(a+4,a+6),16),u=parseInt(n.slice(a+7,a+9),16),d=parseInt(n.slice(a+10,a+12),16);if((c&192)===128&&(u&192)===128&&(d&192)===128){let h=l<<18&1835008|c<<12&258048|u<<6&4032|d&63;h<65536||h>1114111?i+="����":(h-=65536,i+=String.fromCharCode(55296+(h>>10),56320+(h&1023))),a+=9;continue}}i+="�"}return i})}io.defaultChars=";/?:@&=+$,#";io.componentChars="";const aj={};function u7(t){let e=aj[t];if(e)return e;e=aj[t]=[];for(let s=0;s<128;s++){const n=String.fromCharCode(s);/^[0-9a-z]$/i.test(n)?e.push(n):e.push("%"+("0"+s.toString(16).toUpperCase()).slice(-2))}for(let s=0;s<t.length;s++)e[t.charCodeAt(s)]=t[s];return e}function xc(t,e,s){typeof e!="string"&&(s=e,e=xc.defaultChars),typeof s>"u"&&(s=!0);const n=u7(e);let i="";for(let a=0,o=t.length;a<o;a++){const l=t.charCodeAt(a);if(s&&l===37&&a+2<o&&/^[0-9a-f]{2}$/i.test(t.slice(a+1,a+3))){i+=t.slice(a,a+3),a+=2;continue}if(l<128){i+=n[l];continue}if(l>=55296&&l<=57343){if(l>=55296&&l<=56319&&a+1<o){const c=t.charCodeAt(a+1);if(c>=56320&&c<=57343){i+=encodeURIComponent(t[a]+t[a+1]),a++;continue}}i+="%EF%BF%BD";continue}i+=encodeURIComponent(t[a])}return i}xc.defaultChars=";/?:@&=+$,-_.!~*'()#";xc.componentChars="-_.!~*'()";function Ng(t){let e="";return e+=t.protocol||"",e+=t.slashes?"//":"",e+=t.auth?t.auth+"@":"",t.hostname&&t.hostname.indexOf(":")!==-1?e+="["+t.hostname+"]":e+=t.hostname||"",e+=t.port?":"+t.port:"",e+=t.pathname||"",e+=t.search||"",e+=t.hash||"",e}function Cd(){this.protocol=null,this.slashes=null,this.auth=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.pathname=null}const d7=/^([a-z0-9.+-]+:)/i,h7=/:[0-9]*$/,f7=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,m7=["<",">",'"',"`"," ","\r",`
`,"	"],p7=["{","}","|","\\","^","`"].concat(m7),x7=["'"].concat(p7),oj=["%","/","?",";","#"].concat(x7),lj=["/","?","#"],g7=255,cj=/^[+a-z0-9A-Z_-]{0,63}$/,y7=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,uj={javascript:!0,"javascript:":!0},dj={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function Sg(t,e){if(t&&t instanceof Cd)return t;const s=new Cd;return s.parse(t,e),s}Cd.prototype.parse=function(t,e){let s,n,i,a=t;if(a=a.trim(),!e&&t.split("#").length===1){const u=f7.exec(a);if(u)return this.pathname=u[1],u[2]&&(this.search=u[2]),this}let o=d7.exec(a);if(o&&(o=o[0],s=o.toLowerCase(),this.protocol=o,a=a.substr(o.length)),(e||o||a.match(/^\/\/[^@\/]+@[^@\/]+/))&&(i=a.substr(0,2)==="//",i&&!(o&&uj[o])&&(a=a.substr(2),this.slashes=!0)),!uj[o]&&(i||o&&!dj[o])){let u=-1;for(let p=0;p<lj.length;p++)n=a.indexOf(lj[p]),n!==-1&&(u===-1||n<u)&&(u=n);let d,h;u===-1?h=a.lastIndexOf("@"):h=a.lastIndexOf("@",u),h!==-1&&(d=a.slice(0,h),a=a.slice(h+1),this.auth=d),u=-1;for(let p=0;p<oj.length;p++)n=a.indexOf(oj[p]),n!==-1&&(u===-1||n<u)&&(u=n);u===-1&&(u=a.length),a[u-1]===":"&&u--;const f=a.slice(0,u);a=a.slice(u),this.parseHost(f),this.hostname=this.hostname||"";const m=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!m){const p=this.hostname.split(/\./);for(let x=0,g=p.length;x<g;x++){const y=p[x];if(y&&!y.match(cj)){let b="";for(let w=0,S=y.length;w<S;w++)y.charCodeAt(w)>127?b+="x":b+=y[w];if(!b.match(cj)){const w=p.slice(0,x),S=p.slice(x+1),z=y.match(y7);z&&(w.push(z[1]),S.unshift(z[2])),S.length&&(a=S.join(".")+a),this.hostname=w.join(".");break}}}}this.hostname.length>g7&&(this.hostname=""),m&&(this.hostname=this.hostname.substr(1,this.hostname.length-2))}const l=a.indexOf("#");l!==-1&&(this.hash=a.substr(l),a=a.slice(0,l));const c=a.indexOf("?");return c!==-1&&(this.search=a.substr(c),a=a.slice(0,c)),a&&(this.pathname=a),dj[s]&&this.hostname&&!this.pathname&&(this.pathname=""),this};Cd.prototype.parseHost=function(t){let e=h7.exec(t);e&&(e=e[0],e!==":"&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)};const b7=Object.freeze(Object.defineProperty({__proto__:null,decode:io,encode:xc,format:Ng,parse:Sg},Symbol.toStringTag,{value:"Module"})),VC=/[\0-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,UC=/[\0-\x1F\x7F-\x9F]/,j7=/[\xAD\u0600-\u0605\u061C\u06DD\u070F\u0890\u0891\u08E2\u180E\u200B-\u200F\u202A-\u202E\u2060-\u2064\u2066-\u206F\uFEFF\uFFF9-\uFFFB]|\uD804[\uDCBD\uDCCD]|\uD80D[\uDC30-\uDC3F]|\uD82F[\uDCA0-\uDCA3]|\uD834[\uDD73-\uDD7A]|\uDB40[\uDC01\uDC20-\uDC7F]/,Cg=/[!-#%-\*,-\/:;\?@\[-\]_\{\}\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061D-\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1B7D\u1B7E\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52-\u2E5D\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59\uDF86-\uDF89]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDEB9\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2\uDF00-\uDF09]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDF43-\uDF4F\uDFFF]|\uD809[\uDC70-\uDC74]|\uD80B[\uDFF1\uDFF2]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]/,WC=/[\$\+<->\^`\|~\xA2-\xA6\xA8\xA9\xAC\xAE-\xB1\xB4\xB8\xD7\xF7\u02C2-\u02C5\u02D2-\u02DF\u02E5-\u02EB\u02ED\u02EF-\u02FF\u0375\u0384\u0385\u03F6\u0482\u058D-\u058F\u0606-\u0608\u060B\u060E\u060F\u06DE\u06E9\u06FD\u06FE\u07F6\u07FE\u07FF\u0888\u09F2\u09F3\u09FA\u09FB\u0AF1\u0B70\u0BF3-\u0BFA\u0C7F\u0D4F\u0D79\u0E3F\u0F01-\u0F03\u0F13\u0F15-\u0F17\u0F1A-\u0F1F\u0F34\u0F36\u0F38\u0FBE-\u0FC5\u0FC7-\u0FCC\u0FCE\u0FCF\u0FD5-\u0FD8\u109E\u109F\u1390-\u1399\u166D\u17DB\u1940\u19DE-\u19FF\u1B61-\u1B6A\u1B74-\u1B7C\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2044\u2052\u207A-\u207C\u208A-\u208C\u20A0-\u20C0\u2100\u2101\u2103-\u2106\u2108\u2109\u2114\u2116-\u2118\u211E-\u2123\u2125\u2127\u2129\u212E\u213A\u213B\u2140-\u2144\u214A-\u214D\u214F\u218A\u218B\u2190-\u2307\u230C-\u2328\u232B-\u2426\u2440-\u244A\u249C-\u24E9\u2500-\u2767\u2794-\u27C4\u27C7-\u27E5\u27F0-\u2982\u2999-\u29D7\u29DC-\u29FB\u29FE-\u2B73\u2B76-\u2B95\u2B97-\u2BFF\u2CE5-\u2CEA\u2E50\u2E51\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFF\u3004\u3012\u3013\u3020\u3036\u3037\u303E\u303F\u309B\u309C\u3190\u3191\u3196-\u319F\u31C0-\u31E3\u31EF\u3200-\u321E\u322A-\u3247\u3250\u3260-\u327F\u328A-\u32B0\u32C0-\u33FF\u4DC0-\u4DFF\uA490-\uA4C6\uA700-\uA716\uA720\uA721\uA789\uA78A\uA828-\uA82B\uA836-\uA839\uAA77-\uAA79\uAB5B\uAB6A\uAB6B\uFB29\uFBB2-\uFBC2\uFD40-\uFD4F\uFDCF\uFDFC-\uFDFF\uFE62\uFE64-\uFE66\uFE69\uFF04\uFF0B\uFF1C-\uFF1E\uFF3E\uFF40\uFF5C\uFF5E\uFFE0-\uFFE6\uFFE8-\uFFEE\uFFFC\uFFFD]|\uD800[\uDD37-\uDD3F\uDD79-\uDD89\uDD8C-\uDD8E\uDD90-\uDD9C\uDDA0\uDDD0-\uDDFC]|\uD802[\uDC77\uDC78\uDEC8]|\uD805\uDF3F|\uD807[\uDFD5-\uDFF1]|\uD81A[\uDF3C-\uDF3F\uDF45]|\uD82F\uDC9C|\uD833[\uDF50-\uDFC3]|\uD834[\uDC00-\uDCF5\uDD00-\uDD26\uDD29-\uDD64\uDD6A-\uDD6C\uDD83\uDD84\uDD8C-\uDDA9\uDDAE-\uDDEA\uDE00-\uDE41\uDE45\uDF00-\uDF56]|\uD835[\uDEC1\uDEDB\uDEFB\uDF15\uDF35\uDF4F\uDF6F\uDF89\uDFA9\uDFC3]|\uD836[\uDC00-\uDDFF\uDE37-\uDE3A\uDE6D-\uDE74\uDE76-\uDE83\uDE85\uDE86]|\uD838[\uDD4F\uDEFF]|\uD83B[\uDCAC\uDCB0\uDD2E\uDEF0\uDEF1]|\uD83C[\uDC00-\uDC2B\uDC30-\uDC93\uDCA0-\uDCAE\uDCB1-\uDCBF\uDCC1-\uDCCF\uDCD1-\uDCF5\uDD0D-\uDDAD\uDDE6-\uDE02\uDE10-\uDE3B\uDE40-\uDE48\uDE50\uDE51\uDE60-\uDE65\uDF00-\uDFFF]|\uD83D[\uDC00-\uDED7\uDEDC-\uDEEC\uDEF0-\uDEFC\uDF00-\uDF76\uDF7B-\uDFD9\uDFE0-\uDFEB\uDFF0]|\uD83E[\uDC00-\uDC0B\uDC10-\uDC47\uDC50-\uDC59\uDC60-\uDC87\uDC90-\uDCAD\uDCB0\uDCB1\uDD00-\uDE53\uDE60-\uDE6D\uDE70-\uDE7C\uDE80-\uDE88\uDE90-\uDEBD\uDEBF-\uDEC5\uDECE-\uDEDB\uDEE0-\uDEE8\uDEF0-\uDEF8\uDF00-\uDF92\uDF94-\uDFCA]/,KC=/[ \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000]/,w7=Object.freeze(Object.defineProperty({__proto__:null,Any:VC,Cc:UC,Cf:j7,P:Cg,S:WC,Z:KC},Symbol.toStringTag,{value:"Module"})),v7=new Uint16Array('ᵁ<Õıʊҝջאٵ۞ޢߖࠏ੊ઑඡ๭༉༦჊ረዡᐕᒝᓃᓟᔥ\0\0\0\0\0\0ᕫᛍᦍᰒᷝ὾⁠↰⊍⏀⏻⑂⠤⤒ⴈ⹈⿎〖㊺㘹㞬㣾㨨㩱㫠㬮ࠀEMabcfglmnoprstu\\bfms¦³¹ÈÏlig耻Æ䃆P耻&䀦cute耻Á䃁reve;䄂Āiyx}rc耻Â䃂;䐐r;쀀𝔄rave耻À䃀pha;䎑acr;䄀d;橓Āgp¡on;䄄f;쀀𝔸plyFunction;恡ing耻Å䃅Ācs¾Ãr;쀀𝒜ign;扔ilde耻Ã䃃ml耻Ä䃄ЀaceforsuåûþėĜĢħĪĀcrêòkslash;或Ŷöø;櫧ed;挆y;䐑ƀcrtąċĔause;戵noullis;愬a;䎒r;쀀𝔅pf;쀀𝔹eve;䋘còēmpeq;扎܀HOacdefhilorsuōőŖƀƞƢƵƷƺǜȕɳɸɾcy;䐧PY耻©䂩ƀcpyŝŢźute;䄆Ā;iŧŨ拒talDifferentialD;慅leys;愭ȀaeioƉƎƔƘron;䄌dil耻Ç䃇rc;䄈nint;戰ot;䄊ĀdnƧƭilla;䂸terDot;䂷òſi;䎧rcleȀDMPTǇǋǑǖot;抙inus;抖lus;投imes;抗oĀcsǢǸkwiseContourIntegral;戲eCurlyĀDQȃȏoubleQuote;思uote;怙ȀlnpuȞȨɇɕonĀ;eȥȦ户;橴ƀgitȯȶȺruent;扡nt;戯ourIntegral;戮ĀfrɌɎ;愂oduct;成nterClockwiseContourIntegral;戳oss;樯cr;쀀𝒞pĀ;Cʄʅ拓ap;才րDJSZacefiosʠʬʰʴʸˋ˗ˡ˦̳ҍĀ;oŹʥtrahd;椑cy;䐂cy;䐅cy;䐏ƀgrsʿ˄ˇger;怡r;憡hv;櫤Āayː˕ron;䄎;䐔lĀ;t˝˞戇a;䎔r;쀀𝔇Āaf˫̧Ācm˰̢riticalȀADGT̖̜̀̆cute;䂴oŴ̋̍;䋙bleAcute;䋝rave;䁠ilde;䋜ond;拄ferentialD;慆Ѱ̽\0\0\0͔͂\0Ѕf;쀀𝔻ƀ;DE͈͉͍䂨ot;惜qual;扐blèCDLRUVͣͲ΂ϏϢϸontourIntegraìȹoɴ͹\0\0ͻ»͉nArrow;懓Āeo·ΤftƀARTΐΖΡrrow;懐ightArrow;懔eåˊngĀLRΫτeftĀARγιrrow;柸ightArrow;柺ightArrow;柹ightĀATϘϞrrow;懒ee;抨pɁϩ\0\0ϯrrow;懑ownArrow;懕erticalBar;戥ǹABLRTaВЪаўѿͼrrowƀ;BUНОТ憓ar;椓pArrow;懵reve;䌑eft˒к\0ц\0ѐightVector;楐eeVector;楞ectorĀ;Bљњ憽ar;楖ightǔѧ\0ѱeeVector;楟ectorĀ;BѺѻ懁ar;楗eeĀ;A҆҇护rrow;憧ĀctҒҗr;쀀𝒟rok;䄐ࠀNTacdfglmopqstuxҽӀӄӋӞӢӧӮӵԡԯԶՒ՝ՠեG;䅊H耻Ð䃐cute耻É䃉ƀaiyӒӗӜron;䄚rc耻Ê䃊;䐭ot;䄖r;쀀𝔈rave耻È䃈ement;戈ĀapӺӾcr;䄒tyɓԆ\0\0ԒmallSquare;旻erySmallSquare;斫ĀgpԦԪon;䄘f;쀀𝔼silon;䎕uĀaiԼՉlĀ;TՂՃ橵ilde;扂librium;懌Āci՗՚r;愰m;橳a;䎗ml耻Ë䃋Āipժկsts;戃onentialE;慇ʀcfiosօֈ֍ֲ׌y;䐤r;쀀𝔉lledɓ֗\0\0֣mallSquare;旼erySmallSquare;斪Ͱֺ\0ֿ\0\0ׄf;쀀𝔽All;戀riertrf;愱cò׋؀JTabcdfgorstר׬ׯ׺؀ؒؖ؛؝أ٬ٲcy;䐃耻>䀾mmaĀ;d׷׸䎓;䏜reve;䄞ƀeiy؇،ؐdil;䄢rc;䄜;䐓ot;䄠r;쀀𝔊;拙pf;쀀𝔾eater̀EFGLSTصلَٖٛ٦qualĀ;Lؾؿ扥ess;招ullEqual;执reater;檢ess;扷lantEqual;橾ilde;扳cr;쀀𝒢;扫ЀAacfiosuڅڋږڛڞڪھۊRDcy;䐪Āctڐڔek;䋇;䁞irc;䄤r;愌lbertSpace;愋ǰگ\0ڲf;愍izontalLine;攀Āctۃۅòکrok;䄦mpńېۘownHumðįqual;扏܀EJOacdfgmnostuۺ۾܃܇܎ܚܞܡܨ݄ݸދޏޕcy;䐕lig;䄲cy;䐁cute耻Í䃍Āiyܓܘrc耻Î䃎;䐘ot;䄰r;愑rave耻Ì䃌ƀ;apܠܯܿĀcgܴܷr;䄪inaryI;慈lieóϝǴ݉\0ݢĀ;eݍݎ戬Āgrݓݘral;戫section;拂isibleĀCTݬݲomma;恣imes;恢ƀgptݿރވon;䄮f;쀀𝕀a;䎙cr;愐ilde;䄨ǫޚ\0ޞcy;䐆l耻Ï䃏ʀcfosuެ޷޼߂ߐĀiyޱ޵rc;䄴;䐙r;쀀𝔍pf;쀀𝕁ǣ߇\0ߌr;쀀𝒥rcy;䐈kcy;䐄΀HJacfosߤߨ߽߬߱ࠂࠈcy;䐥cy;䐌ppa;䎚Āey߶߻dil;䄶;䐚r;쀀𝔎pf;쀀𝕂cr;쀀𝒦րJTaceflmostࠥࠩࠬࡐࡣ঳সে্਷ੇcy;䐉耻<䀼ʀcmnpr࠷࠼ࡁࡄࡍute;䄹bda;䎛g;柪lacetrf;愒r;憞ƀaeyࡗ࡜ࡡron;䄽dil;䄻;䐛Āfsࡨ॰tԀACDFRTUVarࡾࢩࢱࣦ࣠ࣼयज़ΐ४Ānrࢃ࢏gleBracket;柨rowƀ;BR࢙࢚࢞憐ar;懤ightArrow;懆eiling;挈oǵࢷ\0ࣃbleBracket;柦nǔࣈ\0࣒eeVector;楡ectorĀ;Bࣛࣜ懃ar;楙loor;挊ightĀAV࣯ࣵrrow;憔ector;楎Āerँगeƀ;AVउऊऐ抣rrow;憤ector;楚iangleƀ;BEतथऩ抲ar;槏qual;抴pƀDTVषूौownVector;楑eeVector;楠ectorĀ;Bॖॗ憿ar;楘ectorĀ;B॥०憼ar;楒ightáΜs̀EFGLSTॾঋকঝঢভqualGreater;拚ullEqual;扦reater;扶ess;檡lantEqual;橽ilde;扲r;쀀𝔏Ā;eঽা拘ftarrow;懚idot;䄿ƀnpw৔ਖਛgȀLRlr৞৷ਂਐeftĀAR০৬rrow;柵ightArrow;柷ightArrow;柶eftĀarγਊightáοightáϊf;쀀𝕃erĀLRਢਬeftArrow;憙ightArrow;憘ƀchtਾੀੂòࡌ;憰rok;䅁;扪Ѐacefiosuਗ਼੝੠੷੼અઋ઎p;椅y;䐜Ādl੥੯iumSpace;恟lintrf;愳r;쀀𝔐nusPlus;戓pf;쀀𝕄cò੶;䎜ҀJacefostuણધભીଔଙඑ඗ඞcy;䐊cute;䅃ƀaey઴હાron;䅇dil;䅅;䐝ƀgswે૰଎ativeƀMTV૓૟૨ediumSpace;怋hiĀcn૦૘ë૙eryThiî૙tedĀGL૸ଆreaterGreateòٳessLesóੈLine;䀊r;쀀𝔑ȀBnptଢନଷ଺reak;恠BreakingSpace;䂠f;愕ڀ;CDEGHLNPRSTV୕ୖ୪୼஡௫ఄ౞಄ದ೘ൡඅ櫬Āou୛୤ngruent;扢pCap;扭oubleVerticalBar;戦ƀlqxஃஊ஛ement;戉ualĀ;Tஒஓ扠ilde;쀀≂̸ists;戄reater΀;EFGLSTஶஷ஽௉௓௘௥扯qual;扱ullEqual;쀀≧̸reater;쀀≫̸ess;批lantEqual;쀀⩾̸ilde;扵umpń௲௽ownHump;쀀≎̸qual;쀀≏̸eĀfsఊధtTriangleƀ;BEచఛడ拪ar;쀀⧏̸qual;括s̀;EGLSTవశ఼ౄోౘ扮qual;扰reater;扸ess;쀀≪̸lantEqual;쀀⩽̸ilde;扴estedĀGL౨౹reaterGreater;쀀⪢̸essLess;쀀⪡̸recedesƀ;ESಒಓಛ技qual;쀀⪯̸lantEqual;拠ĀeiಫಹverseElement;戌ghtTriangleƀ;BEೋೌ೒拫ar;쀀⧐̸qual;拭ĀquೝഌuareSuĀbp೨೹setĀ;E೰ೳ쀀⊏̸qual;拢ersetĀ;Eഃആ쀀⊐̸qual;拣ƀbcpഓതൎsetĀ;Eഛഞ쀀⊂⃒qual;抈ceedsȀ;ESTലള഻െ抁qual;쀀⪰̸lantEqual;拡ilde;쀀≿̸ersetĀ;E൘൛쀀⊃⃒qual;抉ildeȀ;EFT൮൯൵ൿ扁qual;扄ullEqual;扇ilde;扉erticalBar;戤cr;쀀𝒩ilde耻Ñ䃑;䎝܀Eacdfgmoprstuvලෂ෉෕ෛ෠෧෼ขภยา฿ไlig;䅒cute耻Ó䃓Āiy෎ීrc耻Ô䃔;䐞blac;䅐r;쀀𝔒rave耻Ò䃒ƀaei෮ෲ෶cr;䅌ga;䎩cron;䎟pf;쀀𝕆enCurlyĀDQฎบoubleQuote;怜uote;怘;橔Āclวฬr;쀀𝒪ash耻Ø䃘iŬื฼de耻Õ䃕es;樷ml耻Ö䃖erĀBP๋๠Āar๐๓r;怾acĀek๚๜;揞et;掴arenthesis;揜Ҁacfhilors๿ງຊຏຒດຝະ໼rtialD;戂y;䐟r;쀀𝔓i;䎦;䎠usMinus;䂱Āipຢອncareplanåڝf;愙Ȁ;eio຺ູ໠໤檻cedesȀ;EST່້໏໚扺qual;檯lantEqual;扼ilde;找me;怳Ādp໩໮uct;戏ortionĀ;aȥ໹l;戝Āci༁༆r;쀀𝒫;䎨ȀUfos༑༖༛༟OT耻"䀢r;쀀𝔔pf;愚cr;쀀𝒬؀BEacefhiorsu༾གྷཇའཱིྦྷྪྭ႖ႩႴႾarr;椐G耻®䂮ƀcnrཎནབute;䅔g;柫rĀ;tཛྷཝ憠l;椖ƀaeyཧཬཱron;䅘dil;䅖;䐠Ā;vླྀཹ愜erseĀEUྂྙĀlq྇ྎement;戋uilibrium;懋pEquilibrium;楯r»ཹo;䎡ghtЀACDFTUVa࿁࿫࿳ဢဨၛႇϘĀnr࿆࿒gleBracket;柩rowƀ;BL࿜࿝࿡憒ar;懥eftArrow;懄eiling;按oǵ࿹\0စbleBracket;柧nǔည\0နeeVector;楝ectorĀ;Bဝသ懂ar;楕loor;挋Āerိ၃eƀ;AVဵံြ抢rrow;憦ector;楛iangleƀ;BEၐၑၕ抳ar;槐qual;抵pƀDTVၣၮၸownVector;楏eeVector;楜ectorĀ;Bႂႃ憾ar;楔ectorĀ;B႑႒懀ar;楓Āpuႛ႞f;愝ndImplies;楰ightarrow;懛ĀchႹႼr;愛;憱leDelayed;槴ڀHOacfhimoqstuფჱჷჽᄙᄞᅑᅖᅡᅧᆵᆻᆿĀCcჩხHcy;䐩y;䐨FTcy;䐬cute;䅚ʀ;aeiyᄈᄉᄎᄓᄗ檼ron;䅠dil;䅞rc;䅜;䐡r;쀀𝔖ortȀDLRUᄪᄴᄾᅉownArrow»ОeftArrow»࢚ightArrow»࿝pArrow;憑gma;䎣allCircle;战pf;쀀𝕊ɲᅭ\0\0ᅰt;戚areȀ;ISUᅻᅼᆉᆯ斡ntersection;抓uĀbpᆏᆞsetĀ;Eᆗᆘ抏qual;抑ersetĀ;Eᆨᆩ抐qual;抒nion;抔cr;쀀𝒮ar;拆ȀbcmpᇈᇛሉላĀ;sᇍᇎ拐etĀ;Eᇍᇕqual;抆ĀchᇠህeedsȀ;ESTᇭᇮᇴᇿ扻qual;檰lantEqual;扽ilde;承Tháྌ;我ƀ;esሒሓሣ拑rsetĀ;Eሜም抃qual;抇et»ሓրHRSacfhiorsሾቄ቉ቕ቞ቱቶኟዂወዑORN耻Þ䃞ADE;愢ĀHc቎ቒcy;䐋y;䐦Ābuቚቜ;䀉;䎤ƀaeyብቪቯron;䅤dil;䅢;䐢r;쀀𝔗Āeiቻ኉ǲኀ\0ኇefore;戴a;䎘Ācn኎ኘkSpace;쀀  Space;怉ldeȀ;EFTካኬኲኼ戼qual;扃ullEqual;扅ilde;扈pf;쀀𝕋ipleDot;惛Āctዖዛr;쀀𝒯rok;䅦ૡዷጎጚጦ\0ጬጱ\0\0\0\0\0ጸጽ፷ᎅ\0᏿ᐄᐊᐐĀcrዻጁute耻Ú䃚rĀ;oጇገ憟cir;楉rǣጓ\0጖y;䐎ve;䅬Āiyጞጣrc耻Û䃛;䐣blac;䅰r;쀀𝔘rave耻Ù䃙acr;䅪Ādiፁ፩erĀBPፈ፝Āarፍፐr;䁟acĀekፗፙ;揟et;掵arenthesis;揝onĀ;P፰፱拃lus;抎Āgp፻፿on;䅲f;쀀𝕌ЀADETadps᎕ᎮᎸᏄϨᏒᏗᏳrrowƀ;BDᅐᎠᎤar;椒ownArrow;懅ownArrow;憕quilibrium;楮eeĀ;AᏋᏌ报rrow;憥ownáϳerĀLRᏞᏨeftArrow;憖ightArrow;憗iĀ;lᏹᏺ䏒on;䎥ing;䅮cr;쀀𝒰ilde;䅨ml耻Ü䃜ҀDbcdefosvᐧᐬᐰᐳᐾᒅᒊᒐᒖash;披ar;櫫y;䐒ashĀ;lᐻᐼ抩;櫦Āerᑃᑅ;拁ƀbtyᑌᑐᑺar;怖Ā;iᑏᑕcalȀBLSTᑡᑥᑪᑴar;戣ine;䁼eparator;杘ilde;所ThinSpace;怊r;쀀𝔙pf;쀀𝕍cr;쀀𝒱dash;抪ʀcefosᒧᒬᒱᒶᒼirc;䅴dge;拀r;쀀𝔚pf;쀀𝕎cr;쀀𝒲Ȁfiosᓋᓐᓒᓘr;쀀𝔛;䎞pf;쀀𝕏cr;쀀𝒳ҀAIUacfosuᓱᓵᓹᓽᔄᔏᔔᔚᔠcy;䐯cy;䐇cy;䐮cute耻Ý䃝Āiyᔉᔍrc;䅶;䐫r;쀀𝔜pf;쀀𝕐cr;쀀𝒴ml;䅸ЀHacdefosᔵᔹᔿᕋᕏᕝᕠᕤcy;䐖cute;䅹Āayᕄᕉron;䅽;䐗ot;䅻ǲᕔ\0ᕛoWidtè૙a;䎖r;愨pf;愤cr;쀀𝒵௡ᖃᖊᖐ\0ᖰᖶᖿ\0\0\0\0ᗆᗛᗫᙟ᙭\0ᚕ᚛ᚲᚹ\0ᚾcute耻á䃡reve;䄃̀;Ediuyᖜᖝᖡᖣᖨᖭ戾;쀀∾̳;房rc耻â䃢te肻´̆;䐰lig耻æ䃦Ā;r²ᖺ;쀀𝔞rave耻à䃠ĀepᗊᗖĀfpᗏᗔsym;愵èᗓha;䎱ĀapᗟcĀclᗤᗧr;䄁g;樿ɤᗰ\0\0ᘊʀ;adsvᗺᗻᗿᘁᘇ戧nd;橕;橜lope;橘;橚΀;elmrszᘘᘙᘛᘞᘿᙏᙙ戠;榤e»ᘙsdĀ;aᘥᘦ戡ѡᘰᘲᘴᘶᘸᘺᘼᘾ;榨;榩;榪;榫;榬;榭;榮;榯tĀ;vᙅᙆ戟bĀ;dᙌᙍ抾;榝Āptᙔᙗh;戢»¹arr;捼Āgpᙣᙧon;䄅f;쀀𝕒΀;Eaeiop዁ᙻᙽᚂᚄᚇᚊ;橰cir;橯;扊d;手s;䀧roxĀ;e዁ᚒñᚃing耻å䃥ƀctyᚡᚦᚨr;쀀𝒶;䀪mpĀ;e዁ᚯñʈilde耻ã䃣ml耻ä䃤Āciᛂᛈoninôɲnt;樑ࠀNabcdefiklnoprsu᛭ᛱᜰ᜼ᝃᝈ᝸᝽០៦ᠹᡐᜍ᤽᥈ᥰot;櫭Ācrᛶ᜞kȀcepsᜀᜅᜍᜓong;扌psilon;䏶rime;怵imĀ;e᜚᜛戽q;拍Ŷᜢᜦee;抽edĀ;gᜬᜭ挅e»ᜭrkĀ;t፜᜷brk;掶Āoyᜁᝁ;䐱quo;怞ʀcmprtᝓ᝛ᝡᝤᝨausĀ;eĊĉptyv;榰séᜌnoõēƀahwᝯ᝱ᝳ;䎲;愶een;扬r;쀀𝔟g΀costuvwឍឝឳេ៕៛៞ƀaiuបពរðݠrc;旯p»፱ƀdptឤឨឭot;樀lus;樁imes;樂ɱឹ\0\0ើcup;樆ar;昅riangleĀdu៍្own;施p;斳plus;樄eåᑄåᒭarow;植ƀako៭ᠦᠵĀcn៲ᠣkƀlst៺֫᠂ozenge;槫riangleȀ;dlr᠒᠓᠘᠝斴own;斾eft;旂ight;斸k;搣Ʊᠫ\0ᠳƲᠯ\0ᠱ;斒;斑4;斓ck;斈ĀeoᠾᡍĀ;qᡃᡆ쀀=⃥uiv;쀀≡⃥t;挐Ȁptwxᡙᡞᡧᡬf;쀀𝕓Ā;tᏋᡣom»Ꮜtie;拈؀DHUVbdhmptuvᢅᢖᢪᢻᣗᣛᣬ᣿ᤅᤊᤐᤡȀLRlrᢎᢐᢒᢔ;敗;敔;敖;敓ʀ;DUduᢡᢢᢤᢦᢨ敐;敦;敩;敤;敧ȀLRlrᢳᢵᢷᢹ;敝;敚;敜;教΀;HLRhlrᣊᣋᣍᣏᣑᣓᣕ救;敬;散;敠;敫;敢;敟ox;槉ȀLRlrᣤᣦᣨᣪ;敕;敒;攐;攌ʀ;DUduڽ᣷᣹᣻᣽;敥;敨;攬;攴inus;抟lus;択imes;抠ȀLRlrᤙᤛᤝ᤟;敛;敘;攘;攔΀;HLRhlrᤰᤱᤳᤵᤷ᤻᤹攂;敪;敡;敞;攼;攤;攜Āevģ᥂bar耻¦䂦Ȁceioᥑᥖᥚᥠr;쀀𝒷mi;恏mĀ;e᜚᜜lƀ;bhᥨᥩᥫ䁜;槅sub;柈Ŭᥴ᥾lĀ;e᥹᥺怢t»᥺pƀ;Eeįᦅᦇ;檮Ā;qۜۛೡᦧ\0᧨ᨑᨕᨲ\0ᨷᩐ\0\0᪴\0\0᫁\0\0ᬡᬮ᭍᭒\0᯽\0ᰌƀcpr᦭ᦲ᧝ute;䄇̀;abcdsᦿᧀᧄ᧊᧕᧙戩nd;橄rcup;橉Āau᧏᧒p;橋p;橇ot;橀;쀀∩︀Āeo᧢᧥t;恁îړȀaeiu᧰᧻ᨁᨅǰ᧵\0᧸s;橍on;䄍dil耻ç䃧rc;䄉psĀ;sᨌᨍ橌m;橐ot;䄋ƀdmnᨛᨠᨦil肻¸ƭptyv;榲t脀¢;eᨭᨮ䂢räƲr;쀀𝔠ƀceiᨽᩀᩍy;䑇ckĀ;mᩇᩈ朓ark»ᩈ;䏇r΀;Ecefms᩟᩠ᩢᩫ᪤᪪᪮旋;槃ƀ;elᩩᩪᩭ䋆q;扗eɡᩴ\0\0᪈rrowĀlr᩼᪁eft;憺ight;憻ʀRSacd᪒᪔᪖᪚᪟»ཇ;擈st;抛irc;抚ash;抝nint;樐id;櫯cir;槂ubsĀ;u᪻᪼晣it»᪼ˬ᫇᫔᫺\0ᬊonĀ;eᫍᫎ䀺Ā;qÇÆɭ᫙\0\0᫢aĀ;t᫞᫟䀬;䁀ƀ;fl᫨᫩᫫戁îᅠeĀmx᫱᫶ent»᫩eóɍǧ᫾\0ᬇĀ;dኻᬂot;橭nôɆƀfryᬐᬔᬗ;쀀𝕔oäɔ脀©;sŕᬝr;愗Āaoᬥᬩrr;憵ss;朗Ācuᬲᬷr;쀀𝒸Ābpᬼ᭄Ā;eᭁᭂ櫏;櫑Ā;eᭉᭊ櫐;櫒dot;拯΀delprvw᭠᭬᭷ᮂᮬᯔ᯹arrĀlr᭨᭪;椸;椵ɰ᭲\0\0᭵r;拞c;拟arrĀ;p᭿ᮀ憶;椽̀;bcdosᮏᮐᮖᮡᮥᮨ截rcap;橈Āauᮛᮞp;橆p;橊ot;抍r;橅;쀀∪︀Ȁalrv᮵ᮿᯞᯣrrĀ;mᮼᮽ憷;椼yƀevwᯇᯔᯘqɰᯎ\0\0ᯒreã᭳uã᭵ee;拎edge;拏en耻¤䂤earrowĀlrᯮ᯳eft»ᮀight»ᮽeäᯝĀciᰁᰇoninôǷnt;戱lcty;挭ঀAHabcdefhijlorstuwz᰸᰻᰿ᱝᱩᱵᲊᲞᲬᲷ᳻᳿ᴍᵻᶑᶫᶻ᷆᷍rò΁ar;楥Ȁglrs᱈ᱍ᱒᱔ger;怠eth;愸òᄳhĀ;vᱚᱛ怐»ऊūᱡᱧarow;椏aã̕Āayᱮᱳron;䄏;䐴ƀ;ao̲ᱼᲄĀgrʿᲁr;懊tseq;橷ƀglmᲑᲔᲘ耻°䂰ta;䎴ptyv;榱ĀirᲣᲨsht;楿;쀀𝔡arĀlrᲳᲵ»ࣜ»သʀaegsv᳂͸᳖᳜᳠mƀ;oș᳊᳔ndĀ;ș᳑uit;晦amma;䏝in;拲ƀ;io᳧᳨᳸䃷de脀÷;o᳧ᳰntimes;拇nø᳷cy;䑒cɯᴆ\0\0ᴊrn;挞op;挍ʀlptuwᴘᴝᴢᵉᵕlar;䀤f;쀀𝕕ʀ;emps̋ᴭᴷᴽᵂqĀ;d͒ᴳot;扑inus;戸lus;戔quare;抡blebarwedgåúnƀadhᄮᵝᵧownarrowóᲃarpoonĀlrᵲᵶefôᲴighôᲶŢᵿᶅkaro÷གɯᶊ\0\0ᶎrn;挟op;挌ƀcotᶘᶣᶦĀryᶝᶡ;쀀𝒹;䑕l;槶rok;䄑Ādrᶰᶴot;拱iĀ;fᶺ᠖斿Āah᷀᷃ròЩaòྦangle;榦Āci᷒ᷕy;䑟grarr;柿ऀDacdefglmnopqrstuxḁḉḙḸոḼṉṡṾấắẽỡἪἷὄ὎὚ĀDoḆᴴoôᲉĀcsḎḔute耻é䃩ter;橮ȀaioyḢḧḱḶron;䄛rĀ;cḭḮ扖耻ê䃪lon;払;䑍ot;䄗ĀDrṁṅot;扒;쀀𝔢ƀ;rsṐṑṗ檚ave耻è䃨Ā;dṜṝ檖ot;檘Ȁ;ilsṪṫṲṴ檙nters;揧;愓Ā;dṹṺ檕ot;檗ƀapsẅẉẗcr;䄓tyƀ;svẒẓẕ戅et»ẓpĀ1;ẝẤĳạả;怄;怅怃ĀgsẪẬ;䅋p;怂ĀgpẴẸon;䄙f;쀀𝕖ƀalsỄỎỒrĀ;sỊị拕l;槣us;橱iƀ;lvỚớở䎵on»ớ;䏵ȀcsuvỪỳἋἣĀioữḱrc»Ḯɩỹ\0\0ỻíՈantĀglἂἆtr»ṝess»Ṻƀaeiἒ἖Ἒls;䀽st;扟vĀ;DȵἠD;橸parsl;槥ĀDaἯἳot;打rr;楱ƀcdiἾὁỸr;愯oô͒ĀahὉὋ;䎷耻ð䃰Āmrὓὗl耻ë䃫o;悬ƀcipὡὤὧl;䀡sôծĀeoὬὴctatioîՙnentialåչৡᾒ\0ᾞ\0ᾡᾧ\0\0ῆῌ\0ΐ\0ῦῪ \0 ⁚llingdotseñṄy;䑄male;晀ƀilrᾭᾳ῁lig;耀ﬃɩᾹ\0\0᾽g;耀ﬀig;耀ﬄ;쀀𝔣lig;耀ﬁlig;쀀fjƀaltῙ῜ῡt;晭ig;耀ﬂns;斱of;䆒ǰ΅\0ῳf;쀀𝕗ĀakֿῷĀ;vῼ´拔;櫙artint;樍Āao‌⁕Ācs‑⁒α‚‰‸⁅⁈\0⁐β•‥‧‪‬\0‮耻½䂽;慓耻¼䂼;慕;慙;慛Ƴ‴\0‶;慔;慖ʴ‾⁁\0\0⁃耻¾䂾;慗;慜5;慘ƶ⁌\0⁎;慚;慝8;慞l;恄wn;挢cr;쀀𝒻ࢀEabcdefgijlnorstv₂₉₟₥₰₴⃰⃵⃺⃿℃ℒℸ̗ℾ⅒↞Ā;lٍ₇;檌ƀcmpₐₕ₝ute;䇵maĀ;dₜ᳚䎳;檆reve;䄟Āiy₪₮rc;䄝;䐳ot;䄡Ȁ;lqsؾق₽⃉ƀ;qsؾٌ⃄lanô٥Ȁ;cdl٥⃒⃥⃕c;檩otĀ;o⃜⃝檀Ā;l⃢⃣檂;檄Ā;e⃪⃭쀀⋛︀s;檔r;쀀𝔤Ā;gٳ؛mel;愷cy;䑓Ȁ;Eajٚℌℎℐ;檒;檥;檤ȀEaesℛℝ℩ℴ;扩pĀ;p℣ℤ檊rox»ℤĀ;q℮ℯ檈Ā;q℮ℛim;拧pf;쀀𝕘Āci⅃ⅆr;愊mƀ;el٫ⅎ⅐;檎;檐茀>;cdlqr׮ⅠⅪⅮⅳⅹĀciⅥⅧ;檧r;橺ot;拗Par;榕uest;橼ʀadelsↄⅪ←ٖ↛ǰ↉\0↎proø₞r;楸qĀlqؿ↖lesó₈ií٫Āen↣↭rtneqq;쀀≩︀Å↪ԀAabcefkosy⇄⇇⇱⇵⇺∘∝∯≨≽ròΠȀilmr⇐⇔⇗⇛rsðᒄf»․ilôکĀdr⇠⇤cy;䑊ƀ;cwࣴ⇫⇯ir;楈;憭ar;意irc;䄥ƀalr∁∎∓rtsĀ;u∉∊晥it»∊lip;怦con;抹r;쀀𝔥sĀew∣∩arow;椥arow;椦ʀamopr∺∾≃≞≣rr;懿tht;戻kĀlr≉≓eftarrow;憩ightarrow;憪f;쀀𝕙bar;怕ƀclt≯≴≸r;쀀𝒽asè⇴rok;䄧Ābp⊂⊇ull;恃hen»ᱛૡ⊣\0⊪\0⊸⋅⋎\0⋕⋳\0\0⋸⌢⍧⍢⍿\0⎆⎪⎴cute耻í䃭ƀ;iyݱ⊰⊵rc耻î䃮;䐸Ācx⊼⊿y;䐵cl耻¡䂡ĀfrΟ⋉;쀀𝔦rave耻ì䃬Ȁ;inoܾ⋝⋩⋮Āin⋢⋦nt;樌t;戭fin;槜ta;愩lig;䄳ƀaop⋾⌚⌝ƀcgt⌅⌈⌗r;䄫ƀelpܟ⌏⌓inåގarôܠh;䄱f;抷ed;䆵ʀ;cfotӴ⌬⌱⌽⍁are;愅inĀ;t⌸⌹戞ie;槝doô⌙ʀ;celpݗ⍌⍐⍛⍡al;抺Āgr⍕⍙eróᕣã⍍arhk;樗rod;樼Ȁcgpt⍯⍲⍶⍻y;䑑on;䄯f;쀀𝕚a;䎹uest耻¿䂿Āci⎊⎏r;쀀𝒾nʀ;EdsvӴ⎛⎝⎡ӳ;拹ot;拵Ā;v⎦⎧拴;拳Ā;iݷ⎮lde;䄩ǫ⎸\0⎼cy;䑖l耻ï䃯̀cfmosu⏌⏗⏜⏡⏧⏵Āiy⏑⏕rc;䄵;䐹r;쀀𝔧ath;䈷pf;쀀𝕛ǣ⏬\0⏱r;쀀𝒿rcy;䑘kcy;䑔Ѐacfghjos␋␖␢␧␭␱␵␻ppaĀ;v␓␔䎺;䏰Āey␛␠dil;䄷;䐺r;쀀𝔨reen;䄸cy;䑅cy;䑜pf;쀀𝕜cr;쀀𝓀஀ABEHabcdefghjlmnoprstuv⑰⒁⒆⒍⒑┎┽╚▀♎♞♥♹♽⚚⚲⛘❝❨➋⟀⠁⠒ƀart⑷⑺⑼rò৆òΕail;椛arr;椎Ā;gঔ⒋;檋ar;楢ॣ⒥\0⒪\0⒱\0\0\0\0\0⒵Ⓔ\0ⓆⓈⓍ\0⓹ute;䄺mptyv;榴raîࡌbda;䎻gƀ;dlࢎⓁⓃ;榑åࢎ;檅uo耻«䂫rЀ;bfhlpst࢙ⓞⓦⓩ⓫⓮⓱⓵Ā;f࢝ⓣs;椟s;椝ë≒p;憫l;椹im;楳l;憢ƀ;ae⓿─┄檫il;椙Ā;s┉┊檭;쀀⪭︀ƀabr┕┙┝rr;椌rk;杲Āak┢┬cĀek┨┪;䁻;䁛Āes┱┳;榋lĀdu┹┻;榏;榍Ȁaeuy╆╋╖╘ron;䄾Ādi═╔il;䄼ìࢰâ┩;䐻Ȁcqrs╣╦╭╽a;椶uoĀ;rนᝆĀdu╲╷har;楧shar;楋h;憲ʀ;fgqs▋▌উ◳◿扤tʀahlrt▘▤▷◂◨rrowĀ;t࢙□aé⓶arpoonĀdu▯▴own»њp»०eftarrows;懇ightƀahs◍◖◞rrowĀ;sࣴࢧarpoonó྘quigarro÷⇰hreetimes;拋ƀ;qs▋ও◺lanôবʀ;cdgsব☊☍☝☨c;檨otĀ;o☔☕橿Ā;r☚☛檁;檃Ā;e☢☥쀀⋚︀s;檓ʀadegs☳☹☽♉♋pproøⓆot;拖qĀgq♃♅ôউgtò⒌ôছiíলƀilr♕࣡♚sht;楼;쀀𝔩Ā;Eজ♣;檑š♩♶rĀdu▲♮Ā;l॥♳;楪lk;斄cy;䑙ʀ;achtੈ⚈⚋⚑⚖rò◁orneòᴈard;楫ri;旺Āio⚟⚤dot;䅀ustĀ;a⚬⚭掰che»⚭ȀEaes⚻⚽⛉⛔;扨pĀ;p⛃⛄檉rox»⛄Ā;q⛎⛏檇Ā;q⛎⚻im;拦Ѐabnoptwz⛩⛴⛷✚✯❁❇❐Ānr⛮⛱g;柬r;懽rëࣁgƀlmr⛿✍✔eftĀar০✇ightá৲apsto;柼ightá৽parrowĀlr✥✩efô⓭ight;憬ƀafl✶✹✽r;榅;쀀𝕝us;樭imes;樴š❋❏st;戗áፎƀ;ef❗❘᠀旊nge»❘arĀ;l❤❥䀨t;榓ʀachmt❳❶❼➅➇ròࢨorneòᶌarĀ;d྘➃;業;怎ri;抿̀achiqt➘➝ੀ➢➮➻quo;怹r;쀀𝓁mƀ;egল➪➬;檍;檏Ābu┪➳oĀ;rฟ➹;怚rok;䅂萀<;cdhilqrࠫ⟒☹⟜⟠⟥⟪⟰Āci⟗⟙;檦r;橹reå◲mes;拉arr;楶uest;橻ĀPi⟵⟹ar;榖ƀ;ef⠀भ᠛旃rĀdu⠇⠍shar;楊har;楦Āen⠗⠡rtneqq;쀀≨︀Å⠞܀Dacdefhilnopsu⡀⡅⢂⢎⢓⢠⢥⢨⣚⣢⣤ઃ⣳⤂Dot;戺Ȁclpr⡎⡒⡣⡽r耻¯䂯Āet⡗⡙;時Ā;e⡞⡟朠se»⡟Ā;sျ⡨toȀ;dluျ⡳⡷⡻owîҌefôएðᏑker;斮Āoy⢇⢌mma;権;䐼ash;怔asuredangle»ᘦr;쀀𝔪o;愧ƀcdn⢯⢴⣉ro耻µ䂵Ȁ;acdᑤ⢽⣀⣄sôᚧir;櫰ot肻·Ƶusƀ;bd⣒ᤃ⣓戒Ā;uᴼ⣘;横ţ⣞⣡p;櫛ò−ðઁĀdp⣩⣮els;抧f;쀀𝕞Āct⣸⣽r;쀀𝓂pos»ᖝƀ;lm⤉⤊⤍䎼timap;抸ఀGLRVabcdefghijlmoprstuvw⥂⥓⥾⦉⦘⧚⧩⨕⨚⩘⩝⪃⪕⪤⪨⬄⬇⭄⭿⮮ⰴⱧⱼ⳩Āgt⥇⥋;쀀⋙̸Ā;v⥐௏쀀≫⃒ƀelt⥚⥲⥶ftĀar⥡⥧rrow;懍ightarrow;懎;쀀⋘̸Ā;v⥻ే쀀≪⃒ightarrow;懏ĀDd⦎⦓ash;抯ash;抮ʀbcnpt⦣⦧⦬⦱⧌la»˞ute;䅄g;쀀∠⃒ʀ;Eiop඄⦼⧀⧅⧈;쀀⩰̸d;쀀≋̸s;䅉roø඄urĀ;a⧓⧔普lĀ;s⧓ସǳ⧟\0⧣p肻 ଷmpĀ;e௹ఀʀaeouy⧴⧾⨃⨐⨓ǰ⧹\0⧻;橃on;䅈dil;䅆ngĀ;dൾ⨊ot;쀀⩭̸p;橂;䐽ash;怓΀;Aadqsxஒ⨩⨭⨻⩁⩅⩐rr;懗rĀhr⨳⨶k;椤Ā;oᏲᏰot;쀀≐̸uiöୣĀei⩊⩎ar;椨í஘istĀ;s஠டr;쀀𝔫ȀEest௅⩦⩹⩼ƀ;qs஼⩭௡ƀ;qs஼௅⩴lanô௢ií௪Ā;rஶ⪁»ஷƀAap⪊⪍⪑rò⥱rr;憮ar;櫲ƀ;svྍ⪜ྌĀ;d⪡⪢拼;拺cy;䑚΀AEadest⪷⪺⪾⫂⫅⫶⫹rò⥦;쀀≦̸rr;憚r;急Ȁ;fqs఻⫎⫣⫯tĀar⫔⫙rro÷⫁ightarro÷⪐ƀ;qs఻⪺⫪lanôౕĀ;sౕ⫴»శiíౝĀ;rవ⫾iĀ;eచథiäඐĀpt⬌⬑f;쀀𝕟膀¬;in⬙⬚⬶䂬nȀ;Edvஉ⬤⬨⬮;쀀⋹̸ot;쀀⋵̸ǡஉ⬳⬵;拷;拶iĀ;vಸ⬼ǡಸ⭁⭃;拾;拽ƀaor⭋⭣⭩rȀ;ast୻⭕⭚⭟lleì୻l;쀀⫽⃥;쀀∂̸lint;樔ƀ;ceಒ⭰⭳uåಥĀ;cಘ⭸Ā;eಒ⭽ñಘȀAait⮈⮋⮝⮧rò⦈rrƀ;cw⮔⮕⮙憛;쀀⤳̸;쀀↝̸ghtarrow»⮕riĀ;eೋೖ΀chimpqu⮽⯍⯙⬄୸⯤⯯Ȁ;cerല⯆ഷ⯉uå൅;쀀𝓃ortɭ⬅\0\0⯖ará⭖mĀ;e൮⯟Ā;q൴൳suĀbp⯫⯭å೸åഋƀbcp⯶ⰑⰙȀ;Ees⯿ⰀഢⰄ抄;쀀⫅̸etĀ;eഛⰋqĀ;qണⰀcĀ;eലⰗñസȀ;EesⰢⰣൟⰧ抅;쀀⫆̸etĀ;e൘ⰮqĀ;qൠⰣȀgilrⰽⰿⱅⱇìௗlde耻ñ䃱çృiangleĀlrⱒⱜeftĀ;eచⱚñదightĀ;eೋⱥñ೗Ā;mⱬⱭ䎽ƀ;esⱴⱵⱹ䀣ro;愖p;怇ҀDHadgilrsⲏⲔⲙⲞⲣⲰⲶⳓⳣash;抭arr;椄p;쀀≍⃒ash;抬ĀetⲨⲬ;쀀≥⃒;쀀>⃒nfin;槞ƀAetⲽⳁⳅrr;椂;쀀≤⃒Ā;rⳊⳍ쀀<⃒ie;쀀⊴⃒ĀAtⳘⳜrr;椃rie;쀀⊵⃒im;쀀∼⃒ƀAan⳰⳴ⴂrr;懖rĀhr⳺⳽k;椣Ā;oᏧᏥear;椧ቓ᪕\0\0\0\0\0\0\0\0\0\0\0\0\0ⴭ\0ⴸⵈⵠⵥ⵲ⶄᬇ\0\0ⶍⶫ\0ⷈⷎ\0ⷜ⸙⸫⸾⹃Ācsⴱ᪗ute耻ó䃳ĀiyⴼⵅrĀ;c᪞ⵂ耻ô䃴;䐾ʀabios᪠ⵒⵗǈⵚlac;䅑v;樸old;榼lig;䅓Ācr⵩⵭ir;榿;쀀𝔬ͯ⵹\0\0⵼\0ⶂn;䋛ave耻ò䃲;槁Ābmⶈ෴ar;榵Ȁacitⶕ⶘ⶥⶨrò᪀Āir⶝ⶠr;榾oss;榻nå๒;槀ƀaeiⶱⶵⶹcr;䅍ga;䏉ƀcdnⷀⷅǍron;䎿;榶pf;쀀𝕠ƀaelⷔ⷗ǒr;榷rp;榹΀;adiosvⷪⷫⷮ⸈⸍⸐⸖戨rò᪆Ȁ;efmⷷⷸ⸂⸅橝rĀ;oⷾⷿ愴f»ⷿ耻ª䂪耻º䂺gof;抶r;橖lope;橗;橛ƀclo⸟⸡⸧ò⸁ash耻ø䃸l;折iŬⸯ⸴de耻õ䃵esĀ;aǛ⸺s;樶ml耻ö䃶bar;挽ૡ⹞\0⹽\0⺀⺝\0⺢⺹\0\0⻋ຜ\0⼓\0\0⼫⾼\0⿈rȀ;astЃ⹧⹲຅脀¶;l⹭⹮䂶leìЃɩ⹸\0\0⹻m;櫳;櫽y;䐿rʀcimpt⺋⺏⺓ᡥ⺗nt;䀥od;䀮il;怰enk;怱r;쀀𝔭ƀimo⺨⺰⺴Ā;v⺭⺮䏆;䏕maô੶ne;明ƀ;tv⺿⻀⻈䏀chfork»´;䏖Āau⻏⻟nĀck⻕⻝kĀ;h⇴⻛;愎ö⇴sҀ;abcdemst⻳⻴ᤈ⻹⻽⼄⼆⼊⼎䀫cir;樣ir;樢Āouᵀ⼂;樥;橲n肻±ຝim;樦wo;樧ƀipu⼙⼠⼥ntint;樕f;쀀𝕡nd耻£䂣Ԁ;Eaceinosu່⼿⽁⽄⽇⾁⾉⾒⽾⾶;檳p;檷uå໙Ā;c໎⽌̀;acens່⽙⽟⽦⽨⽾pproø⽃urlyeñ໙ñ໎ƀaes⽯⽶⽺pprox;檹qq;檵im;拨iíໟmeĀ;s⾈ຮ怲ƀEas⽸⾐⽺ð⽵ƀdfp໬⾙⾯ƀals⾠⾥⾪lar;挮ine;挒urf;挓Ā;t໻⾴ï໻rel;抰Āci⿀⿅r;쀀𝓅;䏈ncsp;怈̀fiopsu⿚⋢⿟⿥⿫⿱r;쀀𝔮pf;쀀𝕢rime;恗cr;쀀𝓆ƀaeo⿸〉〓tĀei⿾々rnionóڰnt;樖stĀ;e【】䀿ñἙô༔઀ABHabcdefhilmnoprstux぀けさすムㄎㄫㅇㅢㅲㆎ㈆㈕㈤㈩㉘㉮㉲㊐㊰㊷ƀartぇおがròႳòϝail;検aròᱥar;楤΀cdenqrtとふへみわゔヌĀeuねぱ;쀀∽̱te;䅕iãᅮmptyv;榳gȀ;del࿑らるろ;榒;榥å࿑uo耻»䂻rր;abcfhlpstw࿜ガクシスゼゾダッデナp;極Ā;f࿠ゴs;椠;椳s;椞ë≝ð✮l;楅im;楴l;憣;憝Āaiパフil;椚oĀ;nホボ戶aló༞ƀabrョリヮrò៥rk;杳ĀakンヽcĀekヹ・;䁽;䁝Āes㄂㄄;榌lĀduㄊㄌ;榎;榐Ȁaeuyㄗㄜㄧㄩron;䅙Ādiㄡㄥil;䅗ì࿲âヺ;䑀Ȁclqsㄴㄷㄽㅄa;椷dhar;楩uoĀ;rȎȍh;憳ƀacgㅎㅟངlȀ;ipsླྀㅘㅛႜnåႻarôྩt;断ƀilrㅩဣㅮsht;楽;쀀𝔯ĀaoㅷㆆrĀduㅽㅿ»ѻĀ;l႑ㆄ;楬Ā;vㆋㆌ䏁;䏱ƀgns㆕ㇹㇼht̀ahlrstㆤㆰ㇂㇘㇤㇮rrowĀ;t࿜ㆭaéトarpoonĀduㆻㆿowîㅾp»႒eftĀah㇊㇐rrowó࿪arpoonóՑightarrows;應quigarro÷ニhreetimes;拌g;䋚ingdotseñἲƀahm㈍㈐㈓rò࿪aòՑ;怏oustĀ;a㈞㈟掱che»㈟mid;櫮Ȁabpt㈲㈽㉀㉒Ānr㈷㈺g;柭r;懾rëဃƀafl㉇㉊㉎r;榆;쀀𝕣us;樮imes;樵Āap㉝㉧rĀ;g㉣㉤䀩t;榔olint;樒arò㇣Ȁachq㉻㊀Ⴜ㊅quo;怺r;쀀𝓇Ābu・㊊oĀ;rȔȓƀhir㊗㊛㊠reåㇸmes;拊iȀ;efl㊪ၙᠡ㊫方tri;槎luhar;楨;愞ൡ㋕㋛㋟㌬㌸㍱\0㍺㎤\0\0㏬㏰\0㐨㑈㑚㒭㒱㓊㓱\0㘖\0\0㘳cute;䅛quï➺Ԁ;Eaceinpsyᇭ㋳㋵㋿㌂㌋㌏㌟㌦㌩;檴ǰ㋺\0㋼;檸on;䅡uåᇾĀ;dᇳ㌇il;䅟rc;䅝ƀEas㌖㌘㌛;檶p;檺im;择olint;樓iíሄ;䑁otƀ;be㌴ᵇ㌵担;橦΀Aacmstx㍆㍊㍗㍛㍞㍣㍭rr;懘rĀhr㍐㍒ë∨Ā;oਸ਼਴t耻§䂧i;䀻war;椩mĀin㍩ðnuóñt;朶rĀ;o㍶⁕쀀𝔰Ȁacoy㎂㎆㎑㎠rp;景Āhy㎋㎏cy;䑉;䑈rtɭ㎙\0\0㎜iäᑤaraì⹯耻­䂭Āgm㎨㎴maƀ;fv㎱㎲㎲䏃;䏂Ѐ;deglnprካ㏅㏉㏎㏖㏞㏡㏦ot;橪Ā;q኱ኰĀ;E㏓㏔檞;檠Ā;E㏛㏜檝;檟e;扆lus;樤arr;楲aròᄽȀaeit㏸㐈㐏㐗Āls㏽㐄lsetmé㍪hp;樳parsl;槤Ādlᑣ㐔e;挣Ā;e㐜㐝檪Ā;s㐢㐣檬;쀀⪬︀ƀflp㐮㐳㑂tcy;䑌Ā;b㐸㐹䀯Ā;a㐾㐿槄r;挿f;쀀𝕤aĀdr㑍ЂesĀ;u㑔㑕晠it»㑕ƀcsu㑠㑹㒟Āau㑥㑯pĀ;sᆈ㑫;쀀⊓︀pĀ;sᆴ㑵;쀀⊔︀uĀbp㑿㒏ƀ;esᆗᆜ㒆etĀ;eᆗ㒍ñᆝƀ;esᆨᆭ㒖etĀ;eᆨ㒝ñᆮƀ;afᅻ㒦ְrť㒫ֱ»ᅼaròᅈȀcemt㒹㒾㓂㓅r;쀀𝓈tmîñiì㐕aræᆾĀar㓎㓕rĀ;f㓔ឿ昆Āan㓚㓭ightĀep㓣㓪psiloîỠhé⺯s»⡒ʀbcmnp㓻㕞ሉ㖋㖎Ҁ;Edemnprs㔎㔏㔑㔕㔞㔣㔬㔱㔶抂;櫅ot;檽Ā;dᇚ㔚ot;櫃ult;櫁ĀEe㔨㔪;櫋;把lus;檿arr;楹ƀeiu㔽㕒㕕tƀ;en㔎㕅㕋qĀ;qᇚ㔏eqĀ;q㔫㔨m;櫇Ābp㕚㕜;櫕;櫓c̀;acensᇭ㕬㕲㕹㕻㌦pproø㋺urlyeñᇾñᇳƀaes㖂㖈㌛pproø㌚qñ㌗g;晪ڀ123;Edehlmnps㖩㖬㖯ሜ㖲㖴㗀㗉㗕㗚㗟㗨㗭耻¹䂹耻²䂲耻³䂳;櫆Āos㖹㖼t;檾ub;櫘Ā;dሢ㗅ot;櫄sĀou㗏㗒l;柉b;櫗arr;楻ult;櫂ĀEe㗤㗦;櫌;抋lus;櫀ƀeiu㗴㘉㘌tƀ;enሜ㗼㘂qĀ;qሢ㖲eqĀ;q㗧㗤m;櫈Ābp㘑㘓;櫔;櫖ƀAan㘜㘠㘭rr;懙rĀhr㘦㘨ë∮Ā;oਫ਩war;椪lig耻ß䃟௡㙑㙝㙠ዎ㙳㙹\0㙾㛂\0\0\0\0\0㛛㜃\0㜉㝬\0\0\0㞇ɲ㙖\0\0㙛get;挖;䏄rë๟ƀaey㙦㙫㙰ron;䅥dil;䅣;䑂lrec;挕r;쀀𝔱Ȁeiko㚆㚝㚵㚼ǲ㚋\0㚑eĀ4fኄኁaƀ;sv㚘㚙㚛䎸ym;䏑Ācn㚢㚲kĀas㚨㚮pproø዁im»ኬsðኞĀas㚺㚮ð዁rn耻þ䃾Ǭ̟㛆⋧es膀×;bd㛏㛐㛘䃗Ā;aᤏ㛕r;樱;樰ƀeps㛡㛣㜀á⩍Ȁ;bcf҆㛬㛰㛴ot;挶ir;櫱Ā;o㛹㛼쀀𝕥rk;櫚á㍢rime;怴ƀaip㜏㜒㝤dåቈ΀adempst㜡㝍㝀㝑㝗㝜㝟ngleʀ;dlqr㜰㜱㜶㝀㝂斵own»ᶻeftĀ;e⠀㜾ñम;扜ightĀ;e㊪㝋ñၚot;旬inus;樺lus;樹b;槍ime;樻ezium;揢ƀcht㝲㝽㞁Āry㝷㝻;쀀𝓉;䑆cy;䑛rok;䅧Āio㞋㞎xô᝷headĀlr㞗㞠eftarro÷ࡏightarrow»ཝऀAHabcdfghlmoprstuw㟐㟓㟗㟤㟰㟼㠎㠜㠣㠴㡑㡝㡫㢩㣌㣒㣪㣶ròϭar;楣Ācr㟜㟢ute耻ú䃺òᅐrǣ㟪\0㟭y;䑞ve;䅭Āiy㟵㟺rc耻û䃻;䑃ƀabh㠃㠆㠋ròᎭlac;䅱aòᏃĀir㠓㠘sht;楾;쀀𝔲rave耻ù䃹š㠧㠱rĀlr㠬㠮»ॗ»ႃlk;斀Āct㠹㡍ɯ㠿\0\0㡊rnĀ;e㡅㡆挜r»㡆op;挏ri;旸Āal㡖㡚cr;䅫肻¨͉Āgp㡢㡦on;䅳f;쀀𝕦̀adhlsuᅋ㡸㡽፲㢑㢠ownáᎳarpoonĀlr㢈㢌efô㠭ighô㠯iƀ;hl㢙㢚㢜䏅»ᏺon»㢚parrows;懈ƀcit㢰㣄㣈ɯ㢶\0\0㣁rnĀ;e㢼㢽挝r»㢽op;挎ng;䅯ri;旹cr;쀀𝓊ƀdir㣙㣝㣢ot;拰lde;䅩iĀ;f㜰㣨»᠓Āam㣯㣲rò㢨l耻ü䃼angle;榧ހABDacdeflnoprsz㤜㤟㤩㤭㦵㦸㦽㧟㧤㧨㧳㧹㧽㨁㨠ròϷarĀ;v㤦㤧櫨;櫩asèϡĀnr㤲㤷grt;榜΀eknprst㓣㥆㥋㥒㥝㥤㦖appá␕othinçẖƀhir㓫⻈㥙opô⾵Ā;hᎷ㥢ïㆍĀiu㥩㥭gmá㎳Ābp㥲㦄setneqĀ;q㥽㦀쀀⊊︀;쀀⫋︀setneqĀ;q㦏㦒쀀⊋︀;쀀⫌︀Āhr㦛㦟etá㚜iangleĀlr㦪㦯eft»थight»ၑy;䐲ash»ံƀelr㧄㧒㧗ƀ;beⷪ㧋㧏ar;抻q;扚lip;拮Ābt㧜ᑨaòᑩr;쀀𝔳tré㦮suĀbp㧯㧱»ജ»൙pf;쀀𝕧roð໻tré㦴Ācu㨆㨋r;쀀𝓋Ābp㨐㨘nĀEe㦀㨖»㥾nĀEe㦒㨞»㦐igzag;榚΀cefoprs㨶㨻㩖㩛㩔㩡㩪irc;䅵Ādi㩀㩑Ābg㩅㩉ar;機eĀ;qᗺ㩏;扙erp;愘r;쀀𝔴pf;쀀𝕨Ā;eᑹ㩦atèᑹcr;쀀𝓌ૣណ㪇\0㪋\0㪐㪛\0\0㪝㪨㪫㪯\0\0㫃㫎\0㫘ៜ៟tré៑r;쀀𝔵ĀAa㪔㪗ròσrò৶;䎾ĀAa㪡㪤ròθrò৫að✓is;拻ƀdptឤ㪵㪾Āfl㪺ឩ;쀀𝕩imåឲĀAa㫇㫊ròώròਁĀcq㫒ីr;쀀𝓍Āpt៖㫜ré។Ѐacefiosu㫰㫽㬈㬌㬑㬕㬛㬡cĀuy㫶㫻te耻ý䃽;䑏Āiy㬂㬆rc;䅷;䑋n耻¥䂥r;쀀𝔶cy;䑗pf;쀀𝕪cr;쀀𝓎Ācm㬦㬩y;䑎l耻ÿ䃿Ԁacdefhiosw㭂㭈㭔㭘㭤㭩㭭㭴㭺㮀cute;䅺Āay㭍㭒ron;䅾;䐷ot;䅼Āet㭝㭡træᕟa;䎶r;쀀𝔷cy;䐶grarr;懝pf;쀀𝕫cr;쀀𝓏Ājn㮅㮇;怍j;怌'.split("").map(t=>t.charCodeAt(0))),k7=new Uint16Array("Ȁaglq	\x1Bɭ\0\0p;䀦os;䀧t;䀾t;䀼uot;䀢".split("").map(t=>t.charCodeAt(0)));var Kf;const N7=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]),S7=(Kf=String.fromCodePoint)!==null&&Kf!==void 0?Kf:function(t){let e="";return t>65535&&(t-=65536,e+=String.fromCharCode(t>>>10&1023|55296),t=56320|t&1023),e+=String.fromCharCode(t),e};function C7(t){var e;return t>=55296&&t<=57343||t>1114111?65533:(e=N7.get(t))!==null&&e!==void 0?e:t}var At;(function(t){t[t.NUM=35]="NUM",t[t.SEMI=59]="SEMI",t[t.EQUALS=61]="EQUALS",t[t.ZERO=48]="ZERO",t[t.NINE=57]="NINE",t[t.LOWER_A=97]="LOWER_A",t[t.LOWER_F=102]="LOWER_F",t[t.LOWER_X=120]="LOWER_X",t[t.LOWER_Z=122]="LOWER_Z",t[t.UPPER_A=65]="UPPER_A",t[t.UPPER_F=70]="UPPER_F",t[t.UPPER_Z=90]="UPPER_Z"})(At||(At={}));const z7=32;var Br;(function(t){t[t.VALUE_LENGTH=49152]="VALUE_LENGTH",t[t.BRANCH_LENGTH=16256]="BRANCH_LENGTH",t[t.JUMP_TABLE=127]="JUMP_TABLE"})(Br||(Br={}));function jp(t){return t>=At.ZERO&&t<=At.NINE}function _7(t){return t>=At.UPPER_A&&t<=At.UPPER_F||t>=At.LOWER_A&&t<=At.LOWER_F}function A7(t){return t>=At.UPPER_A&&t<=At.UPPER_Z||t>=At.LOWER_A&&t<=At.LOWER_Z||jp(t)}function T7(t){return t===At.EQUALS||A7(t)}var Ct;(function(t){t[t.EntityStart=0]="EntityStart",t[t.NumericStart=1]="NumericStart",t[t.NumericDecimal=2]="NumericDecimal",t[t.NumericHex=3]="NumericHex",t[t.NamedEntity=4]="NamedEntity"})(Ct||(Ct={}));var Or;(function(t){t[t.Legacy=0]="Legacy",t[t.Strict=1]="Strict",t[t.Attribute=2]="Attribute"})(Or||(Or={}));class E7{constructor(e,s,n){this.decodeTree=e,this.emitCodePoint=s,this.errors=n,this.state=Ct.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=Or.Strict}startEntity(e){this.decodeMode=e,this.state=Ct.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1}write(e,s){switch(this.state){case Ct.EntityStart:return e.charCodeAt(s)===At.NUM?(this.state=Ct.NumericStart,this.consumed+=1,this.stateNumericStart(e,s+1)):(this.state=Ct.NamedEntity,this.stateNamedEntity(e,s));case Ct.NumericStart:return this.stateNumericStart(e,s);case Ct.NumericDecimal:return this.stateNumericDecimal(e,s);case Ct.NumericHex:return this.stateNumericHex(e,s);case Ct.NamedEntity:return this.stateNamedEntity(e,s)}}stateNumericStart(e,s){return s>=e.length?-1:(e.charCodeAt(s)|z7)===At.LOWER_X?(this.state=Ct.NumericHex,this.consumed+=1,this.stateNumericHex(e,s+1)):(this.state=Ct.NumericDecimal,this.stateNumericDecimal(e,s))}addToNumericResult(e,s,n,i){if(s!==n){const a=n-s;this.result=this.result*Math.pow(i,a)+parseInt(e.substr(s,a),i),this.consumed+=a}}stateNumericHex(e,s){const n=s;for(;s<e.length;){const i=e.charCodeAt(s);if(jp(i)||_7(i))s+=1;else return this.addToNumericResult(e,n,s,16),this.emitNumericEntity(i,3)}return this.addToNumericResult(e,n,s,16),-1}stateNumericDecimal(e,s){const n=s;for(;s<e.length;){const i=e.charCodeAt(s);if(jp(i))s+=1;else return this.addToNumericResult(e,n,s,10),this.emitNumericEntity(i,2)}return this.addToNumericResult(e,n,s,10),-1}emitNumericEntity(e,s){var n;if(this.consumed<=s)return(n=this.errors)===null||n===void 0||n.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(e===At.SEMI)this.consumed+=1;else if(this.decodeMode===Or.Strict)return 0;return this.emitCodePoint(C7(this.result),this.consumed),this.errors&&(e!==At.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed}stateNamedEntity(e,s){const{decodeTree:n}=this;let i=n[this.treeIndex],a=(i&Br.VALUE_LENGTH)>>14;for(;s<e.length;s++,this.excess++){const o=e.charCodeAt(s);if(this.treeIndex=D7(n,i,this.treeIndex+Math.max(1,a),o),this.treeIndex<0)return this.result===0||this.decodeMode===Or.Attribute&&(a===0||T7(o))?0:this.emitNotTerminatedNamedEntity();if(i=n[this.treeIndex],a=(i&Br.VALUE_LENGTH)>>14,a!==0){if(o===At.SEMI)return this.emitNamedEntityData(this.treeIndex,a,this.consumed+this.excess);this.decodeMode!==Or.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1}emitNotTerminatedNamedEntity(){var e;const{result:s,decodeTree:n}=this,i=(n[s]&Br.VALUE_LENGTH)>>14;return this.emitNamedEntityData(s,i,this.consumed),(e=this.errors)===null||e===void 0||e.missingSemicolonAfterCharacterReference(),this.consumed}emitNamedEntityData(e,s,n){const{decodeTree:i}=this;return this.emitCodePoint(s===1?i[e]&~Br.VALUE_LENGTH:i[e+1],n),s===3&&this.emitCodePoint(i[e+2],n),n}end(){var e;switch(this.state){case Ct.NamedEntity:return this.result!==0&&(this.decodeMode!==Or.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case Ct.NumericDecimal:return this.emitNumericEntity(0,2);case Ct.NumericHex:return this.emitNumericEntity(0,3);case Ct.NumericStart:return(e=this.errors)===null||e===void 0||e.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case Ct.EntityStart:return 0}}}function HC(t){let e="";const s=new E7(t,n=>e+=S7(n));return function(i,a){let o=0,l=0;for(;(l=i.indexOf("&",l))>=0;){e+=i.slice(o,l),s.startEntity(a);const u=s.write(i,l+1);if(u<0){o=l+s.end();break}o=l+u,l=u===0?o+1:o}const c=e+i.slice(o);return e="",c}}function D7(t,e,s,n){const i=(e&Br.BRANCH_LENGTH)>>7,a=e&Br.JUMP_TABLE;if(i===0)return a!==0&&n===a?s:-1;if(a){const c=n-a;return c<0||c>=i?-1:t[s+c]-1}let o=s,l=o+i-1;for(;o<=l;){const c=o+l>>>1,u=t[c];if(u<n)o=c+1;else if(u>n)l=c-1;else return t[c+i]}return-1}const M7=HC(v7);HC(k7);function GC(t,e=Or.Legacy){return M7(t,e)}function P7(t){return Object.prototype.toString.call(t)}function zg(t){return P7(t)==="[object String]"}const I7=Object.prototype.hasOwnProperty;function O7(t,e){return I7.call(t,e)}function Rh(t){return Array.prototype.slice.call(arguments,1).forEach(function(s){if(s){if(typeof s!="object")throw new TypeError(s+"must be object");Object.keys(s).forEach(function(n){t[n]=s[n]})}}),t}function JC(t,e,s){return[].concat(t.slice(0,e),s,t.slice(e+1))}function _g(t){return!(t>=55296&&t<=57343||t>=64976&&t<=65007||(t&65535)===65535||(t&65535)===65534||t>=0&&t<=8||t===11||t>=14&&t<=31||t>=127&&t<=159||t>1114111)}function zd(t){if(t>65535){t-=65536;const e=55296+(t>>10),s=56320+(t&1023);return String.fromCharCode(e,s)}return String.fromCharCode(t)}const ZC=/\\([!"#$%&'()*+,\-./:;<=>?@[\\\]^_`{|}~])/g,R7=/&([a-z#][a-z0-9]{1,31});/gi,L7=new RegExp(ZC.source+"|"+R7.source,"gi"),F7=/^#((?:x[a-f0-9]{1,8}|[0-9]{1,8}))$/i;function $7(t,e){if(e.charCodeAt(0)===35&&F7.test(e)){const n=e[1].toLowerCase()==="x"?parseInt(e.slice(2),16):parseInt(e.slice(1),10);return _g(n)?zd(n):t}const s=GC(t);return s!==t?s:t}function B7(t){return t.indexOf("\\")<0?t:t.replace(ZC,"$1")}function ao(t){return t.indexOf("\\")<0&&t.indexOf("&")<0?t:t.replace(L7,function(e,s,n){return s||$7(e,n)})}const q7=/[&<>"]/,V7=/[&<>"]/g,U7={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};function W7(t){return U7[t]}function ei(t){return q7.test(t)?t.replace(V7,W7):t}const K7=/[.?*+^$[\]\\(){}|-]/g;function H7(t){return t.replace(K7,"\\$&")}function Le(t){switch(t){case 9:case 32:return!0}return!1}function Vl(t){if(t>=8192&&t<=8202)return!0;switch(t){case 9:case 10:case 11:case 12:case 13:case 32:case 160:case 5760:case 8239:case 8287:case 12288:return!0}return!1}function Ul(t){return Cg.test(t)||WC.test(t)}function Wl(t){switch(t){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 58:case 59:case 60:case 61:case 62:case 63:case 64:case 91:case 92:case 93:case 94:case 95:case 96:case 123:case 124:case 125:case 126:return!0;default:return!1}}function Lh(t){return t=t.trim().replace(/\s+/g," "),"ẞ".toLowerCase()==="Ṿ"&&(t=t.replace(/ẞ/g,"ß")),t.toLowerCase().toUpperCase()}const G7={mdurl:b7,ucmicro:w7},J7=Object.freeze(Object.defineProperty({__proto__:null,arrayReplaceAt:JC,assign:Rh,escapeHtml:ei,escapeRE:H7,fromCodePoint:zd,has:O7,isMdAsciiPunct:Wl,isPunctChar:Ul,isSpace:Le,isString:zg,isValidEntityCode:_g,isWhiteSpace:Vl,lib:G7,normalizeReference:Lh,unescapeAll:ao,unescapeMd:B7},Symbol.toStringTag,{value:"Module"}));function Z7(t,e,s){let n,i,a,o;const l=t.posMax,c=t.pos;for(t.pos=e+1,n=1;t.pos<l;){if(a=t.src.charCodeAt(t.pos),a===93&&(n--,n===0)){i=!0;break}if(o=t.pos,t.md.inline.skipToken(t),a===91){if(o===t.pos-1)n++;else if(s)return t.pos=c,-1}}let u=-1;return i&&(u=t.pos),t.pos=c,u}function Q7(t,e,s){let n,i=e;const a={ok:!1,pos:0,str:""};if(t.charCodeAt(i)===60){for(i++;i<s;){if(n=t.charCodeAt(i),n===10||n===60)return a;if(n===62)return a.pos=i+1,a.str=ao(t.slice(e+1,i)),a.ok=!0,a;if(n===92&&i+1<s){i+=2;continue}i++}return a}let o=0;for(;i<s&&(n=t.charCodeAt(i),!(n===32||n<32||n===127));){if(n===92&&i+1<s){if(t.charCodeAt(i+1)===32)break;i+=2;continue}if(n===40&&(o++,o>32))return a;if(n===41){if(o===0)break;o--}i++}return e===i||o!==0||(a.str=ao(t.slice(e,i)),a.pos=i,a.ok=!0),a}function Y7(t,e,s,n){let i,a=e;const o={ok:!1,can_continue:!1,pos:0,str:"",marker:0};if(n)o.str=n.str,o.marker=n.marker;else{if(a>=s)return o;let l=t.charCodeAt(a);if(l!==34&&l!==39&&l!==40)return o;e++,a++,l===40&&(l=41),o.marker=l}for(;a<s;){if(i=t.charCodeAt(a),i===o.marker)return o.pos=a+1,o.str+=ao(t.slice(e,a)),o.ok=!0,o;if(i===40&&o.marker===41)return o;i===92&&a+1<s&&a++,a++}return o.can_continue=!0,o.str+=ao(t.slice(e,a)),o}const X7=Object.freeze(Object.defineProperty({__proto__:null,parseLinkDestination:Q7,parseLinkLabel:Z7,parseLinkTitle:Y7},Symbol.toStringTag,{value:"Module"})),Un={};Un.code_inline=function(t,e,s,n,i){const a=t[e];return"<code"+i.renderAttrs(a)+">"+ei(a.content)+"</code>"};Un.code_block=function(t,e,s,n,i){const a=t[e];return"<pre"+i.renderAttrs(a)+"><code>"+ei(t[e].content)+`</code></pre>
`};Un.fence=function(t,e,s,n,i){const a=t[e],o=a.info?ao(a.info).trim():"";let l="",c="";if(o){const d=o.split(/(\s+)/g);l=d[0],c=d.slice(2).join("")}let u;if(s.highlight?u=s.highlight(a.content,l,c)||ei(a.content):u=ei(a.content),u.indexOf("<pre")===0)return u+`
`;if(o){const d=a.attrIndex("class"),h=a.attrs?a.attrs.slice():[];d<0?h.push(["class",s.langPrefix+l]):(h[d]=h[d].slice(),h[d][1]+=" "+s.langPrefix+l);const f={attrs:h};return`<pre><code${i.renderAttrs(f)}>${u}</code></pre>
`}return`<pre><code${i.renderAttrs(a)}>${u}</code></pre>
`};Un.image=function(t,e,s,n,i){const a=t[e];return a.attrs[a.attrIndex("alt")][1]=i.renderInlineAsText(a.children,s,n),i.renderToken(t,e,s)};Un.hardbreak=function(t,e,s){return s.xhtmlOut?`<br />
`:`<br>
`};Un.softbreak=function(t,e,s){return s.breaks?s.xhtmlOut?`<br />
`:`<br>
`:`
`};Un.text=function(t,e){return ei(t[e].content)};Un.html_block=function(t,e){return t[e].content};Un.html_inline=function(t,e){return t[e].content};function ko(){this.rules=Rh({},Un)}ko.prototype.renderAttrs=function(e){let s,n,i;if(!e.attrs)return"";for(i="",s=0,n=e.attrs.length;s<n;s++)i+=" "+ei(e.attrs[s][0])+'="'+ei(e.attrs[s][1])+'"';return i};ko.prototype.renderToken=function(e,s,n){const i=e[s];let a="";if(i.hidden)return"";i.block&&i.nesting!==-1&&s&&e[s-1].hidden&&(a+=`
`),a+=(i.nesting===-1?"</":"<")+i.tag,a+=this.renderAttrs(i),i.nesting===0&&n.xhtmlOut&&(a+=" /");let o=!1;if(i.block&&(o=!0,i.nesting===1&&s+1<e.length)){const l=e[s+1];(l.type==="inline"||l.hidden||l.nesting===-1&&l.tag===i.tag)&&(o=!1)}return a+=o?`>
`:">",a};ko.prototype.renderInline=function(t,e,s){let n="";const i=this.rules;for(let a=0,o=t.length;a<o;a++){const l=t[a].type;typeof i[l]<"u"?n+=i[l](t,a,e,s,this):n+=this.renderToken(t,a,e)}return n};ko.prototype.renderInlineAsText=function(t,e,s){let n="";for(let i=0,a=t.length;i<a;i++)switch(t[i].type){case"text":n+=t[i].content;break;case"image":n+=this.renderInlineAsText(t[i].children,e,s);break;case"html_inline":case"html_block":n+=t[i].content;break;case"softbreak":case"hardbreak":n+=`
`;break}return n};ko.prototype.render=function(t,e,s){let n="";const i=this.rules;for(let a=0,o=t.length;a<o;a++){const l=t[a].type;l==="inline"?n+=this.renderInline(t[a].children,e,s):typeof i[l]<"u"?n+=i[l](t,a,e,s,this):n+=this.renderToken(t,a,e,s)}return n};function vs(){this.__rules__=[],this.__cache__=null}vs.prototype.__find__=function(t){for(let e=0;e<this.__rules__.length;e++)if(this.__rules__[e].name===t)return e;return-1};vs.prototype.__compile__=function(){const t=this,e=[""];t.__rules__.forEach(function(s){s.enabled&&s.alt.forEach(function(n){e.indexOf(n)<0&&e.push(n)})}),t.__cache__={},e.forEach(function(s){t.__cache__[s]=[],t.__rules__.forEach(function(n){n.enabled&&(s&&n.alt.indexOf(s)<0||t.__cache__[s].push(n.fn))})})};vs.prototype.at=function(t,e,s){const n=this.__find__(t),i=s||{};if(n===-1)throw new Error("Parser rule not found: "+t);this.__rules__[n].fn=e,this.__rules__[n].alt=i.alt||[],this.__cache__=null};vs.prototype.before=function(t,e,s,n){const i=this.__find__(t),a=n||{};if(i===-1)throw new Error("Parser rule not found: "+t);this.__rules__.splice(i,0,{name:e,enabled:!0,fn:s,alt:a.alt||[]}),this.__cache__=null};vs.prototype.after=function(t,e,s,n){const i=this.__find__(t),a=n||{};if(i===-1)throw new Error("Parser rule not found: "+t);this.__rules__.splice(i+1,0,{name:e,enabled:!0,fn:s,alt:a.alt||[]}),this.__cache__=null};vs.prototype.push=function(t,e,s){const n=s||{};this.__rules__.push({name:t,enabled:!0,fn:e,alt:n.alt||[]}),this.__cache__=null};vs.prototype.enable=function(t,e){Array.isArray(t)||(t=[t]);const s=[];return t.forEach(function(n){const i=this.__find__(n);if(i<0){if(e)return;throw new Error("Rules manager: invalid rule name "+n)}this.__rules__[i].enabled=!0,s.push(n)},this),this.__cache__=null,s};vs.prototype.enableOnly=function(t,e){Array.isArray(t)||(t=[t]),this.__rules__.forEach(function(s){s.enabled=!1}),this.enable(t,e)};vs.prototype.disable=function(t,e){Array.isArray(t)||(t=[t]);const s=[];return t.forEach(function(n){const i=this.__find__(n);if(i<0){if(e)return;throw new Error("Rules manager: invalid rule name "+n)}this.__rules__[i].enabled=!1,s.push(n)},this),this.__cache__=null,s};vs.prototype.getRules=function(t){return this.__cache__===null&&this.__compile__(),this.__cache__[t]||[]};function jn(t,e,s){this.type=t,this.tag=e,this.attrs=null,this.map=null,this.nesting=s,this.level=0,this.children=null,this.content="",this.markup="",this.info="",this.meta=null,this.block=!1,this.hidden=!1}jn.prototype.attrIndex=function(e){if(!this.attrs)return-1;const s=this.attrs;for(let n=0,i=s.length;n<i;n++)if(s[n][0]===e)return n;return-1};jn.prototype.attrPush=function(e){this.attrs?this.attrs.push(e):this.attrs=[e]};jn.prototype.attrSet=function(e,s){const n=this.attrIndex(e),i=[e,s];n<0?this.attrPush(i):this.attrs[n]=i};jn.prototype.attrGet=function(e){const s=this.attrIndex(e);let n=null;return s>=0&&(n=this.attrs[s][1]),n};jn.prototype.attrJoin=function(e,s){const n=this.attrIndex(e);n<0?this.attrPush([e,s]):this.attrs[n][1]=this.attrs[n][1]+" "+s};function QC(t,e,s){this.src=t,this.env=s,this.tokens=[],this.inlineMode=!1,this.md=e}QC.prototype.Token=jn;const eq=/\r\n?|\n/g,tq=/\0/g;function sq(t){let e;e=t.src.replace(eq,`
`),e=e.replace(tq,"�"),t.src=e}function nq(t){let e;t.inlineMode?(e=new t.Token("inline","",0),e.content=t.src,e.map=[0,1],e.children=[],t.tokens.push(e)):t.md.block.parse(t.src,t.md,t.env,t.tokens)}function rq(t){const e=t.tokens;for(let s=0,n=e.length;s<n;s++){const i=e[s];i.type==="inline"&&t.md.inline.parse(i.content,t.md,t.env,i.children)}}function iq(t){return/^<a[>\s]/i.test(t)}function aq(t){return/^<\/a\s*>/i.test(t)}function oq(t){const e=t.tokens;if(t.md.options.linkify)for(let s=0,n=e.length;s<n;s++){if(e[s].type!=="inline"||!t.md.linkify.pretest(e[s].content))continue;let i=e[s].children,a=0;for(let o=i.length-1;o>=0;o--){const l=i[o];if(l.type==="link_close"){for(o--;i[o].level!==l.level&&i[o].type!=="link_open";)o--;continue}if(l.type==="html_inline"&&(iq(l.content)&&a>0&&a--,aq(l.content)&&a++),!(a>0)&&l.type==="text"&&t.md.linkify.test(l.content)){const c=l.content;let u=t.md.linkify.match(c);const d=[];let h=l.level,f=0;u.length>0&&u[0].index===0&&o>0&&i[o-1].type==="text_special"&&(u=u.slice(1));for(let m=0;m<u.length;m++){const p=u[m].url,x=t.md.normalizeLink(p);if(!t.md.validateLink(x))continue;let g=u[m].text;u[m].schema?u[m].schema==="mailto:"&&!/^mailto:/i.test(g)?g=t.md.normalizeLinkText("mailto:"+g).replace(/^mailto:/,""):g=t.md.normalizeLinkText(g):g=t.md.normalizeLinkText("http://"+g).replace(/^http:\/\//,"");const y=u[m].index;if(y>f){const z=new t.Token("text","",0);z.content=c.slice(f,y),z.level=h,d.push(z)}const b=new t.Token("link_open","a",1);b.attrs=[["href",x]],b.level=h++,b.markup="linkify",b.info="auto",d.push(b);const w=new t.Token("text","",0);w.content=g,w.level=h,d.push(w);const S=new t.Token("link_close","a",-1);S.level=--h,S.markup="linkify",S.info="auto",d.push(S),f=u[m].lastIndex}if(f<c.length){const m=new t.Token("text","",0);m.content=c.slice(f),m.level=h,d.push(m)}e[s].children=i=JC(i,o,d)}}}}const YC=/\+-|\.\.|\?\?\?\?|!!!!|,,|--/,lq=/\((c|tm|r)\)/i,cq=/\((c|tm|r)\)/ig,uq={c:"©",r:"®",tm:"™"};function dq(t,e){return uq[e.toLowerCase()]}function hq(t){let e=0;for(let s=t.length-1;s>=0;s--){const n=t[s];n.type==="text"&&!e&&(n.content=n.content.replace(cq,dq)),n.type==="link_open"&&n.info==="auto"&&e--,n.type==="link_close"&&n.info==="auto"&&e++}}function fq(t){let e=0;for(let s=t.length-1;s>=0;s--){const n=t[s];n.type==="text"&&!e&&YC.test(n.content)&&(n.content=n.content.replace(/\+-/g,"±").replace(/\.{2,}/g,"…").replace(/([?!])…/g,"$1..").replace(/([?!]){4,}/g,"$1$1$1").replace(/,{2,}/g,",").replace(/(^|[^-])---(?=[^-]|$)/mg,"$1—").replace(/(^|\s)--(?=\s|$)/mg,"$1–").replace(/(^|[^-\s])--(?=[^-\s]|$)/mg,"$1–")),n.type==="link_open"&&n.info==="auto"&&e--,n.type==="link_close"&&n.info==="auto"&&e++}}function mq(t){let e;if(t.md.options.typographer)for(e=t.tokens.length-1;e>=0;e--)t.tokens[e].type==="inline"&&(lq.test(t.tokens[e].content)&&hq(t.tokens[e].children),YC.test(t.tokens[e].content)&&fq(t.tokens[e].children))}const pq=/['"]/,hj=/['"]/g,fj="’";function Zc(t,e,s){return t.slice(0,e)+s+t.slice(e+1)}function xq(t,e){let s;const n=[];for(let i=0;i<t.length;i++){const a=t[i],o=t[i].level;for(s=n.length-1;s>=0&&!(n[s].level<=o);s--);if(n.length=s+1,a.type!=="text")continue;let l=a.content,c=0,u=l.length;e:for(;c<u;){hj.lastIndex=c;const d=hj.exec(l);if(!d)break;let h=!0,f=!0;c=d.index+1;const m=d[0]==="'";let p=32;if(d.index-1>=0)p=l.charCodeAt(d.index-1);else for(s=i-1;s>=0&&!(t[s].type==="softbreak"||t[s].type==="hardbreak");s--)if(t[s].content){p=t[s].content.charCodeAt(t[s].content.length-1);break}let x=32;if(c<u)x=l.charCodeAt(c);else for(s=i+1;s<t.length&&!(t[s].type==="softbreak"||t[s].type==="hardbreak");s++)if(t[s].content){x=t[s].content.charCodeAt(0);break}const g=Wl(p)||Ul(String.fromCharCode(p)),y=Wl(x)||Ul(String.fromCharCode(x)),b=Vl(p),w=Vl(x);if(w?h=!1:y&&(b||g||(h=!1)),b?f=!1:g&&(w||y||(f=!1)),x===34&&d[0]==='"'&&p>=48&&p<=57&&(f=h=!1),h&&f&&(h=g,f=y),!h&&!f){m&&(a.content=Zc(a.content,d.index,fj));continue}if(f)for(s=n.length-1;s>=0;s--){let S=n[s];if(n[s].level<o)break;if(S.single===m&&n[s].level===o){S=n[s];let z,N;m?(z=e.md.options.quotes[2],N=e.md.options.quotes[3]):(z=e.md.options.quotes[0],N=e.md.options.quotes[1]),a.content=Zc(a.content,d.index,N),t[S.token].content=Zc(t[S.token].content,S.pos,z),c+=N.length-1,S.token===i&&(c+=z.length-1),l=a.content,u=l.length,n.length=s;continue e}}h?n.push({token:i,pos:d.index,single:m,level:o}):f&&m&&(a.content=Zc(a.content,d.index,fj))}}}function gq(t){if(t.md.options.typographer)for(let e=t.tokens.length-1;e>=0;e--)t.tokens[e].type!=="inline"||!pq.test(t.tokens[e].content)||xq(t.tokens[e].children,t)}function yq(t){let e,s;const n=t.tokens,i=n.length;for(let a=0;a<i;a++){if(n[a].type!=="inline")continue;const o=n[a].children,l=o.length;for(e=0;e<l;e++)o[e].type==="text_special"&&(o[e].type="text");for(e=s=0;e<l;e++)o[e].type==="text"&&e+1<l&&o[e+1].type==="text"?o[e+1].content=o[e].content+o[e+1].content:(e!==s&&(o[s]=o[e]),s++);e!==s&&(o.length=s)}}const Hf=[["normalize",sq],["block",nq],["inline",rq],["linkify",oq],["replacements",mq],["smartquotes",gq],["text_join",yq]];function Ag(){this.ruler=new vs;for(let t=0;t<Hf.length;t++)this.ruler.push(Hf[t][0],Hf[t][1])}Ag.prototype.process=function(t){const e=this.ruler.getRules("");for(let s=0,n=e.length;s<n;s++)e[s](t)};Ag.prototype.State=QC;function Wn(t,e,s,n){this.src=t,this.md=e,this.env=s,this.tokens=n,this.bMarks=[],this.eMarks=[],this.tShift=[],this.sCount=[],this.bsCount=[],this.blkIndent=0,this.line=0,this.lineMax=0,this.tight=!1,this.ddIndent=-1,this.listIndent=-1,this.parentType="root",this.level=0;const i=this.src;for(let a=0,o=0,l=0,c=0,u=i.length,d=!1;o<u;o++){const h=i.charCodeAt(o);if(!d)if(Le(h)){l++,h===9?c+=4-c%4:c++;continue}else d=!0;(h===10||o===u-1)&&(h!==10&&o++,this.bMarks.push(a),this.eMarks.push(o),this.tShift.push(l),this.sCount.push(c),this.bsCount.push(0),d=!1,l=0,c=0,a=o+1)}this.bMarks.push(i.length),this.eMarks.push(i.length),this.tShift.push(0),this.sCount.push(0),this.bsCount.push(0),this.lineMax=this.bMarks.length-1}Wn.prototype.push=function(t,e,s){const n=new jn(t,e,s);return n.block=!0,s<0&&this.level--,n.level=this.level,s>0&&this.level++,this.tokens.push(n),n};Wn.prototype.isEmpty=function(e){return this.bMarks[e]+this.tShift[e]>=this.eMarks[e]};Wn.prototype.skipEmptyLines=function(e){for(let s=this.lineMax;e<s&&!(this.bMarks[e]+this.tShift[e]<this.eMarks[e]);e++);return e};Wn.prototype.skipSpaces=function(e){for(let s=this.src.length;e<s;e++){const n=this.src.charCodeAt(e);if(!Le(n))break}return e};Wn.prototype.skipSpacesBack=function(e,s){if(e<=s)return e;for(;e>s;)if(!Le(this.src.charCodeAt(--e)))return e+1;return e};Wn.prototype.skipChars=function(e,s){for(let n=this.src.length;e<n&&this.src.charCodeAt(e)===s;e++);return e};Wn.prototype.skipCharsBack=function(e,s,n){if(e<=n)return e;for(;e>n;)if(s!==this.src.charCodeAt(--e))return e+1;return e};Wn.prototype.getLines=function(e,s,n,i){if(e>=s)return"";const a=new Array(s-e);for(let o=0,l=e;l<s;l++,o++){let c=0;const u=this.bMarks[l];let d=u,h;for(l+1<s||i?h=this.eMarks[l]+1:h=this.eMarks[l];d<h&&c<n;){const f=this.src.charCodeAt(d);if(Le(f))f===9?c+=4-(c+this.bsCount[l])%4:c++;else if(d-u<this.tShift[l])c++;else break;d++}c>n?a[o]=new Array(c-n+1).join(" ")+this.src.slice(d,h):a[o]=this.src.slice(d,h)}return a.join("")};Wn.prototype.Token=jn;const bq=65536;function Gf(t,e){const s=t.bMarks[e]+t.tShift[e],n=t.eMarks[e];return t.src.slice(s,n)}function mj(t){const e=[],s=t.length;let n=0,i=t.charCodeAt(n),a=!1,o=0,l="";for(;n<s;)i===124&&(a?(l+=t.substring(o,n-1),o=n):(e.push(l+t.substring(o,n)),l="",o=n+1)),a=i===92,n++,i=t.charCodeAt(n);return e.push(l+t.substring(o)),e}function jq(t,e,s,n){if(e+2>s)return!1;let i=e+1;if(t.sCount[i]<t.blkIndent||t.sCount[i]-t.blkIndent>=4)return!1;let a=t.bMarks[i]+t.tShift[i];if(a>=t.eMarks[i])return!1;const o=t.src.charCodeAt(a++);if(o!==124&&o!==45&&o!==58||a>=t.eMarks[i])return!1;const l=t.src.charCodeAt(a++);if(l!==124&&l!==45&&l!==58&&!Le(l)||o===45&&Le(l))return!1;for(;a<t.eMarks[i];){const S=t.src.charCodeAt(a);if(S!==124&&S!==45&&S!==58&&!Le(S))return!1;a++}let c=Gf(t,e+1),u=c.split("|");const d=[];for(let S=0;S<u.length;S++){const z=u[S].trim();if(!z){if(S===0||S===u.length-1)continue;return!1}if(!/^:?-+:?$/.test(z))return!1;z.charCodeAt(z.length-1)===58?d.push(z.charCodeAt(0)===58?"center":"right"):z.charCodeAt(0)===58?d.push("left"):d.push("")}if(c=Gf(t,e).trim(),c.indexOf("|")===-1||t.sCount[e]-t.blkIndent>=4)return!1;u=mj(c),u.length&&u[0]===""&&u.shift(),u.length&&u[u.length-1]===""&&u.pop();const h=u.length;if(h===0||h!==d.length)return!1;if(n)return!0;const f=t.parentType;t.parentType="table";const m=t.md.block.ruler.getRules("blockquote"),p=t.push("table_open","table",1),x=[e,0];p.map=x;const g=t.push("thead_open","thead",1);g.map=[e,e+1];const y=t.push("tr_open","tr",1);y.map=[e,e+1];for(let S=0;S<u.length;S++){const z=t.push("th_open","th",1);d[S]&&(z.attrs=[["style","text-align:"+d[S]]]);const N=t.push("inline","",0);N.content=u[S].trim(),N.children=[],t.push("th_close","th",-1)}t.push("tr_close","tr",-1),t.push("thead_close","thead",-1);let b,w=0;for(i=e+2;i<s&&!(t.sCount[i]<t.blkIndent);i++){let S=!1;for(let N=0,k=m.length;N<k;N++)if(m[N](t,i,s,!0)){S=!0;break}if(S||(c=Gf(t,i).trim(),!c)||t.sCount[i]-t.blkIndent>=4||(u=mj(c),u.length&&u[0]===""&&u.shift(),u.length&&u[u.length-1]===""&&u.pop(),w+=h-u.length,w>bq))break;if(i===e+2){const N=t.push("tbody_open","tbody",1);N.map=b=[e+2,0]}const z=t.push("tr_open","tr",1);z.map=[i,i+1];for(let N=0;N<h;N++){const k=t.push("td_open","td",1);d[N]&&(k.attrs=[["style","text-align:"+d[N]]]);const C=t.push("inline","",0);C.content=u[N]?u[N].trim():"",C.children=[],t.push("td_close","td",-1)}t.push("tr_close","tr",-1)}return b&&(t.push("tbody_close","tbody",-1),b[1]=i),t.push("table_close","table",-1),x[1]=i,t.parentType=f,t.line=i,!0}function wq(t,e,s){if(t.sCount[e]-t.blkIndent<4)return!1;let n=e+1,i=n;for(;n<s;){if(t.isEmpty(n)){n++;continue}if(t.sCount[n]-t.blkIndent>=4){n++,i=n;continue}break}t.line=i;const a=t.push("code_block","code",0);return a.content=t.getLines(e,i,4+t.blkIndent,!1)+`
`,a.map=[e,t.line],!0}function vq(t,e,s,n){let i=t.bMarks[e]+t.tShift[e],a=t.eMarks[e];if(t.sCount[e]-t.blkIndent>=4||i+3>a)return!1;const o=t.src.charCodeAt(i);if(o!==126&&o!==96)return!1;let l=i;i=t.skipChars(i,o);let c=i-l;if(c<3)return!1;const u=t.src.slice(l,i),d=t.src.slice(i,a);if(o===96&&d.indexOf(String.fromCharCode(o))>=0)return!1;if(n)return!0;let h=e,f=!1;for(;h++,!(h>=s||(i=l=t.bMarks[h]+t.tShift[h],a=t.eMarks[h],i<a&&t.sCount[h]<t.blkIndent));)if(t.src.charCodeAt(i)===o&&!(t.sCount[h]-t.blkIndent>=4)&&(i=t.skipChars(i,o),!(i-l<c)&&(i=t.skipSpaces(i),!(i<a)))){f=!0;break}c=t.sCount[e],t.line=h+(f?1:0);const m=t.push("fence","code",0);return m.info=d,m.content=t.getLines(e+1,h,c,!0),m.markup=u,m.map=[e,t.line],!0}function kq(t,e,s,n){let i=t.bMarks[e]+t.tShift[e],a=t.eMarks[e];const o=t.lineMax;if(t.sCount[e]-t.blkIndent>=4||t.src.charCodeAt(i)!==62)return!1;if(n)return!0;const l=[],c=[],u=[],d=[],h=t.md.block.ruler.getRules("blockquote"),f=t.parentType;t.parentType="blockquote";let m=!1,p;for(p=e;p<s;p++){const w=t.sCount[p]<t.blkIndent;if(i=t.bMarks[p]+t.tShift[p],a=t.eMarks[p],i>=a)break;if(t.src.charCodeAt(i++)===62&&!w){let z=t.sCount[p]+1,N,k;t.src.charCodeAt(i)===32?(i++,z++,k=!1,N=!0):t.src.charCodeAt(i)===9?(N=!0,(t.bsCount[p]+z)%4===3?(i++,z++,k=!1):k=!0):N=!1;let C=z;for(l.push(t.bMarks[p]),t.bMarks[p]=i;i<a;){const T=t.src.charCodeAt(i);if(Le(T))T===9?C+=4-(C+t.bsCount[p]+(k?1:0))%4:C++;else break;i++}m=i>=a,c.push(t.bsCount[p]),t.bsCount[p]=t.sCount[p]+1+(N?1:0),u.push(t.sCount[p]),t.sCount[p]=C-z,d.push(t.tShift[p]),t.tShift[p]=i-t.bMarks[p];continue}if(m)break;let S=!1;for(let z=0,N=h.length;z<N;z++)if(h[z](t,p,s,!0)){S=!0;break}if(S){t.lineMax=p,t.blkIndent!==0&&(l.push(t.bMarks[p]),c.push(t.bsCount[p]),d.push(t.tShift[p]),u.push(t.sCount[p]),t.sCount[p]-=t.blkIndent);break}l.push(t.bMarks[p]),c.push(t.bsCount[p]),d.push(t.tShift[p]),u.push(t.sCount[p]),t.sCount[p]=-1}const x=t.blkIndent;t.blkIndent=0;const g=t.push("blockquote_open","blockquote",1);g.markup=">";const y=[e,0];g.map=y,t.md.block.tokenize(t,e,p);const b=t.push("blockquote_close","blockquote",-1);b.markup=">",t.lineMax=o,t.parentType=f,y[1]=t.line;for(let w=0;w<d.length;w++)t.bMarks[w+e]=l[w],t.tShift[w+e]=d[w],t.sCount[w+e]=u[w],t.bsCount[w+e]=c[w];return t.blkIndent=x,!0}function Nq(t,e,s,n){const i=t.eMarks[e];if(t.sCount[e]-t.blkIndent>=4)return!1;let a=t.bMarks[e]+t.tShift[e];const o=t.src.charCodeAt(a++);if(o!==42&&o!==45&&o!==95)return!1;let l=1;for(;a<i;){const u=t.src.charCodeAt(a++);if(u!==o&&!Le(u))return!1;u===o&&l++}if(l<3)return!1;if(n)return!0;t.line=e+1;const c=t.push("hr","hr",0);return c.map=[e,t.line],c.markup=Array(l+1).join(String.fromCharCode(o)),!0}function pj(t,e){const s=t.eMarks[e];let n=t.bMarks[e]+t.tShift[e];const i=t.src.charCodeAt(n++);if(i!==42&&i!==45&&i!==43)return-1;if(n<s){const a=t.src.charCodeAt(n);if(!Le(a))return-1}return n}function xj(t,e){const s=t.bMarks[e]+t.tShift[e],n=t.eMarks[e];let i=s;if(i+1>=n)return-1;let a=t.src.charCodeAt(i++);if(a<48||a>57)return-1;for(;;){if(i>=n)return-1;if(a=t.src.charCodeAt(i++),a>=48&&a<=57){if(i-s>=10)return-1;continue}if(a===41||a===46)break;return-1}return i<n&&(a=t.src.charCodeAt(i),!Le(a))?-1:i}function Sq(t,e){const s=t.level+2;for(let n=e+2,i=t.tokens.length-2;n<i;n++)t.tokens[n].level===s&&t.tokens[n].type==="paragraph_open"&&(t.tokens[n+2].hidden=!0,t.tokens[n].hidden=!0,n+=2)}function Cq(t,e,s,n){let i,a,o,l,c=e,u=!0;if(t.sCount[c]-t.blkIndent>=4||t.listIndent>=0&&t.sCount[c]-t.listIndent>=4&&t.sCount[c]<t.blkIndent)return!1;let d=!1;n&&t.parentType==="paragraph"&&t.sCount[c]>=t.blkIndent&&(d=!0);let h,f,m;if((m=xj(t,c))>=0){if(h=!0,o=t.bMarks[c]+t.tShift[c],f=Number(t.src.slice(o,m-1)),d&&f!==1)return!1}else if((m=pj(t,c))>=0)h=!1;else return!1;if(d&&t.skipSpaces(m)>=t.eMarks[c])return!1;if(n)return!0;const p=t.src.charCodeAt(m-1),x=t.tokens.length;h?(l=t.push("ordered_list_open","ol",1),f!==1&&(l.attrs=[["start",f]])):l=t.push("bullet_list_open","ul",1);const g=[c,0];l.map=g,l.markup=String.fromCharCode(p);let y=!1;const b=t.md.block.ruler.getRules("list"),w=t.parentType;for(t.parentType="list";c<s;){a=m,i=t.eMarks[c];const S=t.sCount[c]+m-(t.bMarks[c]+t.tShift[c]);let z=S;for(;a<i;){const O=t.src.charCodeAt(a);if(O===9)z+=4-(z+t.bsCount[c])%4;else if(O===32)z++;else break;a++}const N=a;let k;N>=i?k=1:k=z-S,k>4&&(k=1);const C=S+k;l=t.push("list_item_open","li",1),l.markup=String.fromCharCode(p);const T=[c,0];l.map=T,h&&(l.info=t.src.slice(o,m-1));const v=t.tight,_=t.tShift[c],A=t.sCount[c],E=t.listIndent;if(t.listIndent=t.blkIndent,t.blkIndent=C,t.tight=!0,t.tShift[c]=N-t.bMarks[c],t.sCount[c]=z,N>=i&&t.isEmpty(c+1)?t.line=Math.min(t.line+2,s):t.md.block.tokenize(t,c,s,!0),(!t.tight||y)&&(u=!1),y=t.line-c>1&&t.isEmpty(t.line-1),t.blkIndent=t.listIndent,t.listIndent=E,t.tShift[c]=_,t.sCount[c]=A,t.tight=v,l=t.push("list_item_close","li",-1),l.markup=String.fromCharCode(p),c=t.line,T[1]=c,c>=s||t.sCount[c]<t.blkIndent||t.sCount[c]-t.blkIndent>=4)break;let M=!1;for(let O=0,R=b.length;O<R;O++)if(b[O](t,c,s,!0)){M=!0;break}if(M)break;if(h){if(m=xj(t,c),m<0)break;o=t.bMarks[c]+t.tShift[c]}else if(m=pj(t,c),m<0)break;if(p!==t.src.charCodeAt(m-1))break}return h?l=t.push("ordered_list_close","ol",-1):l=t.push("bullet_list_close","ul",-1),l.markup=String.fromCharCode(p),g[1]=c,t.line=c,t.parentType=w,u&&Sq(t,x),!0}function zq(t,e,s,n){let i=t.bMarks[e]+t.tShift[e],a=t.eMarks[e],o=e+1;if(t.sCount[e]-t.blkIndent>=4||t.src.charCodeAt(i)!==91)return!1;function l(b){const w=t.lineMax;if(b>=w||t.isEmpty(b))return null;let S=!1;if(t.sCount[b]-t.blkIndent>3&&(S=!0),t.sCount[b]<0&&(S=!0),!S){const k=t.md.block.ruler.getRules("reference"),C=t.parentType;t.parentType="reference";let T=!1;for(let v=0,_=k.length;v<_;v++)if(k[v](t,b,w,!0)){T=!0;break}if(t.parentType=C,T)return null}const z=t.bMarks[b]+t.tShift[b],N=t.eMarks[b];return t.src.slice(z,N+1)}let c=t.src.slice(i,a+1);a=c.length;let u=-1;for(i=1;i<a;i++){const b=c.charCodeAt(i);if(b===91)return!1;if(b===93){u=i;break}else if(b===10){const w=l(o);w!==null&&(c+=w,a=c.length,o++)}else if(b===92&&(i++,i<a&&c.charCodeAt(i)===10)){const w=l(o);w!==null&&(c+=w,a=c.length,o++)}}if(u<0||c.charCodeAt(u+1)!==58)return!1;for(i=u+2;i<a;i++){const b=c.charCodeAt(i);if(b===10){const w=l(o);w!==null&&(c+=w,a=c.length,o++)}else if(!Le(b))break}const d=t.md.helpers.parseLinkDestination(c,i,a);if(!d.ok)return!1;const h=t.md.normalizeLink(d.str);if(!t.md.validateLink(h))return!1;i=d.pos;const f=i,m=o,p=i;for(;i<a;i++){const b=c.charCodeAt(i);if(b===10){const w=l(o);w!==null&&(c+=w,a=c.length,o++)}else if(!Le(b))break}let x=t.md.helpers.parseLinkTitle(c,i,a);for(;x.can_continue;){const b=l(o);if(b===null)break;c+=b,i=a,a=c.length,o++,x=t.md.helpers.parseLinkTitle(c,i,a,x)}let g;for(i<a&&p!==i&&x.ok?(g=x.str,i=x.pos):(g="",i=f,o=m);i<a;){const b=c.charCodeAt(i);if(!Le(b))break;i++}if(i<a&&c.charCodeAt(i)!==10&&g)for(g="",i=f,o=m;i<a;){const b=c.charCodeAt(i);if(!Le(b))break;i++}if(i<a&&c.charCodeAt(i)!==10)return!1;const y=Lh(c.slice(1,u));return y?(n||(typeof t.env.references>"u"&&(t.env.references={}),typeof t.env.references[y]>"u"&&(t.env.references[y]={title:g,href:h}),t.line=o),!0):!1}const _q=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],Aq="[a-zA-Z_:][a-zA-Z0-9:._-]*",Tq="[^\"'=<>`\\x00-\\x20]+",Eq="'[^']*'",Dq='"[^"]*"',Mq="(?:"+Tq+"|"+Eq+"|"+Dq+")",Pq="(?:\\s+"+Aq+"(?:\\s*=\\s*"+Mq+")?)",XC="<[A-Za-z][A-Za-z0-9\\-]*"+Pq+"*\\s*\\/?>",ez="<\\/[A-Za-z][A-Za-z0-9\\-]*\\s*>",Iq="<!---?>|<!--(?:[^-]|-[^-]|--[^>])*-->",Oq="<[?][\\s\\S]*?[?]>",Rq="<![A-Za-z][^>]*>",Lq="<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",Fq=new RegExp("^(?:"+XC+"|"+ez+"|"+Iq+"|"+Oq+"|"+Rq+"|"+Lq+")"),$q=new RegExp("^(?:"+XC+"|"+ez+")"),ha=[[/^<(script|pre|style|textarea)(?=(\s|>|$))/i,/<\/(script|pre|style|textarea)>/i,!0],[/^<!--/,/-->/,!0],[/^<\?/,/\?>/,!0],[/^<![A-Z]/,/>/,!0],[/^<!\[CDATA\[/,/\]\]>/,!0],[new RegExp("^</?("+_q.join("|")+")(?=(\\s|/?>|$))","i"),/^$/,!0],[new RegExp($q.source+"\\s*$"),/^$/,!1]];function Bq(t,e,s,n){let i=t.bMarks[e]+t.tShift[e],a=t.eMarks[e];if(t.sCount[e]-t.blkIndent>=4||!t.md.options.html||t.src.charCodeAt(i)!==60)return!1;let o=t.src.slice(i,a),l=0;for(;l<ha.length&&!ha[l][0].test(o);l++);if(l===ha.length)return!1;if(n)return ha[l][2];let c=e+1;if(!ha[l][1].test(o)){for(;c<s&&!(t.sCount[c]<t.blkIndent);c++)if(i=t.bMarks[c]+t.tShift[c],a=t.eMarks[c],o=t.src.slice(i,a),ha[l][1].test(o)){o.length!==0&&c++;break}}t.line=c;const u=t.push("html_block","",0);return u.map=[e,c],u.content=t.getLines(e,c,t.blkIndent,!0),!0}function qq(t,e,s,n){let i=t.bMarks[e]+t.tShift[e],a=t.eMarks[e];if(t.sCount[e]-t.blkIndent>=4)return!1;let o=t.src.charCodeAt(i);if(o!==35||i>=a)return!1;let l=1;for(o=t.src.charCodeAt(++i);o===35&&i<a&&l<=6;)l++,o=t.src.charCodeAt(++i);if(l>6||i<a&&!Le(o))return!1;if(n)return!0;a=t.skipSpacesBack(a,i);const c=t.skipCharsBack(a,35,i);c>i&&Le(t.src.charCodeAt(c-1))&&(a=c),t.line=e+1;const u=t.push("heading_open","h"+String(l),1);u.markup="########".slice(0,l),u.map=[e,t.line];const d=t.push("inline","",0);d.content=t.src.slice(i,a).trim(),d.map=[e,t.line],d.children=[];const h=t.push("heading_close","h"+String(l),-1);return h.markup="########".slice(0,l),!0}function Vq(t,e,s){const n=t.md.block.ruler.getRules("paragraph");if(t.sCount[e]-t.blkIndent>=4)return!1;const i=t.parentType;t.parentType="paragraph";let a=0,o,l=e+1;for(;l<s&&!t.isEmpty(l);l++){if(t.sCount[l]-t.blkIndent>3)continue;if(t.sCount[l]>=t.blkIndent){let m=t.bMarks[l]+t.tShift[l];const p=t.eMarks[l];if(m<p&&(o=t.src.charCodeAt(m),(o===45||o===61)&&(m=t.skipChars(m,o),m=t.skipSpaces(m),m>=p))){a=o===61?1:2;break}}if(t.sCount[l]<0)continue;let f=!1;for(let m=0,p=n.length;m<p;m++)if(n[m](t,l,s,!0)){f=!0;break}if(f)break}if(!a)return!1;const c=t.getLines(e,l,t.blkIndent,!1).trim();t.line=l+1;const u=t.push("heading_open","h"+String(a),1);u.markup=String.fromCharCode(o),u.map=[e,t.line];const d=t.push("inline","",0);d.content=c,d.map=[e,t.line-1],d.children=[];const h=t.push("heading_close","h"+String(a),-1);return h.markup=String.fromCharCode(o),t.parentType=i,!0}function Uq(t,e,s){const n=t.md.block.ruler.getRules("paragraph"),i=t.parentType;let a=e+1;for(t.parentType="paragraph";a<s&&!t.isEmpty(a);a++){if(t.sCount[a]-t.blkIndent>3||t.sCount[a]<0)continue;let u=!1;for(let d=0,h=n.length;d<h;d++)if(n[d](t,a,s,!0)){u=!0;break}if(u)break}const o=t.getLines(e,a,t.blkIndent,!1).trim();t.line=a;const l=t.push("paragraph_open","p",1);l.map=[e,t.line];const c=t.push("inline","",0);return c.content=o,c.map=[e,t.line],c.children=[],t.push("paragraph_close","p",-1),t.parentType=i,!0}const Qc=[["table",jq,["paragraph","reference"]],["code",wq],["fence",vq,["paragraph","reference","blockquote","list"]],["blockquote",kq,["paragraph","reference","blockquote","list"]],["hr",Nq,["paragraph","reference","blockquote","list"]],["list",Cq,["paragraph","reference","blockquote"]],["reference",zq],["html_block",Bq,["paragraph","reference","blockquote"]],["heading",qq,["paragraph","reference","blockquote"]],["lheading",Vq],["paragraph",Uq]];function Fh(){this.ruler=new vs;for(let t=0;t<Qc.length;t++)this.ruler.push(Qc[t][0],Qc[t][1],{alt:(Qc[t][2]||[]).slice()})}Fh.prototype.tokenize=function(t,e,s){const n=this.ruler.getRules(""),i=n.length,a=t.md.options.maxNesting;let o=e,l=!1;for(;o<s&&(t.line=o=t.skipEmptyLines(o),!(o>=s||t.sCount[o]<t.blkIndent));){if(t.level>=a){t.line=s;break}const c=t.line;let u=!1;for(let d=0;d<i;d++)if(u=n[d](t,o,s,!1),u){if(c>=t.line)throw new Error("block rule didn't increment state.line");break}if(!u)throw new Error("none of the block rules matched");t.tight=!l,t.isEmpty(t.line-1)&&(l=!0),o=t.line,o<s&&t.isEmpty(o)&&(l=!0,o++,t.line=o)}};Fh.prototype.parse=function(t,e,s,n){if(!t)return;const i=new this.State(t,e,s,n);this.tokenize(i,i.line,i.lineMax)};Fh.prototype.State=Wn;function gc(t,e,s,n){this.src=t,this.env=s,this.md=e,this.tokens=n,this.tokens_meta=Array(n.length),this.pos=0,this.posMax=this.src.length,this.level=0,this.pending="",this.pendingLevel=0,this.cache={},this.delimiters=[],this._prev_delimiters=[],this.backticks={},this.backticksScanned=!1,this.linkLevel=0}gc.prototype.pushPending=function(){const t=new jn("text","",0);return t.content=this.pending,t.level=this.pendingLevel,this.tokens.push(t),this.pending="",t};gc.prototype.push=function(t,e,s){this.pending&&this.pushPending();const n=new jn(t,e,s);let i=null;return s<0&&(this.level--,this.delimiters=this._prev_delimiters.pop()),n.level=this.level,s>0&&(this.level++,this._prev_delimiters.push(this.delimiters),this.delimiters=[],i={delimiters:this.delimiters}),this.pendingLevel=this.level,this.tokens.push(n),this.tokens_meta.push(i),n};gc.prototype.scanDelims=function(t,e){const s=this.posMax,n=this.src.charCodeAt(t),i=t>0?this.src.charCodeAt(t-1):32;let a=t;for(;a<s&&this.src.charCodeAt(a)===n;)a++;const o=a-t,l=a<s?this.src.charCodeAt(a):32,c=Wl(i)||Ul(String.fromCharCode(i)),u=Wl(l)||Ul(String.fromCharCode(l)),d=Vl(i),h=Vl(l),f=!h&&(!u||d||c),m=!d&&(!c||h||u);return{can_open:f&&(e||!m||c),can_close:m&&(e||!f||u),length:o}};gc.prototype.Token=jn;function Wq(t){switch(t){case 10:case 33:case 35:case 36:case 37:case 38:case 42:case 43:case 45:case 58:case 60:case 61:case 62:case 64:case 91:case 92:case 93:case 94:case 95:case 96:case 123:case 125:case 126:return!0;default:return!1}}function Kq(t,e){let s=t.pos;for(;s<t.posMax&&!Wq(t.src.charCodeAt(s));)s++;return s===t.pos?!1:(e||(t.pending+=t.src.slice(t.pos,s)),t.pos=s,!0)}const Hq=/(?:^|[^a-z0-9.+-])([a-z][a-z0-9.+-]*)$/i;function Gq(t,e){if(!t.md.options.linkify||t.linkLevel>0)return!1;const s=t.pos,n=t.posMax;if(s+3>n||t.src.charCodeAt(s)!==58||t.src.charCodeAt(s+1)!==47||t.src.charCodeAt(s+2)!==47)return!1;const i=t.pending.match(Hq);if(!i)return!1;const a=i[1],o=t.md.linkify.matchAtStart(t.src.slice(s-a.length));if(!o)return!1;let l=o.url;if(l.length<=a.length)return!1;l=l.replace(/\*+$/,"");const c=t.md.normalizeLink(l);if(!t.md.validateLink(c))return!1;if(!e){t.pending=t.pending.slice(0,-a.length);const u=t.push("link_open","a",1);u.attrs=[["href",c]],u.markup="linkify",u.info="auto";const d=t.push("text","",0);d.content=t.md.normalizeLinkText(l);const h=t.push("link_close","a",-1);h.markup="linkify",h.info="auto"}return t.pos+=l.length-a.length,!0}function Jq(t,e){let s=t.pos;if(t.src.charCodeAt(s)!==10)return!1;const n=t.pending.length-1,i=t.posMax;if(!e)if(n>=0&&t.pending.charCodeAt(n)===32)if(n>=1&&t.pending.charCodeAt(n-1)===32){let a=n-1;for(;a>=1&&t.pending.charCodeAt(a-1)===32;)a--;t.pending=t.pending.slice(0,a),t.push("hardbreak","br",0)}else t.pending=t.pending.slice(0,-1),t.push("softbreak","br",0);else t.push("softbreak","br",0);for(s++;s<i&&Le(t.src.charCodeAt(s));)s++;return t.pos=s,!0}const Tg=[];for(let t=0;t<256;t++)Tg.push(0);"\\!\"#$%&'()*+,./:;<=>?@[]^_`{|}~-".split("").forEach(function(t){Tg[t.charCodeAt(0)]=1});function Zq(t,e){let s=t.pos;const n=t.posMax;if(t.src.charCodeAt(s)!==92||(s++,s>=n))return!1;let i=t.src.charCodeAt(s);if(i===10){for(e||t.push("hardbreak","br",0),s++;s<n&&(i=t.src.charCodeAt(s),!!Le(i));)s++;return t.pos=s,!0}let a=t.src[s];if(i>=55296&&i<=56319&&s+1<n){const l=t.src.charCodeAt(s+1);l>=56320&&l<=57343&&(a+=t.src[s+1],s++)}const o="\\"+a;if(!e){const l=t.push("text_special","",0);i<256&&Tg[i]!==0?l.content=a:l.content=o,l.markup=o,l.info="escape"}return t.pos=s+1,!0}function Qq(t,e){let s=t.pos;if(t.src.charCodeAt(s)!==96)return!1;const i=s;s++;const a=t.posMax;for(;s<a&&t.src.charCodeAt(s)===96;)s++;const o=t.src.slice(i,s),l=o.length;if(t.backticksScanned&&(t.backticks[l]||0)<=i)return e||(t.pending+=o),t.pos+=l,!0;let c=s,u;for(;(u=t.src.indexOf("`",c))!==-1;){for(c=u+1;c<a&&t.src.charCodeAt(c)===96;)c++;const d=c-u;if(d===l){if(!e){const h=t.push("code_inline","code",0);h.markup=o,h.content=t.src.slice(s,u).replace(/\n/g," ").replace(/^ (.+) $/,"$1")}return t.pos=c,!0}t.backticks[d]=u}return t.backticksScanned=!0,e||(t.pending+=o),t.pos+=l,!0}function Yq(t,e){const s=t.pos,n=t.src.charCodeAt(s);if(e||n!==126)return!1;const i=t.scanDelims(t.pos,!0);let a=i.length;const o=String.fromCharCode(n);if(a<2)return!1;let l;a%2&&(l=t.push("text","",0),l.content=o,a--);for(let c=0;c<a;c+=2)l=t.push("text","",0),l.content=o+o,t.delimiters.push({marker:n,length:0,token:t.tokens.length-1,end:-1,open:i.can_open,close:i.can_close});return t.pos+=i.length,!0}function gj(t,e){let s;const n=[],i=e.length;for(let a=0;a<i;a++){const o=e[a];if(o.marker!==126||o.end===-1)continue;const l=e[o.end];s=t.tokens[o.token],s.type="s_open",s.tag="s",s.nesting=1,s.markup="~~",s.content="",s=t.tokens[l.token],s.type="s_close",s.tag="s",s.nesting=-1,s.markup="~~",s.content="",t.tokens[l.token-1].type==="text"&&t.tokens[l.token-1].content==="~"&&n.push(l.token-1)}for(;n.length;){const a=n.pop();let o=a+1;for(;o<t.tokens.length&&t.tokens[o].type==="s_close";)o++;o--,a!==o&&(s=t.tokens[o],t.tokens[o]=t.tokens[a],t.tokens[a]=s)}}function Xq(t){const e=t.tokens_meta,s=t.tokens_meta.length;gj(t,t.delimiters);for(let n=0;n<s;n++)e[n]&&e[n].delimiters&&gj(t,e[n].delimiters)}const tz={tokenize:Yq,postProcess:Xq};function eV(t,e){const s=t.pos,n=t.src.charCodeAt(s);if(e||n!==95&&n!==42)return!1;const i=t.scanDelims(t.pos,n===42);for(let a=0;a<i.length;a++){const o=t.push("text","",0);o.content=String.fromCharCode(n),t.delimiters.push({marker:n,length:i.length,token:t.tokens.length-1,end:-1,open:i.can_open,close:i.can_close})}return t.pos+=i.length,!0}function yj(t,e){const s=e.length;for(let n=s-1;n>=0;n--){const i=e[n];if(i.marker!==95&&i.marker!==42||i.end===-1)continue;const a=e[i.end],o=n>0&&e[n-1].end===i.end+1&&e[n-1].marker===i.marker&&e[n-1].token===i.token-1&&e[i.end+1].token===a.token+1,l=String.fromCharCode(i.marker),c=t.tokens[i.token];c.type=o?"strong_open":"em_open",c.tag=o?"strong":"em",c.nesting=1,c.markup=o?l+l:l,c.content="";const u=t.tokens[a.token];u.type=o?"strong_close":"em_close",u.tag=o?"strong":"em",u.nesting=-1,u.markup=o?l+l:l,u.content="",o&&(t.tokens[e[n-1].token].content="",t.tokens[e[i.end+1].token].content="",n--)}}function tV(t){const e=t.tokens_meta,s=t.tokens_meta.length;yj(t,t.delimiters);for(let n=0;n<s;n++)e[n]&&e[n].delimiters&&yj(t,e[n].delimiters)}const sz={tokenize:eV,postProcess:tV};function sV(t,e){let s,n,i,a,o="",l="",c=t.pos,u=!0;if(t.src.charCodeAt(t.pos)!==91)return!1;const d=t.pos,h=t.posMax,f=t.pos+1,m=t.md.helpers.parseLinkLabel(t,t.pos,!0);if(m<0)return!1;let p=m+1;if(p<h&&t.src.charCodeAt(p)===40){for(u=!1,p++;p<h&&(s=t.src.charCodeAt(p),!(!Le(s)&&s!==10));p++);if(p>=h)return!1;if(c=p,i=t.md.helpers.parseLinkDestination(t.src,p,t.posMax),i.ok){for(o=t.md.normalizeLink(i.str),t.md.validateLink(o)?p=i.pos:o="",c=p;p<h&&(s=t.src.charCodeAt(p),!(!Le(s)&&s!==10));p++);if(i=t.md.helpers.parseLinkTitle(t.src,p,t.posMax),p<h&&c!==p&&i.ok)for(l=i.str,p=i.pos;p<h&&(s=t.src.charCodeAt(p),!(!Le(s)&&s!==10));p++);}(p>=h||t.src.charCodeAt(p)!==41)&&(u=!0),p++}if(u){if(typeof t.env.references>"u")return!1;if(p<h&&t.src.charCodeAt(p)===91?(c=p+1,p=t.md.helpers.parseLinkLabel(t,p),p>=0?n=t.src.slice(c,p++):p=m+1):p=m+1,n||(n=t.src.slice(f,m)),a=t.env.references[Lh(n)],!a)return t.pos=d,!1;o=a.href,l=a.title}if(!e){t.pos=f,t.posMax=m;const x=t.push("link_open","a",1),g=[["href",o]];x.attrs=g,l&&g.push(["title",l]),t.linkLevel++,t.md.inline.tokenize(t),t.linkLevel--,t.push("link_close","a",-1)}return t.pos=p,t.posMax=h,!0}function nV(t,e){let s,n,i,a,o,l,c,u,d="";const h=t.pos,f=t.posMax;if(t.src.charCodeAt(t.pos)!==33||t.src.charCodeAt(t.pos+1)!==91)return!1;const m=t.pos+2,p=t.md.helpers.parseLinkLabel(t,t.pos+1,!1);if(p<0)return!1;if(a=p+1,a<f&&t.src.charCodeAt(a)===40){for(a++;a<f&&(s=t.src.charCodeAt(a),!(!Le(s)&&s!==10));a++);if(a>=f)return!1;for(u=a,l=t.md.helpers.parseLinkDestination(t.src,a,t.posMax),l.ok&&(d=t.md.normalizeLink(l.str),t.md.validateLink(d)?a=l.pos:d=""),u=a;a<f&&(s=t.src.charCodeAt(a),!(!Le(s)&&s!==10));a++);if(l=t.md.helpers.parseLinkTitle(t.src,a,t.posMax),a<f&&u!==a&&l.ok)for(c=l.str,a=l.pos;a<f&&(s=t.src.charCodeAt(a),!(!Le(s)&&s!==10));a++);else c="";if(a>=f||t.src.charCodeAt(a)!==41)return t.pos=h,!1;a++}else{if(typeof t.env.references>"u")return!1;if(a<f&&t.src.charCodeAt(a)===91?(u=a+1,a=t.md.helpers.parseLinkLabel(t,a),a>=0?i=t.src.slice(u,a++):a=p+1):a=p+1,i||(i=t.src.slice(m,p)),o=t.env.references[Lh(i)],!o)return t.pos=h,!1;d=o.href,c=o.title}if(!e){n=t.src.slice(m,p);const x=[];t.md.inline.parse(n,t.md,t.env,x);const g=t.push("image","img",0),y=[["src",d],["alt",""]];g.attrs=y,g.children=x,g.content=n,c&&y.push(["title",c])}return t.pos=a,t.posMax=f,!0}const rV=/^([a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)$/,iV=/^([a-zA-Z][a-zA-Z0-9+.-]{1,31}):([^<>\x00-\x20]*)$/;function aV(t,e){let s=t.pos;if(t.src.charCodeAt(s)!==60)return!1;const n=t.pos,i=t.posMax;for(;;){if(++s>=i)return!1;const o=t.src.charCodeAt(s);if(o===60)return!1;if(o===62)break}const a=t.src.slice(n+1,s);if(iV.test(a)){const o=t.md.normalizeLink(a);if(!t.md.validateLink(o))return!1;if(!e){const l=t.push("link_open","a",1);l.attrs=[["href",o]],l.markup="autolink",l.info="auto";const c=t.push("text","",0);c.content=t.md.normalizeLinkText(a);const u=t.push("link_close","a",-1);u.markup="autolink",u.info="auto"}return t.pos+=a.length+2,!0}if(rV.test(a)){const o=t.md.normalizeLink("mailto:"+a);if(!t.md.validateLink(o))return!1;if(!e){const l=t.push("link_open","a",1);l.attrs=[["href",o]],l.markup="autolink",l.info="auto";const c=t.push("text","",0);c.content=t.md.normalizeLinkText(a);const u=t.push("link_close","a",-1);u.markup="autolink",u.info="auto"}return t.pos+=a.length+2,!0}return!1}function oV(t){return/^<a[>\s]/i.test(t)}function lV(t){return/^<\/a\s*>/i.test(t)}function cV(t){const e=t|32;return e>=97&&e<=122}function uV(t,e){if(!t.md.options.html)return!1;const s=t.posMax,n=t.pos;if(t.src.charCodeAt(n)!==60||n+2>=s)return!1;const i=t.src.charCodeAt(n+1);if(i!==33&&i!==63&&i!==47&&!cV(i))return!1;const a=t.src.slice(n).match(Fq);if(!a)return!1;if(!e){const o=t.push("html_inline","",0);o.content=a[0],oV(o.content)&&t.linkLevel++,lV(o.content)&&t.linkLevel--}return t.pos+=a[0].length,!0}const dV=/^&#((?:x[a-f0-9]{1,6}|[0-9]{1,7}));/i,hV=/^&([a-z][a-z0-9]{1,31});/i;function fV(t,e){const s=t.pos,n=t.posMax;if(t.src.charCodeAt(s)!==38||s+1>=n)return!1;if(t.src.charCodeAt(s+1)===35){const a=t.src.slice(s).match(dV);if(a){if(!e){const o=a[1][0].toLowerCase()==="x"?parseInt(a[1].slice(1),16):parseInt(a[1],10),l=t.push("text_special","",0);l.content=_g(o)?zd(o):zd(65533),l.markup=a[0],l.info="entity"}return t.pos+=a[0].length,!0}}else{const a=t.src.slice(s).match(hV);if(a){const o=GC(a[0]);if(o!==a[0]){if(!e){const l=t.push("text_special","",0);l.content=o,l.markup=a[0],l.info="entity"}return t.pos+=a[0].length,!0}}}return!1}function bj(t){const e={},s=t.length;if(!s)return;let n=0,i=-2;const a=[];for(let o=0;o<s;o++){const l=t[o];if(a.push(0),(t[n].marker!==l.marker||i!==l.token-1)&&(n=o),i=l.token,l.length=l.length||0,!l.close)continue;e.hasOwnProperty(l.marker)||(e[l.marker]=[-1,-1,-1,-1,-1,-1]);const c=e[l.marker][(l.open?3:0)+l.length%3];let u=n-a[n]-1,d=u;for(;u>c;u-=a[u]+1){const h=t[u];if(h.marker===l.marker&&h.open&&h.end<0){let f=!1;if((h.close||l.open)&&(h.length+l.length)%3===0&&(h.length%3!==0||l.length%3!==0)&&(f=!0),!f){const m=u>0&&!t[u-1].open?a[u-1]+1:0;a[o]=o-u+m,a[u]=m,l.open=!1,h.end=o,h.close=!1,d=-1,i=-2;break}}}d!==-1&&(e[l.marker][(l.open?3:0)+(l.length||0)%3]=d)}}function mV(t){const e=t.tokens_meta,s=t.tokens_meta.length;bj(t.delimiters);for(let n=0;n<s;n++)e[n]&&e[n].delimiters&&bj(e[n].delimiters)}function pV(t){let e,s,n=0;const i=t.tokens,a=t.tokens.length;for(e=s=0;e<a;e++)i[e].nesting<0&&n--,i[e].level=n,i[e].nesting>0&&n++,i[e].type==="text"&&e+1<a&&i[e+1].type==="text"?i[e+1].content=i[e].content+i[e+1].content:(e!==s&&(i[s]=i[e]),s++);e!==s&&(i.length=s)}const Jf=[["text",Kq],["linkify",Gq],["newline",Jq],["escape",Zq],["backticks",Qq],["strikethrough",tz.tokenize],["emphasis",sz.tokenize],["link",sV],["image",nV],["autolink",aV],["html_inline",uV],["entity",fV]],Zf=[["balance_pairs",mV],["strikethrough",tz.postProcess],["emphasis",sz.postProcess],["fragments_join",pV]];function yc(){this.ruler=new vs;for(let t=0;t<Jf.length;t++)this.ruler.push(Jf[t][0],Jf[t][1]);this.ruler2=new vs;for(let t=0;t<Zf.length;t++)this.ruler2.push(Zf[t][0],Zf[t][1])}yc.prototype.skipToken=function(t){const e=t.pos,s=this.ruler.getRules(""),n=s.length,i=t.md.options.maxNesting,a=t.cache;if(typeof a[e]<"u"){t.pos=a[e];return}let o=!1;if(t.level<i){for(let l=0;l<n;l++)if(t.level++,o=s[l](t,!0),t.level--,o){if(e>=t.pos)throw new Error("inline rule didn't increment state.pos");break}}else t.pos=t.posMax;o||t.pos++,a[e]=t.pos};yc.prototype.tokenize=function(t){const e=this.ruler.getRules(""),s=e.length,n=t.posMax,i=t.md.options.maxNesting;for(;t.pos<n;){const a=t.pos;let o=!1;if(t.level<i){for(let l=0;l<s;l++)if(o=e[l](t,!1),o){if(a>=t.pos)throw new Error("inline rule didn't increment state.pos");break}}if(o){if(t.pos>=n)break;continue}t.pending+=t.src[t.pos++]}t.pending&&t.pushPending()};yc.prototype.parse=function(t,e,s,n){const i=new this.State(t,e,s,n);this.tokenize(i);const a=this.ruler2.getRules(""),o=a.length;for(let l=0;l<o;l++)a[l](i)};yc.prototype.State=gc;function xV(t){const e={};t=t||{},e.src_Any=VC.source,e.src_Cc=UC.source,e.src_Z=KC.source,e.src_P=Cg.source,e.src_ZPCc=[e.src_Z,e.src_P,e.src_Cc].join("|"),e.src_ZCc=[e.src_Z,e.src_Cc].join("|");const s="[><｜]";return e.src_pseudo_letter="(?:(?!"+s+"|"+e.src_ZPCc+")"+e.src_Any+")",e.src_ip4="(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)",e.src_auth="(?:(?:(?!"+e.src_ZCc+"|[@/\\[\\]()]).)+@)?",e.src_port="(?::(?:6(?:[0-4]\\d{3}|5(?:[0-4]\\d{2}|5(?:[0-2]\\d|3[0-5])))|[1-5]?\\d{1,4}))?",e.src_host_terminator="(?=$|"+s+"|"+e.src_ZPCc+")(?!"+(t["---"]?"-(?!--)|":"-|")+"_|:\\d|\\.-|\\.(?!$|"+e.src_ZPCc+"))",e.src_path="(?:[/?#](?:(?!"+e.src_ZCc+"|"+s+`|[()[\\]{}.,"'?!\\-;]).|\\[(?:(?!`+e.src_ZCc+"|\\]).)*\\]|\\((?:(?!"+e.src_ZCc+"|[)]).)*\\)|\\{(?:(?!"+e.src_ZCc+'|[}]).)*\\}|\\"(?:(?!'+e.src_ZCc+`|["]).)+\\"|\\'(?:(?!`+e.src_ZCc+"|[']).)+\\'|\\'(?="+e.src_pseudo_letter+"|[-])|\\.{2,}[a-zA-Z0-9%/&]|\\.(?!"+e.src_ZCc+"|[.]|$)|"+(t["---"]?"\\-(?!--(?:[^-]|$))(?:-*)|":"\\-+|")+",(?!"+e.src_ZCc+"|$)|;(?!"+e.src_ZCc+"|$)|\\!+(?!"+e.src_ZCc+"|[!]|$)|\\?(?!"+e.src_ZCc+"|[?]|$))+|\\/)?",e.src_email_name='[\\-;:&=\\+\\$,\\.a-zA-Z0-9_][\\-;:&=\\+\\$,\\"\\.a-zA-Z0-9_]*',e.src_xn="xn--[a-z0-9\\-]{1,59}",e.src_domain_root="(?:"+e.src_xn+"|"+e.src_pseudo_letter+"{1,63})",e.src_domain="(?:"+e.src_xn+"|(?:"+e.src_pseudo_letter+")|(?:"+e.src_pseudo_letter+"(?:-|"+e.src_pseudo_letter+"){0,61}"+e.src_pseudo_letter+"))",e.src_host="(?:(?:(?:(?:"+e.src_domain+")\\.)*"+e.src_domain+"))",e.tpl_host_fuzzy="(?:"+e.src_ip4+"|(?:(?:(?:"+e.src_domain+")\\.)+(?:%TLDS%)))",e.tpl_host_no_ip_fuzzy="(?:(?:(?:"+e.src_domain+")\\.)+(?:%TLDS%))",e.src_host_strict=e.src_host+e.src_host_terminator,e.tpl_host_fuzzy_strict=e.tpl_host_fuzzy+e.src_host_terminator,e.src_host_port_strict=e.src_host+e.src_port+e.src_host_terminator,e.tpl_host_port_fuzzy_strict=e.tpl_host_fuzzy+e.src_port+e.src_host_terminator,e.tpl_host_port_no_ip_fuzzy_strict=e.tpl_host_no_ip_fuzzy+e.src_port+e.src_host_terminator,e.tpl_host_fuzzy_test="localhost|www\\.|\\.\\d{1,3}\\.|(?:\\.(?:%TLDS%)(?:"+e.src_ZPCc+"|>|$))",e.tpl_email_fuzzy="(^|"+s+'|"|\\(|'+e.src_ZCc+")("+e.src_email_name+"@"+e.tpl_host_fuzzy_strict+")",e.tpl_link_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|｜]|"+e.src_ZPCc+"))((?![$+<=>^`|｜])"+e.tpl_host_port_fuzzy_strict+e.src_path+")",e.tpl_link_no_ip_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|｜]|"+e.src_ZPCc+"))((?![$+<=>^`|｜])"+e.tpl_host_port_no_ip_fuzzy_strict+e.src_path+")",e}function wp(t){return Array.prototype.slice.call(arguments,1).forEach(function(s){s&&Object.keys(s).forEach(function(n){t[n]=s[n]})}),t}function $h(t){return Object.prototype.toString.call(t)}function gV(t){return $h(t)==="[object String]"}function yV(t){return $h(t)==="[object Object]"}function bV(t){return $h(t)==="[object RegExp]"}function jj(t){return $h(t)==="[object Function]"}function jV(t){return t.replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}const nz={fuzzyLink:!0,fuzzyEmail:!0,fuzzyIP:!1};function wV(t){return Object.keys(t||{}).reduce(function(e,s){return e||nz.hasOwnProperty(s)},!1)}const vV={"http:":{validate:function(t,e,s){const n=t.slice(e);return s.re.http||(s.re.http=new RegExp("^\\/\\/"+s.re.src_auth+s.re.src_host_port_strict+s.re.src_path,"i")),s.re.http.test(n)?n.match(s.re.http)[0].length:0}},"https:":"http:","ftp:":"http:","//":{validate:function(t,e,s){const n=t.slice(e);return s.re.no_http||(s.re.no_http=new RegExp("^"+s.re.src_auth+"(?:localhost|(?:(?:"+s.re.src_domain+")\\.)+"+s.re.src_domain_root+")"+s.re.src_port+s.re.src_host_terminator+s.re.src_path,"i")),s.re.no_http.test(n)?e>=3&&t[e-3]===":"||e>=3&&t[e-3]==="/"?0:n.match(s.re.no_http)[0].length:0}},"mailto:":{validate:function(t,e,s){const n=t.slice(e);return s.re.mailto||(s.re.mailto=new RegExp("^"+s.re.src_email_name+"@"+s.re.src_host_strict,"i")),s.re.mailto.test(n)?n.match(s.re.mailto)[0].length:0}}},kV="a[cdefgilmnoqrstuwxz]|b[abdefghijmnorstvwyz]|c[acdfghiklmnoruvwxyz]|d[ejkmoz]|e[cegrstu]|f[ijkmor]|g[abdefghilmnpqrstuwy]|h[kmnrtu]|i[delmnoqrst]|j[emop]|k[eghimnprwyz]|l[abcikrstuvy]|m[acdeghklmnopqrstuvwxyz]|n[acefgilopruz]|om|p[aefghklmnrstwy]|qa|r[eosuw]|s[abcdeghijklmnortuvxyz]|t[cdfghjklmnortvwz]|u[agksyz]|v[aceginu]|w[fs]|y[et]|z[amw]",NV="biz|com|edu|gov|net|org|pro|web|xxx|aero|asia|coop|info|museum|name|shop|рф".split("|");function SV(t){t.__index__=-1,t.__text_cache__=""}function CV(t){return function(e,s){const n=e.slice(s);return t.test(n)?n.match(t)[0].length:0}}function wj(){return function(t,e){e.normalize(t)}}function _d(t){const e=t.re=xV(t.__opts__),s=t.__tlds__.slice();t.onCompile(),t.__tlds_replaced__||s.push(kV),s.push(e.src_xn),e.src_tlds=s.join("|");function n(l){return l.replace("%TLDS%",e.src_tlds)}e.email_fuzzy=RegExp(n(e.tpl_email_fuzzy),"i"),e.link_fuzzy=RegExp(n(e.tpl_link_fuzzy),"i"),e.link_no_ip_fuzzy=RegExp(n(e.tpl_link_no_ip_fuzzy),"i"),e.host_fuzzy_test=RegExp(n(e.tpl_host_fuzzy_test),"i");const i=[];t.__compiled__={};function a(l,c){throw new Error('(LinkifyIt) Invalid schema "'+l+'": '+c)}Object.keys(t.__schemas__).forEach(function(l){const c=t.__schemas__[l];if(c===null)return;const u={validate:null,link:null};if(t.__compiled__[l]=u,yV(c)){bV(c.validate)?u.validate=CV(c.validate):jj(c.validate)?u.validate=c.validate:a(l,c),jj(c.normalize)?u.normalize=c.normalize:c.normalize?a(l,c):u.normalize=wj();return}if(gV(c)){i.push(l);return}a(l,c)}),i.forEach(function(l){t.__compiled__[t.__schemas__[l]]&&(t.__compiled__[l].validate=t.__compiled__[t.__schemas__[l]].validate,t.__compiled__[l].normalize=t.__compiled__[t.__schemas__[l]].normalize)}),t.__compiled__[""]={validate:null,normalize:wj()};const o=Object.keys(t.__compiled__).filter(function(l){return l.length>0&&t.__compiled__[l]}).map(jV).join("|");t.re.schema_test=RegExp("(^|(?!_)(?:[><｜]|"+e.src_ZPCc+"))("+o+")","i"),t.re.schema_search=RegExp("(^|(?!_)(?:[><｜]|"+e.src_ZPCc+"))("+o+")","ig"),t.re.schema_at_start=RegExp("^"+t.re.schema_search.source,"i"),t.re.pretest=RegExp("("+t.re.schema_test.source+")|("+t.re.host_fuzzy_test.source+")|@","i"),SV(t)}function zV(t,e){const s=t.__index__,n=t.__last_index__,i=t.__text_cache__.slice(s,n);this.schema=t.__schema__.toLowerCase(),this.index=s+e,this.lastIndex=n+e,this.raw=i,this.text=i,this.url=i}function vp(t,e){const s=new zV(t,e);return t.__compiled__[s.schema].normalize(s,t),s}function Rs(t,e){if(!(this instanceof Rs))return new Rs(t,e);e||wV(t)&&(e=t,t={}),this.__opts__=wp({},nz,e),this.__index__=-1,this.__last_index__=-1,this.__schema__="",this.__text_cache__="",this.__schemas__=wp({},vV,t),this.__compiled__={},this.__tlds__=NV,this.__tlds_replaced__=!1,this.re={},_d(this)}Rs.prototype.add=function(e,s){return this.__schemas__[e]=s,_d(this),this};Rs.prototype.set=function(e){return this.__opts__=wp(this.__opts__,e),this};Rs.prototype.test=function(e){if(this.__text_cache__=e,this.__index__=-1,!e.length)return!1;let s,n,i,a,o,l,c,u,d;if(this.re.schema_test.test(e)){for(c=this.re.schema_search,c.lastIndex=0;(s=c.exec(e))!==null;)if(a=this.testSchemaAt(e,s[2],c.lastIndex),a){this.__schema__=s[2],this.__index__=s.index+s[1].length,this.__last_index__=s.index+s[0].length+a;break}}return this.__opts__.fuzzyLink&&this.__compiled__["http:"]&&(u=e.search(this.re.host_fuzzy_test),u>=0&&(this.__index__<0||u<this.__index__)&&(n=e.match(this.__opts__.fuzzyIP?this.re.link_fuzzy:this.re.link_no_ip_fuzzy))!==null&&(o=n.index+n[1].length,(this.__index__<0||o<this.__index__)&&(this.__schema__="",this.__index__=o,this.__last_index__=n.index+n[0].length))),this.__opts__.fuzzyEmail&&this.__compiled__["mailto:"]&&(d=e.indexOf("@"),d>=0&&(i=e.match(this.re.email_fuzzy))!==null&&(o=i.index+i[1].length,l=i.index+i[0].length,(this.__index__<0||o<this.__index__||o===this.__index__&&l>this.__last_index__)&&(this.__schema__="mailto:",this.__index__=o,this.__last_index__=l))),this.__index__>=0};Rs.prototype.pretest=function(e){return this.re.pretest.test(e)};Rs.prototype.testSchemaAt=function(e,s,n){return this.__compiled__[s.toLowerCase()]?this.__compiled__[s.toLowerCase()].validate(e,n,this):0};Rs.prototype.match=function(e){const s=[];let n=0;this.__index__>=0&&this.__text_cache__===e&&(s.push(vp(this,n)),n=this.__last_index__);let i=n?e.slice(n):e;for(;this.test(i);)s.push(vp(this,n)),i=i.slice(this.__last_index__),n+=this.__last_index__;return s.length?s:null};Rs.prototype.matchAtStart=function(e){if(this.__text_cache__=e,this.__index__=-1,!e.length)return null;const s=this.re.schema_at_start.exec(e);if(!s)return null;const n=this.testSchemaAt(e,s[2],s[0].length);return n?(this.__schema__=s[2],this.__index__=s.index+s[1].length,this.__last_index__=s.index+s[0].length+n,vp(this,0)):null};Rs.prototype.tlds=function(e,s){return e=Array.isArray(e)?e:[e],s?(this.__tlds__=this.__tlds__.concat(e).sort().filter(function(n,i,a){return n!==a[i-1]}).reverse(),_d(this),this):(this.__tlds__=e.slice(),this.__tlds_replaced__=!0,_d(this),this)};Rs.prototype.normalize=function(e){e.schema||(e.url="http://"+e.url),e.schema==="mailto:"&&!/^mailto:/i.test(e.url)&&(e.url="mailto:"+e.url)};Rs.prototype.onCompile=function(){};const Fa=2147483647,zn=36,Eg=1,Kl=26,_V=38,AV=700,rz=72,iz=128,az="-",TV=/^xn--/,EV=/[^\0-\x7F]/,DV=/[\x2E\u3002\uFF0E\uFF61]/g,MV={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},Qf=zn-Eg,_n=Math.floor,Yf=String.fromCharCode;function Er(t){throw new RangeError(MV[t])}function PV(t,e){const s=[];let n=t.length;for(;n--;)s[n]=e(t[n]);return s}function oz(t,e){const s=t.split("@");let n="";s.length>1&&(n=s[0]+"@",t=s[1]),t=t.replace(DV,".");const i=t.split("."),a=PV(i,e).join(".");return n+a}function lz(t){const e=[];let s=0;const n=t.length;for(;s<n;){const i=t.charCodeAt(s++);if(i>=55296&&i<=56319&&s<n){const a=t.charCodeAt(s++);(a&64512)==56320?e.push(((i&1023)<<10)+(a&1023)+65536):(e.push(i),s--)}else e.push(i)}return e}const IV=t=>String.fromCodePoint(...t),OV=function(t){return t>=48&&t<58?26+(t-48):t>=65&&t<91?t-65:t>=97&&t<123?t-97:zn},vj=function(t,e){return t+22+75*(t<26)-((e!=0)<<5)},cz=function(t,e,s){let n=0;for(t=s?_n(t/AV):t>>1,t+=_n(t/e);t>Qf*Kl>>1;n+=zn)t=_n(t/Qf);return _n(n+(Qf+1)*t/(t+_V))},uz=function(t){const e=[],s=t.length;let n=0,i=iz,a=rz,o=t.lastIndexOf(az);o<0&&(o=0);for(let l=0;l<o;++l)t.charCodeAt(l)>=128&&Er("not-basic"),e.push(t.charCodeAt(l));for(let l=o>0?o+1:0;l<s;){const c=n;for(let d=1,h=zn;;h+=zn){l>=s&&Er("invalid-input");const f=OV(t.charCodeAt(l++));f>=zn&&Er("invalid-input"),f>_n((Fa-n)/d)&&Er("overflow"),n+=f*d;const m=h<=a?Eg:h>=a+Kl?Kl:h-a;if(f<m)break;const p=zn-m;d>_n(Fa/p)&&Er("overflow"),d*=p}const u=e.length+1;a=cz(n-c,u,c==0),_n(n/u)>Fa-i&&Er("overflow"),i+=_n(n/u),n%=u,e.splice(n++,0,i)}return String.fromCodePoint(...e)},dz=function(t){const e=[];t=lz(t);const s=t.length;let n=iz,i=0,a=rz;for(const c of t)c<128&&e.push(Yf(c));const o=e.length;let l=o;for(o&&e.push(az);l<s;){let c=Fa;for(const d of t)d>=n&&d<c&&(c=d);const u=l+1;c-n>_n((Fa-i)/u)&&Er("overflow"),i+=(c-n)*u,n=c;for(const d of t)if(d<n&&++i>Fa&&Er("overflow"),d===n){let h=i;for(let f=zn;;f+=zn){const m=f<=a?Eg:f>=a+Kl?Kl:f-a;if(h<m)break;const p=h-m,x=zn-m;e.push(Yf(vj(m+p%x,0))),h=_n(p/x)}e.push(Yf(vj(h,0))),a=cz(i,u,l===o),i=0,++l}++i,++n}return e.join("")},RV=function(t){return oz(t,function(e){return TV.test(e)?uz(e.slice(4).toLowerCase()):e})},LV=function(t){return oz(t,function(e){return EV.test(e)?"xn--"+dz(e):e})},hz={version:"2.3.1",ucs2:{decode:lz,encode:IV},decode:uz,encode:dz,toASCII:LV,toUnicode:RV},FV={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"“”‘’",highlight:null,maxNesting:100},components:{core:{},block:{},inline:{}}},$V={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"“”‘’",highlight:null,maxNesting:20},components:{core:{rules:["normalize","block","inline","text_join"]},block:{rules:["paragraph"]},inline:{rules:["text"],rules2:["balance_pairs","fragments_join"]}}},BV={options:{html:!0,xhtmlOut:!0,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"“”‘’",highlight:null,maxNesting:20},components:{core:{rules:["normalize","block","inline","text_join"]},block:{rules:["blockquote","code","fence","heading","hr","html_block","lheading","list","reference","paragraph"]},inline:{rules:["autolink","backticks","emphasis","entity","escape","html_inline","image","link","newline","text"],rules2:["balance_pairs","emphasis","fragments_join"]}}},qV={default:FV,zero:$V,commonmark:BV},VV=/^(vbscript|javascript|file|data):/,UV=/^data:image\/(gif|png|jpeg|webp);/;function WV(t){const e=t.trim().toLowerCase();return VV.test(e)?UV.test(e):!0}const fz=["http:","https:","mailto:"];function KV(t){const e=Sg(t,!0);if(e.hostname&&(!e.protocol||fz.indexOf(e.protocol)>=0))try{e.hostname=hz.toASCII(e.hostname)}catch{}return xc(Ng(e))}function HV(t){const e=Sg(t,!0);if(e.hostname&&(!e.protocol||fz.indexOf(e.protocol)>=0))try{e.hostname=hz.toUnicode(e.hostname)}catch{}return io(Ng(e),io.defaultChars+"%")}function ks(t,e){if(!(this instanceof ks))return new ks(t,e);e||zg(t)||(e=t||{},t="default"),this.inline=new yc,this.block=new Fh,this.core=new Ag,this.renderer=new ko,this.linkify=new Rs,this.validateLink=WV,this.normalizeLink=KV,this.normalizeLinkText=HV,this.utils=J7,this.helpers=Rh({},X7),this.options={},this.configure(t),e&&this.set(e)}ks.prototype.set=function(t){return Rh(this.options,t),this};ks.prototype.configure=function(t){const e=this;if(zg(t)){const s=t;if(t=qV[s],!t)throw new Error('Wrong `markdown-it` preset "'+s+'", check name')}if(!t)throw new Error("Wrong `markdown-it` preset, can't be empty");return t.options&&e.set(t.options),t.components&&Object.keys(t.components).forEach(function(s){t.components[s].rules&&e[s].ruler.enableOnly(t.components[s].rules),t.components[s].rules2&&e[s].ruler2.enableOnly(t.components[s].rules2)}),this};ks.prototype.enable=function(t,e){let s=[];Array.isArray(t)||(t=[t]),["core","block","inline"].forEach(function(i){s=s.concat(this[i].ruler.enable(t,!0))},this),s=s.concat(this.inline.ruler2.enable(t,!0));const n=t.filter(function(i){return s.indexOf(i)<0});if(n.length&&!e)throw new Error("MarkdownIt. Failed to enable unknown rule(s): "+n);return this};ks.prototype.disable=function(t,e){let s=[];Array.isArray(t)||(t=[t]),["core","block","inline"].forEach(function(i){s=s.concat(this[i].ruler.disable(t,!0))},this),s=s.concat(this.inline.ruler2.disable(t,!0));const n=t.filter(function(i){return s.indexOf(i)<0});if(n.length&&!e)throw new Error("MarkdownIt. Failed to disable unknown rule(s): "+n);return this};ks.prototype.use=function(t){const e=[this].concat(Array.prototype.slice.call(arguments,1));return t.apply(t,e),this};ks.prototype.parse=function(t,e){if(typeof t!="string")throw new Error("Input data should be a String");const s=new this.core.State(t,this,e);return this.core.process(s),s.tokens};ks.prototype.render=function(t,e){return e=e||{},this.renderer.render(this.parse(t,e),this.options,e)};ks.prototype.parseInline=function(t,e){const s=new this.core.State(t,this,e);return s.inlineMode=!0,this.core.process(s),s.tokens};ks.prototype.renderInline=function(t,e){return e=e||{},this.renderer.render(this.parseInline(t,e),this.options,e)};const GV=new Lx({nodes:{doc:{content:"block+"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM(){return["p",0]}},blockquote:{content:"block+",group:"block",parseDOM:[{tag:"blockquote"}],toDOM(){return["blockquote",0]}},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM(){return["div",["hr"]]}},heading:{attrs:{level:{default:1}},content:"(text | image)*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM(t){return["h"+t.attrs.level,0]}},code_block:{content:"text*",group:"block",code:!0,defining:!0,marks:"",attrs:{params:{default:""}},parseDOM:[{tag:"pre",preserveWhitespace:"full",getAttrs:t=>({params:t.getAttribute("data-params")||""})}],toDOM(t){return["pre",t.attrs.params?{"data-params":t.attrs.params}:{},["code",0]]}},ordered_list:{content:"list_item+",group:"block",attrs:{order:{default:1},tight:{default:!1}},parseDOM:[{tag:"ol",getAttrs(t){return{order:t.hasAttribute("start")?+t.getAttribute("start"):1,tight:t.hasAttribute("data-tight")}}}],toDOM(t){return["ol",{start:t.attrs.order==1?null:t.attrs.order,"data-tight":t.attrs.tight?"true":null},0]}},bullet_list:{content:"list_item+",group:"block",attrs:{tight:{default:!1}},parseDOM:[{tag:"ul",getAttrs:t=>({tight:t.hasAttribute("data-tight")})}],toDOM(t){return["ul",{"data-tight":t.attrs.tight?"true":null},0]}},list_item:{content:"block+",defining:!0,parseDOM:[{tag:"li"}],toDOM(){return["li",0]}},text:{group:"inline"},image:{inline:!0,attrs:{src:{},alt:{default:null},title:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs(t){return{src:t.getAttribute("src"),title:t.getAttribute("title"),alt:t.getAttribute("alt")}}}],toDOM(t){return["img",t.attrs]}},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM(){return["br"]}}},marks:{em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"},{style:"font-style=normal",clearMark:t=>t.type.name=="em"}],toDOM(){return["em"]}},strong:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name=="strong"},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}],toDOM(){return["strong"]}},link:{attrs:{href:{},title:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs(t){return{href:t.getAttribute("href"),title:t.getAttribute("title")}}}],toDOM(t){return["a",t.attrs]}},code:{code:!0,parseDOM:[{tag:"code"}],toDOM(){return["code"]}}}});function JV(t,e){if(t.isText&&e.isText&&ze.sameSet(t.marks,e.marks))return t.withText(t.text+e.text)}class ZV{constructor(e,s){this.schema=e,this.tokenHandlers=s,this.stack=[{type:e.topNodeType,attrs:null,content:[],marks:ze.none}]}top(){return this.stack[this.stack.length-1]}push(e){this.stack.length&&this.top().content.push(e)}addText(e){if(!e)return;let s=this.top(),n=s.content,i=n[n.length-1],a=this.schema.text(e,s.marks),o;i&&(o=JV(i,a))?n[n.length-1]=o:n.push(a)}openMark(e){let s=this.top();s.marks=e.addToSet(s.marks)}closeMark(e){let s=this.top();s.marks=e.removeFromSet(s.marks)}parseTokens(e){for(let s=0;s<e.length;s++){let n=e[s],i=this.tokenHandlers[n.type];if(!i)throw new Error("Token type `"+n.type+"` not supported by Markdown parser");i(this,n,e,s)}}addNode(e,s,n){let i=this.top(),a=e.createAndFill(s,n,i?i.marks:[]);return a?(this.push(a),a):null}openNode(e,s){this.stack.push({type:e,attrs:s,content:[],marks:ze.none})}closeNode(){let e=this.stack.pop();return this.addNode(e.type,e.attrs,e.content)}}function Oo(t,e,s,n){return t.getAttrs?t.getAttrs(e,s,n):t.attrs instanceof Function?t.attrs(e):t.attrs}function Xf(t,e){return t.noCloseToken||e=="code_inline"||e=="code_block"||e=="fence"}function kj(t){return t[t.length-1]==`
`?t.slice(0,t.length-1):t}function em(){}function QV(t,e){let s=Object.create(null);for(let n in e){let i=e[n];if(i.block){let a=t.nodeType(i.block);Xf(i,n)?s[n]=(o,l,c,u)=>{o.openNode(a,Oo(i,l,c,u)),o.addText(kj(l.content)),o.closeNode()}:(s[n+"_open"]=(o,l,c,u)=>o.openNode(a,Oo(i,l,c,u)),s[n+"_close"]=o=>o.closeNode())}else if(i.node){let a=t.nodeType(i.node);s[n]=(o,l,c,u)=>o.addNode(a,Oo(i,l,c,u))}else if(i.mark){let a=t.marks[i.mark];Xf(i,n)?s[n]=(o,l,c,u)=>{o.openMark(a.create(Oo(i,l,c,u))),o.addText(kj(l.content)),o.closeMark(a)}:(s[n+"_open"]=(o,l,c,u)=>o.openMark(a.create(Oo(i,l,c,u))),s[n+"_close"]=o=>o.closeMark(a))}else if(i.ignore)Xf(i,n)?s[n]=em:(s[n+"_open"]=em,s[n+"_close"]=em);else throw new RangeError("Unrecognized parsing spec "+JSON.stringify(i))}return s.text=(n,i)=>n.addText(i.content),s.inline=(n,i)=>n.parseTokens(i.children),s.softbreak=s.softbreak||(n=>n.addText(" ")),s}let YV=class{constructor(e,s,n){this.schema=e,this.tokenizer=s,this.tokens=n,this.tokenHandlers=QV(e,n)}parse(e,s={}){let n=new ZV(this.schema,this.tokenHandlers),i;n.parseTokens(this.tokenizer.parse(e,s));do i=n.closeNode();while(n.stack.length);return i||this.schema.topNodeType.createAndFill()}};function Nj(t,e){for(;++e<t.length;)if(t[e].type!="list_item_open")return t[e].hidden;return!1}new YV(GV,ks("commonmark",{html:!1}),{blockquote:{block:"blockquote"},paragraph:{block:"paragraph"},list_item:{block:"list_item"},bullet_list:{block:"bullet_list",getAttrs:(t,e,s)=>({tight:Nj(e,s)})},ordered_list:{block:"ordered_list",getAttrs:(t,e,s)=>({order:+t.attrGet("start")||1,tight:Nj(e,s)})},heading:{block:"heading",getAttrs:t=>({level:+t.tag.slice(1)})},code_block:{block:"code_block",noCloseToken:!0},fence:{block:"code_block",getAttrs:t=>({params:t.info||""}),noCloseToken:!0},hr:{node:"horizontal_rule"},image:{node:"image",getAttrs:t=>({src:t.attrGet("src"),title:t.attrGet("title")||null,alt:t.children[0]&&t.children[0].content||null})},hardbreak:{node:"hard_break"},em:{mark:"em"},strong:{mark:"strong"},link:{mark:"link",getAttrs:t=>({href:t.attrGet("href"),title:t.attrGet("title")||null})},code_inline:{mark:"code",noCloseToken:!0}});const XV={open:"",close:"",mixable:!0};let eU=class{constructor(e,s,n={}){this.nodes=e,this.marks=s,this.options=n}serialize(e,s={}){s=Object.assign({},this.options,s);let n=new mz(this.nodes,this.marks,s);return n.renderContent(e),n.out}};const Kn=new eU({blockquote(t,e){t.wrapBlock("> ",null,e,()=>t.renderContent(e))},code_block(t,e){const s=e.textContent.match(/`{3,}/gm),n=s?s.sort().slice(-1)[0]+"`":"```";t.write(n+(e.attrs.params||"")+`
`),t.text(e.textContent,!1),t.write(`
`),t.write(n),t.closeBlock(e)},heading(t,e){t.write(t.repeat("#",e.attrs.level)+" "),t.renderInline(e,!1),t.closeBlock(e)},horizontal_rule(t,e){t.write(e.attrs.markup||"---"),t.closeBlock(e)},bullet_list(t,e){t.renderList(e,"  ",()=>(e.attrs.bullet||"*")+" ")},ordered_list(t,e){let s=e.attrs.order||1,n=String(s+e.childCount-1).length,i=t.repeat(" ",n+2);t.renderList(e,i,a=>{let o=String(s+a);return t.repeat(" ",n-o.length)+o+". "})},list_item(t,e){t.renderContent(e)},paragraph(t,e){t.renderInline(e),t.closeBlock(e)},image(t,e){t.write("!["+t.esc(e.attrs.alt||"")+"]("+e.attrs.src.replace(/[\(\)]/g,"\\$&")+(e.attrs.title?' "'+e.attrs.title.replace(/"/g,'\\"')+'"':"")+")")},hard_break(t,e,s,n){for(let i=n+1;i<s.childCount;i++)if(s.child(i).type!=e.type){t.write(`\\
`);return}},text(t,e){t.text(e.text,!t.inAutolink)}},{em:{open:"*",close:"*",mixable:!0,expelEnclosingWhitespace:!0},strong:{open:"**",close:"**",mixable:!0,expelEnclosingWhitespace:!0},link:{open(t,e,s,n){return t.inAutolink=tU(e,s,n),t.inAutolink?"<":"["},close(t,e,s,n){let{inAutolink:i}=t;return t.inAutolink=void 0,i?">":"]("+e.attrs.href.replace(/[\(\)"]/g,"\\$&")+(e.attrs.title?` "${e.attrs.title.replace(/"/g,'\\"')}"`:"")+")"},mixable:!0},code:{open(t,e,s,n){return Sj(s.child(n),-1)},close(t,e,s,n){return Sj(s.child(n-1),1)},escape:!1}});function Sj(t,e){let s=/`+/g,n,i=0;if(t.isText)for(;n=s.exec(t.text);)i=Math.max(i,n[0].length);let a=i>0&&e>0?" `":"`";for(let o=0;o<i;o++)a+="`";return i>0&&e<0&&(a+=" "),a}function tU(t,e,s){if(t.attrs.title||!/^\w+:/.test(t.attrs.href))return!1;let n=e.child(s);return!n.isText||n.text!=t.attrs.href||n.marks[n.marks.length-1]!=t?!1:s==e.childCount-1||!t.isInSet(e.child(s+1).marks)}let mz=class{constructor(e,s,n){this.nodes=e,this.marks=s,this.options=n,this.delim="",this.out="",this.closed=null,this.inAutolink=void 0,this.atBlockStart=!1,this.inTightList=!1,typeof this.options.tightLists>"u"&&(this.options.tightLists=!1),typeof this.options.hardBreakNodeName>"u"&&(this.options.hardBreakNodeName="hard_break")}flushClose(e=2){if(this.closed){if(this.atBlank()||(this.out+=`
`),e>1){let s=this.delim,n=/\s+$/.exec(s);n&&(s=s.slice(0,s.length-n[0].length));for(let i=1;i<e;i++)this.out+=s+`
`}this.closed=null}}getMark(e){let s=this.marks[e];if(!s){if(this.options.strict!==!1)throw new Error(`Mark type \`${e}\` not supported by Markdown renderer`);s=XV}return s}wrapBlock(e,s,n,i){let a=this.delim;this.write(s??e),this.delim+=e,i(),this.delim=a,this.closeBlock(n)}atBlank(){return/(^|\n)$/.test(this.out)}ensureNewLine(){this.atBlank()||(this.out+=`
`)}write(e){this.flushClose(),this.delim&&this.atBlank()&&(this.out+=this.delim),e&&(this.out+=e)}closeBlock(e){this.closed=e}text(e,s=!0){let n=e.split(`
`);for(let i=0;i<n.length;i++)this.write(),!s&&n[i][0]=="["&&/(^|[^\\])\!$/.test(this.out)&&(this.out=this.out.slice(0,this.out.length-1)+"\\!"),this.out+=s?this.esc(n[i],this.atBlockStart):n[i],i!=n.length-1&&(this.out+=`
`)}render(e,s,n){if(this.nodes[e.type.name])this.nodes[e.type.name](this,e,s,n);else{if(this.options.strict!==!1)throw new Error("Token type `"+e.type.name+"` not supported by Markdown renderer");e.type.isLeaf||(e.type.inlineContent?this.renderInline(e):this.renderContent(e),e.isBlock&&this.closeBlock(e))}}renderContent(e){e.forEach((s,n,i)=>this.render(s,e,i))}renderInline(e,s=!0){this.atBlockStart=s;let n=[],i="",a=(o,l,c)=>{let u=o?o.marks:[];o&&o.type.name===this.options.hardBreakNodeName&&(u=u.filter(x=>{if(c+1==e.childCount)return!1;let g=e.child(c+1);return x.isInSet(g.marks)&&(!g.isText||/\S/.test(g.text))}));let d=i;if(i="",o&&o.isText&&u.some(x=>{let g=this.getMark(x.type.name);return g&&g.expelEnclosingWhitespace&&!x.isInSet(n)})){let[x,g,y]=/^(\s*)(.*)$/m.exec(o.text);g&&(d+=g,o=y?o.withText(y):null,o||(u=n))}if(o&&o.isText&&u.some(x=>{let g=this.getMark(x.type.name);return g&&g.expelEnclosingWhitespace&&(c==e.childCount-1||!x.isInSet(e.child(c+1).marks))})){let[x,g,y]=/^(.*?)(\s*)$/m.exec(o.text);y&&(i=y,o=g?o.withText(g):null,o||(u=n))}let h=u.length?u[u.length-1]:null,f=h&&this.getMark(h.type.name).escape===!1,m=u.length-(f?1:0);e:for(let x=0;x<m;x++){let g=u[x];if(!this.getMark(g.type.name).mixable)break;for(let y=0;y<n.length;y++){let b=n[y];if(!this.getMark(b.type.name).mixable)break;if(g.eq(b)){x>y?u=u.slice(0,y).concat(g).concat(u.slice(y,x)).concat(u.slice(x+1,m)):y>x&&(u=u.slice(0,x).concat(u.slice(x+1,y)).concat(g).concat(u.slice(y,m)));continue e}}}let p=0;for(;p<Math.min(n.length,m)&&u[p].eq(n[p]);)++p;for(;p<n.length;)this.text(this.markString(n.pop(),!1,e,c),!1);if(d&&this.text(d),o){for(;n.length<m;){let x=u[n.length];n.push(x),this.text(this.markString(x,!0,e,c),!1),this.atBlockStart=!1}f&&o.isText?this.text(this.markString(h,!0,e,c)+o.text+this.markString(h,!1,e,c+1),!1):this.render(o,e,c),this.atBlockStart=!1}o?.isText&&o.nodeSize>0&&(this.atBlockStart=!1)};e.forEach(a),a(null,0,e.childCount),this.atBlockStart=!1}renderList(e,s,n){this.closed&&this.closed.type==e.type?this.flushClose(3):this.inTightList&&this.flushClose(1);let i=typeof e.attrs.tight<"u"?e.attrs.tight:this.options.tightLists,a=this.inTightList;this.inTightList=i,e.forEach((o,l,c)=>{c&&i&&this.flushClose(1),this.wrapBlock(s,n(c),e,()=>this.render(o,e,c))}),this.inTightList=a}esc(e,s=!1){return e=e.replace(/[`*\\~\[\]_]/g,(n,i)=>n=="_"&&i>0&&i+1<e.length&&e[i-1].match(/\w/)&&e[i+1].match(/\w/)?n:"\\"+n),s&&(e=e.replace(/^(\+[ ]|[\-*>])/,"\\$&").replace(/^(\s*)(#{1,6})(\s|$)/,"$1\\$2$3").replace(/^(\s*\d+)\.\s/,"$1\\. ")),this.options.escapeExtraCharacters&&(e=e.replace(this.options.escapeExtraCharacters,"\\$&")),e}quote(e){let s=e.indexOf('"')==-1?'""':e.indexOf("'")==-1?"''":"()";return s[0]+e+s[1]}repeat(e,s){let n="";for(let i=0;i<s;i++)n+=e;return n}markString(e,s,n,i){let a=this.getMark(e.type.name),o=s?a.open:a.close;return typeof o=="string"?o:o(this,e,n,i)}getEnclosingWhitespace(e){return{leading:(e.match(/^(\s+)/)||[void 0])[0],trailing:(e.match(/(\s+)$/)||[void 0])[0]}}};var tm,Cj;function sU(){if(Cj)return tm;Cj=1;var t=!0,e=!1,s=!1;tm=function(x,g){g&&(t=!g.enabled,e=!!g.label,s=!!g.labelAfter),x.core.ruler.after("inline","github-task-lists",function(y){for(var b=y.tokens,w=2;w<b.length;w++)a(b,w)&&(o(b[w],y.Token),n(b[w-2],"class","task-list-item"+(t?"":" enabled")),n(b[i(b,w-2)],"class","contains-task-list"))})};function n(x,g,y){var b=x.attrIndex(g),w=[g,y];b<0?x.attrPush(w):x.attrs[b]=w}function i(x,g){for(var y=x[g].level-1,b=g-1;b>=0;b--)if(x[b].level===y)return b;return-1}function a(x,g){return h(x[g])&&f(x[g-1])&&m(x[g-2])&&p(x[g])}function o(x,g){if(x.children.unshift(l(x,g)),x.children[1].content=x.children[1].content.slice(3),x.content=x.content.slice(3),e)if(s){x.children.pop();var y="task-item-"+Math.ceil(Math.random()*(1e4*1e3)-1e3);x.children[0].content=x.children[0].content.slice(0,-1)+' id="'+y+'">',x.children.push(d(x.content,y,g))}else x.children.unshift(c(g)),x.children.push(u(g))}function l(x,g){var y=new g("html_inline","",0),b=t?' disabled="" ':"";return x.content.indexOf("[ ] ")===0?y.content='<input class="task-list-item-checkbox"'+b+'type="checkbox">':(x.content.indexOf("[x] ")===0||x.content.indexOf("[X] ")===0)&&(y.content='<input class="task-list-item-checkbox" checked=""'+b+'type="checkbox">'),y}function c(x){var g=new x("html_inline","",0);return g.content="<label>",g}function u(x){var g=new x("html_inline","",0);return g.content="</label>",g}function d(x,g,y){var b=new y("html_inline","",0);return b.content='<label class="task-list-item-label" for="'+g+'">'+x+"</label>",b.attrs=[{for:g}],b}function h(x){return x.type==="inline"}function f(x){return x.type==="paragraph_open"}function m(x){return x.type==="list_item_open"}function p(x){return x.content.indexOf("[ ] ")===0||x.content.indexOf("[x] ")===0||x.content.indexOf("[X] ")===0}return tm}var nU=sU();const rU=z1(nU);var iU=Object.defineProperty,aU=(t,e,s)=>e in t?iU(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Ad=(t,e,s)=>(aU(t,typeof e!="symbol"?e+"":e,s),s);const oU=qe.create({name:"markdownTightLists",addOptions:()=>({tight:!0,tightClass:"tight",listTypes:["bulletList","orderedList"]}),addGlobalAttributes(){return[{types:this.options.listTypes,attributes:{tight:{default:this.options.tight,parseHTML:t=>t.getAttribute("data-tight")==="true"||!t.querySelector("p"),renderHTML:t=>({class:t.tight?this.options.tightClass:null,"data-tight":t.tight?"true":null})}}}]},addCommands(){var t=this;return{toggleTight:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return s=>{let{editor:n,commands:i}=s;function a(o){if(!n.isActive(o))return!1;const l=n.getAttributes(o);return i.updateAttributes(o,{tight:e??!(l!=null&&l.tight)})}return t.options.listTypes.some(o=>a(o))}}}}}),zj=ks();function pz(t,e){return zj.inline.State.prototype.scanDelims.call({src:t,posMax:t.length}),new zj.inline.State(t,null,null,[]).scanDelims(e,!0)}function xz(t,e,s,n){let i=t.substring(0,s)+t.substring(s+e.length);return i=i.substring(0,s+n)+e+i.substring(s+n),i}function lU(t,e,s,n){let i=s,a=t;for(;i<n&&!pz(a,i).can_open;)a=xz(a,e,i,1),i++;return{text:a,from:i,to:n}}function cU(t,e,s,n){let i=n,a=t;for(;i>s&&!pz(a,i).can_close;)a=xz(a,e,i,-1),i--;return{text:a,from:s,to:i}}function uU(t,e,s,n){let i={text:t,from:s,to:n};return i=lU(i.text,e,i.from,i.to),i=cU(i.text,e,i.from,i.to),i.to-i.from<e.length+1&&(i.text=i.text.substring(0,i.from)+i.text.substring(i.to+e.length)),i.text}class dU extends mz{constructor(e,s,n){super(e,s,n??{}),Ad(this,"inTable",!1),this.inlines=[]}render(e,s,n){super.render(e,s,n);const i=this.inlines[this.inlines.length-1];if(i!=null&&i.start&&i!==null&&i!==void 0&&i.end){const{delimiter:a,start:o,end:l}=this.normalizeInline(i);this.out=uU(this.out,a,o,l),this.inlines.pop()}}markString(e,s,n,i){const a=this.marks[e.type.name];if(a.expelEnclosingWhitespace)if(s)this.inlines.push({start:this.out.length,delimiter:a.open});else{const o=this.inlines.pop();this.inlines.push({...o,end:this.out.length})}return super.markString(e,s,n,i)}normalizeInline(e){let{start:s,end:n}=e;for(;this.out.charAt(s).match(/\s/);)s++;return{...e,start:s}}}const gz=Ls.create({name:"markdownHTMLMark",addStorage(){return{markdown:{serialize:{open(t,e){var s,n;return this.editor.storage.markdown.options.html?(s=(n=_j(e))===null||n===void 0?void 0:n[0])!==null&&s!==void 0?s:"":(console.warn(`Tiptap Markdown: "${e.type.name}" mark is only available in html mode`),"")},close(t,e){var s,n;return this.editor.storage.markdown.options.html&&(s=(n=_j(e))===null||n===void 0?void 0:n[1])!==null&&s!==void 0?s:""}},parse:{}}}}});function _j(t){const e=t.type.schema,s=e.text(" ",[t]),i=mc(q.from(s),e).match(/^(<.*?>) (<\/.*?>)$/);return i?[i[1],i[2]]:null}function Dg(t){const e=`<body>${t}</body>`;return new window.DOMParser().parseFromString(e,"text/html").body}function hU(t){return t?.replace(/</g,"&lt;").replace(/>/g,"&gt;")}function fU(t){const e=t.parentElement,s=e.cloneNode();for(;e.firstChild&&e.firstChild!==t;)s.appendChild(e.firstChild);s.childNodes.length>0&&e.parentElement.insertBefore(s,e),e.parentElement.insertBefore(t,e),e.childNodes.length===0&&e.remove()}function mU(t){const e=t.parentNode;for(;t.firstChild;)e.insertBefore(t.firstChild,t);e.removeChild(t)}const Bh=Ne.create({name:"markdownHTMLNode",addStorage(){return{markdown:{serialize(t,e,s){this.editor.storage.markdown.options.html?t.write(pU(e,s)):(console.warn(`Tiptap Markdown: "${e.type.name}" node is only available in html mode`),t.write(`[${e.type.name}]`)),e.isBlock&&t.closeBlock(e)},parse:{}}}}});function pU(t,e){const s=t.type.schema,n=mc(q.from(t),s);return t.isBlock&&(e instanceof q||e.type.name===s.topNodeType.name)?xU(n):n}function xU(t){const s=Dg(t).firstElementChild;return s.innerHTML=s.innerHTML.trim()?`
${s.innerHTML}
`:`
`,s.outerHTML}const gU=Ne.create({name:"blockquote"}),yU=gU.extend({addStorage(){return{markdown:{serialize:Kn.nodes.blockquote,parse:{}}}}}),bU=Ne.create({name:"bulletList"}),yz=bU.extend({addStorage(){return{markdown:{serialize(t,e){return t.renderList(e,"  ",()=>(this.editor.storage.markdown.options.bulletListMarker||"-")+" ")},parse:{}}}}}),jU=Ne.create({name:"codeBlock"}),wU=jU.extend({addStorage(){return{markdown:{serialize(t,e){t.write("```"+(e.attrs.language||"")+`
`),t.text(e.textContent,!1),t.ensureNewLine(),t.write("```"),t.closeBlock(e)},parse:{setup(t){var e;t.set({langPrefix:(e=this.options.languageClassPrefix)!==null&&e!==void 0?e:"language-"})},updateDOM(t){t.innerHTML=t.innerHTML.replace(/\n<\/code><\/pre>/g,"</code></pre>")}}}}}}),vU=Ne.create({name:"hardBreak"}),bz=vU.extend({addStorage(){return{markdown:{serialize(t,e,s,n){for(let i=n+1;i<s.childCount;i++)if(s.child(i).type!=e.type){t.write(t.inTable?Bh.storage.markdown.serialize.call(this,t,e,s):`\\
`);return}},parse:{}}}}}),kU=Ne.create({name:"heading"}),NU=kU.extend({addStorage(){return{markdown:{serialize:Kn.nodes.heading,parse:{}}}}}),SU=Ne.create({name:"horizontalRule"}),CU=SU.extend({addStorage(){return{markdown:{serialize:Kn.nodes.horizontal_rule,parse:{}}}}}),zU=Ne.create({name:"image"}),_U=zU.extend({addStorage(){return{markdown:{serialize:Kn.nodes.image,parse:{}}}}}),AU=Ne.create({name:"listItem"}),TU=AU.extend({addStorage(){return{markdown:{serialize:Kn.nodes.list_item,parse:{}}}}}),EU=Ne.create({name:"orderedList"});function DU(t,e,s){let n=0;for(;s-n>0&&e.child(s-n-1).type.name===t.type.name;n++);return n}const MU=EU.extend({addStorage(){return{markdown:{serialize(t,e,s,n){const i=e.attrs.start||1,a=String(i+e.childCount-1).length,o=t.repeat(" ",a+2),c=DU(e,s,n)%2?") ":". ";t.renderList(e,o,u=>{const d=String(i+u);return t.repeat(" ",a-d.length)+d+c})},parse:{}}}}}),PU=Ne.create({name:"paragraph"}),IU=PU.extend({addStorage(){return{markdown:{serialize:Kn.nodes.paragraph,parse:{}}}}});function sm(t){var e,s;return(e=t==null||(s=t.content)===null||s===void 0?void 0:s.content)!==null&&e!==void 0?e:[]}const OU=Ne.create({name:"table"}),RU=OU.extend({addStorage(){return{markdown:{serialize(t,e,s){if(!LU(e)){Bh.storage.markdown.serialize.call(this,t,e,s);return}t.inTable=!0,e.forEach((n,i,a)=>{if(t.write("| "),n.forEach((o,l,c)=>{c&&t.write(" | ");const u=o.firstChild;u.textContent.trim()&&t.renderInline(u)}),t.write(" |"),t.ensureNewLine(),!a){const o=Array.from({length:n.childCount}).map(()=>"---").join(" | ");t.write(`| ${o} |`),t.ensureNewLine()}}),t.closeBlock(e),t.inTable=!1},parse:{}}}}});function Aj(t){return t.attrs.colspan>1||t.attrs.rowspan>1}function LU(t){const e=sm(t),s=e[0],n=e.slice(1);return!(sm(s).some(i=>i.type.name!=="tableHeader"||Aj(i)||i.childCount>1)||n.some(i=>sm(i).some(a=>a.type.name==="tableHeader"||Aj(a)||a.childCount>1)))}const FU=Ne.create({name:"taskItem"}),$U=FU.extend({addStorage(){return{markdown:{serialize(t,e){const s=e.attrs.checked?"[x]":"[ ]";t.write(`${s} `),t.renderContent(e)},parse:{updateDOM(t){[...t.querySelectorAll(".task-list-item")].forEach(e=>{const s=e.querySelector("input");e.setAttribute("data-type","taskItem"),s&&(e.setAttribute("data-checked",s.checked),s.remove())})}}}}}}),BU=Ne.create({name:"taskList"}),qU=BU.extend({addStorage(){return{markdown:{serialize:yz.storage.markdown.serialize,parse:{setup(t){t.use(rU)},updateDOM(t){[...t.querySelectorAll(".contains-task-list")].forEach(e=>{e.setAttribute("data-type","taskList")})}}}}}}),VU=Ne.create({name:"text"}),UU=VU.extend({addStorage(){return{markdown:{serialize(t,e){t.text(hU(e.text))},parse:{}}}}}),WU=Ls.create({name:"bold"}),KU=WU.extend({addStorage(){return{markdown:{serialize:Kn.marks.strong,parse:{}}}}}),HU=Ls.create({name:"code"}),GU=HU.extend({addStorage(){return{markdown:{serialize:Kn.marks.code,parse:{}}}}}),JU=Ls.create({name:"italic"}),ZU=JU.extend({addStorage(){return{markdown:{serialize:Kn.marks.em,parse:{}}}}}),QU=Ls.create({name:"link"}),YU=QU.extend({addStorage(){return{markdown:{serialize:Kn.marks.link,parse:{}}}}}),XU=Ls.create({name:"strike"}),eW=XU.extend({addStorage(){return{markdown:{serialize:{open:"~~",close:"~~",expelEnclosingWhitespace:!0},parse:{}}}}}),tW=[yU,yz,wU,bz,NU,CU,Bh,_U,TU,MU,IU,RU,$U,qU,UU,KU,GU,gz,ZU,YU,eW];function Td(t){var e,s;const n=(e=t.storage)===null||e===void 0?void 0:e.markdown,i=(s=tW.find(a=>a.name===t.name))===null||s===void 0?void 0:s.storage.markdown;return n||i?{...i,...n}:null}class sW{constructor(e){Ad(this,"editor",null),this.editor=e}serialize(e){const s=new dU(this.nodes,this.marks,{hardBreakNodeName:bz.name});return s.renderContent(e),s.out}get nodes(){var e;return{...Object.fromEntries(Object.keys(this.editor.schema.nodes).map(s=>[s,this.serializeNode(Bh)])),...Object.fromEntries((e=this.editor.extensionManager.extensions.filter(s=>s.type==="node"&&this.serializeNode(s)).map(s=>[s.name,this.serializeNode(s)]))!==null&&e!==void 0?e:[])}}get marks(){var e;return{...Object.fromEntries(Object.keys(this.editor.schema.marks).map(s=>[s,this.serializeMark(gz)])),...Object.fromEntries((e=this.editor.extensionManager.extensions.filter(s=>s.type==="mark"&&this.serializeMark(s)).map(s=>[s.name,this.serializeMark(s)]))!==null&&e!==void 0?e:[])}}serializeNode(e){var s;return(s=Td(e))===null||s===void 0||(s=s.serialize)===null||s===void 0?void 0:s.bind({editor:this.editor,options:e.options})}serializeMark(e){var s;const n=(s=Td(e))===null||s===void 0?void 0:s.serialize;return n?{...n,open:typeof n.open=="function"?n.open.bind({editor:this.editor,options:e.options}):n.open,close:typeof n.close=="function"?n.close.bind({editor:this.editor,options:e.options}):n.close}:null}}class nW{constructor(e,s){Ad(this,"editor",null),Ad(this,"md",null);let{html:n,linkify:i,breaks:a}=s;this.editor=e,this.md=this.withPatchedRenderer(ks({html:n,linkify:i,breaks:a}))}parse(e){let{inline:s}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){this.editor.extensionManager.extensions.forEach(a=>{var o;return(o=Td(a))===null||o===void 0||(o=o.parse)===null||o===void 0||(o=o.setup)===null||o===void 0?void 0:o.call({editor:this.editor,options:a.options},this.md)});const n=this.md.render(e),i=Dg(n);return this.editor.extensionManager.extensions.forEach(a=>{var o;return(o=Td(a))===null||o===void 0||(o=o.parse)===null||o===void 0||(o=o.updateDOM)===null||o===void 0?void 0:o.call({editor:this.editor,options:a.options},i)}),this.normalizeDOM(i,{inline:s,content:e}),i.innerHTML}return e}normalizeDOM(e,s){let{inline:n,content:i}=s;return this.normalizeBlocks(e),e.querySelectorAll("*").forEach(a=>{var o;((o=a.nextSibling)===null||o===void 0?void 0:o.nodeType)===Node.TEXT_NODE&&!a.closest("pre")&&(a.nextSibling.textContent=a.nextSibling.textContent.replace(/^\n/,""))}),n&&this.normalizeInline(e,i),e}normalizeBlocks(e){const n=Object.values(this.editor.schema.nodes).filter(i=>i.isBlock).map(i=>{var a;return(a=i.spec.parseDOM)===null||a===void 0?void 0:a.map(o=>o.tag)}).flat().filter(Boolean).join(",");n&&[...e.querySelectorAll(n)].forEach(i=>{i.parentElement.matches("p")&&fU(i)})}normalizeInline(e,s){var n;if((n=e.firstElementChild)!==null&&n!==void 0&&n.matches("p")){var i,a,o,l;const c=e.firstElementChild,{nextElementSibling:u}=c,d=(i=(a=s.match(/^\s+/))===null||a===void 0?void 0:a[0])!==null&&i!==void 0?i:"",h=u?"":(o=(l=s.match(/\s+$/))===null||l===void 0?void 0:l[0])!==null&&o!==void 0?o:"";if(s.match(/^\n\n/)){c.innerHTML=`${c.innerHTML}${h}`;return}mU(c),e.innerHTML=`${d}${e.innerHTML}${h}`}}withPatchedRenderer(e){const s=n=>function(){const i=n(...arguments);return i===`
`?i:i[i.length-1]===`
`?i.slice(0,-1):i};return e.renderer.rules.hardbreak=s(e.renderer.rules.hardbreak),e.renderer.rules.softbreak=s(e.renderer.rules.softbreak),e.renderer.rules.fence=s(e.renderer.rules.fence),e.renderer.rules.code_block=s(e.renderer.rules.code_block),e.renderer.renderToken=s(e.renderer.renderToken.bind(e.renderer)),e}}const rW=qe.create({name:"markdownClipboard",addOptions(){return{transformPastedText:!1,transformCopiedText:!1}},addProseMirrorPlugins(){return[new $e({key:new ct("markdownClipboard"),props:{clipboardTextParser:(t,e,s)=>{if(s||!this.options.transformPastedText)return null;const n=this.editor.storage.markdown.parser.parse(t,{inline:!0});return ir.fromSchema(this.editor.schema).parseSlice(Dg(n),{preserveWhitespace:!0,context:e})},clipboardTextSerializer:t=>this.options.transformCopiedText?this.editor.storage.markdown.serializer.serialize(t.content):null}})]}}),iW=qe.create({name:"markdown",priority:50,addOptions(){return{html:!0,tightLists:!0,tightListClass:"tight",bulletListMarker:"-",linkify:!1,breaks:!1,transformPastedText:!1,transformCopiedText:!1}},addCommands(){const t=US.Commands.config.addCommands();return{setContent:(e,s)=>n=>t.setContent(n.editor.storage.markdown.parser.parse(e),s)(n),insertContentAt:(e,s,n)=>i=>t.insertContentAt(e,i.editor.storage.markdown.parser.parse(s,{inline:!0}),n)(i)}},onBeforeCreate(){this.editor.storage.markdown={options:{...this.options},parser:new nW(this.editor,this.options),serializer:new sW(this.editor),getMarkdown:()=>this.editor.storage.markdown.serializer.serialize(this.editor.state.doc)},this.editor.options.initialContent=this.editor.options.content,this.editor.options.content=this.editor.storage.markdown.parser.parse(this.editor.options.content)},onCreate(){this.editor.options.content=this.editor.options.initialContent,delete this.editor.options.initialContent},addStorage(){return{}},addExtensions(){return[oU.configure({tight:this.options.tightLists,tightClass:this.options.tightListClass}),rW.configure({transformPastedText:this.options.transformPastedText,transformCopiedText:this.options.transformCopiedText})]}});function aW({editor:t}){if(!t)return null;const e=()=>t.chain().focus();return r.jsxs("div",{className:"flex flex-wrap items-center gap-1 border-b bg-muted/30 px-2 py-1",children:[r.jsx(D,{type:"button",size:"sm",variant:t.isActive("bold")?"secondary":"ghost",onClick:()=>e().toggleBold().run(),title:"Pogrubienie (Ctrl/Cmd+B)",children:r.jsx(A_,{className:"w-4 h-4"})}),r.jsx(D,{type:"button",size:"sm",variant:t.isActive("italic")?"secondary":"ghost",onClick:()=>e().toggleItalic().run(),title:"Kursywa (Ctrl/Cmd+I)",children:r.jsx(T_,{className:"w-4 h-4"})}),r.jsx(D,{type:"button",size:"sm",variant:t.isActive("underline")?"secondary":"ghost",onClick:()=>e().toggleUnderline().run(),title:"Podkreślenie",children:r.jsx(E_,{className:"w-4 h-4"})}),r.jsx("div",{className:"mx-1 h-5 w-px bg-border"}),r.jsx(D,{type:"button",size:"sm",variant:t.isActive("heading",{level:2})?"secondary":"ghost",onClick:()=>e().toggleHeading({level:2}).run(),title:"Nagłówek H2",children:r.jsx(D_,{className:"w-4 h-4"})}),r.jsx(D,{type:"button",size:"sm",variant:t.isActive("heading",{level:3})?"secondary":"ghost",onClick:()=>e().toggleHeading({level:3}).run(),title:"Nagłówek H3",children:r.jsx(M_,{className:"w-4 h-4"})}),r.jsx("div",{className:"mx-1 h-5 w-px bg-border"}),r.jsx(D,{type:"button",size:"sm",variant:t.isActive("bulletList")?"secondary":"ghost",onClick:()=>e().toggleBulletList().run(),title:"Lista punktowana",children:r.jsx(P_,{className:"w-4 h-4"})}),r.jsx(D,{type:"button",size:"sm",variant:t.isActive("orderedList")?"secondary":"ghost",onClick:()=>e().toggleOrderedList().run(),title:"Lista numerowana",children:r.jsx(I_,{className:"w-4 h-4"})}),r.jsx("div",{className:"mx-1 h-5 w-px bg-border"}),r.jsx(D,{type:"button",size:"sm",variant:"ghost",onClick:()=>{const s=window.prompt("Adres URL:");s&&e().setLink({href:s}).run()},title:"Wstaw link",children:r.jsx(O_,{className:"w-4 h-4"})}),r.jsx(D,{type:"button",size:"sm",variant:t.isActive("codeBlock")?"secondary":"ghost",onClick:()=>e().toggleCodeBlock().run(),title:"Blok kodu",children:r.jsx(R_,{className:"w-4 h-4"})}),r.jsx("div",{className:"mx-1 h-5 w-px bg-border"}),r.jsx(D,{type:"button",size:"sm",variant:"ghost",onClick:()=>t.commands.undo(),title:"Cofnij",children:r.jsx(Qp,{className:"w-4 h-4"})})]})}function oW({editor:t}){const[,e]=j.useState(0);if(j.useEffect(()=>{if(!t)return;const a=()=>e(o=>o+1);return t.on("selectionUpdate",a),t.on("transaction",a),()=>{t.off("selectionUpdate",a),t.off("transaction",a)}},[t]),!t)return null;const s=t.isActive("table"),n=()=>t.chain().focus(),i=t.can().chain().focus();return r.jsxs("div",{className:"flex flex-wrap items-center gap-2 border rounded-lg px-2 py-1 bg-muted/30",children:[r.jsxs(D,{type:"button",size:"sm",variant:"outline",title:"Wstaw tabelę 2×2",onClick:()=>n().insertTable({rows:2,cols:2,withHeaderRow:!0}).run(),children:[r.jsx(L_,{className:"w-4 h-4 mr-1"}),"Wstaw tabelę"]}),s&&r.jsxs(r.Fragment,{children:[r.jsxs(D,{type:"button",size:"sm",variant:"ghost",title:"Usuń tabelę",disabled:!i.deleteTable().run(),onClick:()=>n().deleteTable().run(),children:[r.jsx(St,{className:"w-4 h-4 mr-1"}),"Usuń tabelę"]}),r.jsx("div",{className:"mx-2 h-5 w-px bg-border"}),r.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[r.jsx(F_,{className:"w-3.5 h-3.5"})," Kolumna:"]}),r.jsxs(D,{type:"button",size:"sm",variant:"ghost",title:"Dodaj kolumnę (za bieżącą)",disabled:!i.addColumnAfter().run(),onClick:()=>n().addColumnAfter().run(),children:[r.jsx(Je,{className:"w-4 h-4 mr-1"})," Dodaj"]}),r.jsxs(D,{type:"button",size:"sm",variant:"ghost",title:"Usuń bieżącą kolumnę",disabled:!i.deleteColumn().run(),onClick:()=>n().deleteColumn().run(),children:[r.jsx(ku,{className:"w-4 h-4 mr-1"})," Usuń"]}),r.jsx("div",{className:"mx-2 h-5 w-px bg-border"}),r.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[r.jsx($_,{className:"w-3.5 h-3.5"})," Wiersz:"]}),r.jsxs(D,{type:"button",size:"sm",variant:"ghost",title:"Dodaj wiersz (poniżej bieżącego)",disabled:!i.addRowAfter().run(),onClick:()=>n().addRowAfter().run(),children:[r.jsx(Je,{className:"w-4 h-4 mr-1"})," Dodaj"]}),r.jsxs(D,{type:"button",size:"sm",variant:"ghost",title:"Usuń bieżący wiersz",disabled:!i.deleteRow().run(),onClick:()=>n().deleteRow().run(),children:[r.jsx(ku,{className:"w-4 h-4 mr-1"})," Usuń"]})]})]})}function lW({editor:t}){return t?r.jsx(D,{type:"button",size:"sm",variant:"outline",className:"h-7",onClick:()=>{const e=(t.storage.markdown.getMarkdown()||"").trim(),s=(e?e+`

`:"")+"```quiz\n# Tu wstaw pytanie/odpowiedzi przez generator lub ręcznie\n```";t.commands.setContent(s,{emitUpdate:!0})},title:"Wstaw blok quizu (```quiz)",children:"Wstaw quiz"}):null}const cW=`Wpisz treść…

- Lista punktowana
1. Lista numerowana

| Kolumna | Kolumna |
|--------|---------|
| Wartość | Wartość |`,uW=qe.create({name:"activeTableHighlight",addProseMirrorPlugins(){return[new $e({props:{decorations(t){const{$from:e}=t.selection;for(let s=e.depth;s>=0;s--){const n=e.node(s);if(n.type.name==="table"){const i=e.before(s),a=kt.node(i,i+n.nodeSize,{class:"is-active-table"},{inclusiveStart:!0,inclusiveEnd:!0});return Ie.create(t.doc,[a])}}return null}}})]}});function dW({value:t,onChange:e,placeholder:s="Zacznij pisać…",minHeightClass:n="min-h-[240px]"}){const i=k9({extensions:[iB,P$,b$.configure({openOnClick:!1,autolink:!0}),aB.configure({placeholder:s}),qC.configure({resizable:!1}),BC,$C,FC,iW.configure({html:!1,transformPastedText:!0}),uW],content:t&&t.trim().length?t:cW,editorProps:{attributes:{class:`prose prose-sm max-w-none dark:prose-invert ${n} p-4 outline-none`}},onUpdate:({editor:o})=>{const l=o.storage?.markdown?.getMarkdown?.()??"";e(l)}});if(!i)return null;const a=i.storage?.markdown?.getMarkdown?.()?.length??(t||"").length;return r.jsxs("div",{className:"rounded-xl overflow-hidden border border-border bg-background",children:[r.jsx(aW,{editor:i}),r.jsx(x9,{editor:i}),r.jsx("div",{className:"border-t",children:r.jsxs("div",{className:"flex flex-col gap-2 p-2",children:[r.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[r.jsx(lW,{editor:i}),r.jsx("div",{className:"grow"}),r.jsxs("span",{className:"text-xs text-muted-foreground",children:[a," znaków"]})]}),r.jsx(oW,{editor:i})]})}),r.jsx("style",{children:`
        /* Jedna siatka (bez podwójnych linii) */
        .ProseMirror table {
          border-collapse: collapse !important;
          width: 100%;
        }
        /* Bazowe cienkie, szare obramowania */
        .ProseMirror table td,
        .ProseMirror table th {
          border: 1px solid #D1D5DB !important; /* gray-300 */
          padding: 6px 8px;
        }
        /* Aktywna tabela: przerywane, ciemniejsze szarości */
        .ProseMirror table.is-active-table td,
        .ProseMirror table.is-active-table th {
          border-style: dashed !important;
          border-color: #6B7280 !important; /* gray-500 */
        }
        /* Zaznaczone komórki: subtelne tło + ciemniejsza kreska */
        .ProseMirror td.selectedCell,
        .ProseMirror th.selectedCell {
          background: #F3F4F6 !important;   /* gray-100 */
          border-color: #4B5563 !important;  /* gray-600 */
          border-style: dashed !important;
        }
      `})]})}const hW=["Cele lekcji","Kluczowe pojęcia","Szczegółowe omówienie","Przykłady z życia","Częste błędy i pułapki","Podsumowanie"],fW=`Wpisz treść…

- Lista punktowana
1. Lista numerowana

| Kolumna | Kolumna |
|--------|---------|
| Wartość | Wartość |`,mW=t=>!t||!t.trim()?hW.map((s,n)=>({id:`section-${n}`,title:s,content:"",hasQuiz:!1})):t.split(/\n(?=##\s+)/g).map((s,n)=>{const i=s.match(/^##\s+(.+?)$/m),a=i?i[1].trim():`Sekcja ${n+1}`,o=s.replace(/^##\s+.+?\n/,"").trim(),l=/```quiz[\s\S]*?```/g.test(o);return{id:`section-${n}`,title:a,content:o,hasQuiz:l}}),pW=t=>t.filter(e=>e.title.trim()&&(e.content.trim()||e.hasQuiz)).map(e=>`## ${e.title}

${e.content.trim()}`).join(`

`),jz=({value:t,onChange:e,label:s,error:n,required:i,hint:a})=>{const[o,l]=j.useState([]),[c,u]=j.useState({}),[d,h]=j.useState({});j.useEffect(()=>{const S=mW(t);l(S);const z={},N={};S.forEach(k=>{z[k.id]=!0,N[k.id]="wysiwyg"}),u(z),h(N)},[t]);const f=S=>{l(S),e(pW(S))},m=(S,z)=>{const N=[...o];N[S]={...N[S],content:z,hasQuiz:/```quiz[\s\S]*?```/g.test(z)},f(N)},p=(S,z)=>{const N=[...o];N[S]={...N[S],title:z},f(N)},x=(S=null)=>{const z=S===null?o.length:S+1,N={id:`section-${Date.now()}`,title:`Sekcja ${o.length+1}`,content:"",hasQuiz:!1},k=[...o.slice(0,z),N,...o.slice(z)];f(k),u(C=>({...C,[N.id]:!0})),h(C=>({...C,[N.id]:"wysiwyg"}))},g=S=>{const z=o[S],N={...z,id:`section-${Date.now()}`},k=[...o.slice(0,S+1),N,...o.slice(S+1)];f(k),u(C=>({...C,[N.id]:!0})),h(C=>({...C,[N.id]:d[z.id]||"wysiwyg"}))},y=S=>f(o.filter((z,N)=>N!==S)),b=(S,z)=>{const N=S+z;if(N<0||N>=o.length)return;const k=[...o];[k[S],k[N]]=[k[N],k[S]],f(k)},w=S=>u(Object.fromEntries(o.map(z=>[z.id,S])));return r.jsxs("div",{className:"space-y-3",children:[s&&r.jsxs("label",{className:"text-sm font-medium",children:[s,i&&r.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),a&&r.jsx("p",{className:"text-xs text-muted-foreground",children:a}),r.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-2",children:[r.jsxs(D,{type:"button",size:"sm",onClick:()=>x(null),children:[r.jsx(Je,{className:"w-4 h-4 mr-1"}),"Dodaj sekcję"]}),r.jsxs(D,{type:"button",size:"sm",variant:"outline",onClick:()=>w(!0),children:[r.jsx(ls,{className:"w-4 h-4 mr-1"}),"Rozwiń wszystkie"]}),r.jsxs(D,{type:"button",size:"sm",variant:"outline",onClick:()=>w(!1),children:[r.jsx(Ua,{className:"w-4 h-4 mr-1"}),"Zwiń wszystkie"]})]}),r.jsx("div",{className:"space-y-4",children:o.map((S,z)=>{const N=d[S.id]||"wysiwyg";return r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between gap-2 mt-12 pt-3 border-t border-t-2",children:[r.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[r.jsx(D,{type:"button",variant:"ghost",size:"sm",onClick:()=>u(k=>({...k,[S.id]:!k[S.id]})),className:"h-8 w-8 p-0 shrink-0",title:c[S.id]?"Zwiń sekcję":"Rozwiń sekcję",children:c[S.id]?r.jsx(Ua,{className:"h-4 w-4"}):r.jsx(ls,{className:"h-4 w-4"})}),r.jsx(te,{type:"text",value:S.title,onChange:k=>p(z,k.target.value),className:"h-8 font-semibold",placeholder:"Tytuł sekcji",onKeyDown:k=>k.key==="Enter"&&k.preventDefault()})]}),r.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[S.hasQuiz&&r.jsx(V,{variant:"secondary",className:"text-xs",children:"Quiz"}),r.jsxs(V,{variant:"outline",className:"text-xs",children:[z+1,"/",o.length]}),r.jsx(D,{type:"button",variant:"ghost",size:"sm",onClick:()=>b(z,-1),disabled:z===0,title:"Przenieś w górę",children:r.jsx(B_,{className:"w-4 h-4"})}),r.jsx(D,{type:"button",variant:"ghost",size:"sm",onClick:()=>b(z,1),disabled:z===o.length-1,title:"Przenieś w dół",children:r.jsx(q_,{className:"w-4 h-4"})}),r.jsx(D,{type:"button",variant:"ghost",size:"sm",onClick:()=>g(z),title:"Duplikuj sekcję",children:r.jsx(V_,{className:"w-4 h-4"})}),r.jsx(D,{type:"button",variant:"ghost",size:"sm",onClick:()=>x(z),title:"Dodaj sekcję poniżej",children:r.jsx(Je,{className:"w-4 h-4"})}),r.jsx(D,{type:"button",variant:"ghost",size:"sm",onClick:()=>y(z),title:"Usuń sekcję",children:r.jsx(St,{className:"w-4 h-4"})}),r.jsxs(D,{type:"button",variant:N==="wysiwyg"?"secondary":"ghost",size:"sm",className:"h-8",onClick:()=>h(k=>({...k,[S.id]:"wysiwyg"})),title:"Tryb WYSIWYG",children:[r.jsx(Tt,{className:"h-4 w-4 mr-1"}),"WYSIWYG"]}),r.jsxs(D,{type:"button",variant:N==="markdown"?"secondary":"ghost",size:"sm",className:"h-8",onClick:()=>h(k=>({...k,[S.id]:"markdown"})),title:"Tryb Markdown",children:[r.jsx(U_,{className:"h-4 w-4 mr-1"}),"Markdown"]})]})]}),c[S.id]&&r.jsx("div",{className:"rounded-xl border border-border shadow-sm bg-background",children:N==="wysiwyg"?r.jsx(dW,{value:S.content,onChange:k=>m(z,k),placeholder:"Zacznij pisać…"}):r.jsx(mn,{value:S.content,onChange:k=>m(z,k.target.value),className:"font-mono text-sm min-h-[240px] rounded-none border-0",placeholder:fW})})]},S.id)})}),n&&r.jsx("p",{className:"text-xs text-red-500 mt-1",children:n})]})},xW=()=>{const{show:t}=Yt(),e=pe(),[s]=Fd(),n=s.get("topic_id"),{data:i}=tt({resource:"topics",id:n,meta:{select:"*, courses(*)"},queryOptions:{enabled:!!n}}),{data:a,isLoading:o}=Y({resource:"activities",filters:[{field:"topic_id",operator:"eq",value:n}],sorters:[{field:"position",order:"desc"}],pagination:{pageSize:1},queryOptions:{enabled:!!n}}),{refineCore:{onFinish:l},register:c,handleSubmit:u,setValue:d,watch:h,formState:{errors:f,isSubmitting:m}}=ni({defaultValues:{topic_id:n?parseInt(n):void 0,type:"material",is_published:!1,position:1,passing_score:70},refineCoreProps:{successNotification:!1,redirect:!1,onMutationSuccess:g=>{const y=i?.data?.course_id,b=g.data.type;if(G.success("Aktywność została utworzona"),b==="quiz")G.info("Dodaj pytania do quizu"),e(`/teacher/questions/manage/${g.data.id}`);else{const w=sessionStorage.getItem("returnUrl");w?(sessionStorage.removeItem("returnUrl"),e(w)):e(y?`/teacher/courses/show/${y}?expanded=${n}`:"/teacher/courses")}}}}),p=h("type");j.useEffect(()=>{if(!o&&a&&a.data.length>0){const g=a.data[0].position+1;d("position",g)}},[a,o,d]);const x=()=>{const g=sessionStorage.getItem("returnUrl");g?(sessionStorage.removeItem("returnUrl"),e(g)):i?.data?.course_id?e(`/teacher/courses/show/${i.data.course_id}?expanded=${n}`):e("/teacher/courses")};return n?r.jsxs(X,{children:[r.jsx(Fi,{}),r.jsx(he,{children:r.jsx(je,{title:"Dodaj aktywność",description:i?.data?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"block text-lg",children:i.data.courses?.title}),r.jsxs("span",{className:"block text-sm text-muted-foreground",children:["Temat ",i.data.position,": ",i.data.title]})]}):"Utwórz nowy materiał lub quiz"})}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Informacje o aktywności"})}),r.jsx(I,{children:r.jsxs(oi,{onSubmit:u(l),children:[r.jsx("input",{type:"hidden",...c("topic_id")}),r.jsxs(Pt,{variant:"1-2-2",children:[r.jsx(ye,{label:"Typ aktywności",error:f.type?.message,required:!0,children:r.jsxs(Ee,{value:p,onValueChange:g=>d("type",g),children:[r.jsx(_e,{children:r.jsx(De,{placeholder:"Wybierz typ"})}),r.jsxs(Ae,{children:[r.jsx(ee,{value:"material",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(cs,{className:"w-4 h-4"}),"Materiał"]})}),r.jsx(ee,{value:"quiz",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(dt,{className:"w-4 h-4"}),"Quiz"]})})]})]})}),r.jsx(ye,{label:"Tytuł",htmlFor:"title",error:f.title?.message,required:!0,children:r.jsx(te,{id:"title",placeholder:p==="quiz"?"np. Test wiedzy z rozdziału":"np. Wprowadzenie do tematu",...c("title",{required:"Tytuł jest wymagany",minLength:{value:3,message:"Tytuł musi mieć minimum 3 znaki"}})})}),r.jsx(ye,{label:"Pozycja w temacie",htmlFor:"position",error:f.position?.message,required:!0,children:r.jsx(te,{id:"position",type:"number",min:"1",disabled:!0,className:"bg-muted",...c("position",{required:"Pozycja jest wymagana",min:{value:1,message:"Pozycja musi być większa od 0"},valueAsNumber:!0})})}),r.jsx(ye,{label:"Czas trwania (min)",htmlFor:"duration_min",hint:"Szacowany czas potrzebny na ukończenie",children:r.jsx(te,{id:"duration_min",type:"number",min:"1",placeholder:"np. 15",...c("duration_min",{min:{value:1,message:"Czas musi być większy od 0"},valueAsNumber:!0})})})]}),p==="material"&&r.jsxs(r.Fragment,{children:[r.jsx(jz,{value:h("content")||"",onChange:g=>d("content",g),label:"Treść materiału",error:f.content?.message,required:!0,hint:"Edytuj każdą sekcję osobno. Kliknij ikonę oka aby zobaczyć podgląd, kliknij kod aby wrócić do edycji."}),r.jsx(P,{className:"bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800",children:r.jsxs(I,{className:"pt-6",children:[r.jsx("p",{className:"text-sm",children:r.jsx("strong",{className:"text-blue-700 dark:text-blue-300",children:"Wskazówka dla nauczycieli:"})}),r.jsxs("ul",{className:"text-sm text-blue-600 dark:text-blue-400 mt-2 ml-4 space-y-1",children:[r.jsx("li",{children:"Materiał składa się z 6 sekcji"}),r.jsx("li",{children:"Każda sekcja ma własny edytor - rozwiń/zwiń przyciskiem strzałki"}),r.jsx("li",{children:"Używaj Markdown: **pogrubienie**, *kursywa*, listy, tabele"}),r.jsx("li",{children:"Pytania kontrolne dodajesz przez generator (krok 4) w formacie ```quiz"}),r.jsx("li",{children:"Uczniowie muszą odpowiedzieć na pytania aby odhaczyć sekcję"})]})]})})]}),p==="quiz"&&r.jsxs(r.Fragment,{children:[r.jsxs(Pt,{variant:"1-1-1",children:[r.jsx(ye,{label:"Próg zaliczenia (%)",htmlFor:"passing_score",error:f.passing_score?.message,hint:"Minimalny wynik do zaliczenia",children:r.jsx(te,{id:"passing_score",type:"number",min:"0",max:"100",...c("passing_score",{min:{value:0,message:"Wartość minimalna to 0"},max:{value:100,message:"Wartość maksymalna to 100"},valueAsNumber:!0})})}),r.jsx(ye,{label:"Limit czasu (min)",htmlFor:"time_limit",hint:"Pozostaw puste dla braku limitu",children:r.jsx(te,{id:"time_limit",type:"number",min:"1",placeholder:"Brak limitu",...c("time_limit",{min:{value:1,message:"Limit musi być większy od 0"},valueAsNumber:!0})})}),r.jsx(ye,{label:"Maksymalna liczba prób",htmlFor:"max_attempts",hint:"Pozostaw puste dla nieograniczonej liczby",children:r.jsx(te,{id:"max_attempts",type:"number",min:"1",placeholder:"Bez limitu",...c("max_attempts",{min:{value:1,message:"Minimum 1 próba"},valueAsNumber:!0})})})]}),r.jsx("div",{className:"mt-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg border border-blue-200 dark:border-blue-800",children:r.jsxs("p",{className:"text-sm",children:[r.jsx("strong",{className:"text-blue-700 dark:text-blue-300",children:"Wskazówka:"})," ",r.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:"Po utworzeniu quizu zostaniesz przekierowany do ekranu dodawania pytań."})]})})]}),r.jsx(ye,{label:"Status publikacji",children:r.jsxs(he,{variant:"start",children:[r.jsx(fs,{checked:h("is_published")||!1,onCheckedChange:g=>d("is_published",g)}),r.jsx("span",{className:"text-sm text-muted-foreground",children:"Opublikuj aktywność od razu (uczniowie będą mogli ją zobaczyć)"})]})}),r.jsxs(li,{children:[r.jsx(D,{type:"button",variant:"outline",onClick:x,disabled:m,children:"Anuluj"}),r.jsx(D,{type:"submit",disabled:m||!n,children:m?"Tworzenie...":p==="quiz"?"Utwórz i dodaj pytania":"Utwórz aktywność"})]})]})})]})]}):r.jsx(X,{children:r.jsx(P,{children:r.jsxs(I,{className:"text-center py-12",children:[r.jsx("p",{className:"text-lg font-medium text-muted-foreground mb-4",children:"Nie wybrano tematu"}),r.jsx(D,{onClick:()=>e("/teacher/courses"),children:"Przejdź do kursów"})]})})})},gW=()=>{const{list:t}=Yt(),{id:e}=Qt(),s=pe(),{data:n,isLoading:i}=tt({resource:"activities",id:e,liveMode:"off",meta:{select:"*, topics(*, courses(*))"}}),{data:a}=tt({resource:"questions",id:e,meta:{select:"count",filter:`activity_id.eq.${e}`},queryOptions:{enabled:!!e&&n?.data?.type==="quiz"}}),{refineCore:{onFinish:o,formLoading:l},register:c,handleSubmit:u,setValue:d,watch:h,reset:f,formState:{errors:m,isSubmitting:p}}=ni({refineCoreProps:{resource:"activities",id:e,liveMode:"off",redirect:!1,successNotification:!1,onMutationSuccess:()=>{const T=n?.data?.topics?.course_id,v=n?.data?.topic_id;G.success("Aktywność została zaktualizowana");const _=sessionStorage.getItem("returnUrl");_?(sessionStorage.removeItem("returnUrl"),s(_)):T?s(`/teacher/courses/show/${T}?expanded=${v}`):t("activities")},onMutationError:T=>{console.error("Błąd podczas aktualizacji:",T),T?.code==="PGRST204"?G.error("Błąd konfiguracji - skontaktuj się z administratorem"):T?.code==="23505"?G.error("Aktywność o tej pozycji już istnieje w tym temacie"):T?.code==="23503"?G.error("Nieprawidłowe powiązanie z tematem"):T?.message?G.error(`Błąd: ${T.message}`):G.error("Wystąpił nieoczekiwany błąd. Spróbuj ponownie.")}}});j.useEffect(()=>{if(n?.data){const{topics:T,_count:v,questions:_,...A}=n.data;f(A)}},[n,f]);const x=h("type")||n?.data?.type||"material";if(i||l)return r.jsx(X,{children:r.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const g=n?.data,y=g?.topics,b=y?.courses,w=b?.id,S=g?.topic_id,z=()=>{const T=sessionStorage.getItem("returnUrl");T?(sessionStorage.removeItem("returnUrl"),s(T)):w?s(`/teacher/courses/show/${w}?expanded=${S}`):t("activities")},N=()=>x==="quiz"?r.jsx(dt,{className:"w-6 h-6 text-blue-500"}):r.jsx(cs,{className:"w-6 h-6 text-green-500"}),k=()=>{const T=window.location.pathname+window.location.search;sessionStorage.setItem("returnUrl",T),s(`/teacher/questions/manage/${g?.id}`)},C=a?.data?.[0]?.count||0;return r.jsxs(X,{children:[r.jsx(Fi,{}),r.jsxs(he,{children:[r.jsx(je,{title:r.jsxs("div",{className:"flex items-center gap-2",children:[N(),"Edytuj aktywność"]}),description:r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"block text-lg font-medium",children:g?.title}),r.jsxs("span",{className:"block text-sm text-muted-foreground",children:[b?.title," → Temat ",y?.position,": ",y?.title]})]})}),x==="quiz"&&r.jsxs(D,{onClick:k,variant:"outline",children:[r.jsx(qr,{className:"w-4 h-4 mr-2"}),"Zarządzaj pytaniami (",C,")"]})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Informacje o aktywności"})}),r.jsx(I,{children:r.jsxs(oi,{onSubmit:u(o),children:[r.jsxs(Pt,{variant:"1-2-2",children:[r.jsxs(ye,{label:"Typ aktywności",error:m.type?.message,required:!0,children:[r.jsxs(Ee,{value:x,disabled:!0,children:[r.jsx(_e,{className:"bg-muted",children:r.jsx(De,{placeholder:"Wybierz typ"})}),r.jsxs(Ae,{children:[r.jsx(ee,{value:"material",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(cs,{className:"w-4 h-4"}),"Materiał"]})}),r.jsx(ee,{value:"quiz",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(dt,{className:"w-4 h-4"}),"Quiz"]})})]})]}),r.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Typ aktywności nie może być zmieniony"})]}),r.jsx(ye,{label:"Tytuł",htmlFor:"title",error:m.title?.message,required:!0,children:r.jsx(te,{id:"title",placeholder:x==="quiz"?"np. Test wiedzy":"np. Wprowadzenie",...c("title",{required:"Tytuł jest wymagany",minLength:{value:3,message:"Tytuł musi mieć minimum 3 znaki"}})})}),r.jsx(ye,{label:"Pozycja w temacie",htmlFor:"position",error:m.position?.message,required:!0,children:r.jsx(te,{id:"position",type:"number",min:"1",...c("position",{required:"Pozycja jest wymagana",min:{value:1,message:"Pozycja musi być większa od 0"},valueAsNumber:!0})})}),r.jsx(ye,{label:"Czas trwania (min)",htmlFor:"duration_min",hint:"Szacowany czas potrzebny na ukończenie",children:r.jsx(te,{id:"duration_min",type:"number",min:"1",placeholder:"np. 15",...c("duration_min",{min:{value:1,message:"Czas musi być większy od 0"},valueAsNumber:!0})})})]}),x==="material"&&r.jsx(jz,{value:h("content")||"",onChange:T=>d("content",T),label:"Treść materiału",error:m.content?.message,required:!0,hint:"Edytuj sekcje w trybie WYSIWYG lub Markdown. Dodawaj/układaj sekcje przyciskami nad panelem."}),x==="quiz"&&r.jsxs(r.Fragment,{children:[r.jsxs(Pt,{variant:"1-1-1",children:[r.jsx(ye,{label:"Próg zaliczenia (%)",htmlFor:"passing_score",error:m.passing_score?.message,hint:"Minimalny wynik do zaliczenia",children:r.jsx(te,{id:"passing_score",type:"number",min:"0",max:"100",...c("passing_score",{min:{value:0,message:"Wartość minimalna to 0"},max:{value:100,message:"Wartość maksymalna to 100"},valueAsNumber:!0})})}),r.jsx(ye,{label:"Limit czasu (min)",htmlFor:"time_limit",hint:"Pozostaw puste dla braku limitu",children:r.jsx(te,{id:"time_limit",type:"number",min:"1",placeholder:"Brak limitu",...c("time_limit",{min:{value:1,message:"Limit musi być większy od 0"},valueAsNumber:!0})})}),r.jsx(ye,{label:"Maksymalna liczba prób",htmlFor:"max_attempts",hint:"Pozostaw puste dla nieograniczonej liczby",children:r.jsx(te,{id:"max_attempts",type:"number",min:"1",placeholder:"Bez limitu",...c("max_attempts",{min:{value:1,message:"Minimum 1 próba"},valueAsNumber:!0})})})]}),C>0&&r.jsx(P,{className:"mt-4 bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800",children:r.jsx(I,{className:"pt-6",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsxs("p",{className:"text-sm font-medium",children:["Ten quiz zawiera ",C," ",C===1?"pytanie":C<5?"pytania":"pytań"]}),r.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Możesz zarządzać pytaniami klikając przycisk powyżej"})]}),r.jsx(V,{variant:"outline",className:"text-lg px-3 py-1",children:C})]})})})]}),r.jsx(ye,{label:"Status publikacji",children:r.jsxs(he,{variant:"start",children:[r.jsx(fs,{checked:h("is_published")||!1,onCheckedChange:T=>d("is_published",T)}),r.jsx("span",{className:"text-sm text-muted-foreground",children:"Aktywność jest opublikowana (uczniowie mogą ją zobaczyć)"})]})}),r.jsxs(li,{children:[r.jsx(D,{type:"button",variant:"outline",onClick:z,disabled:p,children:"Anuluj"}),r.jsx(D,{type:"submit",disabled:p,children:p?"Zapisywanie...":"Zapisz zmiany"})]})]})})]})]})},yW=({duration_min:t,position:e,created_at:s,updated_at:n})=>r.jsxs("div",{className:"space-y-4",children:[t&&r.jsxs("div",{className:"space-y-1",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[r.jsx(Ze,{className:"w-4 h-4"}),r.jsx("span",{children:"Czas trwania"})]}),r.jsxs("p",{className:"text-base font-medium pl-6",children:[t," minut"]})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[r.jsx(O1,{className:"w-4 h-4"}),r.jsx("span",{children:"Pozycja w temacie"})]}),r.jsx("p",{className:"text-base font-medium pl-6",children:e})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[r.jsx(js,{className:"w-4 h-4"}),r.jsx("span",{children:"Data utworzenia"})]}),r.jsx("p",{className:"text-base font-medium pl-6",children:new Date(s).toLocaleDateString("pl-PL",{day:"2-digit",month:"long",year:"numeric"})})]}),n&&r.jsxs("div",{className:"space-y-1",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[r.jsx(js,{className:"w-4 h-4"}),r.jsx("span",{children:"Ostatnia aktualizacja"})]}),r.jsx("p",{className:"text-base font-medium pl-6",children:new Date(n).toLocaleDateString("pl-PL",{day:"2-digit",month:"long",year:"numeric"})})]})]}),bW=({activity:t})=>r.jsxs("div",{className:"grid gap-6 lg:grid-cols-[1fr,300px]",children:[r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Treść materiału"})}),r.jsx(I,{children:t.content?r.jsx(Xd,{content:t.content,showMetadata:!1,height:"600px"}):r.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[r.jsx(cs,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),r.jsx("p",{children:"Brak treści materiału"})]})})]}),r.jsxs(P,{children:[r.jsx(F,{className:"pb-3",children:r.jsx(L,{className:"text-base",children:"Informacje"})}),r.jsx(I,{children:r.jsx(yW,{duration_min:t.duration_min,position:t.position,created_at:t.created_at,updated_at:t.updated_at})})]})]}),jW=({activity:t,questionsCount:e,questionsData:s,questionsLoading:n,onNavigateToQuestions:i})=>{const a=s?.reduce((l,c)=>l+(c.points||0),0)||0,o=Math.ceil((t.passing_score||70)/100*a);return r.jsxs("div",{className:"space-y-6",children:[r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Parametry quizu"})}),r.jsx(I,{children:r.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[r.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(Ze,{className:"w-4 h-4 text-muted-foreground"}),r.jsx("span",{className:"text-sm text-muted-foreground",children:"Czas trwania"})]}),r.jsxs("p",{className:"text-2xl font-bold",children:[t.duration_min||"-"," min"]})]}),r.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(pt,{className:"w-4 h-4 text-muted-foreground"}),r.jsx("span",{className:"text-sm text-muted-foreground",children:"Próg zaliczenia"})]}),r.jsxs("p",{className:"text-2xl font-bold",children:[t.passing_score||70,"%"]})]}),r.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(W_,{className:"w-4 h-4 text-muted-foreground"}),r.jsx("span",{className:"text-sm text-muted-foreground",children:"Limit czasu"})]}),r.jsx("p",{className:"text-2xl font-bold",children:t.time_limit?`${t.time_limit} min`:"Brak"})]}),r.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(yl,{className:"w-4 h-4 text-muted-foreground"}),r.jsx("span",{className:"text-sm text-muted-foreground",children:"Liczba prób"})]}),r.jsx("p",{className:"text-2xl font-bold",children:t.max_attempts||"Bez limitu"})]})]})})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center justify-between",children:[r.jsxs("span",{children:["Pytania (",e,")"]}),e>0&&r.jsxs(D,{size:"sm",variant:"outline",onClick:()=>i(t.id),children:[r.jsx(Bn,{className:"w-3 h-3 mr-1"}),"Zarządzaj"]})]})}),r.jsx(I,{children:e===0?r.jsxs("div",{className:"text-center py-12",children:[r.jsx(dt,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground/30"}),r.jsx("p",{className:"text-lg font-medium text-muted-foreground mb-2",children:"Ten quiz nie ma jeszcze pytań"}),r.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"Dodaj pytania, aby uczniowie mogli rozwiązać quiz"}),r.jsxs(D,{onClick:()=>i(t.id),children:[r.jsx(Je,{className:"w-4 h-4 mr-2"}),"Dodaj pierwsze pytanie"]})]}):n?r.jsx("div",{className:"flex items-center justify-center py-8",children:r.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})}):r.jsx("div",{className:"space-y-2",children:s?.map((l,c)=>r.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg border bg-card hover:bg-muted/50 transition-colors",children:[r.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center text-sm font-semibold",children:c+1}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[l.type==="single_choice"&&r.jsxs(V,{variant:"outline",className:"text-xs",children:[r.jsx(ws,{className:"w-3 h-3 mr-1"}),"Jednokrotny wybór"]}),l.type==="multiple_choice"&&r.jsxs(V,{variant:"outline",className:"text-xs",children:[r.jsx(qr,{className:"w-3 h-3 mr-1"}),"Wielokrotny wybór"]}),l.type==="true_false"&&r.jsxs(V,{variant:"outline",className:"text-xs",children:[r.jsx(st,{className:"w-3 h-3 mr-1"}),"Prawda/Fałsz"]}),r.jsxs(V,{variant:"secondary",className:"text-xs",children:[l.points," pkt"]})]}),r.jsx("p",{className:"text-sm font-medium line-clamp-2",children:l.content}),l.explanation&&r.jsxs("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-1",children:[r.jsx("span",{className:"font-medium",children:"Wyjaśnienie:"})," ",l.explanation]})]})]},l.id))})})]}),r.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[r.jsxs(P,{children:[r.jsx(F,{className:"pb-3",children:r.jsx(L,{className:"text-base",children:"Statystyki"})}),r.jsx(I,{children:r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-sm text-muted-foreground",children:"Liczba pytań"}),r.jsx("span",{className:"font-medium",children:e})]}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-sm text-muted-foreground",children:"Maksymalna liczba punktów"}),r.jsx("span",{className:"font-medium",children:a})]}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-sm text-muted-foreground",children:"Wymagane punkty do zaliczenia"}),r.jsx("span",{className:"font-medium",children:o})]})]})})]}),r.jsxs(P,{children:[r.jsx(F,{className:"pb-3",children:r.jsx(L,{className:"text-base",children:"Informacje"})}),r.jsx(I,{children:r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-sm text-muted-foreground",children:"Pozycja w temacie"}),r.jsx("span",{className:"font-medium",children:t.position})]}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-sm text-muted-foreground",children:"Data utworzenia"}),r.jsx("span",{className:"font-medium",children:new Date(t.created_at).toLocaleDateString("pl-PL")})]}),t.updated_at&&r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-sm text-muted-foreground",children:"Ostatnia aktualizacja"}),r.jsx("span",{className:"font-medium",children:new Date(t.updated_at).toLocaleDateString("pl-PL")})]})]})})]})]})]})},wW=()=>{const{edit:t}=Yt(),{id:e}=Qt(),s=pe(),{data:n,isLoading:i}=tt({resource:"activities",id:e,meta:{select:"*, topics(*, courses(*)), questions:questions(count)"}}),{data:a,isLoading:o}=Y({resource:"questions",filters:[{field:"activity_id",operator:"eq",value:parseInt(e)}],sorters:[{field:"position",order:"asc"}],queryOptions:{enabled:n?.data?.type==="quiz"&&!!e}});if(i)return r.jsx(X,{children:r.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const l=n?.data;if(!l)return r.jsx(X,{children:r.jsx("div",{className:"text-center py-12",children:r.jsx("p",{className:"text-muted-foreground",children:"Nie znaleziono aktywności"})})});const c=l.topics,u=c?.courses,d=l.questions?.[0]?.count||l._count?.questions||0,h=()=>{const x=window.location.pathname+window.location.search;sessionStorage.setItem("returnUrl",x),t("activities",l.id??"")},f=x=>{const g=window.location.pathname+window.location.search;sessionStorage.setItem("returnUrl",g),s(x)},m=()=>l.type==="quiz"?r.jsx(dt,{className:"w-5 h-5"}):r.jsx(cs,{className:"w-5 h-5"}),p=()=>l.type==="quiz"?"text-blue-500":"text-green-500";return r.jsxs(X,{children:[r.jsx(Fi,{}),r.jsxs("div",{className:"mb-6",children:[r.jsxs("div",{className:"text-sm text-muted-foreground mb-2",children:[u?.title," → Temat ",c?.position,": ",c?.title]}),r.jsxs(he,{children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:`p-2 rounded-lg bg-muted ${p()}`,children:m()}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold",children:l.title}),r.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[r.jsx(V,{variant:l.type==="quiz"?"default":"secondary",children:l.type==="quiz"?"Quiz":"Materiał"}),r.jsx(V,{variant:l.is_published?"default":"outline",children:l.is_published?r.jsxs(r.Fragment,{children:[r.jsx(Tt,{className:"w-3 h-3 mr-1"})," Opublikowany"]}):r.jsxs(r.Fragment,{children:[r.jsx(ii,{className:"w-3 h-3 mr-1"})," Szkic"]})})]})]})]}),r.jsxs("div",{className:"flex gap-2",children:[l.type==="quiz"&&r.jsxs(D,{variant:"outline",onClick:()=>f(`/teacher/questions/manage/${l.id}`),children:[r.jsx(qr,{className:"w-4 h-4 mr-2"}),"Zarządzaj pytaniami (",d,")"]}),r.jsxs(D,{onClick:h,children:[r.jsx(Bn,{className:"w-4 h-4 mr-2"}),"Edytuj"]})]})]})]}),l.type==="material"?r.jsx(bW,{activity:l}):r.jsx(jW,{activity:l,questionsCount:d,questionsData:a?.data,questionsLoading:o,onNavigateToQuestions:x=>f(`/teacher/questions/manage/${x}`)})]})},Tj={name:"activities",list:"/teacher/activities/create",create:"/teacher/activities/create",edit:"/teacher/activities/edit/:id",show:"/teacher/activities/show/:id",meta:{hide:!0}},vW=[r.jsx(Z,{path:"activities/create",element:r.jsx(xW,{})},"activities-create"),r.jsx(Z,{path:"activities/edit/:id",element:r.jsx(gW,{})},"activities-edit"),r.jsx(Z,{path:"activities/show/:id",element:r.jsx(wW,{})},"activities-show")],kW=()=>{const{create:t,edit:e,show:s}=Yt(),n=pe(),{mutate:i}=lr(),{tableQuery:{data:a,isLoading:o,isError:l,refetch:c},current:u,setCurrent:d,pageSize:h,setFilters:f}=D1({sorters:{initial:[{field:"created_at",order:"desc"}]},meta:{select:"*, group_members(count), course_access(count)"}}),m=ex({isLoading:o,isError:l});if(m)return m;const p=(y,b)=>{confirm(`Czy na pewno chcesz usunąć grupę "${b}"? Ta akcja usunie również wszystkie przypisania uczniów i kursów.`)&&i({resource:"groups",id:y},{onSuccess:()=>{G.success("Grupa została usunięta"),c()},onError:()=>{G.error("Błąd podczas usuwania grupy")}})},x=(y,b)=>{b?.stopPropagation(),n(`/teacher/groups/${y}/assign-students`)},g=y=>!y||!Array.isArray(y)||y.length===0?0:y[0].count||0;return r.jsxs(X,{children:[r.jsx(he,{children:r.jsx(je,{title:"Grupy",description:"Zarządzaj grupami uczniów i przypisuj im kursy"})}),r.jsx(he,{children:r.jsx(te,{placeholder:"Szukaj grup...",className:"max-w-sm",onChange:y=>{f([{field:"name",operator:"contains",value:y.target.value}])}})}),a?.data?.length===0?r.jsx(P,{className:"border-dashed border-2",children:r.jsxs(I,{className:"text-center py-12",children:[r.jsx(ge,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),r.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Brak grup"}),r.jsx("p",{className:"text-muted-foreground mb-6",children:"Utwórz pierwszą grupę, aby móc przypisywać uczniów do kursów"}),r.jsxs(D,{onClick:()=>t("groups"),children:[r.jsx(Je,{className:"w-4 h-4 mr-2"}),"Utwórz pierwszą grupę"]})]})}):r.jsx(Pt,{children:a?.data?.map(y=>{const b=g(y.group_members),w=g(y.course_access);return r.jsxs(P,{className:"cursor-pointer transition-all hover:shadow-lg hover:border-primary/50 relative overflow-hidden",onClick:S=>{!S.target.closest('[role="menu"]')&&!S.target.closest(".quick-action")&&s("groups",y.id)},children:[!y.is_active&&r.jsx("div",{className:"absolute inset-0 bg-muted/50 z-10 pointer-events-none"}),r.jsx(F,{children:r.jsxs(he,{children:[r.jsxs(L,{className:"flex items-center gap-2",children:[r.jsx(ge,{className:"w-5 h-5 text-primary"}),r.jsx("span",{className:"truncate",children:y.name})]}),r.jsxs(Qa,{children:[r.jsx(Ya,{asChild:!0,children:r.jsx(D,{variant:"ghost",size:"sm",onClick:S=>S.stopPropagation(),className:"relative z-20",children:r.jsx(Kd,{className:"h-4 w-4"})})}),r.jsxs(Li,{align:"end",children:[r.jsxs(We,{onClick:()=>s("groups",y.id),children:[r.jsx(Tt,{className:"mr-2 h-4 w-4"}),"Podgląd"]}),r.jsxs(We,{onClick:()=>e("groups",y.id),children:[r.jsx(Bn,{className:"mr-2 h-4 w-4"}),"Edytuj"]}),r.jsx(as,{}),r.jsxs(We,{onClick:S=>x(y.id,S),className:"text-blue-600 focus:text-blue-600",children:[r.jsx(Pi,{className:"mr-2 h-4 w-4"}),"Dodaj uczniów"]}),r.jsx(as,{}),r.jsxs(We,{onClick:()=>p(y.id,y.name),className:"text-red-600 focus:text-red-600",children:[r.jsx(St,{className:"mr-2 h-4 w-4"}),"Usuń"]})]})]})]})}),r.jsx(I,{children:r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[r.jsx(js,{className:"w-4 h-4"}),r.jsxs("span",{children:["Rok akademicki: ",y.academic_year]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[r.jsx("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"p-2 bg-background rounded-md",children:r.jsx(ge,{className:"w-4 h-4 text-blue-600"})}),r.jsxs("div",{children:[r.jsx("p",{className:"text-xs text-muted-foreground",children:"Uczniowie"}),r.jsx("p",{className:"text-lg font-semibold",children:b})]})]})}),r.jsx("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"p-2 bg-background rounded-md",children:r.jsx(Se,{className:"w-4 h-4 text-green-600"})}),r.jsxs("div",{children:[r.jsx("p",{className:"text-xs text-muted-foreground",children:"Kursy"}),r.jsx("p",{className:"text-lg font-semibold",children:w})]})]})})]}),r.jsxs("div",{className:"flex items-center justify-between pt-2",children:[r.jsx(V,{variant:y.is_active?"default":"secondary",className:y.is_active?"bg-green-600":"",children:y.is_active?"Aktywna":"Nieaktywna"}),r.jsx("div",{className:"flex gap-1",children:b===0&&r.jsx(D,{size:"sm",variant:"ghost",className:"h-8 px-2 quick-action text-blue-600 hover:text-blue-700 hover:bg-blue-50",onClick:S=>x(y.id,S),title:"Dodaj uczniów",children:r.jsx(Pi,{className:"h-4 w-4"})})})]})]})})]},y.id)})}),r.jsx(cv,{current:u,pageSize:h,total:a?.total||0,setCurrent:d,itemName:"grup"})]})},NW=()=>{const{list:t}=Yt(),{data:e}=wt(),{refineCore:{onFinish:s},register:n,handleSubmit:i,setValue:a,watch:o,formState:{errors:l,isSubmitting:c}}=ni({defaultValues:{name:"",vendor_id:e?.vendor_id||0,is_active:!0,academic_year:new Date().getFullYear().toString()+"/"+(new Date().getFullYear()+1).toString()}});return r.jsxs(X,{children:[r.jsxs(D,{variant:"outline",size:"sm",onClick:()=>t("groups"),children:[r.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),r.jsx(he,{children:r.jsx(je,{title:"Dodaj grupę",description:"Utwórz nową grupę uczniów"})}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Informacje o grupie"})}),r.jsx(I,{children:r.jsxs(oi,{onSubmit:i(s),children:[r.jsx(ye,{label:"Nazwa grupy",htmlFor:"name",error:l.name?.message?.toString(),required:!0,children:r.jsx(te,{id:"name",placeholder:"np. Klasa 1A",...n("name",{required:"Nazwa grupy jest wymagana",minLength:{value:2,message:"Nazwa musi mieć minimum 2 znaki"}})})}),r.jsx(ye,{label:"Rok akademicki",htmlFor:"academic_year",error:l.academic_year?.message?.toString(),required:!0,children:r.jsx(te,{id:"academic_year",placeholder:"np. 2024/2025",...n("academic_year",{required:"Rok akademicki jest wymagany",pattern:{value:/^\d{4}\/\d{4}$/,message:"Format: RRRR/RRRR (np. 2024/2025)"}})})}),r.jsx(ye,{label:"Status grupy",children:r.jsxs(he,{variant:"start",children:[r.jsx(fs,{checked:o("is_active"),onCheckedChange:u=>a("is_active",u)}),r.jsx("span",{className:"text-sm text-muted-foreground",children:"Grupa aktywna"})]})}),r.jsxs(li,{children:[r.jsx(D,{type:"button",variant:"outline",onClick:()=>t("groups"),children:"Anuluj"}),r.jsx(D,{type:"submit",disabled:c,children:c?"Tworzenie...":"Utwórz grupę"})]})]})})]})]})},SW=()=>{const{list:t}=Yt(),{id:e}=Qt(),{data:s,isLoading:n}=tt({resource:"groups",id:e,liveMode:"off"}),{refineCore:{onFinish:i},register:a,handleSubmit:o,setValue:l,watch:c,reset:u,formState:{errors:d,isSubmitting:h}}=ni({refineCoreProps:{resource:"groups",id:e,redirect:"list",liveMode:"off"}});return j.useEffect(()=>{s?.data&&u({name:s.data.name,academic_year:s.data.academic_year,is_active:s.data.is_active,vendor_id:s.data.vendor_id})},[s,u]),n?r.jsx(X,{children:r.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):r.jsxs(X,{children:[r.jsxs(D,{variant:"outline",size:"sm",onClick:()=>t("groups"),children:[r.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),r.jsx(he,{children:r.jsx(je,{title:"Edytuj grupę",description:`Edycja: ${s?.data?.name}`})}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Informacje o grupie"})}),r.jsx(I,{children:r.jsxs(oi,{onSubmit:o(i),children:[r.jsx(ye,{label:"Nazwa grupy",htmlFor:"name",error:d.name?.message,required:!0,children:r.jsx(te,{id:"name",placeholder:"np. Klasa 1A",...a("name",{required:"Nazwa grupy jest wymagana",minLength:{value:2,message:"Nazwa musi mieć minimum 2 znaki"}})})}),r.jsx(ye,{label:"Rok akademicki",htmlFor:"academic_year",error:d.academic_year?.message,required:!0,children:r.jsx(te,{id:"academic_year",placeholder:"np. 2024/2025",...a("academic_year",{required:"Rok akademicki jest wymagany",pattern:{value:/^\d{4}\/\d{4}$/,message:"Format: RRRR/RRRR (np. 2024/2025)"}})})}),r.jsx(ye,{label:"Status grupy",children:r.jsxs(he,{variant:"start",children:[r.jsx(fs,{checked:c("is_active"),onCheckedChange:f=>l("is_active",f)}),r.jsx("span",{className:"text-sm text-muted-foreground",children:"Grupa aktywna"})]})}),r.jsxs(li,{children:[r.jsx(D,{type:"button",variant:"outline",onClick:()=>t("groups"),children:"Anuluj"}),r.jsx(D,{type:"submit",disabled:h,children:h?"Zapisywanie...":"Zapisz zmiany"})]})]})})]})]})},CW=()=>{const{list:t,edit:e,show:s}=Yt(),{id:n}=Qt(),i=pe(),a=M1(),{data:o,isLoading:l}=tt({resource:"groups",id:n,liveMode:"off"}),{data:c,isLoading:u}=Y({resource:"group_members",filters:[{field:"group_id",operator:"eq",value:n}],meta:{select:"*, users(*)"},queryOptions:{enabled:!!n},liveMode:"off"}),{data:d,isLoading:h}=Y({resource:"course_access",filters:[{field:"group_id",operator:"eq",value:n}],meta:{select:"*, courses(*)"},queryOptions:{enabled:!!n},liveMode:"off"}),f=async(y,b)=>{if(confirm(`Czy na pewno chcesz odpiąć kurs "${b}" od tej grupy?`))try{const{error:w}=await oe.from("course_access").delete().eq("course_id",y).eq("group_id",parseInt(n));if(w)throw w;G.success("Kurs został odpięty od grupy"),a({resource:"course_access",invalidates:["list"]})}catch(w){console.error("Error removing course:",w),G.error("Błąd podczas odpinania kursu")}},m=async(y,b)=>{if(confirm(`Czy na pewno chcesz usunąć "${b}" z tej grupy?`))try{const{error:w}=await oe.from("group_members").delete().eq("user_id",y).eq("group_id",parseInt(n));if(w)throw w;G.success("Uczeń został usunięty z grupy"),a({resource:"group_members",invalidates:["list"]})}catch(w){console.error("Error removing member:",w),G.error("Błąd podczas usuwania ucznia z grupy")}};if(l||u||h)return r.jsx(X,{children:r.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const p=o?.data,x=c?.total||0,g=d?.total||0;return r.jsxs(X,{children:[r.jsxs(D,{variant:"outline",size:"sm",onClick:()=>t("groups"),children:[r.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),r.jsxs(he,{children:[r.jsxs("div",{children:[r.jsx(je,{title:p?.name,description:`Rok akademicki: ${p?.academic_year}`}),!p?.is_active&&r.jsx(V,{variant:"secondary",className:"mt-2",children:"Grupa nieaktywna"})]}),r.jsxs(D,{onClick:()=>e("groups",p?.id??""),children:[r.jsx(Bn,{className:"w-4 h-4 mr-2"}),"Edytuj grupę"]})]}),!p?.is_active&&r.jsxs(we,{children:[r.jsx(st,{className:"h-4 w-4"}),r.jsx(ve,{children:"Ta grupa jest nieaktywna. Uczniowie nie mają dostępu do przypisanych kursów."})]}),r.jsxs(Pt,{variant:"2-2-4",children:[r.jsxs(P,{children:[r.jsx(F,{className:"pb-2",children:r.jsx(L,{className:"text-sm font-medium",children:"Status"})}),r.jsx(I,{children:r.jsx(V,{variant:p?.is_active?"default":"secondary",className:p?.is_active?"bg-green-600":"",children:p?.is_active?"Aktywna":"Nieaktywna"})})]}),r.jsxs(P,{children:[r.jsx(F,{className:"pb-2",children:r.jsx(L,{className:"text-sm font-medium",children:"Uczniowie"})}),r.jsx(I,{children:r.jsx("div",{className:"text-2xl font-bold",children:x})})]}),r.jsxs(P,{children:[r.jsx(F,{className:"pb-2",children:r.jsx(L,{className:"text-sm font-medium",children:"Kursy"})}),r.jsx(I,{children:r.jsx("div",{className:"text-2xl font-bold",children:g})})]}),r.jsxs(P,{children:[r.jsx(F,{className:"pb-2",children:r.jsx(L,{className:"text-sm font-medium",children:"Utworzono"})}),r.jsx(I,{children:r.jsx("div",{className:"text-sm",children:new Date(p?.created_at).toLocaleDateString("pl-PL")})})]})]}),r.jsxs(Pt,{variant:"1-2-2",children:[r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(he,{children:[r.jsx(L,{children:"Uczniowie grupy"}),r.jsxs(D,{size:"sm",onClick:()=>i(`/teacher/groups/${n}/assign-students`),children:[r.jsx(Pi,{className:"w-4 h-4 mr-2"}),"Dodaj ucznia"]})]})}),r.jsx(I,{children:c?.data?.length?r.jsx("div",{className:"space-y-2",children:c.data.map(y=>r.jsx("div",{className:"p-4 border rounded-lg hover:bg-muted/30 transition-all duration-200 group cursor-pointer",onClick:()=>s("users",y.user_id),children:r.jsxs("div",{className:"flex items-start justify-between gap-4",children:[r.jsxs("div",{className:"flex gap-3 flex-1 min-w-0",children:[r.jsx("div",{className:"h-10 w-10 rounded-full bg-muted/50 flex items-center justify-center flex-shrink-0",children:r.jsx(ge,{className:"h-5 w-5 text-muted-foreground"})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("h4",{className:"font-medium text-base leading-tight truncate pr-2",children:y.users?.full_name}),r.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[r.jsx(qd,{className:"h-3.5 w-3.5 text-muted-foreground"}),r.jsx("p",{className:"text-sm text-muted-foreground truncate",children:y.users?.email})]})]})]}),r.jsx("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:r.jsx(ba,{children:r.jsxs(ja,{children:[r.jsx(wa,{asChild:!0,children:r.jsx(D,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-red-50",onClick:b=>{b.stopPropagation(),m(y.user_id,y.users?.full_name)},children:r.jsx(St,{className:"h-4 w-4 text-red-600"})})}),r.jsx(gi,{children:r.jsx("p",{children:"Usuń z grupy"})})]})})})]})},y.user_id))}):r.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[r.jsx(ge,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),r.jsx("p",{children:"Brak uczniów w grupie"}),r.jsxs(D,{size:"sm",variant:"outline",className:"mt-4",onClick:()=>i(`/teacher/groups/${n}/assign-students`),children:[r.jsx(Pi,{className:"w-4 h-4 mr-2"}),"Dodaj pierwszego ucznia"]})]})})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(he,{children:r.jsx(L,{children:"Przypisane kursy"})})}),r.jsx(I,{children:d?.data?.length?r.jsx("div",{className:"space-y-2",children:d.data.map(y=>r.jsx("div",{className:"p-4 border rounded-lg hover:bg-muted/30 transition-all duration-200 group cursor-pointer",onClick:()=>s("courses",y.course_id),children:r.jsxs("div",{className:"flex items-start justify-between gap-4",children:[r.jsxs("div",{className:"flex gap-3 flex-1 min-w-0",children:[r.jsx("div",{className:"flex-shrink-0 mt-0.5",children:y.courses?.icon_emoji?r.jsx("div",{className:"h-10 w-10 rounded-lg bg-muted/50 flex items-center justify-center",children:r.jsx("span",{className:"text-xl",children:y.courses.icon_emoji})}):r.jsx("div",{className:"h-10 w-10 rounded-lg bg-muted/50 flex items-center justify-center",children:r.jsx(Se,{className:"h-5 w-5 text-muted-foreground"})})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("h4",{className:"font-medium text-base leading-tight truncate pr-2",children:y.courses?.title}),r.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[r.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[r.jsx(js,{className:"h-3.5 w-3.5"}),r.jsx("span",{children:new Date(y.assigned_at).toLocaleDateString("pl-PL")})]}),r.jsx(V,{variant:y.courses?.is_published?"default":"secondary",className:`text-xs ${y.courses?.is_published?"bg-green-100 text-green-700 hover:bg-green-100":""}`,children:y.courses?.is_published?"Opublikowany":"Szkic"})]})]})]}),r.jsx("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:r.jsx(ba,{children:r.jsxs(ja,{children:[r.jsx(wa,{asChild:!0,children:r.jsx(D,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-red-50",onClick:b=>{b.stopPropagation(),f(y.course_id,y.courses?.title)},children:r.jsx(St,{className:"h-4 w-4 text-red-600"})})}),r.jsx(gi,{children:r.jsx("p",{children:"Odepnij kurs"})})]})})})]})},y.course_id))}):r.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[r.jsx(Se,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),r.jsx("p",{children:"Brak przypisanych kursów"}),r.jsxs(D,{size:"sm",variant:"outline",className:"mt-4",onClick:()=>i(`/teacher/groups/${n}/assign-courses`),children:[r.jsx(Je,{className:"w-4 h-4 mr-2"}),"Przypisz pierwszy kurs"]})]})})]})]})]})},zW=()=>{const{id:t}=Qt(),e=pe(),[s,n]=j.useState([]),[i,a]=j.useState(""),{data:o,isLoading:l}=tt({resource:"groups",id:t}),{data:c,isLoading:u}=Y({resource:"users",filters:[{field:"role",operator:"eq",value:"student"}],pagination:{mode:"off"}}),{data:d,isLoading:h}=Y({resource:"group_members",filters:[{field:"group_id",operator:"eq",value:parseInt(t)}],pagination:{mode:"off"},meta:{select:"user_id, group_id"}}),{mutate:f,isLoading:m}=hn(),p=async()=>{if(s.length===0){G.error("Wybierz przynajmniej jednego ucznia");return}try{const N=s.map(k=>f({resource:"group_members",values:{user_id:k,group_id:parseInt(t)}},{onSuccess:()=>{console.log(`Student ${k} assigned successfully`)},onError:C=>{console.error("Error assigning student:",k,C)}}));await Promise.all(N),G.success(`Dodano ${s.length} uczniów do grupy`),e(`/teacher/groups/show/${t}`)}catch(N){G.error("Błąd podczas dodawania uczniów"),console.error("Error details:",N)}};if(l||u||h)return r.jsx(X,{children:r.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const x=o?.data,g=d?.data?.map(N=>N.user_id)||[],y=c?.data?.filter(N=>!g.includes(N.id))||[],b=y.filter(N=>N.full_name.toLowerCase().includes(i.toLowerCase())||N.email.toLowerCase().includes(i.toLowerCase())),w=N=>{n(k=>k.includes(N)?k.filter(C=>C!==N):[...k,N])},S=()=>{n(b.map(N=>N.id))},z=()=>{n([])};return r.jsxs(X,{children:[r.jsxs(D,{variant:"outline",size:"sm",onClick:()=>e(`/teacher/groups/show/${t}`),children:[r.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Powrót do grupy"]}),r.jsx(he,{children:r.jsx(je,{title:"Dodaj uczniów",description:`Dodawanie uczniów do grupy: ${x?.name}`})}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(he,{children:[r.jsx(L,{children:"Dostępni uczniowie"}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(D,{variant:"outline",size:"sm",onClick:S,disabled:b.length===0,children:[r.jsx(Ds,{className:"w-4 h-4 mr-2"}),"Zaznacz wszystkich"]}),r.jsxs(D,{variant:"outline",size:"sm",onClick:z,disabled:s.length===0,children:[r.jsx(fn,{className:"w-4 h-4 mr-2"}),"Odznacz wszystkich"]})]})]})}),r.jsxs(I,{children:[r.jsx(te,{placeholder:"Szukaj uczniów...",value:i,onChange:N=>a(N.target.value),className:"mb-4"}),b.length===0?r.jsx("div",{className:"text-center py-8 text-muted-foreground",children:y.length===0?r.jsxs(r.Fragment,{children:[r.jsx(Pi,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),r.jsx("p",{children:"Wszyscy uczniowie są już w tej grupie"})]}):r.jsxs(r.Fragment,{children:[r.jsx(Pi,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),r.jsx("p",{children:"Nie znaleziono uczniów"})]})}):r.jsx("div",{className:"space-y-2",children:b.map(N=>r.jsxs("div",{className:"flex items-center space-x-3 p-3 border rounded-lg hover:bg-muted/50 cursor-pointer",onClick:()=>w(N.id),children:[r.jsx(mt,{checked:s.includes(N.id),onCheckedChange:()=>w(N.id),onClick:k=>k.stopPropagation()}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"font-medium",children:N.full_name}),r.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[r.jsx(qd,{className:"w-3 h-3"}),N.email]})]}),r.jsx(V,{variant:"secondary",className:"text-xs",children:"Uczeń"})]},N.id))}),s.length>0&&r.jsxs("div",{className:"mt-6 p-4 bg-muted rounded-lg",children:[r.jsxs("p",{className:"text-sm text-muted-foreground mb-3",children:["Wybrano ",s.length," uczniów do dodania"]}),r.jsxs(he,{children:[r.jsx(D,{variant:"outline",onClick:()=>e(`/teacher/groups/show/${t}`),children:"Anuluj"}),r.jsx(D,{onClick:p,disabled:m,children:m?"Dodawanie...":"Dodaj uczniów"})]})]})]})]})]})},Ej={name:"groups",list:"/teacher/groups",create:"/teacher/groups/create",edit:"/teacher/groups/edit/:id",show:"/teacher/groups/show/:id",meta:{label:"Grupy",icon:r.jsx(ge,{className:"h-4 w-4"})}},_W=[r.jsx(Z,{path:"groups",element:r.jsx(kW,{})},"groups-list"),r.jsx(Z,{path:"groups/create",element:r.jsx(NW,{})},"groups-create"),r.jsx(Z,{path:"groups/edit/:id",element:r.jsx(SW,{})},"groups-edit"),r.jsx(Z,{path:"groups/show/:id",element:r.jsx(CW,{})},"groups-show"),r.jsx(Z,{path:"groups/:id/assign-students",element:r.jsx(zW,{})},"groups-assign-students")],AW=()=>{const{show:t}=Yt(),e=pe(),{data:s}=wt(),[n,i]=j.useState(""),[a,o]=j.useState("all"),[l,c]=j.useState([]),[u,d]=j.useState([]),[h,f]=j.useState(!0),[m,p]=j.useState(new Map);j.useEffect(()=>{(async()=>{if(s?.id){f(!0);try{const{data:w,error:S}=await oe.from("course_access").select("course_id").eq("teacher_id",s.id);if(S)throw S;if(!w||w.length===0){c([]),d([]),f(!1);return}const z=[...new Set(w.map(R=>R.course_id))],{data:N,error:k}=await oe.from("course_access").select("group_id, course_id").in("course_id",z).not("group_id","is",null);if(k)throw k;const C=new Map;N?.forEach(R=>{if(R.group_id){const B=C.get(R.group_id)||[];B.push(R.course_id),C.set(R.group_id,B)}}),p(C);const T=[...new Set(N?.map(R=>R.group_id).filter(Boolean)||[])];if(T.length===0){c([]),d([]),f(!1);return}const{data:v,error:_}=await oe.from("groups").select("*").in("id",T).order("name");if(_)throw _;const A=v?.map(R=>({id:R.id,name:R.name,academic_year:R.academic_year,vendor_id:R.vendor_id||0,is_active:R.is_active??!0,created_at:R.created_at||new Date().toISOString()}))||[];c(A);const{data:E,error:M}=await oe.from("users").select(`
            *,
            user_stats(*),
            group_members!inner(
              group_id,
              user_id,
              joined_at,
              groups!inner(*)
            )
          `).in("group_members.group_id",T).eq("role","student").order("full_name");if(M)throw M;const O=E?.map(R=>({id:R.id,email:R.email,full_name:R.full_name,vendor_id:R.vendor_id,role:R.role,is_active:R.is_active,created_at:R.created_at,groups:R.group_members?.map(B=>({group_id:B.group_id,user_id:B.user_id,joined_at:B.joined_at,groups:B.groups}))||[],user_stats:R.user_stats?Array.isArray(R.user_stats)?R.user_stats:[R.user_stats]:[]}))||[];d(O)}catch(w){console.error("Error fetching students:",w),c([]),d([])}finally{f(!1)}}})()},[s]);const x=j.useMemo(()=>u.filter(b=>{const w=!n||b.full_name.toLowerCase().includes(n.toLowerCase())||b.email.toLowerCase().includes(n.toLowerCase()),S=a==="all"||b.groups?.some(z=>z.groups?.id.toString()===a);return w&&S}),[u,n,a]),g=b=>{if(!b)return{color:"text-gray-500",text:"Brak aktywności"};const w=Math.floor((new Date().getTime()-new Date(b).getTime())/(1e3*60*60*24));return w===0?{color:"text-green-600",text:"Dzisiaj"}:w===1?{color:"text-green-600",text:"Wczoraj"}:w<=7?{color:"text-yellow-600",text:`${w} dni temu`}:w<=30?{color:"text-orange-600",text:`${Math.floor(w/7)} tyg. temu`}:{color:"text-red-600",text:"Ponad miesiąc temu"}},y=b=>{const w=b.groups?.[0]?.group_id;return w&&m.get(w)?.[0]||null};return h?r.jsx(X,{children:r.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):r.jsxs(X,{children:[r.jsx(he,{children:r.jsx(je,{title:"Uczniowie z moich kursów",description:`Uczniowie z grup które mają dostęp do Twoich kursów (${l.length} ${l.length===1?"grupa":l.length<5?"grupy":"grup"})`})}),r.jsxs(he,{className:"gap-4",children:[r.jsxs("div",{className:"relative flex-1 max-w-sm",children:[r.jsx(uo,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),r.jsx(te,{placeholder:"Szukaj ucznia...",className:"pl-10",value:n,onChange:b=>i(b.target.value)})]}),l.length>0&&r.jsxs(Ee,{value:a,onValueChange:o,children:[r.jsx(_e,{className:"w-[200px]",children:r.jsx(De,{placeholder:"Filtruj po grupie"})}),r.jsxs(Ae,{children:[r.jsx(ee,{value:"all",children:"Wszystkie grupy"}),l.map(b=>r.jsxs(ee,{value:b.id.toString(),children:[b.name," (",b.academic_year,")"]},b.id))]})]})]}),l.length===0?r.jsx(P,{children:r.jsxs(I,{className:"p-12 text-center",children:[r.jsx(st,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),r.jsx("p",{className:"text-lg font-medium mb-2",children:"Nie masz przypisanych kursów"}),r.jsx("p",{className:"text-muted-foreground",children:'Poproś administratora o przypisanie Cię do kursów. Administrator może to zrobić w module "Zarządzanie dostępem" → "Dostęp do kursów"'})]})}):x.length===0&&u.length===0?r.jsx(P,{children:r.jsxs(I,{className:"p-12 text-center",children:[r.jsx(ge,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),r.jsx("p",{className:"text-lg font-medium mb-2",children:"Brak uczniów w grupach z Twoimi kursami"}),r.jsx("p",{className:"text-muted-foreground",children:"Uczniowie pojawią się tutaj, gdy administrator przypisze grupy do Twoich kursów"})]})}):r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:[x.map(b=>{const w=b.user_stats?.[0],S=g(w?.last_active),z=b.groups?.[0]?.group_id,N=y(b);return r.jsx(P,{className:"hover:shadow-md transition-shadow",children:r.jsxs(I,{className:"p-6",children:[r.jsxs("div",{className:"flex items-start justify-between mb-4",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center",children:r.jsx(F1,{className:"h-5 w-5 text-primary"})}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-semibold text-sm",children:b.full_name}),r.jsx("p",{className:"text-xs text-muted-foreground",children:b.email})]})]}),r.jsxs("div",{className:"flex gap-1",children:[r.jsx(D,{variant:"ghost",size:"sm",onClick:()=>t("users",b.id),title:"Zobacz profil",children:r.jsx(Tt,{className:"h-4 w-4"})}),z&&N&&r.jsx(D,{variant:"ghost",size:"sm",onClick:()=>e(`/teacher/groups/${z}/courses/${N}/students/${b.id}`),title:"Zobacz szczegóły w kursie",children:r.jsx(Se,{className:"h-4 w-4"})})]})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between text-sm",children:[r.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[r.jsx(ge,{className:"w-3 h-3"}),"Grupa"]}),r.jsxs("div",{className:"flex gap-1 flex-wrap justify-end",children:[b.groups?.slice(0,2).map(k=>r.jsx(V,{variant:"outline",className:"text-xs",children:k.groups?.name},k.groups?.id)),b.groups?.length>2&&r.jsxs(V,{variant:"outline",className:"text-xs",children:["+",b.groups.length-2]})]})]}),r.jsxs("div",{className:"flex items-center justify-between text-sm",children:[r.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[r.jsx(ft,{className:"w-3 h-3"}),"Punkty"]}),r.jsxs("span",{className:"font-medium",children:[w?.total_points||0,r.jsxs("span",{className:"text-xs text-muted-foreground ml-1",children:["(poz. ",w?.current_level||1,")"]})]})]}),r.jsxs("div",{className:"flex items-center justify-between text-sm",children:[r.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[r.jsx(cr,{className:"w-3 h-3"}),"Quizy"]}),r.jsx("span",{className:"font-medium",children:w?.quizzes_completed||0})]}),r.jsxs("div",{className:"flex items-center justify-between text-sm",children:[r.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[r.jsx(Ze,{className:"w-3 h-3"}),"Aktywność"]}),r.jsx("span",{className:`font-medium ${S.color}`,children:S.text})]}),w&&w.daily_streak>0&&r.jsxs("div",{className:"flex items-center justify-between text-sm",children:[r.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[r.jsx(Et,{className:"w-3 h-3"}),"Seria dni"]}),r.jsxs("span",{className:"font-medium text-orange-600",children:["🔥 ",w.daily_streak]})]})]}),S.color==="text-red-600"&&r.jsx("div",{className:"mt-3 pt-3 border-t",children:r.jsxs("div",{className:"flex items-center gap-2 text-xs text-orange-600",children:[r.jsx(st,{className:"w-3 h-3"}),r.jsx("span",{children:"Uczeń może potrzebować wsparcia"})]})})]})},b.id)}),x.length===0&&u.length>0&&r.jsx(P,{className:"col-span-full",children:r.jsxs(I,{className:"p-12 text-center",children:[r.jsx(ge,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),r.jsx("p",{className:"text-muted-foreground",children:"Nie znaleziono uczniów spełniających kryteria"})]})})]})]})},TW=()=>{const{list:t}=Yt(),{id:e}=Qt(),{data:s}=wt(),[n,i]=j.useState([]),[a,o]=j.useState([]),[l,c]=j.useState(!0),[u,d]=j.useState(null);if(j.useEffect(()=>{(async()=>{if(e){c(!0);try{const{data:b,error:w}=await oe.from("users").select(`
            *,
            user_stats(*),
            group_members(
              group_id,
              user_id,
              joined_at,
              groups(*)
            )
          `).eq("id",e).single();if(w)throw w;if(b){const S={id:b.id,email:b.email,full_name:b.full_name,vendor_id:b.vendor_id,role:b.role,is_active:b.is_active,created_at:b.created_at,groups:b.group_members?.map(z=>({group_id:z.group_id,user_id:z.user_id,joined_at:z.joined_at,groups:z.groups}))||[],user_stats:b.user_stats?Array.isArray(b.user_stats)?b.user_stats:[b.user_stats]:[]};d(S)}}catch(b){console.error("Error fetching student data:",b)}finally{c(!1)}}})()},[e]),j.useEffect(()=>{(async()=>{if(!(!e||!s?.id))try{const{data:b}=await oe.from("course_access").select("course_id").eq("teacher_id",s.id);if(!b||b.length===0)return;const w=b.map(N=>N.course_id),{data:S}=await oe.from("courses").select(`
            id,
            title,
            topics!inner(
              id,
              title,
              activities!inner(
                id,
                type,
                activity_progress!left(
                  completed_at,
                  score,
                  attempts,
                  time_spent
                )
              )
            )
          `).in("id",w).eq("topics.activities.activity_progress.user_id",e);if(S){const N=S.map(k=>{let C=0,T=0,v=0,_=0,A=0,E=0,M=null;return k.topics?.forEach(O=>{O.activities?.forEach(R=>{C++;const B=R.activity_progress?.[0];B?.completed_at&&(T++,(!M||new Date(B.completed_at)>new Date(M))&&(M=B.completed_at)),R.type==="quiz"&&B?.score!==null&&(v+=B.score,_++,B.score>=70?A++:B.attempts>0&&E++)})}),{course_id:k.id,course_title:k.title,total_activities:C,completed_activities:T,avg_score:_>0?Math.round(v/_):0,quizzes_passed:A,quizzes_failed:E,last_activity:M||""}});i(N)}const{data:z}=await oe.from("activity_progress").select(`
            *,
            activities(
              id,
              title,
              type,
              topics(
                title,
                courses(title)
              )
            )
          `).eq("user_id",e).order("completed_at",{ascending:!1,nullsFirst:!1}).limit(10);z&&o(z)}catch(b){console.error("Error fetching student progress:",b)}})()},[e,s]),l)return r.jsx(X,{children:r.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const h=u,f=h?.user_stats?.[0],m=y=>y>=80?"text-green-600":y>=60?"text-yellow-600":"text-red-600",p=y=>y==="quiz"?"📝":"📚",x=y=>{const b=Math.floor(y/60),w=y%60;return b>0?`${b}h ${w}min`:`${w}min`},g=y=>{if(!y)return"text-gray-500";const b=Math.floor((new Date().getTime()-new Date(y).getTime())/(1e3*60*60*24));return b===0?"text-green-600":b<=7?"text-yellow-600":b<=30?"text-orange-600":"text-red-600"};return r.jsxs(X,{children:[r.jsxs(D,{variant:"outline",size:"sm",onClick:()=>t("users"),children:[r.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),r.jsx(he,{children:r.jsxs("div",{children:[r.jsx(je,{title:h?.full_name||"",description:h?.email||""}),r.jsxs("div",{className:"flex gap-2 mt-2",children:[h?.groups?.map(y=>r.jsxs(V,{variant:"outline",children:[r.jsx(ge,{className:"w-3 h-3 mr-1"}),y.groups?.name," (",y.groups?.academic_year,")"]},y.groups?.id)),!h?.is_active&&r.jsx(V,{variant:"destructive",children:"Nieaktywny"})]})]})}),r.jsxs(Pt,{children:[r.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center gap-2",children:[r.jsx(Vr,{className:"w-5 h-5"}),"Podsumowanie postępów"]})}),r.jsxs(I,{children:[r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[r.jsxs("div",{className:"text-center p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg",children:[r.jsx(ft,{className:"w-8 h-8 mx-auto mb-2 text-blue-600"}),r.jsx("p",{className:"text-2xl font-bold",children:f?.total_points||0}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"Punkty"})]}),r.jsxs("div",{className:"text-center p-4 bg-purple-50 dark:bg-purple-950/20 rounded-lg",children:[r.jsx(pt,{className:"w-8 h-8 mx-auto mb-2 text-purple-600"}),r.jsx("p",{className:"text-2xl font-bold",children:f?.current_level||1}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"Poziom"})]}),r.jsxs("div",{className:"text-center p-4 bg-green-50 dark:bg-green-950/20 rounded-lg",children:[r.jsx(Os,{className:"w-8 h-8 mx-auto mb-2 text-green-600"}),r.jsx("p",{className:"text-2xl font-bold",children:f?.quizzes_completed||0}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"Ukończone quizy"})]}),r.jsxs("div",{className:"text-center p-4 bg-orange-50 dark:bg-orange-950/20 rounded-lg",children:[r.jsx(Et,{className:"w-8 h-8 mx-auto mb-2 text-orange-600"}),r.jsx("p",{className:"text-2xl font-bold",children:f?.daily_streak||0}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"Dni z rzędu"})]})]}),r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 pt-4 border-t",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-muted-foreground",children:"Perfekcyjne wyniki"}),r.jsxs("p",{className:"text-lg font-semibold text-green-600",children:[f?.perfect_scores||0,f&&f.quizzes_completed>0&&r.jsxs("span",{className:"text-sm text-muted-foreground ml-1",children:["(",Math.round(f.perfect_scores/f.quizzes_completed*100),"%)"]})]})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-muted-foreground",children:"Czas nauki"}),r.jsx("p",{className:"text-lg font-semibold",children:f?x(f.total_time_spent):"0min"})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-muted-foreground",children:"Punkty/h (idle)"}),r.jsx("p",{className:"text-lg font-semibold",children:f?.idle_points_rate||1})]})]})]})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center gap-2",children:[r.jsx(Se,{className:"w-5 h-5"}),"Postępy w Twoich kursach"]})}),r.jsxs(I,{className:"space-y-4",children:[n.map(y=>{const b=y.total_activities>0?Math.round(y.completed_activities/y.total_activities*100):0;return r.jsxs("div",{className:"p-4 border rounded-lg space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h4",{className:"font-semibold",children:y.course_title}),r.jsxs(V,{variant:b===100?"default":"outline",children:[b,"% ukończone"]})]}),r.jsx(un,{value:b,className:"h-2"}),r.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-muted-foreground",children:"Ukończone"}),r.jsxs("p",{className:"font-medium",children:[y.completed_activities,"/",y.total_activities," aktywności"]})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-muted-foreground",children:"Średni wynik"}),r.jsx("p",{className:`font-medium ${y.avg_score>0?m(y.avg_score):""}`,children:y.avg_score>0?`${y.avg_score}%`:"Brak"})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-muted-foreground",children:"Quizy"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("span",{className:"text-green-600 flex items-center",children:[r.jsx(ws,{className:"w-3 h-3 mr-1"}),y.quizzes_passed]}),r.jsxs("span",{className:"text-red-600 flex items-center",children:[r.jsx(Nu,{className:"w-3 h-3 mr-1"}),y.quizzes_failed]})]})]})]}),y.last_activity&&r.jsx("div",{className:"pt-2 border-t",children:r.jsxs("p",{className:"text-xs text-muted-foreground",children:["Ostatnia aktywność: ",new Date(y.last_activity).toLocaleDateString("pl-PL")]})})]},y.course_id)}),n.length===0&&r.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Uczeń nie rozpoczął jeszcze żadnego z Twoich kursów"})]})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center gap-2",children:[r.jsx(Hd,{className:"w-5 h-5"}),"Ostatnie aktywności"]})}),r.jsx(I,{children:r.jsxs("div",{className:"space-y-3",children:[a.map(y=>r.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("span",{className:"text-2xl",children:y.activities&&p(y.activities.type)}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-sm",children:y.activities?.title}),r.jsxs("p",{className:"text-xs text-muted-foreground",children:[y.activities?.topics?.courses?.title," • ",y.activities?.topics?.title]})]})]}),r.jsxs("div",{className:"text-right",children:[y.score!==null&&r.jsxs("p",{className:`font-medium ${m(y.score)}`,children:[y.score,"%"]}),r.jsx("p",{className:"text-xs text-muted-foreground",children:y.completed_at?new Date(y.completed_at).toLocaleDateString("pl-PL"):new Date(y.started_at).toLocaleDateString("pl-PL")}),y.attempts>1&&r.jsxs("p",{className:"text-xs text-muted-foreground",children:["Próba ",y.attempts]})]})]},`${y.user_id}-${y.activity_id}`)),a.length===0&&r.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Brak aktywności do wyświetlenia"})]})})]})]}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{className:"text-lg flex items-center gap-2",children:[r.jsx(Ze,{className:"w-4 h-4"}),"Czas nauki"]})}),r.jsxs(I,{className:"space-y-3",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-muted-foreground",children:"Łączny czas"}),r.jsx("p",{className:"text-xl font-bold",children:f?x(f.total_time_spent):"0min"})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-muted-foreground",children:"Ostatnia aktywność"}),r.jsx("p",{className:`text-sm font-medium ${g(f?.last_active)}`,children:f?.last_active?new Date(f.last_active).toLocaleDateString("pl-PL",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"Brak aktywności"})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-muted-foreground",children:"Ostatnie pobieranie idle"}),r.jsx("p",{className:"text-sm font-medium",children:f?.last_idle_claim?new Date(f.last_idle_claim).toLocaleString("pl-PL",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Nigdy"})]})]})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{className:"text-lg flex items-center gap-2",children:[r.jsx(Os,{className:"w-4 h-4"}),"Statystyki quizów"]})}),r.jsxs(I,{className:"space-y-3",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-sm",children:"Ukończone"}),r.jsx("span",{className:"font-bold",children:f?.quizzes_completed||0})]}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-sm",children:"Wyniki 100%"}),r.jsx("span",{className:"font-bold text-green-600",children:f?.perfect_scores||0})]}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-sm",children:"Współczynnik"}),r.jsx("span",{className:"font-bold",children:f&&f.quizzes_completed>0?`${Math.round(f.perfect_scores/f.quizzes_completed*100)}%`:"0%"})]}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-sm",children:"Średni czas/quiz"}),r.jsx("span",{className:"font-bold",children:f&&f.quizzes_completed>0?x(Math.round(f.total_time_spent/f.quizzes_completed)):"0min"})]})]})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{className:"text-lg flex items-center gap-2",children:[r.jsx(js,{className:"w-4 h-4"}),"Informacje"]})}),r.jsxs(I,{className:"space-y-3",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-muted-foreground",children:"Dołączył"}),r.jsx("p",{className:"text-sm font-medium",children:h?.created_at&&new Date(h.created_at).toLocaleDateString("pl-PL",{year:"numeric",month:"long",day:"numeric"})})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-muted-foreground",children:"Dni od rejestracji"}),r.jsxs("p",{className:"text-sm font-medium",children:[h?.created_at&&Math.floor((new Date().getTime()-new Date(h.created_at).getTime())/(1e3*60*60*24))," dni"]})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-muted-foreground",children:"Status konta"}),r.jsx("p",{className:"text-sm font-medium",children:h?.is_active?r.jsx("span",{className:"text-green-600",children:"✓ Aktywny"}):r.jsx("span",{className:"text-red-600",children:"✗ Nieaktywny"})})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-muted-foreground",children:"Grupy"}),r.jsx("div",{className:"text-sm font-medium",children:h?.groups?.map(y=>r.jsxs("div",{children:[y.groups?.name," (",y.groups?.academic_year,")"]},y.groups?.id))})]})]})]})]})]})]})},EW=[r.jsx(Z,{path:"users",element:r.jsx(AW,{})},"users-list"),r.jsx(Z,{path:"users/show/:id",element:r.jsx(TW,{})},"users-show")],DW=t=>{const e=new Date(t);return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate())).toISOString().slice(0,10)},MW=()=>{const t=pe(),e={queryOptions:{staleTime:1/0,gcTime:1800*1e3,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,refetchInterval:!1,retry:0}},{data:s}=Y({resource:"user_stats",filters:[{field:"last_active",operator:"gte",value:new Date(Date.now()-10080*60*1e3).toISOString().split("T")[0]}],pagination:{mode:"off"},...e}),{data:n}=Y({resource:"activity_progress",pagination:{mode:"off"},meta:{select:"*, activities(type, passing_score)",query:d=>d.not("completed_at","is",null)},...e}),{data:i}=Y({resource:"user_stats",pagination:{mode:"off"},sorters:[{field:"total_points",order:"desc"}],...e}),a=j.useMemo(()=>{const d=s?.data?.length||0,h=n?.data?.filter(y=>y.activities?.type==="quiz"&&y.score!==null).map(y=>Number(y.score))||[],f=h.length>0?Math.round(h.reduce((y,b)=>y+b,0)/h.length):0,m=n?.data?.length||0,p=n?.data?.filter(y=>y.completed_at).length||0,x=m>0?Math.round(p/m*100):0,g=i?.data?.reduce((y,b)=>y+Number(b.total_points),0)||0;return{activeUsers:d,activeUsersChange:12,avgQuizScore:f,avgQuizScoreChange:3,completionRate:x,completionRateChange:5,totalPoints:g,totalPointsChange:8}},[s?.data,n?.data,i?.data]),o=j.useMemo(()=>{const d=Array.from({length:7},(f,m)=>{const p=new Date;return p.setUTCDate(p.getUTCDate()-(6-m)),p.toISOString().slice(0,10)}),h=new Map;for(const f of d)h.set(f,{quizzes:0,materials:0});for(const f of n?.data||[]){if(!f?.started_at)continue;const m=DW(f.started_at);if(!h.has(m))continue;const p=h.get(m);f.activities?.type==="quiz"?p.quizzes+=1:f.activities?.type==="material"&&(p.materials+=1)}return d.map(f=>({date:new Date(f+"T00:00:00Z").toLocaleDateString("pl-PL",{weekday:"short",day:"numeric"}),quizzes:h.get(f).quizzes,materials:h.get(f).materials}))},[n?.data]),l=[{title:"Aktywni użytkownicy",value:a.activeUsers,change:a.activeUsersChange,icon:ge,color:"text-blue-600",bgColor:"bg-blue-50",link:"/teacher/reports/engagement"},{title:"Średni wynik quizów",value:`${a.avgQuizScore}%`,change:a.avgQuizScoreChange,icon:pt,color:"text-green-600",bgColor:"bg-green-50",link:"/teacher/reports/performance"},{title:"Wskaźnik ukończeń",value:`${a.completionRate}%`,change:a.completionRateChange,icon:Et,color:"text-purple-600",bgColor:"bg-purple-50",link:"/teacher/reports/progress"},{title:"Suma punktów",value:a.totalPoints.toLocaleString("pl-PL"),change:a.totalPointsChange,icon:ft,color:"text-orange-600",bgColor:"bg-orange-50",link:"/teacher/reports/gamification"}],c=[{to:"/teacher/reports/engagement",title:"Raport zaangażowania",description:"Aktywność użytkowników, czas nauki, trendy",icon:r.jsx(Hd,{className:"h-5 w-5"}),color:"text-blue-600"},{to:"/teacher/reports/progress",title:"Raport postępów",description:"Postęp kursów, wskaźniki ukończeń",icon:r.jsx(Et,{className:"h-5 w-5"}),color:"text-purple-600"},{to:"/teacher/reports/performance",title:"Raport wyników",description:"Wyniki quizów, najtrudniejsze pytania",icon:r.jsx(pt,{className:"h-5 w-5"}),color:"text-green-600"},{to:"/teacher/reports/gamification",title:"Raport gamifikacji",description:"Ranking punktowy, poziomy, osiągnięcia",icon:r.jsx(ft,{className:"h-5 w-5"}),color:"text-orange-600"}],u=i?.data?.slice(0,5)||[];return r.jsxs(X,{children:[r.jsx(he,{children:r.jsx(je,{title:"Centrum Raportów",description:"Kompleksowy przegląd wyników i postępów uczniów"})}),r.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-6",children:l.map((d,h)=>r.jsxs(P,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>t(d.link),children:[r.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(L,{className:"text-sm font-medium",children:d.title}),r.jsx("div",{className:`${d.bgColor} p-2 rounded-lg`,children:r.jsx(d.icon,{className:`h-4 w-4 ${d.color}`})})]}),r.jsxs(I,{children:[r.jsx("div",{className:"text-2xl font-bold",children:d.value}),r.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[r.jsxs("span",{className:d.change>0?"text-green-600":"text-red-600",children:[d.change>0?"+":"",d.change,"%"]})," ","vs. ostatnie 7 dni"]})]})]},h))}),r.jsxs("div",{className:"grid gap-6 lg:grid-cols-3 mb-6",children:[r.jsxs(P,{className:"lg:col-span-2",children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center justify-between",children:[r.jsx("span",{children:"Aktywność w ostatnich 7 dniach"}),r.jsx(D,{variant:"ghost",size:"sm",onClick:()=>t("/teacher/reports/engagement"),children:"Zobacz więcej →"})]})}),r.jsx(I,{children:r.jsx("div",{style:{width:"100%",height:250},children:r.jsx(ht,{width:"100%",height:"100%",children:r.jsxs(Gd,{data:o,children:[r.jsx(Ms,{strokeDasharray:"3 3"}),r.jsx(ys,{dataKey:"date"}),r.jsx(is,{allowDecimals:!1}),r.jsx(gt,{}),r.jsx(Zr,{type:"monotone",dataKey:"materials",stackId:"1",stroke:"#82ca9d",fill:"#82ca9d",name:"Materiały",isAnimationActive:!1,dot:!0}),r.jsx(Zr,{type:"monotone",dataKey:"quizzes",stackId:"1",stroke:"#8884d8",fill:"#8884d8",name:"Quizy",isAnimationActive:!1,dot:!0})]},`${o.map(d=>d.quizzes+d.materials).join("-")}`)})})})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center justify-between",children:[r.jsx("span",{children:"Top 5 uczniów"}),r.jsx(ft,{className:"h-4 w-4 text-orange-600"})]})}),r.jsx(I,{children:r.jsx("div",{className:"space-y-3",children:u.map((d,h)=>r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold
                      ${h===0?"bg-yellow-100 text-yellow-700":h===1?"bg-gray-100 text-gray-700":h===2?"bg-orange-100 text-orange-700":"bg-muted text-muted-foreground"}`,children:h+1}),r.jsxs("div",{children:[r.jsxs("p",{className:"text-sm font-medium",children:["Uczeń #",h+1]}),r.jsxs("p",{className:"text-xs text-muted-foreground",children:["Poziom ",d.current_level]})]})]}),r.jsxs("div",{className:"text-right",children:[r.jsx("p",{className:"text-sm font-bold",children:d.total_points}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"punktów"})]})]},d.user_id))})})]})]}),r.jsxs("div",{className:"mb-6",children:[r.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Szczegółowe raporty"}),r.jsx(Pt,{variant:"2-2-4",children:c.map(d=>r.jsxs(P,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>t(d.to),children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center gap-2 text-base",children:[r.jsx("span",{className:d.color,children:d.icon}),d.title]})}),r.jsx(I,{children:r.jsx("p",{className:"text-sm text-muted-foreground",children:d.description})})]},d.to))})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Ostatnie aktywności"})}),r.jsx(I,{children:r.jsx("div",{className:"space-y-2",children:n?.data?.slice(0,10).map(d=>r.jsxs("div",{className:"flex items-center justify-between py-2 border-b last:border-0",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(V,{variant:d.activities?.type==="quiz"?"default":"secondary",children:d.activities?.type==="quiz"?"Quiz":"Materiał"}),r.jsxs("span",{className:"text-sm",children:["Aktywność #",d.activity_id]})]}),r.jsxs("div",{className:"text-right",children:[d.score!==null&&r.jsxs("span",{className:"text-sm font-medium",children:[d.score,"%"]}),r.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(d.started_at).toLocaleDateString("pl-PL")})]})]},`${d.user_id}-${d.activity_id}`))})})]})]})},PW=()=>{const[t,e]=j.useState("7d"),[s,n]=j.useState("all"),i=a_()(),[a,o]=j.useState(!0),[l,c]=j.useState([]),[u,d]=j.useState([]),[h,f]=j.useState([]),[m,p]=j.useState([]),x=()=>{const v=new Date,_=new Date;switch(t){case"7d":_.setDate(_.getDate()-7);break;case"30d":_.setDate(_.getDate()-30);break;case"90d":_.setDate(_.getDate()-90);break}return{start:_,end:v}},{start:g,end:y}=x();j.useEffect(()=>{(async()=>{try{o(!0);const[_,A,E,M]=await Promise.all([i.getList({resource:"activity_progress",filters:[{field:"started_at",operator:"gte",value:g.toISOString()}],pagination:{mode:"off"}}),i.getList({resource:"activities",pagination:{mode:"off"},meta:{select:"id, type, topic_id"}}),i.getList({resource:"topics",pagination:{mode:"off"},meta:{select:"id, course_id"}}),i.getList({resource:"courses",filters:[{field:"is_published",operator:"eq",value:!0}],pagination:{mode:"off"}})]);c(_.data),d(A.data),f(E.data),p(M.data)}catch(_){console.error("Error fetching data:",_)}finally{o(!1)}})()},[]);const b=j.useMemo(()=>{if(!l.length||!u.length||!h.length)return[];const v=new Map(u.map(M=>[M.id,{type:M.type,topicId:M.topic_id}])),_=new Map(h.map(M=>[M.id,M.course_id])),A=l.map(M=>{const O=v.get(M.activity_id),R=O?.topicId?_.get(O.topicId):void 0;return{...M,activityType:O?.type,courseId:R}});if(s==="all")return A;const E=parseInt(s);return A.filter(M=>M.courseId===E)},[l,u,h,s]),w=j.useMemo(()=>{const v=new Set(b.map(O=>O.user_id)).size,_=b.reduce((O,R)=>O+(R.time_spent||0),0),A=v>0?(_/60/v).toFixed(1):"0",E=b.filter(O=>O.completed_at).length,M=b.length>0?Math.round(E/b.length*100):0;return{activeUsers:v,activeUsersChange:12,avgTimeHours:A,avgTimeChange:5,completedActivities:E,completedChange:18,engagementRate:M,engagementChange:3}},[b]),S=j.useMemo(()=>{const v=Math.ceil((y.getTime()-g.getTime())/864e5),_=[];for(let A=0;A<v;A++){const E=new Date(g);E.setDate(E.getDate()+A);const M=E.toISOString().split("T")[0],O=b.filter(B=>B.started_at.startsWith(M)),R=new Set(O.map(B=>B.user_id)).size;_.push({date:E.toLocaleDateString("pl-PL",{day:"numeric",month:"short"}),users:R})}return _},[b,g,y]),z=j.useMemo(()=>{const v=b.filter(E=>E.activityType==="quiz").length,_=b.filter(E=>E.activityType==="material").length;return v+_===0?[{name:"Brak danych",value:1,color:"#e5e7eb"}]:[{name:"Quizy",value:v,color:"#8884d8"},{name:"Materiały",value:_,color:"#82ca9d"}].filter(E=>E.value>0)},[b]),N=j.useMemo(()=>{const v=new Map;b.forEach(A=>{const E=v.get(A.user_id)||0;v.set(A.user_id,E+(A.time_spent||0))});const _=[{range:"0-30min",count:0,color:"#94a3b8"},{range:"30-60min",count:0,color:"#60a5fa"},{range:"1-2h",count:0,color:"#818cf8"},{range:"2-5h",count:0,color:"#a78bfa"},{range:"5h+",count:0,color:"#c084fc"}];return v.forEach(A=>{A<=30?_[0].count++:A<=60?_[1].count++:A<=120?_[2].count++:A<=300?_[3].count++:_[4].count++}),_.filter(A=>A.count>0)},[b]),k=j.useMemo(()=>{const v=Math.ceil((y.getTime()-g.getTime())/864e5),_=[];for(let A=0;A<v;A++){const E=new Date(g);E.setDate(E.getDate()+A);const M=E.toISOString().split("T")[0],O=b.filter($=>$.started_at.startsWith(M)),R=O.filter($=>$.completed_at).length,B=O.length,K=B>0?Math.round(R/B*100):0;_.push({date:E.toLocaleDateString("pl-PL",{day:"numeric",month:"short"}),rate:K,completed:R,total:B})}return _},[b,g,y]),C=[{label:"Aktywni użytkownicy",value:w.activeUsers.toString(),icon:ge,change:`+${w.activeUsersChange}%`,color:"text-blue-600",bgColor:"bg-blue-50"},{label:"Średni czas nauki",value:`${w.avgTimeHours}h`,icon:Ze,change:`+${w.avgTimeChange}%`,color:"text-purple-600",bgColor:"bg-purple-50"},{label:"Ukończone aktywności",value:w.completedActivities.toString(),icon:Hd,change:`+${w.completedChange}%`,color:"text-green-600",bgColor:"bg-green-50"},{label:"Wskaźnik zaangażowania",value:`${w.engagementRate}%`,icon:Et,change:`+${w.engagementChange}%`,color:"text-orange-600",bgColor:"bg-orange-50"}],T=j.useMemo(()=>{if(!m.length||!b.length)return[];const v=new Map;return m.forEach(_=>{const A=typeof _.id=="number"?_.id:parseInt(_.id);isNaN(A)||v.set(A,{title:_.title||"",users:new Set,activities:0,completed:0})}),b.forEach(_=>{const A=_.courseId;if(A&&v.has(A)){const E=v.get(A);E&&(E.users.add(_.user_id),E.activities++,_.completed_at&&E.completed++)}}),Array.from(v.entries()).filter(([_,A])=>A.activities>0).map(([_,A])=>({id:_,title:A.title,users:A.users.size,activities:A.activities,completionRate:A.activities>0?Math.round(A.completed/A.activities*100):0})).sort((_,A)=>A.users-_.users).slice(0,5)},[b,m]);return a?r.jsx(X,{children:r.jsx("div",{className:"flex items-center justify-center h-64",children:r.jsx("div",{className:"text-muted-foreground",children:"Ładowanie danych..."})})}):r.jsxs(X,{children:[r.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx(Ke,{to:"/teacher/reports/overview",children:r.jsxs(D,{variant:"ghost",size:"sm",children:[r.jsx(Pe,{className:"mr-2 h-4 w-4"}),"Powrót do centrum raportów"]})}),r.jsx("h1",{className:"text-2xl font-bold",children:"Raport zaangażowania"})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(Ee,{value:s,onValueChange:n,children:[r.jsx(_e,{className:"w-[200px]",children:r.jsx(De,{placeholder:"Wybierz kurs"})}),r.jsxs(Ae,{children:[r.jsx(ee,{value:"all",children:"Wszystkie kursy"}),m.map(v=>{const _=typeof v.id=="number"?v.id:parseInt(v.id);return r.jsx(ee,{value:_.toString(),children:v.title},_)})]})]}),r.jsxs(Ee,{value:t,onValueChange:e,children:[r.jsx(_e,{className:"w-[150px]",children:r.jsx(De,{})}),r.jsxs(Ae,{children:[r.jsx(ee,{value:"7d",children:"Ostatnie 7 dni"}),r.jsx(ee,{value:"30d",children:"Ostatnie 30 dni"}),r.jsx(ee,{value:"90d",children:"Ostatnie 90 dni"})]})]})]})]}),r.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-6",children:C.map((v,_)=>r.jsxs(P,{children:[r.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(L,{className:"text-sm font-medium",children:v.label}),r.jsx("div",{className:`${v.bgColor} p-2 rounded-lg`,children:r.jsx(v.icon,{className:`h-4 w-4 ${v.color}`})})]}),r.jsxs(I,{children:[r.jsx("div",{className:"text-2xl font-bold",children:v.value}),r.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.jsx("span",{className:"text-green-600",children:v.change})," vs. poprzedni okres"]})]})]},_))}),r.jsxs("div",{className:"grid gap-6 lg:grid-cols-3 mb-6",children:[r.jsxs(P,{className:"lg:col-span-2",children:[r.jsx(F,{children:r.jsx(L,{children:"Aktywni użytkownicy w czasie"})}),r.jsx(I,{children:r.jsx(ht,{width:"100%",height:300,children:r.jsxs(Gd,{data:S,children:[r.jsx(Ms,{strokeDasharray:"3 3"}),r.jsx(ys,{dataKey:"date"}),r.jsx(is,{}),r.jsx(gt,{}),r.jsx(Zr,{type:"monotone",dataKey:"users",stroke:"#8884d8",fill:"#8884d8",fillOpacity:.6,name:"Aktywni użytkownicy",isAnimationActive:!1})]},`${S.map(v=>v.users).join("-")}`)})})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Typy aktywności"})}),r.jsx(I,{children:r.jsx(ht,{width:"100%",height:300,children:r.jsxs(Su,{children:[r.jsx(Cu,{data:z,cx:"50%",cy:"50%",labelLine:!1,label:({name:v,percent:_})=>_!==void 0&&_>0?`${v}: ${(_*100).toFixed(0)}%`:"",outerRadius:80,fill:"#8884d8",dataKey:"value",isAnimationActive:!1,children:z.map((v,_)=>r.jsx(Tn,{fill:v.color},`cell-${_}`))}),r.jsx(gt,{})]})})})]})]}),r.jsxs("div",{className:"grid gap-6 lg:grid-cols-2 mb-6",children:[r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Rozkład czasu nauki użytkowników"})}),r.jsx(I,{children:r.jsx(ht,{width:"100%",height:250,children:r.jsxs(sc,{data:N,children:[r.jsx(Ms,{strokeDasharray:"3 3"}),r.jsx(ys,{dataKey:"range"}),r.jsx(is,{}),r.jsx(gt,{}),r.jsx(Wa,{dataKey:"count",name:"Liczba użytkowników",isAnimationActive:!1,children:N.map((v,_)=>r.jsx(Tn,{fill:v.color},`cell-${_}`))})]},`${N.map(v=>v.count).join("-")}`)})})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Wskaźnik ukończeń w czasie"})}),r.jsx(I,{children:r.jsx(ht,{width:"100%",height:250,children:r.jsxs(V1,{data:k,children:[r.jsx(Ms,{strokeDasharray:"3 3"}),r.jsx(ys,{dataKey:"date"}),r.jsx(is,{}),r.jsx(gt,{content:({active:v,payload:_})=>{if(v&&_&&_.length){const A=_[0].payload;return r.jsxs("div",{className:"bg-white p-2 border rounded shadow-sm",children:[r.jsx("p",{className:"font-medium text-sm",children:A.date}),r.jsxs("p",{className:"text-xs",children:["Wskaźnik: ",A.rate,"%"]}),r.jsxs("p",{className:"text-xs",children:["Ukończone: ",A.completed,"/",A.total]})]})}return null}}),r.jsx(Xp,{type:"monotone",dataKey:"rate",stroke:"#22c55e",strokeWidth:2,dot:{fill:"#22c55e"},name:"Wskaźnik ukończeń %",isAnimationActive:!1})]},`${k.map(v=>v.rate).join("-")}`)})})]})]}),T.length>0&&r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Zaangażowanie według kursów"})}),r.jsx(I,{children:r.jsx("div",{className:"space-y-3",children:T.map(v=>r.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[r.jsxs("div",{children:[r.jsx("p",{className:"font-medium",children:v.title}),r.jsxs("div",{className:"flex gap-4 mt-1 text-sm text-muted-foreground",children:[r.jsxs("span",{children:["Użytkownicy: ",v.users]}),r.jsxs("span",{children:["Aktywności: ",v.activities]})]})]}),r.jsx("div",{className:"text-right",children:r.jsxs(V,{variant:v.completionRate>=70?"default":"secondary",children:[v.completionRate,"% ukończonych"]})})]},v.id))})})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Kluczowe wnioski"})}),r.jsx(I,{children:r.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(js,{className:"h-4 w-4 text-muted-foreground"}),r.jsx("span",{className:"text-sm font-medium",children:"Trendy"})]}),r.jsx("p",{className:"text-sm text-muted-foreground",children:w.activeUsers>0?`${w.activeUsers} unikalnych użytkowników aktywnych w wybranym okresie`:"Brak aktywności w wybranym okresie"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(pt,{className:"h-4 w-4 text-muted-foreground"}),r.jsx("span",{className:"text-sm font-medium",children:"Wskaźnik ukończeń"})]}),r.jsxs("p",{className:"text-sm text-muted-foreground",children:[w.engagementRate,"% rozpoczętych aktywności zostało ukończonych"]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Tt,{className:"h-4 w-4 text-muted-foreground"}),r.jsx("span",{className:"text-sm font-medium",children:"Średnie zaangażowanie"})]}),r.jsxs("p",{className:"text-sm text-muted-foreground",children:["Średnio ",w.avgTimeHours," godzin nauki na użytkownika"]})]})]})})]})]})},IW=()=>{const[t,e]=j.useState("all"),[s,n]=j.useState(null),[i,a]=j.useState("progress"),o={queryOptions:{staleTime:1/0,gcTime:1800*1e3,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,refetchInterval:!1,retry:0}},{data:l}=Y({resource:"courses",filters:[{field:"is_published",operator:"eq",value:!0}],pagination:{mode:"off"},...o}),{data:c}=Y({resource:"activities",filters:[{field:"is_published",operator:"eq",value:!0}],pagination:{mode:"off"},meta:{select:"id, topic_id, type, topics(id, course_id)"},...o}),{data:u}=Y({resource:"activity_progress",pagination:{mode:"off"},meta:{select:"*, activities(id, topic_id, type, topics(id, course_id))"},...o}),{data:d}=Y({resource:"groups",pagination:{mode:"off"},...o}),{data:h}=Y({resource:"group_members",pagination:{mode:"off"},filters:t!=="all"?[{field:"group_id",operator:"eq",value:parseInt(t)}]:[],...o}),f=j.useMemo(()=>{if(!l?.data||!c?.data||!u?.data)return[];const g=new Map;return l.data.forEach(y=>{const b=typeof y.id=="number"?y.id:parseInt(y.id),S=c.data.filter(M=>M.topics?.course_id===b).length,z=u.data.filter(M=>M.activities?.topics?.course_id===b),N=t!=="all"&&h?.data?z.filter(M=>h.data.some(O=>O.user_id===M.user_id)):z,k=new Set(N.map(M=>M.user_id)),C=new Map,T=new Map;N.forEach(M=>{if(M.completed_at){const O=C.get(M.user_id)||0;C.set(M.user_id,O+1)}if(M.score!==null&&M.score!==void 0){const O=T.get(M.user_id)||[];O.push(Number(M.score)),T.set(M.user_id,O)}});const v=C.size,_=v>0?Array.from(C.values()).reduce((M,O)=>M+O,0)/v:0,A=Array.from(T.values()).flat(),E=A.length>0?Math.round(A.reduce((M,O)=>M+O,0)/A.length):null;g.set(b,{courseId:b,courseTitle:y.title||"",totalActivities:S,completedActivities:Math.round(_),avgScore:E,totalStudents:k.size,activeStudents:v})}),Array.from(g.values()).filter(y=>y.totalActivities>0).sort((y,b)=>{const w=y.totalActivities>0?y.completedActivities/y.totalActivities:0;return(b.totalActivities>0?b.completedActivities/b.totalActivities:0)-w})},[l?.data,c?.data,u?.data,t,h?.data]),m=j.useMemo(()=>{if(!u?.data||!f.length)return[];const g=new Map;f.forEach(b=>{const w=u.data.filter(z=>z.activities?.topics?.course_id===b.courseId);(t!=="all"&&h?.data?w.filter(z=>h.data.some(N=>N.user_id===z.user_id)):w).forEach(z=>{g.has(z.user_id)||g.set(z.user_id,new Map);const N=g.get(z.user_id);N.has(b.courseId)||N.set(b.courseId,{userId:z.user_id,courseId:b.courseId,courseTitle:b.courseTitle,completedActivities:0,totalActivities:b.totalActivities,avgScore:null,lastActivity:null,timeSpent:0});const k=N.get(b.courseId);if(z.completed_at&&k.completedActivities++,z.score!==null&&z.score!==void 0){const C=[];k.avgScore!==null&&C.push(k.avgScore),C.push(Number(z.score)),k.avgScore=Math.round(C.reduce((T,v)=>T+v,0)/C.length)}k.timeSpent+=z.time_spent||0,(!k.lastActivity||new Date(z.started_at)>new Date(k.lastActivity))&&(k.lastActivity=z.started_at)})});const y=[];return g.forEach(b=>{b.forEach(w=>{y.push(w)})}),y.sort((b,w)=>{switch(i){case"progress":{const S=b.totalActivities>0?b.completedActivities/b.totalActivities:0;return(w.totalActivities>0?w.completedActivities/w.totalActivities:0)-S}case"score":return(w.avgScore||0)-(b.avgScore||0);case"activity":return new Date(w.lastActivity||0).getTime()-new Date(b.lastActivity||0).getTime();default:return 0}})},[u?.data,f,t,h?.data,i]),p=j.useMemo(()=>{const g=[{name:"Rozpoczęli kurs",value:0,fill:"#8884d8"},{name:"Ukończyli 25%",value:0,fill:"#83a6ed"},{name:"Ukończyli 50%",value:0,fill:"#8dd1e1"},{name:"Ukończyli 75%",value:0,fill:"#82ca9d"},{name:"Ukończyli 100%",value:0,fill:"#67b26f"}],y=new Map;return m.forEach(b=>{const w=b.totalActivities>0?b.completedActivities/b.totalActivities*100:0,S=y.get(b.userId)||0;y.set(b.userId,Math.max(S,w))}),y.forEach(b=>{b>0&&g[0].value++,b>=25&&g[1].value++,b>=50&&g[2].value++,b>=75&&g[3].value++,b>=100&&g[4].value++}),g},[m]),x=j.useMemo(()=>{const g=new Set(m.map(z=>z.userId)).size,y=new Set(m.filter(z=>z.completedActivities>0).map(z=>z.userId)).size,b=f.length>0?Math.round(f.reduce((z,N)=>z+(N.totalActivities>0?N.completedActivities/N.totalActivities*100:0),0)/f.length):0,w=f.filter(z=>z.avgScore!==null),S=w.length>0?Math.round(w.reduce((z,N)=>z+N.avgScore,0)/w.length):0;return{totalStudents:g,activeStudents:y,avgCompletion:b,avgScore:S}},[m,f]);return r.jsxs(X,{children:[r.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx(Ke,{to:"/teacher/reports/overview",children:r.jsxs(D,{variant:"ghost",size:"sm",children:[r.jsx(Pe,{className:"mr-2 h-4 w-4"}),"Powrót do centrum raportów"]})}),r.jsx("h1",{className:"text-2xl font-bold",children:"Raport postępów"})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(Ee,{value:t,onValueChange:e,children:[r.jsx(_e,{className:"w-[200px]",children:r.jsx(De,{placeholder:"Wybierz grupę"})}),r.jsxs(Ae,{children:[r.jsx(ee,{value:"all",children:"Wszystkie grupy"}),d?.data?.map(g=>r.jsx(ee,{value:g.id?.toString()||"",children:g.name||"Bez nazwy"},g.id||"unknown"))]})]}),r.jsxs(D,{variant:"outline",size:"sm",children:[r.jsx($1,{className:"mr-2 h-4 w-4"}),"Eksportuj"]})]})]}),r.jsxs("div",{className:"grid gap-4 md:grid-cols-4 mb-6",children:[r.jsxs(P,{children:[r.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(L,{className:"text-sm font-medium",children:"Wszyscy uczniowie"}),r.jsx(ge,{className:"h-4 w-4 text-muted-foreground"})]}),r.jsxs(I,{children:[r.jsx("div",{className:"text-2xl font-bold",children:x.totalStudents}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"w wybranych grupach"})]})]}),r.jsxs(P,{children:[r.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(L,{className:"text-sm font-medium",children:"Aktywni uczniowie"}),r.jsx(Et,{className:"h-4 w-4 text-muted-foreground"})]}),r.jsxs(I,{children:[r.jsx("div",{className:"text-2xl font-bold",children:x.activeStudents}),r.jsx("p",{className:"text-xs text-muted-foreground",children:x.totalStudents>0?`${Math.round(x.activeStudents/x.totalStudents*100)}% wszystkich`:"0% wszystkich"})]})]}),r.jsxs(P,{children:[r.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(L,{className:"text-sm font-medium",children:"Średni postęp"}),r.jsx(Se,{className:"h-4 w-4 text-muted-foreground"})]}),r.jsxs(I,{children:[r.jsxs("div",{className:"text-2xl font-bold",children:[x.avgCompletion,"%"]}),r.jsx(un,{value:x.avgCompletion,className:"mt-2"})]})]}),r.jsxs(P,{children:[r.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(L,{className:"text-sm font-medium",children:"Średni wynik"}),r.jsx(pt,{className:"h-4 w-4 text-muted-foreground"})]}),r.jsxs(I,{children:[r.jsxs("div",{className:"text-2xl font-bold",children:[x.avgScore,"%"]}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"z ukończonych quizów"})]})]})]}),r.jsxs("div",{className:"grid gap-6 lg:grid-cols-2 mb-6",children:[r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Postęp według kursów"})}),r.jsx(I,{children:r.jsx(ht,{width:"100%",height:300,children:r.jsxs(sc,{data:f,layout:"vertical",children:[r.jsx(Ms,{strokeDasharray:"3 3"}),r.jsx(ys,{type:"number",domain:[0,100]}),r.jsx(is,{dataKey:"courseTitle",type:"category",width:120,tick:{fontSize:12}}),r.jsx(gt,{formatter:g=>`${g}%`,content:({active:g,payload:y})=>{if(g&&y&&y.length){const b=y[0].payload;return r.jsxs("div",{className:"bg-white p-2 border rounded shadow-sm",children:[r.jsx("p",{className:"font-medium text-sm",children:b.courseTitle}),r.jsxs("p",{className:"text-xs text-muted-foreground",children:["Ukończono: ",b.completedActivities,"/",b.totalActivities," aktywności"]}),r.jsxs("p",{className:"text-xs text-muted-foreground",children:["Aktywnych: ",b.activeStudents,"/",b.totalStudents," uczniów"]}),b.avgScore!==null&&r.jsxs("p",{className:"text-xs text-muted-foreground",children:["Średni wynik: ",b.avgScore,"%"]})]})}return null}}),r.jsx(Wa,{dataKey:g=>g.totalActivities>0?Math.round(g.completedActivities/g.totalActivities*100):0,fill:"#8884d8",name:"Postęp",isAnimationActive:!1})]},`${f.map(g=>g.courseId).join("-")}`)})})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Lejek ukończeń"})}),r.jsx(I,{children:r.jsx(ht,{width:"100%",height:300,children:r.jsxs(iA,{children:[r.jsx(gt,{}),r.jsxs(aA,{dataKey:"value",data:p,isAnimationActive:!1,children:[r.jsx(oA,{position:"center",fill:"#fff"}),p.map((g,y)=>r.jsx(Tn,{fill:g.fill},`cell-${y}`))]})]})})})]})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center justify-between",children:[r.jsx("span",{children:"Szczegółowe postępy uczniów"}),r.jsx("div",{className:"flex gap-2",children:r.jsxs(Ee,{value:i,onValueChange:g=>a(g),children:[r.jsx(_e,{className:"w-[150px]",children:r.jsx(De,{})}),r.jsxs(Ae,{children:[r.jsx(ee,{value:"progress",children:"Sortuj wg postępu"}),r.jsx(ee,{value:"score",children:"Sortuj wg wyniku"}),r.jsx(ee,{value:"activity",children:"Sortuj wg aktywności"})]})]})})]})}),r.jsxs(I,{children:[r.jsx("div",{className:"rounded-md border",children:r.jsxs(fr,{children:[r.jsx(mr,{children:r.jsxs(Nt,{children:[r.jsx(de,{children:"Uczeń"}),r.jsx(de,{children:"Kurs"}),r.jsx(de,{children:"Postęp"}),r.jsx(de,{children:"Średni wynik"}),r.jsx(de,{children:"Czas nauki"}),r.jsx(de,{children:"Ostatnia aktywność"})]})}),r.jsx(pr,{children:m.slice(0,20).map((g,y)=>{const b=g.totalActivities>0?Math.round(g.completedActivities/g.totalActivities*100):0;return r.jsxs(Nt,{children:[r.jsxs(ue,{className:"font-medium",children:["Uczeń #",y+1]}),r.jsx(ue,{children:g.courseTitle}),r.jsx(ue,{children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(un,{value:b,className:"w-[60px]"}),r.jsxs("span",{className:"text-sm text-muted-foreground",children:[b,"%"]})]})}),r.jsx(ue,{children:g.avgScore!==null?r.jsxs(V,{variant:g.avgScore>=70?"default":"secondary",children:[g.avgScore,"%"]}):r.jsx("span",{className:"text-muted-foreground",children:"-"})}),r.jsxs(ue,{children:[Math.floor(g.timeSpent/60),"h ",g.timeSpent%60,"m"]}),r.jsx(ue,{children:g.lastActivity?new Date(g.lastActivity).toLocaleDateString("pl-PL"):"-"})]},`${g.userId}-${g.courseId}`)})})]})}),m.length>20&&r.jsx("div",{className:"mt-4 text-center",children:r.jsxs(D,{variant:"outline",size:"sm",children:["Zobacz wszystkich (",m.length,")"]})})]})]})]})},wz=["#94a3b8","#60a5fa","#818cf8","#a78bfa","#c084fc","#e879f9","#f472b6","#fb923c","#fbbf24","#fde047"],Dj=t=>{const e=Math.min(Math.floor((t-1)/10),9);return wz[e]},OW=()=>{const[t,e]=j.useState("all"),[s,n]=j.useState("30d"),[i,a]=j.useState(!1),o=()=>{const N=new Date,k=new Date;switch(s){case"7d":k.setDate(k.getDate()-7);break;case"30d":k.setDate(k.getDate()-30);break;case"90d":k.setDate(k.getDate()-90);break}return{start:k,end:N}},{start:l}=o(),c={queryOptions:{staleTime:1/0,gcTime:1800*1e3,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,refetchInterval:!1,retry:0}},{data:u}=Y({resource:"user_stats",pagination:{mode:"off"},sorters:[{field:"total_points",order:"desc"}],meta:{select:"*, users(full_name, email, role)"},...c}),{data:d}=Y({resource:"groups",pagination:{mode:"off"},...c}),{data:h}=Y({resource:"group_members",filters:t!=="all"?[{field:"group_id",operator:"eq",value:parseInt(t)}]:[],pagination:{mode:"off"},...c}),{data:f}=Y({resource:"activity_progress",filters:[{field:"started_at",operator:"gte",value:l.toISOString()}],pagination:{mode:"off"},meta:{select:"*, activities(type)"},...c}),m=j.useMemo(()=>{let N=u?.data||[];if(N=N.filter(k=>!k.users?.role||k.users.role==="student"),t!=="all"&&h?.data){const k=h.data.map(C=>C.user_id);N=N.filter(C=>k.includes(C.user_id))}if(i){const k=new Date;k.setDate(k.getDate()-7),N=N.filter(C=>new Date(C.last_active)>k)}return N},[u?.data,t,h?.data,i]),p=j.useMemo(()=>{const N=m.length,k=m.reduce((_,A)=>_+A.total_points,0),C=N>0?Math.round(m.reduce((_,A)=>_+A.current_level,0)/N):0,T=m.filter(_=>_.daily_streak>0).length,v=Math.max(...m.map(_=>_.daily_streak),0);return{totalUsers:N,totalPoints:k,avgLevel:C,activeStreaks:T,maxStreak:v}},[m]),x=j.useMemo(()=>{const N=new Map;return m.forEach(k=>{const C=Math.floor((k.current_level-1)/10)*10+1;N.set(C,(N.get(C)||0)+1)}),Array.from(N.entries()).map(([k,C])=>({level:`${k}-${k+9}`,count:C,percentage:m.length>0?Math.round(C/m.length*100):0})).sort((k,C)=>parseInt(k.level)-parseInt(C.level))},[m]),g=j.useMemo(()=>m.slice(0,10),[m]),y=j.useMemo(()=>{if(!f?.data)return[];const N=new Map;return f.data.forEach(k=>{if(k.activities?.type==="quiz"&&k.completed_at){const C=N.get(k.user_id)||0;N.set(k.user_id,C+1)}}),m.map(k=>({points:k.total_points,quizzes:N.get(k.user_id)||0,level:k.current_level,streak:k.daily_streak,timeHours:Math.round((k.total_time_spent||0)/60)}))},[m,f?.data]),b=j.useMemo(()=>{const N=[{range:"0",count:0},{range:"1-3",count:0},{range:"4-7",count:0},{range:"8-14",count:0},{range:"15-30",count:0},{range:"30+",count:0}];return m.forEach(k=>{k.daily_streak===0?N[0].count++:k.daily_streak<=3?N[1].count++:k.daily_streak<=7?N[2].count++:k.daily_streak<=14?N[3].count++:k.daily_streak<=30?N[4].count++:N[5].count++}),N},[m]),w=j.useMemo(()=>{if(!f?.data)return[];const N=new Map,k=[];for(let C=13;C>=0;C--){const T=new Date;T.setDate(T.getDate()-C);const v=T.toISOString().split("T")[0];k.push(v),N.set(v,{points:0,activities:0})}return f.data.forEach(C=>{const T=C.started_at.split("T")[0];if(N.has(T)){const v=N.get(T);v.activities++,C.activities?.type==="material"&&C.completed_at?v.points+=10:C.activities?.type==="quiz"&&C.score!==null&&C.score!==void 0&&(v.points+=Math.round(20+C.score/100*30))}}),k.map(C=>({date:new Date(C+"T00:00:00").toLocaleDateString("pl-PL",{day:"numeric",month:"short"}),points:N.get(C)?.points||0}))},[f?.data]),S=j.useMemo(()=>{if(!f?.data)return[];let N=0,k=0;const C=m.filter(v=>v.daily_streak>0).length*5,T=m.filter(v=>v.current_level>1).length*50;return f.data.forEach(v=>{v.activities?.type==="quiz"&&v.score!==null&&v.score!==void 0?N+=Math.round(20+v.score/100*30):v.activities?.type==="material"&&v.completed_at&&(k+=10)}),[{type:"Ukończone quizy",points:N,color:"#8884d8"},{type:"Materiały",points:k,color:"#82ca9d"},{type:"Codzienne logowanie",points:C,color:"#ffc658"},{type:"Awans poziomów",points:T,color:"#ff8042"}].filter(v=>v.points>0).sort((v,_)=>_.points-v.points)},[f?.data,m]),z=j.useMemo(()=>{if(!f?.data)return[];const N=new Map;return f.data.forEach(k=>{k.activities?.type==="quiz"&&k.completed_at&&N.set(k.user_id,(N.get(k.user_id)||0)+1)}),g.map(k=>({...k,quizzesCompleted:N.get(k.user_id)||0}))},[g,f?.data]);return r.jsxs(X,{children:[r.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx(Ke,{to:"/teacher/reports/overview",children:r.jsxs(D,{variant:"ghost",size:"sm",children:[r.jsx(Pe,{className:"mr-2 h-4 w-4"}),"Powrót do centrum raportów"]})}),r.jsx("h1",{className:"text-2xl font-bold",children:"Raport gamifikacji"})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(Ee,{value:t,onValueChange:e,children:[r.jsx(_e,{className:"w-[200px]",children:r.jsx(De,{placeholder:"Wybierz grupę"})}),r.jsxs(Ae,{children:[r.jsx(ee,{value:"all",children:"Wszystkie grupy"}),d?.data?.map(N=>r.jsx(ee,{value:N.id.toString(),children:N.name},N.id))]})]}),r.jsxs(Ee,{value:s,onValueChange:n,children:[r.jsx(_e,{className:"w-[150px]",children:r.jsx(De,{})}),r.jsxs(Ae,{children:[r.jsx(ee,{value:"7d",children:"Ostatnie 7 dni"}),r.jsx(ee,{value:"30d",children:"Ostatnie 30 dni"}),r.jsx(ee,{value:"90d",children:"Ostatnie 90 dni"})]})]}),r.jsx(D,{variant:i?"default":"outline",size:"sm",onClick:()=>a(!i),children:"Tylko aktywni"})]})]}),r.jsxs("div",{className:"grid gap-4 md:grid-cols-5 mb-6",children:[r.jsxs(P,{children:[r.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(L,{className:"text-sm font-medium",children:"Uczniowie"}),r.jsx(ft,{className:"h-4 w-4 text-muted-foreground"})]}),r.jsxs(I,{children:[r.jsx("div",{className:"text-2xl font-bold",children:p.totalUsers}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"w rankingu"})]})]}),r.jsxs(P,{children:[r.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(L,{className:"text-sm font-medium",children:"Łączne punkty"}),r.jsx(Ii,{className:"h-4 w-4 text-muted-foreground"})]}),r.jsxs(I,{children:[r.jsx("div",{className:"text-2xl font-bold",children:p.totalPoints.toLocaleString("pl-PL")}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"zdobytych"})]})]}),r.jsxs(P,{children:[r.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(L,{className:"text-sm font-medium",children:"Średni poziom"}),r.jsx(B1,{className:"h-4 w-4 text-muted-foreground"})]}),r.jsxs(I,{children:[r.jsx("div",{className:"text-2xl font-bold",children:p.avgLevel}),r.jsx(un,{value:p.avgLevel/99*100,className:"mt-2 h-1"})]})]}),r.jsxs(P,{children:[r.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(L,{className:"text-sm font-medium",children:"Aktywne serie"}),r.jsx(An,{className:"h-4 w-4 text-muted-foreground"})]}),r.jsxs(I,{children:[r.jsx("div",{className:"text-2xl font-bold",children:p.activeStreaks}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"uczniów"})]})]}),r.jsxs(P,{children:[r.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(L,{className:"text-sm font-medium",children:"Najdłuższa seria"}),r.jsx(Vt,{className:"h-4 w-4 text-muted-foreground"})]}),r.jsxs(I,{children:[r.jsx("div",{className:"text-2xl font-bold",children:p.maxStreak}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"dni"})]})]})]}),r.jsxs("div",{className:"grid gap-6 lg:grid-cols-3 mb-6",children:[r.jsxs(P,{className:"lg:col-span-2",children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center gap-2",children:[r.jsx(ft,{className:"h-5 w-5 text-yellow-600"}),"Top 10 uczniów"]})}),r.jsx(I,{children:r.jsx("div",{className:"space-y-3",children:z.map((N,k)=>r.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg hover:bg-muted/50 transition-colors",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold
                      ${k===0?"bg-yellow-100 text-yellow-700 ring-2 ring-yellow-500":k===1?"bg-gray-100 text-gray-700 ring-2 ring-gray-400":k===2?"bg-orange-100 text-orange-700 ring-2 ring-orange-500":"bg-muted text-muted-foreground"}`,children:k+1}),r.jsx(bl,{children:r.jsx(jl,{className:"text-xs",children:N.users?.full_name?N.users.full_name.split(" ").map(C=>C[0]).join("").toUpperCase():`U${k+1}`})}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium",children:N.users?.full_name||`Uczeń #${k+1}`}),r.jsxs("div",{className:"flex gap-2 mt-1",children:[r.jsxs(V,{variant:"outline",className:"text-xs",style:{borderColor:Dj(N.current_level),color:Dj(N.current_level)},children:["Poziom ",N.current_level]}),N.daily_streak>0&&r.jsxs(V,{variant:"secondary",className:"text-xs",children:[r.jsx(An,{className:"w-3 h-3 mr-1"}),N.daily_streak," dni"]}),N.perfect_scores>0&&r.jsxs(V,{variant:"secondary",className:"text-xs",children:[r.jsx(Ii,{className:"w-3 h-3 mr-1"}),N.perfect_scores," perfect"]})]})]})]}),r.jsxs("div",{className:"text-right",children:[r.jsx("p",{className:"text-lg font-bold",children:N.total_points.toLocaleString("pl-PL")}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"punktów"})]})]},N.user_id))})})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Rozkład poziomów"})}),r.jsx(I,{children:r.jsx(ht,{width:"100%",height:300,children:r.jsxs(Su,{children:[r.jsx(Cu,{data:x,cx:"50%",cy:"50%",labelLine:!1,label:({percentage:N})=>N>0?`${N}%`:"",outerRadius:80,fill:"#8884d8",dataKey:"count",isAnimationActive:!1,children:x.map((N,k)=>r.jsx(Tn,{fill:wz[k]},`cell-${k}`))}),r.jsx(gt,{}),r.jsx(Ma,{formatter:(N,k)=>k?.payload&&"level"in k.payload?`Poziom ${k.payload.level}`:""})]})})})]})]}),r.jsxs("div",{className:"grid gap-6 lg:grid-cols-2 mb-6",children:[r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Punkty vs Ukończone quizy"})}),r.jsx(I,{children:r.jsx(ht,{width:"100%",height:300,children:r.jsxs(U1,{children:[r.jsx(Ms,{strokeDasharray:"3 3"}),r.jsx(ys,{dataKey:"quizzes",name:"Ukończone quizy"}),r.jsx(is,{dataKey:"points",name:"Punkty"}),r.jsx(W1,{dataKey:"level",range:[50,200]}),r.jsx(gt,{cursor:{strokeDasharray:"3 3"}}),r.jsx(K1,{name:"Uczniowie",data:y,fill:"#8884d8",isAnimationActive:!1})]})})})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Rozkład daily streaks"})}),r.jsx(I,{children:r.jsx(ht,{width:"100%",height:300,children:r.jsxs(sc,{data:b,children:[r.jsx(Ms,{strokeDasharray:"3 3"}),r.jsx(ys,{dataKey:"range"}),r.jsx(is,{}),r.jsx(gt,{}),r.jsx(Wa,{dataKey:"count",fill:"#fbbf24",name:"Liczba uczniów",isAnimationActive:!1,children:b.map((N,k)=>r.jsx(Tn,{fill:k===0?"#94a3b8":k<=2?"#fbbf24":k<=4?"#f97316":"#ef4444"},`cell-${k}`))})]},`${b.map(N=>N.count).join("-")}`)})})]})]}),r.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Zdobywane punkty w czasie"})}),r.jsx(I,{children:r.jsx(ht,{width:"100%",height:250,children:r.jsxs(V1,{data:w,children:[r.jsx(Ms,{strokeDasharray:"3 3"}),r.jsx(ys,{dataKey:"date"}),r.jsx(is,{}),r.jsx(gt,{}),r.jsx(Xp,{type:"monotone",dataKey:"points",stroke:"#8884d8",strokeWidth:2,dot:{fill:"#8884d8"},name:"Punkty",isAnimationActive:!1})]},`${w.map(N=>N.points).join("-")}`)})})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Źródła punktów"})}),r.jsx(I,{children:r.jsx(ht,{width:"100%",height:250,children:r.jsxs(Su,{children:[r.jsx(Cu,{data:S,cx:"50%",cy:"50%",labelLine:!1,label:({value:N})=>N!==void 0&&N>0?`${N.toLocaleString("pl-PL")}`:"",outerRadius:80,fill:"#8884d8",dataKey:"points",isAnimationActive:!1,children:S.map((N,k)=>r.jsx(Tn,{fill:N.color},`cell-${k}`))}),r.jsx(gt,{}),r.jsx(Ma,{})]})})})]})]}),r.jsxs(P,{className:"mt-6 bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-950/20 dark:to-blue-950/20",children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center gap-2",children:[r.jsx(Os,{className:"h-5 w-5 text-purple-600"}),"Kluczowe osiągnięcia"]})}),r.jsx(I,{children:r.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(pt,{className:"h-4 w-4 text-muted-foreground"}),r.jsx("span",{className:"text-sm font-medium",children:"Najaktywniejszy uczeń"})]}),r.jsxs("p",{className:"text-sm text-muted-foreground",children:[z[0]?.quizzesCompleted||0," ukończonych quizów"]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Et,{className:"h-4 w-4 text-muted-foreground"}),r.jsx("span",{className:"text-sm font-medium",children:"Największy wzrost"})]}),r.jsxs("p",{className:"text-sm text-muted-foreground",children:["+",Math.round(p.totalPoints*.15).toLocaleString("pl-PL")," punktów w tym okresie"]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(An,{className:"h-4 w-4 text-muted-foreground"}),r.jsx("span",{className:"text-sm font-medium",children:"Zaangażowanie"})]}),r.jsxs("p",{className:"text-sm text-muted-foreground",children:[p.totalUsers>0?Math.round(p.activeStreaks/p.totalUsers*100):0,"% uczniów ma aktywną serię"]})]})]})})]})]})},Ro={veryActive:"#22c55e",active:"#3b82f6",moderate:"#f59e0b",lowActivity:"#ef4444",inactive:"#6b7280"},ss={champions:"#8b5cf6",loyalists:"#3b82f6",potentials:"#10b981",newUsers:"#f59e0b",atRisk:"#ef4444",dormant:"#6b7280"},RW=()=>{const[t,e]=j.useState("30d"),[s,n]=j.useState("all"),[i,a]=j.useState("all"),o=j.useMemo(()=>({staleTime:1/0,gcTime:1800*1e3,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,refetchInterval:1e4,retry:0}),[]),{startISO:l}=j.useMemo(()=>{const v=new Date,_=new Date(v);switch(t){case"7d":_.setDate(_.getDate()-7);break;case"30d":_.setDate(_.getDate()-30);break;case"90d":_.setDate(_.getDate()-90);break}return _.setHours(0,0,0,0),{startISO:_.toISOString(),endISO:v.toISOString()}},[t]),c=j.useMemo(()=>s!=="all"?[{field:"role",operator:"eq",value:s}]:[],[s]),u=j.useMemo(()=>({select:"*, users!user_stats_user_id_fkey(email, full_name)"}),[]),d=j.useMemo(()=>({select:"*, activities(type)"}),[]),h=j.useMemo(()=>[{field:"started_at",operator:"gte",value:l}],[l]),{data:f}=Y({resource:"users",pagination:{mode:"off"},filters:c,queryOptions:o}),{data:m}=Y({resource:"user_stats",pagination:{mode:"off"},meta:u,queryOptions:o}),{data:p}=Y({resource:"activity_progress",filters:h,pagination:{mode:"off"},meta:d,queryOptions:o}),x=j.useMemo(()=>{if(!f?.data||!m?.data||!p?.data)return[];const v=new Map(m.data.map(A=>[A.user_id,A])),_=new Map;return p.data.forEach(A=>{const E=_.get(A.user_id)||[];E.push(A),_.set(A.user_id,E)}),f.data.map(A=>{const E=v.get(A.id),M=_.get(A.id)||[];let O;const R=E?.last_active?Math.floor((Date.now()-new Date(E.last_active).getTime())/(1e3*60*60*24)):999;E?R>30?O="dormant":R>14?O="atRisk":E.total_points<100&&R<7?O="newUsers":E.total_points>1e3&&E.daily_streak>7?O="champions":E.daily_streak>3?O="loyalists":O="potentials":O="dormant";const B=M.filter($=>typeof $.score=="number"),K=B.length?Math.round(B.reduce(($,J)=>$+J.score,0)/B.length):null;return{...A,stats:E,activities:M,segment:O,daysSinceLastActive:R,avgScore:K}})},[f?.data,m?.data,p?.data]),g=j.useMemo(()=>i==="all"?x:x.filter(v=>v.segment===i),[x,i]),y=j.useMemo(()=>{const v=g.length,_=g.filter(B=>B.is_active).length,A=g.filter(B=>B.daysSinceLastActive<=7).length,E=g.filter(B=>B.stats),M=E.length?Math.round(E.reduce((B,K)=>B+(K.stats?.current_level||0),0)/E.length):0,O=E.filter(B=>(B.stats?.daily_streak||0)>0).length,R=E.length?Math.round(E.reduce((B,K)=>B+(K.stats?.total_time_spent||0),0)/E.length/60):0;return{total:v,active:_,activePercent:v>0?Math.round(_/v*100):0,activeLastWeek:A,activeLastWeekPercent:v>0?Math.round(A/v*100):0,avgLevel:M,withStreaks:O,streakPercent:v>0?Math.round(O/v*100):0,avgTimeHours:R}},[g]),b=j.useMemo(()=>{const v=[{name:"Champions",key:"champions",count:0,color:ss.champions,description:"Wysokie punkty, aktywna seria"},{name:"Lojaliści",key:"loyalists",count:0,color:ss.loyalists,description:"Regularna aktywność"},{name:"Potencjalni",key:"potentials",count:0,color:ss.potentials,description:"Niska regularność"},{name:"Nowi",key:"newUsers",count:0,color:ss.newUsers,description:"Niedawno dołączyli"},{name:"Zagrożeni",key:"atRisk",count:0,color:ss.atRisk,description:"Spadek aktywności"},{name:"Nieaktywni",key:"dormant",count:0,color:ss.dormant,description:"Brak aktywności >30 dni"}],_={};return x.forEach(A=>{_[A.segment]=(_[A.segment]||0)+1}),v.map(A=>({...A,count:_[A.key]||0})).filter(A=>A.count>0)},[x]),w=j.useMemo(()=>{const v=[{name:"Champions",key:"champions",count:0,color:ss.champions,description:"Wysokie punkty, aktywna seria"},{name:"Lojaliści",key:"loyalists",count:0,color:ss.loyalists,description:"Regularna aktywność"},{name:"Potencjalni",key:"potentials",count:0,color:ss.potentials,description:"Niska regularność"},{name:"Nowi",key:"newUsers",count:0,color:ss.newUsers,description:"Niedawno dołączyli"},{name:"Zagrożeni",key:"atRisk",count:0,color:ss.atRisk,description:"Spadek aktywności"},{name:"Nieaktywni",key:"dormant",count:0,color:ss.dormant,description:"Brak aktywności >30 dni"}],_={};return x.forEach(A=>{_[A.segment]=(_[A.segment]||0)+1}),v.map(A=>({...A,count:_[A.key]||0}))},[x]),S=j.useMemo(()=>{const v=[{name:"Bardzo aktywni",range:"Codziennie",count:0,color:Ro.veryActive},{name:"Aktywni",range:"2-6 dni/tydz",count:0,color:Ro.active},{name:"Umiarkowani",range:"1 dzień/tydz",count:0,color:Ro.moderate},{name:"Niska aktywność",range:"<1 dzień/tydz",count:0,color:Ro.lowActivity},{name:"Nieaktywni",range:"Brak",count:0,color:Ro.inactive}];return g.forEach(_=>{!_.stats||_.daysSinceLastActive>30?v[4].count++:_.daysSinceLastActive<=1?v[0].count++:_.daysSinceLastActive<=3?v[1].count++:_.daysSinceLastActive<=7?v[2].count++:v[3].count++}),v},[g]),z=j.useMemo(()=>{const v=new Map;return p?.data?.forEach(A=>{const E=A.started_at.slice(0,10),M=v.get(E)||new Set;M.add(A.user_id),v.set(E,M)}),Array.from(v.keys()).sort().slice(-30).map(A=>({date:new Date(A).toLocaleDateString("pl-PL",{day:"numeric",month:"short"}),activeUsers:v.get(A)?.size||0,newUsers:g.filter(E=>E.created_at?.slice(0,10)===A).length}))},[p?.data,g]),N=j.useMemo(()=>g.filter(v=>v.stats&&(v.stats.total_time_spent||0)>0).map(v=>({timeHours:Math.round((v.stats.total_time_spent||0)/60),points:v.stats.total_points,level:v.stats.current_level,streak:v.stats.daily_streak,segment:v.segment})),[g]),k=j.useMemo(()=>g.filter(v=>v.stats).sort((v,_)=>(_.stats?.total_points||0)-(v.stats?.total_points||0)).slice(0,10),[g]),C=j.useMemo(()=>{const v=new Map,_=4;return g.forEach(A=>{const E=new Date(A.created_at);E.setHours(0,0,0,0),E.setDate(E.getDate()-E.getDay());const M=E.toISOString().slice(0,10);v.has(M)||v.set(M,{total:0,retained:Array(_).fill(0)});const O=v.get(M);O.total++;for(let R=0;R<_;R++){const B=new Date(E);B.setDate(B.getDate()+R*7);const K=new Date(B);K.setDate(K.getDate()+7),A.activities.some(J=>{const ie=new Date(J.started_at);return ie>=B&&ie<K})&&O.retained[R]++}}),Array.from(v.entries()).map(([A,E])=>({cohort:new Date(A).toLocaleDateString("pl-PL",{day:"numeric",month:"short"}),week0:100,week1:E.total>0?Math.round(E.retained[1]/E.total*100):0,week2:E.total>0?Math.round(E.retained[2]/E.total*100):0,week3:E.total>0?Math.round(E.retained[3]/E.total*100):0,total:E.total})).slice(-4)},[g]),T=[{label:"Wszyscy użytkownicy",value:y.total.toString(),subValue:`${y.activePercent}% aktywnych`,icon:ge,color:"text-blue-600",bgColor:"bg-blue-50"},{label:"Aktywni w ostatnim tygodniu",value:y.activeLastWeek.toString(),subValue:`${y.activeLastWeekPercent}% wszystkich`,icon:K_,color:"text-green-600",bgColor:"bg-green-50"},{label:"Średni poziom",value:y.avgLevel.toString(),subValue:`${y.avgTimeHours}h średnio`,icon:Os,color:"text-purple-600",bgColor:"bg-purple-50"},{label:"Z aktywną serią",value:y.withStreaks.toString(),subValue:`${y.streakPercent}% wszystkich`,icon:Vt,color:"text-orange-600",bgColor:"bg-orange-50"}];return r.jsxs(X,{children:[r.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx(Ke,{to:"/teacher/reports/overview",children:r.jsxs(D,{variant:"ghost",size:"sm",children:[r.jsx(Pe,{className:"mr-2 h-4 w-4"}),"Powrót do centrum raportów"]})}),r.jsx("h1",{className:"text-2xl font-bold",children:"Analiza użytkowników"})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(Ee,{value:s,onValueChange:n,children:[r.jsx(_e,{className:"w-[150px]",children:r.jsx(De,{})}),r.jsxs(Ae,{children:[r.jsx(ee,{value:"all",children:"Wszystkie role"}),r.jsx(ee,{value:"student",children:"Uczniowie"}),r.jsx(ee,{value:"teacher",children:"Nauczyciele"}),r.jsx(ee,{value:"admin",children:"Administratorzy"})]})]}),r.jsxs(Ee,{value:i,onValueChange:a,children:[r.jsx(_e,{className:"w-[180px]",children:r.jsx(De,{})}),r.jsxs(Ae,{children:[r.jsx(ee,{value:"all",children:"Wszystkie segmenty"}),w.map(v=>r.jsxs(ee,{value:v.key,children:[v.name," (",v.count,")"]},v.key))]})]}),r.jsxs(Ee,{value:t,onValueChange:e,children:[r.jsx(_e,{className:"w-[150px]",children:r.jsx(De,{})}),r.jsxs(Ae,{children:[r.jsx(ee,{value:"7d",children:"Ostatnie 7 dni"}),r.jsx(ee,{value:"30d",children:"Ostatnie 30 dni"}),r.jsx(ee,{value:"90d",children:"Ostatnie 90 dni"})]})]})]})]}),r.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-6",children:T.map((v,_)=>r.jsxs(P,{children:[r.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(L,{className:"text-sm font-medium",children:v.label}),r.jsx("div",{className:`${v.bgColor} p-2 rounded-lg`,children:r.jsx(v.icon,{className:`h-4 w-4 ${v.color}`})})]}),r.jsxs(I,{children:[r.jsx("div",{className:"text-2xl font-bold",children:v.value}),r.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:v.subValue})]})]},_))}),r.jsxs(tx,{defaultValue:"segments",className:"space-y-4",children:[r.jsxs(Qd,{className:"grid w-full grid-cols-5",children:[r.jsx(Ks,{value:"segments",children:"Segmentacja"}),r.jsx(Ks,{value:"activity",children:"Aktywność"}),r.jsx(Ks,{value:"performance",children:"Wyniki"}),r.jsx(Ks,{value:"retention",children:"Retencja"}),r.jsx(Ks,{value:"leaderboard",children:"Ranking"})]}),r.jsxs(Hs,{value:"segments",className:"space-y-4",children:[r.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Segmentacja użytkowników"})}),r.jsx(I,{children:b.length===0?r.jsx("div",{className:"text-sm text-muted-foreground p-6 border rounded-lg",children:"Brak danych do wyświetlenia dla wybranego zakresu."}):r.jsx(ht,{width:"100%",height:300,children:r.jsxs(Su,{children:[r.jsx(Cu,{data:b,cx:"50%",cy:"50%",outerRadius:100,dataKey:"count",label:({name:v,percent:_})=>_!==void 0?`${v}: ${(_*100).toFixed(0)}%`:v,isAnimationActive:!1,children:b.map((v,_)=>r.jsx(Tn,{fill:v.color},`cell-${_}`))}),r.jsx(gt,{})]})})})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Charakterystyka segmentów"})}),r.jsx(I,{children:r.jsx("div",{className:"space-y-3",children:w.map(v=>r.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:v.color}}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium",children:v.name}),r.jsx("p",{className:"text-xs text-muted-foreground",children:v.description})]})]}),r.jsxs("div",{className:"text-right",children:[r.jsx("p",{className:"text-lg font-bold",children:v.count}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"użytkowników"})]})]},v.key))})})]})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center gap-2",children:[r.jsx(wu,{className:"h-5 w-5 text-orange-600"}),"Kluczowe obserwacje"]})}),r.jsx(I,{children:r.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[w.find(v=>v.key==="atRisk")?.count?r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center gap-2 text-orange-600",children:[r.jsx(H_,{className:"h-4 w-4"}),r.jsx("span",{className:"text-sm font-medium",children:"Użytkownicy zagrożeni"})]}),r.jsxs("p",{className:"text-sm text-muted-foreground",children:[w.find(v=>v.key==="atRisk")?.count," użytkowników wymaga uwagi – rozważ wysłanie powiadomień motywacyjnych"]})]}):null,w.find(v=>v.key==="champions")?.count?r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center gap-2 text-purple-600",children:[r.jsx(Os,{className:"h-4 w-4"}),r.jsx("span",{className:"text-sm font-medium",children:"Champions do wykorzystania"})]}),r.jsxs("p",{className:"text-sm text-muted-foreground",children:[w.find(v=>v.key==="champions")?.count," najaktywniejszych użytkowników – mogą być mentorami lub ambasadorami"]})]}):null,w.find(v=>v.key==="newUsers")?.count?r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[r.jsx(ge,{className:"h-4 w-4"}),r.jsx("span",{className:"text-sm font-medium",children:"Nowi użytkownicy"})]}),r.jsxs("p",{className:"text-sm text-muted-foreground",children:[w.find(v=>v.key==="newUsers")?.count," nowych użytkowników – upewnij się, że mają dobre wsparcie onboardingowe"]})]}):null]})})]})]}),r.jsxs(Hs,{value:"activity",className:"space-y-4",children:[r.jsx("div",{className:"grid gap-6 lg:grid-cols-2",children:r.jsxs(P,{className:"lg:col-span-2",children:[r.jsx(F,{children:r.jsx(L,{children:"Wzorzec aktywności użytkowników"})}),r.jsx(I,{children:r.jsx(ht,{width:"100%",height:300,children:r.jsxs(Gd,{data:z,children:[r.jsx(Ms,{strokeDasharray:"3 3"}),r.jsx(ys,{dataKey:"date"}),r.jsx(is,{}),r.jsx(gt,{}),r.jsx(Ma,{}),r.jsx(Zr,{type:"monotone",dataKey:"activeUsers",stackId:"1",stroke:"#3b82f6",fill:"#3b82f6",fillOpacity:.6,name:"Aktywni użytkownicy",isAnimationActive:!1}),r.jsx(Zr,{type:"monotone",dataKey:"newUsers",stackId:"1",stroke:"#10b981",fill:"#10b981",fillOpacity:.6,name:"Nowi użytkownicy",isAnimationActive:!1})]})})})]})}),r.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Poziomy aktywności"})}),r.jsx(I,{children:r.jsx(ht,{width:"100%",height:250,children:r.jsxs(sc,{data:S,children:[r.jsx(Ms,{strokeDasharray:"3 3"}),r.jsx(ys,{dataKey:"name"}),r.jsx(is,{}),r.jsx(gt,{}),r.jsx(Wa,{dataKey:"count",name:"Użytkownicy",isAnimationActive:!1,children:S.map((v,_)=>r.jsx(Tn,{fill:v.color},`cell-${_}`))})]})})})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Metryki zaangażowania"})}),r.jsxs(I,{className:"space-y-4",children:[r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Hd,{className:"h-4 w-4 text-muted-foreground"}),r.jsx("span",{className:"text-sm",children:"Średnia częstotliwość logowania"})]}),r.jsx(V,{variant:"outline",children:"3.2 dni/tydzień"})]}),r.jsx(un,{value:64,className:"h-2"})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Ze,{className:"h-4 w-4 text-muted-foreground"}),r.jsx("span",{className:"text-sm",children:"Średni czas sesji"})]}),r.jsx(V,{variant:"outline",children:"24 min"})]}),r.jsx(un,{value:48,className:"h-2"})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Se,{className:"h-4 w-4 text-muted-foreground"}),r.jsx("span",{className:"text-sm",children:"Ukończenia na użytkownika"})]}),r.jsx(V,{variant:"outline",children:"7.8 aktywności"})]}),r.jsx(un,{value:78,className:"h-2"})]})]})]})]})]}),r.jsxs(Hs,{value:"performance",className:"space-y-4",children:[r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Punkty vs Czas nauki"})}),r.jsx(I,{children:r.jsx(ht,{width:"100%",height:400,children:r.jsxs(U1,{children:[r.jsx(Ms,{strokeDasharray:"3 3"}),r.jsx(ys,{dataKey:"timeHours",name:"Czas nauki (h)"}),r.jsx(is,{dataKey:"points",name:"Punkty"}),r.jsx(W1,{dataKey:"level",range:[50,400]}),r.jsx(gt,{cursor:{strokeDasharray:"3 3"}}),r.jsx(Ma,{}),r.jsx(K1,{name:"Użytkownicy",data:N,fill:"#8884d8",isAnimationActive:!1,children:N.map((v,_)=>r.jsx(Tn,{fill:ss[v.segment]||"#8884d8"},`cell-${_}`))})]})})})]}),r.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Rozkład wyników"})}),r.jsx(I,{children:r.jsx("div",{className:"space-y-4",children:[{label:"90-100%",count:g.filter(v=>v.avgScore!==null&&v.avgScore>=90).length,color:"#22c55e"},{label:"80-89%",count:g.filter(v=>v.avgScore!==null&&v.avgScore>=80&&v.avgScore<90).length,color:"#84cc16"},{label:"70-79%",count:g.filter(v=>v.avgScore!==null&&v.avgScore>=70&&v.avgScore<80).length,color:"#eab308"},{label:"60-69%",count:g.filter(v=>v.avgScore!==null&&v.avgScore>=60&&v.avgScore<70).length,color:"#f97316"},{label:"<60%",count:g.filter(v=>v.avgScore!==null&&v.avgScore<60).length,color:"#ef4444"}].map(v=>{const _=g.filter(E=>E.avgScore!==null).length,A=_>0?v.count/_*100:0;return r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between text-sm",children:[r.jsx("span",{children:v.label}),r.jsxs("span",{className:"font-medium",children:[v.count," użytkowników"]})]}),r.jsx("div",{className:"relative h-8 bg-muted rounded-full overflow-hidden",children:r.jsx("div",{className:"absolute left-0 top-0 h-full transition-all duration-500",style:{width:`${A}%`,backgroundColor:v.color}})})]},v.label)})})})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Wskaźniki sukcesu"})}),r.jsx(I,{children:r.jsx(ht,{width:"100%",height:250,children:r.jsxs(lA,{cx:"50%",cy:"50%",innerRadius:"10%",outerRadius:"90%",data:[{name:"Ukończenia",value:68,fill:"#8884d8"},{name:"Zdawalność",value:74,fill:"#82ca9d"},{name:"Zaangażowanie",value:82,fill:"#ffc658"}],children:[r.jsx(cA,{dataKey:"value",isAnimationActive:!1}),r.jsx(Ma,{}),r.jsx(gt,{})]})})})]})]})]}),r.jsxs(Hs,{value:"retention",className:"space-y-4",children:[r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Analiza kohortowa retencji"})}),r.jsxs(I,{children:[r.jsx("div",{className:"overflow-x-auto",children:r.jsxs(fr,{children:[r.jsx(mr,{children:r.jsxs(Nt,{children:[r.jsx(de,{children:"Kohorta"}),r.jsx(de,{className:"text-center",children:"Tydzień 0"}),r.jsx(de,{className:"text-center",children:"Tydzień 1"}),r.jsx(de,{className:"text-center",children:"Tydzień 2"}),r.jsx(de,{className:"text-center",children:"Tydzień 3"}),r.jsx(de,{className:"text-center",children:"Liczba użytkowników"})]})}),r.jsx(pr,{children:C.map(v=>r.jsxs(Nt,{children:[r.jsx(ue,{className:"font-medium",children:v.cohort}),r.jsx(ue,{className:"text-center",children:r.jsxs("div",{className:"inline-flex items-center justify-center w-16 h-8 rounded",style:{backgroundColor:`rgba(34, 197, 94, ${v.week0/100})`},children:[v.week0,"%"]})}),r.jsx(ue,{className:"text-center",children:r.jsxs("div",{className:"inline-flex items-center justify-center w-16 h-8 rounded",style:{backgroundColor:`rgba(34, 197, 94, ${v.week1/100})`},children:[v.week1,"%"]})}),r.jsx(ue,{className:"text-center",children:r.jsxs("div",{className:"inline-flex items-center justify-center w-16 h-8 rounded",style:{backgroundColor:`rgba(34, 197, 94, ${v.week2/100})`},children:[v.week2,"%"]})}),r.jsx(ue,{className:"text-center",children:r.jsxs("div",{className:"inline-flex items-center justify-center w-16 h-8 rounded",style:{backgroundColor:`rgba(34, 197, 94, ${v.week3/100})`},children:[v.week3,"%"]})}),r.jsx(ue,{className:"text-center",children:v.total})]},v.cohort))})]})}),r.jsx("div",{className:"mt-4 p-4 bg-muted rounded-lg",children:r.jsxs("p",{className:"text-sm text-muted-foreground",children:[r.jsx("strong",{children:"Interpretacja:"})," Wartości pokazują procent użytkowników z danej kohorty, którzy byli aktywni w kolejnych tygodniach po dołączeniu."]})})]})]}),r.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Czynniki wpływające na retencję"})}),r.jsx(I,{children:r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(ri,{className:"h-5 w-5 text-purple-600"}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-sm",children:"Ukończenie pierwszego quizu"}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"+42% retencji po 30 dniach"})]})]}),r.jsx(V,{variant:"default",children:"Kluczowy"})]}),r.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(pt,{className:"h-5 w-5 text-blue-600"}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-sm",children:"Osiągnięcie 100 punktów"}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"+28% retencji po 30 dniach"})]})]}),r.jsx(V,{variant:"secondary",children:"Ważny"})]}),r.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(ge,{className:"h-5 w-5 text-green-600"}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-sm",children:"Dołączenie do grupy"}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"+15% retencji po 30 dniach"})]})]}),r.jsx(V,{variant:"outline",children:"Pomocny"})]})]})})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Prognoza churn"})}),r.jsx(I,{children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"text-center py-8",children:[r.jsx("div",{className:"text-4xl font-bold text-orange-600 mb-2",children:w.find(v=>v.key==="atRisk")?.count||0}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"użytkowników zagrożonych odejściem"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("p",{className:"text-sm font-medium",children:"Główne przyczyny:"}),r.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[r.jsx("li",{children:"• Brak aktywności powyżej 14 dni (78%)"}),r.jsx("li",{children:"• Niskie wyniki quizów (45%)"}),r.jsx("li",{children:"• Brak postępów w kursie (34%)"}),r.jsx("li",{children:"• Utrata daily streak (23%)"})]})]}),r.jsxs(D,{className:"w-full",variant:"outline",children:[r.jsx(wu,{className:"mr-2 h-4 w-4"}),"Wygeneruj kampanię reaktywacyjną"]})]})})]})]})]}),r.jsxs(Hs,{value:"leaderboard",className:"space-y-4",children:[r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center gap-2",children:[r.jsx(ft,{className:"h-5 w-5 text-yellow-600"}),"Top 10 użytkowników"]})}),r.jsx(I,{children:r.jsx("div",{className:"space-y-3",children:k.map((v,_)=>r.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg hover:bg-muted/50 transition-colors",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold
                        ${_===0?"bg-yellow-100 text-yellow-700 ring-2 ring-yellow-500":_===1?"bg-gray-100 text-gray-700 ring-2 ring-gray-400":_===2?"bg-orange-100 text-orange-700 ring-2 ring-orange-500":"bg-muted text-muted-foreground"}`,children:_+1}),r.jsx(bl,{children:r.jsx(jl,{className:"text-xs",children:v.full_name?.split(" ").map(A=>A[0]).join("")||v.email.substring(0,2).toUpperCase()})}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium",children:v.full_name||`Użytkownik ${_+1}`}),r.jsxs("div",{className:"flex gap-2 mt-1",children:[r.jsx(V,{variant:"outline",className:"text-xs",style:{borderColor:ss[v.segment]||"#8884d8",color:ss[v.segment]||"#8884d8"},children:w.find(A=>A.key===v.segment)?.name||v.segment}),r.jsxs(V,{variant:"secondary",className:"text-xs",children:["Poziom ",v.stats?.current_level||0]}),v.stats&&v.stats.daily_streak>0&&r.jsxs(V,{variant:"secondary",className:"text-xs",children:[r.jsx(Vt,{className:"w-3 h-3 mr-1"}),v.stats.daily_streak," dni"]})]})]})]}),r.jsxs("div",{className:"text-right",children:[r.jsx("p",{className:"text-lg font-bold",children:v.stats?.total_points.toLocaleString("pl-PL")||0}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"punktów"})]})]},v.id))})})]}),r.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{className:"text-base",children:"Najbardziej zaangażowani"})}),r.jsx(I,{children:r.jsx("div",{className:"space-y-3",children:g.filter(v=>v.stats).sort((v,_)=>(_.stats?.total_time_spent||0)-(v.stats?.total_time_spent||0)).slice(0,5).map((v,_)=>r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-sm",children:v.full_name||`Użytkownik ${_+1}`}),r.jsxs(V,{variant:"outline",children:[Math.round((v.stats?.total_time_spent||0)/60),"h"]})]},v.id))})})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{className:"text-base",children:"Najlepsze wyniki"})}),r.jsx(I,{children:r.jsx("div",{className:"space-y-3",children:g.filter(v=>v.avgScore!==null).sort((v,_)=>v.avgScore<_.avgScore?1:-1).slice(0,5).map((v,_)=>r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-sm",children:v.full_name||`Użytkownik ${_+1}`}),r.jsxs(V,{variant:v.avgScore>=80?"default":"secondary",children:[v.avgScore,"%"]})]},v.id))})})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{className:"text-base",children:"Najdłuższe serie"})}),r.jsx(I,{children:r.jsx("div",{className:"space-y-3",children:g.filter(v=>v.stats).sort((v,_)=>(_.stats?.daily_streak||0)-(v.stats?.daily_streak||0)).slice(0,5).map((v,_)=>r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-sm",children:v.full_name||`Użytkownik ${_+1}`}),r.jsxs(V,{variant:"outline",children:[r.jsx(Vt,{className:"w-3 h-3 mr-1"}),v.stats?.daily_streak," dni"]})]},v.id))})})]})]})]})]})]})},LW=()=>{const[t,e]=j.useState("30d"),[s,n]=j.useState("all"),[i,a]=j.useState("all"),o={queryOptions:{staleTime:1/0,gcTime:1800*1e3,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,refetchInterval:!1,retry:0}},l=()=>{const k=new Date,C=new Date;switch(t){case"7d":C.setDate(C.getDate()-7);break;case"30d":C.setDate(C.getDate()-30);break;case"90d":C.setDate(C.getDate()-90);break}return{start:C,end:k}},{start:c}=l(),{data:u}=Y({resource:"questions",pagination:{mode:"off"},...o}),{data:d}=Y({resource:"courses",pagination:{mode:"off"},...o}),{data:h}=Y({resource:"topics",filters:s!=="all"?[{field:"course_id",operator:"eq",value:parseInt(s)}]:[],pagination:{mode:"off"},...o}),{data:f}=Y({resource:"activities",filters:[{field:"type",operator:"eq",value:"quiz"},{field:"is_published",operator:"eq",value:!0}],pagination:{mode:"off"},...o}),{data:m}=Y({resource:"activity_progress",filters:[{field:"started_at",operator:"gte",value:c.toISOString()}],pagination:{mode:"off"},meta:{query:k=>k.not("score","is",null)},...o}),p=j.useMemo(()=>{if(!f?.data||!h?.data||!d?.data)return[];const k=new Map(h.data.map(T=>[T.id,T])),C=new Map(d.data.map(T=>[T.id,T]));return f.data.map(T=>{const v=k.get(T.topic_id),_=v?C.get(v.course_id):void 0;return{...T,topicTitle:v?.title||"",courseId:_?.id,courseTitle:_?.title||""}})},[f?.data,h?.data,d?.data]),x=j.useMemo(()=>{let k=p;return s!=="all"&&(k=k.filter(C=>C.courseId===parseInt(s))),i!=="all"&&(k=k.filter(C=>C.topic_id===parseInt(i))),k},[p,s,i]),g=j.useMemo(()=>{if(!m?.data)return[];const k=x.map(C=>C.id);return m.data.filter(C=>k.includes(C.activity_id)&&C.score!==null&&C.score!==void 0)},[m?.data,x]),y=j.useMemo(()=>{const k=new Map;return x.forEach(C=>{const T=g.filter(v=>v.activity_id===C.id);if(T.length>0){const v=T.filter(E=>E.score!==null&&E.score!==void 0).map(E=>E.score);if(v.length===0)return;const _=Math.round(v.reduce((E,M)=>E+M,0)/v.length),A=Math.round(v.filter(E=>E>=(C.passing_score||70)).length/v.length*100);k.set(C.id,{activityId:C.id,activityTitle:C.title,topicTitle:C.topicTitle,courseTitle:C.courseTitle,attempts:T.length,avgScore:_,minScore:Math.min(...v),maxScore:Math.max(...v),passRate:A,passingScore:C.passing_score||70})}}),Array.from(k.values()).sort((C,T)=>C.avgScore-T.avgScore)},[x,g]),b=j.useMemo(()=>{const k=g.length,C=g.filter(M=>M.score!==null&&M.score!==void 0).map(M=>M.score),T=C.length>0?Math.round(C.reduce((M,O)=>M+O,0)/C.length):0,v=g.filter(M=>{if(M.score===null||M.score===void 0)return!1;const R=x.find(B=>B.id===M.activity_id)?.passing_score||70;return M.score>=R}).length,_=k>0?Math.round(v/k*100):0;return{totalAttempts:k,avgScore:T,avgScoreChange:3,passRate:_,passRateChange:5,uniqueStudents:new Set(g.map(M=>M.user_id)).size,totalQuizzes:x.length}},[g,x]),w=j.useMemo(()=>{const k=[{range:"0-20%",count:0,color:"#ef4444"},{range:"21-40%",count:0,color:"#f97316"},{range:"41-60%",count:0,color:"#eab308"},{range:"61-80%",count:0,color:"#84cc16"},{range:"81-100%",count:0,color:"#22c55e"}];return g.forEach(C=>{const T=C.score||0;T<=20?k[0].count++:T<=40?k[1].count++:T<=60?k[2].count++:T<=80?k[3].count++:k[4].count++}),k},[g]),S=j.useMemo(()=>{const k=new Map;return g.forEach(C=>{const T=x.find(v=>v.id===C.activity_id);if(T?.topicTitle&&C.score!==null&&C.score!==void 0){const v=k.get(T.topicTitle)||{scores:[],topic:T.topicTitle};v.scores.push(C.score),k.set(T.topicTitle,v)}}),Array.from(k.values()).map(({topic:C,scores:T})=>({topic:C.length>20?C.substring(0,20)+"...":C,avgScore:Math.round(T.reduce((v,_)=>v+_,0)/T.length),attempts:T.length})).slice(0,8)},[g,x]),z=j.useMemo(()=>{const k=new Map;return g.forEach(C=>{const T=new Date(C.started_at).toLocaleDateString("pl-PL"),v=k.get(T)||[];C.score!==null&&C.score!==void 0&&(v.push(C.score),k.set(T,v))}),Array.from(k.entries()).map(([C,T])=>({date:C,avgScore:Math.round(T.reduce((v,_)=>v+_,0)/T.length),attempts:T.length,minScore:Math.min(...T),maxScore:Math.max(...T)})).sort((C,T)=>new Date(C.date).getTime()-new Date(T.date).getTime()).slice(-14)},[g]),N=j.useMemo(()=>{if(!u?.data||!y.length)return[];const k=y.slice(0,5),C=[];return k.forEach(T=>{u.data.filter(_=>_.activity_id===T.activityId).sort((_,A)=>_.order_index-A.order_index).forEach((_,A)=>{let E="medium";T.avgScore<30?E="very-hard":T.avgScore<50?E="hard":T.avgScore<70?E="medium":E="easy",C.push({questionId:_.id,question:_.question,activityTitle:T.activityTitle,quizAttempts:T.attempts,avgQuizScore:T.avgScore,difficulty:E})})}),C.sort((T,v)=>T.avgQuizScore-v.avgQuizScore).slice(0,10)},[u?.data,y]);return r.jsxs(X,{children:[r.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx(Ke,{to:"/teacher/reports/overview",children:r.jsxs(D,{variant:"ghost",size:"sm",children:[r.jsx(Pe,{className:"mr-2 h-4 w-4"}),"Powrót do centrum raportów"]})}),r.jsx("h1",{className:"text-2xl font-bold",children:"Raport wyników"})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(Ee,{value:s,onValueChange:n,children:[r.jsx(_e,{className:"w-[200px]",children:r.jsx(De,{placeholder:"Wybierz kurs"})}),r.jsxs(Ae,{children:[r.jsx(ee,{value:"all",children:"Wszystkie kursy"}),d?.data?.map(k=>r.jsx(ee,{value:k.id.toString(),children:k.title},k.id))]})]}),r.jsxs(Ee,{value:i,onValueChange:a,disabled:s==="all",children:[r.jsx(_e,{className:"w-[200px]",children:r.jsx(De,{placeholder:"Wybierz temat"})}),r.jsxs(Ae,{children:[r.jsx(ee,{value:"all",children:"Wszystkie tematy"}),h?.data?.map(k=>r.jsx(ee,{value:k.id.toString(),children:k.title},k.id))]})]}),r.jsxs(Ee,{value:t,onValueChange:e,children:[r.jsx(_e,{className:"w-[150px]",children:r.jsx(De,{})}),r.jsxs(Ae,{children:[r.jsx(ee,{value:"7d",children:"Ostatnie 7 dni"}),r.jsx(ee,{value:"30d",children:"Ostatnie 30 dni"}),r.jsx(ee,{value:"90d",children:"Ostatnie 90 dni"})]})]}),r.jsxs(D,{variant:"outline",size:"sm",children:[r.jsx($1,{className:"mr-2 h-4 w-4"}),"Eksportuj"]})]})]}),r.jsxs("div",{className:"grid gap-4 md:grid-cols-4 mb-6",children:[r.jsxs(P,{children:[r.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(L,{className:"text-sm font-medium",children:"Średni wynik"}),r.jsx(pt,{className:"h-4 w-4 text-muted-foreground"})]}),r.jsxs(I,{children:[r.jsxs("div",{className:"text-2xl font-bold",children:[b.avgScore,"%"]}),r.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.jsxs("span",{className:b.avgScoreChange>0?"text-green-600":"text-red-600",children:[b.avgScoreChange>0?r.jsx(Et,{className:"inline h-3 w-3"}):r.jsx(q1,{className:"inline h-3 w-3"})," ",Math.abs(b.avgScoreChange),"%"]})," ","vs. poprzedni okres"]})]})]}),r.jsxs(P,{children:[r.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(L,{className:"text-sm font-medium",children:"Wskaźnik zdawalności"}),r.jsx(Vr,{className:"h-4 w-4 text-muted-foreground"})]}),r.jsxs(I,{children:[r.jsxs("div",{className:"text-2xl font-bold",children:[b.passRate,"%"]}),r.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.jsxs("span",{className:b.passRateChange>0?"text-green-600":"text-red-600",children:[b.passRateChange>0?"+":"",b.passRateChange,"%"]})," ","vs. poprzedni okres"]})]})]}),r.jsxs(P,{children:[r.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(L,{className:"text-sm font-medium",children:"Liczba podejść"}),r.jsx(dt,{className:"h-4 w-4 text-muted-foreground"})]}),r.jsxs(I,{children:[r.jsx("div",{className:"text-2xl font-bold",children:b.totalAttempts}),r.jsxs("p",{className:"text-xs text-muted-foreground",children:[b.uniqueStudents," unikalnych uczniów"]})]})]}),r.jsxs(P,{children:[r.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(L,{className:"text-sm font-medium",children:"Liczba quizów"}),r.jsx(pt,{className:"h-4 w-4 text-muted-foreground"})]}),r.jsxs(I,{children:[r.jsx("div",{className:"text-2xl font-bold",children:b.totalQuizzes}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"aktywnych w okresie"})]})]})]}),r.jsxs(tx,{defaultValue:"distribution",className:"space-y-4",children:[r.jsxs(Qd,{children:[r.jsx(Ks,{value:"distribution",children:"Rozkład wyników"}),r.jsx(Ks,{value:"topics",children:"Wyniki według tematów"}),r.jsx(Ks,{value:"trend",children:"Trend w czasie"}),r.jsx(Ks,{value:"difficult",children:"Najtrudniejsze pytania"})]}),r.jsx(Hs,{value:"distribution",className:"space-y-4",children:r.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Rozkład wyników"})}),r.jsx(I,{children:r.jsx(ht,{width:"100%",height:300,children:r.jsxs(sc,{data:w,children:[r.jsx(Ms,{strokeDasharray:"3 3"}),r.jsx(ys,{dataKey:"range"}),r.jsx(is,{}),r.jsx(gt,{}),r.jsx(Wa,{dataKey:"count",name:"Liczba wyników",isAnimationActive:!1,children:w.map((k,C)=>r.jsx(Tn,{fill:k.color},`cell-${C}`))})]})})})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center gap-2",children:[r.jsx(st,{className:"h-4 w-4 text-orange-600"}),"Quizy wymagające uwagi"]})}),r.jsx(I,{children:r.jsx("div",{className:"space-y-3",children:y.slice(0,5).map(k=>r.jsxs("div",{className:"space-y-2 pb-3 border-b last:border-0",children:[r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("p",{className:"font-medium text-sm",children:k.activityTitle}),r.jsx("p",{className:"text-xs text-muted-foreground",children:k.topicTitle})]}),r.jsxs(V,{variant:k.avgScore<50?"destructive":"secondary",children:[k.avgScore,"%"]})]}),r.jsxs("div",{className:"flex gap-4 text-xs text-muted-foreground",children:[r.jsxs("span",{children:["Zdawalność: ",k.passRate,"%"]}),r.jsxs("span",{children:["Próby: ",k.attempts]}),r.jsxs("span",{children:["Min/Max: ",k.minScore,"%/",k.maxScore,"%"]})]})]},k.activityId))})})]})]})}),r.jsx(Hs,{value:"topics",className:"space-y-4",children:r.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Średnie wyniki według tematów"})}),r.jsx(I,{children:r.jsx(ht,{width:"100%",height:400,children:r.jsxs(uA,{data:S,children:[r.jsx(dA,{}),r.jsx(hA,{dataKey:"topic",tick:{fontSize:12}}),r.jsx(fA,{domain:[0,100]}),r.jsx(mA,{name:"Średni wynik",dataKey:"avgScore",stroke:"#8884d8",fill:"#8884d8",fillOpacity:.6,isAnimationActive:!1}),r.jsx(gt,{})]})})})]}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Szczegółowe wyniki"})}),r.jsx(I,{children:r.jsxs(fr,{children:[r.jsx(mr,{children:r.jsxs(Nt,{children:[r.jsx(de,{children:"Temat"}),r.jsx(de,{className:"text-right",children:"Średni wynik"}),r.jsx(de,{className:"text-right",children:"Liczba prób"})]})}),r.jsx(pr,{children:S.map(k=>r.jsxs(Nt,{children:[r.jsx(ue,{className:"font-medium",children:k.topic}),r.jsx(ue,{className:"text-right",children:r.jsxs(V,{variant:k.avgScore>=70?"default":"secondary",children:[k.avgScore,"%"]})}),r.jsx(ue,{className:"text-right",children:k.attempts})]},k.topic))})]})})]})]})}),r.jsx(Hs,{value:"trend",className:"space-y-4",children:r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Trend wyników w czasie"})}),r.jsx(I,{children:r.jsx(ht,{width:"100%",height:400,children:r.jsxs(pA,{data:z,children:[r.jsx(Ms,{strokeDasharray:"3 3"}),r.jsx(ys,{dataKey:"date"}),r.jsx(is,{}),r.jsx(gt,{}),r.jsx(Ma,{}),r.jsx(Zr,{type:"monotone",dataKey:"maxScore",fill:"#8884d8",stroke:"#8884d8",fillOpacity:.2,name:"Max",isAnimationActive:!1}),r.jsx(Zr,{type:"monotone",dataKey:"minScore",fill:"#82ca9d",stroke:"#82ca9d",fillOpacity:.2,name:"Min",isAnimationActive:!1}),r.jsx(Xp,{type:"monotone",dataKey:"avgScore",stroke:"#ff7300",strokeWidth:3,name:"Średnia",dot:{fill:"#ff7300"},isAnimationActive:!1}),r.jsx(Wa,{dataKey:"attempts",fill:"#ffc658",name:"Liczba prób",yAxisId:"right",isAnimationActive:!1}),r.jsx(is,{yAxisId:"right",orientation:"right"})]})})})]})}),r.jsx(Hs,{value:"difficult",className:"space-y-4",children:r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center gap-2",children:[r.jsx(st,{className:"h-5 w-5 text-red-600"}),"Najtrudniejsze pytania"]})}),r.jsxs(I,{children:[r.jsx("div",{className:"space-y-4",children:N.length>0?N.map((k,C)=>r.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[r.jsx("div",{className:"flex items-start justify-between",children:r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsxs(V,{variant:"outline",children:["#",C+1]}),r.jsxs(V,{variant:k.difficulty==="very-hard"?"destructive":k.difficulty==="hard"?"secondary":"default",children:["Quiz: ",k.avgQuizScore,"% średnio"]})]}),r.jsx("p",{className:"text-sm font-medium",children:k.question}),r.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Z quizu: ",k.activityTitle," • ",k.quizAttempts," podejść"]})]})}),r.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-muted-foreground",children:"Średni wynik quizu"}),r.jsxs("p",{className:"font-medium",children:[k.avgQuizScore,"%"]})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-muted-foreground",children:"Liczba podejść"}),r.jsx("p",{className:"font-medium",children:k.quizAttempts})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-muted-foreground",children:"Poziom trudności"}),r.jsx(V,{variant:k.difficulty==="very-hard"?"destructive":k.difficulty==="hard"?"secondary":k.difficulty==="medium"?"outline":"default",children:k.difficulty==="very-hard"?"Bardzo trudne":k.difficulty==="hard"?"Trudne":k.difficulty==="medium"?"Średnie":"Łatwe"})]})]})]},k.questionId)):r.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[r.jsx("p",{children:"Brak danych o pytaniach w wybranym okresie."}),r.jsx("p",{className:"text-sm mt-2",children:"Upewnij się, że wybrane quizy mają pytania."})]})}),r.jsx("div",{className:"mt-4 p-4 bg-muted rounded-lg",children:r.jsxs("p",{className:"text-sm text-muted-foreground",children:[r.jsx("strong",{children:"Wskazówka:"})," Rozważ dodanie dodatkowych materiałów lub wyjaśnień do pytań z niskim wskaźnikiem poprawnych odpowiedzi."]})})]})]})})]})]})},FW=[r.jsx(Z,{path:"reports",element:r.jsx(dn,{to:"overview",replace:!0})},"reports-root-redirect"),r.jsx(Z,{path:"reports/overview",element:r.jsx(MW,{})},"reports-overview"),r.jsx(Z,{path:"reports/engagement",element:r.jsx(PW,{})},"reports-engagement"),r.jsx(Z,{path:"reports/progress",element:r.jsx(IW,{})},"reports-progress"),r.jsx(Z,{path:"reports/performance",element:r.jsx(LW,{})},"reports-performance"),r.jsx(Z,{path:"reports/gamification",element:r.jsx(OW,{})},"reports-gamification"),r.jsx(Z,{path:"reports/summary",element:r.jsx(RW,{})},"reports-summary")],$W=()=>{const{activityId:t}=Qt();pe();const[e,s]=j.useState(null),[n,i]=j.useState(!1),{data:a,isLoading:o}=tt({resource:"activities",id:t,meta:{select:"*, topics(*, courses(*))"}}),{data:l,isLoading:c,refetch:u}=Y({resource:"questions",filters:[{field:"activity_id",operator:"eq",value:parseInt(t)}],sorters:[{field:"position",order:"asc"}],pagination:{mode:"off"}}),{mutate:d}=hn(),{mutate:h}=Hi(),{mutate:f}=lr();if(o||c)return r.jsx(X,{children:r.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const m=a?.data,p=l?.data||[];return r.jsxs(X,{children:[r.jsx(Fi,{}),r.jsxs(he,{children:[r.jsx(je,{title:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(dt,{className:"w-6 h-6 text-blue-500"}),"Pytania quizu"]}),description:r.jsxs("div",{children:[r.jsx("div",{className:"text-lg font-medium",children:m?.title}),r.jsxs("div",{className:"text-sm text-muted-foreground",children:[m?.topics?.courses?.title," → Temat"," ",m?.topics?.position,": ",m?.topics?.title]})]})}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(V,{variant:"outline",className:"text-base px-3 py-1",children:[p.length," ",p.length===1?"pytanie":"pytań"]}),r.jsxs(D,{onClick:()=>i(!0),disabled:n,children:[r.jsx(Je,{className:"w-4 h-4 mr-2"}),"Dodaj pytanie"]})]})]}),r.jsx(P,{className:"bg-muted/50",children:r.jsx(I,{className:"pt-6",children:r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[r.jsxs("div",{children:[r.jsx("span",{className:"text-muted-foreground",children:"Próg zaliczenia:"}),r.jsxs("span",{className:"ml-2 font-medium",children:[m?.passing_score||70,"%"]})]}),m?.time_limit&&r.jsxs("div",{children:[r.jsx("span",{className:"text-muted-foreground",children:"Limit czasu:"}),r.jsxs("span",{className:"ml-2 font-medium",children:[m.time_limit," min"]})]}),m?.max_attempts&&r.jsxs("div",{children:[r.jsx("span",{className:"text-muted-foreground",children:"Max. prób:"}),r.jsx("span",{className:"ml-2 font-medium",children:m.max_attempts})]})]})})}),n&&r.jsx(Mj,{activityId:parseInt(t),position:p.length+1,onSave:x=>{d({resource:"questions",values:x},{onSuccess:()=>{G.success("Pytanie zostało dodane"),i(!1),u()}})},onCancel:()=>i(!1)}),r.jsx("div",{className:"space-y-4",children:p.map(x=>r.jsx("div",{children:e===x.id?r.jsx(Mj,{question:x,activityId:parseInt(t),position:x.position,onSave:g=>{h({resource:"questions",id:x.id,values:g},{onSuccess:()=>{G.success("Pytanie zostało zaktualizowane"),s(null),u()}})},onCancel:()=>s(null)}):r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(he,{children:[r.jsxs(L,{className:"text-base",children:[r.jsxs("span",{className:"text-muted-foreground mr-2",children:["#",x.position]}),x.question]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(V,{variant:"outline",children:[x.points," pkt"]}),r.jsx(D,{variant:"outline",size:"sm",onClick:()=>s(x.id),children:r.jsx(Bn,{className:"w-3 h-3"})}),r.jsx(D,{variant:"outline",size:"sm",onClick:()=>{confirm("Czy na pewno chcesz usunąć to pytanie?")&&f({resource:"questions",id:x.id},{onSuccess:()=>{G.success("Pytanie zostało usunięte"),u()}})},children:r.jsx(St,{className:"w-3 h-3 text-red-600"})})]})]})}),r.jsxs(I,{children:[r.jsx("div",{className:"space-y-2",children:x.options.map((g,y)=>r.jsxs("div",{className:`flex items-center gap-2 p-2 rounded ${g.is_correct?"bg-green-50 dark:bg-green-950/30 border border-green-200 dark:border-green-800":""}`,children:[g.is_correct?r.jsx(Ds,{className:"w-4 h-4 text-green-600"}):r.jsx(fn,{className:"w-4 h-4 text-gray-400"}),r.jsx("span",{className:g.is_correct?"font-medium":"",children:g.text})]},g.id||y))}),x.explanation&&r.jsxs("div",{className:"mt-4 p-3 bg-muted rounded",children:[r.jsx("p",{className:"text-sm font-medium mb-1",children:"Wyjaśnienie:"}),r.jsx("p",{className:"text-sm text-muted-foreground",children:x.explanation})]})]})]})},x.id))}),p.length===0&&!n&&r.jsx(P,{children:r.jsxs(I,{className:"text-center py-12",children:[r.jsx(dt,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground/50"}),r.jsx("p",{className:"text-lg font-medium text-muted-foreground mb-4",children:"Quiz nie ma jeszcze żadnych pytań"}),r.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"Dodaj pierwsze pytanie, aby uczniowie mogli rozwiązać quiz"}),r.jsxs(D,{onClick:()=>i(!0),children:[r.jsx(Je,{className:"w-4 h-4 mr-2"}),"Dodaj pierwsze pytanie"]})]})}),p.length>0&&r.jsxs("div",{className:"flex justify-between items-center pt-6 border-t",children:[r.jsxs("div",{className:"text-sm text-muted-foreground",children:["Łącznie punktów: ",p.reduce((x,g)=>x+g.points,0)]}),r.jsx(Fi,{variant:"outline",children:"Zakończ edycję"})]})]})},Mj=({question:t,activityId:e,position:s,onSave:n,onCancel:i})=>{const[a,o]=j.useState({question:t?.question||"",explanation:t?.explanation||"",points:t?.points||1,position:s,options:t?.options||[{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1}]}),l=()=>{if(!a.question.trim()){G.error("Pytanie jest wymagane");return}const d=a.options.filter(f=>f.text.trim());if(d.length<2){G.error("Dodaj przynajmniej 2 odpowiedzi");return}if(d.filter(f=>f.is_correct).length===0){G.error("Zaznacz przynajmniej jedną poprawną odpowiedź");return}n({activity_id:e,question:a.question,explanation:a.explanation||null,points:a.points,position:a.position,options:d.map((f,m)=>({...f,position:m+1}))})},c=()=>{a.options.length<6&&o({...a,options:[...a.options,{text:"",is_correct:!1}]})},u=d=>{if(a.options.length>2){const h=a.options.filter((f,m)=>m!==d);o({...a,options:h})}};return r.jsxs(P,{className:"border-primary",children:[r.jsx(F,{children:r.jsx(L,{children:t?"Edytuj pytanie":"Nowe pytanie"})}),r.jsxs(I,{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium",children:"Treść pytania"}),r.jsx(mn,{placeholder:"Wprowadź treść pytania...",value:a.question,onChange:d=>o({...a,question:d.target.value}),className:"mt-1",rows:3})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium",children:"Liczba punktów"}),r.jsx(te,{type:"number",min:"1",value:a.points,onChange:d=>o({...a,points:parseInt(d.target.value)||1}),className:"mt-1"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium",children:"Pozycja"}),r.jsx(te,{type:"number",min:"1",value:a.position,onChange:d=>o({...a,position:parseInt(d.target.value)||1}),className:"mt-1"})]})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex justify-between items-center mb-2",children:[r.jsx("label",{className:"text-sm font-medium",children:"Odpowiedzi"}),a.options.length<6&&r.jsxs(D,{type:"button",size:"sm",variant:"outline",onClick:c,children:[r.jsx(Je,{className:"w-3 h-3 mr-1"}),"Dodaj opcję"]})]}),r.jsx("div",{className:"space-y-2",children:a.options.map((d,h)=>r.jsxs("div",{className:"flex gap-2",children:[r.jsx(mt,{checked:d.is_correct,onCheckedChange:f=>{const m=[...a.options];m[h].is_correct=f,o({...a,options:m})}}),r.jsx(te,{placeholder:`Odpowiedź ${h+1}`,value:d.text,onChange:f=>{const m=[...a.options];m[h].text=f.target.value,o({...a,options:m})},className:"flex-1"}),a.options.length>2&&r.jsx(D,{type:"button",variant:"ghost",size:"sm",onClick:()=>u(h),children:r.jsx(fn,{className:"w-4 h-4"})})]},h))}),r.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Zaznacz checkbox przy poprawnych odpowiedziach. Możesz zaznaczyć więcej niż jedną."})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium",children:"Wyjaśnienie (opcjonalne)"}),r.jsx(mn,{placeholder:"Wyjaśnienie poprawnej odpowiedzi...",value:a.explanation,onChange:d=>o({...a,explanation:d.target.value}),className:"mt-1",rows:3})]}),r.jsxs(he,{children:[r.jsxs(D,{variant:"outline",onClick:i,children:[r.jsx(fn,{className:"w-4 h-4 mr-2"}),"Anuluj"]}),r.jsxs(D,{onClick:l,children:[r.jsx(Jr,{className:"w-4 h-4 mr-2"}),"Zapisz pytanie"]})]})]})]})},BW=()=>{const[t]=Fd(),e=pe(),s=t.get("activity_id"),{data:n,isLoading:i}=Y({resource:"questions",filters:[{field:"activity_id",operator:"eq",value:parseInt(s)}],sorters:[{field:"position",order:"desc"}],pagination:{mode:"off"}}),[a,o]=j.useState({question:"",explanation:"",points:1,position:1,options:[{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1}]});j.useEffect(()=>{if(n?.data){const x=n.data.reduce((g,y)=>Math.max(g,y.position||0),0);o(g=>({...g,position:x+1}))}},[n]);const{data:l,isLoading:c}=tt({resource:"activities",id:s,meta:{select:"*, topics(*, courses(*))"}}),{mutate:u,isLoading:d}=hn();if(!s)return r.jsx(X,{children:r.jsx(P,{children:r.jsx(I,{className:"text-center py-12",children:r.jsx("p",{className:"text-lg font-medium text-muted-foreground",children:"Brak ID aktywności"})})})});if(c||i)return r.jsx(X,{children:r.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const h=l?.data;if(!h||h.type!=="quiz")return r.jsx(X,{children:r.jsx(P,{children:r.jsx(I,{className:"text-center py-12",children:r.jsx("p",{className:"text-lg font-medium text-muted-foreground",children:"Nieprawidłowa aktywność lub aktywność nie jest quizem"})})})});const f=()=>{if(!a.question.trim()){G.error("Pytanie jest wymagane");return}const x=a.options.filter(y=>y.text.trim());if(x.length<2){G.error("Dodaj przynajmniej 2 odpowiedzi");return}if(x.filter(y=>y.is_correct).length===0){G.error("Zaznacz przynajmniej jedną poprawną odpowiedź");return}u({resource:"questions",values:{activity_id:parseInt(s),question:a.question,explanation:a.explanation||null,points:a.points,position:a.position,options:x.map((y,b)=>({id:b+1,text:y.text,is_correct:y.is_correct}))}},{onSuccess:()=>{G.success("Pytanie zostało dodane"),e(`/teacher/questions/manage/${s}`)},onError:y=>{console.error("Błąd podczas dodawania pytania:",y);const b=y?.code||y?.statusCode,w=y?.message||y?.error?.message;b==="23505"||b===23505?w?.includes("position")?G.error("Pytanie o tej pozycji już istnieje. Zmień pozycję na inną wartość."):G.error("Wystąpił konflikt z istniejącymi danymi. Sprawdź pozycję pytania."):b==="23503"||b===23503?G.error("Nieprawidłowe powiązanie z aktywnością."):b==="22P02"||b===22002?G.error("Nieprawidłowy format danych."):w?G.error(`Błąd: ${w}`):G.error("Wystąpił nieoczekiwany błąd. Spróbuj ponownie.")}})},m=()=>{a.options.length<6&&o({...a,options:[...a.options,{text:"",is_correct:!1}]})},p=x=>{if(a.options.length>2){const g=a.options.filter((y,b)=>b!==x);o({...a,options:g})}};return r.jsxs(X,{children:[r.jsx(Fi,{}),r.jsx(he,{children:r.jsx(je,{title:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(dt,{className:"w-6 h-6 text-blue-500"}),"Dodaj pytanie do quizu"]}),description:r.jsxs("div",{children:[r.jsx("div",{className:"text-lg font-medium",children:h?.title}),r.jsxs("div",{className:"text-sm text-muted-foreground",children:[h?.topics?.courses?.title," → Temat"," ",h?.topics?.position,": ",h?.topics?.title]})]})})}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsx(L,{children:"Nowe pytanie"})}),r.jsxs(I,{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium",children:"Treść pytania"}),r.jsx(mn,{placeholder:"Wprowadź treść pytania...",value:a.question,onChange:x=>o({...a,question:x.target.value}),className:"mt-1",rows:3})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium",children:"Liczba punktów"}),r.jsx(te,{type:"number",min:"1",value:a.points,onChange:x=>o({...a,points:parseInt(x.target.value)||1}),className:"mt-1"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium",children:"Pozycja"}),r.jsx(te,{type:"number",min:"1",value:a.position,onChange:x=>o({...a,position:parseInt(x.target.value)||1}),className:"mt-1"})]})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex justify-between items-center mb-2",children:[r.jsx("label",{className:"text-sm font-medium",children:"Odpowiedzi"}),a.options.length<6&&r.jsxs(D,{type:"button",size:"sm",variant:"outline",onClick:m,children:[r.jsx(Je,{className:"w-3 h-3 mr-1"}),"Dodaj opcję"]})]}),r.jsx("div",{className:"space-y-2",children:a.options.map((x,g)=>r.jsxs("div",{className:"flex gap-2",children:[r.jsx(mt,{checked:x.is_correct,onCheckedChange:y=>{const b=[...a.options];b[g].is_correct=y,o({...a,options:b})}}),r.jsx(te,{placeholder:`Odpowiedź ${g+1}`,value:x.text,onChange:y=>{const b=[...a.options];b[g].text=y.target.value,o({...a,options:b})},className:"flex-1"}),a.options.length>2&&r.jsx(D,{type:"button",variant:"ghost",size:"sm",onClick:()=>p(g),children:r.jsx(fn,{className:"w-4 h-4"})})]},g))}),r.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Zaznacz checkbox przy poprawnych odpowiedziach. Możesz zaznaczyć więcej niż jedną."})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium",children:"Wyjaśnienie (opcjonalne)"}),r.jsx(mn,{placeholder:"Wyjaśnienie poprawnej odpowiedzi...",value:a.explanation,onChange:x=>o({...a,explanation:x.target.value}),className:"mt-1",rows:3})]}),r.jsxs(he,{children:[r.jsxs(D,{variant:"outline",onClick:()=>e(`/teacher/questions/manage/${s}`),children:[r.jsx(fn,{className:"w-4 h-4 mr-2"}),"Anuluj"]}),r.jsxs(D,{onClick:f,disabled:d,children:[r.jsx(Jr,{className:"w-4 h-4 mr-2"}),d?"Zapisywanie...":"Zapisz pytanie"]})]})]})]})]})},qW=[r.jsx(Z,{path:"/questions/manage/:activityId",element:r.jsx($W,{})},"questions-manage"),r.jsx(Z,{path:"/questions/create",element:r.jsx(BW,{})},"questions-create")],VW=(t,e)=>{const{data:s,isLoading:n}=tt({resource:"groups",id:t}),{data:i,isLoading:a}=tt({resource:"courses",id:e}),{data:o,isLoading:l}=Y({resource:"group_members",filters:[{field:"group_id",operator:"eq",value:parseInt(t)}],pagination:{mode:"off"},meta:{select:"*, users(id, full_name, email)"}}),{data:c,isLoading:u}=Y({resource:"topics",filters:[{field:"course_id",operator:"eq",value:parseInt(e)}],pagination:{mode:"off"},sorters:[{field:"position",order:"asc"}]}),d=c?.data?.map(v=>v.id)||[],{data:h,isLoading:f}=Y({resource:"activities",filters:d.length>0?[{field:"topic_id",operator:"in",value:d}]:[],pagination:{mode:"off"},sorters:[{field:"position",order:"asc"}],queryOptions:{enabled:d.length>0}}),m=h?.data?.map(v=>v.id)||[],p=o?.data?.map(v=>v.user_id)||[],{data:x,isLoading:g}=Y({resource:"activity_progress",filters:m.length>0&&p.length>0?[{field:"activity_id",operator:"in",value:m},{field:"user_id",operator:"in",value:p}]:[],pagination:{mode:"off"},queryOptions:{enabled:m.length>0&&p.length>0}}),y=n||a||l||u||f||g,b=o?.data?.map(v=>v.users).filter(Boolean)||[],w=c?.data||[],S=h?.data||[],z=x?.data||[],N=v=>{const _=z.filter(J=>J.user_id===v),A=_.filter(J=>J.completed_at!==null).length,E=S.length,M=E>0?A/E*100:0,O=_.filter(J=>J.completed_at!==null).sort((J,ie)=>new Date(ie.completed_at).getTime()-new Date(J.completed_at).getTime()),R=O.length>0?O[0].completed_at:null,B=_.filter(J=>J.score!==null&&J.score>0),K=B.length>0?B.reduce((J,ie)=>J+ie.score,0)/B.length:null,$=_.reduce((J,ie)=>J+(ie.time_spent||0),0);return{completedCount:A,totalCount:E,progressPercentage:M,lastActivity:R,averageScore:K,totalTimeSpent:$}},k=j.useMemo(()=>{if(b.length===0)return{averageProgress:0,completedStudents:0,inProgressStudents:0,notStartedStudents:0,averageScore:null};let v=0,_=0,A=0,E=0;const M=[];return b.forEach(O=>{const R=N(O.id);v+=R.progressPercentage,R.progressPercentage===100?_++:R.progressPercentage>0?A++:E++,R.averageScore!==null&&M.push(R.averageScore)}),{averageProgress:v/b.length,completedStudents:_,inProgressStudents:A,notStartedStudents:E,averageScore:M.length>0?M.reduce((O,R)=>O+R,0)/M.length:null}},[b,z,S]),C=v=>S.filter(_=>_.topic_id===v),T=v=>{const _=z.filter(K=>K.activity_id===v),A=b.length,E=_.filter(K=>K.completed_at!==null).length,M=_.length,O=A-M,R=_.filter(K=>K.score!==null&&K.score>0),B=R.length>0?R.reduce((K,$)=>K+$.score,0)/R.length:null;return{totalStudents:A,completedCount:E,startedCount:M,notStartedCount:O,averageScore:B,completionPercentage:A>0?E/A*100:0}};return{group:s?.data,course:i?.data,students:b,topics:w,activities:S,completions:z,quizAttempts:[],courseStats:k,isLoading:y,getStudentProgress:N,getTopicActivities:C,getActivityStats:T}},UW=({stats:t,studentsCount:e})=>r.jsxs(Pt,{variant:"2-2-4",children:[r.jsxs(P,{children:[r.jsx(F,{className:"pb-2",children:r.jsxs(L,{className:"text-sm font-medium flex items-center gap-2",children:[r.jsx(Et,{className:"w-4 h-4"}),"Średni postęp"]})}),r.jsxs(I,{children:[r.jsxs("div",{className:"text-2xl font-bold",children:[t.averageProgress.toFixed(1),"%"]}),r.jsx("div",{className:"mt-2 h-2 bg-muted rounded-full overflow-hidden",children:r.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${t.averageProgress}%`}})})]})]}),r.jsxs(P,{children:[r.jsx(F,{className:"pb-2",children:r.jsxs(L,{className:"text-sm font-medium flex items-center gap-2",children:[r.jsx(ho,{className:"w-4 h-4"}),"Ukończyli"]})}),r.jsxs(I,{children:[r.jsx("div",{className:"text-2xl font-bold text-green-600",children:t.completedStudents}),r.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["z ",e," uczniów"]})]})]}),r.jsxs(P,{children:[r.jsx(F,{className:"pb-2",children:r.jsxs(L,{className:"text-sm font-medium flex items-center gap-2",children:[r.jsx(Ze,{className:"w-4 h-4"}),"W trakcie"]})}),r.jsxs(I,{children:[r.jsx("div",{className:"text-2xl font-bold text-blue-600",children:t.inProgressStudents}),r.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"aktywnych uczniów"})]})]}),r.jsxs(P,{children:[r.jsx(F,{className:"pb-2",children:r.jsxs(L,{className:"text-sm font-medium flex items-center gap-2",children:[r.jsx(Os,{className:"w-4 h-4"}),"Średnia ocen"]})}),r.jsxs(I,{children:[r.jsx("div",{className:"text-2xl font-bold",children:t.averageScore!==null?`${t.averageScore.toFixed(1)}%`:"—"}),r.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"z quizów"})]})]})]}),WW=({students:t,getStudentProgress:e})=>{const s=pe(),{groupId:n,courseId:i}=Qt(),a=u=>u===100?r.jsx(V,{className:"bg-green-600 hover:bg-green-700",children:"Ukończony"}):u>0?r.jsx(V,{className:"bg-blue-600 hover:bg-blue-700",children:"W trakcie"}):r.jsx(V,{variant:"secondary",children:"Brak"}),o=u=>u===null?r.jsx(ku,{className:"w-4 h-4 text-muted-foreground"}):u>=80?r.jsx(Et,{className:"w-4 h-4 text-green-600"}):u>=60?r.jsx(ku,{className:"w-4 h-4 text-yellow-600"}):r.jsx(q1,{className:"w-4 h-4 text-red-600"}),l=u=>u?new Date(u).toLocaleDateString("pl-PL",{day:"2-digit",month:"2-digit"}):"—",c=u=>{s(`/teacher/groups/${n}/courses/${i}/students/${u}`)};return r.jsx("div",{className:"rounded-md border",children:r.jsxs(fr,{children:[r.jsx(mr,{children:r.jsxs(Nt,{children:[r.jsx(de,{className:"w-[250px]",children:"Uczeń"}),r.jsx(de,{className:"text-center w-[100px]",children:"Status"}),r.jsx(de,{className:"text-center w-[100px]",children:"Postęp"}),r.jsx(de,{className:"text-center w-[120px]",children:"Ukończone"}),r.jsx(de,{className:"text-center w-[100px]",children:"Średnia"}),r.jsx(de,{className:"text-center w-[100px]",children:"Ostatnia"}),r.jsx(de,{className:"text-right w-[120px]",children:"Akcje"})]})}),r.jsx(pr,{children:t.length===0?r.jsx(Nt,{children:r.jsx(ue,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"Brak uczniów w grupie"})}):t.map(u=>{const d=e(u.id);return r.jsxs(Nt,{className:"hover:bg-muted/50",children:[r.jsx(ue,{children:r.jsxs("div",{children:[r.jsx("div",{className:"font-medium",children:u.full_name}),r.jsx("div",{className:"text-sm text-muted-foreground",children:u.email})]})}),r.jsx(ue,{className:"text-center",children:a(d.progressPercentage)}),r.jsx(ue,{children:r.jsxs("div",{className:"flex items-center justify-center gap-2",children:[r.jsx("div",{className:"w-16 h-2 bg-muted rounded-full overflow-hidden",children:r.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${d.progressPercentage}%`}})}),r.jsxs("span",{className:"text-sm font-medium w-10 text-right",children:[d.progressPercentage.toFixed(0),"%"]})]})}),r.jsx(ue,{className:"text-center",children:r.jsxs("span",{className:"text-sm",children:[d.completedCount,"/",d.totalCount]})}),r.jsx(ue,{children:r.jsxs("div",{className:"flex items-center justify-center gap-2",children:[o(d.averageScore),r.jsx("span",{className:"text-sm font-medium",children:d.averageScore!==null?`${d.averageScore.toFixed(0)}%`:"—"})]})}),r.jsx(ue,{className:"text-center text-sm",children:l(d.lastActivity)}),r.jsx(ue,{className:"text-right",children:r.jsxs(D,{variant:"ghost",size:"sm",onClick:()=>c(u.id),children:["Szczegóły",r.jsx(Ue,{className:"w-4 h-4 ml-1"})]})})]},u.id)})})]})})},KW=({topic:t,topicNumber:e,activities:s,students:n,getActivityStats:i})=>{const[a,o]=j.useState(!1);if(s.length===0)return null;const l=s.reduce((d,h)=>{const f=i(h.id);return d.totalCompleted+=f.completedCount,d.totalPossible+=f.totalStudents,h.type==="quiz"&&f.averageScore!==null&&d.quizScores.push(f.averageScore),d},{totalCompleted:0,totalPossible:0,quizScores:[]}),c=l.totalPossible>0?l.totalCompleted/l.totalPossible*100:0,u=l.quizScores.length>0?l.quizScores.reduce((d,h)=>d+h,0)/l.quizScores.length:null;return r.jsxs("div",{className:"border rounded-lg",children:[r.jsx("button",{onClick:()=>o(!a),className:"w-full p-4 flex items-center justify-between hover:bg-muted/50 transition-colors",children:r.jsxs("div",{className:"flex items-center gap-3 flex-1 text-left",children:[a?r.jsx(ls,{className:"w-5 h-5 text-muted-foreground flex-shrink-0"}):r.jsx(He,{className:"w-5 h-5 text-muted-foreground flex-shrink-0"}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("h4",{className:"font-semibold",children:["Temat ",e,": ",t.title]}),r.jsxs("div",{className:"flex items-center gap-3 mt-1 text-sm text-muted-foreground",children:[r.jsxs("span",{children:[s.length," ",s.length===1?"aktywność":"aktywności"]}),r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx(ho,{className:"w-3 h-3"}),c.toFixed(0),"% ukończonych"]}),u!==null&&r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx(Os,{className:"w-3 h-3"}),"Średnia: ",u.toFixed(0),"%"]})]})]})]})}),a&&r.jsx("div",{className:"p-4 pt-0 space-y-3",children:s.map(d=>{const h=i(d.id),f=d.type==="quiz";return r.jsxs("div",{className:"p-3 bg-muted/30 rounded-lg",children:[r.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx("h5",{className:"font-medium text-sm",children:d.title}),r.jsx(V,{variant:"outline",className:"text-xs",children:f?"Quiz":"Materiał"})]}),r.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground mt-2",children:[r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx(ge,{className:"w-3 h-3"}),h.completedCount,"/",h.totalStudents," ukończyło"]}),h.startedCount>h.completedCount&&r.jsxs("span",{children:[h.startedCount-h.completedCount," w trakcie"]}),h.notStartedCount>0&&r.jsxs("span",{children:[h.notStartedCount," nie rozpoczęło"]})]})]}),r.jsxs("div",{className:"flex flex-col items-end gap-2",children:[r.jsxs("div",{className:"text-right",children:[r.jsxs("div",{className:"text-lg font-bold",children:[h.completionPercentage.toFixed(0),"%"]}),r.jsx("div",{className:"text-xs text-muted-foreground",children:"ukończenia"})]}),f&&h.averageScore!==null&&r.jsxs("div",{className:"text-right",children:[r.jsxs("div",{className:"text-sm font-semibold text-blue-600",children:[h.averageScore.toFixed(0),"%"]}),r.jsx("div",{className:"text-xs text-muted-foreground",children:"średnia"})]})]})]}),r.jsx("div",{className:"mt-2",children:r.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:r.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${h.completionPercentage}%`}})})})]},d.id)})})]})},HW=({topics:t,students:e,getTopicActivities:s,getActivityStats:n})=>t.length===0?r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center gap-2",children:[r.jsx(Et,{className:"w-5 h-5"}),"Postęp według tematów"]})}),r.jsx(I,{children:r.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Brak tematów w kursie"})})]}):r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center gap-2",children:[r.jsx(Et,{className:"w-5 h-5"}),"Postęp według tematów"]})}),r.jsx(I,{className:"space-y-4",children:t.map((i,a)=>{const o=s(i.id);return r.jsx(KW,{topic:i,topicNumber:a+1,activities:o,students:e,getActivityStats:n},i.id)})})]}),GW=()=>{const{groupId:t,courseId:e}=Qt(),s=pe(),{group:n,course:i,students:a,topics:o,courseStats:l,isLoading:c,getStudentProgress:u,getTopicActivities:d,getActivityStats:h}=VW(t,e);return c?r.jsx(X,{children:r.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):!n||!i?r.jsx(X,{children:r.jsx("div",{className:"text-center py-12",children:r.jsx("p",{className:"text-muted-foreground",children:"Nie znaleziono grupy lub kursu"})})}):r.jsxs(X,{children:[r.jsxs(D,{variant:"outline",size:"sm",onClick:()=>s(`/teacher/courses/show/${e}`),children:[r.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Powrót do kursu"]}),r.jsx("div",{className:"space-y-4",children:r.jsxs("div",{className:"flex items-start gap-4",children:[i.icon_emoji&&r.jsx("div",{className:"flex-shrink-0",children:r.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-lg flex items-center justify-center",children:r.jsx("span",{className:"text-3xl",children:i.icon_emoji})})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:i.title}),r.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[r.jsxs(V,{variant:"outline",className:"gap-1",children:[r.jsx(ge,{className:"w-3 h-3"}),"Grupa: ",n.name]}),r.jsxs(V,{variant:"outline",className:"gap-1",children:[r.jsx(Se,{className:"w-3 h-3"}),n.academic_year]})]})]})]})}),r.jsx(UW,{stats:l,studentsCount:a.length}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center gap-2",children:[r.jsx(ge,{className:"w-5 h-5"}),"Postępy uczniów (",a.length,")"]})}),r.jsx(I,{children:r.jsx(WW,{students:a,getStudentProgress:u})})]}),r.jsx(HW,{topics:o,students:a,getTopicActivities:f=>d(f),getActivityStats:h})]})},JW={name:"group-activity",list:"/teacher/groups/:groupId/courses/:courseId/activity",meta:{label:"Aktywność grupy",icon:r.jsx(ge,{className:"h-4 w-4"}),hide:!0}},ZW=[r.jsx(Z,{path:"groups/:groupId/courses/:courseId/activity",element:r.jsx(GW,{})},"group-activity-show")],QW=(t,e,s)=>{const{data:n,isLoading:i}=tt({resource:"users",id:s}),{data:a,isLoading:o}=tt({resource:"groups",id:t}),{data:l,isLoading:c}=tt({resource:"courses",id:e}),{data:u,isLoading:d}=Y({resource:"topics",filters:[{field:"course_id",operator:"eq",value:parseInt(e)}],pagination:{mode:"off"},sorters:[{field:"position",order:"asc"}]}),h=u?.data?.map(A=>A.id)||[],{data:f,isLoading:m}=Y({resource:"activities",filters:h.length>0?[{field:"topic_id",operator:"in",value:h}]:[],pagination:{mode:"off"},sorters:[{field:"position",order:"asc"}],queryOptions:{enabled:h.length>0}}),p=f?.data?.map(A=>A.id)||[],{data:x,isLoading:g}=Y({resource:"activity_progress",filters:p.length>0?[{field:"activity_id",operator:"in",value:p},{field:"user_id",operator:"eq",value:s}]:[],pagination:{mode:"off"},queryOptions:{enabled:p.length>0}}),y=i||o||c||d||m||g,b=n?.data,w=a?.data,S=l?.data,z=u?.data||[],N=f?.data||[],k=x?.data||[],C=j.useMemo(()=>{const A=new Map;return k.forEach(E=>{A.set(E.activity_id,E)}),A},[k]),T=j.useMemo(()=>N.map(A=>({...A,progress:C.get(A.id)||null})),[N,C]),v=j.useMemo(()=>z.map(A=>({...A,activities:T.filter(E=>E.topic_id===A.id)})),[z,T]),_=j.useMemo(()=>{const A=N.length,E=k.filter($=>$.completed_at!==null).length,M=k.filter($=>N.find(ie=>ie.id===$.activity_id)?.type==="quiz"&&$.score!==null),O=M.length>0?M.reduce(($,J)=>$+(J.score||0),0)/M.length:null,R=k.reduce(($,J)=>$+(J.time_spent||0),0),B=k.filter($=>$.completed_at!==null).sort(($,J)=>new Date(J.completed_at).getTime()-new Date($.completed_at).getTime())[0],K=A>0?E/A*100:0;return{totalActivities:A,completedActivities:E,progressPercentage:K,averageScore:O,totalTimeSpent:R,lastActivity:B?.completed_at||null,totalQuizzes:N.filter($=>$.type==="quiz").length,completedQuizzes:M.length}},[N,k]);return{student:b,group:w,course:S,topicsWithActivities:v,overallStats:_,isLoading:y}},YW=({student:t,course:e,group:s,progressPercentage:n})=>{const i=()=>n===100?r.jsx(V,{className:"bg-green-600 hover:bg-green-700",children:"Ukończono kurs"}):n>0?r.jsx(V,{className:"bg-blue-600 hover:bg-blue-700",children:"W trakcie nauki"}):r.jsx(V,{variant:"secondary",children:"Nierozpoczęty"});return r.jsx("div",{className:"space-y-4",children:r.jsxs("div",{className:"flex items-start gap-6",children:[r.jsx("div",{className:"h-40 w-40 rounded-full bg-muted  flex items-center justify-center flex-shrink-0",children:r.jsx(gl,{className:"h-20 w-20 text-primary"})}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-start justify-between gap-4 mb-2",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:t.full_name}),r.jsx("p",{className:"text-muted-foreground mt-1",children:t.email})]}),i()]}),r.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-3",children:[e.icon_emoji&&r.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[r.jsx("span",{className:"text-xl",children:e.icon_emoji}),r.jsx("span",{className:"font-medium",children:e.title})]}),!e.icon_emoji&&r.jsxs(V,{variant:"outline",className:"gap-1",children:[r.jsx(Se,{className:"w-3 h-3"}),e.title]}),r.jsxs(V,{variant:"outline",className:"gap-1",children:[r.jsx(ge,{className:"w-3 h-3"}),s.name]}),r.jsx(V,{variant:"outline",children:s.academic_year})]}),r.jsxs("div",{className:"mt-4",children:[r.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[r.jsx("span",{className:"text-muted-foreground",children:"Postęp w kursie"}),r.jsxs("span",{className:"font-semibold",children:[n.toFixed(1),"%"]})]}),r.jsx("div",{className:"h-3 bg-muted rounded-full overflow-hidden",children:r.jsx("div",{className:"h-full bg-primary transition-all duration-500",style:{width:`${n}%`}})})]})]})]})})},XW=({stats:t})=>{const e=s=>{const n=Math.floor(s/3600),i=Math.floor(s%3600/60);return n>0?`${n}h ${i}m`:`${i} min`};return r.jsxs(Pt,{variant:"2-2-4",children:[r.jsxs(P,{children:[r.jsx(F,{className:"pb-2",children:r.jsxs(L,{className:"text-sm font-medium flex items-center gap-2",children:[r.jsx(ho,{className:"w-4 h-4"}),"Ukończone aktywności"]})}),r.jsxs(I,{children:[r.jsxs("div",{className:"text-2xl font-bold",children:[t.completedActivities,"/",t.totalActivities]}),r.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[t.progressPercentage.toFixed(0),"% kursu"]})]})]}),r.jsxs(P,{children:[r.jsx(F,{className:"pb-2",children:r.jsxs(L,{className:"text-sm font-medium flex items-center gap-2",children:[r.jsx(pt,{className:"w-4 h-4"}),"Zaliczone quizy"]})}),r.jsxs(I,{children:[r.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[t.completedQuizzes,"/",t.totalQuizzes]}),r.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t.totalQuizzes>0?`${(t.completedQuizzes/t.totalQuizzes*100).toFixed(0)}% quizów`:"Brak quizów"})]})]}),r.jsxs(P,{children:[r.jsx(F,{className:"pb-2",children:r.jsxs(L,{className:"text-sm font-medium flex items-center gap-2",children:[r.jsx(Os,{className:"w-4 h-4"}),"Średnia z quizów"]})}),r.jsxs(I,{children:[r.jsx("div",{className:"text-2xl font-bold",children:t.averageScore!==null?`${t.averageScore.toFixed(1)}%`:"—"}),r.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t.averageScore!==null?t.averageScore>=70?"Wynik pozytywny":"Wymaga poprawy":"Brak wyników"})]})]}),r.jsxs(P,{children:[r.jsx(F,{className:"pb-2",children:r.jsxs(L,{className:"text-sm font-medium flex items-center gap-2",children:[r.jsx(Ze,{className:"w-4 h-4"}),"Czas nauki"]})}),r.jsxs(I,{children:[r.jsx("div",{className:"text-2xl font-bold",children:e(t.totalTimeSpent)}),t.lastActivity&&r.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground mt-1",children:[r.jsx(js,{className:"w-3 h-3"}),"Ostatnio: ",new Date(t.lastActivity).toLocaleDateString("pl-PL")]})]})]})]})},eK=({activity:t,progress:e,onViewDetails:s})=>{const[n,i]=j.useState(!1);console.log("ActivityDetailRow Debug:",{title:t.title,time_spent:e?.time_spent,type:typeof e?.time_spent,raw_progress:e});const a=o=>{console.log("formatTime called with:",o,typeof o);const l=typeof o=="string"?parseInt(o):o;if(isNaN(l)||l===0)return"0s";const c=Math.floor(l/60);if(c===0)return`${l}s`;if(c<60)return`${c} min`;const u=Math.floor(c/60),d=c%60;return`${u}h ${d}m`};return e?r.jsxs("div",{className:"border rounded-lg hover:bg-muted/30 transition-colors",children:[r.jsxs("button",{onClick:()=>i(!n),className:"w-full p-3 flex items-center gap-3 text-left",children:[n?r.jsx(ls,{className:"w-4 h-4 text-muted-foreground flex-shrink-0"}):r.jsx(He,{className:"w-4 h-4 text-muted-foreground flex-shrink-0"}),e.completed_at?r.jsx(ho,{className:"w-4 h-4 text-green-600 flex-shrink-0"}):r.jsx(Ze,{className:"w-4 h-4 text-blue-600 flex-shrink-0"}),t.type==="quiz"?r.jsx(cs,{className:"w-4 h-4 text-muted-foreground flex-shrink-0"}):r.jsx(Vr,{className:"w-4 h-4 text-muted-foreground flex-shrink-0"}),r.jsx("h4",{className:"font-medium flex-1 min-w-0",children:t.title}),r.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[r.jsx(V,{variant:"outline",className:"text-xs",children:t.type==="quiz"?"Quiz":"Materiał"}),e.completed_at?r.jsx(V,{className:"bg-green-600 hover:bg-green-700",children:"Ukończono"}):r.jsx(V,{className:"bg-blue-600 hover:bg-blue-700",children:"W trakcie"}),e.score!==null&&r.jsxs(V,{variant:e.score>=(t.passing_score||70)?"default":"destructive",className:e.score>=(t.passing_score||70)?"bg-green-600 hover:bg-green-700":"",children:[e.score.toFixed(0),"%"]})]})]}),n&&r.jsxs("div",{className:"px-3 pb-3 pt-0 space-y-3",children:[r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[r.jsxs("div",{children:[r.jsx("div",{className:"text-muted-foreground text-xs mb-1",children:"Liczba prób"}),r.jsx("div",{className:"font-medium",children:e.attempts})]}),r.jsxs("div",{children:[r.jsx("div",{className:"text-muted-foreground text-xs mb-1",children:"Czas"}),r.jsx("div",{className:"font-medium",children:a(e.time_spent)})]}),r.jsxs("div",{children:[r.jsx("div",{className:"text-muted-foreground text-xs mb-1",children:"Rozpoczęto"}),r.jsx("div",{className:"font-medium",children:new Date(e.started_at).toLocaleDateString("pl-PL")})]}),r.jsxs("div",{children:[r.jsx("div",{className:"text-muted-foreground text-xs mb-1",children:e.completed_at?"Ukończono":"Status"}),r.jsx("div",{className:"font-medium",children:e.completed_at?new Date(e.completed_at).toLocaleDateString("pl-PL"):"Nieukończone"})]})]}),t.type==="quiz"&&s&&r.jsxs(D,{variant:"outline",size:"sm",onClick:s,children:[r.jsx(Vr,{className:"w-3 h-3 mr-2"}),"Zobacz szczegóły próby"]})]})]}):r.jsx("div",{className:"p-3 border rounded-lg hover:bg-muted/30 transition-colors",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(Jo,{className:"w-4 h-4 text-muted-foreground"}),t.type==="quiz"?r.jsx(cs,{className:"w-4 h-4 text-muted-foreground"}):r.jsx(Vr,{className:"w-4 h-4 text-muted-foreground"}),r.jsx("h4",{className:"font-medium flex-1",children:t.title}),r.jsx(V,{variant:"outline",className:"text-xs",children:t.type==="quiz"?"Quiz":"Materiał"}),r.jsx(V,{variant:"secondary",children:"Brak danych"})]})})},tK=({topics:t,onViewQuizDetails:e})=>{const[s,n]=j.useState(new Set(t.map(o=>o.id))),i=o=>{n(l=>{const c=new Set(l);return c.has(o)?c.delete(o):c.add(o),c})},a=o=>{const l=o.activities.length,c=o.activities.filter(d=>d.progress?.completed_at!==null).length,u=l>0?c/l*100:0;return{total:l,completed:c,percentage:u}};return t.length===0?r.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[r.jsx(Se,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),r.jsx("p",{children:"Brak tematów w kursie"})]}):r.jsx("div",{className:"space-y-3",children:t.map((o,l)=>{const c=s.has(o.id),u=a(o);return r.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[r.jsx("button",{onClick:()=>i(o.id),className:"w-full p-4 flex items-center justify-between hover:bg-muted/50 transition-colors",children:r.jsxs("div",{className:"flex items-center gap-3 flex-1 text-left",children:[c?r.jsx(ls,{className:"w-5 h-5 text-muted-foreground flex-shrink-0"}):r.jsx(He,{className:"w-5 h-5 text-muted-foreground flex-shrink-0"}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("h4",{className:"font-semibold",children:["Temat ",l+1,": ",o.title]}),r.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm text-muted-foreground",children:[r.jsxs("span",{children:[o.activities.length," ",o.activities.length===1?"aktywność":"aktywności"]}),r.jsxs("span",{children:["Ukończono: ",u.completed,"/",u.total]})]})]}),r.jsxs("div",{className:"flex-shrink-0 w-24",children:[r.jsxs("div",{className:"text-xs text-muted-foreground mb-1 text-right",children:[u.percentage.toFixed(0),"%"]}),r.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:r.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${u.percentage}%`}})})]})]})}),c&&r.jsx("div",{className:"p-4 pt-0 space-y-2 bg-muted/20",children:o.activities.length>0?o.activities.map(d=>r.jsx(eK,{activity:d,progress:d.progress,onViewDetails:d.type==="quiz"&&d.progress?()=>e?.(d.id):void 0},d.id)):r.jsx("div",{className:"text-center py-6 text-sm text-muted-foreground",children:"Brak aktywności w tym temacie"})})]},o.id)})})},sK=({open:t,onOpenChange:e,activityId:s,activityTitle:n,lastAttempt:i})=>{const[a,o]=j.useState([]),[l,c]=j.useState(!0);j.useEffect(()=>{if(!t||!s)return;(async()=>{c(!0);try{const{data:p,error:x}=await oe.from("questions").select("id, question, points, position, options").eq("activity_id",s).order("position");if(x)throw x;o(p||[])}catch(p){console.error("Error fetching quiz questions:",p),o([])}finally{c(!1)}})()},[t,s]);const u=m=>{const p=Math.floor(m/60),x=m%60;return`${p}:${String(x).padStart(2,"0")}`};if(!i)return r.jsx(pn,{open:t,onOpenChange:e,children:r.jsxs(en,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[r.jsx(tn,{children:r.jsx(sn,{children:n})}),r.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Brak danych o ostatniej próbie"})]})});const d=new Map(i.answers.map(m=>[m.question_id,m.option_id])),h=a.reduce((m,p)=>m+p.points,0),f=a.reduce((m,p)=>{const x=d.get(p.id);if(!x)return m;const y=p.options.find(b=>b.id===x)?.is_correct===!0;return m+(y?p.points:0)},0);return r.jsx(pn,{open:t,onOpenChange:e,children:r.jsxs(en,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[r.jsxs(tn,{children:[r.jsx(sn,{className:"text-xl",children:n}),r.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[r.jsxs(V,{variant:"outline",className:"gap-1",children:[r.jsx(Ze,{className:"w-3 h-3"}),u(i.time)]}),r.jsxs(V,{variant:"outline",className:"gap-1",children:[r.jsx(Os,{className:"w-3 h-3"}),f,"/",h," pkt"]}),r.jsxs(V,{className:i.score>=70?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700",children:[i.score,"%"]})]}),r.jsxs("p",{className:"text-sm text-muted-foreground",children:["Data próby: ",new Date(i.date).toLocaleString("pl-PL")]})]}),l?r.jsx("div",{className:"flex items-center justify-center py-8",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):r.jsxs("div",{className:"space-y-4 mt-4",children:[a.map((m,p)=>{const x=d.get(m.id),g=m.options.find(w=>w.id===x),y=m.options.find(w=>w.is_correct),b=g?.is_correct===!0;return r.jsx("div",{className:`p-4 rounded-lg border-2 ${b?"border-green-200 bg-green-50 dark:bg-green-950/20":"border-red-200 bg-red-50 dark:bg-red-950/20"}`,children:r.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[b?r.jsx(ws,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}):r.jsx(Nu,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[r.jsxs("h4",{className:"font-medium",children:["Pytanie ",p+1]}),r.jsxs(V,{variant:"outline",className:"text-xs",children:[b?m.points:0,"/",m.points," pkt"]})]}),r.jsx("p",{className:"text-sm mb-3",children:m.question}),r.jsxs("div",{className:"space-y-2 text-sm",children:[r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"text-muted-foreground min-w-[100px]",children:"Odpowiedź ucznia:"}),r.jsx("span",{className:`font-medium ${b?"text-green-700 dark:text-green-400":"text-red-700 dark:text-red-400"}`,children:g?.text||"Brak odpowiedzi"})]}),!b&&y&&r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"text-muted-foreground min-w-[100px]",children:"Poprawna odpowiedź:"}),r.jsx("span",{className:"font-medium text-green-700 dark:text-green-400",children:y.text})]})]})]})]})},m.id)}),a.length===0&&r.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Brak pytań do wyświetlenia"})]})]})})},nK=()=>{const{groupId:t,courseId:e,studentId:s}=Qt(),n=pe(),{student:i,group:a,course:o,topicsWithActivities:l,overallStats:c,isLoading:u}=QW(t,e,s),[d,h]=j.useState(!1),[f,m]=j.useState(null),p=x=>{const g=l.flatMap(y=>y.activities).find(y=>y.id===x);g&&g.progress?.last_attempt&&(m({activityId:g.id,activityTitle:g.title,lastAttempt:g.progress.last_attempt}),h(!0))};return u?r.jsx(X,{children:r.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):!i||!a||!o?r.jsx(X,{children:r.jsx("div",{className:"text-center py-12",children:r.jsx("p",{className:"text-muted-foreground",children:"Nie znaleziono danych ucznia, grupy lub kursu"})})}):r.jsxs(X,{children:[r.jsxs(D,{variant:"outline",size:"sm",onClick:()=>n(`/teacher/groups/${t}/courses/${e}/activity`),children:[r.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Powrót do aktywności grupy"]}),r.jsx(YW,{student:i,course:o,group:a,progressPercentage:c.progressPercentage}),r.jsx(XW,{stats:c}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{className:"flex items-center gap-2",children:[r.jsx(Se,{className:"w-5 h-5"}),"Szczegółowy postęp w kursie"]})}),r.jsx(I,{children:r.jsx(tK,{topics:l,onViewQuizDetails:p})})]}),f&&r.jsx(sK,{open:d,onOpenChange:h,activityId:f.activityId,activityTitle:f.activityTitle,lastAttempt:f.lastAttempt})]})},rK={name:"student-course-details",list:"/teacher/groups/:groupId/courses/:courseId/students/:studentId",meta:{label:"Szczegóły ucznia",icon:r.jsx(F1,{className:"h-4 w-4"}),hide:!0}},iK=[r.jsx(Z,{path:"groups/:groupId/courses/:courseId/students/:studentId",element:r.jsx(nK,{})},"student-course-details")],aK=[...VM,...fO,...gO,...vW,...qW,..._W,...EW,...FW,...ZW,...iK],oK=()=>r.jsx(Ld,{children:r.jsxs(Z,{element:r.jsx(BM,{children:r.jsx(Kp,{})}),children:[r.jsx(Z,{index:!0,element:r.jsx(dn,{to:"dashboard/overview",replace:!0})}),r.jsx(Z,{path:"dashboard",element:r.jsx(dn,{to:"dashboard/overview",replace:!0})}),aK]})}),lK=j.lazy(()=>Promise.resolve({default:oK})),vz=({text:t,colorClass:e})=>r.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-background",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:`inline-block h-12 w-12 animate-spin rounded-full border-4 border-current border-r-transparent ${e}`}),r.jsx("p",{className:"mt-4 text-muted-foreground",children:t})]})}),cK=({children:t})=>{const{data:e,isLoading:s}=wt();return s||!e?r.jsx(vz,{text:"Sprawdzanie uprawnień...",colorClass:"border-indigo-600"}):["teacher","admin"].includes(e.role)?r.jsx(r.Fragment,{children:t}):r.jsx(dn,{to:"/student/dashboard",replace:!0})},uK=r.jsx(Z,{path:"/teacher/*",element:r.jsx(Jp,{fallback:r.jsx(Zp,{to:"/login"}),children:r.jsx(cK,{children:r.jsx(j.Suspense,{fallback:r.jsx(vz,{text:"Ładowanie panelu nauczyciela...",colorClass:"border-indigo-600"}),children:r.jsx(lK,{})})})},"teacher-auth")});class dK{constructor(){rn(this,"stats",{points:0,level:1,streak:0,idle_rate:1,next_level_points:200,quizzes_completed:0,perfect_scores:0,total_time:0,rank:0});rn(this,"listeners",new Set);rn(this,"channel",null);rn(this,"userId",null)}subscribe(e){return this.listeners.add(e),e(this.stats),()=>{this.listeners.delete(e)}}notify(){this.listeners.forEach(e=>e(this.stats))}async fetchStats(e){if(e)try{const{data:s,error:n}=await oe.rpc("get_my_stats");if(n)throw n;s&&(console.log("Fetched stats from DB:",s),this.stats={points:s.points||0,level:s.level||1,streak:s.streak||0,idle_rate:s.idle_rate||1,next_level_points:s.next_level_points||200,quizzes_completed:s.quizzes_completed||0,perfect_scores:s.perfect_scores||0,total_time:s.total_time||0,rank:s.rank||0},this.notify())}catch(s){console.error("Error fetching stats:",s)}}setupSubscription(e){this.userId===e&&this.channel||(this.channel&&this.userId!==e&&(console.log("Closing old subscription for user:",this.userId),oe.removeChannel(this.channel),this.channel=null),this.userId=e,console.log("Setting up global stats subscription for user:",e),this.channel=oe.channel(`global-user-stats-${e}`).on("postgres_changes",{event:"*",schema:"public",table:"user_stats",filter:`user_id=eq.${e}`},s=>{console.log("user_stats change received:",s),this.fetchStats(e)}).on("postgres_changes",{event:"INSERT",schema:"public",table:"gamification_log",filter:`user_id=eq.${e}`},s=>{console.log("gamification_log INSERT received:",s),setTimeout(()=>this.fetchStats(e),300)}).subscribe(s=>{console.log("Global subscription status:",s)}),this.fetchStats(e))}cleanup(){this.channel&&(console.log("Cleaning up global subscription"),oe.removeChannel(this.channel),this.channel=null,this.userId=null)}}const nm=new dK,ta=()=>{const{data:t}=wt(),[e,s]=j.useState({points:0,level:1,streak:0,idle_rate:1,next_level_points:200,quizzes_completed:0,perfect_scores:0,total_time:0,rank:0}),[n,i]=j.useState(!0);j.useEffect(()=>t?.id?(nm.setupSubscription(t.id),nm.subscribe(l=>{s(l),i(!1)})):void 0,[t?.id]);const a=j.useCallback(async()=>{t?.id&&(i(!0),await nm.fetchStats(t.id),i(!1))},[t?.id]);return{stats:e,isLoading:n,refetch:a}},tr=new Map,bc=(t,e,s)=>{const n=s?.cacheKey||`${t}-${JSON.stringify(e)}`,[i,a]=j.useState(()=>tr.get(n)||null),[o,l]=j.useState(!tr.has(n)),[c,u]=j.useState(null),d=j.useCallback(async(f=!1)=>{if(s?.enabled!==!1){if(!f&&tr.has(n)){a(tr.get(n)),l(!1);return}try{l(!0),u(null);const{data:m,error:p}=await oe.rpc(t,e);if(p)throw p;tr.set(n,m),a(m),s?.onSuccess?.(m)}catch(m){u(m),s?.onError?.(m)}finally{l(!1)}}},[t,n,JSON.stringify(e),s?.enabled]);j.useEffect(()=>{d()},[d]);const h=j.useCallback(()=>{tr.delete(n)},[n]);return{data:i,isLoading:o,error:c,refetch:()=>d(!0),invalidate:h}},ul=t=>{t?Array.from(tr.keys()).forEach(e=>{e.includes(t)&&tr.delete(e)}):tr.clear()},hK=(t,e)=>{const[s,n]=j.useState([]),[i,a]=j.useState(!0),[o,l]=j.useState(null),c=j.useCallback(async()=>{if(e?.enabled!==!1)try{a(!0),l(null);let u=oe.from(t).select(e?.select||"*");e?.filters?.forEach(f=>{switch(f.operator){case"eq":u=u.eq(f.field,f.value);break;case"in":u=u.in(f.field,f.value);break;case"contains":u=u.ilike(f.field,`%${f.value}%`);break}}),e?.sorts?.forEach(f=>{u=u.order(f.field,{ascending:f.order==="asc"})}),e?.limit&&(u=u.limit(e.limit));const{data:d,error:h}=await u;if(h)throw h;n(d||[])}catch(u){l(u)}finally{a(!1)}},[t,JSON.stringify(e)]);return j.useEffect(()=>{c()},[c]),{data:s,isLoading:i,error:o,refetch:c}},Pj=({onClose:t,variant:e="sidebar"})=>{const{mutate:s}=$d(),{data:n}=wt(),i=gn(),{stats:a}=ta(),o=[{path:"/student/dashboard",label:"Główna",icon:R1},{path:"/student/gamification",label:"Ulepszenia",icon:bm},{path:"/student/leaderboard",label:"Ranking",icon:ft},{path:"/student/achievements",label:"Osiągnięcia",icon:Os},{path:"/student/profile",label:"Profil",icon:gl}],l=()=>{t&&t()};return e==="bottom"?r.jsx("div",{className:"grid grid-cols-5 gap-1 p-1.5",children:o.map(c=>{const u=i.pathname===c.path;return r.jsxs(Ba,{to:c.path,className:({isActive:d})=>U("relative flex flex-col items-center justify-center gap-1 rounded-lg p-3 transition-colors",d?"text-primary":"text-muted-foreground hover:text-foreground hover:bg-muted/50"),children:[r.jsx(c.icon,{className:"h-5 w-5"}),r.jsx("span",{className:"text-[11px] font-medium",children:c.label}),u&&r.jsx("i",{"aria-hidden":!0,className:"pointer-events-none absolute inset-x-6 -bottom-[3px] h-1 rounded-full bg-primary/70"})]},c.path)})}):r.jsxs("div",{className:"flex h-full flex-col",children:[r.jsxs("div",{className:"h-16 px-6 border-b relative grid place-items-center justify-start overflow-hidden",children:[r.jsx("i",{"aria-hidden":!0,className:"absolute -right-10 -top-10 w-28 h-28 rounded-3xl bg-gradient-to-br from-primary/10 via-secondary/10 to-accent/10 rotate-45"}),r.jsxs("div",{className:"flex items-center gap-3 relative z-10",children:[r.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-primary to-secondary text-white grid place-items-center shadow",children:r.jsx(cr,{className:"w-5 h-5"})}),r.jsx("strong",{className:"text-lg",children:"Smart Up"})]}),t&&r.jsx(D,{variant:"ghost",size:"sm",onClick:t,className:"absolute right-4 lg:hidden",children:r.jsx(fn,{className:"h-4 w-4"})})]}),r.jsx("section",{className:"p-6",children:r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-primary/10 to-secondary/10 text-primary grid place-items-center font-bold",children:n?.full_name?.charAt(0)||"U"}),r.jsx("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 rounded-full bg-secondary text-white text-xs grid place-items-center font-bold",children:a.level})]}),r.jsxs("div",{className:"min-w-0",children:[r.jsx("p",{className:"font-semibold truncate",children:n?.full_name}),r.jsxs("p",{className:"text-sm text-muted-foreground",children:["Poziom ",a.level," • ",a.streak," dni"]})]})]})}),r.jsx("section",{className:"px-6 -mt-2 mb-4",children:r.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[r.jsxs("article",{className:"rounded-xl border p-3 bg-primary/5 border-primary/10",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx(Vt,{className:"w-4 h-4 text-primary"}),r.jsx("span",{className:"text-xs text-muted-foreground",children:"Punkty"})]}),r.jsx("p",{className:"text-lg font-bold",children:Math.floor(a.points)}),r.jsxs("p",{className:"text-xs text-primary",children:["+",a.idle_rate,"/h"]})]}),r.jsxs("article",{className:"rounded-xl border p-3 bg-destructive/5 border-destructive/10",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx(An,{className:"w-4 h-4 text-destructive"}),r.jsx("span",{className:"text-xs text-muted-foreground",children:"Seria"})]}),r.jsx("p",{className:"text-lg font-bold",children:a.streak}),r.jsx("p",{className:"text-xs text-destructive",children:"dni z rzędu"})]})]})}),r.jsx(bt,{className:"flex-1 px-4",children:r.jsx("nav",{className:"space-y-1",children:o.map(c=>r.jsxs(Ba,{to:c.path,onClick:l,className:({isActive:u})=>U("relative w-full flex items-center gap-3 px-4 h-11 rounded-xl transition-colors",u?"bg-primary text-primary-foreground":"hover:bg-muted/50 text-muted-foreground hover:text-foreground"),children:[r.jsx(c.icon,{className:"w-5 h-5"}),r.jsx("span",{className:"text-sm font-medium",children:c.label})]},c.path))})}),r.jsx(Zd,{}),r.jsxs("footer",{className:"p-4 space-y-3",children:[r.jsxs("div",{className:"px-2",children:[r.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground mb-2",children:[r.jsxs("span",{children:["Poziom ",a.level]}),r.jsxs("span",{children:["Poziom ",a.level+1]})]}),r.jsx("div",{className:"h-1.5 rounded-full bg-muted overflow-hidden",children:r.jsx("div",{className:"h-full rounded-full bg-gradient-to-r from-primary via-secondary to-accent",style:{width:`${Math.max(0,Math.min(100,a.points%100))}%`}})})]}),r.jsxs(D,{variant:"outline",size:"sm",onClick:()=>{s(),t&&t()},className:"w-full justify-center text-destructive border-destructive/30 bg-destructive/5 hover:bg-destructive/10",children:[r.jsx(Wd,{className:"mr-2 h-4 w-4"}),"Wyloguj"]})]})]})},fK=()=>r.jsx("div",{"aria-hidden":!0,className:"pointer-events-none fixed inset-0 z-0 overflow-hidden p-0 lg:p-2.5 lg:pb-28 pt-0",children:r.jsxs("div",{className:"relative w-full h-full",children:[r.jsx("div",{className:"absolute inset-0 bg-background rounded-3xl"}),r.jsxs("div",{className:"absolute inset-0 rounded-3xl overflow-hidden",children:[r.jsx("div",{className:"absolute w-[50vw] h-[50vh] bottom-0 left-0 translate-y-[25%] -translate-x-[25%] bg-orange rounded-full blur-[150px] opacity-70 dark:opacity-40"}),r.jsx("div",{className:"absolute w-[30vw] h-[30vh] bottom-0 left-1/2 -translate-x-1/2 translate-y-[20%] bg-yellow rounded-full blur-[100px] opacity-60 dark:opacity-30"}),r.jsx("div",{className:"absolute w-[50vw] h-[50vh] bottom-0 right-0 translate-y-[25%] translate-x-[25%] bg-purple rounded-full blur-[150px] opacity-70 dark:opacity-40"})]})]})}),mK=({stats:t,theme:e,onToggleTheme:s})=>{const[n,i]=j.useState(!1),{data:a}=wt(),{mutate:o}=$d(),l=j.useMemo(()=>Math.floor(t.points),[t.points]);return r.jsx("header",{className:"sticky top-0 z-30 h-16 bg-card/80 backdrop-blur supports-[backdrop-filter]:bg-card/60 border-b shadow-sm hidden lg:block",children:r.jsxs("div",{className:"mx-auto max-w-6xl h-full px-4 lg:px-8 flex items-center justify-between",children:[r.jsx("div",{className:"flex items-center gap-3 min-w-0",children:r.jsxs("div",{className:"min-w-0",children:[r.jsx("h1",{className:"text-base sm:text-lg font-semibold truncate",children:"Dashboard"}),r.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:["Witaj, ",a?.full_name?.split(" ")[0],"!"]})]})}),r.jsxs("div",{className:"flex items-center gap-2 lg:gap-3",children:[r.jsxs("button",{className:"relative p-2.5 rounded-xl hover:bg-muted focus-ring h-11 w-11 grid place-items-center","aria-label":"Powiadomienia",children:[r.jsx(G_,{className:"w-5 h-5 text-muted-foreground"}),r.jsx("span",{className:"absolute top-1.5 right-1.5 w-2 h-2 bg-destructive rounded-full"})]}),r.jsxs("div",{className:"flex items-center gap-2 px-3 lg:px-4 h-11 rounded-xl border bg-primary/10 border-primary/20",children:[r.jsx(Vt,{className:"w-4 h-4 text-primary animate-pulse"}),r.jsx("span",{className:"font-semibold text-sm lg:text-base tabular-nums min-w-[3ch] text-right",children:l.toLocaleString("pl-PL")}),r.jsxs("span",{className:"hidden md:block text-xs text-primary",children:["+",t.idle_rate,"/h"]})]}),r.jsxs("div",{className:"relative",children:[r.jsxs("button",{onClick:()=>i(!n),className:"flex items-center gap-2 px-1.5 h-11 rounded-xl hover:bg-muted focus-ring","aria-haspopup":"menu","aria-expanded":n,children:[r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"w-9 h-9 lg:w-10 lg:h-10 rounded-xl bg-gradient-to-br from-primary to-secondary text-white grid place-items-center font-bold",children:a?.full_name?.charAt(0)||"U"}),r.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-4 h-4 lg:w-5 lg:h-5 rounded-full bg-accent text-white text-[10px] lg:text-xs grid place-items-center border-2 border-card",children:t.level})]}),r.jsx(ls,{className:"w-4 h-4 text-muted-foreground"})]}),n&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>i(!1),"aria-hidden":"true"}),r.jsxs("menu",{className:"absolute right-0 mt-2 w-64 bg-card rounded-xl border shadow-soft-lg z-50 overflow-hidden",children:[r.jsxs("section",{className:"p-4 border-b",children:[r.jsx("p",{className:"font-semibold truncate",children:a?.full_name}),r.jsx("p",{className:"text-sm text-muted-foreground truncate",children:a?.email})]}),r.jsxs("ul",{className:"p-2",children:[r.jsx("li",{children:r.jsxs("button",{onClick:()=>{s(),i(!1)},className:"w-full flex items-center gap-3 px-3 h-11 rounded-lg text-foreground/80 hover:text-foreground hover:bg-muted transition-colors",children:[e==="dark"?r.jsx(J_,{className:"w-4 h-4"}):r.jsx(Z_,{className:"w-4 h-4"}),r.jsx("span",{className:"text-sm font-medium",children:e==="dark"?"Tryb jasny":"Tryb ciemny"})]})}),r.jsx("li",{children:r.jsxs("button",{onClick:()=>{window.location.href="/student/profile",i(!1)},className:"w-full flex items-center gap-3 px-3 h-11 rounded-lg text-foreground/80 hover:text-foreground hover:bg-muted transition-colors",children:[r.jsx(gl,{className:"w-4 h-4"}),r.jsx("span",{className:"text-sm font-medium",children:"Profil"})]})}),r.jsx("li",{children:r.jsxs("button",{onClick:()=>{o(),i(!1)},className:"w-full flex items-center gap-3 px-3 h-11 rounded-lg text-destructive hover:bg-destructive/10 transition-colors",children:[r.jsx(Wd,{className:"w-4 h-4"}),r.jsx("span",{className:"text-sm font-medium",children:"Wyloguj"})]})})]})]})]})]})]})]})})},pK=({children:t})=>{const[e,s]=j.useState(!1),[n,i]=j.useState(()=>{const c=localStorage.getItem("theme");return c==="light"||c==="dark"?c:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}),{stats:a}=ta();j.useEffect(()=>{document.documentElement.classList.toggle("dark",n==="dark"),localStorage.setItem("theme",n)},[n]);const o=()=>{i(n==="dark"?"light":"dark")},l=()=>{s(!e)};return r.jsxs("div",{className:"min-h-screen bg-background relative overflow-x-hidden",children:[r.jsx(fK,{}),r.jsxs("div",{className:"flex relative",children:[e&&r.jsx("div",{className:"fixed inset-0 z-40 bg-black/30 dark:bg-black/50 backdrop-blur-sm lg:hidden",onClick:()=>s(!1)}),r.jsx("aside",{className:`
            h-screen w-80 transform transition-transform duration-300 ease-in-out
            fixed left-0 top-0 z-50
            ${e?"translate-x-0":"-translate-x-full"}
            lg:translate-x-0 lg:w-72
            bg-card/95 backdrop-blur-xl border-r
          `,children:r.jsx(Pj,{onClose:()=>s(!1)})}),r.jsxs("main",{className:"flex-1 lg:ml-72 min-w-0 relative z-10",children:[r.jsx("div",{className:"fixed top-0 left-72 right-0 z-30 hidden lg:block",children:r.jsx(mK,{stats:a,theme:n,onToggleTheme:o})}),r.jsxs("div",{className:"sticky top-0 z-30 flex h-16 items-center border-b bg-card/80 backdrop-blur supports-[backdrop-filter]:bg-card/60 px-4 lg:hidden",children:[r.jsx(D,{variant:"ghost",size:"sm",onClick:l,className:"mr-2",children:r.jsx(ec,{className:"h-6 w-6"})}),r.jsx("span",{className:"font-semibold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",children:"Smart Up"})]}),r.jsx("div",{className:"min-h-[calc(100vh-4rem)] pb-32 lg:pb-24 lg:pt-16",children:t})]})]}),r.jsx("nav",{"aria-label":"Nawigacja dolna",className:"fixed py-3.5 bottom-0 z-40 left-0 right-0 lg:left-72 bg-card/95 backdrop-blur-xl border-t",children:r.jsx(Pj,{variant:"bottom"})})]})},Mg=j.createContext({});function Pg(t){const e=j.useRef(null);return e.current===null&&(e.current=t()),e.current}const Ig=typeof window<"u",kz=Ig?j.useLayoutEffect:j.useEffect,qh=j.createContext(null);function Og(t,e){t.indexOf(e)===-1&&t.push(e)}function Rg(t,e){const s=t.indexOf(e);s>-1&&t.splice(s,1)}const ur=(t,e,s)=>s>e?e:s<t?t:s;let Lg=()=>{};const dr={},Nz=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t);function Sz(t){return typeof t=="object"&&t!==null}const Cz=t=>/^0[^.\s]+$/u.test(t);function Fg(t){let e;return()=>(e===void 0&&(e=t()),e)}const Xs=t=>t,xK=(t,e)=>s=>e(t(s)),jc=(...t)=>t.reduce(xK),Hl=(t,e,s)=>{const n=e-t;return n===0?1:(s-t)/n};class $g{constructor(){this.subscriptions=[]}add(e){return Og(this.subscriptions,e),()=>Rg(this.subscriptions,e)}notify(e,s,n){const i=this.subscriptions.length;if(i)if(i===1)this.subscriptions[0](e,s,n);else for(let a=0;a<i;a++){const o=this.subscriptions[a];o&&o(e,s,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Dn=t=>t*1e3,Mn=t=>t/1e3;function zz(t,e){return e?t*(1e3/e):0}const _z=(t,e,s)=>(((1-3*s+3*e)*t+(3*s-6*e))*t+3*e)*t,gK=1e-7,yK=12;function bK(t,e,s,n,i){let a,o,l=0;do o=e+(s-e)/2,a=_z(o,n,i)-t,a>0?s=o:e=o;while(Math.abs(a)>gK&&++l<yK);return o}function wc(t,e,s,n){if(t===e&&s===n)return Xs;const i=a=>bK(a,0,1,t,s);return a=>a===0||a===1?a:_z(i(a),e,n)}const Az=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,Tz=t=>e=>1-t(1-e),Ez=wc(.33,1.53,.69,.99),Bg=Tz(Ez),Dz=Az(Bg),Mz=t=>(t*=2)<1?.5*Bg(t):.5*(2-Math.pow(2,-10*(t-1))),qg=t=>1-Math.sin(Math.acos(t)),Pz=Tz(qg),Iz=Az(qg),jK=wc(.42,0,1,1),wK=wc(0,0,.58,1),Oz=wc(.42,0,.58,1),vK=t=>Array.isArray(t)&&typeof t[0]!="number",Rz=t=>Array.isArray(t)&&typeof t[0]=="number",kK={linear:Xs,easeIn:jK,easeInOut:Oz,easeOut:wK,circIn:qg,circInOut:Iz,circOut:Pz,backIn:Bg,backInOut:Dz,backOut:Ez,anticipate:Mz},NK=t=>typeof t=="string",Ij=t=>{if(Rz(t)){Lg(t.length===4);const[e,s,n,i]=t;return wc(e,s,n,i)}else if(NK(t))return kK[t];return t},Yc=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function SK(t,e){let s=new Set,n=new Set,i=!1,a=!1;const o=new WeakSet;let l={delta:0,timestamp:0,isProcessing:!1};function c(d){o.has(d)&&(u.schedule(d),t()),d(l)}const u={schedule:(d,h=!1,f=!1)=>{const p=f&&i?s:n;return h&&o.add(d),p.has(d)||p.add(d),d},cancel:d=>{n.delete(d),o.delete(d)},process:d=>{if(l=d,i){a=!0;return}i=!0,[s,n]=[n,s],s.forEach(c),s.clear(),i=!1,a&&(a=!1,u.process(d))}};return u}const CK=40;function Lz(t,e){let s=!1,n=!0;const i={delta:0,timestamp:0,isProcessing:!1},a=()=>s=!0,o=Yc.reduce((w,S)=>(w[S]=SK(a),w),{}),{setup:l,read:c,resolveKeyframes:u,preUpdate:d,update:h,preRender:f,render:m,postRender:p}=o,x=()=>{const w=dr.useManualTiming?i.timestamp:performance.now();s=!1,dr.useManualTiming||(i.delta=n?1e3/60:Math.max(Math.min(w-i.timestamp,CK),1)),i.timestamp=w,i.isProcessing=!0,l.process(i),c.process(i),u.process(i),d.process(i),h.process(i),f.process(i),m.process(i),p.process(i),i.isProcessing=!1,s&&e&&(n=!1,t(x))},g=()=>{s=!0,n=!0,i.isProcessing||t(x)};return{schedule:Yc.reduce((w,S)=>{const z=o[S];return w[S]=(N,k=!1,C=!1)=>(s||g(),z.schedule(N,k,C)),w},{}),cancel:w=>{for(let S=0;S<Yc.length;S++)o[Yc[S]].cancel(w)},state:i,steps:o}}const{schedule:Ge,cancel:ti,state:Lt,steps:rm}=Lz(typeof requestAnimationFrame<"u"?requestAnimationFrame:Xs,!0);let pu;function zK(){pu=void 0}const gs={now:()=>(pu===void 0&&gs.set(Lt.isProcessing||dr.useManualTiming?Lt.timestamp:performance.now()),pu),set:t=>{pu=t,queueMicrotask(zK)}},Fz=t=>e=>typeof e=="string"&&e.startsWith(t),Vg=Fz("--"),_K=Fz("var(--"),Ug=t=>_K(t)?AK.test(t.split("/*")[0].trim()):!1,AK=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,No={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},Gl={...No,transform:t=>ur(0,1,t)},Xc={...No,default:1},dl=t=>Math.round(t*1e5)/1e5,Wg=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function TK(t){return t==null}const EK=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Kg=(t,e)=>s=>!!(typeof s=="string"&&EK.test(s)&&s.startsWith(t)||e&&!TK(s)&&Object.prototype.hasOwnProperty.call(s,e)),$z=(t,e,s)=>n=>{if(typeof n!="string")return n;const[i,a,o,l]=n.match(Wg);return{[t]:parseFloat(i),[e]:parseFloat(a),[s]:parseFloat(o),alpha:l!==void 0?parseFloat(l):1}},DK=t=>ur(0,255,t),im={...No,transform:t=>Math.round(DK(t))},Si={test:Kg("rgb","red"),parse:$z("red","green","blue"),transform:({red:t,green:e,blue:s,alpha:n=1})=>"rgba("+im.transform(t)+", "+im.transform(e)+", "+im.transform(s)+", "+dl(Gl.transform(n))+")"};function MK(t){let e="",s="",n="",i="";return t.length>5?(e=t.substring(1,3),s=t.substring(3,5),n=t.substring(5,7),i=t.substring(7,9)):(e=t.substring(1,2),s=t.substring(2,3),n=t.substring(3,4),i=t.substring(4,5),e+=e,s+=s,n+=n,i+=i),{red:parseInt(e,16),green:parseInt(s,16),blue:parseInt(n,16),alpha:i?parseInt(i,16)/255:1}}const kp={test:Kg("#"),parse:MK,transform:Si.transform},vc=t=>({test:e=>typeof e=="string"&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),Sr=vc("deg"),Pn=vc("%"),ce=vc("px"),PK=vc("vh"),IK=vc("vw"),Oj={...Pn,parse:t=>Pn.parse(t)/100,transform:t=>Pn.transform(t*100)},za={test:Kg("hsl","hue"),parse:$z("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:s,alpha:n=1})=>"hsla("+Math.round(t)+", "+Pn.transform(dl(e))+", "+Pn.transform(dl(s))+", "+dl(Gl.transform(n))+")"},xt={test:t=>Si.test(t)||kp.test(t)||za.test(t),parse:t=>Si.test(t)?Si.parse(t):za.test(t)?za.parse(t):kp.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?Si.transform(t):za.transform(t),getAnimatableNone:t=>{const e=xt.parse(t);return e.alpha=0,xt.transform(e)}},OK=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function RK(t){return isNaN(t)&&typeof t=="string"&&(t.match(Wg)?.length||0)+(t.match(OK)?.length||0)>0}const Bz="number",qz="color",LK="var",FK="var(",Rj="${}",$K=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Jl(t){const e=t.toString(),s=[],n={color:[],number:[],var:[]},i=[];let a=0;const l=e.replace($K,c=>(xt.test(c)?(n.color.push(a),i.push(qz),s.push(xt.parse(c))):c.startsWith(FK)?(n.var.push(a),i.push(LK),s.push(c)):(n.number.push(a),i.push(Bz),s.push(parseFloat(c))),++a,Rj)).split(Rj);return{values:s,split:l,indexes:n,types:i}}function Vz(t){return Jl(t).values}function Uz(t){const{split:e,types:s}=Jl(t),n=e.length;return i=>{let a="";for(let o=0;o<n;o++)if(a+=e[o],i[o]!==void 0){const l=s[o];l===Bz?a+=dl(i[o]):l===qz?a+=xt.transform(i[o]):a+=i[o]}return a}}const BK=t=>typeof t=="number"?0:xt.test(t)?xt.getAnimatableNone(t):t;function qK(t){const e=Vz(t);return Uz(t)(e.map(BK))}const si={test:RK,parse:Vz,createTransformer:Uz,getAnimatableNone:qK};function am(t,e,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?t+(e-t)*6*s:s<1/2?e:s<2/3?t+(e-t)*(2/3-s)*6:t}function VK({hue:t,saturation:e,lightness:s,alpha:n}){t/=360,e/=100,s/=100;let i=0,a=0,o=0;if(!e)i=a=o=s;else{const l=s<.5?s*(1+e):s+e-s*e,c=2*s-l;i=am(c,l,t+1/3),a=am(c,l,t),o=am(c,l,t-1/3)}return{red:Math.round(i*255),green:Math.round(a*255),blue:Math.round(o*255),alpha:n}}function Ed(t,e){return s=>s>0?e:t}const et=(t,e,s)=>t+(e-t)*s,om=(t,e,s)=>{const n=t*t,i=s*(e*e-n)+n;return i<0?0:Math.sqrt(i)},UK=[kp,Si,za],WK=t=>UK.find(e=>e.test(t));function Lj(t){const e=WK(t);if(!e)return!1;let s=e.parse(t);return e===za&&(s=VK(s)),s}const Fj=(t,e)=>{const s=Lj(t),n=Lj(e);if(!s||!n)return Ed(t,e);const i={...s};return a=>(i.red=om(s.red,n.red,a),i.green=om(s.green,n.green,a),i.blue=om(s.blue,n.blue,a),i.alpha=et(s.alpha,n.alpha,a),Si.transform(i))},Np=new Set(["none","hidden"]);function KK(t,e){return Np.has(t)?s=>s<=0?t:e:s=>s>=1?e:t}function HK(t,e){return s=>et(t,e,s)}function Hg(t){return typeof t=="number"?HK:typeof t=="string"?Ug(t)?Ed:xt.test(t)?Fj:ZK:Array.isArray(t)?Wz:typeof t=="object"?xt.test(t)?Fj:GK:Ed}function Wz(t,e){const s=[...t],n=s.length,i=t.map((a,o)=>Hg(a)(a,e[o]));return a=>{for(let o=0;o<n;o++)s[o]=i[o](a);return s}}function GK(t,e){const s={...t,...e},n={};for(const i in s)t[i]!==void 0&&e[i]!==void 0&&(n[i]=Hg(t[i])(t[i],e[i]));return i=>{for(const a in n)s[a]=n[a](i);return s}}function JK(t,e){const s=[],n={color:0,var:0,number:0};for(let i=0;i<e.values.length;i++){const a=e.types[i],o=t.indexes[a][n[a]],l=t.values[o]??0;s[i]=l,n[a]++}return s}const ZK=(t,e)=>{const s=si.createTransformer(e),n=Jl(t),i=Jl(e);return n.indexes.var.length===i.indexes.var.length&&n.indexes.color.length===i.indexes.color.length&&n.indexes.number.length>=i.indexes.number.length?Np.has(t)&&!i.values.length||Np.has(e)&&!n.values.length?KK(t,e):jc(Wz(JK(n,i),i.values),s):Ed(t,e)};function Kz(t,e,s){return typeof t=="number"&&typeof e=="number"&&typeof s=="number"?et(t,e,s):Hg(t)(t,e)}const QK=t=>{const e=({timestamp:s})=>t(s);return{start:(s=!0)=>Ge.update(e,s),stop:()=>ti(e),now:()=>Lt.isProcessing?Lt.timestamp:gs.now()}},Hz=(t,e,s=10)=>{let n="";const i=Math.max(Math.round(e/s),2);for(let a=0;a<i;a++)n+=Math.round(t(a/(i-1))*1e4)/1e4+", ";return`linear(${n.substring(0,n.length-2)})`},Dd=2e4;function Gg(t){let e=0;const s=50;let n=t.next(e);for(;!n.done&&e<Dd;)e+=s,n=t.next(e);return e>=Dd?1/0:e}function YK(t,e=100,s){const n=s({...t,keyframes:[0,e]}),i=Math.min(Gg(n),Dd);return{type:"keyframes",ease:a=>n.next(i*a).value/e,duration:Mn(i)}}const XK=5;function Gz(t,e,s){const n=Math.max(e-XK,0);return zz(s-t(n),e-n)}const it={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},lm=.001;function eH({duration:t=it.duration,bounce:e=it.bounce,velocity:s=it.velocity,mass:n=it.mass}){let i,a,o=1-e;o=ur(it.minDamping,it.maxDamping,o),t=ur(it.minDuration,it.maxDuration,Mn(t)),o<1?(i=u=>{const d=u*o,h=d*t,f=d-s,m=Sp(u,o),p=Math.exp(-h);return lm-f/m*p},a=u=>{const h=u*o*t,f=h*s+s,m=Math.pow(o,2)*Math.pow(u,2)*t,p=Math.exp(-h),x=Sp(Math.pow(u,2),o);return(-i(u)+lm>0?-1:1)*((f-m)*p)/x}):(i=u=>{const d=Math.exp(-u*t),h=(u-s)*t+1;return-lm+d*h},a=u=>{const d=Math.exp(-u*t),h=(s-u)*(t*t);return d*h});const l=5/t,c=sH(i,a,l);if(t=Dn(t),isNaN(c))return{stiffness:it.stiffness,damping:it.damping,duration:t};{const u=Math.pow(c,2)*n;return{stiffness:u,damping:o*2*Math.sqrt(n*u),duration:t}}}const tH=12;function sH(t,e,s){let n=s;for(let i=1;i<tH;i++)n=n-t(n)/e(n);return n}function Sp(t,e){return t*Math.sqrt(1-e*e)}const nH=["duration","bounce"],rH=["stiffness","damping","mass"];function $j(t,e){return e.some(s=>t[s]!==void 0)}function iH(t){let e={velocity:it.velocity,stiffness:it.stiffness,damping:it.damping,mass:it.mass,isResolvedFromDuration:!1,...t};if(!$j(t,rH)&&$j(t,nH))if(t.visualDuration){const s=t.visualDuration,n=2*Math.PI/(s*1.2),i=n*n,a=2*ur(.05,1,1-(t.bounce||0))*Math.sqrt(i);e={...e,mass:it.mass,stiffness:i,damping:a}}else{const s=eH(t);e={...e,...s,mass:it.mass},e.isResolvedFromDuration=!0}return e}function Md(t=it.visualDuration,e=it.bounce){const s=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:e}:t;let{restSpeed:n,restDelta:i}=s;const a=s.keyframes[0],o=s.keyframes[s.keyframes.length-1],l={done:!1,value:a},{stiffness:c,damping:u,mass:d,duration:h,velocity:f,isResolvedFromDuration:m}=iH({...s,velocity:-Mn(s.velocity||0)}),p=f||0,x=u/(2*Math.sqrt(c*d)),g=o-a,y=Mn(Math.sqrt(c/d)),b=Math.abs(g)<5;n||(n=b?it.restSpeed.granular:it.restSpeed.default),i||(i=b?it.restDelta.granular:it.restDelta.default);let w;if(x<1){const z=Sp(y,x);w=N=>{const k=Math.exp(-x*y*N);return o-k*((p+x*y*g)/z*Math.sin(z*N)+g*Math.cos(z*N))}}else if(x===1)w=z=>o-Math.exp(-y*z)*(g+(p+y*g)*z);else{const z=y*Math.sqrt(x*x-1);w=N=>{const k=Math.exp(-x*y*N),C=Math.min(z*N,300);return o-k*((p+x*y*g)*Math.sinh(C)+z*g*Math.cosh(C))/z}}const S={calculatedDuration:m&&h||null,next:z=>{const N=w(z);if(m)l.done=z>=h;else{let k=z===0?p:0;x<1&&(k=z===0?Dn(p):Gz(w,z,N));const C=Math.abs(k)<=n,T=Math.abs(o-N)<=i;l.done=C&&T}return l.value=l.done?o:N,l},toString:()=>{const z=Math.min(Gg(S),Dd),N=Hz(k=>S.next(z*k).value,z,30);return z+"ms "+N},toTransition:()=>{}};return S}Md.applyToOptions=t=>{const e=YK(t,100,Md);return t.ease=e.ease,t.duration=Dn(e.duration),t.type="keyframes",t};function Cp({keyframes:t,velocity:e=0,power:s=.8,timeConstant:n=325,bounceDamping:i=10,bounceStiffness:a=500,modifyTarget:o,min:l,max:c,restDelta:u=.5,restSpeed:d}){const h=t[0],f={done:!1,value:h},m=C=>l!==void 0&&C<l||c!==void 0&&C>c,p=C=>l===void 0?c:c===void 0||Math.abs(l-C)<Math.abs(c-C)?l:c;let x=s*e;const g=h+x,y=o===void 0?g:o(g);y!==g&&(x=y-h);const b=C=>-x*Math.exp(-C/n),w=C=>y+b(C),S=C=>{const T=b(C),v=w(C);f.done=Math.abs(T)<=u,f.value=f.done?y:v};let z,N;const k=C=>{m(f.value)&&(z=C,N=Md({keyframes:[f.value,p(f.value)],velocity:Gz(w,C,f.value),damping:i,stiffness:a,restDelta:u,restSpeed:d}))};return k(0),{calculatedDuration:null,next:C=>{let T=!1;return!N&&z===void 0&&(T=!0,S(C),k(C)),z!==void 0&&C>=z?N.next(C-z):(!T&&S(C),f)}}}function aH(t,e,s){const n=[],i=s||dr.mix||Kz,a=t.length-1;for(let o=0;o<a;o++){let l=i(t[o],t[o+1]);if(e){const c=Array.isArray(e)?e[o]||Xs:e;l=jc(c,l)}n.push(l)}return n}function oH(t,e,{clamp:s=!0,ease:n,mixer:i}={}){const a=t.length;if(Lg(a===e.length),a===1)return()=>e[0];if(a===2&&e[0]===e[1])return()=>e[1];const o=t[0]===t[1];t[0]>t[a-1]&&(t=[...t].reverse(),e=[...e].reverse());const l=aH(e,n,i),c=l.length,u=d=>{if(o&&d<t[0])return e[0];let h=0;if(c>1)for(;h<t.length-2&&!(d<t[h+1]);h++);const f=Hl(t[h],t[h+1],d);return l[h](f)};return s?d=>u(ur(t[0],t[a-1],d)):u}function lH(t,e){const s=t[t.length-1];for(let n=1;n<=e;n++){const i=Hl(0,e,n);t.push(et(s,1,i))}}function cH(t){const e=[0];return lH(e,t.length-1),e}function uH(t,e){return t.map(s=>s*e)}function dH(t,e){return t.map(()=>e||Oz).splice(0,t.length-1)}function hl({duration:t=300,keyframes:e,times:s,ease:n="easeInOut"}){const i=vK(n)?n.map(Ij):Ij(n),a={done:!1,value:e[0]},o=uH(s&&s.length===e.length?s:cH(e),t),l=oH(o,e,{ease:Array.isArray(i)?i:dH(e,i)});return{calculatedDuration:t,next:c=>(a.value=l(c),a.done=c>=t,a)}}const hH=t=>t!==null;function Jg(t,{repeat:e,repeatType:s="loop"},n,i=1){const a=t.filter(hH),l=i<0||e&&s!=="loop"&&e%2===1?0:a.length-1;return!l||n===void 0?a[l]:n}const fH={decay:Cp,inertia:Cp,tween:hl,keyframes:hl,spring:Md};function Jz(t){typeof t.type=="string"&&(t.type=fH[t.type])}class Zg{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,s){return this.finished.then(e,s)}}const mH=t=>t/100;class Qg extends Zg{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:s}=this.options;s&&s.updatedAt!==gs.now()&&this.tick(gs.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;Jz(e);const{type:s=hl,repeat:n=0,repeatDelay:i=0,repeatType:a,velocity:o=0}=e;let{keyframes:l}=e;const c=s||hl;c!==hl&&typeof l[0]!="number"&&(this.mixKeyframes=jc(mH,Kz(l[0],l[1])),l=[0,100]);const u=c({...e,keyframes:l});a==="mirror"&&(this.mirroredGenerator=c({...e,keyframes:[...l].reverse(),velocity:-o})),u.calculatedDuration===null&&(u.calculatedDuration=Gg(u));const{calculatedDuration:d}=u;this.calculatedDuration=d,this.resolvedDuration=d+i,this.totalDuration=this.resolvedDuration*(n+1)-i,this.generator=u}updateTime(e){const s=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=s}tick(e,s=!1){const{generator:n,totalDuration:i,mixKeyframes:a,mirroredGenerator:o,resolvedDuration:l,calculatedDuration:c}=this;if(this.startTime===null)return n.next(0);const{delay:u=0,keyframes:d,repeat:h,repeatType:f,repeatDelay:m,type:p,onUpdate:x,finalKeyframe:g}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-i/this.speed,this.startTime)),s?this.currentTime=e:this.updateTime(e);const y=this.currentTime-u*(this.playbackSpeed>=0?1:-1),b=this.playbackSpeed>=0?y<0:y>i;this.currentTime=Math.max(y,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=i);let w=this.currentTime,S=n;if(h){const C=Math.min(this.currentTime,i)/l;let T=Math.floor(C),v=C%1;!v&&C>=1&&(v=1),v===1&&T--,T=Math.min(T,h+1),!!(T%2)&&(f==="reverse"?(v=1-v,m&&(v-=m/l)):f==="mirror"&&(S=o)),w=ur(0,1,v)*l}const z=b?{done:!1,value:d[0]}:S.next(w);a&&(z.value=a(z.value));let{done:N}=z;!b&&c!==null&&(N=this.playbackSpeed>=0?this.currentTime>=i:this.currentTime<=0);const k=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&N);return k&&p!==Cp&&(z.value=Jg(d,this.options,g,this.speed)),x&&x(z.value),k&&this.finish(),z}then(e,s){return this.finished.then(e,s)}get duration(){return Mn(this.calculatedDuration)}get time(){return Mn(this.currentTime)}set time(e){e=Dn(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(gs.now());const s=this.playbackSpeed!==e;this.playbackSpeed=e,s&&(this.time=Mn(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=QK,startTime:s}=this.options;this.driver||(this.driver=e(i=>this.tick(i))),this.options.onPlay?.();const n=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=n):this.holdTime!==null?this.startTime=n-this.holdTime:this.startTime||(this.startTime=s??n),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(gs.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}function pH(t){for(let e=1;e<t.length;e++)t[e]??(t[e]=t[e-1])}const Ci=t=>t*180/Math.PI,zp=t=>{const e=Ci(Math.atan2(t[1],t[0]));return _p(e)},xH={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:t=>(Math.abs(t[0])+Math.abs(t[3]))/2,rotate:zp,rotateZ:zp,skewX:t=>Ci(Math.atan(t[1])),skewY:t=>Ci(Math.atan(t[2])),skew:t=>(Math.abs(t[1])+Math.abs(t[2]))/2},_p=t=>(t=t%360,t<0&&(t+=360),t),Bj=zp,qj=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),Vj=t=>Math.sqrt(t[4]*t[4]+t[5]*t[5]),gH={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:qj,scaleY:Vj,scale:t=>(qj(t)+Vj(t))/2,rotateX:t=>_p(Ci(Math.atan2(t[6],t[5]))),rotateY:t=>_p(Ci(Math.atan2(-t[2],t[0]))),rotateZ:Bj,rotate:Bj,skewX:t=>Ci(Math.atan(t[4])),skewY:t=>Ci(Math.atan(t[1])),skew:t=>(Math.abs(t[1])+Math.abs(t[4]))/2};function Ap(t){return t.includes("scale")?1:0}function Tp(t,e){if(!t||t==="none")return Ap(e);const s=t.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let n,i;if(s)n=gH,i=s;else{const l=t.match(/^matrix\(([-\d.e\s,]+)\)$/u);n=xH,i=l}if(!i)return Ap(e);const a=n[e],o=i[1].split(",").map(bH);return typeof a=="function"?a(o):o[a]}const yH=(t,e)=>{const{transform:s="none"}=getComputedStyle(t);return Tp(s,e)};function bH(t){return parseFloat(t.trim())}const So=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Co=new Set(So),Uj=t=>t===No||t===ce,jH=new Set(["x","y","z"]),wH=So.filter(t=>!jH.has(t));function vH(t){const e=[];return wH.forEach(s=>{const n=t.getValue(s);n!==void 0&&(e.push([s,n.get()]),n.set(s.startsWith("scale")?1:0))}),e}const Di={width:({x:t},{paddingLeft:e="0",paddingRight:s="0"})=>t.max-t.min-parseFloat(e)-parseFloat(s),height:({y:t},{paddingTop:e="0",paddingBottom:s="0"})=>t.max-t.min-parseFloat(e)-parseFloat(s),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:(t,{transform:e})=>Tp(e,"x"),y:(t,{transform:e})=>Tp(e,"y")};Di.translateX=Di.x;Di.translateY=Di.y;const Mi=new Set;let Ep=!1,Dp=!1,Mp=!1;function Zz(){if(Dp){const t=Array.from(Mi).filter(n=>n.needsMeasurement),e=new Set(t.map(n=>n.element)),s=new Map;e.forEach(n=>{const i=vH(n);i.length&&(s.set(n,i),n.render())}),t.forEach(n=>n.measureInitialState()),e.forEach(n=>{n.render();const i=s.get(n);i&&i.forEach(([a,o])=>{n.getValue(a)?.set(o)})}),t.forEach(n=>n.measureEndState()),t.forEach(n=>{n.suspendedScrollY!==void 0&&window.scrollTo(0,n.suspendedScrollY)})}Dp=!1,Ep=!1,Mi.forEach(t=>t.complete(Mp)),Mi.clear()}function Qz(){Mi.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(Dp=!0)})}function kH(){Mp=!0,Qz(),Zz(),Mp=!1}class Yg{constructor(e,s,n,i,a,o=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=s,this.name=n,this.motionValue=i,this.element=a,this.isAsync=o}scheduleResolve(){this.state="scheduled",this.isAsync?(Mi.add(this),Ep||(Ep=!0,Ge.read(Qz),Ge.resolveKeyframes(Zz))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:s,element:n,motionValue:i}=this;if(e[0]===null){const a=i?.get(),o=e[e.length-1];if(a!==void 0)e[0]=a;else if(n&&s){const l=n.readValue(s,o);l!=null&&(e[0]=l)}e[0]===void 0&&(e[0]=o),i&&a===void 0&&i.set(e[0])}pH(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),Mi.delete(this)}cancel(){this.state==="scheduled"&&(Mi.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const NH=t=>t.startsWith("--");function SH(t,e,s){NH(e)?t.style.setProperty(e,s):t.style[e]=s}const CH=Fg(()=>window.ScrollTimeline!==void 0),zH={};function _H(t,e){const s=Fg(t);return()=>zH[e]??s()}const Yz=_H(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Go=([t,e,s,n])=>`cubic-bezier(${t}, ${e}, ${s}, ${n})`,Wj={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Go([0,.65,.55,1]),circOut:Go([.55,0,1,.45]),backIn:Go([.31,.01,.66,-.59]),backOut:Go([.33,1.53,.69,.99])};function Xz(t,e){if(t)return typeof t=="function"?Yz()?Hz(t,e):"ease-out":Rz(t)?Go(t):Array.isArray(t)?t.map(s=>Xz(s,e)||Wj.easeOut):Wj[t]}function AH(t,e,s,{delay:n=0,duration:i=300,repeat:a=0,repeatType:o="loop",ease:l="easeOut",times:c}={},u=void 0){const d={[e]:s};c&&(d.offset=c);const h=Xz(l,i);Array.isArray(h)&&(d.easing=h);const f={delay:n,duration:i,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:a+1,direction:o==="reverse"?"alternate":"normal"};return u&&(f.pseudoElement=u),t.animate(d,f)}function e3(t){return typeof t=="function"&&"applyToOptions"in t}function TH({type:t,...e}){return e3(t)&&Yz()?t.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class EH extends Zg{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:s,name:n,keyframes:i,pseudoElement:a,allowFlatten:o=!1,finalKeyframe:l,onComplete:c}=e;this.isPseudoElement=!!a,this.allowFlatten=o,this.options=e,Lg(typeof e.type!="string");const u=TH(e);this.animation=AH(s,n,i,u,a),u.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!a){const d=Jg(i,this.options,l,this.speed);this.updateMotionValue?this.updateMotionValue(d):SH(s,n,d),this.animation.cancel()}c?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return Mn(Number(e))}get time(){return Mn(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=Dn(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:s}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&CH()?(this.animation.timeline=e,Xs):s(this)}}const t3={anticipate:Mz,backInOut:Dz,circInOut:Iz};function DH(t){return t in t3}function MH(t){typeof t.ease=="string"&&DH(t.ease)&&(t.ease=t3[t.ease])}const Kj=10;class PH extends EH{constructor(e){MH(e),Jz(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:s,onUpdate:n,onComplete:i,element:a,...o}=this.options;if(!s)return;if(e!==void 0){s.set(e);return}const l=new Qg({...o,autoplay:!1}),c=Dn(this.finishedTime??this.time);s.setWithVelocity(l.sample(c-Kj).value,l.sample(c).value,Kj),l.stop()}}const Hj=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(si.test(t)||t==="0")&&!t.startsWith("url("));function IH(t){const e=t[0];if(t.length===1)return!0;for(let s=0;s<t.length;s++)if(t[s]!==e)return!0}function OH(t,e,s,n){const i=t[0];if(i===null)return!1;if(e==="display"||e==="visibility")return!0;const a=t[t.length-1],o=Hj(i,e),l=Hj(a,e);return!o||!l?!1:IH(t)||(s==="spring"||e3(s))&&n}function Pp(t){t.duration=0,t.type}const RH=new Set(["opacity","clipPath","filter","transform"]),LH=Fg(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function FH(t){const{motionValue:e,name:s,repeatDelay:n,repeatType:i,damping:a,type:o}=t;if(!(e?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:c,transformTemplate:u}=e.owner.getProps();return LH()&&s&&RH.has(s)&&(s!=="transform"||!u)&&!c&&!n&&i!=="mirror"&&a!==0&&o!=="inertia"}const $H=40;class BH extends Zg{constructor({autoplay:e=!0,delay:s=0,type:n="keyframes",repeat:i=0,repeatDelay:a=0,repeatType:o="loop",keyframes:l,name:c,motionValue:u,element:d,...h}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=gs.now();const f={autoplay:e,delay:s,type:n,repeat:i,repeatDelay:a,repeatType:o,name:c,motionValue:u,element:d,...h},m=d?.KeyframeResolver||Yg;this.keyframeResolver=new m(l,(p,x,g)=>this.onKeyframesResolved(p,x,f,!g),c,u,d),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,s,n,i){this.keyframeResolver=void 0;const{name:a,type:o,velocity:l,delay:c,isHandoff:u,onUpdate:d}=n;this.resolvedAt=gs.now(),OH(e,a,o,l)||((dr.instantAnimations||!c)&&d?.(Jg(e,n,s)),e[0]=e[e.length-1],Pp(n),n.repeat=0);const f={startTime:i?this.resolvedAt?this.resolvedAt-this.createdAt>$H?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:s,...n,keyframes:e},m=!u&&FH(f)?new PH({...f,element:f.motionValue.owner.current}):new Qg(f);m.finished.then(()=>this.notifyFinished()).catch(Xs),this.pendingTimeline&&(this.stopTimeline=m.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=m}get finished(){return this._animation?this.animation.finished:this._finished}then(e,s){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),kH()),this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const qH=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function VH(t){const e=qH.exec(t);if(!e)return[,];const[,s,n,i]=e;return[`--${s??n}`,i]}function s3(t,e,s=1){const[n,i]=VH(t);if(!n)return;const a=window.getComputedStyle(e).getPropertyValue(n);if(a){const o=a.trim();return Nz(o)?parseFloat(o):o}return Ug(i)?s3(i,e,s+1):i}function Xg(t,e){return t?.[e]??t?.default??t}const n3=new Set(["width","height","top","left","right","bottom",...So]),UH={test:t=>t==="auto",parse:t=>t},r3=t=>e=>e.test(t),i3=[No,ce,Pn,Sr,IK,PK,UH],Gj=t=>i3.find(r3(t));function WH(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||Cz(t):!0}const KH=new Set(["brightness","contrast","saturate","opacity"]);function HH(t){const[e,s]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[n]=s.match(Wg)||[];if(!n)return t;const i=s.replace(n,"");let a=KH.has(e)?1:0;return n!==s&&(a*=100),e+"("+a+i+")"}const GH=/\b([a-z-]*)\(.*?\)/gu,Ip={...si,getAnimatableNone:t=>{const e=t.match(GH);return e?e.map(HH).join(" "):t}},Jj={...No,transform:Math.round},JH={rotate:Sr,rotateX:Sr,rotateY:Sr,rotateZ:Sr,scale:Xc,scaleX:Xc,scaleY:Xc,scaleZ:Xc,skew:Sr,skewX:Sr,skewY:Sr,distance:ce,translateX:ce,translateY:ce,translateZ:ce,x:ce,y:ce,z:ce,perspective:ce,transformPerspective:ce,opacity:Gl,originX:Oj,originY:Oj,originZ:ce},e0={borderWidth:ce,borderTopWidth:ce,borderRightWidth:ce,borderBottomWidth:ce,borderLeftWidth:ce,borderRadius:ce,radius:ce,borderTopLeftRadius:ce,borderTopRightRadius:ce,borderBottomRightRadius:ce,borderBottomLeftRadius:ce,width:ce,maxWidth:ce,height:ce,maxHeight:ce,top:ce,right:ce,bottom:ce,left:ce,padding:ce,paddingTop:ce,paddingRight:ce,paddingBottom:ce,paddingLeft:ce,margin:ce,marginTop:ce,marginRight:ce,marginBottom:ce,marginLeft:ce,backgroundPositionX:ce,backgroundPositionY:ce,...JH,zIndex:Jj,fillOpacity:Gl,strokeOpacity:Gl,numOctaves:Jj},ZH={...e0,color:xt,backgroundColor:xt,outlineColor:xt,fill:xt,stroke:xt,borderColor:xt,borderTopColor:xt,borderRightColor:xt,borderBottomColor:xt,borderLeftColor:xt,filter:Ip,WebkitFilter:Ip},a3=t=>ZH[t];function o3(t,e){let s=a3(t);return s!==Ip&&(s=si),s.getAnimatableNone?s.getAnimatableNone(e):void 0}const QH=new Set(["auto","none","0"]);function YH(t,e,s){let n=0,i;for(;n<t.length&&!i;){const a=t[n];typeof a=="string"&&!QH.has(a)&&Jl(a).values.length&&(i=t[n]),n++}if(i&&s)for(const a of e)t[a]=o3(s,i)}class XH extends Yg{constructor(e,s,n,i,a){super(e,s,n,i,a,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:s,name:n}=this;if(!s||!s.current)return;super.readKeyframes();for(let c=0;c<e.length;c++){let u=e[c];if(typeof u=="string"&&(u=u.trim(),Ug(u))){const d=s3(u,s.current);d!==void 0&&(e[c]=d),c===e.length-1&&(this.finalKeyframe=u)}}if(this.resolveNoneKeyframes(),!n3.has(n)||e.length!==2)return;const[i,a]=e,o=Gj(i),l=Gj(a);if(o!==l)if(Uj(o)&&Uj(l))for(let c=0;c<e.length;c++){const u=e[c];typeof u=="string"&&(e[c]=parseFloat(u))}else Di[n]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:s}=this,n=[];for(let i=0;i<e.length;i++)(e[i]===null||WH(e[i]))&&n.push(i);n.length&&YH(e,n,s)}measureInitialState(){const{element:e,unresolvedKeyframes:s,name:n}=this;if(!e||!e.current)return;n==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Di[n](e.measureViewportBox(),window.getComputedStyle(e.current)),s[0]=this.measuredOrigin;const i=s[s.length-1];i!==void 0&&e.getValue(n,i).jump(i,!1)}measureEndState(){const{element:e,name:s,unresolvedKeyframes:n}=this;if(!e||!e.current)return;const i=e.getValue(s);i&&i.jump(this.measuredOrigin,!1);const a=n.length-1,o=n[a];n[a]=Di[s](e.measureViewportBox(),window.getComputedStyle(e.current)),o!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=o),this.removedTransforms?.length&&this.removedTransforms.forEach(([l,c])=>{e.getValue(l).set(c)}),this.resolveNoneKeyframes()}}function eG(t,e,s){if(t instanceof EventTarget)return[t];if(typeof t=="string"){let n=document;const i=s?.[t]??n.querySelectorAll(t);return i?Array.from(i):[]}return Array.from(t)}const l3=(t,e)=>e&&typeof t=="number"?e.transform(t):t;function c3(t){return Sz(t)&&"offsetHeight"in t}const Zj=30,tG=t=>!isNaN(parseFloat(t));class sG{constructor(e,s={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=n=>{const i=gs.now();if(this.updatedAt!==i&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(n),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const a of this.dependents)a.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=s.owner}setCurrent(e){this.current=e,this.updatedAt=gs.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=tG(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,s){this.events[e]||(this.events[e]=new $g);const n=this.events[e].add(s);return e==="change"?()=>{n(),Ge.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,s){this.passiveEffect=e,this.stopPassiveEffect=s}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,s,n){this.set(s),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-n}jump(e,s=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,s&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=gs.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>Zj)return 0;const s=Math.min(this.updatedAt-this.prevUpdatedAt,Zj);return zz(parseFloat(this.current)-parseFloat(this.prevFrameValue),s)}start(e){return this.stop(),new Promise(s=>{this.hasAnimated=!0,this.animation=e(s),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function oo(t,e){return new sG(t,e)}const{schedule:t0}=Lz(queueMicrotask,!1),on={x:!1,y:!1};function u3(){return on.x||on.y}function nG(t){return t==="x"||t==="y"?on[t]?null:(on[t]=!0,()=>{on[t]=!1}):on.x||on.y?null:(on.x=on.y=!0,()=>{on.x=on.y=!1})}function d3(t,e){const s=eG(t),n=new AbortController,i={passive:!0,...e,signal:n.signal};return[s,i,()=>n.abort()]}function Qj(t){return!(t.pointerType==="touch"||u3())}function rG(t,e,s={}){const[n,i,a]=d3(t,s),o=l=>{if(!Qj(l))return;const{target:c}=l,u=e(c,l);if(typeof u!="function"||!c)return;const d=h=>{Qj(h)&&(u(h),c.removeEventListener("pointerleave",d))};c.addEventListener("pointerleave",d,i)};return n.forEach(l=>{l.addEventListener("pointerenter",o,i)}),a}const h3=(t,e)=>e?t===e?!0:h3(t,e.parentElement):!1,s0=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,iG=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function aG(t){return iG.has(t.tagName)||t.tabIndex!==-1}const xu=new WeakSet;function Yj(t){return e=>{e.key==="Enter"&&t(e)}}function cm(t,e){t.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const oG=(t,e)=>{const s=t.currentTarget;if(!s)return;const n=Yj(()=>{if(xu.has(s))return;cm(s,"down");const i=Yj(()=>{cm(s,"up")}),a=()=>cm(s,"cancel");s.addEventListener("keyup",i,e),s.addEventListener("blur",a,e)});s.addEventListener("keydown",n,e),s.addEventListener("blur",()=>s.removeEventListener("keydown",n),e)};function Xj(t){return s0(t)&&!u3()}function lG(t,e,s={}){const[n,i,a]=d3(t,s),o=l=>{const c=l.currentTarget;if(!Xj(l))return;xu.add(c);const u=e(c,l),d=(m,p)=>{window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",f),xu.has(c)&&xu.delete(c),Xj(m)&&typeof u=="function"&&u(m,{success:p})},h=m=>{d(m,c===window||c===document||s.useGlobalTarget||h3(c,m.target))},f=m=>{d(m,!1)};window.addEventListener("pointerup",h,i),window.addEventListener("pointercancel",f,i)};return n.forEach(l=>{(s.useGlobalTarget?window:l).addEventListener("pointerdown",o,i),c3(l)&&(l.addEventListener("focus",u=>oG(u,i)),!aG(l)&&!l.hasAttribute("tabindex")&&(l.tabIndex=0))}),a}function f3(t){return Sz(t)&&"ownerSVGElement"in t}function cG(t){return f3(t)&&t.tagName==="svg"}const Ht=t=>!!(t&&t.getVelocity),uG=[...i3,xt,si],dG=t=>uG.find(r3(t)),n0=j.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});class hG extends j.Component{getSnapshotBeforeUpdate(e){const s=this.props.childRef.current;if(s&&e.isPresent&&!this.props.isPresent){const n=s.offsetParent,i=c3(n)&&n.offsetWidth||0,a=this.props.sizeRef.current;a.height=s.offsetHeight||0,a.width=s.offsetWidth||0,a.top=s.offsetTop,a.left=s.offsetLeft,a.right=i-a.width-a.left}return null}componentDidUpdate(){}render(){return this.props.children}}function fG({children:t,isPresent:e,anchorX:s,root:n}){const i=j.useId(),a=j.useRef(null),o=j.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:l}=j.useContext(n0);return j.useInsertionEffect(()=>{const{width:c,height:u,top:d,left:h,right:f}=o.current;if(e||!a.current||!c||!u)return;const m=s==="left"?`left: ${h}`:`right: ${f}`;a.current.dataset.motionPopId=i;const p=document.createElement("style");l&&(p.nonce=l);const x=n??document.head;return x.appendChild(p),p.sheet&&p.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${c}px !important;
            height: ${u}px !important;
            ${m}px !important;
            top: ${d}px !important;
          }
        `),()=>{x.contains(p)&&x.removeChild(p)}},[e]),r.jsx(hG,{isPresent:e,childRef:a,sizeRef:o,children:j.cloneElement(t,{ref:a})})}const mG=({children:t,initial:e,isPresent:s,onExitComplete:n,custom:i,presenceAffectsLayout:a,mode:o,anchorX:l,root:c})=>{const u=Pg(pG),d=j.useId();let h=!0,f=j.useMemo(()=>(h=!1,{id:d,initial:e,isPresent:s,custom:i,onExitComplete:m=>{u.set(m,!0);for(const p of u.values())if(!p)return;n&&n()},register:m=>(u.set(m,!1),()=>u.delete(m))}),[s,u,n]);return a&&h&&(f={...f}),j.useMemo(()=>{u.forEach((m,p)=>u.set(p,!1))},[s]),j.useEffect(()=>{!s&&!u.size&&n&&n()},[s]),o==="popLayout"&&(t=r.jsx(fG,{isPresent:s,anchorX:l,root:c,children:t})),r.jsx(qh.Provider,{value:f,children:t})};function pG(){return new Map}function m3(t=!0){const e=j.useContext(qh);if(e===null)return[!0,null];const{isPresent:s,onExitComplete:n,register:i}=e,a=j.useId();j.useEffect(()=>{if(t)return i(a)},[t]);const o=j.useCallback(()=>t&&n&&n(a),[a,n,t]);return!s&&n?[!1,o]:[!0]}const eu=t=>t.key||"";function ew(t){const e=[];return j.Children.forEach(t,s=>{j.isValidElement(s)&&e.push(s)}),e}const xG=({children:t,custom:e,initial:s=!0,onExitComplete:n,presenceAffectsLayout:i=!0,mode:a="sync",propagate:o=!1,anchorX:l="left",root:c})=>{const[u,d]=m3(o),h=j.useMemo(()=>ew(t),[t]),f=o&&!u?[]:h.map(eu),m=j.useRef(!0),p=j.useRef(h),x=Pg(()=>new Map),[g,y]=j.useState(h),[b,w]=j.useState(h);kz(()=>{m.current=!1,p.current=h;for(let N=0;N<b.length;N++){const k=eu(b[N]);f.includes(k)?x.delete(k):x.get(k)!==!0&&x.set(k,!1)}},[b,f.length,f.join("-")]);const S=[];if(h!==g){let N=[...h];for(let k=0;k<b.length;k++){const C=b[k],T=eu(C);f.includes(T)||(N.splice(k,0,C),S.push(C))}return a==="wait"&&S.length&&(N=S),w(ew(N)),y(h),null}const{forceRender:z}=j.useContext(Mg);return r.jsx(r.Fragment,{children:b.map(N=>{const k=eu(N),C=o&&!u?!1:h===b||f.includes(k),T=()=>{if(x.has(k))x.set(k,!0);else return;let v=!0;x.forEach(_=>{_||(v=!1)}),v&&(z?.(),w(p.current),o&&d?.(),n&&n())};return r.jsx(mG,{isPresent:C,initial:!m.current||s?void 0:!1,custom:e,presenceAffectsLayout:i,mode:a,root:c,onExitComplete:C?void 0:T,anchorX:l,children:N},k)})})},p3=j.createContext({strict:!1}),tw={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},lo={};for(const t in tw)lo[t]={isEnabled:e=>tw[t].some(s=>!!e[s])};function gG(t){for(const e in t)lo[e]={...lo[e],...t[e]}}const yG=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Pd(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||yG.has(t)}let x3=t=>!Pd(t);function bG(t){typeof t=="function"&&(x3=e=>e.startsWith("on")?!Pd(e):t(e))}try{bG(require("@emotion/is-prop-valid").default)}catch{}function jG(t,e,s){const n={};for(const i in t)i==="values"&&typeof t.values=="object"||(x3(i)||s===!0&&Pd(i)||!e&&!Pd(i)||t.draggable&&i.startsWith("onDrag"))&&(n[i]=t[i]);return n}const Vh=j.createContext({});function Uh(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}function Zl(t){return typeof t=="string"||Array.isArray(t)}const r0=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],i0=["initial",...r0];function Wh(t){return Uh(t.animate)||i0.some(e=>Zl(t[e]))}function g3(t){return!!(Wh(t)||t.variants)}function wG(t,e){if(Wh(t)){const{initial:s,animate:n}=t;return{initial:s===!1||Zl(s)?s:void 0,animate:Zl(n)?n:void 0}}return t.inherit!==!1?e:{}}function vG(t){const{initial:e,animate:s}=wG(t,j.useContext(Vh));return j.useMemo(()=>({initial:e,animate:s}),[sw(e),sw(s)])}function sw(t){return Array.isArray(t)?t.join(" "):t}const Ql={};function kG(t){for(const e in t)Ql[e]=t[e],Vg(e)&&(Ql[e].isCSSVariable=!0)}function y3(t,{layout:e,layoutId:s}){return Co.has(t)||t.startsWith("origin")||(e||s!==void 0)&&(!!Ql[t]||t==="opacity")}const NG={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},SG=So.length;function CG(t,e,s){let n="",i=!0;for(let a=0;a<SG;a++){const o=So[a],l=t[o];if(l===void 0)continue;let c=!0;if(typeof l=="number"?c=l===(o.startsWith("scale")?1:0):c=parseFloat(l)===0,!c||s){const u=l3(l,e0[o]);if(!c){i=!1;const d=NG[o]||o;n+=`${d}(${u}) `}s&&(e[o]=u)}}return n=n.trim(),s?n=s(e,i?"":n):i&&(n="none"),n}function a0(t,e,s){const{style:n,vars:i,transformOrigin:a}=t;let o=!1,l=!1;for(const c in e){const u=e[c];if(Co.has(c)){o=!0;continue}else if(Vg(c)){i[c]=u;continue}else{const d=l3(u,e0[c]);c.startsWith("origin")?(l=!0,a[c]=d):n[c]=d}}if(e.transform||(o||s?n.transform=CG(e,t.transform,s):n.transform&&(n.transform="none")),l){const{originX:c="50%",originY:u="50%",originZ:d=0}=a;n.transformOrigin=`${c} ${u} ${d}`}}const o0=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function b3(t,e,s){for(const n in e)!Ht(e[n])&&!y3(n,s)&&(t[n]=e[n])}function zG({transformTemplate:t},e){return j.useMemo(()=>{const s=o0();return a0(s,e,t),Object.assign({},s.vars,s.style)},[e])}function _G(t,e){const s=t.style||{},n={};return b3(n,s,t),Object.assign(n,zG(t,e)),n}function AG(t,e){const s={},n=_G(t,e);return t.drag&&t.dragListener!==!1&&(s.draggable=!1,n.userSelect=n.WebkitUserSelect=n.WebkitTouchCallout="none",n.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(s.tabIndex=0),s.style=n,s}const TG={offset:"stroke-dashoffset",array:"stroke-dasharray"},EG={offset:"strokeDashoffset",array:"strokeDasharray"};function DG(t,e,s=1,n=0,i=!0){t.pathLength=1;const a=i?TG:EG;t[a.offset]=ce.transform(-n);const o=ce.transform(e),l=ce.transform(s);t[a.array]=`${o} ${l}`}function j3(t,{attrX:e,attrY:s,attrScale:n,pathLength:i,pathSpacing:a=1,pathOffset:o=0,...l},c,u,d){if(a0(t,l,u),c){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:h,style:f}=t;h.transform&&(f.transform=h.transform,delete h.transform),(f.transform||h.transformOrigin)&&(f.transformOrigin=h.transformOrigin??"50% 50%",delete h.transformOrigin),f.transform&&(f.transformBox=d?.transformBox??"fill-box",delete h.transformBox),e!==void 0&&(h.x=e),s!==void 0&&(h.y=s),n!==void 0&&(h.scale=n),i!==void 0&&DG(h,i,a,o,!1)}const w3=()=>({...o0(),attrs:{}}),v3=t=>typeof t=="string"&&t.toLowerCase()==="svg";function MG(t,e,s,n){const i=j.useMemo(()=>{const a=w3();return j3(a,e,v3(n),t.transformTemplate,t.style),{...a.attrs,style:{...a.style}}},[e]);if(t.style){const a={};b3(a,t.style,t),i.style={...a,...i.style}}return i}const PG=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function l0(t){return typeof t!="string"||t.includes("-")?!1:!!(PG.indexOf(t)>-1||/[A-Z]/u.test(t))}function IG(t,e,s,{latestValues:n},i,a=!1){const l=(l0(t)?MG:AG)(e,n,i,t),c=jG(e,typeof t=="string",a),u=t!==j.Fragment?{...c,...l,ref:s}:{},{children:d}=e,h=j.useMemo(()=>Ht(d)?d.get():d,[d]);return j.createElement(t,{...u,children:h})}function nw(t){const e=[{},{}];return t?.values.forEach((s,n)=>{e[0][n]=s.get(),e[1][n]=s.getVelocity()}),e}function c0(t,e,s,n){if(typeof e=="function"){const[i,a]=nw(n);e=e(s!==void 0?s:t.custom,i,a)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[i,a]=nw(n);e=e(s!==void 0?s:t.custom,i,a)}return e}function gu(t){return Ht(t)?t.get():t}function OG({scrapeMotionValuesFromProps:t,createRenderState:e},s,n,i){return{latestValues:RG(s,n,i,t),renderState:e()}}function RG(t,e,s,n){const i={},a=n(t,{});for(const f in a)i[f]=gu(a[f]);let{initial:o,animate:l}=t;const c=Wh(t),u=g3(t);e&&u&&!c&&t.inherit!==!1&&(o===void 0&&(o=e.initial),l===void 0&&(l=e.animate));let d=s?s.initial===!1:!1;d=d||o===!1;const h=d?l:o;if(h&&typeof h!="boolean"&&!Uh(h)){const f=Array.isArray(h)?h:[h];for(let m=0;m<f.length;m++){const p=c0(t,f[m]);if(p){const{transitionEnd:x,transition:g,...y}=p;for(const b in y){let w=y[b];if(Array.isArray(w)){const S=d?w.length-1:0;w=w[S]}w!==null&&(i[b]=w)}for(const b in x)i[b]=x[b]}}}return i}const k3=t=>(e,s)=>{const n=j.useContext(Vh),i=j.useContext(qh),a=()=>OG(t,e,n,i);return s?a():Pg(a)};function u0(t,e,s){const{style:n}=t,i={};for(const a in n)(Ht(n[a])||e.style&&Ht(e.style[a])||y3(a,t)||s?.getValue(a)?.liveStyle!==void 0)&&(i[a]=n[a]);return i}const LG=k3({scrapeMotionValuesFromProps:u0,createRenderState:o0});function N3(t,e,s){const n=u0(t,e,s);for(const i in t)if(Ht(t[i])||Ht(e[i])){const a=So.indexOf(i)!==-1?"attr"+i.charAt(0).toUpperCase()+i.substring(1):i;n[a]=t[i]}return n}const FG=k3({scrapeMotionValuesFromProps:N3,createRenderState:w3}),$G=Symbol.for("motionComponentSymbol");function _a(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function BG(t,e,s){return j.useCallback(n=>{n&&t.onMount&&t.onMount(n),e&&(n?e.mount(n):e.unmount()),s&&(typeof s=="function"?s(n):_a(s)&&(s.current=n))},[e])}const d0=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),qG="framerAppearId",S3="data-"+d0(qG),C3=j.createContext({});function VG(t,e,s,n,i){const{visualElement:a}=j.useContext(Vh),o=j.useContext(p3),l=j.useContext(qh),c=j.useContext(n0).reducedMotion,u=j.useRef(null);n=n||o.renderer,!u.current&&n&&(u.current=n(t,{visualState:e,parent:a,props:s,presenceContext:l,blockInitialAnimation:l?l.initial===!1:!1,reducedMotionConfig:c}));const d=u.current,h=j.useContext(C3);d&&!d.projection&&i&&(d.type==="html"||d.type==="svg")&&UG(u.current,s,i,h);const f=j.useRef(!1);j.useInsertionEffect(()=>{d&&f.current&&d.update(s,l)});const m=s[S3],p=j.useRef(!!m&&!window.MotionHandoffIsComplete?.(m)&&window.MotionHasOptimisedAnimation?.(m));return kz(()=>{d&&(f.current=!0,window.MotionIsMounted=!0,d.updateFeatures(),d.scheduleRenderMicrotask(),p.current&&d.animationState&&d.animationState.animateChanges())}),j.useEffect(()=>{d&&(!p.current&&d.animationState&&d.animationState.animateChanges(),p.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(m)}),p.current=!1),d.enteringChildren=void 0)}),d}function UG(t,e,s,n){const{layoutId:i,layout:a,drag:o,dragConstraints:l,layoutScroll:c,layoutRoot:u,layoutCrossfade:d}=e;t.projection=new s(t.latestValues,e["data-framer-portal-id"]?void 0:z3(t.parent)),t.projection.setOptions({layoutId:i,layout:a,alwaysMeasureLayout:!!o||l&&_a(l),visualElement:t,animationType:typeof a=="string"?a:"both",initialPromotionConfig:n,crossfade:d,layoutScroll:c,layoutRoot:u})}function z3(t){if(t)return t.options.allowProjection!==!1?t.projection:z3(t.parent)}function um(t,{forwardMotionProps:e=!1}={},s,n){s&&gG(s);const i=l0(t)?FG:LG;function a(l,c){let u;const d={...j.useContext(n0),...l,layoutId:WG(l)},{isStatic:h}=d,f=vG(l),m=i(l,h);if(!h&&Ig){KG();const p=HG(d);u=p.MeasureLayout,f.visualElement=VG(t,m,d,n,p.ProjectionNode)}return r.jsxs(Vh.Provider,{value:f,children:[u&&f.visualElement?r.jsx(u,{visualElement:f.visualElement,...d}):null,IG(t,l,BG(m,f.visualElement,c),m,h,e)]})}a.displayName=`motion.${typeof t=="string"?t:`create(${t.displayName??t.name??""})`}`;const o=j.forwardRef(a);return o[$G]=t,o}function WG({layoutId:t}){const e=j.useContext(Mg).id;return e&&t!==void 0?e+"-"+t:t}function KG(t,e){j.useContext(p3).strict}function HG(t){const{drag:e,layout:s}=lo;if(!e&&!s)return{};const n={...e,...s};return{MeasureLayout:e?.isEnabled(t)||s?.isEnabled(t)?n.MeasureLayout:void 0,ProjectionNode:n.ProjectionNode}}function GG(t,e){if(typeof Proxy>"u")return um;const s=new Map,n=(a,o)=>um(a,o,t,e),i=(a,o)=>n(a,o);return new Proxy(i,{get:(a,o)=>o==="create"?n:(s.has(o)||s.set(o,um(o,void 0,t,e)),s.get(o))})}function _3({top:t,left:e,right:s,bottom:n}){return{x:{min:e,max:s},y:{min:t,max:n}}}function JG({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function ZG(t,e){if(!e)return t;const s=e({x:t.left,y:t.top}),n=e({x:t.right,y:t.bottom});return{top:s.y,left:s.x,bottom:n.y,right:n.x}}function dm(t){return t===void 0||t===1}function Op({scale:t,scaleX:e,scaleY:s}){return!dm(t)||!dm(e)||!dm(s)}function pi(t){return Op(t)||A3(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function A3(t){return rw(t.x)||rw(t.y)}function rw(t){return t&&t!=="0%"}function Id(t,e,s){const n=t-s,i=e*n;return s+i}function iw(t,e,s,n,i){return i!==void 0&&(t=Id(t,i,n)),Id(t,s,n)+e}function Rp(t,e=0,s=1,n,i){t.min=iw(t.min,e,s,n,i),t.max=iw(t.max,e,s,n,i)}function T3(t,{x:e,y:s}){Rp(t.x,e.translate,e.scale,e.originPoint),Rp(t.y,s.translate,s.scale,s.originPoint)}const aw=.999999999999,ow=1.0000000000001;function QG(t,e,s,n=!1){const i=s.length;if(!i)return;e.x=e.y=1;let a,o;for(let l=0;l<i;l++){a=s[l],o=a.projectionDelta;const{visualElement:c}=a.options;c&&c.props.style&&c.props.style.display==="contents"||(n&&a.options.layoutScroll&&a.scroll&&a!==a.root&&Ta(t,{x:-a.scroll.offset.x,y:-a.scroll.offset.y}),o&&(e.x*=o.x.scale,e.y*=o.y.scale,T3(t,o)),n&&pi(a.latestValues)&&Ta(t,a.latestValues))}e.x<ow&&e.x>aw&&(e.x=1),e.y<ow&&e.y>aw&&(e.y=1)}function Aa(t,e){t.min=t.min+e,t.max=t.max+e}function lw(t,e,s,n,i=.5){const a=et(t.min,t.max,i);Rp(t,e,s,a,n)}function Ta(t,e){lw(t.x,e.x,e.scaleX,e.scale,e.originX),lw(t.y,e.y,e.scaleY,e.scale,e.originY)}function E3(t,e){return _3(ZG(t.getBoundingClientRect(),e))}function YG(t,e,s){const n=E3(t,s),{scroll:i}=e;return i&&(Aa(n.x,i.offset.x),Aa(n.y,i.offset.y)),n}const cw=()=>({translate:0,scale:1,origin:0,originPoint:0}),Ea=()=>({x:cw(),y:cw()}),uw=()=>({min:0,max:0}),ut=()=>({x:uw(),y:uw()}),Lp={current:null},D3={current:!1};function XG(){if(D3.current=!0,!!Ig)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>Lp.current=t.matches;t.addEventListener("change",e),e()}else Lp.current=!1}const eJ=new WeakMap;function tJ(t,e,s){for(const n in e){const i=e[n],a=s[n];if(Ht(i))t.addValue(n,i);else if(Ht(a))t.addValue(n,oo(i,{owner:t}));else if(a!==i)if(t.hasValue(n)){const o=t.getValue(n);o.liveStyle===!0?o.jump(i):o.hasAnimated||o.set(i)}else{const o=t.getStaticValue(n);t.addValue(n,oo(o!==void 0?o:i,{owner:t}))}}for(const n in s)e[n]===void 0&&t.removeValue(n);return e}const dw=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class sJ{scrapeMotionValuesFromProps(e,s,n){return{}}constructor({parent:e,props:s,presenceContext:n,reducedMotionConfig:i,blockInitialAnimation:a,visualState:o},l={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Yg,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const f=gs.now();this.renderScheduledAt<f&&(this.renderScheduledAt=f,Ge.render(this.render,!1,!0))};const{latestValues:c,renderState:u}=o;this.latestValues=c,this.baseTarget={...c},this.initialValues=s.initial?{...c}:{},this.renderState=u,this.parent=e,this.props=s,this.presenceContext=n,this.depth=e?e.depth+1:0,this.reducedMotionConfig=i,this.options=l,this.blockInitialAnimation=!!a,this.isControllingVariants=Wh(s),this.isVariantNode=g3(s),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:d,...h}=this.scrapeMotionValuesFromProps(s,{},this);for(const f in h){const m=h[f];c[f]!==void 0&&Ht(m)&&m.set(c[f])}}mount(e){this.current=e,eJ.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((s,n)=>this.bindToMotionValue(n,s)),D3.current||XG(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Lp.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),ti(this.notifyUpdate),ti(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const s=this.features[e];s&&(s.unmount(),s.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,s){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const n=Co.has(e);n&&this.onBindTransform&&this.onBindTransform();const i=s.on("change",o=>{this.latestValues[e]=o,this.props.onUpdate&&Ge.preRender(this.notifyUpdate),n&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let a;window.MotionCheckAppearSync&&(a=window.MotionCheckAppearSync(this,e,s)),this.valueSubscriptions.set(e,()=>{i(),a&&a(),s.owner&&s.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in lo){const s=lo[e];if(!s)continue;const{isEnabled:n,Feature:i}=s;if(!this.features[e]&&i&&n(this.props)&&(this.features[e]=new i(this)),this.features[e]){const a=this.features[e];a.isMounted?a.update():(a.mount(),a.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):ut()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,s){this.latestValues[e]=s}update(e,s){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=s;for(let n=0;n<dw.length;n++){const i=dw[n];this.propEventSubscriptions[i]&&(this.propEventSubscriptions[i](),delete this.propEventSubscriptions[i]);const a="on"+i,o=e[a];o&&(this.propEventSubscriptions[i]=this.on(i,o))}this.prevMotionValues=tJ(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const s=this.getClosestVariantNode();if(s)return s.variantChildren&&s.variantChildren.add(e),()=>s.variantChildren.delete(e)}addValue(e,s){const n=this.values.get(e);s!==n&&(n&&this.removeValue(e),this.bindToMotionValue(e,s),this.values.set(e,s),this.latestValues[e]=s.get())}removeValue(e){this.values.delete(e);const s=this.valueSubscriptions.get(e);s&&(s(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,s){if(this.props.values&&this.props.values[e])return this.props.values[e];let n=this.values.get(e);return n===void 0&&s!==void 0&&(n=oo(s===null?void 0:s,{owner:this}),this.addValue(e,n)),n}readValue(e,s){let n=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return n!=null&&(typeof n=="string"&&(Nz(n)||Cz(n))?n=parseFloat(n):!dG(n)&&si.test(s)&&(n=o3(e,s)),this.setBaseTarget(e,Ht(n)?n.get():n)),Ht(n)?n.get():n}setBaseTarget(e,s){this.baseTarget[e]=s}getBaseTarget(e){const{initial:s}=this.props;let n;if(typeof s=="string"||typeof s=="object"){const a=c0(this.props,s,this.presenceContext?.custom);a&&(n=a[e])}if(s&&n!==void 0)return n;const i=this.getBaseTargetFromProps(this.props,e);return i!==void 0&&!Ht(i)?i:this.initialValues[e]!==void 0&&n===void 0?void 0:this.baseTarget[e]}on(e,s){return this.events[e]||(this.events[e]=new $g),this.events[e].add(s)}notify(e,...s){this.events[e]&&this.events[e].notify(...s)}scheduleRenderMicrotask(){t0.render(this.render)}}class M3 extends sJ{constructor(){super(...arguments),this.KeyframeResolver=XH}sortInstanceNodePosition(e,s){return e.compareDocumentPosition(s)&2?1:-1}getBaseTargetFromProps(e,s){return e.style?e.style[s]:void 0}removeValueFromRenderState(e,{vars:s,style:n}){delete s[e],delete n[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Ht(e)&&(this.childSubscription=e.on("change",s=>{this.current&&(this.current.textContent=`${s}`)}))}}function P3(t,{style:e,vars:s},n,i){const a=t.style;let o;for(o in e)a[o]=e[o];i?.applyProjectionStyles(a,n);for(o in s)a.setProperty(o,s[o])}function nJ(t){return window.getComputedStyle(t)}class rJ extends M3{constructor(){super(...arguments),this.type="html",this.renderInstance=P3}readValueFromInstance(e,s){if(Co.has(s))return this.projection?.isProjecting?Ap(s):yH(e,s);{const n=nJ(e),i=(Vg(s)?n.getPropertyValue(s):n[s])||0;return typeof i=="string"?i.trim():i}}measureInstanceViewportBox(e,{transformPagePoint:s}){return E3(e,s)}build(e,s,n){a0(e,s,n.transformTemplate)}scrapeMotionValuesFromProps(e,s,n){return u0(e,s,n)}}const I3=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function iJ(t,e,s,n){P3(t,e,void 0,n);for(const i in e.attrs)t.setAttribute(I3.has(i)?i:d0(i),e.attrs[i])}class aJ extends M3{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=ut}getBaseTargetFromProps(e,s){return e[s]}readValueFromInstance(e,s){if(Co.has(s)){const n=a3(s);return n&&n.default||0}return s=I3.has(s)?s:d0(s),e.getAttribute(s)}scrapeMotionValuesFromProps(e,s,n){return N3(e,s,n)}build(e,s,n){j3(e,s,this.isSVGTag,n.transformTemplate,n.style)}renderInstance(e,s,n,i){iJ(e,s,n,i)}mount(e){this.isSVGTag=v3(e.tagName),super.mount(e)}}const oJ=(t,e)=>l0(t)?new aJ(e):new rJ(e,{allowProjection:t!==j.Fragment});function $a(t,e,s){const n=t.getProps();return c0(n,e,s!==void 0?s:n.custom,t)}const Fp=t=>Array.isArray(t);function lJ(t,e,s){t.hasValue(e)?t.getValue(e).set(s):t.addValue(e,oo(s))}function cJ(t){return Fp(t)?t[t.length-1]||0:t}function uJ(t,e){const s=$a(t,e);let{transitionEnd:n={},transition:i={},...a}=s||{};a={...a,...n};for(const o in a){const l=cJ(a[o]);lJ(t,o,l)}}function dJ(t){return!!(Ht(t)&&t.add)}function $p(t,e){const s=t.getValue("willChange");if(dJ(s))return s.add(e);if(!s&&dr.WillChange){const n=new dr.WillChange("auto");t.addValue("willChange",n),n.add(e)}}function O3(t){return t.props[S3]}const hJ=t=>t!==null;function fJ(t,{repeat:e,repeatType:s="loop"},n){const i=t.filter(hJ),a=e&&s!=="loop"&&e%2===1?0:i.length-1;return i[a]}const mJ={type:"spring",stiffness:500,damping:25,restSpeed:10},pJ=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),xJ={type:"keyframes",duration:.8},gJ={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},yJ=(t,{keyframes:e})=>e.length>2?xJ:Co.has(t)?t.startsWith("scale")?pJ(e[1]):mJ:gJ;function bJ({when:t,delay:e,delayChildren:s,staggerChildren:n,staggerDirection:i,repeat:a,repeatType:o,repeatDelay:l,from:c,elapsed:u,...d}){return!!Object.keys(d).length}const h0=(t,e,s,n={},i,a)=>o=>{const l=Xg(n,t)||{},c=l.delay||n.delay||0;let{elapsed:u=0}=n;u=u-Dn(c);const d={keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:e.getVelocity(),...l,delay:-u,onUpdate:f=>{e.set(f),l.onUpdate&&l.onUpdate(f)},onComplete:()=>{o(),l.onComplete&&l.onComplete()},name:t,motionValue:e,element:a?void 0:i};bJ(l)||Object.assign(d,yJ(t,d)),d.duration&&(d.duration=Dn(d.duration)),d.repeatDelay&&(d.repeatDelay=Dn(d.repeatDelay)),d.from!==void 0&&(d.keyframes[0]=d.from);let h=!1;if((d.type===!1||d.duration===0&&!d.repeatDelay)&&(Pp(d),d.delay===0&&(h=!0)),(dr.instantAnimations||dr.skipAnimations)&&(h=!0,Pp(d),d.delay=0),d.allowFlatten=!l.type&&!l.ease,h&&!a&&e.get()!==void 0){const f=fJ(d.keyframes,l);if(f!==void 0){Ge.update(()=>{d.onUpdate(f),d.onComplete()});return}}return l.isSync?new Qg(d):new BH(d)};function jJ({protectedKeys:t,needsAnimating:e},s){const n=t.hasOwnProperty(s)&&e[s]!==!0;return e[s]=!1,n}function R3(t,e,{delay:s=0,transitionOverride:n,type:i}={}){let{transition:a=t.getDefaultTransition(),transitionEnd:o,...l}=e;n&&(a=n);const c=[],u=i&&t.animationState&&t.animationState.getState()[i];for(const d in l){const h=t.getValue(d,t.latestValues[d]??null),f=l[d];if(f===void 0||u&&jJ(u,d))continue;const m={delay:s,...Xg(a||{},d)},p=h.get();if(p!==void 0&&!h.isAnimating&&!Array.isArray(f)&&f===p&&!m.velocity)continue;let x=!1;if(window.MotionHandoffAnimation){const y=O3(t);if(y){const b=window.MotionHandoffAnimation(y,d,Ge);b!==null&&(m.startTime=b,x=!0)}}$p(t,d),h.start(h0(d,h,f,t.shouldReduceMotion&&n3.has(d)?{type:!1}:m,t,x));const g=h.animation;g&&c.push(g)}return o&&Promise.all(c).then(()=>{Ge.update(()=>{o&&uJ(t,o)})}),c}function L3(t,e,s,n=0,i=1){const a=Array.from(t).sort((u,d)=>u.sortNodePosition(d)).indexOf(e),o=t.size,l=(o-1)*n;return typeof s=="function"?s(a,o):i===1?a*n:l-a*n}function Bp(t,e,s={}){const n=$a(t,e,s.type==="exit"?t.presenceContext?.custom:void 0);let{transition:i=t.getDefaultTransition()||{}}=n||{};s.transitionOverride&&(i=s.transitionOverride);const a=n?()=>Promise.all(R3(t,n,s)):()=>Promise.resolve(),o=t.variantChildren&&t.variantChildren.size?(c=0)=>{const{delayChildren:u=0,staggerChildren:d,staggerDirection:h}=i;return wJ(t,e,c,u,d,h,s)}:()=>Promise.resolve(),{when:l}=i;if(l){const[c,u]=l==="beforeChildren"?[a,o]:[o,a];return c().then(()=>u())}else return Promise.all([a(),o(s.delay)])}function wJ(t,e,s=0,n=0,i=0,a=1,o){const l=[];for(const c of t.variantChildren)c.notify("AnimationStart",e),l.push(Bp(c,e,{...o,delay:s+(typeof n=="function"?0:n)+L3(t.variantChildren,c,n,i,a)}).then(()=>c.notify("AnimationComplete",e)));return Promise.all(l)}function vJ(t,e,s={}){t.notify("AnimationStart",e);let n;if(Array.isArray(e)){const i=e.map(a=>Bp(t,a,s));n=Promise.all(i)}else if(typeof e=="string")n=Bp(t,e,s);else{const i=typeof e=="function"?$a(t,e,s.custom):e;n=Promise.all(R3(t,i,s))}return n.then(()=>{t.notify("AnimationComplete",e)})}function F3(t,e){if(!Array.isArray(e))return!1;const s=e.length;if(s!==t.length)return!1;for(let n=0;n<s;n++)if(e[n]!==t[n])return!1;return!0}const kJ=i0.length;function $3(t){if(!t)return;if(!t.isControllingVariants){const s=t.parent?$3(t.parent)||{}:{};return t.props.initial!==void 0&&(s.initial=t.props.initial),s}const e={};for(let s=0;s<kJ;s++){const n=i0[s],i=t.props[n];(Zl(i)||i===!1)&&(e[n]=i)}return e}const NJ=[...r0].reverse(),SJ=r0.length;function CJ(t){return e=>Promise.all(e.map(({animation:s,options:n})=>vJ(t,s,n)))}function zJ(t){let e=CJ(t),s=hw(),n=!0;const i=c=>(u,d)=>{const h=$a(t,d,c==="exit"?t.presenceContext?.custom:void 0);if(h){const{transition:f,transitionEnd:m,...p}=h;u={...u,...p,...m}}return u};function a(c){e=c(t)}function o(c){const{props:u}=t,d=$3(t.parent)||{},h=[],f=new Set;let m={},p=1/0;for(let g=0;g<SJ;g++){const y=NJ[g],b=s[y],w=u[y]!==void 0?u[y]:d[y],S=Zl(w),z=y===c?b.isActive:null;z===!1&&(p=g);let N=w===d[y]&&w!==u[y]&&S;if(N&&n&&t.manuallyAnimateOnMount&&(N=!1),b.protectedKeys={...m},!b.isActive&&z===null||!w&&!b.prevProp||Uh(w)||typeof w=="boolean")continue;const k=_J(b.prevProp,w);let C=k||y===c&&b.isActive&&!N&&S||g>p&&S,T=!1;const v=Array.isArray(w)?w:[w];let _=v.reduce(i(y),{});z===!1&&(_={});const{prevResolvedValues:A={}}=b,E={...A,..._},M=B=>{C=!0,f.has(B)&&(T=!0,f.delete(B)),b.needsAnimating[B]=!0;const K=t.getValue(B);K&&(K.liveStyle=!1)};for(const B in E){const K=_[B],$=A[B];if(m.hasOwnProperty(B))continue;let J=!1;Fp(K)&&Fp($)?J=!F3(K,$):J=K!==$,J?K!=null?M(B):f.add(B):K!==void 0&&f.has(B)?M(B):b.protectedKeys[B]=!0}b.prevProp=w,b.prevResolvedValues=_,b.isActive&&(m={...m,..._}),n&&t.blockInitialAnimation&&(C=!1);const O=N&&k;C&&(!O||T)&&h.push(...v.map(B=>{const K={type:y};if(typeof B=="string"&&n&&!O&&t.manuallyAnimateOnMount&&t.parent){const{parent:$}=t,J=$a($,B);if($.enteringChildren&&J){const{delayChildren:ie}=J.transition||{};K.delay=L3($.enteringChildren,t,ie)}}return{animation:B,options:K}}))}if(f.size){const g={};if(typeof u.initial!="boolean"){const y=$a(t,Array.isArray(u.initial)?u.initial[0]:u.initial);y&&y.transition&&(g.transition=y.transition)}f.forEach(y=>{const b=t.getBaseTarget(y),w=t.getValue(y);w&&(w.liveStyle=!0),g[y]=b??null}),h.push({animation:g})}let x=!!h.length;return n&&(u.initial===!1||u.initial===u.animate)&&!t.manuallyAnimateOnMount&&(x=!1),n=!1,x?e(h):Promise.resolve()}function l(c,u){if(s[c].isActive===u)return Promise.resolve();t.variantChildren?.forEach(h=>h.animationState?.setActive(c,u)),s[c].isActive=u;const d=o(c);for(const h in s)s[h].protectedKeys={};return d}return{animateChanges:o,setActive:l,setAnimateFunction:a,getState:()=>s,reset:()=>{s=hw(),n=!0}}}function _J(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!F3(e,t):!1}function mi(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function hw(){return{animate:mi(!0),whileInView:mi(),whileHover:mi(),whileTap:mi(),whileDrag:mi(),whileFocus:mi(),exit:mi()}}class di{constructor(e){this.isMounted=!1,this.node=e}update(){}}class AJ extends di{constructor(e){super(e),e.animationState||(e.animationState=zJ(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Uh(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:s}=this.node.prevProps||{};e!==s&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let TJ=0;class EJ extends di{constructor(){super(...arguments),this.id=TJ++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:s}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===n)return;const i=this.node.animationState.setActive("exit",!e);s&&!e&&i.then(()=>{s(this.id)})}mount(){const{register:e,onExitComplete:s}=this.node.presenceContext||{};s&&s(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const DJ={animation:{Feature:AJ},exit:{Feature:EJ}};function Yl(t,e,s,n={passive:!0}){return t.addEventListener(e,s,n),()=>t.removeEventListener(e,s)}function kc(t){return{point:{x:t.pageX,y:t.pageY}}}const MJ=t=>e=>s0(e)&&t(e,kc(e));function fl(t,e,s,n){return Yl(t,e,MJ(s),n)}const B3=1e-4,PJ=1-B3,IJ=1+B3,q3=.01,OJ=0-q3,RJ=0+q3;function rs(t){return t.max-t.min}function LJ(t,e,s){return Math.abs(t-e)<=s}function fw(t,e,s,n=.5){t.origin=n,t.originPoint=et(e.min,e.max,t.origin),t.scale=rs(s)/rs(e),t.translate=et(s.min,s.max,t.origin)-t.originPoint,(t.scale>=PJ&&t.scale<=IJ||isNaN(t.scale))&&(t.scale=1),(t.translate>=OJ&&t.translate<=RJ||isNaN(t.translate))&&(t.translate=0)}function ml(t,e,s,n){fw(t.x,e.x,s.x,n?n.originX:void 0),fw(t.y,e.y,s.y,n?n.originY:void 0)}function mw(t,e,s){t.min=s.min+e.min,t.max=t.min+rs(e)}function FJ(t,e,s){mw(t.x,e.x,s.x),mw(t.y,e.y,s.y)}function pw(t,e,s){t.min=e.min-s.min,t.max=t.min+rs(e)}function pl(t,e,s){pw(t.x,e.x,s.x),pw(t.y,e.y,s.y)}function Vs(t){return[t("x"),t("y")]}const V3=({current:t})=>t?t.ownerDocument.defaultView:null,xw=(t,e)=>Math.abs(t-e);function $J(t,e){const s=xw(t.x,e.x),n=xw(t.y,e.y);return Math.sqrt(s**2+n**2)}class U3{constructor(e,s,{transformPagePoint:n,contextWindow:i=window,dragSnapToOrigin:a=!1,distanceThreshold:o=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const f=fm(this.lastMoveEventInfo,this.history),m=this.startEvent!==null,p=$J(f.offset,{x:0,y:0})>=this.distanceThreshold;if(!m&&!p)return;const{point:x}=f,{timestamp:g}=Lt;this.history.push({...x,timestamp:g});const{onStart:y,onMove:b}=this.handlers;m||(y&&y(this.lastMoveEvent,f),this.startEvent=this.lastMoveEvent),b&&b(this.lastMoveEvent,f)},this.handlePointerMove=(f,m)=>{this.lastMoveEvent=f,this.lastMoveEventInfo=hm(m,this.transformPagePoint),Ge.update(this.updatePoint,!0)},this.handlePointerUp=(f,m)=>{this.end();const{onEnd:p,onSessionEnd:x,resumeAnimation:g}=this.handlers;if(this.dragSnapToOrigin&&g&&g(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const y=fm(f.type==="pointercancel"?this.lastMoveEventInfo:hm(m,this.transformPagePoint),this.history);this.startEvent&&p&&p(f,y),x&&x(f,y)},!s0(e))return;this.dragSnapToOrigin=a,this.handlers=s,this.transformPagePoint=n,this.distanceThreshold=o,this.contextWindow=i||window;const l=kc(e),c=hm(l,this.transformPagePoint),{point:u}=c,{timestamp:d}=Lt;this.history=[{...u,timestamp:d}];const{onSessionStart:h}=s;h&&h(e,fm(c,this.history)),this.removeListeners=jc(fl(this.contextWindow,"pointermove",this.handlePointerMove),fl(this.contextWindow,"pointerup",this.handlePointerUp),fl(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),ti(this.updatePoint)}}function hm(t,e){return e?{point:e(t.point)}:t}function gw(t,e){return{x:t.x-e.x,y:t.y-e.y}}function fm({point:t},e){return{point:t,delta:gw(t,W3(e)),offset:gw(t,BJ(e)),velocity:qJ(e,.1)}}function BJ(t){return t[0]}function W3(t){return t[t.length-1]}function qJ(t,e){if(t.length<2)return{x:0,y:0};let s=t.length-1,n=null;const i=W3(t);for(;s>=0&&(n=t[s],!(i.timestamp-n.timestamp>Dn(e)));)s--;if(!n)return{x:0,y:0};const a=Mn(i.timestamp-n.timestamp);if(a===0)return{x:0,y:0};const o={x:(i.x-n.x)/a,y:(i.y-n.y)/a};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function VJ(t,{min:e,max:s},n){return e!==void 0&&t<e?t=n?et(e,t,n.min):Math.max(t,e):s!==void 0&&t>s&&(t=n?et(s,t,n.max):Math.min(t,s)),t}function yw(t,e,s){return{min:e!==void 0?t.min+e:void 0,max:s!==void 0?t.max+s-(t.max-t.min):void 0}}function UJ(t,{top:e,left:s,bottom:n,right:i}){return{x:yw(t.x,s,i),y:yw(t.y,e,n)}}function bw(t,e){let s=e.min-t.min,n=e.max-t.max;return e.max-e.min<t.max-t.min&&([s,n]=[n,s]),{min:s,max:n}}function WJ(t,e){return{x:bw(t.x,e.x),y:bw(t.y,e.y)}}function KJ(t,e){let s=.5;const n=rs(t),i=rs(e);return i>n?s=Hl(e.min,e.max-n,t.min):n>i&&(s=Hl(t.min,t.max-i,e.min)),ur(0,1,s)}function HJ(t,e){const s={};return e.min!==void 0&&(s.min=e.min-t.min),e.max!==void 0&&(s.max=e.max-t.min),s}const qp=.35;function GJ(t=qp){return t===!1?t=0:t===!0&&(t=qp),{x:jw(t,"left","right"),y:jw(t,"top","bottom")}}function jw(t,e,s){return{min:ww(t,e),max:ww(t,s)}}function ww(t,e){return typeof t=="number"?t:t[e]||0}const JJ=new WeakMap;class ZJ{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=ut(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:s=!1,distanceThreshold:n}={}){const{presenceContext:i}=this.visualElement;if(i&&i.isPresent===!1)return;const a=h=>{const{dragSnapToOrigin:f}=this.getProps();f?this.pauseAnimation():this.stopAnimation(),s&&this.snapToCursor(kc(h).point)},o=(h,f)=>{const{drag:m,dragPropagation:p,onDragStart:x}=this.getProps();if(m&&!p&&(this.openDragLock&&this.openDragLock(),this.openDragLock=nG(m),!this.openDragLock))return;this.latestPointerEvent=h,this.latestPanInfo=f,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Vs(y=>{let b=this.getAxisMotionValue(y).get()||0;if(Pn.test(b)){const{projection:w}=this.visualElement;if(w&&w.layout){const S=w.layout.layoutBox[y];S&&(b=rs(S)*(parseFloat(b)/100))}}this.originPoint[y]=b}),x&&Ge.postRender(()=>x(h,f)),$p(this.visualElement,"transform");const{animationState:g}=this.visualElement;g&&g.setActive("whileDrag",!0)},l=(h,f)=>{this.latestPointerEvent=h,this.latestPanInfo=f;const{dragPropagation:m,dragDirectionLock:p,onDirectionLock:x,onDrag:g}=this.getProps();if(!m&&!this.openDragLock)return;const{offset:y}=f;if(p&&this.currentDirection===null){this.currentDirection=QJ(y),this.currentDirection!==null&&x&&x(this.currentDirection);return}this.updateAxis("x",f.point,y),this.updateAxis("y",f.point,y),this.visualElement.render(),g&&g(h,f)},c=(h,f)=>{this.latestPointerEvent=h,this.latestPanInfo=f,this.stop(h,f),this.latestPointerEvent=null,this.latestPanInfo=null},u=()=>Vs(h=>this.getAnimationState(h)==="paused"&&this.getAxisMotionValue(h).animation?.play()),{dragSnapToOrigin:d}=this.getProps();this.panSession=new U3(e,{onSessionStart:a,onStart:o,onMove:l,onSessionEnd:c,resumeAnimation:u},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:d,distanceThreshold:n,contextWindow:V3(this.visualElement)})}stop(e,s){const n=e||this.latestPointerEvent,i=s||this.latestPanInfo,a=this.isDragging;if(this.cancel(),!a||!i||!n)return;const{velocity:o}=i;this.startAnimation(o);const{onDragEnd:l}=this.getProps();l&&Ge.postRender(()=>l(n,i))}cancel(){this.isDragging=!1;const{projection:e,animationState:s}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),s&&s.setActive("whileDrag",!1)}updateAxis(e,s,n){const{drag:i}=this.getProps();if(!n||!tu(e,i,this.currentDirection))return;const a=this.getAxisMotionValue(e);let o=this.originPoint[e]+n[e];this.constraints&&this.constraints[e]&&(o=VJ(o,this.constraints[e],this.elastic[e])),a.set(o)}resolveConstraints(){const{dragConstraints:e,dragElastic:s}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,i=this.constraints;e&&_a(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&n?this.constraints=UJ(n.layoutBox,e):this.constraints=!1,this.elastic=GJ(s),i!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&Vs(a=>{this.constraints!==!1&&this.getAxisMotionValue(a)&&(this.constraints[a]=HJ(n.layoutBox[a],this.constraints[a]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:s}=this.getProps();if(!e||!_a(e))return!1;const n=e.current,{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const a=YG(n,i.root,this.visualElement.getTransformPagePoint());let o=WJ(i.layout.layoutBox,a);if(s){const l=s(JG(o));this.hasMutatedConstraints=!!l,l&&(o=_3(l))}return o}startAnimation(e){const{drag:s,dragMomentum:n,dragElastic:i,dragTransition:a,dragSnapToOrigin:o,onDragTransitionEnd:l}=this.getProps(),c=this.constraints||{},u=Vs(d=>{if(!tu(d,s,this.currentDirection))return;let h=c&&c[d]||{};o&&(h={min:0,max:0});const f=i?200:1e6,m=i?40:1e7,p={type:"inertia",velocity:n?e[d]:0,bounceStiffness:f,bounceDamping:m,timeConstant:750,restDelta:1,restSpeed:10,...a,...h};return this.startAxisValueAnimation(d,p)});return Promise.all(u).then(l)}startAxisValueAnimation(e,s){const n=this.getAxisMotionValue(e);return $p(this.visualElement,e),n.start(h0(e,n,0,s,this.visualElement,!1))}stopAnimation(){Vs(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Vs(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const s=`_drag${e.toUpperCase()}`,n=this.visualElement.getProps(),i=n[s];return i||this.visualElement.getValue(e,(n.initial?n.initial[e]:void 0)||0)}snapToCursor(e){Vs(s=>{const{drag:n}=this.getProps();if(!tu(s,n,this.currentDirection))return;const{projection:i}=this.visualElement,a=this.getAxisMotionValue(s);if(i&&i.layout){const{min:o,max:l}=i.layout.layoutBox[s];a.set(e[s]-et(o,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:s}=this.getProps(),{projection:n}=this.visualElement;if(!_a(s)||!n||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};Vs(o=>{const l=this.getAxisMotionValue(o);if(l&&this.constraints!==!1){const c=l.get();i[o]=KJ({min:c,max:c},this.constraints[o])}});const{transformTemplate:a}=this.visualElement.getProps();this.visualElement.current.style.transform=a?a({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),Vs(o=>{if(!tu(o,e,null))return;const l=this.getAxisMotionValue(o),{min:c,max:u}=this.constraints[o];l.set(et(c,u,i[o]))})}addListeners(){if(!this.visualElement.current)return;JJ.set(this.visualElement,this);const e=this.visualElement.current,s=fl(e,"pointerdown",c=>{const{drag:u,dragListener:d=!0}=this.getProps();u&&d&&this.start(c)}),n=()=>{const{dragConstraints:c}=this.getProps();_a(c)&&c.current&&(this.constraints=this.resolveRefConstraints())},{projection:i}=this.visualElement,a=i.addEventListener("measure",n);i&&!i.layout&&(i.root&&i.root.updateScroll(),i.updateLayout()),Ge.read(n);const o=Yl(window,"resize",()=>this.scalePositionWithinConstraints()),l=i.addEventListener("didUpdate",({delta:c,hasLayoutChanged:u})=>{this.isDragging&&u&&(Vs(d=>{const h=this.getAxisMotionValue(d);h&&(this.originPoint[d]+=c[d].translate,h.set(h.get()+c[d].translate))}),this.visualElement.render())});return()=>{o(),s(),a(),l&&l()}}getProps(){const e=this.visualElement.getProps(),{drag:s=!1,dragDirectionLock:n=!1,dragPropagation:i=!1,dragConstraints:a=!1,dragElastic:o=qp,dragMomentum:l=!0}=e;return{...e,drag:s,dragDirectionLock:n,dragPropagation:i,dragConstraints:a,dragElastic:o,dragMomentum:l}}}function tu(t,e,s){return(e===!0||e===t)&&(s===null||s===t)}function QJ(t,e=10){let s=null;return Math.abs(t.y)>e?s="y":Math.abs(t.x)>e&&(s="x"),s}class YJ extends di{constructor(e){super(e),this.removeGroupControls=Xs,this.removeListeners=Xs,this.controls=new ZJ(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Xs}unmount(){this.removeGroupControls(),this.removeListeners()}}const vw=t=>(e,s)=>{t&&Ge.postRender(()=>t(e,s))};class XJ extends di{constructor(){super(...arguments),this.removePointerDownListener=Xs}onPointerDown(e){this.session=new U3(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:V3(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:s,onPan:n,onPanEnd:i}=this.node.getProps();return{onSessionStart:vw(e),onStart:vw(s),onMove:n,onEnd:(a,o)=>{delete this.session,i&&Ge.postRender(()=>i(a,o))}}}mount(){this.removePointerDownListener=fl(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const yu={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function kw(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const Lo={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(ce.test(t))t=parseFloat(t);else return t;const s=kw(t,e.target.x),n=kw(t,e.target.y);return`${s}% ${n}%`}},eZ={correct:(t,{treeScale:e,projectionDelta:s})=>{const n=t,i=si.parse(t);if(i.length>5)return n;const a=si.createTransformer(t),o=typeof i[0]!="number"?1:0,l=s.x.scale*e.x,c=s.y.scale*e.y;i[0+o]/=l,i[1+o]/=c;const u=et(l,c,.5);return typeof i[2+o]=="number"&&(i[2+o]/=u),typeof i[3+o]=="number"&&(i[3+o]/=u),a(i)}};let mm=!1;class tZ extends j.Component{componentDidMount(){const{visualElement:e,layoutGroup:s,switchLayoutGroup:n,layoutId:i}=this.props,{projection:a}=e;kG(sZ),a&&(s.group&&s.group.add(a),n&&n.register&&i&&n.register(a),mm&&a.root.didUpdate(),a.addEventListener("animationComplete",()=>{this.safeToRemove()}),a.setOptions({...a.options,onExitComplete:()=>this.safeToRemove()})),yu.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:s,visualElement:n,drag:i,isPresent:a}=this.props,{projection:o}=n;return o&&(o.isPresent=a,mm=!0,i||e.layoutDependency!==s||s===void 0||e.isPresent!==a?o.willUpdate():this.safeToRemove(),e.isPresent!==a&&(a?o.promote():o.relegate()||Ge.postRender(()=>{const l=o.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),t0.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:s,switchLayoutGroup:n}=this.props,{projection:i}=e;mm=!0,i&&(i.scheduleCheckAfterUnmount(),s&&s.group&&s.group.remove(i),n&&n.deregister&&n.deregister(i))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function K3(t){const[e,s]=m3(),n=j.useContext(Mg);return r.jsx(tZ,{...t,layoutGroup:n,switchLayoutGroup:j.useContext(C3),isPresent:e,safeToRemove:s})}const sZ={borderRadius:{...Lo,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Lo,borderTopRightRadius:Lo,borderBottomLeftRadius:Lo,borderBottomRightRadius:Lo,boxShadow:eZ};function nZ(t,e,s){const n=Ht(t)?t:oo(t);return n.start(h0("",n,e,s)),n.animation}const rZ=(t,e)=>t.depth-e.depth;class iZ{constructor(){this.children=[],this.isDirty=!1}add(e){Og(this.children,e),this.isDirty=!0}remove(e){Rg(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(rZ),this.isDirty=!1,this.children.forEach(e)}}function aZ(t,e){const s=gs.now(),n=({timestamp:i})=>{const a=i-s;a>=e&&(ti(n),t(a-e))};return Ge.setup(n,!0),()=>ti(n)}const H3=["TopLeft","TopRight","BottomLeft","BottomRight"],oZ=H3.length,Nw=t=>typeof t=="string"?parseFloat(t):t,Sw=t=>typeof t=="number"||ce.test(t);function lZ(t,e,s,n,i,a){i?(t.opacity=et(0,s.opacity??1,cZ(n)),t.opacityExit=et(e.opacity??1,0,uZ(n))):a&&(t.opacity=et(e.opacity??1,s.opacity??1,n));for(let o=0;o<oZ;o++){const l=`border${H3[o]}Radius`;let c=Cw(e,l),u=Cw(s,l);if(c===void 0&&u===void 0)continue;c||(c=0),u||(u=0),c===0||u===0||Sw(c)===Sw(u)?(t[l]=Math.max(et(Nw(c),Nw(u),n),0),(Pn.test(u)||Pn.test(c))&&(t[l]+="%")):t[l]=u}(e.rotate||s.rotate)&&(t.rotate=et(e.rotate||0,s.rotate||0,n))}function Cw(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const cZ=G3(0,.5,Pz),uZ=G3(.5,.95,Xs);function G3(t,e,s){return n=>n<t?0:n>e?1:s(Hl(t,e,n))}function zw(t,e){t.min=e.min,t.max=e.max}function Bs(t,e){zw(t.x,e.x),zw(t.y,e.y)}function _w(t,e){t.translate=e.translate,t.scale=e.scale,t.originPoint=e.originPoint,t.origin=e.origin}function Aw(t,e,s,n,i){return t-=e,t=Id(t,1/s,n),i!==void 0&&(t=Id(t,1/i,n)),t}function dZ(t,e=0,s=1,n=.5,i,a=t,o=t){if(Pn.test(e)&&(e=parseFloat(e),e=et(o.min,o.max,e/100)-o.min),typeof e!="number")return;let l=et(a.min,a.max,n);t===a&&(l-=e),t.min=Aw(t.min,e,s,l,i),t.max=Aw(t.max,e,s,l,i)}function Tw(t,e,[s,n,i],a,o){dZ(t,e[s],e[n],e[i],e.scale,a,o)}const hZ=["x","scaleX","originX"],fZ=["y","scaleY","originY"];function Ew(t,e,s,n){Tw(t.x,e,hZ,s?s.x:void 0,n?n.x:void 0),Tw(t.y,e,fZ,s?s.y:void 0,n?n.y:void 0)}function Dw(t){return t.translate===0&&t.scale===1}function J3(t){return Dw(t.x)&&Dw(t.y)}function Mw(t,e){return t.min===e.min&&t.max===e.max}function mZ(t,e){return Mw(t.x,e.x)&&Mw(t.y,e.y)}function Pw(t,e){return Math.round(t.min)===Math.round(e.min)&&Math.round(t.max)===Math.round(e.max)}function Z3(t,e){return Pw(t.x,e.x)&&Pw(t.y,e.y)}function Iw(t){return rs(t.x)/rs(t.y)}function Ow(t,e){return t.translate===e.translate&&t.scale===e.scale&&t.originPoint===e.originPoint}class pZ{constructor(){this.members=[]}add(e){Og(this.members,e),e.scheduleRender()}remove(e){if(Rg(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const s=this.members[this.members.length-1];s&&this.promote(s)}}relegate(e){const s=this.members.findIndex(i=>e===i);if(s===0)return!1;let n;for(let i=s;i>=0;i--){const a=this.members[i];if(a.isPresent!==!1){n=a;break}}return n?(this.promote(n),!0):!1}promote(e,s){const n=this.lead;if(e!==n&&(this.prevLead=n,this.lead=e,e.show(),n)){n.instance&&n.scheduleRender(),e.scheduleRender(),e.resumeFrom=n,s&&(e.resumeFrom.preserveOpacity=!0),n.snapshot&&(e.snapshot=n.snapshot,e.snapshot.latestValues=n.animationValues||n.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:i}=e.options;i===!1&&n.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:s,resumingFrom:n}=e;s.onExitComplete&&s.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function xZ(t,e,s){let n="";const i=t.x.translate/e.x,a=t.y.translate/e.y,o=s?.z||0;if((i||a||o)&&(n=`translate3d(${i}px, ${a}px, ${o}px) `),(e.x!==1||e.y!==1)&&(n+=`scale(${1/e.x}, ${1/e.y}) `),s){const{transformPerspective:u,rotate:d,rotateX:h,rotateY:f,skewX:m,skewY:p}=s;u&&(n=`perspective(${u}px) ${n}`),d&&(n+=`rotate(${d}deg) `),h&&(n+=`rotateX(${h}deg) `),f&&(n+=`rotateY(${f}deg) `),m&&(n+=`skewX(${m}deg) `),p&&(n+=`skewY(${p}deg) `)}const l=t.x.scale*e.x,c=t.y.scale*e.y;return(l!==1||c!==1)&&(n+=`scale(${l}, ${c})`),n||"none"}const pm=["","X","Y","Z"],gZ=1e3;let yZ=0;function xm(t,e,s,n){const{latestValues:i}=e;i[t]&&(s[t]=i[t],e.setStaticValue(t,0),n&&(n[t]=0))}function Q3(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:e}=t.options;if(!e)return;const s=O3(e);if(window.MotionHasOptimisedAnimation(s,"transform")){const{layout:i,layoutId:a}=t.options;window.MotionCancelOptimisedAnimation(s,"transform",Ge,!(i||a))}const{parent:n}=t;n&&!n.hasCheckedOptimisedAppear&&Q3(n)}function Y3({attachResizeListener:t,defaultParent:e,measureScroll:s,checkIsScrollRoot:n,resetTransform:i}){return class{constructor(o={},l=e?.()){this.id=yZ++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(wZ),this.nodes.forEach(SZ),this.nodes.forEach(CZ),this.nodes.forEach(vZ)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new iZ)}addEventListener(o,l){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new $g),this.eventHandlers.get(o).add(l)}notifyListeners(o,...l){const c=this.eventHandlers.get(o);c&&c.notify(...l)}hasListeners(o){return this.eventHandlers.has(o)}mount(o){if(this.instance)return;this.isSVG=f3(o)&&!cG(o),this.instance=o;const{layoutId:l,layout:c,visualElement:u}=this.options;if(u&&!u.current&&u.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(c||l)&&(this.isLayoutDirty=!0),t){let d,h=0;const f=()=>this.root.updateBlockedByResize=!1;Ge.read(()=>{h=window.innerWidth}),t(o,()=>{const m=window.innerWidth;m!==h&&(h=m,this.root.updateBlockedByResize=!0,d&&d(),d=aZ(f,250),yu.hasAnimatedSinceResize&&(yu.hasAnimatedSinceResize=!1,this.nodes.forEach(Fw)))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&u&&(l||c)&&this.addEventListener("didUpdate",({delta:d,hasLayoutChanged:h,hasRelativeLayoutChanged:f,layout:m})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const p=this.options.transition||u.getDefaultTransition()||EZ,{onLayoutAnimationStart:x,onLayoutAnimationComplete:g}=u.getProps(),y=!this.targetLayout||!Z3(this.targetLayout,m),b=!h&&f;if(this.options.layoutRoot||this.resumeFrom||b||h&&(y||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const w={...Xg(p,"layout"),onPlay:x,onComplete:g};(u.shouldReduceMotion||this.options.layoutRoot)&&(w.delay=0,w.type=!1),this.startAnimation(w),this.setAnimationOrigin(d,b)}else h||Fw(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=m})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),ti(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(zZ),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Q3(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let d=0;d<this.path.length;d++){const h=this.path[d];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:l,layout:c}=this.options;if(l===void 0&&!c)return;const u=this.getTransformTemplate();this.prevTransformTemplateValue=u?u(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(Rw);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(Lw);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(NZ),this.nodes.forEach(bZ),this.nodes.forEach(jZ)):this.nodes.forEach(Lw),this.clearAllSnapshots();const l=gs.now();Lt.delta=ur(0,1e3/60,l-Lt.timestamp),Lt.timestamp=l,Lt.isProcessing=!0,rm.update.process(Lt),rm.preRender.process(Lt),rm.render.process(Lt),Lt.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,t0.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(kZ),this.sharedNodes.forEach(_Z)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Ge.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Ge.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!rs(this.snapshot.measuredBox.x)&&!rs(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutCorrected=ut(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let l=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(l=!1),l&&this.instance){const c=n(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:c,offset:s(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!i)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,l=this.projectionDelta&&!J3(this.projectionDelta),c=this.getTransformTemplate(),u=c?c(this.latestValues,""):void 0,d=u!==this.prevTransformTemplateValue;o&&this.instance&&(l||pi(this.latestValues)||d)&&(i(this.instance,u),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const l=this.measurePageBox();let c=this.removeElementScroll(l);return o&&(c=this.removeTransform(c)),DZ(c),{animationId:this.root.animationId,measuredBox:l,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:o}=this.options;if(!o)return ut();const l=o.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(MZ))){const{scroll:u}=this.root;u&&(Aa(l.x,u.offset.x),Aa(l.y,u.offset.y))}return l}removeElementScroll(o){const l=ut();if(Bs(l,o),this.scroll?.wasRoot)return l;for(let c=0;c<this.path.length;c++){const u=this.path[c],{scroll:d,options:h}=u;u!==this.root&&d&&h.layoutScroll&&(d.wasRoot&&Bs(l,o),Aa(l.x,d.offset.x),Aa(l.y,d.offset.y))}return l}applyTransform(o,l=!1){const c=ut();Bs(c,o);for(let u=0;u<this.path.length;u++){const d=this.path[u];!l&&d.options.layoutScroll&&d.scroll&&d!==d.root&&Ta(c,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),pi(d.latestValues)&&Ta(c,d.latestValues)}return pi(this.latestValues)&&Ta(c,this.latestValues),c}removeTransform(o){const l=ut();Bs(l,o);for(let c=0;c<this.path.length;c++){const u=this.path[c];if(!u.instance||!pi(u.latestValues))continue;Op(u.latestValues)&&u.updateSnapshot();const d=ut(),h=u.measurePageBox();Bs(d,h),Ew(l,u.latestValues,u.snapshot?u.snapshot.layoutBox:void 0,d)}return pi(this.latestValues)&&Ew(l,this.latestValues),l}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Lt.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==l;if(!(o||c&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:d,layoutId:h}=this.options;if(!(!this.layout||!(d||h))){if(this.resolvedRelativeTargetAt=Lt.timestamp,!this.targetDelta&&!this.relativeTarget){const f=this.getClosestProjectingParent();f&&f.layout&&this.animationProgress!==1?(this.relativeParent=f,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ut(),this.relativeTargetOrigin=ut(),pl(this.relativeTargetOrigin,this.layout.layoutBox,f.layout.layoutBox),Bs(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=ut(),this.targetWithTransforms=ut()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),FJ(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Bs(this.target,this.layout.layoutBox),T3(this.target,this.targetDelta)):Bs(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const f=this.getClosestProjectingParent();f&&!!f.resumingFrom==!!this.resumingFrom&&!f.options.layoutScroll&&f.target&&this.animationProgress!==1?(this.relativeParent=f,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ut(),this.relativeTargetOrigin=ut(),pl(this.relativeTargetOrigin,this.target,f.target),Bs(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||Op(this.parent.latestValues)||A3(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const o=this.getLead(),l=!!this.resumingFrom||this!==o;let c=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===Lt.timestamp&&(c=!1),c)return;const{layout:u,layoutId:d}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||d))return;Bs(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,f=this.treeScale.y;QG(this.layoutCorrected,this.treeScale,this.path,l),o.layout&&!o.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(o.target=o.layout.layoutBox,o.targetWithTransforms=ut());const{target:m}=o;if(!m){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(_w(this.prevProjectionDelta.x,this.projectionDelta.x),_w(this.prevProjectionDelta.y,this.projectionDelta.y)),ml(this.projectionDelta,this.layoutCorrected,m,this.latestValues),(this.treeScale.x!==h||this.treeScale.y!==f||!Ow(this.projectionDelta.x,this.prevProjectionDelta.x)||!Ow(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",m))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){if(this.options.visualElement?.scheduleRender(),o){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Ea(),this.projectionDelta=Ea(),this.projectionDeltaWithTransform=Ea()}setAnimationOrigin(o,l=!1){const c=this.snapshot,u=c?c.latestValues:{},d={...this.latestValues},h=Ea();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const f=ut(),m=c?c.source:void 0,p=this.layout?this.layout.source:void 0,x=m!==p,g=this.getStack(),y=!g||g.members.length<=1,b=!!(x&&!y&&this.options.crossfade===!0&&!this.path.some(TZ));this.animationProgress=0;let w;this.mixTargetDelta=S=>{const z=S/1e3;$w(h.x,o.x,z),$w(h.y,o.y,z),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(pl(f,this.layout.layoutBox,this.relativeParent.layout.layoutBox),AZ(this.relativeTarget,this.relativeTargetOrigin,f,z),w&&mZ(this.relativeTarget,w)&&(this.isProjectionDirty=!1),w||(w=ut()),Bs(w,this.relativeTarget)),x&&(this.animationValues=d,lZ(d,u,this.latestValues,z,b,y)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=z},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(ti(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Ge.update(()=>{yu.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=oo(0)),this.currentAnimation=nZ(this.motionValue,[0,1e3],{...o,velocity:0,isSync:!0,onUpdate:l=>{this.mixTargetDelta(l),o.onUpdate&&o.onUpdate(l)},onStop:()=>{},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(gZ),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:l,target:c,layout:u,latestValues:d}=o;if(!(!l||!c||!u)){if(this!==o&&this.layout&&u&&X3(this.options.animationType,this.layout.layoutBox,u.layoutBox)){c=this.target||ut();const h=rs(this.layout.layoutBox.x);c.x.min=o.target.x.min,c.x.max=c.x.min+h;const f=rs(this.layout.layoutBox.y);c.y.min=o.target.y.min,c.y.max=c.y.min+f}Bs(l,c),Ta(l,d),ml(this.projectionDeltaWithTransform,this.layoutCorrected,l,d)}}registerSharedNode(o,l){this.sharedNodes.has(o)||this.sharedNodes.set(o,new pZ),this.sharedNodes.get(o).add(l);const u=l.options.initialPromotionConfig;l.promote({transition:u?u.transition:void 0,preserveFollowOpacity:u&&u.shouldPreserveFollowOpacity?u.shouldPreserveFollowOpacity(l):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){const{layoutId:o}=this.options;return o?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:o}=this.options;return o?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:l,preserveFollowOpacity:c}={}){const u=this.getStack();u&&u.promote(this,c),o&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let l=!1;const{latestValues:c}=o;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(l=!0),!l)return;const u={};c.z&&xm("z",o,u,this.animationValues);for(let d=0;d<pm.length;d++)xm(`rotate${pm[d]}`,o,u,this.animationValues),xm(`skew${pm[d]}`,o,u,this.animationValues);o.render();for(const d in u)o.setStaticValue(d,u[d]),this.animationValues&&(this.animationValues[d]=u[d]);o.scheduleRender()}applyProjectionStyles(o,l){if(!this.instance||this.isSVG)return;if(!this.isVisible){o.visibility="hidden";return}const c=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,o.visibility="",o.opacity="",o.pointerEvents=gu(l?.pointerEvents)||"",o.transform=c?c(this.latestValues,""):"none";return}const u=this.getLead();if(!this.projectionDelta||!this.layout||!u.target){this.options.layoutId&&(o.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,o.pointerEvents=gu(l?.pointerEvents)||""),this.hasProjected&&!pi(this.latestValues)&&(o.transform=c?c({},""):"none",this.hasProjected=!1);return}o.visibility="";const d=u.animationValues||u.latestValues;this.applyTransformsToTarget();let h=xZ(this.projectionDeltaWithTransform,this.treeScale,d);c&&(h=c(d,h)),o.transform=h;const{x:f,y:m}=this.projectionDelta;o.transformOrigin=`${f.origin*100}% ${m.origin*100}% 0`,u.animationValues?o.opacity=u===this?d.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:d.opacityExit:o.opacity=u===this?d.opacity!==void 0?d.opacity:"":d.opacityExit!==void 0?d.opacityExit:0;for(const p in Ql){if(d[p]===void 0)continue;const{correct:x,applyTo:g,isCSSVariable:y}=Ql[p],b=h==="none"?d[p]:x(d[p],u);if(g){const w=g.length;for(let S=0;S<w;S++)o[g[S]]=b}else y?this.options.visualElement.renderState.vars[p]=b:o[p]=b}this.options.layoutId&&(o.pointerEvents=u===this?gu(l?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>o.currentAnimation?.stop()),this.root.nodes.forEach(Rw),this.root.sharedNodes.clear()}}}function bZ(t){t.updateLayout()}function jZ(t){const e=t.resumeFrom?.snapshot||t.snapshot;if(t.isLead()&&t.layout&&e&&t.hasListeners("didUpdate")){const{layoutBox:s,measuredBox:n}=t.layout,{animationType:i}=t.options,a=e.source!==t.layout.source;i==="size"?Vs(d=>{const h=a?e.measuredBox[d]:e.layoutBox[d],f=rs(h);h.min=s[d].min,h.max=h.min+f}):X3(i,e.layoutBox,s)&&Vs(d=>{const h=a?e.measuredBox[d]:e.layoutBox[d],f=rs(s[d]);h.max=h.min+f,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[d].max=t.relativeTarget[d].min+f)});const o=Ea();ml(o,s,e.layoutBox);const l=Ea();a?ml(l,t.applyTransform(n,!0),e.measuredBox):ml(l,s,e.layoutBox);const c=!J3(o);let u=!1;if(!t.resumeFrom){const d=t.getClosestProjectingParent();if(d&&!d.resumeFrom){const{snapshot:h,layout:f}=d;if(h&&f){const m=ut();pl(m,e.layoutBox,h.layoutBox);const p=ut();pl(p,s,f.layoutBox),Z3(m,p)||(u=!0),d.options.layoutRoot&&(t.relativeTarget=p,t.relativeTargetOrigin=m,t.relativeParent=d)}}}t.notifyListeners("didUpdate",{layout:s,snapshot:e,delta:l,layoutDelta:o,hasLayoutChanged:c,hasRelativeLayoutChanged:u})}else if(t.isLead()){const{onExitComplete:s}=t.options;s&&s()}t.options.transition=void 0}function wZ(t){t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function vZ(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function kZ(t){t.clearSnapshot()}function Rw(t){t.clearMeasurements()}function Lw(t){t.isLayoutDirty=!1}function NZ(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function Fw(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function SZ(t){t.resolveTargetDelta()}function CZ(t){t.calcProjection()}function zZ(t){t.resetSkewAndRotation()}function _Z(t){t.removeLeadSnapshot()}function $w(t,e,s){t.translate=et(e.translate,0,s),t.scale=et(e.scale,1,s),t.origin=e.origin,t.originPoint=e.originPoint}function Bw(t,e,s,n){t.min=et(e.min,s.min,n),t.max=et(e.max,s.max,n)}function AZ(t,e,s,n){Bw(t.x,e.x,s.x,n),Bw(t.y,e.y,s.y,n)}function TZ(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const EZ={duration:.45,ease:[.4,0,.1,1]},qw=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),Vw=qw("applewebkit/")&&!qw("chrome/")?Math.round:Xs;function Uw(t){t.min=Vw(t.min),t.max=Vw(t.max)}function DZ(t){Uw(t.x),Uw(t.y)}function X3(t,e,s){return t==="position"||t==="preserve-aspect"&&!LJ(Iw(e),Iw(s),.2)}function MZ(t){return t!==t.root&&t.scroll?.wasRoot}const PZ=Y3({attachResizeListener:(t,e)=>Yl(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),gm={current:void 0},e4=Y3({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!gm.current){const t=new PZ({});t.mount(window),t.setOptions({layoutScroll:!0}),gm.current=t}return gm.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),IZ={pan:{Feature:XJ},drag:{Feature:YJ,ProjectionNode:e4,MeasureLayout:K3}};function Ww(t,e,s){const{props:n}=t;t.animationState&&n.whileHover&&t.animationState.setActive("whileHover",s==="Start");const i="onHover"+s,a=n[i];a&&Ge.postRender(()=>a(e,kc(e)))}class OZ extends di{mount(){const{current:e}=this.node;e&&(this.unmount=rG(e,(s,n)=>(Ww(this.node,n,"Start"),i=>Ww(this.node,i,"End"))))}unmount(){}}class RZ extends di{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=jc(Yl(this.node.current,"focus",()=>this.onFocus()),Yl(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function Kw(t,e,s){const{props:n}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&n.whileTap&&t.animationState.setActive("whileTap",s==="Start");const i="onTap"+(s==="End"?"":s),a=n[i];a&&Ge.postRender(()=>a(e,kc(e)))}class LZ extends di{mount(){const{current:e}=this.node;e&&(this.unmount=lG(e,(s,n)=>(Kw(this.node,n,"Start"),(i,{success:a})=>Kw(this.node,i,a?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Vp=new WeakMap,ym=new WeakMap,FZ=t=>{const e=Vp.get(t.target);e&&e(t)},$Z=t=>{t.forEach(FZ)};function BZ({root:t,...e}){const s=t||document;ym.has(s)||ym.set(s,{});const n=ym.get(s),i=JSON.stringify(e);return n[i]||(n[i]=new IntersectionObserver($Z,{root:t,...e})),n[i]}function qZ(t,e,s){const n=BZ(e);return Vp.set(t,s),n.observe(t),()=>{Vp.delete(t),n.unobserve(t)}}const VZ={some:0,all:1};class UZ extends di{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:s,margin:n,amount:i="some",once:a}=e,o={root:s?s.current:void 0,rootMargin:n,threshold:typeof i=="number"?i:VZ[i]},l=c=>{const{isIntersecting:u}=c;if(this.isInView===u||(this.isInView=u,a&&!u&&this.hasEnteredView))return;u&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",u);const{onViewportEnter:d,onViewportLeave:h}=this.node.getProps(),f=u?d:h;f&&f(c)};return qZ(this.node.current,o,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:s}=this.node;["amount","margin","root"].some(WZ(e,s))&&this.startObserver()}unmount(){}}function WZ({viewport:t={}},{viewport:e={}}={}){return s=>t[s]!==e[s]}const KZ={inView:{Feature:UZ},tap:{Feature:LZ},focus:{Feature:RZ},hover:{Feature:OZ}},HZ={layout:{ProjectionNode:e4,MeasureLayout:K3}},GZ={...DJ,...KZ,...IZ,...HZ},lt=GG(GZ,oJ),Kh={normal:.3,slow:.5},JZ={stagger:.05},ZZ={default:[.4,0,.2,1]},QZ={hidden:{opacity:0,y:20},visible:(t=0)=>({opacity:1,y:0,transition:{delay:t*JZ.stagger,duration:Kh.normal,ease:ZZ.default}})},YZ=(t,e=Kh.slow)=>{const[s,n]=ae.useState(0),i=ae.useRef(0);return ae.useEffect(()=>{const a=i.current,o=t,l=Date.now(),c=()=>{const u=(Date.now()-l)/1e3,d=Math.min(u/e,1),h=1-Math.pow(1-d,3),f=Math.floor(a+(o-a)*h);n(f),d<1?requestAnimationFrame(c):i.current=o};requestAnimationFrame(c)},[t,e]),s},zo=({children:t,index:e=0,className:s="",...n})=>r.jsx(lt.div,{variants:QZ,initial:"hidden",animate:"visible",custom:e,className:s,...n,children:t}),Ki=({value:t,className:e="bg-gray-100 rounded-full overflow-hidden",barClassName:s="h-full bg-gray-900",height:n="h-2"})=>r.jsx("div",{className:`${n} ${e}`,children:r.jsx(lt.div,{initial:{width:0},animate:{width:`${t}%`},transition:{duration:Kh.slow,ease:"easeOut"},className:s})}),Ft=({value:t,className:e="",duration:s=Kh.slow,prefix:n="",suffix:i=""})=>{const a=YZ(t,s);return r.jsxs("span",{className:e,children:[n,a.toLocaleString("pl-PL"),i]})},XZ=()=>r.jsxs("div",{className:"rounded-2xl border bg-card p-5 shadow-soft animate-pulse",children:[r.jsxs("div",{className:"flex items-start justify-between gap-3",children:[r.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[r.jsx("div",{className:"h-8 w-8 rounded-md bg-muted/70"}),r.jsx("div",{className:"h-4 w-40 rounded bg-muted/70"})]}),r.jsx("div",{className:"h-5 w-16 rounded-full bg-muted/70"})]}),r.jsxs("div",{className:"mt-4",children:[r.jsx("div",{className:"h-2 w-full rounded-full bg-muted/60"}),r.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[r.jsx("div",{className:"h-3 w-16 rounded bg-muted/60"}),r.jsx("div",{className:"h-3 w-20 rounded bg-muted/60"})]})]}),r.jsx("div",{className:"mt-4 h-9 w-2/3 rounded-lg bg-muted/60"}),r.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[r.jsx("div",{className:"h-6 w-16 rounded bg-muted/60"}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("div",{className:"h-9 w-24 rounded-lg bg-muted/60"}),r.jsx("div",{className:"h-9 w-10 rounded-lg bg-muted/60"})]})]})]}),eQ=()=>{const t=pe(),{data:e}=wt(),{stats:s,refetch:n}=ta(),{data:i,isLoading:a}=bc("get_my_courses"),[o,l]=ae.useState(0),c=i||[],u=!a&&c.length===0;ae.useEffect(()=>{const h=async()=>{try{const{data:m}=await oe.rpc("check_claimable_rewards");l(m?.claimable_points||0)}catch{}};h();const f=setInterval(h,3e4);return()=>clearInterval(f)},[]);const d=async()=>{try{const{data:h,error:f}=await oe.rpc("claim_daily_rewards");if(f)throw f;h&&(G.success(`Odebrano ${h.total_earned} punktów`),n(),l(0))}catch{G.error("Nie można odebrać nagród")}};return r.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8 pb-24 lg:pb-8",children:[r.jsxs(lt.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.45},className:"relative overflow-hidden rounded-2xl border",children:[r.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/[0.12] via-secondary/[0.10] to-accent/[0.12]"}),r.jsx("div",{className:"absolute inset-0 opacity-[0.06]",style:{backgroundImage:`
                linear-gradient(to right, hsl(var(--ring)/0.35) 1px, transparent 1px),
                linear-gradient(to bottom, hsl(var(--ring)/0.35) 1px, transparent 1px)
              `,backgroundSize:"28px 28px"}})]}),r.jsxs("div",{className:"relative z-10 p-4 sm:p-6 md:p-8",children:[r.jsxs("div",{className:"space-y-6 md:hidden",children:[r.jsxs("div",{className:"space-y-3",children:[r.jsx("h2",{className:"text-xl font-bold tracking-tight",children:"Twoje tempo nauki"}),r.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s.streak>0&&r.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full border bg-background/60 px-3 py-1.5 shadow-soft",children:[r.jsx(An,{className:"h-4 w-4 text-destructive"}),r.jsxs("span",{className:"text-sm font-medium",children:["Seria: ",r.jsx("span",{className:"tabular-nums",children:s.streak})," ","dni"]})]}),o>0&&r.jsxs("button",{onClick:d,className:"inline-flex items-center gap-2 rounded-lg bg-primary px-3 py-1.5 text-sm text-primary-foreground hover:bg-primary/90 focus-ring",children:[r.jsx(v0,{className:"h-4 w-4"}),"Odbierz ",o," pkt"]})]})]}),r.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[r.jsxs("div",{className:"rounded-xl border bg-card p-4 shadow-soft",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Punkty"}),r.jsx(Vt,{className:"h-4 w-4 text-primary"})]}),r.jsxs("div",{className:"flex items-end gap-2",children:[r.jsx("span",{className:"text-3xl font-semibold tabular-nums text-primary leading-none",children:r.jsx(Ft,{value:s.points})}),r.jsx("span",{className:"mb-1 text-sm text-muted-foreground",children:"pkt"})]}),r.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:["+",r.jsx(Ft,{value:s.idle_rate}),"/h"]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[r.jsxs("div",{className:"rounded-xl border bg-card p-4 shadow-soft",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Poziom"}),r.jsx(Ii,{className:"h-4 w-4 text-secondary"})]}),r.jsx("span",{className:"text-2xl font-semibold text-secondary",children:s.level}),r.jsx("div",{className:"mt-2 h-1.5 w-full rounded-full bg-muted",children:r.jsx("div",{className:"h-full rounded-full bg-secondary transition-all",style:{width:`${s.points%100}%`}})})]}),r.jsxs("div",{className:"rounded-xl border bg-card p-4 shadow-soft",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Premia"}),r.jsx(Et,{className:"h-4 w-4 text-accent"})]}),r.jsxs("span",{className:"text-2xl font-semibold text-accent",children:["+",r.jsx(Ft,{value:s.idle_rate})]}),r.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"pkt/h"})]})]})]})]}),r.jsxs("div",{className:"hidden md:grid gap-8 md:grid-cols-12 md:items-center",children:[r.jsxs("div",{className:"md:col-span-4 space-y-4",children:[r.jsx("h2",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Twoje tempo nauki"}),s.streak>0&&r.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full border bg-background/60 px-3 py-1.5 shadow-soft",children:[r.jsx(An,{className:"h-4 w-4 text-destructive"}),r.jsxs("span",{className:"text-sm font-medium",children:["Seria: ",r.jsx("span",{className:"tabular-nums",children:s.streak})," ","dni"]})]}),o>0&&r.jsxs("button",{onClick:d,className:"inline-flex items-center gap-2 rounded-lg bg-primary px-4 py-2 text-primary-foreground hover:bg-primary/90 focus-ring",children:[r.jsx(v0,{className:"h-4 w-4"}),"Odbierz ",o," pkt"]})]}),r.jsx("div",{className:"md:col-span-8",children:r.jsxs("div",{className:"grid grid-cols-3 gap-4 md:gap-6",children:[r.jsxs("div",{className:"rounded-xl border bg-card p-5 shadow-soft",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Punkty"}),r.jsx(Vt,{className:"h-4 w-4 text-primary"})]}),r.jsxs("div",{className:"mt-2 flex items-end gap-2",children:[r.jsx("span",{className:"text-4xl md:text-5xl font-semibold tabular-nums text-primary leading-none",children:r.jsx(Ft,{value:s.points})}),r.jsx("span",{className:"mb-[2px] text-sm text-muted-foreground",children:"pkt"})]}),r.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:["+",r.jsx(Ft,{value:s.idle_rate}),"/h"]})]}),r.jsxs("div",{className:"rounded-xl border bg-card p-5 shadow-soft",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Poziom"}),r.jsx(Ii,{className:"h-4 w-4 text-secondary"})]}),r.jsx("div",{className:"mt-2 flex items-center gap-2",children:r.jsx("span",{className:"text-4xl md:text-5xl font-semibold text-secondary leading-none",children:s.level})}),r.jsx("div",{className:"mt-3 h-2 w-full rounded-full bg-muted",children:r.jsx("div",{className:"h-full rounded-full bg-secondary transition-all",style:{width:`${s.points%100}%`}})}),r.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:["Do kolejnego: ",100-s.points%100," pkt"]})]}),r.jsxs("div",{className:"rounded-xl border bg-card p-5 shadow-soft",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Premia"}),r.jsx(Et,{className:"h-4 w-4 text-accent"})]}),r.jsxs("div",{className:"mt-2 flex items-end gap-2",children:[r.jsxs("span",{className:"text-4xl md:text-5xl font-semibold text-accent leading-none",children:["+",r.jsx(Ft,{value:s.idle_rate})]}),r.jsx("span",{className:"mb-[2px] text-sm text-muted-foreground",children:"pkt/h"})]}),r.jsx("button",{onClick:()=>t("/student/gamification"),className:"mt-3 w-full rounded-lg border px-3 py-2 hover:bg-primary/5 focus-ring",children:"Gamifikacja"})]})]})})]})]})]}),r.jsxs(lt.section,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.4,delay:.05},className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between gap-4",children:[r.jsxs("div",{className:"min-w-0",children:[r.jsx("h3",{className:"text-lg sm:text-xl md:text-2xl font-semibold tracking-tight",children:"Twoje kursy"}),r.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"To jest Twoja główna ścieżka — kontynuuj naukę tam, gdzie skończyłeś."})]}),r.jsxs("button",{onClick:()=>t("/student/courses"),className:"inline-flex items-center gap-1 sm:gap-2 rounded-lg border px-2 sm:px-3 py-1.5 sm:py-2 text-sm hover:bg-primary/5 focus-ring whitespace-nowrap",children:[r.jsx("span",{className:"hidden sm:inline",children:"Zobacz wszystkie"}),r.jsx("span",{className:"sm:hidden",children:"Wszystkie"}),r.jsx(Ue,{className:"h-4 w-4"})]})]}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-5",children:[a&&Array.from({length:6}).map((h,f)=>r.jsx(XZ,{},f)),!a&&c.slice(0,9).map(h=>{const f=h.progress_percent===100;return r.jsxs("div",{className:"group relative rounded-2xl border bg-card p-4 sm:p-5 shadow-soft hover:bg-muted/40 transition-colors",children:[r.jsxs("div",{className:"flex items-start justify-between gap-3",children:[r.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[r.jsx("span",{className:"text-2xl sm:text-3xl shrink-0 leading-none",children:h.icon_emoji||"📚"}),r.jsx("h4",{className:"font-semibold text-sm sm:text-base text-foreground line-clamp-2",children:h.title})]}),f?r.jsx("span",{className:"inline-flex items-center gap-1 rounded-full border border-green-600/30 bg-green-500/10 text-green-700 dark:text-green-400 px-2 sm:px-2.5 py-0.5 sm:py-1 text-[10px] sm:text-[11px] font-semibold",children:"Ukończono"}):r.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-primary/30 text-primary px-2 sm:px-2.5 py-0.5 sm:py-1 text-[10px] sm:text-[11px] font-semibold",children:[h.progress_percent,"%"]})]}),r.jsxs("div",{className:"mt-4",children:[r.jsx("div",{className:"h-2 w-full rounded-full bg-muted",children:r.jsx("div",{className:`h-full rounded-full transition-all ${f?"bg-green-600":"bg-primary"}`,style:{width:`${h.progress_percent||0}%`}})}),r.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-muted-foreground",children:[r.jsx("span",{children:"Ukończono"}),r.jsxs("span",{className:"font-medium text-foreground",children:[h.completed_lessons||0,"/",h.total_lessons||10," lekcji"]})]})]}),h.next_activity&&r.jsxs("div",{className:"mt-3 sm:mt-4 flex items-center gap-2 rounded-lg border bg-background/60 px-2.5 sm:px-3 py-1.5 sm:py-2",children:[r.jsx(Q_,{className:"h-3.5 sm:h-4 w-3.5 sm:w-4 text-primary"}),r.jsx("p",{className:"text-xs sm:text-sm font-medium truncate",children:h.next_activity})]}),r.jsxs("div",{className:"mt-3 sm:mt-4 flex items-center justify-between",children:[h.points_available?r.jsxs("span",{className:"inline-flex rounded-md bg-orange-500/10 text-[10px] sm:text-[11px] font-semibold px-2 py-0.5 sm:py-1 text-orange-600",children:["+",h.points_available," pkt"]}):r.jsx("span",{}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:()=>t(`/student/courses/${h.course_id}`),className:"rounded-lg bg-primary px-3 sm:px-4 py-1.5 sm:py-2 text-sm text-primary-foreground hover:bg-primary/90 focus-ring",children:"Kontynuuj"}),r.jsx("button",{onClick:()=>t(`/student/courses/${h.course_id}`),className:"rounded-lg border px-2.5 sm:px-3 py-1.5 sm:py-2 hover:bg-primary/5 focus-ring",title:"Szczegóły",children:r.jsx(Ue,{className:"h-3.5 sm:h-4 w-3.5 sm:w-4"})})]})]})]},h.course_id)}),u&&r.jsxs("div",{className:"col-span-full rounded-2xl border bg-card p-8 sm:p-10 text-center shadow-soft",children:[r.jsx("div",{className:"text-4xl sm:text-5xl",children:"🚀"}),r.jsx("h4",{className:"mt-3 sm:mt-4 text-base sm:text-lg font-semibold",children:"Zacznij swoją przygodę"}),r.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:"Dołącz do kursu i odkryj nowy sposób nauki."}),r.jsx("button",{onClick:()=>t("/student/courses"),className:"mt-4 sm:mt-6 rounded-lg bg-secondary px-4 sm:px-5 py-2 sm:py-2.5 text-sm text-white hover:opacity-95 focus-ring",children:"Odkryj kursy"})]})]})]}),r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4",children:[r.jsxs("div",{className:"rounded-xl border bg-card/70 backdrop-blur-sm p-4 sm:p-5 shadow-md",children:[r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground font-medium",children:"Punkty"}),r.jsx(Vt,{className:"h-3.5 sm:h-4 w-3.5 sm:w-4 text-primary"})]}),r.jsx("p",{className:"mt-1.5 text-xl sm:text-2xl font-semibold tabular-nums text-foreground",children:r.jsx(Ft,{value:s.points})}),r.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:["+",r.jsx(Ft,{value:s.idle_rate}),"/h"]})]}),r.jsxs("div",{className:"rounded-xl border bg-card/70 backdrop-blur-sm p-4 sm:p-5 shadow-md",children:[r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground font-medium",children:"Poziom"}),r.jsx(ft,{className:"h-3.5 sm:h-4 w-3.5 sm:w-4 text-secondary"})]}),r.jsx("p",{className:"mt-1.5 text-xl sm:text-2xl font-semibold text-foreground",children:s.level}),r.jsx("div",{className:"mt-2 sm:mt-3",children:r.jsx(Ki,{value:s.points%100})})]}),r.jsxs("div",{className:"rounded-xl border bg-card/70 backdrop-blur-sm p-4 sm:p-5 shadow-md",children:[r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground font-medium",children:"Seria dni"}),r.jsx(An,{className:"h-3.5 sm:h-4 w-3.5 sm:w-4 text-destructive"})]}),r.jsx("p",{className:"mt-1.5 text-xl sm:text-2xl font-semibold text-foreground",children:r.jsx(Ft,{value:s.streak})}),r.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:"dni z rzędu"})]}),r.jsxs("div",{className:"rounded-xl border bg-card/70 backdrop-blur-sm p-4 sm:p-5 shadow-md",children:[r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground font-medium",children:"Tempo"}),r.jsx(Et,{className:"h-3.5 sm:h-4 w-3.5 sm:w-4 text-accent"})]}),r.jsxs("p",{className:"mt-1.5 text-xl sm:text-2xl font-semibold text-foreground",children:["+",r.jsx(Ft,{value:s.idle_rate})]}),r.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:"punktów/h"})]})]})]})},tQ=[r.jsx(Z,{path:"dashboard",element:r.jsx(eQ,{})},"dashboard")],sQ=()=>{const t=pe(),{data:e}=bc("get_my_courses"),s=e||[];return r.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8 pb-24 lg:pb-8",children:[r.jsxs(lt.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.45},className:"relative overflow-hidden rounded-2xl border",children:[r.jsx("div",{className:"pointer-events-none absolute inset-0",children:r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/[0.12] via-secondary/[0.10] to-accent/[0.12]"})}),r.jsxs("div",{className:"relative z-10 p-4 sm:p-6 md:p-8",children:[r.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Twoje kursy"}),r.jsx("p",{className:"mt-2 text-sm md:text-base text-muted-foreground",children:"Wybierz kurs i kontynuuj naukę w swoim tempie."})]})]}),r.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-5",children:s.map((n,i)=>r.jsxs(zo,{index:i,className:"group relative rounded-2xl border bg-card p-4 sm:p-5 shadow-soft hover:bg-muted/40 transition-colors cursor-pointer",onClick:()=>t(`/student/courses/${n.course_id}`),children:[r.jsxs("div",{className:"flex items-start justify-between gap-3",children:[r.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[r.jsx("span",{className:"text-2xl sm:text-3xl shrink-0 leading-none",children:n.icon_emoji||"📚"}),r.jsx("h4",{className:"font-semibold text-sm sm:text-base text-foreground line-clamp-2",children:n.title})]}),r.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-primary/30 text-primary px-2 sm:px-2.5 py-0.5 sm:py-1 text-[10px] sm:text-[11px] font-semibold",children:[n.progress_percent,"%"]})]}),r.jsx("div",{className:"mt-4",children:r.jsx(Ki,{value:n.progress_percent})}),r.jsxs("button",{className:"mt-4 inline-flex items-center gap-1 text-sm font-medium text-primary",children:["Kontynuuj",r.jsx(Ue,{className:"h-4 w-4"})]})]},n.course_id))})]})},nQ=[r.jsx(Z,{path:"/courses",element:r.jsx(sQ,{})},"courses-list")],rQ=()=>r.jsxs("div",{className:"rounded-2xl border bg-card p-5 md:p-6 shadow-soft animate-pulse",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"h-12 w-12 rounded-xl bg-muted/60"}),r.jsxs("div",{className:"flex-1 space-y-2",children:[r.jsx("div",{className:"h-5 w-1/2 rounded bg-muted/60"}),r.jsx("div",{className:"h-4 w-3/4 rounded bg-muted/60"})]}),r.jsx("div",{className:"h-9 w-36 rounded-lg bg-muted/60"})]}),r.jsxs("div",{className:"mt-5",children:[r.jsx("div",{className:"h-2 w-full rounded-full bg-muted/60"}),r.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[r.jsx("div",{className:"h-3 w-16 rounded bg-muted/60"}),r.jsx("div",{className:"h-3 w-10 rounded bg-muted/60"})]})]})]}),iQ=()=>r.jsxs("div",{className:"rounded-2xl border bg-card p-4 md:p-5 shadow-soft animate-pulse",children:[r.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[r.jsx("div",{className:"h-10 w-10 rounded-full bg-muted/60"}),r.jsx("div",{className:"h-4 w-2/5 rounded bg-muted/60"})]}),r.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((t,e)=>r.jsx("div",{className:"h-14 rounded-xl border bg-muted/40"},e))})]}),aQ=()=>{const{courseId:t}=Qt(),e=pe(),{data:s,isLoading:n}=bc("get_course_structure",{p_course_id:parseInt(t)},{enabled:!!t}),{data:i}=hK("courses",{filters:[{field:"id",operator:"eq",value:parseInt(t)}],enabled:!!t}),a=ae.useMemo(()=>{if(!s)return[];const u=s.reduce((f,m)=>{const p=`${m.topic_id}-${m.topic_title}`;return f[p]||(f[p]={id:m.topic_id,title:m.topic_title,position:m.topic_position,activities:[]}),m.activity_id&&f[p].activities.push({id:m.activity_id,title:m.activity_title,type:m.activity_type,position:m.activity_position,completed:m.is_completed,score:m.score}),f},{}),d=Object.values(u).sort((f,m)=>f.position-m.position);let h=!1;return d.map((f,m)=>{const p=f.activities.length>0&&f.activities.every(g=>g.completed),x=m===0||d[m-1].activities.length>0&&d[m-1].activities.every(g=>g.completed);return f.activities.sort((g,y)=>g.position-y.position),f.activities=f.activities.map(g=>{let y=!1;return g.completed?y=!0:x&&!h&&(y=!0,h=!0),{...g,isUnlocked:y}}),{...f,isCompleted:p,isUnlocked:x}})},[s]),o=ae.useMemo(()=>{const u=a.flatMap(f=>f.activities),d=u.filter(f=>f.completed).length,h=u.length;return{totalActivities:h,completedActivities:d,progress:h>0?Math.round(d/h*100):0}},[a]),l=i?.[0],c=ae.useMemo(()=>{for(const u of a){const d=u.activities.find(h=>!h.completed&&h.isUnlocked);if(d)return{topicId:u.id,activity:d,path:d.type==="quiz"?`/student/courses/${t}/quiz/${d.id}`:`/student/courses/${t}/lesson/${d.id}`}}return null},[a,t]);return n?r.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8",children:[r.jsxs("button",{className:"inline-flex items-center gap-2 text-muted-foreground cursor-default",disabled:!0,children:[r.jsx(Pe,{className:"w-4 h-4"}),r.jsx("span",{className:"text-sm",children:"Powrót"})]}),r.jsx(rQ,{}),r.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((u,d)=>r.jsx(iQ,{},d))})]}):l?r.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8 pb-24 lg:pb-8",children:[r.jsxs("button",{onClick:()=>e("/student/dashboard#courses"),className:"flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors",children:[r.jsx(Pe,{className:"w-4 h-4"}),r.jsx("span",{className:"text-sm",children:"Powrót"})]}),r.jsxs(lt.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.45},className:"relative overflow-hidden rounded-2xl border",children:[r.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/[0.12] via-secondary/[0.10] to-accent/[0.12]"}),r.jsx("div",{className:"absolute inset-0 opacity-[0.06]",style:{backgroundImage:`
                linear-gradient(to right, hsl(var(--ring)/0.35) 1px, transparent 1px),
                linear-gradient(to bottom, hsl(var(--ring)/0.35) 1px, transparent 1px)
              `,backgroundSize:"28px 28px"}})]}),r.jsx("div",{className:"relative z-10 p-4 sm:p-6 md:p-8",children:r.jsxs("div",{className:"grid md:grid-cols-12 gap-6 md:items-center",children:[r.jsxs("div",{className:"md:col-span-7 flex items-start gap-4 min-w-0",children:[r.jsx("div",{className:"text-5xl md:text-6xl leading-none shrink-0",children:l.icon_emoji||"📚"}),r.jsxs("div",{className:"min-w-0",children:[r.jsx("h1",{className:"text-xl md:text-3xl font-bold tracking-tight",children:l.title}),l.description&&r.jsx("p",{className:"mt-2 text-sm md:text-base text-muted-foreground line-clamp-3",children:l.description}),r.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[r.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border bg-background/60 px-3 py-1.5 shadow-soft",children:[r.jsx(Ze,{className:"h-4 w-4"}),r.jsxs("span",{className:"text-sm font-medium",children:["Ukończone:"," ",r.jsx("span",{className:"tabular-nums",children:r.jsx(Ft,{value:o.completedActivities})}),"/",o.totalActivities]})]}),o.progress===100&&r.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-green-600/30 bg-green-500/10 text-green-700 dark:text-green-400 px-3 py-1.5 shadow-soft text-sm font-semibold",children:[r.jsx(Ds,{className:"h-4 w-4"}),"Kurs ukończony"]})]})]})]}),r.jsx("div",{className:"md:col-span-5",children:r.jsxs("div",{className:"rounded-xl border bg-card p-4 md:p-5 shadow-soft",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Postęp kursu"}),r.jsxs("span",{className:"text-sm font-semibold",children:[o.progress,"%"]})]}),r.jsx("div",{className:"mt-2",children:r.jsx(Ki,{value:o.progress})}),r.jsxs("div",{className:"mt-3 flex gap-2",children:[c?r.jsxs("button",{onClick:()=>e(c.path),className:"flex-1 inline-flex items-center justify-center gap-2 rounded-lg bg-primary px-4 py-2 text-primary-foreground hover:bg-primary/90 focus-ring",children:["Kontynuuj",r.jsx(Ue,{className:"h-4 w-4"})]}):r.jsx("button",{disabled:!0,className:"flex-1 rounded-lg border px-4 py-2 text-muted-foreground cursor-default",title:"Brak kolejnej aktywności",children:"Wszystko ukończone"}),r.jsx("button",{onClick:()=>e("/student/courses"),className:"rounded-lg border px-3 py-2 hover:bg-primary/5 focus-ring",title:"Wróć do listy",children:r.jsx(Pe,{className:"h-4 w-4"})})]})]})})]})})]}),r.jsx("div",{className:"space-y-6",children:a.map((u,d)=>r.jsxs(zo,{index:d,className:U("relative rounded-2xl border bg-card p-4 md:p-5 shadow-soft",!u.isUnlocked&&"opacity-60"),children:[r.jsxs("div",{className:"flex items-center justify-between gap-4 mb-3 md:mb-4",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:U("w-10 h-10 rounded-full flex items-center justify-center",u.isCompleted?"bg-green-600 text-white":u.isUnlocked?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground"),"aria-label":u.isCompleted?"Temat ukończony":u.isUnlocked?"Temat odblokowany":"Temat zablokowany",children:u.isCompleted?r.jsx(Ds,{className:"w-5 h-5"}):u.isUnlocked?r.jsx("span",{className:"font-semibold",children:u.position}):r.jsx(Da,{className:"w-4 h-4"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-base md:text-lg font-semibold text-foreground",children:u.title}),r.jsxs("p",{className:"text-sm text-muted-foreground",children:[u.activities.filter(h=>h.completed).length," ","z ",u.activities.length," ukończonych"]})]})]}),r.jsx("div",{className:"hidden md:block w-40",children:r.jsx(Ki,{value:u.activities.length?Math.round(u.activities.filter(h=>h.completed).length/u.activities.length*100):0})})]}),r.jsx("div",{className:"mt-3 md:mt-4 space-y-3",children:u.activities.map(h=>{const f=h.type==="quiz",m=h.type==="quiz"?`/student/courses/${t}/quiz/${h.id}`:`/student/courses/${t}/lesson/${h.id}`;return r.jsxs(lt.button,{whileHover:h.isUnlocked?{x:2}:{},whileTap:h.isUnlocked?{scale:.98}:{},onClick:()=>{h.isUnlocked&&e(m)},disabled:!h.isUnlocked,className:U("w-full flex items-center justify-between p-4 rounded-xl border transition-colors focus-ring",h.isUnlocked?"bg-background/60 hover:bg-primary/5":"bg-muted/40 cursor-not-allowed"),children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:U("w-8 h-8 rounded-lg flex items-center justify-center shrink-0",f?h.isUnlocked?"bg-purple-100":"bg-muted":h.isUnlocked?"bg-blue-100":"bg-muted"),children:h.isUnlocked?f?r.jsx(Vt,{className:"w-4 h-4 text-purple-600"}):r.jsx(Ze,{className:"w-4 h-4 text-blue-600"}):r.jsx(Da,{className:"w-4 h-4 text-muted-foreground"})}),r.jsxs("div",{className:"text-left",children:[r.jsx("div",{className:U("font-medium",h.isUnlocked?"text-foreground":"text-muted-foreground"),children:h.title}),r.jsxs("div",{className:"text-sm text-muted-foreground",children:[f?"Quiz":"Materiał",h.score!==null&&` • ${h.score}%`,!h.isUnlocked&&" • Zablokowane"]})]})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[!h.completed&&h.isUnlocked&&r.jsx("span",{className:"hidden sm:inline text-xs text-muted-foreground",children:"Przejdź"}),h.completed?r.jsx(Ds,{className:"w-5 h-5 text-green-600"}):h.isUnlocked?r.jsx(Ue,{className:"w-5 h-5 text-muted-foreground"}):r.jsx(Da,{className:"w-4 h-4 text-muted-foreground"})]})]},h.id)})})]},u.id))})]}):r.jsxs("div",{className:"container mx-auto px-4 py-12 text-center",children:[r.jsx("div",{className:"text-5xl",children:"🤷‍♂️"}),r.jsx("h2",{className:"mt-3 text-xl font-semibold",children:"Nie znaleziono kursu"}),r.jsx("p",{className:"text-muted-foreground mt-1",children:"Spróbuj wrócić do listy kursów i wybrać ponownie."}),r.jsx("button",{onClick:()=>e("/student/courses"),className:"mt-6 rounded-lg bg-primary px-4 py-2 text-primary-foreground hover:bg-primary/90 focus-ring",children:"Przejdź do kursów"})]})},oQ=[r.jsx(Z,{path:"/courses/:courseId",element:r.jsx(aQ,{})},"course-detail")],Hw=t=>t.toLowerCase().replace(/[^\p{Letter}\p{Number}]+/gu,"-").replace(/(^-|-$)/g,"")||"sekcja",lQ=(t,e)=>{const s=t.split(/\n(?=##\s+)/g);return s.length<=1&&!/^##\s+/.test(t)?[{id:Hw(e||"Sekcja 1"),title:e||"Sekcja 1",content:t}]:s.map((n,i)=>{const o=(n.match(/^##\s+(.+?)\s*$/m)?.[1]||`Sekcja ${i+1}`).trim(),l=n.replace(/^##\s+.+?\n/,"").trim();return{id:Hw(o),title:o,content:l}})},cQ=/```quiz\s*?\n([\s\S]*?)```/g,uQ=(t,e,s)=>{try{const n=Mk.parse(t),i=(n?.options||[]).map(String);return!n?.question||!Array.isArray(n?.options)||typeof n?.answerIndex!="number"||n.answerIndex<0||n.answerIndex>=i.length?null:{question:n.question,options:i,answerIndex:n.answerIndex,key:`${e}:${s}`}}catch{return null}},dQ=t=>new Map(t.map(e=>[e.id,[...e.content.matchAll(cQ)].map((s,n)=>uQ(s[1],e.id,n)).filter(Boolean)])),Gw=(t,e)=>{const[s,n]=ae.useState(()=>{try{const i=localStorage.getItem(t);return i?JSON.parse(i):e}catch{return e}});return ae.useEffect(()=>{try{localStorage.setItem(t,JSON.stringify(s))}catch(i){console.error("Błąd zapisu do localStorage:",i)}},[t,s]),[s,n]},hQ=()=>{const t=ae.useRef(null);return{ref:t,say:s=>{t.current&&(t.current.textContent="",setTimeout(()=>t.current&&(t.current.textContent=s),30))}}},fQ=()=>r.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6",children:[r.jsx("div",{className:"h-5 w-24 rounded bg-muted/60"}),r.jsxs("div",{className:"rounded-2xl border bg-card p-6 shadow-soft animate-pulse",children:[r.jsx("div",{className:"h-6 w-2/3 rounded bg-muted/60 mb-2"}),r.jsx("div",{className:"h-4 w-40 rounded bg-muted/60"})]}),r.jsx("div",{className:"space-y-3",children:Array.from({length:10}).map((t,e)=>r.jsx("div",{className:"h-4 w-full rounded bg-muted/50"},e))}),r.jsx("div",{className:"h-10 w-48 rounded-lg bg-muted/60 ml-auto"})]}),Jw={code:({inline:t,className:e="",children:s,...n})=>{const i=(e||"").toLowerCase();return!t&&i.includes("language-quiz")?null:r.jsx("code",{className:e,...n,children:s})},pre:t=>((Array.isArray(t.children)?t.children[0]:t.children)?.props?.className?.toLowerCase?.()||"").includes("language-quiz")?null:r.jsx("pre",{...t})},mQ=({quiz:t,onClose:e,onPass:s})=>{const[n,i]=ae.useState(null),[a,o]=ae.useState(!1),l=()=>{const c=n!==null&&n===t.answerIndex;o(c),c?(G.success("Poprawna odpowiedź!"),setTimeout(s,200)):G.error("Niepoprawna odpowiedź — spróbuj ponownie.")};return r.jsxs("div",{className:"fixed inset-0 z-[90] flex items-end sm:items-center justify-center",children:[r.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:e}),r.jsxs("div",{className:"relative z-[91] w-full sm:max-w-lg bg-background rounded-t-2xl sm:rounded-2xl border shadow-2xl p-4 sm:p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("h3",{className:"text-base sm:text-lg font-semibold",children:"Pytanie kontrolne"}),r.jsx("button",{onClick:e,className:"p-1 rounded hover:bg-muted","aria-label":"Zamknij",children:r.jsx(fn,{className:"h-5 w-5"})})]}),r.jsx("p",{className:"mb-3 text-sm sm:text-base",children:t.question}),r.jsx("div",{className:"space-y-2 mb-4",children:t.options.map((c,u)=>r.jsxs("label",{className:"flex items-center gap-2 rounded-md border px-3 py-2 cursor-pointer hover:bg-muted",children:[r.jsx("input",{type:"radio",name:"quiz-choice",className:"h-4 w-4",checked:n===u,onChange:()=>i(u),disabled:a}),r.jsx("span",{className:"text-sm",children:c})]},u))}),r.jsxs("div",{className:"flex items-center justify-end gap-2",children:[r.jsx("button",{onClick:e,className:"rounded-lg border px-3 py-1.5 text-sm hover:bg-muted",children:"Anuluj"}),r.jsx("button",{onClick:l,className:"rounded-lg border px-3 py-1.5 text-sm font-medium hover:bg-muted",disabled:a,children:"Zatwierdź"})]})]})]})},pQ=({lessonTitle:t,courseId:e,timeSpent:s,sectionsCount:n,quizzesCompleted:i,pointsEarned:a,nextLessonPath:o})=>{const l=pe(),c=u=>{const d=Math.floor(u/60),h=u%60;return d>0?`${d} min ${h} s`:`${h} s`};return r.jsx(lt.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"fixed inset-0 z-20 flex items-center justify-center p-4 bg-black/50",children:r.jsxs("div",{className:"w-full max-w-md rounded-2xl border bg-card p-6 shadow-2xl",children:[r.jsxs("div",{className:"text-center mb-6",children:[r.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-green-100 dark:bg-green-900/30 mb-4",children:r.jsx(ws,{className:"w-8 h-8 text-green-600"})}),r.jsx("h2",{className:"text-2xl font-bold",children:"Lekcja ukończona! 🎉"}),r.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:t})]}),r.jsxs("div",{className:"rounded-xl bg-primary/10 p-4 mb-6 text-center",children:[r.jsxs("div",{className:"flex items-center justify-center gap-2 text-3xl font-bold text-primary",children:[r.jsx(Vt,{className:"w-6 h-6"}),"+",a," punktów"]}),r.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"za ukończenie materiału"})]}),r.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx(Ze,{className:"w-5 h-5 mx-auto mb-1 text-blue-600"}),r.jsx("p",{className:"text-sm font-medium",children:c(s)}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"Czas nauki"})]}),r.jsxs("div",{className:"text-center",children:[r.jsx(Se,{className:"w-5 h-5 mx-auto mb-1 text-purple-600"}),r.jsx("p",{className:"text-sm font-medium",children:n}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"Sekcji"})]}),r.jsxs("div",{className:"text-center",children:[r.jsx(ft,{className:"w-5 h-5 mx-auto mb-1 text-yellow-600"}),r.jsx("p",{className:"text-sm font-medium",children:i}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"Pytań"})]})]}),r.jsx("div",{className:"flex gap-3",children:o?r.jsxs("button",{onClick:()=>l(o),className:"flex-1 inline-flex items-center justify-center gap-2 rounded-lg bg-primary px-4 py-2.5 text-primary-foreground hover:bg-primary/90",children:["Następna lekcja",r.jsx(Ue,{className:"w-4 h-4"})]}):r.jsx("button",{onClick:()=>l(`/student/courses/${e}`),className:"flex-1 rounded-lg bg-primary px-4 py-2.5 text-primary-foreground hover:bg-primary/90",children:"Wróć do kursu"})})]})})},xQ=()=>{const{courseId:t,lessonId:e}=Qt(),s=pe(),{refetch:n}=ta(),{data:i,isLoading:a}=tt({resource:"activities",id:e,meta:{select:"*, topics(title, course_id, courses(title, icon_emoji))"}}),o=i?.data??{},l=o?.content_md??o?.markdown??o?.content,c=ae.useMemo(()=>l?lQ(l,o?.title??"Sekcja"):[],[l,o?.title]),u=ae.useMemo(()=>dQ(c),[c]),d=`lesson-progress:${e}`,h=`lesson-quiz:${e}`,[f,m]=Gw(d,Object.fromEntries(c.map(E=>[E.id,!1]))),[p,x]=Gw(h,{}),[g,y]=ae.useState(null),[b,w]=ae.useState(!1),[S]=ae.useState(Date.now());ae.useEffect(()=>{if(!e)return;(async()=>{try{const{error:M}=await oe.rpc("start_activity",{p_activity_id:parseInt(e)});M?console.error("Error starting activity timer:",M):console.log("Activity timer started successfully")}catch(M){console.error("Failed to start activity timer:",M)}})()},[e]),ae.useEffect(()=>{c.length&&m(E=>{const M={};return c.forEach(O=>M[O.id]=E[O.id]??!1),M})},[c.map(E=>E.id).join("|")]);const{ref:z,say:N}=hQ(),k=c.findIndex(E=>!f[E.id]),C=k===-1,T=E=>{const[M]=u.get(E)??[];M&&y(M)},v=E=>{const M=c[E];if(!M||!(k===-1||E<=k)&&!f[M.id])return;if(f[M.id]){m(B=>({...B,[M.id]:!1})),N(`Sekcja ${E+1} cofnięta.`);return}(u.get(M.id)??[]).length>0?T(M.id):(m(B=>({...B,[M.id]:!0})),N(`Sekcja ${E+1} odhaczona.`))},_=()=>{const E=g;if(y(null),!E)return;x(R=>({...R,[E.key]:!0}));const M=E.key.split(":")[0];m(R=>({...R,[M]:!0}));const O=c.findIndex(R=>R.id===M);N(`Sekcja ${O+1} odhaczona po pytaniu kontrolnym.`)},A=async()=>{if(!C)return G.info("Najpierw odhacz wszystkie sekcje po kolei.");console.log("Completing lesson...");try{const{data:E,error:M}=await oe.rpc("complete_material",{p_activity_id:parseInt(e)});if(console.log("Complete material result:",E,"Error:",M),M)throw M;if(E){const O=Math.floor((Date.now()-S)/1e3);console.log("Material completed successfully, time spent:",O),w(!0);try{localStorage.removeItem(d),localStorage.removeItem(h)}catch(R){console.error("Błąd zapisu do localStorage:",R)}ul("get_course_structure"),ul("get_my_courses"),setTimeout(()=>{console.log("Forcing stats refresh..."),n()},500),setTimeout(async()=>{console.log("Manually checking updated stats...");const{data:R,error:B}=await oe.rpc("get_my_stats");console.log("New stats after completion:",R,"Error:",B)},1e3)}}catch(E){console.error("Failed to complete lesson:",E),G.error("Nie udało się ukończyć lekcji")}};return r.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-10 pb-28 lg:pb-16",children:[r.jsx("div",{ref:z,"aria-live":"polite",className:"sr-only"}),r.jsxs("button",{onClick:()=>s(`/student/courses/${t}`),className:"flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors",children:[r.jsx(Pe,{className:"w-4 h-4"}),r.jsx("span",{className:"text-sm",children:"Powrót do kursu"})]}),r.jsx("section",{className:"relative overflow-hidden rounded-2xl border bg-white dark:bg-card",children:r.jsx("div",{className:"relative z-10 p-5 sm:p-7 md:p-10",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"text-4xl md:text-5xl leading-none",children:o?.topics?.courses?.icon_emoji||"📚"}),r.jsxs("div",{className:"min-w-0",children:[r.jsxs("div",{className:"text-xs sm:text-sm text-muted-foreground flex items-center gap-2",children:[r.jsx("span",{className:"truncate",children:o?.topics?.courses?.title||"…"}),r.jsx("span",{children:"•"}),r.jsx("span",{className:"truncate",children:o?.topics?.title||"…"})]}),r.jsx("h1",{className:"mt-1 text-xl md:text-3xl font-bold tracking-tight",children:o?.title||"Ładowanie…"}),o?.duration_min&&r.jsxs("div",{className:"mt-3 inline-flex items-center gap-2 rounded-full border bg-white/70 dark:bg-background/60 px-3 py-1.5 shadow-soft",children:[r.jsx(Ze,{className:"h-4 w-4"}),r.jsxs("span",{className:"text-sm font-medium",children:[o?.duration_min," min czytania"]})]})]})]})})}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1fr_280px] gap-10",children:[r.jsx("main",{children:a?r.jsx(fQ,{}):r.jsxs("section",{children:[r.jsx("div",{className:"prose prose-neutral dark:prose-invert max-w-[72ch] mx-auto prose-headings:font-semibold prose-p:text-muted-foreground prose-p:leading-relaxed prose-li:leading-relaxed prose-headings:tracking-tight prose-img:rounded-xl prose-blockquote:rounded-xl md:prose-lg",children:c.length?c.map((E,M)=>{const O=!!f[E.id],R=!O&&M===k,K=!(k===-1||M<=k)&&!O,$=(u.get(E.id)??[])[0],J="rounded-[20px] border p-6 sm:p-7 md:p-8 shadow-sm transition-colors duration-200",ie=O?"bg-emerald-50 dark:bg-emerald-950/25 border-emerald-300":R?"bg-white dark:bg-background border-neutral-200 shadow-md":K?"bg-white dark:bg-card border-dashed border-muted-foreground/40":"bg-white dark:bg-card border-neutral-200",W=!O&&K?"filter blur-[2px] select-none pointer-events-none":"";return r.jsxs("div",{id:E.id,className:"mb-12 scroll-mt-28",children:[r.jsxs("div",{className:`${J} ${ie}`,children:[r.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-3",children:[K&&r.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border px-2.5 py-0.5 text-[11px] text-muted-foreground bg-white",children:[r.jsx(Da,{className:"h-3.5 w-3.5"}),"Zablokowana"]}),O&&r.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-emerald-300/60 bg-emerald-50/60 px-2.5 py-0.5 text-[11px] text-emerald-700 dark:text-emerald-300",children:[r.jsx(Ds,{className:"h-3.5 w-3.5"}),"Ukończona"]}),R&&!O&&r.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border bg-white px-2.5 py-0.5 text-[11px]",children:[r.jsx(Jo,{className:"h-3.5 w-3.5"}),"W trakcie"]}),$&&r.jsxs("button",{type:"button",onClick:()=>!O&&!K&&T(E.id),disabled:O||K,className:["inline-flex items-center gap-1 rounded-full border px-2.5 py-0.5 text-[11px]",O?"text-emerald-700 border-emerald-300/60 bg-emerald-50/60 dark:bg-emerald-950/25":K?"text-muted-foreground cursor-not-allowed bg-white dark:bg-background/40":"bg-white hover:bg-muted"].join(" "),title:O?"Pytanie rozwiązane":K?"Najpierw odblokuj sekcję":"Kliknij, aby odpowiedzieć","aria-label":"Pytanie kontrolne",children:[r.jsx(dt,{className:"h-3.5 w-3.5"}),$.question.length>72?$.question.slice(0,69)+"…":$.question]})]}),r.jsxs("div",{className:W,children:[r.jsx("h2",{className:"text-[22px] md:text-[26px] font-semibold tracking-tight m-0 mb-4",children:E.title||`Sekcja ${M+1}`}),r.jsx(Va,{remarkPlugins:[Ga],components:Jw,children:E.content})]}),r.jsx("div",{className:"mt-6 flex justify-end",children:r.jsxs("label",{className:["inline-flex items-center gap-3",K?"cursor-not-allowed opacity-60":"cursor-pointer"].join(" "),title:K?"Najpierw ukończ poprzednie sekcje":O?"Sekcja odhaczona — klik, aby cofnąć":$?"Kliknij, aby odpowiedzieć na pytanie":"Odhacz sekcję",children:[r.jsx("input",{type:"checkbox",className:"sr-only",checked:O,onChange:()=>!K&&v(M),disabled:K&&!O,"aria-label":`Odhacz sekcję: ${E.title||`Sekcja ${M+1}`}`}),r.jsx("span",{className:["inline-flex items-center gap-2 rounded-lg border px-3 py-2 text-sm font-medium shadow-soft transition-all",O?"bg-emerald-50/70 dark:bg-emerald-950/30 border-emerald-300/60 text-emerald-700 dark:text-emerald-300":"bg-white hover:bg-muted border-neutral-200"].join(" "),children:$&&!O?r.jsx("span",{className:"truncate max-w-[56ch]",children:$.question}):r.jsxs(r.Fragment,{children:[O?r.jsx(Ds,{className:"h-4 w-4"}):r.jsx(Jo,{className:"h-4 w-4"}),r.jsxs("span",{className:"whitespace-nowrap",children:[String(M+1).padStart(2,"0")," • ",O?"Odhaczono":$?"Odhacz (pytanie)":"Odhacz sekcję"]})]})})]})})]}),r.jsx("div",{className:"h-8"})]},E.id)}):l?r.jsx(Va,{remarkPlugins:[Ga],components:Jw,children:l}):r.jsx("div",{dangerouslySetInnerHTML:{__html:o?.content||""}})}),!!c.length&&r.jsx("div",{className:"mt-10 flex justify-end",children:r.jsx("button",{onClick:A,className:"inline-flex items-center gap-2 rounded-lg border bg-white px-4 py-2 text-sm font-medium shadow-soft hover:bg-muted transition-colors disabled:opacity-60",disabled:!C,title:C?void 0:"Najpierw odhacz wszystkie sekcje",children:"Zakończ lekcję"})})]})}),r.jsx("aside",{children:r.jsxs("nav",{className:"border rounded-[14px] p-4 bg-white dark:bg-background/60 lg:sticky lg:top-28",children:[r.jsx("h2",{className:"text-sm font-semibold mb-3",children:"Spis treści"}),a?r.jsx("div",{className:"h-4 w-40 rounded bg-muted/60 animate-pulse"}):c.length?r.jsx("ol",{className:"space-y-1.5 text-sm",children:c.map((E,M)=>{const O=!!f[E.id],R=!O&&M===k,K=!(k===-1||M<=k)&&!O,$=()=>{K||document.getElementById(E.id)?.scrollIntoView({behavior:"smooth"})};return r.jsxs("li",{className:"flex items-center gap-1.5",children:[K?r.jsx(Da,{className:"h-3.5 w-3.5 text-muted-foreground"}):O?r.jsx(Ds,{className:"h-3.5 w-3.5 text-emerald-600"}):r.jsx(Jo,{className:"h-3.5 w-3.5"}),r.jsxs("button",{onClick:$,className:["flex-1 text-left px-2 py-1 rounded transition-colors",K?"text-muted-foreground cursor-not-allowed":"hover:bg-muted",O?"text-emerald-700":"",R?"font-semibold underline":""].join(" "),disabled:K,children:[String(M+1).padStart(2,"0"),". ",E.title||`Sekcja ${M+1}`]})]},E.id)})}):r.jsx("p",{className:"text-sm text-muted-foreground",children:"Brak sekcji."})]})})]}),g&&r.jsx(mQ,{quiz:g,onClose:()=>y(null),onPass:_}),b&&r.jsx(pQ,{lessonTitle:o?.title||"Lekcja",courseId:t,timeSpent:Math.floor((Date.now()-S)/1e3),sectionsCount:c.length,quizzesCompleted:Object.keys(p).length,pointsEarned:5,nextLessonPath:void 0})]})},gQ=[r.jsx(Z,{path:"/courses/:courseId/lesson/:lessonId",element:r.jsx(xQ,{})},"lesson-view")],yQ=()=>{const{courseId:t,quizId:e}=Qt(),s=pe(),{refetch:n}=ta(),[i,a]=ae.useState(0),[o,l]=ae.useState({}),[c,u]=ae.useState(null),[d,h]=ae.useState(!1),[f,m]=ae.useState([]),[p,x]=ae.useState(!0),{data:g,isLoading:y}=tt({resource:"activities",id:e,meta:{select:"*, topics(title, course_id, courses(title, icon_emoji))"}});ae.useEffect(()=>{(async()=>{if(e)try{await oe.rpc("start_activity",{p_activity_id:parseInt(e)}),x(!0);const{data:O,error:R}=await oe.rpc("get_quiz_questions",{p_activity_id:parseInt(e)});if(R)throw R;const B=typeof O=="string"?JSON.parse(O):O;m(Array.isArray(B)?B:[])}catch(O){console.error("Quiz init error:",O),G.error("Błąd podczas ładowania quizu")}finally{x(!1)}})()},[e]),ae.useEffect(()=>{g?.data?.time_limit&&c===null&&u(g.data.time_limit*60)},[g]),ae.useEffect(()=>{if(c!==null&&c>0){const M=setTimeout(()=>u(c-1),1e3);return()=>clearTimeout(M)}else c===0&&C()},[c]);const b=g?.data,w=f[i],S=f.length>0?(i+1)/f.length*100:0,z=M=>{if(M.type)switch(M.type){case"single_choice":return"single";case"multiple_choice":return"multiple";case"true_false":return"true_false"}return"single"},N=M=>{switch(M){case"single":return{label:"Jednokrotny wybór",icon:ws};case"multiple":return{label:"Wielokrotny wybór",icon:qr};case"true_false":return{label:"Prawda/Fałsz",icon:st}}},k=(M,O,R)=>{if(R){const B=o[M]||[],K=B.includes(O)?B.filter($=>$!==O):[...B,O];l($=>({...$,[M]:K}))}else l(B=>({...B,[M]:O}))},C=async()=>{h(!0);try{const M=Object.entries(o).flatMap(([B,K])=>Array.isArray(K)?K.map($=>({question_id:parseInt(B),option_id:$})):[{question_id:parseInt(B),option_id:K}]);console.log("Submitting quiz answers:",M);const{data:O,error:R}=await oe.rpc("finish_quiz",{p_activity_id:parseInt(e),p_answers:M});if(R)throw R;O&&(console.log("Quiz finished successfully:",O),ul("get_course_structure"),ul("get_my_courses"),ul("get_my_stats"),setTimeout(()=>{console.log("Forcing stats refresh..."),n()},500),s(`/student/courses/${t}/quiz/${e}/result`,{state:{courseId:t,quizId:e,result:{...O,passing_score:b?.passing_score||70,max_attempts:b?.max_attempts,attempts_used:b?.attempts||1}}}))}catch(M){console.error("Failed to submit quiz:",M),G.error("Nie udało się przesłać odpowiedzi")}finally{h(!1)}};if(y||p)return r.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});if(!w)return null;const T=z(w),v=N(T),_=T==="multiple",A=o[w.id],E=_?Array.isArray(A)&&A.length>0:A!==void 0;return r.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 max-w-3xl",children:[r.jsxs("div",{className:"flex items-center justify-between mb-8",children:[r.jsxs("button",{onClick:()=>s(`/student/courses/${t}`),className:"flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors",children:[r.jsx(Pe,{className:"w-4 h-4"}),r.jsx("span",{className:"text-sm",children:"Zakończ quiz"})]}),c!==null&&r.jsxs("div",{className:U("flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium",c<60?"bg-red-100 text-red-700":"bg-muted text-foreground"),children:[r.jsx(Ze,{className:"w-4 h-4"}),Math.floor(c/60),":",String(c%60).padStart(2,"0")]})]}),r.jsxs("div",{className:"mb-8",children:[r.jsx("h1",{className:"text-2xl font-bold mb-2",children:b?.title}),r.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[r.jsxs("span",{children:["Pytanie ",i+1," z ",f.length]}),r.jsx("span",{children:"•"}),r.jsxs("span",{children:[w.points," pkt"]}),r.jsx("span",{children:"•"}),r.jsxs(V,{variant:"outline",className:"text-xs",children:[r.jsx(v.icon,{className:"w-3 h-3 mr-1"}),v.label]})]})]}),r.jsx("div",{className:"h-1 bg-muted rounded-full overflow-hidden mb-8",children:r.jsx(lt.div,{initial:{width:0},animate:{width:`${S}%`},className:"h-full bg-primary"})}),r.jsx(xG,{mode:"wait",children:r.jsx(lt.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},transition:{duration:.2},children:r.jsxs("div",{className:"bg-card rounded-2xl border p-8 mb-8",children:[r.jsx("h2",{className:"text-lg font-medium mb-6",children:w.question}),_&&r.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"⚠️ Zaznacz wszystkie poprawne odpowiedzi"}),r.jsx("div",{className:"space-y-3",children:w.options.map(M=>{const O=_?Array.isArray(A)&&A.includes(M.id):A===M.id;return r.jsx("label",{className:U("block p-4 rounded-xl border-2 cursor-pointer transition-all",O?"border-primary bg-primary/5":"border-border hover:border-muted-foreground"),children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("input",{type:_?"checkbox":"radio",name:`question-${w.id}`,value:M.id,checked:O,onChange:()=>k(w.id,M.id,_),className:"sr-only"}),r.jsxs("div",{className:U("flex items-center justify-center flex-shrink-0",_?U("w-5 h-5 rounded border-2",O?"border-primary bg-primary text-primary-foreground":"border-muted-foreground"):U("w-5 h-5 rounded-full border-2",O?"border-primary":"border-muted-foreground")),children:[_&&O&&r.jsx(Ds,{className:"w-3 h-3"}),!_&&O&&r.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-primary"})]}),r.jsx("span",{className:"flex-1",children:M.text})]})},M.id)})})]})},w.id)}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("button",{onClick:()=>a(Math.max(0,i-1)),disabled:i===0,className:U("flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all",i===0?"text-muted-foreground cursor-not-allowed":"text-foreground hover:bg-muted"),children:[r.jsx(Pe,{className:"w-4 h-4"}),"Poprzednie"]}),r.jsx("div",{className:"flex gap-2",children:f.map((M,O)=>{const R=o[f[O]?.id],B=Array.isArray(R)?R.length>0:R!==void 0;return r.jsx("button",{onClick:()=>a(O),className:U("w-2 h-2 rounded-full transition-all",O===i?"bg-primary w-8":B?"bg-muted-foreground":"bg-muted")},O)})}),i<f.length-1?r.jsxs("button",{onClick:()=>a(i+1),disabled:!E,className:U("flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all",E?"bg-primary text-primary-foreground hover:bg-primary/90":"bg-muted text-muted-foreground cursor-not-allowed"),children:["Następne",r.jsx(Ue,{className:"w-4 h-4"})]}):r.jsxs("button",{onClick:C,disabled:d||Object.keys(o).length<f.length,className:U("flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all",d||Object.keys(o).length<f.length?"bg-muted text-muted-foreground cursor-not-allowed":"bg-green-500 text-white hover:bg-green-600"),children:[d?"Przesyłanie...":"Zakończ quiz",r.jsx(Ds,{className:"w-4 h-4"})]})]})]})},bQ=()=>{const t=pe(),e=gn(),{courseId:s,quizId:n,result:i}=e.state,a=b=>{const w=Math.floor(b/60),S=b%60;return`${w}:${String(S).padStart(2,"0")}`},o=b=>b>=90?"text-green-600":b>=70?"text-yellow-600":"text-red-600",l=b=>b<30?1:b<50?2:b<70?5:10+Math.floor((b-70)/3),c=i.max_attempts&&(i.attempts_used??0)<i.max_attempts,u=i.score===100,d=i.user_points||0,h=i.next_level_points||((i.user_level||1)+1)*100,f=d%100,m=h-d,p=f/100*100,x=i.question_results?.filter(b=>b.is_correct).length||0,g=i.question_results?.length||0,y=g-x;return r.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-3xl",children:[r.jsxs(lt.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.3},className:"space-y-6",children:[r.jsx(P,{children:r.jsxs(I,{className:"pt-6",children:[r.jsxs("div",{className:"text-center mb-6",children:[r.jsx("div",{className:U("inline-flex items-center justify-center w-16 h-16 rounded-full mb-4",i.passed?"bg-green-100":"bg-orange-100"),children:r.jsx(ft,{className:U("w-8 h-8",i.passed?"text-green-600":"text-orange-600")})}),r.jsx("h1",{className:"text-2xl font-bold mb-2",children:i.passed?"Quiz zaliczony!":"Niezaliczone, ale zdobywasz punkty!"}),r.jsx("p",{className:"text-muted-foreground",children:i.passed?u?"Perfekcyjny wynik! Jesteś mistrzem!":"Gratulacje! Świetnie Ci poszło.":`Zdobywasz ${i.points_earned} punktów za swoją próbę!`})]}),r.jsx("div",{className:"bg-muted/50 rounded-xl p-6 mb-6",children:r.jsxs("div",{className:"text-center",children:[r.jsxs("div",{className:U("text-5xl font-bold mb-2",o(i.score)),children:[i.score,"%"]}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"Twój wynik"})]})}),r.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[r.jsx(Vt,{className:"w-4 h-4 text-yellow-600"}),r.jsx("span",{className:"font-semibold text-lg",children:i.points_earned})]}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"Punktów zdobytych"})]}),r.jsxs("div",{className:"text-center",children:[r.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[r.jsx(Ze,{className:"w-4 h-4 text-blue-600"}),r.jsx("span",{className:"font-semibold",children:a(i.time_spent)})]}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"Czas"})]}),r.jsxs("div",{className:"text-center",children:[r.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[r.jsx(pt,{className:"w-4 h-4 text-purple-600"}),r.jsxs("span",{className:"font-semibold",children:[i.passing_score,"%"]})]}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"Próg zaliczenia"})]})]})]})}),r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{className:"text-lg flex items-center gap-2",children:[r.jsx(Vr,{className:"w-5 h-5"}),"Postęp poziomu"]})}),r.jsx(I,{children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex justify-between items-center text-sm",children:[r.jsxs("span",{className:"font-medium",children:["Poziom ",i.user_level||1]}),r.jsxs("span",{className:"text-muted-foreground",children:[d," / ",h," punktów"]}),r.jsxs("span",{className:"font-medium",children:["Poziom ",(i.user_level||1)+1]})]}),r.jsx(un,{value:p,className:"h-3"}),r.jsxs("div",{className:"text-center",children:[r.jsxs("p",{className:"text-sm text-muted-foreground",children:["Do następnego poziomu pozostało:",r.jsxs("span",{className:"font-semibold text-foreground ml-1",children:[m," punktów"]})]}),i.points_earned>0&&r.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:["+",i.points_earned," punktów z tego quizu!"]})]})]})})]}),i.question_results&&i.question_results.length>0&&r.jsxs(P,{children:[r.jsx(F,{children:r.jsxs(L,{className:"text-lg flex items-center justify-between",children:[r.jsx("span",{children:"Analiza odpowiedzi"}),r.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[r.jsxs("span",{className:"flex items-center gap-1 text-green-600",children:[r.jsx(ws,{className:"w-4 h-4"}),x]}),r.jsxs("span",{className:"flex items-center gap-1 text-red-600",children:[r.jsx(Nu,{className:"w-4 h-4"}),y]})]})]})}),r.jsxs(I,{children:[r.jsx("div",{className:"space-y-3",children:i.question_results.map((b,w)=>r.jsx(lt.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:w*.05},className:U("p-4 rounded-lg border transition-all",b.is_correct?"bg-green-50 dark:bg-green-950/30 border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-950/30 border-red-200 dark:border-red-800"),children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"flex-shrink-0 mt-0.5",children:b.is_correct?r.jsx(ws,{className:"w-5 h-5 text-green-600"}):r.jsx(Nu,{className:"w-5 h-5 text-red-600"})}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsxs("h4",{className:"font-medium text-sm",children:["Pytanie ",w+1]}),r.jsxs("span",{className:U("text-sm font-semibold",b.is_correct?"text-green-600":"text-red-600"),children:[b.is_correct?`+${b.points}`:"0"," pkt"]})]}),r.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:b.question_text}),r.jsxs("div",{className:"space-y-2 text-xs",children:[r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"text-muted-foreground min-w-[120px]",children:"Twoja odpowiedź:"}),r.jsx("span",{className:U("font-medium flex-1",b.is_correct?"text-green-700 dark:text-green-400":"text-red-700 dark:text-red-400"),children:Array.isArray(b.your_answer)?b.your_answer.join(", "):b.your_answer||"Brak odpowiedzi"})]}),!b.is_correct&&r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"text-muted-foreground min-w-[120px]",children:"Poprawna odpowiedź:"}),r.jsx("span",{className:"font-medium text-green-700 dark:text-green-400 flex-1",children:Array.isArray(b.correct_answer)?b.correct_answer.join(", "):b.correct_answer})]})]})]})]})},b.question_id))}),r.jsxs("div",{className:"mt-6 p-4 bg-muted/50 rounded-lg",children:[r.jsxs("div",{className:"flex items-center justify-between text-sm",children:[r.jsx("span",{className:"text-muted-foreground",children:"Skuteczność:"}),r.jsx("span",{className:"font-semibold",children:g>0?`${Math.round(x/g*100)}%`:"0%"})]}),r.jsxs("div",{className:"flex items-center justify-between text-sm mt-1",children:[r.jsx("span",{className:"text-muted-foreground",children:"Zdobyte punkty:"}),r.jsxs("span",{className:"font-semibold",children:[i.question_results.filter(b=>b.is_correct).reduce((b,w)=>b+w.points,0)," / ",i.question_results.reduce((b,w)=>b+w.points,0)]})]})]})]})]}),r.jsxs(P,{className:U(i.points_earned>0?"border-primary/50":""),children:[r.jsx(F,{children:r.jsxs(L,{className:"text-lg flex items-center gap-2",children:[r.jsx(Et,{className:"w-5 h-5"}),"Jak obliczyliśmy Twoje punkty"]})}),r.jsxs(I,{children:[r.jsxs("div",{className:"space-y-2 text-sm",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsxs("span",{className:"text-muted-foreground",children:["Punkty bazowe za wynik ",i.score,"%:"]}),r.jsxs("span",{className:"font-medium tabular-nums",children:[i.base_points||l(i.score)," pkt"]})]}),i.multipliers?.quiz_multiplier&&i.multipliers.quiz_multiplier>1&&r.jsxs("div",{className:"flex justify-between items-center text-green-600 dark:text-green-400",children:[r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx(ri,{className:"w-3 h-3"}),'Ulepszenie "Szybki umysł":']}),r.jsxs("span",{className:"font-medium",children:["×",i.multipliers.quiz_multiplier]})]}),i.streak_days&&i.streak_days>0&&i.multipliers?.streak_multiplier&&r.jsxs("div",{className:"flex justify-between items-center text-orange-600 dark:text-orange-400",children:[r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx(An,{className:"w-3 h-3"}),"Streak ",i.streak_days," dni:"]}),r.jsxs("span",{className:"font-medium",children:["×",i.multipliers.streak_multiplier.toFixed(1)]})]}),u&&i.perfect_bonus&&i.perfect_bonus>0&&r.jsxs("div",{className:"flex justify-between items-center text-purple-600 dark:text-purple-400",children:[r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx(Y_,{className:"w-3 h-3"}),"Bonus perfekcjonisty:"]}),r.jsxs("span",{className:"font-medium",children:["+",i.perfect_bonus," pkt"]})]}),i.multipliers?.min_points&&i.score<30&&r.jsxs("div",{className:"flex justify-between items-center text-blue-600 dark:text-blue-400",children:[r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx(yl,{className:"w-3 h-3"}),'Gwarancja "Druga szansa":']}),r.jsxs("span",{className:"font-medium",children:["min. ",i.multipliers.min_points," pkt"]})]}),r.jsx("div",{className:"pt-2 mt-2 border-t border-border/50",children:r.jsxs("div",{className:"flex justify-between items-center font-semibold",children:[r.jsx("span",{children:"Łącznie zdobywasz:"}),r.jsxs("span",{className:"text-lg text-primary",children:[i.points_earned," punktów"]})]})})]}),(!i.multipliers?.quiz_multiplier||i.multipliers.quiz_multiplier===1)&&r.jsx("div",{className:"mt-3 p-2 bg-amber-50 dark:bg-amber-900/20 rounded-md",children:r.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-400 flex items-center gap-1",children:[r.jsx(st,{className:"w-3 h-3 flex-shrink-0"}),"Wskazówka: Kup ulepszenia w zakładce Idle aby zwiększyć punkty z quizów!"]})})]})]}),!i.passed&&r.jsx(P,{className:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800",children:r.jsxs(I,{className:"pt-6",children:[r.jsx("h4",{className:"font-medium text-sm mb-1 text-blue-700 dark:text-blue-400",children:"Nie poddawaj się! 💪"}),r.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-300",children:i.score>=60?`Świetnie Ci idzie! Brakuje tylko ${i.passing_score-i.score}% do zaliczenia.`:i.score>=40?"Już prawie połowa! Przejrzyj materiały i spróbuj ponownie.":"Każda próba to krok naprzód. Wróć do materiałów i próbuj dalej!"})]})}),r.jsxs("div",{className:"flex gap-3",children:[i.passed?r.jsxs("button",{onClick:()=>t(`/student/courses/${s}`),className:"flex-1 inline-flex items-center justify-center gap-2 rounded-lg bg-primary px-4 py-2.5 text-primary-foreground hover:bg-primary/90 focus-ring",children:["Kontynuuj kurs",r.jsx(Ue,{className:"w-4 h-4"})]}):r.jsx(r.Fragment,{children:c?r.jsxs("button",{onClick:()=>t(`/student/courses/${s}/quiz/${n}`),className:"flex-1 inline-flex items-center justify-center gap-2 rounded-lg bg-primary px-4 py-2.5 text-primary-foreground hover:bg-primary/90 focus-ring",children:[r.jsx(yl,{className:"w-4 h-4"}),"Spróbuj ponownie"]}):r.jsx("button",{onClick:()=>t(`/student/courses/${s}`),className:"flex-1 rounded-lg border px-4 py-2.5 hover:bg-muted/50 focus-ring",children:"Wróć do kursu"})}),r.jsx("button",{onClick:()=>t("/student/dashboard"),className:"px-4 py-2.5 rounded-lg border hover:bg-muted/50 focus-ring",children:"Dashboard"})]}),i.max_attempts&&r.jsxs("p",{className:"text-center text-xs text-muted-foreground",children:["Wykorzystane próby: ",i.attempts_used," z ",i.max_attempts]})]}),u&&r.jsx(lt.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.5},className:"mt-4 text-center",children:r.jsx("p",{className:"text-sm text-muted-foreground",children:"🎯 Mistrzostwo! Twoja wiedza jest imponująca!"})})]})},jQ=[r.jsx(Z,{path:"/courses/:courseId/quiz/:quizId",element:r.jsx(yQ,{})},"quiz-take"),r.jsx(Z,{path:"/courses/:courseId/quiz/:quizId/result",element:r.jsx(bQ,{})},"quiz-result")],wQ={"⚡":Vt,"🚀":Yp,"🧠":ri,"☕":eA,"📚":X_},vQ=()=>r.jsxs("div",{className:"rounded-2xl border bg-card p-6 shadow-soft animate-pulse",children:[r.jsxs("div",{className:"flex items-start justify-between mb-4",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-12 h-12 rounded-xl bg-muted/70"}),r.jsxs("div",{children:[r.jsx("div",{className:"h-4 w-40 rounded bg-muted/70"}),r.jsx("div",{className:"mt-2 h-3 w-24 rounded bg-muted/60"})]})]}),r.jsx("div",{className:"h-5 w-16 rounded-full bg-muted/60"})]}),r.jsxs("div",{className:"space-y-3 mb-4",children:[r.jsx("div",{className:"h-3 w-full rounded bg-muted/60"}),r.jsx("div",{className:"h-3 w-2/3 rounded bg-muted/60"})]}),r.jsx("div",{className:"h-10 w-full rounded-lg bg-muted/60"})]}),kQ=()=>{const{stats:t,refetch:e}=ta(),{data:s,isLoading:n,refetch:i}=bc("get_idle_upgrades"),a=async l=>{try{const{data:c,error:u}=await oe.rpc("buy_idle_upgrade",{p_upgrade_id:l});if(u)throw u;c&&(G.success(`Ulepszenie zakupione! Poziom ${c.new_level}`),e(),i())}catch{G.error("Niewystarczająca ilość punktów")}},o=s||[];return r.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8 pb-24 lg:pb-8",children:[r.jsxs(lt.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.45},className:"relative overflow-hidden rounded-2xl border",children:[r.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/[0.12] via-secondary/[0.10] to-accent/[0.12]"}),r.jsx("div",{className:"absolute inset-0 opacity-[0.06]",style:{backgroundImage:`
                linear-gradient(to right, hsl(var(--ring)/0.35) 1px, transparent 1px),
                linear-gradient(to bottom, hsl(var(--ring)/0.35) 1px, transparent 1px)
              `,backgroundSize:"28px 28px"}})]}),r.jsx("div",{className:"relative z-10 p-4 sm:p-6 md:p-8",children:r.jsxs("div",{className:"grid gap-4 md:grid-cols-12 md:items-center",children:[r.jsxs("div",{className:"md:col-span-4 space-y-2",children:[r.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Ulepszenia"}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"Inwestuj punkty, aby zwiększyć tempo zdobywania kolejnych."})]}),r.jsxs("div",{className:"md:col-span-8 grid grid-cols-3 gap-4 md:gap-6",children:[r.jsxs("div",{className:"rounded-xl border bg-card p-5 shadow-soft",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Punkty / h"}),r.jsx(Et,{className:"h-4 w-4 text-accent"})]}),r.jsx("div",{className:"mt-2 flex items-end gap-2",children:r.jsx("span",{className:"text-4xl md:text-5xl font-semibold text-accent leading-none tabular-nums",children:r.jsx(Ft,{value:t.idle_rate})})}),r.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Premia za obecność."})]}),r.jsxs("div",{className:"rounded-xl border bg-card p-5 shadow-soft",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Twoje punkty"}),r.jsx(Vt,{className:"h-4 w-4 text-primary"})]}),r.jsxs("div",{className:"mt-2 flex items-end gap-2",children:[r.jsx("span",{className:"text-4xl md:text-5xl font-semibold text-primary leading-none tabular-nums",children:r.jsx(Ft,{value:t.points})}),r.jsx("span",{className:"mb-[2px] text-sm text-muted-foreground",children:"pkt"})]}),r.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Wydaj je na ulepszenia poniżej."})]}),r.jsxs("div",{className:"rounded-xl border bg-card p-5 shadow-soft",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Do kolejnego poziomu"}),r.jsx(Yp,{className:"h-4 w-4 text-secondary"})]}),r.jsx("div",{className:"mt-3",children:r.jsx(Ki,{value:t.points%100})}),r.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:["Pozostało ",100-t.points%100," pkt"]})]})]})]})})]}),r.jsxs(lt.section,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.4,delay:.05},className:"space-y-4",children:[r.jsx("div",{className:"flex items-center justify-between gap-4",children:r.jsxs("div",{className:"min-w-0",children:[r.jsx("h3",{className:"text-lg sm:text-xl md:text-2xl font-semibold tracking-tight",children:"Dostępne ulepszenia"}),r.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Wybierz i zwiększ swoje tempo zdobywania punktów."})]})}),r.jsxs("div",{className:"grid md:grid-cols-2 gap-4 sm:gap-5",children:[n&&Array.from({length:6}).map((l,c)=>r.jsx(vQ,{},c)),!n&&o.map((l,c)=>{const u=t.points>=l.next_cost,d=wQ[l.icon]||Vt;return r.jsxs(zo,{index:c,className:U("group relative rounded-2xl border bg-card p-5 shadow-soft hover:bg-muted/40 transition-colors"),children:[r.jsxs("div",{className:"flex items-start justify-between gap-3",children:[r.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[r.jsx("div",{className:"w-12 h-12 rounded-xl bg-muted flex items-center justify-center shrink-0",children:r.jsx(d,{className:"w-6 h-6 text-muted-foreground"})}),r.jsxs("div",{className:"min-w-0",children:[r.jsx("h4",{className:"font-semibold text-sm sm:text-base text-foreground line-clamp-2",children:l.name}),r.jsxs("p",{className:"text-xs text-muted-foreground",children:["Poziom ",l.current_level]})]})]}),r.jsx("span",{className:U("inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-[11px] font-semibold border",u?"border-primary/30 text-primary":"border-muted-foreground/25 text-muted-foreground"),children:u?"Dostępne":"Za drogie"})]}),r.jsxs("div",{className:"mt-4 space-y-3",children:[r.jsxs("div",{className:"flex justify-between text-xs sm:text-sm",children:[r.jsx("span",{className:"text-muted-foreground",children:"Aktualny bonus"}),r.jsxs("span",{className:"font-medium text-green-600 dark:text-green-400",children:["+",r.jsx(Ft,{value:l.total_bonus})," pkt/h"]})]}),r.jsxs("div",{className:"flex justify-between text-xs sm:text-sm",children:[r.jsx("span",{className:"text-muted-foreground",children:"Następny poziom"}),r.jsxs("span",{className:"font-medium",children:["+",l.bonus_per_level," pkt/h"]})]})]}),r.jsxs(lt.button,{whileHover:u?{scale:1.02}:{},whileTap:u?{scale:.98}:{},onClick:()=>a(l.id),disabled:!u,className:U("mt-4 w-full py-2.5 sm:py-3 rounded-lg font-medium focus-ring transition-colors",u?"bg-primary text-primary-foreground hover:bg-primary/90":"bg-muted text-muted-foreground cursor-not-allowed"),title:u?"Kup ulepszenie":"Brakuje punktów",children:["Ulepsz za ",r.jsx(Ft,{value:l.next_cost})," pkt"]})]},l.id)})]})]})]})},NQ=[r.jsx(Z,{path:"/gamification",element:r.jsx(kQ,{})},"gamification")],SQ=()=>r.jsx("div",{className:"rounded-2xl border bg-card p-4 shadow-soft animate-pulse",children:r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"w-8 h-5 rounded bg-muted/60"}),r.jsx("div",{className:"w-10 h-10 rounded-full bg-muted/70"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"h-4 w-40 rounded bg-muted/60"}),r.jsx("div",{className:"mt-2 h-3 w-28 rounded bg-muted/50"})]}),r.jsx("div",{className:"h-5 w-16 rounded bg-muted/60"})]})}),CQ=()=>{const{data:t}=wt(),[e,s]=ae.useState("all"),{data:n,isLoading:i,refetch:a,error:o}=bc("get_leaderboard",{p_limit:20,p_filter:e});ae.useEffect(()=>{let u=!1,d=!1;return(async()=>{if(!(u||d)){d=!0;try{await a()}finally{d=!1}}})(),()=>{u=!0}},[e]);const l=n||[],c=u=>{switch(u){case 1:return r.jsx(ft,{className:"w-5 h-5 text-yellow-500"});case 2:return r.jsx(B1,{className:"w-5 h-5 text-gray-400"});case 3:return r.jsx(Os,{className:"w-5 h-5 text-orange-500"});default:return r.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:u})}};return r.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8 pb-24 lg:pb-8",children:[r.jsxs(lt.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.45},className:"relative overflow-hidden rounded-2xl border",children:[r.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/[0.12] via-secondary/[0.10] to-accent/[0.12]"}),r.jsx("div",{className:"absolute inset-0 opacity-[0.06]",style:{backgroundImage:`
                linear-gradient(to right, hsl(var(--ring)/0.35) 1px, transparent 1px),
                linear-gradient(to bottom, hsl(var(--ring)/0.35) 1px, transparent 1px)
              `,backgroundSize:"28px 28px"}})]}),r.jsx("div",{className:"relative z-10 p-4 sm:p-6 md:p-8",children:r.jsxs("div",{className:"flex flex-col md:flex-row md:items-end md:justify-between gap-4",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Ranking"}),r.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Top 20 użytkowników według punktów."})]}),r.jsx("div",{className:"bg-muted rounded-lg p-1 inline-flex gap-1",children:[{value:"all",label:"Wszyscy"},{value:"students",label:"Uczniowie"},{value:"teachers",label:"Nauczyciele"}].map(u=>r.jsx("button",{onClick:()=>s(u.value),className:U("px-3 sm:px-4 py-1.5 rounded-md text-sm font-medium transition-colors",e===u.value?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:u.label},u.value))})]})})]}),r.jsxs(lt.section,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.4,delay:.05},className:"space-y-2",children:[i&&Array.from({length:4}).map((u,d)=>r.jsx(SQ,{},d)),!i&&(o||l.length===0)&&r.jsxs("div",{className:"rounded-2xl border bg-card p-8 text-center shadow-soft",children:[r.jsx("div",{className:"text-4xl",children:"🥲"}),r.jsx("h4",{className:"mt-3 text-base sm:text-lg font-semibold",children:"Brak wyników"}),r.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:o?"Nie udało się pobrać rankingu.":"Brak danych dla wybranego filtra."}),r.jsxs("button",{onClick:()=>a(),className:"mt-4 inline-flex items-center gap-2 rounded-lg border px-3 py-2 text-sm hover:bg-primary/5 focus-ring",children:[r.jsx(Qp,{className:"w-4 h-4"}),"Spróbuj ponownie"]})]}),!i&&l.length>0&&l.map((u,d)=>{const h=u.user_id===t?.id,f=u.rank<=3;return r.jsxs(zo,{index:d,className:U("flex items-center gap-4 p-4 rounded-2xl border shadow-soft transition-colors",h?"bg-primary text-primary-foreground border-primary/40":f?"bg-muted/50 border-border":"bg-card hover:bg-muted/40 border-border"),children:[r.jsx("div",{className:"w-8 flex justify-center",children:c(u.rank)}),r.jsx("div",{className:U("w-10 h-10 rounded-full flex items-center justify-center font-semibold shrink-0",h?"bg-primary-foreground text-primary":f?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground"),"aria-label":`Avatar użytkownika ${u.full_name||"Użytkownik"}`,title:u.full_name||"Użytkownik",children:u.full_name?.charAt(0)??"U"}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"font-medium truncate",children:[u.full_name||"Użytkownik",h&&r.jsx("span",{className:"ml-2 text-sm opacity-80",children:"(Ty)"})]}),r.jsxs("div",{className:U("text-sm",h?"text-primary-foreground/80":"text-muted-foreground"),children:["Poziom ",u.level," • Seria ",u.streak," dni"]})]}),r.jsxs("div",{className:"text-right",children:[r.jsx("div",{className:"font-semibold tabular-nums",children:r.jsx(Ft,{value:u.points})}),r.jsx("div",{className:U("text-xs",h?"text-primary-foreground/80":"text-muted-foreground"),children:"punktów"})]})]},u.user_id||`${u.rank}-${d}`)})]})]})},zQ=[r.jsx(Z,{path:"/leaderboard",element:r.jsx(CQ,{})},"leaderboard")],Fo=[{id:1,icon:An,title:"Pierwszy Krok",description:"Ukończ pierwszą lekcję",unlocked:!0,rarity:"common",unlockedAt:"2024-01-15",progress:100},{id:2,icon:Ii,title:"Perfekcjonista",description:"Zdobądź 100% w 10 quizach",unlocked:!0,rarity:"rare",unlockedAt:"2024-02-20",progress:100},{id:3,icon:Vt,title:"Błyskawica",description:"Ukończ 5 lekcji w jeden dzień",unlocked:!1,rarity:"epic",progress:60},{id:4,icon:ft,title:"Mistrz",description:"Osiągnij poziom 50",unlocked:!1,rarity:"legendary",progress:24},{id:5,icon:pt,title:"Snajper",description:"Odpowiedz poprawnie na 100 pytań z rzędu",unlocked:!1,rarity:"epic",progress:45},{id:6,icon:Yp,title:"Rakieta",description:"Ukończ kurs w mniej niż tydzień",unlocked:!1,rarity:"rare",progress:0}],Zw={common:{bg:"bg-muted",ring:"ring-1 ring-border",label:"Pospolite",badge:"border border-muted-foreground/20 text-muted-foreground bg-background/60"},rare:{bg:"bg-blue-500/10",ring:"ring-1 ring-blue-500/30",label:"Rzadkie",badge:"border border-blue-500/30 text-blue-600 dark:text-blue-400"},epic:{bg:"bg-purple-500/10",ring:"ring-1 ring-purple-500/30",label:"Epiczne",badge:"border border-purple-500/30 text-purple-600 dark:text-purple-400"},legendary:{bg:"bg-orange-500/10",ring:"ring-1 ring-orange-500/30",label:"Legendarne",badge:"border border-orange-500/30 text-orange-600 dark:text-orange-400"}},_Q=()=>{const t=Fo.filter(n=>n.unlocked).length,e=Fo.length,s=Math.round(t/e*100);return r.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8 pb-24 lg:pb-8",children:[r.jsxs(lt.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.45},className:"relative overflow-hidden rounded-2xl border",children:[r.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/[0.12] via-secondary/[0.10] to-accent/[0.12]"}),r.jsx("div",{className:"absolute inset-0 opacity-[0.06]",style:{backgroundImage:`
                linear-gradient(to right, hsl(var(--ring)/0.35) 1px, transparent 1px),
                linear-gradient(to bottom, hsl(var(--ring)/0.35) 1px, transparent 1px)
              `,backgroundSize:"28px 28px"}})]}),r.jsxs("div",{className:"relative z-10 p-4 sm:p-6 md:p-8",children:[r.jsxs("div",{className:"flex flex-col md:flex-row md:items-end md:justify-between gap-4",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Osiągnięcia"}),r.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Odblokowano"," ",r.jsx("span",{className:"font-semibold tabular-nums",children:t})," ","z"," ",r.jsx("span",{className:"font-semibold tabular-nums",children:e})," ","(",s,"%)"]})]}),r.jsxs("div",{className:"w-full md:w-96",children:[r.jsxs("div",{className:"flex items-center justify-between text-xs mb-1.5",children:[r.jsx("span",{className:"text-muted-foreground",children:"Postęp osiągnięć"}),r.jsxs("span",{className:"font-medium tabular-nums",children:[s,"%"]})]}),r.jsx(Ki,{value:s})]})]}),r.jsx("div",{className:"mt-4 grid grid-cols-2 sm:grid-cols-4 gap-2",children:Object.entries(Zw).map(([n,i])=>{const a=Fo.filter(l=>l.rarity===n&&l.unlocked).length,o=Fo.filter(l=>l.rarity===n).length;return r.jsxs("div",{className:U("rounded-xl border bg-card/70 backdrop-blur-sm p-3 shadow-soft"),children:[r.jsxs("p",{className:"text-lg font-semibold tabular-nums",children:[a,"/",o]}),r.jsx("p",{className:"text-xs text-muted-foreground",children:i.label})]},n)})})]})]}),r.jsx(lt.section,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.4,delay:.05},className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-5",children:Fo.map((n,i)=>{const a=Zw[n.rarity],o=n.icon,l=n.unlocked?r.jsx("span",{className:U("inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-[11px] font-semibold",a.badge),children:"Odblokowane"}):r.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-primary/30 text-primary px-2.5 py-1 text-[11px] font-semibold",children:[n.progress,"%"]});return r.jsxs(zo,{index:i,className:U("group relative rounded-2xl border bg-card p-5 shadow-soft hover:bg-muted/40 transition-colors",!n.unlocked&&"opacity-95"),children:[r.jsxs("div",{className:"flex items-start justify-between gap-3",children:[r.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[r.jsx("div",{className:U("w-12 h-12 rounded-xl flex items-center justify-center shrink-0",a.bg,a.ring),children:r.jsx(o,{className:"w-6 h-6"})}),r.jsxs("div",{className:"min-w-0",children:[r.jsx("h3",{className:"font-semibold text-sm sm:text-base text-foreground line-clamp-2",children:n.title}),r.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:n.description})]})]}),l]}),r.jsx("div",{className:"mt-4",children:n.unlocked?r.jsxs("div",{className:"text-xs text-muted-foreground",children:["Odblokowano:"," ",r.jsx("span",{className:"font-medium",children:new Date(n.unlockedAt).toLocaleDateString("pl-PL")})]}):r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between text-xs mb-1",children:[r.jsx("span",{className:"text-muted-foreground",children:"Postęp"}),r.jsxs("span",{className:"font-medium tabular-nums",children:[n.progress,"%"]})]}),r.jsx(Ki,{value:n.progress})]})})]},n.id)})})]})},AQ=[r.jsx(Z,{path:"/achievements",element:r.jsx(_Q,{})},"achievements")],TQ=()=>{const{data:t}=wt(),{stats:e}=ta(),s=t?.full_name||t?.name||t?.email||"Użytkownik",n=(t?.full_name||t?.name||"U").split(" ").map(o=>o[0]).slice(0,2).join("").toUpperCase()||"U",i=(()=>{const o=t?.created_at;return(o?new Date(o):new Date).toLocaleDateString("pl-PL")})(),a=[{icon:ft,label:"Punkty",value:e.points,iconColor:"text-primary",highlight:"primary",counter:!0},{icon:pt,label:"Ukończone quizy",value:e.quizzes_completed??0,iconColor:"text-green-600 dark:text-green-400",counter:!1},{icon:Ii,label:"Perfekcyjne wyniki",value:e.perfect_scores??0,iconColor:"text-yellow-600 dark:text-yellow-400",counter:!1},{icon:An,label:"Najdłuższa seria",value:`${e.streak??0} dni`,iconColor:"text-destructive",counter:!1},{icon:Ze,label:"Czas nauki",value:`${Math.max(0,Math.floor((e.total_time??0)/60))}h`,iconColor:"text-blue-600 dark:text-blue-400",counter:!1},{icon:ft,label:"Poziom",value:`Poziom ${e.level??1}`,iconColor:"text-secondary",counter:!1}];return r.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8 pb-24 lg:pb-8",children:[r.jsxs(lt.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.45},className:"relative overflow-hidden rounded-2xl border",children:[r.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/[0.12] via-secondary/[0.10] to-accent/[0.12]"}),r.jsx("div",{className:"absolute inset-0 opacity-[0.06]",style:{backgroundImage:`
                linear-gradient(to right, hsl(var(--ring)/0.35) 1px, transparent 1px),
                linear-gradient(to bottom, hsl(var(--ring)/0.35) 1px, transparent 1px)
              `,backgroundSize:"28px 28px"}})]}),r.jsx("div",{className:"relative z-10 p-4 sm:p-6 md:p-8",children:r.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-6",children:[r.jsxs("div",{className:"flex items-start gap-4 sm:gap-6",children:[r.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 rounded-2xl bg-primary text-primary-foreground flex items-center justify-center text-xl sm:text-2xl font-semibold shadow-soft",children:n}),r.jsxs("div",{className:"min-w-0",children:[r.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:s}),r.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-muted-foreground",children:[t?.email&&r.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[r.jsx(qd,{className:"w-4 h-4 shrink-0"}),r.jsx("span",{className:"truncate",children:t.email})]}),r.jsxs("div",{className:"flex items-center gap-1.5",children:[r.jsx(js,{className:"w-4 h-4"}),r.jsxs("span",{children:["Dołączył ",i]})]})]})]})]}),r.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[r.jsxs("button",{className:"inline-flex items-center gap-2 rounded-lg border px-3 py-2 text-sm hover:bg-primary/5 focus-ring",children:[r.jsx(tA,{className:"w-4 h-4"}),"Edytuj profil"]}),r.jsx("button",{className:"inline-flex items-center gap-2 rounded-lg bg-primary px-3 py-2 text-sm text-primary-foreground hover:bg-primary/90 focus-ring",children:"Ustawienia"})]})]})})]}),r.jsxs(lt.section,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.4,delay:.05},children:[r.jsx("h2",{className:"text-lg sm:text-xl md:text-2xl font-semibold tracking-tight mb-4",children:"Statystyki"}),r.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-5",children:a.map((o,l)=>{const c=o.icon;return r.jsx(zo,{index:l,className:"group relative rounded-2xl border bg-card p-5 shadow-soft hover:bg-muted/40 transition-colors",children:r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"w-12 h-12 rounded-xl bg-muted flex items-center justify-center shrink-0",children:r.jsx(c,{className:`w-6 h-6 ${o.iconColor}`})}),r.jsxs("div",{className:"min-w-0",children:[r.jsx("p",{className:`text-2xl font-semibold leading-none tabular-nums ${o.highlight==="primary"?"text-primary":o.highlight==="secondary"?"text-secondary":o.highlight==="accent"?"text-accent":"text-foreground"}`,children:o.counter?r.jsx(Ft,{value:Number(o.value)}):o.value}),r.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:o.label})]})]})},o.label)})})]})]})},EQ=[r.jsx(Z,{path:"/profile",element:r.jsx(TQ,{})},"profile")],DQ=[...tQ,...nQ,...oQ,...gQ,...jQ,...NQ,...zQ,...AQ,...EQ],MQ=()=>r.jsx(Ld,{children:r.jsxs(Z,{element:r.jsx(pK,{children:r.jsx(Kp,{})}),children:[r.jsx(Z,{index:!0,element:r.jsx(dn,{to:"dashboard",replace:!0})}),DQ]})}),PQ=j.lazy(()=>Promise.resolve({default:MQ})),t4=({text:t,colorClass:e})=>r.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-background",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:`inline-block h-12 w-12 animate-spin rounded-full border-4 border-current border-r-transparent ${e}`}),r.jsx("p",{className:"mt-4 text-muted-foreground",children:t})]})}),IQ=({children:t})=>{const{data:e,isLoading:s}=wt();return s||!e?r.jsx(t4,{text:"Sprawdzanie uprawnień...",colorClass:"border-blue-600"}):e.role!=="student"?r.jsx(dn,{to:"/teacher/dashboard/overview",replace:!0}):r.jsx(r.Fragment,{children:t})},OQ=r.jsx(Z,{path:"/student/*",element:r.jsx(Jp,{fallback:r.jsx(Zp,{to:"/login"}),children:r.jsx(IQ,{children:r.jsx(j.Suspense,{fallback:r.jsx(t4,{text:"Ładowanie panelu ucznia...",colorClass:"border-blue-600"}),children:r.jsx(PQ,{})})})},"student-auth")}),RQ={name:"ai-tools",list:"/admin/ai-tools",meta:{label:"Narzędzia AI",icon:r.jsx(Jt,{className:"h-4 w-4"})}},LQ=Yh.includes(M0)?Yh:[{name:"dashboard",list:"/admin/dashboard/overview",meta:{label:"Dashboard",icon:r.jsx(sA,{className:"h-4 w-4"})}},M0,...Yh,RQ,{...R0,list:"/admin/course-structure",meta:{...R0.meta,parent:"ai-tools"}},{...ty,list:"/admin/educational-material",meta:{...ty.meta,parent:"ai-tools"}},{...sy,list:"/admin/quiz-wizard",meta:{...sy.meta,parent:"ai-tools"}}],FQ={name:"dashboard",list:"/teacher/dashboard/overview",meta:{label:"Zasoby edukacyjne",icon:r.jsx(Se,{className:"h-4 w-4"})}},$Q=[FQ,{...ky,meta:{...ky.meta,parent:"dashboard",label:"Kursy"}},{...Tj,meta:{...Tj.meta,parent:"dashboard",hide:!0}},{...Ej,meta:{...Ej.meta,parent:"dashboard",label:"Grupy"}},JW,rK],BQ={name:"student-root",meta:{label:"Panel ucznia",route:"/student/dashboard/overview"}},qQ=[BQ],VQ=()=>{const t=pe(),[e,s]=j.useState(0),[n,i]=j.useState("");j.useEffect(()=>{const o=()=>s(window.scrollY);return window.addEventListener("scroll",o),()=>window.removeEventListener("scroll",o)},[]);const a=[{name:"Sty",value:65},{name:"Lut",value:72},{name:"Mar",value:78},{name:"Kwi",value:85},{name:"Maj",value:88},{name:"Cze",value:94}];return r.jsxs("div",{className:"min-h-screen bg-white text-foreground",children:[r.jsx("nav",{className:"fixed top-0 w-full z-50 bg-white/80 backdrop-blur-xl border-b border-gray-100",children:r.jsx("div",{className:"container mx-auto px-6 py-4",children:r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-pink-600 to-purple-700 rounded-xl flex items-center justify-center",children:r.jsx(ft,{className:"w-5 h-5 text-white"})}),r.jsx("span",{className:"text-xl font-bold",children:"Smart Up"})]}),r.jsxs("div",{className:"hidden md:flex items-center gap-8",children:[r.jsx("a",{href:"#funkcje",className:"text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors",children:"Funkcje"}),r.jsx("a",{href:"#kursy",className:"text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors",children:"Kursy"}),r.jsx("a",{href:"#firma",className:"text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors",children:"Dla firm"}),r.jsx("a",{href:"#cennik",className:"text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors",children:"Cennik"}),r.jsx(D,{className:"bg-gray-900 hover:bg-gray-800 text-white text-sm px-6",onClick:()=>t("/login"),children:"Rozpocznij"})]})]})})}),r.jsx("section",{className:"pt-32 pb-20 overflow-hidden",children:r.jsx("div",{className:"container mx-auto px-6",children:r.jsxs("div",{className:"grid lg:grid-cols-12 gap-8 items-center",children:[r.jsxs("div",{className:"lg:col-span-5",children:[r.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-purple-50 rounded-full mb-8",children:[r.jsx(Vt,{className:"w-4 h-4 text-purple-700"}),r.jsx("span",{className:"text-sm font-medium text-purple-700",children:"Gamifikacja w edukacji"})]}),r.jsxs("h1",{className:"text-5xl md:text-6xl font-bold leading-tight mb-6",children:["Nauka, która",r.jsx("span",{className:"block text-transparent bg-clip-text bg-gradient-to-r from-pink-600 to-purple-700",children:"motywuje"})]}),r.jsx("p",{className:"text-lg text-gray-600 mb-8 leading-relaxed",children:"Przekształć edukację w angażującą przygodę. System poziomów, punktów i nagród sprawia, że nauka staje się uzależniająca."}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-12",children:[r.jsxs(D,{size:"lg",className:"bg-gray-900 hover:bg-gray-800 text-white px-8",onClick:()=>t("/login"),children:["Zacznij za darmo",r.jsx(Ue,{className:"ml-2 h-4 w-4"})]}),r.jsx(D,{size:"lg",variant:"outline",className:"border-gray-300",children:"Zobacz demo"})]}),r.jsxs("div",{className:"flex items-center gap-8",children:[r.jsxs("div",{children:[r.jsx("div",{className:"text-2xl font-bold",children:"15k+"}),r.jsx("div",{className:"text-sm text-gray-500",children:"aktywnych uczniów"})]}),r.jsx("div",{className:"w-px h-12 bg-gray-200"}),r.jsxs("div",{children:[r.jsx("div",{className:"text-2xl font-bold",children:"92%"}),r.jsx("div",{className:"text-sm text-gray-500",children:"ukończalność"})]}),r.jsx("div",{className:"w-px h-12 bg-gray-200"}),r.jsxs("div",{children:[r.jsx("div",{className:"text-2xl font-bold",children:"4.9"}),r.jsx("div",{className:"text-sm text-gray-500",children:"ocena"})]})]})]}),r.jsx("div",{className:"lg:col-span-7",children:r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"absolute -inset-4 bg-gradient-to-r from-pink-600/5 to-purple-700/5 rounded-3xl blur-2xl"}),r.jsxs("div",{className:"relative bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden",children:[r.jsx("div",{className:"bg-gray-50 px-6 py-4 border-b border-gray-100",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-pink-600 to-purple-700 rounded-lg flex items-center justify-center",children:r.jsx(ft,{className:"w-4 h-4 text-white"})}),r.jsx("span",{className:"font-semibold",children:"Dashboard ucznia"})]}),r.jsx(V,{className:"bg-green-50 text-green-700 border-green-200",children:"Online"})]})}),r.jsxs("div",{className:"p-6",children:[r.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[r.jsxs("div",{className:"bg-gradient-to-br from-pink-50 to-pink-100 rounded-xl p-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx(k0,{className:"w-5 h-5 text-pink-600"}),r.jsx("span",{className:"text-xs text-gray-500",children:"+125"})]}),r.jsx("div",{className:"text-2xl font-bold",children:"1,842"}),r.jsx("div",{className:"text-xs text-gray-500",children:"Punkty XP"})]}),r.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx(pt,{className:"w-5 h-5 text-purple-700"}),r.jsx("span",{className:"text-xs text-gray-500",children:"75%"})]}),r.jsx("div",{className:"text-2xl font-bold",children:"Lvl 12"}),r.jsx("div",{className:"text-xs text-gray-500",children:"Poziom"})]}),r.jsxs("div",{className:"bg-gradient-to-br from-teal-50 to-teal-100 rounded-xl p-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx(Os,{className:"w-5 h-5 text-teal-600"}),r.jsx("span",{className:"text-xs text-gray-500",children:"New!"})]}),r.jsx("div",{className:"text-2xl font-bold",children:"24"}),r.jsx("div",{className:"text-xs text-gray-500",children:"Odznaki"})]})]}),r.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 mb-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("span",{className:"text-sm font-medium",children:"Postęp nauki"}),r.jsx("span",{className:"text-xs text-gray-500",children:"Ostatnie 6 miesięcy"})]}),r.jsx(ht,{width:"100%",height:120,children:r.jsxs(Gd,{data:a,children:[r.jsx("defs",{children:r.jsxs("linearGradient",{id:"colorProgress",x1:"0",y1:"0",x2:"0",y2:"1",children:[r.jsx("stop",{offset:"5%",stopColor:"#db2777",stopOpacity:.3}),r.jsx("stop",{offset:"95%",stopColor:"#db2777",stopOpacity:0})]})}),r.jsx(Zr,{type:"monotone",dataKey:"value",stroke:"#db2777",strokeWidth:2,fill:"url(#colorProgress)"}),r.jsx(ys,{dataKey:"name",axisLine:!1,tickLine:!1,tick:{fontSize:11}}),r.jsx(is,{hide:!0})]})})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between text-sm",children:[r.jsx("span",{className:"font-medium",children:"Aktywne kursy"}),r.jsx("a",{href:"#",className:"text-purple-700 hover:underline",children:"Zobacz wszystkie"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-pink-600 to-purple-700 rounded-lg flex items-center justify-center",children:r.jsx(bm,{className:"w-5 h-5 text-white"})}),r.jsxs("div",{children:[r.jsx("div",{className:"font-medium text-sm",children:"JavaScript: Gra w kodowanie"}),r.jsx("div",{className:"text-xs text-gray-500",children:"Rozdział 4 z 12"})]})]}),r.jsx(He,{className:"w-4 h-4 text-gray-400"})]}),r.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-teal-500 to-blue-600 rounded-lg flex items-center justify-center",children:r.jsx(Vr,{className:"w-5 h-5 text-white"})}),r.jsxs("div",{children:[r.jsx("div",{className:"font-medium text-sm",children:"Analiza danych: Quest"}),r.jsx("div",{className:"text-xs text-gray-500",children:"Rozdział 7 z 10"})]})]}),r.jsx(He,{className:"w-4 h-4 text-gray-400"})]})]})]})]})]})]})})]})})}),r.jsx("section",{id:"funkcje",className:"py-20 bg-gray-50",children:r.jsxs("div",{className:"container mx-auto px-6",children:[r.jsxs("div",{className:"text-center mb-16",children:[r.jsxs("h2",{className:"text-4xl font-bold mb-4",children:["Funkcje, które"," ",r.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-pink-600 to-purple-700",children:"angażują"})]}),r.jsx("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto",children:"System zaprojektowany, aby uczynić naukę uzależniającą jak najlepsza gra"})]}),r.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:[r.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-pink-600/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-pink-600 to-purple-700 rounded-2xl flex items-center justify-center mb-6",children:r.jsx(ft,{className:"w-7 h-7 text-white"})}),r.jsx("h3",{className:"text-xl font-bold mb-3",children:"System poziomów"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"99 poziomów do zdobycia. Każdy poziom odblokowuje nowe możliwości i nagrody."}),r.jsxs("div",{className:"flex items-center text-sm text-pink-600 font-medium",children:["Dowiedz się więcej",r.jsx(Ue,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]}),r.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-700/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-purple-700 to-teal-500 rounded-2xl flex items-center justify-center mb-6",children:r.jsx(k0,{className:"w-7 h-7 text-white"})}),r.jsx("h3",{className:"text-xl font-bold mb-3",children:"Idle Points"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"Zdobywaj punkty nawet gdy nie uczysz się aktywnie. System pasywnego rozwoju."}),r.jsxs("div",{className:"flex items-center text-sm text-purple-700 font-medium",children:["Dowiedz się więcej",r.jsx(Ue,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]}),r.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-teal-500/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-teal-500 to-blue-600 rounded-2xl flex items-center justify-center mb-6",children:r.jsx(pt,{className:"w-7 h-7 text-white"})}),r.jsx("h3",{className:"text-xl font-bold mb-3",children:"Wyzwania"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"Codzienne i tygodniowe wyzwania z dodatkowymi nagrodami za ukończenie."}),r.jsxs("div",{className:"flex items-center text-sm text-teal-600 font-medium",children:["Dowiedz się więcej",r.jsx(Ue,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]}),r.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-orange-500/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-orange-500 to-yellow-500 rounded-2xl flex items-center justify-center mb-6",children:r.jsx(ge,{className:"w-7 h-7 text-white"})}),r.jsx("h3",{className:"text-xl font-bold mb-3",children:"Rankingi"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"Rywalizuj z innymi uczniami. Rankingi globalne, lokalne i grupowe."}),r.jsxs("div",{className:"flex items-center text-sm text-orange-600 font-medium",children:["Dowiedz się więcej",r.jsx(Ue,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]}),r.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-700/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-purple-700 to-pink-600 rounded-2xl flex items-center justify-center mb-6",children:r.jsx(Os,{className:"w-7 h-7 text-white"})}),r.jsx("h3",{className:"text-xl font-bold mb-3",children:"Odznaki"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"Kolekcjonuj unikalne odznaki za osiągnięcia i kamienie milowe."}),r.jsxs("div",{className:"flex items-center text-sm text-purple-700 font-medium",children:["Dowiedz się więcej",r.jsx(Ue,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]}),r.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-teal-500/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-teal-500 to-purple-700 rounded-2xl flex items-center justify-center mb-6",children:r.jsx(Vr,{className:"w-7 h-7 text-white"})}),r.jsx("h3",{className:"text-xl font-bold mb-3",children:"Analityka"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"Szczegółowe statystyki postępów i personalizowane rekomendacje."}),r.jsxs("div",{className:"flex items-center text-sm text-teal-600 font-medium",children:["Dowiedz się więcej",r.jsx(Ue,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]})]})]})}),r.jsx("section",{className:"py-20 bg-white",children:r.jsxs("div",{className:"container mx-auto px-6",children:[r.jsxs("div",{className:"max-w-3xl mx-auto text-center mb-16",children:[r.jsxs("h2",{className:"text-4xl font-bold mb-4",children:["Jak to"," ",r.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-pink-600 to-purple-700",children:"działa"})]}),r.jsx("p",{className:"text-lg text-gray-600",children:"Cztery proste kroki do rozpoczęcia nauki z gamifikacją"})]}),r.jsx("div",{className:"max-w-4xl mx-auto",children:r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"absolute left-1/2 transform -translate-x-1/2 top-0 bottom-0 w-0.5 bg-gray-200"}),r.jsx("div",{className:"space-y-12",children:[{number:"01",title:"Stwórz profil",description:"Wybierz swoją rolę i spersonalizuj doświadczenie nauki",icon:ge,color:"from-pink-600 to-purple-700"},{number:"02",title:"Wybierz kursy",description:"Przeglądaj bibliotekę kursów i wybierz te, które Cię interesują",icon:cr,color:"from-purple-700 to-teal-500"},{number:"03",title:"Ucz się i graj",description:"Rozwiązuj quizy, zdobywaj punkty i awansuj na kolejne poziomy",icon:bm,color:"from-teal-500 to-blue-600"},{number:"04",title:"Śledź postępy",description:"Monitoruj swoje osiągnięcia i rywalizuj z innymi",icon:Et,color:"from-orange-500 to-yellow-500"}].map((o,l)=>r.jsx("div",{className:"relative",children:r.jsxs("div",{className:`flex items-center ${l%2===0?"flex-row":"flex-row-reverse"}`,children:[r.jsxs("div",{className:`w-5/12 ${l%2===0?"text-right pr-8":"text-left pl-8"}`,children:[r.jsxs("div",{className:`inline-flex items-center gap-4 mb-2 ${l%2===0?"flex-row-reverse":""}`,children:[r.jsx("h3",{className:"text-2xl font-bold",children:o.title}),r.jsx("span",{className:"text-4xl font-bold text-gray-200",children:o.number})]}),r.jsx("p",{className:"text-gray-600 text-lg",children:o.description})]}),r.jsx("div",{className:"w-2/12 flex justify-center",children:r.jsx("div",{className:`relative z-10 w-16 h-16 bg-gradient-to-br ${o.color} rounded-2xl flex items-center justify-center shadow-lg`,children:r.jsx(o.icon,{className:"w-8 h-8 text-white"})})}),r.jsx("div",{className:"w-5/12"})]})},l))})]})})]})}),r.jsx("section",{className:"py-20 bg-gradient-to-br from-gray-900 to-gray-800",children:r.jsx("div",{className:"container mx-auto px-6",children:r.jsx("div",{className:"grid md:grid-cols-4 gap-8",children:[{value:"15k+",label:"Aktywnych uczniów",icon:ge},{value:"200+",label:"Kursów",icon:cr},{value:"92%",label:"Ukończalność",icon:pt},{value:"4.9/5",label:"Ocena",icon:Ii}].map((o,l)=>r.jsxs("div",{className:"text-center",children:[r.jsx(o.icon,{className:"w-8 h-8 mx-auto mb-4 text-white/60"}),r.jsx("div",{className:"text-4xl font-bold text-white mb-2",children:o.value}),r.jsx("div",{className:"text-sm text-white/60",children:o.label})]},l))})})}),r.jsx("section",{className:"py-20 bg-white",children:r.jsx("div",{className:"container mx-auto px-6",children:r.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[r.jsxs("h2",{className:"text-4xl font-bold mb-6",children:["Gotowy na naukę, która"," ",r.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-pink-600 to-purple-700",children:"wciąga"}),"?"]}),r.jsx("p",{className:"text-lg text-gray-600 mb-8 max-w-2xl mx-auto",children:"Dołącz do tysięcy uczniów, którzy odkryli radość z nauki dzięki gamifikacji. Pierwsze 30 dni gratis."}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center mb-8",children:[r.jsx(te,{type:"email",placeholder:"twoj@email.pl",value:n,onChange:o=>i(o.target.value),className:"max-w-xs h-12"}),r.jsxs(D,{size:"lg",className:"bg-gradient-to-r from-pink-600 to-purple-700 hover:opacity-90 text-white px-8 h-12",onClick:()=>t("/login"),children:["Rozpocznij za darmo",r.jsx(Ue,{className:"ml-2 h-4 w-4"})]})]}),r.jsx("p",{className:"text-sm text-gray-500",children:"Bez karty kredytowej • Anuluj w każdej chwili • Pełny dostęp"})]})})}),r.jsx("footer",{className:"bg-gray-900 text-white py-12",children:r.jsx("div",{className:"container mx-auto px-6",children:r.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-8 h-8 bg-white/10 rounded-lg flex items-center justify-center",children:r.jsx(ft,{className:"w-4 h-4"})}),r.jsx("span",{className:"text-lg font-bold",children:"Smart Up"})]}),r.jsx("div",{className:"text-sm text-white/60",children:"© 2025 Smart Up. Wszystkie prawa zastrzeżone."})]})})})]})},UQ=new o_({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:!1,staleTime:300*1e3}}});function WQ({children:t}){const{pathname:e}=gn(),s=e.split("/")[1],n=s==="admin"?LQ:s==="teacher"?$Q:s==="student"?qQ:[];return r.jsx(c_,{dataProvider:h_(oe),authProvider:CA,routerProvider:u_,resources:n,options:{syncWithLocation:!0,warnWhenUnsavedChanges:!1,useNewQueryKeys:!0,disableTelemetry:!0},children:t})}function KQ(){return r.jsx(l_,{client:UQ,children:r.jsx(Q4,{children:r.jsx(WQ,{children:r.jsxs(Ld,{children:[r.jsx(Z,{path:"/",element:r.jsx(VQ,{})}),Q1,EA,PA,RA,FM,uK,OQ,r.jsx(Z,{path:"*",element:r.jsx(dn,{to:"/",replace:!0})})]})})})})}const HQ=document.getElementById("root"),GQ=gA.createRoot(HQ);GQ.render(r.jsxs(ae.StrictMode,{children:[r.jsx(KQ,{}),r.jsx(i_,{position:"top-right",richColors:!0,closeButton:!0,duration:4e3,toastOptions:{style:{width:"500px",fontSize:"20px"},className:"sonner-toast"}})]}));export{we as A,D as B,P as C,oi as F,te as I,je as L,ve as a,F as b,L as c,Jd as d,I as e,ye as f,li as g,Oi as h,J1 as i,H1 as l,G1 as r,oe as s,Z1 as u};
