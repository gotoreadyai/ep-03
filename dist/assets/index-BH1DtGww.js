const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/LoginPage-tp8ed3UZ.js","assets/radix-ui-LETSITqz.js","assets/react-vendor-nLIND2rL.js","assets/refine-core-hvoUa3GG.js","assets/NarrowCol-D6-3Hnlm.js","assets/ui-utils-CGHwLeur.js","assets/utils-Bi50OPJh.js","assets/refine-ui-CgT0brDl.js","assets/forms-Dah7oaIm.js","assets/tables-rWu7EQHN.js","assets/RegisterFlow-B1W5qftU.js","assets/ForgotPasswordPage-D_TPzv8_.js","assets/UpdatePasswordPage-B4e-xVMZ.js"])))=>i.map(i=>d[i]);
var ly=Object.defineProperty;var cy=(t,s,n)=>s in t?ly(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n;var ss=(t,s,n)=>cy(t,typeof s!="symbol"?s+"":s,n);import{j as e,R as gh,I as jh,F as yh,S as dc,a as wh,P as dy,C as bh,b as vh,V as uy,c as my,d as Nh,e as hy,T as kh,f as py,g as zh,h as Sh,i as fy,k as Ch,l as xy,L as _h,m as Th,n as gy,o as jy,p as Ah,q as yy,r as wy,s as Ph,t as Dh,u as Mh,v as Ih,w as by,x as Eh,y as vy,z as Os,A as Lh,B as uc,D as Ss,E as ye,G as Ny,H as ky,J as zy,K as Rh,M as Sy,N as Cy,O as _y,Q as Oh,U as Ty,W as $h,X as Ay,Y as qh,Z as Fh,_ as Py,$ as Bh,a0 as Dy,a1 as My,a2 as Ha,a3 as Uh,a4 as Iy,a5 as Vh,a6 as Kh,a7 as Wh,a8 as Qa,a9 as Ey,aa as Ly,ab as Ry,ac as Oy,ad as $y,ae as qy,af as Fy,ag as By,ah as Uy,ai as Vy,aj as Ky,ak as Wy,al as Kd}from"./radix-ui-LETSITqz.js";import{k as Gy,a as f,l as H,n as gi,N as as,e as le,L as Te,d as ms,o as Za,O as mc,u as ft,R as re,h as Xi,p as Ya,B as Hy}from"./react-vendor-nLIND2rL.js";import{t as W,c as Gh,a as Hh,v as Qy,o as _i,u as ji,b as hc,n as Lr,d as za,e as Zy,f as Qh,E as Yy,g as pc,h as fr,m as Ft,i as Jy,j as Xy,k as Ys,s as Bo,r as ew,l as er,p as Yn,q as tw,M as Sn,T as sw}from"./utils-Bi50OPJh.js";import{n as Ye,M as Ja,d as Zh,$ as Q,e as En,X as os,f as Is,I as Yh,i as Le,E as fc,o as xc,k as Jh,j as xt,l as nw,Q as iw,m as rw,p as aw,D as ow}from"./refine-core-hvoUa3GG.js";import{c as lw,_ as Xa,k as ln,I as cw}from"./refine-ui-CgT0brDl.js";import{t as dw,c as uw,U as xr,M as eo,G as Es,a as to,S as Sa,b as so,C as Dt,d as Rr,e as $t,X as ls,f as Or,L as no,T as Ca,g as lt,h as dt,i as Ti,j as ce,F as mw,A as Ce,P as Qe,k as At,l as Cn,B as xe,m as hw,n as pw,o as fw,p as Ae,q as Xh,r as xw,W as $r,s as pt,H as gw,I as Ln,u as Re,v as Ne,w as sn,x as Pt,y as Ai,z as jw,R as ep,D as Xs,E as yw,J as De,K as We,N as _a,O as cn,Q as Be,V as dn,Y as tp,Z as kt,_ as tt,$ as gr,a0 as ww,a1 as Ve,a2 as bw,a3 as vw,a4 as sp,a5 as ir,a6 as io,a7 as Cs,a8 as np,a9 as Nw,aa as kw,ab as ui,ac as zw,ad as Sw,ae as Cw,af as ip,ag as st,ah as en,ai as Bt,aj as Ta,ak as ro,al as rp,am as _n,an as ap,ao as gs,ap as ct,aq as _w,ar as Tw,as as op,at as Wd,au as kl,av as Aw,aw as Pw,ax as Dw,ay as Gd,az as Mw,aA as Iw,aB as gc,aC as Ew,aD as Lw,aE as Rw,aF as Ow,aG as Hd}from"./ui-utils-CGHwLeur.js";import{a as Qd,o as Zd,b as $w,c as Yd,n as Jd,s as Xd}from"./forms-Dah7oaIm.js";import{R as Ue,A as ao,C as qt,X as Tt,Y as vt,T as He,a as nn,P as Aa,b as Pa,c as js,B as qr,d as yi,L as lp,e as jc,F as qw,f as Fw,g as Bw,h as mi,S as cp,Z as dp,i as up,j as Uw,k as Vw,l as Kw,m as Ww,n as Gw,o as Hw,p as Qw,q as Zw}from"./tables-rWu7EQHN.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}})();var sa={},eu;function Yw(){if(eu)return sa;eu=1;var t=Gy();return sa.createRoot=t.createRoot,sa.hydrateRoot=t.hydrateRoot,sa}var Jw=Yw();const Xw="https://hqsyimochfcfqahcuprn.supabase.co",eb="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhxc3lpbW9jaGZjZnFhaGN1cHJuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM4NjU4NTYsImV4cCI6MjA2OTQ0MTg1Nn0.KutvVrkDKuVyvrYQosU3SI6QrrMnWqDCSZ2E3fhCteI",ee=lw(Xw,eb,{db:{schema:"public"},auth:{persistSession:!0}}),U=(...t)=>dw(uw(t)),tb={invalid_credentials:"Nieprawidłowy email lub hasło.","Invalid login credentials":"Nieprawidłowy email lub hasło.",email_not_confirmed:"Email nie został potwierdzony.","Email not confirmed":"Email nie został potwierdzony.",user_not_found:"Nie znaleziono użytkownika.","User not found":"Nie znaleziono użytkownika.",network_error:"Błąd połączenia z serwerem.","Too many requests":"Zbyt wiele prób. Spróbuj ponownie za chwilę."},sb=t=>{if(!t)return{message:"Nieznany błąd",name:"UnknownError",statusCode:500};const s=t.message||t.error_description||"";for(const[n,i]of Object.entries(tb))if(s.includes(n))return{message:i,name:"LoginError",statusCode:t.code==="invalid_credentials"?401:400};return{message:s||"Błąd logowania",name:"LoginError",statusCode:400}},mp={login:async(t,s)=>{try{if(!t||!s)return{success:!1,error:"Email i hasło są wymagane"};const{data:n,error:i}=await ee.auth.signInWithPassword({email:t.trim().toLowerCase(),password:s});if(i)return{success:!1,error:sb(i).message};if(!n.session)return{success:!1,error:"Nie udało się utworzyć sesji"};const{data:r}=await ee.from("users").select("role").eq("id",n.user.id).single();return{success:!0,redirectTo:r?.role==="admin"?"/admin/dashboard/overview":r?.role==="teacher"?"/teacher/dashboard/overview":r?.role==="student"?"/student/dashboard":"/profiles"}}catch(n){return{success:!1,error:n.message||"Nieznany błąd"}}},loginForRefine:async(t,s)=>{const n=await mp.login(t,s);return n.success?n:{success:!1,error:{message:n.error,name:"LoginError",statusCode:400}}},checkAuth:async()=>{const{data:{session:t}}=await ee.auth.getSession();return!!t}},nb={user_already_exists:"Konto z tym adresem email już istnieje","User already registered":"Konto z tym adresem email już istnieje","already exists":"Konto z tym adresem email już istnieje",weak_password:"Hasło musi mieć co najmniej 6 znaków","Password should be at least":"Hasło musi mieć co najmniej 6 znaków","Password cannot be longer than 72":"Hasło nie może być dłuższe niż 72 znaki",invalid_email:"Nieprawidłowy format adresu email","Invalid email":"Nieprawidłowy format adresu email",over_email_send_rate_limit:"Za szybko! Poczekaj 2 sekundy przed ponowną próbą"},tu=t=>{if(!t)return{message:"Nieznany błąd",name:"UnknownError",statusCode:500};const s=t.message||"";for(const[n,i]of Object.entries(nb))if(s.includes(n)){let r=400;return n.includes("already")&&(r=409),n.includes("email_send_rate")&&(r=429),{message:i,name:"RegisterError",statusCode:r}}return{message:s||"Rejestracja nie powiodła się",name:"RegisterError",statusCode:400}},hp={register:async(t,s,n)=>{try{const{data:i,error:r}=await ee.auth.signUp({email:t.trim().toLowerCase(),password:s,options:{data:{full_name:n.trim(),role:"student"},emailRedirectTo:`${window.location.origin}/login?verified=true`}});return r?{success:!1,error:tu(r).message}:i.user?{success:!0,needsEmailConfirmation:!i.session}:{success:!1,error:"Rejestracja nie powiodła się"}}catch(i){return{success:!1,error:i.message||"Błąd rejestracji"}}},registerForRefine:async(t,s,n)=>{const i=await hp.register(t,s,n);return i.success?{success:!0,successNotification:i.needsEmailConfirmation?{message:"Rejestracja udana!",description:"Sprawdź email aby potwierdzić konto."}:{message:"Rejestracja udana!",description:"Możesz się teraz zalogować."}}:{success:!1,error:tu({message:i.error})}}},ib={"User not found":"Nie znaleziono użytkownika z tym adresem email","Invalid email":"Nieprawidłowy format adresu email",over_email_send_rate_limit:"Za szybko! Poczekaj chwilę przed kolejną próbą",reset_password_rate_limit:"Zbyt wiele prób. Spróbuj ponownie za kilka minut"},su=t=>{if(!t)return{message:"Nieznany błąd",name:"UnknownError",statusCode:500};const s=t.message||"";for(const[n,i]of Object.entries(ib))if(s.includes(n))return{message:i,name:"ForgotPasswordError",statusCode:n.includes("rate_limit")?429:400};return{message:s||"Błąd podczas wysyłania emaila",name:"ForgotPasswordError",statusCode:400}},pp={sendResetEmail:async t=>{try{const{error:s}=await ee.auth.resetPasswordForEmail(t.trim().toLowerCase(),{redirectTo:`${window.location.origin}/update-password`});return s?{success:!1,error:su(s).message}:{success:!0}}catch(s){return{success:!1,error:s.message||"Błąd podczas wysyłania emaila"}}},sendResetEmailForRefine:async t=>{const s=await pp.sendResetEmail(t);return s.success?{success:!0,successNotification:{message:"Email wysłany!",description:"Sprawdź swoją skrzynkę odbiorczą"}}:{success:!1,error:su({message:s.error})}}},rb={"New password should be different":"Nowe hasło musi być inne niż obecne","Password should be at least":"Hasło musi mieć co najmniej 6 znaków","Invalid token":"Link wygasł lub jest nieprawidłowy",session_not_found:"Sesja wygasła. Spróbuj ponownie"},nu=t=>{if(!t)return{message:"Nieznany błąd",name:"UnknownError",statusCode:500};const s=t.message||"";for(const[n,i]of Object.entries(rb))if(s.includes(n))return{message:i,name:"UpdatePasswordError",statusCode:n.includes("token")||n.includes("session")?401:400};return{message:s||"Błąd aktualizacji hasła",name:"UpdatePasswordError",statusCode:400}},fp={checkSession:async()=>{try{const{data:t}=await ee.auth.getSession(),n=new URLSearchParams(window.location.hash.substring(1)).get("type");return!t.session&&n!=="recovery"?{isValid:!1,error:"Link wygasł lub jest nieprawidłowy"}:{isValid:!0}}catch{return{isValid:!1,error:"Błąd weryfikacji sesji"}}},updatePassword:async t=>{try{const{error:s}=await ee.auth.updateUser({password:t});return s?{success:!1,error:nu(s).message}:{success:!0}}catch(s){return{success:!1,error:s.message||"Błąd aktualizacji hasła"}}},updatePasswordForRefine:async t=>{const s=await fp.updatePassword(t);return s.success?{success:!0,redirectTo:"/login?passwordChanged=true"}:{success:!1,error:nu({message:s.error})}}};class ab{constructor(){ss(this,"cache",null);ss(this,"lastFetch",0);ss(this,"CACHE_DURATION",300*1e3);ss(this,"fetchPromise",null)}async get(s=!1){const n=Date.now();if(!s&&this.cache&&n-this.lastFetch<this.CACHE_DURATION)return this.cache;if(this.fetchPromise)return this.fetchPromise;this.fetchPromise=this.fetchUser();const i=await this.fetchPromise;return this.fetchPromise=null,i}async fetchUser(){try{const{data:{session:s}}=await ee.auth.getSession();if(!s?.user)return this.clear(),null;const{data:n,error:i}=await ee.from("users").select("*").eq("id",s.user.id).single();if(i||!n){console.error("Error fetching user data:",i);const a={id:s.user.id,email:s.user.email||"",full_name:s.user.user_metadata?.full_name||s.user.email?.split("@")[0]||"User",vendor_id:1,role:"student"};return this.set(a),a}const r={id:n.id,email:n.email,full_name:n.full_name,vendor_id:n.vendor_id,role:n.role,is_active:n.is_active,created_at:n.created_at};return this.set(r),r}catch(s){return console.error("Error in fetchUser:",s),this.clear(),null}}set(s){this.cache=s,this.lastFetch=Date.now()}clear(){this.cache=null,this.lastFetch=0,this.fetchPromise=null}async refresh(){return this.get(!0)}}const Js=new ab;ee.auth.onAuthStateChange((t,s)=>{t==="SIGNED_OUT"||!s?Js.clear():(t==="SIGNED_IN"||t==="TOKEN_REFRESHED")&&Js.get(!0)});const Uo={logout:async()=>{try{Js.clear();const{error:t}=await ee.auth.signOut();return t?{success:!1,error:{message:"Błąd podczas wylogowania",name:"LogoutError",statusCode:500}}:{success:!0,redirectTo:"/login"}}catch{return{success:!1,error:{message:"Nieoczekiwany błąd podczas wylogowania",name:"LogoutError",statusCode:500}}}},check:async()=>{try{const{data:{session:t}}=await ee.auth.getSession();if(!t)return{authenticated:!1,redirectTo:"/login"};const s=t.expires_at;return s&&s*1e3<Date.now()?{authenticated:!1,redirectTo:"/login"}:{authenticated:!0}}catch{return{authenticated:!1,redirectTo:"/login"}}},handleError:async t=>(console.error("Auth error:",t),t?.statusCode===401?(Js.clear(),{redirectTo:"/login",logout:!0,error:t}):{error:t})},ob={login:async({email:t,password:s})=>{const n=await mp.login(t,s);return n.success&&await Js.refresh(),n},logout:async()=>await Uo.logout(),check:async()=>await Uo.check(),getIdentity:async()=>await Js.get(),getPermissions:async()=>(await Js.get())?.role||null,register:async({email:t,password:s,name:n})=>await hp.registerForRefine(t,s,n),forgotPassword:async({email:t})=>await pp.sendResetEmailForRefine(t),updatePassword:async({password:t})=>{const s=await fp.updatePasswordForRefine(t);return s.success&&await Js.clear(),s},onError:async t=>await Uo.handleError(t)},yc=({isLoading:t,isError:s,loadingText:n="Loading...",errorMsg:i="Error loading data"})=>t?e.jsx("div",{className:"p-6 text-gray-600 animate-reverse-pulse",children:n}):s?e.jsx("div",{className:"p-6 text-red-500",children:i}):null;console.log("1. Login index.tsx - ładowanie modułu");const lb=f.lazy(()=>(console.log("2. Login - rozpoczęcie lazy load"),Xa(()=>import("./LoginPage-tp8ed3UZ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])).then(t=>(console.log("3. Login - moduł załadowany",t),t)))),cb=()=>(console.log("4. Login - renderowanie fallback"),e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Ładowanie logowania..."})]})})),xp=e.jsx(H,{path:"/login",element:e.jsx(f.Suspense,{fallback:e.jsx(cb,{}),children:e.jsx(lb,{})})});console.log("5. Login module exported",xp);const db=f.lazy(()=>Xa(()=>import("./RegisterFlow-B1W5qftU.js"),__vite__mapDeps([10,1,2,3,5,4,6,7,8,9]))),ub=()=>e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Przygotowywanie rejestracji..."})]})}),mb=e.jsx(H,{path:"/register/*",element:e.jsx(f.Suspense,{fallback:e.jsx(ub,{}),children:e.jsx(db,{})})}),hb=f.lazy(()=>Xa(()=>import("./ForgotPasswordPage-D_TPzv8_.js"),__vite__mapDeps([11,1,2,3,4,5,6,7,8,9]))),pb=()=>e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-yellow-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Ładowanie formularza resetowania..."})]})}),fb=e.jsx(H,{path:"/forgot-password",element:e.jsx(f.Suspense,{fallback:e.jsx(pb,{}),children:e.jsx(hb,{})})}),xb=f.lazy(()=>Xa(()=>import("./UpdatePasswordPage-B4e-xVMZ.js"),__vite__mapDeps([12,1,2,3,4,5,6,7,8,9]))),gb=()=>e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Weryfikacja linku resetowania..."})]})}),jb=e.jsx(H,{path:"/update-password",element:e.jsx(f.Suspense,{fallback:e.jsx(gb,{}),children:e.jsx(xb,{})})}),jr=f.forwardRef(({className:t,...s},n)=>e.jsx(gh,{ref:n,className:U("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...s}));jr.displayName=gh.displayName;const yb=f.forwardRef(({className:t,...s},n)=>e.jsx(jh,{ref:n,className:U("aspect-square h-full w-full object-cover",t),...s}));yb.displayName=jh.displayName;const yr=f.forwardRef(({className:t,...s},n)=>e.jsx(yh,{ref:n,className:U("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...s}));yr.displayName=yh.displayName;function Rt({className:t,...s}){return e.jsx("div",{className:U("animate-pulse rounded-md bg-primary/10",t),...s})}const gp=({className:t="",showRole:s=!0,showEmail:n=!0,compact:i=!1})=>{const{data:r,isLoading:a,error:o}=Ye(),l=h=>{switch(h){case"admin":return e.jsx(Sa,{className:"h-3 w-3"});case"teacher":return e.jsx(to,{className:"h-3 w-3"});case"student":return e.jsx(Es,{className:"h-3 w-3"});default:return e.jsx(xr,{className:"h-3 w-3"})}},c=h=>{switch(h){case"admin":return"Administrator";case"teacher":return"Nauczyciel";case"student":return"Uczeń";default:return"Użytkownik"}},d=h=>{switch(h){case"admin":return"text-purple-600 bg-purple-50";case"teacher":return"text-blue-600 bg-blue-50";case"student":return"text-green-600 bg-green-50";default:return"text-gray-600 bg-gray-50"}};if(a)return e.jsxs("div",{className:`flex items-center space-x-3 p-3 ${t}`,children:[e.jsx(Rt,{className:"h-10 w-10 rounded-full"}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(Rt,{className:"h-4 w-28"}),e.jsx(Rt,{className:"h-3 w-20"}),s&&e.jsx(Rt,{className:"h-3 w-16"})]})]});if(o||!r)return e.jsxs("div",{className:`flex items-center space-x-3 p-3 text-muted-foreground ${t}`,children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(xr,{className:"h-5 w-5 text-gray-400"})}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium text-gray-500",children:"Nie zalogowano"}),e.jsx("div",{className:"text-xs opacity-70",children:"Brak danych użytkownika"})]})]});const m=(h=>{if(!h)return"U";const p=h.trim().split(" ");return p.length>=2?`${p[0][0]}${p[p.length-1][0]}`.toUpperCase():h.slice(0,2).toUpperCase()})(r.full_name||r.email);return i?e.jsxs("div",{className:`flex items-center space-x-2 p-2 ${t}`,children:[e.jsx(jr,{className:"h-8 w-8",children:e.jsx(yr,{className:"bg-gradient-to-br from-purple-500 to-pink-500 text-white text-xs",children:m})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"font-medium text-sm truncate",children:r.full_name})})]}):e.jsxs("div",{className:`flex items-center space-x-3 px-4 pt-4 rounded-lg bg-white/50 backdrop-blur-sm border border-purple-100/20 ${t}`,children:[e.jsx(jr,{className:"h-12 w-12 ring-2 ring-purple-100 ring-offset-2",children:e.jsx(yr,{className:"bg-gradient-to-br from-purple-500 to-pink-500 text-white font-medium",children:m})}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-1",children:[e.jsx("div",{className:"font-semibold text-gray-900 truncate",title:r.full_name,children:r.full_name}),n&&r.email&&e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-500",children:[e.jsx(eo,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate",title:r.email,children:r.email})]}),s&&r.role&&e.jsx("div",{className:"inline-flex items-center gap-1.5",children:e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full text-xs font-medium ${d(r.role)}`,children:[l(r.role),c(r.role)]})})]})]})},wb=so("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-3.5 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),he=f.forwardRef(({className:t,variant:s,...n},i)=>e.jsx("div",{ref:i,role:"alert",className:U(wb({variant:s}),t),...n}));he.displayName="Alert";const bb=f.forwardRef(({className:t,...s},n)=>e.jsx("h5",{ref:n,className:U("mb-1 font-medium leading-none tracking-tight",t),...s}));bb.displayName="AlertTitle";const pe=f.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:U("text-sm [&_p]:leading-relaxed",t),...s}));pe.displayName="AlertDescription";const vb=so("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function B({className:t,variant:s,asChild:n=!1,...i}){const r=n?dc:"span";return e.jsx(r,{"data-slot":"badge",className:U(vb({variant:s}),t),...i})}const Nb=f.forwardRef(({...t},s)=>e.jsx("nav",{ref:s,"aria-label":"breadcrumb",...t}));Nb.displayName="Breadcrumb";const kb=f.forwardRef(({className:t,...s},n)=>e.jsx("ol",{ref:n,className:U("flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",t),...s}));kb.displayName="BreadcrumbList";const zb=f.forwardRef(({className:t,...s},n)=>e.jsx("li",{ref:n,className:U("inline-flex items-center gap-1.5",t),...s}));zb.displayName="BreadcrumbItem";const Sb=f.forwardRef(({asChild:t,className:s,...n},i)=>{const r=t?dc:"a";return e.jsx(r,{ref:i,className:U("transition-colors hover:text-foreground",s),...n})});Sb.displayName="BreadcrumbLink";const Cb=f.forwardRef(({className:t,...s},n)=>e.jsx("span",{ref:n,role:"link","aria-disabled":"true","aria-current":"page",className:U("font-normal text-foreground",t),...s}));Cb.displayName="BreadcrumbPage";const _b=so("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),M=f.forwardRef(({className:t,variant:s,size:n,asChild:i=!1,...r},a)=>{const o=i?dc:"button";return e.jsx(o,{className:U(_b({variant:s,size:n,className:t})),ref:a,...r})});M.displayName="Button";const I=f.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:U("rounded-xl border bg-card text-card-foreground shadow flex flex-col overflow-hidden",t),...s}));I.displayName="Card";const O=f.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:U("flex flex-col space-y-1.5 p-6 pb-3 bg-pink-200/25",t),...s}));O.displayName="CardHeader";const $=f.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:U("text-lg font-semibold leading-tight tracking-tight pt-3",t),...s}));$.displayName="CardTitle";const oo=f.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:U("text-sm text-muted-foreground",t),...s}));oo.displayName="CardDescription";const E=f.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:U("p-3 lg:p-6 pt-3 space-y-3 flex-1 bg-background",t),...s}));E.displayName="CardContent";const Tb=f.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:U("flex items-center justify-between p-6 pt-0",t),...s}));Tb.displayName="CardFooter";const Ab=so("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Tn=f.forwardRef(({className:t,...s},n)=>e.jsx(wh,{ref:n,className:U(Ab(),t),...s}));Tn.displayName=wh.displayName;f.createContext({});f.createContext({});const J=f.forwardRef(({className:t,type:s,...n},i)=>e.jsx("input",{type:s,className:U("flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:i,...n}));J.displayName="Input";const Pb=f.forwardRef(({className:t,align:s="center",sideOffset:n=4,...i},r)=>e.jsx(dy,{children:e.jsx(bh,{ref:r,align:s,sideOffset:n,className:U("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",t),...i})}));Pb.displayName=bh.displayName;const Ze=f.forwardRef(({className:t,children:s,...n},i)=>e.jsxs(vh,{ref:i,className:U("relative overflow-hidden",t),...n,children:[e.jsx(uy,{className:"h-full w-full rounded-[inherit]",children:s}),e.jsx(jp,{}),e.jsx(my,{})]}));Ze.displayName=vh.displayName;const jp=f.forwardRef(({className:t,orientation:s="vertical",...n},i)=>e.jsx(Nh,{ref:i,orientation:s,className:U("flex touch-none select-none transition-colors",s==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",s==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...n,children:e.jsx(hy,{className:"relative flex-1 rounded-full bg-border"})}));jp.displayName=Nh.displayName;const we=yy,be=wy,ge=f.forwardRef(({className:t,children:s,...n},i)=>e.jsxs(kh,{ref:i,className:U("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-background px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...n,children:[s,e.jsx(py,{asChild:!0,children:e.jsx(Dt,{className:"h-4 w-4 opacity-50"})})]}));ge.displayName=kh.displayName;const yp=f.forwardRef(({className:t,...s},n)=>e.jsx(zh,{ref:n,className:U("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(Rr,{className:"h-4 w-4"})}));yp.displayName=zh.displayName;const wp=f.forwardRef(({className:t,...s},n)=>e.jsx(Sh,{ref:n,className:U("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(Dt,{className:"h-4 w-4"})}));wp.displayName=Sh.displayName;const je=f.forwardRef(({className:t,children:s,position:n="popper",...i},r)=>e.jsx(fy,{children:e.jsxs(Ch,{ref:r,className:U("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...i,children:[e.jsx(yp,{}),e.jsx(xy,{className:U("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),e.jsx(wp,{})]})}));je.displayName=Ch.displayName;const Db=f.forwardRef(({className:t,...s},n)=>e.jsx(_h,{ref:n,className:U("px-2 py-1.5 text-sm font-semibold",t),...s}));Db.displayName=_h.displayName;const Y=f.forwardRef(({className:t,children:s,...n},i)=>e.jsxs(Th,{ref:i,className:U("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[e.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(gy,{children:e.jsx($t,{className:"h-4 w-4"})})}),e.jsx(jy,{children:s})]}));Y.displayName=Th.displayName;const Mb=f.forwardRef(({className:t,...s},n)=>e.jsx(Ah,{ref:n,className:U("-mx-1 my-1 h-px bg-muted",t),...s}));Mb.displayName=Ah.displayName;const lo=f.forwardRef(({className:t,orientation:s="horizontal",decorative:n=!0,...i},r)=>e.jsx(Ph,{ref:r,decorative:n,orientation:s,className:U("shrink-0 bg-border",s==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...i}));lo.displayName=Ph.displayName;function $s({className:t,...s}){return e.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:e.jsx("table",{"data-slot":"table",className:U("w-full caption-bottom text-sm",t),...s})})}function qs({className:t,...s}){return e.jsx("thead",{"data-slot":"table-header",className:U("[&_tr]:border-b",t),...s})}function Fs({className:t,...s}){return e.jsx("tbody",{"data-slot":"table-body",className:U("[&_tr:last-child]:border-0",t),...s})}function Xe({className:t,...s}){return e.jsx("tr",{"data-slot":"table-row",className:U("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...s})}function ne({className:t,...s}){return e.jsx("th",{"data-slot":"table-head",className:U("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...s})}function se({className:t,...s}){return e.jsx("td",{"data-slot":"table-cell",className:U("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...s})}const cs=f.forwardRef(({className:t,...s},n)=>e.jsx("textarea",{className:U("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:n,...s}));cs.displayName="Textarea";const wc=by,co=f.forwardRef(({className:t,...s},n)=>e.jsx(Dh,{ref:n,className:U("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",t),...s}));co.displayName=Dh.displayName;const Gt=f.forwardRef(({className:t,...s},n)=>e.jsx(Mh,{ref:n,className:U("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",t),...s}));Gt.displayName=Mh.displayName;const Ht=f.forwardRef(({className:t,...s},n)=>e.jsx(Ih,{ref:n,className:U("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...s}));Ht.displayName=Ih.displayName;const Ke=f.forwardRef(({className:t,...s},n)=>e.jsx(Eh,{ref:n,className:U("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...s,children:e.jsx(vy,{className:U("flex items-center justify-center text-current"),children:e.jsx($t,{className:"h-4 w-4"})})}));Ke.displayName=Eh.displayName;var uo="Switch",[Ib,BD]=uc(uo),[Eb,Lb]=Ib(uo),bp=f.forwardRef((t,s)=>{const{__scopeSwitch:n,name:i,checked:r,defaultChecked:a,required:o,disabled:l,value:c="on",onCheckedChange:d,form:u,...m}=t,[h,p]=f.useState(null),j=Os(s,v=>p(v)),y=f.useRef(!1),x=h?u||!!h.closest("form"):!0,[g,b]=Lh({prop:r,defaultProp:a??!1,onChange:d,caller:uo});return e.jsxs(Eb,{scope:n,checked:g,disabled:l,children:[e.jsx(Ss.button,{type:"button",role:"switch","aria-checked":g,"aria-required":o,"data-state":zp(g),"data-disabled":l?"":void 0,disabled:l,value:c,...m,ref:j,onClick:ye(t.onClick,v=>{b(C=>!C),x&&(y.current=v.isPropagationStopped(),y.current||v.stopPropagation())})}),x&&e.jsx(kp,{control:h,bubbles:!y.current,name:i,value:c,checked:g,required:o,disabled:l,form:u,style:{transform:"translateX(-100%)"}})]})});bp.displayName=uo;var vp="SwitchThumb",Np=f.forwardRef((t,s)=>{const{__scopeSwitch:n,...i}=t,r=Lb(vp,n);return e.jsx(Ss.span,{"data-state":zp(r.checked),"data-disabled":r.disabled?"":void 0,...i,ref:s})});Np.displayName=vp;var Rb="SwitchBubbleInput",kp=f.forwardRef(({__scopeSwitch:t,control:s,checked:n,bubbles:i=!0,...r},a)=>{const o=f.useRef(null),l=Os(o,a),c=Ny(n),d=ky(s);return f.useEffect(()=>{const u=o.current;if(!u)return;const m=window.HTMLInputElement.prototype,p=Object.getOwnPropertyDescriptor(m,"checked").set;if(c!==n&&p){const j=new Event("click",{bubbles:i});p.call(u,n),u.dispatchEvent(j)}},[c,n,i]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n,...r,tabIndex:-1,ref:l,style:{...r.style,...d,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});kp.displayName=Rb;function zp(t){return t?"checked":"unchecked"}var Sp=bp,Ob=Np;const zt=f.forwardRef(({className:t,...s},n)=>e.jsx(Sp,{className:U("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...s,ref:n,children:e.jsx(Ob,{className:U("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));zt.displayName=Sp.displayName;const Xn=Sy,ei=Cy,ti=_y,jn=f.forwardRef(({className:t,sideOffset:s=4,...n},i)=>e.jsx(zy,{children:e.jsx(Rh,{ref:i,sideOffset:s,className:U("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",t),...n})}));jn.displayName=Rh.displayName;const ds=Py,$b=Ty,Cp=f.forwardRef(({className:t,...s},n)=>e.jsx(Oh,{ref:n,className:U("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s}));Cp.displayName=Oh.displayName;const Jt=f.forwardRef(({className:t,children:s,...n},i)=>e.jsxs($b,{children:[e.jsx(Cp,{}),e.jsxs($h,{ref:i,className:U("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...n,children:[s,e.jsxs(Ay,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(ls,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Jt.displayName=$h.displayName;const Xt=({className:t,...s})=>e.jsx("div",{className:U("flex flex-col space-y-1.5 text-center sm:text-left",t),...s});Xt.displayName="DialogHeader";const wi=({className:t,...s})=>e.jsx("div",{className:U("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s});wi.displayName="DialogFooter";const es=f.forwardRef(({className:t,...s},n)=>e.jsx(qh,{ref:n,className:U("text-lg font-semibold leading-none tracking-tight",t),...s}));es.displayName=qh.displayName;const bi=f.forwardRef(({className:t,...s},n)=>e.jsx(Fh,{ref:n,className:U("text-sm text-muted-foreground",t),...s}));bi.displayName=Fh.displayName;const rs=f.forwardRef(({className:t,value:s,...n},i)=>e.jsx(Bh,{ref:i,className:U("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",t),...n,children:e.jsx(Dy,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}));rs.displayName=Bh.displayName;const qb=({onClose:t})=>{const{mutate:s}=Ja(),{menuItems:n}=Zh(),{data:i}=Ye(),r=()=>{t&&t()};return e.jsxs("div",{className:"flex h-full w-64 flex-col border-r bg-background",children:[e.jsxs("div",{className:"flex h-16 items-center justify-between border-b px-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Or,{className:"h-6 w-6 mr-2"}),e.jsx("span",{className:"font-semibold",children:"Smart Up"})]}),t&&e.jsx(M,{variant:"ghost",size:"sm",onClick:t,className:"lg:hidden",children:e.jsx(ls,{className:"h-4 w-4"})})]}),e.jsx(Ze,{className:"flex-1 px-3 py-4",children:e.jsx("nav",{className:"space-y-4",children:n.map(a=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(gi,{to:a.route??"/",onClick:r,className:({isActive:o})=>U("flex items-center justify-between rounded-md px-3 py-2 text-sm font-semibold transition-colors hover:bg-accent hover:text-accent-foreground",o?"bg-accent text-accent-foreground":"text-foreground"),children:[e.jsxs("span",{className:"flex items-center",children:[a.icon&&e.jsx("span",{className:"mr-3",children:a.icon}),a.label]}),a.children&&a.children.length>0&&e.jsx(Dt,{className:"h-4 w-4 opacity-60"})]}),a.children&&a.children.length>0&&e.jsx("div",{className:"ml-3 border-l pl-3 space-y-1",children:a.children.map(o=>e.jsxs(gi,{to:o.route??"/",onClick:r,className:({isActive:l})=>U("flex items-center rounded-md px-3 py-2 text-sm transition-colors hover:bg-accent hover:text-accent-foreground",l?"bg-accent text-accent-foreground":"text-muted-foreground"),children:[o.icon&&e.jsx("span",{className:"mr-3",children:o.icon}),o.label]},o.key))})]},a.key))})}),e.jsx(lo,{}),e.jsx(gp,{className:"border-b"}),e.jsx("div",{className:"p-4",children:e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>{s(),t&&t()},className:"w-full justify-start",children:[e.jsx(no,{className:"mr-2 h-4 w-4"}),"Logout"]})})]})},Fb=({children:t})=>{const[s,n]=f.useState(!1),i=()=>{n(!s)};return e.jsx("div",{className:"min-h-screen bg-stone-200 relative overflow-x-hidden",children:e.jsxs("div",{className:"flex relative",children:[s&&e.jsx("div",{className:"fixed inset-0 z-40 bg-purple-900/20 backdrop-blur-sm lg:hidden",onClick:()=>n(!1)}),e.jsx("aside",{className:`
            h-screen w-64 transform transition-transform duration-300 ease-in-out
            fixed left-0 top-0 z-50
            ${s?"translate-x-0":"-translate-x-full"}
            lg:translate-x-0
            bg-background/95 backdrop-blur-md border-r border-purple-200/20
          `,children:e.jsx(qb,{onClose:()=>n(!1)})}),e.jsxs("main",{className:"flex-1 lg:ml-64 min-w-0 relative z-10",children:[e.jsxs("div",{className:"sticky top-0 z-30 flex h-16 items-center border-b border-purple-200/20 bg-background/80 backdrop-blur-md px-4 lg:hidden",children:[e.jsx(M,{variant:"ghost",size:"sm",onClick:i,className:"mr-2 hover:bg-purple-100/20 hover:text-purple-700",children:e.jsx(Or,{className:"h-6 w-6"})}),e.jsx("span",{className:"font-semibold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:"Smart Up"})]}),t]})]})})},Bb=()=>e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Admin Dashboard"}),e.jsx("p",{children:"Welcome to admin panel"})]}),Ub=[e.jsx(H,{path:"dashboard/overview",element:e.jsx(Bb,{})},"dashboard-overview")],Z=({children:t})=>e.jsx("div",{className:"p-2 md:p-12 space-y-6 max-w-8xl mx-auto",children:t}),Vb=()=>e.jsx(I,{className:"border-purple/20 bg-purple/5 hover:shadow-md transition-shadow",children:e.jsx(E,{className:"p-5",children:e.jsxs("div",{className:"grid grid-cols-[auto_1fr] gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center gap-2 pr-4 border-r border-purple/20",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-purple flex items-center justify-center shadow-sm",children:e.jsx(Sa,{className:"w-6 h-6 text-purple-foreground"})}),e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-xs font-bold text-purple uppercase tracking-wide",children:"Role"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm text-foreground mb-1",children:"Zarządzaj rolami użytkowników"}),e.jsx("p",{className:"text-xs text-muted-foreground leading-relaxed",children:"Zmiana roli określa uprawnienia użytkownika w systemie"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2 text-xs",children:[e.jsx(Es,{className:"w-4 h-4 text-green-600 dark:text-green-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Uczeń"})," → może się uczyć z kursów (gdy dostanie dostęp przez grupy)"]})]}),e.jsxs("div",{className:"flex items-start gap-2 text-xs",children:[e.jsx(to,{className:"w-4 h-4 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Nauczyciel"})," → może edytować kursy (gdy zostanie przypisany)"]})]}),e.jsxs("div",{className:"flex items-start gap-2 text-xs",children:[e.jsx(Sa,{className:"w-4 h-4 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Administrator"})," → pełne uprawnienia do zarządzania systemem"]})]})]}),e.jsx("div",{className:"px-3 py-2 bg-background rounded-md border border-purple/20",children:e.jsxs("p",{className:"text-xs text-foreground",children:[e.jsx("strong",{children:"Co to robi?"})," Zmiana roli → użytkownik dostaje nowe uprawnienia w systemie"]})}),e.jsx("div",{className:"px-3 py-2 bg-orange/10 rounded-md border border-orange/20",children:e.jsxs("p",{className:"text-xs text-foreground leading-relaxed",children:[e.jsx("strong",{children:"Ważne:"})," Sama zmiana roli NIE przypisuje kursów ani grup - to robisz w innych modułach"]})})]})]})})}),Kb=({open:t,onOpenChange:s,user:n,onSuccess:i})=>{const[r,a]=f.useState(""),[o,l]=f.useState(!1),[c,d]=f.useState(!1),[u,m]=f.useState({activityProgress:!0,gamificationLog:!0,userStats:!0,userUpgrades:!0}),h=async()=>{if(n){if(r!==n.full_name){W.error("Nieprawidłowe potwierdzenie");return}l(!0);try{const g=[];u.activityProgress&&g.push(ee.from("activity_progress").delete().eq("user_id",n.id)),u.gamificationLog&&g.push(ee.from("gamification_log").delete().eq("user_id",n.id)),u.userUpgrades&&g.push(ee.from("user_upgrades").delete().eq("user_id",n.id)),u.userStats&&g.push(ee.from("user_stats").update({total_points:0,current_level:1,daily_streak:0,idle_points_rate:1,quizzes_completed:0,perfect_scores:0,total_time_spent:0}).eq("user_id",n.id));const b=await Promise.all(g);if(b.some(C=>C.error)){const C=b.filter(T=>T.error).map(T=>T.error);throw console.error("Errors during clear:",C),new Error("Błąd podczas czyszczenia danych")}W.success("Aktywności zostały wyczyszczone"),i(),s(!1),a("")}catch(g){console.error("Clear activities error:",g),W.error("Błąd podczas czyszczenia aktywności")}finally{l(!1)}}},p=g=>{o||(s(g),g||a(""))};if(!n)return null;const j=r===n.full_name,y=()=>{const g=[];return u.activityProgress&&g.push(`-- Usuń postępy w aktywnościach
DELETE FROM activity_progress WHERE user_id = '${n.id}';`),u.gamificationLog&&g.push(`-- Usuń historię gamifikacji
DELETE FROM gamification_log WHERE user_id = '${n.id}';`),u.userUpgrades&&g.push(`-- Usuń idle upgrades
DELETE FROM user_upgrades WHERE user_id = '${n.id}';`),u.userStats&&g.push(`-- Zresetuj statystyki
UPDATE user_stats
SET 
  total_points = 0,
  current_level = 1,
  daily_streak = 0,
  idle_points_rate = 1,
  quizzes_completed = 0,
  perfect_scores = 0,
  total_time_spent = 0,
  last_active = CURRENT_DATE,
  last_idle_claim = NOW()
WHERE user_id = '${n.id}';`),g.join(`

`)},x=()=>{const g=y();navigator.clipboard.writeText(g),W.success("SQL skopiowany do schowka")};return e.jsx(ds,{open:t,onOpenChange:p,children:e.jsxs(Jt,{className:"max-w-4xl",children:[e.jsxs(Xt,{children:[e.jsxs(es,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(Ca,{className:"w-5 h-5"}),"Wyczyść wszystkie aktywności"]}),e.jsx(bi,{className:"text-left",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{children:["Ta akcja usunie dane użytkownika: ",e.jsx("strong",{children:n.full_name})]}),e.jsx("p",{className:"text-destructive font-medium",children:"Ta operacja jest nieodwracalna!"})]})})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(Tn,{className:"text-sm font-medium",children:"Co chcesz wyczyścić?"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ke,{id:"activityProgress",checked:u.activityProgress,onCheckedChange:g=>m({...u,activityProgress:g})}),e.jsx("label",{htmlFor:"activityProgress",className:"text-sm leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Postępy w aktywnościach (quizy, materiały)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ke,{id:"gamificationLog",checked:u.gamificationLog,onCheckedChange:g=>m({...u,gamificationLog:g})}),e.jsx("label",{htmlFor:"gamificationLog",className:"text-sm leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Historia gamifikacji (logi punktów)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ke,{id:"userStats",checked:u.userStats,onCheckedChange:g=>m({...u,userStats:g})}),e.jsx("label",{htmlFor:"userStats",className:"text-sm leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Statystyki (punkty, poziom, streak)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ke,{id:"userUpgrades",checked:u.userUpgrades,onCheckedChange:g=>m({...u,userUpgrades:g})}),e.jsx("label",{htmlFor:"userUpgrades",className:"text-sm leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Idle upgrades"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Tn,{htmlFor:"confirmation",className:"text-sm font-medium",children:"Wpisz pełne imię i nazwisko użytkownika aby potwierdzić:"}),e.jsx(J,{id:"confirmation",value:r,onChange:g=>a(g.target.value),placeholder:n.full_name,className:"font-mono",disabled:o}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Wymagane: ",e.jsx("code",{className:"bg-muted px-1 py-0.5 rounded",children:n.full_name})]})]}),e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-destructive/10 rounded-md border border-destructive/20",children:[e.jsx(Ca,{className:"w-4 h-4 text-destructive flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-xs text-foreground leading-relaxed",children:[e.jsx("strong",{children:"UWAGA:"})," Po usunięciu danych nie będzie możliwości ich odzyskania. Użytkownik straci wszystkie postępy i będzie musiał zacząć od nowa."]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{type:"button",variant:"outline",size:"sm",onClick:()=>d(!c),className:"w-full",children:c?"Ukryj SQL":"Pokaż SQL (do ręcznego wykonania)"}),c&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("pre",{className:"p-3 bg-muted rounded text-xs overflow-x-auto max-h-[200px] overflow-y-auto",children:y()}),e.jsx(M,{type:"button",variant:"secondary",size:"sm",onClick:x,className:"w-full",children:"Skopiuj SQL do schowka"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Możesz skopiować ten SQL i wykonać go ręcznie w Supabase SQL Editor"})]})]})]}),e.jsxs(wi,{children:[e.jsx(M,{variant:"outline",onClick:()=>p(!1),disabled:o,children:"Anuluj"}),e.jsx(M,{variant:"destructive",onClick:h,disabled:!j||o,children:o?e.jsxs(e.Fragment,{children:[e.jsx(lt,{className:"w-4 h-4 mr-2 animate-spin"}),"Czyszczenie..."]}):e.jsxs(e.Fragment,{children:[e.jsx(dt,{className:"w-4 h-4 mr-2"}),"Wyczyść aktywności"]})})]})]})})},Wb=()=>{const[t,s]=f.useState(""),[n,i]=f.useState("all"),[r,a]=f.useState(!1),[o,l]=f.useState(null),{data:c,isLoading:d,refetch:u}=Q({resource:"users",pagination:{pageSize:1e3},sorters:[{field:"full_name",order:"asc"}]}),{mutate:m}=En(),h=c?.data??[],p=f.useMemo(()=>({total:h.length,students:h.filter(v=>v.role==="student").length,teachers:h.filter(v=>v.role==="teacher").length,admins:h.filter(v=>v.role==="admin").length}),[h]),j=f.useMemo(()=>h.filter(v=>{const C=!t||v.full_name.toLowerCase().includes(t.toLowerCase())||v.email.toLowerCase().includes(t.toLowerCase()),T=n==="all"||v.role===n;return C&&T}),[h,t,n]),y=(v,C)=>{m({resource:"users",id:v,values:{role:C}},{onSuccess:()=>{W.success("Rola zmieniona"),u()},onError:()=>W.error("Błąd zmiany roli")})},x=(v,C)=>{m({resource:"users",id:v,values:{is_active:!C}},{onSuccess:()=>{W.success(C?"Konto dezaktywowane":"Konto aktywowane"),u()},onError:()=>W.error("Błąd zmiany statusu")})},g=v=>{l(v),a(!0)},b=v=>{switch(v){case"admin":return e.jsxs(B,{className:"bg-red-500",children:[e.jsx(Sa,{className:"w-3 h-3 mr-1"}),"Administrator"]});case"teacher":return e.jsxs(B,{className:"bg-blue-500",children:[e.jsx(to,{className:"w-3 h-3 mr-1"}),"Nauczyciel"]});default:return e.jsxs(B,{className:"bg-green-500",children:[e.jsx(Es,{className:"w-3 h-3 mr-1"}),"Uczeń"]})}};return e.jsx(Z,{children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Użytkownicy"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Zarządzaj rolami użytkowników w systemie"})]}),e.jsx(Vb,{}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsx(I,{children:e.jsxs(E,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold",children:p.total}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Wszyscy"})]})}),e.jsx(I,{className:"border-green-200 bg-green-50/50 dark:border-green-900 dark:bg-green-950/20",children:e.jsxs(E,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:p.students}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Uczniowie"})]})}),e.jsx(I,{className:"border-blue-200 bg-blue-50/50 dark:border-blue-900 dark:bg-blue-950/20",children:e.jsxs(E,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600 dark:text-blue-400",children:p.teachers}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Nauczyciele"})]})}),e.jsx(I,{className:"border-red-200 bg-red-50/50 dark:border-red-900 dark:bg-red-950/20",children:e.jsxs(E,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-red-600 dark:text-red-400",children:p.admins}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Administratorzy"})]})})]}),e.jsx(I,{children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Ti,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(J,{placeholder:"Szukaj po imieniu lub emailu...",value:t,onChange:v=>s(v.target.value),className:"pl-9"})]}),e.jsxs(we,{value:n,onValueChange:v=>i(v),children:[e.jsx(ge,{className:"w-[200px]",children:e.jsx(be,{})}),e.jsxs(je,{children:[e.jsx(Y,{value:"all",children:"Wszystkie role"}),e.jsx(Y,{value:"student",children:"Tylko uczniowie"}),e.jsx(Y,{value:"teacher",children:"Tylko nauczyciele"}),e.jsx(Y,{value:"admin",children:"Tylko administratorzy"})]})]})]})})}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{children:["Użytkownicy (",j.length,")"]})}),e.jsx(E,{className:"p-0",children:d?e.jsx("div",{className:"p-8 text-center",children:"Ładowanie..."}):j.length===0?e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"Nie znaleziono użytkowników"}):e.jsxs($s,{children:[e.jsx(qs,{children:e.jsxs(Xe,{children:[e.jsx(ne,{children:"Użytkownik"}),e.jsx(ne,{children:"Email"}),e.jsx(ne,{children:"Obecna rola"}),e.jsx(ne,{children:"Zmień rolę"}),e.jsx(ne,{className:"text-center",children:"Aktywny"}),e.jsx(ne,{className:"text-center",children:"Akcje"})]})}),e.jsx(Fs,{children:j.map(v=>e.jsxs(Xe,{className:v.is_active?"":"opacity-50",children:[e.jsx(se,{className:"font-medium",children:v.full_name}),e.jsx(se,{className:"text-sm text-muted-foreground",children:v.email}),e.jsx(se,{children:b(v.role)}),e.jsx(se,{children:e.jsxs(we,{value:v.role,onValueChange:C=>y(v.id,C),children:[e.jsx(ge,{className:"w-[160px] h-8",children:e.jsx(be,{})}),e.jsxs(je,{children:[e.jsx(Y,{value:"student",children:"Uczeń"}),e.jsx(Y,{value:"teacher",children:"Nauczyciel"}),e.jsx(Y,{value:"admin",children:"Administrator"})]})]})}),e.jsx(se,{className:"text-center",children:e.jsx(zt,{checked:v.is_active,onCheckedChange:()=>x(v.id,v.is_active)})}),e.jsx(se,{className:"text-center",children:e.jsx(M,{variant:"ghost",size:"sm",onClick:()=>g(v),className:"text-destructive hover:text-destructive hover:bg-destructive/10",children:e.jsx(dt,{className:"w-4 h-4"})})})]},v.id))})]})})]}),e.jsx(Kb,{open:r,onOpenChange:a,user:o,onSuccess:()=>{u()}})]})})},Gb=()=>e.jsx(I,{className:"border-primary/20 bg-primary/5 hover:shadow-md transition-shadow",children:e.jsx(E,{className:"p-5",children:e.jsxs("div",{className:"grid grid-cols-[auto_1fr] gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center gap-2 pr-4 border-r border-primary/20",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-primary flex items-center justify-center shadow-sm",children:e.jsx(ce,{className:"w-6 h-6 text-primary-foreground"})}),e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-xs font-bold text-primary uppercase tracking-wide",children:"Grupy"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm text-foreground mb-1",children:"Co to jest grupa?"}),e.jsxs("p",{className:"text-xs text-muted-foreground leading-relaxed",children:['Grupa = kontener na uczniów (np. "Klasa 1A"). Sama grupa ',e.jsx("strong",{children:"NIE DAJE"})," dostępu do żadnych kursów."]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-primary"}),e.jsx("span",{children:"Organizujesz uczniów w logiczne klasy/zespoły"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-primary"}),e.jsx("span",{children:"Możesz dodawać i usuwać uczniów z grupy"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-primary"}),e.jsx("span",{children:"Grupa służy tylko do organizacji"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-background rounded-md border border-primary/20",children:[e.jsx(mw,{className:"w-4 h-4 text-primary flex-shrink-0"}),e.jsx(Ce,{className:"w-3 h-3 text-muted-foreground flex-shrink-0"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Aby dać dostęp do kursów → użyj modułu ",e.jsx("strong",{children:'"Kursy dla grup"'})]})]})]})]})})}),Hb=()=>{const[t,s]=f.useState(""),[n,i]=f.useState(!1),[r,a]=f.useState(!1),[o,l]=f.useState(null),[c,d]=f.useState(""),[u,m]=f.useState("2024/2025"),[h,p]=f.useState(""),[j,y]=f.useState(new Set),{data:x,isLoading:g,refetch:b}=Q({resource:"groups",pagination:{pageSize:1e3},sorters:[{field:"name",order:"asc"}]}),{data:v}=Q({resource:"users",filters:[{field:"role",operator:"eq",value:"student"},{field:"is_active",operator:"eq",value:!0}],pagination:{pageSize:1e3},sorters:[{field:"full_name",order:"asc"}],queryOptions:{enabled:r}}),{data:C,refetch:T}=Q({resource:"group_members",pagination:{pageSize:1e4},meta:{select:"*, users!inner(full_name, email)"}}),{mutate:z}=os(),{mutate:N}=En(),{mutate:S}=Is(),P=x?.data??[],w=v?.data??[],k=C?.data??[],_=f.useMemo(()=>{const V={};return P.forEach(oe=>{V[oe.id]=k.filter(Se=>Se.group_id===oe.id).length}),V},[P,k]),A=f.useMemo(()=>P.filter(V=>!t||V.name.toLowerCase().includes(t.toLowerCase())||V.academic_year.includes(t)),[P,t]),D=f.useMemo(()=>o?k.filter(V=>V.group_id===o.id):[],[o,k]),R=f.useMemo(()=>{if(!o)return[];const V=new Set(D.map(oe=>oe.user_id));return w.filter(oe=>!V.has(oe.id)&&(!h||oe.full_name.toLowerCase().includes(h.toLowerCase())||oe.email.toLowerCase().includes(h.toLowerCase())))},[o,w,D,h]),L=()=>{c.trim()&&z({resource:"groups",values:{name:c,academic_year:u,vendor_id:1}},{onSuccess:()=>{W.success("Grupa utworzona"),i(!1),d(""),b()},onError:()=>W.error("Błąd tworzenia grupy")})},F=V=>{confirm("Czy na pewno chcesz usunąć tę grupę?")&&S({resource:"groups",id:V},{onSuccess:()=>{W.success("Grupa usunięta"),b()},onError:()=>W.error("Błąd usuwania grupy")})},K=V=>{N({resource:"groups",id:V.id,values:{is_active:!V.is_active}},{onSuccess:()=>{W.success(V.is_active?"Grupa dezaktywowana":"Grupa aktywowana"),b()},onError:()=>W.error("Błąd zmiany statusu")})},q=V=>{l(V),a(!0),y(new Set),p("")},G=async()=>{if(!(!o||j.size===0))try{const V=Array.from(j).map(Se=>({group_id:o.id,user_id:Se})),{error:oe}=await ee.from("group_members").insert(V);if(oe)throw oe;W.success(`Dodano ${j.size} uczniów`),y(new Set),p(""),T()}catch{W.error("Błąd dodawania uczniów")}},X=async V=>{if(o)try{const{error:oe}=await ee.from("group_members").delete().eq("group_id",o.id).eq("user_id",V);if(oe)throw oe;W.success("Uczeń usunięty z grupy"),T()}catch{W.error("Błąd usuwania ucznia")}};return e.jsxs(Z,{children:[e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Grupy i uczniowie"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Twórz klasy i przypisuj uczniów"})]}),e.jsxs(M,{onClick:()=>i(!0),children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Nowa grupa"]})]}),e.jsx(Gb,{}),e.jsx(I,{children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ti,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(J,{placeholder:"Szukaj grupy...",value:t,onChange:V=>s(V.target.value),className:"pl-9"})]})})}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{children:["Grupy (",P.length,")"]})}),e.jsx(E,{className:"p-0",children:g?e.jsx("div",{className:"p-8 text-center",children:"Ładowanie..."}):A.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(ce,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground/50"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:t?"Nie znaleziono grup":"Brak grup"}),e.jsxs(M,{onClick:()=>i(!0),children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Utwórz pierwszą grupę"]})]}):e.jsxs($s,{children:[e.jsx(qs,{children:e.jsxs(Xe,{children:[e.jsx(ne,{children:"Nazwa grupy"}),e.jsx(ne,{children:"Rok akademicki"}),e.jsx(ne,{className:"text-center",children:"Liczba uczniów"}),e.jsx(ne,{className:"text-center",children:"Status"}),e.jsx(ne,{className:"text-center",children:"Akcje"})]})}),e.jsx(Fs,{children:A.map(V=>e.jsxs(Xe,{children:[e.jsx(se,{className:"font-medium",children:V.name}),e.jsx(se,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(At,{className:"w-4 h-4 text-muted-foreground"}),V.academic_year]})}),e.jsx(se,{className:"text-center",children:e.jsxs(B,{variant:"secondary",children:[_[V.id]||0," uczniów"]})}),e.jsx(se,{className:"text-center",children:e.jsx(zt,{checked:V.is_active,onCheckedChange:()=>K(V)})}),e.jsx(se,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs(M,{size:"sm",variant:"outline",onClick:()=>q(V),children:[e.jsx(ce,{className:"w-4 h-4 mr-1"}),"Zarządzaj uczniami"]}),e.jsx(M,{size:"sm",variant:"ghost",onClick:()=>F(V.id),className:"text-red-600",children:e.jsx(dt,{className:"w-4 h-4"})})]})})]},V.id))})]})})]})]}),e.jsx(ds,{open:n,onOpenChange:i,children:e.jsxs(Jt,{children:[e.jsx(Xt,{children:e.jsx(es,{children:"Utwórz nową grupę"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Tn,{htmlFor:"name",children:"Nazwa grupy"}),e.jsx(J,{id:"name",value:c,onChange:V=>d(V.target.value),placeholder:"np. Klasa 1A"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Tn,{htmlFor:"year",children:"Rok akademicki"}),e.jsx(J,{id:"year",value:u,onChange:V=>m(V.target.value),placeholder:"np. 2024/2025"})]})]}),e.jsxs(wi,{children:[e.jsx(M,{variant:"outline",onClick:()=>i(!1),children:"Anuluj"}),e.jsx(M,{onClick:L,disabled:!c.trim(),children:"Utwórz"})]})]})}),e.jsx(ds,{open:r,onOpenChange:a,children:e.jsxs(Jt,{className:"max-w-4xl max-h-[80vh]",children:[e.jsx(Xt,{children:e.jsxs(es,{children:["Uczniowie w grupie: ",o?.name]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"font-medium text-sm",children:["Obecni uczniowie (",D.length,")"]}),e.jsx(Ze,{className:"h-[400px] border rounded-lg p-3",children:D.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Brak uczniów w grupie"}):e.jsx("div",{className:"space-y-2",children:D.map(V=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded hover:bg-muted",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:V.users?.full_name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:V.users?.email})]}),e.jsx(M,{size:"sm",variant:"ghost",onClick:()=>X(V.user_id),className:"text-red-600",children:e.jsx(dt,{className:"w-4 h-4"})})]},V.user_id))})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"font-medium text-sm",children:["Dostępni uczniowie (",R.length,")"]}),e.jsx(J,{placeholder:"Szukaj ucznia...",value:h,onChange:V=>p(V.target.value),className:"h-9"}),e.jsx(Ze,{className:"h-[350px] border rounded-lg p-3",children:R.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:h?"Nie znaleziono":"Wszyscy uczniowie są w grupie"}):e.jsx("div",{className:"space-y-2",children:R.map(V=>e.jsxs("label",{className:"flex items-center gap-3 p-2 rounded hover:bg-muted cursor-pointer",children:[e.jsx(Ke,{checked:j.has(V.id),onCheckedChange:oe=>{const Se=new Set(j);oe?Se.add(V.id):Se.delete(V.id),y(Se)}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:V.full_name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:V.email})]})]},V.id))})}),j.size>0&&e.jsxs(M,{onClick:G,className:"w-full",children:[e.jsx(Cn,{className:"w-4 h-4 mr-2"}),"Dodaj zaznaczonych (",j.size,")"]})]})]}),e.jsx(wi,{children:e.jsx(M,{variant:"outline",onClick:()=>a(!1),children:"Zamknij"})})]})})]})},Qb=({open:t,onOpenChange:s,course:n,teachers:i,access:r,refetchAccess:a})=>{const[o,l]=f.useState(""),[c,d]=f.useState(!1),u=f.useMemo(()=>n?new Set(r.filter(p=>p.course_id===n.id&&p.teacher_id).map(p=>p.teacher_id)):new Set,[n,r]),m=f.useMemo(()=>i.filter(p=>!o||p.full_name.toLowerCase().includes(o.toLowerCase())||p.email.toLowerCase().includes(o.toLowerCase())),[i,o]),h=async p=>{if(!n||c)return;const j=u.has(p);d(!0);try{if(j){const{error:y}=await ee.from("course_access").delete().eq("teacher_id",p).eq("course_id",n.id);if(y)throw y}else{const{error:y}=await ee.from("course_access").insert({course_id:n.id,teacher_id:p,group_id:null});if(y)throw y}await a(),W.success(j?"Usunięto przypisanie":"Dodano przypisanie")}catch{W.error("Błąd przypisania")}finally{d(!1)}};return n?e.jsx(ds,{open:t,onOpenChange:s,children:e.jsxs(Jt,{className:"max-w-2xl max-h-[80vh]",children:[e.jsx(Xt,{children:e.jsx(es,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(to,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsxs("div",{children:["Nauczyciele dla kursu: ",n.title]}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Zaznacz nauczycieli, którzy mają dostęp do tego kursu"})]})]})})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(J,{placeholder:"Szukaj nauczyciela...",value:o,onChange:p=>l(p.target.value),className:"h-9"}),e.jsx(Ze,{className:"h-[400px] border rounded-lg p-3",children:e.jsx("div",{className:"space-y-2",children:m.map(p=>{const j=u.has(p.id);return e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border-2 cursor-pointer transition-all ${j?"border-primary bg-primary/5":"border-transparent hover:bg-muted"}`,onClick:()=>h(p.id),children:[e.jsx(Ke,{checked:j,disabled:c,onClick:y=>y.stopPropagation(),onCheckedChange:()=>h(p.id)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:p.full_name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:p.email})]})]},p.id)})})})]}),e.jsxs(wi,{children:[e.jsx(M,{variant:"outline",onClick:()=>s(!1),disabled:c,children:"Zamknij"}),c&&e.jsx(lt,{className:"w-4 h-4 animate-spin ml-2"})]})]})}):null},Zb=({courses:t,getAssignmentCount:s,onTogglePublish:n,onDelete:i,onManage:r})=>e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{children:["Kursy (",t.length,")"]})}),e.jsx(E,{className:"p-0",children:e.jsxs($s,{children:[e.jsx(qs,{children:e.jsxs(Xe,{children:[e.jsx(ne,{children:"Kurs"}),e.jsx(ne,{className:"text-center",children:"Opublikowany"}),e.jsx(ne,{className:"text-center",children:"Liczba przypisań"}),e.jsx(ne,{className:"text-center",children:"Akcje"})]})}),e.jsx(Fs,{children:t.map(a=>e.jsxs(Xe,{children:[e.jsxs(se,{className:"font-medium flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:a.icon_emoji||"📘"}),a.title]}),e.jsx(se,{className:"text-center",children:e.jsx(zt,{checked:a.is_published,onCheckedChange:()=>n(a.id,a.is_published)})}),e.jsx(se,{className:"text-center",children:e.jsxs(B,{variant:"secondary",children:[s(a.id)," przypisań"]})}),e.jsx(se,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs(M,{size:"sm",variant:"outline",onClick:()=>r(a),children:[e.jsx(xe,{className:"w-4 h-4 mr-1"})," Zarządzaj"]}),e.jsx(M,{size:"sm",variant:"ghost",className:"text-red-600",onClick:()=>i(a.id),children:e.jsx(dt,{className:"w-4 h-4"})})]})})]},a.id))})]})})]}),Yb=()=>{const[t,s]=f.useState(null),[n,i]=f.useState(!1),{data:r,refetch:a}=Q({resource:"courses",pagination:{pageSize:1e3},sorters:[{field:"title",order:"asc"}]}),{data:o}=Q({resource:"users",filters:[{field:"role",operator:"eq",value:"teacher"},{field:"is_active",operator:"eq",value:!0}],pagination:{pageSize:1e3}}),{data:l,refetch:c}=Q({resource:"course_access",pagination:{pageSize:1e4}}),d=r?.data??[],u=o?.data??[],m=(l?.data??[]).filter(x=>x.teacher_id!==null),h=x=>m.filter(g=>g.course_id===x).length,p=async(x,g)=>{const{error:b}=await ee.from("courses").update({is_published:!g}).eq("id",x);b?W.error("Błąd zmiany statusu"):(W.success(g?"Kurs ukryty":"Kurs opublikowany"),a())},j=async x=>{if(!confirm("Czy na pewno chcesz usunąć ten kurs?"))return;const{error:g}=await ee.from("courses").delete().eq("id",x);g?W.error("Błąd usuwania kursu"):(W.success("Kurs usunięty"),a())},y=x=>{s(x),i(!0)};return e.jsx(Z,{children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Kursy nauczycieli"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Zarządzaj przypisaniem nauczycieli do kursów"})]}),e.jsx(Zb,{courses:d,getAssignmentCount:h,onTogglePublish:p,onDelete:j,onManage:y}),e.jsx(Qb,{open:n,onOpenChange:i,course:t,teachers:u,access:m,refetchAccess:c})]})})},Jb=()=>{const[t,s]=f.useState(""),[n,i]=f.useState(""),[r,a]=f.useState(null),[o,l]=f.useState(!1),[c,d]=f.useState(!1),{data:u,isLoading:m,refetch:h}=Q({resource:"courses",pagination:{pageSize:1e3},sorters:[{field:"title",order:"asc"}]}),{data:p}=Q({resource:"groups",filters:[{field:"is_active",operator:"eq",value:!0}],pagination:{pageSize:1e3},sorters:[{field:"name",order:"asc"}],queryOptions:{enabled:o}}),{data:j,refetch:y}=Q({resource:"course_access",pagination:{pageSize:1e4}}),x=u?.data??[],g=p?.data??[],b=f.useMemo(()=>(j?.data??[]).filter(k=>k.group_id!==null),[j]),v=f.useMemo(()=>x.filter(k=>!t||k.title.toLowerCase().includes(t.toLowerCase())),[x,t]),C=f.useMemo(()=>{const k={};return v.forEach(_=>{k[_.id]=b.filter(A=>A.course_id===_.id).length}),k},[v,b]),T=f.useMemo(()=>r?new Set(b.filter(k=>k.course_id===r.id).map(k=>k.group_id)):new Set,[r,b]),z=f.useMemo(()=>g.filter(k=>!n||k.name.toLowerCase().includes(n.toLowerCase())||k.academic_year.includes(n)),[g,n]),N=k=>{a(k),i(""),l(!0)},S=async k=>{if(!r||c)return;const _=T.has(k);d(!0);try{if(_){const{error:A}=await ee.from("course_access").delete().eq("course_id",r.id).eq("group_id",k);if(A)throw A;W.success("Usunięto grupę z kursu")}else{const{error:A}=await ee.from("course_access").insert({course_id:r.id,group_id:k,teacher_id:null});if(A)throw A;W.success("Dodano grupę do kursu")}await y()}catch(A){W.error(A.message||"Wystąpił błąd")}finally{d(!1)}},P=async k=>{try{const{error:_}=await ee.from("courses").update({is_published:!k.is_published}).eq("id",k.id);if(_)throw _;W.success(k.is_published?"Przeniesiono do szkicu":"Opublikowano kurs"),await h()}catch(_){W.error(_.message||"Błąd zmiany publikacji")}},w=async k=>{if(confirm("Na pewno usunąć ten kurs? Tej operacji nie można cofnąć."))try{const{error:_}=await ee.from("courses").delete().eq("id",k);if(_)throw _;W.success("Kurs usunięty"),await h(),await y()}catch(_){W.error(_.message||"Błąd usuwania kursu")}};return e.jsxs(Z,{children:[e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Kursy dla grup"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Najpierw wybierz kurs, potem przypisz do niego grupy"})]}),e.jsx(I,{children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ti,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(J,{placeholder:"Szukaj kursu...",value:t,onChange:k=>s(k.target.value),className:"pl-9"})]})})}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{children:["Kursy (",v.length,")"]})}),e.jsx(E,{className:"p-0",children:m?e.jsx("div",{className:"p-8 text-center",children:"Ładowanie..."}):v.length===0?e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"Brak kursów"}):e.jsxs($s,{children:[e.jsx(qs,{children:e.jsxs(Xe,{children:[e.jsx(ne,{children:"Kurs"}),e.jsx(ne,{className:"text-center",children:"Grupy"}),e.jsx(ne,{className:"text-center",children:"Publikacja"}),e.jsx(ne,{className:"text-center",children:"Akcje"})]})}),e.jsx(Fs,{children:v.map(k=>e.jsxs(Xe,{children:[e.jsx(se,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:k.icon_emoji||"📚"}),k.title,k.is_published?e.jsx(B,{variant:"secondary",className:"ml-2",children:"Opublikowany"}):e.jsx(B,{className:"ml-2",children:"Szkic"})]})}),e.jsx(se,{className:"text-center",children:e.jsxs(B,{variant:"secondary",children:[C[k.id]||0," grup"]})}),e.jsx(se,{className:"text-center",children:e.jsx(zt,{checked:!!k.is_published,onCheckedChange:()=>P(k)})}),e.jsx(se,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs(M,{size:"sm",variant:"outline",onClick:()=>N(k),children:[e.jsx(ce,{className:"w-4 h-4 mr-1"}),"Zarządzaj grupami"]}),e.jsx(M,{size:"sm",variant:"ghost",onClick:()=>w(k.id),className:"text-red-600",children:e.jsx(dt,{className:"w-4 h-4"})})]})})]},k.id))})]})})]})]}),e.jsx(ds,{open:o,onOpenChange:l,children:e.jsxs(Jt,{className:"max-w-2xl max-h-[80vh]",children:[e.jsx(Xt,{children:e.jsx(es,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsxs("div",{children:["Grupy dla kursu: ",r?.title]}),e.jsx("div",{className:"text-sm font-normal text-muted-foreground mt-1",children:"Zaznacz grupy, które mają mieć dostęp do tego kursu"})]})]})})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(J,{placeholder:"Szukaj grupy...",value:n,onChange:k=>i(k.target.value),className:"h-9"}),e.jsx(Ze,{className:"h-[420px] border rounded-lg p-3",children:e.jsxs("div",{className:"space-y-2",children:[z.map(k=>{const _=T.has(k.id);return e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border-2 cursor-pointer transition-all ${_?"border-primary bg-primary/5":"border-transparent hover:bg-muted"}`,onClick:()=>S(k.id),children:[e.jsx(Ke,{checked:_,disabled:c,onClick:A=>A.stopPropagation(),onCheckedChange:()=>S(k.id)}),e.jsx("span",{className:"text-2xl",children:"👥"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:k.name}),e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(At,{className:"w-3 h-3"}),k.academic_year]})]})]},k.id)}),z.length===0&&e.jsx("div",{className:"text-center text-muted-foreground py-10 text-sm",children:"Brak wyników"})]})})]}),e.jsx(wi,{children:e.jsx(M,{variant:"outline",onClick:()=>l(!1),children:"Zamknij"})})]})})]})},Xb={name:"permissions",list:"/admin/permissions",meta:{label:"Uprawnienia",icon:e.jsx(hw,{className:"h-4 w-4"})}},ev={name:"permissions-users",list:"/admin/permissions/users",meta:{label:"Użytkownicy",icon:e.jsx(ce,{className:"h-4 w-4"}),parent:"permissions"}},tv={name:"permissions-groups",list:"/admin/permissions/groups",meta:{label:"Grupy i uczniowie",icon:e.jsx(pw,{className:"h-4 w-4"}),parent:"permissions"}},sv={name:"permissions-teacher-courses",list:"/admin/permissions/teacher-courses",meta:{label:"Kursy nauczycieli",icon:e.jsx(xe,{className:"h-4 w-4"}),parent:"permissions"}},nv={name:"permissions-group-courses",list:"/admin/permissions/group-courses",meta:{label:"Kursy dla grup",icon:e.jsx(Es,{className:"h-4 w-4"}),parent:"permissions"}},iv=[e.jsx(H,{path:"permissions",element:e.jsx(as,{to:"/admin/permissions/users",replace:!0})},"permissions-default"),e.jsx(H,{path:"permissions/users",element:e.jsx(Wb,{})},"permissions-users"),e.jsx(H,{path:"permissions/groups",element:e.jsx(Hb,{})},"permissions-groups"),e.jsx(H,{path:"permissions/teacher-courses",element:e.jsx(Yb,{})},"permissions-teacher-courses"),e.jsx(H,{path:"permissions/group-courses",element:e.jsx(Jb,{})},"permissions-group-courses")],Vo=[Xb,ev,tv,sv,nv],rv={"between-center":"flex justify-between items-center gap-2",center:"flex justify-center items-center gap-2",start:"flex justify-start items-center gap-2",end:"flex justify-end items-center gap-2"},ie=({children:t,variant:s="between-center",className:n=""})=>{const i=rv[s],r=n?`${i} ${n}`:i;return e.jsx("div",{className:r,children:t})},av={"1-2-3":"grid gap-6 md:grid-cols-2 lg:grid-cols-3","1-2-2":"grid gap-6 md:grid-cols-2","1-1-1":"grid gap-6","2-2-4":"grid gap-6 grid-cols-2 lg:grid-cols-4"},nt=({children:t,variant:s="1-2-3",className:n=""})=>{const i=av[s],r=n?`${i} ${n}`:i;return e.jsx("div",{className:r,children:t})},_p=({current:t,pageSize:s,total:n,setCurrent:i,setPageSize:r,itemName:a="elementów",pageSizeOptions:o=[10,20,50]})=>{const l=Math.ceil(n/s),c=(t-1)*s+1,d=Math.min(t*s,n),u=t>1,m=t<l,h=()=>{const p=[];if(l<=5)for(let y=1;y<=l;y++)p.push(y);else{p.push(1),t>3&&p.push("...");const y=Math.max(2,t-1),x=Math.min(l-1,t+1);for(let g=y;g<=x;g++)p.push(g);t<l-2&&p.push("..."),p.push(l)}return p};return n===0?null:e.jsxs(ie,{className:"mt-6",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Pokazuje ",c,"-",d," z ",n," ",a]}),e.jsxs(ie,{className:"gap-2",children:[r&&e.jsxs(we,{value:s.toString(),onValueChange:p=>{r(parseInt(p)),i(1)},children:[e.jsx(ge,{className:"w-[100px]",children:e.jsx(be,{})}),e.jsx(je,{children:o.map(p=>e.jsxs(Y,{value:p.toString(),children:[p," / str."]},p))})]}),e.jsx(M,{variant:"outline",size:"sm",onClick:()=>i(t-1),disabled:!u,children:e.jsx(fw,{className:"w-4 h-4"})}),e.jsx("div",{className:"hidden sm:flex gap-1",children:h().map((p,j)=>p==="..."?e.jsx("span",{className:"px-3 py-1 text-sm text-muted-foreground",children:"..."},`ellipsis-${j}`):e.jsx(M,{variant:t===p?"default":"outline",size:"sm",onClick:()=>i(p),className:"min-w-[40px]",children:p},p))}),e.jsxs("div",{className:"flex sm:hidden items-center px-3 text-sm",children:[t," / ",l]}),e.jsx(M,{variant:"outline",size:"sm",onClick:()=>i(t+1),disabled:!m,children:e.jsx(Ae,{className:"w-4 h-4"})})]})]})},ov={card:{wrap:"space-y-0",title:"font-medium",description:"text-muted-foreground"},lg:{wrap:"space-y-0",title:"text-3xl font-bold tracking-tight",description:"text-muted-foreground"},md:{wrap:"space-y-0",title:"font-medium",description:"text-muted-foreground"},sm:{wrap:"space-y-1",title:"font-medium text-sm text-muted-foreground mb-1",description:"text-sm"}},me=({title:t,description:s,variant:n="lg"})=>{const i=ov[n],r=()=>{switch(n){case"lg":return e.jsx("h1",{className:i.title,children:t});case"md":return e.jsx("h2",{className:i.title,children:t});case"sm":return e.jsx("h3",{className:i.title,children:t});default:return e.jsx("h1",{className:i.title,children:t})}};return n==="card"?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"text-lg font-semibold leading-tight flex items-center gap-2",children:t}),e.jsx(oo,{className:"text-sm text-muted-foreground mt-2",children:s})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:i.wrap,children:[r(),e.jsx("p",{className:`prose ${i.description}`,children:s})]})})},lv=()=>{const{tableQuery:{data:t,isLoading:s,isError:n},current:i,setCurrent:r,pageSize:a,setFilters:o}=Yh({sorters:{initial:[{field:"created_at",order:"desc"}]}}),l=yc({isLoading:s,isError:n});return l||e.jsxs(Z,{children:[e.jsx(me,{title:"Organizacje",description:"Lista wszystkich organizacji w systemie"}),e.jsx(ie,{children:e.jsx(J,{placeholder:"Szukaj organizacji...",className:"max-w-sm",onChange:c=>{o([{operator:"or",value:[{field:"name",operator:"contains",value:c.target.value},{field:"subdomain",operator:"contains",value:c.target.value}]}])}})}),e.jsx(nt,{children:t?.data?.map(c=>e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs(ie,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Xh,{className:"w-5 h-5"}),c.name]}),e.jsx(B,{variant:c.is_active?"default":"secondary",children:c.is_active?"Aktywna":"Nieaktywna"})]})}),e.jsxs(E,{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(xw,{className:"w-3 h-3"}),e.jsxs("span",{children:[c.subdomain,".example.com"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(At,{className:"w-3 h-3"}),e.jsxs("span",{children:["Utworzono: ",new Date(c.created_at).toLocaleDateString("pl-PL")]})]})]})]},c.id))}),e.jsx(_p,{current:i,pageSize:a,total:t?.total||0,setCurrent:r,itemName:"organizacji"})]})},iu={name:"vendors",list:"/admin/vendors",meta:{label:"Organizacje",icon:e.jsx(Xh,{className:"h-4 w-4"})}},cv=[e.jsx(H,{path:"vendors",element:e.jsx(lv,{})},"vendors-list")];function dv(t,s){let n;try{n=t()}catch{return}return{getItem:r=>{var a;const o=c=>c===null?null:JSON.parse(c,void 0),l=(a=n.getItem(r))!=null?a:null;return l instanceof Promise?l.then(o):o(l)},setItem:(r,a)=>n.setItem(r,JSON.stringify(a,void 0)),removeItem:r=>n.removeItem(r)}}const zl=t=>s=>{try{const n=t(s);return n instanceof Promise?n:{then(i){return zl(i)(n)},catch(i){return this}}}catch(n){return{then(i){return this},catch(i){return zl(i)(n)}}}},uv=(t,s)=>(n,i,r)=>{let a={storage:dv(()=>localStorage),partialize:y=>y,version:0,merge:(y,x)=>({...x,...y}),...s},o=!1;const l=new Set,c=new Set;let d=a.storage;if(!d)return t((...y)=>{console.warn(`[zustand persist middleware] Unable to update item '${a.name}', the given storage is currently unavailable.`),n(...y)},i,r);const u=()=>{const y=a.partialize({...i()});return d.setItem(a.name,{state:y,version:a.version})},m=r.setState;r.setState=(y,x)=>{m(y,x),u()};const h=t((...y)=>{n(...y),u()},i,r);r.getInitialState=()=>h;let p;const j=()=>{var y,x;if(!d)return;o=!1,l.forEach(b=>{var v;return b((v=i())!=null?v:h)});const g=((x=a.onRehydrateStorage)==null?void 0:x.call(a,(y=i())!=null?y:h))||void 0;return zl(d.getItem.bind(d))(a.name).then(b=>{if(b)if(typeof b.version=="number"&&b.version!==a.version){if(a.migrate){const v=a.migrate(b.state,b.version);return v instanceof Promise?v.then(C=>[!0,C]):[!0,v]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,b.state];return[!1,void 0]}).then(b=>{var v;const[C,T]=b;if(p=a.merge(T,(v=i())!=null?v:h),n(p,!0),C)return u()}).then(()=>{g?.(p,void 0),p=i(),o=!0,c.forEach(b=>b(p))}).catch(b=>{g?.(void 0,b)})};return r.persist={setOptions:y=>{a={...a,...y},y.storage&&(d=y.storage)},clearStorage:()=>{d?.removeItem(a.name)},getOptions:()=>a,rehydrate:()=>j(),hasHydrated:()=>o,onHydrate:y=>(l.add(y),()=>{l.delete(y)}),onFinishHydration:y=>(c.add(y),()=>{c.delete(y)})},a.skipHydration||j(),p||h},Tp=uv,Ns=Gh()(Tp((t,s)=>({steps:{},schemas:{},registerStep:(n,i,r=!1)=>{t(a=>({schemas:{...a.schemas,[n]:{schema:i,clearOnNext:r}}}))},setStepData:(n,i)=>{t(r=>({steps:{...r.steps,[n]:{...r.steps[n],...i}}}))},getStepData:n=>s().steps[n]||{},clearStep:n=>{t(i=>({steps:{...i.steps,[n]:{}}}))},clearAll:()=>t({steps:{}})}),{name:"step-store"})),mv=Gh()(Tp((t,s)=>({snapshots:[],saveSnapshot:n=>{const i=Ns.getState().steps,r={id:Date.now().toString(),name:n,data:i,created:Date.now()};t(a=>({snapshots:[...a.snapshots,r]}))},loadSnapshot:n=>{const i=s().snapshots.find(r=>r.id===n);if(i){const r=Ns.getState();r.clearAll(),Object.entries(i.data).forEach(([a,o])=>{r.setStepData(a,o)})}},deleteSnapshot:n=>{t(i=>({snapshots:i.snapshots.filter(r=>r.id!==n)}))},listSnapshots:()=>s().snapshots}),{name:"snapshot-store"}));function Ap(){const[t,s]=f.useState(!1),[n,i]=f.useState(""),[r,a]=f.useState(""),{snapshots:o,saveSnapshot:l,loadSnapshot:c,deleteSnapshot:d}=mv();f.useEffect(()=>{const j=y=>{y.key==="Escape"&&s(!1)};return window.addEventListener("keydown",j),()=>window.removeEventListener("keydown",j)},[]);const u=f.useMemo(()=>[...o].sort((j,y)=>y.created-j.created),[o]),m=f.useMemo(()=>{const j=r.trim().toLowerCase();return j?u.filter(y=>y.name.toLowerCase().includes(j)):u},[u,r]),h=()=>{const j=new Date().toLocaleString();l(`Snapshot ${j}`)},p=()=>{const j=n.trim();j&&(l(j),i(""))};return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>s(!0),title:"Snapshoty",className:"fixed right-4 bottom-4 bg-black text-white p-3 rounded-full shadow hover:bg-gray-900",children:"📸"}),t&&e.jsxs("div",{className:"fixed right-0 top-0 h-full w-64 bg-white border-l z-50 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b",children:[e.jsx("div",{className:"font-semibold text-sm",children:"Snapshoty"}),e.jsx("button",{onClick:()=>s(!1),className:"text-gray-500 hover:text-black text-lg leading-none","aria-label":"Zamknij",title:"Zamknij",children:"×"})]}),e.jsxs("div",{className:"p-3 border-b space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"border px-2 py-1 rounded w-full text-sm",placeholder:"Nazwa snapshotu",value:n,onChange:j=>i(j.target.value),onKeyDown:j=>j.key==="Enter"&&p()}),e.jsx("button",{onClick:p,className:"bg-blue-600 hover:bg-blue-700 text-white text-xs px-3 rounded",children:"Zapisz"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:h,className:"text-xs text-blue-700 underline",children:"Szybki zapis"}),e.jsx("input",{className:"border px-2 py-1 rounded text-xs w-32",placeholder:"Szukaj…",value:r,onChange:j=>a(j.target.value)})]})]}),e.jsx("div",{className:"p-3 overflow-y-auto text-sm space-y-2",children:m.length===0?e.jsx("div",{className:"text-gray-500 text-xs text-center mt-4",children:"Brak snapshotów"}):m.map(j=>e.jsxs("div",{className:"border rounded p-2",children:[e.jsx("div",{className:"font-medium truncate",title:j.name,children:j.name}),e.jsx("div",{className:"text-[11px] text-gray-500",children:new Date(j.created).toLocaleString()}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:()=>c(j.id),className:"bg-green-600 hover:bg-green-700 text-white text-xs px-2 py-1 rounded",children:"Wczytaj"}),e.jsx("button",{onClick:()=>{confirm(`Usunąć „${j.name}”?`)&&d(j.id)},className:"bg-red-500 hover:bg-red-600 text-white text-xs px-2 py-1 rounded",children:"Usuń"})]})]},j.id))})]})]})}function hv(){const t=le(),{steps:s,clearAll:n}=Ns(),i=!!s?.step1,r=!!s?.step1?.outline,a=!!s?.step2,o=s?.step2?.refined,l=()=>{n(),t("/admin/course-structure/step1",{replace:!0})};return e.jsxs(Z,{children:[e.jsxs("div",{className:"relative overflow-hidden rounded-2xl border mb-6",children:[e.jsx("div",{className:"absolute inset-0 bg-purple-50"}),e.jsxs("div",{className:"relative px-6 py-8 flex items-center gap-3",children:[e.jsx("div",{className:"shrink-0 inline-flex h-10 w-10 items-center justify-center rounded-xl bg-black text-white",children:e.jsx($r,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-semibold leading-tight",children:"Generator kursów — panel"}),e.jsx("p",{className:"text-sm text-zinc-600",children:"W 2 krokach wygenerujesz szkic kursu i rozpiszesz tematy lekcji z pomocą LLM."})]}),e.jsx("div",{className:"hidden md:block",children:e.jsxs(M,{onClick:l,className:"inline-flex items-center gap-2",children:["Nowy kurs",e.jsx(Ae,{className:"w-4 h-4"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(I,{className:"lg:col-span-2",children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(pt,{className:"w-5 h-5"}),"Szybki start"]})}),e.jsxs(E,{className:"space-y-5",children:[e.jsxs("div",{className:"rounded-xl border p-4",children:[e.jsxs("ol",{className:"list-decimal list-inside text-sm text-zinc-700 space-y-1",children:[e.jsx("li",{children:"Krok 1 — podstawy kursu (temat, grupa docelowa, poziom)."}),e.jsx("li",{children:"Krok 2 — doprecyzowanie listy modułów i lekcji."})]}),e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row gap-2",children:[e.jsxs(M,{onClick:l,className:"flex-1 inline-flex items-center gap-2",children:["Rozpocznij",e.jsx(Ae,{className:"w-4 h-4"})]}),e.jsx(M,{asChild:!0,variant:"secondary",className:"flex-1",children:e.jsxs(Te,{to:"/admin/course-structure/step4",className:"inline-flex items-center gap-2",children:["Edytuj istniejące kursy",e.jsx(Ae,{className:"w-4 h-4"})]})})]})]}),i||a?e.jsx(I,{className:"bg-muted/40",children:e.jsxs(E,{className:"pt-6",children:[e.jsxs("p",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(gw,{className:"w-4 h-4"}),"Ostatnia sesja"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-medium text-foreground",children:o.courseTitle}),e.jsxs("div",{className:"text-xs",children:[o.subject," • ",String(o.level),o.isMaturaCourse?" • Maturalny":""]}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx(M,{size:"sm",onClick:()=>t("/admin/course-structure/step2"),children:"Kontynuuj w kroku 2"}),e.jsx(M,{size:"sm",variant:"outline",onClick:()=>t("/admin/course-structure/step1"),children:"Podgląd kroku 1"}),e.jsx(M,{size:"sm",variant:"ghost",onClick:()=>n(),className:"text-red-600 hover:text-red-700",children:"Wyczyść sesję"})]})]}):r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-medium text-foreground",children:s?.step1?.outline?.title||"Szkic kursu"}),e.jsxs("div",{className:"text-xs",children:[s?.step1?.outline?.subject||s?.step1?.subject," •"," ",s?.step1?.outline?.level||s?.step1?.level]}),e.jsx("div",{className:"mt-3",children:e.jsx(M,{size:"sm",onClick:()=>t("/admin/course-structure/step2"),children:"Przejdź do kroku 2"})})]}):e.jsx("div",{className:"text-sm",children:"Brak zapisanych szkiców do wznowienia."})})]})}):null]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5"}),"Jak to działa?"]})}),e.jsxs(E,{className:"space-y-3",children:[e.jsxs(he,{children:[e.jsx(Ln,{className:"h-4 w-4"}),e.jsx(pe,{className:"text-xs",children:"Kreator może uwzględnić najnowszą (2025) podstawę programową LO (PL) dla kursów maturalnych."})]}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-2",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-foreground",children:"Krok 1:"})," podaj parametry kursu, wybierz poziom i (opcjonalnie) zgodność z podstawą."]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-foreground",children:"Krok 2:"})," wygeneruj listę lekcji (z opisami), zweryfikuj i zapisz."]})]}),e.jsx("div",{className:"pt-2",children:e.jsxs(M,{onClick:l,variant:"outline",className:"w-full inline-flex items-center justify-center gap-2",children:["Przejdź do kroku 1",e.jsx(Ae,{className:"w-4 h-4"})]})})]})]})]})]})}function Sl(t){if(!t)return Qd();switch(t.type){case"string":return t.required?Xd():Xd().optional();case"number":return t.required?Jd():Jd().optional();case"boolean":return t.required?Yd():Yd().optional();case"array":return $w(Sl(t.items||{}));case"object":{if(!t.properties)return Zd({});const s={};for(const[n,i]of Object.entries(t.properties))s[n]=Sl(i);return Zd(s)}default:return Qd()}}function Cl(t,s=0){const n=" ".repeat(s);switch(t.type){case"string":return`${n}string${t.required?" (wymagane)":""}`;case"number":return`${n}number${t.required?" (wymagane)":""}`;case"boolean":return`${n}boolean${t.required?" (wymagane)":""}`;case"enum":return`${n}enum: ${t.options?.join(" | ")}`+(t.required?" (wymagane)":"");case"array":return`${n}array${t.minItems?` (min ${t.minItems})`:""}${t.maxItems?` (max ${t.maxItems})`:""}, element:
`+Cl(t.items||{},s+2);case"object":return t.properties?n+`{
`+Object.entries(t.properties).map(([i,r])=>`${n}  ${i}: ${Cl(r,s+4)}`).join(`
`)+`
`+n+"}":`${n}object`;default:return`${n}any`}}function pv(t){return`⚠️ Odpowiedz wyłącznie poprawnym JSON-em zgodnym z poniższą strukturą:

`+Cl(t,0)}class fa extends Error{constructor(n,i,r){super(n);ss(this,"status");ss(this,"info");this.name="LLMError",this.status=r,this.info=i}}async function Rn(t,s,n="json"){let i=t;n==="json"&&s&&(i+=`

`+pv(s));const r=await fetch("http://localhost:3001/api/chat",{method:"POST",headers:{"content-type":"application/json","x-api-key":"ce040e01e5b1b24f530a541f89e2409b328cf51efc6ba295c85ba1858072498b"},body:JSON.stringify({message:i,model:"gemini-2.5-flash",responseFormat:n})}),a=await r.text();let o=null;try{o=a?JSON.parse(a):null}catch{}if(!r.ok){const d=o?.error||o?.message||o?.details||r.statusText||"Błąd wywołania LLM";throw new fa(d,o??{raw:a},r.status)}const l=o??{},c=l.response||l.text||l.message||"";if(n==="json"){const d=c.replace(/```json\s*|\s*```/g,"").trim();let u;try{u=JSON.parse(d)}catch{throw new fa("Niepoprawny JSON z modelu",{raw:c})}if(s){const m=Sl(s);try{return m.parse(u)}catch(h){throw new fa("Błąd walidacji odpowiedzi LLM",{zodIssues:h?.issues??h,parsed:u})}}return u}return c}const bc=["Matematyka","Biologia","Chemia","Fizyka","Informatyka","Geografia","Historia","Polski","Angielski"],fv={Matematyka:"Matematyka",Biologia:"Biologia",Chemia:"Chemia",Fizyka:"Fizyka",Informatyka:"Informatyka",Geografia:"Geografia",Historia:"Historia",Polski:"Język polski",Angielski:"Język obcy nowożytny"},xv=[{id:"pl-lo-2025-math",label:"Podstawa programowa LO (2025) — Matematyka",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/matematyka",subjects:["Matematyka"],outcomes:{Matematyka:["Rozwiązuje równania i nierówności oraz interpretuje wyniki.","Analizuje funkcje i wykresy; stosuje własności do rozwiązywania zadań.","Geometria płaska i przestrzenna w praktycznych zastosowaniach.","Rachunek prawdopodobieństwa i statystyka opisowa do wnioskowania.","Modeluje problemy tekstowe z użyciem narzędzi matematycznych."]}},{id:"pl-lo-2025-it",label:"Podstawa programowa LO (2025) — Informatyka",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/informatyka",subjects:["Informatyka"],outcomes:{Informatyka:["Projektuje i analizuje proste algorytmy; implementuje je.","Dobiera i stosuje struktury danych.","Pisze, uruchamia i testuje programy.","Podstawy sieci i bezpieczeństwa informacji.","Współpraca zespołowa (repozytoria, wersjonowanie)."]}},{id:"pl-lo-2025-polish",label:"Podstawa programowa LO (2025) — Język polski",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/jezyk-polski",subjects:["Polski"],outcomes:{Polski:["Analizuje i interpretuje teksty literackie i nieliterackie.","Świadomie posługuje się środkami językowymi w wypowiedzi.","Tworzy wypowiedzi pisemne zgodne z wymogami gatunku.","Rozpoznaje konteksty kulturowe i historyczne utworów.","Korzysta z różnych źródeł informacji i je weryfikuje."]}},{id:"pl-lo-2025-bio",label:"Podstawa programowa LO (2025) — Biologia",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/biologia",subjects:["Biologia"],outcomes:{Biologia:["Wyjaśnia zjawiska biologiczne w oparciu o strukturę i funkcję.","Planuje i interpretuje proste doświadczenia biologiczne.","Analizuje dziedziczenie cech i zmienność organizmów.","Rozumie podstawy ekologii i ochrony środowiska.","Korzysta z danych biologicznych do wnioskowania."]}},{id:"pl-lo-2025-phy",label:"Podstawa programowa LO (2025) — Fizyka",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/fizyka",subjects:["Fizyka"],outcomes:{Fizyka:["Opisuje i wyjaśnia zjawiska fizyczne z użyciem pojęć i praw fizyki.","Wykonuje pomiary, szacuje niepewności i analizuje wyniki.","Stosuje zasady dynamiki, energii i pędu w zadaniach.","Interpretuje wykresy i zależności wielkości fizycznych.","Rozwiązuje zadania obliczeniowe, uzasadniając tok rozumowania."]}},{id:"pl-lo-2025-chem-podst",label:"Podstawa programowa LO (2025) — Chemia (podstawowy)",year:2025,level:"podstawowy",sourceUrl:"https://podstawaprogramowa.pl/Liceum-technikum/Chemia",subjects:["Chemia"],outcomes:{Chemia:["Stosuje zasady BHP w pracowni chemicznej; rozpoznaje piktogramy i prowadzi proste doświadczenia.","Opisuje budowę atomu i okresowość właściwości pierwiastków; zapisuje proste konfiguracje elektronowe.","Rozróżnia i charakteryzuje wiązania (jonowe, kowalencyjne, metaliczne) i przewiduje właściwości substancji.","Posługuje się pojęciami mol, masa molowa, objętość molowa; wykonuje obliczenia stechiometryczne.","Pisze i bilansuje równania reakcji, w tym redoks; wyznacza stopnie utlenienia.","Analizuje roztwory: oblicza stężenie procentowe i molowe; opisuje rozpuszczalność i czynniki ją zmieniające.","Opisuje kwasowo-zasadowość: pH, wskaźniki, moc kwasów/zasad; rozwiązuje proste zadania obliczeniowe.","Wyjaśnia czynniki wpływające na szybkość reakcji; opisuje równowagi chemiczne i zasadę Le Chateliera.","Charakteryzuje właściwości gazów i cieczy; stosuje równanie gazu doskonałego w prostych zadaniach.","Rozpoznaje podstawowe grupy funkcyjne w chemii organicznej; podaje właściwości i reakcje charakterystyczne.","Interpretuje i krytycznie analizuje dane (tabele, wykresy, schematy) oraz formułuje wnioski.","Wskazuje zastosowania związków chemicznych w życiu codziennym, środowisku i przemyśle; ocenia wpływ na środowisko."]}},{id:"pl-lo-2025-chem-rozsz",label:"Podstawa programowa LO (2025) — Chemia (rozszerzony)",year:2025,level:"rozszerzony",sourceUrl:"https://podstawaprogramowa.pl/Liceum-technikum/Chemia",subjects:["Chemia"],outcomes:{Chemia:["Wykonuje złożone obliczenia stechiometryczne (odczynnik ograniczający, wydajność, mieszanie roztworów).","Stosuje prawa termochemii: ΔH reakcji, prawo Hessa; jakościowo interpretuje wpływ ΔS i ΔG na spontaniczność.","Analizuje równowagi: zapisuje wyrażenia Kc/Kp, szacuje przesunięcia równowagi (Le Chatelier), rozwiązuje proste układy z K.","Opisuje i oblicza zagadnienia kwas-zasada: stałe dysocjacji, hydroliza soli, bufor i równanie Hendersona–Hasselbalcha.","Projektuje i interpretuje miareczkowania (kwas–zasada, redoks); szkicuje krzywe miareczkowania i dobiera wskaźniki.","Stosuje podstawy kinetyki: prawo szybkości, rząd reakcji z danych doświadczalnych, pojęcie energii aktywacji (Arrhenius jakościowo).","Wykorzystuje elektrochemię: buduje schematy ogniw, oblicza SEM ze standardowych potencjałów; jakościowo stosuje równanie Nernsta.","Posługuje się iloczynem rozpuszczalności (Ksp) do przewidywania strącania; analizuje równowagi strąceniowe.","Rozpoznaje i opisuje mechanizmy podstawowych reakcji organicznych (substytucja/addycja/eliminacja na poziomie jakościowym).","Analizuje izomerię (strukturalna, geometryczna, optyczna) i konsekwencje stereochemiczne właściwości związków.","Charakteryzuje polimery (addycja, kondensacja), makrocząsteczki i ich zastosowania; wskazuje aspekty środowiskowe.","Stosuje elementy analizy jakościowej i instrumentalnej (chromatografia w ujęciu szkolnym, proste widma) do identyfikacji związków."]}},{id:"pl-lo-2025-geo",label:"Podstawa programowa LO (2025) — Geografia",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/geografia",subjects:["Geografia"],outcomes:{Geografia:["Analizuje mapy, dane statystyczne i obrazy Ziemi.","Wyjaśnia procesy przyrodnicze i społeczno-ekonomiczne.","Ocena wpływu działalności człowieka na środowisko.","Interpretuje wskaźniki demograficzne i gospodarcze.","Korzysta z narzędzi GIS/geo-danych na poziomie podstawowym."]}},{id:"pl-lo-2025-hist",label:"Podstawa programowa LO (2025) — Historia",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/historia",subjects:["Historia"],outcomes:{Historia:["Porządkuje wydarzenia w czasie i przestrzeni (chronologia, mapa).","Analizuje i interpretuje źródła historyczne.","Wyjaśnia przyczyny i skutki zjawisk historycznych.","Rozpoznaje spory interpretacyjne i różne narracje.","Formułuje argumenty i wnioski w dyskusji o przeszłości."]}},{id:"pl-lo-2025-eng",label:"Podstawa programowa LO (2025) — Język obcy nowożytny (Angielski)",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/jezyk-obcy-nowozytny",subjects:["Angielski"],outcomes:{Angielski:["Rozumie typowe wypowiedzi ustne i pisemne w kontekście szkolnym.","Komunikuje się w codziennych sytuacjach i w tematach szkolnych.","Pisze krótkie wypowiedzi użytkowe zgodnie z celem i odbiorcą.","Rozwija zakres środków językowych (słownictwo, gramatyka).","Stosuje strategie uczenia się i korzysta z różnych źródeł."]}}];function gv(t){return bc.find(n=>n===t)??null}function vc(t){if(!t)return null;const s=gv(t);if(!s)return null;const n=fv[s],i=xv.filter(a=>a.subjects.includes(s)||a.subjects.includes(n));return i.length===0?null:[...i].sort((a,o)=>{const l=a.year??0,c=o.year??0;return c!==l?c-l:a.id.localeCompare(o.id)})[0]??null}const ru={type:"object",properties:{title:{type:"string"},subject:{type:"string",required:!0},level:{type:"string",required:!0},isMaturaCourse:{type:"boolean",required:!0},topics:{type:"array",minItems:5,items:{type:"object",properties:{title:{type:"string",required:!0},description:{type:"string",required:!0}}}}}};function jv({custom:t,generated:s,activeIsCustom:n}){const i=(t||"").trim(),r=(s||"").trim();return!i&&!r?null:e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-primary/80",children:"NAZWA KURSU"}),e.jsxs("div",{children:[" ",e.jsx("span",{className:n?"font-medium":"",children:i}),n&&e.jsx("span",{className:"ml-2 text-xs text-primary/80",children:"(aktywna)"})]}),e.jsxs("div",{children:[e.jsx("span",{className:n?"":"font-medium",children:r}),!n&&e.jsx("span",{className:"ml-2 text-xs text-primary/80",children:"(aktywna)"})]})]})}function Ko({children:t}){return e.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-xs border bg-primary/10 border-primary text-primary",children:t})}function yv({subjectActive:t,levelActive:s,isMatura:n}){return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wide text-muted-foreground",children:"Szczegóły"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[t&&e.jsx(Ko,{children:t}),s&&e.jsx(Ko,{children:s}),e.jsx(Ko,{children:n?"maturalny":"niematuralny"})]})]})}function wv(){const{registerStep:t,setStepData:s,getStepData:n}=Ns(),i=n("step1")||{};f.useEffect(()=>{t("step1",ru),i.subject||s("step1",{subject:"Matematyka",level:"podstawowy",isMaturaCourse:!0,alignToCurriculum:!0,useCustomTitle:!1})},[]);const r=f.useMemo(()=>vc(i.subject),[i.subject]),[a,o]=f.useState(!1),l=async()=>{s("step1",{isGenerating:!0});try{const j=r?.outcomes?.[i.subject]??[],y=i.isMaturaCourse&&i.alignToCurriculum&&r?`
Uwzględnij zgodność z podstawą programową LO (PL).
(Dokument: ${r.label}${r.year?` • ${r.year}`:""})
Wymagania do pokrycia:
${j.map((b,v)=>`${v+1}. ${b}`).join(`
`)}
Jeśli to możliwe, sygnalizuj pokrycie wymagań w nawiasie, np. "[PP]".
          `.trim():"",x=`
Wygeneruj szkic kursu dla nauczyciela:
- przedmiot: ${i.subject}
- poziom: ${i.level}
- charakter: ${i.isMaturaCourse?"maturalny":"niematuralny"}
${y?`
${y}
`:""}

Szkic ma być zwięzły, klarowny i praktyczny dla planowania lekcji. Zadbaj, by tematy były sensownie dobrane do poziomu.
      `.trim(),g=await Rn(x,ru);s("step1",{outline:g,isGenerating:!1})}catch{s("step1",{isGenerating:!1})}},c=!!(i.isMaturaCourse&&r&&i.alignToCurriculum),d=(i.title||"").trim(),u=(i.outline?.title||"").trim(),m=!!(i.useCustomTitle&&d),h=m?d:u||(i.subject&&i.level?`${i.subject} — kurs ${i.level}`:"Szkic kursu"),p=r?.outcomes?.[i.subject]??[];return e.jsxs(Z,{children:[e.jsx(me,{title:"Krok 1 ",description:"Szkic kursu"}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Parametry kursu"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs(we,{value:i.subject||"Matematyka",onValueChange:j=>s("step1",{subject:j}),disabled:i.isGenerating,children:[e.jsx(ge,{children:e.jsx(be,{placeholder:"Wybierz przedmiot"})}),e.jsx(je,{children:bc.map(j=>e.jsx(Y,{value:j,children:j},j))})]}),e.jsxs(we,{value:i.level||"podstawowy",onValueChange:j=>s("step1",{level:j}),disabled:i.isGenerating,children:[e.jsx(ge,{children:e.jsx(be,{placeholder:"Wybierz poziom"})}),e.jsxs(je,{children:[e.jsx(Y,{value:"podstawowy",children:"Podstawowy"}),e.jsx(Y,{value:"rozszerzony",children:"Rozszerzony"})]})]}),e.jsx(J,{placeholder:"Tytuł kursu (opcjonalnie)",value:i.title||"",onChange:j=>s("step1",{title:j.target.value}),disabled:i.isGenerating}),e.jsx(I,{className:"bg-muted/40 border-dashed",children:e.jsxs(E,{className:"space-y-3 pt-4",children:[(i.title||"").trim()?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{checked:!!i.useCustomTitle,onCheckedChange:j=>s("step1",{useCustomTitle:!!j}),disabled:i.isGenerating}),e.jsxs("span",{className:"text-sm",children:["Użyj ",e.jsx("strong",{children:"mojej nazwy"})," przy zapisie (zamiast wygenerowanej)"]})]}):null,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{checked:i.isMaturaCourse||!1,onCheckedChange:j=>s("step1",{isMaturaCourse:!!j,alignToCurriculum:j?i.alignToCurriculum:!1}),disabled:i.isGenerating}),e.jsx("span",{className:"text-sm",children:"Kurs maturalny"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{checked:i.alignToCurriculum||!1,onCheckedChange:j=>s("step1",{alignToCurriculum:!!j}),disabled:i.isGenerating}),e.jsxs("span",{className:"text-sm",children:["Uwzględnij ",e.jsx("strong",{children:"najnowszą (2025)"})," podstawę programową LO (PL)"]})]})]})}),c&&e.jsxs(e.Fragment,{children:[e.jsxs(he,{children:[e.jsx(Ln,{className:"h-4 w-4"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsxs(pe,{className:"text-xs",children:["Dokument: ",e.jsx("strong",{children:r?.label}),r?.year?` • ${r.year}`:""]}),p.length>0&&e.jsx(M,{type:"button",size:"sm",variant:"outline",className:"h-7 px-2 text-xs shrink-0",onClick:()=>o(j=>!j),children:a?"Ukryj wymagania":`Pokaż wymagania (${p.length})`})]})]}),a&&e.jsx("ul",{className:"text-xs list-disc pl-5 space-y-1 max-h-40 overflow-auto rounded-md border p-2",children:p.map((j,y)=>e.jsx("li",{className:"leading-snug",children:j},y))})]}),e.jsx(M,{onClick:l,disabled:i.isGenerating,className:"w-full",children:i.isGenerating?e.jsxs(e.Fragment,{children:[e.jsx(lt,{className:"w-4 h-4 animate-spin"}),"Generowanie..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pt,{className:"w-4 h-4"}),"Generuj szkic"]})})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Podgląd szkicu"})}),e.jsx(E,{children:i.isGenerating?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(lt,{className:"w-6 h-6 animate-spin"})}):i.outline?e.jsxs("div",{className:"space-y-5",children:[e.jsx(jv,{custom:d,generated:u,activeIsCustom:m}),e.jsx(yv,{subjectActive:i.subject,levelActive:i.level,isMatura:i.isMaturaCourse}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-auto pr-1",children:i.outline.topics?.map((j,y)=>e.jsxs(I,{className:"p-3",children:[e.jsxs("div",{className:"font-medium",children:[y+1,". ",j.title]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:j.description})]},y))}),e.jsx(M,{asChild:!0,className:"w-full",children:e.jsx(Te,{to:"/admin/course-structure/step2",children:"Dalej →"})})]}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("div",{className:"font-medium",children:h}),e.jsx("div",{className:"text-xs mt-1",children:"Kliknij „Generuj szkic”"})]})})]})]}),e.jsx(Ap,{})]})}const au={type:"object",properties:{courseTitle:{type:"string",required:!0},courseDescription:{type:"string"},subject:{type:"string",required:!0},level:{type:"string",required:!0},isMaturaCourse:{type:"boolean",required:!0},topics:{type:"array",minItems:1,items:{type:"object",properties:{title:{type:"string",required:!0},description:{type:"string",required:!0},position:{type:"number",required:!0},is_published:{type:"boolean",required:!0}}}}}},ou=950;function bv(t){return String(t??"").trim().toLowerCase()==="rozszerzony"?"rozszerzony":"podstawowy"}function vv(){const{registerStep:t,setStepData:s,getStepData:n}=Ns(),i=le(),r=n("step1")||{},a=n("step2")||{},[o,l]=f.useState(!1);f.useEffect(()=>{if(t("step2",au),a.targetCount||s("step2",{targetCount:15}),!a.titleSource){const m=r.useCustomTitle&&r.title?.trim()?"custom":"generated";s("step2",{titleSource:m})}r.outline||i("/admin/course-structure/step1")},[]);const c=async()=>{if(!r.outline){s("step2",{error:"Brak danych z kroku 1"});return}s("step2",{isGenerating:!0,error:null,errorDetails:null});const m=String(r.subject||r.outline?.subject||"").trim(),h=bv(r.level||r.outline?.level),p=!!(r.isMaturaCourse??r.outline?.isMaturaCourse);let j=`
Rozwiń szkic kursu do dokładnie ${a.targetCount} tematów lekcji, logicznie uporządkowanych od podstaw do bardziej zaawansowanych.
Wygeneruj tytuły i krótkie opisy (2–3 zdania) z perspektywy nauczyciela przygotowującego plan pracy.
Kontekst:
- tytuł szkicu: ${r.outline.title}
- przedmiot: ${m}
- poziom: ${h}
- kurs ${p?"maturalny":"niematuralny"}
- główne tematy szkicu: ${(r.outline.topics||[]).map(y=>y.title).join(", ")}

Zachowaj spójność terminologii i adekwatność do poziomu. Jeśli kurs maturalny — uwzględnij wymagania egzaminacyjne w zakresie doboru tematów.
    `.trim();j.length>ou&&(j=j.slice(0,ou-3)+"...");try{const y=await Rn(j,au),x=y.courseTitle||y.title||r.outline.title,b=(a.titleSource||(r.useCustomTitle&&r.title?.trim()?"custom":"generated"))==="custom"&&r.title?.trim()?r.title.trim():x,v={...y,courseTitle:b,subject:m,level:h,isMaturaCourse:p,topics:(y.topics||[]).map((C,T)=>({...C,position:Number(C.position||T+1),is_published:!1}))};s("step2",{refined:v,isGenerating:!1,error:null,errorDetails:null,generatedTitle:x})}catch(y){console.error("Błąd generowania:",y);let x;y instanceof fa?x={message:y.message,status:y.status,...y.info&&typeof y.info=="object"?y.info:{raw:y.info}}:y instanceof Error?x={message:y.message}:x={error:y},s("step2",{isGenerating:!1,error:"Nie udało się wygenerować tematów. Spróbuj ponownie.",errorDetails:x})}},d=()=>{i("/admin/course-structure/step3",{state:{refined:a.refined,outline:r.outline}})},u=a.titleSource==="custom"&&r.title?.trim()?r.title.trim():a.generatedTitle||r.outline?.title;return e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsx("h1",{className:"text-2xl font-semibold mb-6",children:"Krok 2 — Szczegółowe tematy lekcji"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Konfiguracja"})}),e.jsxs(E,{className:"space-y-4",children:[r.outline&&e.jsxs(he,{children:[e.jsx(Re,{className:"h-4 w-4"}),e.jsxs(pe,{children:[e.jsx("strong",{children:"Rozwijamy kurs:"})," ",r.outline.title,e.jsx("br",{}),e.jsxs("span",{className:"text-muted-foreground",children:[String(r.subject||r.outline.subject)," • ",String(r.level||r.outline.level),!!(r.isMaturaCourse||r.outline.isMaturaCourse)&&" • Maturalny"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Źródło tytułu kursu"}),r.title?.trim()?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{type:"button",variant:a.titleSource==="custom"?"default":"outline",onClick:()=>s("step2",{titleSource:"custom"}),className:"flex-1",children:"Moja nazwa"}),e.jsx(M,{type:"button",variant:a.titleSource==="generated"?"default":"outline",onClick:()=>s("step2",{titleSource:"generated"}),className:"flex-1",children:"Wygenerowana"})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["• Moja: ",e.jsx("strong",{children:r.title.trim()}),e.jsx("br",{}),"• Wygenerowana: ",e.jsx("strong",{children:a.generatedTitle||r.outline?.title})]}),e.jsxs("div",{className:"text-xs",children:["Zostanie zapisane: ",e.jsx("strong",{children:u})]})]}):e.jsx("div",{className:"text-xs text-muted-foreground",children:"Brak własnej nazwy z kroku 1 — zostanie użyta wygenerowana."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Liczba tematów lekcji"}),e.jsx(J,{type:"number",min:"5",max:"50",value:a.targetCount||15,onChange:m=>s("step2",{targetCount:Number(m.target.value)}),disabled:a.isGenerating}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Zalecane: 10-20 dla kursu podstawowego, 20-30 dla rozszerzonego"})]}),a.error&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(he,{variant:"destructive",children:[e.jsx(Re,{className:"h-4 w-4"}),e.jsx(pe,{children:a.error})]}),a.errorDetails&&e.jsxs(I,{children:[e.jsx(O,{className:"py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx($,{className:"text-sm",children:"Szczegóły błędu"}),e.jsx(M,{variant:"ghost",size:"sm",onClick:()=>l(m=>!m),className:"h-7",children:o?e.jsx(Rr,{className:"w-4 h-4"}):e.jsx(Dt,{className:"w-4 h-4"})})]})}),o&&e.jsxs(E,{className:"pt-0",children:[e.jsx(cs,{className:"font-mono text-xs h-40",readOnly:!0,value:JSON.stringify(a.errorDetails,null,2)}),"limits"in a.errorDetails&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-2",children:[e.jsx("strong",{children:"Wskazówka:"})," Twoja wiadomość mogła przekroczyć limit (",a.errorDetails.limits?.maxMessageLength," znaków). Spróbuj zmniejszyć liczbę tematów lub usunąć część kontekstu."]}),typeof a.errorDetails?.status=="number"&&a.errorDetails.status>=500&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-2",children:[e.jsx("strong",{children:"Wskazówka:"})," Usługa modelu chwilowo przeciążona (HTTP ",a.errorDetails.status,"). Spróbuj ponownie za chwilę."]})]})]})]}),e.jsx(M,{onClick:c,disabled:a.isGenerating||!r.outline,className:"w-full",children:a.isGenerating?e.jsxs(e.Fragment,{children:[e.jsx(lt,{className:"w-4 h-4 animate-spin"}),"Generowanie tematów..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pt,{className:"w-4 h-4"}),"Generuj ",a.targetCount," tematów"]})}),a.refined&&e.jsx(I,{className:"bg-muted",children:e.jsxs(E,{className:"pt-6",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Wygenerowano:"}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("div",{children:["• ",a.refined.topics?.length||0," tematów"]}),e.jsxs("div",{children:["• ",a.refined.courseDescription?"✓":"✗"," Opis kursu"]}),e.jsxs("div",{children:["• Poziom: ",a.refined.level]})]})]})})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Podgląd tematów"})}),e.jsx(E,{children:a.isGenerating?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-muted-foreground",children:[e.jsx(lt,{className:"w-8 h-8 animate-spin mb-3"}),e.jsxs("p",{className:"text-sm",children:["Generowanie ",a.targetCount," tematów..."]}),e.jsx("p",{className:"text-xs mt-1",children:"To może potrwać do 30 sekund"})]}):a.refined?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mb-4",children:e.jsxs(E,{className:"pt-6",children:[e.jsx("h3",{className:"font-bold",children:a.refined.courseTitle}),a.refined.courseDescription&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:a.refined.courseDescription}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[a.refined.subject," • ",a.refined.level,a.refined.isMaturaCourse?" • Maturalny":""]})]})}),e.jsx(Ze,{className:"h-[400px] mb-4",children:e.jsx("div",{className:"space-y-2",children:a.refined.topics?.map(m=>e.jsx(I,{className:"p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("span",{className:"text-muted-foreground text-sm",children:[m.position,"."]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:m.title}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:m.description})]})]})},m.position))})}),e.jsxs(M,{onClick:d,className:"w-full",variant:"default",children:[e.jsx("span",{children:"Przejdź do zapisu"}),e.jsx(Ae,{className:"w-4 h-4"})]})]}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-sm",children:"Tematy pojawią się tutaj po wygenerowaniu"}),e.jsx("p",{className:"text-xs mt-2",children:'Wybierz liczbę tematów i kliknij "Generuj"'})]})})]})]}),e.jsx(Ap,{})]})}function Nv(t){return String(t??"").trim().toLowerCase()==="rozszerzony"?"rozszerzony":"podstawowy"}function kv(){const t=le(),s=ms(),{data:n}=Ye(),{steps:i,clearAll:r}=Ns(),a=f.useMemo(()=>s?.state?.refined??i?.step2?.refined,[s?.state,i]),o=f.useMemo(()=>s?.state?.outline??i?.step1?.outline,[s?.state,i]),[l,c]=f.useState(!1),[d,u]=f.useState(null),[m,h]=f.useState(0),[p,j]=f.useState(null),{mutate:y}=os(),{mutate:x}=os(),g=async()=>{if(!a){j("Brak danych kursu (refined). Wróć do kroku 2.");return}j(null),c(!0),h(0);try{const v=Nv(a.level),C=String(a.subject??o?.subject??"").trim(),T=!!a.isMaturaCourse,z=await new Promise((w,k)=>{y({resource:"courses",values:{title:a.courseTitle,description:a.courseDescription||"",vendor_id:Number(n?.vendor_id??0),is_published:!1,icon_emoji:o?.icon_emoji||"📚",subject:C,level:v,is_exam_course:T}},{onSuccess:_=>{const A=_?.data?.id;if(A==null)return k(new Error("Brak ID kursu"));w(A)},onError:_=>k(_)})});u(z);const N=typeof z=="string"?parseInt(z,10):z,S=a.topics?.length||0;for(let w=0;w<S;w++){const k=a.topics[w],_=Number(k.position??w+1);await new Promise(A=>{x({resource:"topics",values:{course_id:N,title:k.title,position:_,is_published:!!(k.is_published??!1)}},{onSuccess:()=>{h(D=>D+1),A()},onError:()=>A()})})}const P=a.topics?.length||0;t("/admin/course-structure/step4",{replace:!0,state:{courseId:N,courseTitle:a.courseTitle,topicsCount:P}}),r()}catch(v){console.error("Błąd zapisu:",v),j(v?.message||"Nie udało się zapisać kursu.")}finally{c(!1)}};if(!a)return e.jsx("div",{className:"max-w-3xl mx-auto p-6",children:e.jsx(I,{children:e.jsxs(E,{className:"pt-6",children:[e.jsxs(he,{variant:"destructive",children:[e.jsx(Re,{className:"h-4 w-4"}),e.jsxs(pe,{children:[e.jsx("span",{className:"font-medium",children:"Brak danych do zapisu"}),e.jsx("br",{}),"Wróć do kroku 2 i wygeneruj tematy kursu."]})]}),e.jsx(M,{asChild:!0,className:"mt-4",children:e.jsxs(Te,{to:"/admin/course-structure/step2",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Wróć do kroku 2"]})})]})})});const b=a.topics?.length>0?m/a.topics.length*100:0;return e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("header",{className:"flex items-center gap-2 mb-6",children:[e.jsx(sn,{className:"w-5 h-5"}),e.jsx("h1",{className:"text-xl font-semibold",children:"Krok 3 — Zapis kursu"})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Podsumowanie"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:a.courseTitle}),a.courseDescription&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:a.courseDescription}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-2",children:[a.subject," • ",String(a.level),a.isMaturaCourse?" • Maturalny":""]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium mb-2",children:["Tematy (",a.topics.length,"):"]}),e.jsx(Ze,{className:"h-64",children:e.jsxs("div",{className:"space-y-1 text-sm",children:[a.topics.slice(0,12).map((v,C)=>e.jsxs("div",{className:"border-l-2 border-muted pl-2",children:[e.jsxs("span",{className:"text-muted-foreground",children:[Number(v.position??C+1),"."]})," ",v.title]},C)),a.topics.length>12&&e.jsxs("div",{className:"text-xs text-muted-foreground italic",children:["... i ",a.topics.length-12," więcej"]})]})})]}),p&&e.jsxs(he,{variant:"destructive",children:[e.jsx(Re,{className:"h-4 w-4"}),e.jsx(pe,{children:p})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(M,{onClick:g,disabled:l,className:"flex-1",children:[l?e.jsx(lt,{className:"w-4 h-4 animate-spin"}):e.jsx(sn,{className:"w-4 h-4"}),l?"Zapisywanie...":"Zapisz kurs i tematy"]}),e.jsx(M,{asChild:!0,variant:"outline",children:e.jsx(Te,{to:"/admin/course-structure/step2",children:e.jsx(Ne,{className:"w-4 h-4"})})})]})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Status zapisu"})}),e.jsx(E,{children:!l&&!d?e.jsxs("p",{className:"text-sm text-muted-foreground",children:['Kliknij „Zapisz kurs i tematy", aby utworzyć kurs i'," ",a.topics.length," tematów."]}):l?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(lt,{className:"w-4 h-4 animate-spin"}),"Zapisywanie tematów: ",m," / ",a.topics.length]}),e.jsx(rs,{value:b,className:"w-full"})]}):d?e.jsxs(he,{children:[e.jsx(Pt,{className:"h-4 w-4"}),e.jsxs(pe,{children:[e.jsx("span",{className:"font-medium",children:"Zapisano pomyślnie!"}),e.jsx("br",{}),"ID kursu: ",String(d)]})]}):null})]})]})]})}const zv={type:"object",properties:{courseTitle:{type:"string"},topics:{type:"array",minItems:1,items:{type:"object",properties:{title:{type:"string",required:!0},description:{type:"string",required:!0}}}}}};function Sv(){const t=ms(),s=le(),n=t?.state?.courseId,i=t?.state?.courseTitle||"Nowy kurs",r=t?.state?.topicsCount||0,{data:a,isLoading:o,isError:l,refetch:c}=Q({resource:"courses",pagination:{current:1,pageSize:50},sorters:[{field:"id",order:"desc"}]}),d=a?.data??[],[u,m]=f.useState(n);f.useEffect(()=>{!u&&d.length>0&&m(d[0].id)},[u,d]),f.useEffect(()=>{c()},[]);const{data:h,isLoading:p,isError:j,refetch:y}=Q({resource:"topics",filters:u?[{field:"course_id",operator:"eq",value:typeof u=="string"?parseInt(u,10):u}]:[],sorters:[{field:"position",order:"asc"}],pagination:{current:1,pageSize:500},queryOptions:{enabled:!!u}});f.useEffect(()=>{u&&y()},[u]);const x=h?.data??[],g=f.useMemo(()=>{if(n!==void 0)return typeof n=="string"?parseInt(n,10):n},[n]),{mutate:b}=Is(),[v,C]=f.useState(null),T=async(q,G)=>{window.confirm(`Na pewno usunąć temat${G?`: “${G}”`:""}? Tego nie można cofnąć.`)&&(C(q),await new Promise(V=>{b({resource:"topics",id:q},{onSuccess:()=>{C(null),y(),V()},onError:()=>{C(null),V()}})}))},{mutate:z}=Is(),[N,S]=f.useState(!1),P=async()=>{if(!u)return;const G=d.find(V=>Number(V.id)===Number(u))?.title||`Kurs #${String(u)}`;window.confirm(`Usunąć kurs „${G}”? Wszystkie jego tematy (i dalsze zależne rekordy) zostaną usunięte kaskadowo. Tej operacji nie można cofnąć.`)&&(S(!0),await new Promise(V=>{z({resource:"courses",id:u},{onSuccess:async()=>{S(!1),m(void 0),await c(),await y(),V()},onError:()=>{S(!1),V()}})}))},{mutate:w}=os(),[k,_]=f.useState(x.length||15),[A,D]=f.useState(!1),[R,L]=f.useState(0),F=async()=>{if(!u)return;const q=d.find(oe=>Number(oe.id)===Number(u)),G=q?.title||"Kurs",X=q?.description||"";if(window.confirm(`To zastąpi WSZYSTKIE tematy kursu „${G}”.

Kontynuować?`)){D(!0),L(0);try{const oe=`
Jesteś metodykiem. Wygeneruj dokładnie ${k} tematów lekcji do kursu:
- Tytuł kursu: ${G}
- Opis (jeśli jest): ${X||"(brak)"}

Wypisz listę tematów (tytuł + krótki opis 1–2 zdania) z narastającą trudnością.
`.trim(),it=(await Rn(oe,zv))?.topics||[],ze=x.filter(fe=>fe?.id!==void 0&&fe?.id!==null);for(let fe=0;fe<ze.length;fe++){const gt=ze[fe].id;await new Promise(jt=>{b({resource:"topics",id:gt},{onSuccess:()=>jt(),onError:()=>jt()})}),L(Math.round((fe+1)/(ze.length+it.length)*100))}for(let fe=0;fe<it.length;fe++){const gt=it[fe];await new Promise(jt=>{w({resource:"topics",values:{course_id:typeof u=="string"?parseInt(u,10):u,title:gt.title,position:fe+1,is_published:!1}},{onSuccess:()=>{L(Math.round((ze.length+(fe+1))/(ze.length+it.length)*100)),jt()},onError:()=>jt()})})}await y()}catch(oe){console.error("Regeneracja tematów nie powiodła się",oe)}finally{D(!1),L(0)}}},K=()=>{if(!u)return;const q=d.find(G=>Number(G.id)===Number(u));s("/admin/course-structure/step5",{state:{courseId:typeof u=="string"?parseInt(u,10):u,courseTitle:q?.title||`Kurs #${String(u)}`,courseDescription:q?.description||"",currentCount:x.length}})};return e.jsxs("div",{className:"max-w-7xl mx-auto p-6 min-h-screen flex flex-col",children:[e.jsxs("header",{className:"flex items-center gap-2 mb-6",children:[e.jsx(Ai,{className:"w-5 h-5 text-green-600"}),e.jsx("h1",{className:"text-xl font-semibold",children:"Krok 4 — Zakończone"})]}),n!==void 0&&e.jsxs(I,{className:"mb-6 border-green-200 bg-green-50/50",children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(jw,{className:"w-5 h-5 text-green-700"}),"Kurs utworzony"]})}),e.jsxs(E,{className:"space-y-2",children:[e.jsx(he,{children:e.jsxs(pe,{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:i}),r?e.jsxs(e.Fragment,{children:[" — zapisano ",r," temat",r===1?"":r<5?"y":"ów","."]}):null," ","(ID: ",String(n),")"]})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Nowy kurs jest wyróżniony i zaznaczony — po prawej widzisz jego tematy."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-6 flex-1",children:[e.jsxs(I,{className:"lg:col-span-2 lg:h-full flex flex-col",children:[e.jsx(O,{children:e.jsx($,{children:"Wszystkie kursy"})}),e.jsx(E,{className:"flex-1 overflow-hidden",children:o?e.jsxs("div",{className:"space-y-2",children:[e.jsx(Rt,{className:"h-10 w-full"}),e.jsx(Rt,{className:"h-10 w-full"}),e.jsx(Rt,{className:"h-10 w-full"})]}):l?e.jsx(he,{variant:"destructive",children:e.jsx(pe,{children:"Nie udało się pobrać listy kursów."})}):d.length===0?e.jsx("div",{className:"text-sm text-muted-foreground py-4",children:"Brak kursów."}):e.jsx(Ze,{className:"h-full pr-2",children:e.jsx("div",{className:"space-y-2",children:d.map(q=>{const G=g!==void 0&&Number(q.id)===Number(g),X=u!==void 0&&Number(q.id)===Number(u);return e.jsx("button",{onClick:()=>m(q.id),className:["w-full text-left rounded-xl border px-3 py-2 transition",X?"border-black/80 bg-black text-white":"hover:bg-muted/60",G&&!X?"border-green-400":"",G&&X?"ring-2 ring-green-300":""].join(" "),children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:["font-medium",X?"text-white":"text-foreground"].join(" "),children:q.title||`Kurs #${q.id}`}),q.description?e.jsx("div",{className:["text-xs line-clamp-2",X?"text-white/80":"text-muted-foreground"].join(" "),children:q.description}):null]}),e.jsxs("div",{className:"shrink-0 flex items-center gap-2",children:[G&&e.jsx(B,{variant:X?"secondary":"default",children:"NOWY"}),!q.is_published&&e.jsx(B,{variant:X?"secondary":"outline",className:"text-[10px]",children:"szkic"})]})]})},q.id)})})})})]}),e.jsxs(I,{className:"lg:col-span-3 lg:h-full flex flex-col",children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center justify-between gap-2",children:[e.jsxs("span",{children:["Tematy:"," ",(()=>{const q=d.find(G=>Number(G.id)===Number(u));return q?.title?q.title:u?`Kurs #${String(u)}`:"—"})()]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(M,{size:"sm",variant:"destructive",onClick:P,disabled:!u||N||A||p,title:"Usuń kurs wraz z powiązanymi danymi",children:[e.jsx(dt,{className:"w-4 h-4 mr-1"}),N?"Usuwanie...":"Usuń kurs"]}),e.jsxs(M,{size:"sm",variant:"outline",onClick:K,disabled:!u||p,children:[e.jsx(pt,{className:"w-4 h-4 mr-1"}),"Uzupełnij braki"]})]})]})}),e.jsxs(E,{className:"flex-1 overflow-hidden space-y-4",children:[e.jsxs("div",{className:"rounded-xl border p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ep,{className:"w-4 h-4"}),e.jsx("div",{className:"text-sm font-medium",children:"Wygeneruj od nowa"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{type:"number",min:5,max:50,value:k,onChange:q=>_(Number(q.target.value)),className:"max-w-[120px]",disabled:A||p||!u}),e.jsx(M,{size:"sm",onClick:F,disabled:A||p||!u||k<1,children:A?e.jsxs(e.Fragment,{children:[e.jsx(rs,{value:R,className:"w-28 mr-2"}),"Przebudowa…"]}):e.jsxs(e.Fragment,{children:[e.jsx(pt,{className:"w-4 h-4 mr-1"}),"Generuj ",k]})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Zastąpi wszystkie istniejące tematy nowymi propozycjami (LLM) na podstawie tytułu/opisu kursu."})]}),u?p?e.jsxs("div",{className:"space-y-2",children:[e.jsx(Rt,{className:"h-16 w-full"}),e.jsx(Rt,{className:"h-16 w-full"}),e.jsx(Rt,{className:"h-16 w-full"})]}):j?e.jsx(he,{variant:"destructive",children:e.jsx(pe,{children:"Nie udało się pobrać tematów dla wybranego kursu."})}):x.length===0?e.jsx("div",{className:"text-sm text-muted-foreground py-4",children:"Brak tematów dla tego kursu."}):e.jsx(Ze,{className:"h-full",children:e.jsx("div",{className:"space-y-2",children:x.map((q,G)=>{const X=Number(q.position??G+1),V=q?.id!==void 0&&q?.id!==null,oe=V&&v===q.id;return e.jsxs("div",{className:"rounded-xl border p-3 flex items-start gap-3",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[X,"."]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:q.title}),"description"in q&&q.description?e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:q.description}):null]}),e.jsx(M,{type:"button",size:"sm",variant:"ghost",className:"text-red-600 hover:text-red-700",disabled:!V||oe,onClick:()=>V&&T(q.id,q.title),title:V?"Usuń temat":"Brak ID tematu",children:e.jsx(dt,{className:"w-4 h-4"})})]},q.id??`row-${G}`)})})}):e.jsx("div",{className:"text-sm text-muted-foreground py-4",children:"Wybierz kurs z listy po lewej."})]})]})]})]})}const Cv={type:"object",properties:{topics:{type:"array",minItems:1,items:{type:"object",properties:{title:{type:"string",required:!0},description:{type:"string",required:!0}}}}}};function _v(){const t=le(),s=ms(),n=s?.state?.courseId,i=s?.state?.courseTitle||"Kurs",r=s?.state?.courseDescription||"";f.useEffect(()=>{n||t("/admin/course-structure/step4")},[n]);const{data:a,refetch:o,isLoading:l}=Q({resource:"topics",filters:n?[{field:"course_id",operator:"eq",value:typeof n=="string"?parseInt(n,10):n}]:[],sorters:[{field:"position",order:"asc"}],pagination:{current:1,pageSize:500},queryOptions:{enabled:!!n}}),c=f.useMemo(()=>a?.data??[],[a]),d=f.useMemo(()=>c.reduce((S,P)=>Math.max(S,Number(P.position??0)),0),[c]),[u,m]=f.useState(""),[h,p]=f.useState(!1),[j,y]=f.useState([]),[x,g]=f.useState({}),{mutate:b}=os(),v=S=>g(P=>({...P,[S]:!P[S]})),C=()=>g(Object.fromEntries(j.map((S,P)=>[P,!0]))),T=()=>g({}),z=async()=>{if(!n)return;const S=3;p(!0);try{const P=c.map(A=>A.title).filter(Boolean),w=`
Uzupełnij kurs o NOWE tematy. Wygeneruj DOKŁADNIE ${S} propozycje (tytuł + krótki opis 1–2 zdania).
Unikaj powtórzeń względem istniejących tematów.
${u?`Preferowane kierunki / wskazówki: ${u}`:""}
Dane kursu:
- Tytuł: ${i}
- Opis: ${r||"(brak)"}
- Istniejące tematy: ${P.length?P.join("; "):"(brak)"}

Zwróć listę obiektów JSON zgodnych ze schematem.
`.trim(),_=(await Rn(w,Cv))?.topics||[];y(_),g(Object.fromEntries(_.map((A,D)=>[D,!0])))}finally{p(!1)}},N=async()=>{if(!n||j.length===0)return;const S=j.filter((k,_)=>x[_]);if(S.length===0)return;const P=typeof n=="string"?parseInt(n,10):n;let w=d;for(let k=0;k<S.length;k++){w+=1;const _=S[k];await new Promise(A=>{b({resource:"topics",values:{course_id:P,title:_.title,position:w,is_published:!1}},{onSuccess:()=>A(),onError:()=>A()})})}await o(),t("/admin/course-structure/step4",{replace:!0,state:{courseId:n,courseTitle:i,topicsCount:c.length+S.length}})};return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsxs("header",{className:"flex items-center gap-2 mb-6",children:[e.jsx(pt,{className:"w-5 h-5"}),e.jsx("h1",{className:"text-xl font-semibold",children:"Krok 5 — Uzupełnij brakujące tematy"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Xs,{className:"w-4 h-4"}),"Kontekst kursu"]})}),e.jsxs(E,{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:i}),r&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:r})]}),e.jsxs("div",{className:"text-sm",children:["Aktualnie: ",e.jsx("strong",{children:c.length})," tematów"]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm",children:"Podpowiedź dla generatora (opcjonalnie)"}),e.jsx(J,{type:"text",placeholder:"Np. dodaj tematy z ekologii i ochrony środowiska…",value:u,onChange:S=>m(S.target.value)})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Poniżej lista istniejących tematów — generator unika duplikatów."}),e.jsx(Ze,{className:"h-[280px] pr-2",children:l?e.jsx("div",{className:"text-sm text-muted-foreground",children:"Ładowanie…"}):c.length===0?e.jsx("div",{className:"text-sm text-muted-foreground",children:"Brak tematów."}):e.jsx("div",{className:"space-y-1 text-sm",children:c.map((S,P)=>e.jsxs("div",{className:"border-l-2 border-muted pl-2",children:[e.jsxs("span",{className:"text-muted-foreground",children:[Number(S.position??P+1),"."]})," ",S.title]},S.id??P))})}),e.jsxs("div",{className:"pt-2",children:[e.jsx(M,{asChild:!0,size:"sm",variant:"outline",className:"mr-2",children:e.jsxs(Te,{to:"/admin/course-structure/step4",children:[e.jsx(Ne,{className:"mr-1"}),"Wróć"]})}),e.jsxs(M,{size:"sm",onClick:z,disabled:h,children:[e.jsx($r,{}),h?"Generowanie...":"Generuj propozycje nowych tematów"]})]})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(yw,{className:"w-4 h-4"}),"Propozycje (zaznacz, które dodać)"]})}),e.jsx(E,{children:j.length===0?e.jsxs(he,{children:[e.jsx(Re,{className:"h-4 w-4"}),e.jsx(pe,{className:"text-sm",children:"Brak propozycji."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(M,{size:"sm",variant:"outline",onClick:C,children:"Zaznacz wszystko"}),e.jsx(M,{size:"sm",variant:"outline",onClick:T,children:"Wyczyść zaznaczenie"}),e.jsxs("div",{className:"text-xs text-muted-foreground ml-auto",children:["Wybrane: ",j.filter((S,P)=>x[P]).length," / ",j.length]})]}),e.jsx(Ze,{className:"h-[380px] pr-2",children:e.jsx("div",{className:"space-y-2",children:j.map((S,P)=>e.jsxs("div",{className:"rounded-xl border p-3 flex items-start gap-3",children:[e.jsx(Ke,{checked:!!x[P],onCheckedChange:()=>v(P),className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:S.title}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:S.description})]})]},P))})}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs(M,{onClick:N,className:"flex-1",disabled:j.every((S,P)=>!x[P]),children:["Zapisz wybrane",e.jsx(Ae,{className:"w-4 h-4 ml-1"})]}),e.jsx(M,{variant:"outline",className:"flex-1",onClick:()=>y([]),children:"Wyczyść podgląd"})]})]})})]})]})]})}const Tv=[e.jsx(H,{path:"/course-structure",element:e.jsx(hv,{})},"course-dashboard"),e.jsx(H,{path:"/course-structure/step1",element:e.jsx(wv,{})},"course-step1"),e.jsx(H,{path:"/course-structure/step2",element:e.jsx(vv,{})},"course-step2"),e.jsx(H,{path:"/course-structure/step3",element:e.jsx(kv,{})},"course-step3"),e.jsx(H,{path:"/course-structure/step4",element:e.jsx(Sv,{})},"course-step4"),e.jsx(H,{path:"/course-structure/step5",element:e.jsx(_v,{})},"course-step5")],lu={name:"course-structure",list:"/course-structure",create:"/course-structure/step1",meta:{canDelete:!1,label:"Generator kursów",icon:e.jsx($r,{className:"h-4 w-4"})}},Av=[{id:"course-structure",title:"Generator struktury kursu",description:"Stwórz kompletną strukturę kursu z harmonogramem i tematami",icon:_a,path:"/admin/course-structure",color:"from-indigo-50 to-blue-50",borderColor:"border-indigo-200",iconBg:"bg-indigo-100",iconColor:"text-indigo-600",buttonBg:"bg-indigo-600 hover:bg-indigo-700",features:["Automatyczna analiza wymagań","Generowanie harmonogramu","Podział na tygodnie i tematy","Zgodność z podstawą programową"],estimatedTime:"15-20 min",targetAudience:"Twórcy nowych kursów"},{id:"educational-material",title:"Kreator materiałów edukacyjnych",description:"Generuj angażujące materiały dydaktyczne dostosowane do wieku uczniów",icon:xe,path:"/admin/educational-material",color:"from-purple-50 to-pink-50",borderColor:"border-purple-200",iconBg:"bg-purple-100",iconColor:"text-purple-600",buttonBg:"bg-purple-600 hover:bg-purple-700",features:["Materiały dostosowane do wieku","Ćwiczenia praktyczne","Formatowanie Markdown","Integracja z istniejącymi kursami"],estimatedTime:"10-15 min",targetAudience:"Nauczyciele wszystkich poziomów"},{id:"quiz-wizard",title:"Kreator quizów",description:"Twórz profesjonalne testy sprawdzające z różnymi typami pytań",icon:cn,path:"/admin/quiz-wizard",color:"from-blue-50 to-cyan-50",borderColor:"border-blue-200",iconBg:"bg-blue-100",iconColor:"text-blue-600",buttonBg:"bg-blue-600 hover:bg-blue-700",features:["Różne typy pytań","Automatyczne wyjaśnienia","Konfiguracja parametrów","Inteligentne punktowanie"],estimatedTime:"10-15 min",targetAudience:"Do sprawdzania wiedzy"}],Pv=()=>{const t=le();return e.jsxs(Z,{children:[e.jsx(me,{title:"Narzędzia AI dla nauczycieli",description:"Wykorzystaj sztuczną inteligencję do tworzenia wysokiej jakości materiałów edukacyjnych"}),e.jsx("div",{className:"mb-8 p-6 bg-gradient-to-r from-violet-50 to-purple-50 rounded-lg border border-purple-200",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:e.jsx(pt,{className:"w-8 h-8 text-purple-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Przyspiesz tworzenie materiałów z AI"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Nasze narzędzia AI pomagają tworzyć spersonalizowane materiały edukacyjne w ułamku czasu potrzebnego na tradycyjne przygotowanie. Każdy kreator prowadzi Cię krok po kroku przez proces tworzenia."}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{children:"Oszczędność czasu do 80%"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{children:"Dostosowane do programu nauczania"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{children:"Personalizacja dla różnych grup"})]})]})]})]})}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:Av.map(s=>{const n=s.icon;return e.jsxs(I,{className:`hover:shadow-lg transition-shadow cursor-pointer border-2 ${s.borderColor}`,onClick:()=>t(s.path),children:[e.jsxs(O,{children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${s.iconBg}`,children:e.jsx(n,{className:`w-6 h-6 ${s.iconColor}`})}),e.jsx(Ce,{className:"w-5 h-5 text-gray-400"})]}),e.jsx($,{className:"text-lg",children:s.title}),e.jsx(oo,{children:s.description})]}),e.jsx(E,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-700 mb-2",children:"Główne funkcje:"}),e.jsx("ul",{className:"space-y-1",children:s.features.slice(0,3).map((i,r)=>e.jsxs("li",{className:"text-xs text-gray-600 flex items-start gap-1",children:[e.jsx("span",{className:"text-green-500 mt-0.5",children:"•"}),e.jsx("span",{children:i})]},r))})]}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:[e.jsx(De,{className:"w-3 h-3 inline mr-1"}),s.estimatedTime]}),e.jsxs(M,{size:"sm",className:`${s.buttonBg} text-white`,children:[e.jsx($r,{className:"w-3 h-3 mr-1"}),"Rozpocznij"]})]})]})})]},s.id)})}),e.jsxs("div",{className:"mt-8 p-6 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(Be,{className:"w-5 h-5 text-blue-600"}),"Wskazówki dla najlepszych rezultatów"]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 text-sm text-gray-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium mb-1",children:"Przed rozpoczęciem:"}),e.jsxs("ul",{className:"space-y-1 text-gray-600",children:[e.jsx("li",{children:"• Przygotuj podstawowe informacje o kursie"}),e.jsx("li",{children:"• Określ grupę docelową i poziom"}),e.jsx("li",{children:"• Zaplanuj cele edukacyjne"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium mb-1",children:"Podczas tworzenia:"}),e.jsxs("ul",{className:"space-y-1 text-gray-600",children:[e.jsx("li",{children:"• Sprawdzaj podglądy na każdym etapie"}),e.jsx("li",{children:"• Dostosuj wygenerowane treści do potrzeb"}),e.jsx("li",{children:"• Zapisuj regularnie postępy"})]})]})]})]})]})},Dv=[e.jsx(H,{path:"ai-tools",element:e.jsx(Pv,{})},"ai-tools")];function Mv(){return e.jsxs(Z,{children:[e.jsx(me,{title:"Kreator materiałów — panel",description:"Generuj spójny materiał Markdown dla wybranego tematu kursu"}),e.jsxs("div",{className:"relative overflow-hidden rounded-2xl border mb-6",children:[e.jsx("div",{className:"absolute inset-0 bg-blue-50"}),e.jsxs("div",{className:"relative px-6 py-8 flex items-center gap-3",children:[e.jsx("div",{className:"shrink-0 inline-flex h-10 w-10 items-center justify-center rounded-xl bg-black text-white",children:e.jsx($r,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-semibold leading-tight",children:"Kreator materiałów"}),e.jsx("p",{className:"text-sm text-zinc-600",children:"Wygeneruj treść lekcji (Markdown) dla jednego, wskazanego tematu — z opisem, przykładami i podsumowaniem."})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(M,{asChild:!0,children:e.jsxs(Te,{to:"/admin/educational-material/step1",className:"inline-flex items-center gap-2",children:["Nowa sesja",e.jsx(Ae,{className:"w-4 h-4"})]})})})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(pt,{className:"w-5 h-5"}),"Szybki start"]})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("ol",{className:"list-decimal list-inside text-sm text-zinc-700 space-y-1",children:[e.jsx("li",{children:"Wybierz kurs i temat."}),e.jsx("li",{children:"Ustaw parametry (poziom, styl, długość, zgodność z podstawą)."}),e.jsx("li",{children:"Wygeneruj pojedynczy materiał."}),e.jsxs("li",{children:["Zapisz jako aktywność typu ",e.jsx("code",{children:"material"}),"."]}),e.jsx("li",{children:"Opcjonalnie dodaj pytania kontrolne w kroku 4."})]}),e.jsx(M,{asChild:!0,className:"w-full",children:e.jsxs(Te,{to:"/admin/educational-material/step1",className:"inline-flex items-center gap-2",children:["Przejdź do kroku 1",e.jsx(Ae,{className:"w-4 h-4"})]})})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5"}),"Jakie treści generujemy?"]})}),e.jsxs(E,{className:"space-y-3 text-sm text-muted-foreground",children:[e.jsx("p",{children:"Struktura: 6 głównych sekcji (Cele → Pojęcia → Omówienie → Przykłady → Błędy → Podsumowanie)"}),e.jsx("p",{children:"Format: czysty Markdown (obsługujesz już w widoku materiału)."}),e.jsxs(he,{children:[e.jsx(Ln,{className:"h-4 w-4"}),e.jsxs(pe,{className:"text-xs",children:["Jeśli kurs jest maturalny i włączysz zgodność z podstawą LO (2025), kreator dopasuje treści do wymagań z pliku ",e.jsx("code",{children:"curriculum.ts"}),". Pytania kontrolne dodajesz opcjonalnie w kroku 4."]})]})]})]}),e.jsxs(I,{className:"lg:col-span-2",children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-5 h-5"}),"Dodawanie pytań kontrolnych (opcjonalne - krok 4)"]})}),e.jsx(E,{children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Po wygenerowaniu materiałów możesz przejść do kroku 4, aby dodać pytania kontrolne do każdej sekcji."}),e.jsxs("ul",{className:"text-sm text-zinc-700 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Przeglądaj wygenerowane materiały według kursów i tematów"}),e.jsx("li",{children:"Generuj pytania kontrolne dla każdej sekcji materiału"}),e.jsx("li",{children:"Pytania są automatycznie formatowane w YAML i wstawiane do treści"}),e.jsx("li",{children:"Uczniowie muszą odpowiedzieć poprawnie, aby odhaczyć sekcję"})]})]}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx(M,{asChild:!0,variant:"outline",children:e.jsxs(Te,{to:"/admin/educational-material/step4",className:"inline-flex items-center gap-2",children:[e.jsx(Be,{className:"w-4 h-4"}),"Zarządzaj pytaniami"]})})})]})})]})]})]})}function Pp({value:t,onChange:s,showAlert:n=!0,label:i,placeholder:r="Wybierz kurs"}){const[a,o]=f.useState(!1),{data:l}=Q({resource:"courses",filters:a?[{field:"is_published",operator:"eq",value:!0}]:[],sorters:[{field:"created_at",order:"desc"}],pagination:{pageSize:100}}),c=l?.data?.find(d=>d.id===t);return e.jsxs("div",{className:"space-y-4",children:[i&&e.jsx("label",{className:"text-xs font-medium block",children:i}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted rounded-lg",children:[e.jsx(Ke,{checked:a,onCheckedChange:d=>o(!!d)}),e.jsx("label",{className:"text-sm cursor-pointer",children:"Pokazuj tylko opublikowane kursy"})]}),e.jsxs(we,{value:t?String(t):"",onValueChange:d=>s(d?Number(d):null),children:[e.jsx(ge,{children:e.jsx(be,{placeholder:r})}),e.jsx(je,{children:(l?.data||[]).length===0?e.jsx("div",{className:"p-3 text-xs text-muted-foreground",children:a?"Brak opublikowanych kursów. Odznacz filtr.":"Brak kursów. Najpierw wygeneruj kurs."}):(l?.data||[]).map(d=>e.jsx(Y,{value:String(d.id),children:e.jsxs("div",{className:"flex items-center gap-2",children:[d.icon_emoji?`${d.icon_emoji} `:"📚 ",e.jsx("span",{children:d.title}),!d.is_published&&e.jsxs(B,{variant:"outline",className:"ml-2 text-xs",children:[e.jsx(dn,{className:"w-3 h-3 mr-1"}),"Szkic"]})]})},d.id))})]}),n&&c&&!c.is_published&&e.jsxs(he,{children:[e.jsx(Ln,{className:"h-4 w-4"}),e.jsx(pe,{className:"text-xs",children:"Wybrany kurs jest szkicem (nieopublikowany). Materiały zostaną utworzone, ale nie będą widoczne dla uczniów dopóki nie opublikujesz kursu."})]})]})}function cu(t,s){const n=String(t);if(typeof s!="string")throw new TypeError("Expected character");let i=0,r=n.indexOf(s);for(;r!==-1;)i++,r=n.indexOf(s,r+s.length);return i}function Iv(t){if(typeof t!="string")throw new TypeError("Expected a string");return t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function Ev(t,s,n){const r=Hh((n||{}).ignore||[]),a=Lv(s);let o=-1;for(;++o<a.length;)Qy(t,"text",l);function l(d,u){let m=-1,h;for(;++m<u.length;){const p=u[m],j=h?h.children:void 0;if(r(p,j?j.indexOf(p):void 0,h))return;h=p}if(h)return c(d,u)}function c(d,u){const m=u[u.length-1],h=a[o][0],p=a[o][1];let j=0;const x=m.children.indexOf(d);let g=!1,b=[];h.lastIndex=0;let v=h.exec(d.value);for(;v;){const C=v.index,T={index:v.index,input:v.input,stack:[...u,d]};let z=p(...v,T);if(typeof z=="string"&&(z=z.length>0?{type:"text",value:z}:void 0),z===!1?h.lastIndex=C+1:(j!==C&&b.push({type:"text",value:d.value.slice(j,C)}),Array.isArray(z)?b.push(...z):z&&b.push(z),j=C+v[0].length,g=!0),!h.global)break;v=h.exec(d.value)}return g?(j<d.value.length&&b.push({type:"text",value:d.value.slice(j)}),m.children.splice(x,1,...b)):b=[d],x+b.length}}function Lv(t){const s=[];if(!Array.isArray(t))throw new TypeError("Expected find and replace tuple or list of tuples");const n=!t[0]||Array.isArray(t[0])?t:[t];let i=-1;for(;++i<n.length;){const r=n[i];s.push([Rv(r[0]),Ov(r[1])])}return s}function Rv(t){return typeof t=="string"?new RegExp(Iv(t),"g"):t}function Ov(t){return typeof t=="function"?t:function(){return t}}const Wo="phrasing",Go=["autolink","link","image","label"];function $v(){return{transforms:[Wv],enter:{literalAutolink:Fv,literalAutolinkEmail:Ho,literalAutolinkHttp:Ho,literalAutolinkWww:Ho},exit:{literalAutolink:Kv,literalAutolinkEmail:Vv,literalAutolinkHttp:Bv,literalAutolinkWww:Uv}}}function qv(){return{unsafe:[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:Wo,notInConstruct:Go},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:Wo,notInConstruct:Go},{character:":",before:"[ps]",after:"\\/",inConstruct:Wo,notInConstruct:Go}]}}function Fv(t){this.enter({type:"link",title:null,url:"",children:[]},t)}function Ho(t){this.config.enter.autolinkProtocol.call(this,t)}function Bv(t){this.config.exit.autolinkProtocol.call(this,t)}function Uv(t){this.config.exit.data.call(this,t);const s=this.stack[this.stack.length-1];_i(s.type==="link"),s.url="http://"+this.sliceSerialize(t)}function Vv(t){this.config.exit.autolinkEmail.call(this,t)}function Kv(t){this.exit(t)}function Wv(t){Ev(t,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,Gv],[/(?<=^|\s|\p{P}|\p{S})([-.\w+]+)@([-\w]+(?:\.[-\w]+)+)/gu,Hv]],{ignore:["link","linkReference"]})}function Gv(t,s,n,i,r){let a="";if(!Dp(r)||(/^w/i.test(s)&&(n=s+n,s="",a="http://"),!Qv(n)))return!1;const o=Zv(n+i);if(!o[0])return!1;const l={type:"link",title:null,url:a+s+o[0],children:[{type:"text",value:s+o[0]}]};return o[1]?[l,{type:"text",value:o[1]}]:l}function Hv(t,s,n,i){return!Dp(i,!0)||/[-\d_]$/.test(n)?!1:{type:"link",title:null,url:"mailto:"+s+"@"+n,children:[{type:"text",value:s+"@"+n}]}}function Qv(t){const s=t.split(".");return!(s.length<2||s[s.length-1]&&(/_/.test(s[s.length-1])||!/[a-zA-Z\d]/.test(s[s.length-1]))||s[s.length-2]&&(/_/.test(s[s.length-2])||!/[a-zA-Z\d]/.test(s[s.length-2])))}function Zv(t){const s=/[!"&'),.:;<>?\]}]+$/.exec(t);if(!s)return[t,void 0];t=t.slice(0,s.index);let n=s[0],i=n.indexOf(")");const r=cu(t,"(");let a=cu(t,")");for(;i!==-1&&r>a;)t+=n.slice(0,i+1),n=n.slice(i+1),i=n.indexOf(")"),a++;return[t,n]}function Dp(t,s){const n=t.input.charCodeAt(t.index-1);return(t.index===0||ji(n)||hc(n))&&(!s||n!==47)}Mp.peek=r0;function Yv(){this.buffer()}function Jv(t){this.enter({type:"footnoteReference",identifier:"",label:""},t)}function Xv(){this.buffer()}function e0(t){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},t)}function t0(t){const s=this.resume(),n=this.stack[this.stack.length-1];_i(n.type==="footnoteReference"),n.identifier=Lr(this.sliceSerialize(t)).toLowerCase(),n.label=s}function s0(t){this.exit(t)}function n0(t){const s=this.resume(),n=this.stack[this.stack.length-1];_i(n.type==="footnoteDefinition"),n.identifier=Lr(this.sliceSerialize(t)).toLowerCase(),n.label=s}function i0(t){this.exit(t)}function r0(){return"["}function Mp(t,s,n,i){const r=n.createTracker(i);let a=r.move("[^");const o=n.enter("footnoteReference"),l=n.enter("reference");return a+=r.move(n.safe(n.associationId(t),{after:"]",before:a})),l(),o(),a+=r.move("]"),a}function a0(){return{enter:{gfmFootnoteCallString:Yv,gfmFootnoteCall:Jv,gfmFootnoteDefinitionLabelString:Xv,gfmFootnoteDefinition:e0},exit:{gfmFootnoteCallString:t0,gfmFootnoteCall:s0,gfmFootnoteDefinitionLabelString:n0,gfmFootnoteDefinition:i0}}}function o0(t){let s=!1;return t&&t.firstLineBlank&&(s=!0),{handlers:{footnoteDefinition:n,footnoteReference:Mp},unsafe:[{character:"[",inConstruct:["label","phrasing","reference"]}]};function n(i,r,a,o){const l=a.createTracker(o);let c=l.move("[^");const d=a.enter("footnoteDefinition"),u=a.enter("label");return c+=l.move(a.safe(a.associationId(i),{before:c,after:"]"})),u(),c+=l.move("]:"),i.children&&i.children.length>0&&(l.shift(4),c+=l.move((s?`
`:" ")+a.indentLines(a.containerFlow(i,l.current()),s?Ip:l0))),d(),c}}function l0(t,s,n){return s===0?t:Ip(t,s,n)}function Ip(t,s,n){return(n?"":"    ")+t}const c0=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"];Ep.peek=p0;function d0(){return{canContainEols:["delete"],enter:{strikethrough:m0},exit:{strikethrough:h0}}}function u0(){return{unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:c0}],handlers:{delete:Ep}}}function m0(t){this.enter({type:"delete",children:[]},t)}function h0(t){this.exit(t)}function Ep(t,s,n,i){const r=n.createTracker(i),a=n.enter("strikethrough");let o=r.move("~~");return o+=n.containerPhrasing(t,{...r.current(),before:o,after:"~"}),o+=r.move("~~"),a(),o}function p0(){return"~"}function f0(t){return t.length}function x0(t,s){const n=s||{},i=(n.align||[]).concat(),r=n.stringLength||f0,a=[],o=[],l=[],c=[];let d=0,u=-1;for(;++u<t.length;){const y=[],x=[];let g=-1;for(t[u].length>d&&(d=t[u].length);++g<t[u].length;){const b=g0(t[u][g]);if(n.alignDelimiters!==!1){const v=r(b);x[g]=v,(c[g]===void 0||v>c[g])&&(c[g]=v)}y.push(b)}o[u]=y,l[u]=x}let m=-1;if(typeof i=="object"&&"length"in i)for(;++m<d;)a[m]=du(i[m]);else{const y=du(i);for(;++m<d;)a[m]=y}m=-1;const h=[],p=[];for(;++m<d;){const y=a[m];let x="",g="";y===99?(x=":",g=":"):y===108?x=":":y===114&&(g=":");let b=n.alignDelimiters===!1?1:Math.max(1,c[m]-x.length-g.length);const v=x+"-".repeat(b)+g;n.alignDelimiters!==!1&&(b=x.length+b+g.length,b>c[m]&&(c[m]=b),p[m]=b),h[m]=v}o.splice(1,0,h),l.splice(1,0,p),u=-1;const j=[];for(;++u<o.length;){const y=o[u],x=l[u];m=-1;const g=[];for(;++m<d;){const b=y[m]||"";let v="",C="";if(n.alignDelimiters!==!1){const T=c[m]-(x[m]||0),z=a[m];z===114?v=" ".repeat(T):z===99?T%2?(v=" ".repeat(T/2+.5),C=" ".repeat(T/2-.5)):(v=" ".repeat(T/2),C=v):C=" ".repeat(T)}n.delimiterStart!==!1&&!m&&g.push("|"),n.padding!==!1&&!(n.alignDelimiters===!1&&b==="")&&(n.delimiterStart!==!1||m)&&g.push(" "),n.alignDelimiters!==!1&&g.push(v),g.push(b),n.alignDelimiters!==!1&&g.push(C),n.padding!==!1&&g.push(" "),(n.delimiterEnd!==!1||m!==d-1)&&g.push("|")}j.push(n.delimiterEnd===!1?g.join("").replace(/ +$/,""):g.join(""))}return j.join(`
`)}function g0(t){return t==null?"":String(t)}function du(t){const s=typeof t=="string"?t.codePointAt(0):0;return s===67||s===99?99:s===76||s===108?108:s===82||s===114?114:0}function j0(t,s,n,i){const r=n.enter("blockquote"),a=n.createTracker(i);a.move("> "),a.shift(2);const o=n.indentLines(n.containerFlow(t,a.current()),y0);return r(),o}function y0(t,s,n){return">"+(n?"":" ")+t}function w0(t,s){return uu(t,s.inConstruct,!0)&&!uu(t,s.notInConstruct,!1)}function uu(t,s,n){if(typeof s=="string"&&(s=[s]),!s||s.length===0)return n;let i=-1;for(;++i<s.length;)if(t.includes(s[i]))return!0;return!1}function mu(t,s,n,i){let r=-1;for(;++r<n.unsafe.length;)if(n.unsafe[r].character===`
`&&w0(n.stack,n.unsafe[r]))return/[ \t]/.test(i.before)?"":" ";return`\\
`}function b0(t,s){const n=String(t);let i=n.indexOf(s),r=i,a=0,o=0;if(typeof s!="string")throw new TypeError("Expected substring");for(;i!==-1;)i===r?++a>o&&(o=a):a=1,r=i+s.length,i=n.indexOf(s,r);return o}function v0(t,s){return!!(s.options.fences===!1&&t.value&&!t.lang&&/[^ \r\n]/.test(t.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(t.value))}function N0(t){const s=t.options.fence||"`";if(s!=="`"&&s!=="~")throw new Error("Cannot serialize code with `"+s+"` for `options.fence`, expected `` ` `` or `~`");return s}function k0(t,s,n,i){const r=N0(n),a=t.value||"",o=r==="`"?"GraveAccent":"Tilde";if(v0(t,n)){const m=n.enter("codeIndented"),h=n.indentLines(a,z0);return m(),h}const l=n.createTracker(i),c=r.repeat(Math.max(b0(a,r)+1,3)),d=n.enter("codeFenced");let u=l.move(c);if(t.lang){const m=n.enter(`codeFencedLang${o}`);u+=l.move(n.safe(t.lang,{before:u,after:" ",encode:["`"],...l.current()})),m()}if(t.lang&&t.meta){const m=n.enter(`codeFencedMeta${o}`);u+=l.move(" "),u+=l.move(n.safe(t.meta,{before:u,after:`
`,encode:["`"],...l.current()})),m()}return u+=l.move(`
`),a&&(u+=l.move(a+`
`)),u+=l.move(c),d(),u}function z0(t,s,n){return(n?"":"    ")+t}function Nc(t){const s=t.options.quote||'"';if(s!=='"'&&s!=="'")throw new Error("Cannot serialize title with `"+s+"` for `options.quote`, expected `\"`, or `'`");return s}function S0(t,s,n,i){const r=Nc(n),a=r==='"'?"Quote":"Apostrophe",o=n.enter("definition");let l=n.enter("label");const c=n.createTracker(i);let d=c.move("[");return d+=c.move(n.safe(n.associationId(t),{before:d,after:"]",...c.current()})),d+=c.move("]: "),l(),!t.url||/[\0- \u007F]/.test(t.url)?(l=n.enter("destinationLiteral"),d+=c.move("<"),d+=c.move(n.safe(t.url,{before:d,after:">",...c.current()})),d+=c.move(">")):(l=n.enter("destinationRaw"),d+=c.move(n.safe(t.url,{before:d,after:t.title?" ":`
`,...c.current()}))),l(),t.title&&(l=n.enter(`title${a}`),d+=c.move(" "+r),d+=c.move(n.safe(t.title,{before:d,after:r,...c.current()})),d+=c.move(r),l()),o(),d}function C0(t){const s=t.options.emphasis||"*";if(s!=="*"&&s!=="_")throw new Error("Cannot serialize emphasis with `"+s+"` for `options.emphasis`, expected `*`, or `_`");return s}function wr(t){return"&#x"+t.toString(16).toUpperCase()+";"}function Da(t,s,n){const i=za(t),r=za(s);return i===void 0?r===void 0?n==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:r===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:i===1?r===void 0?{inside:!1,outside:!1}:r===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:r===void 0?{inside:!1,outside:!1}:r===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}Lp.peek=_0;function Lp(t,s,n,i){const r=C0(n),a=n.enter("emphasis"),o=n.createTracker(i),l=o.move(r);let c=o.move(n.containerPhrasing(t,{after:r,before:l,...o.current()}));const d=c.charCodeAt(0),u=Da(i.before.charCodeAt(i.before.length-1),d,r);u.inside&&(c=wr(d)+c.slice(1));const m=c.charCodeAt(c.length-1),h=Da(i.after.charCodeAt(0),m,r);h.inside&&(c=c.slice(0,-1)+wr(m));const p=o.move(r);return a(),n.attentionEncodeSurroundingInfo={after:h.outside,before:u.outside},l+c+p}function _0(t,s,n){return n.options.emphasis||"*"}function T0(t,s){let n=!1;return Zy(t,function(i){if("value"in i&&/\r?\n|\r/.test(i.value)||i.type==="break")return n=!0,Yy}),!!((!t.depth||t.depth<3)&&Qh(t)&&(s.options.setext||n))}function A0(t,s,n,i){const r=Math.max(Math.min(6,t.depth||1),1),a=n.createTracker(i);if(T0(t,n)){const u=n.enter("headingSetext"),m=n.enter("phrasing"),h=n.containerPhrasing(t,{...a.current(),before:`
`,after:`
`});return m(),u(),h+`
`+(r===1?"=":"-").repeat(h.length-(Math.max(h.lastIndexOf("\r"),h.lastIndexOf(`
`))+1))}const o="#".repeat(r),l=n.enter("headingAtx"),c=n.enter("phrasing");a.move(o+" ");let d=n.containerPhrasing(t,{before:"# ",after:`
`,...a.current()});return/^[\t ]/.test(d)&&(d=wr(d.charCodeAt(0))+d.slice(1)),d=d?o+" "+d:o,n.options.closeAtx&&(d+=" "+o),c(),l(),d}Rp.peek=P0;function Rp(t){return t.value||""}function P0(){return"<"}Op.peek=D0;function Op(t,s,n,i){const r=Nc(n),a=r==='"'?"Quote":"Apostrophe",o=n.enter("image");let l=n.enter("label");const c=n.createTracker(i);let d=c.move("![");return d+=c.move(n.safe(t.alt,{before:d,after:"]",...c.current()})),d+=c.move("]("),l(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(l=n.enter("destinationLiteral"),d+=c.move("<"),d+=c.move(n.safe(t.url,{before:d,after:">",...c.current()})),d+=c.move(">")):(l=n.enter("destinationRaw"),d+=c.move(n.safe(t.url,{before:d,after:t.title?" ":")",...c.current()}))),l(),t.title&&(l=n.enter(`title${a}`),d+=c.move(" "+r),d+=c.move(n.safe(t.title,{before:d,after:r,...c.current()})),d+=c.move(r),l()),d+=c.move(")"),o(),d}function D0(){return"!"}$p.peek=M0;function $p(t,s,n,i){const r=t.referenceType,a=n.enter("imageReference");let o=n.enter("label");const l=n.createTracker(i);let c=l.move("![");const d=n.safe(t.alt,{before:c,after:"]",...l.current()});c+=l.move(d+"]["),o();const u=n.stack;n.stack=[],o=n.enter("reference");const m=n.safe(n.associationId(t),{before:c,after:"]",...l.current()});return o(),n.stack=u,a(),r==="full"||!d||d!==m?c+=l.move(m+"]"):r==="shortcut"?c=c.slice(0,-1):c+=l.move("]"),c}function M0(){return"!"}qp.peek=I0;function qp(t,s,n){let i=t.value||"",r="`",a=-1;for(;new RegExp("(^|[^`])"+r+"([^`]|$)").test(i);)r+="`";for(/[^ \r\n]/.test(i)&&(/^[ \r\n]/.test(i)&&/[ \r\n]$/.test(i)||/^`|`$/.test(i))&&(i=" "+i+" ");++a<n.unsafe.length;){const o=n.unsafe[a],l=n.compilePattern(o);let c;if(o.atBreak)for(;c=l.exec(i);){let d=c.index;i.charCodeAt(d)===10&&i.charCodeAt(d-1)===13&&d--,i=i.slice(0,d)+" "+i.slice(c.index+1)}}return r+i+r}function I0(){return"`"}function Fp(t,s){const n=Qh(t);return!!(!s.options.resourceLink&&t.url&&!t.title&&t.children&&t.children.length===1&&t.children[0].type==="text"&&(n===t.url||"mailto:"+n===t.url)&&/^[a-z][a-z+.-]+:/i.test(t.url)&&!/[\0- <>\u007F]/.test(t.url))}Bp.peek=E0;function Bp(t,s,n,i){const r=Nc(n),a=r==='"'?"Quote":"Apostrophe",o=n.createTracker(i);let l,c;if(Fp(t,n)){const u=n.stack;n.stack=[],l=n.enter("autolink");let m=o.move("<");return m+=o.move(n.containerPhrasing(t,{before:m,after:">",...o.current()})),m+=o.move(">"),l(),n.stack=u,m}l=n.enter("link"),c=n.enter("label");let d=o.move("[");return d+=o.move(n.containerPhrasing(t,{before:d,after:"](",...o.current()})),d+=o.move("]("),c(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(c=n.enter("destinationLiteral"),d+=o.move("<"),d+=o.move(n.safe(t.url,{before:d,after:">",...o.current()})),d+=o.move(">")):(c=n.enter("destinationRaw"),d+=o.move(n.safe(t.url,{before:d,after:t.title?" ":")",...o.current()}))),c(),t.title&&(c=n.enter(`title${a}`),d+=o.move(" "+r),d+=o.move(n.safe(t.title,{before:d,after:r,...o.current()})),d+=o.move(r),c()),d+=o.move(")"),l(),d}function E0(t,s,n){return Fp(t,n)?"<":"["}Up.peek=L0;function Up(t,s,n,i){const r=t.referenceType,a=n.enter("linkReference");let o=n.enter("label");const l=n.createTracker(i);let c=l.move("[");const d=n.containerPhrasing(t,{before:c,after:"]",...l.current()});c+=l.move(d+"]["),o();const u=n.stack;n.stack=[],o=n.enter("reference");const m=n.safe(n.associationId(t),{before:c,after:"]",...l.current()});return o(),n.stack=u,a(),r==="full"||!d||d!==m?c+=l.move(m+"]"):r==="shortcut"?c=c.slice(0,-1):c+=l.move("]"),c}function L0(){return"["}function kc(t){const s=t.options.bullet||"*";if(s!=="*"&&s!=="+"&&s!=="-")throw new Error("Cannot serialize items with `"+s+"` for `options.bullet`, expected `*`, `+`, or `-`");return s}function R0(t){const s=kc(t),n=t.options.bulletOther;if(!n)return s==="*"?"-":"*";if(n!=="*"&&n!=="+"&&n!=="-")throw new Error("Cannot serialize items with `"+n+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(n===s)throw new Error("Expected `bullet` (`"+s+"`) and `bulletOther` (`"+n+"`) to be different");return n}function O0(t){const s=t.options.bulletOrdered||".";if(s!=="."&&s!==")")throw new Error("Cannot serialize items with `"+s+"` for `options.bulletOrdered`, expected `.` or `)`");return s}function Vp(t){const s=t.options.rule||"*";if(s!=="*"&&s!=="-"&&s!=="_")throw new Error("Cannot serialize rules with `"+s+"` for `options.rule`, expected `*`, `-`, or `_`");return s}function $0(t,s,n,i){const r=n.enter("list"),a=n.bulletCurrent;let o=t.ordered?O0(n):kc(n);const l=t.ordered?o==="."?")":".":R0(n);let c=s&&n.bulletLastUsed?o===n.bulletLastUsed:!1;if(!t.ordered){const u=t.children?t.children[0]:void 0;if((o==="*"||o==="-")&&u&&(!u.children||!u.children[0])&&n.stack[n.stack.length-1]==="list"&&n.stack[n.stack.length-2]==="listItem"&&n.stack[n.stack.length-3]==="list"&&n.stack[n.stack.length-4]==="listItem"&&n.indexStack[n.indexStack.length-1]===0&&n.indexStack[n.indexStack.length-2]===0&&n.indexStack[n.indexStack.length-3]===0&&(c=!0),Vp(n)===o&&u){let m=-1;for(;++m<t.children.length;){const h=t.children[m];if(h&&h.type==="listItem"&&h.children&&h.children[0]&&h.children[0].type==="thematicBreak"){c=!0;break}}}}c&&(o=l),n.bulletCurrent=o;const d=n.containerFlow(t,i);return n.bulletLastUsed=o,n.bulletCurrent=a,r(),d}function q0(t){const s=t.options.listItemIndent||"one";if(s!=="tab"&&s!=="one"&&s!=="mixed")throw new Error("Cannot serialize items with `"+s+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return s}function F0(t,s,n,i){const r=q0(n);let a=n.bulletCurrent||kc(n);s&&s.type==="list"&&s.ordered&&(a=(typeof s.start=="number"&&s.start>-1?s.start:1)+(n.options.incrementListMarker===!1?0:s.children.indexOf(t))+a);let o=a.length+1;(r==="tab"||r==="mixed"&&(s&&s.type==="list"&&s.spread||t.spread))&&(o=Math.ceil(o/4)*4);const l=n.createTracker(i);l.move(a+" ".repeat(o-a.length)),l.shift(o);const c=n.enter("listItem"),d=n.indentLines(n.containerFlow(t,l.current()),u);return c(),d;function u(m,h,p){return h?(p?"":" ".repeat(o))+m:(p?a:a+" ".repeat(o-a.length))+m}}function B0(t,s,n,i){const r=n.enter("paragraph"),a=n.enter("phrasing"),o=n.containerPhrasing(t,i);return a(),r(),o}const U0=Hh(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function V0(t,s,n,i){return(t.children.some(function(o){return U0(o)})?n.containerPhrasing:n.containerFlow).call(n,t,i)}function K0(t){const s=t.options.strong||"*";if(s!=="*"&&s!=="_")throw new Error("Cannot serialize strong with `"+s+"` for `options.strong`, expected `*`, or `_`");return s}Kp.peek=W0;function Kp(t,s,n,i){const r=K0(n),a=n.enter("strong"),o=n.createTracker(i),l=o.move(r+r);let c=o.move(n.containerPhrasing(t,{after:r,before:l,...o.current()}));const d=c.charCodeAt(0),u=Da(i.before.charCodeAt(i.before.length-1),d,r);u.inside&&(c=wr(d)+c.slice(1));const m=c.charCodeAt(c.length-1),h=Da(i.after.charCodeAt(0),m,r);h.inside&&(c=c.slice(0,-1)+wr(m));const p=o.move(r+r);return a(),n.attentionEncodeSurroundingInfo={after:h.outside,before:u.outside},l+c+p}function W0(t,s,n){return n.options.strong||"*"}function G0(t,s,n,i){return n.safe(t.value,i)}function H0(t){const s=t.options.ruleRepetition||3;if(s<3)throw new Error("Cannot serialize rules with repetition `"+s+"` for `options.ruleRepetition`, expected `3` or more");return s}function Q0(t,s,n){const i=(Vp(n)+(n.options.ruleSpaces?" ":"")).repeat(H0(n));return n.options.ruleSpaces?i.slice(0,-1):i}const Wp={blockquote:j0,break:mu,code:k0,definition:S0,emphasis:Lp,hardBreak:mu,heading:A0,html:Rp,image:Op,imageReference:$p,inlineCode:qp,link:Bp,linkReference:Up,list:$0,listItem:F0,paragraph:B0,root:V0,strong:Kp,text:G0,thematicBreak:Q0};function Z0(){return{enter:{table:Y0,tableData:hu,tableHeader:hu,tableRow:X0},exit:{codeText:eN,table:J0,tableData:Qo,tableHeader:Qo,tableRow:Qo}}}function Y0(t){const s=t._align;this.enter({type:"table",align:s.map(function(n){return n==="none"?null:n}),children:[]},t),this.data.inTable=!0}function J0(t){this.exit(t),this.data.inTable=void 0}function X0(t){this.enter({type:"tableRow",children:[]},t)}function Qo(t){this.exit(t)}function hu(t){this.enter({type:"tableCell",children:[]},t)}function eN(t){let s=this.resume();this.data.inTable&&(s=s.replace(/\\([\\|])/g,tN));const n=this.stack[this.stack.length-1];_i(n.type==="inlineCode"),n.value=s,this.exit(t)}function tN(t,s){return s==="|"?s:t}function sN(t){const s=t||{},n=s.tableCellPadding,i=s.tablePipeAlign,r=s.stringLength,a=n?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:`
`,inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[	 :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{inlineCode:h,table:o,tableCell:c,tableRow:l}};function o(p,j,y,x){return d(u(p,y,x),p.align)}function l(p,j,y,x){const g=m(p,y,x),b=d([g]);return b.slice(0,b.indexOf(`
`))}function c(p,j,y,x){const g=y.enter("tableCell"),b=y.enter("phrasing"),v=y.containerPhrasing(p,{...x,before:a,after:a});return b(),g(),v}function d(p,j){return x0(p,{align:j,alignDelimiters:i,padding:n,stringLength:r})}function u(p,j,y){const x=p.children;let g=-1;const b=[],v=j.enter("table");for(;++g<x.length;)b[g]=m(x[g],j,y);return v(),b}function m(p,j,y){const x=p.children;let g=-1;const b=[],v=j.enter("tableRow");for(;++g<x.length;)b[g]=c(x[g],p,j,y);return v(),b}function h(p,j,y){let x=Wp.inlineCode(p,j,y);return y.stack.includes("tableCell")&&(x=x.replace(/\|/g,"\\$&")),x}}function nN(){return{exit:{taskListCheckValueChecked:pu,taskListCheckValueUnchecked:pu,paragraph:rN}}}function iN(){return{unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:aN}}}function pu(t){const s=this.stack[this.stack.length-2];_i(s.type==="listItem"),s.checked=t.type==="taskListCheckValueChecked"}function rN(t){const s=this.stack[this.stack.length-2];if(s&&s.type==="listItem"&&typeof s.checked=="boolean"){const n=this.stack[this.stack.length-1];_i(n.type==="paragraph");const i=n.children[0];if(i&&i.type==="text"){const r=s.children;let a=-1,o;for(;++a<r.length;){const l=r[a];if(l.type==="paragraph"){o=l;break}}o===n&&(i.value=i.value.slice(1),i.value.length===0?n.children.shift():n.position&&i.position&&typeof i.position.start.offset=="number"&&(i.position.start.column++,i.position.start.offset++,n.position.start=Object.assign({},i.position.start)))}}this.exit(t)}function aN(t,s,n,i){const r=t.children[0],a=typeof t.checked=="boolean"&&r&&r.type==="paragraph",o="["+(t.checked?"x":" ")+"] ",l=n.createTracker(i);a&&l.move(o);let c=Wp.listItem(t,s,n,{...i,...l.current()});return a&&(c=c.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,d)),c;function d(u){return u+o}}function oN(){return[$v(),a0(),d0(),Z0(),nN()]}function lN(t){return{extensions:[qv(),o0(t),u0(),sN(t),iN()]}}const cN={tokenize:fN,partial:!0},Gp={tokenize:xN,partial:!0},Hp={tokenize:gN,partial:!0},Qp={tokenize:jN,partial:!0},dN={tokenize:yN,partial:!0},Zp={name:"wwwAutolink",tokenize:hN,previous:Jp},Yp={name:"protocolAutolink",tokenize:pN,previous:Xp},Bs={name:"emailAutolink",tokenize:mN,previous:ef},_s={};function uN(){return{text:_s}}let fn=48;for(;fn<123;)_s[fn]=Bs,fn++,fn===58?fn=65:fn===91&&(fn=97);_s[43]=Bs;_s[45]=Bs;_s[46]=Bs;_s[95]=Bs;_s[72]=[Bs,Yp];_s[104]=[Bs,Yp];_s[87]=[Bs,Zp];_s[119]=[Bs,Zp];function mN(t,s,n){const i=this;let r,a;return o;function o(m){return!_l(m)||!ef.call(i,i.previous)||zc(i.events)?n(m):(t.enter("literalAutolink"),t.enter("literalAutolinkEmail"),l(m))}function l(m){return _l(m)?(t.consume(m),l):m===64?(t.consume(m),c):n(m)}function c(m){return m===46?t.check(dN,u,d)(m):m===45||m===95||pc(m)?(a=!0,t.consume(m),c):u(m)}function d(m){return t.consume(m),r=!0,c}function u(m){return a&&r&&fr(i.previous)?(t.exit("literalAutolinkEmail"),t.exit("literalAutolink"),s(m)):n(m)}}function hN(t,s,n){const i=this;return r;function r(o){return o!==87&&o!==119||!Jp.call(i,i.previous)||zc(i.events)?n(o):(t.enter("literalAutolink"),t.enter("literalAutolinkWww"),t.check(cN,t.attempt(Gp,t.attempt(Hp,a),n),n)(o))}function a(o){return t.exit("literalAutolinkWww"),t.exit("literalAutolink"),s(o)}}function pN(t,s,n){const i=this;let r="",a=!1;return o;function o(m){return(m===72||m===104)&&Xp.call(i,i.previous)&&!zc(i.events)?(t.enter("literalAutolink"),t.enter("literalAutolinkHttp"),r+=String.fromCodePoint(m),t.consume(m),l):n(m)}function l(m){if(fr(m)&&r.length<5)return r+=String.fromCodePoint(m),t.consume(m),l;if(m===58){const h=r.toLowerCase();if(h==="http"||h==="https")return t.consume(m),c}return n(m)}function c(m){return m===47?(t.consume(m),a?d:(a=!0,c)):n(m)}function d(m){return m===null||Jy(m)||Ft(m)||ji(m)||hc(m)?n(m):t.attempt(Gp,t.attempt(Hp,u),n)(m)}function u(m){return t.exit("literalAutolinkHttp"),t.exit("literalAutolink"),s(m)}}function fN(t,s,n){let i=0;return r;function r(o){return(o===87||o===119)&&i<3?(i++,t.consume(o),r):o===46&&i===3?(t.consume(o),a):n(o)}function a(o){return o===null?n(o):s(o)}}function xN(t,s,n){let i,r,a;return o;function o(d){return d===46||d===95?t.check(Qp,c,l)(d):d===null||Ft(d)||ji(d)||d!==45&&hc(d)?c(d):(a=!0,t.consume(d),o)}function l(d){return d===95?i=!0:(r=i,i=void 0),t.consume(d),o}function c(d){return r||i||!a?n(d):s(d)}}function gN(t,s){let n=0,i=0;return r;function r(o){return o===40?(n++,t.consume(o),r):o===41&&i<n?a(o):o===33||o===34||o===38||o===39||o===41||o===42||o===44||o===46||o===58||o===59||o===60||o===63||o===93||o===95||o===126?t.check(Qp,s,a)(o):o===null||Ft(o)||ji(o)?s(o):(t.consume(o),r)}function a(o){return o===41&&i++,t.consume(o),r}}function jN(t,s,n){return i;function i(l){return l===33||l===34||l===39||l===41||l===42||l===44||l===46||l===58||l===59||l===63||l===95||l===126?(t.consume(l),i):l===38?(t.consume(l),a):l===93?(t.consume(l),r):l===60||l===null||Ft(l)||ji(l)?s(l):n(l)}function r(l){return l===null||l===40||l===91||Ft(l)||ji(l)?s(l):i(l)}function a(l){return fr(l)?o(l):n(l)}function o(l){return l===59?(t.consume(l),i):fr(l)?(t.consume(l),o):n(l)}}function yN(t,s,n){return i;function i(a){return t.consume(a),r}function r(a){return pc(a)?n(a):s(a)}}function Jp(t){return t===null||t===40||t===42||t===95||t===91||t===93||t===126||Ft(t)}function Xp(t){return!fr(t)}function ef(t){return!(t===47||_l(t))}function _l(t){return t===43||t===45||t===46||t===95||pc(t)}function zc(t){let s=t.length,n=!1;for(;s--;){const i=t[s][1];if((i.type==="labelLink"||i.type==="labelImage")&&!i._balanced){n=!0;break}if(i._gfmAutolinkLiteralWalkedInto){n=!1;break}}return t.length>0&&!n&&(t[t.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),n}const wN={tokenize:_N,partial:!0};function bN(){return{document:{91:{name:"gfmFootnoteDefinition",tokenize:zN,continuation:{tokenize:SN},exit:CN}},text:{91:{name:"gfmFootnoteCall",tokenize:kN},93:{name:"gfmPotentialFootnoteCall",add:"after",tokenize:vN,resolveTo:NN}}}}function vN(t,s,n){const i=this;let r=i.events.length;const a=i.parser.gfmFootnotes||(i.parser.gfmFootnotes=[]);let o;for(;r--;){const c=i.events[r][1];if(c.type==="labelImage"){o=c;break}if(c.type==="gfmFootnoteCall"||c.type==="labelLink"||c.type==="label"||c.type==="image"||c.type==="link")break}return l;function l(c){if(!o||!o._balanced)return n(c);const d=Lr(i.sliceSerialize({start:o.end,end:i.now()}));return d.codePointAt(0)!==94||!a.includes(d.slice(1))?n(c):(t.enter("gfmFootnoteCallLabelMarker"),t.consume(c),t.exit("gfmFootnoteCallLabelMarker"),s(c))}}function NN(t,s){let n=t.length;for(;n--;)if(t[n][1].type==="labelImage"&&t[n][0]==="enter"){t[n][1];break}t[n+1][1].type="data",t[n+3][1].type="gfmFootnoteCallLabelMarker";const i={type:"gfmFootnoteCall",start:Object.assign({},t[n+3][1].start),end:Object.assign({},t[t.length-1][1].end)},r={type:"gfmFootnoteCallMarker",start:Object.assign({},t[n+3][1].end),end:Object.assign({},t[n+3][1].end)};r.end.column++,r.end.offset++,r.end._bufferIndex++;const a={type:"gfmFootnoteCallString",start:Object.assign({},r.end),end:Object.assign({},t[t.length-1][1].start)},o={type:"chunkString",contentType:"string",start:Object.assign({},a.start),end:Object.assign({},a.end)},l=[t[n+1],t[n+2],["enter",i,s],t[n+3],t[n+4],["enter",r,s],["exit",r,s],["enter",a,s],["enter",o,s],["exit",o,s],["exit",a,s],t[t.length-2],t[t.length-1],["exit",i,s]];return t.splice(n,t.length-n+1,...l),t}function kN(t,s,n){const i=this,r=i.parser.gfmFootnotes||(i.parser.gfmFootnotes=[]);let a=0,o;return l;function l(m){return t.enter("gfmFootnoteCall"),t.enter("gfmFootnoteCallLabelMarker"),t.consume(m),t.exit("gfmFootnoteCallLabelMarker"),c}function c(m){return m!==94?n(m):(t.enter("gfmFootnoteCallMarker"),t.consume(m),t.exit("gfmFootnoteCallMarker"),t.enter("gfmFootnoteCallString"),t.enter("chunkString").contentType="string",d)}function d(m){if(a>999||m===93&&!o||m===null||m===91||Ft(m))return n(m);if(m===93){t.exit("chunkString");const h=t.exit("gfmFootnoteCallString");return r.includes(Lr(i.sliceSerialize(h)))?(t.enter("gfmFootnoteCallLabelMarker"),t.consume(m),t.exit("gfmFootnoteCallLabelMarker"),t.exit("gfmFootnoteCall"),s):n(m)}return Ft(m)||(o=!0),a++,t.consume(m),m===92?u:d}function u(m){return m===91||m===92||m===93?(t.consume(m),a++,d):d(m)}}function zN(t,s,n){const i=this,r=i.parser.gfmFootnotes||(i.parser.gfmFootnotes=[]);let a,o=0,l;return c;function c(j){return t.enter("gfmFootnoteDefinition")._container=!0,t.enter("gfmFootnoteDefinitionLabel"),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(j),t.exit("gfmFootnoteDefinitionLabelMarker"),d}function d(j){return j===94?(t.enter("gfmFootnoteDefinitionMarker"),t.consume(j),t.exit("gfmFootnoteDefinitionMarker"),t.enter("gfmFootnoteDefinitionLabelString"),t.enter("chunkString").contentType="string",u):n(j)}function u(j){if(o>999||j===93&&!l||j===null||j===91||Ft(j))return n(j);if(j===93){t.exit("chunkString");const y=t.exit("gfmFootnoteDefinitionLabelString");return a=Lr(i.sliceSerialize(y)),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(j),t.exit("gfmFootnoteDefinitionLabelMarker"),t.exit("gfmFootnoteDefinitionLabel"),h}return Ft(j)||(l=!0),o++,t.consume(j),j===92?m:u}function m(j){return j===91||j===92||j===93?(t.consume(j),o++,u):u(j)}function h(j){return j===58?(t.enter("definitionMarker"),t.consume(j),t.exit("definitionMarker"),r.includes(a)||r.push(a),Ys(t,p,"gfmFootnoteDefinitionWhitespace")):n(j)}function p(j){return s(j)}}function SN(t,s,n){return t.check(Xy,s,t.attempt(wN,s,n))}function CN(t){t.exit("gfmFootnoteDefinition")}function _N(t,s,n){const i=this;return Ys(t,r,"gfmFootnoteDefinitionIndent",5);function r(a){const o=i.events[i.events.length-1];return o&&o[1].type==="gfmFootnoteDefinitionIndent"&&o[2].sliceSerialize(o[1],!0).length===4?s(a):n(a)}}function TN(t){let n=(t||{}).singleTilde;const i={name:"strikethrough",tokenize:a,resolveAll:r};return n==null&&(n=!0),{text:{126:i},insideSpan:{null:[i]},attentionMarkers:{null:[126]}};function r(o,l){let c=-1;for(;++c<o.length;)if(o[c][0]==="enter"&&o[c][1].type==="strikethroughSequenceTemporary"&&o[c][1]._close){let d=c;for(;d--;)if(o[d][0]==="exit"&&o[d][1].type==="strikethroughSequenceTemporary"&&o[d][1]._open&&o[c][1].end.offset-o[c][1].start.offset===o[d][1].end.offset-o[d][1].start.offset){o[c][1].type="strikethroughSequence",o[d][1].type="strikethroughSequence";const u={type:"strikethrough",start:Object.assign({},o[d][1].start),end:Object.assign({},o[c][1].end)},m={type:"strikethroughText",start:Object.assign({},o[d][1].end),end:Object.assign({},o[c][1].start)},h=[["enter",u,l],["enter",o[d][1],l],["exit",o[d][1],l],["enter",m,l]],p=l.parser.constructs.insideSpan.null;p&&Bo(h,h.length,0,ew(p,o.slice(d+1,c),l)),Bo(h,h.length,0,[["exit",m,l],["enter",o[c][1],l],["exit",o[c][1],l],["exit",u,l]]),Bo(o,d-1,c-d+3,h),c=d+h.length-2;break}}for(c=-1;++c<o.length;)o[c][1].type==="strikethroughSequenceTemporary"&&(o[c][1].type="data");return o}function a(o,l,c){const d=this.previous,u=this.events;let m=0;return h;function h(j){return d===126&&u[u.length-1][1].type!=="characterEscape"?c(j):(o.enter("strikethroughSequenceTemporary"),p(j))}function p(j){const y=za(d);if(j===126)return m>1?c(j):(o.consume(j),m++,p);if(m<2&&!n)return c(j);const x=o.exit("strikethroughSequenceTemporary"),g=za(j);return x._open=!g||g===2&&!!y,x._close=!y||y===2&&!!g,l(j)}}}class AN{constructor(){this.map=[]}add(s,n,i){PN(this,s,n,i)}consume(s){if(this.map.sort(function(a,o){return a[0]-o[0]}),this.map.length===0)return;let n=this.map.length;const i=[];for(;n>0;)n-=1,i.push(s.slice(this.map[n][0]+this.map[n][1]),this.map[n][2]),s.length=this.map[n][0];i.push(s.slice()),s.length=0;let r=i.pop();for(;r;){for(const a of r)s.push(a);r=i.pop()}this.map.length=0}}function PN(t,s,n,i){let r=0;if(!(n===0&&i.length===0)){for(;r<t.map.length;){if(t.map[r][0]===s){t.map[r][1]+=n,t.map[r][2].push(...i);return}r+=1}t.map.push([s,n,i])}}function DN(t,s){let n=!1;const i=[];for(;s<t.length;){const r=t[s];if(n){if(r[0]==="enter")r[1].type==="tableContent"&&i.push(t[s+1][1].type==="tableDelimiterMarker"?"left":"none");else if(r[1].type==="tableContent"){if(t[s-1][1].type==="tableDelimiterMarker"){const a=i.length-1;i[a]=i[a]==="left"?"center":"right"}}else if(r[1].type==="tableDelimiterRow")break}else r[0]==="enter"&&r[1].type==="tableDelimiterRow"&&(n=!0);s+=1}return i}function MN(){return{flow:{null:{name:"table",tokenize:IN,resolveAll:EN}}}}function IN(t,s,n){const i=this;let r=0,a=0,o;return l;function l(w){let k=i.events.length-1;for(;k>-1;){const D=i.events[k][1].type;if(D==="lineEnding"||D==="linePrefix")k--;else break}const _=k>-1?i.events[k][1].type:null,A=_==="tableHead"||_==="tableRow"?z:c;return A===z&&i.parser.lazy[i.now().line]?n(w):A(w)}function c(w){return t.enter("tableHead"),t.enter("tableRow"),d(w)}function d(w){return w===124||(o=!0,a+=1),u(w)}function u(w){return w===null?n(w):er(w)?a>1?(a=0,i.interrupt=!0,t.exit("tableRow"),t.enter("lineEnding"),t.consume(w),t.exit("lineEnding"),p):n(w):Yn(w)?Ys(t,u,"whitespace")(w):(a+=1,o&&(o=!1,r+=1),w===124?(t.enter("tableCellDivider"),t.consume(w),t.exit("tableCellDivider"),o=!0,u):(t.enter("data"),m(w)))}function m(w){return w===null||w===124||Ft(w)?(t.exit("data"),u(w)):(t.consume(w),w===92?h:m)}function h(w){return w===92||w===124?(t.consume(w),m):m(w)}function p(w){return i.interrupt=!1,i.parser.lazy[i.now().line]?n(w):(t.enter("tableDelimiterRow"),o=!1,Yn(w)?Ys(t,j,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(w):j(w))}function j(w){return w===45||w===58?x(w):w===124?(o=!0,t.enter("tableCellDivider"),t.consume(w),t.exit("tableCellDivider"),y):T(w)}function y(w){return Yn(w)?Ys(t,x,"whitespace")(w):x(w)}function x(w){return w===58?(a+=1,o=!0,t.enter("tableDelimiterMarker"),t.consume(w),t.exit("tableDelimiterMarker"),g):w===45?(a+=1,g(w)):w===null||er(w)?C(w):T(w)}function g(w){return w===45?(t.enter("tableDelimiterFiller"),b(w)):T(w)}function b(w){return w===45?(t.consume(w),b):w===58?(o=!0,t.exit("tableDelimiterFiller"),t.enter("tableDelimiterMarker"),t.consume(w),t.exit("tableDelimiterMarker"),v):(t.exit("tableDelimiterFiller"),v(w))}function v(w){return Yn(w)?Ys(t,C,"whitespace")(w):C(w)}function C(w){return w===124?j(w):w===null||er(w)?!o||r!==a?T(w):(t.exit("tableDelimiterRow"),t.exit("tableHead"),s(w)):T(w)}function T(w){return n(w)}function z(w){return t.enter("tableRow"),N(w)}function N(w){return w===124?(t.enter("tableCellDivider"),t.consume(w),t.exit("tableCellDivider"),N):w===null||er(w)?(t.exit("tableRow"),s(w)):Yn(w)?Ys(t,N,"whitespace")(w):(t.enter("data"),S(w))}function S(w){return w===null||w===124||Ft(w)?(t.exit("data"),N(w)):(t.consume(w),w===92?P:S)}function P(w){return w===92||w===124?(t.consume(w),S):S(w)}}function EN(t,s){let n=-1,i=!0,r=0,a=[0,0,0,0],o=[0,0,0,0],l=!1,c=0,d,u,m;const h=new AN;for(;++n<t.length;){const p=t[n],j=p[1];p[0]==="enter"?j.type==="tableHead"?(l=!1,c!==0&&(fu(h,s,c,d,u),u=void 0,c=0),d={type:"table",start:Object.assign({},j.start),end:Object.assign({},j.end)},h.add(n,0,[["enter",d,s]])):j.type==="tableRow"||j.type==="tableDelimiterRow"?(i=!0,m=void 0,a=[0,0,0,0],o=[0,n+1,0,0],l&&(l=!1,u={type:"tableBody",start:Object.assign({},j.start),end:Object.assign({},j.end)},h.add(n,0,[["enter",u,s]])),r=j.type==="tableDelimiterRow"?2:u?3:1):r&&(j.type==="data"||j.type==="tableDelimiterMarker"||j.type==="tableDelimiterFiller")?(i=!1,o[2]===0&&(a[1]!==0&&(o[0]=o[1],m=na(h,s,a,r,void 0,m),a=[0,0,0,0]),o[2]=n)):j.type==="tableCellDivider"&&(i?i=!1:(a[1]!==0&&(o[0]=o[1],m=na(h,s,a,r,void 0,m)),a=o,o=[a[1],n,0,0])):j.type==="tableHead"?(l=!0,c=n):j.type==="tableRow"||j.type==="tableDelimiterRow"?(c=n,a[1]!==0?(o[0]=o[1],m=na(h,s,a,r,n,m)):o[1]!==0&&(m=na(h,s,o,r,n,m)),r=0):r&&(j.type==="data"||j.type==="tableDelimiterMarker"||j.type==="tableDelimiterFiller")&&(o[3]=n)}for(c!==0&&fu(h,s,c,d,u),h.consume(s.events),n=-1;++n<s.events.length;){const p=s.events[n];p[0]==="enter"&&p[1].type==="table"&&(p[1]._align=DN(s.events,n))}return t}function na(t,s,n,i,r,a){const o=i===1?"tableHeader":i===2?"tableDelimiter":"tableData",l="tableContent";n[0]!==0&&(a.end=Object.assign({},Jn(s.events,n[0])),t.add(n[0],0,[["exit",a,s]]));const c=Jn(s.events,n[1]);if(a={type:o,start:Object.assign({},c),end:Object.assign({},c)},t.add(n[1],0,[["enter",a,s]]),n[2]!==0){const d=Jn(s.events,n[2]),u=Jn(s.events,n[3]),m={type:l,start:Object.assign({},d),end:Object.assign({},u)};if(t.add(n[2],0,[["enter",m,s]]),i!==2){const h=s.events[n[2]],p=s.events[n[3]];if(h[1].end=Object.assign({},p[1].end),h[1].type="chunkText",h[1].contentType="text",n[3]>n[2]+1){const j=n[2]+1,y=n[3]-n[2]-1;t.add(j,y,[])}}t.add(n[3]+1,0,[["exit",m,s]])}return r!==void 0&&(a.end=Object.assign({},Jn(s.events,r)),t.add(r,0,[["exit",a,s]]),a=void 0),a}function fu(t,s,n,i,r){const a=[],o=Jn(s.events,n);r&&(r.end=Object.assign({},o),a.push(["exit",r,s])),i.end=Object.assign({},o),a.push(["exit",i,s]),t.add(n+1,0,a)}function Jn(t,s){const n=t[s],i=n[0]==="enter"?"start":"end";return n[1][i]}const LN={name:"tasklistCheck",tokenize:ON};function RN(){return{text:{91:LN}}}function ON(t,s,n){const i=this;return r;function r(c){return i.previous!==null||!i._gfmTasklistFirstContentOfListItem?n(c):(t.enter("taskListCheck"),t.enter("taskListCheckMarker"),t.consume(c),t.exit("taskListCheckMarker"),a)}function a(c){return Ft(c)?(t.enter("taskListCheckValueUnchecked"),t.consume(c),t.exit("taskListCheckValueUnchecked"),o):c===88||c===120?(t.enter("taskListCheckValueChecked"),t.consume(c),t.exit("taskListCheckValueChecked"),o):n(c)}function o(c){return c===93?(t.enter("taskListCheckMarker"),t.consume(c),t.exit("taskListCheckMarker"),t.exit("taskListCheck"),l):n(c)}function l(c){return er(c)?s(c):Yn(c)?t.check({tokenize:$N},s,n)(c):n(c)}}function $N(t,s,n){return Ys(t,i,"whitespace");function i(r){return r===null?n(r):s(r)}}function qN(t){return tw([uN(),bN(),TN(t),MN(),RN()])}const FN={};function An(t){const s=this,n=t||FN,i=s.data(),r=i.micromarkExtensions||(i.micromarkExtensions=[]),a=i.fromMarkdownExtensions||(i.fromMarkdownExtensions=[]),o=i.toMarkdownExtensions||(i.toMarkdownExtensions=[]);r.push(qN(n)),a.push(oN()),o.push(lN(n))}const mo=({content:t,metadata:s,showMetadata:n=!0,height:i="500px"})=>e.jsxs("div",{className:"space-y-4",children:[n&&s&&e.jsxs("div",{className:"grid grid-cols-3 gap-4 p-4 bg-muted rounded-lg",children:[s.duration_min&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[e.jsx(De,{className:"w-4 h-4"}),"Czas trwania"]}),e.jsxs("p",{className:"font-medium",children:[s.duration_min," minut"]})]}),s.position!==void 0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[e.jsx(tp,{className:"w-4 h-4"}),"Pozycja"]}),e.jsx("p",{className:"font-medium",children:s.position})]}),s.created_at&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[e.jsx(At,{className:"w-4 h-4"}),"Utworzono"]}),e.jsx("p",{className:"font-medium",children:new Date(s.created_at).toLocaleDateString("pl-PL")})]}),s.updated_at&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[e.jsx(At,{className:"w-4 h-4"}),"Ostatnia aktualizacja"]}),e.jsx("p",{className:"font-medium",children:new Date(s.updated_at).toLocaleDateString("pl-PL")})]})]}),e.jsx(Ze,{className:"rounded-lg border p-4",style:{height:i},children:e.jsx("div",{className:"prose prose-sm max-w-none dark:prose-invert",children:e.jsx(Sn,{remarkPlugins:[An],children:t})})})]}),BN={type:"object",properties:{courseId:{type:"number",required:!0},topicId:{type:"number",required:!0},subject:{type:"string"},level:{type:"string"},isMaturaCourse:{type:"boolean"},alignToCurriculum:{type:"boolean"},defaultDuration:{type:"number"},style:{type:"string"},tone:{type:"string"}}};function UN(){const{registerStep:t,setStepData:s,getStepData:n}=Ns(),i=le(),r=n("em_step1")||{},[a,o]=f.useState({open:!1,material:null});f.useEffect(()=>{t("em_step1",BN),r.subject||s("em_step1",{subject:"Matematyka",level:"podstawowy",isMaturaCourse:!0,alignToCurriculum:!0,style:"notebook",tone:"friendly",defaultDuration:20})},[]);const{data:l}=Q({resource:"courses",sorters:[{field:"created_at",order:"desc"}],pagination:{pageSize:100}}),{data:c,isLoading:d}=Q({resource:"topics",filters:[{field:"course_id",operator:"eq",value:r.courseId||-1}],sorters:[{field:"position",order:"asc"}],pagination:{pageSize:500},queryOptions:{enabled:!!r.courseId}}),u=f.useMemo(()=>(c?.data||[]).map(C=>C.id),[c?.data]),{data:m}=Q({resource:"activities",filters:u.length>0?[{field:"topic_id",operator:"in",value:u},{field:"type",operator:"eq",value:"material"}]:[],sorters:[{field:"position",order:"asc"}],pagination:{pageSize:1e3},meta:{select:"id,topic_id,title,type,position,content,duration_min,created_at,is_published"},queryOptions:{enabled:u.length>0}}),h=f.useMemo(()=>{const C={};if(m?.data)for(const T of m.data){const z=T.topic_id;C[z]||(C[z]={count:0,materials:[]}),C[z].count++,C[z].materials.push(T)}return C},[m?.data]);f.useEffect(()=>{s("em_step1",{topicId:void 0})},[r.courseId]);const p=f.useMemo(()=>l?.data?.find(C=>C.id===r.courseId),[l?.data,r.courseId]);f.useEffect(()=>{if(!p)return;const T=String(p.level||"").toLowerCase()==="rozszerzony"?"rozszerzony":"podstawowy";s("em_step1",{subject:p.subject||"Matematyka",level:T,isMaturaCourse:!!p.is_exam_course,alignToCurriculum:!!p.is_exam_course})},[p]);const[j,y]=f.useState(""),x=f.useMemo(()=>{const C=c?.data||[];if(!j.trim())return C;const T=j.toLowerCase();return C.filter(z=>String(z.title).toLowerCase().includes(T)||String(z.position).includes(T))},[c?.data,j]),g=f.useMemo(()=>vc(r.subject),[r.subject]),b=!!r.courseId&&!!r.topicId,v=(C,T)=>{T.stopPropagation(),o({open:!0,material:C})};return e.jsxs(Z,{children:[e.jsx(me,{title:"Krok 1",description:"Wybór kursu, tematu i parametrów"}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[1.2fr,0.8fr]",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Kurs i temat"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsx(Pp,{value:r.courseId||null,onChange:C=>s("em_step1",{courseId:C||void 0}),showAlert:!0}),r.courseId&&e.jsxs("div",{className:"rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 border-b bg-muted/40",children:[e.jsx(Ti,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(J,{value:j,onChange:C=>y(C.target.value),placeholder:"Filtruj tematy…",className:"h-8"})]}),e.jsxs("div",{className:"divide-y",children:[d&&e.jsx("div",{className:"p-3 text-xs text-muted-foreground",children:"Ładowanie tematów…"}),!d&&x.length===0&&e.jsx("div",{className:"p-3 text-xs text-muted-foreground",children:j?"Brak wyników dla filtru.":"Ten kurs nie ma jeszcze tematów."}),x.map(C=>{const T=h[C.id],z=r.topicId===C.id;return e.jsx("button",{type:"button",onClick:()=>s("em_step1",{topicId:C.id}),className:["w-full text-left p-3 hover:bg-muted/50 transition",z?"bg-blue-50/60 ring-1 ring-blue-200":""].join(" "),children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx("span",{className:"shrink-0 inline-flex items-center justify-center w-5 h-5 rounded-full bg-primary/10 text-xs font-semibold",children:C.position}),e.jsx("span",{className:"truncate",children:C.title}),!C.is_published&&e.jsx(B,{variant:"outline",className:"text-xs shrink-0",children:e.jsx(dn,{className:"w-3 h-3"})})]}),z&&e.jsx("div",{className:"mt-2 ml-7",children:T?.count>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground mb-1",children:[e.jsx(kt,{className:"w-3 h-3"}),e.jsx("span",{children:"Materiały:"}),e.jsx(B,{variant:"secondary",className:"text-xs h-4 px-1",children:T.count})]}),e.jsx("ul",{className:"space-y-0.5 ml-4",children:T.materials.map(N=>e.jsx("li",{className:"text-[11px]",children:e.jsxs("button",{onClick:S=>v(N,S),className:"text-primary/70 hover:text-primary hover:underline inline-flex items-center gap-1 w-full text-left",children:[e.jsx("span",{className:"mr-1",children:"•"}),e.jsx("span",{className:"truncate flex-1",children:N.title}),e.jsx(tt,{className:"w-3 h-3 opacity-0 hover:opacity-100 transition-opacity flex-shrink-0"})]})},N.id))})]}):e.jsx("div",{className:"text-xs text-muted-foreground/50 italic",children:"Brak materiałów"})})]}),e.jsx("div",{className:["shrink-0 w-3 h-3 rounded-full border mt-1",z?"bg-blue-500 border-blue-500":"bg-white"].join(" "),"aria-hidden":!0})]})},C.id)})]}),e.jsx("div",{className:"p-2 border-t text-[11px] text-muted-foreground",children:"Kliknij temat aby go wybrać i zobaczyć wszystkie materiały. Kliknij tytuł materiału aby zobaczyć podgląd."})]})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Parametry generowania"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs(we,{value:r.subject||"Matematyka",onValueChange:C=>s("em_step1",{subject:C}),children:[e.jsx(ge,{children:e.jsx(be,{placeholder:"Przedmiot"})}),e.jsx(je,{children:bc.map(C=>e.jsx(Y,{value:C,children:C},C))})]}),e.jsxs(we,{value:r.level||"podstawowy",onValueChange:C=>s("em_step1",{level:C}),children:[e.jsx(ge,{children:e.jsx(be,{placeholder:"Poziom"})}),e.jsxs(je,{children:[e.jsx(Y,{value:"podstawowy",children:"Podstawowy"}),e.jsx(Y,{value:"rozszerzony",children:"Rozszerzony"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{checked:r.isMaturaCourse||!1,onCheckedChange:C=>s("em_step1",{isMaturaCourse:!!C,alignToCurriculum:C?r.alignToCurriculum:!1})}),e.jsx("span",{className:"text-sm",children:"Kurs maturalny"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{checked:r.alignToCurriculum||!1,onCheckedChange:C=>s("em_step1",{alignToCurriculum:!!C}),disabled:!r.isMaturaCourse}),e.jsx("span",{className:"text-sm",children:"Uwzględnij najnowszą (2025) podstawę LO (PL)"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-1",children:"Styl"}),e.jsxs(we,{value:r.style||"notebook",onValueChange:C=>s("em_step1",{style:C}),children:[e.jsx(ge,{children:e.jsx(be,{placeholder:"Wybierz styl"})}),e.jsxs(je,{children:[e.jsx(Y,{value:"notebook",children:"Notatka z lekcji"}),e.jsx(Y,{value:"exam",children:"Pod egzamin"}),e.jsx(Y,{value:"concise",children:"Zwięzły"})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-1",children:"Ton"}),e.jsxs(we,{value:r.tone||"friendly",onValueChange:C=>s("em_step1",{tone:C}),children:[e.jsx(ge,{children:e.jsx(be,{placeholder:"Ton"})}),e.jsxs(je,{children:[e.jsx(Y,{value:"friendly",children:"Przystępny"}),e.jsx(Y,{value:"neutral",children:"Neutralny"}),e.jsx(Y,{value:"formal",children:"Formalny"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-1",children:"Domyślny czas (min)"}),e.jsx(J,{type:"number",min:5,value:r.defaultDuration??20,onChange:C=>s("em_step1",{defaultDuration:Number(C.target.value)})})]}),r.isMaturaCourse&&r.alignToCurriculum&&g&&e.jsxs(he,{children:[e.jsx(Ln,{className:"h-4 w-4"}),e.jsxs(pe,{className:"text-xs",children:["Dokument: ",e.jsx("strong",{children:g.label}),g.year?` • ${g.year}`:""]})]}),e.jsxs(M,{disabled:!b,className:"w-full",onClick:()=>i("/admin/educational-material/step2"),children:["Kontynuuj",e.jsx(Ae,{className:"w-4 h-4 ml-1"})]}),!b&&e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Wybierz kurs i temat aby kontynuować"})]})]})]}),e.jsx(ds,{open:a.open,onOpenChange:C=>{C||o({open:!1,material:null})},children:e.jsxs(Jt,{className:"max-w-6xl max-h-[90vh]",children:[e.jsxs(Xt,{children:[e.jsxs(es,{className:"flex items-center gap-2",children:[e.jsx(tt,{className:"w-5 h-5"}),a.material?.title]}),e.jsxs(bi,{children:["Podgląd materiału • ",a.material?.duration_min||20," min"]})]}),a.material&&e.jsx(mo,{content:a.material.content,metadata:{duration_min:a.material.duration_min,position:a.material.position,created_at:a.material.created_at},showMetadata:!0,height:"500px"})]})})]})}const VN={type:"object",properties:{title:{type:"string",required:!0},duration_min:{type:"number"},content_markdown:{type:"string",required:!0},section_count:{type:"number",minimum:6,maximum:6,description:"Must have exactly 6 H2 sections"}}},KN={Matematyka:"używaj wzorów matematycznych w blokach kodu, pokazuj kroki rozwiązania, dodawaj wykresy ASCII gdzie to możliwe",Angielski:"dodaj tabele z odmianą czasowników, przykładowe dialogi, różnice British/American English",Informatyka:"używaj bloków kodu z komentarzami, pokazuj input/output, best practices",Fizyka:"wyjaśniaj wzory krok po kroku, dodawaj jednostki, pokazuj zastosowania praktyczne",Chemia:"równania reakcji w blokach kodu, zasady bezpieczeństwa, przykłady z życia",Biologia:"używaj analogii do życia codziennego, pokazuj zależności w ekosystemach",Historia:"dodawaj kontekst czasowy, mapy konceptualne wydarzeń, ciekawostki",Geografia:"opisuj zjawiska z przykładami regionalnymi, wpływ człowieka na środowisko",Polski:"analizuj teksty krok po kroku, środki stylistyczne z przykładami"},WN={podstawowy:"uczniowie 12-16 lat - używaj prostych analogii z życia codziennego, gier, social mediów, unikaj abstrakcji",rozszerzony:"uczniowie 16-19 lat - mogą zrozumieć abstrakcje, zainteresowani praktycznymi zastosowaniami i karierą"},GN=t=>{const s=t.match(/^##\s+[^#]/gm);if(!s||s.length!==6)throw new Error(`Nieprawidłowa struktura: znaleziono ${s?.length||0} sekcji, wymagane 6`);if(/^#\s+[^#]/m.test(t))throw new Error("Materiał zawiera niedozwolone nagłówki H1");if(/```quiz/i.test(t))throw new Error("Materiał zawiera bloki quiz - usuń je, quizy dodaje się w Step 4");return!0};function HN(){const{getStepData:t,setStepData:s}=Ns(),n=le(),i=t("em_step1"),r=i?.courseId,a=i?.topicId,[o,l]=f.useState(null),[c,d]=f.useState(!1),[u,m]=f.useState(null),[h,p]=f.useState(null),[j,y]=f.useState(!1);f.useEffect(()=>{(!r||!a)&&n("/admin/educational-material/step1")},[r,a,n]);const{data:x}=Q({resource:"topics",filters:[{field:"course_id",operator:"eq",value:r||-1},{field:"id",operator:"eq",value:a||-1}],sorters:[{field:"position",order:"asc"}],pagination:{pageSize:1},queryOptions:{enabled:!!r&&!!a}}),g=f.useMemo(()=>(x?.data||[])[0],[x?.data]),b=f.useMemo(()=>{if(g?.id!=null)return typeof g.id=="string"?Number(g.id):g.id},[g?.id]),v=f.useMemo(()=>g?.position==null?0:typeof g.position=="string"?Number(g.position):g.position,[g?.position]),{data:C}=Le({resource:"courses",id:String(r||""),meta:{select:"*"},queryOptions:{enabled:!!r}}),T=i?.isMaturaCourse&&i?.alignToCurriculum?vc(i?.subject):null,z=async()=>{if(!g||b==null)return;m(null),p(null),y(!1),d(!0),s("em_step2",{isGenerating:!0});const S=T?`
ZGODNOŚĆ Z PODSTAWĄ PROGRAMOWĄ:
- Dokument: ${T.label}${T.year?` • ${T.year}`:""}
- Przedmiot: ${i.subject}
Oznacz fragmenty zgodne z wymaganiami tagiem [PP].
      `.trim():"",P=KN[i.subject||""]||"",w=WN[i.level||"podstawowy"]||"",k=`
Jesteś doświadczonym nauczycielem tworzącym angażujący materiał edukacyjny.

KONTEKST:
- Kurs: ${C?.data?.title||"Kurs"}
- Temat lekcji: ${g.title} (lekcja ${v})
- Przedmiot: ${i.subject}
- Poziom: ${i.level} (${w})
- Typ kursu: ${i.isMaturaCourse?"maturalny":"podstawowy"}
- Czas trwania: ${i.defaultDuration??20} minut

${S}

KRYTYCZNA ZASADA STRUKTURY:
- Używaj WYŁĄCZNIE nagłówków poziomu 2 (##) dla głównych sekcji
- NIE używaj # (H1) - tytuł materiału jest osobno
- Możesz używać ### (H3) i #### (H4) WEWNĄTRZ sekcji dla podpodziałów
- Każda główna sekcja MUSI zaczynać się od ##
- NIE dodawaj bloków \`\`\`quiz - pytania kontrolne są dodawane osobno w Step 4

WYMAGANIA PEDAGOGICZNE:
1. Język: ${i.level==="podstawowy"?"prosty, bezpośredni, z analogiami do życia codziennego":"precyzyjny z terminologią fachową, ale wciąż przystępny"}
2. Ton: ${i.tone==="friendly"?'przyjazny, bezpośredni (używaj "poznamy", "zobaczysz", "odkryjesz")':i.tone==="formal"?"profesjonalny ale przystępny":"neutralny, rzeczowy"}
3. Przedmiot: ${P}

OBOWIĄZKOWA STRUKTURA (dokładnie w tej kolejności, używając ##):

## 🎯 Cele lekcji
Po tej lekcji będziesz:
- [Czasownik w formie dokonanej: poznasz/zrozumiesz/nauczysz się - konkretna wiedza]
- [Czasownik w formie dokonanej: potrafisz/zastosujesz - konkretna umiejętność]
- [Czasownik w formie dokonanej: rozróżnisz/przeanalizujesz - konkretne zastosowanie]

## 📚 Kluczowe pojęcia

**[Pojęcie 1]:** [Definicja prostym językiem, max 2 zdania]

**[Pojęcie 2]:** [Definicja z mini-przykładem w nawiasie]

**[Pojęcie 3]:** [Definicja z odniesieniem do życia codziennego]

[Dodaj 3-5 pojęć kluczowych dla tematu]

## 🔍 Szczegółowe omówienie

### [Podtemat 1 - najważniejszy koncept]

[Akapit wyjaśniający z analogią lub metaforą odpowiednią do wieku]

[Jeśli to przedmiot ścisły, dodaj wzór/równanie/kod:]
\`\`\`
[przykład]
\`\`\`

**Kluczowe zasady:**
- [Zasada 1 z krótkim wyjaśnieniem]
- [Zasada 2 z przykładem]
- [Zasada 3 - do zapamiętania]

**Przykład praktyczny:**
[Opisz konkretną sytuację gdzie to się stosuje]

### [Podtemat 2 - rozwinięcie lub drugi aspekt]

[Wyjaśnienie z kontekstem praktycznym]

${i.subject==="Angielski"||i.subject==="Matematyka"||i.subject==="Chemia"?`
**Tabela pomocnicza:**
| [Nagłówek 1] | [Nagłówek 2] | [Nagłówek 3] |
|--------------|--------------|--------------|
| [Przykład] | [Przykład] | [Przykład] |
`:""}

### [Podtemat 3 - zastosowania lub podsumowanie]

[Połączenie wszystkich elementów w całość]

## 🌟 Przykłady z życia

1. **[Sytuacja codzienna]:** [Opis jak temat występuje w codziennym życiu ucznia]

2. **[Zastosowanie praktyczne]:** [Gdzie spotkamy to w realnym świecie/karierze]

3. **[Ciekawostka]:** [Coś fascynującego co zainteresuje uczniów w tym wieku]

## ⚠️ Częste błędy i pułapki

❌ **Błąd:** [Opis typowego błędu uczniów]
✅ **Poprawnie:** [Jak zrobić to dobrze z wyjaśnieniem dlaczego]

[Powtórz dla 2-3 najczęstszych błędów]

## 📝 Podsumowanie

### ✅ Najważniejsze do zapamiętania:
- **[Absolutne minimum]** - jeśli zapamiętasz tylko jedną rzecz
- **[Kluczowa zasada/wzór]** - fundament tematu
- **[Praktyczne zastosowanie]** - jak użyć tej wiedzy

### 🎯 Po tej lekcji potrafisz:
- [Konkretna umiejętność 1]
- [Konkretna umiejętność 2]
- [Konkretna umiejętność 3]

${i.isMaturaCourse?`
### 📊 Na maturze:
[Wskazówka jak ten temat pojawia się na egzaminie - typy zadań, na co zwrócić uwagę]
`:""}

---
*💫 Następny krok: Ten temat jest fundamentem dla [wskaż co będzie dalej]. Jeśli go opanujesz, [zachęta do dalszej nauki].*

DODATKOWE WYTYCZNE:
- Używaj emoji jako ikon sekcji (max 1-2 na sekcję)
- Formatuj kluczowe terminy **pogrubioną czcionką**
- Twórz listy dla przejrzystości
- Dodawaj tabele gdzie zwiększają zrozumienie
- Przykłady kodu/wzorów/równań w blokach \`\`\`
- Proporcje: 50% wyjaśnienia, 30% przykłady, 20% podsumowanie
- Długość: 800-1200 słów
- Unikaj ściany tekstu - używaj akapitów, list, tabel
- NIE dodawaj bloków \`\`\`quiz ani ćwiczeń - pytania kontrolne będą w Step 4

WALIDACJA STRUKTURY:
- Materiał MUSI mieć dokładnie 6 sekcji na poziomie ## (Cele, Pojęcia, Omówienie, Przykłady, Błędy, Podsumowanie)
- Każda sekcja MUSI zaczynać się od ##
- Wewnątrz sekcji możesz używać ###, ####
- NIE używaj # (H1) w treści

PRZYKŁAD BŁĘDNY ❌:
# Główny tytuł
### Podsekcja bez ## przed
## Sekcja

PRZYKŁAD POPRAWNY ✅:
## 🎯 Cele lekcji
Treść...

## 📚 Kluczowe pojęcia
### Podsekcja wewnątrz (to jest OK)
Treść...

Generuj materiał w czystym Markdown. Bądź konkretny, praktyczny i angażujący dla grupy wiekowej ${w}.
    `.trim();try{const _=await Rn(k,VN);GN(_.content_markdown);const A={topic_id:b,position:v,title:_.title||g.title,duration_min:_.duration_min??i.defaultDuration??20,content_markdown:_.content_markdown};l(A)}catch(_){const A=_?.message?.toString()?.includes("503")||_?.details?.toString()?.includes?.("503")?"Błąd komunikacji z Gemini":_?.message||"Nie udało się wygenerować materiału.";m(A);const D=_?.info??_?.response??{message:_?.message,status:_?.status||_?.statusCode,details:_?.details,hint:_?.hint,raw:_};p(D)}finally{d(!1),s("em_step2",{isGenerating:!1})}},N=()=>{o&&n("/admin/educational-material/step3",{state:{item:o}})};return e.jsxs(Z,{children:[e.jsx(me,{title:"Krok 2",description:"Generowanie materiału edukacyjnego"}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[0.9fr,1.1fr]",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-5 h-5"}),"Panel generowania"]})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-lg bg-muted p-4 space-y-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Kurs:"})," ",e.jsx("span",{className:"font-medium",children:C?.data?.title||"-"})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Temat:"})," ",e.jsx("span",{className:"font-medium",children:g?`${v}. ${g.title}`:"-"})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx(B,{variant:"outline",children:i.subject}),e.jsx(B,{variant:"outline",children:i.level}),i.isMaturaCourse&&e.jsx(B,{variant:"default",children:"Maturalny"})]})]}),e.jsxs(he,{children:[e.jsx(xe,{className:"h-4 w-4"}),e.jsxs(pe,{className:"text-xs",children:[e.jsx("strong",{children:"Struktura:"})," 6 głównych sekcji (##)",e.jsx("br",{}),e.jsx("strong",{children:"Styl:"})," ",i.style==="notebook"?"Notatka z lekcji":i.style==="exam"?"Przygotowanie do egzaminu":"Zwięzły",e.jsx("br",{}),e.jsx("strong",{children:"Ton:"})," ",i.tone==="friendly"?"Przyjazny":i.tone==="formal"?"Formalny":"Neutralny",e.jsx("br",{}),e.jsx("strong",{children:"Pytania kontrolne:"})," Dodasz w kroku 4"]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(M,{onClick:z,disabled:c,className:"w-full",size:"lg",children:c?e.jsxs(e.Fragment,{children:[e.jsx(lt,{className:"w-4 h-4 mr-2 animate-spin"}),"Generowanie materiału..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pt,{className:"w-4 h-4 mr-2"}),"Wygeneruj materiał wysokiej jakości"]})}),e.jsxs(M,{variant:"default",onClick:N,disabled:!o||c,className:"w-full",children:["Przejdź do zapisu",e.jsx(Ae,{className:"w-4 h-4 ml-1"})]})]}),u&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(he,{variant:"destructive",children:[e.jsx(Re,{className:"h-4 w-4"}),e.jsx(pe,{children:u})]}),(h?.status||h?.statusCode||(typeof h=="object"&&"error"in h&&h.error?.includes?.("503")?503:void 0))===503?e.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"Wskazówka:"})," Model jest przeciążony (HTTP 503). Spróbuj ponownie za chwilę lub zmień model/zmniejsz objętość kontekstu."]}):null,h&&e.jsxs(I,{children:[e.jsx(O,{className:"py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx($,{className:"text-sm",children:"Szczegóły błędu"}),e.jsx(M,{variant:"ghost",size:"sm",onClick:()=>y(S=>!S),className:"h-7",children:j?e.jsx(Rr,{className:"w-4 h-4"}):e.jsx(Dt,{className:"w-4 h-4"})})]})}),j&&e.jsx(E,{className:"pt-0",children:e.jsx(cs,{className:"font-mono text-xs h-40",readOnly:!0,value:(()=>{try{return JSON.stringify(h,null,2)}catch{return String(h)}})()})})]})]}),c&&e.jsxs("div",{className:"text-center text-sm text-muted-foreground space-y-1",children:[e.jsx("p",{children:"Tworzę angażujący materiał..."}),e.jsx("p",{className:"text-xs",children:"To może potrwać 20-30 sekund"})]})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Podgląd materiału"})}),e.jsx(E,{children:o?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mb-3 bg-muted",children:e.jsxs(E,{className:"pt-6",children:[e.jsx("div",{className:"font-semibold",children:o.title}),e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-3 mt-2",children:[e.jsxs("span",{children:["⏱️ ",o.duration_min??20," min"]}),e.jsxs("span",{children:["📝 ",o.content_markdown.length," znaków"]}),e.jsx("span",{children:"📄 6 sekcji"})]})]})}),e.jsx(Ze,{className:"h-[500px] rounded-lg border p-4",children:e.jsx("div",{className:"prose prose-sm max-w-none dark:prose-invert",children:e.jsx(Sn,{remarkPlugins:[An],children:o.content_markdown})})})]}):e.jsx("div",{className:"flex flex-col items-center justify-center py-16 text-muted-foreground",children:c?e.jsxs(e.Fragment,{children:[e.jsx(lt,{className:"w-8 h-8 mb-3 animate-spin"}),e.jsx("div",{className:"text-sm",children:"Generowanie struktury..."}),e.jsx("div",{className:"text-xs mt-2",children:"Dodawanie przykładów..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"w-8 h-8 mb-3 opacity-50"}),e.jsx("div",{className:"text-sm",children:"Brak wygenerowanego materiału"}),e.jsx("div",{className:"text-xs mt-1",children:'Kliknij "Wygeneruj materiał"'})]})})})]})]})]})}function QN(){const t=le(),s=ms(),{mutate:n}=os(),i=f.useMemo(()=>s?.state?.item??null,[s?.state?.item]),[r,a]=f.useState(i?.title??""),[o,l]=f.useState(!1),[c,d]=f.useState(!1),[u,m]=f.useState(null),[h,p]=f.useState(null),{data:j}=Q({resource:"activities",filters:i?[{field:"topic_id",operator:"eq",value:i.topic_id}]:[],sorters:[{field:"position",order:"desc"}],pagination:{pageSize:1},queryOptions:{enabled:!!i?.topic_id}});f.useEffect(()=>{i||t("/admin/educational-material/step2")},[i,t]);const y=async()=>{if(i){if(!r||r.trim().length<3){m("Tytuł musi mieć minimum 3 znaki.");return}if(!i.content_markdown||i.content_markdown.trim().length<50){m("Materiał jest zbyt krótki. Wróć do kroku 2 i wygeneruj ponownie.");return}d(!0),m(null);try{const x=Number(i.topic_id),g=j?.data?.[0],b=g?.position?Number(g.position)+1:1,v=await new Promise((C,T)=>{n({resource:"activities",values:{topic_id:x,type:"material",title:r.trim(),content:i.content_markdown,duration_min:i.duration_min??20,position:b,is_published:o}},{onSuccess:z=>{const N=z?.data?.id;if(N){const S=typeof N=="string"?parseInt(N,10):N;p(S),C(S)}else T(new Error("Nie otrzymano ID aktywności"))},onError:z=>{console.error("Błąd zapisu:",z),T(z)}})})}catch(x){console.error("Błąd podczas zapisu:",x),x?.code==="23505"?m("Materiał o tym tytule już istnieje w tym temacie. Zmień tytuł."):x?.code==="23503"?m("Nieprawidłowy temat. Odśwież stronę i spróbuj ponownie."):x?.message?m(x.message):m("Nie udało się zapisać materiału. Spróbuj ponownie."),d(!1)}}};return i?e.jsxs(Z,{children:[e.jsx(me,{title:"Krok 3",description:"Zapis materiału do bazy"}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Ustawienia zapisu"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:["Tytuł materiału ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(J,{value:r,onChange:x=>a(x.target.value),placeholder:"np. Wprowadzenie do tematu",disabled:c||h!==null}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Tytuł będzie widoczny dla uczniów"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:"Opublikuj od razu"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Materiał będzie widoczny dla uczniów"})]}),e.jsx(zt,{checked:o,onCheckedChange:l,disabled:c||h!==null})]}),u&&e.jsxs(he,{variant:"destructive",children:[e.jsx(Re,{className:"h-4 w-4"}),e.jsx(pe,{children:u})]}),h&&e.jsxs(he,{className:"border-green-200 bg-green-50",children:[e.jsx(Pt,{className:"h-4 w-4 text-green-600"}),e.jsxs(pe,{className:"text-green-900",children:[e.jsx("span",{className:"font-medium",children:"Materiał zapisany!"}),e.jsx("br",{}),"ID: ",h,e.jsx("br",{}),e.jsx("span",{className:"text-xs",children:"Możesz teraz dodać pytania kontrolne lub przejść do podglądu."})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{onClick:y,disabled:c||h!==null||!r.trim(),className:"flex-1",children:c?e.jsxs(e.Fragment,{children:[e.jsx(sn,{className:"w-4 h-4 mr-2 animate-pulse"}),"Zapisywanie..."]}):h?e.jsxs(e.Fragment,{children:[e.jsx(Pt,{className:"w-4 h-4 mr-2"}),"Zapisano!"]}):e.jsxs(e.Fragment,{children:[e.jsx(sn,{className:"w-4 h-4 mr-2"}),"Zapisz materiał"]})}),e.jsx(M,{asChild:!0,variant:"outline",disabled:c,children:e.jsxs(Te,{to:"/admin/educational-material/step2",children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Wróć"]})})]}),h&&e.jsxs("div",{className:"pt-4 border-t space-y-2",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Co dalej?"}),e.jsx(M,{asChild:!0,variant:"default",className:"w-full",children:e.jsxs(Te,{to:"/admin/educational-material/step4",children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Dodaj pytania kontrolne (krok 4)"]})}),e.jsx(M,{asChild:!0,variant:"outline",className:"w-full",children:e.jsx(Te,{to:"/admin/educational-material/step1",children:"Stwórz kolejny materiał"})})]})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Podsumowanie materiału"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"ID Tematu"}),e.jsx("div",{className:"font-medium",children:i.topic_id})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Wygenerowany tytuł"}),e.jsx("div",{className:"font-medium",children:i.title})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Czas trwania"}),e.jsxs("div",{className:"font-medium",children:[i.duration_min??20," minut"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Długość treści"}),e.jsxs("div",{className:"font-medium",children:[i.content_markdown.length," znaków"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Pozycja w temacie"}),e.jsx("div",{className:"font-medium",children:j?.data?.[0]?.position?`${Number(j.data[0].position)+1} (po ${j.data.length} istniejących)`:"1 (pierwszy materiał)"})]})]}),e.jsxs(he,{children:[e.jsx(Re,{className:"h-4 w-4"}),e.jsx(pe,{className:"text-xs",children:"Po zapisie materiał będzie dostępny w module aktywności. Możesz go później edytować, dodać pytania kontrolne i przypisać do grup uczniów."})]})]})]})]})]}):e.jsxs(Z,{children:[e.jsx(me,{title:"Krok 3",description:"Zapis materiału"}),e.jsx(I,{children:e.jsx(E,{className:"pt-6",children:e.jsxs(he,{variant:"destructive",children:[e.jsx(Re,{className:"h-4 w-4"}),e.jsxs(pe,{children:["Brak danych z poprzedniego kroku.",e.jsx(Te,{to:"/admin/educational-material/step2",className:"underline ml-1",children:"Wróć do kroku 2"})]})]})})})]})}const Sc=Symbol.for("yaml.alias"),Tl=Symbol.for("yaml.document"),tn=Symbol.for("yaml.map"),tf=Symbol.for("yaml.pair"),ks=Symbol.for("yaml.scalar"),Pi=Symbol.for("yaml.seq"),ts=Symbol.for("yaml.node.type"),un=t=>!!t&&typeof t=="object"&&t[ts]===Sc,On=t=>!!t&&typeof t=="object"&&t[ts]===Tl,Di=t=>!!t&&typeof t=="object"&&t[ts]===tn,Me=t=>!!t&&typeof t=="object"&&t[ts]===tf,ke=t=>!!t&&typeof t=="object"&&t[ts]===ks,Mi=t=>!!t&&typeof t=="object"&&t[ts]===Pi;function Ie(t){if(t&&typeof t=="object")switch(t[ts]){case tn:case Pi:return!0}return!1}function Oe(t){if(t&&typeof t=="object")switch(t[ts]){case Sc:case tn:case ks:case Pi:return!0}return!1}const sf=t=>(ke(t)||Ie(t))&&!!t.anchor,Ct=Symbol("break visit"),nf=Symbol("skip children"),ys=Symbol("remove node");function $n(t,s){const n=rf(s);On(t)?si(null,t.contents,n,Object.freeze([t]))===ys&&(t.contents=null):si(null,t,n,Object.freeze([]))}$n.BREAK=Ct;$n.SKIP=nf;$n.REMOVE=ys;function si(t,s,n,i){const r=af(t,s,n,i);if(Oe(r)||Me(r))return of(t,i,r),si(t,r,n,i);if(typeof r!="symbol"){if(Ie(s)){i=Object.freeze(i.concat(s));for(let a=0;a<s.items.length;++a){const o=si(a,s.items[a],n,i);if(typeof o=="number")a=o-1;else{if(o===Ct)return Ct;o===ys&&(s.items.splice(a,1),a-=1)}}}else if(Me(s)){i=Object.freeze(i.concat(s));const a=si("key",s.key,n,i);if(a===Ct)return Ct;a===ys&&(s.key=null);const o=si("value",s.value,n,i);if(o===Ct)return Ct;o===ys&&(s.value=null)}}return r}async function ho(t,s){const n=rf(s);On(t)?await ni(null,t.contents,n,Object.freeze([t]))===ys&&(t.contents=null):await ni(null,t,n,Object.freeze([]))}ho.BREAK=Ct;ho.SKIP=nf;ho.REMOVE=ys;async function ni(t,s,n,i){const r=await af(t,s,n,i);if(Oe(r)||Me(r))return of(t,i,r),ni(t,r,n,i);if(typeof r!="symbol"){if(Ie(s)){i=Object.freeze(i.concat(s));for(let a=0;a<s.items.length;++a){const o=await ni(a,s.items[a],n,i);if(typeof o=="number")a=o-1;else{if(o===Ct)return Ct;o===ys&&(s.items.splice(a,1),a-=1)}}}else if(Me(s)){i=Object.freeze(i.concat(s));const a=await ni("key",s.key,n,i);if(a===Ct)return Ct;a===ys&&(s.key=null);const o=await ni("value",s.value,n,i);if(o===Ct)return Ct;o===ys&&(s.value=null)}}return r}function rf(t){return typeof t=="object"&&(t.Collection||t.Node||t.Value)?Object.assign({Alias:t.Node,Map:t.Node,Scalar:t.Node,Seq:t.Node},t.Value&&{Map:t.Value,Scalar:t.Value,Seq:t.Value},t.Collection&&{Map:t.Collection,Seq:t.Collection},t):t}function af(t,s,n,i){if(typeof n=="function")return n(t,s,i);if(Di(s))return n.Map?.(t,s,i);if(Mi(s))return n.Seq?.(t,s,i);if(Me(s))return n.Pair?.(t,s,i);if(ke(s))return n.Scalar?.(t,s,i);if(un(s))return n.Alias?.(t,s,i)}function of(t,s,n){const i=s[s.length-1];if(Ie(i))i.items[t]=n;else if(Me(i))t==="key"?i.key=n:i.value=n;else if(On(i))i.contents=n;else{const r=un(i)?"alias":"scalar";throw new Error(`Cannot replace node with ${r} parent`)}}const ZN={"!":"%21",",":"%2C","[":"%5B","]":"%5D","{":"%7B","}":"%7D"},YN=t=>t.replace(/[!,[\]{}]/g,s=>ZN[s]);class wt{constructor(s,n){this.docStart=null,this.docEnd=!1,this.yaml=Object.assign({},wt.defaultYaml,s),this.tags=Object.assign({},wt.defaultTags,n)}clone(){const s=new wt(this.yaml,this.tags);return s.docStart=this.docStart,s}atDocument(){const s=new wt(this.yaml,this.tags);switch(this.yaml.version){case"1.1":this.atNextDocument=!0;break;case"1.2":this.atNextDocument=!1,this.yaml={explicit:wt.defaultYaml.explicit,version:"1.2"},this.tags=Object.assign({},wt.defaultTags);break}return s}add(s,n){this.atNextDocument&&(this.yaml={explicit:wt.defaultYaml.explicit,version:"1.1"},this.tags=Object.assign({},wt.defaultTags),this.atNextDocument=!1);const i=s.trim().split(/[ \t]+/),r=i.shift();switch(r){case"%TAG":{if(i.length!==2&&(n(0,"%TAG directive should contain exactly two parts"),i.length<2))return!1;const[a,o]=i;return this.tags[a]=o,!0}case"%YAML":{if(this.yaml.explicit=!0,i.length!==1)return n(0,"%YAML directive should contain exactly one part"),!1;const[a]=i;if(a==="1.1"||a==="1.2")return this.yaml.version=a,!0;{const o=/^\d+\.\d+$/.test(a);return n(6,`Unsupported YAML version ${a}`,o),!1}}default:return n(0,`Unknown directive ${r}`,!0),!1}}tagName(s,n){if(s==="!")return"!";if(s[0]!=="!")return n(`Not a valid tag: ${s}`),null;if(s[1]==="<"){const o=s.slice(2,-1);return o==="!"||o==="!!"?(n(`Verbatim tags aren't resolved, so ${s} is invalid.`),null):(s[s.length-1]!==">"&&n("Verbatim tags must end with a >"),o)}const[,i,r]=s.match(/^(.*!)([^!]*)$/s);r||n(`The ${s} tag has no suffix`);const a=this.tags[i];if(a)try{return a+decodeURIComponent(r)}catch(o){return n(String(o)),null}return i==="!"?s:(n(`Could not resolve tag: ${s}`),null)}tagString(s){for(const[n,i]of Object.entries(this.tags))if(s.startsWith(i))return n+YN(s.substring(i.length));return s[0]==="!"?s:`!<${s}>`}toString(s){const n=this.yaml.explicit?[`%YAML ${this.yaml.version||"1.2"}`]:[],i=Object.entries(this.tags);let r;if(s&&i.length>0&&Oe(s.contents)){const a={};$n(s.contents,(o,l)=>{Oe(l)&&l.tag&&(a[l.tag]=!0)}),r=Object.keys(a)}else r=[];for(const[a,o]of i)a==="!!"&&o==="tag:yaml.org,2002:"||(!s||r.some(l=>l.startsWith(o)))&&n.push(`%TAG ${a} ${o}`);return n.join(`
`)}}wt.defaultYaml={explicit:!1,version:"1.2"};wt.defaultTags={"!!":"tag:yaml.org,2002:"};function lf(t){if(/[\x00-\x19\s,[\]{}]/.test(t)){const n=`Anchor must not contain whitespace or control characters: ${JSON.stringify(t)}`;throw new Error(n)}return!0}function cf(t){const s=new Set;return $n(t,{Value(n,i){i.anchor&&s.add(i.anchor)}}),s}function df(t,s){for(let n=1;;++n){const i=`${t}${n}`;if(!s.has(i))return i}}function JN(t,s){const n=[],i=new Map;let r=null;return{onAnchor:a=>{n.push(a),r??(r=cf(t));const o=df(s,r);return r.add(o),o},setAnchors:()=>{for(const a of n){const o=i.get(a);if(typeof o=="object"&&o.anchor&&(ke(o.node)||Ie(o.node)))o.node.anchor=o.anchor;else{const l=new Error("Failed to resolve repeated object (this should not happen)");throw l.source=a,l}}},sourceObjects:i}}function ii(t,s,n,i){if(i&&typeof i=="object")if(Array.isArray(i))for(let r=0,a=i.length;r<a;++r){const o=i[r],l=ii(t,i,String(r),o);l===void 0?delete i[r]:l!==o&&(i[r]=l)}else if(i instanceof Map)for(const r of Array.from(i.keys())){const a=i.get(r),o=ii(t,i,r,a);o===void 0?i.delete(r):o!==a&&i.set(r,o)}else if(i instanceof Set)for(const r of Array.from(i)){const a=ii(t,i,r,r);a===void 0?i.delete(r):a!==r&&(i.delete(r),i.add(a))}else for(const[r,a]of Object.entries(i)){const o=ii(t,i,r,a);o===void 0?delete i[r]:o!==a&&(i[r]=o)}return t.call(s,n,i)}function Qt(t,s,n){if(Array.isArray(t))return t.map((i,r)=>Qt(i,String(r),n));if(t&&typeof t.toJSON=="function"){if(!n||!sf(t))return t.toJSON(s,n);const i={aliasCount:0,count:1,res:void 0};n.anchors.set(t,i),n.onCreate=a=>{i.res=a,delete n.onCreate};const r=t.toJSON(s,n);return n.onCreate&&n.onCreate(r),r}return typeof t=="bigint"&&!n?.keep?Number(t):t}class Cc{constructor(s){Object.defineProperty(this,ts,{value:s})}clone(){const s=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return this.range&&(s.range=this.range.slice()),s}toJS(s,{mapAsMap:n,maxAliasCount:i,onAnchor:r,reviver:a}={}){if(!On(s))throw new TypeError("A document argument is required");const o={anchors:new Map,doc:s,keep:!0,mapAsMap:n===!0,mapKeyWarned:!1,maxAliasCount:typeof i=="number"?i:100},l=Qt(this,"",o);if(typeof r=="function")for(const{count:c,res:d}of o.anchors.values())r(d,c);return typeof a=="function"?ii(a,{"":l},"",l):l}}class po extends Cc{constructor(s){super(Sc),this.source=s,Object.defineProperty(this,"tag",{set(){throw new Error("Alias nodes cannot have tags")}})}resolve(s,n){let i;n?.aliasResolveCache?i=n.aliasResolveCache:(i=[],$n(s,{Node:(a,o)=>{(un(o)||sf(o))&&i.push(o)}}),n&&(n.aliasResolveCache=i));let r;for(const a of i){if(a===this)break;a.anchor===this.source&&(r=a)}return r}toJSON(s,n){if(!n)return{source:this.source};const{anchors:i,doc:r,maxAliasCount:a}=n,o=this.resolve(r,n);if(!o){const c=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new ReferenceError(c)}let l=i.get(o);if(l||(Qt(o,null,n),l=i.get(o)),!l||l.res===void 0){const c="This should not happen: Alias anchor was not resolved?";throw new ReferenceError(c)}if(a>=0&&(l.count+=1,l.aliasCount===0&&(l.aliasCount=xa(r,o,i)),l.count*l.aliasCount>a)){const c="Excessive alias count indicates a resource exhaustion attack";throw new ReferenceError(c)}return l.res}toString(s,n,i){const r=`*${this.source}`;if(s){if(lf(this.source),s.options.verifyAliasOrder&&!s.anchors.has(this.source)){const a=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new Error(a)}if(s.implicitKey)return`${r} `}return r}}function xa(t,s,n){if(un(s)){const i=s.resolve(t),r=n&&i&&n.get(i);return r?r.count*r.aliasCount:0}else if(Ie(s)){let i=0;for(const r of s.items){const a=xa(t,r,n);a>i&&(i=a)}return i}else if(Me(s)){const i=xa(t,s.key,n),r=xa(t,s.value,n);return Math.max(i,r)}return 1}const uf=t=>!t||typeof t!="function"&&typeof t!="object";class ae extends Cc{constructor(s){super(ks),this.value=s}toJSON(s,n){return n?.keep?this.value:Qt(this.value,s,n)}toString(){return String(this.value)}}ae.BLOCK_FOLDED="BLOCK_FOLDED";ae.BLOCK_LITERAL="BLOCK_LITERAL";ae.PLAIN="PLAIN";ae.QUOTE_DOUBLE="QUOTE_DOUBLE";ae.QUOTE_SINGLE="QUOTE_SINGLE";const XN="tag:yaml.org,2002:";function ek(t,s,n){if(s){const i=n.filter(a=>a.tag===s),r=i.find(a=>!a.format)??i[0];if(!r)throw new Error(`Tag ${s} not found`);return r}return n.find(i=>i.identify?.(t)&&!i.format)}function br(t,s,n){if(On(t)&&(t=t.contents),Oe(t))return t;if(Me(t)){const m=n.schema[tn].createNode?.(n.schema,null,n);return m.items.push(t),m}(t instanceof String||t instanceof Number||t instanceof Boolean||typeof BigInt<"u"&&t instanceof BigInt)&&(t=t.valueOf());const{aliasDuplicateObjects:i,onAnchor:r,onTagObj:a,schema:o,sourceObjects:l}=n;let c;if(i&&t&&typeof t=="object"){if(c=l.get(t),c)return c.anchor??(c.anchor=r(t)),new po(c.anchor);c={anchor:null,node:null},l.set(t,c)}s?.startsWith("!!")&&(s=XN+s.slice(2));let d=ek(t,s,o.tags);if(!d){if(t&&typeof t.toJSON=="function"&&(t=t.toJSON()),!t||typeof t!="object"){const m=new ae(t);return c&&(c.node=m),m}d=t instanceof Map?o[tn]:Symbol.iterator in Object(t)?o[Pi]:o[tn]}a&&(a(d),delete n.onTagObj);const u=d?.createNode?d.createNode(n.schema,t,n):typeof d?.nodeClass?.from=="function"?d.nodeClass.from(n.schema,t,n):new ae(t);return s?u.tag=s:d.default||(u.tag=d.tag),c&&(c.node=u),u}function Ma(t,s,n){let i=n;for(let r=s.length-1;r>=0;--r){const a=s[r];if(typeof a=="number"&&Number.isInteger(a)&&a>=0){const o=[];o[a]=i,i=o}else i=new Map([[a,i]])}return br(i,void 0,{aliasDuplicateObjects:!1,keepUndefined:!1,onAnchor:()=>{throw new Error("This should not happen, please report a bug.")},schema:t,sourceObjects:new Map})}const tr=t=>t==null||typeof t=="object"&&!!t[Symbol.iterator]().next().done;let mf=class extends Cc{constructor(s,n){super(s),Object.defineProperty(this,"schema",{value:n,configurable:!0,enumerable:!1,writable:!0})}clone(s){const n=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return s&&(n.schema=s),n.items=n.items.map(i=>Oe(i)||Me(i)?i.clone(s):i),this.range&&(n.range=this.range.slice()),n}addIn(s,n){if(tr(s))this.add(n);else{const[i,...r]=s,a=this.get(i,!0);if(Ie(a))a.addIn(r,n);else if(a===void 0&&this.schema)this.set(i,Ma(this.schema,r,n));else throw new Error(`Expected YAML collection at ${i}. Remaining path: ${r}`)}}deleteIn(s){const[n,...i]=s;if(i.length===0)return this.delete(n);const r=this.get(n,!0);if(Ie(r))return r.deleteIn(i);throw new Error(`Expected YAML collection at ${n}. Remaining path: ${i}`)}getIn(s,n){const[i,...r]=s,a=this.get(i,!0);return r.length===0?!n&&ke(a)?a.value:a:Ie(a)?a.getIn(r,n):void 0}hasAllNullValues(s){return this.items.every(n=>{if(!Me(n))return!1;const i=n.value;return i==null||s&&ke(i)&&i.value==null&&!i.commentBefore&&!i.comment&&!i.tag})}hasIn(s){const[n,...i]=s;if(i.length===0)return this.has(n);const r=this.get(n,!0);return Ie(r)?r.hasIn(i):!1}setIn(s,n){const[i,...r]=s;if(r.length===0)this.set(i,n);else{const a=this.get(i,!0);if(Ie(a))a.setIn(r,n);else if(a===void 0&&this.schema)this.set(i,Ma(this.schema,r,n));else throw new Error(`Expected YAML collection at ${i}. Remaining path: ${r}`)}}};const tk=t=>t.replace(/^(?!$)(?: $)?/gm,"#");function Ds(t,s){return/^\n+$/.test(t)?t.substring(1):s?t.replace(/^(?! *$)/gm,s):t}const yn=(t,s,n)=>t.endsWith(`
`)?Ds(n,s):n.includes(`
`)?`
`+Ds(n,s):(t.endsWith(" ")?"":" ")+n,hf="flow",Al="block",ga="quoted";function fo(t,s,n="flow",{indentAtStart:i,lineWidth:r=80,minContentWidth:a=20,onFold:o,onOverflow:l}={}){if(!r||r<0)return t;r<a&&(a=0);const c=Math.max(1+a,1+r-s.length);if(t.length<=c)return t;const d=[],u={};let m=r-s.length;typeof i=="number"&&(i>r-Math.max(2,a)?d.push(0):m=r-i);let h,p,j=!1,y=-1,x=-1,g=-1;n===Al&&(y=xu(t,y,s.length),y!==-1&&(m=y+c));for(let v;v=t[y+=1];){if(n===ga&&v==="\\"){switch(x=y,t[y+1]){case"x":y+=3;break;case"u":y+=5;break;case"U":y+=9;break;default:y+=1}g=y}if(v===`
`)n===Al&&(y=xu(t,y,s.length)),m=y+s.length+c,h=void 0;else{if(v===" "&&p&&p!==" "&&p!==`
`&&p!=="	"){const C=t[y+1];C&&C!==" "&&C!==`
`&&C!=="	"&&(h=y)}if(y>=m)if(h)d.push(h),m=h+c,h=void 0;else if(n===ga){for(;p===" "||p==="	";)p=v,v=t[y+=1],j=!0;const C=y>g+1?y-2:x-1;if(u[C])return t;d.push(C),u[C]=!0,m=C+c,h=void 0}else j=!0}p=v}if(j&&l&&l(),d.length===0)return t;o&&o();let b=t.slice(0,d[0]);for(let v=0;v<d.length;++v){const C=d[v],T=d[v+1]||t.length;C===0?b=`
${s}${t.slice(0,T)}`:(n===ga&&u[C]&&(b+=`${t[C]}\\`),b+=`
${s}${t.slice(C+1,T)}`)}return b}function xu(t,s,n){let i=s,r=s+1,a=t[r];for(;a===" "||a==="	";)if(s<r+n)a=t[++s];else{do a=t[++s];while(a&&a!==`
`);i=s,r=s+1,a=t[r]}return i}const xo=(t,s)=>({indentAtStart:s?t.indent.length:t.indentAtStart,lineWidth:t.options.lineWidth,minContentWidth:t.options.minContentWidth}),go=t=>/^(%|---|\.\.\.)/m.test(t);function sk(t,s,n){if(!s||s<0)return!1;const i=s-n,r=t.length;if(r<=i)return!1;for(let a=0,o=0;a<r;++a)if(t[a]===`
`){if(a-o>i)return!0;if(o=a+1,r-o<=i)return!1}return!0}function rr(t,s){const n=JSON.stringify(t);if(s.options.doubleQuotedAsJSON)return n;const{implicitKey:i}=s,r=s.options.doubleQuotedMinMultiLineLength,a=s.indent||(go(t)?"  ":"");let o="",l=0;for(let c=0,d=n[c];d;d=n[++c])if(d===" "&&n[c+1]==="\\"&&n[c+2]==="n"&&(o+=n.slice(l,c)+"\\ ",c+=1,l=c,d="\\"),d==="\\")switch(n[c+1]){case"u":{o+=n.slice(l,c);const u=n.substr(c+2,4);switch(u){case"0000":o+="\\0";break;case"0007":o+="\\a";break;case"000b":o+="\\v";break;case"001b":o+="\\e";break;case"0085":o+="\\N";break;case"00a0":o+="\\_";break;case"2028":o+="\\L";break;case"2029":o+="\\P";break;default:u.substr(0,2)==="00"?o+="\\x"+u.substr(2):o+=n.substr(c,6)}c+=5,l=c+1}break;case"n":if(i||n[c+2]==='"'||n.length<r)c+=1;else{for(o+=n.slice(l,c)+`

`;n[c+2]==="\\"&&n[c+3]==="n"&&n[c+4]!=='"';)o+=`
`,c+=2;o+=a,n[c+2]===" "&&(o+="\\"),c+=1,l=c+1}break;default:c+=1}return o=l?o+n.slice(l):n,i?o:fo(o,a,ga,xo(s,!1))}function Pl(t,s){if(s.options.singleQuote===!1||s.implicitKey&&t.includes(`
`)||/[ \t]\n|\n[ \t]/.test(t))return rr(t,s);const n=s.indent||(go(t)?"  ":""),i="'"+t.replace(/'/g,"''").replace(/\n+/g,`$&
${n}`)+"'";return s.implicitKey?i:fo(i,n,hf,xo(s,!1))}function ri(t,s){const{singleQuote:n}=s.options;let i;if(n===!1)i=rr;else{const r=t.includes('"'),a=t.includes("'");r&&!a?i=Pl:a&&!r?i=rr:i=n?Pl:rr}return i(t,s)}let Dl;try{Dl=new RegExp(`(^|(?<!
))
+(?!
|$)`,"g")}catch{Dl=/\n+(?!\n|$)/g}function ja({comment:t,type:s,value:n},i,r,a){const{blockQuote:o,commentString:l,lineWidth:c}=i.options;if(!o||/\n[\t ]+$/.test(n)||/^\s*$/.test(n))return ri(n,i);const d=i.indent||(i.forceBlockIndent||go(n)?"  ":""),u=o==="literal"?!0:o==="folded"||s===ae.BLOCK_FOLDED?!1:s===ae.BLOCK_LITERAL?!0:!sk(n,c,d.length);if(!n)return u?`|
`:`>
`;let m,h;for(h=n.length;h>0;--h){const T=n[h-1];if(T!==`
`&&T!=="	"&&T!==" ")break}let p=n.substring(h);const j=p.indexOf(`
`);j===-1?m="-":n===p||j!==p.length-1?(m="+",a&&a()):m="",p&&(n=n.slice(0,-p.length),p[p.length-1]===`
`&&(p=p.slice(0,-1)),p=p.replace(Dl,`$&${d}`));let y=!1,x,g=-1;for(x=0;x<n.length;++x){const T=n[x];if(T===" ")y=!0;else if(T===`
`)g=x;else break}let b=n.substring(0,g<x?g+1:x);b&&(n=n.substring(b.length),b=b.replace(/\n+/g,`$&${d}`));let C=(y?d?"2":"1":"")+m;if(t&&(C+=" "+l(t.replace(/ ?[\r\n]+/g," ")),r&&r()),!u){const T=n.replace(/\n+/g,`
$&`).replace(/(?:^|\n)([\t ].*)(?:([\n\t ]*)\n(?![\n\t ]))?/g,"$1$2").replace(/\n+/g,`$&${d}`);let z=!1;const N=xo(i,!0);o!=="folded"&&s!==ae.BLOCK_FOLDED&&(N.onOverflow=()=>{z=!0});const S=fo(`${b}${T}${p}`,d,Al,N);if(!z)return`>${C}
${d}${S}`}return n=n.replace(/\n+/g,`$&${d}`),`|${C}
${d}${b}${n}${p}`}function nk(t,s,n,i){const{type:r,value:a}=t,{actualString:o,implicitKey:l,indent:c,indentStep:d,inFlow:u}=s;if(l&&a.includes(`
`)||u&&/[[\]{},]/.test(a))return ri(a,s);if(/^[\n\t ,[\]{}#&*!|>'"%@`]|^[?-]$|^[?-][ \t]|[\n:][ \t]|[ \t]\n|[\n\t ]#|[\n\t :]$/.test(a))return l||u||!a.includes(`
`)?ri(a,s):ja(t,s,n,i);if(!l&&!u&&r!==ae.PLAIN&&a.includes(`
`))return ja(t,s,n,i);if(go(a)){if(c==="")return s.forceBlockIndent=!0,ja(t,s,n,i);if(l&&c===d)return ri(a,s)}const m=a.replace(/\n+/g,`$&
${c}`);if(o){const h=y=>y.default&&y.tag!=="tag:yaml.org,2002:str"&&y.test?.test(m),{compat:p,tags:j}=s.doc.schema;if(j.some(h)||p?.some(h))return ri(a,s)}return l?m:fo(m,c,hf,xo(s,!1))}function Fr(t,s,n,i){const{implicitKey:r,inFlow:a}=s,o=typeof t.value=="string"?t:Object.assign({},t,{value:String(t.value)});let{type:l}=t;l!==ae.QUOTE_DOUBLE&&/[\x00-\x08\x0b-\x1f\x7f-\x9f\u{D800}-\u{DFFF}]/u.test(o.value)&&(l=ae.QUOTE_DOUBLE);const c=u=>{switch(u){case ae.BLOCK_FOLDED:case ae.BLOCK_LITERAL:return r||a?ri(o.value,s):ja(o,s,n,i);case ae.QUOTE_DOUBLE:return rr(o.value,s);case ae.QUOTE_SINGLE:return Pl(o.value,s);case ae.PLAIN:return nk(o,s,n,i);default:return null}};let d=c(l);if(d===null){const{defaultKeyType:u,defaultStringType:m}=s.options,h=r&&u||m;if(d=c(h),d===null)throw new Error(`Unsupported default string type ${h}`)}return d}function pf(t,s){const n=Object.assign({blockQuote:!0,commentString:tk,defaultKeyType:null,defaultStringType:"PLAIN",directives:null,doubleQuotedAsJSON:!1,doubleQuotedMinMultiLineLength:40,falseStr:"false",flowCollectionPadding:!0,indentSeq:!0,lineWidth:80,minContentWidth:20,nullStr:"null",simpleKeys:!1,singleQuote:null,trueStr:"true",verifyAliasOrder:!0},t.schema.toStringOptions,s);let i;switch(n.collectionStyle){case"block":i=!1;break;case"flow":i=!0;break;default:i=null}return{anchors:new Set,doc:t,flowCollectionPadding:n.flowCollectionPadding?" ":"",indent:"",indentStep:typeof n.indent=="number"?" ".repeat(n.indent):"  ",inFlow:i,options:n}}function ik(t,s){if(s.tag){const r=t.filter(a=>a.tag===s.tag);if(r.length>0)return r.find(a=>a.format===s.format)??r[0]}let n,i;if(ke(s)){i=s.value;let r=t.filter(a=>a.identify?.(i));if(r.length>1){const a=r.filter(o=>o.test);a.length>0&&(r=a)}n=r.find(a=>a.format===s.format)??r.find(a=>!a.format)}else i=s,n=t.find(r=>r.nodeClass&&i instanceof r.nodeClass);if(!n){const r=i?.constructor?.name??(i===null?"null":typeof i);throw new Error(`Tag not resolved for ${r} value`)}return n}function rk(t,s,{anchors:n,doc:i}){if(!i.directives)return"";const r=[],a=(ke(t)||Ie(t))&&t.anchor;a&&lf(a)&&(n.add(a),r.push(`&${a}`));const o=t.tag??(s.default?null:s.tag);return o&&r.push(i.directives.tagString(o)),r.join(" ")}function vi(t,s,n,i){if(Me(t))return t.toString(s,n,i);if(un(t)){if(s.doc.directives)return t.toString(s);if(s.resolvedAliases?.has(t))throw new TypeError("Cannot stringify circular structure without alias nodes");s.resolvedAliases?s.resolvedAliases.add(t):s.resolvedAliases=new Set([t]),t=t.resolve(s.doc)}let r;const a=Oe(t)?t:s.doc.createNode(t,{onTagObj:c=>r=c});r??(r=ik(s.doc.schema.tags,a));const o=rk(a,r,s);o.length>0&&(s.indentAtStart=(s.indentAtStart??0)+o.length+1);const l=typeof r.stringify=="function"?r.stringify(a,s,n,i):ke(a)?Fr(a,s,n,i):a.toString(s,n,i);return o?ke(a)||l[0]==="{"||l[0]==="["?`${o} ${l}`:`${o}
${s.indent}${l}`:l}function ak({key:t,value:s},n,i,r){const{allNullValues:a,doc:o,indent:l,indentStep:c,options:{commentString:d,indentSeq:u,simpleKeys:m}}=n;let h=Oe(t)&&t.comment||null;if(m){if(h)throw new Error("With simple keys, key nodes cannot have comments");if(Ie(t)||!Oe(t)&&typeof t=="object"){const N="With simple keys, collection cannot be used as a key value";throw new Error(N)}}let p=!m&&(!t||h&&s==null&&!n.inFlow||Ie(t)||(ke(t)?t.type===ae.BLOCK_FOLDED||t.type===ae.BLOCK_LITERAL:typeof t=="object"));n=Object.assign({},n,{allNullValues:!1,implicitKey:!p&&(m||!a),indent:l+c});let j=!1,y=!1,x=vi(t,n,()=>j=!0,()=>y=!0);if(!p&&!n.inFlow&&x.length>1024){if(m)throw new Error("With simple keys, single line scalar must not span more than 1024 characters");p=!0}if(n.inFlow){if(a||s==null)return j&&i&&i(),x===""?"?":p?`? ${x}`:x}else if(a&&!m||s==null&&p)return x=`? ${x}`,h&&!j?x+=yn(x,n.indent,d(h)):y&&r&&r(),x;j&&(h=null),p?(h&&(x+=yn(x,n.indent,d(h))),x=`? ${x}
${l}:`):(x=`${x}:`,h&&(x+=yn(x,n.indent,d(h))));let g,b,v;Oe(s)?(g=!!s.spaceBefore,b=s.commentBefore,v=s.comment):(g=!1,b=null,v=null,s&&typeof s=="object"&&(s=o.createNode(s))),n.implicitKey=!1,!p&&!h&&ke(s)&&(n.indentAtStart=x.length+1),y=!1,!u&&c.length>=2&&!n.inFlow&&!p&&Mi(s)&&!s.flow&&!s.tag&&!s.anchor&&(n.indent=n.indent.substring(2));let C=!1;const T=vi(s,n,()=>C=!0,()=>y=!0);let z=" ";if(h||g||b){if(z=g?`
`:"",b){const N=d(b);z+=`
${Ds(N,n.indent)}`}T===""&&!n.inFlow?z===`
`&&(z=`

`):z+=`
${n.indent}`}else if(!p&&Ie(s)){const N=T[0],S=T.indexOf(`
`),P=S!==-1,w=n.inFlow??s.flow??s.items.length===0;if(P||!w){let k=!1;if(P&&(N==="&"||N==="!")){let _=T.indexOf(" ");N==="&"&&_!==-1&&_<S&&T[_+1]==="!"&&(_=T.indexOf(" ",_+1)),(_===-1||S<_)&&(k=!0)}k||(z=`
${n.indent}`)}}else(T===""||T[0]===`
`)&&(z="");return x+=z+T,n.inFlow?C&&i&&i():v&&!C?x+=yn(x,n.indent,d(v)):y&&r&&r(),x}function ff(t,s){(t==="debug"||t==="warn")&&console.warn(s)}const ia="<<",Ms={identify:t=>t===ia||typeof t=="symbol"&&t.description===ia,default:"key",tag:"tag:yaml.org,2002:merge",test:/^<<$/,resolve:()=>Object.assign(new ae(Symbol(ia)),{addToJSMap:xf}),stringify:()=>ia},ok=(t,s)=>(Ms.identify(s)||ke(s)&&(!s.type||s.type===ae.PLAIN)&&Ms.identify(s.value))&&t?.doc.schema.tags.some(n=>n.tag===Ms.tag&&n.default);function xf(t,s,n){if(n=t&&un(n)?n.resolve(t.doc):n,Mi(n))for(const i of n.items)Zo(t,s,i);else if(Array.isArray(n))for(const i of n)Zo(t,s,i);else Zo(t,s,n)}function Zo(t,s,n){const i=t&&un(n)?n.resolve(t.doc):n;if(!Di(i))throw new Error("Merge sources must be maps or map aliases");const r=i.toJSON(null,t,Map);for(const[a,o]of r)s instanceof Map?s.has(a)||s.set(a,o):s instanceof Set?s.add(a):Object.prototype.hasOwnProperty.call(s,a)||Object.defineProperty(s,a,{value:o,writable:!0,enumerable:!0,configurable:!0});return s}function gf(t,s,{key:n,value:i}){if(Oe(n)&&n.addToJSMap)n.addToJSMap(t,s,i);else if(ok(t,n))xf(t,s,i);else{const r=Qt(n,"",t);if(s instanceof Map)s.set(r,Qt(i,r,t));else if(s instanceof Set)s.add(r);else{const a=lk(n,r,t),o=Qt(i,a,t);a in s?Object.defineProperty(s,a,{value:o,writable:!0,enumerable:!0,configurable:!0}):s[a]=o}}return s}function lk(t,s,n){if(s===null)return"";if(typeof s!="object")return String(s);if(Oe(t)&&n?.doc){const i=pf(n.doc,{});i.anchors=new Set;for(const a of n.anchors.keys())i.anchors.add(a.anchor);i.inFlow=!0,i.inStringifyKey=!0;const r=t.toString(i);if(!n.mapKeyWarned){let a=JSON.stringify(r);a.length>40&&(a=a.substring(0,36)+'..."'),ff(n.doc.options.logLevel,`Keys with collection values will be stringified due to JS Object restrictions: ${a}. Set mapAsMap: true to use object keys.`),n.mapKeyWarned=!0}return r}return JSON.stringify(s)}function _c(t,s,n){const i=br(t,void 0,n),r=br(s,void 0,n);return new ht(i,r)}class ht{constructor(s,n=null){Object.defineProperty(this,ts,{value:tf}),this.key=s,this.value=n}clone(s){let{key:n,value:i}=this;return Oe(n)&&(n=n.clone(s)),Oe(i)&&(i=i.clone(s)),new ht(n,i)}toJSON(s,n){const i=n?.mapAsMap?new Map:{};return gf(n,i,this)}toString(s,n,i){return s?.doc?ak(this,s,n,i):JSON.stringify(this)}}function jf(t,s,n){return(s.inFlow??t.flow?dk:ck)(t,s,n)}function ck({comment:t,items:s},n,{blockItemPrefix:i,flowChars:r,itemIndent:a,onChompKeep:o,onComment:l}){const{indent:c,options:{commentString:d}}=n,u=Object.assign({},n,{indent:a,type:null});let m=!1;const h=[];for(let j=0;j<s.length;++j){const y=s[j];let x=null;if(Oe(y))!m&&y.spaceBefore&&h.push(""),Ia(n,h,y.commentBefore,m),y.comment&&(x=y.comment);else if(Me(y)){const b=Oe(y.key)?y.key:null;b&&(!m&&b.spaceBefore&&h.push(""),Ia(n,h,b.commentBefore,m))}m=!1;let g=vi(y,u,()=>x=null,()=>m=!0);x&&(g+=yn(g,a,d(x))),m&&x&&(m=!1),h.push(i+g)}let p;if(h.length===0)p=r.start+r.end;else{p=h[0];for(let j=1;j<h.length;++j){const y=h[j];p+=y?`
${c}${y}`:`
`}}return t?(p+=`
`+Ds(d(t),c),l&&l()):m&&o&&o(),p}function dk({items:t},s,{flowChars:n,itemIndent:i}){const{indent:r,indentStep:a,flowCollectionPadding:o,options:{commentString:l}}=s;i+=a;const c=Object.assign({},s,{indent:i,inFlow:!0,type:null});let d=!1,u=0;const m=[];for(let j=0;j<t.length;++j){const y=t[j];let x=null;if(Oe(y))y.spaceBefore&&m.push(""),Ia(s,m,y.commentBefore,!1),y.comment&&(x=y.comment);else if(Me(y)){const b=Oe(y.key)?y.key:null;b&&(b.spaceBefore&&m.push(""),Ia(s,m,b.commentBefore,!1),b.comment&&(d=!0));const v=Oe(y.value)?y.value:null;v?(v.comment&&(x=v.comment),v.commentBefore&&(d=!0)):y.value==null&&b?.comment&&(x=b.comment)}x&&(d=!0);let g=vi(y,c,()=>x=null);j<t.length-1&&(g+=","),x&&(g+=yn(g,i,l(x))),!d&&(m.length>u||g.includes(`
`))&&(d=!0),m.push(g),u=m.length}const{start:h,end:p}=n;if(m.length===0)return h+p;if(!d){const j=m.reduce((y,x)=>y+x.length+2,2);d=s.options.lineWidth>0&&j>s.options.lineWidth}if(d){let j=h;for(const y of m)j+=y?`
${a}${r}${y}`:`
`;return`${j}
${r}${p}`}else return`${h}${o}${m.join(" ")}${o}${p}`}function Ia({indent:t,options:{commentString:s}},n,i,r){if(i&&r&&(i=i.replace(/^\n+/,"")),i){const a=Ds(s(i),t);n.push(a.trimStart())}}function wn(t,s){const n=ke(s)?s.value:s;for(const i of t)if(Me(i)&&(i.key===s||i.key===n||ke(i.key)&&i.key.value===n))return i}class Ot extends mf{static get tagName(){return"tag:yaml.org,2002:map"}constructor(s){super(tn,s),this.items=[]}static from(s,n,i){const{keepUndefined:r,replacer:a}=i,o=new this(s),l=(c,d)=>{if(typeof a=="function")d=a.call(n,c,d);else if(Array.isArray(a)&&!a.includes(c))return;(d!==void 0||r)&&o.items.push(_c(c,d,i))};if(n instanceof Map)for(const[c,d]of n)l(c,d);else if(n&&typeof n=="object")for(const c of Object.keys(n))l(c,n[c]);return typeof s.sortMapEntries=="function"&&o.items.sort(s.sortMapEntries),o}add(s,n){let i;Me(s)?i=s:!s||typeof s!="object"||!("key"in s)?i=new ht(s,s?.value):i=new ht(s.key,s.value);const r=wn(this.items,i.key),a=this.schema?.sortMapEntries;if(r){if(!n)throw new Error(`Key ${i.key} already set`);ke(r.value)&&uf(i.value)?r.value.value=i.value:r.value=i.value}else if(a){const o=this.items.findIndex(l=>a(i,l)<0);o===-1?this.items.push(i):this.items.splice(o,0,i)}else this.items.push(i)}delete(s){const n=wn(this.items,s);return n?this.items.splice(this.items.indexOf(n),1).length>0:!1}get(s,n){const r=wn(this.items,s)?.value;return(!n&&ke(r)?r.value:r)??void 0}has(s){return!!wn(this.items,s)}set(s,n){this.add(new ht(s,n),!0)}toJSON(s,n,i){const r=i?new i:n?.mapAsMap?new Map:{};n?.onCreate&&n.onCreate(r);for(const a of this.items)gf(n,r,a);return r}toString(s,n,i){if(!s)return JSON.stringify(this);for(const r of this.items)if(!Me(r))throw new Error(`Map items must all be pairs; found ${JSON.stringify(r)} instead`);return!s.allNullValues&&this.hasAllNullValues(!1)&&(s=Object.assign({},s,{allNullValues:!0})),jf(this,s,{blockItemPrefix:"",flowChars:{start:"{",end:"}"},itemIndent:s.indent||"",onChompKeep:i,onComment:n})}}const Ii={collection:"map",default:!0,nodeClass:Ot,tag:"tag:yaml.org,2002:map",resolve(t,s){return Di(t)||s("Expected a mapping for this tag"),t},createNode:(t,s,n)=>Ot.from(t,s,n)};class rn extends mf{static get tagName(){return"tag:yaml.org,2002:seq"}constructor(s){super(Pi,s),this.items=[]}add(s){this.items.push(s)}delete(s){const n=ra(s);return typeof n!="number"?!1:this.items.splice(n,1).length>0}get(s,n){const i=ra(s);if(typeof i!="number")return;const r=this.items[i];return!n&&ke(r)?r.value:r}has(s){const n=ra(s);return typeof n=="number"&&n<this.items.length}set(s,n){const i=ra(s);if(typeof i!="number")throw new Error(`Expected a valid index, not ${s}.`);const r=this.items[i];ke(r)&&uf(n)?r.value=n:this.items[i]=n}toJSON(s,n){const i=[];n?.onCreate&&n.onCreate(i);let r=0;for(const a of this.items)i.push(Qt(a,String(r++),n));return i}toString(s,n,i){return s?jf(this,s,{blockItemPrefix:"- ",flowChars:{start:"[",end:"]"},itemIndent:(s.indent||"")+"  ",onChompKeep:i,onComment:n}):JSON.stringify(this)}static from(s,n,i){const{replacer:r}=i,a=new this(s);if(n&&Symbol.iterator in Object(n)){let o=0;for(let l of n){if(typeof r=="function"){const c=n instanceof Set?l:String(o++);l=r.call(n,c,l)}a.items.push(br(l,void 0,i))}}return a}}function ra(t){let s=ke(t)?t.value:t;return s&&typeof s=="string"&&(s=Number(s)),typeof s=="number"&&Number.isInteger(s)&&s>=0?s:null}const Ei={collection:"seq",default:!0,nodeClass:rn,tag:"tag:yaml.org,2002:seq",resolve(t,s){return Mi(t)||s("Expected a sequence for this tag"),t},createNode:(t,s,n)=>rn.from(t,s,n)},jo={identify:t=>typeof t=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:t=>t,stringify(t,s,n,i){return s=Object.assign({actualString:!0},s),Fr(t,s,n,i)}},yo={identify:t=>t==null,createNode:()=>new ae(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:()=>new ae(null),stringify:({source:t},s)=>typeof t=="string"&&yo.test.test(t)?t:s.options.nullStr},Tc={identify:t=>typeof t=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,resolve:t=>new ae(t[0]==="t"||t[0]==="T"),stringify({source:t,value:s},n){if(t&&Tc.test.test(t)){const i=t[0]==="t"||t[0]==="T";if(s===i)return t}return s?n.options.trueStr:n.options.falseStr}};function hs({format:t,minFractionDigits:s,tag:n,value:i}){if(typeof i=="bigint")return String(i);const r=typeof i=="number"?i:Number(i);if(!isFinite(r))return isNaN(r)?".nan":r<0?"-.inf":".inf";let a=JSON.stringify(i);if(!t&&s&&(!n||n==="tag:yaml.org,2002:float")&&/^\d/.test(a)){let o=a.indexOf(".");o<0&&(o=a.length,a+=".");let l=s-(a.length-o-1);for(;l-- >0;)a+="0"}return a}const yf={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:t=>t.slice(-3).toLowerCase()==="nan"?NaN:t[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:hs},wf={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:\.[0-9]+|[0-9]+(?:\.[0-9]*)?)[eE][-+]?[0-9]+$/,resolve:t=>parseFloat(t),stringify(t){const s=Number(t.value);return isFinite(s)?s.toExponential():hs(t)}},bf={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:\.[0-9]+|[0-9]+\.[0-9]*)$/,resolve(t){const s=new ae(parseFloat(t)),n=t.indexOf(".");return n!==-1&&t[t.length-1]==="0"&&(s.minFractionDigits=t.length-n-1),s},stringify:hs},wo=t=>typeof t=="bigint"||Number.isInteger(t),Ac=(t,s,n,{intAsBigInt:i})=>i?BigInt(t):parseInt(t.substring(s),n);function vf(t,s,n){const{value:i}=t;return wo(i)&&i>=0?n+i.toString(s):hs(t)}const Nf={identify:t=>wo(t)&&t>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^0o[0-7]+$/,resolve:(t,s,n)=>Ac(t,2,8,n),stringify:t=>vf(t,8,"0o")},kf={identify:wo,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9]+$/,resolve:(t,s,n)=>Ac(t,0,10,n),stringify:hs},zf={identify:t=>wo(t)&&t>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^0x[0-9a-fA-F]+$/,resolve:(t,s,n)=>Ac(t,2,16,n),stringify:t=>vf(t,16,"0x")},uk=[Ii,Ei,jo,yo,Tc,Nf,kf,zf,yf,wf,bf];function gu(t){return typeof t=="bigint"||Number.isInteger(t)}const aa=({value:t})=>JSON.stringify(t),mk=[{identify:t=>typeof t=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:t=>t,stringify:aa},{identify:t=>t==null,createNode:()=>new ae(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^null$/,resolve:()=>null,stringify:aa},{identify:t=>typeof t=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^true$|^false$/,resolve:t=>t==="true",stringify:aa},{identify:gu,default:!0,tag:"tag:yaml.org,2002:int",test:/^-?(?:0|[1-9][0-9]*)$/,resolve:(t,s,{intAsBigInt:n})=>n?BigInt(t):parseInt(t,10),stringify:({value:t})=>gu(t)?t.toString():JSON.stringify(t)},{identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^-?(?:0|[1-9][0-9]*)(?:\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,resolve:t=>parseFloat(t),stringify:aa}],hk={default:!0,tag:"",test:/^/,resolve(t,s){return s(`Unresolved plain scalar ${JSON.stringify(t)}`),t}},pk=[Ii,Ei].concat(mk,hk),Pc={identify:t=>t instanceof Uint8Array,default:!1,tag:"tag:yaml.org,2002:binary",resolve(t,s){if(typeof atob=="function"){const n=atob(t.replace(/[\n\r]/g,"")),i=new Uint8Array(n.length);for(let r=0;r<n.length;++r)i[r]=n.charCodeAt(r);return i}else return s("This environment does not support reading binary tags; either Buffer or atob is required"),t},stringify({comment:t,type:s,value:n},i,r,a){if(!n)return"";const o=n;let l;if(typeof btoa=="function"){let c="";for(let d=0;d<o.length;++d)c+=String.fromCharCode(o[d]);l=btoa(c)}else throw new Error("This environment does not support writing binary tags; either Buffer or btoa is required");if(s??(s=ae.BLOCK_LITERAL),s!==ae.QUOTE_DOUBLE){const c=Math.max(i.options.lineWidth-i.indent.length,i.options.minContentWidth),d=Math.ceil(l.length/c),u=new Array(d);for(let m=0,h=0;m<d;++m,h+=c)u[m]=l.substr(h,c);l=u.join(s===ae.BLOCK_LITERAL?`
`:" ")}return Fr({comment:t,type:s,value:l},i,r,a)}};function Sf(t,s){if(Mi(t))for(let n=0;n<t.items.length;++n){let i=t.items[n];if(!Me(i)){if(Di(i)){i.items.length>1&&s("Each pair must have its own sequence indicator");const r=i.items[0]||new ht(new ae(null));if(i.commentBefore&&(r.key.commentBefore=r.key.commentBefore?`${i.commentBefore}
${r.key.commentBefore}`:i.commentBefore),i.comment){const a=r.value??r.key;a.comment=a.comment?`${i.comment}
${a.comment}`:i.comment}i=r}t.items[n]=Me(i)?i:new ht(i)}}else s("Expected a sequence for this tag");return t}function Cf(t,s,n){const{replacer:i}=n,r=new rn(t);r.tag="tag:yaml.org,2002:pairs";let a=0;if(s&&Symbol.iterator in Object(s))for(let o of s){typeof i=="function"&&(o=i.call(s,String(a++),o));let l,c;if(Array.isArray(o))if(o.length===2)l=o[0],c=o[1];else throw new TypeError(`Expected [key, value] tuple: ${o}`);else if(o&&o instanceof Object){const d=Object.keys(o);if(d.length===1)l=d[0],c=o[l];else throw new TypeError(`Expected tuple with one key, not ${d.length} keys`)}else l=o;r.items.push(_c(l,c,n))}return r}const Dc={collection:"seq",default:!1,tag:"tag:yaml.org,2002:pairs",resolve:Sf,createNode:Cf};class hi extends rn{constructor(){super(),this.add=Ot.prototype.add.bind(this),this.delete=Ot.prototype.delete.bind(this),this.get=Ot.prototype.get.bind(this),this.has=Ot.prototype.has.bind(this),this.set=Ot.prototype.set.bind(this),this.tag=hi.tag}toJSON(s,n){if(!n)return super.toJSON(s);const i=new Map;n?.onCreate&&n.onCreate(i);for(const r of this.items){let a,o;if(Me(r)?(a=Qt(r.key,"",n),o=Qt(r.value,a,n)):a=Qt(r,"",n),i.has(a))throw new Error("Ordered maps must not include duplicate keys");i.set(a,o)}return i}static from(s,n,i){const r=Cf(s,n,i),a=new this;return a.items=r.items,a}}hi.tag="tag:yaml.org,2002:omap";const Mc={collection:"seq",identify:t=>t instanceof Map,nodeClass:hi,default:!1,tag:"tag:yaml.org,2002:omap",resolve(t,s){const n=Sf(t,s),i=[];for(const{key:r}of n.items)ke(r)&&(i.includes(r.value)?s(`Ordered maps must not include duplicate keys: ${r.value}`):i.push(r.value));return Object.assign(new hi,n)},createNode:(t,s,n)=>hi.from(t,s,n)};function _f({value:t,source:s},n){return s&&(t?Tf:Af).test.test(s)?s:t?n.options.trueStr:n.options.falseStr}const Tf={identify:t=>t===!0,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,resolve:()=>new ae(!0),stringify:_f},Af={identify:t=>t===!1,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/,resolve:()=>new ae(!1),stringify:_f},fk={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:t=>t.slice(-3).toLowerCase()==="nan"?NaN:t[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:hs},xk={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:[0-9][0-9_]*)?(?:\.[0-9_]*)?[eE][-+]?[0-9]+$/,resolve:t=>parseFloat(t.replace(/_/g,"")),stringify(t){const s=Number(t.value);return isFinite(s)?s.toExponential():hs(t)}},gk={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:[0-9][0-9_]*)?\.[0-9_]*$/,resolve(t){const s=new ae(parseFloat(t.replace(/_/g,""))),n=t.indexOf(".");if(n!==-1){const i=t.substring(n+1).replace(/_/g,"");i[i.length-1]==="0"&&(s.minFractionDigits=i.length)}return s},stringify:hs},Br=t=>typeof t=="bigint"||Number.isInteger(t);function bo(t,s,n,{intAsBigInt:i}){const r=t[0];if((r==="-"||r==="+")&&(s+=1),t=t.substring(s).replace(/_/g,""),i){switch(n){case 2:t=`0b${t}`;break;case 8:t=`0o${t}`;break;case 16:t=`0x${t}`;break}const o=BigInt(t);return r==="-"?BigInt(-1)*o:o}const a=parseInt(t,n);return r==="-"?-1*a:a}function Ic(t,s,n){const{value:i}=t;if(Br(i)){const r=i.toString(s);return i<0?"-"+n+r.substr(1):n+r}return hs(t)}const jk={identify:Br,default:!0,tag:"tag:yaml.org,2002:int",format:"BIN",test:/^[-+]?0b[0-1_]+$/,resolve:(t,s,n)=>bo(t,2,2,n),stringify:t=>Ic(t,2,"0b")},yk={identify:Br,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^[-+]?0[0-7_]+$/,resolve:(t,s,n)=>bo(t,1,8,n),stringify:t=>Ic(t,8,"0")},wk={identify:Br,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9][0-9_]*$/,resolve:(t,s,n)=>bo(t,0,10,n),stringify:hs},bk={identify:Br,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^[-+]?0x[0-9a-fA-F_]+$/,resolve:(t,s,n)=>bo(t,2,16,n),stringify:t=>Ic(t,16,"0x")};class pi extends Ot{constructor(s){super(s),this.tag=pi.tag}add(s){let n;Me(s)?n=s:s&&typeof s=="object"&&"key"in s&&"value"in s&&s.value===null?n=new ht(s.key,null):n=new ht(s,null),wn(this.items,n.key)||this.items.push(n)}get(s,n){const i=wn(this.items,s);return!n&&Me(i)?ke(i.key)?i.key.value:i.key:i}set(s,n){if(typeof n!="boolean")throw new Error(`Expected boolean value for set(key, value) in a YAML set, not ${typeof n}`);const i=wn(this.items,s);i&&!n?this.items.splice(this.items.indexOf(i),1):!i&&n&&this.items.push(new ht(s))}toJSON(s,n){return super.toJSON(s,n,Set)}toString(s,n,i){if(!s)return JSON.stringify(this);if(this.hasAllNullValues(!0))return super.toString(Object.assign({},s,{allNullValues:!0}),n,i);throw new Error("Set items must all have null values")}static from(s,n,i){const{replacer:r}=i,a=new this(s);if(n&&Symbol.iterator in Object(n))for(let o of n)typeof r=="function"&&(o=r.call(n,o,o)),a.items.push(_c(o,null,i));return a}}pi.tag="tag:yaml.org,2002:set";const Ec={collection:"map",identify:t=>t instanceof Set,nodeClass:pi,default:!1,tag:"tag:yaml.org,2002:set",createNode:(t,s,n)=>pi.from(t,s,n),resolve(t,s){if(Di(t)){if(t.hasAllNullValues(!0))return Object.assign(new pi,t);s("Set items must all have null values")}else s("Expected a mapping for this tag");return t}};function Lc(t,s){const n=t[0],i=n==="-"||n==="+"?t.substring(1):t,r=o=>s?BigInt(o):Number(o),a=i.replace(/_/g,"").split(":").reduce((o,l)=>o*r(60)+r(l),r(0));return n==="-"?r(-1)*a:a}function Pf(t){let{value:s}=t,n=o=>o;if(typeof s=="bigint")n=o=>BigInt(o);else if(isNaN(s)||!isFinite(s))return hs(t);let i="";s<0&&(i="-",s*=n(-1));const r=n(60),a=[s%r];return s<60?a.unshift(0):(s=(s-a[0])/r,a.unshift(s%r),s>=60&&(s=(s-a[0])/r,a.unshift(s))),i+a.map(o=>String(o).padStart(2,"0")).join(":").replace(/000000\d*$/,"")}const Df={identify:t=>typeof t=="bigint"||Number.isInteger(t),default:!0,tag:"tag:yaml.org,2002:int",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,resolve:(t,s,{intAsBigInt:n})=>Lc(t,n),stringify:Pf},Mf={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\.[0-9_]*$/,resolve:t=>Lc(t,!1),stringify:Pf},vo={identify:t=>t instanceof Date,default:!0,tag:"tag:yaml.org,2002:timestamp",test:RegExp("^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})(?:(?:t|T|[ \\t]+)([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\.[0-9]+)?)(?:[ \\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?)?$"),resolve(t){const s=t.match(vo.test);if(!s)throw new Error("!!timestamp expects a date, starting with yyyy-mm-dd");const[,n,i,r,a,o,l]=s.map(Number),c=s[7]?Number((s[7]+"00").substr(1,3)):0;let d=Date.UTC(n,i-1,r,a||0,o||0,l||0,c);const u=s[8];if(u&&u!=="Z"){let m=Lc(u,!1);Math.abs(m)<30&&(m*=60),d-=6e4*m}return new Date(d)},stringify:({value:t})=>t?.toISOString().replace(/(T00:00:00)?\.000Z$/,"")??""},ju=[Ii,Ei,jo,yo,Tf,Af,jk,yk,wk,bk,fk,xk,gk,Pc,Ms,Mc,Dc,Ec,Df,Mf,vo],yu=new Map([["core",uk],["failsafe",[Ii,Ei,jo]],["json",pk],["yaml11",ju],["yaml-1.1",ju]]),wu={binary:Pc,bool:Tc,float:bf,floatExp:wf,floatNaN:yf,floatTime:Mf,int:kf,intHex:zf,intOct:Nf,intTime:Df,map:Ii,merge:Ms,null:yo,omap:Mc,pairs:Dc,seq:Ei,set:Ec,timestamp:vo},vk={"tag:yaml.org,2002:binary":Pc,"tag:yaml.org,2002:merge":Ms,"tag:yaml.org,2002:omap":Mc,"tag:yaml.org,2002:pairs":Dc,"tag:yaml.org,2002:set":Ec,"tag:yaml.org,2002:timestamp":vo};function Yo(t,s,n){const i=yu.get(s);if(i&&!t)return n&&!i.includes(Ms)?i.concat(Ms):i.slice();let r=i;if(!r)if(Array.isArray(t))r=[];else{const a=Array.from(yu.keys()).filter(o=>o!=="yaml11").map(o=>JSON.stringify(o)).join(", ");throw new Error(`Unknown schema "${s}"; use one of ${a} or define customTags array`)}if(Array.isArray(t))for(const a of t)r=r.concat(a);else typeof t=="function"&&(r=t(r.slice()));return n&&(r=r.concat(Ms)),r.reduce((a,o)=>{const l=typeof o=="string"?wu[o]:o;if(!l){const c=JSON.stringify(o),d=Object.keys(wu).map(u=>JSON.stringify(u)).join(", ");throw new Error(`Unknown custom tag ${c}; use one of ${d}`)}return a.includes(l)||a.push(l),a},[])}const Nk=(t,s)=>t.key<s.key?-1:t.key>s.key?1:0;class No{constructor({compat:s,customTags:n,merge:i,resolveKnownTags:r,schema:a,sortMapEntries:o,toStringDefaults:l}){this.compat=Array.isArray(s)?Yo(s,"compat"):s?Yo(null,s):null,this.name=typeof a=="string"&&a||"core",this.knownTags=r?vk:{},this.tags=Yo(n,this.name,i),this.toStringOptions=l??null,Object.defineProperty(this,tn,{value:Ii}),Object.defineProperty(this,ks,{value:jo}),Object.defineProperty(this,Pi,{value:Ei}),this.sortMapEntries=typeof o=="function"?o:o===!0?Nk:null}clone(){const s=Object.create(No.prototype,Object.getOwnPropertyDescriptors(this));return s.tags=this.tags.slice(),s}}function kk(t,s){const n=[];let i=s.directives===!0;if(s.directives!==!1&&t.directives){const c=t.directives.toString(t);c?(n.push(c),i=!0):t.directives.docStart&&(i=!0)}i&&n.push("---");const r=pf(t,s),{commentString:a}=r.options;if(t.commentBefore){n.length!==1&&n.unshift("");const c=a(t.commentBefore);n.unshift(Ds(c,""))}let o=!1,l=null;if(t.contents){if(Oe(t.contents)){if(t.contents.spaceBefore&&i&&n.push(""),t.contents.commentBefore){const u=a(t.contents.commentBefore);n.push(Ds(u,""))}r.forceBlockIndent=!!t.comment,l=t.contents.comment}const c=l?void 0:()=>o=!0;let d=vi(t.contents,r,()=>l=null,c);l&&(d+=yn(d,"",a(l))),(d[0]==="|"||d[0]===">")&&n[n.length-1]==="---"?n[n.length-1]=`--- ${d}`:n.push(d)}else n.push(vi(t.contents,r));if(t.directives?.docEnd)if(t.comment){const c=a(t.comment);c.includes(`
`)?(n.push("..."),n.push(Ds(c,""))):n.push(`... ${c}`)}else n.push("...");else{let c=t.comment;c&&o&&(c=c.replace(/^\n+/,"")),c&&((!o||l)&&n[n.length-1]!==""&&n.push(""),n.push(Ds(a(c),"")))}return n.join(`
`)+`
`}class Li{constructor(s,n,i){this.commentBefore=null,this.comment=null,this.errors=[],this.warnings=[],Object.defineProperty(this,ts,{value:Tl});let r=null;typeof n=="function"||Array.isArray(n)?r=n:i===void 0&&n&&(i=n,n=void 0);const a=Object.assign({intAsBigInt:!1,keepSourceTokens:!1,logLevel:"warn",prettyErrors:!0,strict:!0,stringKeys:!1,uniqueKeys:!0,version:"1.2"},i);this.options=a;let{version:o}=a;i?._directives?(this.directives=i._directives.atDocument(),this.directives.yaml.explicit&&(o=this.directives.yaml.version)):this.directives=new wt({version:o}),this.setSchema(o,i),this.contents=s===void 0?null:this.createNode(s,r,i)}clone(){const s=Object.create(Li.prototype,{[ts]:{value:Tl}});return s.commentBefore=this.commentBefore,s.comment=this.comment,s.errors=this.errors.slice(),s.warnings=this.warnings.slice(),s.options=Object.assign({},this.options),this.directives&&(s.directives=this.directives.clone()),s.schema=this.schema.clone(),s.contents=Oe(this.contents)?this.contents.clone(s.schema):this.contents,this.range&&(s.range=this.range.slice()),s}add(s){Qn(this.contents)&&this.contents.add(s)}addIn(s,n){Qn(this.contents)&&this.contents.addIn(s,n)}createAlias(s,n){if(!s.anchor){const i=cf(this);s.anchor=!n||i.has(n)?df(n||"a",i):n}return new po(s.anchor)}createNode(s,n,i){let r;if(typeof n=="function")s=n.call({"":s},"",s),r=n;else if(Array.isArray(n)){const x=b=>typeof b=="number"||b instanceof String||b instanceof Number,g=n.filter(x).map(String);g.length>0&&(n=n.concat(g)),r=n}else i===void 0&&n&&(i=n,n=void 0);const{aliasDuplicateObjects:a,anchorPrefix:o,flow:l,keepUndefined:c,onTagObj:d,tag:u}=i??{},{onAnchor:m,setAnchors:h,sourceObjects:p}=JN(this,o||"a"),j={aliasDuplicateObjects:a??!0,keepUndefined:c??!1,onAnchor:m,onTagObj:d,replacer:r,schema:this.schema,sourceObjects:p},y=br(s,u,j);return l&&Ie(y)&&(y.flow=!0),h(),y}createPair(s,n,i={}){const r=this.createNode(s,null,i),a=this.createNode(n,null,i);return new ht(r,a)}delete(s){return Qn(this.contents)?this.contents.delete(s):!1}deleteIn(s){return tr(s)?this.contents==null?!1:(this.contents=null,!0):Qn(this.contents)?this.contents.deleteIn(s):!1}get(s,n){return Ie(this.contents)?this.contents.get(s,n):void 0}getIn(s,n){return tr(s)?!n&&ke(this.contents)?this.contents.value:this.contents:Ie(this.contents)?this.contents.getIn(s,n):void 0}has(s){return Ie(this.contents)?this.contents.has(s):!1}hasIn(s){return tr(s)?this.contents!==void 0:Ie(this.contents)?this.contents.hasIn(s):!1}set(s,n){this.contents==null?this.contents=Ma(this.schema,[s],n):Qn(this.contents)&&this.contents.set(s,n)}setIn(s,n){tr(s)?this.contents=n:this.contents==null?this.contents=Ma(this.schema,Array.from(s),n):Qn(this.contents)&&this.contents.setIn(s,n)}setSchema(s,n={}){typeof s=="number"&&(s=String(s));let i;switch(s){case"1.1":this.directives?this.directives.yaml.version="1.1":this.directives=new wt({version:"1.1"}),i={resolveKnownTags:!1,schema:"yaml-1.1"};break;case"1.2":case"next":this.directives?this.directives.yaml.version=s:this.directives=new wt({version:s}),i={resolveKnownTags:!0,schema:"core"};break;case null:this.directives&&delete this.directives,i=null;break;default:{const r=JSON.stringify(s);throw new Error(`Expected '1.1', '1.2' or null as first argument, but found: ${r}`)}}if(n.schema instanceof Object)this.schema=n.schema;else if(i)this.schema=new No(Object.assign(i,n));else throw new Error("With a null YAML version, the { schema: Schema } option is required")}toJS({json:s,jsonArg:n,mapAsMap:i,maxAliasCount:r,onAnchor:a,reviver:o}={}){const l={anchors:new Map,doc:this,keep:!s,mapAsMap:i===!0,mapKeyWarned:!1,maxAliasCount:typeof r=="number"?r:100},c=Qt(this.contents,n??"",l);if(typeof a=="function")for(const{count:d,res:u}of l.anchors.values())a(u,d);return typeof o=="function"?ii(o,{"":c},"",c):c}toJSON(s,n){return this.toJS({json:!0,jsonArg:s,mapAsMap:!1,onAnchor:n})}toString(s={}){if(this.errors.length>0)throw new Error("Document with errors cannot be stringified");if("indent"in s&&(!Number.isInteger(s.indent)||Number(s.indent)<=0)){const n=JSON.stringify(s.indent);throw new Error(`"indent" option must be a positive integer, not ${n}`)}return kk(this,s)}}function Qn(t){if(Ie(t))return!0;throw new Error("Expected a YAML collection as document contents")}class Rc extends Error{constructor(s,n,i,r){super(),this.name=s,this.code=i,this.message=r,this.pos=n}}class bn extends Rc{constructor(s,n,i){super("YAMLParseError",s,n,i)}}class If extends Rc{constructor(s,n,i){super("YAMLWarning",s,n,i)}}const Ea=(t,s)=>n=>{if(n.pos[0]===-1)return;n.linePos=n.pos.map(l=>s.linePos(l));const{line:i,col:r}=n.linePos[0];n.message+=` at line ${i}, column ${r}`;let a=r-1,o=t.substring(s.lineStarts[i-1],s.lineStarts[i]).replace(/[\n\r]+$/,"");if(a>=60&&o.length>80){const l=Math.min(a-39,o.length-79);o="…"+o.substring(l),a-=l-1}if(o.length>80&&(o=o.substring(0,79)+"…"),i>1&&/^ *$/.test(o.substring(0,a))){let l=t.substring(s.lineStarts[i-2],s.lineStarts[i-1]);l.length>80&&(l=l.substring(0,79)+`…
`),o=l+o}if(/[^ ]/.test(o)){let l=1;const c=n.linePos[1];c&&c.line===i&&c.col>r&&(l=Math.max(1,Math.min(c.col-r,80-a)));const d=" ".repeat(a)+"^".repeat(l);n.message+=`:

${o}
${d}
`}};function Ni(t,{flow:s,indicator:n,next:i,offset:r,onError:a,parentIndent:o,startOnNewline:l}){let c=!1,d=l,u=l,m="",h="",p=!1,j=!1,y=null,x=null,g=null,b=null,v=null,C=null,T=null;for(const S of t)switch(j&&(S.type!=="space"&&S.type!=="newline"&&S.type!=="comma"&&a(S.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),j=!1),y&&(d&&S.type!=="comment"&&S.type!=="newline"&&a(y,"TAB_AS_INDENT","Tabs are not allowed as indentation"),y=null),S.type){case"space":!s&&(n!=="doc-start"||i?.type!=="flow-collection")&&S.source.includes("	")&&(y=S),u=!0;break;case"comment":{u||a(S,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const P=S.source.substring(1)||" ";m?m+=h+P:m=P,h="",d=!1;break}case"newline":d?m?m+=S.source:(!C||n!=="seq-item-ind")&&(c=!0):h+=S.source,d=!0,p=!0,(x||g)&&(b=S),u=!0;break;case"anchor":x&&a(S,"MULTIPLE_ANCHORS","A node can have at most one anchor"),S.source.endsWith(":")&&a(S.offset+S.source.length-1,"BAD_ALIAS","Anchor ending in : is ambiguous",!0),x=S,T??(T=S.offset),d=!1,u=!1,j=!0;break;case"tag":{g&&a(S,"MULTIPLE_TAGS","A node can have at most one tag"),g=S,T??(T=S.offset),d=!1,u=!1,j=!0;break}case n:(x||g)&&a(S,"BAD_PROP_ORDER",`Anchors and tags must be after the ${S.source} indicator`),C&&a(S,"UNEXPECTED_TOKEN",`Unexpected ${S.source} in ${s??"collection"}`),C=S,d=n==="seq-item-ind"||n==="explicit-key-ind",u=!1;break;case"comma":if(s){v&&a(S,"UNEXPECTED_TOKEN",`Unexpected , in ${s}`),v=S,d=!1,u=!1;break}default:a(S,"UNEXPECTED_TOKEN",`Unexpected ${S.type} token`),d=!1,u=!1}const z=t[t.length-1],N=z?z.offset+z.source.length:r;return j&&i&&i.type!=="space"&&i.type!=="newline"&&i.type!=="comma"&&(i.type!=="scalar"||i.source!=="")&&a(i.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),y&&(d&&y.indent<=o||i?.type==="block-map"||i?.type==="block-seq")&&a(y,"TAB_AS_INDENT","Tabs are not allowed as indentation"),{comma:v,found:C,spaceBefore:c,comment:m,hasNewline:p,anchor:x,tag:g,newlineAfterProp:b,end:N,start:T??N}}function vr(t){if(!t)return null;switch(t.type){case"alias":case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":if(t.source.includes(`
`))return!0;if(t.end){for(const s of t.end)if(s.type==="newline")return!0}return!1;case"flow-collection":for(const s of t.items){for(const n of s.start)if(n.type==="newline")return!0;if(s.sep){for(const n of s.sep)if(n.type==="newline")return!0}if(vr(s.key)||vr(s.value))return!0}return!1;default:return!0}}function Ml(t,s,n){if(s?.type==="flow-collection"){const i=s.end[0];i.indent===t&&(i.source==="]"||i.source==="}")&&vr(s)&&n(i,"BAD_INDENT","Flow end indicator should be more indented than parent",!0)}}function Ef(t,s,n){const{uniqueKeys:i}=t.options;if(i===!1)return!1;const r=typeof i=="function"?i:(a,o)=>a===o||ke(a)&&ke(o)&&a.value===o.value;return s.some(a=>r(a.key,n))}const bu="All mapping items must start at the same column";function zk({composeNode:t,composeEmptyNode:s},n,i,r,a){const o=a?.nodeClass??Ot,l=new o(n.schema);n.atRoot&&(n.atRoot=!1);let c=i.offset,d=null;for(const u of i.items){const{start:m,key:h,sep:p,value:j}=u,y=Ni(m,{indicator:"explicit-key-ind",next:h??p?.[0],offset:c,onError:r,parentIndent:i.indent,startOnNewline:!0}),x=!y.found;if(x){if(h&&(h.type==="block-seq"?r(c,"BLOCK_AS_IMPLICIT_KEY","A block sequence may not be used as an implicit map key"):"indent"in h&&h.indent!==i.indent&&r(c,"BAD_INDENT",bu)),!y.anchor&&!y.tag&&!p){d=y.end,y.comment&&(l.comment?l.comment+=`
`+y.comment:l.comment=y.comment);continue}(y.newlineAfterProp||vr(h))&&r(h??m[m.length-1],"MULTILINE_IMPLICIT_KEY","Implicit keys need to be on a single line")}else y.found?.indent!==i.indent&&r(c,"BAD_INDENT",bu);n.atKey=!0;const g=y.end,b=h?t(n,h,y,r):s(n,g,m,null,y,r);n.schema.compat&&Ml(i.indent,h,r),n.atKey=!1,Ef(n,l.items,b)&&r(g,"DUPLICATE_KEY","Map keys must be unique");const v=Ni(p??[],{indicator:"map-value-ind",next:j,offset:b.range[2],onError:r,parentIndent:i.indent,startOnNewline:!h||h.type==="block-scalar"});if(c=v.end,v.found){x&&(j?.type==="block-map"&&!v.hasNewline&&r(c,"BLOCK_AS_IMPLICIT_KEY","Nested mappings are not allowed in compact mappings"),n.options.strict&&y.start<v.found.offset-1024&&r(b.range,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit block mapping key"));const C=j?t(n,j,v,r):s(n,c,p,null,v,r);n.schema.compat&&Ml(i.indent,j,r),c=C.range[2];const T=new ht(b,C);n.options.keepSourceTokens&&(T.srcToken=u),l.items.push(T)}else{x&&r(b.range,"MISSING_CHAR","Implicit map keys need to be followed by map values"),v.comment&&(b.comment?b.comment+=`
`+v.comment:b.comment=v.comment);const C=new ht(b);n.options.keepSourceTokens&&(C.srcToken=u),l.items.push(C)}}return d&&d<c&&r(d,"IMPOSSIBLE","Map comment with trailing content"),l.range=[i.offset,c,d??c],l}function Sk({composeNode:t,composeEmptyNode:s},n,i,r,a){const o=a?.nodeClass??rn,l=new o(n.schema);n.atRoot&&(n.atRoot=!1),n.atKey&&(n.atKey=!1);let c=i.offset,d=null;for(const{start:u,value:m}of i.items){const h=Ni(u,{indicator:"seq-item-ind",next:m,offset:c,onError:r,parentIndent:i.indent,startOnNewline:!0});if(!h.found)if(h.anchor||h.tag||m)m&&m.type==="block-seq"?r(h.end,"BAD_INDENT","All sequence items must start at the same column"):r(c,"MISSING_CHAR","Sequence item without - indicator");else{d=h.end,h.comment&&(l.comment=h.comment);continue}const p=m?t(n,m,h,r):s(n,h.end,u,null,h,r);n.schema.compat&&Ml(i.indent,m,r),c=p.range[2],l.items.push(p)}return l.range=[i.offset,c,d??c],l}function Ur(t,s,n,i){let r="";if(t){let a=!1,o="";for(const l of t){const{source:c,type:d}=l;switch(d){case"space":a=!0;break;case"comment":{n&&!a&&i(l,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const u=c.substring(1)||" ";r?r+=o+u:r=u,o="";break}case"newline":r&&(o+=c),a=!0;break;default:i(l,"UNEXPECTED_TOKEN",`Unexpected ${d} at node end`)}s+=c.length}}return{comment:r,offset:s}}const Jo="Block collections are not allowed within flow collections",Xo=t=>t&&(t.type==="block-map"||t.type==="block-seq");function Ck({composeNode:t,composeEmptyNode:s},n,i,r,a){const o=i.start.source==="{",l=o?"flow map":"flow sequence",c=a?.nodeClass??(o?Ot:rn),d=new c(n.schema);d.flow=!0;const u=n.atRoot;u&&(n.atRoot=!1),n.atKey&&(n.atKey=!1);let m=i.offset+i.start.source.length;for(let x=0;x<i.items.length;++x){const g=i.items[x],{start:b,key:v,sep:C,value:T}=g,z=Ni(b,{flow:l,indicator:"explicit-key-ind",next:v??C?.[0],offset:m,onError:r,parentIndent:i.indent,startOnNewline:!1});if(!z.found){if(!z.anchor&&!z.tag&&!C&&!T){x===0&&z.comma?r(z.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${l}`):x<i.items.length-1&&r(z.start,"UNEXPECTED_TOKEN",`Unexpected empty item in ${l}`),z.comment&&(d.comment?d.comment+=`
`+z.comment:d.comment=z.comment),m=z.end;continue}!o&&n.options.strict&&vr(v)&&r(v,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line")}if(x===0)z.comma&&r(z.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${l}`);else if(z.comma||r(z.start,"MISSING_CHAR",`Missing , between ${l} items`),z.comment){let N="";e:for(const S of b)switch(S.type){case"comma":case"space":break;case"comment":N=S.source.substring(1);break e;default:break e}if(N){let S=d.items[d.items.length-1];Me(S)&&(S=S.value??S.key),S.comment?S.comment+=`
`+N:S.comment=N,z.comment=z.comment.substring(N.length+1)}}if(!o&&!C&&!z.found){const N=T?t(n,T,z,r):s(n,z.end,C,null,z,r);d.items.push(N),m=N.range[2],Xo(T)&&r(N.range,"BLOCK_IN_FLOW",Jo)}else{n.atKey=!0;const N=z.end,S=v?t(n,v,z,r):s(n,N,b,null,z,r);Xo(v)&&r(S.range,"BLOCK_IN_FLOW",Jo),n.atKey=!1;const P=Ni(C??[],{flow:l,indicator:"map-value-ind",next:T,offset:S.range[2],onError:r,parentIndent:i.indent,startOnNewline:!1});if(P.found){if(!o&&!z.found&&n.options.strict){if(C)for(const _ of C){if(_===P.found)break;if(_.type==="newline"){r(_,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line");break}}z.start<P.found.offset-1024&&r(P.found,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit flow sequence key")}}else T&&("source"in T&&T.source&&T.source[0]===":"?r(T,"MISSING_CHAR",`Missing space after : in ${l}`):r(P.start,"MISSING_CHAR",`Missing , or : between ${l} items`));const w=T?t(n,T,P,r):P.found?s(n,P.end,C,null,P,r):null;w?Xo(T)&&r(w.range,"BLOCK_IN_FLOW",Jo):P.comment&&(S.comment?S.comment+=`
`+P.comment:S.comment=P.comment);const k=new ht(S,w);if(n.options.keepSourceTokens&&(k.srcToken=g),o){const _=d;Ef(n,_.items,S)&&r(N,"DUPLICATE_KEY","Map keys must be unique"),_.items.push(k)}else{const _=new Ot(n.schema);_.flow=!0,_.items.push(k);const A=(w??S).range;_.range=[S.range[0],A[1],A[2]],d.items.push(_)}m=w?w.range[2]:P.end}}const h=o?"}":"]",[p,...j]=i.end;let y=m;if(p&&p.source===h)y=p.offset+p.source.length;else{const x=l[0].toUpperCase()+l.substring(1),g=u?`${x} must end with a ${h}`:`${x} in block collection must be sufficiently indented and end with a ${h}`;r(m,u?"MISSING_CHAR":"BAD_INDENT",g),p&&p.source.length!==1&&j.unshift(p)}if(j.length>0){const x=Ur(j,y,n.options.strict,r);x.comment&&(d.comment?d.comment+=`
`+x.comment:d.comment=x.comment),d.range=[i.offset,y,x.offset]}else d.range=[i.offset,y,y];return d}function el(t,s,n,i,r,a){const o=n.type==="block-map"?zk(t,s,n,i,a):n.type==="block-seq"?Sk(t,s,n,i,a):Ck(t,s,n,i,a),l=o.constructor;return r==="!"||r===l.tagName?(o.tag=l.tagName,o):(r&&(o.tag=r),o)}function _k(t,s,n,i,r){const a=i.tag,o=a?s.directives.tagName(a.source,h=>r(a,"TAG_RESOLVE_FAILED",h)):null;if(n.type==="block-seq"){const{anchor:h,newlineAfterProp:p}=i,j=h&&a?h.offset>a.offset?h:a:h??a;j&&(!p||p.offset<j.offset)&&r(j,"MISSING_CHAR","Missing newline after block sequence props")}const l=n.type==="block-map"?"map":n.type==="block-seq"?"seq":n.start.source==="{"?"map":"seq";if(!a||!o||o==="!"||o===Ot.tagName&&l==="map"||o===rn.tagName&&l==="seq")return el(t,s,n,r,o);let c=s.schema.tags.find(h=>h.tag===o&&h.collection===l);if(!c){const h=s.schema.knownTags[o];if(h&&h.collection===l)s.schema.tags.push(Object.assign({},h,{default:!1})),c=h;else return h?r(a,"BAD_COLLECTION_TYPE",`${h.tag} used for ${l} collection, but expects ${h.collection??"scalar"}`,!0):r(a,"TAG_RESOLVE_FAILED",`Unresolved tag: ${o}`,!0),el(t,s,n,r,o)}const d=el(t,s,n,r,o,c),u=c.resolve?.(d,h=>r(a,"TAG_RESOLVE_FAILED",h),s.options)??d,m=Oe(u)?u:new ae(u);return m.range=d.range,m.tag=o,c?.format&&(m.format=c.format),m}function Lf(t,s,n){const i=s.offset,r=Tk(s,t.options.strict,n);if(!r)return{value:"",type:null,comment:"",range:[i,i,i]};const a=r.mode===">"?ae.BLOCK_FOLDED:ae.BLOCK_LITERAL,o=s.source?Ak(s.source):[];let l=o.length;for(let y=o.length-1;y>=0;--y){const x=o[y][1];if(x===""||x==="\r")l=y;else break}if(l===0){const y=r.chomp==="+"&&o.length>0?`
`.repeat(Math.max(1,o.length-1)):"";let x=i+r.length;return s.source&&(x+=s.source.length),{value:y,type:a,comment:r.comment,range:[i,x,x]}}let c=s.indent+r.indent,d=s.offset+r.length,u=0;for(let y=0;y<l;++y){const[x,g]=o[y];if(g===""||g==="\r")r.indent===0&&x.length>c&&(c=x.length);else{x.length<c&&n(d+x.length,"MISSING_CHAR","Block scalars with more-indented leading empty lines must use an explicit indentation indicator"),r.indent===0&&(c=x.length),u=y,c===0&&!t.atRoot&&n(d,"BAD_INDENT","Block scalar values in collections must be indented");break}d+=x.length+g.length+1}for(let y=o.length-1;y>=l;--y)o[y][0].length>c&&(l=y+1);let m="",h="",p=!1;for(let y=0;y<u;++y)m+=o[y][0].slice(c)+`
`;for(let y=u;y<l;++y){let[x,g]=o[y];d+=x.length+g.length+1;const b=g[g.length-1]==="\r";if(b&&(g=g.slice(0,-1)),g&&x.length<c){const C=`Block scalar lines must not be less indented than their ${r.indent?"explicit indentation indicator":"first line"}`;n(d-g.length-(b?2:1),"BAD_INDENT",C),x=""}a===ae.BLOCK_LITERAL?(m+=h+x.slice(c)+g,h=`
`):x.length>c||g[0]==="	"?(h===" "?h=`
`:!p&&h===`
`&&(h=`

`),m+=h+x.slice(c)+g,h=`
`,p=!0):g===""?h===`
`?m+=`
`:h=`
`:(m+=h+g,h=" ",p=!1)}switch(r.chomp){case"-":break;case"+":for(let y=l;y<o.length;++y)m+=`
`+o[y][0].slice(c);m[m.length-1]!==`
`&&(m+=`
`);break;default:m+=`
`}const j=i+r.length+s.source.length;return{value:m,type:a,comment:r.comment,range:[i,j,j]}}function Tk({offset:t,props:s},n,i){if(s[0].type!=="block-scalar-header")return i(s[0],"IMPOSSIBLE","Block scalar header not found"),null;const{source:r}=s[0],a=r[0];let o=0,l="",c=-1;for(let h=1;h<r.length;++h){const p=r[h];if(!l&&(p==="-"||p==="+"))l=p;else{const j=Number(p);!o&&j?o=j:c===-1&&(c=t+h)}}c!==-1&&i(c,"UNEXPECTED_TOKEN",`Block scalar header includes extra characters: ${r}`);let d=!1,u="",m=r.length;for(let h=1;h<s.length;++h){const p=s[h];switch(p.type){case"space":d=!0;case"newline":m+=p.source.length;break;case"comment":n&&!d&&i(p,"MISSING_CHAR","Comments must be separated from other tokens by white space characters"),m+=p.source.length,u=p.source.substring(1);break;case"error":i(p,"UNEXPECTED_TOKEN",p.message),m+=p.source.length;break;default:{const j=`Unexpected token in block scalar header: ${p.type}`;i(p,"UNEXPECTED_TOKEN",j);const y=p.source;y&&typeof y=="string"&&(m+=y.length)}}}return{mode:a,indent:o,chomp:l,comment:u,length:m}}function Ak(t){const s=t.split(/\n( *)/),n=s[0],i=n.match(/^( *)/),a=[i?.[1]?[i[1],n.slice(i[1].length)]:["",n]];for(let o=1;o<s.length;o+=2)a.push([s[o],s[o+1]]);return a}function Rf(t,s,n){const{offset:i,type:r,source:a,end:o}=t;let l,c;const d=(h,p,j)=>n(i+h,p,j);switch(r){case"scalar":l=ae.PLAIN,c=Pk(a,d);break;case"single-quoted-scalar":l=ae.QUOTE_SINGLE,c=Dk(a,d);break;case"double-quoted-scalar":l=ae.QUOTE_DOUBLE,c=Mk(a,d);break;default:return n(t,"UNEXPECTED_TOKEN",`Expected a flow scalar value, but found: ${r}`),{value:"",type:null,comment:"",range:[i,i+a.length,i+a.length]}}const u=i+a.length,m=Ur(o,u,s,n);return{value:c,type:l,comment:m.comment,range:[i,u,m.offset]}}function Pk(t,s){let n="";switch(t[0]){case"	":n="a tab character";break;case",":n="flow indicator character ,";break;case"%":n="directive indicator character %";break;case"|":case">":{n=`block scalar indicator ${t[0]}`;break}case"@":case"`":{n=`reserved character ${t[0]}`;break}}return n&&s(0,"BAD_SCALAR_START",`Plain value cannot start with ${n}`),Of(t)}function Dk(t,s){return(t[t.length-1]!=="'"||t.length===1)&&s(t.length,"MISSING_CHAR","Missing closing 'quote"),Of(t.slice(1,-1)).replace(/''/g,"'")}function Of(t){let s,n;try{s=new RegExp(`(.*?)(?<![ 	])[ 	]*\r?
`,"sy"),n=new RegExp(`[ 	]*(.*?)(?:(?<![ 	])[ 	]*)?\r?
`,"sy")}catch{s=/(.*?)[ \t]*\r?\n/sy,n=/[ \t]*(.*?)[ \t]*\r?\n/sy}let i=s.exec(t);if(!i)return t;let r=i[1],a=" ",o=s.lastIndex;for(n.lastIndex=o;i=n.exec(t);)i[1]===""?a===`
`?r+=a:a=`
`:(r+=a+i[1],a=" "),o=n.lastIndex;const l=/[ \t]*(.*)/sy;return l.lastIndex=o,i=l.exec(t),r+a+(i?.[1]??"")}function Mk(t,s){let n="";for(let i=1;i<t.length-1;++i){const r=t[i];if(!(r==="\r"&&t[i+1]===`
`))if(r===`
`){const{fold:a,offset:o}=Ik(t,i);n+=a,i=o}else if(r==="\\"){let a=t[++i];const o=Ek[a];if(o)n+=o;else if(a===`
`)for(a=t[i+1];a===" "||a==="	";)a=t[++i+1];else if(a==="\r"&&t[i+1]===`
`)for(a=t[++i+1];a===" "||a==="	";)a=t[++i+1];else if(a==="x"||a==="u"||a==="U"){const l={x:2,u:4,U:8}[a];n+=Lk(t,i+1,l,s),i+=l}else{const l=t.substr(i-1,2);s(i-1,"BAD_DQ_ESCAPE",`Invalid escape sequence ${l}`),n+=l}}else if(r===" "||r==="	"){const a=i;let o=t[i+1];for(;o===" "||o==="	";)o=t[++i+1];o!==`
`&&!(o==="\r"&&t[i+2]===`
`)&&(n+=i>a?t.slice(a,i+1):r)}else n+=r}return(t[t.length-1]!=='"'||t.length===1)&&s(t.length,"MISSING_CHAR",'Missing closing "quote'),n}function Ik(t,s){let n="",i=t[s+1];for(;(i===" "||i==="	"||i===`
`||i==="\r")&&!(i==="\r"&&t[s+2]!==`
`);)i===`
`&&(n+=`
`),s+=1,i=t[s+1];return n||(n=" "),{fold:n,offset:s}}const Ek={0:"\0",a:"\x07",b:"\b",e:"\x1B",f:"\f",n:`
`,r:"\r",t:"	",v:"\v",N:"",_:" ",L:"\u2028",P:"\u2029"," ":" ",'"':'"',"/":"/","\\":"\\","	":"	"};function Lk(t,s,n,i){const r=t.substr(s,n),o=r.length===n&&/^[0-9a-fA-F]+$/.test(r)?parseInt(r,16):NaN;if(isNaN(o)){const l=t.substr(s-2,n+2);return i(s-2,"BAD_DQ_ESCAPE",`Invalid escape sequence ${l}`),l}return String.fromCodePoint(o)}function $f(t,s,n,i){const{value:r,type:a,comment:o,range:l}=s.type==="block-scalar"?Lf(t,s,i):Rf(s,t.options.strict,i),c=n?t.directives.tagName(n.source,m=>i(n,"TAG_RESOLVE_FAILED",m)):null;let d;t.options.stringKeys&&t.atKey?d=t.schema[ks]:c?d=Rk(t.schema,r,c,n,i):s.type==="scalar"?d=Ok(t,r,s,i):d=t.schema[ks];let u;try{const m=d.resolve(r,h=>i(n??s,"TAG_RESOLVE_FAILED",h),t.options);u=ke(m)?m:new ae(m)}catch(m){const h=m instanceof Error?m.message:String(m);i(n??s,"TAG_RESOLVE_FAILED",h),u=new ae(r)}return u.range=l,u.source=r,a&&(u.type=a),c&&(u.tag=c),d.format&&(u.format=d.format),o&&(u.comment=o),u}function Rk(t,s,n,i,r){if(n==="!")return t[ks];const a=[];for(const l of t.tags)if(!l.collection&&l.tag===n)if(l.default&&l.test)a.push(l);else return l;for(const l of a)if(l.test?.test(s))return l;const o=t.knownTags[n];return o&&!o.collection?(t.tags.push(Object.assign({},o,{default:!1,test:void 0})),o):(r(i,"TAG_RESOLVE_FAILED",`Unresolved tag: ${n}`,n!=="tag:yaml.org,2002:str"),t[ks])}function Ok({atKey:t,directives:s,schema:n},i,r,a){const o=n.tags.find(l=>(l.default===!0||t&&l.default==="key")&&l.test?.test(i))||n[ks];if(n.compat){const l=n.compat.find(c=>c.default&&c.test?.test(i))??n[ks];if(o.tag!==l.tag){const c=s.tagString(o.tag),d=s.tagString(l.tag),u=`Value may be parsed as either ${c} or ${d}`;a(r,"TAG_RESOLVE_FAILED",u,!0)}}return o}function $k(t,s,n){if(s){n??(n=s.length);for(let i=n-1;i>=0;--i){let r=s[i];switch(r.type){case"space":case"comment":case"newline":t-=r.source.length;continue}for(r=s[++i];r?.type==="space";)t+=r.source.length,r=s[++i];break}}return t}const qk={composeNode:qf,composeEmptyNode:Oc};function qf(t,s,n,i){const r=t.atKey,{spaceBefore:a,comment:o,anchor:l,tag:c}=n;let d,u=!0;switch(s.type){case"alias":d=Fk(t,s,i),(l||c)&&i(s,"ALIAS_PROPS","An alias node must not specify any properties");break;case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"block-scalar":d=$f(t,s,c,i),l&&(d.anchor=l.source.substring(1));break;case"block-map":case"block-seq":case"flow-collection":d=_k(qk,t,s,n,i),l&&(d.anchor=l.source.substring(1));break;default:{const m=s.type==="error"?s.message:`Unsupported token (type: ${s.type})`;i(s,"UNEXPECTED_TOKEN",m),d=Oc(t,s.offset,void 0,null,n,i),u=!1}}return l&&d.anchor===""&&i(l,"BAD_ALIAS","Anchor cannot be an empty string"),r&&t.options.stringKeys&&(!ke(d)||typeof d.value!="string"||d.tag&&d.tag!=="tag:yaml.org,2002:str")&&i(c??s,"NON_STRING_KEY","With stringKeys, all keys must be strings"),a&&(d.spaceBefore=!0),o&&(s.type==="scalar"&&s.source===""?d.comment=o:d.commentBefore=o),t.options.keepSourceTokens&&u&&(d.srcToken=s),d}function Oc(t,s,n,i,{spaceBefore:r,comment:a,anchor:o,tag:l,end:c},d){const u={type:"scalar",offset:$k(s,n,i),indent:-1,source:""},m=$f(t,u,l,d);return o&&(m.anchor=o.source.substring(1),m.anchor===""&&d(o,"BAD_ALIAS","Anchor cannot be an empty string")),r&&(m.spaceBefore=!0),a&&(m.comment=a,m.range[2]=c),m}function Fk({options:t},{offset:s,source:n,end:i},r){const a=new po(n.substring(1));a.source===""&&r(s,"BAD_ALIAS","Alias cannot be an empty string"),a.source.endsWith(":")&&r(s+n.length-1,"BAD_ALIAS","Alias ending in : is ambiguous",!0);const o=s+n.length,l=Ur(i,o,t.strict,r);return a.range=[s,o,l.offset],l.comment&&(a.comment=l.comment),a}function Bk(t,s,{offset:n,start:i,value:r,end:a},o){const l=Object.assign({_directives:s},t),c=new Li(void 0,l),d={atKey:!1,atRoot:!0,directives:c.directives,options:c.options,schema:c.schema},u=Ni(i,{indicator:"doc-start",next:r??a?.[0],offset:n,onError:o,parentIndent:0,startOnNewline:!0});u.found&&(c.directives.docStart=!0,r&&(r.type==="block-map"||r.type==="block-seq")&&!u.hasNewline&&o(u.end,"MISSING_CHAR","Block collection cannot start on same line with directives-end marker")),c.contents=r?qf(d,r,u,o):Oc(d,u.end,i,null,u,o);const m=c.contents.range[2],h=Ur(a,m,!1,o);return h.comment&&(c.comment=h.comment),c.range=[n,m,h.offset],c}function Qi(t){if(typeof t=="number")return[t,t+1];if(Array.isArray(t))return t.length===2?t:[t[0],t[1]];const{offset:s,source:n}=t;return[s,s+(typeof n=="string"?n.length:1)]}function vu(t){let s="",n=!1,i=!1;for(let r=0;r<t.length;++r){const a=t[r];switch(a[0]){case"#":s+=(s===""?"":i?`

`:`
`)+(a.substring(1)||" "),n=!0,i=!1;break;case"%":t[r+1]?.[0]!=="#"&&(r+=1),n=!1;break;default:n||(i=!0),n=!1}}return{comment:s,afterEmptyLine:i}}class $c{constructor(s={}){this.doc=null,this.atDirectives=!1,this.prelude=[],this.errors=[],this.warnings=[],this.onError=(n,i,r,a)=>{const o=Qi(n);a?this.warnings.push(new If(o,i,r)):this.errors.push(new bn(o,i,r))},this.directives=new wt({version:s.version||"1.2"}),this.options=s}decorate(s,n){const{comment:i,afterEmptyLine:r}=vu(this.prelude);if(i){const a=s.contents;if(n)s.comment=s.comment?`${s.comment}
${i}`:i;else if(r||s.directives.docStart||!a)s.commentBefore=i;else if(Ie(a)&&!a.flow&&a.items.length>0){let o=a.items[0];Me(o)&&(o=o.key);const l=o.commentBefore;o.commentBefore=l?`${i}
${l}`:i}else{const o=a.commentBefore;a.commentBefore=o?`${i}
${o}`:i}}n?(Array.prototype.push.apply(s.errors,this.errors),Array.prototype.push.apply(s.warnings,this.warnings)):(s.errors=this.errors,s.warnings=this.warnings),this.prelude=[],this.errors=[],this.warnings=[]}streamInfo(){return{comment:vu(this.prelude).comment,directives:this.directives,errors:this.errors,warnings:this.warnings}}*compose(s,n=!1,i=-1){for(const r of s)yield*this.next(r);yield*this.end(n,i)}*next(s){switch(s.type){case"directive":this.directives.add(s.source,(n,i,r)=>{const a=Qi(s);a[0]+=n,this.onError(a,"BAD_DIRECTIVE",i,r)}),this.prelude.push(s.source),this.atDirectives=!0;break;case"document":{const n=Bk(this.options,this.directives,s,this.onError);this.atDirectives&&!n.directives.docStart&&this.onError(s,"MISSING_CHAR","Missing directives-end/doc-start indicator line"),this.decorate(n,!1),this.doc&&(yield this.doc),this.doc=n,this.atDirectives=!1;break}case"byte-order-mark":case"space":break;case"comment":case"newline":this.prelude.push(s.source);break;case"error":{const n=s.source?`${s.message}: ${JSON.stringify(s.source)}`:s.message,i=new bn(Qi(s),"UNEXPECTED_TOKEN",n);this.atDirectives||!this.doc?this.errors.push(i):this.doc.errors.push(i);break}case"doc-end":{if(!this.doc){const i="Unexpected doc-end without preceding document";this.errors.push(new bn(Qi(s),"UNEXPECTED_TOKEN",i));break}this.doc.directives.docEnd=!0;const n=Ur(s.end,s.offset+s.source.length,this.doc.options.strict,this.onError);if(this.decorate(this.doc,!0),n.comment){const i=this.doc.comment;this.doc.comment=i?`${i}
${n.comment}`:n.comment}this.doc.range[2]=n.offset;break}default:this.errors.push(new bn(Qi(s),"UNEXPECTED_TOKEN",`Unsupported token ${s.type}`))}}*end(s=!1,n=-1){if(this.doc)this.decorate(this.doc,!0),yield this.doc,this.doc=null;else if(s){const i=Object.assign({_directives:this.directives},this.options),r=new Li(void 0,i);this.atDirectives&&this.onError(n,"MISSING_CHAR","Missing directives-end indicator line"),r.range=[0,n,n],this.decorate(r,!1),yield r}}}function Uk(t,s=!0,n){if(t){const i=(r,a,o)=>{const l=typeof r=="number"?r:Array.isArray(r)?r[0]:r.offset;if(n)n(l,a,o);else throw new bn([l,l+1],a,o)};switch(t.type){case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return Rf(t,s,i);case"block-scalar":return Lf({options:{strict:s}},t,i)}}return null}function Vk(t,s){const{implicitKey:n=!1,indent:i,inFlow:r=!1,offset:a=-1,type:o="PLAIN"}=s,l=Fr({type:o,value:t},{implicitKey:n,indent:i>0?" ".repeat(i):"",inFlow:r,options:{blockQuote:!0,lineWidth:-1}}),c=s.end??[{type:"newline",offset:-1,indent:i,source:`
`}];switch(l[0]){case"|":case">":{const d=l.indexOf(`
`),u=l.substring(0,d),m=l.substring(d+1)+`
`,h=[{type:"block-scalar-header",offset:a,indent:i,source:u}];return Ff(h,c)||h.push({type:"newline",offset:-1,indent:i,source:`
`}),{type:"block-scalar",offset:a,indent:i,props:h,source:m}}case'"':return{type:"double-quoted-scalar",offset:a,indent:i,source:l,end:c};case"'":return{type:"single-quoted-scalar",offset:a,indent:i,source:l,end:c};default:return{type:"scalar",offset:a,indent:i,source:l,end:c}}}function Kk(t,s,n={}){let{afterKey:i=!1,implicitKey:r=!1,inFlow:a=!1,type:o}=n,l="indent"in t?t.indent:null;if(i&&typeof l=="number"&&(l+=2),!o)switch(t.type){case"single-quoted-scalar":o="QUOTE_SINGLE";break;case"double-quoted-scalar":o="QUOTE_DOUBLE";break;case"block-scalar":{const d=t.props[0];if(d.type!=="block-scalar-header")throw new Error("Invalid block scalar header");o=d.source[0]===">"?"BLOCK_FOLDED":"BLOCK_LITERAL";break}default:o="PLAIN"}const c=Fr({type:o,value:s},{implicitKey:r||l===null,indent:l!==null&&l>0?" ".repeat(l):"",inFlow:a,options:{blockQuote:!0,lineWidth:-1}});switch(c[0]){case"|":case">":Wk(t,c);break;case'"':tl(t,c,"double-quoted-scalar");break;case"'":tl(t,c,"single-quoted-scalar");break;default:tl(t,c,"scalar")}}function Wk(t,s){const n=s.indexOf(`
`),i=s.substring(0,n),r=s.substring(n+1)+`
`;if(t.type==="block-scalar"){const a=t.props[0];if(a.type!=="block-scalar-header")throw new Error("Invalid block scalar header");a.source=i,t.source=r}else{const{offset:a}=t,o="indent"in t?t.indent:-1,l=[{type:"block-scalar-header",offset:a,indent:o,source:i}];Ff(l,"end"in t?t.end:void 0)||l.push({type:"newline",offset:-1,indent:o,source:`
`});for(const c of Object.keys(t))c!=="type"&&c!=="offset"&&delete t[c];Object.assign(t,{type:"block-scalar",indent:o,props:l,source:r})}}function Ff(t,s){if(s)for(const n of s)switch(n.type){case"space":case"comment":t.push(n);break;case"newline":return t.push(n),!0}return!1}function tl(t,s,n){switch(t.type){case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":t.type=n,t.source=s;break;case"block-scalar":{const i=t.props.slice(1);let r=s.length;t.props[0].type==="block-scalar-header"&&(r-=t.props[0].source.length);for(const a of i)a.offset+=r;delete t.props,Object.assign(t,{type:n,source:s,end:i});break}case"block-map":case"block-seq":{const r={type:"newline",offset:t.offset+s.length,indent:t.indent,source:`
`};delete t.items,Object.assign(t,{type:n,source:s,end:[r]});break}default:{const i="indent"in t?t.indent:-1,r="end"in t&&Array.isArray(t.end)?t.end.filter(a=>a.type==="space"||a.type==="comment"||a.type==="newline"):[];for(const a of Object.keys(t))a!=="type"&&a!=="offset"&&delete t[a];Object.assign(t,{type:n,indent:i,source:s,end:r})}}}const Gk=t=>"type"in t?La(t):ya(t);function La(t){switch(t.type){case"block-scalar":{let s="";for(const n of t.props)s+=La(n);return s+t.source}case"block-map":case"block-seq":{let s="";for(const n of t.items)s+=ya(n);return s}case"flow-collection":{let s=t.start.source;for(const n of t.items)s+=ya(n);for(const n of t.end)s+=n.source;return s}case"document":{let s=ya(t);if(t.end)for(const n of t.end)s+=n.source;return s}default:{let s=t.source;if("end"in t&&t.end)for(const n of t.end)s+=n.source;return s}}}function ya({start:t,key:s,sep:n,value:i}){let r="";for(const a of t)r+=a.source;if(s&&(r+=La(s)),n)for(const a of n)r+=a.source;return i&&(r+=La(i)),r}const Il=Symbol("break visit"),Hk=Symbol("skip children"),Bf=Symbol("remove item");function Pn(t,s){"type"in t&&t.type==="document"&&(t={start:t.start,value:t.value}),Uf(Object.freeze([]),t,s)}Pn.BREAK=Il;Pn.SKIP=Hk;Pn.REMOVE=Bf;Pn.itemAtPath=(t,s)=>{let n=t;for(const[i,r]of s){const a=n?.[i];if(a&&"items"in a)n=a.items[r];else return}return n};Pn.parentCollection=(t,s)=>{const n=Pn.itemAtPath(t,s.slice(0,-1)),i=s[s.length-1][0],r=n?.[i];if(r&&"items"in r)return r;throw new Error("Parent collection not found")};function Uf(t,s,n){let i=n(s,t);if(typeof i=="symbol")return i;for(const r of["key","value"]){const a=s[r];if(a&&"items"in a){for(let o=0;o<a.items.length;++o){const l=Uf(Object.freeze(t.concat([[r,o]])),a.items[o],n);if(typeof l=="number")o=l-1;else{if(l===Il)return Il;l===Bf&&(a.items.splice(o,1),o-=1)}}typeof i=="function"&&r==="key"&&(i=i(s,t))}}return typeof i=="function"?i(s,t):i}const ko="\uFEFF",zo="",So="",Nr="",Qk=t=>!!t&&"items"in t,Zk=t=>!!t&&(t.type==="scalar"||t.type==="single-quoted-scalar"||t.type==="double-quoted-scalar"||t.type==="block-scalar");function Yk(t){switch(t){case ko:return"<BOM>";case zo:return"<DOC>";case So:return"<FLOW_END>";case Nr:return"<SCALAR>";default:return JSON.stringify(t)}}function Vf(t){switch(t){case ko:return"byte-order-mark";case zo:return"doc-mode";case So:return"flow-error-end";case Nr:return"scalar";case"---":return"doc-start";case"...":return"doc-end";case"":case`
`:case`\r
`:return"newline";case"-":return"seq-item-ind";case"?":return"explicit-key-ind";case":":return"map-value-ind";case"{":return"flow-map-start";case"}":return"flow-map-end";case"[":return"flow-seq-start";case"]":return"flow-seq-end";case",":return"comma"}switch(t[0]){case" ":case"	":return"space";case"#":return"comment";case"%":return"directive-line";case"*":return"alias";case"&":return"anchor";case"!":return"tag";case"'":return"single-quoted-scalar";case'"':return"double-quoted-scalar";case"|":case">":return"block-scalar-header"}return null}const Jk=Object.freeze(Object.defineProperty({__proto__:null,BOM:ko,DOCUMENT:zo,FLOW_END:So,SCALAR:Nr,createScalarToken:Vk,isCollection:Qk,isScalar:Zk,prettyToken:Yk,resolveAsScalar:Uk,setScalarValue:Kk,stringify:Gk,tokenType:Vf,visit:Pn},Symbol.toStringTag,{value:"Module"}));function ns(t){switch(t){case void 0:case" ":case`
`:case"\r":case"	":return!0;default:return!1}}const Nu=new Set("0123456789ABCDEFabcdef"),Xk=new Set("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-#;/?:@&=+$_.!~*'()"),oa=new Set(",[]{}"),ez=new Set(` ,[]{}
\r	`),sl=t=>!t||ez.has(t);class Kf{constructor(){this.atEnd=!1,this.blockScalarIndent=-1,this.blockScalarKeep=!1,this.buffer="",this.flowKey=!1,this.flowLevel=0,this.indentNext=0,this.indentValue=0,this.lineEndPos=null,this.next=null,this.pos=0}*lex(s,n=!1){if(s){if(typeof s!="string")throw TypeError("source is not a string");this.buffer=this.buffer?this.buffer+s:s,this.lineEndPos=null}this.atEnd=!n;let i=this.next??"stream";for(;i&&(n||this.hasChars(1));)i=yield*this.parseNext(i)}atLineEnd(){let s=this.pos,n=this.buffer[s];for(;n===" "||n==="	";)n=this.buffer[++s];return!n||n==="#"||n===`
`?!0:n==="\r"?this.buffer[s+1]===`
`:!1}charAt(s){return this.buffer[this.pos+s]}continueScalar(s){let n=this.buffer[s];if(this.indentNext>0){let i=0;for(;n===" ";)n=this.buffer[++i+s];if(n==="\r"){const r=this.buffer[i+s+1];if(r===`
`||!r&&!this.atEnd)return s+i+1}return n===`
`||i>=this.indentNext||!n&&!this.atEnd?s+i:-1}if(n==="-"||n==="."){const i=this.buffer.substr(s,3);if((i==="---"||i==="...")&&ns(this.buffer[s+3]))return-1}return s}getLine(){let s=this.lineEndPos;return(typeof s!="number"||s!==-1&&s<this.pos)&&(s=this.buffer.indexOf(`
`,this.pos),this.lineEndPos=s),s===-1?this.atEnd?this.buffer.substring(this.pos):null:(this.buffer[s-1]==="\r"&&(s-=1),this.buffer.substring(this.pos,s))}hasChars(s){return this.pos+s<=this.buffer.length}setNext(s){return this.buffer=this.buffer.substring(this.pos),this.pos=0,this.lineEndPos=null,this.next=s,null}peek(s){return this.buffer.substr(this.pos,s)}*parseNext(s){switch(s){case"stream":return yield*this.parseStream();case"line-start":return yield*this.parseLineStart();case"block-start":return yield*this.parseBlockStart();case"doc":return yield*this.parseDocument();case"flow":return yield*this.parseFlowCollection();case"quoted-scalar":return yield*this.parseQuotedScalar();case"block-scalar":return yield*this.parseBlockScalar();case"plain-scalar":return yield*this.parsePlainScalar()}}*parseStream(){let s=this.getLine();if(s===null)return this.setNext("stream");if(s[0]===ko&&(yield*this.pushCount(1),s=s.substring(1)),s[0]==="%"){let n=s.length,i=s.indexOf("#");for(;i!==-1;){const a=s[i-1];if(a===" "||a==="	"){n=i-1;break}else i=s.indexOf("#",i+1)}for(;;){const a=s[n-1];if(a===" "||a==="	")n-=1;else break}const r=(yield*this.pushCount(n))+(yield*this.pushSpaces(!0));return yield*this.pushCount(s.length-r),this.pushNewline(),"stream"}if(this.atLineEnd()){const n=yield*this.pushSpaces(!0);return yield*this.pushCount(s.length-n),yield*this.pushNewline(),"stream"}return yield zo,yield*this.parseLineStart()}*parseLineStart(){const s=this.charAt(0);if(!s&&!this.atEnd)return this.setNext("line-start");if(s==="-"||s==="."){if(!this.atEnd&&!this.hasChars(4))return this.setNext("line-start");const n=this.peek(3);if((n==="---"||n==="...")&&ns(this.charAt(3)))return yield*this.pushCount(3),this.indentValue=0,this.indentNext=0,n==="---"?"doc":"stream"}return this.indentValue=yield*this.pushSpaces(!1),this.indentNext>this.indentValue&&!ns(this.charAt(1))&&(this.indentNext=this.indentValue),yield*this.parseBlockStart()}*parseBlockStart(){const[s,n]=this.peek(2);if(!n&&!this.atEnd)return this.setNext("block-start");if((s==="-"||s==="?"||s===":")&&ns(n)){const i=(yield*this.pushCount(1))+(yield*this.pushSpaces(!0));return this.indentNext=this.indentValue+1,this.indentValue+=i,yield*this.parseBlockStart()}return"doc"}*parseDocument(){yield*this.pushSpaces(!0);const s=this.getLine();if(s===null)return this.setNext("doc");let n=yield*this.pushIndicators();switch(s[n]){case"#":yield*this.pushCount(s.length-n);case void 0:return yield*this.pushNewline(),yield*this.parseLineStart();case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel=1,"flow";case"}":case"]":return yield*this.pushCount(1),"doc";case"*":return yield*this.pushUntil(sl),"doc";case'"':case"'":return yield*this.parseQuotedScalar();case"|":case">":return n+=yield*this.parseBlockScalarHeader(),n+=yield*this.pushSpaces(!0),yield*this.pushCount(s.length-n),yield*this.pushNewline(),yield*this.parseBlockScalar();default:return yield*this.parsePlainScalar()}}*parseFlowCollection(){let s,n,i=-1;do s=yield*this.pushNewline(),s>0?(n=yield*this.pushSpaces(!1),this.indentValue=i=n):n=0,n+=yield*this.pushSpaces(!0);while(s+n>0);const r=this.getLine();if(r===null)return this.setNext("flow");if((i!==-1&&i<this.indentNext&&r[0]!=="#"||i===0&&(r.startsWith("---")||r.startsWith("..."))&&ns(r[3]))&&!(i===this.indentNext-1&&this.flowLevel===1&&(r[0]==="]"||r[0]==="}")))return this.flowLevel=0,yield So,yield*this.parseLineStart();let a=0;for(;r[a]===",";)a+=yield*this.pushCount(1),a+=yield*this.pushSpaces(!0),this.flowKey=!1;switch(a+=yield*this.pushIndicators(),r[a]){case void 0:return"flow";case"#":return yield*this.pushCount(r.length-a),"flow";case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel+=1,"flow";case"}":case"]":return yield*this.pushCount(1),this.flowKey=!0,this.flowLevel-=1,this.flowLevel?"flow":"doc";case"*":return yield*this.pushUntil(sl),"flow";case'"':case"'":return this.flowKey=!0,yield*this.parseQuotedScalar();case":":{const o=this.charAt(1);if(this.flowKey||ns(o)||o===",")return this.flowKey=!1,yield*this.pushCount(1),yield*this.pushSpaces(!0),"flow"}default:return this.flowKey=!1,yield*this.parsePlainScalar()}}*parseQuotedScalar(){const s=this.charAt(0);let n=this.buffer.indexOf(s,this.pos+1);if(s==="'")for(;n!==-1&&this.buffer[n+1]==="'";)n=this.buffer.indexOf("'",n+2);else for(;n!==-1;){let a=0;for(;this.buffer[n-1-a]==="\\";)a+=1;if(a%2===0)break;n=this.buffer.indexOf('"',n+1)}const i=this.buffer.substring(0,n);let r=i.indexOf(`
`,this.pos);if(r!==-1){for(;r!==-1;){const a=this.continueScalar(r+1);if(a===-1)break;r=i.indexOf(`
`,a)}r!==-1&&(n=r-(i[r-1]==="\r"?2:1))}if(n===-1){if(!this.atEnd)return this.setNext("quoted-scalar");n=this.buffer.length}return yield*this.pushToIndex(n+1,!1),this.flowLevel?"flow":"doc"}*parseBlockScalarHeader(){this.blockScalarIndent=-1,this.blockScalarKeep=!1;let s=this.pos;for(;;){const n=this.buffer[++s];if(n==="+")this.blockScalarKeep=!0;else if(n>"0"&&n<="9")this.blockScalarIndent=Number(n)-1;else if(n!=="-")break}return yield*this.pushUntil(n=>ns(n)||n==="#")}*parseBlockScalar(){let s=this.pos-1,n=0,i;e:for(let a=this.pos;i=this.buffer[a];++a)switch(i){case" ":n+=1;break;case`
`:s=a,n=0;break;case"\r":{const o=this.buffer[a+1];if(!o&&!this.atEnd)return this.setNext("block-scalar");if(o===`
`)break}default:break e}if(!i&&!this.atEnd)return this.setNext("block-scalar");if(n>=this.indentNext){this.blockScalarIndent===-1?this.indentNext=n:this.indentNext=this.blockScalarIndent+(this.indentNext===0?1:this.indentNext);do{const a=this.continueScalar(s+1);if(a===-1)break;s=this.buffer.indexOf(`
`,a)}while(s!==-1);if(s===-1){if(!this.atEnd)return this.setNext("block-scalar");s=this.buffer.length}}let r=s+1;for(i=this.buffer[r];i===" ";)i=this.buffer[++r];if(i==="	"){for(;i==="	"||i===" "||i==="\r"||i===`
`;)i=this.buffer[++r];s=r-1}else if(!this.blockScalarKeep)do{let a=s-1,o=this.buffer[a];o==="\r"&&(o=this.buffer[--a]);const l=a;for(;o===" ";)o=this.buffer[--a];if(o===`
`&&a>=this.pos&&a+1+n>l)s=a;else break}while(!0);return yield Nr,yield*this.pushToIndex(s+1,!0),yield*this.parseLineStart()}*parsePlainScalar(){const s=this.flowLevel>0;let n=this.pos-1,i=this.pos-1,r;for(;r=this.buffer[++i];)if(r===":"){const a=this.buffer[i+1];if(ns(a)||s&&oa.has(a))break;n=i}else if(ns(r)){let a=this.buffer[i+1];if(r==="\r"&&(a===`
`?(i+=1,r=`
`,a=this.buffer[i+1]):n=i),a==="#"||s&&oa.has(a))break;if(r===`
`){const o=this.continueScalar(i+1);if(o===-1)break;i=Math.max(i,o-2)}}else{if(s&&oa.has(r))break;n=i}return!r&&!this.atEnd?this.setNext("plain-scalar"):(yield Nr,yield*this.pushToIndex(n+1,!0),s?"flow":"doc")}*pushCount(s){return s>0?(yield this.buffer.substr(this.pos,s),this.pos+=s,s):0}*pushToIndex(s,n){const i=this.buffer.slice(this.pos,s);return i?(yield i,this.pos+=i.length,i.length):(n&&(yield""),0)}*pushIndicators(){switch(this.charAt(0)){case"!":return(yield*this.pushTag())+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"&":return(yield*this.pushUntil(sl))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"-":case"?":case":":{const s=this.flowLevel>0,n=this.charAt(1);if(ns(n)||s&&oa.has(n))return s?this.flowKey&&(this.flowKey=!1):this.indentNext=this.indentValue+1,(yield*this.pushCount(1))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators())}}return 0}*pushTag(){if(this.charAt(1)==="<"){let s=this.pos+2,n=this.buffer[s];for(;!ns(n)&&n!==">";)n=this.buffer[++s];return yield*this.pushToIndex(n===">"?s+1:s,!1)}else{let s=this.pos+1,n=this.buffer[s];for(;n;)if(Xk.has(n))n=this.buffer[++s];else if(n==="%"&&Nu.has(this.buffer[s+1])&&Nu.has(this.buffer[s+2]))n=this.buffer[s+=3];else break;return yield*this.pushToIndex(s,!1)}}*pushNewline(){const s=this.buffer[this.pos];return s===`
`?yield*this.pushCount(1):s==="\r"&&this.charAt(1)===`
`?yield*this.pushCount(2):0}*pushSpaces(s){let n=this.pos-1,i;do i=this.buffer[++n];while(i===" "||s&&i==="	");const r=n-this.pos;return r>0&&(yield this.buffer.substr(this.pos,r),this.pos=n),r}*pushUntil(s){let n=this.pos,i=this.buffer[n];for(;!s(i);)i=this.buffer[++n];return yield*this.pushToIndex(n,!1)}}class Wf{constructor(){this.lineStarts=[],this.addNewLine=s=>this.lineStarts.push(s),this.linePos=s=>{let n=0,i=this.lineStarts.length;for(;n<i;){const a=n+i>>1;this.lineStarts[a]<s?n=a+1:i=a}if(this.lineStarts[n]===s)return{line:n+1,col:1};if(n===0)return{line:0,col:s};const r=this.lineStarts[n-1];return{line:n,col:s-r+1}}}}function Qs(t,s){for(let n=0;n<t.length;++n)if(t[n].type===s)return!0;return!1}function ku(t){for(let s=0;s<t.length;++s)switch(t[s].type){case"space":case"comment":case"newline":break;default:return s}return-1}function Gf(t){switch(t?.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"flow-collection":return!0;default:return!1}}function la(t){switch(t.type){case"document":return t.start;case"block-map":{const s=t.items[t.items.length-1];return s.sep??s.start}case"block-seq":return t.items[t.items.length-1].start;default:return[]}}function Zn(t){if(t.length===0)return[];let s=t.length;e:for(;--s>=0;)switch(t[s].type){case"doc-start":case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":case"newline":break e}for(;t[++s]?.type==="space";);return t.splice(s,t.length)}function zu(t){if(t.start.type==="flow-seq-start")for(const s of t.items)s.sep&&!s.value&&!Qs(s.start,"explicit-key-ind")&&!Qs(s.sep,"map-value-ind")&&(s.key&&(s.value=s.key),delete s.key,Gf(s.value)?s.value.end?Array.prototype.push.apply(s.value.end,s.sep):s.value.end=s.sep:Array.prototype.push.apply(s.start,s.sep),delete s.sep)}class qc{constructor(s){this.atNewLine=!0,this.atScalar=!1,this.indent=0,this.offset=0,this.onKeyLine=!1,this.stack=[],this.source="",this.type="",this.lexer=new Kf,this.onNewLine=s}*parse(s,n=!1){this.onNewLine&&this.offset===0&&this.onNewLine(0);for(const i of this.lexer.lex(s,n))yield*this.next(i);n||(yield*this.end())}*next(s){if(this.source=s,this.atScalar){this.atScalar=!1,yield*this.step(),this.offset+=s.length;return}const n=Vf(s);if(n)if(n==="scalar")this.atNewLine=!1,this.atScalar=!0,this.type="scalar";else{switch(this.type=n,yield*this.step(),n){case"newline":this.atNewLine=!0,this.indent=0,this.onNewLine&&this.onNewLine(this.offset+s.length);break;case"space":this.atNewLine&&s[0]===" "&&(this.indent+=s.length);break;case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":this.atNewLine&&(this.indent+=s.length);break;case"doc-mode":case"flow-error-end":return;default:this.atNewLine=!1}this.offset+=s.length}else{const i=`Not a YAML token: ${s}`;yield*this.pop({type:"error",offset:this.offset,message:i,source:s}),this.offset+=s.length}}*end(){for(;this.stack.length>0;)yield*this.pop()}get sourceToken(){return{type:this.type,offset:this.offset,indent:this.indent,source:this.source}}*step(){const s=this.peek(1);if(this.type==="doc-end"&&(!s||s.type!=="doc-end")){for(;this.stack.length>0;)yield*this.pop();this.stack.push({type:"doc-end",offset:this.offset,source:this.source});return}if(!s)return yield*this.stream();switch(s.type){case"document":return yield*this.document(s);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return yield*this.scalar(s);case"block-scalar":return yield*this.blockScalar(s);case"block-map":return yield*this.blockMap(s);case"block-seq":return yield*this.blockSequence(s);case"flow-collection":return yield*this.flowCollection(s);case"doc-end":return yield*this.documentEnd(s)}yield*this.pop()}peek(s){return this.stack[this.stack.length-s]}*pop(s){const n=s??this.stack.pop();if(!n)yield{type:"error",offset:this.offset,source:"",message:"Tried to pop an empty stack"};else if(this.stack.length===0)yield n;else{const i=this.peek(1);switch(n.type==="block-scalar"?n.indent="indent"in i?i.indent:0:n.type==="flow-collection"&&i.type==="document"&&(n.indent=0),n.type==="flow-collection"&&zu(n),i.type){case"document":i.value=n;break;case"block-scalar":i.props.push(n);break;case"block-map":{const r=i.items[i.items.length-1];if(r.value){i.items.push({start:[],key:n,sep:[]}),this.onKeyLine=!0;return}else if(r.sep)r.value=n;else{Object.assign(r,{key:n,sep:[]}),this.onKeyLine=!r.explicitKey;return}break}case"block-seq":{const r=i.items[i.items.length-1];r.value?i.items.push({start:[],value:n}):r.value=n;break}case"flow-collection":{const r=i.items[i.items.length-1];!r||r.value?i.items.push({start:[],key:n,sep:[]}):r.sep?r.value=n:Object.assign(r,{key:n,sep:[]});return}default:yield*this.pop(),yield*this.pop(n)}if((i.type==="document"||i.type==="block-map"||i.type==="block-seq")&&(n.type==="block-map"||n.type==="block-seq")){const r=n.items[n.items.length-1];r&&!r.sep&&!r.value&&r.start.length>0&&ku(r.start)===-1&&(n.indent===0||r.start.every(a=>a.type!=="comment"||a.indent<n.indent))&&(i.type==="document"?i.end=r.start:i.items.push({start:r.start}),n.items.splice(-1,1))}}}*stream(){switch(this.type){case"directive-line":yield{type:"directive",offset:this.offset,source:this.source};return;case"byte-order-mark":case"space":case"comment":case"newline":yield this.sourceToken;return;case"doc-mode":case"doc-start":{const s={type:"document",offset:this.offset,start:[]};this.type==="doc-start"&&s.start.push(this.sourceToken),this.stack.push(s);return}}yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML stream`,source:this.source}}*document(s){if(s.value)return yield*this.lineEnd(s);switch(this.type){case"doc-start":{ku(s.start)!==-1?(yield*this.pop(),yield*this.step()):s.start.push(this.sourceToken);return}case"anchor":case"tag":case"space":case"comment":case"newline":s.start.push(this.sourceToken);return}const n=this.startBlockValue(s);n?this.stack.push(n):yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML document`,source:this.source}}*scalar(s){if(this.type==="map-value-ind"){const n=la(this.peek(2)),i=Zn(n);let r;s.end?(r=s.end,r.push(this.sourceToken),delete s.end):r=[this.sourceToken];const a={type:"block-map",offset:s.offset,indent:s.indent,items:[{start:i,key:s,sep:r}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=a}else yield*this.lineEnd(s)}*blockScalar(s){switch(this.type){case"space":case"comment":case"newline":s.props.push(this.sourceToken);return;case"scalar":if(s.source=this.source,this.atNewLine=!0,this.indent=0,this.onNewLine){let n=this.source.indexOf(`
`)+1;for(;n!==0;)this.onNewLine(this.offset+n),n=this.source.indexOf(`
`,n)+1}yield*this.pop();break;default:yield*this.pop(),yield*this.step()}}*blockMap(s){const n=s.items[s.items.length-1];switch(this.type){case"newline":if(this.onKeyLine=!1,n.value){const i="end"in n.value?n.value.end:void 0;(Array.isArray(i)?i[i.length-1]:void 0)?.type==="comment"?i?.push(this.sourceToken):s.items.push({start:[this.sourceToken]})}else n.sep?n.sep.push(this.sourceToken):n.start.push(this.sourceToken);return;case"space":case"comment":if(n.value)s.items.push({start:[this.sourceToken]});else if(n.sep)n.sep.push(this.sourceToken);else{if(this.atIndentedComment(n.start,s.indent)){const r=s.items[s.items.length-2]?.value?.end;if(Array.isArray(r)){Array.prototype.push.apply(r,n.start),r.push(this.sourceToken),s.items.pop();return}}n.start.push(this.sourceToken)}return}if(this.indent>=s.indent){const i=!this.onKeyLine&&this.indent===s.indent,r=i&&(n.sep||n.explicitKey)&&this.type!=="seq-item-ind";let a=[];if(r&&n.sep&&!n.value){const o=[];for(let l=0;l<n.sep.length;++l){const c=n.sep[l];switch(c.type){case"newline":o.push(l);break;case"space":break;case"comment":c.indent>s.indent&&(o.length=0);break;default:o.length=0}}o.length>=2&&(a=n.sep.splice(o[1]))}switch(this.type){case"anchor":case"tag":r||n.value?(a.push(this.sourceToken),s.items.push({start:a}),this.onKeyLine=!0):n.sep?n.sep.push(this.sourceToken):n.start.push(this.sourceToken);return;case"explicit-key-ind":!n.sep&&!n.explicitKey?(n.start.push(this.sourceToken),n.explicitKey=!0):r||n.value?(a.push(this.sourceToken),s.items.push({start:a,explicitKey:!0})):this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken],explicitKey:!0}]}),this.onKeyLine=!0;return;case"map-value-ind":if(n.explicitKey)if(n.sep)if(n.value)s.items.push({start:[],key:null,sep:[this.sourceToken]});else if(Qs(n.sep,"map-value-ind"))this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:a,key:null,sep:[this.sourceToken]}]});else if(Gf(n.key)&&!Qs(n.sep,"newline")){const o=Zn(n.start),l=n.key,c=n.sep;c.push(this.sourceToken),delete n.key,delete n.sep,this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:o,key:l,sep:c}]})}else a.length>0?n.sep=n.sep.concat(a,this.sourceToken):n.sep.push(this.sourceToken);else if(Qs(n.start,"newline"))Object.assign(n,{key:null,sep:[this.sourceToken]});else{const o=Zn(n.start);this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:o,key:null,sep:[this.sourceToken]}]})}else n.sep?n.value||r?s.items.push({start:a,key:null,sep:[this.sourceToken]}):Qs(n.sep,"map-value-ind")?this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[],key:null,sep:[this.sourceToken]}]}):n.sep.push(this.sourceToken):Object.assign(n,{key:null,sep:[this.sourceToken]});this.onKeyLine=!0;return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const o=this.flowScalar(this.type);r||n.value?(s.items.push({start:a,key:o,sep:[]}),this.onKeyLine=!0):n.sep?this.stack.push(o):(Object.assign(n,{key:o,sep:[]}),this.onKeyLine=!0);return}default:{const o=this.startBlockValue(s);if(o){if(o.type==="block-seq"){if(!n.explicitKey&&n.sep&&!Qs(n.sep,"newline")){yield*this.pop({type:"error",offset:this.offset,message:"Unexpected block-seq-ind on same line with key",source:this.source});return}}else i&&s.items.push({start:a});this.stack.push(o);return}}}}yield*this.pop(),yield*this.step()}*blockSequence(s){const n=s.items[s.items.length-1];switch(this.type){case"newline":if(n.value){const i="end"in n.value?n.value.end:void 0;(Array.isArray(i)?i[i.length-1]:void 0)?.type==="comment"?i?.push(this.sourceToken):s.items.push({start:[this.sourceToken]})}else n.start.push(this.sourceToken);return;case"space":case"comment":if(n.value)s.items.push({start:[this.sourceToken]});else{if(this.atIndentedComment(n.start,s.indent)){const r=s.items[s.items.length-2]?.value?.end;if(Array.isArray(r)){Array.prototype.push.apply(r,n.start),r.push(this.sourceToken),s.items.pop();return}}n.start.push(this.sourceToken)}return;case"anchor":case"tag":if(n.value||this.indent<=s.indent)break;n.start.push(this.sourceToken);return;case"seq-item-ind":if(this.indent!==s.indent)break;n.value||Qs(n.start,"seq-item-ind")?s.items.push({start:[this.sourceToken]}):n.start.push(this.sourceToken);return}if(this.indent>s.indent){const i=this.startBlockValue(s);if(i){this.stack.push(i);return}}yield*this.pop(),yield*this.step()}*flowCollection(s){const n=s.items[s.items.length-1];if(this.type==="flow-error-end"){let i;do yield*this.pop(),i=this.peek(1);while(i&&i.type==="flow-collection")}else if(s.end.length===0){switch(this.type){case"comma":case"explicit-key-ind":!n||n.sep?s.items.push({start:[this.sourceToken]}):n.start.push(this.sourceToken);return;case"map-value-ind":!n||n.value?s.items.push({start:[],key:null,sep:[this.sourceToken]}):n.sep?n.sep.push(this.sourceToken):Object.assign(n,{key:null,sep:[this.sourceToken]});return;case"space":case"comment":case"newline":case"anchor":case"tag":!n||n.value?s.items.push({start:[this.sourceToken]}):n.sep?n.sep.push(this.sourceToken):n.start.push(this.sourceToken);return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const r=this.flowScalar(this.type);!n||n.value?s.items.push({start:[],key:r,sep:[]}):n.sep?this.stack.push(r):Object.assign(n,{key:r,sep:[]});return}case"flow-map-end":case"flow-seq-end":s.end.push(this.sourceToken);return}const i=this.startBlockValue(s);i?this.stack.push(i):(yield*this.pop(),yield*this.step())}else{const i=this.peek(2);if(i.type==="block-map"&&(this.type==="map-value-ind"&&i.indent===s.indent||this.type==="newline"&&!i.items[i.items.length-1].sep))yield*this.pop(),yield*this.step();else if(this.type==="map-value-ind"&&i.type!=="flow-collection"){const r=la(i),a=Zn(r);zu(s);const o=s.end.splice(1,s.end.length);o.push(this.sourceToken);const l={type:"block-map",offset:s.offset,indent:s.indent,items:[{start:a,key:s,sep:o}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=l}else yield*this.lineEnd(s)}}flowScalar(s){if(this.onNewLine){let n=this.source.indexOf(`
`)+1;for(;n!==0;)this.onNewLine(this.offset+n),n=this.source.indexOf(`
`,n)+1}return{type:s,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(s){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken],source:""};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":{this.onKeyLine=!0;const n=la(s),i=Zn(n);return i.push(this.sourceToken),{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:i,explicitKey:!0}]}}case"map-value-ind":{this.onKeyLine=!0;const n=la(s),i=Zn(n);return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:i,key:null,sep:[this.sourceToken]}]}}}return null}atIndentedComment(s,n){return this.type!=="comment"||this.indent<=n?!1:s.every(i=>i.type==="newline"||i.type==="space")}*documentEnd(s){this.type!=="doc-mode"&&(s.end?s.end.push(this.sourceToken):s.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop()))}*lineEnd(s){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":yield*this.pop(),yield*this.step();break;case"newline":this.onKeyLine=!1;case"space":case"comment":default:s.end?s.end.push(this.sourceToken):s.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop())}}}function Hf(t){const s=t.prettyErrors!==!1;return{lineCounter:t.lineCounter||s&&new Wf||null,prettyErrors:s}}function tz(t,s={}){const{lineCounter:n,prettyErrors:i}=Hf(s),r=new qc(n?.addNewLine),a=new $c(s),o=Array.from(a.compose(r.parse(t)));if(i&&n)for(const l of o)l.errors.forEach(Ea(t,n)),l.warnings.forEach(Ea(t,n));return o.length>0?o:Object.assign([],{empty:!0},a.streamInfo())}function Qf(t,s={}){const{lineCounter:n,prettyErrors:i}=Hf(s),r=new qc(n?.addNewLine),a=new $c(s);let o=null;for(const l of a.compose(r.parse(t),!0,t.length))if(!o)o=l;else if(o.options.logLevel!=="silent"){o.errors.push(new bn(l.range.slice(0,2),"MULTIPLE_DOCS","Source contains multiple documents; please use YAML.parseAllDocuments()"));break}return i&&n&&(o.errors.forEach(Ea(t,n)),o.warnings.forEach(Ea(t,n))),o}function sz(t,s,n){let i;typeof s=="function"?i=s:n===void 0&&s&&typeof s=="object"&&(n=s);const r=Qf(t,n);if(!r)return null;if(r.warnings.forEach(a=>ff(r.options.logLevel,a)),r.errors.length>0){if(r.options.logLevel!=="silent")throw r.errors[0];r.errors=[]}return r.toJS(Object.assign({reviver:i},n))}function nz(t,s,n){let i=null;if(typeof s=="function"||Array.isArray(s)?i=s:n===void 0&&s&&(n=s),typeof n=="string"&&(n=n.length),typeof n=="number"){const r=Math.round(n);n=r<1?void 0:r>8?{indent:8}:{indent:r}}if(t===void 0){const{keepUndefined:r}=n??s??{};if(!r)return}return On(t)&&!i?t.toString(n):new Li(t,i,n).toString(n)}const Zf=Object.freeze(Object.defineProperty({__proto__:null,Alias:po,CST:Jk,Composer:$c,Document:Li,Lexer:Kf,LineCounter:Wf,Pair:ht,Parser:qc,Scalar:ae,Schema:No,YAMLError:Rc,YAMLMap:Ot,YAMLParseError:bn,YAMLSeq:rn,YAMLWarning:If,isAlias:un,isCollection:Ie,isDocument:On,isMap:Di,isNode:Oe,isPair:Me,isScalar:ke,isSeq:Mi,parse:sz,parseAllDocuments:tz,parseDocument:Qf,stringify:nz,visit:$n,visitAsync:ho},Symbol.toStringTag,{value:"Module"})),iz={type:"object",properties:{question:{type:"string",required:!0},options:{type:"array",items:{type:"string"},minItems:4,maxItems:4,required:!0},answerIndex:{type:"number",minimum:0,maximum:3,required:!0},explanation:{type:"string"}}};function rz(){const t=le(),{mutate:s}=En(),[n,i]=f.useState(null),[r,a]=f.useState(null),[o,l]=f.useState(null),[c,d]=f.useState({}),[u,m]=f.useState({activityId:null,sectionId:null}),[h,p]=f.useState(null),[j,y]=f.useState({open:!1,activity:null}),[x,g]=f.useState({open:!1,quiz:null,activityId:null,sectionId:null,sectionTitle:null,sectionContent:null}),{data:b}=Q({resource:"topics",filters:n?[{field:"course_id",operator:"eq",value:n}]:[],sorters:[{field:"position",order:"asc"}],pagination:{pageSize:500},queryOptions:{enabled:!!n}}),{data:v,refetch:C}=Q({resource:"activities",filters:r?[{field:"topic_id",operator:"eq",value:r},{field:"type",operator:"eq",value:"material"}]:[],sorters:[{field:"position",order:"asc"}],pagination:{pageSize:100},meta:{select:"*, topics(title, position, courses(title))"},queryOptions:{enabled:!!r}}),T=k=>k.split(/\n(?=##\s+)/g).map((A,D)=>{const R=A.match(/^##\s+(.+?)$/m),L=R?R[1].trim():`Sekcja ${D+1}`,F=A.replace(/^##\s+.+?\n/,"").trim(),K=L.toLowerCase().replace(/[^\p{Letter}\p{Number}]+/gu,"-").replace(/(^-|-$)/g,"")||`section-${D}`,q=/```quiz[\s\S]*?```/g.test(F);return{id:K,title:L,content:F,hasQuiz:q}}),z=k=>{const _=k.match(/```quiz\s*?\n([\s\S]*?)```/);if(!_)return null;try{const A=_[1],D=Zf.parse(A);if(D.question&&Array.isArray(D.options)&&typeof D.answerIndex=="number")return D}catch(A){console.error("Failed to parse quiz:",A)}return null},N=(k,_)=>{d(A=>({...A,[k]:A[k]===_?null:_}))},S=async(k,_,A,D)=>{m({activityId:k.id,sectionId:_});try{const R=`
Jesteś ekspertem od tworzenia pytań kontrolnych do materiałów edukacyjnych.

KONTEKST LEKCJI:
- Tytuł materiału: ${k.title}
- Kurs: ${k.topics?.courses?.title||"Kurs"}
- Temat: ${k.topics?.title||"Temat"}

SEKCJA DO KTÓREJ TWORZYSZ PYTANIE:
- Tytuł sekcji: ${A}
- Treść sekcji:
"""
${D}
"""

WYTYCZNE:
1. Pytanie MUSI sprawdzać zrozumienie KLUCZOWEGO konceptu z tej konkretnej sekcji
2. Pytanie powinno być jasne i jednoznaczne
3. Opcje odpowiedzi powinny być wiarygodne (dystraktory podobne do poprawnej odpowiedzi)
4. Poziom trudności: średni (nie za łatwe, nie za trudne)
5. Unikaj pytań typu "wszystkie powyższe" lub "żadne z powyższych"
6. Pytanie powinno testować ZROZUMIENIE, nie pamięć faktów
7. Język pytania dopasuj do wieku uczniów (liceum/technikum)

WAŻNE:
- answerIndex to indeks poprawnej odpowiedzi (0-3)
- options to dokładnie 4 opcje odpowiedzi
- explanation to krótkie wyjaśnienie dlaczego ta odpowiedź jest poprawna

Wygeneruj jedno pytanie kontrolne w formacie JSON.
      `.trim(),L=await Rn(R,iz);if(L&&L.question&&L.options&&typeof L.answerIndex=="number")g({open:!0,quiz:{question:L.question,options:L.options,answerIndex:L.answerIndex},activityId:k.id,sectionId:_,sectionTitle:A,sectionContent:D});else throw new Error("Nieprawidłowa struktura wygenerowanego pytania")}catch(R){console.error("Error generating quiz:",R),W.error("Nie udało się wygenerować pytania")}finally{m({activityId:null,sectionId:null})}},P=async()=>{if(!(!x.quiz||!x.activityId||!x.sectionId)){p(x.activityId);try{const k=v?.data?.find(F=>F.id===x.activityId);if(!k)throw new Error("Nie znaleziono aktywności");const A=T(k.content).findIndex(F=>F.id===x.sectionId);if(A===-1)throw new Error("Nie znaleziono sekcji");const D=`\`\`\`quiz
question: "${x.quiz.question}"
options:
${x.quiz.options.map(F=>`  - "${F}"`).join(`
`)}
answerIndex: ${x.quiz.answerIndex}
\`\`\``;let R=k.content;const L=R.split(/\n(?=##\s+)/g);L[A]&&(L[A]=L[A].replace(/```quiz[\s\S]*?```/g,""),L[A]=L[A].trim()+`

`+D),R=L.join(`
`),await new Promise((F,K)=>{s({resource:"activities",id:x.activityId.toString(),values:{content:R}},{onSuccess:()=>{W.success("Pytanie kontrolne zostało dodane!"),g({open:!1,quiz:null,activityId:null,sectionId:null,sectionTitle:null,sectionContent:null}),C(),F()},onError:q=>{console.error("Error updating activity:",q),K(q)}})})}catch(k){console.error("Error saving quiz:",k),W.error("Nie udało się zapisać pytania")}finally{p(null)}}},w=k=>{y({open:!0,activity:k})};return e.jsxs(Z,{children:[e.jsx(me,{title:"Krok 4 (opcjonalny)",description:"Dodaj pytania kontrolne do wygenerowanych materiałów"}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[300px,1fr]",children:[e.jsxs(I,{className:"h-fit",children:[e.jsx(O,{children:e.jsx($,{className:"text-base",children:"Wybór materiałów"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsx(Pp,{value:n,onChange:k=>{i(k),a(null),l(null),d({})},label:"Kurs",showAlert:!1}),n&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium mb-1 block",children:"Temat"}),e.jsxs("select",{value:r||"",onChange:k=>{a(k.target.value?Number(k.target.value):null),l(null),d({})},className:"w-full rounded-md border px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Wybierz temat"}),(b?.data||[]).map(k=>e.jsxs("option",{value:k.id,children:[k.position,". ",k.title]},k.id))]})]}),r&&v?.data&&e.jsxs(he,{children:[e.jsx(kt,{className:"h-4 w-4"}),e.jsxs(pe,{className:"text-xs",children:["Znaleziono ",e.jsx("strong",{children:v.data.length})," materiałów"]})]}),e.jsx(M,{variant:"outline",onClick:()=>t("/admin/educational-material"),className:"w-full",size:"sm",children:"Powrót do panelu"})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-5 h-5"}),"Materiały do uzupełnienia"]})}),e.jsx(E,{children:r?v?.data?.length?e.jsx("div",{className:"space-y-4",children:v.data.map(k=>{const _=T(k.content),A=_.filter(R=>R.hasQuiz).length,D=o===k.id;return e.jsxs("div",{className:"rounded-lg border overflow-hidden",children:[e.jsx("button",{onClick:()=>l(D?null:k.id),className:"w-full p-4 text-left hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:k.title}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[_.length," sekcji"]}),A>0&&e.jsxs(B,{variant:"secondary",className:"text-xs",children:[e.jsx(Be,{className:"w-3 h-3 mr-1"}),A," ",A===1?"pytanie":"pytań"]}),k.is_published&&e.jsxs(B,{variant:"default",className:"text-xs",children:[e.jsx(tt,{className:"w-3 h-3 mr-1"}),"Opublikowany"]})]})]}),e.jsx(Ae,{className:`w-5 h-5 text-muted-foreground transition-transform ${D?"rotate-90":""}`})]})}),D&&e.jsx("div",{className:"border-t",children:e.jsxs(wc,{defaultValue:"sections",className:"w-full",children:[e.jsxs(co,{className:"w-full justify-start rounded-none border-b",children:[e.jsx(Gt,{value:"sections",children:"Sekcje i pytania"}),e.jsx(Gt,{value:"preview",children:"Podgląd"})]}),e.jsx(Ht,{value:"sections",className:"p-4 space-y-3",children:_.map(R=>{const L=z(R.content),F=u.activityId===k.id&&u.sectionId===R.id,K=c[k.id]===R.id;return e.jsxs("div",{className:"rounded-lg border overflow-hidden",children:[e.jsxs("div",{className:"flex items-start justify-between p-3 gap-3",children:[e.jsxs("button",{onClick:()=>N(k.id,R.id),className:"flex-1 flex items-start gap-2 text-left hover:opacity-70 transition-opacity",children:[K?e.jsx(Dt,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-muted-foreground"}):e.jsx(Ae,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-muted-foreground"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-sm",children:R.title}),L&&e.jsxs(B,{variant:"secondary",className:"text-xs mt-1",children:[e.jsx(Be,{className:"w-3 h-3 mr-1"}),"Zawiera pytanie"]})]})]}),e.jsx("div",{className:"flex-shrink-0",children:L?e.jsxs(M,{size:"sm",variant:"outline",onClick:()=>S(k,R.id,R.title,R.content),disabled:F,children:[F?e.jsx(lt,{className:"w-3 h-3 animate-spin"}):e.jsx(gr,{className:"w-3 h-3"}),e.jsx("span",{className:"ml-1",children:"Zamień"})]}):e.jsxs(M,{size:"sm",onClick:()=>S(k,R.id,R.title,R.content),disabled:F,children:[F?e.jsx(lt,{className:"w-3 h-3 animate-spin"}):e.jsx(Qe,{className:"w-3 h-3"}),e.jsx("span",{className:"ml-1",children:"Dodaj pytanie"})]})})]}),K&&e.jsx("div",{className:"border-t bg-muted/30",children:e.jsx(Ze,{className:"max-h-[300px]",children:e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"prose prose-sm max-w-none dark:prose-invert",children:e.jsx(Sn,{remarkPlugins:[An],children:R.content.replace(/```quiz[\s\S]*?```/g,"")})}),L&&e.jsx("div",{className:"mt-4 p-3 bg-background rounded-lg border",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Be,{className:"w-4 h-4 mt-0.5 text-primary flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm mb-2",children:L.question}),e.jsx("div",{className:"space-y-1",children:L.options.map((q,G)=>e.jsxs("div",{className:`text-xs p-2 rounded ${G===L.answerIndex?"bg-green-100 dark:bg-green-900/30 text-green-900 dark:text-green-100 font-medium":"bg-muted"}`,children:[G+1,". ",q,G===L.answerIndex&&" ✓"]},G))})]})]})})]})})})]},R.id)})}),e.jsxs(Ht,{value:"preview",className:"p-4",children:[e.jsxs(M,{variant:"outline",className:"w-full mb-4",onClick:()=>w(k),children:[e.jsx(tt,{className:"w-4 h-4 mr-2"}),"Otwórz podgląd w pełnym oknie"]}),e.jsx(Ze,{className:"h-[400px] rounded-lg border p-4",children:e.jsx("div",{className:"prose prose-sm max-w-none dark:prose-invert",children:e.jsx(Sn,{remarkPlugins:[An],children:k.content})})})]})]})})]},k.id)})}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(kt,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Brak materiałów w wybranym temacie"})]}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Be,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Wybierz kurs i temat aby zobaczyć materiały"})]})})]})]}),e.jsx(ds,{open:j.open,onOpenChange:k=>{k||y({open:!1,activity:null})},children:e.jsxs(Jt,{className:"max-w-4xl max-h-[90vh]",children:[e.jsxs(Xt,{children:[e.jsx(es,{children:j.activity?.title}),e.jsxs(bi,{children:[j.activity?.topics?.courses?.title," → ",j.activity?.topics?.title]})]}),j.activity&&e.jsx(mo,{content:j.activity.content,metadata:{duration_min:j.activity.duration_min,position:j.activity.position,created_at:j.activity.created_at,updated_at:j.activity.updated_at},showMetadata:!0,height:"500px"})]})}),e.jsx(ds,{open:x.open,onOpenChange:k=>{!k&&!h&&g({open:!1,quiz:null,activityId:null,sectionId:null,sectionTitle:null,sectionContent:null})},children:e.jsxs(Jt,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Xt,{children:[e.jsx(es,{children:"Wygenerowane pytanie kontrolne"}),e.jsxs(bi,{children:["Sekcja: ",x.sectionTitle]})]}),x.quiz&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-lg border p-4 bg-muted/50",children:[e.jsx("p",{className:"font-medium mb-3 break-words",children:x.quiz.question}),e.jsx("div",{className:"space-y-2",children:x.quiz.options.map((k,_)=>e.jsxs("div",{className:`flex items-center gap-2 p-2 rounded ${_===x.quiz?.answerIndex?"bg-green-100 dark:bg-green-900/30 border border-green-300":""}`,children:[e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center flex-shrink-0 ${_===x.quiz?.answerIndex?"border-green-500 bg-green-500":"border-gray-300"}`,children:_===x.quiz?.answerIndex&&e.jsx(Pt,{className:"w-3 h-3 text-white"})}),e.jsx("span",{className:"text-sm break-words",children:k})]},_))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Kod YAML (do wstawienia):"}),e.jsx("div",{className:"rounded-lg border bg-background p-3 font-mono text-xs max-h-[300px] overflow-auto",children:e.jsx("pre",{className:"whitespace-pre-wrap break-words",children:`\`\`\`quiz
question: "${x.quiz.question}"
options:
${x.quiz.options.map(k=>`  - "${k}"`).join(`
`)}
answerIndex: ${x.quiz.answerIndex}
\`\`\``})})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(M,{variant:"outline",onClick:()=>g({open:!1,quiz:null,activityId:null,sectionId:null,sectionTitle:null,sectionContent:null}),disabled:h!==null,children:"Anuluj"}),e.jsxs(M,{variant:"outline",onClick:()=>{if(x.activityId&&x.sectionId&&x.sectionTitle&&x.sectionContent){const k=v?.data?.find(_=>_.id===x.activityId);k&&S(k,x.sectionId,x.sectionTitle,x.sectionContent)}},disabled:h!==null,children:[e.jsx(gr,{className:"w-4 h-4 mr-1"}),"Wygeneruj ponownie"]}),e.jsx(M,{onClick:P,disabled:h!==null,children:h?e.jsxs(e.Fragment,{children:[e.jsx(lt,{className:"w-4 h-4 mr-1 animate-spin"}),"Zapisywanie..."]}):e.jsxs(e.Fragment,{children:[e.jsx(sn,{className:"w-4 h-4 mr-1"}),"Zapisz pytanie"]})})]})]})]})})]})}const az=[e.jsx(H,{path:"/educational-material",element:e.jsx(Mv,{})},"em-dashboard"),e.jsx(H,{path:"/educational-material/step1",element:e.jsx(UN,{})},"em-step1"),e.jsx(H,{path:"/educational-material/step2",element:e.jsx(HN,{})},"em-step2"),e.jsx(H,{path:"/educational-material/step3",element:e.jsx(QN,{})},"em-step3"),e.jsx(H,{path:"/educational-material/step4",element:e.jsx(rz,{})},"em-step4")],Su={name:"educational-material",list:"/educational-material",create:"/educational-material/step1",meta:{canDelete:!1,label:"Kreator materiałów",icon:e.jsx(xe,{className:"h-4 w-4"})}};function oz(){return e.jsxs(Z,{children:[e.jsx(me,{title:"Kreator quizów — panel",description:"Wygeneruj pytania na podstawie istniejących materiałów edukacyjnych"}),e.jsxs("div",{className:"relative overflow-hidden rounded-2xl border mb-6",children:[e.jsx("div",{className:"absolute inset-0 bg-cyan-50"}),e.jsxs("div",{className:"relative px-6 py-8 flex items-center gap-3",children:[e.jsx("div",{className:"shrink-0 inline-flex h-10 w-10 items-center justify-center rounded-xl bg-black text-white",children:e.jsx(cn,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-semibold leading-tight",children:"Kreator quizów"}),e.jsx("p",{className:"text-sm text-zinc-600",children:"Wybierz kurs, temat i materiał, a potem wygeneruj zestaw pytań wielokrotnego wyboru z poprawnymi odpowiedziami i wyjaśnieniami."})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(M,{asChild:!0,children:e.jsxs(Te,{to:"/admin/quiz-wizard/step1",className:"inline-flex items-center gap-2",children:["Nowa sesja",e.jsx(Ae,{className:"w-4 h-4"})]})})})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(I,{children:[e.jsxs(O,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(pt,{className:"w-5 h-5"}),"Szybki start"]}),e.jsx(oo,{children:"3 kroki do gotowego quizu"})]}),e.jsxs(E,{className:"space-y-3 text-sm",children:[e.jsxs("ol",{className:"list-decimal list-inside space-y-1 text-zinc-700",children:[e.jsx("li",{children:"Wybierz kurs → temat → materiał (Markdown)."}),e.jsx("li",{children:"Ustaw parametry (liczba pytań, poziom trudności, wyjaśnienia)."}),e.jsxs("li",{children:["Wygeneruj pytania i zapisz quiz do bazy (Supabase) jako aktywność typu ",e.jsx("code",{children:"quiz"}),"."]})]}),e.jsx(M,{asChild:!0,className:"w-full",children:e.jsxs(Te,{to:"/admin/quiz-wizard/step1",className:"inline-flex items-center gap-2",children:["Przejdź do kroku 1",e.jsx(Ae,{className:"w-4 h-4"})]})})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-5 h-5"}),"Jak generujemy pytania?"]})}),e.jsxs(E,{className:"space-y-3 text-sm text-muted-foreground",children:[e.jsx("p",{children:"Model analizuje treść materiału i tworzy pytania sprawdzające zrozumienie kluczowych koncepcji."}),e.jsx("p",{children:"Format generatu: JSON → zapis w treści aktywności jako YAML (lista pytań)."}),e.jsxs(he,{children:[e.jsx(Ln,{className:"h-4 w-4"}),e.jsx(pe,{className:"text-xs",children:"Quiz jest tworzony w tym samym temacie co materiał. Możesz go później przypisać do grup uczniów."})]})]})]})]})]})}function lz({topicId:t,selectedMaterialId:s,onSelectMaterial:n,showPreview:i=!1,showMaterialCount:r=!1,highlightColor:a="blue",className:o=""}){const[l,c]=f.useState(""),[d,u]=f.useState({open:!1,material:null}),{data:m,isLoading:h}=Q({resource:"activities",filters:t?[{field:"topic_id",operator:"eq",value:t},{field:"type",operator:"eq",value:"material"}]:[],sorters:[{field:"position",order:"asc"}],pagination:{pageSize:1e3},meta:{select:i?"id,topic_id,title,position,is_published,content,duration_min,created_at":"id,topic_id,title,position,is_published"},queryOptions:{enabled:!!t}}),p=f.useMemo(()=>{const g=m?.data||[];if(!l.trim())return g;const b=l.toLowerCase();return g.filter(v=>String(v.title).toLowerCase().includes(b)||String(v.position).includes(b))},[m?.data,l]),j=(g,b)=>{b.stopPropagation(),i&&u({open:!0,material:g})},x={blue:{selected:"bg-blue-50/60 ring-1 ring-blue-200",radio:"bg-blue-500 border-blue-500"},cyan:{selected:"bg-cyan-50/60 ring-1 ring-cyan-200",radio:"bg-cyan-500 border-cyan-500"}}[a];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`rounded-lg border ${o}`,children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 border-b bg-muted/40",children:[e.jsx(Ti,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(J,{value:l,onChange:g=>c(g.target.value),placeholder:"Filtruj materiały…",className:"h-8"})]}),e.jsxs("div",{className:"divide-y",children:[h&&e.jsx("div",{className:"p-3 text-xs text-muted-foreground",children:"Ładowanie materiałów…"}),!h&&p.length===0&&e.jsx("div",{className:"p-3 text-xs text-muted-foreground",children:l?"Brak wyników dla filtru.":"Brak materiałów w tym temacie."}),p.map(g=>{const b=s===g.id;return e.jsx("button",{type:"button",onClick:()=>n(g.id),className:["w-full text-left p-3 hover:bg-muted/50 transition",b?x.selected:""].join(" "),children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx("span",{className:"shrink-0 inline-flex items-center justify-center w-5 h-5 rounded-full bg-primary/10 text-xs font-semibold",children:g.position}),e.jsx("span",{className:"truncate",children:g.title}),!g.is_published&&e.jsx(B,{variant:"outline",className:"text-xs shrink-0",children:e.jsx(dn,{className:"w-3 h-3"})})]}),i&&e.jsxs("button",{onClick:v=>j(g,v),className:"mt-1 ml-7 text-xs text-primary/70 hover:text-primary hover:underline inline-flex items-center gap-1",children:[e.jsx(tt,{className:"w-3 h-3"}),"Zobacz treść"]}),r&&g.duration_min&&e.jsxs("div",{className:"mt-1 ml-7 text-xs text-muted-foreground",children:[e.jsx(kt,{className:"w-3 h-3 inline mr-1"}),g.duration_min," min"]})]}),e.jsx("div",{className:["shrink-0 w-3 h-3 rounded-full border mt-1",b?x.radio:"bg-white"].join(" "),"aria-hidden":!0})]})},g.id)})]}),e.jsxs("div",{className:"p-2 border-t text-[11px] text-muted-foreground",children:["Kliknij materiał",i?" lub zobacz treść":"",", aby go wybrać."]})]}),i&&e.jsx(ds,{open:d.open,onOpenChange:g=>{g||u({open:!1,material:null})},children:e.jsxs(Jt,{className:"max-w-6xl max-h-[90vh]",children:[e.jsxs(Xt,{children:[e.jsxs(es,{className:"flex items-center gap-2",children:[e.jsx(tt,{className:"w-5 h-5"}),d.material?.title]}),e.jsxs(bi,{children:["Podgląd materiału • ",d.material?.duration_min||20," min"]})]}),d.material&&e.jsx(mo,{content:d.material.content,metadata:{duration_min:d.material.duration_min,position:d.material.position,created_at:d.material.created_at},showMetadata:!0,height:"500px"})]})})]})}const cz={type:"object",properties:{courseId:{type:"number",required:!0},topicId:{type:"number",required:!0},materialId:{type:"number",required:!0},count:{type:"number"},difficulty:{type:"string"},includeExplanations:{type:"boolean"},randomized:{type:"boolean"},passingScore:{type:"number"},timeLimit:{type:"number"},maxAttempts:{type:"number"}}};function dz(){const{registerStep:t,setStepData:s,getStepData:n}=Ns(),i=le(),r=n("qw_step1")||{},[a,o]=f.useState(!0);f.useEffect(()=>{t("qw_step1",cz),r.count||s("qw_step1",{count:10,difficulty:"mixed",includeExplanations:!0,randomized:!0,passingScore:70,timeLimit:void 0,maxAttempts:void 0})},[]);const{data:l}=Q({resource:"courses",filters:a?[{field:"is_published",operator:"eq",value:!0}]:[],sorters:[{field:"created_at",order:"desc"}],pagination:{pageSize:100}}),{data:c}=Q({resource:"topics",filters:[{field:"course_id",operator:"eq",value:r.courseId||-1}],sorters:[{field:"position",order:"asc"}],pagination:{pageSize:500},queryOptions:{enabled:!!r.courseId}}),d=!!r.courseId&&!!r.topicId&&!!r.materialId;return e.jsxs(Z,{children:[e.jsx(me,{title:"Krok 1",description:"Wybór materiału oraz parametrów quizu"}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[1.2fr,0.8fr]",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Kurs → temat → materiał"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted rounded-lg",children:[e.jsx(Ke,{checked:a,onCheckedChange:u=>o(!!u)}),e.jsx("label",{className:"text-sm cursor-pointer",children:"Tylko opublikowane kursy"})]}),e.jsxs(we,{value:r.courseId?String(r.courseId):"",onValueChange:u=>s("qw_step1",{courseId:Number(u),topicId:void 0,materialId:void 0}),children:[e.jsx(ge,{children:e.jsx(be,{placeholder:"Wybierz kurs"})}),e.jsx(je,{children:(l?.data||[]).map(u=>e.jsx(Y,{value:String(u.id),children:e.jsxs("div",{className:"flex items-center gap-2",children:[u.icon_emoji?`${u.icon_emoji} `:"📚 ",e.jsx("span",{children:u.title}),!u.is_published&&e.jsxs(B,{variant:"outline",className:"ml-2 text-xs",children:[e.jsx(dn,{className:"w-3 h-3"}),"Szkic"]})]})},u.id))})]}),e.jsxs(we,{value:r.topicId?String(r.topicId):"",onValueChange:u=>s("qw_step1",{topicId:Number(u),materialId:void 0}),disabled:!r.courseId,children:[e.jsx(ge,{children:e.jsx(be,{placeholder:"Wybierz temat"})}),e.jsx(je,{children:(c?.data||[]).map(u=>e.jsxs(Y,{value:String(u.id),children:[u.position,". ",u.title]},u.id))})]}),r.topicId&&e.jsx(lz,{topicId:r.topicId,selectedMaterialId:r.materialId||null,onSelectMaterial:u=>s("qw_step1",{materialId:u}),showPreview:!0,highlightColor:"cyan"})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Parametry generowania"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ww,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Steruj zakresem i poziomem pytań"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-1",children:"Liczba pytań"}),e.jsx(J,{type:"number",min:3,max:30,value:r.count??10,onChange:u=>s("qw_step1",{count:Number(u.target.value)})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-1",children:"Poziom trudności"}),e.jsxs(we,{value:r.difficulty||"mixed",onValueChange:u=>s("qw_step1",{difficulty:u}),children:[e.jsx(ge,{children:e.jsx(be,{placeholder:"Wybierz poziom"})}),e.jsxs(je,{children:[e.jsx(Y,{value:"mixed",children:"Mieszany"}),e.jsx(Y,{value:"easy",children:"Łatwy"}),e.jsx(Y,{value:"medium",children:"Średni"}),e.jsx(Y,{value:"hard",children:"Trudny"})]})]})]}),e.jsxs("div",{className:"border-t pt-3 space-y-3",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Parametry quizu"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs mb-1",children:["Wynik zaliczający (%)",e.jsx("span",{className:"text-muted-foreground ml-1",children:"domyślnie: 70%"})]}),e.jsx(J,{type:"number",min:0,max:100,value:r.passingScore??70,onChange:u=>s("qw_step1",{passingScore:Number(u.target.value)})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs mb-1",children:["Limit czasu (minuty)",e.jsx("span",{className:"text-muted-foreground ml-1",children:"opcjonalne"})]}),e.jsx(J,{type:"number",min:1,max:180,placeholder:"Brak limitu",value:r.timeLimit??"",onChange:u=>s("qw_step1",{timeLimit:u.target.value?Number(u.target.value):void 0})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs mb-1",children:["Max. liczba prób",e.jsx("span",{className:"text-muted-foreground ml-1",children:"opcjonalne"})]}),e.jsx(J,{type:"number",min:1,max:10,placeholder:"Bez limitu",value:r.maxAttempts??"",onChange:u=>s("qw_step1",{maxAttempts:u.target.value?Number(u.target.value):void 0})})]})]}),e.jsxs("div",{className:"border-t pt-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{checked:r.includeExplanations??!0,onCheckedChange:u=>s("qw_step1",{includeExplanations:!!u})}),e.jsx("span",{className:"text-sm",children:"Dodaj wyjaśnienia do poprawnych odpowiedzi"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{checked:r.randomized??!0,onCheckedChange:u=>s("qw_step1",{randomized:!!u})}),e.jsx("span",{className:"text-sm",children:"Losuj kolejność odpowiedzi"})]})]}),e.jsxs(he,{children:[e.jsx(Ln,{className:"h-4 w-4"}),e.jsx(pe,{className:"text-xs",children:"Pytania będą tworzone na podstawie treści wybranego materiału. Upewnij się, że materiał jest kompletny."})]}),e.jsxs(M,{disabled:!d,className:"w-full",onClick:()=>i("/admin/quiz-wizard/step2"),children:["Kontynuuj",e.jsx(Ae,{className:"w-4 h-4 ml-1"})]}),!d&&e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Wybierz kurs, temat i materiał aby kontynuować"})]})]})]})]})}const uz={type:"object",properties:{items:{type:"array",minItems:3,items:{type:"object",properties:{question:{type:"string",required:!0},options:{type:"array",items:{type:"string"},minItems:4,maxItems:4,required:!0},answerIndex:{type:"number",minimum:0,maximum:3,required:!0},explanation:{type:"string"}}},required:!0}}};function mz(){const{getStepData:t,setStepData:s}=Ns(),n=le(),i=t("qw_step1"),r=i?.materialId,a=i?.topicId,[o,l]=f.useState(null),[c,d]=f.useState(!1),[u,m]=f.useState(null),[h,p]=f.useState(null),[j,y]=f.useState(!1);f.useEffect(()=>{(!r||!a)&&n("/admin/quiz-wizard/step1")},[r,a,n]);const{data:x}=Le({resource:"activities",id:String(r||""),meta:{select:"*"},queryOptions:{enabled:!!r}}),g=async()=>{if(!x?.data)return;m(null),p(null),y(!1),d(!0),s("qw_step2",{isGenerating:!0});const v=`
Jesteś nauczycielem tworzącym pytania testowe na podstawie materiału edukacyjnego (Markdown).

PARAMETRY QUIZU:
- liczba pytań: ${i.count??10}
- poziom trudności: ${i.difficulty??"mixed"}
- losuj kolejność odpowiedzi: ${i.randomized?"tak":"nie"}
- dodawaj wyjaśnienia: ${i.includeExplanations?"tak":"nie"}

MATERIAŁ (źródło, Markdown):
"""
${x.data.content}
"""

WYTYCZNE:
1) Pytania muszą testować zrozumienie kluczowych idei z materiału (nie pamięciówka).
2) Każde pytanie ma DOKŁADNIE 4 opcje odpowiedzi.
3) answerIndex wskazuje poprawną odpowiedź (0-3).
4) Unikaj opcji "wszystkie/żadne z powyższych".
5) Jeśli "dodawaj wyjaśnienia" = tak → pole explanation ma krótkie uzasadnienie odpowiedzi.
6) Zweryfikuj spójność logiczną i brak wieloznaczności.

ZWRÓĆ WYŁĄCZNIE JSON ze strukturą:
{
  "items": [
    { "question": "...", "options": ["A","B","C","D"], "answerIndex": 0, "explanation": "..." }
  ]
}
    `.trim();try{const C=await Rn(v,uz),T=Array.isArray(C.items)?C.items:[];if(T.length<3)throw new Error("Za mało poprawnych pytań w odpowiedzi modelu.");const z={material_id:x.data.id,topic_id:x.data.topic_id,title:`${x.data.title} — Quiz`,items:T};l(z)}catch(C){const T=C?.message?.toString()?.includes("503")||C?.details?.toString()?.includes?.("503")?"Błąd komunikacji z modelem (503)":C?.message||"Nie udało się wygenerować quizu.";m(T);const z=C?.info??C?.response??{message:C?.message,status:C?.status||C?.statusCode,details:C?.details,raw:C};p(z)}finally{d(!1),s("qw_step2",{isGenerating:!1})}},b=()=>{o&&n("/admin/quiz-wizard/step3",{state:{item:o}})};return e.jsxs(Z,{children:[e.jsx(me,{title:"Krok 2",description:"Generowanie pytań na podstawie materiału"}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[0.9fr,1.1fr]",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-5 h-5"}),"Panel generowania"]})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-lg bg-muted p-4 space-y-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Materiał:"})," ",e.jsx("span",{className:"font-medium",children:x?.data?.title||"-"})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx(B,{variant:"outline",children:i.difficulty??"mixed"}),e.jsx(B,{variant:"outline",children:(i.count??10)+" pytań"}),i.includeExplanations&&e.jsx(B,{variant:"default",children:"Wyjaśnienia"})]})]}),e.jsxs(he,{children:[e.jsx(xe,{className:"h-4 w-4"}),e.jsx(pe,{className:"text-xs",children:"Pytania będą dotyczyły treści wybranego materiału. Możesz je później edytować przed zapisem."})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(M,{onClick:g,disabled:c,className:"w-full",size:"lg",children:c?e.jsxs(e.Fragment,{children:[e.jsx(lt,{className:"w-4 h-4 mr-2 animate-spin"}),"Generowanie pytań..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pt,{className:"w-4 h-4 mr-2"}),"Wygeneruj pytania"]})}),e.jsxs(M,{variant:"default",onClick:b,disabled:!o||c,className:"w-full",children:["Przejdź do zapisu",e.jsx(Ae,{className:"w-4 h-4 ml-1"})]})]}),u&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(he,{variant:"destructive",children:[e.jsx(Re,{className:"h-4 w-4"}),e.jsx(pe,{children:u})]}),h&&e.jsxs(I,{children:[e.jsx(O,{className:"py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx($,{className:"text-sm",children:"Szczegóły błędu"}),e.jsx(M,{variant:"ghost",size:"sm",onClick:()=>y(v=>!v),className:"h-7",children:j?e.jsx(Rr,{className:"w-4 h-4"}):e.jsx(Dt,{className:"w-4 h-4"})})]})}),j&&e.jsx(E,{className:"pt-0",children:e.jsx(cs,{className:"font-mono text-xs h-40",readOnly:!0,value:(()=>{try{return JSON.stringify(h,null,2)}catch{return String(h)}})()})})]})]}),c&&e.jsxs("div",{className:"text-center text-sm text-muted-foreground space-y-1",children:[e.jsx("p",{children:"Analizuję materiał i tworzę pytania..."}),e.jsx("p",{className:"text-xs",children:"To może potrwać kilkanaście sekund"})]})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Podgląd pytań"})}),e.jsx(E,{children:o?e.jsx(Ze,{className:"h-[500px] rounded-lg border p-4",children:e.jsx("div",{className:"space-y-4",children:o.items.map((v,C)=>e.jsxs("div",{className:"rounded-lg border p-3",children:[e.jsxs("div",{className:"text-sm font-medium mb-2",children:[C+1,". ",v.question]}),e.jsx("ul",{className:"text-sm space-y-1",children:v.options.map((T,z)=>e.jsxs("li",{className:z===v.answerIndex?"font-medium":"",children:[String.fromCharCode(65+z),". ",T," ",z===v.answerIndex?"✓":""]},z))}),v.explanation&&e.jsxs("div",{className:"mt-2 text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium",children:"Wyjaśnienie: "}),v.explanation]})]},C))})}):e.jsx("div",{className:"flex flex-col items-center justify-center py-16 text-muted-foreground",children:c?e.jsxs(e.Fragment,{children:[e.jsx(lt,{className:"w-8 h-8 mb-3 animate-spin"}),e.jsx("div",{className:"text-sm",children:"Generowanie pytań..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"w-8 h-8 mb-3 opacity-50"}),e.jsx("div",{className:"text-sm",children:"Brak wygenerowanych pytań"}),e.jsx("div",{className:"text-xs mt-1",children:'Kliknij "Wygeneruj pytania"'})]})})})]})]})]})}function hz(){const t=le(),s=ms(),{mutate:n}=os(),{mutate:i}=os(),r=f.useMemo(()=>s?.state?.item??null,[s?.state?.item]),a=f.useMemo(()=>{try{const z=localStorage.getItem("formWizard_qw_step1");if(z)return JSON.parse(z)}catch(z){console.error("Failed to parse step1 data:",z)}return{}},[]),[o,l]=f.useState(r?.title??""),[c,d]=f.useState(!1),[u,m]=f.useState(r?.items??[]),[h,p]=f.useState(!1),[j,y]=f.useState(null),[x,g]=f.useState(""),{data:b}=Q({resource:"activities",filters:r?[{field:"topic_id",operator:"eq",value:r.topic_id}]:[],sorters:[{field:"position",order:"desc"}],pagination:{pageSize:1},queryOptions:{enabled:!!r?.topic_id}});f.useEffect(()=>{r||t("/admin/quiz-wizard/step2")},[r,t]);const v=z=>{m(N=>N.filter((S,P)=>P!==z))},C=(z,N,S)=>{m(P=>P.map((w,k)=>k===z?{...w,[N]:S}:w))},T=async()=>{if(r){if(!o||o.trim().length<3){y("Tytuł musi mieć minimum 3 znaki.");return}if(u.length===0){y("Quiz musi mieć przynajmniej jedno pytanie.");return}for(let z=0;z<u.length;z++){const N=u[z];if(!N.question||N.question.trim().length<5){y(`Pytanie ${z+1}: treść pytania jest za krótka (min. 5 znaków).`);return}if(!N.options||N.options.length!==4){y(`Pytanie ${z+1}: musi mieć dokładnie 4 opcje odpowiedzi.`);return}if(N.answerIndex<0||N.answerIndex>3){y(`Pytanie ${z+1}: nieprawidłowy indeks poprawnej odpowiedzi.`);return}for(let S=0;S<N.options.length;S++)if(!N.options[S]||N.options[S].trim().length<1){y(`Pytanie ${z+1}, opcja ${S+1}: nie może być pusta.`);return}}p(!0),y(null),g("Tworzenie aktywności quizu...");try{const z=Number(r.topic_id),N=b?.data?.[0],S=N?.position?Number(N.position)+1:1,P=a.passingScore??70,w=a.timeLimit??null,k=a.maxAttempts??null,_=Math.ceil(u.length*1.5);g("Zapisywanie aktywności...");const A=await new Promise((D,R)=>{n({resource:"activities",values:{topic_id:z,type:"quiz",title:o.trim(),content:null,duration_min:_,passing_score:P,time_limit:w,max_attempts:k,position:S,is_published:c}},{onSuccess:L=>{const F=L?.data?.id;if(F){const K=typeof F=="string"?parseInt(F,10):F;D(K)}else R(new Error("Nie otrzymano ID aktywności"))},onError:L=>R(L)})});g(`Zapisywanie pytań (0/${u.length})...`);for(let D=0;D<u.length;D++){const R=u[D],L=D+1,F=R.question.substring(0,40)+(R.question.length>40?"...":"");g(`Zapisywanie pytania ${L}/${u.length}: "${F}"`);const K=R.options.map((q,G)=>({id:G+1,text:q.trim(),is_correct:G===R.answerIndex}));await new Promise((q,G)=>{i({resource:"questions",values:{activity_id:A,question:R.question.trim(),options:K,points:R.points??1,position:L,explanation:R.explanation?.trim()||null}},{onSuccess:()=>{console.log(`✓ Zapisano pytanie ${L}/${u.length}`),q()},onError:X=>{console.error(`✗ Błąd zapisu pytania ${L}:`,X),G(X)}})}),await new Promise(q=>setTimeout(q,150))}g(`✓ Zapisano wszystkie pytania (${u.length}/${u.length})`),setTimeout(()=>{t("/admin/quiz-wizard/step4",{state:{activityId:A,title:o,questionsCount:u.length,topicId:z,isPublished:c,passingScore:P,timeLimit:w,maxAttempts:k}})},1500)}catch(z){console.error("Save error:",z),z?.code==="23505"?y("Quiz o tym tytule już istnieje w tym temacie. Zmień tytuł."):z?.code==="23503"?y("Nieprawidłowy temat lub aktywność. Odśwież stronę i spróbuj ponownie."):z?.message?y(z.message):y("Nie udało się zapisać quizu. Spróbuj ponownie."),p(!1),g("")}}};return r?e.jsxs(Z,{children:[e.jsx(me,{title:"Krok 3",description:"Edycja i zapis quizu do bazy"}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[0.7fr,1.3fr]",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Ustawienia zapisu"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:["Tytuł quizu ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(J,{value:o,onChange:z=>l(z.target.value),placeholder:"np. Quiz do materiału: Wprowadzenie do ...",disabled:h}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Tytuł będzie widoczny dla uczniów"})]}),e.jsxs("div",{className:"rounded-lg border p-3 space-y-2 text-xs",children:[e.jsx("div",{className:"font-medium",children:"Parametry quizu:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-muted-foreground",children:[e.jsx("div",{children:"Wynik zaliczający:"}),e.jsxs("div",{className:"font-medium text-foreground",children:[a.passingScore??70,"%"]}),e.jsx("div",{children:"Limit czasu:"}),e.jsx("div",{className:"font-medium text-foreground",children:a.timeLimit?`${a.timeLimit} min`:"Brak"}),e.jsx("div",{children:"Max. prób:"}),e.jsx("div",{className:"font-medium text-foreground",children:a.maxAttempts??"Bez limitu"}),e.jsx("div",{children:"Liczba pytań:"}),e.jsx("div",{className:"font-medium text-foreground",children:u.length})]})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:"Opublikuj od razu"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Quiz będzie widoczny dla uczniów"})]}),e.jsx(zt,{checked:c,onCheckedChange:d,disabled:h})]}),j&&e.jsxs(he,{variant:"destructive",children:[e.jsx(Re,{className:"h-4 w-4"}),e.jsx(pe,{children:j})]}),x&&e.jsxs(he,{className:"border-blue-200 bg-blue-50",children:[e.jsx(lt,{className:"h-4 w-4 text-blue-600 animate-spin"}),e.jsx(pe,{className:"text-blue-900 text-sm",children:x})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{onClick:T,disabled:h||!o.trim()||u.length===0,className:"flex-1",children:h?e.jsxs(e.Fragment,{children:[e.jsx(lt,{className:"w-4 h-4 mr-2 animate-spin"}),"Zapisywanie..."]}):e.jsxs(e.Fragment,{children:[e.jsx(sn,{className:"w-4 h-4 mr-2"}),"Zapisz quiz"]})}),e.jsx(M,{asChild:!0,variant:"outline",disabled:h,children:e.jsxs(Te,{to:"/admin/quiz-wizard/step2",children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Wróć"]})})]})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Edycja pytań (",u.length,")"]}),e.jsxs(B,{variant:"outline",children:[u.length," pytań"]})]})}),e.jsxs(E,{children:[e.jsx(Ze,{className:"h-[600px] pr-4",children:e.jsx("div",{className:"space-y-4",children:u.length===0?e.jsxs(he,{children:[e.jsx(Re,{className:"h-4 w-4"}),e.jsx(pe,{children:"Brak pytań w quizie. Wróć do kroku 2 i wygeneruj pytania."})]}):u.map((z,N)=>e.jsxs("div",{className:"rounded-lg border p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{className:"text-xs text-muted-foreground",children:["Pytanie ",N+1]}),e.jsx(J,{value:z.question,onChange:S=>C(N,"question",S.target.value),disabled:h,className:"mt-1"})]}),e.jsx(M,{variant:"ghost",size:"sm",onClick:()=>v(N),disabled:h,className:"shrink-0 text-destructive hover:text-destructive",children:e.jsx(dt,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Odpowiedzi"}),z.options.map((S,P)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:["shrink-0 w-4 h-4 rounded-full border-2 flex items-center justify-center",P===z.answerIndex?"border-green-500 bg-green-500":"border-gray-300"].join(" "),children:P===z.answerIndex&&e.jsx(Pt,{className:"w-3 h-3 text-white"})}),e.jsx(J,{value:S,onChange:w=>{const k=[...z.options];k[P]=w.target.value,C(N,"options",k)},disabled:h,className:"flex-1",placeholder:`Opcja ${String.fromCharCode(65+P)}`}),e.jsx(M,{variant:"ghost",size:"sm",onClick:()=>C(N,"answerIndex",P),disabled:h,className:P===z.answerIndex?"text-green-600":"",children:P===z.answerIndex?"✓ Poprawna":"Ustaw"})]},P))]}),z.explanation&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Wyjaśnienie"}),e.jsx(J,{value:z.explanation,onChange:S=>C(N,"explanation",S.target.value),disabled:h,className:"mt-1"})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2 border-t",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Punkty:"}),e.jsx(J,{type:"number",min:1,max:10,value:z.points??1,onChange:S=>C(N,"points",Number(S.target.value)),disabled:h,className:"w-20"})]})]},N))})}),e.jsxs("div",{className:"mt-4 text-xs text-muted-foreground",children:["Pytania zostaną zapisane do tabeli ",e.jsx("code",{className:"bg-muted px-1 py-0.5 rounded",children:"questions"})," z referencją do aktywności. Każda opcja będzie miała flagę ",e.jsx("code",{className:"bg-muted px-1 py-0.5 rounded",children:"is_correct"}),"."]})]})]})]})]}):e.jsxs(Z,{children:[e.jsx(me,{title:"Krok 3",description:"Zapis quizu"}),e.jsx(I,{children:e.jsx(E,{className:"pt-6",children:e.jsxs(he,{variant:"destructive",children:[e.jsx(Re,{className:"h-4 w-4"}),e.jsxs(pe,{children:["Brak danych z poprzedniego kroku.",e.jsx(Te,{to:"/admin/quiz-wizard/step2",className:"underline ml-1",children:"Wróć do kroku 2"})]})]})})})]})}function pz(){const t=le(),n=ms()?.state,{data:i}=Le({resource:"topics",id:String(n?.topicId||""),meta:{select:"*, courses(title, icon_emoji)"},queryOptions:{enabled:!!n?.topicId}});if(f.useEffect(()=>{(!n||!n.activityId)&&t("/admin/quiz-wizard")},[n,t]),!n)return e.jsxs(Z,{children:[e.jsx(me,{title:"Podsumowanie",description:"Brak danych"}),e.jsx(I,{children:e.jsx(E,{className:"pt-6",children:e.jsx(he,{variant:"destructive",children:e.jsxs(pe,{children:["Brak danych podsumowania.",e.jsx(Te,{to:"/admin/quiz-wizard",className:"underline ml-1",children:"Wróć do panelu"})]})})})})]});const r=i?.data?.courses,a=i?.data;return e.jsxs(Z,{children:[e.jsx(me,{title:"✓ Quiz został zapisany!",description:"Podsumowanie utworzonego quizu"}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[1fr,1fr]",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Pt,{className:"w-5 h-5 text-green-600"}),"Informacje o quizie"]})}),e.jsxs(E,{className:"space-y-4",children:[e.jsx("div",{className:"rounded-lg bg-green-50 border border-green-200 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Pt,{className:"w-6 h-6 text-green-600 shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-green-900 mb-1",children:"Quiz został pomyślnie zapisany"}),e.jsx("div",{className:"text-sm text-green-700",children:"Wszystkie pytania zostały zapisane do bazy danych"})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between py-2 border-b",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ID aktywności:"}),e.jsx("code",{className:"text-sm font-mono bg-muted px-2 py-1 rounded",children:n.activityId})]}),e.jsxs("div",{className:"flex items-start justify-between py-2 border-b",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Tytuł:"}),e.jsx("span",{className:"text-sm font-medium text-right max-w-[60%]",children:n.title})]}),e.jsxs("div",{className:"flex items-center justify-between py-2 border-b",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Status:"}),e.jsx(B,{variant:n.isPublished?"default":"outline",children:n.isPublished?"Opublikowany":"Szkic"})]}),r&&a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between py-2 border-b",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Kurs:"}),e.jsxs("span",{className:"text-sm font-medium",children:[r.icon_emoji," ",r.title]})]}),e.jsxs("div",{className:"flex items-center justify-between py-2 border-b",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Temat:"}),e.jsx("span",{className:"text-sm font-medium",children:a.title})]})]})]})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-5 h-5"}),"Parametry quizu"]})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted",children:[e.jsx(xe,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Liczba pytań"}),e.jsx("div",{className:"text-lg font-semibold",children:n.questionsCount})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted",children:[e.jsx(Ve,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Wynik zaliczający"}),e.jsxs("div",{className:"text-lg font-semibold",children:[n.passingScore,"%"]})]})]}),n.timeLimit&&e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted",children:[e.jsx(De,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Limit czasu"}),e.jsxs("div",{className:"text-lg font-semibold",children:[n.timeLimit," min"]})]})]}),n.maxAttempts&&e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted",children:[e.jsx(bw,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Maksymalna liczba prób"}),e.jsx("div",{className:"text-lg font-semibold",children:n.maxAttempts})]})]}),!n.timeLimit&&!n.maxAttempts&&e.jsx(he,{children:e.jsx(pe,{className:"text-xs",children:"Quiz nie ma limitów czasowych ani prób — uczniowie mogą podejść dowolną liczbę razy."})})]}),e.jsxs("div",{className:"pt-4 border-t space-y-2",children:[e.jsx("div",{className:"text-sm font-medium mb-3",children:"Co dalej?"}),e.jsx(M,{asChild:!0,variant:"default",className:"w-full",children:e.jsxs(Te,{to:"/admin/quiz-wizard/step1",children:[e.jsx(vw,{className:"w-4 h-4 mr-2"}),"Utwórz kolejny quiz"]})}),e.jsx(M,{asChild:!0,variant:"outline",className:"w-full",children:e.jsxs(Te,{to:"/admin/quiz-wizard",children:[e.jsx(sp,{className:"w-4 h-4 mr-2"}),"Wróć do panelu"]})})]})]})]})]})]})}const fz=[e.jsx(H,{path:"/quiz-wizard",element:e.jsx(oz,{})},"quiz-dashboard"),e.jsx(H,{path:"/quiz-wizard/step1",element:e.jsx(dz,{})},"quiz-step1"),e.jsx(H,{path:"/quiz-wizard/step2",element:e.jsx(mz,{})},"quiz-step2"),e.jsx(H,{path:"/quiz-wizard/step3",element:e.jsx(hz,{})},"quiz-step3"),e.jsx(H,{path:"/quiz-wizard/step4",element:e.jsx(pz,{})},"quiz-step4")],Cu={name:"quiz-wizard",list:"/quiz-wizard",create:"/quiz-wizard/step1",meta:{canDelete:!1,label:"Kreator quizów",icon:e.jsx(cn,{className:"h-4 w-4"})}},xz=[...Ub,...iv,...cv,...Dv,...Tv,...az,...fz],gz=()=>e.jsx(Za,{children:e.jsxs(H,{element:e.jsx(Fb,{children:e.jsx(mc,{})}),children:[e.jsx(H,{index:!0,element:e.jsx(as,{to:"dashboard/overview",replace:!0})}),e.jsx(H,{path:"dashboard",element:e.jsx(as,{to:"dashboard/overview",replace:!0})}),xz]})}),jz=f.lazy(()=>Promise.resolve({default:gz})),Yf=({text:t,colorClass:s})=>e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-background",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`inline-block h-12 w-12 animate-spin rounded-full border-4 border-current border-r-transparent ${s}`}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:t})]})}),yz=({children:t})=>{const{data:s,isLoading:n}=Ye();if(n||!s)return e.jsx(Yf,{text:"Sprawdzanie uprawnień...",colorClass:"border-red-600"});if(s.role!=="admin"){const i=s.role==="teacher"?"/teacher/dashboard":"/student/dashboard";return e.jsx(as,{to:i,replace:!0})}return e.jsx(e.Fragment,{children:t})},wz=e.jsx(H,{path:"/admin/*",element:e.jsx(fc,{fallback:e.jsx(xc,{to:"/login"}),children:e.jsx(yz,{children:e.jsx(f.Suspense,{fallback:e.jsx(Yf,{text:"Ładowanie panelu administratora...",colorClass:"border-red-600"}),children:e.jsx(jz,{})})})},"admin-auth")}),bz=({onClose:t})=>{const{mutate:s}=Ja(),{menuItems:n}=Zh(),{data:i}=Ye(),r=()=>{t&&t()};return e.jsxs("div",{className:"flex h-full w-64 flex-col border-r bg-background",children:[e.jsxs("div",{className:"flex h-16 items-center justify-between border-b px-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Or,{className:"h-6 w-6 mr-2"}),e.jsx("span",{className:"font-semibold",children:"Smart Up"})]}),t&&e.jsx(M,{variant:"ghost",size:"sm",onClick:t,className:"lg:hidden",children:e.jsx(ls,{className:"h-4 w-4"})})]}),e.jsx(Ze,{className:"flex-1 px-3 py-4",children:e.jsx("nav",{className:"space-y-4",children:n.map(a=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(gi,{to:a.route??"/",onClick:r,className:({isActive:o})=>U("flex items-center justify-between rounded-md px-3 py-2 text-sm font-semibold transition-colors hover:bg-accent hover:text-accent-foreground",o?"bg-accent text-accent-foreground":"text-foreground"),children:[e.jsxs("span",{className:"flex items-center",children:[a.icon&&e.jsx("span",{className:"mr-3",children:a.icon}),a.label]}),e.jsx(Dt,{className:"h-4 w-4 opacity-60"})]}),a.children&&a.children.length>0&&e.jsx("div",{className:"ml-3 border-l pl-3 space-y-1",children:a.children.map(o=>e.jsxs(gi,{to:o.route??"/",onClick:r,className:({isActive:l})=>U("flex items-center rounded-md px-3 py-2 text-sm transition-colors hover:bg-accent hover:text-accent-foreground",l?"bg-accent text-accent-foreground":"text-muted-foreground"),children:[o.icon&&e.jsx("span",{className:"mr-3",children:o.icon}),o.label]},o.key))})]},a.key))})}),e.jsx(lo,{}),e.jsx(gp,{className:"border-b"}),e.jsx("div",{className:"p-4",children:e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>{s(),t&&t()},className:"w-full justify-start",children:[e.jsx(no,{className:"mr-2 h-4 w-4"}),"Logout"]})})]})},vz=({children:t})=>{const[s,n]=f.useState(!1),i=()=>{n(!s)};return e.jsx("div",{className:"min-h-screen bg-stone-200 relative overflow-x-hidden",children:e.jsxs("div",{className:"flex relative",children:[s&&e.jsx("div",{className:"fixed inset-0 z-40 bg-purple-900/20 backdrop-blur-sm lg:hidden",onClick:()=>n(!1)}),e.jsx("aside",{className:`
            h-screen w-64 transform transition-transform duration-300 ease-in-out
            fixed left-0 top-0 z-50
            ${s?"translate-x-0":"-translate-x-full"}
            lg:translate-x-0
            bg-background/95 backdrop-blur-md border-r border-purple-200/20
          `,children:e.jsx(bz,{onClose:()=>n(!1)})}),e.jsxs("main",{className:"flex-1 lg:ml-64 min-w-0 relative z-10",children:[e.jsxs("div",{className:"sticky top-0 z-30 flex h-16 items-center border-b border-purple-200/20 bg-background/80 backdrop-blur-md px-4 lg:hidden",children:[e.jsx(M,{variant:"ghost",size:"sm",onClick:i,className:"mr-2 hover:bg-purple-100/20 hover:text-purple-700",children:e.jsx(Or,{className:"h-6 w-6"})}),e.jsx("span",{className:"font-semibold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:"Smart Up"})]}),t]})]})})},Nz=()=>{const{data:t}=Ye(),s=le(),{data:n}=Q({resource:"groups",filters:[{field:"vendor_id",operator:"eq",value:t?.vendor_id}],pagination:{current:1,pageSize:5}}),{data:i}=Q({resource:"courses",filters:[{field:"vendor_id",operator:"eq",value:t?.vendor_id}],pagination:{current:1,pageSize:5}}),{data:r}=Q({resource:"users",filters:[{field:"vendor_id",operator:"eq",value:t?.vendor_id},{field:"role",operator:"eq",value:"student"}],pagination:{current:1,pageSize:5}});return e.jsxs(Z,{children:[e.jsx(me,{title:`Witaj, ${t?.full_name||"Nauczycielu"}!`,description:"Szybki przegląd systemu"}),e.jsxs(nt,{variant:"1-2-3",children:[e.jsxs(I,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Grupy"}),e.jsx(ce,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n?.total||0}),e.jsxs(M,{variant:"link",size:"sm",className:"px-0 h-auto text-xs",onClick:()=>s("/teacher/groups"),children:["Zarządzaj grupami",e.jsx(Ce,{className:"w-3 h-3 ml-1"})]})]})]}),e.jsxs(I,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Kursy"}),e.jsx(xe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:i?.total||0}),e.jsxs(M,{variant:"link",size:"sm",className:"px-0 h-auto text-xs",onClick:()=>s("/teacher/courses"),children:["Przeglądaj kursy",e.jsx(Ce,{className:"w-3 h-3 ml-1"})]})]})]}),e.jsxs(I,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Uczniowie"}),e.jsx(Es,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r?.total||0}),e.jsxs(M,{variant:"link",size:"sm",className:"px-0 h-auto text-xs",onClick:()=>s("/teacher/users"),children:["Zobacz uczniów",e.jsx(Ce,{className:"w-3 h-3 ml-1"})]})]})]})]}),e.jsxs(nt,{variant:"1-2-2",children:[n?.data&&n.data.length>0&&e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Twoje grupy"})}),e.jsx(E,{children:e.jsx("div",{className:"space-y-2",children:n.data.slice(0,5).map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 cursor-pointer transition-colors",onClick:()=>s(`/teacher/groups/show/${a.id}`),children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:a.academic_year})]}),e.jsx(Ce,{className:"w-4 h-4 text-muted-foreground"})]},a.id))})})]}),i?.data&&i.data.length>0&&e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Twoje kursy"})}),e.jsx(E,{children:e.jsx("div",{className:"space-y-2",children:i.data.slice(0,5).map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 cursor-pointer transition-colors",onClick:()=>s(`/teacher/courses/show/${a.id}`),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[a.icon_emoji&&e.jsx("span",{className:"text-2xl",children:a.icon_emoji}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.title}),e.jsx("div",{className:"text-sm text-muted-foreground",children:a.is_published?"Opublikowany":"Szkic"})]})]}),e.jsx(Ce,{className:"w-4 h-4 text-muted-foreground"})]},a.id))})})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Szybkie akcje"})}),e.jsxs(E,{className:"grid gap-3",children:[e.jsxs(M,{variant:"outline",className:"justify-start h-auto py-3",onClick:()=>s("/teacher/courses/create"),children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"Utwórz nowy kurs"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Dodaj materiały i quizy dla uczniów"})]})]}),e.jsxs(M,{variant:"outline",className:"justify-start h-auto py-3",onClick:()=>s("/teacher/groups/create"),children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"Utwórz nową grupę"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Zorganizuj uczniów i przypisz kursy"})]})]})]})]})]})},kz=[e.jsx(H,{path:"/dashboard/overview",element:e.jsx(Nz,{})},"dashboard")];var zz="DismissableLayer",El="dismissableLayer.update",Sz="dismissableLayer.pointerDownOutside",Cz="dismissableLayer.focusOutside",_u,Jf=f.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Xf=f.forwardRef((t,s)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:i,onPointerDownOutside:r,onFocusOutside:a,onInteractOutside:o,onDismiss:l,...c}=t,d=f.useContext(Jf),[u,m]=f.useState(null),h=u?.ownerDocument??globalThis?.document,[,p]=f.useState({}),j=Os(s,N=>m(N)),y=Array.from(d.layers),[x]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),g=y.indexOf(x),b=u?y.indexOf(u):-1,v=d.layersWithOutsidePointerEventsDisabled.size>0,C=b>=g,T=Az(N=>{const S=N.target,P=[...d.branches].some(w=>w.contains(S));!C||P||(r?.(N),o?.(N),N.defaultPrevented||l?.())},h),z=Pz(N=>{const S=N.target;[...d.branches].some(w=>w.contains(S))||(a?.(N),o?.(N),N.defaultPrevented||l?.())},h);return My(N=>{b===d.layers.size-1&&(i?.(N),!N.defaultPrevented&&l&&(N.preventDefault(),l()))},h),f.useEffect(()=>{if(u)return n&&(d.layersWithOutsidePointerEventsDisabled.size===0&&(_u=h.body.style.pointerEvents,h.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(u)),d.layers.add(u),Tu(),()=>{n&&d.layersWithOutsidePointerEventsDisabled.size===1&&(h.body.style.pointerEvents=_u)}},[u,h,n,d]),f.useEffect(()=>()=>{u&&(d.layers.delete(u),d.layersWithOutsidePointerEventsDisabled.delete(u),Tu())},[u,d]),f.useEffect(()=>{const N=()=>p({});return document.addEventListener(El,N),()=>document.removeEventListener(El,N)},[]),e.jsx(Ss.div,{...c,ref:j,style:{pointerEvents:v?C?"auto":"none":void 0,...t.style},onFocusCapture:ye(t.onFocusCapture,z.onFocusCapture),onBlurCapture:ye(t.onBlurCapture,z.onBlurCapture),onPointerDownCapture:ye(t.onPointerDownCapture,T.onPointerDownCapture)})});Xf.displayName=zz;var _z="DismissableLayerBranch",Tz=f.forwardRef((t,s)=>{const n=f.useContext(Jf),i=f.useRef(null),r=Os(s,i);return f.useEffect(()=>{const a=i.current;if(a)return n.branches.add(a),()=>{n.branches.delete(a)}},[n.branches]),e.jsx(Ss.div,{...t,ref:r})});Tz.displayName=_z;function Az(t,s=globalThis?.document){const n=Ha(t),i=f.useRef(!1),r=f.useRef(()=>{});return f.useEffect(()=>{const a=l=>{if(l.target&&!i.current){let c=function(){ex(Sz,n,d,{discrete:!0})};const d={originalEvent:l};l.pointerType==="touch"?(s.removeEventListener("click",r.current),r.current=c,s.addEventListener("click",r.current,{once:!0})):c()}else s.removeEventListener("click",r.current);i.current=!1},o=window.setTimeout(()=>{s.addEventListener("pointerdown",a)},0);return()=>{window.clearTimeout(o),s.removeEventListener("pointerdown",a),s.removeEventListener("click",r.current)}},[s,n]),{onPointerDownCapture:()=>i.current=!0}}function Pz(t,s=globalThis?.document){const n=Ha(t),i=f.useRef(!1);return f.useEffect(()=>{const r=a=>{a.target&&!i.current&&ex(Cz,n,{originalEvent:a},{discrete:!1})};return s.addEventListener("focusin",r),()=>s.removeEventListener("focusin",r)},[s,n]),{onFocusCapture:()=>i.current=!0,onBlurCapture:()=>i.current=!1}}function Tu(){const t=new CustomEvent(El);document.dispatchEvent(t)}function ex(t,s,n,{discrete:i}){const r=n.originalEvent.target,a=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});s&&r.addEventListener(t,s,{once:!0}),i?Uh(r,a):r.dispatchEvent(a)}var nl=0;function Dz(){f.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??Au()),document.body.insertAdjacentElement("beforeend",t[1]??Au()),nl++,()=>{nl===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(s=>s.remove()),nl--}},[])}function Au(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var Ll=["Enter"," "],Mz=["ArrowDown","PageUp","Home"],tx=["ArrowUp","PageDown","End"],Iz=[...Mz,...tx],Ez={ltr:[...Ll,"ArrowRight"],rtl:[...Ll,"ArrowLeft"]},Lz={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Vr="Menu",[kr,Rz,Oz]=Iy(Vr),[qn,sx]=uc(Vr,[Oz,Vh,Kh]),Co=Vh(),nx=Kh(),[$z,Fn]=qn(Vr),[qz,Kr]=qn(Vr),ix=t=>{const{__scopeMenu:s,open:n=!1,children:i,dir:r,onOpenChange:a,modal:o=!0}=t,l=Co(s),[c,d]=f.useState(null),u=f.useRef(!1),m=Ha(a),h=Vy(r);return f.useEffect(()=>{const p=()=>{u.current=!0,document.addEventListener("pointerdown",j,{capture:!0,once:!0}),document.addEventListener("pointermove",j,{capture:!0,once:!0})},j=()=>u.current=!1;return document.addEventListener("keydown",p,{capture:!0}),()=>{document.removeEventListener("keydown",p,{capture:!0}),document.removeEventListener("pointerdown",j,{capture:!0}),document.removeEventListener("pointermove",j,{capture:!0})}},[]),e.jsx(Ky,{...l,children:e.jsx($z,{scope:s,open:n,onOpenChange:m,content:c,onContentChange:d,children:e.jsx(qz,{scope:s,onClose:f.useCallback(()=>m(!1),[m]),isUsingKeyboardRef:u,dir:h,modal:o,children:i})})})};ix.displayName=Vr;var Fz="MenuAnchor",Fc=f.forwardRef((t,s)=>{const{__scopeMenu:n,...i}=t,r=Co(n);return e.jsx(Ly,{...r,...i,ref:s})});Fc.displayName=Fz;var Bc="MenuPortal",[Bz,rx]=qn(Bc,{forceMount:void 0}),ax=t=>{const{__scopeMenu:s,forceMount:n,children:i,container:r}=t,a=Fn(Bc,s);return e.jsx(Bz,{scope:s,forceMount:n,children:e.jsx(Qa,{present:n||a.open,children:e.jsx(Ey,{asChild:!0,container:r,children:i})})})};ax.displayName=Bc;var Zt="MenuContent",[Uz,Uc]=qn(Zt),ox=f.forwardRef((t,s)=>{const n=rx(Zt,t.__scopeMenu),{forceMount:i=n.forceMount,...r}=t,a=Fn(Zt,t.__scopeMenu),o=Kr(Zt,t.__scopeMenu);return e.jsx(kr.Provider,{scope:t.__scopeMenu,children:e.jsx(Qa,{present:i||a.open,children:e.jsx(kr.Slot,{scope:t.__scopeMenu,children:o.modal?e.jsx(Vz,{...r,ref:s}):e.jsx(Kz,{...r,ref:s})})})})}),Vz=f.forwardRef((t,s)=>{const n=Fn(Zt,t.__scopeMenu),i=f.useRef(null),r=Os(s,i);return f.useEffect(()=>{const a=i.current;if(a)return Uy(a)},[]),e.jsx(Vc,{...t,ref:r,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:ye(t.onFocusOutside,a=>a.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),Kz=f.forwardRef((t,s)=>{const n=Fn(Zt,t.__scopeMenu);return e.jsx(Vc,{...t,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),Wz=$y("MenuContent.ScrollLock"),Vc=f.forwardRef((t,s)=>{const{__scopeMenu:n,loop:i=!1,trapFocus:r,onOpenAutoFocus:a,onCloseAutoFocus:o,disableOutsidePointerEvents:l,onEntryFocus:c,onEscapeKeyDown:d,onPointerDownOutside:u,onFocusOutside:m,onInteractOutside:h,onDismiss:p,disableOutsideScroll:j,...y}=t,x=Fn(Zt,n),g=Kr(Zt,n),b=Co(n),v=nx(n),C=Rz(n),[T,z]=f.useState(null),N=f.useRef(null),S=Os(s,N,x.onContentChange),P=f.useRef(0),w=f.useRef(""),k=f.useRef(0),_=f.useRef(null),A=f.useRef("right"),D=f.useRef(0),R=j?Oy:f.Fragment,L=j?{as:Wz,allowPinchZoom:!0}:void 0,F=q=>{const G=w.current+q,X=C().filter(fe=>!fe.disabled),V=document.activeElement,oe=X.find(fe=>fe.ref.current===V)?.textValue,Se=X.map(fe=>fe.textValue),it=i1(Se,G,oe),ze=X.find(fe=>fe.textValue===it)?.ref.current;(function fe(gt){w.current=gt,window.clearTimeout(P.current),gt!==""&&(P.current=window.setTimeout(()=>fe(""),1e3))})(G),ze&&setTimeout(()=>ze.focus())};f.useEffect(()=>()=>window.clearTimeout(P.current),[]),Dz();const K=f.useCallback(q=>A.current===_.current?.side&&a1(q,_.current?.area),[]);return e.jsx(Uz,{scope:n,searchRef:w,onItemEnter:f.useCallback(q=>{K(q)&&q.preventDefault()},[K]),onItemLeave:f.useCallback(q=>{K(q)||(N.current?.focus(),z(null))},[K]),onTriggerLeave:f.useCallback(q=>{K(q)&&q.preventDefault()},[K]),pointerGraceTimerRef:k,onPointerGraceIntentChange:f.useCallback(q=>{_.current=q},[]),children:e.jsx(R,{...L,children:e.jsx(qy,{asChild:!0,trapped:r,onMountAutoFocus:ye(a,q=>{q.preventDefault(),N.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:e.jsx(Xf,{asChild:!0,disableOutsidePointerEvents:l,onEscapeKeyDown:d,onPointerDownOutside:u,onFocusOutside:m,onInteractOutside:h,onDismiss:p,children:e.jsx(Fy,{asChild:!0,...v,dir:g.dir,orientation:"vertical",loop:i,currentTabStopId:T,onCurrentTabStopIdChange:z,onEntryFocus:ye(c,q=>{g.isUsingKeyboardRef.current||q.preventDefault()}),preventScrollOnEntryFocus:!0,children:e.jsx(By,{role:"menu","aria-orientation":"vertical","data-state":Nx(x.open),"data-radix-menu-content":"",dir:g.dir,...b,...y,ref:S,style:{outline:"none",...y.style},onKeyDown:ye(y.onKeyDown,q=>{const X=q.target.closest("[data-radix-menu-content]")===q.currentTarget,V=q.ctrlKey||q.altKey||q.metaKey,oe=q.key.length===1;X&&(q.key==="Tab"&&q.preventDefault(),!V&&oe&&F(q.key));const Se=N.current;if(q.target!==Se||!Iz.includes(q.key))return;q.preventDefault();const ze=C().filter(fe=>!fe.disabled).map(fe=>fe.ref.current);tx.includes(q.key)&&ze.reverse(),s1(ze)}),onBlur:ye(t.onBlur,q=>{q.currentTarget.contains(q.target)||(window.clearTimeout(P.current),w.current="")}),onPointerMove:ye(t.onPointerMove,zr(q=>{const G=q.target,X=D.current!==q.clientX;if(q.currentTarget.contains(G)&&X){const V=q.clientX>D.current?"right":"left";A.current=V,D.current=q.clientX}}))})})})})})})});ox.displayName=Zt;var Gz="MenuGroup",Kc=f.forwardRef((t,s)=>{const{__scopeMenu:n,...i}=t;return e.jsx(Ss.div,{role:"group",...i,ref:s})});Kc.displayName=Gz;var Hz="MenuLabel",lx=f.forwardRef((t,s)=>{const{__scopeMenu:n,...i}=t;return e.jsx(Ss.div,{...i,ref:s})});lx.displayName=Hz;var Ra="MenuItem",Pu="menu.itemSelect",_o=f.forwardRef((t,s)=>{const{disabled:n=!1,onSelect:i,...r}=t,a=f.useRef(null),o=Kr(Ra,t.__scopeMenu),l=Uc(Ra,t.__scopeMenu),c=Os(s,a),d=f.useRef(!1),u=()=>{const m=a.current;if(!n&&m){const h=new CustomEvent(Pu,{bubbles:!0,cancelable:!0});m.addEventListener(Pu,p=>i?.(p),{once:!0}),Uh(m,h),h.defaultPrevented?d.current=!1:o.onClose()}};return e.jsx(cx,{...r,ref:c,disabled:n,onClick:ye(t.onClick,u),onPointerDown:m=>{t.onPointerDown?.(m),d.current=!0},onPointerUp:ye(t.onPointerUp,m=>{d.current||m.currentTarget?.click()}),onKeyDown:ye(t.onKeyDown,m=>{const h=l.searchRef.current!=="";n||h&&m.key===" "||Ll.includes(m.key)&&(m.currentTarget.click(),m.preventDefault())})})});_o.displayName=Ra;var cx=f.forwardRef((t,s)=>{const{__scopeMenu:n,disabled:i=!1,textValue:r,...a}=t,o=Uc(Ra,n),l=nx(n),c=f.useRef(null),d=Os(s,c),[u,m]=f.useState(!1),[h,p]=f.useState("");return f.useEffect(()=>{const j=c.current;j&&p((j.textContent??"").trim())},[a.children]),e.jsx(kr.ItemSlot,{scope:n,disabled:i,textValue:r??h,children:e.jsx(Ry,{asChild:!0,...l,focusable:!i,children:e.jsx(Ss.div,{role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":i||void 0,"data-disabled":i?"":void 0,...a,ref:d,onPointerMove:ye(t.onPointerMove,zr(j=>{i?o.onItemLeave(j):(o.onItemEnter(j),j.defaultPrevented||j.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:ye(t.onPointerLeave,zr(j=>o.onItemLeave(j))),onFocus:ye(t.onFocus,()=>m(!0)),onBlur:ye(t.onBlur,()=>m(!1))})})})}),Qz="MenuCheckboxItem",dx=f.forwardRef((t,s)=>{const{checked:n=!1,onCheckedChange:i,...r}=t;return e.jsx(fx,{scope:t.__scopeMenu,checked:n,children:e.jsx(_o,{role:"menuitemcheckbox","aria-checked":Oa(n)?"mixed":n,...r,ref:s,"data-state":Gc(n),onSelect:ye(r.onSelect,()=>i?.(Oa(n)?!0:!n),{checkForDefaultPrevented:!1})})})});dx.displayName=Qz;var ux="MenuRadioGroup",[Zz,Yz]=qn(ux,{value:void 0,onValueChange:()=>{}}),mx=f.forwardRef((t,s)=>{const{value:n,onValueChange:i,...r}=t,a=Ha(i);return e.jsx(Zz,{scope:t.__scopeMenu,value:n,onValueChange:a,children:e.jsx(Kc,{...r,ref:s})})});mx.displayName=ux;var hx="MenuRadioItem",px=f.forwardRef((t,s)=>{const{value:n,...i}=t,r=Yz(hx,t.__scopeMenu),a=n===r.value;return e.jsx(fx,{scope:t.__scopeMenu,checked:a,children:e.jsx(_o,{role:"menuitemradio","aria-checked":a,...i,ref:s,"data-state":Gc(a),onSelect:ye(i.onSelect,()=>r.onValueChange?.(n),{checkForDefaultPrevented:!1})})})});px.displayName=hx;var Wc="MenuItemIndicator",[fx,Jz]=qn(Wc,{checked:!1}),xx=f.forwardRef((t,s)=>{const{__scopeMenu:n,forceMount:i,...r}=t,a=Jz(Wc,n);return e.jsx(Qa,{present:i||Oa(a.checked)||a.checked===!0,children:e.jsx(Ss.span,{...r,ref:s,"data-state":Gc(a.checked)})})});xx.displayName=Wc;var Xz="MenuSeparator",gx=f.forwardRef((t,s)=>{const{__scopeMenu:n,...i}=t;return e.jsx(Ss.div,{role:"separator","aria-orientation":"horizontal",...i,ref:s})});gx.displayName=Xz;var e1="MenuArrow",jx=f.forwardRef((t,s)=>{const{__scopeMenu:n,...i}=t,r=Co(n);return e.jsx(Wy,{...r,...i,ref:s})});jx.displayName=e1;var t1="MenuSub",[VD,yx]=qn(t1),sr="MenuSubTrigger",wx=f.forwardRef((t,s)=>{const n=Fn(sr,t.__scopeMenu),i=Kr(sr,t.__scopeMenu),r=yx(sr,t.__scopeMenu),a=Uc(sr,t.__scopeMenu),o=f.useRef(null),{pointerGraceTimerRef:l,onPointerGraceIntentChange:c}=a,d={__scopeMenu:t.__scopeMenu},u=f.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return f.useEffect(()=>u,[u]),f.useEffect(()=>{const m=l.current;return()=>{window.clearTimeout(m),c(null)}},[l,c]),e.jsx(Fc,{asChild:!0,...d,children:e.jsx(cx,{id:r.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":r.contentId,"data-state":Nx(n.open),...t,ref:Wh(s,r.onTriggerChange),onClick:m=>{t.onClick?.(m),!(t.disabled||m.defaultPrevented)&&(m.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:ye(t.onPointerMove,zr(m=>{a.onItemEnter(m),!m.defaultPrevented&&!t.disabled&&!n.open&&!o.current&&(a.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{n.onOpenChange(!0),u()},100))})),onPointerLeave:ye(t.onPointerLeave,zr(m=>{u();const h=n.content?.getBoundingClientRect();if(h){const p=n.content?.dataset.side,j=p==="right",y=j?-5:5,x=h[j?"left":"right"],g=h[j?"right":"left"];a.onPointerGraceIntentChange({area:[{x:m.clientX+y,y:m.clientY},{x,y:h.top},{x:g,y:h.top},{x:g,y:h.bottom},{x,y:h.bottom}],side:p}),window.clearTimeout(l.current),l.current=window.setTimeout(()=>a.onPointerGraceIntentChange(null),300)}else{if(a.onTriggerLeave(m),m.defaultPrevented)return;a.onPointerGraceIntentChange(null)}})),onKeyDown:ye(t.onKeyDown,m=>{const h=a.searchRef.current!=="";t.disabled||h&&m.key===" "||Ez[i.dir].includes(m.key)&&(n.onOpenChange(!0),n.content?.focus(),m.preventDefault())})})})});wx.displayName=sr;var bx="MenuSubContent",vx=f.forwardRef((t,s)=>{const n=rx(Zt,t.__scopeMenu),{forceMount:i=n.forceMount,...r}=t,a=Fn(Zt,t.__scopeMenu),o=Kr(Zt,t.__scopeMenu),l=yx(bx,t.__scopeMenu),c=f.useRef(null),d=Os(s,c);return e.jsx(kr.Provider,{scope:t.__scopeMenu,children:e.jsx(Qa,{present:i||a.open,children:e.jsx(kr.Slot,{scope:t.__scopeMenu,children:e.jsx(Vc,{id:l.contentId,"aria-labelledby":l.triggerId,...r,ref:d,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:u=>{o.isUsingKeyboardRef.current&&c.current?.focus(),u.preventDefault()},onCloseAutoFocus:u=>u.preventDefault(),onFocusOutside:ye(t.onFocusOutside,u=>{u.target!==l.trigger&&a.onOpenChange(!1)}),onEscapeKeyDown:ye(t.onEscapeKeyDown,u=>{o.onClose(),u.preventDefault()}),onKeyDown:ye(t.onKeyDown,u=>{const m=u.currentTarget.contains(u.target),h=Lz[o.dir].includes(u.key);m&&h&&(a.onOpenChange(!1),l.trigger?.focus(),u.preventDefault())})})})})})});vx.displayName=bx;function Nx(t){return t?"open":"closed"}function Oa(t){return t==="indeterminate"}function Gc(t){return Oa(t)?"indeterminate":t?"checked":"unchecked"}function s1(t){const s=document.activeElement;for(const n of t)if(n===s||(n.focus(),document.activeElement!==s))return}function n1(t,s){return t.map((n,i)=>t[(s+i)%t.length])}function i1(t,s,n){const r=s.length>1&&Array.from(s).every(d=>d===s[0])?s[0]:s,a=n?t.indexOf(n):-1;let o=n1(t,Math.max(a,0));r.length===1&&(o=o.filter(d=>d!==n));const c=o.find(d=>d.toLowerCase().startsWith(r.toLowerCase()));return c!==n?c:void 0}function r1(t,s){const{x:n,y:i}=t;let r=!1;for(let a=0,o=s.length-1;a<s.length;o=a++){const l=s[a],c=s[o],d=l.x,u=l.y,m=c.x,h=c.y;u>i!=h>i&&n<(m-d)*(i-u)/(h-u)+d&&(r=!r)}return r}function a1(t,s){if(!s)return!1;const n={x:t.clientX,y:t.clientY};return r1(n,s)}function zr(t){return s=>s.pointerType==="mouse"?t(s):void 0}var o1=ix,l1=Fc,c1=ax,d1=ox,u1=Kc,m1=lx,h1=_o,p1=dx,f1=mx,x1=px,g1=xx,j1=gx,y1=jx,w1=wx,b1=vx,To="DropdownMenu",[v1,KD]=uc(To,[sx]),St=sx(),[N1,kx]=v1(To),zx=t=>{const{__scopeDropdownMenu:s,children:n,dir:i,open:r,defaultOpen:a,onOpenChange:o,modal:l=!0}=t,c=St(s),d=f.useRef(null),[u,m]=Lh({prop:r,defaultProp:a??!1,onChange:o,caller:To});return e.jsx(N1,{scope:s,triggerId:Kd(),triggerRef:d,contentId:Kd(),open:u,onOpenChange:m,onOpenToggle:f.useCallback(()=>m(h=>!h),[m]),modal:l,children:e.jsx(o1,{...c,open:u,onOpenChange:m,dir:i,modal:l,children:n})})};zx.displayName=To;var Sx="DropdownMenuTrigger",Cx=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,disabled:i=!1,...r}=t,a=kx(Sx,n),o=St(n);return e.jsx(l1,{asChild:!0,...o,children:e.jsx(Ss.button,{type:"button",id:a.triggerId,"aria-haspopup":"menu","aria-expanded":a.open,"aria-controls":a.open?a.contentId:void 0,"data-state":a.open?"open":"closed","data-disabled":i?"":void 0,disabled:i,...r,ref:Wh(s,a.triggerRef),onPointerDown:ye(t.onPointerDown,l=>{!i&&l.button===0&&l.ctrlKey===!1&&(a.onOpenToggle(),a.open||l.preventDefault())}),onKeyDown:ye(t.onKeyDown,l=>{i||(["Enter"," "].includes(l.key)&&a.onOpenToggle(),l.key==="ArrowDown"&&a.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(l.key)&&l.preventDefault())})})})});Cx.displayName=Sx;var k1="DropdownMenuPortal",_x=t=>{const{__scopeDropdownMenu:s,...n}=t,i=St(s);return e.jsx(c1,{...i,...n})};_x.displayName=k1;var Tx="DropdownMenuContent",Ax=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=kx(Tx,n),a=St(n),o=f.useRef(!1);return e.jsx(d1,{id:r.contentId,"aria-labelledby":r.triggerId,...a,...i,ref:s,onCloseAutoFocus:ye(t.onCloseAutoFocus,l=>{o.current||r.triggerRef.current?.focus(),o.current=!1,l.preventDefault()}),onInteractOutside:ye(t.onInteractOutside,l=>{const c=l.detail.originalEvent,d=c.button===0&&c.ctrlKey===!0,u=c.button===2||d;(!r.modal||u)&&(o.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Ax.displayName=Tx;var z1="DropdownMenuGroup",S1=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=St(n);return e.jsx(u1,{...r,...i,ref:s})});S1.displayName=z1;var C1="DropdownMenuLabel",Px=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=St(n);return e.jsx(m1,{...r,...i,ref:s})});Px.displayName=C1;var _1="DropdownMenuItem",Dx=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=St(n);return e.jsx(h1,{...r,...i,ref:s})});Dx.displayName=_1;var T1="DropdownMenuCheckboxItem",Mx=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=St(n);return e.jsx(p1,{...r,...i,ref:s})});Mx.displayName=T1;var A1="DropdownMenuRadioGroup",P1=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=St(n);return e.jsx(f1,{...r,...i,ref:s})});P1.displayName=A1;var D1="DropdownMenuRadioItem",Ix=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=St(n);return e.jsx(x1,{...r,...i,ref:s})});Ix.displayName=D1;var M1="DropdownMenuItemIndicator",Ex=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=St(n);return e.jsx(g1,{...r,...i,ref:s})});Ex.displayName=M1;var I1="DropdownMenuSeparator",Lx=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=St(n);return e.jsx(j1,{...r,...i,ref:s})});Lx.displayName=I1;var E1="DropdownMenuArrow",L1=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=St(n);return e.jsx(y1,{...r,...i,ref:s})});L1.displayName=E1;var R1="DropdownMenuSubTrigger",Rx=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=St(n);return e.jsx(w1,{...r,...i,ref:s})});Rx.displayName=R1;var O1="DropdownMenuSubContent",Ox=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=St(n);return e.jsx(b1,{...r,...i,ref:s,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Ox.displayName=O1;var $1=zx,q1=Cx,F1=_x,$x=Ax,qx=Px,Fx=Dx,Bx=Mx,Ux=Ix,Vx=Ex,Kx=Lx,Wx=Rx,Gx=Ox;const ki=$1,zi=q1,B1=f.forwardRef(({className:t,inset:s,children:n,...i},r)=>e.jsxs(Wx,{ref:r,className:U("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s&&"pl-8",t),...i,children:[n,e.jsx(Ae,{className:"ml-auto"})]}));B1.displayName=Wx.displayName;const U1=f.forwardRef(({className:t,...s},n)=>e.jsx(Gx,{ref:n,className:U("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...s}));U1.displayName=Gx.displayName;const Dn=f.forwardRef(({className:t,sideOffset:s=4,...n},i)=>e.jsx(F1,{children:e.jsx($x,{ref:i,sideOffset:s,className:U("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...n})}));Dn.displayName=$x.displayName;const _e=f.forwardRef(({className:t,inset:s,...n},i)=>e.jsx(Fx,{ref:i,className:U("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",s&&"pl-8",t),...n}));_e.displayName=Fx.displayName;const V1=f.forwardRef(({className:t,children:s,checked:n,...i},r)=>e.jsxs(Bx,{ref:r,className:U("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:n,...i,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Vx,{children:e.jsx($t,{className:"h-4 w-4"})})}),s]}));V1.displayName=Bx.displayName;const K1=f.forwardRef(({className:t,children:s,...n},i)=>e.jsxs(Ux,{ref:i,className:U("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Vx,{children:e.jsx(ir,{className:"h-2 w-2 fill-current"})})}),s]}));K1.displayName=Ux.displayName;const Hx=f.forwardRef(({className:t,inset:s,...n},i)=>e.jsx(qx,{ref:i,className:U("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",t),...n}));Hx.displayName=qx.displayName;const Nt=f.forwardRef(({className:t,...s},n)=>e.jsx(Kx,{ref:n,className:U("-mx-1 my-1 h-px bg-muted",t),...s}));Nt.displayName=Kx.displayName;const W1=()=>{const t=le(),s=ms(),n=()=>{const o=`${s.pathname}${s.search}`;sessionStorage.setItem("returnUrl",o)};return{navigateWithReturn:o=>{n(),t(o)},goBack:o=>{const l=sessionStorage.getItem("returnUrl");l?(sessionStorage.removeItem("returnUrl"),t(l)):t(o||-1)},saveReturnUrl:n,navigateToWizard:(o,l)=>{l&&sessionStorage.setItem("wizardContext",JSON.stringify(l)),n(),t(o)},currentUrl:`${s.pathname}${s.search}`}},Rl=t=>{const{mutate:s,isLoading:n}=En();return{togglePublish:async(r,a,o,l)=>{s({resource:t,id:r,values:{is_published:!a}},{onSuccess:()=>{W.success(a?`${o} został ukryty`:`${o} został opublikowany`),l?.()},onError:c=>{W.error("Nie udało się zmienić statusu publikacji"),console.error("Publish toggle error:",c)}})},isToggling:n}},Du=t=>{const{mutate:s}=En(),n=Jh(),[i,r]=f.useState(!1);return{updatePosition:f.useCallback(async(o,l)=>{if(!i){r(!0);try{await new Promise((c,d)=>{s({resource:t,id:o,values:{position:l},mutationMode:"optimistic"},{onSuccess:()=>{console.log(`Updated position for ${t} ${o} to ${l}`),c()},onError:u=>d(u)})}),setTimeout(()=>{n({resource:t,invalidates:["list"]})},1e3)}catch(c){console.error("Position update error:",c),W.error("Nie udało się zaktualizować pozycji"),await n({resource:t,invalidates:["list"]})}finally{r(!1)}}},[t,s,n,i]),isUpdating:i}},G1=t=>{const{data:s,isLoading:n}=Le({resource:"courses",id:t,queryOptions:{enabled:!!t}}),{data:i,isLoading:r,refetch:a}=Q({resource:"topics",filters:[{field:"course_id",operator:"eq",value:t}],sorters:[{field:"position",order:"asc"}],pagination:{mode:"off"},meta:{select:"*, activities(count)"},queryOptions:{enabled:!!t}}),{data:o,refetch:l}=Q({resource:"activities",filters:[{field:"topic_id",operator:"in",value:i?.data?.map(x=>x.id)||[]}],sorters:[{field:"position",order:"asc"}],pagination:{mode:"off"},meta:{select:"*, questions(count)"},queryOptions:{enabled:!!i?.data?.length}}),{data:c}=Q({resource:"course_access",filters:[{field:"course_id",operator:"eq",value:t}],queryOptions:{enabled:!!t}}),d=c?.data?.filter(x=>x.group_id).map(x=>x.group_id)||[],{data:u}=Q({resource:"groups",filters:d.length>0?[{field:"id",operator:"in",value:d}]:[],pagination:{mode:"off"},queryOptions:{enabled:d.length>0}}),{data:m}=Q({resource:"group_members",filters:d.length>0?[{field:"group_id",operator:"in",value:d}]:[],pagination:{mode:"off"},meta:{select:"group_id"},queryOptions:{enabled:d.length>0}}),h=n||r,p={topicsCount:i?.total||0,activitiesCount:o?.total||0,accessCount:c?.total||0},j=x=>o?.data?.filter(g=>g.topic_id===x)||[],y=x=>m?.data?.filter(g=>g.group_id===x).length||0;return{course:s?.data,topics:i?.data||[],activities:o?.data||[],groups:u?.data||[],access:c?.data||[],stats:p,isLoading:h,refetchTopics:a,refetchActivities:l,getActivitiesForTopic:j,getMembersCountForGroup:y}},H1=()=>{const{create:t,edit:s,show:n}=xt(),{mutate:i}=Is(),{togglePublish:r}=Rl("courses"),{data:a}=Ye(),[o,l]=f.useState(""),{data:c,isLoading:d,isError:u,refetch:m}=Q({resource:"courses",pagination:{mode:"off"},sorters:[{field:"created_at",order:"desc"}]}),{data:h,isLoading:p}=Q({resource:"course_access",filters:a?.role==="teacher"?[{field:"teacher_id",operator:"eq",value:a?.id}]:[],pagination:{mode:"off"},queryOptions:{enabled:!!a?.id&&a?.role==="teacher"}}),{data:j}=Q({resource:"topics",pagination:{mode:"off"},meta:{select:"course_id"}}),{data:y}=Q({resource:"course_access",pagination:{mode:"off"},meta:{select:"course_id"}}),x=f.useMemo(()=>h?.data?.map(w=>w.course_id)||[],[h?.data]),g=f.useMemo(()=>{let w=c?.data||[];return a?.role==="teacher"&&(w=w.filter(k=>x.includes(k.id))),o&&(w=w.filter(k=>k.title.toLowerCase().includes(o.toLowerCase()))),w},[c?.data,x,a?.role,o]),b=w=>{const k=j?.data?.filter(A=>A.course_id===w).length||0,_=y?.data?.filter(A=>A.course_id===w).length||0;return{topicsCount:k,accessCount:_}},v=(w,k)=>{confirm(`Czy na pewno chcesz usunąć kurs "${k}"?`)&&i({resource:"courses",id:w},{onSuccess:()=>{W.success("Kurs został usunięty"),m()}})},C=(w,k,_)=>{window.location.href=w},T=d||a?.role==="teacher"&&p,N=yc({isLoading:T,isError:u});if(N)return N;const S=a?.role==="teacher",P=a?.role==="admin";return e.jsxs(Z,{children:[e.jsxs(ie,{children:[e.jsx(me,{title:"Moje kursy",description:P?"Zarządzaj wszystkimi kursami w systemie":"Kursy, które prowadzisz"}),P&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Xn,{children:e.jsxs(ei,{children:[e.jsx(ti,{asChild:!0,children:e.jsxs(M,{variant:"outline",onClick:()=>C("/teacher/course-structure/step1"),children:[e.jsx(_a,{className:"w-4 h-4 mr-2"}),e.jsx(pt,{className:"w-3 h-3"})]})}),e.jsx(jn,{children:e.jsx("p",{children:"Stwórz kurs z pomocą AI"})})]})}),e.jsxs(M,{onClick:()=>t("courses"),children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Dodaj kurs"]})]})]}),e.jsxs(ie,{children:[e.jsx(J,{placeholder:"Szukaj kursów...",className:"max-w-sm",value:o,onChange:w=>l(w.target.value)}),S&&e.jsx(B,{variant:"outline",children:"Pokazuję tylko kursy, które prowadzisz"})]}),e.jsx(nt,{children:g.map(w=>{const k=b(w.id);return e.jsxs(I,{className:`relative cursor-pointer transition-all duration-200 ${w.is_published?"hover:shadow-lg":"opacity-80 hover:opacity-90 "}`,onClick:_=>{_.target.closest('[role="menu"]')||n("courses",w.id)},children:[e.jsx(O,{children:e.jsxs(ie,{children:[e.jsxs($,{className:"flex items-center gap-2 min-w-0",children:[e.jsx("span",{className:"flex-shrink-0",children:w.icon_emoji?e.jsx("span",{className:"text-2xl",children:w.icon_emoji}):e.jsx(xe,{className:"w-5 h-5"})}),e.jsx(Xn,{delayDuration:200,children:e.jsxs(ei,{children:[e.jsx(ti,{asChild:!0,children:e.jsx("span",{className:"truncate",children:w.title})}),w.title.length>30&&e.jsx(jn,{children:e.jsx("p",{className:"max-w-xs",children:w.title})})]})})]}),e.jsxs(ki,{children:[e.jsx(zi,{asChild:!0,children:e.jsx(M,{variant:"ghost",size:"sm",onClick:_=>_.stopPropagation(),children:e.jsx(io,{className:"h-4 w-4"})})}),e.jsxs(Dn,{align:"end",children:[e.jsxs(_e,{onClick:()=>n("courses",w.id),children:[e.jsx(tt,{className:"mr-2 h-4 w-4"}),"Podgląd"]}),P&&e.jsxs(e.Fragment,{children:[e.jsxs(_e,{onClick:()=>s("courses",w.id),children:[e.jsx(Cs,{className:"mr-2 h-4 w-4"}),"Edytuj"]}),e.jsx(Nt,{}),e.jsx(_e,{onClick:()=>r(w.id,w.is_published,w.title,m),children:w.is_published?e.jsxs(e.Fragment,{children:[e.jsx(dn,{className:"mr-2 h-4 w-4"}),"Ukryj kurs"]}):e.jsxs(e.Fragment,{children:[e.jsx(tt,{className:"mr-2 h-4 w-4"}),"Opublikuj kurs"]})})]}),e.jsx(Nt,{}),P&&e.jsxs(e.Fragment,{children:[e.jsx(Nt,{}),e.jsxs(_e,{onClick:()=>v(w.id,w.title),className:"text-red-600 focus:text-red-600",children:[e.jsx(dt,{className:"mr-2 h-4 w-4"}),"Usuń"]})]})]})]})]})}),e.jsxs(E,{children:[w.description&&e.jsx("p",{className:"text-sm text-muted-foreground mb-3 line-clamp-2",children:w.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex gap-2",children:e.jsx(B,{variant:w.is_published?"default":"secondary",className:w.is_published?"bg-green-600":"",children:w.is_published?"Opublikowany":"Szkic"})}),e.jsxs("div",{className:"flex gap-3 text-sm text-muted-foreground",children:[e.jsx(Xn,{children:e.jsxs(ei,{children:[e.jsx(ti,{asChild:!0,children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(kt,{className:"w-3 h-3"}),k.topicsCount]})}),e.jsx(jn,{children:e.jsx("p",{children:"Liczba tematów"})})]})}),e.jsx(Xn,{children:e.jsxs(ei,{children:[e.jsx(ti,{asChild:!0,children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:"w-3 h-3"}),k.accessCount]})}),e.jsx(jn,{children:e.jsx("p",{children:"Liczba przypisań"})})]})})]})]}),w.created_at&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-xs text-muted-foreground",children:[e.jsx(De,{className:"w-3 h-3"}),e.jsxs("span",{children:["Utworzono:"," ",new Date(w.created_at).toLocaleDateString("pl-PL")]})]})]})]},w.id)})}),g.length===0&&e.jsx(I,{className:"border-dashed border-2",children:e.jsx(E,{className:"text-center py-12",children:S?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Nie prowadzisz jeszcze żadnych kursów"}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:"Operator systemu tworzy kursy i przypisuje do nich nauczycieli. Skontaktuj się z operatorem, aby uzyskać dostęp do kursów, które będziesz prowadzić."}),e.jsx("div",{className:"flex gap-3 justify-center",children:e.jsxs(M,{variant:"outline",disabled:!0,children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Kursy tworzy operator"]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(_a,{className:"w-12 h-12 mx-auto mb-4 text-indigo-600"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Brak kursów"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Rozpocznij od stworzenia pierwszego kursu"}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsxs(M,{variant:"outline",onClick:()=>t("courses"),children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Dodaj ręcznie"]}),e.jsxs(M,{onClick:()=>C("/teacher/course-structure/step1"),className:"bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700",children:[e.jsx(pt,{className:"w-4 h-4 mr-2"}),"Wygeneruj z AI"]})]})]})})})]})},mn=({children:t,onSubmit:s,className:n="",...i})=>{const r="space-y-6",a=n?`${r} ${n}`:r;return e.jsx("form",{onSubmit:s,className:a,...i,children:t})},de=({children:t,label:s,htmlFor:n,error:i,required:r=!1,className:a="",hint:o})=>{const l="space-y-2",c=a?`${l} ${a}`:l,d=()=>s?typeof s=="string"?e.jsxs(Tn,{htmlFor:n,children:[s,r&&e.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}):e.jsxs(Tn,{htmlFor:n,className:"flex items-center",children:[s,r&&e.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}):null,u=f.isValidElement(t)?f.cloneElement(t,{className:`${t.props.className||""} ${i?"border-red-500 ring-1 ring-red-500":""}`.trim()}):t;return e.jsxs("div",{className:c,children:[d(),u,o&&!i&&e.jsx("p",{className:"text-sm text-muted-foreground",children:o}),i&&e.jsx("p",{className:"text-sm text-red-500",children:i})]})},hn=({children:t,className:s=""})=>{const n="flex justify-end items-center gap-4 pt-6 border-t",i=s?`${n} ${s}`:n;return e.jsx("div",{className:i,children:t})},Q1=["📚","🎓","💡","🚀","⭐","🏆","🎯","📖","✏️","🧮"],Z1=()=>{const{list:t}=xt(),{data:s}=Ye(),[n,i]=f.useState(!1),{refineCore:{onFinish:r},register:a,handleSubmit:o,setValue:l,watch:c,formState:{errors:d,isSubmitting:u}}=ln({defaultValues:{title:"",description:"",vendor_id:s?.vendor_id||0,is_published:!1,icon_emoji:"📚"}}),m=c("icon_emoji");return e.jsxs(Z,{children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>t("courses"),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsx(ie,{children:e.jsx(me,{title:"Dodaj kurs",description:"Utwórz nowy kurs w systemie"})}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Informacje o kursie"})}),e.jsx(E,{children:e.jsxs(mn,{onSubmit:o(r),children:[e.jsxs(nt,{variant:"1-2-2",children:[e.jsx(de,{label:"Tytuł kursu",htmlFor:"title",error:d.title?.message?.toString(),required:!0,children:e.jsx(J,{id:"title",placeholder:"np. Podstawy programowania",...a("title",{required:"Tytuł kursu jest wymagany",minLength:{value:3,message:"Tytuł musi mieć minimum 3 znaki"}})})}),e.jsx(de,{label:"Ikona kursu",htmlFor:"icon_emoji",children:e.jsxs("div",{className:"relative",children:[e.jsxs(M,{type:"button",variant:"outline",className:"w-full justify-start",onClick:()=>i(!n),children:[e.jsx("span",{className:"text-2xl mr-2",children:m||"📚"}),"Wybierz ikonę"]}),n&&e.jsx("div",{className:"absolute top-full mt-2 p-2 bg-white border rounded-lg shadow-lg z-10",children:e.jsx("div",{className:"grid grid-cols-5 gap-2",children:Q1.map(h=>e.jsx("button",{type:"button",className:"p-2 hover:bg-gray-100 rounded text-2xl",onClick:()=>{l("icon_emoji",h),i(!1)},children:h},h))})})]})})]}),e.jsx(de,{label:"Opis kursu",htmlFor:"description",error:d.description?.message?.toString(),children:e.jsx(cs,{id:"description",placeholder:"Opisz czego uczniowie nauczą się na tym kursie...",rows:4,...a("description")})}),e.jsx(de,{label:"Status publikacji",children:e.jsxs(ie,{variant:"start",children:[e.jsx(zt,{checked:c("is_published")||!1,onCheckedChange:h=>l("is_published",h)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Opublikuj kurs od razu (możesz to zmienić później)"})]})}),e.jsxs(hn,{children:[e.jsx(M,{type:"button",variant:"outline",onClick:()=>t("courses"),children:"Anuluj"}),e.jsx(M,{type:"submit",disabled:u,children:u?"Tworzenie...":"Utwórz kurs"})]})]})})]})]})},Y1=["📚","🎓","💡","🚀","⭐","🏆","🎯","📖","✏️","🧮"],J1=()=>{const{list:t}=xt(),{id:s}=ft(),[n,i]=f.useState(!1),{data:r,isLoading:a}=Le({resource:"courses",id:s,liveMode:"off"}),{refineCore:{onFinish:o},register:l,handleSubmit:c,setValue:d,watch:u,formState:{errors:m,isSubmitting:h}}=ln({refineCoreProps:{resource:"courses",id:s,liveMode:"off"}}),p=u("icon_emoji");return a?e.jsx(Z,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):e.jsxs(Z,{children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>t("courses"),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsx(ie,{children:e.jsx(me,{title:"Edytuj kurs",description:`Edycja kursu: ${r?.data?.title}`})}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Informacje o kursie"})}),e.jsx(E,{children:e.jsxs(mn,{onSubmit:c(o),children:[e.jsxs(nt,{variant:"1-2-2",children:[e.jsx(de,{label:"Tytuł kursu",htmlFor:"title",error:m.title?.message,required:!0,children:e.jsx(J,{id:"title",placeholder:"np. Podstawy programowania",...l("title",{required:"Tytuł kursu jest wymagany",minLength:{value:3,message:"Tytuł musi mieć minimum 3 znaki"}})})}),e.jsx(de,{label:"Ikona kursu",htmlFor:"icon_emoji",children:e.jsxs("div",{className:"relative",children:[e.jsxs(M,{type:"button",variant:"outline",className:"w-full justify-start",onClick:()=>i(!n),children:[e.jsx("span",{className:"text-2xl mr-2",children:p||"📚"}),"Wybierz ikonę"]}),n&&e.jsx("div",{className:"absolute top-full mt-2 p-2 bg-white border rounded-lg shadow-lg z-10",children:e.jsx("div",{className:"grid grid-cols-5 gap-2",children:Y1.map(j=>e.jsx("button",{type:"button",className:"p-2 hover:bg-gray-100 rounded text-2xl",onClick:()=>{d("icon_emoji",j),i(!1)},children:j},j))})})]})})]}),e.jsx(de,{label:"Opis kursu",htmlFor:"description",error:m.description?.message,children:e.jsx(cs,{id:"description",placeholder:"Opisz czego uczniowie nauczą się na tym kursie...",rows:4,...l("description")})}),e.jsx(de,{label:"Status publikacji",children:e.jsxs(ie,{variant:"start",children:[e.jsx(zt,{checked:u("is_published")||!1,onCheckedChange:j=>d("is_published",j)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Kurs jest opublikowany i widoczny dla uczniów"})]})}),e.jsxs(hn,{children:[e.jsx(M,{type:"button",variant:"outline",onClick:()=>t("courses"),children:"Anuluj"}),e.jsx(M,{type:"submit",disabled:h,children:h?"Zapisywanie...":"Zapisz zmiany"})]})]})})]})]})},X1=({topic:t,isExpanded:s,onToggle:n,onDelete:i,onEdit:r,onTogglePublish:a,onNavigateToWizard:o,courseId:l,courseTitle:c,children:d,activitiesCount:u,dragHandleProps:m})=>{const h=le(),p=y=>{const x=window.location.pathname+window.location.search;sessionStorage.setItem("returnUrl",x),h(y)},j=(y,x)=>{o&&o(y,{courseId:l,courseTitle:c,topicId:t.id,topicTitle:t.title,...x})};return e.jsxs("div",{className:`border-2 rounded-lg overflow-hidden group ${s?"shadow-lg border-primary":"border-border hover:border-primary/50"}`,children:[e.jsx("div",{className:`p-4 ${s?"bg-primary text-primary-foreground":"bg-background hover:bg-muted"}`,children:e.jsxs(ie,{children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("button",{onClick:n,className:`p-1 rounded ${s?"text-primary-foreground hover:bg-primary-foreground/20":"hover:bg-muted"}`,"aria-label":s?"Zwiń temat":"Rozwiń temat",children:s?e.jsx(Dt,{className:"w-5 h-5"}):e.jsx(Ae,{className:"w-5 h-5"})}),e.jsx("div",{className:"cursor-move",...m,children:e.jsx(np,{className:`w-4 h-4 ${s?"text-primary-foreground/70":"text-muted-foreground"}`})}),e.jsxs("div",{className:"flex-1 cursor-pointer group",onClick:n,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h4",{className:`font-semibold text-base ${s?"text-primary-foreground":"group-hover:text-primary"}`,children:["Temat ",t.position,": ",t.title]}),e.jsx(B,{variant:t.is_published?s?"secondary":"default":"outline",className:s?"bg-primary-foreground/20 text-primary-foreground border-primary-foreground/30":"",children:t.is_published?"Opublikowany":"Szkic"})]}),e.jsx("div",{className:"flex items-center gap-4 mt-1",children:e.jsxs("span",{className:`text-sm flex items-center gap-1 ${s?"text-primary-foreground/80":"text-muted-foreground"}`,children:[e.jsx(kt,{className:"w-3 h-3"}),u," ",u===1?"aktywność":"aktywności"]})})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(ki,{children:[e.jsx(zi,{asChild:!0,children:e.jsx(M,{size:"sm",variant:s?"secondary":"ghost",title:"Dodaj aktywność",className:`h-8 w-8 p-0 ${s?"bg-primary-foreground/20 hover:bg-primary-foreground/30 text-primary-foreground":""}`,children:e.jsx(Qe,{className:"h-4 w-4"})})}),e.jsxs(Dn,{align:"end",children:[e.jsx(Hx,{children:"Dodaj treść"}),e.jsxs(_e,{onClick:()=>p(`/activities/create?topic_id=${t.id}`),children:[e.jsx(Qe,{className:"mr-2 h-4 w-4"}),"Dodaj ręcznie"]}),e.jsx(Nt,{}),e.jsxs(_e,{onClick:()=>j("/teacher/educational-material/step1"),className:"text-purple-600 focus:text-purple-600",children:[e.jsx(pt,{className:"mr-2 h-4 w-4"}),"Generuj materiał z AI"]}),e.jsxs(_e,{onClick:()=>j("/teacher/quiz-wizard/step1"),className:"text-blue-600 focus:text-blue-600",children:[e.jsx(cn,{className:"mr-2 h-4 w-4"}),"Generuj quiz z AI"]})]})]}),e.jsxs(ki,{children:[e.jsx(zi,{asChild:!0,children:e.jsx(M,{variant:s?"secondary":"ghost",size:"sm",className:`h-8 w-8 p-0 ${s?"bg-primary-foreground/20 hover:bg-primary-foreground/30 text-primary-foreground":""}`,children:e.jsx(io,{className:"h-4 w-4"})})}),e.jsxs(Dn,{align:"end",children:[e.jsxs(_e,{onClick:()=>r("teacher/topics",t.id),children:[e.jsx(Cs,{className:"mr-2 h-4 w-4"}),"Edytuj temat"]}),e.jsx(Nt,{}),e.jsx(_e,{onClick:()=>a(t.id,t.is_published,t.title),children:t.is_published?e.jsxs(e.Fragment,{children:[e.jsx(dn,{className:"mr-2 h-4 w-4"}),"Ukryj temat"]}):e.jsxs(e.Fragment,{children:[e.jsx(tt,{className:"mr-2 h-4 w-4"}),"Opublikuj temat"]})}),e.jsx(Nt,{}),e.jsxs(_e,{onClick:()=>i(t.id,t.title),className:"text-red-600 focus:text-red-600",children:[e.jsx(dt,{className:"mr-2 h-4 w-4"}),"Usuń temat"]})]})]})]})]})}),s&&e.jsx("div",{className:"p-4 bg-muted/20 border-t-2 border-primary",children:e.jsx("div",{className:"space-y-2",children:d})})]})},eS=({activity:t,topicPosition:s,onDelete:n,onEdit:i,onTogglePublish:r,dragHandleProps:a})=>{const o=le(),l=()=>t.type==="quiz"?e.jsx("div",{className:"p-2 bg-blue-600 rounded-lg",children:e.jsx(Be,{className:"w-5 h-5 text-white"})}):e.jsx("div",{className:"p-2 bg-green-600 rounded-lg",children:e.jsx(kt,{className:"w-5 h-5 text-white"})}),c=()=>t.type==="quiz"?"Quiz":"Materiał";return e.jsxs("div",{className:"group flex items-center gap-4 p-4 bg-white border-2 rounded-lg hover:border-primary/50 transition-all duration-200",children:[e.jsx("div",{className:"cursor-move opacity-0 group-hover:opacity-100 transition-opacity",...a,children:e.jsx(np,{className:"w-4 h-4 text-muted-foreground"})}),l(),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("h5",{className:"font-semibold text-sm text-foreground",children:[s,".",t.position," ",t.title]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{variant:t.type==="quiz"?"default":"secondary",className:"text-xs font-medium",children:c()}),t.type==="quiz"&&t._count?.questions!==void 0&&e.jsxs(B,{variant:"outline",className:"text-xs font-medium border-2",children:[e.jsx(Xs,{className:"w-3 h-3 mr-1"}),t._count.questions," ",t._count.questions===1?"pytanie":"pytań"]}),e.jsx(B,{variant:t.is_published?"default":"outline",className:`text-xs font-medium ${t.is_published?"bg-green-600 hover:bg-green-700":"border-2"}`,children:t.is_published?e.jsxs(e.Fragment,{children:[e.jsx(Ai,{className:"w-3 h-3 mr-1"}),"Opublikowany"]}):"Szkic"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-muted-foreground",children:[t.duration_min&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(De,{className:"w-3 h-3"}),e.jsxs("span",{children:[t.duration_min," min"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:"w-3 h-3"}),e.jsx("span",{children:"0 ukończeń"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[t.type==="quiz"&&e.jsx(M,{size:"sm",variant:"ghost",onClick:()=>o(`/teacher/questions/manage/${t.id}`),title:"Zarządzaj pytaniami",className:"h-8 w-8 p-0",children:e.jsx(Xs,{className:"h-4 w-4"})}),e.jsx(M,{size:"sm",variant:"ghost",onClick:()=>o(`/teacher/activities/show/${t.id}`),title:"Podgląd",className:"h-8 w-8 p-0",children:e.jsx(tt,{className:"h-4 w-4"})}),e.jsxs(ki,{children:[e.jsx(zi,{asChild:!0,children:e.jsx(M,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(io,{className:"h-4 w-4"})})}),e.jsxs(Dn,{align:"end",children:[e.jsxs(_e,{onClick:()=>o(`/teacher/activities/show/${t.id}`),children:[e.jsx(tt,{className:"mr-2 h-4 w-4"}),"Podgląd"]}),e.jsxs(_e,{onClick:()=>i("teacher/activities",t.id),children:[e.jsx(Cs,{className:"mr-2 h-4 w-4"}),"Edytuj"]}),e.jsx(Nt,{}),e.jsx(_e,{onClick:()=>r(t.id,t.is_published,t.title),children:t.is_published?e.jsxs(e.Fragment,{children:[e.jsx(dn,{className:"mr-2 h-4 w-4"}),"Ukryj aktywność"]}):e.jsxs(e.Fragment,{children:[e.jsx(tt,{className:"mr-2 h-4 w-4"}),"Opublikuj aktywność"]})}),t.type==="quiz"&&e.jsxs(e.Fragment,{children:[e.jsx(Nt,{}),e.jsxs(_e,{onClick:()=>o(`/teacher/questions/manage/${t.id}`),className:"text-blue-600 focus:text-blue-600",children:[e.jsx(Xs,{className:"mr-2 h-4 w-4"}),"Zarządzaj pytaniami"]}),e.jsxs(_e,{onClick:()=>o(`/teacher/questions/create?activity_id=${t.id}`),className:"text-blue-600 focus:text-blue-600",children:[e.jsx(Qe,{className:"mr-2 h-4 w-4"}),"Dodaj pytanie"]})]}),e.jsx(Nt,{}),e.jsxs(_e,{onClick:()=>n(t.id,t.title),className:"text-red-600 focus:text-red-600",children:[e.jsx(dt,{className:"mr-2 h-4 w-4"}),"Usuń"]})]})]})]})]})},tS=({course:t})=>t?e.jsx(I,{className:"flex-1",children:e.jsx(E,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[t.icon_emoji&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-3xl",children:t.icon_emoji})})}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold",children:t.title}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:t.is_published?"Opublikowany":"Szkic"}),t.created_at&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Utworzony: ",new Date(t.created_at).toLocaleDateString("pl-PL")]})]})]}),t.description&&e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsx("p",{className:"text-muted-foreground leading-relaxed whitespace-pre-wrap",children:t.description})})]})]})})}):null,sS=({group:t,membersCount:s,courseId:n})=>{const i=le();return e.jsx(I,{className:"hover:shadow-md transition-shadow",children:e.jsxs(E,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-base mb-1",children:t.name}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(At,{className:"w-3 h-3"}),t.academic_year]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:"w-3 h-3"}),s," ",s===1?"uczeń":"uczniów"]})]})]}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx(B,{variant:t.is_active?"default":"secondary",children:t.is_active?"Aktywna":"Nieaktywna"})})]}),e.jsxs(M,{size:"sm",variant:"outline",onClick:r=>{r.stopPropagation(),i(`/teacher/groups/${t.id}/courses/${n}/activity`)},children:[e.jsx(tt,{className:"w-3 h-3 mr-1"}),"Zobacz postępy"]})]})})};function nS(){for(var t=arguments.length,s=new Array(t),n=0;n<t;n++)s[n]=arguments[n];return f.useMemo(()=>i=>{s.forEach(r=>r(i))},s)}const Ao=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Ri(t){const s=Object.prototype.toString.call(t);return s==="[object Window]"||s==="[object global]"}function Hc(t){return"nodeType"in t}function Mt(t){var s,n;return t?Ri(t)?t:Hc(t)&&(s=(n=t.ownerDocument)==null?void 0:n.defaultView)!=null?s:window:window}function Qc(t){const{Document:s}=Mt(t);return t instanceof s}function Wr(t){return Ri(t)?!1:t instanceof Mt(t).HTMLElement}function Qx(t){return t instanceof Mt(t).SVGElement}function Oi(t){return t?Ri(t)?t.document:Hc(t)?Qc(t)?t:Wr(t)||Qx(t)?t.ownerDocument:document:document:document}const zs=Ao?f.useLayoutEffect:f.useEffect;function Zc(t){const s=f.useRef(t);return zs(()=>{s.current=t}),f.useCallback(function(){for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return s.current==null?void 0:s.current(...i)},[])}function iS(){const t=f.useRef(null),s=f.useCallback((i,r)=>{t.current=setInterval(i,r)},[]),n=f.useCallback(()=>{t.current!==null&&(clearInterval(t.current),t.current=null)},[]);return[s,n]}function Sr(t,s){s===void 0&&(s=[t]);const n=f.useRef(t);return zs(()=>{n.current!==t&&(n.current=t)},s),n}function Gr(t,s){const n=f.useRef();return f.useMemo(()=>{const i=t(n.current);return n.current=i,i},[...s])}function $a(t){const s=Zc(t),n=f.useRef(null),i=f.useCallback(r=>{r!==n.current&&s?.(r,n.current),n.current=r},[]);return[n,i]}function Ol(t){const s=f.useRef();return f.useEffect(()=>{s.current=t},[t]),s.current}let il={};function Hr(t,s){return f.useMemo(()=>{if(s)return s;const n=il[t]==null?0:il[t]+1;return il[t]=n,t+"-"+n},[t,s])}function Zx(t){return function(s){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return i.reduce((a,o)=>{const l=Object.entries(o);for(const[c,d]of l){const u=a[c];u!=null&&(a[c]=u+t*d)}return a},{...s})}}const fi=Zx(1),Cr=Zx(-1);function rS(t){return"clientX"in t&&"clientY"in t}function Yc(t){if(!t)return!1;const{KeyboardEvent:s}=Mt(t.target);return s&&t instanceof s}function aS(t){if(!t)return!1;const{TouchEvent:s}=Mt(t.target);return s&&t instanceof s}function $l(t){if(aS(t)){if(t.touches&&t.touches.length){const{clientX:s,clientY:n}=t.touches[0];return{x:s,y:n}}else if(t.changedTouches&&t.changedTouches.length){const{clientX:s,clientY:n}=t.changedTouches[0];return{x:s,y:n}}}return rS(t)?{x:t.clientX,y:t.clientY}:null}const _r=Object.freeze({Translate:{toString(t){if(!t)return;const{x:s,y:n}=t;return"translate3d("+(s?Math.round(s):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(t){if(!t)return;const{scaleX:s,scaleY:n}=t;return"scaleX("+s+") scaleY("+n+")"}},Transform:{toString(t){if(t)return[_r.Translate.toString(t),_r.Scale.toString(t)].join(" ")}},Transition:{toString(t){let{property:s,duration:n,easing:i}=t;return s+" "+n+"ms "+i}}}),Mu="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function oS(t){return t.matches(Mu)?t:t.querySelector(Mu)}const lS={display:"none"};function cS(t){let{id:s,value:n}=t;return re.createElement("div",{id:s,style:lS},n)}function dS(t){let{id:s,announcement:n,ariaLiveType:i="assertive"}=t;const r={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return re.createElement("div",{id:s,style:r,role:"status","aria-live":i,"aria-atomic":!0},n)}function uS(){const[t,s]=f.useState("");return{announce:f.useCallback(i=>{i!=null&&s(i)},[]),announcement:t}}const Yx=f.createContext(null);function mS(t){const s=f.useContext(Yx);f.useEffect(()=>{if(!s)throw new Error("useDndMonitor must be used within a children of <DndContext>");return s(t)},[t,s])}function hS(){const[t]=f.useState(()=>new Set),s=f.useCallback(i=>(t.add(i),()=>t.delete(i)),[t]);return[f.useCallback(i=>{let{type:r,event:a}=i;t.forEach(o=>{var l;return(l=o[r])==null?void 0:l.call(o,a)})},[t]),s]}const pS={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},fS={onDragStart(t){let{active:s}=t;return"Picked up draggable item "+s.id+"."},onDragOver(t){let{active:s,over:n}=t;return n?"Draggable item "+s.id+" was moved over droppable area "+n.id+".":"Draggable item "+s.id+" is no longer over a droppable area."},onDragEnd(t){let{active:s,over:n}=t;return n?"Draggable item "+s.id+" was dropped over droppable area "+n.id:"Draggable item "+s.id+" was dropped."},onDragCancel(t){let{active:s}=t;return"Dragging was cancelled. Draggable item "+s.id+" was dropped."}};function xS(t){let{announcements:s=fS,container:n,hiddenTextDescribedById:i,screenReaderInstructions:r=pS}=t;const{announce:a,announcement:o}=uS(),l=Hr("DndLiveRegion"),[c,d]=f.useState(!1);if(f.useEffect(()=>{d(!0)},[]),mS(f.useMemo(()=>({onDragStart(m){let{active:h}=m;a(s.onDragStart({active:h}))},onDragMove(m){let{active:h,over:p}=m;s.onDragMove&&a(s.onDragMove({active:h,over:p}))},onDragOver(m){let{active:h,over:p}=m;a(s.onDragOver({active:h,over:p}))},onDragEnd(m){let{active:h,over:p}=m;a(s.onDragEnd({active:h,over:p}))},onDragCancel(m){let{active:h,over:p}=m;a(s.onDragCancel({active:h,over:p}))}}),[a,s])),!c)return null;const u=re.createElement(re.Fragment,null,re.createElement(cS,{id:i,value:r.draggable}),re.createElement(dS,{id:l,announcement:o}));return n?Xi.createPortal(u,n):u}var Je;(function(t){t.DragStart="dragStart",t.DragMove="dragMove",t.DragEnd="dragEnd",t.DragCancel="dragCancel",t.DragOver="dragOver",t.RegisterDroppable="registerDroppable",t.SetDroppableDisabled="setDroppableDisabled",t.UnregisterDroppable="unregisterDroppable"})(Je||(Je={}));function qa(){}function Iu(t,s){return f.useMemo(()=>({sensor:t,options:s??{}}),[t,s])}function gS(){for(var t=arguments.length,s=new Array(t),n=0;n<t;n++)s[n]=arguments[n];return f.useMemo(()=>[...s].filter(i=>i!=null),[...s])}const us=Object.freeze({x:0,y:0});function Jx(t,s){return Math.sqrt(Math.pow(t.x-s.x,2)+Math.pow(t.y-s.y,2))}function Xx(t,s){let{data:{value:n}}=t,{data:{value:i}}=s;return n-i}function jS(t,s){let{data:{value:n}}=t,{data:{value:i}}=s;return i-n}function Eu(t){let{left:s,top:n,height:i,width:r}=t;return[{x:s,y:n},{x:s+r,y:n},{x:s,y:n+i},{x:s+r,y:n+i}]}function eg(t,s){if(!t||t.length===0)return null;const[n]=t;return n[s]}function Lu(t,s,n){return s===void 0&&(s=t.left),n===void 0&&(n=t.top),{x:s+t.width*.5,y:n+t.height*.5}}const yS=t=>{let{collisionRect:s,droppableRects:n,droppableContainers:i}=t;const r=Lu(s,s.left,s.top),a=[];for(const o of i){const{id:l}=o,c=n.get(l);if(c){const d=Jx(Lu(c),r);a.push({id:l,data:{droppableContainer:o,value:d}})}}return a.sort(Xx)},wS=t=>{let{collisionRect:s,droppableRects:n,droppableContainers:i}=t;const r=Eu(s),a=[];for(const o of i){const{id:l}=o,c=n.get(l);if(c){const d=Eu(c),u=r.reduce((h,p,j)=>h+Jx(d[j],p),0),m=Number((u/4).toFixed(4));a.push({id:l,data:{droppableContainer:o,value:m}})}}return a.sort(Xx)};function bS(t,s){const n=Math.max(s.top,t.top),i=Math.max(s.left,t.left),r=Math.min(s.left+s.width,t.left+t.width),a=Math.min(s.top+s.height,t.top+t.height),o=r-i,l=a-n;if(i<r&&n<a){const c=s.width*s.height,d=t.width*t.height,u=o*l,m=u/(c+d-u);return Number(m.toFixed(4))}return 0}const vS=t=>{let{collisionRect:s,droppableRects:n,droppableContainers:i}=t;const r=[];for(const a of i){const{id:o}=a,l=n.get(o);if(l){const c=bS(l,s);c>0&&r.push({id:o,data:{droppableContainer:a,value:c}})}}return r.sort(jS)};function NS(t,s,n){return{...t,scaleX:s&&n?s.width/n.width:1,scaleY:s&&n?s.height/n.height:1}}function tg(t,s){return t&&s?{x:t.left-s.left,y:t.top-s.top}:us}function kS(t){return function(n){for(var i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];return r.reduce((o,l)=>({...o,top:o.top+t*l.y,bottom:o.bottom+t*l.y,left:o.left+t*l.x,right:o.right+t*l.x}),{...n})}}const zS=kS(1);function SS(t){if(t.startsWith("matrix3d(")){const s=t.slice(9,-1).split(/, /);return{x:+s[12],y:+s[13],scaleX:+s[0],scaleY:+s[5]}}else if(t.startsWith("matrix(")){const s=t.slice(7,-1).split(/, /);return{x:+s[4],y:+s[5],scaleX:+s[0],scaleY:+s[3]}}return null}function CS(t,s,n){const i=SS(s);if(!i)return t;const{scaleX:r,scaleY:a,x:o,y:l}=i,c=t.left-o-(1-r)*parseFloat(n),d=t.top-l-(1-a)*parseFloat(n.slice(n.indexOf(" ")+1)),u=r?t.width/r:t.width,m=a?t.height/a:t.height;return{width:u,height:m,top:d,right:c+u,bottom:d+m,left:c}}const _S={ignoreTransform:!1};function $i(t,s){s===void 0&&(s=_S);let n=t.getBoundingClientRect();if(s.ignoreTransform){const{transform:d,transformOrigin:u}=Mt(t).getComputedStyle(t);d&&(n=CS(n,d,u))}const{top:i,left:r,width:a,height:o,bottom:l,right:c}=n;return{top:i,left:r,width:a,height:o,bottom:l,right:c}}function Ru(t){return $i(t,{ignoreTransform:!0})}function TS(t){const s=t.innerWidth,n=t.innerHeight;return{top:0,left:0,right:s,bottom:n,width:s,height:n}}function AS(t,s){return s===void 0&&(s=Mt(t).getComputedStyle(t)),s.position==="fixed"}function PS(t,s){s===void 0&&(s=Mt(t).getComputedStyle(t));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(r=>{const a=s[r];return typeof a=="string"?n.test(a):!1})}function Po(t,s){const n=[];function i(r){if(s!=null&&n.length>=s||!r)return n;if(Qc(r)&&r.scrollingElement!=null&&!n.includes(r.scrollingElement))return n.push(r.scrollingElement),n;if(!Wr(r)||Qx(r)||n.includes(r))return n;const a=Mt(t).getComputedStyle(r);return r!==t&&PS(r,a)&&n.push(r),AS(r,a)?n:i(r.parentNode)}return t?i(t):n}function sg(t){const[s]=Po(t,1);return s??null}function rl(t){return!Ao||!t?null:Ri(t)?t:Hc(t)?Qc(t)||t===Oi(t).scrollingElement?window:Wr(t)?t:null:null}function ng(t){return Ri(t)?t.scrollX:t.scrollLeft}function ig(t){return Ri(t)?t.scrollY:t.scrollTop}function ql(t){return{x:ng(t),y:ig(t)}}var et;(function(t){t[t.Forward=1]="Forward",t[t.Backward=-1]="Backward"})(et||(et={}));function rg(t){return!Ao||!t?!1:t===document.scrollingElement}function ag(t){const s={x:0,y:0},n=rg(t)?{height:window.innerHeight,width:window.innerWidth}:{height:t.clientHeight,width:t.clientWidth},i={x:t.scrollWidth-n.width,y:t.scrollHeight-n.height},r=t.scrollTop<=s.y,a=t.scrollLeft<=s.x,o=t.scrollTop>=i.y,l=t.scrollLeft>=i.x;return{isTop:r,isLeft:a,isBottom:o,isRight:l,maxScroll:i,minScroll:s}}const DS={x:.2,y:.2};function MS(t,s,n,i,r){let{top:a,left:o,right:l,bottom:c}=n;i===void 0&&(i=10),r===void 0&&(r=DS);const{isTop:d,isBottom:u,isLeft:m,isRight:h}=ag(t),p={x:0,y:0},j={x:0,y:0},y={height:s.height*r.y,width:s.width*r.x};return!d&&a<=s.top+y.height?(p.y=et.Backward,j.y=i*Math.abs((s.top+y.height-a)/y.height)):!u&&c>=s.bottom-y.height&&(p.y=et.Forward,j.y=i*Math.abs((s.bottom-y.height-c)/y.height)),!h&&l>=s.right-y.width?(p.x=et.Forward,j.x=i*Math.abs((s.right-y.width-l)/y.width)):!m&&o<=s.left+y.width&&(p.x=et.Backward,j.x=i*Math.abs((s.left+y.width-o)/y.width)),{direction:p,speed:j}}function IS(t){if(t===document.scrollingElement){const{innerWidth:a,innerHeight:o}=window;return{top:0,left:0,right:a,bottom:o,width:a,height:o}}const{top:s,left:n,right:i,bottom:r}=t.getBoundingClientRect();return{top:s,left:n,right:i,bottom:r,width:t.clientWidth,height:t.clientHeight}}function og(t){return t.reduce((s,n)=>fi(s,ql(n)),us)}function ES(t){return t.reduce((s,n)=>s+ng(n),0)}function LS(t){return t.reduce((s,n)=>s+ig(n),0)}function RS(t,s){if(s===void 0&&(s=$i),!t)return;const{top:n,left:i,bottom:r,right:a}=s(t);sg(t)&&(r<=0||a<=0||n>=window.innerHeight||i>=window.innerWidth)&&t.scrollIntoView({block:"center",inline:"center"})}const OS=[["x",["left","right"],ES],["y",["top","bottom"],LS]];class Jc{constructor(s,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const i=Po(n),r=og(i);this.rect={...s},this.width=s.width,this.height=s.height;for(const[a,o,l]of OS)for(const c of o)Object.defineProperty(this,c,{get:()=>{const d=l(i),u=r[a]-d;return this.rect[c]+u},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class ar{constructor(s){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var i;return(i=this.target)==null?void 0:i.removeEventListener(...n)})},this.target=s}add(s,n,i){var r;(r=this.target)==null||r.addEventListener(s,n,i),this.listeners.push([s,n,i])}}function $S(t){const{EventTarget:s}=Mt(t);return t instanceof s?t:Oi(t)}function al(t,s){const n=Math.abs(t.x),i=Math.abs(t.y);return typeof s=="number"?Math.sqrt(n**2+i**2)>s:"x"in s&&"y"in s?n>s.x&&i>s.y:"x"in s?n>s.x:"y"in s?i>s.y:!1}var Wt;(function(t){t.Click="click",t.DragStart="dragstart",t.Keydown="keydown",t.ContextMenu="contextmenu",t.Resize="resize",t.SelectionChange="selectionchange",t.VisibilityChange="visibilitychange"})(Wt||(Wt={}));function Ou(t){t.preventDefault()}function qS(t){t.stopPropagation()}var ue;(function(t){t.Space="Space",t.Down="ArrowDown",t.Right="ArrowRight",t.Left="ArrowLeft",t.Up="ArrowUp",t.Esc="Escape",t.Enter="Enter",t.Tab="Tab"})(ue||(ue={}));const lg={start:[ue.Space,ue.Enter],cancel:[ue.Esc],end:[ue.Space,ue.Enter,ue.Tab]},FS=(t,s)=>{let{currentCoordinates:n}=s;switch(t.code){case ue.Right:return{...n,x:n.x+25};case ue.Left:return{...n,x:n.x-25};case ue.Down:return{...n,y:n.y+25};case ue.Up:return{...n,y:n.y-25}}};class Xc{constructor(s){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=s;const{event:{target:n}}=s;this.props=s,this.listeners=new ar(Oi(n)),this.windowListeners=new ar(Mt(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Wt.Resize,this.handleCancel),this.windowListeners.add(Wt.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Wt.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:s,onStart:n}=this.props,i=s.node.current;i&&RS(i),n(us)}handleKeyDown(s){if(Yc(s)){const{active:n,context:i,options:r}=this.props,{keyboardCodes:a=lg,coordinateGetter:o=FS,scrollBehavior:l="smooth"}=r,{code:c}=s;if(a.end.includes(c)){this.handleEnd(s);return}if(a.cancel.includes(c)){this.handleCancel(s);return}const{collisionRect:d}=i.current,u=d?{x:d.left,y:d.top}:us;this.referenceCoordinates||(this.referenceCoordinates=u);const m=o(s,{active:n,context:i.current,currentCoordinates:u});if(m){const h=Cr(m,u),p={x:0,y:0},{scrollableAncestors:j}=i.current;for(const y of j){const x=s.code,{isTop:g,isRight:b,isLeft:v,isBottom:C,maxScroll:T,minScroll:z}=ag(y),N=IS(y),S={x:Math.min(x===ue.Right?N.right-N.width/2:N.right,Math.max(x===ue.Right?N.left:N.left+N.width/2,m.x)),y:Math.min(x===ue.Down?N.bottom-N.height/2:N.bottom,Math.max(x===ue.Down?N.top:N.top+N.height/2,m.y))},P=x===ue.Right&&!b||x===ue.Left&&!v,w=x===ue.Down&&!C||x===ue.Up&&!g;if(P&&S.x!==m.x){const k=y.scrollLeft+h.x,_=x===ue.Right&&k<=T.x||x===ue.Left&&k>=z.x;if(_&&!h.y){y.scrollTo({left:k,behavior:l});return}_?p.x=y.scrollLeft-k:p.x=x===ue.Right?y.scrollLeft-T.x:y.scrollLeft-z.x,p.x&&y.scrollBy({left:-p.x,behavior:l});break}else if(w&&S.y!==m.y){const k=y.scrollTop+h.y,_=x===ue.Down&&k<=T.y||x===ue.Up&&k>=z.y;if(_&&!h.x){y.scrollTo({top:k,behavior:l});return}_?p.y=y.scrollTop-k:p.y=x===ue.Down?y.scrollTop-T.y:y.scrollTop-z.y,p.y&&y.scrollBy({top:-p.y,behavior:l});break}}this.handleMove(s,fi(Cr(m,this.referenceCoordinates),p))}}}handleMove(s,n){const{onMove:i}=this.props;s.preventDefault(),i(n)}handleEnd(s){const{onEnd:n}=this.props;s.preventDefault(),this.detach(),n()}handleCancel(s){const{onCancel:n}=this.props;s.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Xc.activators=[{eventName:"onKeyDown",handler:(t,s,n)=>{let{keyboardCodes:i=lg,onActivation:r}=s,{active:a}=n;const{code:o}=t.nativeEvent;if(i.start.includes(o)){const l=a.activatorNode.current;return l&&t.target!==l?!1:(t.preventDefault(),r?.({event:t.nativeEvent}),!0)}return!1}}];function $u(t){return!!(t&&"distance"in t)}function qu(t){return!!(t&&"delay"in t)}class ed{constructor(s,n,i){var r;i===void 0&&(i=$S(s.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=s,this.events=n;const{event:a}=s,{target:o}=a;this.props=s,this.events=n,this.document=Oi(o),this.documentListeners=new ar(this.document),this.listeners=new ar(i),this.windowListeners=new ar(Mt(o)),this.initialCoordinates=(r=$l(a))!=null?r:us,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:s,props:{options:{activationConstraint:n,bypassActivationConstraint:i}}}=this;if(this.listeners.add(s.move.name,this.handleMove,{passive:!1}),this.listeners.add(s.end.name,this.handleEnd),s.cancel&&this.listeners.add(s.cancel.name,this.handleCancel),this.windowListeners.add(Wt.Resize,this.handleCancel),this.windowListeners.add(Wt.DragStart,Ou),this.windowListeners.add(Wt.VisibilityChange,this.handleCancel),this.windowListeners.add(Wt.ContextMenu,Ou),this.documentListeners.add(Wt.Keydown,this.handleKeydown),n){if(i!=null&&i({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(qu(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if($u(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(s,n){const{active:i,onPending:r}=this.props;r(i,s,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:s}=this,{onStart:n}=this.props;s&&(this.activated=!0,this.documentListeners.add(Wt.Click,qS,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Wt.SelectionChange,this.removeTextSelection),n(s))}handleMove(s){var n;const{activated:i,initialCoordinates:r,props:a}=this,{onMove:o,options:{activationConstraint:l}}=a;if(!r)return;const c=(n=$l(s))!=null?n:us,d=Cr(r,c);if(!i&&l){if($u(l)){if(l.tolerance!=null&&al(d,l.tolerance))return this.handleCancel();if(al(d,l.distance))return this.handleStart()}if(qu(l)&&al(d,l.tolerance))return this.handleCancel();this.handlePending(l,d);return}s.cancelable&&s.preventDefault(),o(c)}handleEnd(){const{onAbort:s,onEnd:n}=this.props;this.detach(),this.activated||s(this.props.active),n()}handleCancel(){const{onAbort:s,onCancel:n}=this.props;this.detach(),this.activated||s(this.props.active),n()}handleKeydown(s){s.code===ue.Esc&&this.handleCancel()}removeTextSelection(){var s;(s=this.document.getSelection())==null||s.removeAllRanges()}}const BS={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class td extends ed{constructor(s){const{event:n}=s,i=Oi(n.target);super(s,BS,i)}}td.activators=[{eventName:"onPointerDown",handler:(t,s)=>{let{nativeEvent:n}=t,{onActivation:i}=s;return!n.isPrimary||n.button!==0?!1:(i?.({event:n}),!0)}}];const US={move:{name:"mousemove"},end:{name:"mouseup"}};var Fl;(function(t){t[t.RightClick=2]="RightClick"})(Fl||(Fl={}));class VS extends ed{constructor(s){super(s,US,Oi(s.event.target))}}VS.activators=[{eventName:"onMouseDown",handler:(t,s)=>{let{nativeEvent:n}=t,{onActivation:i}=s;return n.button===Fl.RightClick?!1:(i?.({event:n}),!0)}}];const ol={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class KS extends ed{constructor(s){super(s,ol)}static setup(){return window.addEventListener(ol.move.name,s,{capture:!1,passive:!1}),function(){window.removeEventListener(ol.move.name,s)};function s(){}}}KS.activators=[{eventName:"onTouchStart",handler:(t,s)=>{let{nativeEvent:n}=t,{onActivation:i}=s;const{touches:r}=n;return r.length>1?!1:(i?.({event:n}),!0)}}];var or;(function(t){t[t.Pointer=0]="Pointer",t[t.DraggableRect=1]="DraggableRect"})(or||(or={}));var Fa;(function(t){t[t.TreeOrder=0]="TreeOrder",t[t.ReversedTreeOrder=1]="ReversedTreeOrder"})(Fa||(Fa={}));function WS(t){let{acceleration:s,activator:n=or.Pointer,canScroll:i,draggingRect:r,enabled:a,interval:o=5,order:l=Fa.TreeOrder,pointerCoordinates:c,scrollableAncestors:d,scrollableAncestorRects:u,delta:m,threshold:h}=t;const p=HS({delta:m,disabled:!a}),[j,y]=iS(),x=f.useRef({x:0,y:0}),g=f.useRef({x:0,y:0}),b=f.useMemo(()=>{switch(n){case or.Pointer:return c?{top:c.y,bottom:c.y,left:c.x,right:c.x}:null;case or.DraggableRect:return r}},[n,r,c]),v=f.useRef(null),C=f.useCallback(()=>{const z=v.current;if(!z)return;const N=x.current.x*g.current.x,S=x.current.y*g.current.y;z.scrollBy(N,S)},[]),T=f.useMemo(()=>l===Fa.TreeOrder?[...d].reverse():d,[l,d]);f.useEffect(()=>{if(!a||!d.length||!b){y();return}for(const z of T){if(i?.(z)===!1)continue;const N=d.indexOf(z),S=u[N];if(!S)continue;const{direction:P,speed:w}=MS(z,S,b,s,h);for(const k of["x","y"])p[k][P[k]]||(w[k]=0,P[k]=0);if(w.x>0||w.y>0){y(),v.current=z,j(C,o),x.current=w,g.current=P;return}}x.current={x:0,y:0},g.current={x:0,y:0},y()},[s,C,i,y,a,o,JSON.stringify(b),JSON.stringify(p),j,d,T,u,JSON.stringify(h)])}const GS={x:{[et.Backward]:!1,[et.Forward]:!1},y:{[et.Backward]:!1,[et.Forward]:!1}};function HS(t){let{delta:s,disabled:n}=t;const i=Ol(s);return Gr(r=>{if(n||!i||!r)return GS;const a={x:Math.sign(s.x-i.x),y:Math.sign(s.y-i.y)};return{x:{[et.Backward]:r.x[et.Backward]||a.x===-1,[et.Forward]:r.x[et.Forward]||a.x===1},y:{[et.Backward]:r.y[et.Backward]||a.y===-1,[et.Forward]:r.y[et.Forward]||a.y===1}}},[n,s,i])}function QS(t,s){const n=s!=null?t.get(s):void 0,i=n?n.node.current:null;return Gr(r=>{var a;return s==null?null:(a=i??r)!=null?a:null},[i,s])}function ZS(t,s){return f.useMemo(()=>t.reduce((n,i)=>{const{sensor:r}=i,a=r.activators.map(o=>({eventName:o.eventName,handler:s(o.handler,i)}));return[...n,...a]},[]),[t,s])}var Tr;(function(t){t[t.Always=0]="Always",t[t.BeforeDragging=1]="BeforeDragging",t[t.WhileDragging=2]="WhileDragging"})(Tr||(Tr={}));var Bl;(function(t){t.Optimized="optimized"})(Bl||(Bl={}));const Fu=new Map;function YS(t,s){let{dragging:n,dependencies:i,config:r}=s;const[a,o]=f.useState(null),{frequency:l,measure:c,strategy:d}=r,u=f.useRef(t),m=x(),h=Sr(m),p=f.useCallback(function(g){g===void 0&&(g=[]),!h.current&&o(b=>b===null?g:b.concat(g.filter(v=>!b.includes(v))))},[h]),j=f.useRef(null),y=Gr(g=>{if(m&&!n)return Fu;if(!g||g===Fu||u.current!==t||a!=null){const b=new Map;for(let v of t){if(!v)continue;if(a&&a.length>0&&!a.includes(v.id)&&v.rect.current){b.set(v.id,v.rect.current);continue}const C=v.node.current,T=C?new Jc(c(C),C):null;v.rect.current=T,T&&b.set(v.id,T)}return b}return g},[t,a,n,m,c]);return f.useEffect(()=>{u.current=t},[t]),f.useEffect(()=>{m||p()},[n,m]),f.useEffect(()=>{a&&a.length>0&&o(null)},[JSON.stringify(a)]),f.useEffect(()=>{m||typeof l!="number"||j.current!==null||(j.current=setTimeout(()=>{p(),j.current=null},l))},[l,m,p,...i]),{droppableRects:y,measureDroppableContainers:p,measuringScheduled:a!=null};function x(){switch(d){case Tr.Always:return!1;case Tr.BeforeDragging:return n;default:return!n}}}function cg(t,s){return Gr(n=>t?n||(typeof s=="function"?s(t):t):null,[s,t])}function JS(t,s){return cg(t,s)}function XS(t){let{callback:s,disabled:n}=t;const i=Zc(s),r=f.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:a}=window;return new a(i)},[i,n]);return f.useEffect(()=>()=>r?.disconnect(),[r]),r}function Do(t){let{callback:s,disabled:n}=t;const i=Zc(s),r=f.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:a}=window;return new a(i)},[n]);return f.useEffect(()=>()=>r?.disconnect(),[r]),r}function e2(t){return new Jc($i(t),t)}function Bu(t,s,n){s===void 0&&(s=e2);const[i,r]=f.useState(null);function a(){r(c=>{if(!t)return null;if(t.isConnected===!1){var d;return(d=c??n)!=null?d:null}const u=s(t);return JSON.stringify(c)===JSON.stringify(u)?c:u})}const o=XS({callback(c){if(t)for(const d of c){const{type:u,target:m}=d;if(u==="childList"&&m instanceof HTMLElement&&m.contains(t)){a();break}}}}),l=Do({callback:a});return zs(()=>{a(),t?(l?.observe(t),o?.observe(document.body,{childList:!0,subtree:!0})):(l?.disconnect(),o?.disconnect())},[t]),i}function t2(t){const s=cg(t);return tg(t,s)}const Uu=[];function s2(t){const s=f.useRef(t),n=Gr(i=>t?i&&i!==Uu&&t&&s.current&&t.parentNode===s.current.parentNode?i:Po(t):Uu,[t]);return f.useEffect(()=>{s.current=t},[t]),n}function n2(t){const[s,n]=f.useState(null),i=f.useRef(t),r=f.useCallback(a=>{const o=rl(a.target);o&&n(l=>l?(l.set(o,ql(o)),new Map(l)):null)},[]);return f.useEffect(()=>{const a=i.current;if(t!==a){o(a);const l=t.map(c=>{const d=rl(c);return d?(d.addEventListener("scroll",r,{passive:!0}),[d,ql(d)]):null}).filter(c=>c!=null);n(l.length?new Map(l):null),i.current=t}return()=>{o(t),o(a)};function o(l){l.forEach(c=>{const d=rl(c);d?.removeEventListener("scroll",r)})}},[r,t]),f.useMemo(()=>t.length?s?Array.from(s.values()).reduce((a,o)=>fi(a,o),us):og(t):us,[t,s])}function Vu(t,s){s===void 0&&(s=[]);const n=f.useRef(null);return f.useEffect(()=>{n.current=null},s),f.useEffect(()=>{const i=t!==us;i&&!n.current&&(n.current=t),!i&&n.current&&(n.current=null)},[t]),n.current?Cr(t,n.current):us}function i2(t){f.useEffect(()=>{if(!Ao)return;const s=t.map(n=>{let{sensor:i}=n;return i.setup==null?void 0:i.setup()});return()=>{for(const n of s)n?.()}},t.map(s=>{let{sensor:n}=s;return n}))}function r2(t,s){return f.useMemo(()=>t.reduce((n,i)=>{let{eventName:r,handler:a}=i;return n[r]=o=>{a(o,s)},n},{}),[t,s])}function dg(t){return f.useMemo(()=>t?TS(t):null,[t])}const Ku=[];function a2(t,s){s===void 0&&(s=$i);const[n]=t,i=dg(n?Mt(n):null),[r,a]=f.useState(Ku);function o(){a(()=>t.length?t.map(c=>rg(c)?i:new Jc(s(c),c)):Ku)}const l=Do({callback:o});return zs(()=>{l?.disconnect(),o(),t.forEach(c=>l?.observe(c))},[t]),r}function o2(t){if(!t)return null;if(t.children.length>1)return t;const s=t.children[0];return Wr(s)?s:t}function l2(t){let{measure:s}=t;const[n,i]=f.useState(null),r=f.useCallback(d=>{for(const{target:u}of d)if(Wr(u)){i(m=>{const h=s(u);return m?{...m,width:h.width,height:h.height}:h});break}},[s]),a=Do({callback:r}),o=f.useCallback(d=>{const u=o2(d);a?.disconnect(),u&&a?.observe(u),i(u?s(u):null)},[s,a]),[l,c]=$a(o);return f.useMemo(()=>({nodeRef:l,rect:n,setRef:c}),[n,l,c])}const c2=[{sensor:td,options:{}},{sensor:Xc,options:{}}],d2={current:{}},wa={draggable:{measure:Ru},droppable:{measure:Ru,strategy:Tr.WhileDragging,frequency:Bl.Optimized},dragOverlay:{measure:$i}};class lr extends Map{get(s){var n;return s!=null&&(n=super.get(s))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(s=>{let{disabled:n}=s;return!n})}getNodeFor(s){var n,i;return(n=(i=this.get(s))==null?void 0:i.node.current)!=null?n:void 0}}const u2={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new lr,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:qa},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:wa,measureDroppableContainers:qa,windowRect:null,measuringScheduled:!1},m2={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:qa,draggableNodes:new Map,over:null,measureDroppableContainers:qa},Mo=f.createContext(m2),ug=f.createContext(u2);function h2(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new lr}}}function p2(t,s){switch(s.type){case Je.DragStart:return{...t,draggable:{...t.draggable,initialCoordinates:s.initialCoordinates,active:s.active}};case Je.DragMove:return t.draggable.active==null?t:{...t,draggable:{...t.draggable,translate:{x:s.coordinates.x-t.draggable.initialCoordinates.x,y:s.coordinates.y-t.draggable.initialCoordinates.y}}};case Je.DragEnd:case Je.DragCancel:return{...t,draggable:{...t.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Je.RegisterDroppable:{const{element:n}=s,{id:i}=n,r=new lr(t.droppable.containers);return r.set(i,n),{...t,droppable:{...t.droppable,containers:r}}}case Je.SetDroppableDisabled:{const{id:n,key:i,disabled:r}=s,a=t.droppable.containers.get(n);if(!a||i!==a.key)return t;const o=new lr(t.droppable.containers);return o.set(n,{...a,disabled:r}),{...t,droppable:{...t.droppable,containers:o}}}case Je.UnregisterDroppable:{const{id:n,key:i}=s,r=t.droppable.containers.get(n);if(!r||i!==r.key)return t;const a=new lr(t.droppable.containers);return a.delete(n),{...t,droppable:{...t.droppable,containers:a}}}default:return t}}function f2(t){let{disabled:s}=t;const{active:n,activatorEvent:i,draggableNodes:r}=f.useContext(Mo),a=Ol(i),o=Ol(n?.id);return f.useEffect(()=>{if(!s&&!i&&a&&o!=null){if(!Yc(a)||document.activeElement===a.target)return;const l=r.get(o);if(!l)return;const{activatorNode:c,node:d}=l;if(!c.current&&!d.current)return;requestAnimationFrame(()=>{for(const u of[c.current,d.current]){if(!u)continue;const m=oS(u);if(m){m.focus();break}}})}},[i,s,r,o,a]),null}function x2(t,s){let{transform:n,...i}=s;return t!=null&&t.length?t.reduce((r,a)=>a({transform:r,...i}),n):n}function g2(t){return f.useMemo(()=>({draggable:{...wa.draggable,...t?.draggable},droppable:{...wa.droppable,...t?.droppable},dragOverlay:{...wa.dragOverlay,...t?.dragOverlay}}),[t?.draggable,t?.droppable,t?.dragOverlay])}function j2(t){let{activeNode:s,measure:n,initialRect:i,config:r=!0}=t;const a=f.useRef(!1),{x:o,y:l}=typeof r=="boolean"?{x:r,y:r}:r;zs(()=>{if(!o&&!l||!s){a.current=!1;return}if(a.current||!i)return;const d=s?.node.current;if(!d||d.isConnected===!1)return;const u=n(d),m=tg(u,i);if(o||(m.x=0),l||(m.y=0),a.current=!0,Math.abs(m.x)>0||Math.abs(m.y)>0){const h=sg(d);h&&h.scrollBy({top:m.y,left:m.x})}},[s,o,l,i,n])}const mg=f.createContext({...us,scaleX:1,scaleY:1});var Zs;(function(t){t[t.Uninitialized=0]="Uninitialized",t[t.Initializing=1]="Initializing",t[t.Initialized=2]="Initialized"})(Zs||(Zs={}));const y2=f.memo(function(s){var n,i,r,a;let{id:o,accessibility:l,autoScroll:c=!0,children:d,sensors:u=c2,collisionDetection:m=vS,measuring:h,modifiers:p,...j}=s;const y=f.useReducer(p2,void 0,h2),[x,g]=y,[b,v]=hS(),[C,T]=f.useState(Zs.Uninitialized),z=C===Zs.Initialized,{draggable:{active:N,nodes:S,translate:P},droppable:{containers:w}}=x,k=N!=null?S.get(N):null,_=f.useRef({initial:null,translated:null}),A=f.useMemo(()=>{var ut;return N!=null?{id:N,data:(ut=k?.data)!=null?ut:d2,rect:_}:null},[N,k]),D=f.useRef(null),[R,L]=f.useState(null),[F,K]=f.useState(null),q=Sr(j,Object.values(j)),G=Hr("DndDescribedBy",o),X=f.useMemo(()=>w.getEnabled(),[w]),V=g2(h),{droppableRects:oe,measureDroppableContainers:Se,measuringScheduled:it}=YS(X,{dragging:z,dependencies:[P.x,P.y],config:V.droppable}),ze=QS(S,N),fe=f.useMemo(()=>F?$l(F):null,[F]),gt=oy(),jt=JS(ze,V.draggable.measure);j2({activeNode:N!=null?S.get(N):null,config:gt.layoutShiftCompensation,initialRect:jt,measure:V.draggable.measure});const ve=Bu(ze,V.draggable.measure,jt),Vi=Bu(ze?ze.parentElement:null),ps=f.useRef({activatorEvent:null,active:null,activeNode:ze,collisionRect:null,collisions:null,droppableRects:oe,draggableNodes:S,draggingNode:null,draggingNodeRect:null,droppableContainers:w,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Un=w.getNodeFor((n=ps.current.over)==null?void 0:n.id),Ts=l2({measure:V.dragOverlay.measure}),Vn=(i=Ts.nodeRef.current)!=null?i:ze,Kn=z?(r=Ts.rect)!=null?r:ve:null,Rd=!!(Ts.nodeRef.current&&Ts.rect),Od=t2(Rd?null:ve),$o=dg(Vn?Mt(Vn):null),Us=s2(z?Un??ze:null),ea=a2(Us),ta=x2(p,{transform:{x:P.x-Od.x,y:P.y-Od.y,scaleX:1,scaleY:1},activatorEvent:F,active:A,activeNodeRect:ve,containerNodeRect:Vi,draggingNodeRect:Kn,over:ps.current.over,overlayNodeRect:Ts.rect,scrollableAncestors:Us,scrollableAncestorRects:ea,windowRect:$o}),$d=fe?fi(fe,P):null,qd=n2(Us),ey=Vu(qd),ty=Vu(qd,[ve]),Wn=fi(ta,ey),Gn=Kn?zS(Kn,ta):null,Ki=A&&Gn?m({active:A,collisionRect:Gn,droppableRects:oe,droppableContainers:X,pointerCoordinates:$d}):null,Fd=eg(Ki,"id"),[Vs,Bd]=f.useState(null),sy=Rd?ta:fi(ta,ty),ny=NS(sy,(a=Vs?.rect)!=null?a:null,ve),qo=f.useRef(null),Ud=f.useCallback((ut,It)=>{let{sensor:Et,options:Ks}=It;if(D.current==null)return;const Ut=S.get(D.current);if(!Ut)return;const Lt=ut.nativeEvent,fs=new Et({active:D.current,activeNode:Ut,event:Lt,options:Ks,context:ps,onAbort(rt){if(!S.get(rt))return;const{onDragAbort:xs}=q.current,As={id:rt};xs?.(As),b({type:"onDragAbort",event:As})},onPending(rt,Ws,xs,As){if(!S.get(rt))return;const{onDragPending:Gi}=q.current,Gs={id:rt,constraint:Ws,initialCoordinates:xs,offset:As};Gi?.(Gs),b({type:"onDragPending",event:Gs})},onStart(rt){const Ws=D.current;if(Ws==null)return;const xs=S.get(Ws);if(!xs)return;const{onDragStart:As}=q.current,Wi={activatorEvent:Lt,active:{id:Ws,data:xs.data,rect:_}};Xi.unstable_batchedUpdates(()=>{As?.(Wi),T(Zs.Initializing),g({type:Je.DragStart,initialCoordinates:rt,active:Ws}),b({type:"onDragStart",event:Wi}),L(qo.current),K(Lt)})},onMove(rt){g({type:Je.DragMove,coordinates:rt})},onEnd:Hn(Je.DragEnd),onCancel:Hn(Je.DragCancel)});qo.current=fs;function Hn(rt){return async function(){const{active:xs,collisions:As,over:Wi,scrollAdjustedTranslate:Gi}=ps.current;let Gs=null;if(xs&&Gi){const{cancelDrop:Hi}=q.current;Gs={activatorEvent:Lt,active:xs,collisions:As,delta:Gi,over:Wi},rt===Je.DragEnd&&typeof Hi=="function"&&await Promise.resolve(Hi(Gs))&&(rt=Je.DragCancel)}D.current=null,Xi.unstable_batchedUpdates(()=>{g({type:rt}),T(Zs.Uninitialized),Bd(null),L(null),K(null),qo.current=null;const Hi=rt===Je.DragEnd?"onDragEnd":"onDragCancel";if(Gs){const Fo=q.current[Hi];Fo?.(Gs),b({type:Hi,event:Gs})}})}}},[S]),iy=f.useCallback((ut,It)=>(Et,Ks)=>{const Ut=Et.nativeEvent,Lt=S.get(Ks);if(D.current!==null||!Lt||Ut.dndKit||Ut.defaultPrevented)return;const fs={active:Lt};ut(Et,It.options,fs)===!0&&(Ut.dndKit={capturedBy:It.sensor},D.current=Ks,Ud(Et,It))},[S,Ud]),Vd=ZS(u,iy);i2(u),zs(()=>{ve&&C===Zs.Initializing&&T(Zs.Initialized)},[ve,C]),f.useEffect(()=>{const{onDragMove:ut}=q.current,{active:It,activatorEvent:Et,collisions:Ks,over:Ut}=ps.current;if(!It||!Et)return;const Lt={active:It,activatorEvent:Et,collisions:Ks,delta:{x:Wn.x,y:Wn.y},over:Ut};Xi.unstable_batchedUpdates(()=>{ut?.(Lt),b({type:"onDragMove",event:Lt})})},[Wn.x,Wn.y]),f.useEffect(()=>{const{active:ut,activatorEvent:It,collisions:Et,droppableContainers:Ks,scrollAdjustedTranslate:Ut}=ps.current;if(!ut||D.current==null||!It||!Ut)return;const{onDragOver:Lt}=q.current,fs=Ks.get(Fd),Hn=fs&&fs.rect.current?{id:fs.id,rect:fs.rect.current,data:fs.data,disabled:fs.disabled}:null,rt={active:ut,activatorEvent:It,collisions:Et,delta:{x:Ut.x,y:Ut.y},over:Hn};Xi.unstable_batchedUpdates(()=>{Bd(Hn),Lt?.(rt),b({type:"onDragOver",event:rt})})},[Fd]),zs(()=>{ps.current={activatorEvent:F,active:A,activeNode:ze,collisionRect:Gn,collisions:Ki,droppableRects:oe,draggableNodes:S,draggingNode:Vn,draggingNodeRect:Kn,droppableContainers:w,over:Vs,scrollableAncestors:Us,scrollAdjustedTranslate:Wn},_.current={initial:Kn,translated:Gn}},[A,ze,Ki,Gn,S,Vn,Kn,oe,w,Vs,Us,Wn]),WS({...gt,delta:P,draggingRect:Gn,pointerCoordinates:$d,scrollableAncestors:Us,scrollableAncestorRects:ea});const ry=f.useMemo(()=>({active:A,activeNode:ze,activeNodeRect:ve,activatorEvent:F,collisions:Ki,containerNodeRect:Vi,dragOverlay:Ts,draggableNodes:S,droppableContainers:w,droppableRects:oe,over:Vs,measureDroppableContainers:Se,scrollableAncestors:Us,scrollableAncestorRects:ea,measuringConfiguration:V,measuringScheduled:it,windowRect:$o}),[A,ze,ve,F,Ki,Vi,Ts,S,w,oe,Vs,Se,Us,ea,V,it,$o]),ay=f.useMemo(()=>({activatorEvent:F,activators:Vd,active:A,activeNodeRect:ve,ariaDescribedById:{draggable:G},dispatch:g,draggableNodes:S,over:Vs,measureDroppableContainers:Se}),[F,Vd,A,ve,g,G,S,Vs,Se]);return re.createElement(Yx.Provider,{value:v},re.createElement(Mo.Provider,{value:ay},re.createElement(ug.Provider,{value:ry},re.createElement(mg.Provider,{value:ny},d)),re.createElement(f2,{disabled:l?.restoreFocus===!1})),re.createElement(xS,{...l,hiddenTextDescribedById:G}));function oy(){const ut=R?.autoScrollEnabled===!1,It=typeof c=="object"?c.enabled===!1:c===!1,Et=z&&!ut&&!It;return typeof c=="object"?{...c,enabled:Et}:{enabled:Et}}}),w2=f.createContext(null),Wu="button",b2="Draggable";function v2(t){let{id:s,data:n,disabled:i=!1,attributes:r}=t;const a=Hr(b2),{activators:o,activatorEvent:l,active:c,activeNodeRect:d,ariaDescribedById:u,draggableNodes:m,over:h}=f.useContext(Mo),{role:p=Wu,roleDescription:j="draggable",tabIndex:y=0}=r??{},x=c?.id===s,g=f.useContext(x?mg:w2),[b,v]=$a(),[C,T]=$a(),z=r2(o,s),N=Sr(n);zs(()=>(m.set(s,{id:s,key:a,node:b,activatorNode:C,data:N}),()=>{const P=m.get(s);P&&P.key===a&&m.delete(s)}),[m,s]);const S=f.useMemo(()=>({role:p,tabIndex:y,"aria-disabled":i,"aria-pressed":x&&p===Wu?!0:void 0,"aria-roledescription":j,"aria-describedby":u.draggable}),[i,p,y,x,j,u.draggable]);return{active:c,activatorEvent:l,activeNodeRect:d,attributes:S,isDragging:x,listeners:i?void 0:z,node:b,over:h,setNodeRef:v,setActivatorNodeRef:T,transform:g}}function N2(){return f.useContext(ug)}const k2="Droppable",z2={timeout:25};function S2(t){let{data:s,disabled:n=!1,id:i,resizeObserverConfig:r}=t;const a=Hr(k2),{active:o,dispatch:l,over:c,measureDroppableContainers:d}=f.useContext(Mo),u=f.useRef({disabled:n}),m=f.useRef(!1),h=f.useRef(null),p=f.useRef(null),{disabled:j,updateMeasurementsFor:y,timeout:x}={...z2,...r},g=Sr(y??i),b=f.useCallback(()=>{if(!m.current){m.current=!0;return}p.current!=null&&clearTimeout(p.current),p.current=setTimeout(()=>{d(Array.isArray(g.current)?g.current:[g.current]),p.current=null},x)},[x]),v=Do({callback:b,disabled:j||!o}),C=f.useCallback((S,P)=>{v&&(P&&(v.unobserve(P),m.current=!1),S&&v.observe(S))},[v]),[T,z]=$a(C),N=Sr(s);return f.useEffect(()=>{!v||!T.current||(v.disconnect(),m.current=!1,v.observe(T.current))},[T,v]),f.useEffect(()=>(l({type:Je.RegisterDroppable,element:{id:i,key:a,disabled:n,node:T,rect:h,data:N}}),()=>l({type:Je.UnregisterDroppable,key:a,id:i})),[i]),f.useEffect(()=>{n!==u.current.disabled&&(l({type:Je.SetDroppableDisabled,id:i,key:a,disabled:n}),u.current.disabled=n)},[i,a,n,l]),{active:o,rect:h,isOver:c?.id===i,node:T,over:c,setNodeRef:z}}function sd(t,s,n){const i=t.slice();return i.splice(n<0?i.length+n:n,0,i.splice(s,1)[0]),i}function C2(t,s){return t.reduce((n,i,r)=>{const a=s.get(i);return a&&(n[r]=a),n},Array(t.length))}function ca(t){return t!==null&&t>=0}function _2(t,s){if(t===s)return!0;if(t.length!==s.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==s[n])return!1;return!0}function T2(t){return typeof t=="boolean"?{draggable:t,droppable:t}:t}const hg=t=>{let{rects:s,activeIndex:n,overIndex:i,index:r}=t;const a=sd(s,i,n),o=s[r],l=a[r];return!l||!o?null:{x:l.left-o.left,y:l.top-o.top,scaleX:l.width/o.width,scaleY:l.height/o.height}},da={scaleX:1,scaleY:1},A2=t=>{var s;let{activeIndex:n,activeNodeRect:i,index:r,rects:a,overIndex:o}=t;const l=(s=a[n])!=null?s:i;if(!l)return null;if(r===n){const d=a[o];return d?{x:0,y:n<o?d.top+d.height-(l.top+l.height):d.top-l.top,...da}:null}const c=P2(a,r,n);return r>n&&r<=o?{x:0,y:-l.height-c,...da}:r<n&&r>=o?{x:0,y:l.height+c,...da}:{x:0,y:0,...da}};function P2(t,s,n){const i=t[s],r=t[s-1],a=t[s+1];return i?n<s?r?i.top-(r.top+r.height):a?a.top-(i.top+i.height):0:a?a.top-(i.top+i.height):r?i.top-(r.top+r.height):0:0}const pg="Sortable",fg=re.createContext({activeIndex:-1,containerId:pg,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:hg,disabled:{draggable:!1,droppable:!1}});function D2(t){let{children:s,id:n,items:i,strategy:r=hg,disabled:a=!1}=t;const{active:o,dragOverlay:l,droppableRects:c,over:d,measureDroppableContainers:u}=N2(),m=Hr(pg,n),h=l.rect!==null,p=f.useMemo(()=>i.map(z=>typeof z=="object"&&"id"in z?z.id:z),[i]),j=o!=null,y=o?p.indexOf(o.id):-1,x=d?p.indexOf(d.id):-1,g=f.useRef(p),b=!_2(p,g.current),v=x!==-1&&y===-1||b,C=T2(a);zs(()=>{b&&j&&u(p)},[b,p,j,u]),f.useEffect(()=>{g.current=p},[p]);const T=f.useMemo(()=>({activeIndex:y,containerId:m,disabled:C,disableTransforms:v,items:p,overIndex:x,useDragOverlay:h,sortedRects:C2(p,c),strategy:r}),[y,m,C.draggable,C.droppable,v,p,x,c,h,r]);return re.createElement(fg.Provider,{value:T},s)}const M2=t=>{let{id:s,items:n,activeIndex:i,overIndex:r}=t;return sd(n,i,r).indexOf(s)},I2=t=>{let{containerId:s,isSorting:n,wasDragging:i,index:r,items:a,newIndex:o,previousItems:l,previousContainerId:c,transition:d}=t;return!d||!i||l!==a&&r===o?!1:n?!0:o!==r&&s===c},E2={duration:200,easing:"ease"},xg="transform",L2=_r.Transition.toString({property:xg,duration:0,easing:"linear"}),R2={roleDescription:"sortable"};function O2(t){let{disabled:s,index:n,node:i,rect:r}=t;const[a,o]=f.useState(null),l=f.useRef(n);return zs(()=>{if(!s&&n!==l.current&&i.current){const c=r.current;if(c){const d=$i(i.current,{ignoreTransform:!0}),u={x:c.left-d.left,y:c.top-d.top,scaleX:c.width/d.width,scaleY:c.height/d.height};(u.x||u.y)&&o(u)}}n!==l.current&&(l.current=n)},[s,n,i,r]),f.useEffect(()=>{a&&o(null)},[a]),a}function $2(t){let{animateLayoutChanges:s=I2,attributes:n,disabled:i,data:r,getNewIndex:a=M2,id:o,strategy:l,resizeObserverConfig:c,transition:d=E2}=t;const{items:u,containerId:m,activeIndex:h,disabled:p,disableTransforms:j,sortedRects:y,overIndex:x,useDragOverlay:g,strategy:b}=f.useContext(fg),v=q2(i,p),C=u.indexOf(o),T=f.useMemo(()=>({sortable:{containerId:m,index:C,items:u},...r}),[m,r,C,u]),z=f.useMemo(()=>u.slice(u.indexOf(o)),[u,o]),{rect:N,node:S,isOver:P,setNodeRef:w}=S2({id:o,data:T,disabled:v.droppable,resizeObserverConfig:{updateMeasurementsFor:z,...c}}),{active:k,activatorEvent:_,activeNodeRect:A,attributes:D,setNodeRef:R,listeners:L,isDragging:F,over:K,setActivatorNodeRef:q,transform:G}=v2({id:o,data:T,attributes:{...R2,...n},disabled:v.draggable}),X=nS(w,R),V=!!k,oe=V&&!j&&ca(h)&&ca(x),Se=!g&&F,it=Se&&oe?G:null,fe=oe?it??(l??b)({rects:y,activeNodeRect:A,activeIndex:h,overIndex:x,index:C}):null,gt=ca(h)&&ca(x)?a({id:o,items:u,activeIndex:h,overIndex:x}):C,jt=k?.id,ve=f.useRef({activeId:jt,items:u,newIndex:gt,containerId:m}),Vi=u!==ve.current.items,ps=s({active:k,containerId:m,isDragging:F,isSorting:V,id:o,index:C,items:u,newIndex:ve.current.newIndex,previousItems:ve.current.items,previousContainerId:ve.current.containerId,transition:d,wasDragging:ve.current.activeId!=null}),Un=O2({disabled:!ps,index:C,node:S,rect:N});return f.useEffect(()=>{V&&ve.current.newIndex!==gt&&(ve.current.newIndex=gt),m!==ve.current.containerId&&(ve.current.containerId=m),u!==ve.current.items&&(ve.current.items=u)},[V,gt,m,u]),f.useEffect(()=>{if(jt===ve.current.activeId)return;if(jt!=null&&ve.current.activeId==null){ve.current.activeId=jt;return}const Vn=setTimeout(()=>{ve.current.activeId=jt},50);return()=>clearTimeout(Vn)},[jt]),{active:k,activeIndex:h,attributes:D,data:T,rect:N,index:C,newIndex:gt,items:u,isOver:P,isSorting:V,isDragging:F,listeners:L,node:S,overIndex:x,over:K,setNodeRef:X,setActivatorNodeRef:q,setDroppableNodeRef:w,setDraggableNodeRef:R,transform:Un??fe,transition:Ts()};function Ts(){if(Un||Vi&&ve.current.newIndex===C)return L2;if(!(Se&&!Yc(_)||!d)&&(V||ps))return _r.Transition.toString({...d,property:xg})}}function q2(t,s){var n,i;return typeof t=="boolean"?{draggable:t,droppable:!1}:{draggable:(n=t?.draggable)!=null?n:s.draggable,droppable:(i=t?.droppable)!=null?i:s.droppable}}function Ba(t){if(!t)return!1;const s=t.data.current;return!!(s&&"sortable"in s&&typeof s.sortable=="object"&&"containerId"in s.sortable&&"items"in s.sortable&&"index"in s.sortable)}const F2=[ue.Down,ue.Right,ue.Up,ue.Left],B2=(t,s)=>{let{context:{active:n,collisionRect:i,droppableRects:r,droppableContainers:a,over:o,scrollableAncestors:l}}=s;if(F2.includes(t.code)){if(t.preventDefault(),!n||!i)return;const c=[];a.getEnabled().forEach(m=>{if(!m||m!=null&&m.disabled)return;const h=r.get(m.id);if(h)switch(t.code){case ue.Down:i.top<h.top&&c.push(m);break;case ue.Up:i.top>h.top&&c.push(m);break;case ue.Left:i.left>h.left&&c.push(m);break;case ue.Right:i.left<h.left&&c.push(m);break}});const d=wS({collisionRect:i,droppableRects:r,droppableContainers:c});let u=eg(d,"id");if(u===o?.id&&d.length>1&&(u=d[1].id),u!=null){const m=a.get(n.id),h=a.get(u),p=h?r.get(h.id):null,j=h?.node.current;if(j&&p&&m&&h){const x=Po(j).some((z,N)=>l[N]!==z),g=gg(m,h),b=U2(m,h),v=x||!g?{x:0,y:0}:{x:b?i.width-p.width:0,y:b?i.height-p.height:0},C={x:p.left,y:p.top};return v.x&&v.y?C:Cr(C,v)}}}};function gg(t,s){return!Ba(t)||!Ba(s)?!1:t.data.current.sortable.containerId===s.data.current.sortable.containerId}function U2(t,s){return!Ba(t)||!Ba(s)||!gg(t,s)?!1:t.data.current.sortable.index<s.data.current.sortable.index}const V2=()=>e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}),K2=({course:t,topicsCount:s,activitiesCount:n,accessCount:i})=>e.jsxs(nt,{variant:"2-2-4",children:[e.jsxs(I,{children:[e.jsx(O,{className:"pb-2",children:e.jsx($,{className:"text-sm font-medium",children:"Status"})}),e.jsx(E,{children:e.jsx(B,{variant:t?.is_published?"default":"secondary",children:t?.is_published?"Opublikowany":"Szkic"})})]}),e.jsxs(I,{children:[e.jsx(O,{className:"pb-2",children:e.jsx($,{className:"text-sm font-medium",children:"Tematy"})}),e.jsx(E,{children:e.jsx("div",{className:"text-2xl font-bold",children:s})})]}),e.jsxs(I,{children:[e.jsx(O,{className:"pb-2",children:e.jsx($,{className:"text-sm font-medium",children:"Aktywności"})}),e.jsx(E,{children:e.jsx("div",{className:"text-2xl font-bold",children:n})})]}),e.jsxs(I,{children:[e.jsx(O,{className:"pb-2",children:e.jsx($,{className:"text-sm font-medium",children:"Uczestników"})}),e.jsx(E,{children:e.jsx("div",{className:"text-2xl font-bold",children:i})})]})]}),W2=({id:t,disabled:s=!1,children:n})=>{const{attributes:i,listeners:r,setNodeRef:a,transform:o,transition:l,isDragging:c}=$2({id:t,disabled:s}),d={transform:_r.Transform.toString(o),transition:l,opacity:c?.5:1,cursor:c?"grabbing":"grab"},u=s?{}:{...i,...r,style:{cursor:c?"grabbing":"grab"}};return e.jsx("div",{ref:a,style:d,className:c?"z-50":"",children:n({dragHandleProps:u,isDragging:c})})},Gu=({items:t,renderItem:s,onReorder:n,className:i="space-y-2",disabled:r=!1})=>{const[a,o]=f.useState(t),[l,c]=f.useState(null),[d,u]=f.useState(null);f.useEffect(()=>{if(!d)o(t);else{const j=a.map(y=>{const x=t.find(g=>g.id===y.id);return x?{...x,position:y.position}:y});o(j)}},[t]);const m=gS(Iu(td,{activationConstraint:{distance:8}}),Iu(Xc,{coordinateGetter:B2})),h=j=>{c(Number(j.active.id))},p=j=>{const{active:y,over:x}=j;if(c(null),x&&y.id!==x.id){const g=a.findIndex(v=>v.id===Number(y.id)),b=a.findIndex(v=>v.id===Number(x.id));if(g!==-1&&b!==-1&&g!==b){let v;const C=a[g];if(b===0)v=a[0].position/2;else if(b===a.length-1)v=a[a.length-1].position+1e3;else if(g<b){const N=a[b],S=b+1<a.length?a[b+1]:null;S?v=(N.position+S.position)/2:v=N.position+1e3}else{const N=b>0?a[b-1]:null,S=a[b];N?v=(N.position+S.position)/2:v=S.position/2}const z=sd(a,g,b).map(N=>N.id===C.id?{...N,position:v}:N);o(z),u({id:C.id,position:v}),n(C.id,v),setTimeout(()=>u(null),2e3)}}};return e.jsx(y2,{sensors:m,collisionDetection:yS,onDragStart:h,onDragEnd:p,children:e.jsx(D2,{items:a.map(j=>j.id),strategy:A2,children:e.jsx("div",{className:i,children:a.map((j,y)=>e.jsx(W2,{id:j.id,disabled:r||d!==null&&d.id!==j.id,children:x=>s(j,y,x.dragHandleProps)},j.id))})})})},G2=()=>{const{list:t,edit:s}=xt(),{id:n}=ft(),[i,r]=Ya(),{data:a}=Ye(),o=a?.role==="admin",{navigateWithReturn:l,navigateToWizard:c}=W1(),{course:d,topics:u,groups:m,stats:h,isLoading:p,refetchTopics:j,refetchActivities:y,getActivitiesForTopic:x,getMembersCountForGroup:g}=G1(n),{togglePublish:b}=Rl("topics"),{togglePublish:v}=Rl("activities"),{updatePosition:C,isUpdating:T}=Du("topics"),{updatePosition:z,isUpdating:N}=Du("activities"),{mutate:S}=Is(),{mutate:P}=Is(),w=i.get("expanded");if(p)return e.jsx(V2,{});if(!d)return e.jsx(Z,{children:e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Nie znaleziono kursu"})})});const k=L=>{w===L.toString()?(i.delete("expanded"),r(i)):r({expanded:L.toString()})},_=(L,F)=>{confirm(`Czy na pewno chcesz usunąć temat "${F}" wraz ze wszystkimi aktywnościami?`)&&S({resource:"topics",id:L},{onSuccess:()=>{W.success("Temat został usunięty"),j(),y(),w===L.toString()&&(i.delete("expanded"),r(i))}})},A=(L,F)=>{confirm(`Czy na pewno chcesz usunąć aktywność "${F}"?`)&&P({resource:"activities",id:L},{onSuccess:()=>{W.success("Aktywność została usunięta"),y(),j()}})},D=async(L,F)=>{try{await C(L,F)}catch(K){console.error("Failed to reorder topic:",K)}},R=async(L,F)=>{try{await z(L,F)}catch(K){console.error("Failed to reorder activity:",K)}};return e.jsxs(Z,{children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>t("courses"),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Szczegóły kursu"}),e.jsx("div",{className:"flex gap-2",children:o&&e.jsxs(M,{onClick:()=>s("courses",d?.id??0),size:"sm",children:[e.jsx(Cs,{className:"w-4 h-4 mr-2"}),"Edytuj kurs"]})})]}),e.jsx(tS,{course:d})]}),e.jsx(K2,{course:d,topicsCount:h.topicsCount,activitiesCount:h.activitiesCount,accessCount:h.accessCount}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs(ie,{children:[e.jsxs($,{className:"flex items-center gap-2",children:["Struktura kursu",(T||N)&&e.jsxs("span",{className:"text-sm font-normal text-muted-foreground flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),"Zapisywanie..."]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(M,{size:"sm",onClick:()=>l(`/teacher/topics/create?course_id=${n}`),children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Dodaj temat"]})})]})}),e.jsx(E,{children:u.length>0?e.jsx(Gu,{items:u,onReorder:D,disabled:T||N,renderItem:(L,F,K)=>{const q=x(L.id),G=w===L.id.toString();return e.jsx(X1,{topic:{...L,position:F+1},isExpanded:G,onToggle:()=>k(L.id),onDelete:_,onEdit:(X,V)=>l(`/${X}/edit/${V}`),onTogglePublish:(X,V,oe)=>b(X,V,oe,j),activitiesCount:q.length,onNavigateToWizard:c,courseId:Number(d?.id),courseTitle:d?.title,dragHandleProps:K,children:q.length>0?e.jsx(Gu,{items:q,onReorder:R,disabled:N,renderItem:(X,V,oe)=>e.jsx(eS,{activity:{...X,position:V+1},topicPosition:F+1,onDelete:A,onEdit:(Se,it)=>l(`/${Se}/edit/${it}`),onTogglePublish:(Se,it,ze)=>v(Se,it,ze,y),dragHandleProps:oe},X.id)}):e.jsxs("div",{className:"text-center py-6 text-muted-foreground",children:[e.jsx("p",{children:"Brak aktywności w tym temacie"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-center mt-4",children:[e.jsxs(M,{size:"sm",variant:"outline",onClick:()=>l(`/activities/create?topic_id=${L.id}`),children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Dodaj ręcznie"]}),e.jsxs(M,{size:"sm",onClick:()=>c("/teacher/educational-material/step1",{courseId:d?.id,courseTitle:d?.title,topicId:L.id,topicTitle:L.title}),children:[e.jsx(pt,{className:"w-4 h-4 mr-2"}),"Generuj materiał z AI"]}),e.jsxs(M,{size:"sm",variant:"secondary",onClick:()=>c("/teacher/quiz-wizard/step1",{courseId:d?.id,courseTitle:d?.title,topicId:L.id,topicTitle:L.title}),children:[e.jsx(cn,{className:"w-4 h-4 mr-2"}),"Generuj quiz z AI"]})]})]})},L.id)}}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(kt,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Brak tematów w tym kursie"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center mt-4",children:[e.jsxs(M,{onClick:()=>l(`/topics/create?course_id=${n}`),children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Dodaj pierwszy temat"]}),e.jsxs(M,{variant:"secondary",onClick:()=>l(`/teacher/course-structure/edit/${d?.id}`),children:[e.jsx(_a,{className:"w-4 h-4 mr-2"}),"Wygeneruj strukturę z AI"]})]})]})})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs(ie,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5"}),"Grupy z dostępem"]}),e.jsxs(B,{variant:"outline",children:[m.length," ",m.length===1?"grupa":"grup"]})]})}),e.jsx(E,{children:m.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m.map(L=>e.jsx(sS,{group:L,membersCount:g(L.id),courseId:Number(n)},L.id))}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ce,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Brak przypisanych grup do tego kursu"}),e.jsx("p",{className:"text-sm mt-2",children:"Administrator może przypisać grupy w ustawieniach kursu"})]})})]})]})},Hu={name:"courses",list:"/teacher/courses",create:"/teacher/courses/create",edit:"/teacher/courses/edit/:id",show:"/teacher/courses/show/:id",meta:{label:"Kursy",icon:e.jsx(xe,{className:"h-4 w-4"})}},H2=[e.jsx(H,{path:"courses",element:e.jsx(H1,{})},"courses-list"),e.jsx(H,{path:"courses/create",element:e.jsx(Z1,{})},"courses-create"),e.jsx(H,{path:"courses/edit/:id",element:e.jsx(J1,{})},"courses-edit"),e.jsx(H,{path:"courses/show/:id",element:e.jsx(G2,{})},"courses-show")],Q2=()=>{const{edit:t,list:s}=xt(),{mutate:n}=En(),{mutate:i}=Is(),[r,a]=f.useState("all"),[o,l]=f.useState(!1),[c,d]=f.useState(null),u=r!=="all"?[{field:"course_id",operator:"eq",value:r}]:[],{data:m,isLoading:h,refetch:p}=Q({resource:"topics",meta:{populate:["courses"]},filters:u,pagination:{pageSize:20},sorters:[{field:"courses.title",order:"asc"},{field:"position",order:"asc"}]}),{data:j}=Q({resource:"courses",pagination:{pageSize:100},sorters:[{field:"title",order:"asc"}]}),y=m?.data||[],x=j?.data||[],g=async v=>{await n({resource:"topics",id:v.id,values:{is_published:!v.is_published},successNotification:()=>({message:v.is_published?"Temat został ukryty":"Temat został opublikowany",type:"success"})}),p()},b=v=>{d(v),l(!0)};return e.jsxs(Z,{children:[e.jsxs(ie,{children:[e.jsx(me,{title:"Tematy",description:"Zarządzaj tematami kursów"}),e.jsxs(ie,{variant:"start",className:"gap-2",children:[x.length>0&&e.jsxs(we,{value:r,onValueChange:a,children:[e.jsxs(ge,{className:"w-[250px]",children:[e.jsx(Nw,{className:"h-4 w-4 mr-2"}),e.jsx(be,{placeholder:"Filtruj po kursie"})]}),e.jsxs(je,{children:[e.jsx(Y,{value:"all",children:"Filtrowanie: Wszystkie kursy"}),e.jsx(Nt,{}),x.map(v=>e.jsx(Y,{value:v.id.toString(),children:v.title},v.id))]})]}),e.jsxs(M,{onClick:()=>s("courses"),children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Przejdź do kursów"]})]})]}),e.jsx(I,{children:e.jsx(E,{className:"p-0",children:h?e.jsx("div",{className:"p-8",children:e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((v,C)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Rt,{className:"h-12 w-12"}),e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(Rt,{className:"h-4 w-3/4"}),e.jsx(Rt,{className:"h-4 w-1/2"})]})]},C))})}):y.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(xe,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium text-muted-foreground",children:r!=="all"?"Brak tematów w wybranym kursie":"Brak tematów"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Aby dodać temat, przejdź do kursu"}),e.jsxs(M,{onClick:()=>s("courses"),children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Przejdź do kursów"]})]}):e.jsxs($s,{children:[e.jsx(qs,{children:e.jsxs(Xe,{children:[e.jsx(ne,{className:"w-[50px]",children:"#"}),e.jsx(ne,{children:"Tytuł"}),e.jsx(ne,{className:"w-[200px]",children:"Kurs"}),e.jsx(ne,{className:"w-[120px]",children:"Status"}),e.jsx(ne,{className:"w-[140px]",children:"Data utworzenia"}),e.jsx(ne,{className:"text-right w-[80px]",children:"Akcje"})]})}),e.jsx(Fs,{children:y.map(v=>e.jsxs(Xe,{children:[e.jsx(se,{className:"font-medium",children:e.jsx(B,{variant:"outline",className:"w-12 justify-center",children:v.position})}),e.jsx(se,{children:e.jsx("div",{className:"font-medium",children:v.title})}),e.jsx(se,{className:"max-w-[200px]",children:e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(xe,{className:"h-4 w-4 mr-2 text-muted-foreground shrink-0"}),e.jsx("span",{className:"truncate block",title:v.courses?.title||"Brak kursu",children:v.courses?.title||"Brak kursu"})]})}),e.jsx(se,{children:e.jsx(B,{variant:v.is_published?"default":"secondary",children:v.is_published?"Opublikowany":"Szkic"})}),e.jsx(se,{children:e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground",children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),new Date(v.created_at).toLocaleDateString("pl-PL")]})}),e.jsx(se,{className:"text-right",children:e.jsxs(ki,{children:[e.jsx(zi,{asChild:!0,children:e.jsxs(M,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Otwórz menu"}),e.jsx(kw,{className:"h-4 w-4"})]})}),e.jsxs(Dn,{align:"end",children:[e.jsxs(_e,{onClick:()=>t("topics",v.id),children:[e.jsx(Cs,{className:"mr-2 h-4 w-4"}),"Edytuj"]}),e.jsx(Nt,{}),e.jsx(_e,{onClick:()=>g(v),children:v.is_published?e.jsxs(e.Fragment,{children:[e.jsx(ui,{className:"mr-2 h-4 w-4"}),"Ukryj temat"]}):e.jsxs(e.Fragment,{children:[e.jsx(zw,{className:"mr-2 h-4 w-4"}),"Opublikuj temat"]})}),e.jsx(Nt,{}),e.jsxs(_e,{onClick:()=>b(v),className:"text-destructive focus:text-destructive",children:[e.jsx(dt,{className:"mr-2 h-4 w-4"}),"Usuń temat"]})]})]})})]},v.id))})]})})})]})},Z2=()=>{const{show:t}=xt(),s=le(),[n]=Ya(),i=n.get("course_id"),{data:r}=Le({resource:"courses",id:i,queryOptions:{enabled:!!i}}),{data:a,isLoading:o}=Q({resource:"topics",filters:[{field:"course_id",operator:"eq",value:i}],sorters:[{field:"position",order:"desc"}],pagination:{pageSize:1},queryOptions:{enabled:!!i}}),{refineCore:{onFinish:l},register:c,handleSubmit:d,setValue:u,watch:m,formState:{errors:h,isSubmitting:p}}=ln({defaultValues:{course_id:i?parseInt(i):void 0,is_published:!1,position:1},refineCoreProps:{successNotification:()=>({message:"Temat został utworzony",type:"success"}),redirect:!1,onMutationSuccess:()=>{i?t("courses",i):s("/courses")}}});f.useEffect(()=>{if(!o&&a&&a.data.length>0){const y=a.data[0].position+1;u("position",y)}},[a,o,u]);const j=()=>{i?t("courses",i):s("/courses")};return e.jsxs(Z,{children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:j,children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Powrót do kursu"]}),e.jsx(ie,{children:e.jsx(me,{title:"Dodaj temat",description:r?.data?`Do kursu: ${r.data.title}`:"Utwórz nowy temat"})}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Informacje o temacie"})}),e.jsx(E,{children:e.jsxs(mn,{onSubmit:d(l),children:[e.jsx("input",{type:"hidden",...c("course_id")}),e.jsx(de,{label:"Tytuł tematu",htmlFor:"title",error:h.title?.message,required:!0,children:e.jsx(J,{id:"title",placeholder:"np. Wprowadzenie do zmiennych",...c("title",{required:"Tytuł tematu jest wymagany",minLength:{value:3,message:"Tytuł musi mieć minimum 3 znaki"}})})}),e.jsx(de,{label:"Pozycja",htmlFor:"position",error:h.position?.message,required:!0,children:e.jsx(J,{id:"position",type:"number",min:"1",disabled:!0,className:"bg-muted",...c("position",{required:"Pozycja jest wymagana",min:{value:1,message:"Pozycja musi być większa od 0"},valueAsNumber:!0})})}),e.jsx(de,{label:"Status publikacji",children:e.jsxs(ie,{variant:"start",children:[e.jsx(zt,{checked:m("is_published")||!1,onCheckedChange:y=>u("is_published",y)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Opublikuj temat od razu"})]})}),e.jsxs(hn,{children:[e.jsx(M,{type:"button",variant:"outline",onClick:j,children:"Anuluj"}),e.jsx(M,{type:"submit",disabled:p||!i,children:p?"Tworzenie...":"Utwórz temat"})]})]})})]})]})},Mn=({variant:t="outline",size:s="sm",children:n="Powrót do kursu"})=>{const i=le(),r=ms(),a=()=>{const o=sessionStorage.getItem("returnUrl");if(o){sessionStorage.removeItem("returnUrl"),i(o);return}const c=new URLSearchParams(r.search).get("returnUrl");if(c){i(decodeURIComponent(c));return}i(-1)};return e.jsxs(M,{variant:t,size:s,onClick:a,children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),n]})},Y2=()=>{const{show:t}=xt(),{id:s}=ft(),n=le(),{data:i,isLoading:r}=Le({resource:"topics",id:s,liveMode:"off"}),a=i?.data,o=a?.course_id,{refineCore:{onFinish:l},register:c,handleSubmit:d,setValue:u,watch:m,formState:{errors:h,isSubmitting:p}}=ln({refineCoreProps:{resource:"topics",id:s,liveMode:"off",successNotification:()=>({message:"Temat został zaktualizowany",type:"success"}),redirect:!1,onMutationSuccess:()=>{const y=sessionStorage.getItem("returnUrl");y?(sessionStorage.removeItem("returnUrl"),n(y)):o&&n(`/teacher/courses/show/${o}?expanded=${s}`)}}}),j=()=>{const y=sessionStorage.getItem("returnUrl");y?(sessionStorage.removeItem("returnUrl"),n(y)):o?n(`/teacher/courses/show/${o}?expanded=${s}`):t("courses","")};return r?e.jsx(Z,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):e.jsxs(Z,{children:[e.jsx(Mn,{}),e.jsx(ie,{children:e.jsx(me,{title:"Edytuj temat",description:`Edycja: ${a?.title}`})}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Informacje o temacie"})}),e.jsx(E,{children:e.jsxs(mn,{onSubmit:d(l),children:[e.jsx(de,{label:"Tytuł tematu",htmlFor:"title",error:h.title?.message,required:!0,children:e.jsx(J,{id:"title",placeholder:"np. Wprowadzenie do zmiennych",...c("title",{required:"Tytuł tematu jest wymagany",minLength:{value:3,message:"Tytuł musi mieć minimum 3 znaki"}})})}),e.jsx(de,{label:"Pozycja",htmlFor:"position",error:h.position?.message,required:!0,children:e.jsx(J,{id:"position",type:"number",min:"1",...c("position",{required:"Pozycja jest wymagana",min:{value:1,message:"Pozycja musi być większa od 0"},valueAsNumber:!0})})}),e.jsx(de,{label:"Status publikacji",children:e.jsxs(ie,{variant:"start",children:[e.jsx(zt,{checked:m("is_published")||!1,onCheckedChange:y=>u("is_published",y)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Temat jest opublikowany"})]})}),e.jsxs(hn,{children:[e.jsx(M,{type:"button",variant:"outline",onClick:j,children:"Anuluj"}),e.jsx(M,{type:"submit",disabled:p,children:p?"Zapisywanie...":"Zapisz zmiany"})]})]})})]})]})},J2=[e.jsx(H,{path:"topics",element:e.jsx(Q2,{})},"topics-list"),e.jsx(H,{path:"topics/create",element:e.jsx(Z2,{})},"topics-create"),e.jsx(H,{path:"topics/edit/:id",element:e.jsx(Y2,{})},"topics-edit")],X2=t=>!t||!t.trim()?[{id:"section-0",title:"Cele lekcji",content:"",hasQuiz:!1},{id:"section-1",title:"Kluczowe pojęcia",content:"",hasQuiz:!1},{id:"section-2",title:"Szczegółowe omówienie",content:"",hasQuiz:!1},{id:"section-3",title:"Przykłady z życia",content:"",hasQuiz:!1},{id:"section-4",title:"Częste błędy i pułapki",content:"",hasQuiz:!1},{id:"section-5",title:"Podsumowanie",content:"",hasQuiz:!1}]:t.split(/\n(?=##\s+)/g).map((n,i)=>{const r=n.match(/^##\s+(.+?)$/m),a=r?r[1].trim():`Sekcja ${i+1}`,o=n.replace(/^##\s+.+?\n/,"").trim(),l=/```quiz[\s\S]*?```/g.test(o);return{id:`section-${i}`,title:a,content:o,hasQuiz:l}}),Qu=t=>t.filter(s=>s.title.trim()&&(s.content.trim()||s.hasQuiz)).map(s=>`## ${s.title}

${s.content}`).join(`

`),jg=({value:t,onChange:s,label:n,error:i,required:r,hint:a})=>{const[o,l]=f.useState([]),[c,d]=f.useState({}),[u,m]=f.useState({});f.useEffect(()=>{const x=X2(t);l(x);const g={};x.forEach(b=>{g[b.id]=!0}),d(g)},[t]);const h=x=>{d(g=>({...g,[x]:!g[x]}))},p=x=>{m(g=>({...g,[x]:!g[x]}))},j=(x,g)=>{const b=[...o];b[x]={...b[x],content:g,hasQuiz:/```quiz[\s\S]*?```/g.test(g)},l(b),s(Qu(b))},y=(x,g)=>{const b=[...o];b[x]={...b[x],title:g},l(b),s(Qu(b))};return e.jsxs("div",{className:"space-y-2",children:[n&&e.jsxs("label",{className:"text-sm font-medium",children:[n,r&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),a&&e.jsx("p",{className:"text-xs text-muted-foreground",children:a}),e.jsx("div",{className:"space-y-3",children:o.map((x,g)=>e.jsxs(I,{className:"overflow-hidden",children:[e.jsx(O,{className:"pb-3 bg-muted/30",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx(M,{type:"button",variant:"ghost",size:"sm",onClick:()=>h(x.id),className:"h-8 w-8 p-0 shrink-0",children:c[x.id]?e.jsx(Rr,{className:"h-4 w-4"}):e.jsx(Dt,{className:"h-4 w-4"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx(J,{type:"text",value:x.title,onChange:b=>y(g,b.target.value),className:"h-8 font-semibold border-none shadow-none focus-visible:ring-1",placeholder:"Tytuł sekcji"})})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[x.hasQuiz&&e.jsx(B,{variant:"secondary",className:"text-xs",children:"Quiz"}),e.jsxs(B,{variant:"outline",className:"text-xs",children:[g+1,"/6"]}),c[x.id]&&e.jsx(M,{type:"button",variant:"ghost",size:"sm",onClick:()=>p(x.id),className:"h-8",title:u[x.id]?"Tryb edycji":"Podgląd",children:u[x.id]?e.jsx(Sw,{className:"h-4 w-4"}):e.jsx(tt,{className:"h-4 w-4"})})]})]})}),c[x.id]&&e.jsxs(E,{className:"pt-4",children:[u[x.id]?e.jsx("div",{className:"prose prose-sm max-w-none dark:prose-invert border rounded-lg p-4 bg-muted/20 min-h-[150px]",children:x.content?e.jsx(Sn,{remarkPlugins:[An],children:x.content}):e.jsx("p",{className:"text-muted-foreground italic",children:"Brak treści w tej sekcji"})}):e.jsx(cs,{value:x.content,onChange:b=>j(g,b.target.value),className:"font-mono text-sm min-h-[200px]",placeholder:"Treść sekcji w Markdown...\\n\\n**Pogrubienie** *kursywa*\\n\\n- Lista\\n- Punktowana\\n\\n| Tabela | Kolumna |\\n|--------|--------|\\n| Dane   | Wartość |"}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-muted-foreground",children:[e.jsxs("span",{children:[x.content.length," znaków"]}),x.hasQuiz&&e.jsx("span",{className:"text-blue-600 font-medium",children:"Zawiera quiz"})]})]})]},x.id))}),i&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:i})]})},eC=()=>{const{show:t}=xt(),s=le(),[n]=Ya(),i=n.get("topic_id"),{data:r}=Le({resource:"topics",id:i,meta:{select:"*, courses(*)"},queryOptions:{enabled:!!i}}),{data:a,isLoading:o}=Q({resource:"activities",filters:[{field:"topic_id",operator:"eq",value:i}],sorters:[{field:"position",order:"desc"}],pagination:{pageSize:1},queryOptions:{enabled:!!i}}),{refineCore:{onFinish:l},register:c,handleSubmit:d,setValue:u,watch:m,formState:{errors:h,isSubmitting:p}}=ln({defaultValues:{topic_id:i?parseInt(i):void 0,type:"material",is_published:!1,position:1,passing_score:70},refineCoreProps:{successNotification:!1,redirect:!1,onMutationSuccess:x=>{const g=r?.data?.course_id,b=x.data.type;if(W.success("Aktywność została utworzona"),b==="quiz")W.info("Dodaj pytania do quizu"),s(`/teacher/questions/manage/${x.data.id}`);else{const v=sessionStorage.getItem("returnUrl");v?(sessionStorage.removeItem("returnUrl"),s(v)):s(g?`/teacher/courses/show/${g}?expanded=${i}`:"/teacher/courses")}}}}),j=m("type");f.useEffect(()=>{if(!o&&a&&a.data.length>0){const x=a.data[0].position+1;u("position",x)}},[a,o,u]);const y=()=>{const x=sessionStorage.getItem("returnUrl");x?(sessionStorage.removeItem("returnUrl"),s(x)):r?.data?.course_id?s(`/teacher/courses/show/${r.data.course_id}?expanded=${i}`):s("/teacher/courses")};return i?e.jsxs(Z,{children:[e.jsx(Mn,{}),e.jsx(ie,{children:e.jsx(me,{title:"Dodaj aktywność",description:r?.data?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"block text-lg",children:r.data.courses?.title}),e.jsxs("span",{className:"block text-sm text-muted-foreground",children:["Temat ",r.data.position,": ",r.data.title]})]}):"Utwórz nowy materiał lub quiz"})}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Informacje o aktywności"})}),e.jsx(E,{children:e.jsxs(mn,{onSubmit:d(l),children:[e.jsx("input",{type:"hidden",...c("topic_id")}),e.jsxs(nt,{variant:"1-2-2",children:[e.jsx(de,{label:"Typ aktywności",error:h.type?.message,required:!0,children:e.jsxs(we,{value:j,onValueChange:x=>u("type",x),children:[e.jsx(ge,{children:e.jsx(be,{placeholder:"Wybierz typ"})}),e.jsxs(je,{children:[e.jsx(Y,{value:"material",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(kt,{className:"w-4 h-4"}),"Materiał"]})}),e.jsx(Y,{value:"quiz",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-4 h-4"}),"Quiz"]})})]})]})}),e.jsx(de,{label:"Tytuł",htmlFor:"title",error:h.title?.message,required:!0,children:e.jsx(J,{id:"title",placeholder:j==="quiz"?"np. Test wiedzy z rozdziału":"np. Wprowadzenie do tematu",...c("title",{required:"Tytuł jest wymagany",minLength:{value:3,message:"Tytuł musi mieć minimum 3 znaki"}})})}),e.jsx(de,{label:"Pozycja w temacie",htmlFor:"position",error:h.position?.message,required:!0,children:e.jsx(J,{id:"position",type:"number",min:"1",disabled:!0,className:"bg-muted",...c("position",{required:"Pozycja jest wymagana",min:{value:1,message:"Pozycja musi być większa od 0"},valueAsNumber:!0})})}),e.jsx(de,{label:"Czas trwania (min)",htmlFor:"duration_min",hint:"Szacowany czas potrzebny na ukończenie",children:e.jsx(J,{id:"duration_min",type:"number",min:"1",placeholder:"np. 15",...c("duration_min",{min:{value:1,message:"Czas musi być większy od 0"},valueAsNumber:!0})})})]}),j==="material"&&e.jsxs(e.Fragment,{children:[e.jsx(jg,{value:m("content")||"",onChange:x=>u("content",x),label:"Treść materiału",error:h.content?.message,required:!0,hint:"Edytuj każdą sekcję osobno. Kliknij ikonę oka aby zobaczyć podgląd, kliknij kod aby wrócić do edycji."}),e.jsx(I,{className:"bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800",children:e.jsxs(E,{className:"pt-6",children:[e.jsx("p",{className:"text-sm",children:e.jsx("strong",{className:"text-blue-700 dark:text-blue-300",children:"Wskazówka dla nauczycieli:"})}),e.jsxs("ul",{className:"text-sm text-blue-600 dark:text-blue-400 mt-2 ml-4 space-y-1",children:[e.jsx("li",{children:"Materiał składa się z 6 sekcji"}),e.jsx("li",{children:"Każda sekcja ma własny edytor - rozwiń/zwiń przyciskiem strzałki"}),e.jsx("li",{children:"Używaj Markdown: **pogrubienie**, *kursywa*, listy, tabele"}),e.jsx("li",{children:"Pytania kontrolne dodajesz przez generator (krok 4) w formacie ```quiz"}),e.jsx("li",{children:"Uczniowie muszą odpowiedzieć na pytania aby odhaczyć sekcję"})]})]})})]}),j==="quiz"&&e.jsxs(e.Fragment,{children:[e.jsxs(nt,{variant:"1-1-1",children:[e.jsx(de,{label:"Próg zaliczenia (%)",htmlFor:"passing_score",error:h.passing_score?.message,hint:"Minimalny wynik do zaliczenia",children:e.jsx(J,{id:"passing_score",type:"number",min:"0",max:"100",...c("passing_score",{min:{value:0,message:"Wartość minimalna to 0"},max:{value:100,message:"Wartość maksymalna to 100"},valueAsNumber:!0})})}),e.jsx(de,{label:"Limit czasu (min)",htmlFor:"time_limit",hint:"Pozostaw puste dla braku limitu",children:e.jsx(J,{id:"time_limit",type:"number",min:"1",placeholder:"Brak limitu",...c("time_limit",{min:{value:1,message:"Limit musi być większy od 0"},valueAsNumber:!0})})}),e.jsx(de,{label:"Maksymalna liczba prób",htmlFor:"max_attempts",hint:"Pozostaw puste dla nieograniczonej liczby",children:e.jsx(J,{id:"max_attempts",type:"number",min:"1",placeholder:"Bez limitu",...c("max_attempts",{min:{value:1,message:"Minimum 1 próba"},valueAsNumber:!0})})})]}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{className:"text-blue-700 dark:text-blue-300",children:"Wskazówka:"})," ",e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:"Po utworzeniu quizu zostaniesz przekierowany do ekranu dodawania pytań."})]})})]}),e.jsx(de,{label:"Status publikacji",children:e.jsxs(ie,{variant:"start",children:[e.jsx(zt,{checked:m("is_published")||!1,onCheckedChange:x=>u("is_published",x)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Opublikuj aktywność od razu (uczniowie będą mogli ją zobaczyć)"})]})}),e.jsxs(hn,{children:[e.jsx(M,{type:"button",variant:"outline",onClick:y,disabled:p,children:"Anuluj"}),e.jsx(M,{type:"submit",disabled:p||!i,children:p?"Tworzenie...":j==="quiz"?"Utwórz i dodaj pytania":"Utwórz aktywność"})]})]})})]})]}):e.jsx(Z,{children:e.jsx(I,{children:e.jsxs(E,{className:"text-center py-12",children:[e.jsx("p",{className:"text-lg font-medium text-muted-foreground mb-4",children:"Nie wybrano tematu"}),e.jsx(M,{onClick:()=>s("/teacher/courses"),children:"Przejdź do kursów"})]})})})},tC=()=>{const{list:t}=xt(),{id:s}=ft(),n=le(),{data:i,isLoading:r}=Le({resource:"activities",id:s,liveMode:"off",meta:{select:"*, topics(*, courses(*))"}}),{data:a}=Le({resource:"questions",id:s,meta:{select:"count",filter:`activity_id.eq.${s}`},queryOptions:{enabled:!!s&&i?.data?.type==="quiz"}}),{refineCore:{onFinish:o,formLoading:l},register:c,handleSubmit:d,setValue:u,watch:m,reset:h,formState:{errors:p,isSubmitting:j}}=ln({refineCoreProps:{resource:"activities",id:s,liveMode:"off",redirect:!1,successNotification:!1,onMutationSuccess:()=>{const P=i?.data?.topics?.course_id,w=i?.data?.topic_id;W.success("Aktywność została zaktualizowana");const k=sessionStorage.getItem("returnUrl");k?(sessionStorage.removeItem("returnUrl"),n(k)):P?n(`/teacher/courses/show/${P}?expanded=${w}`):t("activities")},onMutationError:P=>{console.error("Błąd podczas aktualizacji:",P),P?.code==="PGRST204"?W.error("Błąd konfiguracji - skontaktuj się z administratorem"):P?.code==="23505"?W.error("Aktywność o tej pozycji już istnieje w tym temacie"):P?.code==="23503"?W.error("Nieprawidłowe powiązanie z tematem"):P?.message?W.error(`Błąd: ${P.message}`):W.error("Wystąpił nieoczekiwany błąd. Spróbuj ponownie.")}}});f.useEffect(()=>{if(i?.data){const{topics:P,_count:w,questions:k,..._}=i.data;h(_)}},[i,h]);const y=m("type")||i?.data?.type||"material";if(r||l)return e.jsx(Z,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const x=i?.data,g=x?.topics,b=g?.courses,v=b?.id,C=x?.topic_id,T=()=>{const P=sessionStorage.getItem("returnUrl");P?(sessionStorage.removeItem("returnUrl"),n(P)):v?n(`/teacher/courses/show/${v}?expanded=${C}`):t("activities")},z=()=>y==="quiz"?e.jsx(Be,{className:"w-6 h-6 text-blue-500"}):e.jsx(kt,{className:"w-6 h-6 text-green-500"}),N=()=>{const P=window.location.pathname+window.location.search;sessionStorage.setItem("returnUrl",P),n(`/teacher/questions/manage/${x?.id}`)},S=a?.data?.[0]?.count||0;return e.jsxs(Z,{children:[e.jsx(Mn,{}),"https://mdxeditor.dev/editor/demo",e.jsxs(ie,{children:[e.jsx(me,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[z(),"Edytuj aktywność"]}),description:e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"block text-lg font-medium",children:x?.title}),e.jsxs("span",{className:"block text-sm text-muted-foreground",children:[b?.title," → Temat ",g?.position,": ",g?.title]})]})}),y==="quiz"&&e.jsxs(M,{onClick:N,variant:"outline",children:[e.jsx(Xs,{className:"w-4 h-4 mr-2"}),"Zarządzaj pytaniami (",S,")"]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Informacje o aktywności"})}),e.jsx(E,{children:e.jsxs(mn,{onSubmit:d(o),children:[e.jsxs(nt,{variant:"1-2-2",children:[e.jsxs(de,{label:"Typ aktywności",error:p.type?.message,required:!0,children:[e.jsxs(we,{value:y,disabled:!0,children:[e.jsx(ge,{className:"bg-muted",children:e.jsx(be,{placeholder:"Wybierz typ"})}),e.jsxs(je,{children:[e.jsx(Y,{value:"material",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(kt,{className:"w-4 h-4"}),"Materiał"]})}),e.jsx(Y,{value:"quiz",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-4 h-4"}),"Quiz"]})})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Typ aktywności nie może być zmieniony"})]}),e.jsx(de,{label:"Tytuł",htmlFor:"title",error:p.title?.message,required:!0,children:e.jsx(J,{id:"title",placeholder:y==="quiz"?"np. Test wiedzy":"np. Wprowadzenie",...c("title",{required:"Tytuł jest wymagany",minLength:{value:3,message:"Tytuł musi mieć minimum 3 znaki"}})})}),e.jsx(de,{label:"Pozycja w temacie",htmlFor:"position",error:p.position?.message,required:!0,children:e.jsx(J,{id:"position",type:"number",min:"1",...c("position",{required:"Pozycja jest wymagana",min:{value:1,message:"Pozycja musi być większa od 0"},valueAsNumber:!0})})}),e.jsx(de,{label:"Czas trwania (min)",htmlFor:"duration_min",hint:"Szacowany czas potrzebny na ukończenie",children:e.jsx(J,{id:"duration_min",type:"number",min:"1",placeholder:"np. 15",...c("duration_min",{min:{value:1,message:"Czas musi być większy od 0"},valueAsNumber:!0})})})]}),y==="material"&&e.jsxs(e.Fragment,{children:[e.jsx(jg,{value:m("content")||"",onChange:P=>u("content",P),label:"Treść materiału",error:p.content?.message,required:!0,hint:"Edytuj każdą sekcję osobno. Struktura: 6 głównych sekcji. Pytania kontrolne dodajesz przez generator (krok 4)."}),e.jsx(I,{className:"bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800",children:e.jsxs(E,{className:"pt-6",children:[e.jsx("p",{className:"text-sm",children:e.jsx("strong",{className:"text-blue-700 dark:text-blue-300",children:"Struktura materiału:"})}),e.jsxs("ul",{className:"text-sm text-blue-600 dark:text-blue-400 mt-2 ml-4 space-y-1",children:[e.jsx("li",{children:"6 głównych sekcji: Cele → Pojęcia → Omówienie → Przykłady → Błędy → Podsumowanie"}),e.jsx("li",{children:"Każda sekcja ma własny edytor (rozwiń/zwiń strzałką)"}),e.jsx("li",{children:"Przycisk oka - podgląd, przycisk kodu - edycja"}),e.jsx("li",{children:"Pytania kontrolne (```quiz) dodajesz przez generator w kroku 4"}),e.jsx("li",{children:"Uczeń musi odpowiedzieć poprawnie aby odhaczyć sekcję"})]})]})})]}),y==="quiz"&&e.jsxs(e.Fragment,{children:[e.jsxs(nt,{variant:"1-1-1",children:[e.jsx(de,{label:"Próg zaliczenia (%)",htmlFor:"passing_score",error:p.passing_score?.message,hint:"Minimalny wynik do zaliczenia",children:e.jsx(J,{id:"passing_score",type:"number",min:"0",max:"100",...c("passing_score",{min:{value:0,message:"Wartość minimalna to 0"},max:{value:100,message:"Wartość maksymalna to 100"},valueAsNumber:!0})})}),e.jsx(de,{label:"Limit czasu (min)",htmlFor:"time_limit",hint:"Pozostaw puste dla braku limitu",children:e.jsx(J,{id:"time_limit",type:"number",min:"1",placeholder:"Brak limitu",...c("time_limit",{min:{value:1,message:"Limit musi być większy od 0"},valueAsNumber:!0})})}),e.jsx(de,{label:"Maksymalna liczba prób",htmlFor:"max_attempts",hint:"Pozostaw puste dla nieograniczonej liczby",children:e.jsx(J,{id:"max_attempts",type:"number",min:"1",placeholder:"Bez limitu",...c("max_attempts",{min:{value:1,message:"Minimum 1 próba"},valueAsNumber:!0})})})]}),S>0&&e.jsx(I,{className:"mt-4 bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800",children:e.jsx(E,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium",children:["Ten quiz zawiera ",S," ",S===1?"pytanie":S<5?"pytania":"pytań"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Możesz zarządzać pytaniami klikając przycisk powyżej"})]}),e.jsx(B,{variant:"outline",className:"text-lg px-3 py-1",children:S})]})})})]}),e.jsx(de,{label:"Status publikacji",children:e.jsxs(ie,{variant:"start",children:[e.jsx(zt,{checked:m("is_published")||!1,onCheckedChange:P=>u("is_published",P)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Aktywność jest opublikowana (uczniowie mogą ją zobaczyć)"})]})}),e.jsxs(hn,{children:[e.jsx(M,{type:"button",variant:"outline",onClick:T,disabled:j,children:"Anuluj"}),e.jsx(M,{type:"submit",disabled:j,children:j?"Zapisywanie...":"Zapisz zmiany"})]})]})})]})]})},sC=({duration_min:t,position:s,created_at:n,updated_at:i})=>e.jsxs("div",{className:"space-y-4",children:[t&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(De,{className:"w-4 h-4"}),e.jsx("span",{children:"Czas trwania"})]}),e.jsxs("p",{className:"text-base font-medium pl-6",children:[t," minut"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(tp,{className:"w-4 h-4"}),e.jsx("span",{children:"Pozycja w temacie"})]}),e.jsx("p",{className:"text-base font-medium pl-6",children:s})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(At,{className:"w-4 h-4"}),e.jsx("span",{children:"Data utworzenia"})]}),e.jsx("p",{className:"text-base font-medium pl-6",children:new Date(n).toLocaleDateString("pl-PL",{day:"2-digit",month:"long",year:"numeric"})})]}),i&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(At,{className:"w-4 h-4"}),e.jsx("span",{children:"Ostatnia aktualizacja"})]}),e.jsx("p",{className:"text-base font-medium pl-6",children:new Date(i).toLocaleDateString("pl-PL",{day:"2-digit",month:"long",year:"numeric"})})]})]}),nC=({activity:t})=>e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[1fr,300px]",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Treść materiału"})}),e.jsx(E,{children:t.content?e.jsx(mo,{content:t.content,showMetadata:!1,height:"600px"}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(kt,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Brak treści materiału"})]})})]}),e.jsxs(I,{children:[e.jsx(O,{className:"pb-3",children:e.jsx($,{className:"text-base",children:"Informacje"})}),e.jsx(E,{children:e.jsx(sC,{duration_min:t.duration_min,position:t.position,created_at:t.created_at,updated_at:t.updated_at})})]})]}),iC=({activity:t,questionsCount:s,questionsData:n,questionsLoading:i,onNavigateToQuestions:r})=>{const a=n?.reduce((l,c)=>l+(c.points||0),0)||0,o=Math.ceil((t.passing_score||70)/100*a);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Parametry quizu"})}),e.jsx(E,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(De,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Czas trwania"})]}),e.jsxs("p",{className:"text-2xl font-bold",children:[t.duration_min||"-"," min"]})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(We,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Próg zaliczenia"})]}),e.jsxs("p",{className:"text-2xl font-bold",children:[t.passing_score||70,"%"]})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Cw,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Limit czasu"})]}),e.jsx("p",{className:"text-2xl font-bold",children:t.time_limit?`${t.time_limit} min`:"Brak"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(gr,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Liczba prób"})]}),e.jsx("p",{className:"text-2xl font-bold",children:t.max_attempts||"Bez limitu"})]})]})})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Pytania (",s,")"]}),s>0&&e.jsxs(M,{size:"sm",variant:"outline",onClick:()=>r(t.id),children:[e.jsx(Cs,{className:"w-3 h-3 mr-1"}),"Zarządzaj"]})]})}),e.jsx(E,{children:s===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Be,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground/30"}),e.jsx("p",{className:"text-lg font-medium text-muted-foreground mb-2",children:"Ten quiz nie ma jeszcze pytań"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"Dodaj pytania, aby uczniowie mogli rozwiązać quiz"}),e.jsxs(M,{onClick:()=>r(t.id),children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Dodaj pierwsze pytanie"]})]}):i?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})}):e.jsx("div",{className:"space-y-2",children:n?.map((l,c)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg border bg-card hover:bg-muted/50 transition-colors",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center text-sm font-semibold",children:c+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[l.type==="single_choice"&&e.jsxs(B,{variant:"outline",className:"text-xs",children:[e.jsx(Pt,{className:"w-3 h-3 mr-1"}),"Jednokrotny wybór"]}),l.type==="multiple_choice"&&e.jsxs(B,{variant:"outline",className:"text-xs",children:[e.jsx(Xs,{className:"w-3 h-3 mr-1"}),"Wielokrotny wybór"]}),l.type==="true_false"&&e.jsxs(B,{variant:"outline",className:"text-xs",children:[e.jsx(Re,{className:"w-3 h-3 mr-1"}),"Prawda/Fałsz"]}),e.jsxs(B,{variant:"secondary",className:"text-xs",children:[l.points," pkt"]})]}),e.jsx("p",{className:"text-sm font-medium line-clamp-2",children:l.content}),l.explanation&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-1",children:[e.jsx("span",{className:"font-medium",children:"Wyjaśnienie:"})," ",l.explanation]})]})]},l.id))})})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(I,{children:[e.jsx(O,{className:"pb-3",children:e.jsx($,{className:"text-base",children:"Statystyki"})}),e.jsx(E,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Liczba pytań"}),e.jsx("span",{className:"font-medium",children:s})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Maksymalna liczba punktów"}),e.jsx("span",{className:"font-medium",children:a})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Wymagane punkty do zaliczenia"}),e.jsx("span",{className:"font-medium",children:o})]})]})})]}),e.jsxs(I,{children:[e.jsx(O,{className:"pb-3",children:e.jsx($,{className:"text-base",children:"Informacje"})}),e.jsx(E,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Pozycja w temacie"}),e.jsx("span",{className:"font-medium",children:t.position})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Data utworzenia"}),e.jsx("span",{className:"font-medium",children:new Date(t.created_at).toLocaleDateString("pl-PL")})]}),t.updated_at&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ostatnia aktualizacja"}),e.jsx("span",{className:"font-medium",children:new Date(t.updated_at).toLocaleDateString("pl-PL")})]})]})})]})]})]})},rC=()=>{const{edit:t}=xt(),{id:s}=ft(),n=le(),{data:i,isLoading:r}=Le({resource:"activities",id:s,meta:{select:"*, topics(*, courses(*)), questions:questions(count)"}}),{data:a,isLoading:o}=Q({resource:"questions",filters:[{field:"activity_id",operator:"eq",value:parseInt(s)}],sorters:[{field:"position",order:"asc"}],queryOptions:{enabled:i?.data?.type==="quiz"&&!!s}});if(r)return e.jsx(Z,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const l=i?.data;if(!l)return e.jsx(Z,{children:e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Nie znaleziono aktywności"})})});const c=l.topics,d=c?.courses,u=l.questions?.[0]?.count||l._count?.questions||0,m=()=>{const y=window.location.pathname+window.location.search;sessionStorage.setItem("returnUrl",y),t("activities",l.id??"")},h=y=>{const x=window.location.pathname+window.location.search;sessionStorage.setItem("returnUrl",x),n(y)},p=()=>l.type==="quiz"?e.jsx(Be,{className:"w-5 h-5"}):e.jsx(kt,{className:"w-5 h-5"}),j=()=>l.type==="quiz"?"text-blue-500":"text-green-500";return e.jsxs(Z,{children:[e.jsx(Mn,{}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"text-sm text-muted-foreground mb-2",children:[d?.title," → Temat ",c?.position,": ",c?.title]}),e.jsxs(ie,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg bg-muted ${j()}`,children:p()}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:l.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(B,{variant:l.type==="quiz"?"default":"secondary",children:l.type==="quiz"?"Quiz":"Materiał"}),e.jsx(B,{variant:l.is_published?"default":"outline",children:l.is_published?e.jsxs(e.Fragment,{children:[e.jsx(tt,{className:"w-3 h-3 mr-1"})," Opublikowany"]}):e.jsxs(e.Fragment,{children:[e.jsx(dn,{className:"w-3 h-3 mr-1"})," Szkic"]})})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[l.type==="quiz"&&e.jsxs(M,{variant:"outline",onClick:()=>h(`/teacher/questions/manage/${l.id}`),children:[e.jsx(Xs,{className:"w-4 h-4 mr-2"}),"Zarządzaj pytaniami (",u,")"]}),e.jsxs(M,{onClick:m,children:[e.jsx(Cs,{className:"w-4 h-4 mr-2"}),"Edytuj"]})]})]})]}),l.type==="material"?e.jsx(nC,{activity:l}):e.jsx(iC,{activity:l,questionsCount:u,questionsData:a?.data,questionsLoading:o,onNavigateToQuestions:y=>h(`/teacher/questions/manage/${y}`)})]})},Zu={name:"activities",list:"/teacher/activities/create",create:"/teacher/activities/create",edit:"/teacher/activities/edit/:id",show:"/teacher/activities/show/:id",meta:{hide:!0}},aC=[e.jsx(H,{path:"activities/create",element:e.jsx(eC,{})},"activities-create"),e.jsx(H,{path:"activities/edit/:id",element:e.jsx(tC,{})},"activities-edit"),e.jsx(H,{path:"activities/show/:id",element:e.jsx(rC,{})},"activities-show")],oC=()=>{const{create:t,edit:s,show:n}=xt(),i=le(),{mutate:r}=Is(),{tableQuery:{data:a,isLoading:o,isError:l,refetch:c},current:d,setCurrent:u,pageSize:m,setFilters:h}=Yh({sorters:{initial:[{field:"created_at",order:"desc"}]},meta:{select:"*, group_members(count), course_access(count)"}}),p=yc({isLoading:o,isError:l});if(p)return p;const j=(g,b)=>{confirm(`Czy na pewno chcesz usunąć grupę "${b}"? Ta akcja usunie również wszystkie przypisania uczniów i kursów.`)&&r({resource:"groups",id:g},{onSuccess:()=>{W.success("Grupa została usunięta"),c()},onError:()=>{W.error("Błąd podczas usuwania grupy")}})},y=(g,b)=>{b?.stopPropagation(),i(`/teacher/groups/${g}/assign-students`)},x=g=>!g||!Array.isArray(g)||g.length===0?0:g[0].count||0;return e.jsxs(Z,{children:[e.jsx(ie,{children:e.jsx(me,{title:"Grupy",description:"Zarządzaj grupami uczniów i przypisuj im kursy"})}),e.jsx(ie,{children:e.jsx(J,{placeholder:"Szukaj grup...",className:"max-w-sm",onChange:g=>{h([{field:"name",operator:"contains",value:g.target.value}])}})}),a?.data?.length===0?e.jsx(I,{className:"border-dashed border-2",children:e.jsxs(E,{className:"text-center py-12",children:[e.jsx(ce,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Brak grup"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Utwórz pierwszą grupę, aby móc przypisywać uczniów do kursów"}),e.jsxs(M,{onClick:()=>t("groups"),children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Utwórz pierwszą grupę"]})]})}):e.jsx(nt,{children:a?.data?.map(g=>{const b=x(g.group_members),v=x(g.course_access);return e.jsxs(I,{className:"cursor-pointer transition-all hover:shadow-lg hover:border-primary/50 relative overflow-hidden",onClick:C=>{!C.target.closest('[role="menu"]')&&!C.target.closest(".quick-action")&&n("groups",g.id)},children:[!g.is_active&&e.jsx("div",{className:"absolute inset-0 bg-muted/50 z-10 pointer-events-none"}),e.jsx(O,{children:e.jsxs(ie,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"truncate",children:g.name})]}),e.jsxs(ki,{children:[e.jsx(zi,{asChild:!0,children:e.jsx(M,{variant:"ghost",size:"sm",onClick:C=>C.stopPropagation(),className:"relative z-20",children:e.jsx(io,{className:"h-4 w-4"})})}),e.jsxs(Dn,{align:"end",children:[e.jsxs(_e,{onClick:()=>n("groups",g.id),children:[e.jsx(tt,{className:"mr-2 h-4 w-4"}),"Podgląd"]}),e.jsxs(_e,{onClick:()=>s("groups",g.id),children:[e.jsx(Cs,{className:"mr-2 h-4 w-4"}),"Edytuj"]}),e.jsx(Nt,{}),e.jsxs(_e,{onClick:C=>y(g.id,C),className:"text-blue-600 focus:text-blue-600",children:[e.jsx(Cn,{className:"mr-2 h-4 w-4"}),"Dodaj uczniów"]}),e.jsx(Nt,{}),e.jsxs(_e,{onClick:()=>j(g.id,g.name),className:"text-red-600 focus:text-red-600",children:[e.jsx(dt,{className:"mr-2 h-4 w-4"}),"Usuń"]})]})]})]})}),e.jsx(E,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(At,{className:"w-4 h-4"}),e.jsxs("span",{children:["Rok akademicki: ",g.academic_year]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-background rounded-md",children:e.jsx(ce,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Uczniowie"}),e.jsx("p",{className:"text-lg font-semibold",children:b})]})]})}),e.jsx("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-background rounded-md",children:e.jsx(xe,{className:"w-4 h-4 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Kursy"}),e.jsx("p",{className:"text-lg font-semibold",children:v})]})]})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsx(B,{variant:g.is_active?"default":"secondary",className:g.is_active?"bg-green-600":"",children:g.is_active?"Aktywna":"Nieaktywna"}),e.jsx("div",{className:"flex gap-1",children:b===0&&e.jsx(M,{size:"sm",variant:"ghost",className:"h-8 px-2 quick-action text-blue-600 hover:text-blue-700 hover:bg-blue-50",onClick:C=>y(g.id,C),title:"Dodaj uczniów",children:e.jsx(Cn,{className:"h-4 w-4"})})})]})]})})]},g.id)})}),e.jsx(_p,{current:d,pageSize:m,total:a?.total||0,setCurrent:u,itemName:"grup"})]})},lC=()=>{const{list:t}=xt(),{data:s}=Ye(),{refineCore:{onFinish:n},register:i,handleSubmit:r,setValue:a,watch:o,formState:{errors:l,isSubmitting:c}}=ln({defaultValues:{name:"",vendor_id:s?.vendor_id||0,is_active:!0,academic_year:new Date().getFullYear().toString()+"/"+(new Date().getFullYear()+1).toString()}});return e.jsxs(Z,{children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>t("groups"),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsx(ie,{children:e.jsx(me,{title:"Dodaj grupę",description:"Utwórz nową grupę uczniów"})}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Informacje o grupie"})}),e.jsx(E,{children:e.jsxs(mn,{onSubmit:r(n),children:[e.jsx(de,{label:"Nazwa grupy",htmlFor:"name",error:l.name?.message?.toString(),required:!0,children:e.jsx(J,{id:"name",placeholder:"np. Klasa 1A",...i("name",{required:"Nazwa grupy jest wymagana",minLength:{value:2,message:"Nazwa musi mieć minimum 2 znaki"}})})}),e.jsx(de,{label:"Rok akademicki",htmlFor:"academic_year",error:l.academic_year?.message?.toString(),required:!0,children:e.jsx(J,{id:"academic_year",placeholder:"np. 2024/2025",...i("academic_year",{required:"Rok akademicki jest wymagany",pattern:{value:/^\d{4}\/\d{4}$/,message:"Format: RRRR/RRRR (np. 2024/2025)"}})})}),e.jsx(de,{label:"Status grupy",children:e.jsxs(ie,{variant:"start",children:[e.jsx(zt,{checked:o("is_active"),onCheckedChange:d=>a("is_active",d)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Grupa aktywna"})]})}),e.jsxs(hn,{children:[e.jsx(M,{type:"button",variant:"outline",onClick:()=>t("groups"),children:"Anuluj"}),e.jsx(M,{type:"submit",disabled:c,children:c?"Tworzenie...":"Utwórz grupę"})]})]})})]})]})},cC=()=>{const{list:t}=xt(),{id:s}=ft(),{data:n,isLoading:i}=Le({resource:"groups",id:s,liveMode:"off"}),{refineCore:{onFinish:r},register:a,handleSubmit:o,setValue:l,watch:c,reset:d,formState:{errors:u,isSubmitting:m}}=ln({refineCoreProps:{resource:"groups",id:s,redirect:"list",liveMode:"off"}});return f.useEffect(()=>{n?.data&&d({name:n.data.name,academic_year:n.data.academic_year,is_active:n.data.is_active,vendor_id:n.data.vendor_id})},[n,d]),i?e.jsx(Z,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):e.jsxs(Z,{children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>t("groups"),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsx(ie,{children:e.jsx(me,{title:"Edytuj grupę",description:`Edycja: ${n?.data?.name}`})}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Informacje o grupie"})}),e.jsx(E,{children:e.jsxs(mn,{onSubmit:o(r),children:[e.jsx(de,{label:"Nazwa grupy",htmlFor:"name",error:u.name?.message,required:!0,children:e.jsx(J,{id:"name",placeholder:"np. Klasa 1A",...a("name",{required:"Nazwa grupy jest wymagana",minLength:{value:2,message:"Nazwa musi mieć minimum 2 znaki"}})})}),e.jsx(de,{label:"Rok akademicki",htmlFor:"academic_year",error:u.academic_year?.message,required:!0,children:e.jsx(J,{id:"academic_year",placeholder:"np. 2024/2025",...a("academic_year",{required:"Rok akademicki jest wymagany",pattern:{value:/^\d{4}\/\d{4}$/,message:"Format: RRRR/RRRR (np. 2024/2025)"}})})}),e.jsx(de,{label:"Status grupy",children:e.jsxs(ie,{variant:"start",children:[e.jsx(zt,{checked:c("is_active"),onCheckedChange:h=>l("is_active",h)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Grupa aktywna"})]})}),e.jsxs(hn,{children:[e.jsx(M,{type:"button",variant:"outline",onClick:()=>t("groups"),children:"Anuluj"}),e.jsx(M,{type:"submit",disabled:m,children:m?"Zapisywanie...":"Zapisz zmiany"})]})]})})]})]})},dC=()=>{const{list:t,edit:s,show:n}=xt(),{id:i}=ft(),r=le(),a=Jh(),{data:o,isLoading:l}=Le({resource:"groups",id:i,liveMode:"off"}),{data:c,isLoading:d}=Q({resource:"group_members",filters:[{field:"group_id",operator:"eq",value:i}],meta:{select:"*, users(*)"},queryOptions:{enabled:!!i},liveMode:"off"}),{data:u,isLoading:m}=Q({resource:"course_access",filters:[{field:"group_id",operator:"eq",value:i}],meta:{select:"*, courses(*)"},queryOptions:{enabled:!!i},liveMode:"off"}),h=async(g,b)=>{if(confirm(`Czy na pewno chcesz odpiąć kurs "${b}" od tej grupy?`))try{const{error:v}=await ee.from("course_access").delete().eq("course_id",g).eq("group_id",parseInt(i));if(v)throw v;W.success("Kurs został odpięty od grupy"),a({resource:"course_access",invalidates:["list"]})}catch(v){console.error("Error removing course:",v),W.error("Błąd podczas odpinania kursu")}},p=async(g,b)=>{if(confirm(`Czy na pewno chcesz usunąć "${b}" z tej grupy?`))try{const{error:v}=await ee.from("group_members").delete().eq("user_id",g).eq("group_id",parseInt(i));if(v)throw v;W.success("Uczeń został usunięty z grupy"),a({resource:"group_members",invalidates:["list"]})}catch(v){console.error("Error removing member:",v),W.error("Błąd podczas usuwania ucznia z grupy")}};if(l||d||m)return e.jsx(Z,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const j=o?.data,y=c?.total||0,x=u?.total||0;return e.jsxs(Z,{children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>t("groups"),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsxs(ie,{children:[e.jsxs("div",{children:[e.jsx(me,{title:j?.name,description:`Rok akademicki: ${j?.academic_year}`}),!j?.is_active&&e.jsx(B,{variant:"secondary",className:"mt-2",children:"Grupa nieaktywna"})]}),e.jsxs(M,{onClick:()=>s("groups",j?.id??""),children:[e.jsx(Cs,{className:"w-4 h-4 mr-2"}),"Edytuj grupę"]})]}),!j?.is_active&&e.jsxs(he,{children:[e.jsx(Re,{className:"h-4 w-4"}),e.jsx(pe,{children:"Ta grupa jest nieaktywna. Uczniowie nie mają dostępu do przypisanych kursów."})]}),e.jsxs(nt,{variant:"2-2-4",children:[e.jsxs(I,{children:[e.jsx(O,{className:"pb-2",children:e.jsx($,{className:"text-sm font-medium",children:"Status"})}),e.jsx(E,{children:e.jsx(B,{variant:j?.is_active?"default":"secondary",className:j?.is_active?"bg-green-600":"",children:j?.is_active?"Aktywna":"Nieaktywna"})})]}),e.jsxs(I,{children:[e.jsx(O,{className:"pb-2",children:e.jsx($,{className:"text-sm font-medium",children:"Uczniowie"})}),e.jsx(E,{children:e.jsx("div",{className:"text-2xl font-bold",children:y})})]}),e.jsxs(I,{children:[e.jsx(O,{className:"pb-2",children:e.jsx($,{className:"text-sm font-medium",children:"Kursy"})}),e.jsx(E,{children:e.jsx("div",{className:"text-2xl font-bold",children:x})})]}),e.jsxs(I,{children:[e.jsx(O,{className:"pb-2",children:e.jsx($,{className:"text-sm font-medium",children:"Utworzono"})}),e.jsx(E,{children:e.jsx("div",{className:"text-sm",children:new Date(j?.created_at).toLocaleDateString("pl-PL")})})]})]}),e.jsxs(nt,{variant:"1-2-2",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs(ie,{children:[e.jsx($,{children:"Uczniowie grupy"}),e.jsxs(M,{size:"sm",onClick:()=>r(`/teacher/groups/${i}/assign-students`),children:[e.jsx(Cn,{className:"w-4 h-4 mr-2"}),"Dodaj ucznia"]})]})}),e.jsx(E,{children:c?.data?.length?e.jsx("div",{className:"space-y-2",children:c.data.map(g=>e.jsx("div",{className:"p-4 border rounded-lg hover:bg-muted/30 transition-all duration-200 group cursor-pointer",onClick:()=>n("users",g.user_id),children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-muted/50 flex items-center justify-center flex-shrink-0",children:e.jsx(ce,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-base leading-tight truncate pr-2",children:g.users?.full_name}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(eo,{className:"h-3.5 w-3.5 text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:g.users?.email})]})]})]}),e.jsx("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Xn,{children:e.jsxs(ei,{children:[e.jsx(ti,{asChild:!0,children:e.jsx(M,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-red-50",onClick:b=>{b.stopPropagation(),p(g.user_id,g.users?.full_name)},children:e.jsx(dt,{className:"h-4 w-4 text-red-600"})})}),e.jsx(jn,{children:e.jsx("p",{children:"Usuń z grupy"})})]})})})]})},g.user_id))}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ce,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Brak uczniów w grupie"}),e.jsxs(M,{size:"sm",variant:"outline",className:"mt-4",onClick:()=>r(`/teacher/groups/${i}/assign-students`),children:[e.jsx(Cn,{className:"w-4 h-4 mr-2"}),"Dodaj pierwszego ucznia"]})]})})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx(ie,{children:e.jsx($,{children:"Przypisane kursy"})})}),e.jsx(E,{children:u?.data?.length?e.jsx("div",{className:"space-y-2",children:u.data.map(g=>e.jsx("div",{className:"p-4 border rounded-lg hover:bg-muted/30 transition-all duration-200 group cursor-pointer",onClick:()=>n("courses",g.course_id),children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:g.courses?.icon_emoji?e.jsx("div",{className:"h-10 w-10 rounded-lg bg-muted/50 flex items-center justify-center",children:e.jsx("span",{className:"text-xl",children:g.courses.icon_emoji})}):e.jsx("div",{className:"h-10 w-10 rounded-lg bg-muted/50 flex items-center justify-center",children:e.jsx(xe,{className:"h-5 w-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-base leading-tight truncate pr-2",children:g.courses?.title}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(At,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:new Date(g.assigned_at).toLocaleDateString("pl-PL")})]}),e.jsx(B,{variant:g.courses?.is_published?"default":"secondary",className:`text-xs ${g.courses?.is_published?"bg-green-100 text-green-700 hover:bg-green-100":""}`,children:g.courses?.is_published?"Opublikowany":"Szkic"})]})]})]}),e.jsx("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Xn,{children:e.jsxs(ei,{children:[e.jsx(ti,{asChild:!0,children:e.jsx(M,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-red-50",onClick:b=>{b.stopPropagation(),h(g.course_id,g.courses?.title)},children:e.jsx(dt,{className:"h-4 w-4 text-red-600"})})}),e.jsx(jn,{children:e.jsx("p",{children:"Odepnij kurs"})})]})})})]})},g.course_id))}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(xe,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Brak przypisanych kursów"}),e.jsxs(M,{size:"sm",variant:"outline",className:"mt-4",onClick:()=>r(`/teacher/groups/${i}/assign-courses`),children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Przypisz pierwszy kurs"]})]})})]})]})]})},uC=()=>{const{id:t}=ft(),s=le(),[n,i]=f.useState([]),[r,a]=f.useState(""),{data:o,isLoading:l}=Le({resource:"groups",id:t}),{data:c,isLoading:d}=Q({resource:"users",filters:[{field:"role",operator:"eq",value:"student"}],pagination:{mode:"off"}}),{data:u,isLoading:m}=Q({resource:"group_members",filters:[{field:"group_id",operator:"eq",value:parseInt(t)}],pagination:{mode:"off"},meta:{select:"user_id, group_id"}}),{mutate:h,isLoading:p}=os(),j=async()=>{if(n.length===0){W.error("Wybierz przynajmniej jednego ucznia");return}try{const z=n.map(N=>h({resource:"group_members",values:{user_id:N,group_id:parseInt(t)}},{onSuccess:()=>{console.log(`Student ${N} assigned successfully`)},onError:S=>{console.error("Error assigning student:",N,S)}}));await Promise.all(z),W.success(`Dodano ${n.length} uczniów do grupy`),s(`/teacher/groups/show/${t}`)}catch(z){W.error("Błąd podczas dodawania uczniów"),console.error("Error details:",z)}};if(l||d||m)return e.jsx(Z,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const y=o?.data,x=u?.data?.map(z=>z.user_id)||[],g=c?.data?.filter(z=>!x.includes(z.id))||[],b=g.filter(z=>z.full_name.toLowerCase().includes(r.toLowerCase())||z.email.toLowerCase().includes(r.toLowerCase())),v=z=>{i(N=>N.includes(z)?N.filter(S=>S!==z):[...N,z])},C=()=>{i(b.map(z=>z.id))},T=()=>{i([])};return e.jsxs(Z,{children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>s(`/teacher/groups/show/${t}`),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Powrót do grupy"]}),e.jsx(ie,{children:e.jsx(me,{title:"Dodaj uczniów",description:`Dodawanie uczniów do grupy: ${y?.name}`})}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs(ie,{children:[e.jsx($,{children:"Dostępni uczniowie"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:C,disabled:b.length===0,children:[e.jsx($t,{className:"w-4 h-4 mr-2"}),"Zaznacz wszystkich"]}),e.jsxs(M,{variant:"outline",size:"sm",onClick:T,disabled:n.length===0,children:[e.jsx(ls,{className:"w-4 h-4 mr-2"}),"Odznacz wszystkich"]})]})]})}),e.jsxs(E,{children:[e.jsx(J,{placeholder:"Szukaj uczniów...",value:r,onChange:z=>a(z.target.value),className:"mb-4"}),b.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:g.length===0?e.jsxs(e.Fragment,{children:[e.jsx(Cn,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Wszyscy uczniowie są już w tej grupie"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Cn,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Nie znaleziono uczniów"})]})}):e.jsx("div",{className:"space-y-2",children:b.map(z=>e.jsxs("div",{className:"flex items-center space-x-3 p-3 border rounded-lg hover:bg-muted/50 cursor-pointer",onClick:()=>v(z.id),children:[e.jsx(Ke,{checked:n.includes(z.id),onCheckedChange:()=>v(z.id),onClick:N=>N.stopPropagation()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:z.full_name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(eo,{className:"w-3 h-3"}),z.email]})]}),e.jsx(B,{variant:"secondary",className:"text-xs",children:"Uczeń"})]},z.id))}),n.length>0&&e.jsxs("div",{className:"mt-6 p-4 bg-muted rounded-lg",children:[e.jsxs("p",{className:"text-sm text-muted-foreground mb-3",children:["Wybrano ",n.length," uczniów do dodania"]}),e.jsxs(ie,{children:[e.jsx(M,{variant:"outline",onClick:()=>s(`/teacher/groups/show/${t}`),children:"Anuluj"}),e.jsx(M,{onClick:j,disabled:p,children:p?"Dodawanie...":"Dodaj uczniów"})]})]})]})]})]})},Yu={name:"groups",list:"/teacher/groups",create:"/teacher/groups/create",edit:"/teacher/groups/edit/:id",show:"/teacher/groups/show/:id",meta:{label:"Grupy",icon:e.jsx(ce,{className:"h-4 w-4"})}},mC=[e.jsx(H,{path:"groups",element:e.jsx(oC,{})},"groups-list"),e.jsx(H,{path:"groups/create",element:e.jsx(lC,{})},"groups-create"),e.jsx(H,{path:"groups/edit/:id",element:e.jsx(cC,{})},"groups-edit"),e.jsx(H,{path:"groups/show/:id",element:e.jsx(dC,{})},"groups-show"),e.jsx(H,{path:"groups/:id/assign-students",element:e.jsx(uC,{})},"groups-assign-students")],hC=()=>{const{show:t}=xt(),s=le(),{data:n}=Ye(),[i,r]=f.useState(""),[a,o]=f.useState("all"),[l,c]=f.useState([]),[d,u]=f.useState([]),[m,h]=f.useState(!0),[p,j]=f.useState(new Map);f.useEffect(()=>{(async()=>{if(n?.id){h(!0);try{const{data:v,error:C}=await ee.from("course_access").select("course_id").eq("teacher_id",n.id);if(C)throw C;if(!v||v.length===0){c([]),u([]),h(!1);return}const T=[...new Set(v.map(L=>L.course_id))],{data:z,error:N}=await ee.from("course_access").select("group_id, course_id").in("course_id",T).not("group_id","is",null);if(N)throw N;const S=new Map;z?.forEach(L=>{if(L.group_id){const F=S.get(L.group_id)||[];F.push(L.course_id),S.set(L.group_id,F)}}),j(S);const P=[...new Set(z?.map(L=>L.group_id).filter(Boolean)||[])];if(P.length===0){c([]),u([]),h(!1);return}const{data:w,error:k}=await ee.from("groups").select("*").in("id",P).order("name");if(k)throw k;const _=w?.map(L=>({id:L.id,name:L.name,academic_year:L.academic_year,vendor_id:L.vendor_id||0,is_active:L.is_active??!0,created_at:L.created_at||new Date().toISOString()}))||[];c(_);const{data:A,error:D}=await ee.from("users").select(`
            *,
            user_stats(*),
            group_members!inner(
              group_id,
              user_id,
              joined_at,
              groups!inner(*)
            )
          `).in("group_members.group_id",P).eq("role","student").order("full_name");if(D)throw D;const R=A?.map(L=>({id:L.id,email:L.email,full_name:L.full_name,vendor_id:L.vendor_id,role:L.role,is_active:L.is_active,created_at:L.created_at,groups:L.group_members?.map(F=>({group_id:F.group_id,user_id:F.user_id,joined_at:F.joined_at,groups:F.groups}))||[],user_stats:L.user_stats?Array.isArray(L.user_stats)?L.user_stats:[L.user_stats]:[]}))||[];u(R)}catch(v){console.error("Error fetching students:",v),c([]),u([])}finally{h(!1)}}})()},[n]);const y=f.useMemo(()=>d.filter(b=>{const v=!i||b.full_name.toLowerCase().includes(i.toLowerCase())||b.email.toLowerCase().includes(i.toLowerCase()),C=a==="all"||b.groups?.some(T=>T.groups?.id.toString()===a);return v&&C}),[d,i,a]),x=b=>{if(!b)return{color:"text-gray-500",text:"Brak aktywności"};const v=Math.floor((new Date().getTime()-new Date(b).getTime())/(1e3*60*60*24));return v===0?{color:"text-green-600",text:"Dzisiaj"}:v===1?{color:"text-green-600",text:"Wczoraj"}:v<=7?{color:"text-yellow-600",text:`${v} dni temu`}:v<=30?{color:"text-orange-600",text:`${Math.floor(v/7)} tyg. temu`}:{color:"text-red-600",text:"Ponad miesiąc temu"}},g=b=>{const v=b.groups?.[0]?.group_id;return v&&p.get(v)?.[0]||null};return m?e.jsx(Z,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):e.jsxs(Z,{children:[e.jsx(ie,{children:e.jsx(me,{title:"Uczniowie z moich kursów",description:`Uczniowie z grup które mają dostęp do Twoich kursów (${l.length} ${l.length===1?"grupa":l.length<5?"grupy":"grup"})`})}),e.jsxs(ie,{className:"gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(Ti,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(J,{placeholder:"Szukaj ucznia...",className:"pl-10",value:i,onChange:b=>r(b.target.value)})]}),l.length>0&&e.jsxs(we,{value:a,onValueChange:o,children:[e.jsx(ge,{className:"w-[200px]",children:e.jsx(be,{placeholder:"Filtruj po grupie"})}),e.jsxs(je,{children:[e.jsx(Y,{value:"all",children:"Wszystkie grupy"}),l.map(b=>e.jsxs(Y,{value:b.id.toString(),children:[b.name," (",b.academic_year,")"]},b.id))]})]})]}),l.length===0?e.jsx(I,{children:e.jsxs(E,{className:"p-12 text-center",children:[e.jsx(Re,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Nie masz przypisanych kursów"}),e.jsx("p",{className:"text-muted-foreground",children:'Poproś administratora o przypisanie Cię do kursów. Administrator może to zrobić w module "Zarządzanie dostępem" → "Dostęp do kursów"'})]})}):y.length===0&&d.length===0?e.jsx(I,{children:e.jsxs(E,{className:"p-12 text-center",children:[e.jsx(ce,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Brak uczniów w grupach z Twoimi kursami"}),e.jsx("p",{className:"text-muted-foreground",children:"Uczniowie pojawią się tutaj, gdy administrator przypisze grupy do Twoich kursów"})]})}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:[y.map(b=>{const v=b.user_stats?.[0],C=x(v?.last_active),T=b.groups?.[0]?.group_id,z=g(b);return e.jsx(I,{className:"hover:shadow-md transition-shadow",children:e.jsxs(E,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(ip,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm",children:b.full_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:b.email})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(M,{variant:"ghost",size:"sm",onClick:()=>t("users",b.id),title:"Zobacz profil",children:e.jsx(tt,{className:"h-4 w-4"})}),T&&z&&e.jsx(M,{variant:"ghost",size:"sm",onClick:()=>s(`/teacher/groups/${T}/courses/${z}/students/${b.id}`),title:"Zobacz szczegóły w kursie",children:e.jsx(xe,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(ce,{className:"w-3 h-3"}),"Grupa"]}),e.jsxs("div",{className:"flex gap-1 flex-wrap justify-end",children:[b.groups?.slice(0,2).map(N=>e.jsx(B,{variant:"outline",className:"text-xs",children:N.groups?.name},N.groups?.id)),b.groups?.length>2&&e.jsxs(B,{variant:"outline",className:"text-xs",children:["+",b.groups.length-2]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(Ve,{className:"w-3 h-3"}),"Punkty"]}),e.jsxs("span",{className:"font-medium",children:[v?.total_points||0,e.jsxs("span",{className:"text-xs text-muted-foreground ml-1",children:["(poz. ",v?.current_level||1,")"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(Es,{className:"w-3 h-3"}),"Quizy"]}),e.jsx("span",{className:"font-medium",children:v?.quizzes_completed||0})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(De,{className:"w-3 h-3"}),"Aktywność"]}),e.jsx("span",{className:`font-medium ${C.color}`,children:C.text})]}),v&&v.daily_streak>0&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(st,{className:"w-3 h-3"}),"Seria dni"]}),e.jsxs("span",{className:"font-medium text-orange-600",children:["🔥 ",v.daily_streak]})]})]}),C.color==="text-red-600"&&e.jsx("div",{className:"mt-3 pt-3 border-t",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs text-orange-600",children:[e.jsx(Re,{className:"w-3 h-3"}),e.jsx("span",{children:"Uczeń może potrzebować wsparcia"})]})})]})},b.id)}),y.length===0&&d.length>0&&e.jsx(I,{className:"col-span-full",children:e.jsxs(E,{className:"p-12 text-center",children:[e.jsx(ce,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Nie znaleziono uczniów spełniających kryteria"})]})})]})]})},pC=()=>{const{list:t}=xt(),{id:s}=ft(),{data:n}=Ye(),[i,r]=f.useState([]),[a,o]=f.useState([]),[l,c]=f.useState(!0),[d,u]=f.useState(null);if(f.useEffect(()=>{(async()=>{if(s){c(!0);try{const{data:b,error:v}=await ee.from("users").select(`
            *,
            user_stats(*),
            group_members(
              group_id,
              user_id,
              joined_at,
              groups(*)
            )
          `).eq("id",s).single();if(v)throw v;if(b){const C={id:b.id,email:b.email,full_name:b.full_name,vendor_id:b.vendor_id,role:b.role,is_active:b.is_active,created_at:b.created_at,groups:b.group_members?.map(T=>({group_id:T.group_id,user_id:T.user_id,joined_at:T.joined_at,groups:T.groups}))||[],user_stats:b.user_stats?Array.isArray(b.user_stats)?b.user_stats:[b.user_stats]:[]};u(C)}}catch(b){console.error("Error fetching student data:",b)}finally{c(!1)}}})()},[s]),f.useEffect(()=>{(async()=>{if(!(!s||!n?.id))try{const{data:b}=await ee.from("course_access").select("course_id").eq("teacher_id",n.id);if(!b||b.length===0)return;const v=b.map(z=>z.course_id),{data:C}=await ee.from("courses").select(`
            id,
            title,
            topics!inner(
              id,
              title,
              activities!inner(
                id,
                type,
                activity_progress!left(
                  completed_at,
                  score,
                  attempts,
                  time_spent
                )
              )
            )
          `).in("id",v).eq("topics.activities.activity_progress.user_id",s);if(C){const z=C.map(N=>{let S=0,P=0,w=0,k=0,_=0,A=0,D=null;return N.topics?.forEach(R=>{R.activities?.forEach(L=>{S++;const F=L.activity_progress?.[0];F?.completed_at&&(P++,(!D||new Date(F.completed_at)>new Date(D))&&(D=F.completed_at)),L.type==="quiz"&&F?.score!==null&&(w+=F.score,k++,F.score>=70?_++:F.attempts>0&&A++)})}),{course_id:N.id,course_title:N.title,total_activities:S,completed_activities:P,avg_score:k>0?Math.round(w/k):0,quizzes_passed:_,quizzes_failed:A,last_activity:D||""}});r(z)}const{data:T}=await ee.from("activity_progress").select(`
            *,
            activities(
              id,
              title,
              type,
              topics(
                title,
                courses(title)
              )
            )
          `).eq("user_id",s).order("completed_at",{ascending:!1,nullsFirst:!1}).limit(10);T&&o(T)}catch(b){console.error("Error fetching student progress:",b)}})()},[s,n]),l)return e.jsx(Z,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const m=d,h=m?.user_stats?.[0],p=g=>g>=80?"text-green-600":g>=60?"text-yellow-600":"text-red-600",j=g=>g==="quiz"?"📝":"📚",y=g=>{const b=Math.floor(g/60),v=g%60;return b>0?`${b}h ${v}min`:`${v}min`},x=g=>{if(!g)return"text-gray-500";const b=Math.floor((new Date().getTime()-new Date(g).getTime())/(1e3*60*60*24));return b===0?"text-green-600":b<=7?"text-yellow-600":b<=30?"text-orange-600":"text-red-600"};return e.jsxs(Z,{children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>t("users"),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsx(ie,{children:e.jsxs("div",{children:[e.jsx(me,{title:m?.full_name||"",description:m?.email||""}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[m?.groups?.map(g=>e.jsxs(B,{variant:"outline",children:[e.jsx(ce,{className:"w-3 h-3 mr-1"}),g.groups?.name," (",g.groups?.academic_year,")"]},g.groups?.id)),!m?.is_active&&e.jsx(B,{variant:"destructive",children:"Nieaktywny"})]})]})}),e.jsxs(nt,{children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(en,{className:"w-5 h-5"}),"Podsumowanie postępów"]})}),e.jsxs(E,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg",children:[e.jsx(Ve,{className:"w-8 h-8 mx-auto mb-2 text-blue-600"}),e.jsx("p",{className:"text-2xl font-bold",children:h?.total_points||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Punkty"})]}),e.jsxs("div",{className:"text-center p-4 bg-purple-50 dark:bg-purple-950/20 rounded-lg",children:[e.jsx(We,{className:"w-8 h-8 mx-auto mb-2 text-purple-600"}),e.jsx("p",{className:"text-2xl font-bold",children:h?.current_level||1}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Poziom"})]}),e.jsxs("div",{className:"text-center p-4 bg-green-50 dark:bg-green-950/20 rounded-lg",children:[e.jsx(Bt,{className:"w-8 h-8 mx-auto mb-2 text-green-600"}),e.jsx("p",{className:"text-2xl font-bold",children:h?.quizzes_completed||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ukończone quizy"})]}),e.jsxs("div",{className:"text-center p-4 bg-orange-50 dark:bg-orange-950/20 rounded-lg",children:[e.jsx(st,{className:"w-8 h-8 mx-auto mb-2 text-orange-600"}),e.jsx("p",{className:"text-2xl font-bold",children:h?.daily_streak||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Dni z rzędu"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 pt-4 border-t",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Perfekcyjne wyniki"}),e.jsxs("p",{className:"text-lg font-semibold text-green-600",children:[h?.perfect_scores||0,h&&h.quizzes_completed>0&&e.jsxs("span",{className:"text-sm text-muted-foreground ml-1",children:["(",Math.round(h.perfect_scores/h.quizzes_completed*100),"%)"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Czas nauki"}),e.jsx("p",{className:"text-lg font-semibold",children:h?y(h.total_time_spent):"0min"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Punkty/h (idle)"}),e.jsx("p",{className:"text-lg font-semibold",children:h?.idle_points_rate||1})]})]})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5"}),"Postępy w Twoich kursach"]})}),e.jsxs(E,{className:"space-y-4",children:[i.map(g=>{const b=g.total_activities>0?Math.round(g.completed_activities/g.total_activities*100):0;return e.jsxs("div",{className:"p-4 border rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold",children:g.course_title}),e.jsxs(B,{variant:b===100?"default":"outline",children:[b,"% ukończone"]})]}),e.jsx(rs,{value:b,className:"h-2"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Ukończone"}),e.jsxs("p",{className:"font-medium",children:[g.completed_activities,"/",g.total_activities," aktywności"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Średni wynik"}),e.jsx("p",{className:`font-medium ${g.avg_score>0?p(g.avg_score):""}`,children:g.avg_score>0?`${g.avg_score}%`:"Brak"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Quizy"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-green-600 flex items-center",children:[e.jsx(Pt,{className:"w-3 h-3 mr-1"}),g.quizzes_passed]}),e.jsxs("span",{className:"text-red-600 flex items-center",children:[e.jsx(Ta,{className:"w-3 h-3 mr-1"}),g.quizzes_failed]})]})]})]}),g.last_activity&&e.jsx("div",{className:"pt-2 border-t",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Ostatnia aktywność: ",new Date(g.last_activity).toLocaleDateString("pl-PL")]})})]},g.course_id)}),i.length===0&&e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Uczeń nie rozpoczął jeszcze żadnego z Twoich kursów"})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(ro,{className:"w-5 h-5"}),"Ostatnie aktywności"]})}),e.jsx(E,{children:e.jsxs("div",{className:"space-y-3",children:[a.map(g=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:g.activities&&j(g.activities.type)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:g.activities?.title}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[g.activities?.topics?.courses?.title," • ",g.activities?.topics?.title]})]})]}),e.jsxs("div",{className:"text-right",children:[g.score!==null&&e.jsxs("p",{className:`font-medium ${p(g.score)}`,children:[g.score,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:g.completed_at?new Date(g.completed_at).toLocaleDateString("pl-PL"):new Date(g.started_at).toLocaleDateString("pl-PL")}),g.attempts>1&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Próba ",g.attempts]})]})]},`${g.user_id}-${g.activity_id}`)),a.length===0&&e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Brak aktywności do wyświetlenia"})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"text-lg flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4"}),"Czas nauki"]})}),e.jsxs(E,{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Łączny czas"}),e.jsx("p",{className:"text-xl font-bold",children:h?y(h.total_time_spent):"0min"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ostatnia aktywność"}),e.jsx("p",{className:`text-sm font-medium ${x(h?.last_active)}`,children:h?.last_active?new Date(h.last_active).toLocaleDateString("pl-PL",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"Brak aktywności"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ostatnie pobieranie idle"}),e.jsx("p",{className:"text-sm font-medium",children:h?.last_idle_claim?new Date(h.last_idle_claim).toLocaleString("pl-PL",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Nigdy"})]})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"text-lg flex items-center gap-2",children:[e.jsx(Bt,{className:"w-4 h-4"}),"Statystyki quizów"]})}),e.jsxs(E,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Ukończone"}),e.jsx("span",{className:"font-bold",children:h?.quizzes_completed||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Wyniki 100%"}),e.jsx("span",{className:"font-bold text-green-600",children:h?.perfect_scores||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Współczynnik"}),e.jsx("span",{className:"font-bold",children:h&&h.quizzes_completed>0?`${Math.round(h.perfect_scores/h.quizzes_completed*100)}%`:"0%"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Średni czas/quiz"}),e.jsx("span",{className:"font-bold",children:h&&h.quizzes_completed>0?y(Math.round(h.total_time_spent/h.quizzes_completed)):"0min"})]})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"text-lg flex items-center gap-2",children:[e.jsx(At,{className:"w-4 h-4"}),"Informacje"]})}),e.jsxs(E,{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Dołączył"}),e.jsx("p",{className:"text-sm font-medium",children:m?.created_at&&new Date(m.created_at).toLocaleDateString("pl-PL",{year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Dni od rejestracji"}),e.jsxs("p",{className:"text-sm font-medium",children:[m?.created_at&&Math.floor((new Date().getTime()-new Date(m.created_at).getTime())/(1e3*60*60*24))," dni"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status konta"}),e.jsx("p",{className:"text-sm font-medium",children:m?.is_active?e.jsx("span",{className:"text-green-600",children:"✓ Aktywny"}):e.jsx("span",{className:"text-red-600",children:"✗ Nieaktywny"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Grupy"}),e.jsx("div",{className:"text-sm font-medium",children:m?.groups?.map(g=>e.jsxs("div",{children:[g.groups?.name," (",g.groups?.academic_year,")"]},g.groups?.id))})]})]})]})]})]})]})},fC=[e.jsx(H,{path:"users",element:e.jsx(hC,{})},"users-list"),e.jsx(H,{path:"users/show/:id",element:e.jsx(pC,{})},"users-show")],xC=t=>{const s=new Date(t);return new Date(Date.UTC(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate())).toISOString().slice(0,10)},gC=()=>{const t=le(),s={queryOptions:{staleTime:1/0,gcTime:1800*1e3,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,refetchInterval:!1,retry:0}},{data:n}=Q({resource:"user_stats",filters:[{field:"last_active",operator:"gte",value:new Date(Date.now()-10080*60*1e3).toISOString().split("T")[0]}],pagination:{mode:"off"},...s}),{data:i}=Q({resource:"activity_progress",pagination:{mode:"off"},meta:{select:"*, activities(type, passing_score)",query:u=>u.not("completed_at","is",null)},...s}),{data:r}=Q({resource:"user_stats",pagination:{mode:"off"},sorters:[{field:"total_points",order:"desc"}],...s}),a=f.useMemo(()=>{const u=n?.data?.length||0,m=i?.data?.filter(g=>g.activities?.type==="quiz"&&g.score!==null).map(g=>Number(g.score))||[],h=m.length>0?Math.round(m.reduce((g,b)=>g+b,0)/m.length):0,p=i?.data?.length||0,j=i?.data?.filter(g=>g.completed_at).length||0,y=p>0?Math.round(j/p*100):0,x=r?.data?.reduce((g,b)=>g+Number(b.total_points),0)||0;return{activeUsers:u,activeUsersChange:12,avgQuizScore:h,avgQuizScoreChange:3,completionRate:y,completionRateChange:5,totalPoints:x,totalPointsChange:8}},[n?.data,i?.data,r?.data]),o=f.useMemo(()=>{const u=Array.from({length:7},(h,p)=>{const j=new Date;return j.setUTCDate(j.getUTCDate()-(6-p)),j.toISOString().slice(0,10)}),m=new Map;for(const h of u)m.set(h,{quizzes:0,materials:0});for(const h of i?.data||[]){if(!h?.started_at)continue;const p=xC(h.started_at);if(!m.has(p))continue;const j=m.get(p);h.activities?.type==="quiz"?j.quizzes+=1:h.activities?.type==="material"&&(j.materials+=1)}return u.map(h=>({date:new Date(h+"T00:00:00Z").toLocaleDateString("pl-PL",{weekday:"short",day:"numeric"}),quizzes:m.get(h).quizzes,materials:m.get(h).materials}))},[i?.data]),l=[{title:"Aktywni użytkownicy",value:a.activeUsers,change:a.activeUsersChange,icon:ce,color:"text-blue-600",bgColor:"bg-blue-50",link:"/teacher/reports/engagement"},{title:"Średni wynik quizów",value:`${a.avgQuizScore}%`,change:a.avgQuizScoreChange,icon:We,color:"text-green-600",bgColor:"bg-green-50",link:"/teacher/reports/performance"},{title:"Wskaźnik ukończeń",value:`${a.completionRate}%`,change:a.completionRateChange,icon:st,color:"text-purple-600",bgColor:"bg-purple-50",link:"/teacher/reports/progress"},{title:"Suma punktów",value:a.totalPoints.toLocaleString("pl-PL"),change:a.totalPointsChange,icon:Ve,color:"text-orange-600",bgColor:"bg-orange-50",link:"/teacher/reports/gamification"}],c=[{to:"/teacher/reports/engagement",title:"Raport zaangażowania",description:"Aktywność użytkowników, czas nauki, trendy",icon:e.jsx(ro,{className:"h-5 w-5"}),color:"text-blue-600"},{to:"/teacher/reports/progress",title:"Raport postępów",description:"Postęp kursów, wskaźniki ukończeń",icon:e.jsx(st,{className:"h-5 w-5"}),color:"text-purple-600"},{to:"/teacher/reports/performance",title:"Raport wyników",description:"Wyniki quizów, najtrudniejsze pytania",icon:e.jsx(We,{className:"h-5 w-5"}),color:"text-green-600"},{to:"/teacher/reports/gamification",title:"Raport gamifikacji",description:"Ranking punktowy, poziomy, osiągnięcia",icon:e.jsx(Ve,{className:"h-5 w-5"}),color:"text-orange-600"}],d=r?.data?.slice(0,5)||[];return e.jsxs(Z,{children:[e.jsx(ie,{children:e.jsx(me,{title:"Centrum Raportów",description:"Kompleksowy przegląd wyników i postępów uczniów"})}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-6",children:l.map((u,m)=>e.jsxs(I,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>t(u.link),children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:u.title}),e.jsx("div",{className:`${u.bgColor} p-2 rounded-lg`,children:e.jsx(u.icon,{className:`h-4 w-4 ${u.color}`})})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:u.value}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e.jsxs("span",{className:u.change>0?"text-green-600":"text-red-600",children:[u.change>0?"+":"",u.change,"%"]})," ","vs. ostatnie 7 dni"]})]})]},m))}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3 mb-6",children:[e.jsxs(I,{className:"lg:col-span-2",children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Aktywność w ostatnich 7 dniach"}),e.jsx(M,{variant:"ghost",size:"sm",onClick:()=>t("/teacher/reports/engagement"),children:"Zobacz więcej →"})]})}),e.jsx(E,{children:e.jsx("div",{style:{width:"100%",height:250},children:e.jsx(Ue,{width:"100%",height:"100%",children:e.jsxs(ao,{data:o,children:[e.jsx(qt,{strokeDasharray:"3 3"}),e.jsx(Tt,{dataKey:"date"}),e.jsx(vt,{allowDecimals:!1}),e.jsx(He,{}),e.jsx(nn,{type:"monotone",dataKey:"materials",stackId:"1",stroke:"#82ca9d",fill:"#82ca9d",name:"Materiały",isAnimationActive:!1,dot:!0}),e.jsx(nn,{type:"monotone",dataKey:"quizzes",stackId:"1",stroke:"#8884d8",fill:"#8884d8",name:"Quizy",isAnimationActive:!1,dot:!0})]},`${o.map(u=>u.quizzes+u.materials).join("-")}`)})})})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Top 5 uczniów"}),e.jsx(Ve,{className:"h-4 w-4 text-orange-600"})]})}),e.jsx(E,{children:e.jsx("div",{className:"space-y-3",children:d.map((u,m)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold
                      ${m===0?"bg-yellow-100 text-yellow-700":m===1?"bg-gray-100 text-gray-700":m===2?"bg-orange-100 text-orange-700":"bg-muted text-muted-foreground"}`,children:m+1}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium",children:["Uczeń #",m+1]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Poziom ",u.current_level]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-bold",children:u.total_points}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"punktów"})]})]},u.user_id))})})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Szczegółowe raporty"}),e.jsx(nt,{variant:"2-2-4",children:c.map(u=>e.jsxs(I,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>t(u.to),children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2 text-base",children:[e.jsx("span",{className:u.color,children:u.icon}),u.title]})}),e.jsx(E,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:u.description})})]},u.to))})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Ostatnie aktywności"})}),e.jsx(E,{children:e.jsx("div",{className:"space-y-2",children:i?.data?.slice(0,10).map(u=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b last:border-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{variant:u.activities?.type==="quiz"?"default":"secondary",children:u.activities?.type==="quiz"?"Quiz":"Materiał"}),e.jsxs("span",{className:"text-sm",children:["Aktywność #",u.activity_id]})]}),e.jsxs("div",{className:"text-right",children:[u.score!==null&&e.jsxs("span",{className:"text-sm font-medium",children:[u.score,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(u.started_at).toLocaleDateString("pl-PL")})]})]},`${u.user_id}-${u.activity_id}`))})})]})]})},jC=()=>{const[t,s]=f.useState("7d"),[n,i]=f.useState("all"),r=nw()(),[a,o]=f.useState(!0),[l,c]=f.useState([]),[d,u]=f.useState([]),[m,h]=f.useState([]),[p,j]=f.useState([]),y=()=>{const w=new Date,k=new Date;switch(t){case"7d":k.setDate(k.getDate()-7);break;case"30d":k.setDate(k.getDate()-30);break;case"90d":k.setDate(k.getDate()-90);break}return{start:k,end:w}},{start:x,end:g}=y();f.useEffect(()=>{(async()=>{try{o(!0);const[k,_,A,D]=await Promise.all([r.getList({resource:"activity_progress",filters:[{field:"started_at",operator:"gte",value:x.toISOString()}],pagination:{mode:"off"}}),r.getList({resource:"activities",pagination:{mode:"off"},meta:{select:"id, type, topic_id"}}),r.getList({resource:"topics",pagination:{mode:"off"},meta:{select:"id, course_id"}}),r.getList({resource:"courses",filters:[{field:"is_published",operator:"eq",value:!0}],pagination:{mode:"off"}})]);c(k.data),u(_.data),h(A.data),j(D.data)}catch(k){console.error("Error fetching data:",k)}finally{o(!1)}})()},[]);const b=f.useMemo(()=>{if(!l.length||!d.length||!m.length)return[];const w=new Map(d.map(D=>[D.id,{type:D.type,topicId:D.topic_id}])),k=new Map(m.map(D=>[D.id,D.course_id])),_=l.map(D=>{const R=w.get(D.activity_id),L=R?.topicId?k.get(R.topicId):void 0;return{...D,activityType:R?.type,courseId:L}});if(n==="all")return _;const A=parseInt(n);return _.filter(D=>D.courseId===A)},[l,d,m,n]),v=f.useMemo(()=>{const w=new Set(b.map(R=>R.user_id)).size,k=b.reduce((R,L)=>R+(L.time_spent||0),0),_=w>0?(k/60/w).toFixed(1):"0",A=b.filter(R=>R.completed_at).length,D=b.length>0?Math.round(A/b.length*100):0;return{activeUsers:w,activeUsersChange:12,avgTimeHours:_,avgTimeChange:5,completedActivities:A,completedChange:18,engagementRate:D,engagementChange:3}},[b]),C=f.useMemo(()=>{const w=Math.ceil((g.getTime()-x.getTime())/864e5),k=[];for(let _=0;_<w;_++){const A=new Date(x);A.setDate(A.getDate()+_);const D=A.toISOString().split("T")[0],R=b.filter(F=>F.started_at.startsWith(D)),L=new Set(R.map(F=>F.user_id)).size;k.push({date:A.toLocaleDateString("pl-PL",{day:"numeric",month:"short"}),users:L})}return k},[b,x,g]),T=f.useMemo(()=>{const w=b.filter(A=>A.activityType==="quiz").length,k=b.filter(A=>A.activityType==="material").length;return w+k===0?[{name:"Brak danych",value:1,color:"#e5e7eb"}]:[{name:"Quizy",value:w,color:"#8884d8"},{name:"Materiały",value:k,color:"#82ca9d"}].filter(A=>A.value>0)},[b]),z=f.useMemo(()=>{const w=new Map;b.forEach(_=>{const A=w.get(_.user_id)||0;w.set(_.user_id,A+(_.time_spent||0))});const k=[{range:"0-30min",count:0,color:"#94a3b8"},{range:"30-60min",count:0,color:"#60a5fa"},{range:"1-2h",count:0,color:"#818cf8"},{range:"2-5h",count:0,color:"#a78bfa"},{range:"5h+",count:0,color:"#c084fc"}];return w.forEach(_=>{_<=30?k[0].count++:_<=60?k[1].count++:_<=120?k[2].count++:_<=300?k[3].count++:k[4].count++}),k.filter(_=>_.count>0)},[b]),N=f.useMemo(()=>{const w=Math.ceil((g.getTime()-x.getTime())/864e5),k=[];for(let _=0;_<w;_++){const A=new Date(x);A.setDate(A.getDate()+_);const D=A.toISOString().split("T")[0],R=b.filter(q=>q.started_at.startsWith(D)),L=R.filter(q=>q.completed_at).length,F=R.length,K=F>0?Math.round(L/F*100):0;k.push({date:A.toLocaleDateString("pl-PL",{day:"numeric",month:"short"}),rate:K,completed:L,total:F})}return k},[b,x,g]),S=[{label:"Aktywni użytkownicy",value:v.activeUsers.toString(),icon:ce,change:`+${v.activeUsersChange}%`,color:"text-blue-600",bgColor:"bg-blue-50"},{label:"Średni czas nauki",value:`${v.avgTimeHours}h`,icon:De,change:`+${v.avgTimeChange}%`,color:"text-purple-600",bgColor:"bg-purple-50"},{label:"Ukończone aktywności",value:v.completedActivities.toString(),icon:ro,change:`+${v.completedChange}%`,color:"text-green-600",bgColor:"bg-green-50"},{label:"Wskaźnik zaangażowania",value:`${v.engagementRate}%`,icon:st,change:`+${v.engagementChange}%`,color:"text-orange-600",bgColor:"bg-orange-50"}],P=f.useMemo(()=>{if(!p.length||!b.length)return[];const w=new Map;return p.forEach(k=>{const _=typeof k.id=="number"?k.id:parseInt(k.id);isNaN(_)||w.set(_,{title:k.title||"",users:new Set,activities:0,completed:0})}),b.forEach(k=>{const _=k.courseId;if(_&&w.has(_)){const A=w.get(_);A&&(A.users.add(k.user_id),A.activities++,k.completed_at&&A.completed++)}}),Array.from(w.entries()).filter(([k,_])=>_.activities>0).map(([k,_])=>({id:k,title:_.title,users:_.users.size,activities:_.activities,completionRate:_.activities>0?Math.round(_.completed/_.activities*100):0})).sort((k,_)=>_.users-k.users).slice(0,5)},[b,p]);return a?e.jsx(Z,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-muted-foreground",children:"Ładowanie danych..."})})}):e.jsxs(Z,{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Te,{to:"/teacher/reports/overview",children:e.jsxs(M,{variant:"ghost",size:"sm",children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Powrót do centrum raportów"]})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Raport zaangażowania"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(we,{value:n,onValueChange:i,children:[e.jsx(ge,{className:"w-[200px]",children:e.jsx(be,{placeholder:"Wybierz kurs"})}),e.jsxs(je,{children:[e.jsx(Y,{value:"all",children:"Wszystkie kursy"}),p.map(w=>{const k=typeof w.id=="number"?w.id:parseInt(w.id);return e.jsx(Y,{value:k.toString(),children:w.title},k)})]})]}),e.jsxs(we,{value:t,onValueChange:s,children:[e.jsx(ge,{className:"w-[150px]",children:e.jsx(be,{})}),e.jsxs(je,{children:[e.jsx(Y,{value:"7d",children:"Ostatnie 7 dni"}),e.jsx(Y,{value:"30d",children:"Ostatnie 30 dni"}),e.jsx(Y,{value:"90d",children:"Ostatnie 90 dni"})]})]})]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-6",children:S.map((w,k)=>e.jsxs(I,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:w.label}),e.jsx("div",{className:`${w.bgColor} p-2 rounded-lg`,children:e.jsx(w.icon,{className:`h-4 w-4 ${w.color}`})})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:w.value}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"text-green-600",children:w.change})," vs. poprzedni okres"]})]})]},k))}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3 mb-6",children:[e.jsxs(I,{className:"lg:col-span-2",children:[e.jsx(O,{children:e.jsx($,{children:"Aktywni użytkownicy w czasie"})}),e.jsx(E,{children:e.jsx(Ue,{width:"100%",height:300,children:e.jsxs(ao,{data:C,children:[e.jsx(qt,{strokeDasharray:"3 3"}),e.jsx(Tt,{dataKey:"date"}),e.jsx(vt,{}),e.jsx(He,{}),e.jsx(nn,{type:"monotone",dataKey:"users",stroke:"#8884d8",fill:"#8884d8",fillOpacity:.6,name:"Aktywni użytkownicy",isAnimationActive:!1})]},`${C.map(w=>w.users).join("-")}`)})})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Typy aktywności"})}),e.jsx(E,{children:e.jsx(Ue,{width:"100%",height:300,children:e.jsxs(Aa,{children:[e.jsx(Pa,{data:T,cx:"50%",cy:"50%",labelLine:!1,label:({name:w,percent:k})=>k!==void 0&&k>0?`${w}: ${(k*100).toFixed(0)}%`:"",outerRadius:80,fill:"#8884d8",dataKey:"value",isAnimationActive:!1,children:T.map((w,k)=>e.jsx(js,{fill:w.color},`cell-${k}`))}),e.jsx(He,{})]})})})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2 mb-6",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Rozkład czasu nauki użytkowników"})}),e.jsx(E,{children:e.jsx(Ue,{width:"100%",height:250,children:e.jsxs(qr,{data:z,children:[e.jsx(qt,{strokeDasharray:"3 3"}),e.jsx(Tt,{dataKey:"range"}),e.jsx(vt,{}),e.jsx(He,{}),e.jsx(yi,{dataKey:"count",name:"Liczba użytkowników",isAnimationActive:!1,children:z.map((w,k)=>e.jsx(js,{fill:w.color},`cell-${k}`))})]},`${z.map(w=>w.count).join("-")}`)})})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Wskaźnik ukończeń w czasie"})}),e.jsx(E,{children:e.jsx(Ue,{width:"100%",height:250,children:e.jsxs(lp,{data:N,children:[e.jsx(qt,{strokeDasharray:"3 3"}),e.jsx(Tt,{dataKey:"date"}),e.jsx(vt,{}),e.jsx(He,{content:({active:w,payload:k})=>{if(w&&k&&k.length){const _=k[0].payload;return e.jsxs("div",{className:"bg-white p-2 border rounded shadow-sm",children:[e.jsx("p",{className:"font-medium text-sm",children:_.date}),e.jsxs("p",{className:"text-xs",children:["Wskaźnik: ",_.rate,"%"]}),e.jsxs("p",{className:"text-xs",children:["Ukończone: ",_.completed,"/",_.total]})]})}return null}}),e.jsx(jc,{type:"monotone",dataKey:"rate",stroke:"#22c55e",strokeWidth:2,dot:{fill:"#22c55e"},name:"Wskaźnik ukończeń %",isAnimationActive:!1})]},`${N.map(w=>w.rate).join("-")}`)})})]})]}),P.length>0&&e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Zaangażowanie według kursów"})}),e.jsx(E,{children:e.jsx("div",{className:"space-y-3",children:P.map(w=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:w.title}),e.jsxs("div",{className:"flex gap-4 mt-1 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Użytkownicy: ",w.users]}),e.jsxs("span",{children:["Aktywności: ",w.activities]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs(B,{variant:w.completionRate>=70?"default":"secondary",children:[w.completionRate,"% ukończonych"]})})]},w.id))})})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Kluczowe wnioski"})}),e.jsx(E,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(At,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Trendy"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:v.activeUsers>0?`${v.activeUsers} unikalnych użytkowników aktywnych w wybranym okresie`:"Brak aktywności w wybranym okresie"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Wskaźnik ukończeń"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[v.engagementRate,"% rozpoczętych aktywności zostało ukończonych"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(tt,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Średnie zaangażowanie"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Średnio ",v.avgTimeHours," godzin nauki na użytkownika"]})]})]})})]})]})},yC=()=>{const[t,s]=f.useState("all"),[n,i]=f.useState(null),[r,a]=f.useState("progress"),o={queryOptions:{staleTime:1/0,gcTime:1800*1e3,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,refetchInterval:!1,retry:0}},{data:l}=Q({resource:"courses",filters:[{field:"is_published",operator:"eq",value:!0}],pagination:{mode:"off"},...o}),{data:c}=Q({resource:"activities",filters:[{field:"is_published",operator:"eq",value:!0}],pagination:{mode:"off"},meta:{select:"id, topic_id, type, topics(id, course_id)"},...o}),{data:d}=Q({resource:"activity_progress",pagination:{mode:"off"},meta:{select:"*, activities(id, topic_id, type, topics(id, course_id))"},...o}),{data:u}=Q({resource:"groups",pagination:{mode:"off"},...o}),{data:m}=Q({resource:"group_members",pagination:{mode:"off"},filters:t!=="all"?[{field:"group_id",operator:"eq",value:parseInt(t)}]:[],...o}),h=f.useMemo(()=>{if(!l?.data||!c?.data||!d?.data)return[];const x=new Map;return l.data.forEach(g=>{const b=typeof g.id=="number"?g.id:parseInt(g.id),C=c.data.filter(D=>D.topics?.course_id===b).length,T=d.data.filter(D=>D.activities?.topics?.course_id===b),z=t!=="all"&&m?.data?T.filter(D=>m.data.some(R=>R.user_id===D.user_id)):T,N=new Set(z.map(D=>D.user_id)),S=new Map,P=new Map;z.forEach(D=>{if(D.completed_at){const R=S.get(D.user_id)||0;S.set(D.user_id,R+1)}if(D.score!==null&&D.score!==void 0){const R=P.get(D.user_id)||[];R.push(Number(D.score)),P.set(D.user_id,R)}});const w=S.size,k=w>0?Array.from(S.values()).reduce((D,R)=>D+R,0)/w:0,_=Array.from(P.values()).flat(),A=_.length>0?Math.round(_.reduce((D,R)=>D+R,0)/_.length):null;x.set(b,{courseId:b,courseTitle:g.title||"",totalActivities:C,completedActivities:Math.round(k),avgScore:A,totalStudents:N.size,activeStudents:w})}),Array.from(x.values()).filter(g=>g.totalActivities>0).sort((g,b)=>{const v=g.totalActivities>0?g.completedActivities/g.totalActivities:0;return(b.totalActivities>0?b.completedActivities/b.totalActivities:0)-v})},[l?.data,c?.data,d?.data,t,m?.data]),p=f.useMemo(()=>{if(!d?.data||!h.length)return[];const x=new Map;h.forEach(b=>{const v=d.data.filter(T=>T.activities?.topics?.course_id===b.courseId);(t!=="all"&&m?.data?v.filter(T=>m.data.some(z=>z.user_id===T.user_id)):v).forEach(T=>{x.has(T.user_id)||x.set(T.user_id,new Map);const z=x.get(T.user_id);z.has(b.courseId)||z.set(b.courseId,{userId:T.user_id,courseId:b.courseId,courseTitle:b.courseTitle,completedActivities:0,totalActivities:b.totalActivities,avgScore:null,lastActivity:null,timeSpent:0});const N=z.get(b.courseId);if(T.completed_at&&N.completedActivities++,T.score!==null&&T.score!==void 0){const S=[];N.avgScore!==null&&S.push(N.avgScore),S.push(Number(T.score)),N.avgScore=Math.round(S.reduce((P,w)=>P+w,0)/S.length)}N.timeSpent+=T.time_spent||0,(!N.lastActivity||new Date(T.started_at)>new Date(N.lastActivity))&&(N.lastActivity=T.started_at)})});const g=[];return x.forEach(b=>{b.forEach(v=>{g.push(v)})}),g.sort((b,v)=>{switch(r){case"progress":{const C=b.totalActivities>0?b.completedActivities/b.totalActivities:0;return(v.totalActivities>0?v.completedActivities/v.totalActivities:0)-C}case"score":return(v.avgScore||0)-(b.avgScore||0);case"activity":return new Date(v.lastActivity||0).getTime()-new Date(b.lastActivity||0).getTime();default:return 0}})},[d?.data,h,t,m?.data,r]),j=f.useMemo(()=>{const x=[{name:"Rozpoczęli kurs",value:0,fill:"#8884d8"},{name:"Ukończyli 25%",value:0,fill:"#83a6ed"},{name:"Ukończyli 50%",value:0,fill:"#8dd1e1"},{name:"Ukończyli 75%",value:0,fill:"#82ca9d"},{name:"Ukończyli 100%",value:0,fill:"#67b26f"}],g=new Map;return p.forEach(b=>{const v=b.totalActivities>0?b.completedActivities/b.totalActivities*100:0,C=g.get(b.userId)||0;g.set(b.userId,Math.max(C,v))}),g.forEach(b=>{b>0&&x[0].value++,b>=25&&x[1].value++,b>=50&&x[2].value++,b>=75&&x[3].value++,b>=100&&x[4].value++}),x},[p]),y=f.useMemo(()=>{const x=new Set(p.map(T=>T.userId)).size,g=new Set(p.filter(T=>T.completedActivities>0).map(T=>T.userId)).size,b=h.length>0?Math.round(h.reduce((T,z)=>T+(z.totalActivities>0?z.completedActivities/z.totalActivities*100:0),0)/h.length):0,v=h.filter(T=>T.avgScore!==null),C=v.length>0?Math.round(v.reduce((T,z)=>T+z.avgScore,0)/v.length):0;return{totalStudents:x,activeStudents:g,avgCompletion:b,avgScore:C}},[p,h]);return e.jsxs(Z,{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Te,{to:"/teacher/reports/overview",children:e.jsxs(M,{variant:"ghost",size:"sm",children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Powrót do centrum raportów"]})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Raport postępów"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(we,{value:t,onValueChange:s,children:[e.jsx(ge,{className:"w-[200px]",children:e.jsx(be,{placeholder:"Wybierz grupę"})}),e.jsxs(je,{children:[e.jsx(Y,{value:"all",children:"Wszystkie grupy"}),u?.data?.map(x=>e.jsx(Y,{value:x.id?.toString()||"",children:x.name||"Bez nazwy"},x.id||"unknown"))]})]}),e.jsxs(M,{variant:"outline",size:"sm",children:[e.jsx(rp,{className:"mr-2 h-4 w-4"}),"Eksportuj"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4 mb-6",children:[e.jsxs(I,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Wszyscy uczniowie"}),e.jsx(ce,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:y.totalStudents}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"w wybranych grupach"})]})]}),e.jsxs(I,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Aktywni uczniowie"}),e.jsx(st,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:y.activeStudents}),e.jsx("p",{className:"text-xs text-muted-foreground",children:y.totalStudents>0?`${Math.round(y.activeStudents/y.totalStudents*100)}% wszystkich`:"0% wszystkich"})]})]}),e.jsxs(I,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Średni postęp"}),e.jsx(xe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[y.avgCompletion,"%"]}),e.jsx(rs,{value:y.avgCompletion,className:"mt-2"})]})]}),e.jsxs(I,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Średni wynik"}),e.jsx(We,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[y.avgScore,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"z ukończonych quizów"})]})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2 mb-6",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Postęp według kursów"})}),e.jsx(E,{children:e.jsx(Ue,{width:"100%",height:300,children:e.jsxs(qr,{data:h,layout:"vertical",children:[e.jsx(qt,{strokeDasharray:"3 3"}),e.jsx(Tt,{type:"number",domain:[0,100]}),e.jsx(vt,{dataKey:"courseTitle",type:"category",width:120,tick:{fontSize:12}}),e.jsx(He,{formatter:x=>`${x}%`,content:({active:x,payload:g})=>{if(x&&g&&g.length){const b=g[0].payload;return e.jsxs("div",{className:"bg-white p-2 border rounded shadow-sm",children:[e.jsx("p",{className:"font-medium text-sm",children:b.courseTitle}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Ukończono: ",b.completedActivities,"/",b.totalActivities," aktywności"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Aktywnych: ",b.activeStudents,"/",b.totalStudents," uczniów"]}),b.avgScore!==null&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Średni wynik: ",b.avgScore,"%"]})]})}return null}}),e.jsx(yi,{dataKey:x=>x.totalActivities>0?Math.round(x.completedActivities/x.totalActivities*100):0,fill:"#8884d8",name:"Postęp",isAnimationActive:!1})]},`${h.map(x=>x.courseId).join("-")}`)})})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Lejek ukończeń"})}),e.jsx(E,{children:e.jsx(Ue,{width:"100%",height:300,children:e.jsxs(qw,{children:[e.jsx(He,{}),e.jsxs(Fw,{dataKey:"value",data:j,isAnimationActive:!1,children:[e.jsx(Bw,{position:"center",fill:"#fff"}),j.map((x,g)=>e.jsx(js,{fill:x.fill},`cell-${g}`))]})]})})})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Szczegółowe postępy uczniów"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(we,{value:r,onValueChange:x=>a(x),children:[e.jsx(ge,{className:"w-[150px]",children:e.jsx(be,{})}),e.jsxs(je,{children:[e.jsx(Y,{value:"progress",children:"Sortuj wg postępu"}),e.jsx(Y,{value:"score",children:"Sortuj wg wyniku"}),e.jsx(Y,{value:"activity",children:"Sortuj wg aktywności"})]})]})})]})}),e.jsxs(E,{children:[e.jsx("div",{className:"rounded-md border",children:e.jsxs($s,{children:[e.jsx(qs,{children:e.jsxs(Xe,{children:[e.jsx(ne,{children:"Uczeń"}),e.jsx(ne,{children:"Kurs"}),e.jsx(ne,{children:"Postęp"}),e.jsx(ne,{children:"Średni wynik"}),e.jsx(ne,{children:"Czas nauki"}),e.jsx(ne,{children:"Ostatnia aktywność"})]})}),e.jsx(Fs,{children:p.slice(0,20).map((x,g)=>{const b=x.totalActivities>0?Math.round(x.completedActivities/x.totalActivities*100):0;return e.jsxs(Xe,{children:[e.jsxs(se,{className:"font-medium",children:["Uczeń #",g+1]}),e.jsx(se,{children:x.courseTitle}),e.jsx(se,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rs,{value:b,className:"w-[60px]"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[b,"%"]})]})}),e.jsx(se,{children:x.avgScore!==null?e.jsxs(B,{variant:x.avgScore>=70?"default":"secondary",children:[x.avgScore,"%"]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsxs(se,{children:[Math.floor(x.timeSpent/60),"h ",x.timeSpent%60,"m"]}),e.jsx(se,{children:x.lastActivity?new Date(x.lastActivity).toLocaleDateString("pl-PL"):"-"})]},`${x.userId}-${x.courseId}`)})})]})}),p.length>20&&e.jsx("div",{className:"mt-4 text-center",children:e.jsxs(M,{variant:"outline",size:"sm",children:["Zobacz wszystkich (",p.length,")"]})})]})]})]})},yg=["#94a3b8","#60a5fa","#818cf8","#a78bfa","#c084fc","#e879f9","#f472b6","#fb923c","#fbbf24","#fde047"],Ju=t=>{const s=Math.min(Math.floor((t-1)/10),9);return yg[s]},wC=()=>{const[t,s]=f.useState("all"),[n,i]=f.useState("30d"),[r,a]=f.useState(!1),o=()=>{const z=new Date,N=new Date;switch(n){case"7d":N.setDate(N.getDate()-7);break;case"30d":N.setDate(N.getDate()-30);break;case"90d":N.setDate(N.getDate()-90);break}return{start:N,end:z}},{start:l}=o(),c={queryOptions:{staleTime:1/0,gcTime:1800*1e3,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,refetchInterval:!1,retry:0}},{data:d}=Q({resource:"user_stats",pagination:{mode:"off"},sorters:[{field:"total_points",order:"desc"}],meta:{select:"*, users(full_name, email, role)"},...c}),{data:u}=Q({resource:"groups",pagination:{mode:"off"},...c}),{data:m}=Q({resource:"group_members",filters:t!=="all"?[{field:"group_id",operator:"eq",value:parseInt(t)}]:[],pagination:{mode:"off"},...c}),{data:h}=Q({resource:"activity_progress",filters:[{field:"started_at",operator:"gte",value:l.toISOString()}],pagination:{mode:"off"},meta:{select:"*, activities(type)"},...c}),p=f.useMemo(()=>{let z=d?.data||[];if(z=z.filter(N=>!N.users?.role||N.users.role==="student"),t!=="all"&&m?.data){const N=m.data.map(S=>S.user_id);z=z.filter(S=>N.includes(S.user_id))}if(r){const N=new Date;N.setDate(N.getDate()-7),z=z.filter(S=>new Date(S.last_active)>N)}return z},[d?.data,t,m?.data,r]),j=f.useMemo(()=>{const z=p.length,N=p.reduce((k,_)=>k+_.total_points,0),S=z>0?Math.round(p.reduce((k,_)=>k+_.current_level,0)/z):0,P=p.filter(k=>k.daily_streak>0).length,w=Math.max(...p.map(k=>k.daily_streak),0);return{totalUsers:z,totalPoints:N,avgLevel:S,activeStreaks:P,maxStreak:w}},[p]),y=f.useMemo(()=>{const z=new Map;return p.forEach(N=>{const S=Math.floor((N.current_level-1)/10)*10+1;z.set(S,(z.get(S)||0)+1)}),Array.from(z.entries()).map(([N,S])=>({level:`${N}-${N+9}`,count:S,percentage:p.length>0?Math.round(S/p.length*100):0})).sort((N,S)=>parseInt(N.level)-parseInt(S.level))},[p]),x=f.useMemo(()=>p.slice(0,10),[p]),g=f.useMemo(()=>{if(!h?.data)return[];const z=new Map;return h.data.forEach(N=>{if(N.activities?.type==="quiz"&&N.completed_at){const S=z.get(N.user_id)||0;z.set(N.user_id,S+1)}}),p.map(N=>({points:N.total_points,quizzes:z.get(N.user_id)||0,level:N.current_level,streak:N.daily_streak,timeHours:Math.round((N.total_time_spent||0)/60)}))},[p,h?.data]),b=f.useMemo(()=>{const z=[{range:"0",count:0},{range:"1-3",count:0},{range:"4-7",count:0},{range:"8-14",count:0},{range:"15-30",count:0},{range:"30+",count:0}];return p.forEach(N=>{N.daily_streak===0?z[0].count++:N.daily_streak<=3?z[1].count++:N.daily_streak<=7?z[2].count++:N.daily_streak<=14?z[3].count++:N.daily_streak<=30?z[4].count++:z[5].count++}),z},[p]),v=f.useMemo(()=>{if(!h?.data)return[];const z=new Map,N=[];for(let S=13;S>=0;S--){const P=new Date;P.setDate(P.getDate()-S);const w=P.toISOString().split("T")[0];N.push(w),z.set(w,{points:0,activities:0})}return h.data.forEach(S=>{const P=S.started_at.split("T")[0];if(z.has(P)){const w=z.get(P);w.activities++,S.activities?.type==="material"&&S.completed_at?w.points+=10:S.activities?.type==="quiz"&&S.score!==null&&S.score!==void 0&&(w.points+=Math.round(20+S.score/100*30))}}),N.map(S=>({date:new Date(S+"T00:00:00").toLocaleDateString("pl-PL",{day:"numeric",month:"short"}),points:z.get(S)?.points||0}))},[h?.data]),C=f.useMemo(()=>{if(!h?.data)return[];let z=0,N=0;const S=p.filter(w=>w.daily_streak>0).length*5,P=p.filter(w=>w.current_level>1).length*50;return h.data.forEach(w=>{w.activities?.type==="quiz"&&w.score!==null&&w.score!==void 0?z+=Math.round(20+w.score/100*30):w.activities?.type==="material"&&w.completed_at&&(N+=10)}),[{type:"Ukończone quizy",points:z,color:"#8884d8"},{type:"Materiały",points:N,color:"#82ca9d"},{type:"Codzienne logowanie",points:S,color:"#ffc658"},{type:"Awans poziomów",points:P,color:"#ff8042"}].filter(w=>w.points>0).sort((w,k)=>k.points-w.points)},[h?.data,p]),T=f.useMemo(()=>{if(!h?.data)return[];const z=new Map;return h.data.forEach(N=>{N.activities?.type==="quiz"&&N.completed_at&&z.set(N.user_id,(z.get(N.user_id)||0)+1)}),x.map(N=>({...N,quizzesCompleted:z.get(N.user_id)||0}))},[x,h?.data]);return e.jsxs(Z,{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Te,{to:"/teacher/reports/overview",children:e.jsxs(M,{variant:"ghost",size:"sm",children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Powrót do centrum raportów"]})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Raport gamifikacji"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(we,{value:t,onValueChange:s,children:[e.jsx(ge,{className:"w-[200px]",children:e.jsx(be,{placeholder:"Wybierz grupę"})}),e.jsxs(je,{children:[e.jsx(Y,{value:"all",children:"Wszystkie grupy"}),u?.data?.map(z=>e.jsx(Y,{value:z.id.toString(),children:z.name},z.id))]})]}),e.jsxs(we,{value:n,onValueChange:i,children:[e.jsx(ge,{className:"w-[150px]",children:e.jsx(be,{})}),e.jsxs(je,{children:[e.jsx(Y,{value:"7d",children:"Ostatnie 7 dni"}),e.jsx(Y,{value:"30d",children:"Ostatnie 30 dni"}),e.jsx(Y,{value:"90d",children:"Ostatnie 90 dni"})]})]}),e.jsx(M,{variant:r?"default":"outline",size:"sm",onClick:()=>a(!r),children:"Tylko aktywni"})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-5 mb-6",children:[e.jsxs(I,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Uczniowie"}),e.jsx(Ve,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:j.totalUsers}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"w rankingu"})]})]}),e.jsxs(I,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Łączne punkty"}),e.jsx(_n,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:j.totalPoints.toLocaleString("pl-PL")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"zdobytych"})]})]}),e.jsxs(I,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Średni poziom"}),e.jsx(ap,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:j.avgLevel}),e.jsx(rs,{value:j.avgLevel/99*100,className:"mt-2 h-1"})]})]}),e.jsxs(I,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Aktywne serie"}),e.jsx(gs,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:j.activeStreaks}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"uczniów"})]})]}),e.jsxs(I,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Najdłuższa seria"}),e.jsx(ct,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:j.maxStreak}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"dni"})]})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3 mb-6",children:[e.jsxs(I,{className:"lg:col-span-2",children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"h-5 w-5 text-yellow-600"}),"Top 10 uczniów"]})}),e.jsx(E,{children:e.jsx("div",{className:"space-y-3",children:T.map((z,N)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold
                      ${N===0?"bg-yellow-100 text-yellow-700 ring-2 ring-yellow-500":N===1?"bg-gray-100 text-gray-700 ring-2 ring-gray-400":N===2?"bg-orange-100 text-orange-700 ring-2 ring-orange-500":"bg-muted text-muted-foreground"}`,children:N+1}),e.jsx(jr,{children:e.jsx(yr,{className:"text-xs",children:z.users?.full_name?z.users.full_name.split(" ").map(S=>S[0]).join("").toUpperCase():`U${N+1}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:z.users?.full_name||`Uczeń #${N+1}`}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs(B,{variant:"outline",className:"text-xs",style:{borderColor:Ju(z.current_level),color:Ju(z.current_level)},children:["Poziom ",z.current_level]}),z.daily_streak>0&&e.jsxs(B,{variant:"secondary",className:"text-xs",children:[e.jsx(gs,{className:"w-3 h-3 mr-1"}),z.daily_streak," dni"]}),z.perfect_scores>0&&e.jsxs(B,{variant:"secondary",className:"text-xs",children:[e.jsx(_n,{className:"w-3 h-3 mr-1"}),z.perfect_scores," perfect"]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold",children:z.total_points.toLocaleString("pl-PL")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"punktów"})]})]},z.user_id))})})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Rozkład poziomów"})}),e.jsx(E,{children:e.jsx(Ue,{width:"100%",height:300,children:e.jsxs(Aa,{children:[e.jsx(Pa,{data:y,cx:"50%",cy:"50%",labelLine:!1,label:({percentage:z})=>z>0?`${z}%`:"",outerRadius:80,fill:"#8884d8",dataKey:"count",isAnimationActive:!1,children:y.map((z,N)=>e.jsx(js,{fill:yg[N]},`cell-${N}`))}),e.jsx(He,{}),e.jsx(mi,{formatter:(z,N)=>N?.payload&&"level"in N.payload?`Poziom ${N.payload.level}`:""})]})})})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2 mb-6",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Punkty vs Ukończone quizy"})}),e.jsx(E,{children:e.jsx(Ue,{width:"100%",height:300,children:e.jsxs(cp,{children:[e.jsx(qt,{strokeDasharray:"3 3"}),e.jsx(Tt,{dataKey:"quizzes",name:"Ukończone quizy"}),e.jsx(vt,{dataKey:"points",name:"Punkty"}),e.jsx(dp,{dataKey:"level",range:[50,200]}),e.jsx(He,{cursor:{strokeDasharray:"3 3"}}),e.jsx(up,{name:"Uczniowie",data:g,fill:"#8884d8",isAnimationActive:!1})]})})})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Rozkład daily streaks"})}),e.jsx(E,{children:e.jsx(Ue,{width:"100%",height:300,children:e.jsxs(qr,{data:b,children:[e.jsx(qt,{strokeDasharray:"3 3"}),e.jsx(Tt,{dataKey:"range"}),e.jsx(vt,{}),e.jsx(He,{}),e.jsx(yi,{dataKey:"count",fill:"#fbbf24",name:"Liczba uczniów",isAnimationActive:!1,children:b.map((z,N)=>e.jsx(js,{fill:N===0?"#94a3b8":N<=2?"#fbbf24":N<=4?"#f97316":"#ef4444"},`cell-${N}`))})]},`${b.map(z=>z.count).join("-")}`)})})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Zdobywane punkty w czasie"})}),e.jsx(E,{children:e.jsx(Ue,{width:"100%",height:250,children:e.jsxs(lp,{data:v,children:[e.jsx(qt,{strokeDasharray:"3 3"}),e.jsx(Tt,{dataKey:"date"}),e.jsx(vt,{}),e.jsx(He,{}),e.jsx(jc,{type:"monotone",dataKey:"points",stroke:"#8884d8",strokeWidth:2,dot:{fill:"#8884d8"},name:"Punkty",isAnimationActive:!1})]},`${v.map(z=>z.points).join("-")}`)})})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Źródła punktów"})}),e.jsx(E,{children:e.jsx(Ue,{width:"100%",height:250,children:e.jsxs(Aa,{children:[e.jsx(Pa,{data:C,cx:"50%",cy:"50%",labelLine:!1,label:({value:z})=>z!==void 0&&z>0?`${z.toLocaleString("pl-PL")}`:"",outerRadius:80,fill:"#8884d8",dataKey:"points",isAnimationActive:!1,children:C.map((z,N)=>e.jsx(js,{fill:z.color},`cell-${N}`))}),e.jsx(He,{}),e.jsx(mi,{})]})})})]})]}),e.jsxs(I,{className:"mt-6 bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-950/20 dark:to-blue-950/20",children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Bt,{className:"h-5 w-5 text-purple-600"}),"Kluczowe osiągnięcia"]})}),e.jsx(E,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Najaktywniejszy uczeń"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[T[0]?.quizzesCompleted||0," ukończonych quizów"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(st,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Największy wzrost"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["+",Math.round(j.totalPoints*.15).toLocaleString("pl-PL")," punktów w tym okresie"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Zaangażowanie"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[j.totalUsers>0?Math.round(j.activeStreaks/j.totalUsers*100):0,"% uczniów ma aktywną serię"]})]})]})})]})]})},Zi={veryActive:"#22c55e",active:"#3b82f6",moderate:"#f59e0b",lowActivity:"#ef4444",inactive:"#6b7280"},yt={champions:"#8b5cf6",loyalists:"#3b82f6",potentials:"#10b981",newUsers:"#f59e0b",atRisk:"#ef4444",dormant:"#6b7280"},bC=()=>{const[t,s]=f.useState("30d"),[n,i]=f.useState("all"),[r,a]=f.useState("all"),o=f.useMemo(()=>({staleTime:1/0,gcTime:1800*1e3,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,refetchInterval:1e4,retry:0}),[]),{startISO:l}=f.useMemo(()=>{const w=new Date,k=new Date(w);switch(t){case"7d":k.setDate(k.getDate()-7);break;case"30d":k.setDate(k.getDate()-30);break;case"90d":k.setDate(k.getDate()-90);break}return k.setHours(0,0,0,0),{startISO:k.toISOString(),endISO:w.toISOString()}},[t]),c=f.useMemo(()=>n!=="all"?[{field:"role",operator:"eq",value:n}]:[],[n]),d=f.useMemo(()=>({select:"*, users!user_stats_user_id_fkey(email, full_name)"}),[]),u=f.useMemo(()=>({select:"*, activities(type)"}),[]),m=f.useMemo(()=>[{field:"started_at",operator:"gte",value:l}],[l]),{data:h}=Q({resource:"users",pagination:{mode:"off"},filters:c,queryOptions:o}),{data:p}=Q({resource:"user_stats",pagination:{mode:"off"},meta:d,queryOptions:o}),{data:j}=Q({resource:"activity_progress",filters:m,pagination:{mode:"off"},meta:u,queryOptions:o}),y=f.useMemo(()=>{if(!h?.data||!p?.data||!j?.data)return[];const w=new Map(p.data.map(_=>[_.user_id,_])),k=new Map;return j.data.forEach(_=>{const A=k.get(_.user_id)||[];A.push(_),k.set(_.user_id,A)}),h.data.map(_=>{const A=w.get(_.id),D=k.get(_.id)||[];let R;const L=A?.last_active?Math.floor((Date.now()-new Date(A.last_active).getTime())/(1e3*60*60*24)):999;A?L>30?R="dormant":L>14?R="atRisk":A.total_points<100&&L<7?R="newUsers":A.total_points>1e3&&A.daily_streak>7?R="champions":A.daily_streak>3?R="loyalists":R="potentials":R="dormant";const F=D.filter(q=>typeof q.score=="number"),K=F.length?Math.round(F.reduce((q,G)=>q+G.score,0)/F.length):null;return{..._,stats:A,activities:D,segment:R,daysSinceLastActive:L,avgScore:K}})},[h?.data,p?.data,j?.data]),x=f.useMemo(()=>r==="all"?y:y.filter(w=>w.segment===r),[y,r]),g=f.useMemo(()=>{const w=x.length,k=x.filter(F=>F.is_active).length,_=x.filter(F=>F.daysSinceLastActive<=7).length,A=x.filter(F=>F.stats),D=A.length?Math.round(A.reduce((F,K)=>F+(K.stats?.current_level||0),0)/A.length):0,R=A.filter(F=>(F.stats?.daily_streak||0)>0).length,L=A.length?Math.round(A.reduce((F,K)=>F+(K.stats?.total_time_spent||0),0)/A.length/60):0;return{total:w,active:k,activePercent:w>0?Math.round(k/w*100):0,activeLastWeek:_,activeLastWeekPercent:w>0?Math.round(_/w*100):0,avgLevel:D,withStreaks:R,streakPercent:w>0?Math.round(R/w*100):0,avgTimeHours:L}},[x]),b=f.useMemo(()=>{const w=[{name:"Champions",key:"champions",count:0,color:yt.champions,description:"Wysokie punkty, aktywna seria"},{name:"Lojaliści",key:"loyalists",count:0,color:yt.loyalists,description:"Regularna aktywność"},{name:"Potencjalni",key:"potentials",count:0,color:yt.potentials,description:"Niska regularność"},{name:"Nowi",key:"newUsers",count:0,color:yt.newUsers,description:"Niedawno dołączyli"},{name:"Zagrożeni",key:"atRisk",count:0,color:yt.atRisk,description:"Spadek aktywności"},{name:"Nieaktywni",key:"dormant",count:0,color:yt.dormant,description:"Brak aktywności >30 dni"}],k={};return y.forEach(_=>{k[_.segment]=(k[_.segment]||0)+1}),w.map(_=>({..._,count:k[_.key]||0})).filter(_=>_.count>0)},[y]),v=f.useMemo(()=>{const w=[{name:"Champions",key:"champions",count:0,color:yt.champions,description:"Wysokie punkty, aktywna seria"},{name:"Lojaliści",key:"loyalists",count:0,color:yt.loyalists,description:"Regularna aktywność"},{name:"Potencjalni",key:"potentials",count:0,color:yt.potentials,description:"Niska regularność"},{name:"Nowi",key:"newUsers",count:0,color:yt.newUsers,description:"Niedawno dołączyli"},{name:"Zagrożeni",key:"atRisk",count:0,color:yt.atRisk,description:"Spadek aktywności"},{name:"Nieaktywni",key:"dormant",count:0,color:yt.dormant,description:"Brak aktywności >30 dni"}],k={};return y.forEach(_=>{k[_.segment]=(k[_.segment]||0)+1}),w.map(_=>({..._,count:k[_.key]||0}))},[y]),C=f.useMemo(()=>{const w=[{name:"Bardzo aktywni",range:"Codziennie",count:0,color:Zi.veryActive},{name:"Aktywni",range:"2-6 dni/tydz",count:0,color:Zi.active},{name:"Umiarkowani",range:"1 dzień/tydz",count:0,color:Zi.moderate},{name:"Niska aktywność",range:"<1 dzień/tydz",count:0,color:Zi.lowActivity},{name:"Nieaktywni",range:"Brak",count:0,color:Zi.inactive}];return x.forEach(k=>{!k.stats||k.daysSinceLastActive>30?w[4].count++:k.daysSinceLastActive<=1?w[0].count++:k.daysSinceLastActive<=3?w[1].count++:k.daysSinceLastActive<=7?w[2].count++:w[3].count++}),w},[x]),T=f.useMemo(()=>{const w=new Map;return j?.data?.forEach(_=>{const A=_.started_at.slice(0,10),D=w.get(A)||new Set;D.add(_.user_id),w.set(A,D)}),Array.from(w.keys()).sort().slice(-30).map(_=>({date:new Date(_).toLocaleDateString("pl-PL",{day:"numeric",month:"short"}),activeUsers:w.get(_)?.size||0,newUsers:x.filter(A=>A.created_at?.slice(0,10)===_).length}))},[j?.data,x]),z=f.useMemo(()=>x.filter(w=>w.stats&&(w.stats.total_time_spent||0)>0).map(w=>({timeHours:Math.round((w.stats.total_time_spent||0)/60),points:w.stats.total_points,level:w.stats.current_level,streak:w.stats.daily_streak,segment:w.segment})),[x]),N=f.useMemo(()=>x.filter(w=>w.stats).sort((w,k)=>(k.stats?.total_points||0)-(w.stats?.total_points||0)).slice(0,10),[x]),S=f.useMemo(()=>{const w=new Map,k=4;return x.forEach(_=>{const A=new Date(_.created_at);A.setHours(0,0,0,0),A.setDate(A.getDate()-A.getDay());const D=A.toISOString().slice(0,10);w.has(D)||w.set(D,{total:0,retained:Array(k).fill(0)});const R=w.get(D);R.total++;for(let L=0;L<k;L++){const F=new Date(A);F.setDate(F.getDate()+L*7);const K=new Date(F);K.setDate(K.getDate()+7),_.activities.some(G=>{const X=new Date(G.started_at);return X>=F&&X<K})&&R.retained[L]++}}),Array.from(w.entries()).map(([_,A])=>({cohort:new Date(_).toLocaleDateString("pl-PL",{day:"numeric",month:"short"}),week0:100,week1:A.total>0?Math.round(A.retained[1]/A.total*100):0,week2:A.total>0?Math.round(A.retained[2]/A.total*100):0,week3:A.total>0?Math.round(A.retained[3]/A.total*100):0,total:A.total})).slice(-4)},[x]),P=[{label:"Wszyscy użytkownicy",value:g.total.toString(),subValue:`${g.activePercent}% aktywnych`,icon:ce,color:"text-blue-600",bgColor:"bg-blue-50"},{label:"Aktywni w ostatnim tygodniu",value:g.activeLastWeek.toString(),subValue:`${g.activeLastWeekPercent}% wszystkich`,icon:_w,color:"text-green-600",bgColor:"bg-green-50"},{label:"Średni poziom",value:g.avgLevel.toString(),subValue:`${g.avgTimeHours}h średnio`,icon:Bt,color:"text-purple-600",bgColor:"bg-purple-50"},{label:"Z aktywną serią",value:g.withStreaks.toString(),subValue:`${g.streakPercent}% wszystkich`,icon:ct,color:"text-orange-600",bgColor:"bg-orange-50"}];return e.jsxs(Z,{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Te,{to:"/teacher/reports/overview",children:e.jsxs(M,{variant:"ghost",size:"sm",children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Powrót do centrum raportów"]})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Analiza użytkowników"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(we,{value:n,onValueChange:i,children:[e.jsx(ge,{className:"w-[150px]",children:e.jsx(be,{})}),e.jsxs(je,{children:[e.jsx(Y,{value:"all",children:"Wszystkie role"}),e.jsx(Y,{value:"student",children:"Uczniowie"}),e.jsx(Y,{value:"teacher",children:"Nauczyciele"}),e.jsx(Y,{value:"admin",children:"Administratorzy"})]})]}),e.jsxs(we,{value:r,onValueChange:a,children:[e.jsx(ge,{className:"w-[180px]",children:e.jsx(be,{})}),e.jsxs(je,{children:[e.jsx(Y,{value:"all",children:"Wszystkie segmenty"}),v.map(w=>e.jsxs(Y,{value:w.key,children:[w.name," (",w.count,")"]},w.key))]})]}),e.jsxs(we,{value:t,onValueChange:s,children:[e.jsx(ge,{className:"w-[150px]",children:e.jsx(be,{})}),e.jsxs(je,{children:[e.jsx(Y,{value:"7d",children:"Ostatnie 7 dni"}),e.jsx(Y,{value:"30d",children:"Ostatnie 30 dni"}),e.jsx(Y,{value:"90d",children:"Ostatnie 90 dni"})]})]})]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-6",children:P.map((w,k)=>e.jsxs(I,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:w.label}),e.jsx("div",{className:`${w.bgColor} p-2 rounded-lg`,children:e.jsx(w.icon,{className:`h-4 w-4 ${w.color}`})})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:w.value}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:w.subValue})]})]},k))}),e.jsxs(wc,{defaultValue:"segments",className:"space-y-4",children:[e.jsxs(co,{className:"grid w-full grid-cols-5",children:[e.jsx(Gt,{value:"segments",children:"Segmentacja"}),e.jsx(Gt,{value:"activity",children:"Aktywność"}),e.jsx(Gt,{value:"performance",children:"Wyniki"}),e.jsx(Gt,{value:"retention",children:"Retencja"}),e.jsx(Gt,{value:"leaderboard",children:"Ranking"})]}),e.jsxs(Ht,{value:"segments",className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Segmentacja użytkowników"})}),e.jsx(E,{children:b.length===0?e.jsx("div",{className:"text-sm text-muted-foreground p-6 border rounded-lg",children:"Brak danych do wyświetlenia dla wybranego zakresu."}):e.jsx(Ue,{width:"100%",height:300,children:e.jsxs(Aa,{children:[e.jsx(Pa,{data:b,cx:"50%",cy:"50%",outerRadius:100,dataKey:"count",label:({name:w,percent:k})=>k!==void 0?`${w}: ${(k*100).toFixed(0)}%`:w,isAnimationActive:!1,children:b.map((w,k)=>e.jsx(js,{fill:w.color},`cell-${k}`))}),e.jsx(He,{})]})})})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Charakterystyka segmentów"})}),e.jsx(E,{children:e.jsx("div",{className:"space-y-3",children:v.map(w=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:w.color}}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:w.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:w.description})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold",children:w.count}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"użytkowników"})]})]},w.key))})})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ca,{className:"h-5 w-5 text-orange-600"}),"Kluczowe obserwacje"]})}),e.jsx(E,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[v.find(w=>w.key==="atRisk")?.count?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-orange-600",children:[e.jsx(Tw,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Użytkownicy zagrożeni"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[v.find(w=>w.key==="atRisk")?.count," użytkowników wymaga uwagi – rozważ wysłanie powiadomień motywacyjnych"]})]}):null,v.find(w=>w.key==="champions")?.count?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-purple-600",children:[e.jsx(Bt,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Champions do wykorzystania"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[v.find(w=>w.key==="champions")?.count," najaktywniejszych użytkowników – mogą być mentorami lub ambasadorami"]})]}):null,v.find(w=>w.key==="newUsers")?.count?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Nowi użytkownicy"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[v.find(w=>w.key==="newUsers")?.count," nowych użytkowników – upewnij się, że mają dobre wsparcie onboardingowe"]})]}):null]})})]})]}),e.jsxs(Ht,{value:"activity",className:"space-y-4",children:[e.jsx("div",{className:"grid gap-6 lg:grid-cols-2",children:e.jsxs(I,{className:"lg:col-span-2",children:[e.jsx(O,{children:e.jsx($,{children:"Wzorzec aktywności użytkowników"})}),e.jsx(E,{children:e.jsx(Ue,{width:"100%",height:300,children:e.jsxs(ao,{data:T,children:[e.jsx(qt,{strokeDasharray:"3 3"}),e.jsx(Tt,{dataKey:"date"}),e.jsx(vt,{}),e.jsx(He,{}),e.jsx(mi,{}),e.jsx(nn,{type:"monotone",dataKey:"activeUsers",stackId:"1",stroke:"#3b82f6",fill:"#3b82f6",fillOpacity:.6,name:"Aktywni użytkownicy",isAnimationActive:!1}),e.jsx(nn,{type:"monotone",dataKey:"newUsers",stackId:"1",stroke:"#10b981",fill:"#10b981",fillOpacity:.6,name:"Nowi użytkownicy",isAnimationActive:!1})]})})})]})}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Poziomy aktywności"})}),e.jsx(E,{children:e.jsx(Ue,{width:"100%",height:250,children:e.jsxs(qr,{data:C,children:[e.jsx(qt,{strokeDasharray:"3 3"}),e.jsx(Tt,{dataKey:"name"}),e.jsx(vt,{}),e.jsx(He,{}),e.jsx(yi,{dataKey:"count",name:"Użytkownicy",isAnimationActive:!1,children:C.map((w,k)=>e.jsx(js,{fill:w.color},`cell-${k}`))})]})})})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Metryki zaangażowania"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ro,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Średnia częstotliwość logowania"})]}),e.jsx(B,{variant:"outline",children:"3.2 dni/tydzień"})]}),e.jsx(rs,{value:64,className:"h-2"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Średni czas sesji"})]}),e.jsx(B,{variant:"outline",children:"24 min"})]}),e.jsx(rs,{value:48,className:"h-2"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Ukończenia na użytkownika"})]}),e.jsx(B,{variant:"outline",children:"7.8 aktywności"})]}),e.jsx(rs,{value:78,className:"h-2"})]})]})]})]})]}),e.jsxs(Ht,{value:"performance",className:"space-y-4",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Punkty vs Czas nauki"})}),e.jsx(E,{children:e.jsx(Ue,{width:"100%",height:400,children:e.jsxs(cp,{children:[e.jsx(qt,{strokeDasharray:"3 3"}),e.jsx(Tt,{dataKey:"timeHours",name:"Czas nauki (h)"}),e.jsx(vt,{dataKey:"points",name:"Punkty"}),e.jsx(dp,{dataKey:"level",range:[50,400]}),e.jsx(He,{cursor:{strokeDasharray:"3 3"}}),e.jsx(mi,{}),e.jsx(up,{name:"Użytkownicy",data:z,fill:"#8884d8",isAnimationActive:!1,children:z.map((w,k)=>e.jsx(js,{fill:yt[w.segment]||"#8884d8"},`cell-${k}`))})]})})})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Rozkład wyników"})}),e.jsx(E,{children:e.jsx("div",{className:"space-y-4",children:[{label:"90-100%",count:x.filter(w=>w.avgScore!==null&&w.avgScore>=90).length,color:"#22c55e"},{label:"80-89%",count:x.filter(w=>w.avgScore!==null&&w.avgScore>=80&&w.avgScore<90).length,color:"#84cc16"},{label:"70-79%",count:x.filter(w=>w.avgScore!==null&&w.avgScore>=70&&w.avgScore<80).length,color:"#eab308"},{label:"60-69%",count:x.filter(w=>w.avgScore!==null&&w.avgScore>=60&&w.avgScore<70).length,color:"#f97316"},{label:"<60%",count:x.filter(w=>w.avgScore!==null&&w.avgScore<60).length,color:"#ef4444"}].map(w=>{const k=x.filter(A=>A.avgScore!==null).length,_=k>0?w.count/k*100:0;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:w.label}),e.jsxs("span",{className:"font-medium",children:[w.count," użytkowników"]})]}),e.jsx("div",{className:"relative h-8 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"absolute left-0 top-0 h-full transition-all duration-500",style:{width:`${_}%`,backgroundColor:w.color}})})]},w.label)})})})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Wskaźniki sukcesu"})}),e.jsx(E,{children:e.jsx(Ue,{width:"100%",height:250,children:e.jsxs(Uw,{cx:"50%",cy:"50%",innerRadius:"10%",outerRadius:"90%",data:[{name:"Ukończenia",value:68,fill:"#8884d8"},{name:"Zdawalność",value:74,fill:"#82ca9d"},{name:"Zaangażowanie",value:82,fill:"#ffc658"}],children:[e.jsx(Vw,{dataKey:"value",isAnimationActive:!1}),e.jsx(mi,{}),e.jsx(He,{})]})})})]})]})]}),e.jsxs(Ht,{value:"retention",className:"space-y-4",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Analiza kohortowa retencji"})}),e.jsxs(E,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs($s,{children:[e.jsx(qs,{children:e.jsxs(Xe,{children:[e.jsx(ne,{children:"Kohorta"}),e.jsx(ne,{className:"text-center",children:"Tydzień 0"}),e.jsx(ne,{className:"text-center",children:"Tydzień 1"}),e.jsx(ne,{className:"text-center",children:"Tydzień 2"}),e.jsx(ne,{className:"text-center",children:"Tydzień 3"}),e.jsx(ne,{className:"text-center",children:"Liczba użytkowników"})]})}),e.jsx(Fs,{children:S.map(w=>e.jsxs(Xe,{children:[e.jsx(se,{className:"font-medium",children:w.cohort}),e.jsx(se,{className:"text-center",children:e.jsxs("div",{className:"inline-flex items-center justify-center w-16 h-8 rounded",style:{backgroundColor:`rgba(34, 197, 94, ${w.week0/100})`},children:[w.week0,"%"]})}),e.jsx(se,{className:"text-center",children:e.jsxs("div",{className:"inline-flex items-center justify-center w-16 h-8 rounded",style:{backgroundColor:`rgba(34, 197, 94, ${w.week1/100})`},children:[w.week1,"%"]})}),e.jsx(se,{className:"text-center",children:e.jsxs("div",{className:"inline-flex items-center justify-center w-16 h-8 rounded",style:{backgroundColor:`rgba(34, 197, 94, ${w.week2/100})`},children:[w.week2,"%"]})}),e.jsx(se,{className:"text-center",children:e.jsxs("div",{className:"inline-flex items-center justify-center w-16 h-8 rounded",style:{backgroundColor:`rgba(34, 197, 94, ${w.week3/100})`},children:[w.week3,"%"]})}),e.jsx(se,{className:"text-center",children:w.total})]},w.cohort))})]})}),e.jsx("div",{className:"mt-4 p-4 bg-muted rounded-lg",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsx("strong",{children:"Interpretacja:"})," Wartości pokazują procent użytkowników z danej kohorty, którzy byli aktywni w kolejnych tygodniach po dołączeniu."]})})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Czynniki wpływające na retencję"})}),e.jsx(E,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(cn,{className:"h-5 w-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Ukończenie pierwszego quizu"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+42% retencji po 30 dniach"})]})]}),e.jsx(B,{variant:"default",children:"Kluczowy"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(We,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Osiągnięcie 100 punktów"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+28% retencji po 30 dniach"})]})]}),e.jsx(B,{variant:"secondary",children:"Ważny"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ce,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Dołączenie do grupy"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+15% retencji po 30 dniach"})]})]}),e.jsx(B,{variant:"outline",children:"Pomocny"})]})]})})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Prognoza churn"})}),e.jsx(E,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl font-bold text-orange-600 mb-2",children:v.find(w=>w.key==="atRisk")?.count||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"użytkowników zagrożonych odejściem"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Główne przyczyny:"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:"• Brak aktywności powyżej 14 dni (78%)"}),e.jsx("li",{children:"• Niskie wyniki quizów (45%)"}),e.jsx("li",{children:"• Brak postępów w kursie (34%)"}),e.jsx("li",{children:"• Utrata daily streak (23%)"})]})]}),e.jsxs(M,{className:"w-full",variant:"outline",children:[e.jsx(Ca,{className:"mr-2 h-4 w-4"}),"Wygeneruj kampanię reaktywacyjną"]})]})})]})]})]}),e.jsxs(Ht,{value:"leaderboard",className:"space-y-4",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"h-5 w-5 text-yellow-600"}),"Top 10 użytkowników"]})}),e.jsx(E,{children:e.jsx("div",{className:"space-y-3",children:N.map((w,k)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold
                        ${k===0?"bg-yellow-100 text-yellow-700 ring-2 ring-yellow-500":k===1?"bg-gray-100 text-gray-700 ring-2 ring-gray-400":k===2?"bg-orange-100 text-orange-700 ring-2 ring-orange-500":"bg-muted text-muted-foreground"}`,children:k+1}),e.jsx(jr,{children:e.jsx(yr,{className:"text-xs",children:w.full_name?.split(" ").map(_=>_[0]).join("")||w.email.substring(0,2).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:w.full_name||`Użytkownik ${k+1}`}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx(B,{variant:"outline",className:"text-xs",style:{borderColor:yt[w.segment]||"#8884d8",color:yt[w.segment]||"#8884d8"},children:v.find(_=>_.key===w.segment)?.name||w.segment}),e.jsxs(B,{variant:"secondary",className:"text-xs",children:["Poziom ",w.stats?.current_level||0]}),w.stats&&w.stats.daily_streak>0&&e.jsxs(B,{variant:"secondary",className:"text-xs",children:[e.jsx(ct,{className:"w-3 h-3 mr-1"}),w.stats.daily_streak," dni"]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold",children:w.stats?.total_points.toLocaleString("pl-PL")||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"punktów"})]})]},w.id))})})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{className:"text-base",children:"Najbardziej zaangażowani"})}),e.jsx(E,{children:e.jsx("div",{className:"space-y-3",children:x.filter(w=>w.stats).sort((w,k)=>(k.stats?.total_time_spent||0)-(w.stats?.total_time_spent||0)).slice(0,5).map((w,k)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:w.full_name||`Użytkownik ${k+1}`}),e.jsxs(B,{variant:"outline",children:[Math.round((w.stats?.total_time_spent||0)/60),"h"]})]},w.id))})})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{className:"text-base",children:"Najlepsze wyniki"})}),e.jsx(E,{children:e.jsx("div",{className:"space-y-3",children:x.filter(w=>w.avgScore!==null).sort((w,k)=>w.avgScore<k.avgScore?1:-1).slice(0,5).map((w,k)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:w.full_name||`Użytkownik ${k+1}`}),e.jsxs(B,{variant:w.avgScore>=80?"default":"secondary",children:[w.avgScore,"%"]})]},w.id))})})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{className:"text-base",children:"Najdłuższe serie"})}),e.jsx(E,{children:e.jsx("div",{className:"space-y-3",children:x.filter(w=>w.stats).sort((w,k)=>(k.stats?.daily_streak||0)-(w.stats?.daily_streak||0)).slice(0,5).map((w,k)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:w.full_name||`Użytkownik ${k+1}`}),e.jsxs(B,{variant:"outline",children:[e.jsx(ct,{className:"w-3 h-3 mr-1"}),w.stats?.daily_streak," dni"]})]},w.id))})})]})]})]})]})]})},vC=()=>{const[t,s]=f.useState("30d"),[n,i]=f.useState("all"),[r,a]=f.useState("all"),o={queryOptions:{staleTime:1/0,gcTime:1800*1e3,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,refetchInterval:!1,retry:0}},l=()=>{const N=new Date,S=new Date;switch(t){case"7d":S.setDate(S.getDate()-7);break;case"30d":S.setDate(S.getDate()-30);break;case"90d":S.setDate(S.getDate()-90);break}return{start:S,end:N}},{start:c}=l(),{data:d}=Q({resource:"questions",pagination:{mode:"off"},...o}),{data:u}=Q({resource:"courses",pagination:{mode:"off"},...o}),{data:m}=Q({resource:"topics",filters:n!=="all"?[{field:"course_id",operator:"eq",value:parseInt(n)}]:[],pagination:{mode:"off"},...o}),{data:h}=Q({resource:"activities",filters:[{field:"type",operator:"eq",value:"quiz"},{field:"is_published",operator:"eq",value:!0}],pagination:{mode:"off"},...o}),{data:p}=Q({resource:"activity_progress",filters:[{field:"started_at",operator:"gte",value:c.toISOString()}],pagination:{mode:"off"},meta:{query:N=>N.not("score","is",null)},...o}),j=f.useMemo(()=>{if(!h?.data||!m?.data||!u?.data)return[];const N=new Map(m.data.map(P=>[P.id,P])),S=new Map(u.data.map(P=>[P.id,P]));return h.data.map(P=>{const w=N.get(P.topic_id),k=w?S.get(w.course_id):void 0;return{...P,topicTitle:w?.title||"",courseId:k?.id,courseTitle:k?.title||""}})},[h?.data,m?.data,u?.data]),y=f.useMemo(()=>{let N=j;return n!=="all"&&(N=N.filter(S=>S.courseId===parseInt(n))),r!=="all"&&(N=N.filter(S=>S.topic_id===parseInt(r))),N},[j,n,r]),x=f.useMemo(()=>{if(!p?.data)return[];const N=y.map(S=>S.id);return p.data.filter(S=>N.includes(S.activity_id)&&S.score!==null&&S.score!==void 0)},[p?.data,y]),g=f.useMemo(()=>{const N=new Map;return y.forEach(S=>{const P=x.filter(w=>w.activity_id===S.id);if(P.length>0){const w=P.filter(A=>A.score!==null&&A.score!==void 0).map(A=>A.score);if(w.length===0)return;const k=Math.round(w.reduce((A,D)=>A+D,0)/w.length),_=Math.round(w.filter(A=>A>=(S.passing_score||70)).length/w.length*100);N.set(S.id,{activityId:S.id,activityTitle:S.title,topicTitle:S.topicTitle,courseTitle:S.courseTitle,attempts:P.length,avgScore:k,minScore:Math.min(...w),maxScore:Math.max(...w),passRate:_,passingScore:S.passing_score||70})}}),Array.from(N.values()).sort((S,P)=>S.avgScore-P.avgScore)},[y,x]),b=f.useMemo(()=>{const N=x.length,S=x.filter(D=>D.score!==null&&D.score!==void 0).map(D=>D.score),P=S.length>0?Math.round(S.reduce((D,R)=>D+R,0)/S.length):0,w=x.filter(D=>{if(D.score===null||D.score===void 0)return!1;const L=y.find(F=>F.id===D.activity_id)?.passing_score||70;return D.score>=L}).length,k=N>0?Math.round(w/N*100):0;return{totalAttempts:N,avgScore:P,avgScoreChange:3,passRate:k,passRateChange:5,uniqueStudents:new Set(x.map(D=>D.user_id)).size,totalQuizzes:y.length}},[x,y]),v=f.useMemo(()=>{const N=[{range:"0-20%",count:0,color:"#ef4444"},{range:"21-40%",count:0,color:"#f97316"},{range:"41-60%",count:0,color:"#eab308"},{range:"61-80%",count:0,color:"#84cc16"},{range:"81-100%",count:0,color:"#22c55e"}];return x.forEach(S=>{const P=S.score||0;P<=20?N[0].count++:P<=40?N[1].count++:P<=60?N[2].count++:P<=80?N[3].count++:N[4].count++}),N},[x]),C=f.useMemo(()=>{const N=new Map;return x.forEach(S=>{const P=y.find(w=>w.id===S.activity_id);if(P?.topicTitle&&S.score!==null&&S.score!==void 0){const w=N.get(P.topicTitle)||{scores:[],topic:P.topicTitle};w.scores.push(S.score),N.set(P.topicTitle,w)}}),Array.from(N.values()).map(({topic:S,scores:P})=>({topic:S.length>20?S.substring(0,20)+"...":S,avgScore:Math.round(P.reduce((w,k)=>w+k,0)/P.length),attempts:P.length})).slice(0,8)},[x,y]),T=f.useMemo(()=>{const N=new Map;return x.forEach(S=>{const P=new Date(S.started_at).toLocaleDateString("pl-PL"),w=N.get(P)||[];S.score!==null&&S.score!==void 0&&(w.push(S.score),N.set(P,w))}),Array.from(N.entries()).map(([S,P])=>({date:S,avgScore:Math.round(P.reduce((w,k)=>w+k,0)/P.length),attempts:P.length,minScore:Math.min(...P),maxScore:Math.max(...P)})).sort((S,P)=>new Date(S.date).getTime()-new Date(P.date).getTime()).slice(-14)},[x]),z=f.useMemo(()=>{if(!d?.data||!g.length)return[];const N=g.slice(0,5),S=[];return N.forEach(P=>{d.data.filter(k=>k.activity_id===P.activityId).sort((k,_)=>k.order_index-_.order_index).forEach((k,_)=>{let A="medium";P.avgScore<30?A="very-hard":P.avgScore<50?A="hard":P.avgScore<70?A="medium":A="easy",S.push({questionId:k.id,question:k.question,activityTitle:P.activityTitle,quizAttempts:P.attempts,avgQuizScore:P.avgScore,difficulty:A})})}),S.sort((P,w)=>P.avgQuizScore-w.avgQuizScore).slice(0,10)},[d?.data,g]);return e.jsxs(Z,{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Te,{to:"/teacher/reports/overview",children:e.jsxs(M,{variant:"ghost",size:"sm",children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Powrót do centrum raportów"]})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Raport wyników"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(we,{value:n,onValueChange:i,children:[e.jsx(ge,{className:"w-[200px]",children:e.jsx(be,{placeholder:"Wybierz kurs"})}),e.jsxs(je,{children:[e.jsx(Y,{value:"all",children:"Wszystkie kursy"}),u?.data?.map(N=>e.jsx(Y,{value:N.id.toString(),children:N.title},N.id))]})]}),e.jsxs(we,{value:r,onValueChange:a,disabled:n==="all",children:[e.jsx(ge,{className:"w-[200px]",children:e.jsx(be,{placeholder:"Wybierz temat"})}),e.jsxs(je,{children:[e.jsx(Y,{value:"all",children:"Wszystkie tematy"}),m?.data?.map(N=>e.jsx(Y,{value:N.id.toString(),children:N.title},N.id))]})]}),e.jsxs(we,{value:t,onValueChange:s,children:[e.jsx(ge,{className:"w-[150px]",children:e.jsx(be,{})}),e.jsxs(je,{children:[e.jsx(Y,{value:"7d",children:"Ostatnie 7 dni"}),e.jsx(Y,{value:"30d",children:"Ostatnie 30 dni"}),e.jsx(Y,{value:"90d",children:"Ostatnie 90 dni"})]})]}),e.jsxs(M,{variant:"outline",size:"sm",children:[e.jsx(rp,{className:"mr-2 h-4 w-4"}),"Eksportuj"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4 mb-6",children:[e.jsxs(I,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Średni wynik"}),e.jsx(We,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[b.avgScore,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsxs("span",{className:b.avgScoreChange>0?"text-green-600":"text-red-600",children:[b.avgScoreChange>0?e.jsx(st,{className:"inline h-3 w-3"}):e.jsx(op,{className:"inline h-3 w-3"})," ",Math.abs(b.avgScoreChange),"%"]})," ","vs. poprzedni okres"]})]})]}),e.jsxs(I,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Wskaźnik zdawalności"}),e.jsx(en,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[b.passRate,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsxs("span",{className:b.passRateChange>0?"text-green-600":"text-red-600",children:[b.passRateChange>0?"+":"",b.passRateChange,"%"]})," ","vs. poprzedni okres"]})]})]}),e.jsxs(I,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Liczba podejść"}),e.jsx(Be,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:b.totalAttempts}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[b.uniqueStudents," unikalnych uczniów"]})]})]}),e.jsxs(I,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Liczba quizów"}),e.jsx(We,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:b.totalQuizzes}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"aktywnych w okresie"})]})]})]}),e.jsxs(wc,{defaultValue:"distribution",className:"space-y-4",children:[e.jsxs(co,{children:[e.jsx(Gt,{value:"distribution",children:"Rozkład wyników"}),e.jsx(Gt,{value:"topics",children:"Wyniki według tematów"}),e.jsx(Gt,{value:"trend",children:"Trend w czasie"}),e.jsx(Gt,{value:"difficult",children:"Najtrudniejsze pytania"})]}),e.jsx(Ht,{value:"distribution",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Rozkład wyników"})}),e.jsx(E,{children:e.jsx(Ue,{width:"100%",height:300,children:e.jsxs(qr,{data:v,children:[e.jsx(qt,{strokeDasharray:"3 3"}),e.jsx(Tt,{dataKey:"range"}),e.jsx(vt,{}),e.jsx(He,{}),e.jsx(yi,{dataKey:"count",name:"Liczba wyników",isAnimationActive:!1,children:v.map((N,S)=>e.jsx(js,{fill:N.color},`cell-${S}`))})]})})})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4 text-orange-600"}),"Quizy wymagające uwagi"]})}),e.jsx(E,{children:e.jsx("div",{className:"space-y-3",children:g.slice(0,5).map(N=>e.jsxs("div",{className:"space-y-2 pb-3 border-b last:border-0",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:N.activityTitle}),e.jsx("p",{className:"text-xs text-muted-foreground",children:N.topicTitle})]}),e.jsxs(B,{variant:N.avgScore<50?"destructive":"secondary",children:[N.avgScore,"%"]})]}),e.jsxs("div",{className:"flex gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Zdawalność: ",N.passRate,"%"]}),e.jsxs("span",{children:["Próby: ",N.attempts]}),e.jsxs("span",{children:["Min/Max: ",N.minScore,"%/",N.maxScore,"%"]})]})]},N.activityId))})})]})]})}),e.jsx(Ht,{value:"topics",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Średnie wyniki według tematów"})}),e.jsx(E,{children:e.jsx(Ue,{width:"100%",height:400,children:e.jsxs(Kw,{data:C,children:[e.jsx(Ww,{}),e.jsx(Gw,{dataKey:"topic",tick:{fontSize:12}}),e.jsx(Hw,{domain:[0,100]}),e.jsx(Qw,{name:"Średni wynik",dataKey:"avgScore",stroke:"#8884d8",fill:"#8884d8",fillOpacity:.6,isAnimationActive:!1}),e.jsx(He,{})]})})})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Szczegółowe wyniki"})}),e.jsx(E,{children:e.jsxs($s,{children:[e.jsx(qs,{children:e.jsxs(Xe,{children:[e.jsx(ne,{children:"Temat"}),e.jsx(ne,{className:"text-right",children:"Średni wynik"}),e.jsx(ne,{className:"text-right",children:"Liczba prób"})]})}),e.jsx(Fs,{children:C.map(N=>e.jsxs(Xe,{children:[e.jsx(se,{className:"font-medium",children:N.topic}),e.jsx(se,{className:"text-right",children:e.jsxs(B,{variant:N.avgScore>=70?"default":"secondary",children:[N.avgScore,"%"]})}),e.jsx(se,{className:"text-right",children:N.attempts})]},N.topic))})]})})]})]})}),e.jsx(Ht,{value:"trend",className:"space-y-4",children:e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Trend wyników w czasie"})}),e.jsx(E,{children:e.jsx(Ue,{width:"100%",height:400,children:e.jsxs(Zw,{data:T,children:[e.jsx(qt,{strokeDasharray:"3 3"}),e.jsx(Tt,{dataKey:"date"}),e.jsx(vt,{}),e.jsx(He,{}),e.jsx(mi,{}),e.jsx(nn,{type:"monotone",dataKey:"maxScore",fill:"#8884d8",stroke:"#8884d8",fillOpacity:.2,name:"Max",isAnimationActive:!1}),e.jsx(nn,{type:"monotone",dataKey:"minScore",fill:"#82ca9d",stroke:"#82ca9d",fillOpacity:.2,name:"Min",isAnimationActive:!1}),e.jsx(jc,{type:"monotone",dataKey:"avgScore",stroke:"#ff7300",strokeWidth:3,name:"Średnia",dot:{fill:"#ff7300"},isAnimationActive:!1}),e.jsx(yi,{dataKey:"attempts",fill:"#ffc658",name:"Liczba prób",yAxisId:"right",isAnimationActive:!1}),e.jsx(vt,{yAxisId:"right",orientation:"right"})]})})})]})}),e.jsx(Ht,{value:"difficult",className:"space-y-4",children:e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-5 w-5 text-red-600"}),"Najtrudniejsze pytania"]})}),e.jsxs(E,{children:[e.jsx("div",{className:"space-y-4",children:z.length>0?z.map((N,S)=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs(B,{variant:"outline",children:["#",S+1]}),e.jsxs(B,{variant:N.difficulty==="very-hard"?"destructive":N.difficulty==="hard"?"secondary":"default",children:["Quiz: ",N.avgQuizScore,"% średnio"]})]}),e.jsx("p",{className:"text-sm font-medium",children:N.question}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Z quizu: ",N.activityTitle," • ",N.quizAttempts," podejść"]})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Średni wynik quizu"}),e.jsxs("p",{className:"font-medium",children:[N.avgQuizScore,"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Liczba podejść"}),e.jsx("p",{className:"font-medium",children:N.quizAttempts})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Poziom trudności"}),e.jsx(B,{variant:N.difficulty==="very-hard"?"destructive":N.difficulty==="hard"?"secondary":N.difficulty==="medium"?"outline":"default",children:N.difficulty==="very-hard"?"Bardzo trudne":N.difficulty==="hard"?"Trudne":N.difficulty==="medium"?"Średnie":"Łatwe"})]})]})]},N.questionId)):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"Brak danych o pytaniach w wybranym okresie."}),e.jsx("p",{className:"text-sm mt-2",children:"Upewnij się, że wybrane quizy mają pytania."})]})}),e.jsx("div",{className:"mt-4 p-4 bg-muted rounded-lg",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsx("strong",{children:"Wskazówka:"})," Rozważ dodanie dodatkowych materiałów lub wyjaśnień do pytań z niskim wskaźnikiem poprawnych odpowiedzi."]})})]})]})})]})]})},NC=[e.jsx(H,{path:"reports",element:e.jsx(as,{to:"overview",replace:!0})},"reports-root-redirect"),e.jsx(H,{path:"reports/overview",element:e.jsx(gC,{})},"reports-overview"),e.jsx(H,{path:"reports/engagement",element:e.jsx(jC,{})},"reports-engagement"),e.jsx(H,{path:"reports/progress",element:e.jsx(yC,{})},"reports-progress"),e.jsx(H,{path:"reports/performance",element:e.jsx(vC,{})},"reports-performance"),e.jsx(H,{path:"reports/gamification",element:e.jsx(wC,{})},"reports-gamification"),e.jsx(H,{path:"reports/summary",element:e.jsx(bC,{})},"reports-summary")],kC=()=>{const{activityId:t}=ft();le();const[s,n]=f.useState(null),[i,r]=f.useState(!1),{data:a,isLoading:o}=Le({resource:"activities",id:t,meta:{select:"*, topics(*, courses(*))"}}),{data:l,isLoading:c,refetch:d}=Q({resource:"questions",filters:[{field:"activity_id",operator:"eq",value:parseInt(t)}],sorters:[{field:"position",order:"asc"}],pagination:{mode:"off"}}),{mutate:u}=os(),{mutate:m}=En(),{mutate:h}=Is();if(o||c)return e.jsx(Z,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const p=a?.data,j=l?.data||[];return e.jsxs(Z,{children:[e.jsx(Mn,{}),e.jsxs(ie,{children:[e.jsx(me,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-6 h-6 text-blue-500"}),"Pytania quizu"]}),description:e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-medium",children:p?.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[p?.topics?.courses?.title," → Temat"," ",p?.topics?.position,": ",p?.topics?.title]})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(B,{variant:"outline",className:"text-base px-3 py-1",children:[j.length," ",j.length===1?"pytanie":"pytań"]}),e.jsxs(M,{onClick:()=>r(!0),disabled:i,children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Dodaj pytanie"]})]})]}),e.jsx(I,{className:"bg-muted/50",children:e.jsx(E,{className:"pt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Próg zaliczenia:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[p?.passing_score||70,"%"]})]}),p?.time_limit&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Limit czasu:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[p.time_limit," min"]})]}),p?.max_attempts&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Max. prób:"}),e.jsx("span",{className:"ml-2 font-medium",children:p.max_attempts})]})]})})}),i&&e.jsx(Xu,{activityId:parseInt(t),position:j.length+1,onSave:y=>{u({resource:"questions",values:y},{onSuccess:()=>{W.success("Pytanie zostało dodane"),r(!1),d()}})},onCancel:()=>r(!1)}),e.jsx("div",{className:"space-y-4",children:j.map(y=>e.jsx("div",{children:s===y.id?e.jsx(Xu,{question:y,activityId:parseInt(t),position:y.position,onSave:x=>{m({resource:"questions",id:y.id,values:x},{onSuccess:()=>{W.success("Pytanie zostało zaktualizowane"),n(null),d()}})},onCancel:()=>n(null)}):e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs(ie,{children:[e.jsxs($,{className:"text-base",children:[e.jsxs("span",{className:"text-muted-foreground mr-2",children:["#",y.position]}),y.question]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(B,{variant:"outline",children:[y.points," pkt"]}),e.jsx(M,{variant:"outline",size:"sm",onClick:()=>n(y.id),children:e.jsx(Cs,{className:"w-3 h-3"})}),e.jsx(M,{variant:"outline",size:"sm",onClick:()=>{confirm("Czy na pewno chcesz usunąć to pytanie?")&&h({resource:"questions",id:y.id},{onSuccess:()=>{W.success("Pytanie zostało usunięte"),d()}})},children:e.jsx(dt,{className:"w-3 h-3 text-red-600"})})]})]})}),e.jsxs(E,{children:[e.jsx("div",{className:"space-y-2",children:y.options.map((x,g)=>e.jsxs("div",{className:`flex items-center gap-2 p-2 rounded ${x.is_correct?"bg-green-50 dark:bg-green-950/30 border border-green-200 dark:border-green-800":""}`,children:[x.is_correct?e.jsx($t,{className:"w-4 h-4 text-green-600"}):e.jsx(ls,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:x.is_correct?"font-medium":"",children:x.text})]},x.id||g))}),y.explanation&&e.jsxs("div",{className:"mt-4 p-3 bg-muted rounded",children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:"Wyjaśnienie:"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:y.explanation})]})]})]})},y.id))}),j.length===0&&!i&&e.jsx(I,{children:e.jsxs(E,{className:"text-center py-12",children:[e.jsx(Be,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground/50"}),e.jsx("p",{className:"text-lg font-medium text-muted-foreground mb-4",children:"Quiz nie ma jeszcze żadnych pytań"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"Dodaj pierwsze pytanie, aby uczniowie mogli rozwiązać quiz"}),e.jsxs(M,{onClick:()=>r(!0),children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Dodaj pierwsze pytanie"]})]})}),j.length>0&&e.jsxs("div",{className:"flex justify-between items-center pt-6 border-t",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Łącznie punktów: ",j.reduce((y,x)=>y+x.points,0)]}),e.jsx(Mn,{variant:"outline",children:"Zakończ edycję"})]})]})},Xu=({question:t,activityId:s,position:n,onSave:i,onCancel:r})=>{const[a,o]=f.useState({question:t?.question||"",explanation:t?.explanation||"",points:t?.points||1,position:n,options:t?.options||[{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1}]}),l=()=>{if(!a.question.trim()){W.error("Pytanie jest wymagane");return}const u=a.options.filter(h=>h.text.trim());if(u.length<2){W.error("Dodaj przynajmniej 2 odpowiedzi");return}if(u.filter(h=>h.is_correct).length===0){W.error("Zaznacz przynajmniej jedną poprawną odpowiedź");return}i({activity_id:s,question:a.question,explanation:a.explanation||null,points:a.points,position:a.position,options:u.map((h,p)=>({...h,position:p+1}))})},c=()=>{a.options.length<6&&o({...a,options:[...a.options,{text:"",is_correct:!1}]})},d=u=>{if(a.options.length>2){const m=a.options.filter((h,p)=>p!==u);o({...a,options:m})}};return e.jsxs(I,{className:"border-primary",children:[e.jsx(O,{children:e.jsx($,{children:t?"Edytuj pytanie":"Nowe pytanie"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Treść pytania"}),e.jsx(cs,{placeholder:"Wprowadź treść pytania...",value:a.question,onChange:u=>o({...a,question:u.target.value}),className:"mt-1",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Liczba punktów"}),e.jsx(J,{type:"number",min:"1",value:a.points,onChange:u=>o({...a,points:parseInt(u.target.value)||1}),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Pozycja"}),e.jsx(J,{type:"number",min:"1",value:a.position,onChange:u=>o({...a,position:parseInt(u.target.value)||1}),className:"mt-1"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Odpowiedzi"}),a.options.length<6&&e.jsxs(M,{type:"button",size:"sm",variant:"outline",onClick:c,children:[e.jsx(Qe,{className:"w-3 h-3 mr-1"}),"Dodaj opcję"]})]}),e.jsx("div",{className:"space-y-2",children:a.options.map((u,m)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ke,{checked:u.is_correct,onCheckedChange:h=>{const p=[...a.options];p[m].is_correct=h,o({...a,options:p})}}),e.jsx(J,{placeholder:`Odpowiedź ${m+1}`,value:u.text,onChange:h=>{const p=[...a.options];p[m].text=h.target.value,o({...a,options:p})},className:"flex-1"}),a.options.length>2&&e.jsx(M,{type:"button",variant:"ghost",size:"sm",onClick:()=>d(m),children:e.jsx(ls,{className:"w-4 h-4"})})]},m))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Zaznacz checkbox przy poprawnych odpowiedziach. Możesz zaznaczyć więcej niż jedną."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Wyjaśnienie (opcjonalne)"}),e.jsx(cs,{placeholder:"Wyjaśnienie poprawnej odpowiedzi...",value:a.explanation,onChange:u=>o({...a,explanation:u.target.value}),className:"mt-1",rows:3})]}),e.jsxs(ie,{children:[e.jsxs(M,{variant:"outline",onClick:r,children:[e.jsx(ls,{className:"w-4 h-4 mr-2"}),"Anuluj"]}),e.jsxs(M,{onClick:l,children:[e.jsx(sn,{className:"w-4 h-4 mr-2"}),"Zapisz pytanie"]})]})]})]})},zC=()=>{const[t]=Ya(),s=le(),n=t.get("activity_id"),{data:i,isLoading:r}=Q({resource:"questions",filters:[{field:"activity_id",operator:"eq",value:parseInt(n)}],sorters:[{field:"position",order:"desc"}],pagination:{mode:"off"}}),[a,o]=f.useState({question:"",explanation:"",points:1,position:1,options:[{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1}]});f.useEffect(()=>{if(i?.data){const y=i.data.reduce((x,g)=>Math.max(x,g.position||0),0);o(x=>({...x,position:y+1}))}},[i]);const{data:l,isLoading:c}=Le({resource:"activities",id:n,meta:{select:"*, topics(*, courses(*))"}}),{mutate:d,isLoading:u}=os();if(!n)return e.jsx(Z,{children:e.jsx(I,{children:e.jsx(E,{className:"text-center py-12",children:e.jsx("p",{className:"text-lg font-medium text-muted-foreground",children:"Brak ID aktywności"})})})});if(c||r)return e.jsx(Z,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const m=l?.data;if(!m||m.type!=="quiz")return e.jsx(Z,{children:e.jsx(I,{children:e.jsx(E,{className:"text-center py-12",children:e.jsx("p",{className:"text-lg font-medium text-muted-foreground",children:"Nieprawidłowa aktywność lub aktywność nie jest quizem"})})})});const h=()=>{if(!a.question.trim()){W.error("Pytanie jest wymagane");return}const y=a.options.filter(g=>g.text.trim());if(y.length<2){W.error("Dodaj przynajmniej 2 odpowiedzi");return}if(y.filter(g=>g.is_correct).length===0){W.error("Zaznacz przynajmniej jedną poprawną odpowiedź");return}d({resource:"questions",values:{activity_id:parseInt(n),question:a.question,explanation:a.explanation||null,points:a.points,position:a.position,options:y.map((g,b)=>({id:b+1,text:g.text,is_correct:g.is_correct}))}},{onSuccess:()=>{W.success("Pytanie zostało dodane"),s(`/teacher/questions/manage/${n}`)},onError:g=>{console.error("Błąd podczas dodawania pytania:",g);const b=g?.code||g?.statusCode,v=g?.message||g?.error?.message;b==="23505"||b===23505?v?.includes("position")?W.error("Pytanie o tej pozycji już istnieje. Zmień pozycję na inną wartość."):W.error("Wystąpił konflikt z istniejącymi danymi. Sprawdź pozycję pytania."):b==="23503"||b===23503?W.error("Nieprawidłowe powiązanie z aktywnością."):b==="22P02"||b===22002?W.error("Nieprawidłowy format danych."):v?W.error(`Błąd: ${v}`):W.error("Wystąpił nieoczekiwany błąd. Spróbuj ponownie.")}})},p=()=>{a.options.length<6&&o({...a,options:[...a.options,{text:"",is_correct:!1}]})},j=y=>{if(a.options.length>2){const x=a.options.filter((g,b)=>b!==y);o({...a,options:x})}};return e.jsxs(Z,{children:[e.jsx(Mn,{}),e.jsx(ie,{children:e.jsx(me,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-6 h-6 text-blue-500"}),"Dodaj pytanie do quizu"]}),description:e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-medium",children:m?.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[m?.topics?.courses?.title," → Temat"," ",m?.topics?.position,": ",m?.topics?.title]})]})})}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Nowe pytanie"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Treść pytania"}),e.jsx(cs,{placeholder:"Wprowadź treść pytania...",value:a.question,onChange:y=>o({...a,question:y.target.value}),className:"mt-1",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Liczba punktów"}),e.jsx(J,{type:"number",min:"1",value:a.points,onChange:y=>o({...a,points:parseInt(y.target.value)||1}),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Pozycja"}),e.jsx(J,{type:"number",min:"1",value:a.position,onChange:y=>o({...a,position:parseInt(y.target.value)||1}),className:"mt-1"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Odpowiedzi"}),a.options.length<6&&e.jsxs(M,{type:"button",size:"sm",variant:"outline",onClick:p,children:[e.jsx(Qe,{className:"w-3 h-3 mr-1"}),"Dodaj opcję"]})]}),e.jsx("div",{className:"space-y-2",children:a.options.map((y,x)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ke,{checked:y.is_correct,onCheckedChange:g=>{const b=[...a.options];b[x].is_correct=g,o({...a,options:b})}}),e.jsx(J,{placeholder:`Odpowiedź ${x+1}`,value:y.text,onChange:g=>{const b=[...a.options];b[x].text=g.target.value,o({...a,options:b})},className:"flex-1"}),a.options.length>2&&e.jsx(M,{type:"button",variant:"ghost",size:"sm",onClick:()=>j(x),children:e.jsx(ls,{className:"w-4 h-4"})})]},x))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Zaznacz checkbox przy poprawnych odpowiedziach. Możesz zaznaczyć więcej niż jedną."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Wyjaśnienie (opcjonalne)"}),e.jsx(cs,{placeholder:"Wyjaśnienie poprawnej odpowiedzi...",value:a.explanation,onChange:y=>o({...a,explanation:y.target.value}),className:"mt-1",rows:3})]}),e.jsxs(ie,{children:[e.jsxs(M,{variant:"outline",onClick:()=>s(`/teacher/questions/manage/${n}`),children:[e.jsx(ls,{className:"w-4 h-4 mr-2"}),"Anuluj"]}),e.jsxs(M,{onClick:h,disabled:u,children:[e.jsx(sn,{className:"w-4 h-4 mr-2"}),u?"Zapisywanie...":"Zapisz pytanie"]})]})]})]})]})},SC=[e.jsx(H,{path:"/questions/manage/:activityId",element:e.jsx(kC,{})},"questions-manage"),e.jsx(H,{path:"/questions/create",element:e.jsx(zC,{})},"questions-create")],CC=(t,s)=>{const{data:n,isLoading:i}=Le({resource:"groups",id:t}),{data:r,isLoading:a}=Le({resource:"courses",id:s}),{data:o,isLoading:l}=Q({resource:"group_members",filters:[{field:"group_id",operator:"eq",value:parseInt(t)}],pagination:{mode:"off"},meta:{select:"*, users(id, full_name, email)"}}),{data:c,isLoading:d}=Q({resource:"topics",filters:[{field:"course_id",operator:"eq",value:parseInt(s)}],pagination:{mode:"off"},sorters:[{field:"position",order:"asc"}]}),u=c?.data?.map(w=>w.id)||[],{data:m,isLoading:h}=Q({resource:"activities",filters:u.length>0?[{field:"topic_id",operator:"in",value:u}]:[],pagination:{mode:"off"},sorters:[{field:"position",order:"asc"}],queryOptions:{enabled:u.length>0}}),p=m?.data?.map(w=>w.id)||[],j=o?.data?.map(w=>w.user_id)||[],{data:y,isLoading:x}=Q({resource:"activity_progress",filters:p.length>0&&j.length>0?[{field:"activity_id",operator:"in",value:p},{field:"user_id",operator:"in",value:j}]:[],pagination:{mode:"off"},queryOptions:{enabled:p.length>0&&j.length>0}}),g=i||a||l||d||h||x,b=o?.data?.map(w=>w.users).filter(Boolean)||[],v=c?.data||[],C=m?.data||[],T=y?.data||[],z=w=>{const k=T.filter(G=>G.user_id===w),_=k.filter(G=>G.completed_at!==null).length,A=C.length,D=A>0?_/A*100:0,R=k.filter(G=>G.completed_at!==null).sort((G,X)=>new Date(X.completed_at).getTime()-new Date(G.completed_at).getTime()),L=R.length>0?R[0].completed_at:null,F=k.filter(G=>G.score!==null&&G.score>0),K=F.length>0?F.reduce((G,X)=>G+X.score,0)/F.length:null,q=k.reduce((G,X)=>G+(X.time_spent||0),0);return{completedCount:_,totalCount:A,progressPercentage:D,lastActivity:L,averageScore:K,totalTimeSpent:q}},N=f.useMemo(()=>{if(b.length===0)return{averageProgress:0,completedStudents:0,inProgressStudents:0,notStartedStudents:0,averageScore:null};let w=0,k=0,_=0,A=0;const D=[];return b.forEach(R=>{const L=z(R.id);w+=L.progressPercentage,L.progressPercentage===100?k++:L.progressPercentage>0?_++:A++,L.averageScore!==null&&D.push(L.averageScore)}),{averageProgress:w/b.length,completedStudents:k,inProgressStudents:_,notStartedStudents:A,averageScore:D.length>0?D.reduce((R,L)=>R+L,0)/D.length:null}},[b,T,C]),S=w=>C.filter(k=>k.topic_id===w),P=w=>{const k=T.filter(K=>K.activity_id===w),_=b.length,A=k.filter(K=>K.completed_at!==null).length,D=k.length,R=_-D,L=k.filter(K=>K.score!==null&&K.score>0),F=L.length>0?L.reduce((K,q)=>K+q.score,0)/L.length:null;return{totalStudents:_,completedCount:A,startedCount:D,notStartedCount:R,averageScore:F,completionPercentage:_>0?A/_*100:0}};return{group:n?.data,course:r?.data,students:b,topics:v,activities:C,completions:T,quizAttempts:[],courseStats:N,isLoading:g,getStudentProgress:z,getTopicActivities:S,getActivityStats:P}},_C=({stats:t,studentsCount:s})=>e.jsxs(nt,{variant:"2-2-4",children:[e.jsxs(I,{children:[e.jsx(O,{className:"pb-2",children:e.jsxs($,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(st,{className:"w-4 h-4"}),"Średni postęp"]})}),e.jsxs(E,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[t.averageProgress.toFixed(1),"%"]}),e.jsx("div",{className:"mt-2 h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${t.averageProgress}%`}})})]})]}),e.jsxs(I,{children:[e.jsx(O,{className:"pb-2",children:e.jsxs($,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Ai,{className:"w-4 h-4"}),"Ukończyli"]})}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:t.completedStudents}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["z ",s," uczniów"]})]})]}),e.jsxs(I,{children:[e.jsx(O,{className:"pb-2",children:e.jsxs($,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4"}),"W trakcie"]})}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:t.inProgressStudents}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"aktywnych uczniów"})]})]}),e.jsxs(I,{children:[e.jsx(O,{className:"pb-2",children:e.jsxs($,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Bt,{className:"w-4 h-4"}),"Średnia ocen"]})}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.averageScore!==null?`${t.averageScore.toFixed(1)}%`:"—"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"z quizów"})]})]})]}),TC=({students:t,getStudentProgress:s})=>{const n=le(),{groupId:i,courseId:r}=ft(),a=d=>d===100?e.jsx(B,{className:"bg-green-600 hover:bg-green-700",children:"Ukończony"}):d>0?e.jsx(B,{className:"bg-blue-600 hover:bg-blue-700",children:"W trakcie"}):e.jsx(B,{variant:"secondary",children:"Brak"}),o=d=>d===null?e.jsx(Wd,{className:"w-4 h-4 text-muted-foreground"}):d>=80?e.jsx(st,{className:"w-4 h-4 text-green-600"}):d>=60?e.jsx(Wd,{className:"w-4 h-4 text-yellow-600"}):e.jsx(op,{className:"w-4 h-4 text-red-600"}),l=d=>d?new Date(d).toLocaleDateString("pl-PL",{day:"2-digit",month:"2-digit"}):"—",c=d=>{n(`/teacher/groups/${i}/courses/${r}/students/${d}`)};return e.jsx("div",{className:"rounded-md border",children:e.jsxs($s,{children:[e.jsx(qs,{children:e.jsxs(Xe,{children:[e.jsx(ne,{className:"w-[250px]",children:"Uczeń"}),e.jsx(ne,{className:"text-center w-[100px]",children:"Status"}),e.jsx(ne,{className:"text-center w-[100px]",children:"Postęp"}),e.jsx(ne,{className:"text-center w-[120px]",children:"Ukończone"}),e.jsx(ne,{className:"text-center w-[100px]",children:"Średnia"}),e.jsx(ne,{className:"text-center w-[100px]",children:"Ostatnia"}),e.jsx(ne,{className:"text-right w-[120px]",children:"Akcje"})]})}),e.jsx(Fs,{children:t.length===0?e.jsx(Xe,{children:e.jsx(se,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"Brak uczniów w grupie"})}):t.map(d=>{const u=s(d.id);return e.jsxs(Xe,{className:"hover:bg-muted/50",children:[e.jsx(se,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:d.full_name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:d.email})]})}),e.jsx(se,{className:"text-center",children:a(u.progressPercentage)}),e.jsx(se,{children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-16 h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${u.progressPercentage}%`}})}),e.jsxs("span",{className:"text-sm font-medium w-10 text-right",children:[u.progressPercentage.toFixed(0),"%"]})]})}),e.jsx(se,{className:"text-center",children:e.jsxs("span",{className:"text-sm",children:[u.completedCount,"/",u.totalCount]})}),e.jsx(se,{children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[o(u.averageScore),e.jsx("span",{className:"text-sm font-medium",children:u.averageScore!==null?`${u.averageScore.toFixed(0)}%`:"—"})]})}),e.jsx(se,{className:"text-center text-sm",children:l(u.lastActivity)}),e.jsx(se,{className:"text-right",children:e.jsxs(M,{variant:"ghost",size:"sm",onClick:()=>c(d.id),children:["Szczegóły",e.jsx(Ce,{className:"w-4 h-4 ml-1"})]})})]},d.id)})})]})})},AC=({topic:t,topicNumber:s,activities:n,students:i,getActivityStats:r})=>{const[a,o]=f.useState(!1);if(n.length===0)return null;const l=n.reduce((u,m)=>{const h=r(m.id);return u.totalCompleted+=h.completedCount,u.totalPossible+=h.totalStudents,m.type==="quiz"&&h.averageScore!==null&&u.quizScores.push(h.averageScore),u},{totalCompleted:0,totalPossible:0,quizScores:[]}),c=l.totalPossible>0?l.totalCompleted/l.totalPossible*100:0,d=l.quizScores.length>0?l.quizScores.reduce((u,m)=>u+m,0)/l.quizScores.length:null;return e.jsxs("div",{className:"border rounded-lg",children:[e.jsx("button",{onClick:()=>o(!a),className:"w-full p-4 flex items-center justify-between hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3 flex-1 text-left",children:[a?e.jsx(Dt,{className:"w-5 h-5 text-muted-foreground flex-shrink-0"}):e.jsx(Ae,{className:"w-5 h-5 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"font-semibold",children:["Temat ",s,": ",t.title]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-sm text-muted-foreground",children:[e.jsxs("span",{children:[n.length," ",n.length===1?"aktywność":"aktywności"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ai,{className:"w-3 h-3"}),c.toFixed(0),"% ukończonych"]}),d!==null&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Bt,{className:"w-3 h-3"}),"Średnia: ",d.toFixed(0),"%"]})]})]})]})}),a&&e.jsx("div",{className:"p-4 pt-0 space-y-3",children:n.map(u=>{const m=r(u.id),h=u.type==="quiz";return e.jsxs("div",{className:"p-3 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h5",{className:"font-medium text-sm",children:u.title}),e.jsx(B,{variant:"outline",className:"text-xs",children:h?"Quiz":"Materiał"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground mt-2",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:"w-3 h-3"}),m.completedCount,"/",m.totalStudents," ukończyło"]}),m.startedCount>m.completedCount&&e.jsxs("span",{children:[m.startedCount-m.completedCount," w trakcie"]}),m.notStartedCount>0&&e.jsxs("span",{children:[m.notStartedCount," nie rozpoczęło"]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-bold",children:[m.completionPercentage.toFixed(0),"%"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"ukończenia"})]}),h&&m.averageScore!==null&&e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-semibold text-blue-600",children:[m.averageScore.toFixed(0),"%"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"średnia"})]})]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${m.completionPercentage}%`}})})})]},u.id)})})]})},PC=({topics:t,students:s,getTopicActivities:n,getActivityStats:i})=>t.length===0?e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(st,{className:"w-5 h-5"}),"Postęp według tematów"]})}),e.jsx(E,{children:e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Brak tematów w kursie"})})]}):e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(st,{className:"w-5 h-5"}),"Postęp według tematów"]})}),e.jsx(E,{className:"space-y-4",children:t.map((r,a)=>{const o=n(r.id);return e.jsx(AC,{topic:r,topicNumber:a+1,activities:o,students:s,getActivityStats:i},r.id)})})]}),DC=()=>{const{groupId:t,courseId:s}=ft(),n=le(),{group:i,course:r,students:a,topics:o,courseStats:l,isLoading:c,getStudentProgress:d,getTopicActivities:u,getActivityStats:m}=CC(t,s);return c?e.jsx(Z,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):!i||!r?e.jsx(Z,{children:e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Nie znaleziono grupy lub kursu"})})}):e.jsxs(Z,{children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>n(`/teacher/courses/show/${s}`),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Powrót do kursu"]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[r.icon_emoji&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-3xl",children:r.icon_emoji})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:r.title}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsxs(B,{variant:"outline",className:"gap-1",children:[e.jsx(ce,{className:"w-3 h-3"}),"Grupa: ",i.name]}),e.jsxs(B,{variant:"outline",className:"gap-1",children:[e.jsx(xe,{className:"w-3 h-3"}),i.academic_year]})]})]})]})}),e.jsx(_C,{stats:l,studentsCount:a.length}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5"}),"Postępy uczniów (",a.length,")"]})}),e.jsx(E,{children:e.jsx(TC,{students:a,getStudentProgress:d})})]}),e.jsx(PC,{topics:o,students:a,getTopicActivities:h=>u(h),getActivityStats:m})]})},MC={name:"group-activity",list:"/teacher/groups/:groupId/courses/:courseId/activity",meta:{label:"Aktywność grupy",icon:e.jsx(ce,{className:"h-4 w-4"}),hide:!0}},IC=[e.jsx(H,{path:"groups/:groupId/courses/:courseId/activity",element:e.jsx(DC,{})},"group-activity-show")],EC=(t,s,n)=>{const{data:i,isLoading:r}=Le({resource:"users",id:n}),{data:a,isLoading:o}=Le({resource:"groups",id:t}),{data:l,isLoading:c}=Le({resource:"courses",id:s}),{data:d,isLoading:u}=Q({resource:"topics",filters:[{field:"course_id",operator:"eq",value:parseInt(s)}],pagination:{mode:"off"},sorters:[{field:"position",order:"asc"}]}),m=d?.data?.map(_=>_.id)||[],{data:h,isLoading:p}=Q({resource:"activities",filters:m.length>0?[{field:"topic_id",operator:"in",value:m}]:[],pagination:{mode:"off"},sorters:[{field:"position",order:"asc"}],queryOptions:{enabled:m.length>0}}),j=h?.data?.map(_=>_.id)||[],{data:y,isLoading:x}=Q({resource:"activity_progress",filters:j.length>0?[{field:"activity_id",operator:"in",value:j},{field:"user_id",operator:"eq",value:n}]:[],pagination:{mode:"off"},queryOptions:{enabled:j.length>0}}),g=r||o||c||u||p||x,b=i?.data,v=a?.data,C=l?.data,T=d?.data||[],z=h?.data||[],N=y?.data||[],S=f.useMemo(()=>{const _=new Map;return N.forEach(A=>{_.set(A.activity_id,A)}),_},[N]),P=f.useMemo(()=>z.map(_=>({..._,progress:S.get(_.id)||null})),[z,S]),w=f.useMemo(()=>T.map(_=>({..._,activities:P.filter(A=>A.topic_id===_.id)})),[T,P]),k=f.useMemo(()=>{const _=z.length,A=N.filter(q=>q.completed_at!==null).length,D=N.filter(q=>z.find(X=>X.id===q.activity_id)?.type==="quiz"&&q.score!==null),R=D.length>0?D.reduce((q,G)=>q+(G.score||0),0)/D.length:null,L=N.reduce((q,G)=>q+(G.time_spent||0),0),F=N.filter(q=>q.completed_at!==null).sort((q,G)=>new Date(G.completed_at).getTime()-new Date(q.completed_at).getTime())[0],K=_>0?A/_*100:0;return{totalActivities:_,completedActivities:A,progressPercentage:K,averageScore:R,totalTimeSpent:L,lastActivity:F?.completed_at||null,totalQuizzes:z.filter(q=>q.type==="quiz").length,completedQuizzes:D.length}},[z,N]);return{student:b,group:v,course:C,topicsWithActivities:w,overallStats:k,isLoading:g}},LC=({student:t,course:s,group:n,progressPercentage:i})=>{const r=()=>i===100?e.jsx(B,{className:"bg-green-600 hover:bg-green-700",children:"Ukończono kurs"}):i>0?e.jsx(B,{className:"bg-blue-600 hover:bg-blue-700",children:"W trakcie nauki"}):e.jsx(B,{variant:"secondary",children:"Nierozpoczęty"});return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-start gap-6",children:[e.jsx("div",{className:"h-40 w-40 rounded-full bg-muted  flex items-center justify-center flex-shrink-0",children:e.jsx(xr,{className:"h-20 w-20 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-2",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:t.full_name}),e.jsx("p",{className:"text-muted-foreground mt-1",children:t.email})]}),r()]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-3",children:[s.icon_emoji&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-xl",children:s.icon_emoji}),e.jsx("span",{className:"font-medium",children:s.title})]}),!s.icon_emoji&&e.jsxs(B,{variant:"outline",className:"gap-1",children:[e.jsx(xe,{className:"w-3 h-3"}),s.title]}),e.jsxs(B,{variant:"outline",className:"gap-1",children:[e.jsx(ce,{className:"w-3 h-3"}),n.name]}),e.jsx(B,{variant:"outline",children:n.academic_year})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Postęp w kursie"}),e.jsxs("span",{className:"font-semibold",children:[i.toFixed(1),"%"]})]}),e.jsx("div",{className:"h-3 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary transition-all duration-500",style:{width:`${i}%`}})})]})]})]})})},RC=({stats:t})=>{const s=n=>{const i=Math.floor(n/3600),r=Math.floor(n%3600/60);return i>0?`${i}h ${r}m`:`${r} min`};return e.jsxs(nt,{variant:"2-2-4",children:[e.jsxs(I,{children:[e.jsx(O,{className:"pb-2",children:e.jsxs($,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Ai,{className:"w-4 h-4"}),"Ukończone aktywności"]})}),e.jsxs(E,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[t.completedActivities,"/",t.totalActivities]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[t.progressPercentage.toFixed(0),"% kursu"]})]})]}),e.jsxs(I,{children:[e.jsx(O,{className:"pb-2",children:e.jsxs($,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4"}),"Zaliczone quizy"]})}),e.jsxs(E,{children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[t.completedQuizzes,"/",t.totalQuizzes]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t.totalQuizzes>0?`${(t.completedQuizzes/t.totalQuizzes*100).toFixed(0)}% quizów`:"Brak quizów"})]})]}),e.jsxs(I,{children:[e.jsx(O,{className:"pb-2",children:e.jsxs($,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Bt,{className:"w-4 h-4"}),"Średnia z quizów"]})}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.averageScore!==null?`${t.averageScore.toFixed(1)}%`:"—"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t.averageScore!==null?t.averageScore>=70?"Wynik pozytywny":"Wymaga poprawy":"Brak wyników"})]})]}),e.jsxs(I,{children:[e.jsx(O,{className:"pb-2",children:e.jsxs($,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4"}),"Czas nauki"]})}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:s(t.totalTimeSpent)}),t.lastActivity&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground mt-1",children:[e.jsx(At,{className:"w-3 h-3"}),"Ostatnio: ",new Date(t.lastActivity).toLocaleDateString("pl-PL")]})]})]})]})},OC=({activity:t,progress:s,onViewDetails:n})=>{const[i,r]=f.useState(!1);console.log("ActivityDetailRow Debug:",{title:t.title,time_spent:s?.time_spent,type:typeof s?.time_spent,raw_progress:s});const a=o=>{console.log("formatTime called with:",o,typeof o);const l=typeof o=="string"?parseInt(o):o;if(isNaN(l)||l===0)return"0s";const c=Math.floor(l/60);if(c===0)return`${l}s`;if(c<60)return`${c} min`;const d=Math.floor(c/60),u=c%60;return`${d}h ${u}m`};return s?e.jsxs("div",{className:"border rounded-lg hover:bg-muted/30 transition-colors",children:[e.jsxs("button",{onClick:()=>r(!i),className:"w-full p-3 flex items-center gap-3 text-left",children:[i?e.jsx(Dt,{className:"w-4 h-4 text-muted-foreground flex-shrink-0"}):e.jsx(Ae,{className:"w-4 h-4 text-muted-foreground flex-shrink-0"}),s.completed_at?e.jsx(Ai,{className:"w-4 h-4 text-green-600 flex-shrink-0"}):e.jsx(De,{className:"w-4 h-4 text-blue-600 flex-shrink-0"}),t.type==="quiz"?e.jsx(kt,{className:"w-4 h-4 text-muted-foreground flex-shrink-0"}):e.jsx(en,{className:"w-4 h-4 text-muted-foreground flex-shrink-0"}),e.jsx("h4",{className:"font-medium flex-1 min-w-0",children:t.title}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(B,{variant:"outline",className:"text-xs",children:t.type==="quiz"?"Quiz":"Materiał"}),s.completed_at?e.jsx(B,{className:"bg-green-600 hover:bg-green-700",children:"Ukończono"}):e.jsx(B,{className:"bg-blue-600 hover:bg-blue-700",children:"W trakcie"}),s.score!==null&&e.jsxs(B,{variant:s.score>=(t.passing_score||70)?"default":"destructive",className:s.score>=(t.passing_score||70)?"bg-green-600 hover:bg-green-700":"",children:[s.score.toFixed(0),"%"]})]})]}),i&&e.jsxs("div",{className:"px-3 pb-3 pt-0 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs mb-1",children:"Liczba prób"}),e.jsx("div",{className:"font-medium",children:s.attempts})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs mb-1",children:"Czas"}),e.jsx("div",{className:"font-medium",children:a(s.time_spent)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs mb-1",children:"Rozpoczęto"}),e.jsx("div",{className:"font-medium",children:new Date(s.started_at).toLocaleDateString("pl-PL")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs mb-1",children:s.completed_at?"Ukończono":"Status"}),e.jsx("div",{className:"font-medium",children:s.completed_at?new Date(s.completed_at).toLocaleDateString("pl-PL"):"Nieukończone"})]})]}),t.type==="quiz"&&n&&e.jsxs(M,{variant:"outline",size:"sm",onClick:n,children:[e.jsx(en,{className:"w-3 h-3 mr-2"}),"Zobacz szczegóły próby"]})]})]}):e.jsx("div",{className:"p-3 border rounded-lg hover:bg-muted/30 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ir,{className:"w-4 h-4 text-muted-foreground"}),t.type==="quiz"?e.jsx(kt,{className:"w-4 h-4 text-muted-foreground"}):e.jsx(en,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("h4",{className:"font-medium flex-1",children:t.title}),e.jsx(B,{variant:"outline",className:"text-xs",children:t.type==="quiz"?"Quiz":"Materiał"}),e.jsx(B,{variant:"secondary",children:"Brak danych"})]})})},$C=({topics:t,onViewQuizDetails:s})=>{const[n,i]=f.useState(new Set(t.map(o=>o.id))),r=o=>{i(l=>{const c=new Set(l);return c.has(o)?c.delete(o):c.add(o),c})},a=o=>{const l=o.activities.length,c=o.activities.filter(u=>u.progress?.completed_at!==null).length,d=l>0?c/l*100:0;return{total:l,completed:c,percentage:d}};return t.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(xe,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Brak tematów w kursie"})]}):e.jsx("div",{className:"space-y-3",children:t.map((o,l)=>{const c=n.has(o.id),d=a(o);return e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsx("button",{onClick:()=>r(o.id),className:"w-full p-4 flex items-center justify-between hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3 flex-1 text-left",children:[c?e.jsx(Dt,{className:"w-5 h-5 text-muted-foreground flex-shrink-0"}):e.jsx(Ae,{className:"w-5 h-5 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"font-semibold",children:["Temat ",l+1,": ",o.title]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm text-muted-foreground",children:[e.jsxs("span",{children:[o.activities.length," ",o.activities.length===1?"aktywność":"aktywności"]}),e.jsxs("span",{children:["Ukończono: ",d.completed,"/",d.total]})]})]}),e.jsxs("div",{className:"flex-shrink-0 w-24",children:[e.jsxs("div",{className:"text-xs text-muted-foreground mb-1 text-right",children:[d.percentage.toFixed(0),"%"]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${d.percentage}%`}})})]})]})}),c&&e.jsx("div",{className:"p-4 pt-0 space-y-2 bg-muted/20",children:o.activities.length>0?o.activities.map(u=>e.jsx(OC,{activity:u,progress:u.progress,onViewDetails:u.type==="quiz"&&u.progress?()=>s?.(u.id):void 0},u.id)):e.jsx("div",{className:"text-center py-6 text-sm text-muted-foreground",children:"Brak aktywności w tym temacie"})})]},o.id)})})},qC=({open:t,onOpenChange:s,activityId:n,activityTitle:i,lastAttempt:r})=>{const[a,o]=f.useState([]),[l,c]=f.useState(!0);f.useEffect(()=>{if(!t||!n)return;(async()=>{c(!0);try{const{data:j,error:y}=await ee.from("questions").select("id, question, points, position, options").eq("activity_id",n).order("position");if(y)throw y;o(j||[])}catch(j){console.error("Error fetching quiz questions:",j),o([])}finally{c(!1)}})()},[t,n]);const d=p=>{const j=Math.floor(p/60),y=p%60;return`${j}:${String(y).padStart(2,"0")}`};if(!r)return e.jsx(ds,{open:t,onOpenChange:s,children:e.jsxs(Jt,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx(Xt,{children:e.jsx(es,{children:i})}),e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Brak danych o ostatniej próbie"})]})});const u=new Map(r.answers.map(p=>[p.question_id,p.option_id])),m=a.reduce((p,j)=>p+j.points,0),h=a.reduce((p,j)=>{const y=u.get(j.id);if(!y)return p;const g=j.options.find(b=>b.id===y)?.is_correct===!0;return p+(g?j.points:0)},0);return e.jsx(ds,{open:t,onOpenChange:s,children:e.jsxs(Jt,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Xt,{children:[e.jsx(es,{className:"text-xl",children:i}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsxs(B,{variant:"outline",className:"gap-1",children:[e.jsx(De,{className:"w-3 h-3"}),d(r.time)]}),e.jsxs(B,{variant:"outline",className:"gap-1",children:[e.jsx(Bt,{className:"w-3 h-3"}),h,"/",m," pkt"]}),e.jsxs(B,{className:r.score>=70?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700",children:[r.score,"%"]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Data próby: ",new Date(r.date).toLocaleString("pl-PL")]})]}),l?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-4 mt-4",children:[a.map((p,j)=>{const y=u.get(p.id),x=p.options.find(v=>v.id===y),g=p.options.find(v=>v.is_correct),b=x?.is_correct===!0;return e.jsx("div",{className:`p-4 rounded-lg border-2 ${b?"border-green-200 bg-green-50 dark:bg-green-950/20":"border-red-200 bg-red-50 dark:bg-red-950/20"}`,children:e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[b?e.jsx(Pt,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}):e.jsx(Ta,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[e.jsxs("h4",{className:"font-medium",children:["Pytanie ",j+1]}),e.jsxs(B,{variant:"outline",className:"text-xs",children:[b?p.points:0,"/",p.points," pkt"]})]}),e.jsx("p",{className:"text-sm mb-3",children:p.question}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-muted-foreground min-w-[100px]",children:"Odpowiedź ucznia:"}),e.jsx("span",{className:`font-medium ${b?"text-green-700 dark:text-green-400":"text-red-700 dark:text-red-400"}`,children:x?.text||"Brak odpowiedzi"})]}),!b&&g&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-muted-foreground min-w-[100px]",children:"Poprawna odpowiedź:"}),e.jsx("span",{className:"font-medium text-green-700 dark:text-green-400",children:g.text})]})]})]})]})},p.id)}),a.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Brak pytań do wyświetlenia"})]})]})})},FC=()=>{const{groupId:t,courseId:s,studentId:n}=ft(),i=le(),{student:r,group:a,course:o,topicsWithActivities:l,overallStats:c,isLoading:d}=EC(t,s,n),[u,m]=f.useState(!1),[h,p]=f.useState(null),j=y=>{const x=l.flatMap(g=>g.activities).find(g=>g.id===y);x&&x.progress?.last_attempt&&(p({activityId:x.id,activityTitle:x.title,lastAttempt:x.progress.last_attempt}),m(!0))};return d?e.jsx(Z,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):!r||!a||!o?e.jsx(Z,{children:e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Nie znaleziono danych ucznia, grupy lub kursu"})})}):e.jsxs(Z,{children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>i(`/teacher/groups/${t}/courses/${s}/activity`),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Powrót do aktywności grupy"]}),e.jsx(LC,{student:r,course:o,group:a,progressPercentage:c.progressPercentage}),e.jsx(RC,{stats:c}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5"}),"Szczegółowy postęp w kursie"]})}),e.jsx(E,{children:e.jsx($C,{topics:l,onViewQuizDetails:j})})]}),h&&e.jsx(qC,{open:u,onOpenChange:m,activityId:h.activityId,activityTitle:h.activityTitle,lastAttempt:h.lastAttempt})]})},BC={name:"student-course-details",list:"/teacher/groups/:groupId/courses/:courseId/students/:studentId",meta:{label:"Szczegóły ucznia",icon:e.jsx(ip,{className:"h-4 w-4"}),hide:!0}},UC=[e.jsx(H,{path:"groups/:groupId/courses/:courseId/students/:studentId",element:e.jsx(FC,{})},"student-course-details")],VC=[...kz,...H2,...J2,...aC,...SC,...mC,...fC,...NC,...IC,...UC],KC=()=>e.jsx(Za,{children:e.jsxs(H,{element:e.jsx(vz,{children:e.jsx(mc,{})}),children:[e.jsx(H,{index:!0,element:e.jsx(as,{to:"dashboard/overview",replace:!0})}),e.jsx(H,{path:"dashboard",element:e.jsx(as,{to:"dashboard/overview",replace:!0})}),VC]})}),WC=f.lazy(()=>Promise.resolve({default:KC})),wg=({text:t,colorClass:s})=>e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-background",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`inline-block h-12 w-12 animate-spin rounded-full border-4 border-current border-r-transparent ${s}`}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:t})]})}),GC=({children:t})=>{const{data:s,isLoading:n}=Ye();return n||!s?e.jsx(wg,{text:"Sprawdzanie uprawnień...",colorClass:"border-indigo-600"}):["teacher","admin"].includes(s.role)?e.jsx(e.Fragment,{children:t}):e.jsx(as,{to:"/student/dashboard",replace:!0})},HC=e.jsx(H,{path:"/teacher/*",element:e.jsx(fc,{fallback:e.jsx(xc,{to:"/login"}),children:e.jsx(GC,{children:e.jsx(f.Suspense,{fallback:e.jsx(wg,{text:"Ładowanie panelu nauczyciela...",colorClass:"border-indigo-600"}),children:e.jsx(WC,{})})})},"teacher-auth")});class QC{constructor(){ss(this,"stats",{points:0,level:1,streak:0,idle_rate:1,next_level_points:200,quizzes_completed:0,perfect_scores:0,total_time:0,rank:0});ss(this,"listeners",new Set);ss(this,"channel",null);ss(this,"userId",null)}subscribe(s){return this.listeners.add(s),s(this.stats),()=>{this.listeners.delete(s)}}notify(){this.listeners.forEach(s=>s(this.stats))}async fetchStats(s){if(s)try{const{data:n,error:i}=await ee.rpc("get_my_stats");if(i)throw i;n&&(console.log("Fetched stats from DB:",n),this.stats={points:n.points||0,level:n.level||1,streak:n.streak||0,idle_rate:n.idle_rate||1,next_level_points:n.next_level_points||200,quizzes_completed:n.quizzes_completed||0,perfect_scores:n.perfect_scores||0,total_time:n.total_time||0,rank:n.rank||0},this.notify())}catch(n){console.error("Error fetching stats:",n)}}setupSubscription(s){this.userId===s&&this.channel||(this.channel&&this.userId!==s&&(console.log("Closing old subscription for user:",this.userId),ee.removeChannel(this.channel),this.channel=null),this.userId=s,console.log("Setting up global stats subscription for user:",s),this.channel=ee.channel(`global-user-stats-${s}`).on("postgres_changes",{event:"*",schema:"public",table:"user_stats",filter:`user_id=eq.${s}`},n=>{console.log("user_stats change received:",n),this.fetchStats(s)}).on("postgres_changes",{event:"INSERT",schema:"public",table:"gamification_log",filter:`user_id=eq.${s}`},n=>{console.log("gamification_log INSERT received:",n),setTimeout(()=>this.fetchStats(s),300)}).subscribe(n=>{console.log("Global subscription status:",n)}),this.fetchStats(s))}cleanup(){this.channel&&(console.log("Cleaning up global subscription"),ee.removeChannel(this.channel),this.channel=null,this.userId=null)}}const ll=new QC,Bn=()=>{const{data:t}=Ye(),[s,n]=f.useState({points:0,level:1,streak:0,idle_rate:1,next_level_points:200,quizzes_completed:0,perfect_scores:0,total_time:0,rank:0}),[i,r]=f.useState(!0);f.useEffect(()=>t?.id?(ll.setupSubscription(t.id),ll.subscribe(l=>{n(l),r(!1)})):void 0,[t?.id]);const a=f.useCallback(async()=>{t?.id&&(r(!0),await ll.fetchStats(t.id),r(!1))},[t?.id]);return{stats:s,isLoading:i,refetch:a}},Ps=new Map,Qr=(t,s,n)=>{const i=n?.cacheKey||`${t}-${JSON.stringify(s)}`,[r,a]=f.useState(()=>Ps.get(i)||null),[o,l]=f.useState(!Ps.has(i)),[c,d]=f.useState(null),u=f.useCallback(async(h=!1)=>{if(n?.enabled!==!1){if(!h&&Ps.has(i)){a(Ps.get(i)),l(!1);return}try{l(!0),d(null);const{data:p,error:j}=await ee.rpc(t,s);if(j)throw j;Ps.set(i,p),a(p),n?.onSuccess?.(p)}catch(p){d(p),n?.onError?.(p)}finally{l(!1)}}},[t,i,JSON.stringify(s),n?.enabled]);f.useEffect(()=>{u()},[u]);const m=f.useCallback(()=>{Ps.delete(i)},[i]);return{data:r,isLoading:o,error:c,refetch:()=>u(!0),invalidate:m}},cr=t=>{t?Array.from(Ps.keys()).forEach(s=>{s.includes(t)&&Ps.delete(s)}):Ps.clear()},ZC=(t,s)=>{const[n,i]=f.useState([]),[r,a]=f.useState(!0),[o,l]=f.useState(null),c=f.useCallback(async()=>{if(s?.enabled!==!1)try{a(!0),l(null);let d=ee.from(t).select(s?.select||"*");s?.filters?.forEach(h=>{switch(h.operator){case"eq":d=d.eq(h.field,h.value);break;case"in":d=d.in(h.field,h.value);break;case"contains":d=d.ilike(h.field,`%${h.value}%`);break}}),s?.sorts?.forEach(h=>{d=d.order(h.field,{ascending:h.order==="asc"})}),s?.limit&&(d=d.limit(s.limit));const{data:u,error:m}=await d;if(m)throw m;i(u||[])}catch(d){l(d)}finally{a(!1)}},[t,JSON.stringify(s)]);return f.useEffect(()=>{c()},[c]),{data:n,isLoading:r,error:o,refetch:c}},em=({onClose:t,variant:s="sidebar"})=>{const{mutate:n}=Ja(),{data:i}=Ye(),r=ms(),{stats:a}=Bn(),o=[{path:"/student/dashboard",label:"Główna",icon:sp},{path:"/student/gamification",label:"Ulepszenia",icon:kl},{path:"/student/leaderboard",label:"Ranking",icon:Ve},{path:"/student/achievements",label:"Osiągnięcia",icon:Bt},{path:"/student/profile",label:"Profil",icon:xr}],l=()=>{t&&t()};return s==="bottom"?e.jsx("div",{className:"grid grid-cols-5 gap-1 p-1.5",children:o.map(c=>{const d=r.pathname===c.path;return e.jsxs(gi,{to:c.path,className:({isActive:u})=>U("relative flex flex-col items-center justify-center gap-1 rounded-lg p-3 transition-colors",u?"text-primary":"text-muted-foreground hover:text-foreground hover:bg-muted/50"),children:[e.jsx(c.icon,{className:"h-5 w-5"}),e.jsx("span",{className:"text-[11px] font-medium",children:c.label}),d&&e.jsx("i",{"aria-hidden":!0,className:"pointer-events-none absolute inset-x-6 -bottom-[3px] h-1 rounded-full bg-primary/70"})]},c.path)})}):e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsxs("div",{className:"h-16 px-6 border-b relative grid place-items-center justify-start overflow-hidden",children:[e.jsx("i",{"aria-hidden":!0,className:"absolute -right-10 -top-10 w-28 h-28 rounded-3xl bg-gradient-to-br from-primary/10 via-secondary/10 to-accent/10 rotate-45"}),e.jsxs("div",{className:"flex items-center gap-3 relative z-10",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-primary to-secondary text-white grid place-items-center shadow",children:e.jsx(Es,{className:"w-5 h-5"})}),e.jsx("strong",{className:"text-lg",children:"Smart Up"})]}),t&&e.jsx(M,{variant:"ghost",size:"sm",onClick:t,className:"absolute right-4 lg:hidden",children:e.jsx(ls,{className:"h-4 w-4"})})]}),e.jsx("section",{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-primary/10 to-secondary/10 text-primary grid place-items-center font-bold",children:i?.full_name?.charAt(0)||"U"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 rounded-full bg-secondary text-white text-xs grid place-items-center font-bold",children:a.level})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-semibold truncate",children:i?.full_name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Poziom ",a.level," • ",a.streak," dni"]})]})]})}),e.jsx("section",{className:"px-6 -mt-2 mb-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("article",{className:"rounded-xl border p-3 bg-primary/5 border-primary/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ct,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Punkty"})]}),e.jsx("p",{className:"text-lg font-bold",children:Math.floor(a.points)}),e.jsxs("p",{className:"text-xs text-primary",children:["+",a.idle_rate,"/h"]})]}),e.jsxs("article",{className:"rounded-xl border p-3 bg-destructive/5 border-destructive/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(gs,{className:"w-4 h-4 text-destructive"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Seria"})]}),e.jsx("p",{className:"text-lg font-bold",children:a.streak}),e.jsx("p",{className:"text-xs text-destructive",children:"dni z rzędu"})]})]})}),e.jsx(Ze,{className:"flex-1 px-4",children:e.jsx("nav",{className:"space-y-1",children:o.map(c=>e.jsxs(gi,{to:c.path,onClick:l,className:({isActive:d})=>U("relative w-full flex items-center gap-3 px-4 h-11 rounded-xl transition-colors",d?"bg-primary text-primary-foreground":"hover:bg-muted/50 text-muted-foreground hover:text-foreground"),children:[e.jsx(c.icon,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:c.label})]},c.path))})}),e.jsx(lo,{}),e.jsxs("footer",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"px-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground mb-2",children:[e.jsxs("span",{children:["Poziom ",a.level]}),e.jsxs("span",{children:["Poziom ",a.level+1]})]}),e.jsx("div",{className:"h-1.5 rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-gradient-to-r from-primary via-secondary to-accent",style:{width:`${Math.max(0,Math.min(100,a.points%100))}%`}})})]}),e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>{n(),t&&t()},className:"w-full justify-center text-destructive border-destructive/30 bg-destructive/5 hover:bg-destructive/10",children:[e.jsx(no,{className:"mr-2 h-4 w-4"}),"Wyloguj"]})]})]})},YC=()=>e.jsx("div",{"aria-hidden":!0,className:"pointer-events-none fixed inset-0 z-0 overflow-hidden p-0 lg:p-2.5 lg:pb-28 pt-0",children:e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("div",{className:"absolute inset-0 bg-background rounded-3xl"}),e.jsxs("div",{className:"absolute inset-0 rounded-3xl overflow-hidden",children:[e.jsx("div",{className:"absolute w-[50vw] h-[50vh] bottom-0 left-0 translate-y-[25%] -translate-x-[25%] bg-orange rounded-full blur-[150px] opacity-70 dark:opacity-40"}),e.jsx("div",{className:"absolute w-[30vw] h-[30vh] bottom-0 left-1/2 -translate-x-1/2 translate-y-[20%] bg-yellow rounded-full blur-[100px] opacity-60 dark:opacity-30"}),e.jsx("div",{className:"absolute w-[50vw] h-[50vh] bottom-0 right-0 translate-y-[25%] translate-x-[25%] bg-purple rounded-full blur-[150px] opacity-70 dark:opacity-40"})]})]})}),JC=({stats:t,theme:s,onToggleTheme:n})=>{const[i,r]=f.useState(!1),{data:a}=Ye(),{mutate:o}=Ja(),l=f.useMemo(()=>Math.floor(t.points),[t.points]);return e.jsx("header",{className:"sticky top-0 z-30 h-16 bg-card/80 backdrop-blur supports-[backdrop-filter]:bg-card/60 border-b shadow-sm hidden lg:block",children:e.jsxs("div",{className:"mx-auto max-w-6xl h-full px-4 lg:px-8 flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3 min-w-0",children:e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-base sm:text-lg font-semibold truncate",children:"Dashboard"}),e.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:["Witaj, ",a?.full_name?.split(" ")[0],"!"]})]})}),e.jsxs("div",{className:"flex items-center gap-2 lg:gap-3",children:[e.jsxs("button",{className:"relative p-2.5 rounded-xl hover:bg-muted focus-ring h-11 w-11 grid place-items-center","aria-label":"Powiadomienia",children:[e.jsx(Aw,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("span",{className:"absolute top-1.5 right-1.5 w-2 h-2 bg-destructive rounded-full"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 lg:px-4 h-11 rounded-xl border bg-primary/10 border-primary/20",children:[e.jsx(ct,{className:"w-4 h-4 text-primary animate-pulse"}),e.jsx("span",{className:"font-semibold text-sm lg:text-base tabular-nums min-w-[3ch] text-right",children:l.toLocaleString("pl-PL")}),e.jsxs("span",{className:"hidden md:block text-xs text-primary",children:["+",t.idle_rate,"/h"]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>r(!i),className:"flex items-center gap-2 px-1.5 h-11 rounded-xl hover:bg-muted focus-ring","aria-haspopup":"menu","aria-expanded":i,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-9 h-9 lg:w-10 lg:h-10 rounded-xl bg-gradient-to-br from-primary to-secondary text-white grid place-items-center font-bold",children:a?.full_name?.charAt(0)||"U"}),e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-4 h-4 lg:w-5 lg:h-5 rounded-full bg-accent text-white text-[10px] lg:text-xs grid place-items-center border-2 border-card",children:t.level})]}),e.jsx(Dt,{className:"w-4 h-4 text-muted-foreground"})]}),i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>r(!1),"aria-hidden":"true"}),e.jsxs("menu",{className:"absolute right-0 mt-2 w-64 bg-card rounded-xl border shadow-soft-lg z-50 overflow-hidden",children:[e.jsxs("section",{className:"p-4 border-b",children:[e.jsx("p",{className:"font-semibold truncate",children:a?.full_name}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:a?.email})]}),e.jsxs("ul",{className:"p-2",children:[e.jsx("li",{children:e.jsxs("button",{onClick:()=>{n(),r(!1)},className:"w-full flex items-center gap-3 px-3 h-11 rounded-lg text-foreground/80 hover:text-foreground hover:bg-muted transition-colors",children:[s==="dark"?e.jsx(Pw,{className:"w-4 h-4"}):e.jsx(Dw,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:s==="dark"?"Tryb jasny":"Tryb ciemny"})]})}),e.jsx("li",{children:e.jsxs("button",{onClick:()=>{window.location.href="/student/profile",r(!1)},className:"w-full flex items-center gap-3 px-3 h-11 rounded-lg text-foreground/80 hover:text-foreground hover:bg-muted transition-colors",children:[e.jsx(xr,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Profil"})]})}),e.jsx("li",{children:e.jsxs("button",{onClick:()=>{o(),r(!1)},className:"w-full flex items-center gap-3 px-3 h-11 rounded-lg text-destructive hover:bg-destructive/10 transition-colors",children:[e.jsx(no,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Wyloguj"})]})})]})]})]})]})]})]})})},XC=({children:t})=>{const[s,n]=f.useState(!1),[i,r]=f.useState(()=>{const c=localStorage.getItem("theme");return c==="light"||c==="dark"?c:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}),{stats:a}=Bn();f.useEffect(()=>{document.documentElement.classList.toggle("dark",i==="dark"),localStorage.setItem("theme",i)},[i]);const o=()=>{r(i==="dark"?"light":"dark")},l=()=>{n(!s)};return e.jsxs("div",{className:"min-h-screen bg-background relative overflow-x-hidden",children:[e.jsx(YC,{}),e.jsxs("div",{className:"flex relative",children:[s&&e.jsx("div",{className:"fixed inset-0 z-40 bg-black/30 dark:bg-black/50 backdrop-blur-sm lg:hidden",onClick:()=>n(!1)}),e.jsx("aside",{className:`
            h-screen w-80 transform transition-transform duration-300 ease-in-out
            fixed left-0 top-0 z-50
            ${s?"translate-x-0":"-translate-x-full"}
            lg:translate-x-0 lg:w-72
            bg-card/95 backdrop-blur-xl border-r
          `,children:e.jsx(em,{onClose:()=>n(!1)})}),e.jsxs("main",{className:"flex-1 lg:ml-72 min-w-0 relative z-10",children:[e.jsx("div",{className:"fixed top-0 left-72 right-0 z-30 hidden lg:block",children:e.jsx(JC,{stats:a,theme:i,onToggleTheme:o})}),e.jsxs("div",{className:"sticky top-0 z-30 flex h-16 items-center border-b bg-card/80 backdrop-blur supports-[backdrop-filter]:bg-card/60 px-4 lg:hidden",children:[e.jsx(M,{variant:"ghost",size:"sm",onClick:l,className:"mr-2",children:e.jsx(Or,{className:"h-6 w-6"})}),e.jsx("span",{className:"font-semibold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",children:"Smart Up"})]}),e.jsx("div",{className:"min-h-[calc(100vh-4rem)] pb-32 lg:pb-24 lg:pt-16",children:t})]})]}),e.jsx("nav",{"aria-label":"Nawigacja dolna",className:"fixed py-3.5 bottom-0 z-40 left-0 right-0 lg:left-72 bg-card/95 backdrop-blur-xl border-t",children:e.jsx(em,{variant:"bottom"})})]})},nd=f.createContext({});function id(t){const s=f.useRef(null);return s.current===null&&(s.current=t()),s.current}const rd=typeof window<"u",bg=rd?f.useLayoutEffect:f.useEffect,Io=f.createContext(null);function ad(t,s){t.indexOf(s)===-1&&t.push(s)}function od(t,s){const n=t.indexOf(s);n>-1&&t.splice(n,1)}const Ls=(t,s,n)=>n>s?s:n<t?t:n;let ld=()=>{};const Rs={},vg=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t);function Ng(t){return typeof t=="object"&&t!==null}const kg=t=>/^0[^.\s]+$/u.test(t);function cd(t){let s;return()=>(s===void 0&&(s=t()),s)}const Yt=t=>t,e_=(t,s)=>n=>s(t(n)),Zr=(...t)=>t.reduce(e_),Ar=(t,s,n)=>{const i=s-t;return i===0?1:(n-t)/i};class dd{constructor(){this.subscriptions=[]}add(s){return ad(this.subscriptions,s),()=>od(this.subscriptions,s)}notify(s,n,i){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](s,n,i);else for(let a=0;a<r;a++){const o=this.subscriptions[a];o&&o(s,n,i)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const ws=t=>t*1e3,bs=t=>t/1e3;function zg(t,s){return s?t*(1e3/s):0}const Sg=(t,s,n)=>(((1-3*n+3*s)*t+(3*n-6*s))*t+3*s)*t,t_=1e-7,s_=12;function n_(t,s,n,i,r){let a,o,l=0;do o=s+(n-s)/2,a=Sg(o,i,r)-t,a>0?n=o:s=o;while(Math.abs(a)>t_&&++l<s_);return o}function Yr(t,s,n,i){if(t===s&&n===i)return Yt;const r=a=>n_(a,0,1,t,n);return a=>a===0||a===1?a:Sg(r(a),s,i)}const Cg=t=>s=>s<=.5?t(2*s)/2:(2-t(2*(1-s)))/2,_g=t=>s=>1-t(1-s),Tg=Yr(.33,1.53,.69,.99),ud=_g(Tg),Ag=Cg(ud),Pg=t=>(t*=2)<1?.5*ud(t):.5*(2-Math.pow(2,-10*(t-1))),md=t=>1-Math.sin(Math.acos(t)),Dg=_g(md),Mg=Cg(md),i_=Yr(.42,0,1,1),r_=Yr(0,0,.58,1),Ig=Yr(.42,0,.58,1),a_=t=>Array.isArray(t)&&typeof t[0]!="number",Eg=t=>Array.isArray(t)&&typeof t[0]=="number",o_={linear:Yt,easeIn:i_,easeInOut:Ig,easeOut:r_,circIn:md,circInOut:Mg,circOut:Dg,backIn:ud,backInOut:Ag,backOut:Tg,anticipate:Pg},l_=t=>typeof t=="string",tm=t=>{if(Eg(t)){ld(t.length===4);const[s,n,i,r]=t;return Yr(s,n,i,r)}else if(l_(t))return o_[t];return t},ua=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function c_(t,s){let n=new Set,i=new Set,r=!1,a=!1;const o=new WeakSet;let l={delta:0,timestamp:0,isProcessing:!1};function c(u){o.has(u)&&(d.schedule(u),t()),u(l)}const d={schedule:(u,m=!1,h=!1)=>{const j=h&&r?n:i;return m&&o.add(u),j.has(u)||j.add(u),u},cancel:u=>{i.delete(u),o.delete(u)},process:u=>{if(l=u,r){a=!0;return}r=!0,[n,i]=[i,n],n.forEach(c),n.clear(),r=!1,a&&(a=!1,d.process(u))}};return d}const d_=40;function Lg(t,s){let n=!1,i=!0;const r={delta:0,timestamp:0,isProcessing:!1},a=()=>n=!0,o=ua.reduce((v,C)=>(v[C]=c_(a),v),{}),{setup:l,read:c,resolveKeyframes:d,preUpdate:u,update:m,preRender:h,render:p,postRender:j}=o,y=()=>{const v=Rs.useManualTiming?r.timestamp:performance.now();n=!1,Rs.useManualTiming||(r.delta=i?1e3/60:Math.max(Math.min(v-r.timestamp,d_),1)),r.timestamp=v,r.isProcessing=!0,l.process(r),c.process(r),d.process(r),u.process(r),m.process(r),h.process(r),p.process(r),j.process(r),r.isProcessing=!1,n&&s&&(i=!1,t(y))},x=()=>{n=!0,i=!0,r.isProcessing||t(y)};return{schedule:ua.reduce((v,C)=>{const T=o[C];return v[C]=(z,N=!1,S=!1)=>(n||x(),T.schedule(z,N,S)),v},{}),cancel:v=>{for(let C=0;C<ua.length;C++)o[ua[C]].cancel(v)},state:r,steps:o}}const{schedule:Pe,cancel:an,state:at,steps:cl}=Lg(typeof requestAnimationFrame<"u"?requestAnimationFrame:Yt,!0);let ba;function u_(){ba=void 0}const _t={now:()=>(ba===void 0&&_t.set(at.isProcessing||Rs.useManualTiming?at.timestamp:performance.now()),ba),set:t=>{ba=t,queueMicrotask(u_)}},Rg=t=>s=>typeof s=="string"&&s.startsWith(t),hd=Rg("--"),m_=Rg("var(--"),pd=t=>m_(t)?h_.test(t.split("/*")[0].trim()):!1,h_=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,qi={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},Pr={...qi,transform:t=>Ls(0,1,t)},ma={...qi,default:1},dr=t=>Math.round(t*1e5)/1e5,fd=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function p_(t){return t==null}const f_=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,xd=(t,s)=>n=>!!(typeof n=="string"&&f_.test(n)&&n.startsWith(t)||s&&!p_(n)&&Object.prototype.hasOwnProperty.call(n,s)),Og=(t,s,n)=>i=>{if(typeof i!="string")return i;const[r,a,o,l]=i.match(fd);return{[t]:parseFloat(r),[s]:parseFloat(a),[n]:parseFloat(o),alpha:l!==void 0?parseFloat(l):1}},x_=t=>Ls(0,255,t),dl={...qi,transform:t=>Math.round(x_(t))},vn={test:xd("rgb","red"),parse:Og("red","green","blue"),transform:({red:t,green:s,blue:n,alpha:i=1})=>"rgba("+dl.transform(t)+", "+dl.transform(s)+", "+dl.transform(n)+", "+dr(Pr.transform(i))+")"};function g_(t){let s="",n="",i="",r="";return t.length>5?(s=t.substring(1,3),n=t.substring(3,5),i=t.substring(5,7),r=t.substring(7,9)):(s=t.substring(1,2),n=t.substring(2,3),i=t.substring(3,4),r=t.substring(4,5),s+=s,n+=n,i+=i,r+=r),{red:parseInt(s,16),green:parseInt(n,16),blue:parseInt(i,16),alpha:r?parseInt(r,16)/255:1}}const Ul={test:xd("#"),parse:g_,transform:vn.transform},Jr=t=>({test:s=>typeof s=="string"&&s.endsWith(t)&&s.split(" ").length===1,parse:parseFloat,transform:s=>`${s}${t}`}),Hs=Jr("deg"),vs=Jr("%"),te=Jr("px"),j_=Jr("vh"),y_=Jr("vw"),sm={...vs,parse:t=>vs.parse(t)/100,transform:t=>vs.transform(t*100)},ai={test:xd("hsl","hue"),parse:Og("hue","saturation","lightness"),transform:({hue:t,saturation:s,lightness:n,alpha:i=1})=>"hsla("+Math.round(t)+", "+vs.transform(dr(s))+", "+vs.transform(dr(n))+", "+dr(Pr.transform(i))+")"},Ge={test:t=>vn.test(t)||Ul.test(t)||ai.test(t),parse:t=>vn.test(t)?vn.parse(t):ai.test(t)?ai.parse(t):Ul.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?vn.transform(t):ai.transform(t),getAnimatableNone:t=>{const s=Ge.parse(t);return s.alpha=0,Ge.transform(s)}},w_=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function b_(t){return isNaN(t)&&typeof t=="string"&&(t.match(fd)?.length||0)+(t.match(w_)?.length||0)>0}const $g="number",qg="color",v_="var",N_="var(",nm="${}",k_=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Dr(t){const s=t.toString(),n=[],i={color:[],number:[],var:[]},r=[];let a=0;const l=s.replace(k_,c=>(Ge.test(c)?(i.color.push(a),r.push(qg),n.push(Ge.parse(c))):c.startsWith(N_)?(i.var.push(a),r.push(v_),n.push(c)):(i.number.push(a),r.push($g),n.push(parseFloat(c))),++a,nm)).split(nm);return{values:n,split:l,indexes:i,types:r}}function Fg(t){return Dr(t).values}function Bg(t){const{split:s,types:n}=Dr(t),i=s.length;return r=>{let a="";for(let o=0;o<i;o++)if(a+=s[o],r[o]!==void 0){const l=n[o];l===$g?a+=dr(r[o]):l===qg?a+=Ge.transform(r[o]):a+=r[o]}return a}}const z_=t=>typeof t=="number"?0:Ge.test(t)?Ge.getAnimatableNone(t):t;function S_(t){const s=Fg(t);return Bg(t)(s.map(z_))}const on={test:b_,parse:Fg,createTransformer:Bg,getAnimatableNone:S_};function ul(t,s,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(s-t)*6*n:n<1/2?s:n<2/3?t+(s-t)*(2/3-n)*6:t}function C_({hue:t,saturation:s,lightness:n,alpha:i}){t/=360,s/=100,n/=100;let r=0,a=0,o=0;if(!s)r=a=o=n;else{const l=n<.5?n*(1+s):n+s-n*s,c=2*n-l;r=ul(c,l,t+1/3),a=ul(c,l,t),o=ul(c,l,t-1/3)}return{red:Math.round(r*255),green:Math.round(a*255),blue:Math.round(o*255),alpha:i}}function Ua(t,s){return n=>n>0?s:t}const Ee=(t,s,n)=>t+(s-t)*n,ml=(t,s,n)=>{const i=t*t,r=n*(s*s-i)+i;return r<0?0:Math.sqrt(r)},__=[Ul,vn,ai],T_=t=>__.find(s=>s.test(t));function im(t){const s=T_(t);if(!s)return!1;let n=s.parse(t);return s===ai&&(n=C_(n)),n}const rm=(t,s)=>{const n=im(t),i=im(s);if(!n||!i)return Ua(t,s);const r={...n};return a=>(r.red=ml(n.red,i.red,a),r.green=ml(n.green,i.green,a),r.blue=ml(n.blue,i.blue,a),r.alpha=Ee(n.alpha,i.alpha,a),vn.transform(r))},Vl=new Set(["none","hidden"]);function A_(t,s){return Vl.has(t)?n=>n<=0?t:s:n=>n>=1?s:t}function P_(t,s){return n=>Ee(t,s,n)}function gd(t){return typeof t=="number"?P_:typeof t=="string"?pd(t)?Ua:Ge.test(t)?rm:I_:Array.isArray(t)?Ug:typeof t=="object"?Ge.test(t)?rm:D_:Ua}function Ug(t,s){const n=[...t],i=n.length,r=t.map((a,o)=>gd(a)(a,s[o]));return a=>{for(let o=0;o<i;o++)n[o]=r[o](a);return n}}function D_(t,s){const n={...t,...s},i={};for(const r in n)t[r]!==void 0&&s[r]!==void 0&&(i[r]=gd(t[r])(t[r],s[r]));return r=>{for(const a in i)n[a]=i[a](r);return n}}function M_(t,s){const n=[],i={color:0,var:0,number:0};for(let r=0;r<s.values.length;r++){const a=s.types[r],o=t.indexes[a][i[a]],l=t.values[o]??0;n[r]=l,i[a]++}return n}const I_=(t,s)=>{const n=on.createTransformer(s),i=Dr(t),r=Dr(s);return i.indexes.var.length===r.indexes.var.length&&i.indexes.color.length===r.indexes.color.length&&i.indexes.number.length>=r.indexes.number.length?Vl.has(t)&&!r.values.length||Vl.has(s)&&!i.values.length?A_(t,s):Zr(Ug(M_(i,r),r.values),n):Ua(t,s)};function Vg(t,s,n){return typeof t=="number"&&typeof s=="number"&&typeof n=="number"?Ee(t,s,n):gd(t)(t,s)}const E_=t=>{const s=({timestamp:n})=>t(n);return{start:(n=!0)=>Pe.update(s,n),stop:()=>an(s),now:()=>at.isProcessing?at.timestamp:_t.now()}},Kg=(t,s,n=10)=>{let i="";const r=Math.max(Math.round(s/n),2);for(let a=0;a<r;a++)i+=Math.round(t(a/(r-1))*1e4)/1e4+", ";return`linear(${i.substring(0,i.length-2)})`},Va=2e4;function jd(t){let s=0;const n=50;let i=t.next(s);for(;!i.done&&s<Va;)s+=n,i=t.next(s);return s>=Va?1/0:s}function L_(t,s=100,n){const i=n({...t,keyframes:[0,s]}),r=Math.min(jd(i),Va);return{type:"keyframes",ease:a=>i.next(r*a).value/s,duration:bs(r)}}const R_=5;function Wg(t,s,n){const i=Math.max(s-R_,0);return zg(n-t(i),s-i)}const $e={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},hl=.001;function O_({duration:t=$e.duration,bounce:s=$e.bounce,velocity:n=$e.velocity,mass:i=$e.mass}){let r,a,o=1-s;o=Ls($e.minDamping,$e.maxDamping,o),t=Ls($e.minDuration,$e.maxDuration,bs(t)),o<1?(r=d=>{const u=d*o,m=u*t,h=u-n,p=Kl(d,o),j=Math.exp(-m);return hl-h/p*j},a=d=>{const m=d*o*t,h=m*n+n,p=Math.pow(o,2)*Math.pow(d,2)*t,j=Math.exp(-m),y=Kl(Math.pow(d,2),o);return(-r(d)+hl>0?-1:1)*((h-p)*j)/y}):(r=d=>{const u=Math.exp(-d*t),m=(d-n)*t+1;return-hl+u*m},a=d=>{const u=Math.exp(-d*t),m=(n-d)*(t*t);return u*m});const l=5/t,c=q_(r,a,l);if(t=ws(t),isNaN(c))return{stiffness:$e.stiffness,damping:$e.damping,duration:t};{const d=Math.pow(c,2)*i;return{stiffness:d,damping:o*2*Math.sqrt(i*d),duration:t}}}const $_=12;function q_(t,s,n){let i=n;for(let r=1;r<$_;r++)i=i-t(i)/s(i);return i}function Kl(t,s){return t*Math.sqrt(1-s*s)}const F_=["duration","bounce"],B_=["stiffness","damping","mass"];function am(t,s){return s.some(n=>t[n]!==void 0)}function U_(t){let s={velocity:$e.velocity,stiffness:$e.stiffness,damping:$e.damping,mass:$e.mass,isResolvedFromDuration:!1,...t};if(!am(t,B_)&&am(t,F_))if(t.visualDuration){const n=t.visualDuration,i=2*Math.PI/(n*1.2),r=i*i,a=2*Ls(.05,1,1-(t.bounce||0))*Math.sqrt(r);s={...s,mass:$e.mass,stiffness:r,damping:a}}else{const n=O_(t);s={...s,...n,mass:$e.mass},s.isResolvedFromDuration=!0}return s}function Ka(t=$e.visualDuration,s=$e.bounce){const n=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:s}:t;let{restSpeed:i,restDelta:r}=n;const a=n.keyframes[0],o=n.keyframes[n.keyframes.length-1],l={done:!1,value:a},{stiffness:c,damping:d,mass:u,duration:m,velocity:h,isResolvedFromDuration:p}=U_({...n,velocity:-bs(n.velocity||0)}),j=h||0,y=d/(2*Math.sqrt(c*u)),x=o-a,g=bs(Math.sqrt(c/u)),b=Math.abs(x)<5;i||(i=b?$e.restSpeed.granular:$e.restSpeed.default),r||(r=b?$e.restDelta.granular:$e.restDelta.default);let v;if(y<1){const T=Kl(g,y);v=z=>{const N=Math.exp(-y*g*z);return o-N*((j+y*g*x)/T*Math.sin(T*z)+x*Math.cos(T*z))}}else if(y===1)v=T=>o-Math.exp(-g*T)*(x+(j+g*x)*T);else{const T=g*Math.sqrt(y*y-1);v=z=>{const N=Math.exp(-y*g*z),S=Math.min(T*z,300);return o-N*((j+y*g*x)*Math.sinh(S)+T*x*Math.cosh(S))/T}}const C={calculatedDuration:p&&m||null,next:T=>{const z=v(T);if(p)l.done=T>=m;else{let N=T===0?j:0;y<1&&(N=T===0?ws(j):Wg(v,T,z));const S=Math.abs(N)<=i,P=Math.abs(o-z)<=r;l.done=S&&P}return l.value=l.done?o:z,l},toString:()=>{const T=Math.min(jd(C),Va),z=Kg(N=>C.next(T*N).value,T,30);return T+"ms "+z},toTransition:()=>{}};return C}Ka.applyToOptions=t=>{const s=L_(t,100,Ka);return t.ease=s.ease,t.duration=ws(s.duration),t.type="keyframes",t};function Wl({keyframes:t,velocity:s=0,power:n=.8,timeConstant:i=325,bounceDamping:r=10,bounceStiffness:a=500,modifyTarget:o,min:l,max:c,restDelta:d=.5,restSpeed:u}){const m=t[0],h={done:!1,value:m},p=S=>l!==void 0&&S<l||c!==void 0&&S>c,j=S=>l===void 0?c:c===void 0||Math.abs(l-S)<Math.abs(c-S)?l:c;let y=n*s;const x=m+y,g=o===void 0?x:o(x);g!==x&&(y=g-m);const b=S=>-y*Math.exp(-S/i),v=S=>g+b(S),C=S=>{const P=b(S),w=v(S);h.done=Math.abs(P)<=d,h.value=h.done?g:w};let T,z;const N=S=>{p(h.value)&&(T=S,z=Ka({keyframes:[h.value,j(h.value)],velocity:Wg(v,S,h.value),damping:r,stiffness:a,restDelta:d,restSpeed:u}))};return N(0),{calculatedDuration:null,next:S=>{let P=!1;return!z&&T===void 0&&(P=!0,C(S),N(S)),T!==void 0&&S>=T?z.next(S-T):(!P&&C(S),h)}}}function V_(t,s,n){const i=[],r=n||Rs.mix||Vg,a=t.length-1;for(let o=0;o<a;o++){let l=r(t[o],t[o+1]);if(s){const c=Array.isArray(s)?s[o]||Yt:s;l=Zr(c,l)}i.push(l)}return i}function K_(t,s,{clamp:n=!0,ease:i,mixer:r}={}){const a=t.length;if(ld(a===s.length),a===1)return()=>s[0];if(a===2&&s[0]===s[1])return()=>s[1];const o=t[0]===t[1];t[0]>t[a-1]&&(t=[...t].reverse(),s=[...s].reverse());const l=V_(s,i,r),c=l.length,d=u=>{if(o&&u<t[0])return s[0];let m=0;if(c>1)for(;m<t.length-2&&!(u<t[m+1]);m++);const h=Ar(t[m],t[m+1],u);return l[m](h)};return n?u=>d(Ls(t[0],t[a-1],u)):d}function W_(t,s){const n=t[t.length-1];for(let i=1;i<=s;i++){const r=Ar(0,s,i);t.push(Ee(n,1,r))}}function G_(t){const s=[0];return W_(s,t.length-1),s}function H_(t,s){return t.map(n=>n*s)}function Q_(t,s){return t.map(()=>s||Ig).splice(0,t.length-1)}function ur({duration:t=300,keyframes:s,times:n,ease:i="easeInOut"}){const r=a_(i)?i.map(tm):tm(i),a={done:!1,value:s[0]},o=H_(n&&n.length===s.length?n:G_(s),t),l=K_(o,s,{ease:Array.isArray(r)?r:Q_(s,r)});return{calculatedDuration:t,next:c=>(a.value=l(c),a.done=c>=t,a)}}const Z_=t=>t!==null;function yd(t,{repeat:s,repeatType:n="loop"},i,r=1){const a=t.filter(Z_),l=r<0||s&&n!=="loop"&&s%2===1?0:a.length-1;return!l||i===void 0?a[l]:i}const Y_={decay:Wl,inertia:Wl,tween:ur,keyframes:ur,spring:Ka};function Gg(t){typeof t.type=="string"&&(t.type=Y_[t.type])}class wd{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(s=>{this.resolve=s})}notifyFinished(){this.resolve()}then(s,n){return this.finished.then(s,n)}}const J_=t=>t/100;class bd extends wd{constructor(s){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:n}=this.options;n&&n.updatedAt!==_t.now()&&this.tick(_t.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=s,this.initAnimation(),this.play(),s.autoplay===!1&&this.pause()}initAnimation(){const{options:s}=this;Gg(s);const{type:n=ur,repeat:i=0,repeatDelay:r=0,repeatType:a,velocity:o=0}=s;let{keyframes:l}=s;const c=n||ur;c!==ur&&typeof l[0]!="number"&&(this.mixKeyframes=Zr(J_,Vg(l[0],l[1])),l=[0,100]);const d=c({...s,keyframes:l});a==="mirror"&&(this.mirroredGenerator=c({...s,keyframes:[...l].reverse(),velocity:-o})),d.calculatedDuration===null&&(d.calculatedDuration=jd(d));const{calculatedDuration:u}=d;this.calculatedDuration=u,this.resolvedDuration=u+r,this.totalDuration=this.resolvedDuration*(i+1)-r,this.generator=d}updateTime(s){const n=Math.round(s-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=n}tick(s,n=!1){const{generator:i,totalDuration:r,mixKeyframes:a,mirroredGenerator:o,resolvedDuration:l,calculatedDuration:c}=this;if(this.startTime===null)return i.next(0);const{delay:d=0,keyframes:u,repeat:m,repeatType:h,repeatDelay:p,type:j,onUpdate:y,finalKeyframe:x}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,s):this.speed<0&&(this.startTime=Math.min(s-r/this.speed,this.startTime)),n?this.currentTime=s:this.updateTime(s);const g=this.currentTime-d*(this.playbackSpeed>=0?1:-1),b=this.playbackSpeed>=0?g<0:g>r;this.currentTime=Math.max(g,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=r);let v=this.currentTime,C=i;if(m){const S=Math.min(this.currentTime,r)/l;let P=Math.floor(S),w=S%1;!w&&S>=1&&(w=1),w===1&&P--,P=Math.min(P,m+1),!!(P%2)&&(h==="reverse"?(w=1-w,p&&(w-=p/l)):h==="mirror"&&(C=o)),v=Ls(0,1,w)*l}const T=b?{done:!1,value:u[0]}:C.next(v);a&&(T.value=a(T.value));let{done:z}=T;!b&&c!==null&&(z=this.playbackSpeed>=0?this.currentTime>=r:this.currentTime<=0);const N=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&z);return N&&j!==Wl&&(T.value=yd(u,this.options,x,this.speed)),y&&y(T.value),N&&this.finish(),T}then(s,n){return this.finished.then(s,n)}get duration(){return bs(this.calculatedDuration)}get time(){return bs(this.currentTime)}set time(s){s=ws(s),this.currentTime=s,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=s:this.driver&&(this.startTime=this.driver.now()-s/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(s){this.updateTime(_t.now());const n=this.playbackSpeed!==s;this.playbackSpeed=s,n&&(this.time=bs(this.currentTime))}play(){if(this.isStopped)return;const{driver:s=E_,startTime:n}=this.options;this.driver||(this.driver=s(r=>this.tick(r))),this.options.onPlay?.();const i=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=i):this.holdTime!==null?this.startTime=i-this.holdTime:this.startTime||(this.startTime=n??i),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(_t.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(s){return this.startTime=0,this.tick(s,!0)}attachTimeline(s){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),s.observe(this)}}function X_(t){for(let s=1;s<t.length;s++)t[s]??(t[s]=t[s-1])}const Nn=t=>t*180/Math.PI,Gl=t=>{const s=Nn(Math.atan2(t[1],t[0]));return Hl(s)},e4={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:t=>(Math.abs(t[0])+Math.abs(t[3]))/2,rotate:Gl,rotateZ:Gl,skewX:t=>Nn(Math.atan(t[1])),skewY:t=>Nn(Math.atan(t[2])),skew:t=>(Math.abs(t[1])+Math.abs(t[2]))/2},Hl=t=>(t=t%360,t<0&&(t+=360),t),om=Gl,lm=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),cm=t=>Math.sqrt(t[4]*t[4]+t[5]*t[5]),t4={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:lm,scaleY:cm,scale:t=>(lm(t)+cm(t))/2,rotateX:t=>Hl(Nn(Math.atan2(t[6],t[5]))),rotateY:t=>Hl(Nn(Math.atan2(-t[2],t[0]))),rotateZ:om,rotate:om,skewX:t=>Nn(Math.atan(t[4])),skewY:t=>Nn(Math.atan(t[1])),skew:t=>(Math.abs(t[1])+Math.abs(t[4]))/2};function Ql(t){return t.includes("scale")?1:0}function Zl(t,s){if(!t||t==="none")return Ql(s);const n=t.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let i,r;if(n)i=t4,r=n;else{const l=t.match(/^matrix\(([-\d.e\s,]+)\)$/u);i=e4,r=l}if(!r)return Ql(s);const a=i[s],o=r[1].split(",").map(n4);return typeof a=="function"?a(o):o[a]}const s4=(t,s)=>{const{transform:n="none"}=getComputedStyle(t);return Zl(n,s)};function n4(t){return parseFloat(t.trim())}const Fi=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Bi=new Set(Fi),dm=t=>t===qi||t===te,i4=new Set(["x","y","z"]),r4=Fi.filter(t=>!i4.has(t));function a4(t){const s=[];return r4.forEach(n=>{const i=t.getValue(n);i!==void 0&&(s.push([n,i.get()]),i.set(n.startsWith("scale")?1:0))}),s}const kn={width:({x:t},{paddingLeft:s="0",paddingRight:n="0"})=>t.max-t.min-parseFloat(s)-parseFloat(n),height:({y:t},{paddingTop:s="0",paddingBottom:n="0"})=>t.max-t.min-parseFloat(s)-parseFloat(n),top:(t,{top:s})=>parseFloat(s),left:(t,{left:s})=>parseFloat(s),bottom:({y:t},{top:s})=>parseFloat(s)+(t.max-t.min),right:({x:t},{left:s})=>parseFloat(s)+(t.max-t.min),x:(t,{transform:s})=>Zl(s,"x"),y:(t,{transform:s})=>Zl(s,"y")};kn.translateX=kn.x;kn.translateY=kn.y;const zn=new Set;let Yl=!1,Jl=!1,Xl=!1;function Hg(){if(Jl){const t=Array.from(zn).filter(i=>i.needsMeasurement),s=new Set(t.map(i=>i.element)),n=new Map;s.forEach(i=>{const r=a4(i);r.length&&(n.set(i,r),i.render())}),t.forEach(i=>i.measureInitialState()),s.forEach(i=>{i.render();const r=n.get(i);r&&r.forEach(([a,o])=>{i.getValue(a)?.set(o)})}),t.forEach(i=>i.measureEndState()),t.forEach(i=>{i.suspendedScrollY!==void 0&&window.scrollTo(0,i.suspendedScrollY)})}Jl=!1,Yl=!1,zn.forEach(t=>t.complete(Xl)),zn.clear()}function Qg(){zn.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(Jl=!0)})}function o4(){Xl=!0,Qg(),Hg(),Xl=!1}class vd{constructor(s,n,i,r,a,o=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...s],this.onComplete=n,this.name=i,this.motionValue=r,this.element=a,this.isAsync=o}scheduleResolve(){this.state="scheduled",this.isAsync?(zn.add(this),Yl||(Yl=!0,Pe.read(Qg),Pe.resolveKeyframes(Hg))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:s,name:n,element:i,motionValue:r}=this;if(s[0]===null){const a=r?.get(),o=s[s.length-1];if(a!==void 0)s[0]=a;else if(i&&n){const l=i.readValue(n,o);l!=null&&(s[0]=l)}s[0]===void 0&&(s[0]=o),r&&a===void 0&&r.set(s[0])}X_(s)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(s=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,s),zn.delete(this)}cancel(){this.state==="scheduled"&&(zn.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const l4=t=>t.startsWith("--");function c4(t,s,n){l4(s)?t.style.setProperty(s,n):t.style[s]=n}const d4=cd(()=>window.ScrollTimeline!==void 0),u4={};function m4(t,s){const n=cd(t);return()=>u4[s]??n()}const Zg=m4(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),nr=([t,s,n,i])=>`cubic-bezier(${t}, ${s}, ${n}, ${i})`,um={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:nr([0,.65,.55,1]),circOut:nr([.55,0,1,.45]),backIn:nr([.31,.01,.66,-.59]),backOut:nr([.33,1.53,.69,.99])};function Yg(t,s){if(t)return typeof t=="function"?Zg()?Kg(t,s):"ease-out":Eg(t)?nr(t):Array.isArray(t)?t.map(n=>Yg(n,s)||um.easeOut):um[t]}function h4(t,s,n,{delay:i=0,duration:r=300,repeat:a=0,repeatType:o="loop",ease:l="easeOut",times:c}={},d=void 0){const u={[s]:n};c&&(u.offset=c);const m=Yg(l,r);Array.isArray(m)&&(u.easing=m);const h={delay:i,duration:r,easing:Array.isArray(m)?"linear":m,fill:"both",iterations:a+1,direction:o==="reverse"?"alternate":"normal"};return d&&(h.pseudoElement=d),t.animate(u,h)}function Jg(t){return typeof t=="function"&&"applyToOptions"in t}function p4({type:t,...s}){return Jg(t)&&Zg()?t.applyToOptions(s):(s.duration??(s.duration=300),s.ease??(s.ease="easeOut"),s)}class f4 extends wd{constructor(s){if(super(),this.finishedTime=null,this.isStopped=!1,!s)return;const{element:n,name:i,keyframes:r,pseudoElement:a,allowFlatten:o=!1,finalKeyframe:l,onComplete:c}=s;this.isPseudoElement=!!a,this.allowFlatten=o,this.options=s,ld(typeof s.type!="string");const d=p4(s);this.animation=h4(n,i,r,d,a),d.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!a){const u=yd(r,this.options,l,this.speed);this.updateMotionValue?this.updateMotionValue(u):c4(n,i,u),this.animation.cancel()}c?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:s}=this;s==="idle"||s==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const s=this.animation.effect?.getComputedTiming?.().duration||0;return bs(Number(s))}get time(){return bs(Number(this.animation.currentTime)||0)}set time(s){this.finishedTime=null,this.animation.currentTime=ws(s)}get speed(){return this.animation.playbackRate}set speed(s){s<0&&(this.finishedTime=null),this.animation.playbackRate=s}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(s){this.animation.startTime=s}attachTimeline({timeline:s,observe:n}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,s&&d4()?(this.animation.timeline=s,Yt):n(this)}}const Xg={anticipate:Pg,backInOut:Ag,circInOut:Mg};function x4(t){return t in Xg}function g4(t){typeof t.ease=="string"&&x4(t.ease)&&(t.ease=Xg[t.ease])}const mm=10;class j4 extends f4{constructor(s){g4(s),Gg(s),super(s),s.startTime&&(this.startTime=s.startTime),this.options=s}updateMotionValue(s){const{motionValue:n,onUpdate:i,onComplete:r,element:a,...o}=this.options;if(!n)return;if(s!==void 0){n.set(s);return}const l=new bd({...o,autoplay:!1}),c=ws(this.finishedTime??this.time);n.setWithVelocity(l.sample(c-mm).value,l.sample(c).value,mm),l.stop()}}const hm=(t,s)=>s==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(on.test(t)||t==="0")&&!t.startsWith("url("));function y4(t){const s=t[0];if(t.length===1)return!0;for(let n=0;n<t.length;n++)if(t[n]!==s)return!0}function w4(t,s,n,i){const r=t[0];if(r===null)return!1;if(s==="display"||s==="visibility")return!0;const a=t[t.length-1],o=hm(r,s),l=hm(a,s);return!o||!l?!1:y4(t)||(n==="spring"||Jg(n))&&i}function ec(t){t.duration=0,t.type}const b4=new Set(["opacity","clipPath","filter","transform"]),v4=cd(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function N4(t){const{motionValue:s,name:n,repeatDelay:i,repeatType:r,damping:a,type:o}=t;if(!(s?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:c,transformTemplate:d}=s.owner.getProps();return v4()&&n&&b4.has(n)&&(n!=="transform"||!d)&&!c&&!i&&r!=="mirror"&&a!==0&&o!=="inertia"}const k4=40;class z4 extends wd{constructor({autoplay:s=!0,delay:n=0,type:i="keyframes",repeat:r=0,repeatDelay:a=0,repeatType:o="loop",keyframes:l,name:c,motionValue:d,element:u,...m}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=_t.now();const h={autoplay:s,delay:n,type:i,repeat:r,repeatDelay:a,repeatType:o,name:c,motionValue:d,element:u,...m},p=u?.KeyframeResolver||vd;this.keyframeResolver=new p(l,(j,y,x)=>this.onKeyframesResolved(j,y,h,!x),c,d,u),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(s,n,i,r){this.keyframeResolver=void 0;const{name:a,type:o,velocity:l,delay:c,isHandoff:d,onUpdate:u}=i;this.resolvedAt=_t.now(),w4(s,a,o,l)||((Rs.instantAnimations||!c)&&u?.(yd(s,i,n)),s[0]=s[s.length-1],ec(i),i.repeat=0);const h={startTime:r?this.resolvedAt?this.resolvedAt-this.createdAt>k4?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:n,...i,keyframes:s},p=!d&&N4(h)?new j4({...h,element:h.motionValue.owner.current}):new bd(h);p.finished.then(()=>this.notifyFinished()).catch(Yt),this.pendingTimeline&&(this.stopTimeline=p.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=p}get finished(){return this._animation?this.animation.finished:this._finished}then(s,n){return this.finished.finally(s).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),o4()),this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(s){this.animation.time=s}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(s){this.animation.speed=s}get startTime(){return this.animation.startTime}attachTimeline(s){return this._animation?this.stopTimeline=this.animation.attachTimeline(s):this.pendingTimeline=s,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const S4=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function C4(t){const s=S4.exec(t);if(!s)return[,];const[,n,i,r]=s;return[`--${n??i}`,r]}function ej(t,s,n=1){const[i,r]=C4(t);if(!i)return;const a=window.getComputedStyle(s).getPropertyValue(i);if(a){const o=a.trim();return vg(o)?parseFloat(o):o}return pd(r)?ej(r,s,n+1):r}function Nd(t,s){return t?.[s]??t?.default??t}const tj=new Set(["width","height","top","left","right","bottom",...Fi]),_4={test:t=>t==="auto",parse:t=>t},sj=t=>s=>s.test(t),nj=[qi,te,vs,Hs,y_,j_,_4],pm=t=>nj.find(sj(t));function T4(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||kg(t):!0}const A4=new Set(["brightness","contrast","saturate","opacity"]);function P4(t){const[s,n]=t.slice(0,-1).split("(");if(s==="drop-shadow")return t;const[i]=n.match(fd)||[];if(!i)return t;const r=n.replace(i,"");let a=A4.has(s)?1:0;return i!==n&&(a*=100),s+"("+a+r+")"}const D4=/\b([a-z-]*)\(.*?\)/gu,tc={...on,getAnimatableNone:t=>{const s=t.match(D4);return s?s.map(P4).join(" "):t}},fm={...qi,transform:Math.round},M4={rotate:Hs,rotateX:Hs,rotateY:Hs,rotateZ:Hs,scale:ma,scaleX:ma,scaleY:ma,scaleZ:ma,skew:Hs,skewX:Hs,skewY:Hs,distance:te,translateX:te,translateY:te,translateZ:te,x:te,y:te,z:te,perspective:te,transformPerspective:te,opacity:Pr,originX:sm,originY:sm,originZ:te},kd={borderWidth:te,borderTopWidth:te,borderRightWidth:te,borderBottomWidth:te,borderLeftWidth:te,borderRadius:te,radius:te,borderTopLeftRadius:te,borderTopRightRadius:te,borderBottomRightRadius:te,borderBottomLeftRadius:te,width:te,maxWidth:te,height:te,maxHeight:te,top:te,right:te,bottom:te,left:te,padding:te,paddingTop:te,paddingRight:te,paddingBottom:te,paddingLeft:te,margin:te,marginTop:te,marginRight:te,marginBottom:te,marginLeft:te,backgroundPositionX:te,backgroundPositionY:te,...M4,zIndex:fm,fillOpacity:Pr,strokeOpacity:Pr,numOctaves:fm},I4={...kd,color:Ge,backgroundColor:Ge,outlineColor:Ge,fill:Ge,stroke:Ge,borderColor:Ge,borderTopColor:Ge,borderRightColor:Ge,borderBottomColor:Ge,borderLeftColor:Ge,filter:tc,WebkitFilter:tc},ij=t=>I4[t];function rj(t,s){let n=ij(t);return n!==tc&&(n=on),n.getAnimatableNone?n.getAnimatableNone(s):void 0}const E4=new Set(["auto","none","0"]);function L4(t,s,n){let i=0,r;for(;i<t.length&&!r;){const a=t[i];typeof a=="string"&&!E4.has(a)&&Dr(a).values.length&&(r=t[i]),i++}if(r&&n)for(const a of s)t[a]=rj(n,r)}class R4 extends vd{constructor(s,n,i,r,a){super(s,n,i,r,a,!0)}readKeyframes(){const{unresolvedKeyframes:s,element:n,name:i}=this;if(!n||!n.current)return;super.readKeyframes();for(let c=0;c<s.length;c++){let d=s[c];if(typeof d=="string"&&(d=d.trim(),pd(d))){const u=ej(d,n.current);u!==void 0&&(s[c]=u),c===s.length-1&&(this.finalKeyframe=d)}}if(this.resolveNoneKeyframes(),!tj.has(i)||s.length!==2)return;const[r,a]=s,o=pm(r),l=pm(a);if(o!==l)if(dm(o)&&dm(l))for(let c=0;c<s.length;c++){const d=s[c];typeof d=="string"&&(s[c]=parseFloat(d))}else kn[i]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:s,name:n}=this,i=[];for(let r=0;r<s.length;r++)(s[r]===null||T4(s[r]))&&i.push(r);i.length&&L4(s,i,n)}measureInitialState(){const{element:s,unresolvedKeyframes:n,name:i}=this;if(!s||!s.current)return;i==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=kn[i](s.measureViewportBox(),window.getComputedStyle(s.current)),n[0]=this.measuredOrigin;const r=n[n.length-1];r!==void 0&&s.getValue(i,r).jump(r,!1)}measureEndState(){const{element:s,name:n,unresolvedKeyframes:i}=this;if(!s||!s.current)return;const r=s.getValue(n);r&&r.jump(this.measuredOrigin,!1);const a=i.length-1,o=i[a];i[a]=kn[n](s.measureViewportBox(),window.getComputedStyle(s.current)),o!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=o),this.removedTransforms?.length&&this.removedTransforms.forEach(([l,c])=>{s.getValue(l).set(c)}),this.resolveNoneKeyframes()}}function O4(t,s,n){if(t instanceof EventTarget)return[t];if(typeof t=="string"){let i=document;const r=n?.[t]??i.querySelectorAll(t);return r?Array.from(r):[]}return Array.from(t)}const aj=(t,s)=>s&&typeof t=="number"?s.transform(t):t;function oj(t){return Ng(t)&&"offsetHeight"in t}const xm=30,$4=t=>!isNaN(parseFloat(t));class q4{constructor(s,n={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=i=>{const r=_t.now();if(this.updatedAt!==r&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(i),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const a of this.dependents)a.dirty()},this.hasAnimated=!1,this.setCurrent(s),this.owner=n.owner}setCurrent(s){this.current=s,this.updatedAt=_t.now(),this.canTrackVelocity===null&&s!==void 0&&(this.canTrackVelocity=$4(this.current))}setPrevFrameValue(s=this.current){this.prevFrameValue=s,this.prevUpdatedAt=this.updatedAt}onChange(s){return this.on("change",s)}on(s,n){this.events[s]||(this.events[s]=new dd);const i=this.events[s].add(n);return s==="change"?()=>{i(),Pe.read(()=>{this.events.change.getSize()||this.stop()})}:i}clearListeners(){for(const s in this.events)this.events[s].clear()}attach(s,n){this.passiveEffect=s,this.stopPassiveEffect=n}set(s){this.passiveEffect?this.passiveEffect(s,this.updateAndNotify):this.updateAndNotify(s)}setWithVelocity(s,n,i){this.set(n),this.prev=void 0,this.prevFrameValue=s,this.prevUpdatedAt=this.updatedAt-i}jump(s,n=!0){this.updateAndNotify(s),this.prev=s,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(s){this.dependents||(this.dependents=new Set),this.dependents.add(s)}removeDependent(s){this.dependents&&this.dependents.delete(s)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const s=_t.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||s-this.updatedAt>xm)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,xm);return zg(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(s){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=s(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Si(t,s){return new q4(t,s)}const{schedule:zd}=Lg(queueMicrotask,!1),is={x:!1,y:!1};function lj(){return is.x||is.y}function F4(t){return t==="x"||t==="y"?is[t]?null:(is[t]=!0,()=>{is[t]=!1}):is.x||is.y?null:(is.x=is.y=!0,()=>{is.x=is.y=!1})}function cj(t,s){const n=O4(t),i=new AbortController,r={passive:!0,...s,signal:i.signal};return[n,r,()=>i.abort()]}function gm(t){return!(t.pointerType==="touch"||lj())}function B4(t,s,n={}){const[i,r,a]=cj(t,n),o=l=>{if(!gm(l))return;const{target:c}=l,d=s(c,l);if(typeof d!="function"||!c)return;const u=m=>{gm(m)&&(d(m),c.removeEventListener("pointerleave",u))};c.addEventListener("pointerleave",u,r)};return i.forEach(l=>{l.addEventListener("pointerenter",o,r)}),a}const dj=(t,s)=>s?t===s?!0:dj(t,s.parentElement):!1,Sd=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,U4=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function V4(t){return U4.has(t.tagName)||t.tabIndex!==-1}const va=new WeakSet;function jm(t){return s=>{s.key==="Enter"&&t(s)}}function pl(t,s){t.dispatchEvent(new PointerEvent("pointer"+s,{isPrimary:!0,bubbles:!0}))}const K4=(t,s)=>{const n=t.currentTarget;if(!n)return;const i=jm(()=>{if(va.has(n))return;pl(n,"down");const r=jm(()=>{pl(n,"up")}),a=()=>pl(n,"cancel");n.addEventListener("keyup",r,s),n.addEventListener("blur",a,s)});n.addEventListener("keydown",i,s),n.addEventListener("blur",()=>n.removeEventListener("keydown",i),s)};function ym(t){return Sd(t)&&!lj()}function W4(t,s,n={}){const[i,r,a]=cj(t,n),o=l=>{const c=l.currentTarget;if(!ym(l))return;va.add(c);const d=s(c,l),u=(p,j)=>{window.removeEventListener("pointerup",m),window.removeEventListener("pointercancel",h),va.has(c)&&va.delete(c),ym(p)&&typeof d=="function"&&d(p,{success:j})},m=p=>{u(p,c===window||c===document||n.useGlobalTarget||dj(c,p.target))},h=p=>{u(p,!1)};window.addEventListener("pointerup",m,r),window.addEventListener("pointercancel",h,r)};return i.forEach(l=>{(n.useGlobalTarget?window:l).addEventListener("pointerdown",o,r),oj(l)&&(l.addEventListener("focus",d=>K4(d,r)),!V4(l)&&!l.hasAttribute("tabindex")&&(l.tabIndex=0))}),a}function uj(t){return Ng(t)&&"ownerSVGElement"in t}function G4(t){return uj(t)&&t.tagName==="svg"}const mt=t=>!!(t&&t.getVelocity),H4=[...nj,Ge,on],Q4=t=>H4.find(sj(t)),Cd=f.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});class Z4 extends f.Component{getSnapshotBeforeUpdate(s){const n=this.props.childRef.current;if(n&&s.isPresent&&!this.props.isPresent){const i=n.offsetParent,r=oj(i)&&i.offsetWidth||0,a=this.props.sizeRef.current;a.height=n.offsetHeight||0,a.width=n.offsetWidth||0,a.top=n.offsetTop,a.left=n.offsetLeft,a.right=r-a.width-a.left}return null}componentDidUpdate(){}render(){return this.props.children}}function Y4({children:t,isPresent:s,anchorX:n,root:i}){const r=f.useId(),a=f.useRef(null),o=f.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:l}=f.useContext(Cd);return f.useInsertionEffect(()=>{const{width:c,height:d,top:u,left:m,right:h}=o.current;if(s||!a.current||!c||!d)return;const p=n==="left"?`left: ${m}`:`right: ${h}`;a.current.dataset.motionPopId=r;const j=document.createElement("style");l&&(j.nonce=l);const y=i??document.head;return y.appendChild(j),j.sheet&&j.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${c}px !important;
            height: ${d}px !important;
            ${p}px !important;
            top: ${u}px !important;
          }
        `),()=>{y.contains(j)&&y.removeChild(j)}},[s]),e.jsx(Z4,{isPresent:s,childRef:a,sizeRef:o,children:f.cloneElement(t,{ref:a})})}const J4=({children:t,initial:s,isPresent:n,onExitComplete:i,custom:r,presenceAffectsLayout:a,mode:o,anchorX:l,root:c})=>{const d=id(X4),u=f.useId();let m=!0,h=f.useMemo(()=>(m=!1,{id:u,initial:s,isPresent:n,custom:r,onExitComplete:p=>{d.set(p,!0);for(const j of d.values())if(!j)return;i&&i()},register:p=>(d.set(p,!1),()=>d.delete(p))}),[n,d,i]);return a&&m&&(h={...h}),f.useMemo(()=>{d.forEach((p,j)=>d.set(j,!1))},[n]),f.useEffect(()=>{!n&&!d.size&&i&&i()},[n]),o==="popLayout"&&(t=e.jsx(Y4,{isPresent:n,anchorX:l,root:c,children:t})),e.jsx(Io.Provider,{value:h,children:t})};function X4(){return new Map}function mj(t=!0){const s=f.useContext(Io);if(s===null)return[!0,null];const{isPresent:n,onExitComplete:i,register:r}=s,a=f.useId();f.useEffect(()=>{if(t)return r(a)},[t]);const o=f.useCallback(()=>t&&i&&i(a),[a,i,t]);return!n&&i?[!1,o]:[!0]}const ha=t=>t.key||"";function wm(t){const s=[];return f.Children.forEach(t,n=>{f.isValidElement(n)&&s.push(n)}),s}const eT=({children:t,custom:s,initial:n=!0,onExitComplete:i,presenceAffectsLayout:r=!0,mode:a="sync",propagate:o=!1,anchorX:l="left",root:c})=>{const[d,u]=mj(o),m=f.useMemo(()=>wm(t),[t]),h=o&&!d?[]:m.map(ha),p=f.useRef(!0),j=f.useRef(m),y=id(()=>new Map),[x,g]=f.useState(m),[b,v]=f.useState(m);bg(()=>{p.current=!1,j.current=m;for(let z=0;z<b.length;z++){const N=ha(b[z]);h.includes(N)?y.delete(N):y.get(N)!==!0&&y.set(N,!1)}},[b,h.length,h.join("-")]);const C=[];if(m!==x){let z=[...m];for(let N=0;N<b.length;N++){const S=b[N],P=ha(S);h.includes(P)||(z.splice(N,0,S),C.push(S))}return a==="wait"&&C.length&&(z=C),v(wm(z)),g(m),null}const{forceRender:T}=f.useContext(nd);return e.jsx(e.Fragment,{children:b.map(z=>{const N=ha(z),S=o&&!d?!1:m===b||h.includes(N),P=()=>{if(y.has(N))y.set(N,!0);else return;let w=!0;y.forEach(k=>{k||(w=!1)}),w&&(T?.(),v(j.current),o&&u?.(),i&&i())};return e.jsx(J4,{isPresent:S,initial:!p.current||n?void 0:!1,custom:s,presenceAffectsLayout:r,mode:a,root:c,onExitComplete:S?void 0:P,anchorX:l,children:z},N)})})},hj=f.createContext({strict:!1}),bm={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Ci={};for(const t in bm)Ci[t]={isEnabled:s=>bm[t].some(n=>!!s[n])};function tT(t){for(const s in t)Ci[s]={...Ci[s],...t[s]}}const sT=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Wa(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||sT.has(t)}let pj=t=>!Wa(t);function nT(t){typeof t=="function"&&(pj=s=>s.startsWith("on")?!Wa(s):t(s))}try{nT(require("@emotion/is-prop-valid").default)}catch{}function iT(t,s,n){const i={};for(const r in t)r==="values"&&typeof t.values=="object"||(pj(r)||n===!0&&Wa(r)||!s&&!Wa(r)||t.draggable&&r.startsWith("onDrag"))&&(i[r]=t[r]);return i}const Eo=f.createContext({});function Lo(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}function Mr(t){return typeof t=="string"||Array.isArray(t)}const _d=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Td=["initial",..._d];function Ro(t){return Lo(t.animate)||Td.some(s=>Mr(t[s]))}function fj(t){return!!(Ro(t)||t.variants)}function rT(t,s){if(Ro(t)){const{initial:n,animate:i}=t;return{initial:n===!1||Mr(n)?n:void 0,animate:Mr(i)?i:void 0}}return t.inherit!==!1?s:{}}function aT(t){const{initial:s,animate:n}=rT(t,f.useContext(Eo));return f.useMemo(()=>({initial:s,animate:n}),[vm(s),vm(n)])}function vm(t){return Array.isArray(t)?t.join(" "):t}const Ir={};function oT(t){for(const s in t)Ir[s]=t[s],hd(s)&&(Ir[s].isCSSVariable=!0)}function xj(t,{layout:s,layoutId:n}){return Bi.has(t)||t.startsWith("origin")||(s||n!==void 0)&&(!!Ir[t]||t==="opacity")}const lT={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},cT=Fi.length;function dT(t,s,n){let i="",r=!0;for(let a=0;a<cT;a++){const o=Fi[a],l=t[o];if(l===void 0)continue;let c=!0;if(typeof l=="number"?c=l===(o.startsWith("scale")?1:0):c=parseFloat(l)===0,!c||n){const d=aj(l,kd[o]);if(!c){r=!1;const u=lT[o]||o;i+=`${u}(${d}) `}n&&(s[o]=d)}}return i=i.trim(),n?i=n(s,r?"":i):r&&(i="none"),i}function Ad(t,s,n){const{style:i,vars:r,transformOrigin:a}=t;let o=!1,l=!1;for(const c in s){const d=s[c];if(Bi.has(c)){o=!0;continue}else if(hd(c)){r[c]=d;continue}else{const u=aj(d,kd[c]);c.startsWith("origin")?(l=!0,a[c]=u):i[c]=u}}if(s.transform||(o||n?i.transform=dT(s,t.transform,n):i.transform&&(i.transform="none")),l){const{originX:c="50%",originY:d="50%",originZ:u=0}=a;i.transformOrigin=`${c} ${d} ${u}`}}const Pd=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function gj(t,s,n){for(const i in s)!mt(s[i])&&!xj(i,n)&&(t[i]=s[i])}function uT({transformTemplate:t},s){return f.useMemo(()=>{const n=Pd();return Ad(n,s,t),Object.assign({},n.vars,n.style)},[s])}function mT(t,s){const n=t.style||{},i={};return gj(i,n,t),Object.assign(i,uT(t,s)),i}function hT(t,s){const n={},i=mT(t,s);return t.drag&&t.dragListener!==!1&&(n.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(n.tabIndex=0),n.style=i,n}const pT={offset:"stroke-dashoffset",array:"stroke-dasharray"},fT={offset:"strokeDashoffset",array:"strokeDasharray"};function xT(t,s,n=1,i=0,r=!0){t.pathLength=1;const a=r?pT:fT;t[a.offset]=te.transform(-i);const o=te.transform(s),l=te.transform(n);t[a.array]=`${o} ${l}`}function jj(t,{attrX:s,attrY:n,attrScale:i,pathLength:r,pathSpacing:a=1,pathOffset:o=0,...l},c,d,u){if(Ad(t,l,d),c){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:m,style:h}=t;m.transform&&(h.transform=m.transform,delete m.transform),(h.transform||m.transformOrigin)&&(h.transformOrigin=m.transformOrigin??"50% 50%",delete m.transformOrigin),h.transform&&(h.transformBox=u?.transformBox??"fill-box",delete m.transformBox),s!==void 0&&(m.x=s),n!==void 0&&(m.y=n),i!==void 0&&(m.scale=i),r!==void 0&&xT(m,r,a,o,!1)}const yj=()=>({...Pd(),attrs:{}}),wj=t=>typeof t=="string"&&t.toLowerCase()==="svg";function gT(t,s,n,i){const r=f.useMemo(()=>{const a=yj();return jj(a,s,wj(i),t.transformTemplate,t.style),{...a.attrs,style:{...a.style}}},[s]);if(t.style){const a={};gj(a,t.style,t),r.style={...a,...r.style}}return r}const jT=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Dd(t){return typeof t!="string"||t.includes("-")?!1:!!(jT.indexOf(t)>-1||/[A-Z]/u.test(t))}function yT(t,s,n,{latestValues:i},r,a=!1){const l=(Dd(t)?gT:hT)(s,i,r,t),c=iT(s,typeof t=="string",a),d=t!==f.Fragment?{...c,...l,ref:n}:{},{children:u}=s,m=f.useMemo(()=>mt(u)?u.get():u,[u]);return f.createElement(t,{...d,children:m})}function Nm(t){const s=[{},{}];return t?.values.forEach((n,i)=>{s[0][i]=n.get(),s[1][i]=n.getVelocity()}),s}function Md(t,s,n,i){if(typeof s=="function"){const[r,a]=Nm(i);s=s(n!==void 0?n:t.custom,r,a)}if(typeof s=="string"&&(s=t.variants&&t.variants[s]),typeof s=="function"){const[r,a]=Nm(i);s=s(n!==void 0?n:t.custom,r,a)}return s}function Na(t){return mt(t)?t.get():t}function wT({scrapeMotionValuesFromProps:t,createRenderState:s},n,i,r){return{latestValues:bT(n,i,r,t),renderState:s()}}function bT(t,s,n,i){const r={},a=i(t,{});for(const h in a)r[h]=Na(a[h]);let{initial:o,animate:l}=t;const c=Ro(t),d=fj(t);s&&d&&!c&&t.inherit!==!1&&(o===void 0&&(o=s.initial),l===void 0&&(l=s.animate));let u=n?n.initial===!1:!1;u=u||o===!1;const m=u?l:o;if(m&&typeof m!="boolean"&&!Lo(m)){const h=Array.isArray(m)?m:[m];for(let p=0;p<h.length;p++){const j=Md(t,h[p]);if(j){const{transitionEnd:y,transition:x,...g}=j;for(const b in g){let v=g[b];if(Array.isArray(v)){const C=u?v.length-1:0;v=v[C]}v!==null&&(r[b]=v)}for(const b in y)r[b]=y[b]}}}return r}const bj=t=>(s,n)=>{const i=f.useContext(Eo),r=f.useContext(Io),a=()=>wT(t,s,i,r);return n?a():id(a)};function Id(t,s,n){const{style:i}=t,r={};for(const a in i)(mt(i[a])||s.style&&mt(s.style[a])||xj(a,t)||n?.getValue(a)?.liveStyle!==void 0)&&(r[a]=i[a]);return r}const vT=bj({scrapeMotionValuesFromProps:Id,createRenderState:Pd});function vj(t,s,n){const i=Id(t,s,n);for(const r in t)if(mt(t[r])||mt(s[r])){const a=Fi.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;i[a]=t[r]}return i}const NT=bj({scrapeMotionValuesFromProps:vj,createRenderState:yj}),kT=Symbol.for("motionComponentSymbol");function oi(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function zT(t,s,n){return f.useCallback(i=>{i&&t.onMount&&t.onMount(i),s&&(i?s.mount(i):s.unmount()),n&&(typeof n=="function"?n(i):oi(n)&&(n.current=i))},[s])}const Ed=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),ST="framerAppearId",Nj="data-"+Ed(ST),kj=f.createContext({});function CT(t,s,n,i,r){const{visualElement:a}=f.useContext(Eo),o=f.useContext(hj),l=f.useContext(Io),c=f.useContext(Cd).reducedMotion,d=f.useRef(null);i=i||o.renderer,!d.current&&i&&(d.current=i(t,{visualState:s,parent:a,props:n,presenceContext:l,blockInitialAnimation:l?l.initial===!1:!1,reducedMotionConfig:c}));const u=d.current,m=f.useContext(kj);u&&!u.projection&&r&&(u.type==="html"||u.type==="svg")&&_T(d.current,n,r,m);const h=f.useRef(!1);f.useInsertionEffect(()=>{u&&h.current&&u.update(n,l)});const p=n[Nj],j=f.useRef(!!p&&!window.MotionHandoffIsComplete?.(p)&&window.MotionHasOptimisedAnimation?.(p));return bg(()=>{u&&(h.current=!0,window.MotionIsMounted=!0,u.updateFeatures(),u.scheduleRenderMicrotask(),j.current&&u.animationState&&u.animationState.animateChanges())}),f.useEffect(()=>{u&&(!j.current&&u.animationState&&u.animationState.animateChanges(),j.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(p)}),j.current=!1),u.enteringChildren=void 0)}),u}function _T(t,s,n,i){const{layoutId:r,layout:a,drag:o,dragConstraints:l,layoutScroll:c,layoutRoot:d,layoutCrossfade:u}=s;t.projection=new n(t.latestValues,s["data-framer-portal-id"]?void 0:zj(t.parent)),t.projection.setOptions({layoutId:r,layout:a,alwaysMeasureLayout:!!o||l&&oi(l),visualElement:t,animationType:typeof a=="string"?a:"both",initialPromotionConfig:i,crossfade:u,layoutScroll:c,layoutRoot:d})}function zj(t){if(t)return t.options.allowProjection!==!1?t.projection:zj(t.parent)}function fl(t,{forwardMotionProps:s=!1}={},n,i){n&&tT(n);const r=Dd(t)?NT:vT;function a(l,c){let d;const u={...f.useContext(Cd),...l,layoutId:TT(l)},{isStatic:m}=u,h=aT(l),p=r(l,m);if(!m&&rd){AT();const j=PT(u);d=j.MeasureLayout,h.visualElement=CT(t,p,u,i,j.ProjectionNode)}return e.jsxs(Eo.Provider,{value:h,children:[d&&h.visualElement?e.jsx(d,{visualElement:h.visualElement,...u}):null,yT(t,l,zT(p,h.visualElement,c),p,m,s)]})}a.displayName=`motion.${typeof t=="string"?t:`create(${t.displayName??t.name??""})`}`;const o=f.forwardRef(a);return o[kT]=t,o}function TT({layoutId:t}){const s=f.useContext(nd).id;return s&&t!==void 0?s+"-"+t:t}function AT(t,s){f.useContext(hj).strict}function PT(t){const{drag:s,layout:n}=Ci;if(!s&&!n)return{};const i={...s,...n};return{MeasureLayout:s?.isEnabled(t)||n?.isEnabled(t)?i.MeasureLayout:void 0,ProjectionNode:i.ProjectionNode}}function DT(t,s){if(typeof Proxy>"u")return fl;const n=new Map,i=(a,o)=>fl(a,o,t,s),r=(a,o)=>i(a,o);return new Proxy(r,{get:(a,o)=>o==="create"?i:(n.has(o)||n.set(o,fl(o,void 0,t,s)),n.get(o))})}function Sj({top:t,left:s,right:n,bottom:i}){return{x:{min:s,max:n},y:{min:t,max:i}}}function MT({x:t,y:s}){return{top:s.min,right:t.max,bottom:s.max,left:t.min}}function IT(t,s){if(!s)return t;const n=s({x:t.left,y:t.top}),i=s({x:t.right,y:t.bottom});return{top:n.y,left:n.x,bottom:i.y,right:i.x}}function xl(t){return t===void 0||t===1}function sc({scale:t,scaleX:s,scaleY:n}){return!xl(t)||!xl(s)||!xl(n)}function gn(t){return sc(t)||Cj(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function Cj(t){return km(t.x)||km(t.y)}function km(t){return t&&t!=="0%"}function Ga(t,s,n){const i=t-n,r=s*i;return n+r}function zm(t,s,n,i,r){return r!==void 0&&(t=Ga(t,r,i)),Ga(t,n,i)+s}function nc(t,s=0,n=1,i,r){t.min=zm(t.min,s,n,i,r),t.max=zm(t.max,s,n,i,r)}function _j(t,{x:s,y:n}){nc(t.x,s.translate,s.scale,s.originPoint),nc(t.y,n.translate,n.scale,n.originPoint)}const Sm=.999999999999,Cm=1.0000000000001;function ET(t,s,n,i=!1){const r=n.length;if(!r)return;s.x=s.y=1;let a,o;for(let l=0;l<r;l++){a=n[l],o=a.projectionDelta;const{visualElement:c}=a.options;c&&c.props.style&&c.props.style.display==="contents"||(i&&a.options.layoutScroll&&a.scroll&&a!==a.root&&ci(t,{x:-a.scroll.offset.x,y:-a.scroll.offset.y}),o&&(s.x*=o.x.scale,s.y*=o.y.scale,_j(t,o)),i&&gn(a.latestValues)&&ci(t,a.latestValues))}s.x<Cm&&s.x>Sm&&(s.x=1),s.y<Cm&&s.y>Sm&&(s.y=1)}function li(t,s){t.min=t.min+s,t.max=t.max+s}function _m(t,s,n,i,r=.5){const a=Ee(t.min,t.max,r);nc(t,s,n,a,i)}function ci(t,s){_m(t.x,s.x,s.scaleX,s.scale,s.originX),_m(t.y,s.y,s.scaleY,s.scale,s.originY)}function Tj(t,s){return Sj(IT(t.getBoundingClientRect(),s))}function LT(t,s,n){const i=Tj(t,n),{scroll:r}=s;return r&&(li(i.x,r.offset.x),li(i.y,r.offset.y)),i}const Tm=()=>({translate:0,scale:1,origin:0,originPoint:0}),di=()=>({x:Tm(),y:Tm()}),Am=()=>({min:0,max:0}),Fe=()=>({x:Am(),y:Am()}),ic={current:null},Aj={current:!1};function RT(){if(Aj.current=!0,!!rd)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),s=()=>ic.current=t.matches;t.addEventListener("change",s),s()}else ic.current=!1}const OT=new WeakMap;function $T(t,s,n){for(const i in s){const r=s[i],a=n[i];if(mt(r))t.addValue(i,r);else if(mt(a))t.addValue(i,Si(r,{owner:t}));else if(a!==r)if(t.hasValue(i)){const o=t.getValue(i);o.liveStyle===!0?o.jump(r):o.hasAnimated||o.set(r)}else{const o=t.getStaticValue(i);t.addValue(i,Si(o!==void 0?o:r,{owner:t}))}}for(const i in n)s[i]===void 0&&t.removeValue(i);return s}const Pm=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class qT{scrapeMotionValuesFromProps(s,n,i){return{}}constructor({parent:s,props:n,presenceContext:i,reducedMotionConfig:r,blockInitialAnimation:a,visualState:o},l={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=vd,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const h=_t.now();this.renderScheduledAt<h&&(this.renderScheduledAt=h,Pe.render(this.render,!1,!0))};const{latestValues:c,renderState:d}=o;this.latestValues=c,this.baseTarget={...c},this.initialValues=n.initial?{...c}:{},this.renderState=d,this.parent=s,this.props=n,this.presenceContext=i,this.depth=s?s.depth+1:0,this.reducedMotionConfig=r,this.options=l,this.blockInitialAnimation=!!a,this.isControllingVariants=Ro(n),this.isVariantNode=fj(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(s&&s.current);const{willChange:u,...m}=this.scrapeMotionValuesFromProps(n,{},this);for(const h in m){const p=m[h];c[h]!==void 0&&mt(p)&&p.set(c[h])}}mount(s){this.current=s,OT.set(s,this),this.projection&&!this.projection.instance&&this.projection.mount(s),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,i)=>this.bindToMotionValue(i,n)),Aj.current||RT(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:ic.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),an(this.notifyUpdate),an(this.render),this.valueSubscriptions.forEach(s=>s()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const s in this.events)this.events[s].clear();for(const s in this.features){const n=this.features[s];n&&(n.unmount(),n.isMounted=!1)}this.current=null}addChild(s){this.children.add(s),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(s)}removeChild(s){this.children.delete(s),this.enteringChildren&&this.enteringChildren.delete(s)}bindToMotionValue(s,n){this.valueSubscriptions.has(s)&&this.valueSubscriptions.get(s)();const i=Bi.has(s);i&&this.onBindTransform&&this.onBindTransform();const r=n.on("change",o=>{this.latestValues[s]=o,this.props.onUpdate&&Pe.preRender(this.notifyUpdate),i&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let a;window.MotionCheckAppearSync&&(a=window.MotionCheckAppearSync(this,s,n)),this.valueSubscriptions.set(s,()=>{r(),a&&a(),n.owner&&n.stop()})}sortNodePosition(s){return!this.current||!this.sortInstanceNodePosition||this.type!==s.type?0:this.sortInstanceNodePosition(this.current,s.current)}updateFeatures(){let s="animation";for(s in Ci){const n=Ci[s];if(!n)continue;const{isEnabled:i,Feature:r}=n;if(!this.features[s]&&r&&i(this.props)&&(this.features[s]=new r(this)),this.features[s]){const a=this.features[s];a.isMounted?a.update():(a.mount(),a.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Fe()}getStaticValue(s){return this.latestValues[s]}setStaticValue(s,n){this.latestValues[s]=n}update(s,n){(s.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=s,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let i=0;i<Pm.length;i++){const r=Pm[i];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const a="on"+r,o=s[a];o&&(this.propEventSubscriptions[r]=this.on(r,o))}this.prevMotionValues=$T(this,this.scrapeMotionValuesFromProps(s,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(s){return this.props.variants?this.props.variants[s]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(s){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(s),()=>n.variantChildren.delete(s)}addValue(s,n){const i=this.values.get(s);n!==i&&(i&&this.removeValue(s),this.bindToMotionValue(s,n),this.values.set(s,n),this.latestValues[s]=n.get())}removeValue(s){this.values.delete(s);const n=this.valueSubscriptions.get(s);n&&(n(),this.valueSubscriptions.delete(s)),delete this.latestValues[s],this.removeValueFromRenderState(s,this.renderState)}hasValue(s){return this.values.has(s)}getValue(s,n){if(this.props.values&&this.props.values[s])return this.props.values[s];let i=this.values.get(s);return i===void 0&&n!==void 0&&(i=Si(n===null?void 0:n,{owner:this}),this.addValue(s,i)),i}readValue(s,n){let i=this.latestValues[s]!==void 0||!this.current?this.latestValues[s]:this.getBaseTargetFromProps(this.props,s)??this.readValueFromInstance(this.current,s,this.options);return i!=null&&(typeof i=="string"&&(vg(i)||kg(i))?i=parseFloat(i):!Q4(i)&&on.test(n)&&(i=rj(s,n)),this.setBaseTarget(s,mt(i)?i.get():i)),mt(i)?i.get():i}setBaseTarget(s,n){this.baseTarget[s]=n}getBaseTarget(s){const{initial:n}=this.props;let i;if(typeof n=="string"||typeof n=="object"){const a=Md(this.props,n,this.presenceContext?.custom);a&&(i=a[s])}if(n&&i!==void 0)return i;const r=this.getBaseTargetFromProps(this.props,s);return r!==void 0&&!mt(r)?r:this.initialValues[s]!==void 0&&i===void 0?void 0:this.baseTarget[s]}on(s,n){return this.events[s]||(this.events[s]=new dd),this.events[s].add(n)}notify(s,...n){this.events[s]&&this.events[s].notify(...n)}scheduleRenderMicrotask(){zd.render(this.render)}}class Pj extends qT{constructor(){super(...arguments),this.KeyframeResolver=R4}sortInstanceNodePosition(s,n){return s.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(s,n){return s.style?s.style[n]:void 0}removeValueFromRenderState(s,{vars:n,style:i}){delete n[s],delete i[s]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:s}=this.props;mt(s)&&(this.childSubscription=s.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}function Dj(t,{style:s,vars:n},i,r){const a=t.style;let o;for(o in s)a[o]=s[o];r?.applyProjectionStyles(a,i);for(o in n)a.setProperty(o,n[o])}function FT(t){return window.getComputedStyle(t)}class BT extends Pj{constructor(){super(...arguments),this.type="html",this.renderInstance=Dj}readValueFromInstance(s,n){if(Bi.has(n))return this.projection?.isProjecting?Ql(n):s4(s,n);{const i=FT(s),r=(hd(n)?i.getPropertyValue(n):i[n])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(s,{transformPagePoint:n}){return Tj(s,n)}build(s,n,i){Ad(s,n,i.transformTemplate)}scrapeMotionValuesFromProps(s,n,i){return Id(s,n,i)}}const Mj=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function UT(t,s,n,i){Dj(t,s,void 0,i);for(const r in s.attrs)t.setAttribute(Mj.has(r)?r:Ed(r),s.attrs[r])}class VT extends Pj{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Fe}getBaseTargetFromProps(s,n){return s[n]}readValueFromInstance(s,n){if(Bi.has(n)){const i=ij(n);return i&&i.default||0}return n=Mj.has(n)?n:Ed(n),s.getAttribute(n)}scrapeMotionValuesFromProps(s,n,i){return vj(s,n,i)}build(s,n,i){jj(s,n,this.isSVGTag,i.transformTemplate,i.style)}renderInstance(s,n,i,r){UT(s,n,i,r)}mount(s){this.isSVGTag=wj(s.tagName),super.mount(s)}}const KT=(t,s)=>Dd(t)?new VT(s):new BT(s,{allowProjection:t!==f.Fragment});function xi(t,s,n){const i=t.getProps();return Md(i,s,n!==void 0?n:i.custom,t)}const rc=t=>Array.isArray(t);function WT(t,s,n){t.hasValue(s)?t.getValue(s).set(n):t.addValue(s,Si(n))}function GT(t){return rc(t)?t[t.length-1]||0:t}function HT(t,s){const n=xi(t,s);let{transitionEnd:i={},transition:r={},...a}=n||{};a={...a,...i};for(const o in a){const l=GT(a[o]);WT(t,o,l)}}function QT(t){return!!(mt(t)&&t.add)}function ac(t,s){const n=t.getValue("willChange");if(QT(n))return n.add(s);if(!n&&Rs.WillChange){const i=new Rs.WillChange("auto");t.addValue("willChange",i),i.add(s)}}function Ij(t){return t.props[Nj]}const ZT=t=>t!==null;function YT(t,{repeat:s,repeatType:n="loop"},i){const r=t.filter(ZT),a=s&&n!=="loop"&&s%2===1?0:r.length-1;return r[a]}const JT={type:"spring",stiffness:500,damping:25,restSpeed:10},XT=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),eA={type:"keyframes",duration:.8},tA={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},sA=(t,{keyframes:s})=>s.length>2?eA:Bi.has(t)?t.startsWith("scale")?XT(s[1]):JT:tA;function nA({when:t,delay:s,delayChildren:n,staggerChildren:i,staggerDirection:r,repeat:a,repeatType:o,repeatDelay:l,from:c,elapsed:d,...u}){return!!Object.keys(u).length}const Ld=(t,s,n,i={},r,a)=>o=>{const l=Nd(i,t)||{},c=l.delay||i.delay||0;let{elapsed:d=0}=i;d=d-ws(c);const u={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:s.getVelocity(),...l,delay:-d,onUpdate:h=>{s.set(h),l.onUpdate&&l.onUpdate(h)},onComplete:()=>{o(),l.onComplete&&l.onComplete()},name:t,motionValue:s,element:a?void 0:r};nA(l)||Object.assign(u,sA(t,u)),u.duration&&(u.duration=ws(u.duration)),u.repeatDelay&&(u.repeatDelay=ws(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let m=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(ec(u),u.delay===0&&(m=!0)),(Rs.instantAnimations||Rs.skipAnimations)&&(m=!0,ec(u),u.delay=0),u.allowFlatten=!l.type&&!l.ease,m&&!a&&s.get()!==void 0){const h=YT(u.keyframes,l);if(h!==void 0){Pe.update(()=>{u.onUpdate(h),u.onComplete()});return}}return l.isSync?new bd(u):new z4(u)};function iA({protectedKeys:t,needsAnimating:s},n){const i=t.hasOwnProperty(n)&&s[n]!==!0;return s[n]=!1,i}function Ej(t,s,{delay:n=0,transitionOverride:i,type:r}={}){let{transition:a=t.getDefaultTransition(),transitionEnd:o,...l}=s;i&&(a=i);const c=[],d=r&&t.animationState&&t.animationState.getState()[r];for(const u in l){const m=t.getValue(u,t.latestValues[u]??null),h=l[u];if(h===void 0||d&&iA(d,u))continue;const p={delay:n,...Nd(a||{},u)},j=m.get();if(j!==void 0&&!m.isAnimating&&!Array.isArray(h)&&h===j&&!p.velocity)continue;let y=!1;if(window.MotionHandoffAnimation){const g=Ij(t);if(g){const b=window.MotionHandoffAnimation(g,u,Pe);b!==null&&(p.startTime=b,y=!0)}}ac(t,u),m.start(Ld(u,m,h,t.shouldReduceMotion&&tj.has(u)?{type:!1}:p,t,y));const x=m.animation;x&&c.push(x)}return o&&Promise.all(c).then(()=>{Pe.update(()=>{o&&HT(t,o)})}),c}function Lj(t,s,n,i=0,r=1){const a=Array.from(t).sort((d,u)=>d.sortNodePosition(u)).indexOf(s),o=t.size,l=(o-1)*i;return typeof n=="function"?n(a,o):r===1?a*i:l-a*i}function oc(t,s,n={}){const i=xi(t,s,n.type==="exit"?t.presenceContext?.custom:void 0);let{transition:r=t.getDefaultTransition()||{}}=i||{};n.transitionOverride&&(r=n.transitionOverride);const a=i?()=>Promise.all(Ej(t,i,n)):()=>Promise.resolve(),o=t.variantChildren&&t.variantChildren.size?(c=0)=>{const{delayChildren:d=0,staggerChildren:u,staggerDirection:m}=r;return rA(t,s,c,d,u,m,n)}:()=>Promise.resolve(),{when:l}=r;if(l){const[c,d]=l==="beforeChildren"?[a,o]:[o,a];return c().then(()=>d())}else return Promise.all([a(),o(n.delay)])}function rA(t,s,n=0,i=0,r=0,a=1,o){const l=[];for(const c of t.variantChildren)c.notify("AnimationStart",s),l.push(oc(c,s,{...o,delay:n+(typeof i=="function"?0:i)+Lj(t.variantChildren,c,i,r,a)}).then(()=>c.notify("AnimationComplete",s)));return Promise.all(l)}function aA(t,s,n={}){t.notify("AnimationStart",s);let i;if(Array.isArray(s)){const r=s.map(a=>oc(t,a,n));i=Promise.all(r)}else if(typeof s=="string")i=oc(t,s,n);else{const r=typeof s=="function"?xi(t,s,n.custom):s;i=Promise.all(Ej(t,r,n))}return i.then(()=>{t.notify("AnimationComplete",s)})}function Rj(t,s){if(!Array.isArray(s))return!1;const n=s.length;if(n!==t.length)return!1;for(let i=0;i<n;i++)if(s[i]!==t[i])return!1;return!0}const oA=Td.length;function Oj(t){if(!t)return;if(!t.isControllingVariants){const n=t.parent?Oj(t.parent)||{}:{};return t.props.initial!==void 0&&(n.initial=t.props.initial),n}const s={};for(let n=0;n<oA;n++){const i=Td[n],r=t.props[i];(Mr(r)||r===!1)&&(s[i]=r)}return s}const lA=[..._d].reverse(),cA=_d.length;function dA(t){return s=>Promise.all(s.map(({animation:n,options:i})=>aA(t,n,i)))}function uA(t){let s=dA(t),n=Dm(),i=!0;const r=c=>(d,u)=>{const m=xi(t,u,c==="exit"?t.presenceContext?.custom:void 0);if(m){const{transition:h,transitionEnd:p,...j}=m;d={...d,...j,...p}}return d};function a(c){s=c(t)}function o(c){const{props:d}=t,u=Oj(t.parent)||{},m=[],h=new Set;let p={},j=1/0;for(let x=0;x<cA;x++){const g=lA[x],b=n[g],v=d[g]!==void 0?d[g]:u[g],C=Mr(v),T=g===c?b.isActive:null;T===!1&&(j=x);let z=v===u[g]&&v!==d[g]&&C;if(z&&i&&t.manuallyAnimateOnMount&&(z=!1),b.protectedKeys={...p},!b.isActive&&T===null||!v&&!b.prevProp||Lo(v)||typeof v=="boolean")continue;const N=mA(b.prevProp,v);let S=N||g===c&&b.isActive&&!z&&C||x>j&&C,P=!1;const w=Array.isArray(v)?v:[v];let k=w.reduce(r(g),{});T===!1&&(k={});const{prevResolvedValues:_={}}=b,A={..._,...k},D=F=>{S=!0,h.has(F)&&(P=!0,h.delete(F)),b.needsAnimating[F]=!0;const K=t.getValue(F);K&&(K.liveStyle=!1)};for(const F in A){const K=k[F],q=_[F];if(p.hasOwnProperty(F))continue;let G=!1;rc(K)&&rc(q)?G=!Rj(K,q):G=K!==q,G?K!=null?D(F):h.add(F):K!==void 0&&h.has(F)?D(F):b.protectedKeys[F]=!0}b.prevProp=v,b.prevResolvedValues=k,b.isActive&&(p={...p,...k}),i&&t.blockInitialAnimation&&(S=!1);const R=z&&N;S&&(!R||P)&&m.push(...w.map(F=>{const K={type:g};if(typeof F=="string"&&i&&!R&&t.manuallyAnimateOnMount&&t.parent){const{parent:q}=t,G=xi(q,F);if(q.enteringChildren&&G){const{delayChildren:X}=G.transition||{};K.delay=Lj(q.enteringChildren,t,X)}}return{animation:F,options:K}}))}if(h.size){const x={};if(typeof d.initial!="boolean"){const g=xi(t,Array.isArray(d.initial)?d.initial[0]:d.initial);g&&g.transition&&(x.transition=g.transition)}h.forEach(g=>{const b=t.getBaseTarget(g),v=t.getValue(g);v&&(v.liveStyle=!0),x[g]=b??null}),m.push({animation:x})}let y=!!m.length;return i&&(d.initial===!1||d.initial===d.animate)&&!t.manuallyAnimateOnMount&&(y=!1),i=!1,y?s(m):Promise.resolve()}function l(c,d){if(n[c].isActive===d)return Promise.resolve();t.variantChildren?.forEach(m=>m.animationState?.setActive(c,d)),n[c].isActive=d;const u=o(c);for(const m in n)n[m].protectedKeys={};return u}return{animateChanges:o,setActive:l,setAnimateFunction:a,getState:()=>n,reset:()=>{n=Dm(),i=!0}}}function mA(t,s){return typeof s=="string"?s!==t:Array.isArray(s)?!Rj(s,t):!1}function xn(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Dm(){return{animate:xn(!0),whileInView:xn(),whileHover:xn(),whileTap:xn(),whileDrag:xn(),whileFocus:xn(),exit:xn()}}class pn{constructor(s){this.isMounted=!1,this.node=s}update(){}}class hA extends pn{constructor(s){super(s),s.animationState||(s.animationState=uA(s))}updateAnimationControlsSubscription(){const{animate:s}=this.node.getProps();Lo(s)&&(this.unmountControls=s.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:s}=this.node.getProps(),{animate:n}=this.node.prevProps||{};s!==n&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let pA=0;class fA extends pn{constructor(){super(...arguments),this.id=pA++}update(){if(!this.node.presenceContext)return;const{isPresent:s,onExitComplete:n}=this.node.presenceContext,{isPresent:i}=this.node.prevPresenceContext||{};if(!this.node.animationState||s===i)return;const r=this.node.animationState.setActive("exit",!s);n&&!s&&r.then(()=>{n(this.id)})}mount(){const{register:s,onExitComplete:n}=this.node.presenceContext||{};n&&n(this.id),s&&(this.unmount=s(this.id))}unmount(){}}const xA={animation:{Feature:hA},exit:{Feature:fA}};function Er(t,s,n,i={passive:!0}){return t.addEventListener(s,n,i),()=>t.removeEventListener(s,n)}function Xr(t){return{point:{x:t.pageX,y:t.pageY}}}const gA=t=>s=>Sd(s)&&t(s,Xr(s));function mr(t,s,n,i){return Er(t,s,gA(n),i)}const $j=1e-4,jA=1-$j,yA=1+$j,qj=.01,wA=0-qj,bA=0+qj;function bt(t){return t.max-t.min}function vA(t,s,n){return Math.abs(t-s)<=n}function Mm(t,s,n,i=.5){t.origin=i,t.originPoint=Ee(s.min,s.max,t.origin),t.scale=bt(n)/bt(s),t.translate=Ee(n.min,n.max,t.origin)-t.originPoint,(t.scale>=jA&&t.scale<=yA||isNaN(t.scale))&&(t.scale=1),(t.translate>=wA&&t.translate<=bA||isNaN(t.translate))&&(t.translate=0)}function hr(t,s,n,i){Mm(t.x,s.x,n.x,i?i.originX:void 0),Mm(t.y,s.y,n.y,i?i.originY:void 0)}function Im(t,s,n){t.min=n.min+s.min,t.max=t.min+bt(s)}function NA(t,s,n){Im(t.x,s.x,n.x),Im(t.y,s.y,n.y)}function Em(t,s,n){t.min=s.min-n.min,t.max=t.min+bt(s)}function pr(t,s,n){Em(t.x,s.x,n.x),Em(t.y,s.y,n.y)}function Kt(t){return[t("x"),t("y")]}const Fj=({current:t})=>t?t.ownerDocument.defaultView:null,Lm=(t,s)=>Math.abs(t-s);function kA(t,s){const n=Lm(t.x,s.x),i=Lm(t.y,s.y);return Math.sqrt(n**2+i**2)}class Bj{constructor(s,n,{transformPagePoint:i,contextWindow:r=window,dragSnapToOrigin:a=!1,distanceThreshold:o=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const h=jl(this.lastMoveEventInfo,this.history),p=this.startEvent!==null,j=kA(h.offset,{x:0,y:0})>=this.distanceThreshold;if(!p&&!j)return;const{point:y}=h,{timestamp:x}=at;this.history.push({...y,timestamp:x});const{onStart:g,onMove:b}=this.handlers;p||(g&&g(this.lastMoveEvent,h),this.startEvent=this.lastMoveEvent),b&&b(this.lastMoveEvent,h)},this.handlePointerMove=(h,p)=>{this.lastMoveEvent=h,this.lastMoveEventInfo=gl(p,this.transformPagePoint),Pe.update(this.updatePoint,!0)},this.handlePointerUp=(h,p)=>{this.end();const{onEnd:j,onSessionEnd:y,resumeAnimation:x}=this.handlers;if(this.dragSnapToOrigin&&x&&x(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const g=jl(h.type==="pointercancel"?this.lastMoveEventInfo:gl(p,this.transformPagePoint),this.history);this.startEvent&&j&&j(h,g),y&&y(h,g)},!Sd(s))return;this.dragSnapToOrigin=a,this.handlers=n,this.transformPagePoint=i,this.distanceThreshold=o,this.contextWindow=r||window;const l=Xr(s),c=gl(l,this.transformPagePoint),{point:d}=c,{timestamp:u}=at;this.history=[{...d,timestamp:u}];const{onSessionStart:m}=n;m&&m(s,jl(c,this.history)),this.removeListeners=Zr(mr(this.contextWindow,"pointermove",this.handlePointerMove),mr(this.contextWindow,"pointerup",this.handlePointerUp),mr(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(s){this.handlers=s}end(){this.removeListeners&&this.removeListeners(),an(this.updatePoint)}}function gl(t,s){return s?{point:s(t.point)}:t}function Rm(t,s){return{x:t.x-s.x,y:t.y-s.y}}function jl({point:t},s){return{point:t,delta:Rm(t,Uj(s)),offset:Rm(t,zA(s)),velocity:SA(s,.1)}}function zA(t){return t[0]}function Uj(t){return t[t.length-1]}function SA(t,s){if(t.length<2)return{x:0,y:0};let n=t.length-1,i=null;const r=Uj(t);for(;n>=0&&(i=t[n],!(r.timestamp-i.timestamp>ws(s)));)n--;if(!i)return{x:0,y:0};const a=bs(r.timestamp-i.timestamp);if(a===0)return{x:0,y:0};const o={x:(r.x-i.x)/a,y:(r.y-i.y)/a};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function CA(t,{min:s,max:n},i){return s!==void 0&&t<s?t=i?Ee(s,t,i.min):Math.max(t,s):n!==void 0&&t>n&&(t=i?Ee(n,t,i.max):Math.min(t,n)),t}function Om(t,s,n){return{min:s!==void 0?t.min+s:void 0,max:n!==void 0?t.max+n-(t.max-t.min):void 0}}function _A(t,{top:s,left:n,bottom:i,right:r}){return{x:Om(t.x,n,r),y:Om(t.y,s,i)}}function $m(t,s){let n=s.min-t.min,i=s.max-t.max;return s.max-s.min<t.max-t.min&&([n,i]=[i,n]),{min:n,max:i}}function TA(t,s){return{x:$m(t.x,s.x),y:$m(t.y,s.y)}}function AA(t,s){let n=.5;const i=bt(t),r=bt(s);return r>i?n=Ar(s.min,s.max-i,t.min):i>r&&(n=Ar(t.min,t.max-r,s.min)),Ls(0,1,n)}function PA(t,s){const n={};return s.min!==void 0&&(n.min=s.min-t.min),s.max!==void 0&&(n.max=s.max-t.min),n}const lc=.35;function DA(t=lc){return t===!1?t=0:t===!0&&(t=lc),{x:qm(t,"left","right"),y:qm(t,"top","bottom")}}function qm(t,s,n){return{min:Fm(t,s),max:Fm(t,n)}}function Fm(t,s){return typeof t=="number"?t:t[s]||0}const MA=new WeakMap;class IA{constructor(s){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Fe(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=s}start(s,{snapToCursor:n=!1,distanceThreshold:i}={}){const{presenceContext:r}=this.visualElement;if(r&&r.isPresent===!1)return;const a=m=>{const{dragSnapToOrigin:h}=this.getProps();h?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(Xr(m).point)},o=(m,h)=>{const{drag:p,dragPropagation:j,onDragStart:y}=this.getProps();if(p&&!j&&(this.openDragLock&&this.openDragLock(),this.openDragLock=F4(p),!this.openDragLock))return;this.latestPointerEvent=m,this.latestPanInfo=h,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Kt(g=>{let b=this.getAxisMotionValue(g).get()||0;if(vs.test(b)){const{projection:v}=this.visualElement;if(v&&v.layout){const C=v.layout.layoutBox[g];C&&(b=bt(C)*(parseFloat(b)/100))}}this.originPoint[g]=b}),y&&Pe.postRender(()=>y(m,h)),ac(this.visualElement,"transform");const{animationState:x}=this.visualElement;x&&x.setActive("whileDrag",!0)},l=(m,h)=>{this.latestPointerEvent=m,this.latestPanInfo=h;const{dragPropagation:p,dragDirectionLock:j,onDirectionLock:y,onDrag:x}=this.getProps();if(!p&&!this.openDragLock)return;const{offset:g}=h;if(j&&this.currentDirection===null){this.currentDirection=EA(g),this.currentDirection!==null&&y&&y(this.currentDirection);return}this.updateAxis("x",h.point,g),this.updateAxis("y",h.point,g),this.visualElement.render(),x&&x(m,h)},c=(m,h)=>{this.latestPointerEvent=m,this.latestPanInfo=h,this.stop(m,h),this.latestPointerEvent=null,this.latestPanInfo=null},d=()=>Kt(m=>this.getAnimationState(m)==="paused"&&this.getAxisMotionValue(m).animation?.play()),{dragSnapToOrigin:u}=this.getProps();this.panSession=new Bj(s,{onSessionStart:a,onStart:o,onMove:l,onSessionEnd:c,resumeAnimation:d},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:u,distanceThreshold:i,contextWindow:Fj(this.visualElement)})}stop(s,n){const i=s||this.latestPointerEvent,r=n||this.latestPanInfo,a=this.isDragging;if(this.cancel(),!a||!r||!i)return;const{velocity:o}=r;this.startAnimation(o);const{onDragEnd:l}=this.getProps();l&&Pe.postRender(()=>l(i,r))}cancel(){this.isDragging=!1;const{projection:s,animationState:n}=this.visualElement;s&&(s.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:i}=this.getProps();!i&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(s,n,i){const{drag:r}=this.getProps();if(!i||!pa(s,r,this.currentDirection))return;const a=this.getAxisMotionValue(s);let o=this.originPoint[s]+i[s];this.constraints&&this.constraints[s]&&(o=CA(o,this.constraints[s],this.elastic[s])),a.set(o)}resolveConstraints(){const{dragConstraints:s,dragElastic:n}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,r=this.constraints;s&&oi(s)?this.constraints||(this.constraints=this.resolveRefConstraints()):s&&i?this.constraints=_A(i.layoutBox,s):this.constraints=!1,this.elastic=DA(n),r!==this.constraints&&i&&this.constraints&&!this.hasMutatedConstraints&&Kt(a=>{this.constraints!==!1&&this.getAxisMotionValue(a)&&(this.constraints[a]=PA(i.layoutBox[a],this.constraints[a]))})}resolveRefConstraints(){const{dragConstraints:s,onMeasureDragConstraints:n}=this.getProps();if(!s||!oi(s))return!1;const i=s.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const a=LT(i,r.root,this.visualElement.getTransformPagePoint());let o=TA(r.layout.layoutBox,a);if(n){const l=n(MT(o));this.hasMutatedConstraints=!!l,l&&(o=Sj(l))}return o}startAnimation(s){const{drag:n,dragMomentum:i,dragElastic:r,dragTransition:a,dragSnapToOrigin:o,onDragTransitionEnd:l}=this.getProps(),c=this.constraints||{},d=Kt(u=>{if(!pa(u,n,this.currentDirection))return;let m=c&&c[u]||{};o&&(m={min:0,max:0});const h=r?200:1e6,p=r?40:1e7,j={type:"inertia",velocity:i?s[u]:0,bounceStiffness:h,bounceDamping:p,timeConstant:750,restDelta:1,restSpeed:10,...a,...m};return this.startAxisValueAnimation(u,j)});return Promise.all(d).then(l)}startAxisValueAnimation(s,n){const i=this.getAxisMotionValue(s);return ac(this.visualElement,s),i.start(Ld(s,i,0,n,this.visualElement,!1))}stopAnimation(){Kt(s=>this.getAxisMotionValue(s).stop())}pauseAnimation(){Kt(s=>this.getAxisMotionValue(s).animation?.pause())}getAnimationState(s){return this.getAxisMotionValue(s).animation?.state}getAxisMotionValue(s){const n=`_drag${s.toUpperCase()}`,i=this.visualElement.getProps(),r=i[n];return r||this.visualElement.getValue(s,(i.initial?i.initial[s]:void 0)||0)}snapToCursor(s){Kt(n=>{const{drag:i}=this.getProps();if(!pa(n,i,this.currentDirection))return;const{projection:r}=this.visualElement,a=this.getAxisMotionValue(n);if(r&&r.layout){const{min:o,max:l}=r.layout.layoutBox[n];a.set(s[n]-Ee(o,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:s,dragConstraints:n}=this.getProps(),{projection:i}=this.visualElement;if(!oi(n)||!i||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};Kt(o=>{const l=this.getAxisMotionValue(o);if(l&&this.constraints!==!1){const c=l.get();r[o]=AA({min:c,max:c},this.constraints[o])}});const{transformTemplate:a}=this.visualElement.getProps();this.visualElement.current.style.transform=a?a({},""):"none",i.root&&i.root.updateScroll(),i.updateLayout(),this.resolveConstraints(),Kt(o=>{if(!pa(o,s,null))return;const l=this.getAxisMotionValue(o),{min:c,max:d}=this.constraints[o];l.set(Ee(c,d,r[o]))})}addListeners(){if(!this.visualElement.current)return;MA.set(this.visualElement,this);const s=this.visualElement.current,n=mr(s,"pointerdown",c=>{const{drag:d,dragListener:u=!0}=this.getProps();d&&u&&this.start(c)}),i=()=>{const{dragConstraints:c}=this.getProps();oi(c)&&c.current&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,a=r.addEventListener("measure",i);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),Pe.read(i);const o=Er(window,"resize",()=>this.scalePositionWithinConstraints()),l=r.addEventListener("didUpdate",({delta:c,hasLayoutChanged:d})=>{this.isDragging&&d&&(Kt(u=>{const m=this.getAxisMotionValue(u);m&&(this.originPoint[u]+=c[u].translate,m.set(m.get()+c[u].translate))}),this.visualElement.render())});return()=>{o(),n(),a(),l&&l()}}getProps(){const s=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:i=!1,dragPropagation:r=!1,dragConstraints:a=!1,dragElastic:o=lc,dragMomentum:l=!0}=s;return{...s,drag:n,dragDirectionLock:i,dragPropagation:r,dragConstraints:a,dragElastic:o,dragMomentum:l}}}function pa(t,s,n){return(s===!0||s===t)&&(n===null||n===t)}function EA(t,s=10){let n=null;return Math.abs(t.y)>s?n="y":Math.abs(t.x)>s&&(n="x"),n}class LA extends pn{constructor(s){super(s),this.removeGroupControls=Yt,this.removeListeners=Yt,this.controls=new IA(s)}mount(){const{dragControls:s}=this.node.getProps();s&&(this.removeGroupControls=s.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Yt}unmount(){this.removeGroupControls(),this.removeListeners()}}const Bm=t=>(s,n)=>{t&&Pe.postRender(()=>t(s,n))};class RA extends pn{constructor(){super(...arguments),this.removePointerDownListener=Yt}onPointerDown(s){this.session=new Bj(s,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Fj(this.node)})}createPanHandlers(){const{onPanSessionStart:s,onPanStart:n,onPan:i,onPanEnd:r}=this.node.getProps();return{onSessionStart:Bm(s),onStart:Bm(n),onMove:i,onEnd:(a,o)=>{delete this.session,r&&Pe.postRender(()=>r(a,o))}}}mount(){this.removePointerDownListener=mr(this.node.current,"pointerdown",s=>this.onPointerDown(s))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const ka={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function Um(t,s){return s.max===s.min?0:t/(s.max-s.min)*100}const Yi={correct:(t,s)=>{if(!s.target)return t;if(typeof t=="string")if(te.test(t))t=parseFloat(t);else return t;const n=Um(t,s.target.x),i=Um(t,s.target.y);return`${n}% ${i}%`}},OA={correct:(t,{treeScale:s,projectionDelta:n})=>{const i=t,r=on.parse(t);if(r.length>5)return i;const a=on.createTransformer(t),o=typeof r[0]!="number"?1:0,l=n.x.scale*s.x,c=n.y.scale*s.y;r[0+o]/=l,r[1+o]/=c;const d=Ee(l,c,.5);return typeof r[2+o]=="number"&&(r[2+o]/=d),typeof r[3+o]=="number"&&(r[3+o]/=d),a(r)}};let yl=!1;class $A extends f.Component{componentDidMount(){const{visualElement:s,layoutGroup:n,switchLayoutGroup:i,layoutId:r}=this.props,{projection:a}=s;oT(qA),a&&(n.group&&n.group.add(a),i&&i.register&&r&&i.register(a),yl&&a.root.didUpdate(),a.addEventListener("animationComplete",()=>{this.safeToRemove()}),a.setOptions({...a.options,onExitComplete:()=>this.safeToRemove()})),ka.hasEverUpdated=!0}getSnapshotBeforeUpdate(s){const{layoutDependency:n,visualElement:i,drag:r,isPresent:a}=this.props,{projection:o}=i;return o&&(o.isPresent=a,yl=!0,r||s.layoutDependency!==n||n===void 0||s.isPresent!==a?o.willUpdate():this.safeToRemove(),s.isPresent!==a&&(a?o.promote():o.relegate()||Pe.postRender(()=>{const l=o.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:s}=this.props.visualElement;s&&(s.root.didUpdate(),zd.postRender(()=>{!s.currentAnimation&&s.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:s,layoutGroup:n,switchLayoutGroup:i}=this.props,{projection:r}=s;yl=!0,r&&(r.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(r),i&&i.deregister&&i.deregister(r))}safeToRemove(){const{safeToRemove:s}=this.props;s&&s()}render(){return null}}function Vj(t){const[s,n]=mj(),i=f.useContext(nd);return e.jsx($A,{...t,layoutGroup:i,switchLayoutGroup:f.useContext(kj),isPresent:s,safeToRemove:n})}const qA={borderRadius:{...Yi,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Yi,borderTopRightRadius:Yi,borderBottomLeftRadius:Yi,borderBottomRightRadius:Yi,boxShadow:OA};function FA(t,s,n){const i=mt(t)?t:Si(t);return i.start(Ld("",i,s,n)),i.animation}const BA=(t,s)=>t.depth-s.depth;class UA{constructor(){this.children=[],this.isDirty=!1}add(s){ad(this.children,s),this.isDirty=!0}remove(s){od(this.children,s),this.isDirty=!0}forEach(s){this.isDirty&&this.children.sort(BA),this.isDirty=!1,this.children.forEach(s)}}function VA(t,s){const n=_t.now(),i=({timestamp:r})=>{const a=r-n;a>=s&&(an(i),t(a-s))};return Pe.setup(i,!0),()=>an(i)}const Kj=["TopLeft","TopRight","BottomLeft","BottomRight"],KA=Kj.length,Vm=t=>typeof t=="string"?parseFloat(t):t,Km=t=>typeof t=="number"||te.test(t);function WA(t,s,n,i,r,a){r?(t.opacity=Ee(0,n.opacity??1,GA(i)),t.opacityExit=Ee(s.opacity??1,0,HA(i))):a&&(t.opacity=Ee(s.opacity??1,n.opacity??1,i));for(let o=0;o<KA;o++){const l=`border${Kj[o]}Radius`;let c=Wm(s,l),d=Wm(n,l);if(c===void 0&&d===void 0)continue;c||(c=0),d||(d=0),c===0||d===0||Km(c)===Km(d)?(t[l]=Math.max(Ee(Vm(c),Vm(d),i),0),(vs.test(d)||vs.test(c))&&(t[l]+="%")):t[l]=d}(s.rotate||n.rotate)&&(t.rotate=Ee(s.rotate||0,n.rotate||0,i))}function Wm(t,s){return t[s]!==void 0?t[s]:t.borderRadius}const GA=Wj(0,.5,Dg),HA=Wj(.5,.95,Yt);function Wj(t,s,n){return i=>i<t?0:i>s?1:n(Ar(t,s,i))}function Gm(t,s){t.min=s.min,t.max=s.max}function Vt(t,s){Gm(t.x,s.x),Gm(t.y,s.y)}function Hm(t,s){t.translate=s.translate,t.scale=s.scale,t.originPoint=s.originPoint,t.origin=s.origin}function Qm(t,s,n,i,r){return t-=s,t=Ga(t,1/n,i),r!==void 0&&(t=Ga(t,1/r,i)),t}function QA(t,s=0,n=1,i=.5,r,a=t,o=t){if(vs.test(s)&&(s=parseFloat(s),s=Ee(o.min,o.max,s/100)-o.min),typeof s!="number")return;let l=Ee(a.min,a.max,i);t===a&&(l-=s),t.min=Qm(t.min,s,n,l,r),t.max=Qm(t.max,s,n,l,r)}function Zm(t,s,[n,i,r],a,o){QA(t,s[n],s[i],s[r],s.scale,a,o)}const ZA=["x","scaleX","originX"],YA=["y","scaleY","originY"];function Ym(t,s,n,i){Zm(t.x,s,ZA,n?n.x:void 0,i?i.x:void 0),Zm(t.y,s,YA,n?n.y:void 0,i?i.y:void 0)}function Jm(t){return t.translate===0&&t.scale===1}function Gj(t){return Jm(t.x)&&Jm(t.y)}function Xm(t,s){return t.min===s.min&&t.max===s.max}function JA(t,s){return Xm(t.x,s.x)&&Xm(t.y,s.y)}function eh(t,s){return Math.round(t.min)===Math.round(s.min)&&Math.round(t.max)===Math.round(s.max)}function Hj(t,s){return eh(t.x,s.x)&&eh(t.y,s.y)}function th(t){return bt(t.x)/bt(t.y)}function sh(t,s){return t.translate===s.translate&&t.scale===s.scale&&t.originPoint===s.originPoint}class XA{constructor(){this.members=[]}add(s){ad(this.members,s),s.scheduleRender()}remove(s){if(od(this.members,s),s===this.prevLead&&(this.prevLead=void 0),s===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(s){const n=this.members.findIndex(r=>s===r);if(n===0)return!1;let i;for(let r=n;r>=0;r--){const a=this.members[r];if(a.isPresent!==!1){i=a;break}}return i?(this.promote(i),!0):!1}promote(s,n){const i=this.lead;if(s!==i&&(this.prevLead=i,this.lead=s,s.show(),i)){i.instance&&i.scheduleRender(),s.scheduleRender(),s.resumeFrom=i,n&&(s.resumeFrom.preserveOpacity=!0),i.snapshot&&(s.snapshot=i.snapshot,s.snapshot.latestValues=i.animationValues||i.latestValues),s.root&&s.root.isUpdating&&(s.isLayoutDirty=!0);const{crossfade:r}=s.options;r===!1&&i.hide()}}exitAnimationComplete(){this.members.forEach(s=>{const{options:n,resumingFrom:i}=s;n.onExitComplete&&n.onExitComplete(),i&&i.options.onExitComplete&&i.options.onExitComplete()})}scheduleRender(){this.members.forEach(s=>{s.instance&&s.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function eP(t,s,n){let i="";const r=t.x.translate/s.x,a=t.y.translate/s.y,o=n?.z||0;if((r||a||o)&&(i=`translate3d(${r}px, ${a}px, ${o}px) `),(s.x!==1||s.y!==1)&&(i+=`scale(${1/s.x}, ${1/s.y}) `),n){const{transformPerspective:d,rotate:u,rotateX:m,rotateY:h,skewX:p,skewY:j}=n;d&&(i=`perspective(${d}px) ${i}`),u&&(i+=`rotate(${u}deg) `),m&&(i+=`rotateX(${m}deg) `),h&&(i+=`rotateY(${h}deg) `),p&&(i+=`skewX(${p}deg) `),j&&(i+=`skewY(${j}deg) `)}const l=t.x.scale*s.x,c=t.y.scale*s.y;return(l!==1||c!==1)&&(i+=`scale(${l}, ${c})`),i||"none"}const wl=["","X","Y","Z"],tP=1e3;let sP=0;function bl(t,s,n,i){const{latestValues:r}=s;r[t]&&(n[t]=r[t],s.setStaticValue(t,0),i&&(i[t]=0))}function Qj(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:s}=t.options;if(!s)return;const n=Ij(s);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:r,layoutId:a}=t.options;window.MotionCancelOptimisedAnimation(n,"transform",Pe,!(r||a))}const{parent:i}=t;i&&!i.hasCheckedOptimisedAppear&&Qj(i)}function Zj({attachResizeListener:t,defaultParent:s,measureScroll:n,checkIsScrollRoot:i,resetTransform:r}){return class{constructor(o={},l=s?.()){this.id=sP++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(rP),this.nodes.forEach(cP),this.nodes.forEach(dP),this.nodes.forEach(aP)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new UA)}addEventListener(o,l){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new dd),this.eventHandlers.get(o).add(l)}notifyListeners(o,...l){const c=this.eventHandlers.get(o);c&&c.notify(...l)}hasListeners(o){return this.eventHandlers.has(o)}mount(o){if(this.instance)return;this.isSVG=uj(o)&&!G4(o),this.instance=o;const{layoutId:l,layout:c,visualElement:d}=this.options;if(d&&!d.current&&d.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(c||l)&&(this.isLayoutDirty=!0),t){let u,m=0;const h=()=>this.root.updateBlockedByResize=!1;Pe.read(()=>{m=window.innerWidth}),t(o,()=>{const p=window.innerWidth;p!==m&&(m=p,this.root.updateBlockedByResize=!0,u&&u(),u=VA(h,250),ka.hasAnimatedSinceResize&&(ka.hasAnimatedSinceResize=!1,this.nodes.forEach(rh)))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&d&&(l||c)&&this.addEventListener("didUpdate",({delta:u,hasLayoutChanged:m,hasRelativeLayoutChanged:h,layout:p})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const j=this.options.transition||d.getDefaultTransition()||fP,{onLayoutAnimationStart:y,onLayoutAnimationComplete:x}=d.getProps(),g=!this.targetLayout||!Hj(this.targetLayout,p),b=!m&&h;if(this.options.layoutRoot||this.resumeFrom||b||m&&(g||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const v={...Nd(j,"layout"),onPlay:y,onComplete:x};(d.shouldReduceMotion||this.options.layoutRoot)&&(v.delay=0,v.type=!1),this.startAnimation(v),this.setAnimationOrigin(u,b)}else m||rh(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=p})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),an(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(uP),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Qj(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const m=this.path[u];m.shouldResetTransform=!0,m.updateScroll("snapshot"),m.options.layoutRoot&&m.willUpdate(!1)}const{layoutId:l,layout:c}=this.options;if(l===void 0&&!c)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(nh);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(ih);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(lP),this.nodes.forEach(nP),this.nodes.forEach(iP)):this.nodes.forEach(ih),this.clearAllSnapshots();const l=_t.now();at.delta=Ls(0,1e3/60,l-at.timestamp),at.timestamp=l,at.isProcessing=!0,cl.update.process(at),cl.preRender.process(at),cl.render.process(at),at.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,zd.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(oP),this.sharedNodes.forEach(mP)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Pe.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Pe.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!bt(this.snapshot.measuredBox.x)&&!bt(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Fe(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let l=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(l=!1),l&&this.instance){const c=i(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:c,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!r)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,l=this.projectionDelta&&!Gj(this.projectionDelta),c=this.getTransformTemplate(),d=c?c(this.latestValues,""):void 0,u=d!==this.prevTransformTemplateValue;o&&this.instance&&(l||gn(this.latestValues)||u)&&(r(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const l=this.measurePageBox();let c=this.removeElementScroll(l);return o&&(c=this.removeTransform(c)),xP(c),{animationId:this.root.animationId,measuredBox:l,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:o}=this.options;if(!o)return Fe();const l=o.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(gP))){const{scroll:d}=this.root;d&&(li(l.x,d.offset.x),li(l.y,d.offset.y))}return l}removeElementScroll(o){const l=Fe();if(Vt(l,o),this.scroll?.wasRoot)return l;for(let c=0;c<this.path.length;c++){const d=this.path[c],{scroll:u,options:m}=d;d!==this.root&&u&&m.layoutScroll&&(u.wasRoot&&Vt(l,o),li(l.x,u.offset.x),li(l.y,u.offset.y))}return l}applyTransform(o,l=!1){const c=Fe();Vt(c,o);for(let d=0;d<this.path.length;d++){const u=this.path[d];!l&&u.options.layoutScroll&&u.scroll&&u!==u.root&&ci(c,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),gn(u.latestValues)&&ci(c,u.latestValues)}return gn(this.latestValues)&&ci(c,this.latestValues),c}removeTransform(o){const l=Fe();Vt(l,o);for(let c=0;c<this.path.length;c++){const d=this.path[c];if(!d.instance||!gn(d.latestValues))continue;sc(d.latestValues)&&d.updateSnapshot();const u=Fe(),m=d.measurePageBox();Vt(u,m),Ym(l,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,u)}return gn(this.latestValues)&&Ym(l,this.latestValues),l}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==at.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==l;if(!(o||c&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:u,layoutId:m}=this.options;if(!(!this.layout||!(u||m))){if(this.resolvedRelativeTargetAt=at.timestamp,!this.targetDelta&&!this.relativeTarget){const h=this.getClosestProjectingParent();h&&h.layout&&this.animationProgress!==1?(this.relativeParent=h,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Fe(),this.relativeTargetOrigin=Fe(),pr(this.relativeTargetOrigin,this.layout.layoutBox,h.layout.layoutBox),Vt(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Fe(),this.targetWithTransforms=Fe()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),NA(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Vt(this.target,this.layout.layoutBox),_j(this.target,this.targetDelta)):Vt(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const h=this.getClosestProjectingParent();h&&!!h.resumingFrom==!!this.resumingFrom&&!h.options.layoutScroll&&h.target&&this.animationProgress!==1?(this.relativeParent=h,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Fe(),this.relativeTargetOrigin=Fe(),pr(this.relativeTargetOrigin,this.target,h.target),Vt(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||sc(this.parent.latestValues)||Cj(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const o=this.getLead(),l=!!this.resumingFrom||this!==o;let c=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===at.timestamp&&(c=!1),c)return;const{layout:d,layoutId:u}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(d||u))return;Vt(this.layoutCorrected,this.layout.layoutBox);const m=this.treeScale.x,h=this.treeScale.y;ET(this.layoutCorrected,this.treeScale,this.path,l),o.layout&&!o.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(o.target=o.layout.layoutBox,o.targetWithTransforms=Fe());const{target:p}=o;if(!p){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(Hm(this.prevProjectionDelta.x,this.projectionDelta.x),Hm(this.prevProjectionDelta.y,this.projectionDelta.y)),hr(this.projectionDelta,this.layoutCorrected,p,this.latestValues),(this.treeScale.x!==m||this.treeScale.y!==h||!sh(this.projectionDelta.x,this.prevProjectionDelta.x)||!sh(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",p))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){if(this.options.visualElement?.scheduleRender(),o){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=di(),this.projectionDelta=di(),this.projectionDeltaWithTransform=di()}setAnimationOrigin(o,l=!1){const c=this.snapshot,d=c?c.latestValues:{},u={...this.latestValues},m=di();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const h=Fe(),p=c?c.source:void 0,j=this.layout?this.layout.source:void 0,y=p!==j,x=this.getStack(),g=!x||x.members.length<=1,b=!!(y&&!g&&this.options.crossfade===!0&&!this.path.some(pP));this.animationProgress=0;let v;this.mixTargetDelta=C=>{const T=C/1e3;ah(m.x,o.x,T),ah(m.y,o.y,T),this.setTargetDelta(m),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(pr(h,this.layout.layoutBox,this.relativeParent.layout.layoutBox),hP(this.relativeTarget,this.relativeTargetOrigin,h,T),v&&JA(this.relativeTarget,v)&&(this.isProjectionDirty=!1),v||(v=Fe()),Vt(v,this.relativeTarget)),y&&(this.animationValues=u,WA(u,d,this.latestValues,T,b,g)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=T},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(an(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Pe.update(()=>{ka.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=Si(0)),this.currentAnimation=FA(this.motionValue,[0,1e3],{...o,velocity:0,isSync:!0,onUpdate:l=>{this.mixTargetDelta(l),o.onUpdate&&o.onUpdate(l)},onStop:()=>{},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(tP),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:l,target:c,layout:d,latestValues:u}=o;if(!(!l||!c||!d)){if(this!==o&&this.layout&&d&&Yj(this.options.animationType,this.layout.layoutBox,d.layoutBox)){c=this.target||Fe();const m=bt(this.layout.layoutBox.x);c.x.min=o.target.x.min,c.x.max=c.x.min+m;const h=bt(this.layout.layoutBox.y);c.y.min=o.target.y.min,c.y.max=c.y.min+h}Vt(l,c),ci(l,u),hr(this.projectionDeltaWithTransform,this.layoutCorrected,l,u)}}registerSharedNode(o,l){this.sharedNodes.has(o)||this.sharedNodes.set(o,new XA),this.sharedNodes.get(o).add(l);const d=l.options.initialPromotionConfig;l.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(l):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){const{layoutId:o}=this.options;return o?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:o}=this.options;return o?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:l,preserveFollowOpacity:c}={}){const d=this.getStack();d&&d.promote(this,c),o&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let l=!1;const{latestValues:c}=o;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(l=!0),!l)return;const d={};c.z&&bl("z",o,d,this.animationValues);for(let u=0;u<wl.length;u++)bl(`rotate${wl[u]}`,o,d,this.animationValues),bl(`skew${wl[u]}`,o,d,this.animationValues);o.render();for(const u in d)o.setStaticValue(u,d[u]),this.animationValues&&(this.animationValues[u]=d[u]);o.scheduleRender()}applyProjectionStyles(o,l){if(!this.instance||this.isSVG)return;if(!this.isVisible){o.visibility="hidden";return}const c=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,o.visibility="",o.opacity="",o.pointerEvents=Na(l?.pointerEvents)||"",o.transform=c?c(this.latestValues,""):"none";return}const d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){this.options.layoutId&&(o.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,o.pointerEvents=Na(l?.pointerEvents)||""),this.hasProjected&&!gn(this.latestValues)&&(o.transform=c?c({},""):"none",this.hasProjected=!1);return}o.visibility="";const u=d.animationValues||d.latestValues;this.applyTransformsToTarget();let m=eP(this.projectionDeltaWithTransform,this.treeScale,u);c&&(m=c(u,m)),o.transform=m;const{x:h,y:p}=this.projectionDelta;o.transformOrigin=`${h.origin*100}% ${p.origin*100}% 0`,d.animationValues?o.opacity=d===this?u.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:u.opacityExit:o.opacity=d===this?u.opacity!==void 0?u.opacity:"":u.opacityExit!==void 0?u.opacityExit:0;for(const j in Ir){if(u[j]===void 0)continue;const{correct:y,applyTo:x,isCSSVariable:g}=Ir[j],b=m==="none"?u[j]:y(u[j],d);if(x){const v=x.length;for(let C=0;C<v;C++)o[x[C]]=b}else g?this.options.visualElement.renderState.vars[j]=b:o[j]=b}this.options.layoutId&&(o.pointerEvents=d===this?Na(l?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>o.currentAnimation?.stop()),this.root.nodes.forEach(nh),this.root.sharedNodes.clear()}}}function nP(t){t.updateLayout()}function iP(t){const s=t.resumeFrom?.snapshot||t.snapshot;if(t.isLead()&&t.layout&&s&&t.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:i}=t.layout,{animationType:r}=t.options,a=s.source!==t.layout.source;r==="size"?Kt(u=>{const m=a?s.measuredBox[u]:s.layoutBox[u],h=bt(m);m.min=n[u].min,m.max=m.min+h}):Yj(r,s.layoutBox,n)&&Kt(u=>{const m=a?s.measuredBox[u]:s.layoutBox[u],h=bt(n[u]);m.max=m.min+h,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[u].max=t.relativeTarget[u].min+h)});const o=di();hr(o,n,s.layoutBox);const l=di();a?hr(l,t.applyTransform(i,!0),s.measuredBox):hr(l,n,s.layoutBox);const c=!Gj(o);let d=!1;if(!t.resumeFrom){const u=t.getClosestProjectingParent();if(u&&!u.resumeFrom){const{snapshot:m,layout:h}=u;if(m&&h){const p=Fe();pr(p,s.layoutBox,m.layoutBox);const j=Fe();pr(j,n,h.layoutBox),Hj(p,j)||(d=!0),u.options.layoutRoot&&(t.relativeTarget=j,t.relativeTargetOrigin=p,t.relativeParent=u)}}}t.notifyListeners("didUpdate",{layout:n,snapshot:s,delta:l,layoutDelta:o,hasLayoutChanged:c,hasRelativeLayoutChanged:d})}else if(t.isLead()){const{onExitComplete:n}=t.options;n&&n()}t.options.transition=void 0}function rP(t){t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function aP(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function oP(t){t.clearSnapshot()}function nh(t){t.clearMeasurements()}function ih(t){t.isLayoutDirty=!1}function lP(t){const{visualElement:s}=t.options;s&&s.getProps().onBeforeLayoutMeasure&&s.notify("BeforeLayoutMeasure"),t.resetTransform()}function rh(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function cP(t){t.resolveTargetDelta()}function dP(t){t.calcProjection()}function uP(t){t.resetSkewAndRotation()}function mP(t){t.removeLeadSnapshot()}function ah(t,s,n){t.translate=Ee(s.translate,0,n),t.scale=Ee(s.scale,1,n),t.origin=s.origin,t.originPoint=s.originPoint}function oh(t,s,n,i){t.min=Ee(s.min,n.min,i),t.max=Ee(s.max,n.max,i)}function hP(t,s,n,i){oh(t.x,s.x,n.x,i),oh(t.y,s.y,n.y,i)}function pP(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const fP={duration:.45,ease:[.4,0,.1,1]},lh=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),ch=lh("applewebkit/")&&!lh("chrome/")?Math.round:Yt;function dh(t){t.min=ch(t.min),t.max=ch(t.max)}function xP(t){dh(t.x),dh(t.y)}function Yj(t,s,n){return t==="position"||t==="preserve-aspect"&&!vA(th(s),th(n),.2)}function gP(t){return t!==t.root&&t.scroll?.wasRoot}const jP=Zj({attachResizeListener:(t,s)=>Er(t,"resize",s),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),vl={current:void 0},Jj=Zj({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!vl.current){const t=new jP({});t.mount(window),t.setOptions({layoutScroll:!0}),vl.current=t}return vl.current},resetTransform:(t,s)=>{t.style.transform=s!==void 0?s:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),yP={pan:{Feature:RA},drag:{Feature:LA,ProjectionNode:Jj,MeasureLayout:Vj}};function uh(t,s,n){const{props:i}=t;t.animationState&&i.whileHover&&t.animationState.setActive("whileHover",n==="Start");const r="onHover"+n,a=i[r];a&&Pe.postRender(()=>a(s,Xr(s)))}class wP extends pn{mount(){const{current:s}=this.node;s&&(this.unmount=B4(s,(n,i)=>(uh(this.node,i,"Start"),r=>uh(this.node,r,"End"))))}unmount(){}}class bP extends pn{constructor(){super(...arguments),this.isActive=!1}onFocus(){let s=!1;try{s=this.node.current.matches(":focus-visible")}catch{s=!0}!s||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Zr(Er(this.node.current,"focus",()=>this.onFocus()),Er(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function mh(t,s,n){const{props:i}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&i.whileTap&&t.animationState.setActive("whileTap",n==="Start");const r="onTap"+(n==="End"?"":n),a=i[r];a&&Pe.postRender(()=>a(s,Xr(s)))}class vP extends pn{mount(){const{current:s}=this.node;s&&(this.unmount=W4(s,(n,i)=>(mh(this.node,i,"Start"),(r,{success:a})=>mh(this.node,r,a?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const cc=new WeakMap,Nl=new WeakMap,NP=t=>{const s=cc.get(t.target);s&&s(t)},kP=t=>{t.forEach(NP)};function zP({root:t,...s}){const n=t||document;Nl.has(n)||Nl.set(n,{});const i=Nl.get(n),r=JSON.stringify(s);return i[r]||(i[r]=new IntersectionObserver(kP,{root:t,...s})),i[r]}function SP(t,s,n){const i=zP(s);return cc.set(t,n),i.observe(t),()=>{cc.delete(t),i.unobserve(t)}}const CP={some:0,all:1};class _P extends pn{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:s={}}=this.node.getProps(),{root:n,margin:i,amount:r="some",once:a}=s,o={root:n?n.current:void 0,rootMargin:i,threshold:typeof r=="number"?r:CP[r]},l=c=>{const{isIntersecting:d}=c;if(this.isInView===d||(this.isInView=d,a&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:u,onViewportLeave:m}=this.node.getProps(),h=d?u:m;h&&h(c)};return SP(this.node.current,o,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:s,prevProps:n}=this.node;["amount","margin","root"].some(TP(s,n))&&this.startObserver()}unmount(){}}function TP({viewport:t={}},{viewport:s={}}={}){return n=>t[n]!==s[n]}const AP={inView:{Feature:_P},tap:{Feature:vP},focus:{Feature:bP},hover:{Feature:wP}},PP={layout:{ProjectionNode:Jj,MeasureLayout:Vj}},DP={...xA,...AP,...yP,...PP},qe=DT(DP,KT),Oo={normal:.3,slow:.5},MP={stagger:.05},IP={default:[.4,0,.2,1]},EP={hidden:{opacity:0,y:20},visible:(t=0)=>({opacity:1,y:0,transition:{delay:t*MP.stagger,duration:Oo.normal,ease:IP.default}})},LP=(t,s=Oo.slow)=>{const[n,i]=re.useState(0),r=re.useRef(0);return re.useEffect(()=>{const a=r.current,o=t,l=Date.now(),c=()=>{const d=(Date.now()-l)/1e3,u=Math.min(d/s,1),m=1-Math.pow(1-u,3),h=Math.floor(a+(o-a)*m);i(h),u<1?requestAnimationFrame(c):r.current=o};requestAnimationFrame(c)},[t,s]),n},Ui=({children:t,index:s=0,className:n="",...i})=>e.jsx(qe.div,{variants:EP,initial:"hidden",animate:"visible",custom:s,className:n,...i,children:t}),In=({value:t,className:s="bg-gray-100 rounded-full overflow-hidden",barClassName:n="h-full bg-gray-900",height:i="h-2"})=>e.jsx("div",{className:`${i} ${s}`,children:e.jsx(qe.div,{initial:{width:0},animate:{width:`${t}%`},transition:{duration:Oo.slow,ease:"easeOut"},className:n})}),ot=({value:t,className:s="",duration:n=Oo.slow,prefix:i="",suffix:r=""})=>{const a=LP(t,n);return e.jsxs("span",{className:s,children:[i,a.toLocaleString("pl-PL"),r]})},RP=()=>e.jsxs("div",{className:"rounded-2xl border bg-card p-5 shadow-soft animate-pulse",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"h-8 w-8 rounded-md bg-muted/70"}),e.jsx("div",{className:"h-4 w-40 rounded bg-muted/70"})]}),e.jsx("div",{className:"h-5 w-16 rounded-full bg-muted/70"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"h-2 w-full rounded-full bg-muted/60"}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsx("div",{className:"h-3 w-16 rounded bg-muted/60"}),e.jsx("div",{className:"h-3 w-20 rounded bg-muted/60"})]})]}),e.jsx("div",{className:"mt-4 h-9 w-2/3 rounded-lg bg-muted/60"}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsx("div",{className:"h-6 w-16 rounded bg-muted/60"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"h-9 w-24 rounded-lg bg-muted/60"}),e.jsx("div",{className:"h-9 w-10 rounded-lg bg-muted/60"})]})]})]}),OP=()=>{const t=le(),{data:s}=Ye(),{stats:n,refetch:i}=Bn(),{data:r,isLoading:a}=Qr("get_my_courses"),[o,l]=re.useState(0),c=r||[],d=!a&&c.length===0;re.useEffect(()=>{const m=async()=>{try{const{data:p}=await ee.rpc("check_claimable_rewards");l(p?.claimable_points||0)}catch{}};m();const h=setInterval(m,3e4);return()=>clearInterval(h)},[]);const u=async()=>{try{const{data:m,error:h}=await ee.rpc("claim_daily_rewards");if(h)throw h;m&&(W.success(`Odebrano ${m.total_earned} punktów`),i(),l(0))}catch{W.error("Nie można odebrać nagród")}};return e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8 pb-24 lg:pb-8",children:[e.jsxs(qe.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.45},className:"relative overflow-hidden rounded-2xl border",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/[0.12] via-secondary/[0.10] to-accent/[0.12]"}),e.jsx("div",{className:"absolute inset-0 opacity-[0.06]",style:{backgroundImage:`
                linear-gradient(to right, hsl(var(--ring)/0.35) 1px, transparent 1px),
                linear-gradient(to bottom, hsl(var(--ring)/0.35) 1px, transparent 1px)
              `,backgroundSize:"28px 28px"}})]}),e.jsxs("div",{className:"relative z-10 p-4 sm:p-6 md:p-8",children:[e.jsxs("div",{className:"space-y-6 md:hidden",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-xl font-bold tracking-tight",children:"Twoje tempo nauki"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.streak>0&&e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full border bg-background/60 px-3 py-1.5 shadow-soft",children:[e.jsx(gs,{className:"h-4 w-4 text-destructive"}),e.jsxs("span",{className:"text-sm font-medium",children:["Seria: ",e.jsx("span",{className:"tabular-nums",children:n.streak})," ","dni"]})]}),o>0&&e.jsxs("button",{onClick:u,className:"inline-flex items-center gap-2 rounded-lg bg-primary px-3 py-1.5 text-sm text-primary-foreground hover:bg-primary/90 focus-ring",children:[e.jsx(Gd,{className:"h-4 w-4"}),"Odbierz ",o," pkt"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:"rounded-xl border bg-card p-4 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Punkty"}),e.jsx(ct,{className:"h-4 w-4 text-primary"})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("span",{className:"text-3xl font-semibold tabular-nums text-primary leading-none",children:e.jsx(ot,{value:n.points})}),e.jsx("span",{className:"mb-1 text-sm text-muted-foreground",children:"pkt"})]}),e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:["+",e.jsx(ot,{value:n.idle_rate}),"/h"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded-xl border bg-card p-4 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Poziom"}),e.jsx(_n,{className:"h-4 w-4 text-secondary"})]}),e.jsx("span",{className:"text-2xl font-semibold text-secondary",children:n.level}),e.jsx("div",{className:"mt-2 h-1.5 w-full rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-secondary transition-all",style:{width:`${n.points%100}%`}})})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-4 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Premia"}),e.jsx(st,{className:"h-4 w-4 text-accent"})]}),e.jsxs("span",{className:"text-2xl font-semibold text-accent",children:["+",e.jsx(ot,{value:n.idle_rate})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"pkt/h"})]})]})]})]}),e.jsxs("div",{className:"hidden md:grid gap-8 md:grid-cols-12 md:items-center",children:[e.jsxs("div",{className:"md:col-span-4 space-y-4",children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Twoje tempo nauki"}),n.streak>0&&e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full border bg-background/60 px-3 py-1.5 shadow-soft",children:[e.jsx(gs,{className:"h-4 w-4 text-destructive"}),e.jsxs("span",{className:"text-sm font-medium",children:["Seria: ",e.jsx("span",{className:"tabular-nums",children:n.streak})," ","dni"]})]}),o>0&&e.jsxs("button",{onClick:u,className:"inline-flex items-center gap-2 rounded-lg bg-primary px-4 py-2 text-primary-foreground hover:bg-primary/90 focus-ring",children:[e.jsx(Gd,{className:"h-4 w-4"}),"Odbierz ",o," pkt"]})]}),e.jsx("div",{className:"md:col-span-8",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 md:gap-6",children:[e.jsxs("div",{className:"rounded-xl border bg-card p-5 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Punkty"}),e.jsx(ct,{className:"h-4 w-4 text-primary"})]}),e.jsxs("div",{className:"mt-2 flex items-end gap-2",children:[e.jsx("span",{className:"text-4xl md:text-5xl font-semibold tabular-nums text-primary leading-none",children:e.jsx(ot,{value:n.points})}),e.jsx("span",{className:"mb-[2px] text-sm text-muted-foreground",children:"pkt"})]}),e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:["+",e.jsx(ot,{value:n.idle_rate}),"/h"]})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-5 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Poziom"}),e.jsx(_n,{className:"h-4 w-4 text-secondary"})]}),e.jsx("div",{className:"mt-2 flex items-center gap-2",children:e.jsx("span",{className:"text-4xl md:text-5xl font-semibold text-secondary leading-none",children:n.level})}),e.jsx("div",{className:"mt-3 h-2 w-full rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-secondary transition-all",style:{width:`${n.points%100}%`}})}),e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:["Do kolejnego: ",100-n.points%100," pkt"]})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-5 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Premia"}),e.jsx(st,{className:"h-4 w-4 text-accent"})]}),e.jsxs("div",{className:"mt-2 flex items-end gap-2",children:[e.jsxs("span",{className:"text-4xl md:text-5xl font-semibold text-accent leading-none",children:["+",e.jsx(ot,{value:n.idle_rate})]}),e.jsx("span",{className:"mb-[2px] text-sm text-muted-foreground",children:"pkt/h"})]}),e.jsx("button",{onClick:()=>t("/student/gamification"),className:"mt-3 w-full rounded-lg border px-3 py-2 hover:bg-primary/5 focus-ring",children:"Gamifikacja"})]})]})})]})]})]}),e.jsxs(qe.section,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.4,delay:.05},className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-lg sm:text-xl md:text-2xl font-semibold tracking-tight",children:"Twoje kursy"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"To jest Twoja główna ścieżka — kontynuuj naukę tam, gdzie skończyłeś."})]}),e.jsxs("button",{onClick:()=>t("/student/courses"),className:"inline-flex items-center gap-1 sm:gap-2 rounded-lg border px-2 sm:px-3 py-1.5 sm:py-2 text-sm hover:bg-primary/5 focus-ring whitespace-nowrap",children:[e.jsx("span",{className:"hidden sm:inline",children:"Zobacz wszystkie"}),e.jsx("span",{className:"sm:hidden",children:"Wszystkie"}),e.jsx(Ce,{className:"h-4 w-4"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-5",children:[a&&Array.from({length:6}).map((m,h)=>e.jsx(RP,{},h)),!a&&c.slice(0,9).map(m=>{const h=m.progress_percent===100;return e.jsxs("div",{className:"group relative rounded-2xl border bg-card p-4 sm:p-5 shadow-soft hover:bg-muted/40 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("span",{className:"text-2xl sm:text-3xl shrink-0 leading-none",children:m.icon_emoji||"📚"}),e.jsx("h4",{className:"font-semibold text-sm sm:text-base text-foreground line-clamp-2",children:m.title})]}),h?e.jsx("span",{className:"inline-flex items-center gap-1 rounded-full border border-green-600/30 bg-green-500/10 text-green-700 dark:text-green-400 px-2 sm:px-2.5 py-0.5 sm:py-1 text-[10px] sm:text-[11px] font-semibold",children:"Ukończono"}):e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-primary/30 text-primary px-2 sm:px-2.5 py-0.5 sm:py-1 text-[10px] sm:text-[11px] font-semibold",children:[m.progress_percent,"%"]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"h-2 w-full rounded-full bg-muted",children:e.jsx("div",{className:`h-full rounded-full transition-all ${h?"bg-green-600":"bg-primary"}`,style:{width:`${m.progress_percent||0}%`}})}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"Ukończono"}),e.jsxs("span",{className:"font-medium text-foreground",children:[m.completed_lessons||0,"/",m.total_lessons||10," lekcji"]})]})]}),m.next_activity&&e.jsxs("div",{className:"mt-3 sm:mt-4 flex items-center gap-2 rounded-lg border bg-background/60 px-2.5 sm:px-3 py-1.5 sm:py-2",children:[e.jsx(Mw,{className:"h-3.5 sm:h-4 w-3.5 sm:w-4 text-primary"}),e.jsx("p",{className:"text-xs sm:text-sm font-medium truncate",children:m.next_activity})]}),e.jsxs("div",{className:"mt-3 sm:mt-4 flex items-center justify-between",children:[m.points_available?e.jsxs("span",{className:"inline-flex rounded-md bg-orange-500/10 text-[10px] sm:text-[11px] font-semibold px-2 py-0.5 sm:py-1 text-orange-600",children:["+",m.points_available," pkt"]}):e.jsx("span",{}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>t(`/student/courses/${m.course_id}`),className:"rounded-lg bg-primary px-3 sm:px-4 py-1.5 sm:py-2 text-sm text-primary-foreground hover:bg-primary/90 focus-ring",children:"Kontynuuj"}),e.jsx("button",{onClick:()=>t(`/student/courses/${m.course_id}`),className:"rounded-lg border px-2.5 sm:px-3 py-1.5 sm:py-2 hover:bg-primary/5 focus-ring",title:"Szczegóły",children:e.jsx(Ce,{className:"h-3.5 sm:h-4 w-3.5 sm:w-4"})})]})]})]},m.course_id)}),d&&e.jsxs("div",{className:"col-span-full rounded-2xl border bg-card p-8 sm:p-10 text-center shadow-soft",children:[e.jsx("div",{className:"text-4xl sm:text-5xl",children:"🚀"}),e.jsx("h4",{className:"mt-3 sm:mt-4 text-base sm:text-lg font-semibold",children:"Zacznij swoją przygodę"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:"Dołącz do kursu i odkryj nowy sposób nauki."}),e.jsx("button",{onClick:()=>t("/student/courses"),className:"mt-4 sm:mt-6 rounded-lg bg-secondary px-4 sm:px-5 py-2 sm:py-2.5 text-sm text-white hover:opacity-95 focus-ring",children:"Odkryj kursy"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"rounded-xl border bg-card/70 backdrop-blur-sm p-4 sm:p-5 shadow-md",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground font-medium",children:"Punkty"}),e.jsx(ct,{className:"h-3.5 sm:h-4 w-3.5 sm:w-4 text-primary"})]}),e.jsx("p",{className:"mt-1.5 text-xl sm:text-2xl font-semibold tabular-nums text-foreground",children:e.jsx(ot,{value:n.points})}),e.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:["+",e.jsx(ot,{value:n.idle_rate}),"/h"]})]}),e.jsxs("div",{className:"rounded-xl border bg-card/70 backdrop-blur-sm p-4 sm:p-5 shadow-md",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground font-medium",children:"Poziom"}),e.jsx(Ve,{className:"h-3.5 sm:h-4 w-3.5 sm:w-4 text-secondary"})]}),e.jsx("p",{className:"mt-1.5 text-xl sm:text-2xl font-semibold text-foreground",children:n.level}),e.jsx("div",{className:"mt-2 sm:mt-3",children:e.jsx(In,{value:n.points%100})})]}),e.jsxs("div",{className:"rounded-xl border bg-card/70 backdrop-blur-sm p-4 sm:p-5 shadow-md",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground font-medium",children:"Seria dni"}),e.jsx(gs,{className:"h-3.5 sm:h-4 w-3.5 sm:w-4 text-destructive"})]}),e.jsx("p",{className:"mt-1.5 text-xl sm:text-2xl font-semibold text-foreground",children:e.jsx(ot,{value:n.streak})}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:"dni z rzędu"})]}),e.jsxs("div",{className:"rounded-xl border bg-card/70 backdrop-blur-sm p-4 sm:p-5 shadow-md",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground font-medium",children:"Tempo"}),e.jsx(st,{className:"h-3.5 sm:h-4 w-3.5 sm:w-4 text-accent"})]}),e.jsxs("p",{className:"mt-1.5 text-xl sm:text-2xl font-semibold text-foreground",children:["+",e.jsx(ot,{value:n.idle_rate})]}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:"punktów/h"})]})]})]})},$P=[e.jsx(H,{path:"dashboard",element:e.jsx(OP,{})},"dashboard")],qP=()=>{const t=le(),{data:s}=Qr("get_my_courses"),n=s||[];return e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8 pb-24 lg:pb-8",children:[e.jsxs(qe.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.45},className:"relative overflow-hidden rounded-2xl border",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0",children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/[0.12] via-secondary/[0.10] to-accent/[0.12]"})}),e.jsxs("div",{className:"relative z-10 p-4 sm:p-6 md:p-8",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Twoje kursy"}),e.jsx("p",{className:"mt-2 text-sm md:text-base text-muted-foreground",children:"Wybierz kurs i kontynuuj naukę w swoim tempie."})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-5",children:n.map((i,r)=>e.jsxs(Ui,{index:r,className:"group relative rounded-2xl border bg-card p-4 sm:p-5 shadow-soft hover:bg-muted/40 transition-colors cursor-pointer",onClick:()=>t(`/student/courses/${i.course_id}`),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("span",{className:"text-2xl sm:text-3xl shrink-0 leading-none",children:i.icon_emoji||"📚"}),e.jsx("h4",{className:"font-semibold text-sm sm:text-base text-foreground line-clamp-2",children:i.title})]}),e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-primary/30 text-primary px-2 sm:px-2.5 py-0.5 sm:py-1 text-[10px] sm:text-[11px] font-semibold",children:[i.progress_percent,"%"]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(In,{value:i.progress_percent})}),e.jsxs("button",{className:"mt-4 inline-flex items-center gap-1 text-sm font-medium text-primary",children:["Kontynuuj",e.jsx(Ce,{className:"h-4 w-4"})]})]},i.course_id))})]})},FP=[e.jsx(H,{path:"/courses",element:e.jsx(qP,{})},"courses-list")],BP=()=>e.jsxs("div",{className:"rounded-2xl border bg-card p-5 md:p-6 shadow-soft animate-pulse",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-muted/60"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-5 w-1/2 rounded bg-muted/60"}),e.jsx("div",{className:"h-4 w-3/4 rounded bg-muted/60"})]}),e.jsx("div",{className:"h-9 w-36 rounded-lg bg-muted/60"})]}),e.jsxs("div",{className:"mt-5",children:[e.jsx("div",{className:"h-2 w-full rounded-full bg-muted/60"}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsx("div",{className:"h-3 w-16 rounded bg-muted/60"}),e.jsx("div",{className:"h-3 w-10 rounded bg-muted/60"})]})]})]}),UP=()=>e.jsxs("div",{className:"rounded-2xl border bg-card p-4 md:p-5 shadow-soft animate-pulse",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-muted/60"}),e.jsx("div",{className:"h-4 w-2/5 rounded bg-muted/60"})]}),e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((t,s)=>e.jsx("div",{className:"h-14 rounded-xl border bg-muted/40"},s))})]}),VP=()=>{const{courseId:t}=ft(),s=le(),{data:n,isLoading:i}=Qr("get_course_structure",{p_course_id:parseInt(t)},{enabled:!!t}),{data:r}=ZC("courses",{filters:[{field:"id",operator:"eq",value:parseInt(t)}],enabled:!!t}),a=re.useMemo(()=>{if(!n)return[];const d=n.reduce((h,p)=>{const j=`${p.topic_id}-${p.topic_title}`;return h[j]||(h[j]={id:p.topic_id,title:p.topic_title,position:p.topic_position,activities:[]}),p.activity_id&&h[j].activities.push({id:p.activity_id,title:p.activity_title,type:p.activity_type,position:p.activity_position,completed:p.is_completed,score:p.score}),h},{}),u=Object.values(d).sort((h,p)=>h.position-p.position);let m=!1;return u.map((h,p)=>{const j=h.activities.length>0&&h.activities.every(x=>x.completed),y=p===0||u[p-1].activities.length>0&&u[p-1].activities.every(x=>x.completed);return h.activities.sort((x,g)=>x.position-g.position),h.activities=h.activities.map(x=>{let g=!1;return x.completed?g=!0:y&&!m&&(g=!0,m=!0),{...x,isUnlocked:g}}),{...h,isCompleted:j,isUnlocked:y}})},[n]),o=re.useMemo(()=>{const d=a.flatMap(h=>h.activities),u=d.filter(h=>h.completed).length,m=d.length;return{totalActivities:m,completedActivities:u,progress:m>0?Math.round(u/m*100):0}},[a]),l=r?.[0],c=re.useMemo(()=>{for(const d of a){const u=d.activities.find(m=>!m.completed&&m.isUnlocked);if(u)return{topicId:d.id,activity:u,path:u.type==="quiz"?`/student/courses/${t}/quiz/${u.id}`:`/student/courses/${t}/lesson/${u.id}`}}return null},[a,t]);return i?e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8",children:[e.jsxs("button",{className:"inline-flex items-center gap-2 text-muted-foreground cursor-default",disabled:!0,children:[e.jsx(Ne,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Powrót"})]}),e.jsx(BP,{}),e.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((d,u)=>e.jsx(UP,{},u))})]}):l?e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8 pb-24 lg:pb-8",children:[e.jsxs("button",{onClick:()=>s("/student/dashboard#courses"),className:"flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx(Ne,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Powrót"})]}),e.jsxs(qe.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.45},className:"relative overflow-hidden rounded-2xl border",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/[0.12] via-secondary/[0.10] to-accent/[0.12]"}),e.jsx("div",{className:"absolute inset-0 opacity-[0.06]",style:{backgroundImage:`
                linear-gradient(to right, hsl(var(--ring)/0.35) 1px, transparent 1px),
                linear-gradient(to bottom, hsl(var(--ring)/0.35) 1px, transparent 1px)
              `,backgroundSize:"28px 28px"}})]}),e.jsx("div",{className:"relative z-10 p-4 sm:p-6 md:p-8",children:e.jsxs("div",{className:"grid md:grid-cols-12 gap-6 md:items-center",children:[e.jsxs("div",{className:"md:col-span-7 flex items-start gap-4 min-w-0",children:[e.jsx("div",{className:"text-5xl md:text-6xl leading-none shrink-0",children:l.icon_emoji||"📚"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-xl md:text-3xl font-bold tracking-tight",children:l.title}),l.description&&e.jsx("p",{className:"mt-2 text-sm md:text-base text-muted-foreground line-clamp-3",children:l.description}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border bg-background/60 px-3 py-1.5 shadow-soft",children:[e.jsx(De,{className:"h-4 w-4"}),e.jsxs("span",{className:"text-sm font-medium",children:["Ukończone:"," ",e.jsx("span",{className:"tabular-nums",children:e.jsx(ot,{value:o.completedActivities})}),"/",o.totalActivities]})]}),o.progress===100&&e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-green-600/30 bg-green-500/10 text-green-700 dark:text-green-400 px-3 py-1.5 shadow-soft text-sm font-semibold",children:[e.jsx($t,{className:"h-4 w-4"}),"Kurs ukończony"]})]})]})]}),e.jsx("div",{className:"md:col-span-5",children:e.jsxs("div",{className:"rounded-xl border bg-card p-4 md:p-5 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Postęp kursu"}),e.jsxs("span",{className:"text-sm font-semibold",children:[o.progress,"%"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx(In,{value:o.progress})}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[c?e.jsxs("button",{onClick:()=>s(c.path),className:"flex-1 inline-flex items-center justify-center gap-2 rounded-lg bg-primary px-4 py-2 text-primary-foreground hover:bg-primary/90 focus-ring",children:["Kontynuuj",e.jsx(Ce,{className:"h-4 w-4"})]}):e.jsx("button",{disabled:!0,className:"flex-1 rounded-lg border px-4 py-2 text-muted-foreground cursor-default",title:"Brak kolejnej aktywności",children:"Wszystko ukończone"}),e.jsx("button",{onClick:()=>s("/student/courses"),className:"rounded-lg border px-3 py-2 hover:bg-primary/5 focus-ring",title:"Wróć do listy",children:e.jsx(Ne,{className:"h-4 w-4"})})]})]})})]})})]}),e.jsx("div",{className:"space-y-6",children:a.map((d,u)=>e.jsxs(Ui,{index:u,className:U("relative rounded-2xl border bg-card p-4 md:p-5 shadow-soft",!d.isUnlocked&&"opacity-60"),children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-3 md:mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:U("w-10 h-10 rounded-full flex items-center justify-center",d.isCompleted?"bg-green-600 text-white":d.isUnlocked?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground"),"aria-label":d.isCompleted?"Temat ukończony":d.isUnlocked?"Temat odblokowany":"Temat zablokowany",children:d.isCompleted?e.jsx($t,{className:"w-5 h-5"}):d.isUnlocked?e.jsx("span",{className:"font-semibold",children:d.position}):e.jsx(ui,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-base md:text-lg font-semibold text-foreground",children:d.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[d.activities.filter(m=>m.completed).length," ","z ",d.activities.length," ukończonych"]})]})]}),e.jsx("div",{className:"hidden md:block w-40",children:e.jsx(In,{value:d.activities.length?Math.round(d.activities.filter(m=>m.completed).length/d.activities.length*100):0})})]}),e.jsx("div",{className:"mt-3 md:mt-4 space-y-3",children:d.activities.map(m=>{const h=m.type==="quiz",p=m.type==="quiz"?`/student/courses/${t}/quiz/${m.id}`:`/student/courses/${t}/lesson/${m.id}`;return e.jsxs(qe.button,{whileHover:m.isUnlocked?{x:2}:{},whileTap:m.isUnlocked?{scale:.98}:{},onClick:()=>{m.isUnlocked&&s(p)},disabled:!m.isUnlocked,className:U("w-full flex items-center justify-between p-4 rounded-xl border transition-colors focus-ring",m.isUnlocked?"bg-background/60 hover:bg-primary/5":"bg-muted/40 cursor-not-allowed"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:U("w-8 h-8 rounded-lg flex items-center justify-center shrink-0",h?m.isUnlocked?"bg-purple-100":"bg-muted":m.isUnlocked?"bg-blue-100":"bg-muted"),children:m.isUnlocked?h?e.jsx(ct,{className:"w-4 h-4 text-purple-600"}):e.jsx(De,{className:"w-4 h-4 text-blue-600"}):e.jsx(ui,{className:"w-4 h-4 text-muted-foreground"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:U("font-medium",m.isUnlocked?"text-foreground":"text-muted-foreground"),children:m.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[h?"Quiz":"Materiał",m.score!==null&&` • ${m.score}%`,!m.isUnlocked&&" • Zablokowane"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[!m.completed&&m.isUnlocked&&e.jsx("span",{className:"hidden sm:inline text-xs text-muted-foreground",children:"Przejdź"}),m.completed?e.jsx($t,{className:"w-5 h-5 text-green-600"}):m.isUnlocked?e.jsx(Ce,{className:"w-5 h-5 text-muted-foreground"}):e.jsx(ui,{className:"w-4 h-4 text-muted-foreground"})]})]},m.id)})})]},d.id))})]}):e.jsxs("div",{className:"container mx-auto px-4 py-12 text-center",children:[e.jsx("div",{className:"text-5xl",children:"🤷‍♂️"}),e.jsx("h2",{className:"mt-3 text-xl font-semibold",children:"Nie znaleziono kursu"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Spróbuj wrócić do listy kursów i wybrać ponownie."}),e.jsx("button",{onClick:()=>s("/student/courses"),className:"mt-6 rounded-lg bg-primary px-4 py-2 text-primary-foreground hover:bg-primary/90 focus-ring",children:"Przejdź do kursów"})]})},KP=[e.jsx(H,{path:"/courses/:courseId",element:e.jsx(VP,{})},"course-detail")],hh=t=>t.toLowerCase().replace(/[^\p{Letter}\p{Number}]+/gu,"-").replace(/(^-|-$)/g,"")||"sekcja",WP=(t,s)=>{const n=t.split(/\n(?=##\s+)/g);return n.length<=1&&!/^##\s+/.test(t)?[{id:hh(s||"Sekcja 1"),title:s||"Sekcja 1",content:t}]:n.map((i,r)=>{const o=(i.match(/^##\s+(.+?)\s*$/m)?.[1]||`Sekcja ${r+1}`).trim(),l=i.replace(/^##\s+.+?\n/,"").trim();return{id:hh(o),title:o,content:l}})},GP=/```quiz\s*?\n([\s\S]*?)```/g,HP=(t,s,n)=>{try{const i=Zf.parse(t),r=(i?.options||[]).map(String);return!i?.question||!Array.isArray(i?.options)||typeof i?.answerIndex!="number"||i.answerIndex<0||i.answerIndex>=r.length?null:{question:i.question,options:r,answerIndex:i.answerIndex,key:`${s}:${n}`}}catch{return null}},QP=t=>new Map(t.map(s=>[s.id,[...s.content.matchAll(GP)].map((n,i)=>HP(n[1],s.id,i)).filter(Boolean)])),ph=(t,s)=>{const[n,i]=re.useState(()=>{try{const r=localStorage.getItem(t);return r?JSON.parse(r):s}catch{return s}});return re.useEffect(()=>{try{localStorage.setItem(t,JSON.stringify(n))}catch(r){console.error("Błąd zapisu do localStorage:",r)}},[t,n]),[n,i]},ZP=()=>{const t=re.useRef(null);return{ref:t,say:n=>{t.current&&(t.current.textContent="",setTimeout(()=>t.current&&(t.current.textContent=n),30))}}},YP=()=>e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6",children:[e.jsx("div",{className:"h-5 w-24 rounded bg-muted/60"}),e.jsxs("div",{className:"rounded-2xl border bg-card p-6 shadow-soft animate-pulse",children:[e.jsx("div",{className:"h-6 w-2/3 rounded bg-muted/60 mb-2"}),e.jsx("div",{className:"h-4 w-40 rounded bg-muted/60"})]}),e.jsx("div",{className:"space-y-3",children:Array.from({length:10}).map((t,s)=>e.jsx("div",{className:"h-4 w-full rounded bg-muted/50"},s))}),e.jsx("div",{className:"h-10 w-48 rounded-lg bg-muted/60 ml-auto"})]}),fh={code:({inline:t,className:s="",children:n,...i})=>{const r=(s||"").toLowerCase();return!t&&r.includes("language-quiz")?null:e.jsx("code",{className:s,...i,children:n})},pre:t=>((Array.isArray(t.children)?t.children[0]:t.children)?.props?.className?.toLowerCase?.()||"").includes("language-quiz")?null:e.jsx("pre",{...t})},JP=({quiz:t,onClose:s,onPass:n})=>{const[i,r]=re.useState(null),[a,o]=re.useState(!1),l=()=>{const c=i!==null&&i===t.answerIndex;o(c),c?(W.success("Poprawna odpowiedź!"),setTimeout(n,200)):W.error("Niepoprawna odpowiedź — spróbuj ponownie.")};return e.jsxs("div",{className:"fixed inset-0 z-[90] flex items-end sm:items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:s}),e.jsxs("div",{className:"relative z-[91] w-full sm:max-w-lg bg-background rounded-t-2xl sm:rounded-2xl border shadow-2xl p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold",children:"Pytanie kontrolne"}),e.jsx("button",{onClick:s,className:"p-1 rounded hover:bg-muted","aria-label":"Zamknij",children:e.jsx(ls,{className:"h-5 w-5"})})]}),e.jsx("p",{className:"mb-3 text-sm sm:text-base",children:t.question}),e.jsx("div",{className:"space-y-2 mb-4",children:t.options.map((c,d)=>e.jsxs("label",{className:"flex items-center gap-2 rounded-md border px-3 py-2 cursor-pointer hover:bg-muted",children:[e.jsx("input",{type:"radio",name:"quiz-choice",className:"h-4 w-4",checked:i===d,onChange:()=>r(d),disabled:a}),e.jsx("span",{className:"text-sm",children:c})]},d))}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:s,className:"rounded-lg border px-3 py-1.5 text-sm hover:bg-muted",children:"Anuluj"}),e.jsx("button",{onClick:l,className:"rounded-lg border px-3 py-1.5 text-sm font-medium hover:bg-muted",disabled:a,children:"Zatwierdź"})]})]})]})},XP=({lessonTitle:t,courseId:s,timeSpent:n,sectionsCount:i,quizzesCompleted:r,pointsEarned:a,nextLessonPath:o})=>{const l=le(),c=d=>{const u=Math.floor(d/60),m=d%60;return u>0?`${u} min ${m} s`:`${m} s`};return e.jsx(qe.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"fixed inset-0 z-20 flex items-center justify-center p-4 bg-black/50",children:e.jsxs("div",{className:"w-full max-w-md rounded-2xl border bg-card p-6 shadow-2xl",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-green-100 dark:bg-green-900/30 mb-4",children:e.jsx(Pt,{className:"w-8 h-8 text-green-600"})}),e.jsx("h2",{className:"text-2xl font-bold",children:"Lekcja ukończona! 🎉"}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:t})]}),e.jsxs("div",{className:"rounded-xl bg-primary/10 p-4 mb-6 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-3xl font-bold text-primary",children:[e.jsx(ct,{className:"w-6 h-6"}),"+",a," punktów"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"za ukończenie materiału"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(De,{className:"w-5 h-5 mx-auto mb-1 text-blue-600"}),e.jsx("p",{className:"text-sm font-medium",children:c(n)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Czas nauki"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(xe,{className:"w-5 h-5 mx-auto mb-1 text-purple-600"}),e.jsx("p",{className:"text-sm font-medium",children:i}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Sekcji"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(Ve,{className:"w-5 h-5 mx-auto mb-1 text-yellow-600"}),e.jsx("p",{className:"text-sm font-medium",children:r}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pytań"})]})]}),e.jsx("div",{className:"flex gap-3",children:o?e.jsxs("button",{onClick:()=>l(o),className:"flex-1 inline-flex items-center justify-center gap-2 rounded-lg bg-primary px-4 py-2.5 text-primary-foreground hover:bg-primary/90",children:["Następna lekcja",e.jsx(Ce,{className:"w-4 h-4"})]}):e.jsx("button",{onClick:()=>l(`/student/courses/${s}`),className:"flex-1 rounded-lg bg-primary px-4 py-2.5 text-primary-foreground hover:bg-primary/90",children:"Wróć do kursu"})})]})})},eD=()=>{const{courseId:t,lessonId:s}=ft(),n=le(),{refetch:i}=Bn(),{data:r,isLoading:a}=Le({resource:"activities",id:s,meta:{select:"*, topics(title, course_id, courses(title, icon_emoji))"}}),o=r?.data??{},l=o?.content_md??o?.markdown??o?.content,c=re.useMemo(()=>l?WP(l,o?.title??"Sekcja"):[],[l,o?.title]),d=re.useMemo(()=>QP(c),[c]),u=`lesson-progress:${s}`,m=`lesson-quiz:${s}`,[h,p]=ph(u,Object.fromEntries(c.map(A=>[A.id,!1]))),[j,y]=ph(m,{}),[x,g]=re.useState(null),[b,v]=re.useState(!1),[C]=re.useState(Date.now());re.useEffect(()=>{if(!s)return;(async()=>{try{const{error:D}=await ee.rpc("start_activity",{p_activity_id:parseInt(s)});D?console.error("Error starting activity timer:",D):console.log("Activity timer started successfully")}catch(D){console.error("Failed to start activity timer:",D)}})()},[s]),re.useEffect(()=>{c.length&&p(A=>{const D={};return c.forEach(R=>D[R.id]=A[R.id]??!1),D})},[c.map(A=>A.id).join("|")]);const{ref:T,say:z}=ZP(),N=c.findIndex(A=>!h[A.id]),S=N===-1,P=A=>{const[D]=d.get(A)??[];D&&g(D)},w=A=>{const D=c[A];if(!D||!(N===-1||A<=N)&&!h[D.id])return;if(h[D.id]){p(F=>({...F,[D.id]:!1})),z(`Sekcja ${A+1} cofnięta.`);return}(d.get(D.id)??[]).length>0?P(D.id):(p(F=>({...F,[D.id]:!0})),z(`Sekcja ${A+1} odhaczona.`))},k=()=>{const A=x;if(g(null),!A)return;y(L=>({...L,[A.key]:!0}));const D=A.key.split(":")[0];p(L=>({...L,[D]:!0}));const R=c.findIndex(L=>L.id===D);z(`Sekcja ${R+1} odhaczona po pytaniu kontrolnym.`)},_=async()=>{if(!S)return W.info("Najpierw odhacz wszystkie sekcje po kolei.");console.log("Completing lesson...");try{const{data:A,error:D}=await ee.rpc("complete_material",{p_activity_id:parseInt(s)});if(console.log("Complete material result:",A,"Error:",D),D)throw D;if(A){const R=Math.floor((Date.now()-C)/1e3);console.log("Material completed successfully, time spent:",R),v(!0);try{localStorage.removeItem(u),localStorage.removeItem(m)}catch(L){console.error("Błąd zapisu do localStorage:",L)}cr("get_course_structure"),cr("get_my_courses"),setTimeout(()=>{console.log("Forcing stats refresh..."),i()},500),setTimeout(async()=>{console.log("Manually checking updated stats...");const{data:L,error:F}=await ee.rpc("get_my_stats");console.log("New stats after completion:",L,"Error:",F)},1e3)}}catch(A){console.error("Failed to complete lesson:",A),W.error("Nie udało się ukończyć lekcji")}};return e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-10 pb-28 lg:pb-16",children:[e.jsx("div",{ref:T,"aria-live":"polite",className:"sr-only"}),e.jsxs("button",{onClick:()=>n(`/student/courses/${t}`),className:"flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx(Ne,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Powrót do kursu"})]}),e.jsx("section",{className:"relative overflow-hidden rounded-2xl border bg-white dark:bg-card",children:e.jsx("div",{className:"relative z-10 p-5 sm:p-7 md:p-10",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-4xl md:text-5xl leading-none",children:o?.topics?.courses?.icon_emoji||"📚"}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-muted-foreground flex items-center gap-2",children:[e.jsx("span",{className:"truncate",children:o?.topics?.courses?.title||"…"}),e.jsx("span",{children:"•"}),e.jsx("span",{className:"truncate",children:o?.topics?.title||"…"})]}),e.jsx("h1",{className:"mt-1 text-xl md:text-3xl font-bold tracking-tight",children:o?.title||"Ładowanie…"}),o?.duration_min&&e.jsxs("div",{className:"mt-3 inline-flex items-center gap-2 rounded-full border bg-white/70 dark:bg-background/60 px-3 py-1.5 shadow-soft",children:[e.jsx(De,{className:"h-4 w-4"}),e.jsxs("span",{className:"text-sm font-medium",children:[o?.duration_min," min czytania"]})]})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1fr_280px] gap-10",children:[e.jsx("main",{children:a?e.jsx(YP,{}):e.jsxs("section",{children:[e.jsx("div",{className:"prose prose-neutral dark:prose-invert max-w-[72ch] mx-auto prose-headings:font-semibold prose-p:text-muted-foreground prose-p:leading-relaxed prose-li:leading-relaxed prose-headings:tracking-tight prose-img:rounded-xl prose-blockquote:rounded-xl md:prose-lg",children:c.length?c.map((A,D)=>{const R=!!h[A.id],L=!R&&D===N,K=!(N===-1||D<=N)&&!R,q=(d.get(A.id)??[])[0],G="rounded-[20px] border p-6 sm:p-7 md:p-8 shadow-sm transition-colors duration-200",X=R?"bg-emerald-50 dark:bg-emerald-950/25 border-emerald-300":L?"bg-white dark:bg-background border-neutral-200 shadow-md":K?"bg-white dark:bg-card border-dashed border-muted-foreground/40":"bg-white dark:bg-card border-neutral-200",V=!R&&K?"filter blur-[2px] select-none pointer-events-none":"";return e.jsxs("div",{id:A.id,className:"mb-12 scroll-mt-28",children:[e.jsxs("div",{className:`${G} ${X}`,children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-3",children:[K&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border px-2.5 py-0.5 text-[11px] text-muted-foreground bg-white",children:[e.jsx(ui,{className:"h-3.5 w-3.5"}),"Zablokowana"]}),R&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-emerald-300/60 bg-emerald-50/60 px-2.5 py-0.5 text-[11px] text-emerald-700 dark:text-emerald-300",children:[e.jsx($t,{className:"h-3.5 w-3.5"}),"Ukończona"]}),L&&!R&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border bg-white px-2.5 py-0.5 text-[11px]",children:[e.jsx(ir,{className:"h-3.5 w-3.5"}),"W trakcie"]}),q&&e.jsxs("button",{type:"button",onClick:()=>!R&&!K&&P(A.id),disabled:R||K,className:["inline-flex items-center gap-1 rounded-full border px-2.5 py-0.5 text-[11px]",R?"text-emerald-700 border-emerald-300/60 bg-emerald-50/60 dark:bg-emerald-950/25":K?"text-muted-foreground cursor-not-allowed bg-white dark:bg-background/40":"bg-white hover:bg-muted"].join(" "),title:R?"Pytanie rozwiązane":K?"Najpierw odblokuj sekcję":"Kliknij, aby odpowiedzieć","aria-label":"Pytanie kontrolne",children:[e.jsx(Be,{className:"h-3.5 w-3.5"}),q.question.length>72?q.question.slice(0,69)+"…":q.question]})]}),e.jsxs("div",{className:V,children:[e.jsx("h2",{className:"text-[22px] md:text-[26px] font-semibold tracking-tight m-0 mb-4",children:A.title||`Sekcja ${D+1}`}),e.jsx(Sn,{remarkPlugins:[An],components:fh,children:A.content})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsxs("label",{className:["inline-flex items-center gap-3",K?"cursor-not-allowed opacity-60":"cursor-pointer"].join(" "),title:K?"Najpierw ukończ poprzednie sekcje":R?"Sekcja odhaczona — klik, aby cofnąć":q?"Kliknij, aby odpowiedzieć na pytanie":"Odhacz sekcję",children:[e.jsx("input",{type:"checkbox",className:"sr-only",checked:R,onChange:()=>!K&&w(D),disabled:K&&!R,"aria-label":`Odhacz sekcję: ${A.title||`Sekcja ${D+1}`}`}),e.jsx("span",{className:["inline-flex items-center gap-2 rounded-lg border px-3 py-2 text-sm font-medium shadow-soft transition-all",R?"bg-emerald-50/70 dark:bg-emerald-950/30 border-emerald-300/60 text-emerald-700 dark:text-emerald-300":"bg-white hover:bg-muted border-neutral-200"].join(" "),children:q&&!R?e.jsx("span",{className:"truncate max-w-[56ch]",children:q.question}):e.jsxs(e.Fragment,{children:[R?e.jsx($t,{className:"h-4 w-4"}):e.jsx(ir,{className:"h-4 w-4"}),e.jsxs("span",{className:"whitespace-nowrap",children:[String(D+1).padStart(2,"0")," • ",R?"Odhaczono":q?"Odhacz (pytanie)":"Odhacz sekcję"]})]})})]})})]}),e.jsx("div",{className:"h-8"})]},A.id)}):l?e.jsx(Sn,{remarkPlugins:[An],components:fh,children:l}):e.jsx("div",{dangerouslySetInnerHTML:{__html:o?.content||""}})}),!!c.length&&e.jsx("div",{className:"mt-10 flex justify-end",children:e.jsx("button",{onClick:_,className:"inline-flex items-center gap-2 rounded-lg border bg-white px-4 py-2 text-sm font-medium shadow-soft hover:bg-muted transition-colors disabled:opacity-60",disabled:!S,title:S?void 0:"Najpierw odhacz wszystkie sekcje",children:"Zakończ lekcję"})})]})}),e.jsx("aside",{children:e.jsxs("nav",{className:"border rounded-[14px] p-4 bg-white dark:bg-background/60 lg:sticky lg:top-28",children:[e.jsx("h2",{className:"text-sm font-semibold mb-3",children:"Spis treści"}),a?e.jsx("div",{className:"h-4 w-40 rounded bg-muted/60 animate-pulse"}):c.length?e.jsx("ol",{className:"space-y-1.5 text-sm",children:c.map((A,D)=>{const R=!!h[A.id],L=!R&&D===N,K=!(N===-1||D<=N)&&!R,q=()=>{K||document.getElementById(A.id)?.scrollIntoView({behavior:"smooth"})};return e.jsxs("li",{className:"flex items-center gap-1.5",children:[K?e.jsx(ui,{className:"h-3.5 w-3.5 text-muted-foreground"}):R?e.jsx($t,{className:"h-3.5 w-3.5 text-emerald-600"}):e.jsx(ir,{className:"h-3.5 w-3.5"}),e.jsxs("button",{onClick:q,className:["flex-1 text-left px-2 py-1 rounded transition-colors",K?"text-muted-foreground cursor-not-allowed":"hover:bg-muted",R?"text-emerald-700":"",L?"font-semibold underline":""].join(" "),disabled:K,children:[String(D+1).padStart(2,"0"),". ",A.title||`Sekcja ${D+1}`]})]},A.id)})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Brak sekcji."})]})})]}),x&&e.jsx(JP,{quiz:x,onClose:()=>g(null),onPass:k}),b&&e.jsx(XP,{lessonTitle:o?.title||"Lekcja",courseId:t,timeSpent:Math.floor((Date.now()-C)/1e3),sectionsCount:c.length,quizzesCompleted:Object.keys(j).length,pointsEarned:5,nextLessonPath:void 0})]})},tD=[e.jsx(H,{path:"/courses/:courseId/lesson/:lessonId",element:e.jsx(eD,{})},"lesson-view")],sD=()=>{const{courseId:t,quizId:s}=ft(),n=le(),{refetch:i}=Bn(),[r,a]=re.useState(0),[o,l]=re.useState({}),[c,d]=re.useState(null),[u,m]=re.useState(!1),[h,p]=re.useState([]),[j,y]=re.useState(!0),{data:x,isLoading:g}=Le({resource:"activities",id:s,meta:{select:"*, topics(title, course_id, courses(title, icon_emoji))"}});re.useEffect(()=>{(async()=>{if(s)try{await ee.rpc("start_activity",{p_activity_id:parseInt(s)}),y(!0);const{data:R,error:L}=await ee.rpc("get_quiz_questions",{p_activity_id:parseInt(s)});if(L)throw L;const F=typeof R=="string"?JSON.parse(R):R;p(Array.isArray(F)?F:[])}catch(R){console.error("Quiz init error:",R),W.error("Błąd podczas ładowania quizu")}finally{y(!1)}})()},[s]),re.useEffect(()=>{x?.data?.time_limit&&c===null&&d(x.data.time_limit*60)},[x]),re.useEffect(()=>{if(c!==null&&c>0){const D=setTimeout(()=>d(c-1),1e3);return()=>clearTimeout(D)}else c===0&&S()},[c]);const b=x?.data,v=h[r],C=h.length>0?(r+1)/h.length*100:0,T=D=>{if(D.type)switch(D.type){case"single_choice":return"single";case"multiple_choice":return"multiple";case"true_false":return"true_false"}return"single"},z=D=>{switch(D){case"single":return{label:"Jednokrotny wybór",icon:Pt};case"multiple":return{label:"Wielokrotny wybór",icon:Xs};case"true_false":return{label:"Prawda/Fałsz",icon:Re}}},N=(D,R,L)=>{if(L){const F=o[D]||[],K=F.includes(R)?F.filter(q=>q!==R):[...F,R];l(q=>({...q,[D]:K}))}else l(F=>({...F,[D]:R}))},S=async()=>{m(!0);try{const D=Object.entries(o).flatMap(([F,K])=>Array.isArray(K)?K.map(q=>({question_id:parseInt(F),option_id:q})):[{question_id:parseInt(F),option_id:K}]);console.log("Submitting quiz answers:",D);const{data:R,error:L}=await ee.rpc("finish_quiz",{p_activity_id:parseInt(s),p_answers:D});if(L)throw L;R&&(console.log("Quiz finished successfully:",R),cr("get_course_structure"),cr("get_my_courses"),cr("get_my_stats"),setTimeout(()=>{console.log("Forcing stats refresh..."),i()},500),n(`/student/courses/${t}/quiz/${s}/result`,{state:{courseId:t,quizId:s,result:{...R,passing_score:b?.passing_score||70,max_attempts:b?.max_attempts,attempts_used:b?.attempts||1}}}))}catch(D){console.error("Failed to submit quiz:",D),W.error("Nie udało się przesłać odpowiedzi")}finally{m(!1)}};if(g||j)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});if(!v)return null;const P=T(v),w=z(P),k=P==="multiple",_=o[v.id],A=k?Array.isArray(_)&&_.length>0:_!==void 0;return e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 max-w-3xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("button",{onClick:()=>n(`/student/courses/${t}`),className:"flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx(Ne,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Zakończ quiz"})]}),c!==null&&e.jsxs("div",{className:U("flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium",c<60?"bg-red-100 text-red-700":"bg-muted text-foreground"),children:[e.jsx(De,{className:"w-4 h-4"}),Math.floor(c/60),":",String(c%60).padStart(2,"0")]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:b?.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Pytanie ",r+1," z ",h.length]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[v.points," pkt"]}),e.jsx("span",{children:"•"}),e.jsxs(B,{variant:"outline",className:"text-xs",children:[e.jsx(w.icon,{className:"w-3 h-3 mr-1"}),w.label]})]})]}),e.jsx("div",{className:"h-1 bg-muted rounded-full overflow-hidden mb-8",children:e.jsx(qe.div,{initial:{width:0},animate:{width:`${C}%`},className:"h-full bg-primary"})}),e.jsx(eT,{mode:"wait",children:e.jsx(qe.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},transition:{duration:.2},children:e.jsxs("div",{className:"bg-card rounded-2xl border p-8 mb-8",children:[e.jsx("h2",{className:"text-lg font-medium mb-6",children:v.question}),k&&e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"⚠️ Zaznacz wszystkie poprawne odpowiedzi"}),e.jsx("div",{className:"space-y-3",children:v.options.map(D=>{const R=k?Array.isArray(_)&&_.includes(D.id):_===D.id;return e.jsx("label",{className:U("block p-4 rounded-xl border-2 cursor-pointer transition-all",R?"border-primary bg-primary/5":"border-border hover:border-muted-foreground"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:k?"checkbox":"radio",name:`question-${v.id}`,value:D.id,checked:R,onChange:()=>N(v.id,D.id,k),className:"sr-only"}),e.jsxs("div",{className:U("flex items-center justify-center flex-shrink-0",k?U("w-5 h-5 rounded border-2",R?"border-primary bg-primary text-primary-foreground":"border-muted-foreground"):U("w-5 h-5 rounded-full border-2",R?"border-primary":"border-muted-foreground")),children:[k&&R&&e.jsx($t,{className:"w-3 h-3"}),!k&&R&&e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-primary"})]}),e.jsx("span",{className:"flex-1",children:D.text})]})},D.id)})})]})},v.id)}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>a(Math.max(0,r-1)),disabled:r===0,className:U("flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all",r===0?"text-muted-foreground cursor-not-allowed":"text-foreground hover:bg-muted"),children:[e.jsx(Ne,{className:"w-4 h-4"}),"Poprzednie"]}),e.jsx("div",{className:"flex gap-2",children:h.map((D,R)=>{const L=o[h[R]?.id],F=Array.isArray(L)?L.length>0:L!==void 0;return e.jsx("button",{onClick:()=>a(R),className:U("w-2 h-2 rounded-full transition-all",R===r?"bg-primary w-8":F?"bg-muted-foreground":"bg-muted")},R)})}),r<h.length-1?e.jsxs("button",{onClick:()=>a(r+1),disabled:!A,className:U("flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all",A?"bg-primary text-primary-foreground hover:bg-primary/90":"bg-muted text-muted-foreground cursor-not-allowed"),children:["Następne",e.jsx(Ce,{className:"w-4 h-4"})]}):e.jsxs("button",{onClick:S,disabled:u||Object.keys(o).length<h.length,className:U("flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all",u||Object.keys(o).length<h.length?"bg-muted text-muted-foreground cursor-not-allowed":"bg-green-500 text-white hover:bg-green-600"),children:[u?"Przesyłanie...":"Zakończ quiz",e.jsx($t,{className:"w-4 h-4"})]})]})]})},nD=()=>{const t=le(),s=ms(),{courseId:n,quizId:i,result:r}=s.state,a=b=>{const v=Math.floor(b/60),C=b%60;return`${v}:${String(C).padStart(2,"0")}`},o=b=>b>=90?"text-green-600":b>=70?"text-yellow-600":"text-red-600",l=b=>b<30?1:b<50?2:b<70?5:10+Math.floor((b-70)/3),c=r.max_attempts&&(r.attempts_used??0)<r.max_attempts,d=r.score===100,u=r.user_points||0,m=r.next_level_points||((r.user_level||1)+1)*100,h=u%100,p=m-u,j=h/100*100,y=r.question_results?.filter(b=>b.is_correct).length||0,x=r.question_results?.length||0,g=x-y;return e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-3xl",children:[e.jsxs(qe.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.3},className:"space-y-6",children:[e.jsx(I,{children:e.jsxs(E,{className:"pt-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:U("inline-flex items-center justify-center w-16 h-16 rounded-full mb-4",r.passed?"bg-green-100":"bg-orange-100"),children:e.jsx(Ve,{className:U("w-8 h-8",r.passed?"text-green-600":"text-orange-600")})}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:r.passed?"Quiz zaliczony!":"Niezaliczone, ale zdobywasz punkty!"}),e.jsx("p",{className:"text-muted-foreground",children:r.passed?d?"Perfekcyjny wynik! Jesteś mistrzem!":"Gratulacje! Świetnie Ci poszło.":`Zdobywasz ${r.points_earned} punktów za swoją próbę!`})]}),e.jsx("div",{className:"bg-muted/50 rounded-xl p-6 mb-6",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:U("text-5xl font-bold mb-2",o(r.score)),children:[r.score,"%"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Twój wynik"})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx(ct,{className:"w-4 h-4 text-yellow-600"}),e.jsx("span",{className:"font-semibold text-lg",children:r.points_earned})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Punktów zdobytych"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx(De,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-semibold",children:a(r.time_spent)})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Czas"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx(We,{className:"w-4 h-4 text-purple-600"}),e.jsxs("span",{className:"font-semibold",children:[r.passing_score,"%"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Próg zaliczenia"})]})]})]})}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"text-lg flex items-center gap-2",children:[e.jsx(en,{className:"w-5 h-5"}),"Postęp poziomu"]})}),e.jsx(E,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("span",{className:"font-medium",children:["Poziom ",r.user_level||1]}),e.jsxs("span",{className:"text-muted-foreground",children:[u," / ",m," punktów"]}),e.jsxs("span",{className:"font-medium",children:["Poziom ",(r.user_level||1)+1]})]}),e.jsx(rs,{value:j,className:"h-3"}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Do następnego poziomu pozostało:",e.jsxs("span",{className:"font-semibold text-foreground ml-1",children:[p," punktów"]})]}),r.points_earned>0&&e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:["+",r.points_earned," punktów z tego quizu!"]})]})]})})]}),r.question_results&&r.question_results.length>0&&e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"text-lg flex items-center justify-between",children:[e.jsx("span",{children:"Analiza odpowiedzi"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(Pt,{className:"w-4 h-4"}),y]}),e.jsxs("span",{className:"flex items-center gap-1 text-red-600",children:[e.jsx(Ta,{className:"w-4 h-4"}),g]})]})]})}),e.jsxs(E,{children:[e.jsx("div",{className:"space-y-3",children:r.question_results.map((b,v)=>e.jsx(qe.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:v*.05},className:U("p-4 rounded-lg border transition-all",b.is_correct?"bg-green-50 dark:bg-green-950/30 border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-950/30 border-red-200 dark:border-red-800"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:b.is_correct?e.jsx(Pt,{className:"w-5 h-5 text-green-600"}):e.jsx(Ta,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h4",{className:"font-medium text-sm",children:["Pytanie ",v+1]}),e.jsxs("span",{className:U("text-sm font-semibold",b.is_correct?"text-green-600":"text-red-600"),children:[b.is_correct?`+${b.points}`:"0"," pkt"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:b.question_text}),e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-muted-foreground min-w-[120px]",children:"Twoja odpowiedź:"}),e.jsx("span",{className:U("font-medium flex-1",b.is_correct?"text-green-700 dark:text-green-400":"text-red-700 dark:text-red-400"),children:Array.isArray(b.your_answer)?b.your_answer.join(", "):b.your_answer||"Brak odpowiedzi"})]}),!b.is_correct&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-muted-foreground min-w-[120px]",children:"Poprawna odpowiedź:"}),e.jsx("span",{className:"font-medium text-green-700 dark:text-green-400 flex-1",children:Array.isArray(b.correct_answer)?b.correct_answer.join(", "):b.correct_answer})]})]})]})]})},b.question_id))}),e.jsxs("div",{className:"mt-6 p-4 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Skuteczność:"}),e.jsx("span",{className:"font-semibold",children:x>0?`${Math.round(y/x*100)}%`:"0%"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm mt-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"Zdobyte punkty:"}),e.jsxs("span",{className:"font-semibold",children:[r.question_results.filter(b=>b.is_correct).reduce((b,v)=>b+v.points,0)," / ",r.question_results.reduce((b,v)=>b+v.points,0)]})]})]})]})]}),e.jsxs(I,{className:U(r.points_earned>0?"border-primary/50":""),children:[e.jsx(O,{children:e.jsxs($,{className:"text-lg flex items-center gap-2",children:[e.jsx(st,{className:"w-5 h-5"}),"Jak obliczyliśmy Twoje punkty"]})}),e.jsxs(E,{children:[e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Punkty bazowe za wynik ",r.score,"%:"]}),e.jsxs("span",{className:"font-medium tabular-nums",children:[r.base_points||l(r.score)," pkt"]})]}),r.multipliers?.quiz_multiplier&&r.multipliers.quiz_multiplier>1&&e.jsxs("div",{className:"flex justify-between items-center text-green-600 dark:text-green-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(cn,{className:"w-3 h-3"}),'Ulepszenie "Szybki umysł":']}),e.jsxs("span",{className:"font-medium",children:["×",r.multipliers.quiz_multiplier]})]}),r.streak_days&&r.streak_days>0&&r.multipliers?.streak_multiplier&&e.jsxs("div",{className:"flex justify-between items-center text-orange-600 dark:text-orange-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(gs,{className:"w-3 h-3"}),"Streak ",r.streak_days," dni:"]}),e.jsxs("span",{className:"font-medium",children:["×",r.multipliers.streak_multiplier.toFixed(1)]})]}),d&&r.perfect_bonus&&r.perfect_bonus>0&&e.jsxs("div",{className:"flex justify-between items-center text-purple-600 dark:text-purple-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Iw,{className:"w-3 h-3"}),"Bonus perfekcjonisty:"]}),e.jsxs("span",{className:"font-medium",children:["+",r.perfect_bonus," pkt"]})]}),r.multipliers?.min_points&&r.score<30&&e.jsxs("div",{className:"flex justify-between items-center text-blue-600 dark:text-blue-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(gr,{className:"w-3 h-3"}),'Gwarancja "Druga szansa":']}),e.jsxs("span",{className:"font-medium",children:["min. ",r.multipliers.min_points," pkt"]})]}),e.jsx("div",{className:"pt-2 mt-2 border-t border-border/50",children:e.jsxs("div",{className:"flex justify-between items-center font-semibold",children:[e.jsx("span",{children:"Łącznie zdobywasz:"}),e.jsxs("span",{className:"text-lg text-primary",children:[r.points_earned," punktów"]})]})})]}),(!r.multipliers?.quiz_multiplier||r.multipliers.quiz_multiplier===1)&&e.jsx("div",{className:"mt-3 p-2 bg-amber-50 dark:bg-amber-900/20 rounded-md",children:e.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-400 flex items-center gap-1",children:[e.jsx(Re,{className:"w-3 h-3 flex-shrink-0"}),"Wskazówka: Kup ulepszenia w zakładce Idle aby zwiększyć punkty z quizów!"]})})]})]}),!r.passed&&e.jsx(I,{className:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800",children:e.jsxs(E,{className:"pt-6",children:[e.jsx("h4",{className:"font-medium text-sm mb-1 text-blue-700 dark:text-blue-400",children:"Nie poddawaj się! 💪"}),e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-300",children:r.score>=60?`Świetnie Ci idzie! Brakuje tylko ${r.passing_score-r.score}% do zaliczenia.`:r.score>=40?"Już prawie połowa! Przejrzyj materiały i spróbuj ponownie.":"Każda próba to krok naprzód. Wróć do materiałów i próbuj dalej!"})]})}),e.jsxs("div",{className:"flex gap-3",children:[r.passed?e.jsxs("button",{onClick:()=>t(`/student/courses/${n}`),className:"flex-1 inline-flex items-center justify-center gap-2 rounded-lg bg-primary px-4 py-2.5 text-primary-foreground hover:bg-primary/90 focus-ring",children:["Kontynuuj kurs",e.jsx(Ce,{className:"w-4 h-4"})]}):e.jsx(e.Fragment,{children:c?e.jsxs("button",{onClick:()=>t(`/student/courses/${n}/quiz/${i}`),className:"flex-1 inline-flex items-center justify-center gap-2 rounded-lg bg-primary px-4 py-2.5 text-primary-foreground hover:bg-primary/90 focus-ring",children:[e.jsx(gr,{className:"w-4 h-4"}),"Spróbuj ponownie"]}):e.jsx("button",{onClick:()=>t(`/student/courses/${n}`),className:"flex-1 rounded-lg border px-4 py-2.5 hover:bg-muted/50 focus-ring",children:"Wróć do kursu"})}),e.jsx("button",{onClick:()=>t("/student/dashboard"),className:"px-4 py-2.5 rounded-lg border hover:bg-muted/50 focus-ring",children:"Dashboard"})]}),r.max_attempts&&e.jsxs("p",{className:"text-center text-xs text-muted-foreground",children:["Wykorzystane próby: ",r.attempts_used," z ",r.max_attempts]})]}),d&&e.jsx(qe.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.5},className:"mt-4 text-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"🎯 Mistrzostwo! Twoja wiedza jest imponująca!"})})]})},iD=[e.jsx(H,{path:"/courses/:courseId/quiz/:quizId",element:e.jsx(sD,{})},"quiz-take"),e.jsx(H,{path:"/courses/:courseId/quiz/:quizId/result",element:e.jsx(nD,{})},"quiz-result")],rD={"⚡":ct,"🚀":gc,"🧠":cn,"☕":Lw,"📚":Ew},aD=()=>e.jsxs("div",{className:"rounded-2xl border bg-card p-6 shadow-soft animate-pulse",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-muted/70"}),e.jsxs("div",{children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted/70"}),e.jsx("div",{className:"mt-2 h-3 w-24 rounded bg-muted/60"})]})]}),e.jsx("div",{className:"h-5 w-16 rounded-full bg-muted/60"})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsx("div",{className:"h-3 w-full rounded bg-muted/60"}),e.jsx("div",{className:"h-3 w-2/3 rounded bg-muted/60"})]}),e.jsx("div",{className:"h-10 w-full rounded-lg bg-muted/60"})]}),oD=()=>{const{stats:t,refetch:s}=Bn(),{data:n,isLoading:i,refetch:r}=Qr("get_idle_upgrades"),a=async l=>{try{const{data:c,error:d}=await ee.rpc("buy_idle_upgrade",{p_upgrade_id:l});if(d)throw d;c&&(W.success(`Ulepszenie zakupione! Poziom ${c.new_level}`),s(),r())}catch{W.error("Niewystarczająca ilość punktów")}},o=n||[];return e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8 pb-24 lg:pb-8",children:[e.jsxs(qe.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.45},className:"relative overflow-hidden rounded-2xl border",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/[0.12] via-secondary/[0.10] to-accent/[0.12]"}),e.jsx("div",{className:"absolute inset-0 opacity-[0.06]",style:{backgroundImage:`
                linear-gradient(to right, hsl(var(--ring)/0.35) 1px, transparent 1px),
                linear-gradient(to bottom, hsl(var(--ring)/0.35) 1px, transparent 1px)
              `,backgroundSize:"28px 28px"}})]}),e.jsx("div",{className:"relative z-10 p-4 sm:p-6 md:p-8",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-12 md:items-center",children:[e.jsxs("div",{className:"md:col-span-4 space-y-2",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Ulepszenia"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Inwestuj punkty, aby zwiększyć tempo zdobywania kolejnych."})]}),e.jsxs("div",{className:"md:col-span-8 grid grid-cols-3 gap-4 md:gap-6",children:[e.jsxs("div",{className:"rounded-xl border bg-card p-5 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Punkty / h"}),e.jsx(st,{className:"h-4 w-4 text-accent"})]}),e.jsx("div",{className:"mt-2 flex items-end gap-2",children:e.jsx("span",{className:"text-4xl md:text-5xl font-semibold text-accent leading-none tabular-nums",children:e.jsx(ot,{value:t.idle_rate})})}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Premia za obecność."})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-5 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Twoje punkty"}),e.jsx(ct,{className:"h-4 w-4 text-primary"})]}),e.jsxs("div",{className:"mt-2 flex items-end gap-2",children:[e.jsx("span",{className:"text-4xl md:text-5xl font-semibold text-primary leading-none tabular-nums",children:e.jsx(ot,{value:t.points})}),e.jsx("span",{className:"mb-[2px] text-sm text-muted-foreground",children:"pkt"})]}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Wydaj je na ulepszenia poniżej."})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-5 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Do kolejnego poziomu"}),e.jsx(gc,{className:"h-4 w-4 text-secondary"})]}),e.jsx("div",{className:"mt-3",children:e.jsx(In,{value:t.points%100})}),e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:["Pozostało ",100-t.points%100," pkt"]})]})]})]})})]}),e.jsxs(qe.section,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.4,delay:.05},className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between gap-4",children:e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-lg sm:text-xl md:text-2xl font-semibold tracking-tight",children:"Dostępne ulepszenia"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Wybierz i zwiększ swoje tempo zdobywania punktów."})]})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 sm:gap-5",children:[i&&Array.from({length:6}).map((l,c)=>e.jsx(aD,{},c)),!i&&o.map((l,c)=>{const d=t.points>=l.next_cost,u=rD[l.icon]||ct;return e.jsxs(Ui,{index:c,className:U("group relative rounded-2xl border bg-card p-5 shadow-soft hover:bg-muted/40 transition-colors"),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-muted flex items-center justify-center shrink-0",children:e.jsx(u,{className:"w-6 h-6 text-muted-foreground"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h4",{className:"font-semibold text-sm sm:text-base text-foreground line-clamp-2",children:l.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Poziom ",l.current_level]})]})]}),e.jsx("span",{className:U("inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-[11px] font-semibold border",d?"border-primary/30 text-primary":"border-muted-foreground/25 text-muted-foreground"),children:d?"Dostępne":"Za drogie"})]}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-xs sm:text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Aktualny bonus"}),e.jsxs("span",{className:"font-medium text-green-600 dark:text-green-400",children:["+",e.jsx(ot,{value:l.total_bonus})," pkt/h"]})]}),e.jsxs("div",{className:"flex justify-between text-xs sm:text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Następny poziom"}),e.jsxs("span",{className:"font-medium",children:["+",l.bonus_per_level," pkt/h"]})]})]}),e.jsxs(qe.button,{whileHover:d?{scale:1.02}:{},whileTap:d?{scale:.98}:{},onClick:()=>a(l.id),disabled:!d,className:U("mt-4 w-full py-2.5 sm:py-3 rounded-lg font-medium focus-ring transition-colors",d?"bg-primary text-primary-foreground hover:bg-primary/90":"bg-muted text-muted-foreground cursor-not-allowed"),title:d?"Kup ulepszenie":"Brakuje punktów",children:["Ulepsz za ",e.jsx(ot,{value:l.next_cost})," pkt"]})]},l.id)})]})]})]})},lD=[e.jsx(H,{path:"/gamification",element:e.jsx(oD,{})},"gamification")],cD=()=>e.jsx("div",{className:"rounded-2xl border bg-card p-4 shadow-soft animate-pulse",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-8 h-5 rounded bg-muted/60"}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-muted/70"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted/60"}),e.jsx("div",{className:"mt-2 h-3 w-28 rounded bg-muted/50"})]}),e.jsx("div",{className:"h-5 w-16 rounded bg-muted/60"})]})}),dD=()=>{const{data:t}=Ye(),[s,n]=re.useState("all"),{data:i,isLoading:r,refetch:a,error:o}=Qr("get_leaderboard",{p_limit:20,p_filter:s});re.useEffect(()=>{let d=!1,u=!1;return(async()=>{if(!(d||u)){u=!0;try{await a()}finally{u=!1}}})(),()=>{d=!0}},[s]);const l=i||[],c=d=>{switch(d){case 1:return e.jsx(Ve,{className:"w-5 h-5 text-yellow-500"});case 2:return e.jsx(ap,{className:"w-5 h-5 text-gray-400"});case 3:return e.jsx(Bt,{className:"w-5 h-5 text-orange-500"});default:return e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:d})}};return e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8 pb-24 lg:pb-8",children:[e.jsxs(qe.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.45},className:"relative overflow-hidden rounded-2xl border",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/[0.12] via-secondary/[0.10] to-accent/[0.12]"}),e.jsx("div",{className:"absolute inset-0 opacity-[0.06]",style:{backgroundImage:`
                linear-gradient(to right, hsl(var(--ring)/0.35) 1px, transparent 1px),
                linear-gradient(to bottom, hsl(var(--ring)/0.35) 1px, transparent 1px)
              `,backgroundSize:"28px 28px"}})]}),e.jsx("div",{className:"relative z-10 p-4 sm:p-6 md:p-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Ranking"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Top 20 użytkowników według punktów."})]}),e.jsx("div",{className:"bg-muted rounded-lg p-1 inline-flex gap-1",children:[{value:"all",label:"Wszyscy"},{value:"students",label:"Uczniowie"},{value:"teachers",label:"Nauczyciele"}].map(d=>e.jsx("button",{onClick:()=>n(d.value),className:U("px-3 sm:px-4 py-1.5 rounded-md text-sm font-medium transition-colors",s===d.value?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:d.label},d.value))})]})})]}),e.jsxs(qe.section,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.4,delay:.05},className:"space-y-2",children:[r&&Array.from({length:4}).map((d,u)=>e.jsx(cD,{},u)),!r&&(o||l.length===0)&&e.jsxs("div",{className:"rounded-2xl border bg-card p-8 text-center shadow-soft",children:[e.jsx("div",{className:"text-4xl",children:"🥲"}),e.jsx("h4",{className:"mt-3 text-base sm:text-lg font-semibold",children:"Brak wyników"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:o?"Nie udało się pobrać rankingu.":"Brak danych dla wybranego filtra."}),e.jsxs("button",{onClick:()=>a(),className:"mt-4 inline-flex items-center gap-2 rounded-lg border px-3 py-2 text-sm hover:bg-primary/5 focus-ring",children:[e.jsx(ep,{className:"w-4 h-4"}),"Spróbuj ponownie"]})]}),!r&&l.length>0&&l.map((d,u)=>{const m=d.user_id===t?.id,h=d.rank<=3;return e.jsxs(Ui,{index:u,className:U("flex items-center gap-4 p-4 rounded-2xl border shadow-soft transition-colors",m?"bg-primary text-primary-foreground border-primary/40":h?"bg-muted/50 border-border":"bg-card hover:bg-muted/40 border-border"),children:[e.jsx("div",{className:"w-8 flex justify-center",children:c(d.rank)}),e.jsx("div",{className:U("w-10 h-10 rounded-full flex items-center justify-center font-semibold shrink-0",m?"bg-primary-foreground text-primary":h?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground"),"aria-label":`Avatar użytkownika ${d.full_name||"Użytkownik"}`,title:d.full_name||"Użytkownik",children:d.full_name?.charAt(0)??"U"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-medium truncate",children:[d.full_name||"Użytkownik",m&&e.jsx("span",{className:"ml-2 text-sm opacity-80",children:"(Ty)"})]}),e.jsxs("div",{className:U("text-sm",m?"text-primary-foreground/80":"text-muted-foreground"),children:["Poziom ",d.level," • Seria ",d.streak," dni"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-semibold tabular-nums",children:e.jsx(ot,{value:d.points})}),e.jsx("div",{className:U("text-xs",m?"text-primary-foreground/80":"text-muted-foreground"),children:"punktów"})]})]},d.user_id||`${d.rank}-${u}`)})]})]})},uD=[e.jsx(H,{path:"/leaderboard",element:e.jsx(dD,{})},"leaderboard")],Ji=[{id:1,icon:gs,title:"Pierwszy Krok",description:"Ukończ pierwszą lekcję",unlocked:!0,rarity:"common",unlockedAt:"2024-01-15",progress:100},{id:2,icon:_n,title:"Perfekcjonista",description:"Zdobądź 100% w 10 quizach",unlocked:!0,rarity:"rare",unlockedAt:"2024-02-20",progress:100},{id:3,icon:ct,title:"Błyskawica",description:"Ukończ 5 lekcji w jeden dzień",unlocked:!1,rarity:"epic",progress:60},{id:4,icon:Ve,title:"Mistrz",description:"Osiągnij poziom 50",unlocked:!1,rarity:"legendary",progress:24},{id:5,icon:We,title:"Snajper",description:"Odpowiedz poprawnie na 100 pytań z rzędu",unlocked:!1,rarity:"epic",progress:45},{id:6,icon:gc,title:"Rakieta",description:"Ukończ kurs w mniej niż tydzień",unlocked:!1,rarity:"rare",progress:0}],xh={common:{bg:"bg-muted",ring:"ring-1 ring-border",label:"Pospolite",badge:"border border-muted-foreground/20 text-muted-foreground bg-background/60"},rare:{bg:"bg-blue-500/10",ring:"ring-1 ring-blue-500/30",label:"Rzadkie",badge:"border border-blue-500/30 text-blue-600 dark:text-blue-400"},epic:{bg:"bg-purple-500/10",ring:"ring-1 ring-purple-500/30",label:"Epiczne",badge:"border border-purple-500/30 text-purple-600 dark:text-purple-400"},legendary:{bg:"bg-orange-500/10",ring:"ring-1 ring-orange-500/30",label:"Legendarne",badge:"border border-orange-500/30 text-orange-600 dark:text-orange-400"}},mD=()=>{const t=Ji.filter(i=>i.unlocked).length,s=Ji.length,n=Math.round(t/s*100);return e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8 pb-24 lg:pb-8",children:[e.jsxs(qe.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.45},className:"relative overflow-hidden rounded-2xl border",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/[0.12] via-secondary/[0.10] to-accent/[0.12]"}),e.jsx("div",{className:"absolute inset-0 opacity-[0.06]",style:{backgroundImage:`
                linear-gradient(to right, hsl(var(--ring)/0.35) 1px, transparent 1px),
                linear-gradient(to bottom, hsl(var(--ring)/0.35) 1px, transparent 1px)
              `,backgroundSize:"28px 28px"}})]}),e.jsxs("div",{className:"relative z-10 p-4 sm:p-6 md:p-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Osiągnięcia"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Odblokowano"," ",e.jsx("span",{className:"font-semibold tabular-nums",children:t})," ","z"," ",e.jsx("span",{className:"font-semibold tabular-nums",children:s})," ","(",n,"%)"]})]}),e.jsxs("div",{className:"w-full md:w-96",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-1.5",children:[e.jsx("span",{className:"text-muted-foreground",children:"Postęp osiągnięć"}),e.jsxs("span",{className:"font-medium tabular-nums",children:[n,"%"]})]}),e.jsx(In,{value:n})]})]}),e.jsx("div",{className:"mt-4 grid grid-cols-2 sm:grid-cols-4 gap-2",children:Object.entries(xh).map(([i,r])=>{const a=Ji.filter(l=>l.rarity===i&&l.unlocked).length,o=Ji.filter(l=>l.rarity===i).length;return e.jsxs("div",{className:U("rounded-xl border bg-card/70 backdrop-blur-sm p-3 shadow-soft"),children:[e.jsxs("p",{className:"text-lg font-semibold tabular-nums",children:[a,"/",o]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.label})]},i)})})]})]}),e.jsx(qe.section,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.4,delay:.05},className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-5",children:Ji.map((i,r)=>{const a=xh[i.rarity],o=i.icon,l=i.unlocked?e.jsx("span",{className:U("inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-[11px] font-semibold",a.badge),children:"Odblokowane"}):e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-primary/30 text-primary px-2.5 py-1 text-[11px] font-semibold",children:[i.progress,"%"]});return e.jsxs(Ui,{index:r,className:U("group relative rounded-2xl border bg-card p-5 shadow-soft hover:bg-muted/40 transition-colors",!i.unlocked&&"opacity-95"),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:U("w-12 h-12 rounded-xl flex items-center justify-center shrink-0",a.bg,a.ring),children:e.jsx(o,{className:"w-6 h-6"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm sm:text-base text-foreground line-clamp-2",children:i.title}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:i.description})]})]}),l]}),e.jsx("div",{className:"mt-4",children:i.unlocked?e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Odblokowano:"," ",e.jsx("span",{className:"font-medium",children:new Date(i.unlockedAt).toLocaleDateString("pl-PL")})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"Postęp"}),e.jsxs("span",{className:"font-medium tabular-nums",children:[i.progress,"%"]})]}),e.jsx(In,{value:i.progress})]})})]},i.id)})})]})},hD=[e.jsx(H,{path:"/achievements",element:e.jsx(mD,{})},"achievements")],pD=()=>{const{data:t}=Ye(),{stats:s}=Bn(),n=t?.full_name||t?.name||t?.email||"Użytkownik",i=(t?.full_name||t?.name||"U").split(" ").map(o=>o[0]).slice(0,2).join("").toUpperCase()||"U",r=(()=>{const o=t?.created_at;return(o?new Date(o):new Date).toLocaleDateString("pl-PL")})(),a=[{icon:Ve,label:"Punkty",value:s.points,iconColor:"text-primary",highlight:"primary",counter:!0},{icon:We,label:"Ukończone quizy",value:s.quizzes_completed??0,iconColor:"text-green-600 dark:text-green-400",counter:!1},{icon:_n,label:"Perfekcyjne wyniki",value:s.perfect_scores??0,iconColor:"text-yellow-600 dark:text-yellow-400",counter:!1},{icon:gs,label:"Najdłuższa seria",value:`${s.streak??0} dni`,iconColor:"text-destructive",counter:!1},{icon:De,label:"Czas nauki",value:`${Math.max(0,Math.floor((s.total_time??0)/60))}h`,iconColor:"text-blue-600 dark:text-blue-400",counter:!1},{icon:Ve,label:"Poziom",value:`Poziom ${s.level??1}`,iconColor:"text-secondary",counter:!1}];return e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8 pb-24 lg:pb-8",children:[e.jsxs(qe.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.45},className:"relative overflow-hidden rounded-2xl border",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/[0.12] via-secondary/[0.10] to-accent/[0.12]"}),e.jsx("div",{className:"absolute inset-0 opacity-[0.06]",style:{backgroundImage:`
                linear-gradient(to right, hsl(var(--ring)/0.35) 1px, transparent 1px),
                linear-gradient(to bottom, hsl(var(--ring)/0.35) 1px, transparent 1px)
              `,backgroundSize:"28px 28px"}})]}),e.jsx("div",{className:"relative z-10 p-4 sm:p-6 md:p-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-6",children:[e.jsxs("div",{className:"flex items-start gap-4 sm:gap-6",children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 rounded-2xl bg-primary text-primary-foreground flex items-center justify-center text-xl sm:text-2xl font-semibold shadow-soft",children:i}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:n}),e.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-muted-foreground",children:[t?.email&&e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[e.jsx(eo,{className:"w-4 h-4 shrink-0"}),e.jsx("span",{className:"truncate",children:t.email})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(At,{className:"w-4 h-4"}),e.jsxs("span",{children:["Dołączył ",r]})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("button",{className:"inline-flex items-center gap-2 rounded-lg border px-3 py-2 text-sm hover:bg-primary/5 focus-ring",children:[e.jsx(Rw,{className:"w-4 h-4"}),"Edytuj profil"]}),e.jsx("button",{className:"inline-flex items-center gap-2 rounded-lg bg-primary px-3 py-2 text-sm text-primary-foreground hover:bg-primary/90 focus-ring",children:"Ustawienia"})]})]})})]}),e.jsxs(qe.section,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.4,delay:.05},children:[e.jsx("h2",{className:"text-lg sm:text-xl md:text-2xl font-semibold tracking-tight mb-4",children:"Statystyki"}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-5",children:a.map((o,l)=>{const c=o.icon;return e.jsx(Ui,{index:l,className:"group relative rounded-2xl border bg-card p-5 shadow-soft hover:bg-muted/40 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-muted flex items-center justify-center shrink-0",children:e.jsx(c,{className:`w-6 h-6 ${o.iconColor}`})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:`text-2xl font-semibold leading-none tabular-nums ${o.highlight==="primary"?"text-primary":o.highlight==="secondary"?"text-secondary":o.highlight==="accent"?"text-accent":"text-foreground"}`,children:o.counter?e.jsx(ot,{value:Number(o.value)}):o.value}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:o.label})]})]})},o.label)})})]})]})},fD=[e.jsx(H,{path:"/profile",element:e.jsx(pD,{})},"profile")],xD=[...$P,...FP,...KP,...tD,...iD,...lD,...uD,...hD,...fD],gD=()=>e.jsx(Za,{children:e.jsxs(H,{element:e.jsx(XC,{children:e.jsx(mc,{})}),children:[e.jsx(H,{index:!0,element:e.jsx(as,{to:"dashboard",replace:!0})}),xD]})}),jD=f.lazy(()=>Promise.resolve({default:gD})),Xj=({text:t,colorClass:s})=>e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-background",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`inline-block h-12 w-12 animate-spin rounded-full border-4 border-current border-r-transparent ${s}`}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:t})]})}),yD=({children:t})=>{const{data:s,isLoading:n}=Ye();return n||!s?e.jsx(Xj,{text:"Sprawdzanie uprawnień...",colorClass:"border-blue-600"}):s.role!=="student"?e.jsx(as,{to:"/teacher/dashboard/overview",replace:!0}):e.jsx(e.Fragment,{children:t})},wD=e.jsx(H,{path:"/student/*",element:e.jsx(fc,{fallback:e.jsx(xc,{to:"/login"}),children:e.jsx(yD,{children:e.jsx(f.Suspense,{fallback:e.jsx(Xj,{text:"Ładowanie panelu ucznia...",colorClass:"border-blue-600"}),children:e.jsx(jD,{})})})},"student-auth")}),bD={name:"ai-tools",list:"/admin/ai-tools",meta:{label:"Narzędzia AI",icon:e.jsx(pt,{className:"h-4 w-4"})}},vD=Vo.includes(iu)?Vo:[{name:"dashboard",list:"/admin/dashboard/overview",meta:{label:"Dashboard",icon:e.jsx(Ow,{className:"h-4 w-4"})}},iu,...Vo,bD,{...lu,list:"/admin/course-structure",meta:{...lu.meta,parent:"ai-tools"}},{...Su,list:"/admin/educational-material",meta:{...Su.meta,parent:"ai-tools"}},{...Cu,list:"/admin/quiz-wizard",meta:{...Cu.meta,parent:"ai-tools"}}],ND={name:"dashboard",list:"/teacher/dashboard/overview",meta:{label:"Zasoby edukacyjne",icon:e.jsx(xe,{className:"h-4 w-4"})}},kD=[ND,{...Hu,meta:{...Hu.meta,parent:"dashboard",label:"Kursy"}},{...Zu,meta:{...Zu.meta,parent:"dashboard",hide:!0}},{...Yu,meta:{...Yu.meta,parent:"dashboard",label:"Grupy"}},MC,BC],zD={name:"student-root",meta:{label:"Panel ucznia",route:"/student/dashboard/overview"}},SD=[zD],CD=()=>{const t=le(),[s,n]=f.useState(0),[i,r]=f.useState("");f.useEffect(()=>{const o=()=>n(window.scrollY);return window.addEventListener("scroll",o),()=>window.removeEventListener("scroll",o)},[]);const a=[{name:"Sty",value:65},{name:"Lut",value:72},{name:"Mar",value:78},{name:"Kwi",value:85},{name:"Maj",value:88},{name:"Cze",value:94}];return e.jsxs("div",{className:"min-h-screen bg-white text-foreground",children:[e.jsx("nav",{className:"fixed top-0 w-full z-50 bg-white/80 backdrop-blur-xl border-b border-gray-100",children:e.jsx("div",{className:"container mx-auto px-6 py-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-pink-600 to-purple-700 rounded-xl flex items-center justify-center",children:e.jsx(Ve,{className:"w-5 h-5 text-white"})}),e.jsx("span",{className:"text-xl font-bold",children:"Smart Up"})]}),e.jsxs("div",{className:"hidden md:flex items-center gap-8",children:[e.jsx("a",{href:"#funkcje",className:"text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors",children:"Funkcje"}),e.jsx("a",{href:"#kursy",className:"text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors",children:"Kursy"}),e.jsx("a",{href:"#firma",className:"text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors",children:"Dla firm"}),e.jsx("a",{href:"#cennik",className:"text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors",children:"Cennik"}),e.jsx(M,{className:"bg-gray-900 hover:bg-gray-800 text-white text-sm px-6",onClick:()=>t("/login"),children:"Rozpocznij"})]})]})})}),e.jsx("section",{className:"pt-32 pb-20 overflow-hidden",children:e.jsx("div",{className:"container mx-auto px-6",children:e.jsxs("div",{className:"grid lg:grid-cols-12 gap-8 items-center",children:[e.jsxs("div",{className:"lg:col-span-5",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-purple-50 rounded-full mb-8",children:[e.jsx(ct,{className:"w-4 h-4 text-purple-700"}),e.jsx("span",{className:"text-sm font-medium text-purple-700",children:"Gamifikacja w edukacji"})]}),e.jsxs("h1",{className:"text-5xl md:text-6xl font-bold leading-tight mb-6",children:["Nauka, która",e.jsx("span",{className:"block text-transparent bg-clip-text bg-gradient-to-r from-pink-600 to-purple-700",children:"motywuje"})]}),e.jsx("p",{className:"text-lg text-gray-600 mb-8 leading-relaxed",children:"Przekształć edukację w angażującą przygodę. System poziomów, punktów i nagród sprawia, że nauka staje się uzależniająca."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-12",children:[e.jsxs(M,{size:"lg",className:"bg-gray-900 hover:bg-gray-800 text-white px-8",onClick:()=>t("/login"),children:["Zacznij za darmo",e.jsx(Ce,{className:"ml-2 h-4 w-4"})]}),e.jsx(M,{size:"lg",variant:"outline",className:"border-gray-300",children:"Zobacz demo"})]}),e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:"15k+"}),e.jsx("div",{className:"text-sm text-gray-500",children:"aktywnych uczniów"})]}),e.jsx("div",{className:"w-px h-12 bg-gray-200"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:"92%"}),e.jsx("div",{className:"text-sm text-gray-500",children:"ukończalność"})]}),e.jsx("div",{className:"w-px h-12 bg-gray-200"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:"4.9"}),e.jsx("div",{className:"text-sm text-gray-500",children:"ocena"})]})]})]}),e.jsx("div",{className:"lg:col-span-7",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -inset-4 bg-gradient-to-r from-pink-600/5 to-purple-700/5 rounded-3xl blur-2xl"}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-6 py-4 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-pink-600 to-purple-700 rounded-lg flex items-center justify-center",children:e.jsx(Ve,{className:"w-4 h-4 text-white"})}),e.jsx("span",{className:"font-semibold",children:"Dashboard ucznia"})]}),e.jsx(B,{className:"bg-green-50 text-green-700 border-green-200",children:"Online"})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-pink-50 to-pink-100 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Hd,{className:"w-5 h-5 text-pink-600"}),e.jsx("span",{className:"text-xs text-gray-500",children:"+125"})]}),e.jsx("div",{className:"text-2xl font-bold",children:"1,842"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Punkty XP"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(We,{className:"w-5 h-5 text-purple-700"}),e.jsx("span",{className:"text-xs text-gray-500",children:"75%"})]}),e.jsx("div",{className:"text-2xl font-bold",children:"Lvl 12"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Poziom"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-teal-50 to-teal-100 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Bt,{className:"w-5 h-5 text-teal-600"}),e.jsx("span",{className:"text-xs text-gray-500",children:"New!"})]}),e.jsx("div",{className:"text-2xl font-bold",children:"24"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Odznaki"})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("span",{className:"text-sm font-medium",children:"Postęp nauki"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ostatnie 6 miesięcy"})]}),e.jsx(Ue,{width:"100%",height:120,children:e.jsxs(ao,{data:a,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorProgress",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#db2777",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#db2777",stopOpacity:0})]})}),e.jsx(nn,{type:"monotone",dataKey:"value",stroke:"#db2777",strokeWidth:2,fill:"url(#colorProgress)"}),e.jsx(Tt,{dataKey:"name",axisLine:!1,tickLine:!1,tick:{fontSize:11}}),e.jsx(vt,{hide:!0})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Aktywne kursy"}),e.jsx("a",{href:"#",className:"text-purple-700 hover:underline",children:"Zobacz wszystkie"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-pink-600 to-purple-700 rounded-lg flex items-center justify-center",children:e.jsx(kl,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:"JavaScript: Gra w kodowanie"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Rozdział 4 z 12"})]})]}),e.jsx(Ae,{className:"w-4 h-4 text-gray-400"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-teal-500 to-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(en,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:"Analiza danych: Quest"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Rozdział 7 z 10"})]})]}),e.jsx(Ae,{className:"w-4 h-4 text-gray-400"})]})]})]})]})]})]})})]})})}),e.jsx("section",{id:"funkcje",className:"py-20 bg-gray-50",children:e.jsxs("div",{className:"container mx-auto px-6",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsxs("h2",{className:"text-4xl font-bold mb-4",children:["Funkcje, które"," ",e.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-pink-600 to-purple-700",children:"angażują"})]}),e.jsx("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto",children:"System zaprojektowany, aby uczynić naukę uzależniającą jak najlepsza gra"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-pink-600/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-pink-600 to-purple-700 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(Ve,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-3",children:"System poziomów"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"99 poziomów do zdobycia. Każdy poziom odblokowuje nowe możliwości i nagrody."}),e.jsxs("div",{className:"flex items-center text-sm text-pink-600 font-medium",children:["Dowiedz się więcej",e.jsx(Ce,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]}),e.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-700/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-purple-700 to-teal-500 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(Hd,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-3",children:"Idle Points"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Zdobywaj punkty nawet gdy nie uczysz się aktywnie. System pasywnego rozwoju."}),e.jsxs("div",{className:"flex items-center text-sm text-purple-700 font-medium",children:["Dowiedz się więcej",e.jsx(Ce,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]}),e.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-teal-500/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-teal-500 to-blue-600 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(We,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-3",children:"Wyzwania"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Codzienne i tygodniowe wyzwania z dodatkowymi nagrodami za ukończenie."}),e.jsxs("div",{className:"flex items-center text-sm text-teal-600 font-medium",children:["Dowiedz się więcej",e.jsx(Ce,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]}),e.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-orange-500/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-orange-500 to-yellow-500 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(ce,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-3",children:"Rankingi"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Rywalizuj z innymi uczniami. Rankingi globalne, lokalne i grupowe."}),e.jsxs("div",{className:"flex items-center text-sm text-orange-600 font-medium",children:["Dowiedz się więcej",e.jsx(Ce,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]}),e.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-700/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-purple-700 to-pink-600 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(Bt,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-3",children:"Odznaki"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Kolekcjonuj unikalne odznaki za osiągnięcia i kamienie milowe."}),e.jsxs("div",{className:"flex items-center text-sm text-purple-700 font-medium",children:["Dowiedz się więcej",e.jsx(Ce,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]}),e.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-teal-500/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-teal-500 to-purple-700 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(en,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-3",children:"Analityka"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Szczegółowe statystyki postępów i personalizowane rekomendacje."}),e.jsxs("div",{className:"flex items-center text-sm text-teal-600 font-medium",children:["Dowiedz się więcej",e.jsx(Ce,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]})]})]})}),e.jsx("section",{className:"py-20 bg-white",children:e.jsxs("div",{className:"container mx-auto px-6",children:[e.jsxs("div",{className:"max-w-3xl mx-auto text-center mb-16",children:[e.jsxs("h2",{className:"text-4xl font-bold mb-4",children:["Jak to"," ",e.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-pink-600 to-purple-700",children:"działa"})]}),e.jsx("p",{className:"text-lg text-gray-600",children:"Cztery proste kroki do rozpoczęcia nauki z gamifikacją"})]}),e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-1/2 transform -translate-x-1/2 top-0 bottom-0 w-0.5 bg-gray-200"}),e.jsx("div",{className:"space-y-12",children:[{number:"01",title:"Stwórz profil",description:"Wybierz swoją rolę i spersonalizuj doświadczenie nauki",icon:ce,color:"from-pink-600 to-purple-700"},{number:"02",title:"Wybierz kursy",description:"Przeglądaj bibliotekę kursów i wybierz te, które Cię interesują",icon:Es,color:"from-purple-700 to-teal-500"},{number:"03",title:"Ucz się i graj",description:"Rozwiązuj quizy, zdobywaj punkty i awansuj na kolejne poziomy",icon:kl,color:"from-teal-500 to-blue-600"},{number:"04",title:"Śledź postępy",description:"Monitoruj swoje osiągnięcia i rywalizuj z innymi",icon:st,color:"from-orange-500 to-yellow-500"}].map((o,l)=>e.jsx("div",{className:"relative",children:e.jsxs("div",{className:`flex items-center ${l%2===0?"flex-row":"flex-row-reverse"}`,children:[e.jsxs("div",{className:`w-5/12 ${l%2===0?"text-right pr-8":"text-left pl-8"}`,children:[e.jsxs("div",{className:`inline-flex items-center gap-4 mb-2 ${l%2===0?"flex-row-reverse":""}`,children:[e.jsx("h3",{className:"text-2xl font-bold",children:o.title}),e.jsx("span",{className:"text-4xl font-bold text-gray-200",children:o.number})]}),e.jsx("p",{className:"text-gray-600 text-lg",children:o.description})]}),e.jsx("div",{className:"w-2/12 flex justify-center",children:e.jsx("div",{className:`relative z-10 w-16 h-16 bg-gradient-to-br ${o.color} rounded-2xl flex items-center justify-center shadow-lg`,children:e.jsx(o.icon,{className:"w-8 h-8 text-white"})})}),e.jsx("div",{className:"w-5/12"})]})},l))})]})})]})}),e.jsx("section",{className:"py-20 bg-gradient-to-br from-gray-900 to-gray-800",children:e.jsx("div",{className:"container mx-auto px-6",children:e.jsx("div",{className:"grid md:grid-cols-4 gap-8",children:[{value:"15k+",label:"Aktywnych uczniów",icon:ce},{value:"200+",label:"Kursów",icon:Es},{value:"92%",label:"Ukończalność",icon:We},{value:"4.9/5",label:"Ocena",icon:_n}].map((o,l)=>e.jsxs("div",{className:"text-center",children:[e.jsx(o.icon,{className:"w-8 h-8 mx-auto mb-4 text-white/60"}),e.jsx("div",{className:"text-4xl font-bold text-white mb-2",children:o.value}),e.jsx("div",{className:"text-sm text-white/60",children:o.label})]},l))})})}),e.jsx("section",{className:"py-20 bg-white",children:e.jsx("div",{className:"container mx-auto px-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[e.jsxs("h2",{className:"text-4xl font-bold mb-6",children:["Gotowy na naukę, która"," ",e.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-pink-600 to-purple-700",children:"wciąga"}),"?"]}),e.jsx("p",{className:"text-lg text-gray-600 mb-8 max-w-2xl mx-auto",children:"Dołącz do tysięcy uczniów, którzy odkryli radość z nauki dzięki gamifikacji. Pierwsze 30 dni gratis."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center mb-8",children:[e.jsx(J,{type:"email",placeholder:"twoj@email.pl",value:i,onChange:o=>r(o.target.value),className:"max-w-xs h-12"}),e.jsxs(M,{size:"lg",className:"bg-gradient-to-r from-pink-600 to-purple-700 hover:opacity-90 text-white px-8 h-12",onClick:()=>t("/login"),children:["Rozpocznij za darmo",e.jsx(Ce,{className:"ml-2 h-4 w-4"})]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Bez karty kredytowej • Anuluj w każdej chwili • Pełny dostęp"})]})})}),e.jsx("footer",{className:"bg-gray-900 text-white py-12",children:e.jsx("div",{className:"container mx-auto px-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-white/10 rounded-lg flex items-center justify-center",children:e.jsx(Ve,{className:"w-4 h-4"})}),e.jsx("span",{className:"text-lg font-bold",children:"Smart Up"})]}),e.jsx("div",{className:"text-sm text-white/60",children:"© 2025 Smart Up. Wszystkie prawa zastrzeżone."})]})})})]})},_D=new iw({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:!1,staleTime:300*1e3}}});function TD({children:t}){const{pathname:s}=ms(),n=s.split("/")[1],i=n==="admin"?vD:n==="teacher"?kD:n==="student"?SD:[];return e.jsx(aw,{dataProvider:cw(ee),authProvider:ob,routerProvider:ow,resources:i,options:{syncWithLocation:!0,warnWhenUnsavedChanges:!1,useNewQueryKeys:!0,disableTelemetry:!0},children:t})}function AD(){return e.jsx(rw,{client:_D,children:e.jsx(Hy,{children:e.jsx(TD,{children:e.jsxs(Za,{children:[e.jsx(H,{path:"/",element:e.jsx(CD,{})}),xp,mb,fb,jb,wz,HC,wD,e.jsx(H,{path:"*",element:e.jsx(as,{to:"/",replace:!0})})]})})})})}const PD=document.getElementById("root"),DD=Jw.createRoot(PD);DD.render(e.jsxs(re.StrictMode,{children:[e.jsx(AD,{}),e.jsx(sw,{position:"top-right",richColors:!0,closeButton:!0,duration:4e3,toastOptions:{style:{width:"500px",fontSize:"20px"},className:"sonner-toast"}})]}));export{he as A,M as B,I as C,mn as F,J as I,me as L,pe as a,O as b,$ as c,oo as d,E as e,de as f,hn as g,Tn as h,pp as i,mp as l,hp as r,ee as s,fp as u};
