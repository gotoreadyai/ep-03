const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/LoginPage-BNy3ay7X.js","assets/radix-ui-BdNglvg2.js","assets/react-vendor-nLIND2rL.js","assets/refine-core-BpFEoGih.js","assets/NarrowCol-DUq-L8Qp.js","assets/ui-utils-Bzo4Vnxc.js","assets/utils-CTBb6ImH.js","assets/refine-ui-CWV2tBaG.js","assets/forms-Dah7oaIm.js","assets/tables-BOHXus41.js","assets/RegisterFlow-Cnj2n1Lh.js","assets/ForgotPasswordPage-BLTdl2Ku.js","assets/UpdatePasswordPage-BKhw-fyR.js"])))=>i.map(i=>d[i]);
var ny=Object.defineProperty;var iy=(t,s,n)=>s in t?ny(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n;var ts=(t,s,n)=>iy(t,typeof s!="symbol"?s+"":s,n);import{j as e,R as gh,I as jh,F as yh,S as ic,a as wh,P as ry,C as bh,b as vh,V as ay,c as oy,d as Nh,e as ly,T as kh,f as cy,g as zh,h as Sh,i as dy,k as Ch,l as uy,L as _h,m as Th,n as my,o as hy,p as Ah,q as py,r as fy,s as Dh,t as Ph,u as Mh,v as Ih,w as xy,x as Eh,y as gy,z as Pn,A as Rh,B as rc,D as on,E as Se,G as jy,H as yy,J as wy,K as Lh,M as by,N as vy,O as Ny,Q as Oh,U as ky,W as $h,X as zy,Y as Fh,Z as qh,_ as Sy,$ as Bh,a0 as Cy,a1 as _y,a2 as Uh,a3 as Vh,a4 as Kh,a5 as Ka,a6 as Ty,a7 as Ay,a8 as Dy,a9 as Py,aa as My,ab as Iy,ac as Ey,ad as Ry,ae as Ly,af as Oy,ag as $y,ah as Fy,ai as Wh,aj as qy,ak as By,al as Uy,am as Bd}from"./radix-ui-BdNglvg2.js";import{k as Vy,a as f,l as K,n as pi,N as rs,e as ae,L as Le,d as Ns,o as Wa,O as ac,u as Ct,R as te,h as Yi,p as Ga,B as Ky}from"./react-vendor-nLIND2rL.js";import{c as Gh,a as Zh,v as Wy,o as Ci,u as fi,b as oc,n as Rr,d as za,e as Gy,t as Hh,E as Zy,f as lc,g as mr,m as Ot,h as Hy,i as Qy,j as Hs,s as Lo,r as Yy,k as Ji,l as Jn,p as Jy,M as xi,q as Y,T as Xy}from"./utils-CTBb6ImH.js";import{n as Ze,M as Za,d as Qh,H as cc,$ as Z,e as Mn,X as Yt,f as Is,I as Yh,i as Xe,E as dc,o as uc,k as Jh,j as ct,l as ew,Q as tw,m as sw,p as nw,D as iw}from"./refine-core-BpFEoGih.js";import{c as rw,_ as Ha,k as ln,I as aw}from"./refine-ui-CWV2tBaG.js";import{t as ow,c as lw,U as Sa,M as Qa,G as gi,a as mc,S as Ya,b as Ja,C as dt,d as $t,e as rt,X as Jt,f as Lr,L as Xa,g as de,h as Es,B as ye,i as hc,I as cn,j as In,k as cw,l as Ke,F as Xh,m as dw,T as Be,n as be,Z as Ye,P as Fe,o as js,p as Ft,q as uw,r as mw,s as hw,u as ep,v as pw,W as _i,H as fw,w as Et,x as Me,A as Ne,y as Rs,z as Rt,D as tp,E as xw,R as sp,J as Ys,K as gw,N as et,O as hr,Q as ys,V as He,Y as Re,_ as dn,$ as jw,a0 as zt,a1 as Je,a2 as pr,a3 as yw,a4 as Or,a5 as xt,a6 as qe,a7 as pa,a8 as eo,a9 as ks,aa as np,ab as ww,ac as Nn,ad as bw,ae as vw,af as Ud,ag as Nw,ah as ji,ai as Ls,aj as jl,ak as ip,al as Sn,am as rp,an as ms,ao as kw,ap as Vd,aq as zw,ar as Sw,as as Cw,at as yl,au as ap,av as _w,aw as Tw,ax as Kd,ay as Aw,az as Dw,aA as pc,aB as Pw,aC as Mw,aD as Iw,aE as Ew,aF as Wd}from"./ui-utils-Bzo4Vnxc.js";import{a as Gd,o as Zd,b as Rw,c as Hd,n as Qd,s as Yd}from"./forms-Dah7oaIm.js";import{R as $e,A as to,C as Lt,X as kt,Y as gt,T as Ve,a as Xs,P as Ca,b as _a,c as hs,B as $r,d as yi,L as op,e as fc,F as Lw,f as Ow,g as $w,h as ci,S as lp,Z as cp,i as dp,j as Fw,k as qw,l as Bw,m as Uw,n as Vw,o as Kw,p as Ww,q as Gw}from"./tables-BOHXus41.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}})();var ta={},Jd;function Zw(){if(Jd)return ta;Jd=1;var t=Vy();return ta.createRoot=t.createRoot,ta.hydrateRoot=t.hydrateRoot,ta}var Hw=Zw();const Qw="https://hqsyimochfcfqahcuprn.supabase.co",Yw="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhxc3lpbW9jaGZjZnFhaGN1cHJuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM4NjU4NTYsImV4cCI6MjA2OTQ0MTg1Nn0.KutvVrkDKuVyvrYQosU3SI6QrrMnWqDCSZ2E3fhCteI",X=rw(Qw,Yw,{db:{schema:"public"},auth:{persistSession:!0}}),B=(...t)=>ow(lw(t)),Jw={invalid_credentials:"Nieprawidowy email lub haso.","Invalid login credentials":"Nieprawidowy email lub haso.",email_not_confirmed:"Email nie zosta potwierdzony.","Email not confirmed":"Email nie zosta potwierdzony.",user_not_found:"Nie znaleziono u偶ytkownika.","User not found":"Nie znaleziono u偶ytkownika.",network_error:"Bd poczenia z serwerem.","Too many requests":"Zbyt wiele pr贸b. Spr贸buj ponownie za chwil."},Xw=t=>{if(!t)return{message:"Nieznany bd",name:"UnknownError",statusCode:500};const s=t.message||t.error_description||"";for(const[n,i]of Object.entries(Jw))if(s.includes(n))return{message:i,name:"LoginError",statusCode:t.code==="invalid_credentials"?401:400};return{message:s||"Bd logowania",name:"LoginError",statusCode:400}},up={login:async(t,s)=>{try{if(!t||!s)return{success:!1,error:"Email i haso s wymagane"};const{data:n,error:i}=await X.auth.signInWithPassword({email:t.trim().toLowerCase(),password:s});if(i)return{success:!1,error:Xw(i).message};if(!n.session)return{success:!1,error:"Nie udao si utworzy sesji"};const{data:r}=await X.from("users").select("role").eq("id",n.user.id).single();return{success:!0,redirectTo:r?.role==="admin"?"/admin/dashboard/overview":r?.role==="teacher"?"/teacher/dashboard/overview":r?.role==="student"?"/student/dashboard":"/profiles"}}catch(n){return{success:!1,error:n.message||"Nieznany bd"}}},loginForRefine:async(t,s)=>{const n=await up.login(t,s);return n.success?n:{success:!1,error:{message:n.error,name:"LoginError",statusCode:400}}},checkAuth:async()=>{const{data:{session:t}}=await X.auth.getSession();return!!t}},eb={user_already_exists:"Konto z tym adresem email ju偶 istnieje","User already registered":"Konto z tym adresem email ju偶 istnieje","already exists":"Konto z tym adresem email ju偶 istnieje",weak_password:"Haso musi mie co najmniej 6 znak贸w","Password should be at least":"Haso musi mie co najmniej 6 znak贸w","Password cannot be longer than 72":"Haso nie mo偶e by du偶sze ni偶 72 znaki",invalid_email:"Nieprawidowy format adresu email","Invalid email":"Nieprawidowy format adresu email",over_email_send_rate_limit:"Za szybko! Poczekaj 2 sekundy przed ponown pr贸b"},Xd=t=>{if(!t)return{message:"Nieznany bd",name:"UnknownError",statusCode:500};const s=t.message||"";for(const[n,i]of Object.entries(eb))if(s.includes(n)){let r=400;return n.includes("already")&&(r=409),n.includes("email_send_rate")&&(r=429),{message:i,name:"RegisterError",statusCode:r}}return{message:s||"Rejestracja nie powioda si",name:"RegisterError",statusCode:400}},mp={register:async(t,s,n)=>{try{const{data:i,error:r}=await X.auth.signUp({email:t.trim().toLowerCase(),password:s,options:{data:{full_name:n.trim(),role:"student"},emailRedirectTo:`${window.location.origin}/login?verified=true`}});return r?{success:!1,error:Xd(r).message}:i.user?{success:!0,needsEmailConfirmation:!i.session}:{success:!1,error:"Rejestracja nie powioda si"}}catch(i){return{success:!1,error:i.message||"Bd rejestracji"}}},registerForRefine:async(t,s,n)=>{const i=await mp.register(t,s,n);return i.success?{success:!0,successNotification:i.needsEmailConfirmation?{message:"Rejestracja udana!",description:"Sprawd藕 email aby potwierdzi konto."}:{message:"Rejestracja udana!",description:"Mo偶esz si teraz zalogowa."}}:{success:!1,error:Xd({message:i.error})}}},tb={"User not found":"Nie znaleziono u偶ytkownika z tym adresem email","Invalid email":"Nieprawidowy format adresu email",over_email_send_rate_limit:"Za szybko! Poczekaj chwil przed kolejn pr贸b",reset_password_rate_limit:"Zbyt wiele pr贸b. Spr贸buj ponownie za kilka minut"},eu=t=>{if(!t)return{message:"Nieznany bd",name:"UnknownError",statusCode:500};const s=t.message||"";for(const[n,i]of Object.entries(tb))if(s.includes(n))return{message:i,name:"ForgotPasswordError",statusCode:n.includes("rate_limit")?429:400};return{message:s||"Bd podczas wysyania emaila",name:"ForgotPasswordError",statusCode:400}},hp={sendResetEmail:async t=>{try{const{error:s}=await X.auth.resetPasswordForEmail(t.trim().toLowerCase(),{redirectTo:`${window.location.origin}/update-password`});return s?{success:!1,error:eu(s).message}:{success:!0}}catch(s){return{success:!1,error:s.message||"Bd podczas wysyania emaila"}}},sendResetEmailForRefine:async t=>{const s=await hp.sendResetEmail(t);return s.success?{success:!0,successNotification:{message:"Email wysany!",description:"Sprawd藕 swoj skrzynk odbiorcz"}}:{success:!1,error:eu({message:s.error})}}},sb={"New password should be different":"Nowe haso musi by inne ni偶 obecne","Password should be at least":"Haso musi mie co najmniej 6 znak贸w","Invalid token":"Link wygas lub jest nieprawidowy",session_not_found:"Sesja wygasa. Spr贸buj ponownie"},tu=t=>{if(!t)return{message:"Nieznany bd",name:"UnknownError",statusCode:500};const s=t.message||"";for(const[n,i]of Object.entries(sb))if(s.includes(n))return{message:i,name:"UpdatePasswordError",statusCode:n.includes("token")||n.includes("session")?401:400};return{message:s||"Bd aktualizacji hasa",name:"UpdatePasswordError",statusCode:400}},pp={checkSession:async()=>{try{const{data:t}=await X.auth.getSession(),n=new URLSearchParams(window.location.hash.substring(1)).get("type");return!t.session&&n!=="recovery"?{isValid:!1,error:"Link wygas lub jest nieprawidowy"}:{isValid:!0}}catch{return{isValid:!1,error:"Bd weryfikacji sesji"}}},updatePassword:async t=>{try{const{error:s}=await X.auth.updateUser({password:t});return s?{success:!1,error:tu(s).message}:{success:!0}}catch(s){return{success:!1,error:s.message||"Bd aktualizacji hasa"}}},updatePasswordForRefine:async t=>{const s=await pp.updatePassword(t);return s.success?{success:!0,redirectTo:"/login?passwordChanged=true"}:{success:!1,error:tu({message:s.error})}}};class nb{constructor(){ts(this,"cache",null);ts(this,"lastFetch",0);ts(this,"CACHE_DURATION",300*1e3);ts(this,"fetchPromise",null)}async get(s=!1){const n=Date.now();if(!s&&this.cache&&n-this.lastFetch<this.CACHE_DURATION)return this.cache;if(this.fetchPromise)return this.fetchPromise;this.fetchPromise=this.fetchUser();const i=await this.fetchPromise;return this.fetchPromise=null,i}async fetchUser(){try{const{data:{session:s}}=await X.auth.getSession();if(!s?.user)return this.clear(),null;const{data:n,error:i}=await X.from("users").select("*").eq("id",s.user.id).single();if(i||!n){console.error("Error fetching user data:",i);const a={id:s.user.id,email:s.user.email||"",full_name:s.user.user_metadata?.full_name||s.user.email?.split("@")[0]||"User",vendor_id:1,role:"student"};return this.set(a),a}const r={id:n.id,email:n.email,full_name:n.full_name,vendor_id:n.vendor_id,role:n.role,is_active:n.is_active,created_at:n.created_at};return this.set(r),r}catch(s){return console.error("Error in fetchUser:",s),this.clear(),null}}set(s){this.cache=s,this.lastFetch=Date.now()}clear(){this.cache=null,this.lastFetch=0,this.fetchPromise=null}async refresh(){return this.get(!0)}}const Qs=new nb;X.auth.onAuthStateChange((t,s)=>{t==="SIGNED_OUT"||!s?Qs.clear():(t==="SIGNED_IN"||t==="TOKEN_REFRESHED")&&Qs.get(!0)});const Oo={logout:async()=>{try{Qs.clear();const{error:t}=await X.auth.signOut();return t?{success:!1,error:{message:"Bd podczas wylogowania",name:"LogoutError",statusCode:500}}:{success:!0,redirectTo:"/login"}}catch{return{success:!1,error:{message:"Nieoczekiwany bd podczas wylogowania",name:"LogoutError",statusCode:500}}}},check:async()=>{try{const{data:{session:t}}=await X.auth.getSession();if(!t)return{authenticated:!1,redirectTo:"/login"};const s=t.expires_at;return s&&s*1e3<Date.now()?{authenticated:!1,redirectTo:"/login"}:{authenticated:!0}}catch{return{authenticated:!1,redirectTo:"/login"}}},handleError:async t=>(console.error("Auth error:",t),t?.statusCode===401?(Qs.clear(),{redirectTo:"/login",logout:!0,error:t}):{error:t})},ib={login:async({email:t,password:s})=>{const n=await up.login(t,s);return n.success&&await Qs.refresh(),n},logout:async()=>await Oo.logout(),check:async()=>await Oo.check(),getIdentity:async()=>await Qs.get(),getPermissions:async()=>(await Qs.get())?.role||null,register:async({email:t,password:s,name:n})=>await mp.registerForRefine(t,s,n),forgotPassword:async({email:t})=>await hp.sendResetEmailForRefine(t),updatePassword:async({password:t})=>{const s=await pp.updatePasswordForRefine(t);return s.success&&await Qs.clear(),s},onError:async t=>await Oo.handleError(t)},xc=({isLoading:t,isError:s,loadingText:n="Loading...",errorMsg:i="Error loading data"})=>t?e.jsx("div",{className:"p-6 text-gray-600 animate-reverse-pulse",children:n}):s?e.jsx("div",{className:"p-6 text-red-500",children:i}):null;console.log("1. Login index.tsx - adowanie moduu");const rb=f.lazy(()=>(console.log("2. Login - rozpoczcie lazy load"),Ha(()=>import("./LoginPage-BNy3ay7X.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])).then(t=>(console.log("3. Login - modu zaadowany",t),t)))),ab=()=>(console.log("4. Login - renderowanie fallback"),e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"adowanie logowania..."})]})})),fp=e.jsx(K,{path:"/login",element:e.jsx(f.Suspense,{fallback:e.jsx(ab,{}),children:e.jsx(rb,{})})});console.log("5. Login module exported",fp);const ob=f.lazy(()=>Ha(()=>import("./RegisterFlow-Cnj2n1Lh.js"),__vite__mapDeps([10,1,2,3,5,4,6,7,8,9]))),lb=()=>e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Przygotowywanie rejestracji..."})]})}),cb=e.jsx(K,{path:"/register/*",element:e.jsx(f.Suspense,{fallback:e.jsx(lb,{}),children:e.jsx(ob,{})})}),db=f.lazy(()=>Ha(()=>import("./ForgotPasswordPage-BLTdl2Ku.js"),__vite__mapDeps([11,1,2,3,4,5,6,7,8,9]))),ub=()=>e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-yellow-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"adowanie formularza resetowania..."})]})}),mb=e.jsx(K,{path:"/forgot-password",element:e.jsx(f.Suspense,{fallback:e.jsx(ub,{}),children:e.jsx(db,{})})}),hb=f.lazy(()=>Ha(()=>import("./UpdatePasswordPage-BKhw-fyR.js"),__vite__mapDeps([12,1,2,3,4,5,6,7,8,9]))),pb=()=>e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Weryfikacja linku resetowania..."})]})}),fb=e.jsx(K,{path:"/update-password",element:e.jsx(f.Suspense,{fallback:e.jsx(pb,{}),children:e.jsx(hb,{})})}),fr=f.forwardRef(({className:t,...s},n)=>e.jsx(gh,{ref:n,className:B("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...s}));fr.displayName=gh.displayName;const xb=f.forwardRef(({className:t,...s},n)=>e.jsx(jh,{ref:n,className:B("aspect-square h-full w-full object-cover",t),...s}));xb.displayName=jh.displayName;const xr=f.forwardRef(({className:t,...s},n)=>e.jsx(yh,{ref:n,className:B("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...s}));xr.displayName=yh.displayName;function Mt({className:t,...s}){return e.jsx("div",{className:B("animate-pulse rounded-md bg-primary/10",t),...s})}const xp=({className:t="",showRole:s=!0,showEmail:n=!0,compact:i=!1})=>{const{data:r,isLoading:a,error:o}=Ze(),l=h=>{switch(h){case"admin":return e.jsx(Ya,{className:"h-3 w-3"});case"teacher":return e.jsx(mc,{className:"h-3 w-3"});case"student":return e.jsx(gi,{className:"h-3 w-3"});default:return e.jsx(Sa,{className:"h-3 w-3"})}},c=h=>{switch(h){case"admin":return"Administrator";case"teacher":return"Nauczyciel";case"student":return"Ucze";default:return"U偶ytkownik"}},d=h=>{switch(h){case"admin":return"text-purple-600 bg-purple-50";case"teacher":return"text-blue-600 bg-blue-50";case"student":return"text-green-600 bg-green-50";default:return"text-gray-600 bg-gray-50"}};if(a)return e.jsxs("div",{className:`flex items-center space-x-3 p-3 ${t}`,children:[e.jsx(Mt,{className:"h-10 w-10 rounded-full"}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(Mt,{className:"h-4 w-28"}),e.jsx(Mt,{className:"h-3 w-20"}),s&&e.jsx(Mt,{className:"h-3 w-16"})]})]});if(o||!r)return e.jsxs("div",{className:`flex items-center space-x-3 p-3 text-muted-foreground ${t}`,children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(Sa,{className:"h-5 w-5 text-gray-400"})}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium text-gray-500",children:"Nie zalogowano"}),e.jsx("div",{className:"text-xs opacity-70",children:"Brak danych u偶ytkownika"})]})]});const m=(h=>{if(!h)return"U";const y=h.trim().split(" ");return y.length>=2?`${y[0][0]}${y[y.length-1][0]}`.toUpperCase():h.slice(0,2).toUpperCase()})(r.full_name||r.email);return i?e.jsxs("div",{className:`flex items-center space-x-2 p-2 ${t}`,children:[e.jsx(fr,{className:"h-8 w-8",children:e.jsx(xr,{className:"bg-gradient-to-br from-purple-500 to-pink-500 text-white text-xs",children:m})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"font-medium text-sm truncate",children:r.full_name})})]}):e.jsxs("div",{className:`flex items-center space-x-3 px-4 pt-4 rounded-lg bg-white/50 backdrop-blur-sm border border-purple-100/20 ${t}`,children:[e.jsx(fr,{className:"h-12 w-12 ring-2 ring-purple-100 ring-offset-2",children:e.jsx(xr,{className:"bg-gradient-to-br from-purple-500 to-pink-500 text-white font-medium",children:m})}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-1",children:[e.jsx("div",{className:"font-semibold text-gray-900 truncate",title:r.full_name,children:r.full_name}),n&&r.email&&e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-500",children:[e.jsx(Qa,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate",title:r.email,children:r.email})]}),s&&r.role&&e.jsx("div",{className:"inline-flex items-center gap-1.5",children:e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full text-xs font-medium ${d(r.role)}`,children:[l(r.role),c(r.role)]})})]})]})},gb=Ja("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-3.5 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),he=f.forwardRef(({className:t,variant:s,...n},i)=>e.jsx("div",{ref:i,role:"alert",className:B(gb({variant:s}),t),...n}));he.displayName="Alert";const jb=f.forwardRef(({className:t,...s},n)=>e.jsx("h5",{ref:n,className:B("mb-1 font-medium leading-none tracking-tight",t),...s}));jb.displayName="AlertTitle";const pe=f.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:B("text-sm [&_p]:leading-relaxed",t),...s}));pe.displayName="AlertDescription";const yb=Ja("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function V({className:t,variant:s,asChild:n=!1,...i}){const r=n?ic:"span";return e.jsx(r,{"data-slot":"badge",className:B(yb({variant:s}),t),...i})}const wb=f.forwardRef(({...t},s)=>e.jsx("nav",{ref:s,"aria-label":"breadcrumb",...t}));wb.displayName="Breadcrumb";const bb=f.forwardRef(({className:t,...s},n)=>e.jsx("ol",{ref:n,className:B("flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",t),...s}));bb.displayName="BreadcrumbList";const vb=f.forwardRef(({className:t,...s},n)=>e.jsx("li",{ref:n,className:B("inline-flex items-center gap-1.5",t),...s}));vb.displayName="BreadcrumbItem";const Nb=f.forwardRef(({asChild:t,className:s,...n},i)=>{const r=t?ic:"a";return e.jsx(r,{ref:i,className:B("transition-colors hover:text-foreground",s),...n})});Nb.displayName="BreadcrumbLink";const kb=f.forwardRef(({className:t,...s},n)=>e.jsx("span",{ref:n,role:"link","aria-disabled":"true","aria-current":"page",className:B("font-normal text-foreground",t),...s}));kb.displayName="BreadcrumbPage";const zb=Ja("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),M=f.forwardRef(({className:t,variant:s,size:n,asChild:i=!1,...r},a)=>{const o=i?ic:"button";return e.jsx(o,{className:B(zb({variant:s,size:n,className:t})),ref:a,...r})});M.displayName="Button";const I=f.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:B("rounded-xl border bg-card text-card-foreground shadow flex flex-col overflow-hidden",t),...s}));I.displayName="Card";const F=f.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:B("flex flex-col space-y-1.5 p-6 pb-3 bg-pink-200/25",t),...s}));F.displayName="CardHeader";const $=f.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:B("text-lg font-semibold leading-tight tracking-tight pt-3",t),...s}));$.displayName="CardTitle";const so=f.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:B("text-sm text-muted-foreground",t),...s}));so.displayName="CardDescription";const E=f.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:B("p-3 lg:p-6 pt-3 space-y-3 flex-1 bg-background",t),...s}));E.displayName="CardContent";const Sb=f.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:B("flex items-center justify-between p-6 pt-0",t),...s}));Sb.displayName="CardFooter";const Cb=Ja("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),gr=f.forwardRef(({className:t,...s},n)=>e.jsx(wh,{ref:n,className:B(Cb(),t),...s}));gr.displayName=wh.displayName;f.createContext({});f.createContext({});const Q=f.forwardRef(({className:t,type:s,...n},i)=>e.jsx("input",{type:s,className:B("flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:i,...n}));Q.displayName="Input";const _b=f.forwardRef(({className:t,align:s="center",sideOffset:n=4,...i},r)=>e.jsx(ry,{children:e.jsx(bh,{ref:r,align:s,sideOffset:n,className:B("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",t),...i})}));_b.displayName=bh.displayName;const tt=f.forwardRef(({className:t,children:s,...n},i)=>e.jsxs(vh,{ref:i,className:B("relative overflow-hidden",t),...n,children:[e.jsx(ay,{className:"h-full w-full rounded-[inherit]",children:s}),e.jsx(gp,{}),e.jsx(oy,{})]}));tt.displayName=vh.displayName;const gp=f.forwardRef(({className:t,orientation:s="vertical",...n},i)=>e.jsx(Nh,{ref:i,orientation:s,className:B("flex touch-none select-none transition-colors",s==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",s==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...n,children:e.jsx(ly,{className:"relative flex-1 rounded-full bg-border"})}));gp.displayName=Nh.displayName;const ge=py,je=fy,fe=f.forwardRef(({className:t,children:s,...n},i)=>e.jsxs(kh,{ref:i,className:B("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-background px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...n,children:[s,e.jsx(cy,{asChild:!0,children:e.jsx(dt,{className:"h-4 w-4 opacity-50"})})]}));fe.displayName=kh.displayName;const jp=f.forwardRef(({className:t,...s},n)=>e.jsx(zh,{ref:n,className:B("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx($t,{className:"h-4 w-4"})}));jp.displayName=zh.displayName;const yp=f.forwardRef(({className:t,...s},n)=>e.jsx(Sh,{ref:n,className:B("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(dt,{className:"h-4 w-4"})}));yp.displayName=Sh.displayName;const xe=f.forwardRef(({className:t,children:s,position:n="popper",...i},r)=>e.jsx(dy,{children:e.jsxs(Ch,{ref:r,className:B("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...i,children:[e.jsx(jp,{}),e.jsx(uy,{className:B("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),e.jsx(yp,{})]})}));xe.displayName=Ch.displayName;const Tb=f.forwardRef(({className:t,...s},n)=>e.jsx(_h,{ref:n,className:B("px-2 py-1.5 text-sm font-semibold",t),...s}));Tb.displayName=_h.displayName;const W=f.forwardRef(({className:t,children:s,...n},i)=>e.jsxs(Th,{ref:i,className:B("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[e.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(my,{children:e.jsx(rt,{className:"h-4 w-4"})})}),e.jsx(hy,{children:s})]}));W.displayName=Th.displayName;const Ab=f.forwardRef(({className:t,...s},n)=>e.jsx(Ah,{ref:n,className:B("-mx-1 my-1 h-px bg-muted",t),...s}));Ab.displayName=Ah.displayName;const no=f.forwardRef(({className:t,orientation:s="horizontal",decorative:n=!0,...i},r)=>e.jsx(Dh,{ref:r,decorative:n,orientation:s,className:B("shrink-0 bg-border",s==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...i}));no.displayName=Dh.displayName;function En({className:t,...s}){return e.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:e.jsx("table",{"data-slot":"table",className:B("w-full caption-bottom text-sm",t),...s})})}function Rn({className:t,...s}){return e.jsx("thead",{"data-slot":"table-header",className:B("[&_tr]:border-b",t),...s})}function Ln({className:t,...s}){return e.jsx("tbody",{"data-slot":"table-body",className:B("[&_tr:last-child]:border-0",t),...s})}function St({className:t,...s}){return e.jsx("tr",{"data-slot":"table-row",className:B("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...s})}function le({className:t,...s}){return e.jsx("th",{"data-slot":"table-head",className:B("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...s})}function ce({className:t,...s}){return e.jsx("td",{"data-slot":"table-cell",className:B("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...s})}const Xt=f.forwardRef(({className:t,...s},n)=>e.jsx("textarea",{className:B("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:n,...s}));Xt.displayName="Textarea";const gc=xy,io=f.forwardRef(({className:t,...s},n)=>e.jsx(Ph,{ref:n,className:B("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",t),...s}));io.displayName=Ph.displayName;const Wt=f.forwardRef(({className:t,...s},n)=>e.jsx(Mh,{ref:n,className:B("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",t),...s}));Wt.displayName=Mh.displayName;const Gt=f.forwardRef(({className:t,...s},n)=>e.jsx(Ih,{ref:n,className:B("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...s}));Gt.displayName=Ih.displayName;const Ge=f.forwardRef(({className:t,...s},n)=>e.jsx(Eh,{ref:n,className:B("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...s,children:e.jsx(gy,{className:B("flex items-center justify-center text-current"),children:e.jsx(rt,{className:"h-4 w-4"})})}));Ge.displayName=Eh.displayName;var ro="Switch",[Db,uP]=rc(ro),[Pb,Mb]=Db(ro),wp=f.forwardRef((t,s)=>{const{__scopeSwitch:n,name:i,checked:r,defaultChecked:a,required:o,disabled:l,value:c="on",onCheckedChange:d,form:u,...m}=t,[h,y]=f.useState(null),x=Pn(s,v=>y(v)),g=f.useRef(!1),j=h?u||!!h.closest("form"):!0,[w,b]=Rh({prop:r,defaultProp:a??!1,onChange:d,caller:ro});return e.jsxs(Pb,{scope:n,checked:w,disabled:l,children:[e.jsx(on.button,{type:"button",role:"switch","aria-checked":w,"aria-required":o,"data-state":kp(w),"data-disabled":l?"":void 0,disabled:l,value:c,...m,ref:x,onClick:Se(t.onClick,v=>{b(C=>!C),j&&(g.current=v.isPropagationStopped(),g.current||v.stopPropagation())})}),j&&e.jsx(Np,{control:h,bubbles:!g.current,name:i,value:c,checked:w,required:o,disabled:l,form:u,style:{transform:"translateX(-100%)"}})]})});wp.displayName=ro;var bp="SwitchThumb",vp=f.forwardRef((t,s)=>{const{__scopeSwitch:n,...i}=t,r=Mb(bp,n);return e.jsx(on.span,{"data-state":kp(r.checked),"data-disabled":r.disabled?"":void 0,...i,ref:s})});vp.displayName=bp;var Ib="SwitchBubbleInput",Np=f.forwardRef(({__scopeSwitch:t,control:s,checked:n,bubbles:i=!0,...r},a)=>{const o=f.useRef(null),l=Pn(o,a),c=jy(n),d=yy(s);return f.useEffect(()=>{const u=o.current;if(!u)return;const m=window.HTMLInputElement.prototype,y=Object.getOwnPropertyDescriptor(m,"checked").set;if(c!==n&&y){const x=new Event("click",{bubbles:i});y.call(u,n),u.dispatchEvent(x)}},[c,n,i]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n,...r,tabIndex:-1,ref:l,style:{...r.style,...d,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Np.displayName=Ib;function kp(t){return t?"checked":"unchecked"}var zp=wp,Eb=vp;const qt=f.forwardRef(({className:t,...s},n)=>e.jsx(zp,{className:B("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...s,ref:n,children:e.jsx(Eb,{className:B("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));qt.displayName=zp.displayName;const Ts=by,As=vy,Ds=Ny,us=f.forwardRef(({className:t,sideOffset:s=4,...n},i)=>e.jsx(wy,{children:e.jsx(Lh,{ref:i,sideOffset:s,className:B("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",t),...n})}));us.displayName=Lh.displayName;const Cn=Sy,Rb=ky,Sp=f.forwardRef(({className:t,...s},n)=>e.jsx(Oh,{ref:n,className:B("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s}));Sp.displayName=Oh.displayName;const en=f.forwardRef(({className:t,children:s,...n},i)=>e.jsxs(Rb,{children:[e.jsx(Sp,{}),e.jsxs($h,{ref:i,className:B("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...n,children:[s,e.jsxs(zy,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(Jt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));en.displayName=$h.displayName;const tn=({className:t,...s})=>e.jsx("div",{className:B("flex flex-col space-y-1.5 text-center sm:text-left",t),...s});tn.displayName="DialogHeader";const ao=({className:t,...s})=>e.jsx("div",{className:B("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s});ao.displayName="DialogFooter";const sn=f.forwardRef(({className:t,...s},n)=>e.jsx(Fh,{ref:n,className:B("text-lg font-semibold leading-none tracking-tight",t),...s}));sn.displayName=Fh.displayName;const jr=f.forwardRef(({className:t,...s},n)=>e.jsx(qh,{ref:n,className:B("text-sm text-muted-foreground",t),...s}));jr.displayName=qh.displayName;const is=f.forwardRef(({className:t,value:s,...n},i)=>e.jsx(Bh,{ref:i,className:B("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",t),...n,children:e.jsx(Cy,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}));is.displayName=Bh.displayName;const Lb=({onClose:t})=>{const{mutate:s}=Za(),{menuItems:n}=Qh(),{data:i}=Ze(),r=()=>{t&&t()};return e.jsxs("div",{className:"flex h-full w-64 flex-col border-r bg-background",children:[e.jsxs("div",{className:"flex h-16 items-center justify-between border-b px-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Lr,{className:"h-6 w-6 mr-2"}),e.jsx("span",{className:"font-semibold",children:"Smart Up"})]}),t&&e.jsx(M,{variant:"ghost",size:"sm",onClick:t,className:"lg:hidden",children:e.jsx(Jt,{className:"h-4 w-4"})})]}),e.jsx(tt,{className:"flex-1 px-3 py-4",children:e.jsx("nav",{className:"space-y-4",children:n.map(a=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(pi,{to:a.route??"/",onClick:r,className:({isActive:o})=>B("flex items-center justify-between rounded-md px-3 py-2 text-sm font-semibold transition-colors hover:bg-accent hover:text-accent-foreground",o?"bg-accent text-accent-foreground":"text-foreground"),children:[e.jsxs("span",{className:"flex items-center",children:[a.icon&&e.jsx("span",{className:"mr-3",children:a.icon}),a.label]}),a.children&&a.children.length>0&&e.jsx(dt,{className:"h-4 w-4 opacity-60"})]}),a.children&&a.children.length>0&&e.jsx("div",{className:"ml-3 border-l pl-3 space-y-1",children:a.children.map(o=>e.jsxs(pi,{to:o.route??"/",onClick:r,className:({isActive:l})=>B("flex items-center rounded-md px-3 py-2 text-sm transition-colors hover:bg-accent hover:text-accent-foreground",l?"bg-accent text-accent-foreground":"text-muted-foreground"),children:[o.icon&&e.jsx("span",{className:"mr-3",children:o.icon}),o.label]},o.key))})]},a.key))})}),e.jsx(no,{}),e.jsx(xp,{className:"border-b"}),e.jsx("div",{className:"p-4",children:e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>{s(),t&&t()},className:"w-full justify-start",children:[e.jsx(Xa,{className:"mr-2 h-4 w-4"}),"Logout"]})})]})},Ob=({children:t})=>{const[s,n]=f.useState(!1),i=()=>{n(!s)};return e.jsx("div",{className:"min-h-screen bg-stone-200 relative overflow-x-hidden",children:e.jsxs("div",{className:"flex relative",children:[s&&e.jsx("div",{className:"fixed inset-0 z-40 bg-purple-900/20 backdrop-blur-sm lg:hidden",onClick:()=>n(!1)}),e.jsx("aside",{className:`
            h-screen w-64 transform transition-transform duration-300 ease-in-out
            fixed left-0 top-0 z-50
            ${s?"translate-x-0":"-translate-x-full"}
            lg:translate-x-0
            bg-background/95 backdrop-blur-md border-r border-purple-200/20
          `,children:e.jsx(Lb,{onClose:()=>n(!1)})}),e.jsxs("main",{className:"flex-1 lg:ml-64 min-w-0 relative z-10",children:[e.jsxs("div",{className:"sticky top-0 z-30 flex h-16 items-center border-b border-purple-200/20 bg-background/80 backdrop-blur-md px-4 lg:hidden",children:[e.jsx(M,{variant:"ghost",size:"sm",onClick:i,className:"mr-2 hover:bg-purple-100/20 hover:text-purple-700",children:e.jsx(Lr,{className:"h-6 w-6"})}),e.jsx("span",{className:"font-semibold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:"Smart Up"})]}),t]})]})})},$b=()=>e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Admin Dashboard"}),e.jsx("p",{children:"Welcome to admin panel"})]}),Fb=[e.jsx(K,{path:"dashboard/overview",element:e.jsx($b,{})},"dashboard-overview")],H=({children:t})=>e.jsx("div",{className:"p-2 md:p-12 space-y-6 max-w-7xl mx-auto",children:t}),qb=({course:t,open:s,onOpenChange:n,onAccessUpdate:i})=>{const{open:r}=cc(),[a,o]=f.useState(""),[l,c]=f.useState(""),[d,u]=f.useState(!1),{data:m}=Z({resource:"groups",filters:[{field:"is_active",operator:"eq",value:!0}],pagination:{pageSize:1e3},sorters:[{field:"name",order:"asc"}],queryOptions:{enabled:s}}),{data:h}=Z({resource:"users",filters:[{field:"role",operator:"eq",value:"teacher"},{field:"is_active",operator:"eq",value:!0}],pagination:{pageSize:1e3},sorters:[{field:"full_name",order:"asc"}],queryOptions:{enabled:s}}),{data:y,refetch:x}=Z({resource:"course_access",filters:t?[{field:"course_id",operator:"eq",value:t.id}]:[],pagination:{pageSize:1e4},queryOptions:{enabled:s&&!!t}}),g=f.useMemo(()=>m?.data??[],[m]),j=f.useMemo(()=>h?.data??[],[h]),w=f.useMemo(()=>y?.data??[],[y]),b=f.useMemo(()=>{if(!t)return{groupAccess:{},teacherAccess:{}};const T={},p={};return w.forEach(N=>{N.group_id&&(T[N.group_id]=!0),N.teacher_id&&(p[N.teacher_id]=!0)}),{groupAccess:T,teacherAccess:p}},[t,w]),v=f.useMemo(()=>g.filter(T=>!a||T.name.toLowerCase().includes(a.toLowerCase())||T.academic_year.includes(a)),[g,a]),C=f.useMemo(()=>j.filter(T=>!l||T.full_name.toLowerCase().includes(l.toLowerCase())||T.email.toLowerCase().includes(l.toLowerCase())),[j,l]);f.useEffect(()=>{s||(o(""),c(""))},[s]);const _=async(T,p)=>{if(t){u(!0);try{if(p){const{error:N}=await X.from("course_access").delete().eq("course_id",t.id).eq("group_id",T);if(N)throw N}else{const{error:N}=await X.from("course_access").insert({course_id:t.id,group_id:T,teacher_id:null});if(N)throw N}r?.({type:"success",message:p?"Dostp usunity":"Dostp przyznany"}),x(),i()}catch{r?.({type:"error",message:"Wystpi bd podczas zapisywania"})}finally{u(!1)}}},S=async(T,p)=>{if(t){u(!0);try{if(p){const{error:N}=await X.from("course_access").delete().eq("course_id",t.id).eq("teacher_id",T);if(N)throw N}else{const{error:N}=await X.from("course_access").insert({course_id:t.id,group_id:null,teacher_id:T});if(N)throw N}r?.({type:"success",message:p?"Dostp usunity":"Dostp przyznany"}),x(),i()}catch{r?.({type:"error",message:"Wystpi bd podczas zapisywania"})}finally{u(!1)}}},z=Object.values(b.groupAccess).filter(Boolean).length,k=Object.values(b.teacherAccess).filter(Boolean).length;return e.jsx(Cn,{open:s,onOpenChange:n,children:e.jsxs(en,{className:"max-w-4xl max-h-[80vh]",children:[e.jsx(tn,{children:e.jsxs(sn,{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:t?.icon_emoji||""}),e.jsxs("div",{children:[e.jsx("div",{children:"Zarzdzaj dostpem do kursu"}),e.jsx("div",{className:"text-sm font-normal text-muted-foreground",children:t?.title})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 overflow-hidden",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"font-medium text-sm flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4"}),"Grupy z dostpem"]}),e.jsxs(V,{variant:"secondary",children:[z," z ",g.length]})]}),e.jsx(Q,{placeholder:"Szukaj grupy...",value:a,onChange:T=>o(T.target.value),className:"h-9"}),e.jsx(tt,{className:"h-[350px] border rounded-lg p-3",children:e.jsx("div",{className:"space-y-2",children:v.map(T=>{const p=b.groupAccess[T.id]||!1;return e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border-2 cursor-pointer transition-all ${p?"border-primary bg-primary/5":"border-transparent hover:bg-muted"}`,children:[e.jsx(Ge,{checked:p,onCheckedChange:()=>_(T.id,p),disabled:d}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:T.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:T.academic_year})]}),p&&e.jsx(rt,{className:"w-4 h-4 text-primary"})]},T.id)})})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"font-medium text-sm flex items-center gap-2",children:[e.jsx(Es,{className:"w-4 h-4"}),"Nauczyciele prowadzcy"]}),e.jsxs(V,{variant:"secondary",children:[k," z ",j.length]})]}),e.jsx(Q,{placeholder:"Szukaj nauczyciela...",value:l,onChange:T=>c(T.target.value),className:"h-9"}),e.jsx(tt,{className:"h-[350px] border rounded-lg p-3",children:e.jsx("div",{className:"space-y-2",children:C.map(T=>{const p=b.teacherAccess[T.id]||!1;return e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border-2 cursor-pointer transition-all ${p?"border-primary bg-primary/5":"border-transparent hover:bg-muted"}`,children:[e.jsx(Ge,{checked:p,onCheckedChange:()=>S(T.id,p),disabled:d}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:T.full_name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:T.email})]}),p&&e.jsx(rt,{className:"w-4 h-4 text-primary"})]},T.id)})})})]})]}),e.jsxs(ao,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Kurs dostpny dla ",e.jsxs("strong",{children:[z," grup"]})," i"," ",e.jsxs("strong",{children:[k," nauczycieli"]})]}),e.jsx(M,{variant:"outline",onClick:()=>n(!1),children:"Zamknij"})]})]})})},Bb=()=>{const[t,s]=f.useState(!1);return e.jsx(I,{className:"border-2 border-green-200/50 bg-gradient-to-br from-green-50/50 to-emerald-50/50 dark:from-green-950/20 dark:to-emerald-950/20",children:e.jsx(E,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-green-100 dark:bg-green-900/50 flex-shrink-0",children:e.jsx(ye,{className:"h-6 w-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"font-semibold text-lg flex items-center gap-2",children:["Zarzdzanie dostpem do kurs贸w",e.jsx(hc,{className:"h-4 w-4 text-green-500"})]}),e.jsx("button",{onClick:()=>s(!t),className:"p-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-green-600 dark:text-green-400","aria-label":t?"Zwi szczeg贸y":"Rozwi szczeg贸y",children:t?e.jsx($t,{className:"h-5 w-5"}):e.jsx(dt,{className:"h-5 w-5"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Kontroluj, kt贸re grupy i nauczyciele maj dostp do poszczeg贸lnych kurs贸w."}),t&&e.jsxs("div",{className:"mt-4 space-y-4 animate-in slide-in-from-top-2 duration-200",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900/50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/50 rounded-lg flex-shrink-0",children:e.jsx(de,{className:"h-4 w-4 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:"Przypisz grupy"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Wybierz grupy, kt贸re bd miay dostp do kursu"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/50 rounded-lg flex-shrink-0",children:e.jsx(Es,{className:"h-4 w-4 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:"Dodaj nauczycieli"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Wska偶 nauczycieli prowadzcych zajcia"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/50 rounded-lg flex-shrink-0",children:e.jsx(Ya,{className:"h-4 w-4 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:"Kontroluj dostp"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Zmiany s zapisywane automatycznie"})]})]})]}),e.jsx("div",{className:"p-3 bg-green-50 dark:bg-green-950/30 rounded-lg",children:e.jsxs("p",{className:"text-xs text-green-700 dark:text-green-300 flex items-start gap-2",children:[e.jsx(cn,{className:"h-3 w-3 mt-0.5 flex-shrink-0"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Wa偶ne:"}),' Najpierw utw贸rz grupy w module "Grupy i klasy", a nastpnie przypisz je do kurs贸w tutaj.']})]})})]})]})]})})})},Ub=()=>{const[t,s]=f.useState(""),[n,i]=f.useState(null),[r,a]=f.useState(!1),[o,l]=f.useState({key:"title",direction:"asc"}),{data:c,isLoading:d}=Z({resource:"courses",filters:[{field:"is_published",operator:"eq",value:!0}],pagination:{pageSize:1e3},sorters:[{field:"title",order:"asc"}]}),{data:u,refetch:m}=Z({resource:"course_access",pagination:{pageSize:1e4}}),h=f.useMemo(()=>c?.data??[],[c]),y=f.useMemo(()=>u?.data??[],[u]),x=f.useMemo(()=>{const b={};return h.forEach(v=>{const C=y.filter(_=>_.course_id===v.id);b[v.id]={groupCount:C.filter(_=>_.group_id).length,teacherCount:C.filter(_=>_.teacher_id).length}}),b},[h,y]),g=f.useMemo(()=>{const b=h.filter(v=>t===""||v.title.toLowerCase().includes(t.toLowerCase()));return o.key&&b.sort((v,C)=>{let _,S;return o.key==="groupCount"?(_=x[v.id]?.groupCount||0,S=x[C.id]?.groupCount||0):o.key==="teacherCount"?(_=x[v.id]?.teacherCount||0,S=x[C.id]?.teacherCount||0):o.key&&o.key in v&&(_=v[o.key],S=C[o.key]),_<S?o.direction==="asc"?-1:1:_>S?o.direction==="asc"?1:-1:0}),b},[h,t,o,x]),j=b=>{l(v=>({key:b,direction:v.key===b&&v.direction==="asc"?"desc":"asc"}))},w=({column:b})=>o.key!==b?e.jsx($t,{className:"w-4 h-4 opacity-20"}):o.direction==="asc"?e.jsx($t,{className:"w-4 h-4"}):e.jsx(dt,{className:"w-4 h-4"});return e.jsxs(H,{children:[e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Dostp do kurs贸w"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Zarzdzaj dostpem grup i nauczycieli do kurs贸w"})]}),e.jsx(Bb,{}),e.jsx(I,{children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(In,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(Q,{placeholder:"Szukaj kursu po nazwie...",value:t,onChange:b=>s(b.target.value),className:"pl-9"})]})})}),e.jsx(I,{children:e.jsx(E,{className:"p-0",children:d?e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"adowanie kurs贸w..."}):g.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(ye,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground/50"}),e.jsx("p",{className:"text-muted-foreground",children:t?"Nie znaleziono kurs贸w":"Brak kurs贸w w systemie"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(En,{children:[e.jsx(Rn,{children:e.jsxs(St,{children:[e.jsx(le,{className:"cursor-pointer select-none",onClick:()=>j("title"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Kurs",e.jsx(w,{column:"title"})]})}),e.jsx(le,{className:"cursor-pointer select-none text-center",onClick:()=>j("groupCount"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Grupy z dostpem",e.jsx(w,{column:"groupCount"})]})}),e.jsx(le,{className:"cursor-pointer select-none text-center",onClick:()=>j("teacherCount"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Nauczyciele",e.jsx(w,{column:"teacherCount"})]})}),e.jsx(le,{className:"text-center",children:"Akcje"})]})}),e.jsx(Ln,{children:g.map(b=>{const v=x[b.id]||{groupCount:0,teacherCount:0};return e.jsxs(St,{children:[e.jsx(ce,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:b.icon_emoji||""}),e.jsx("div",{className:"font-medium",children:b.title})]})}),e.jsx(ce,{className:"text-center",children:e.jsxs(V,{variant:v.groupCount>0?"default":"secondary",className:"gap-1",children:[e.jsx(de,{className:"w-3 h-3"}),v.groupCount," grup"]})}),e.jsx(ce,{className:"text-center",children:e.jsxs(V,{variant:v.teacherCount>0?"default":"secondary",className:"gap-1",children:[e.jsx(mc,{className:"w-3 h-3"}),v.teacherCount," nauczycieli"]})}),e.jsx(ce,{className:"text-center",children:e.jsxs(M,{size:"sm",variant:"outline",onClick:()=>{i(b),a(!0)},children:[e.jsx(hc,{className:"w-4 h-4 mr-1"}),"Zarzdzaj dostpem"]})})]},b.id)})})]})})})}),e.jsxs("div",{className:"text-sm text-muted-foreground text-center",children:["Wywietlono ",g.length," z ",h.length," kurs贸w"]})]}),e.jsx(qb,{course:n,open:r,onOpenChange:a,onAccessUpdate:m})]})},Vb=()=>{const[t,s]=f.useState(!1);return e.jsx(I,{className:"border-2 border-purple-200/50 bg-gradient-to-br from-purple-50/50 to-pink-50/50 dark:from-purple-950/20 dark:to-pink-950/20",children:e.jsx(E,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-purple-100 dark:bg-purple-900/50 flex-shrink-0",children:e.jsx(cw,{className:"h-6 w-6 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"font-semibold text-lg flex items-center gap-2",children:["Jak zarzdza u偶ytkownikami?",e.jsx(Ke,{className:"h-4 w-4 text-purple-500"})]}),e.jsx("button",{onClick:()=>s(!t),className:"p-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-purple-600 dark:text-purple-400","aria-label":t?"Zwi szczeg贸y":"Rozwi szczeg贸y",children:t?e.jsx($t,{className:"h-5 w-5"}):e.jsx(dt,{className:"h-5 w-5"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"System pozwala na atwe zarzdzanie rolami i statusami u偶ytkownik贸w."}),t&&e.jsxs("div",{className:"mt-4 space-y-4 animate-in slide-in-from-top-2 duration-200",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-purple-100 dark:bg-purple-900/50 text-sm font-bold text-purple-600 flex-shrink-0",children:"1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm mb-1",children:"Znajd藕 u偶ytkownika"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"U偶yj wyszukiwarki lub filtr贸w, aby znale藕 konkretnego u偶ytkownika"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-purple-100 dark:bg-purple-900/50 text-sm font-bold text-purple-600 flex-shrink-0",children:"2"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm mb-1",children:"Zmie rol"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Wybierz now rol z rozwijanej listy: Ucze, Nauczyciel lub Administrator"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-purple-100 dark:bg-purple-900/50 text-sm font-bold text-purple-600 flex-shrink-0",children:"3"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm mb-1",children:"Zarzdzaj statusem"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"U偶yj przecznika, aby aktywowa lub dezaktywowa konto u偶ytkownika"})]})]})]}),e.jsx("div",{className:"p-3 bg-purple-50 dark:bg-purple-950/30 rounded-lg",children:e.jsxs("p",{className:"text-xs text-purple-700 dark:text-purple-300 flex items-start gap-2",children:[e.jsx(Ya,{className:"h-3 w-3 mt-0.5 flex-shrink-0"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Wskaz贸wka:"})," Administratorzy maj peen dostp do systemu. Przyznawaj t rol z rozwag."]})]})})]})]})]})})})},Kb=()=>{const{open:t}=cc(),[s,n]=f.useState(""),[i,r]=f.useState("all"),[a,o]=f.useState("all"),[l,c]=f.useState({key:"full_name",direction:"asc"}),{data:d,isLoading:u,refetch:m}=Z({resource:"users",pagination:{pageSize:1e4},sorters:[{field:"full_name",order:"asc"}]}),{mutate:h,isLoading:y}=Mn(),x=d?.data??[],g=f.useMemo(()=>{const S=x.filter(z=>{const k=s===""||z.full_name.toLowerCase().includes(s.toLowerCase())||z.email.toLowerCase().includes(s.toLowerCase()),T=i==="all"||z.role===i,p=a==="all"||(a==="active"?z.is_active:!z.is_active);return k&&T&&p});return l.key&&S.sort((z,k)=>{const T=z[l.key],p=k[l.key];return T<p?l.direction==="asc"?-1:1:T>p?l.direction==="asc"?1:-1:0}),S},[x,s,i,a,l]),j=f.useMemo(()=>({total:x.length,students:x.filter(S=>S.role==="student").length,teachers:x.filter(S=>S.role==="teacher").length,admins:x.filter(S=>S.role==="admin").length,active:x.filter(S=>S.is_active).length,inactive:x.filter(S=>!S.is_active).length}),[x]),w=S=>{c(z=>({key:S,direction:z.key===S&&z.direction==="asc"?"desc":"asc"}))},b=async(S,z)=>{h({resource:"users",id:S,values:{is_active:!z},successNotification:()=>({message:z?"Konto dezaktywowane":"Konto aktywowane",type:"success"})},{onSuccess:()=>m()})},v=async(S,z)=>{h({resource:"users",id:S,values:{role:z},successNotification:()=>({message:"Rola zmieniona",type:"success"})},{onSuccess:()=>m()})},C=S=>{switch(S){case"admin":return e.jsxs(V,{variant:"destructive",children:[e.jsx(Ya,{className:"w-3 h-3 mr-1"}),"Administrator"]});case"teacher":return e.jsxs(V,{className:"bg-blue-500",children:[e.jsx(mc,{className:"w-3 h-3 mr-1"}),"Nauczyciel"]});default:return e.jsxs(V,{className:"bg-green-500",children:[e.jsx(gi,{className:"w-3 h-3 mr-1"}),"Ucze"]})}},_=({column:S})=>l.key!==S?e.jsx($t,{className:"w-4 h-4 opacity-20"}):l.direction==="asc"?e.jsx($t,{className:"w-4 h-4"}):e.jsx(dt,{className:"w-4 h-4"});return e.jsx(H,{children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Zarzdzanie u偶ytkownikami"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Zmie role u偶ytkownik贸w i zarzdzaj ich dostpem do systemu"})]}),e.jsx(Vb,{}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-3",children:[e.jsx(I,{children:e.jsxs(E,{className:"p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:j.total}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Wszyscy"})]})}),e.jsx(I,{className:"border-green-200 bg-green-50/50 dark:bg-green-950/20",children:e.jsxs(E,{className:"p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:j.students}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Uczniowie"})]})}),e.jsx(I,{className:"border-blue-200 bg-blue-50/50 dark:bg-blue-950/20",children:e.jsxs(E,{className:"p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:j.teachers}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Nauczyciele"})]})}),e.jsx(I,{className:"border-red-200 bg-red-50/50 dark:bg-red-950/20",children:e.jsxs(E,{className:"p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:j.admins}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Admini"})]})}),e.jsx(I,{children:e.jsxs(E,{className:"p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:j.active}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Aktywni"})]})}),e.jsx(I,{children:e.jsxs(E,{className:"p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:j.inactive}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Nieaktywni"})]})})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs($,{className:"text-base flex items-center gap-2",children:[e.jsx(Xh,{className:"w-4 h-4"}),"Filtry"]})}),e.jsx(E,{children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(In,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(Q,{placeholder:"Szukaj po imieniu lub emailu...",value:s,onChange:S=>n(S.target.value),className:"pl-9"})]})}),e.jsxs(ge,{value:i,onValueChange:S=>r(S),children:[e.jsx(fe,{className:"w-[180px]",children:e.jsx(je,{placeholder:"Wszystkie role"})}),e.jsxs(xe,{children:[e.jsx(W,{value:"all",children:"Wszystkie role"}),e.jsx(W,{value:"student",children:"Tylko uczniowie"}),e.jsx(W,{value:"teacher",children:"Tylko nauczyciele"}),e.jsx(W,{value:"admin",children:"Tylko admini"})]})]}),e.jsxs(ge,{value:a,onValueChange:S=>o(S),children:[e.jsx(fe,{className:"w-[180px]",children:e.jsx(je,{placeholder:"Wszystkie statusy"})}),e.jsxs(xe,{children:[e.jsx(W,{value:"all",children:"Wszystkie statusy"}),e.jsx(W,{value:"active",children:"Tylko aktywni"}),e.jsx(W,{value:"inactive",children:"Tylko nieaktywni"})]})]})]})})]}),e.jsx(I,{children:e.jsx(E,{className:"p-0",children:u?e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"adowanie u偶ytkownik贸w..."}):g.length===0?e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"Nie znaleziono u偶ytkownik贸w speniajcych kryteria"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(En,{children:[e.jsx(Rn,{children:e.jsxs(St,{children:[e.jsx(le,{className:"cursor-pointer select-none",onClick:()=>w("full_name"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Imi i nazwisko",e.jsx(_,{column:"full_name"})]})}),e.jsx(le,{className:"cursor-pointer select-none",onClick:()=>w("email"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Email",e.jsx(_,{column:"email"})]})}),e.jsx(le,{className:"cursor-pointer select-none",onClick:()=>w("role"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Rola",e.jsx(_,{column:"role"})]})}),e.jsx(le,{children:"Zmie rol"}),e.jsx(le,{className:"cursor-pointer select-none text-center",onClick:()=>w("is_active"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Status",e.jsx(_,{column:"is_active"})]})})]})}),e.jsx(Ln,{children:g.map(S=>e.jsxs(St,{className:S.is_active?"":"opacity-60",children:[e.jsx(ce,{className:"font-medium",children:S.full_name}),e.jsx(ce,{className:"text-sm text-muted-foreground",children:S.email}),e.jsx(ce,{children:C(S.role)}),e.jsx(ce,{children:e.jsxs(ge,{value:S.role,onValueChange:z=>v(S.id,z),disabled:y,children:[e.jsx(fe,{className:"w-[140px] h-8",children:e.jsx(je,{})}),e.jsxs(xe,{children:[e.jsx(W,{value:"student",children:"Ucze"}),e.jsx(W,{value:"teacher",children:"Nauczyciel"}),e.jsx(W,{value:"admin",children:"Administrator"})]})]})}),e.jsx(ce,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(qt,{checked:S.is_active,onCheckedChange:()=>b(S.id,S.is_active),disabled:y}),e.jsx("span",{className:"text-sm",children:S.is_active?e.jsx(V,{variant:"outline",className:"text-green-600",children:"Aktywny"}):e.jsx(V,{variant:"destructive",children:"Nieaktywny"})})]})})]},S.id))})]})})})}),e.jsxs("div",{className:"text-sm text-muted-foreground text-center",children:["Wywietlono ",g.length," z ",x.length," u偶ytkownik贸w"]})]})})},Wb=({group:t,open:s,onOpenChange:n,onMembersUpdate:i})=>{const{open:r}=cc(),[a,o]=f.useState(""),[l,c]=f.useState(new Set),{data:d}=Z({resource:"users",filters:[{field:"role",operator:"eq",value:"student"},{field:"is_active",operator:"eq",value:!0}],pagination:{pageSize:1e4},sorters:[{field:"full_name",order:"asc"}],queryOptions:{enabled:s}}),{data:u,refetch:m}=Z({resource:"group_members",filters:t?[{field:"group_id",operator:"eq",value:t.id}]:[],pagination:{pageSize:1e4},meta:{select:`
        *,
        users!inner(full_name, email)
      `},queryOptions:{enabled:s&&!!t}}),h=f.useMemo(()=>d?.data??[],[d]),y=f.useMemo(()=>u?.data??[],[u]),x=f.useMemo(()=>t?y.filter(v=>v.group_id===t.id):[],[t,y]),g=f.useMemo(()=>{if(!t)return[];const v=new Set(x.map(C=>C.user_id));return h.filter(C=>!(v.has(C.id)||a&&!C.full_name.toLowerCase().includes(a.toLowerCase())))},[h,t,x,a]);f.useEffect(()=>{s||(c(new Set),o(""))},[s]);const j=async()=>{if(!(!t||l.size===0))try{const v=Array.from(l).map(_=>({group_id:t.id,user_id:_})),{error:C}=await X.from("group_members").insert(v);if(C)throw C;r?.({type:"success",message:`Dodano ${l.size} uczni贸w do grupy`}),c(new Set),o(""),m(),i()}catch{r?.({type:"error",message:"Nie udao si doda uczni贸w"})}},w=async v=>{if(t)try{const{error:C}=await X.from("group_members").delete().eq("group_id",t.id).eq("user_id",v);if(C)throw C;r?.({type:"success",message:"Ucze usunity z grupy"}),m(),i()}catch{r?.({type:"error",message:"Nie udao si usun ucznia"})}},b=()=>{n(!1),c(new Set),o("")};return e.jsx(Cn,{open:s,onOpenChange:n,children:e.jsxs(en,{className:"max-w-4xl max-h-[80vh]",children:[e.jsx(tn,{children:e.jsxs(sn,{children:["Zarzdzaj uczniami w grupie: ",t?.name]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 overflow-hidden",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"font-medium text-sm",children:["Uczniowie w grupie (",x.length,")"]}),e.jsx("div",{className:"border rounded-lg p-3 h-[400px] overflow-y-auto",children:x.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Brak uczni贸w w grupie"}):e.jsx("div",{className:"space-y-2",children:x.map(v=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded hover:bg-muted",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:v.users?.full_name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:v.users?.email})]}),e.jsx(M,{size:"sm",variant:"ghost",onClick:()=>w(v.user_id),className:"text-red-600",children:e.jsx(dw,{className:"w-4 h-4"})})]},v.user_id))})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"font-medium text-sm",children:["Dostpni uczniowie (",g.length,")"]}),e.jsx(Q,{placeholder:"Szukaj ucznia...",value:a,onChange:v=>o(v.target.value),className:"h-9"}),e.jsx("div",{className:"border rounded-lg p-3 h-[350px] overflow-y-auto",children:g.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:a?"Nie znaleziono uczni贸w":"Wszyscy uczniowie s ju偶 w grupie"}):e.jsx("div",{className:"space-y-2",children:g.map(v=>e.jsxs("label",{className:"flex items-center gap-3 p-2 rounded hover:bg-muted cursor-pointer",children:[e.jsx(Ge,{checked:l.has(v.id),onCheckedChange:C=>{const _=new Set(l);C?_.add(v.id):_.delete(v.id),c(_)}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:v.full_name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:v.email})]})]},v.id))})}),l.size>0&&e.jsxs(M,{onClick:j,className:"w-full",children:[e.jsx(Es,{className:"w-4 h-4 mr-2"}),"Dodaj zaznaczonych (",l.size,")"]})]})]}),e.jsx(ao,{children:e.jsx(M,{variant:"outline",onClick:b,children:"Zamknij"})})]})})},Gb=()=>{const[t,s]=f.useState(!1);return e.jsx(I,{className:"border-2 border-blue-200/50 bg-gradient-to-br from-blue-50/50 to-indigo-50/50 dark:from-blue-950/20 dark:to-indigo-950/20",children:e.jsx(E,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-blue-100 dark:bg-blue-900/50 flex-shrink-0",children:e.jsx(Be,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"font-semibold text-lg flex items-center gap-2",children:["System zarzdzania grupami",e.jsx(de,{className:"h-4 w-4 text-blue-500"})]}),e.jsx("button",{onClick:()=>s(!t),className:"p-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-blue-600 dark:text-blue-400","aria-label":t?"Zwi szczeg贸y":"Rozwi szczeg贸y",children:t?e.jsx($t,{className:"h-5 w-5"}):e.jsx(dt,{className:"h-5 w-5"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Tw贸rz grupy i klasy, przypisuj uczni贸w i organizuj struktur nauczania."}),t&&e.jsxs("div",{className:"mt-4 space-y-4 animate-in slide-in-from-top-2 duration-200",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-sm text-blue-700 dark:text-blue-300",children:"Tworzenie grup"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(be,{className:"h-3 w-3 mt-0.5 text-blue-500 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:'Kliknij "Nowa grupa"'})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(be,{className:"h-3 w-3 mt-0.5 text-blue-500 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:'Nadaj nazw (np. "Klasa 1A")'})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(be,{className:"h-3 w-3 mt-0.5 text-blue-500 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Okrel rok akademicki"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-sm text-blue-700 dark:text-blue-300",children:"Zarzdzanie uczniami"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(be,{className:"h-3 w-3 mt-0.5 text-blue-500 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:'Kliknij "Zarzdzaj" przy grupie'})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(be,{className:"h-3 w-3 mt-0.5 text-blue-500 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Dodaj uczni贸w z listy"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(be,{className:"h-3 w-3 mt-0.5 text-blue-500 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Usu niepotrzebnych czonk贸w"})]})]})]})]}),e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-950/30 rounded-lg",children:e.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-300 flex items-start gap-2",children:[e.jsx(Ye,{className:"h-3 w-3 mt-0.5 flex-shrink-0"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Pro tip:"})," Grupy mo偶na dezaktywowa bez usuwania - przydatne na koniec roku szkolnego!"]})]})})]})]})]})})})},Zb=()=>{const[t,s]=f.useState(null),[n,i]=f.useState(!1),[r,a]=f.useState(!1),[o,l]=f.useState(""),[c,d]=f.useState("2024/2025"),[u,m]=f.useState(""),[h,y]=f.useState({key:"name",direction:"asc"}),{data:x,isLoading:g,refetch:j}=Z({resource:"groups",pagination:{pageSize:1e3},sorters:[{field:"name",order:"asc"}]}),{data:w,refetch:b}=Z({resource:"group_members",pagination:{pageSize:1e4}}),{mutate:v,isLoading:C}=Yt(),{mutate:_}=Mn(),{mutate:S}=Is(),z=f.useMemo(()=>x?.data??[],[x]),k=f.useMemo(()=>w?.data??[],[w]),T=f.useMemo(()=>{const L={};return z.forEach(U=>{L[U.id]=k.filter(O=>O.group_id===U.id).length}),L},[z,k]),p=f.useMemo(()=>{const L=z.filter(U=>u===""||U.name.toLowerCase().includes(u.toLowerCase())||U.academic_year.includes(u));return h.key&&L.sort((U,O)=>{let G,se;return h.key==="memberCount"?(G=T[U.id]||0,se=T[O.id]||0):(G=U[h.key],se=O[h.key]),G<se?h.direction==="asc"?-1:1:G>se?h.direction==="asc"?1:-1:0}),L},[z,u,h,T]),N=L=>{y(U=>({key:L,direction:U.key===L&&U.direction==="asc"?"desc":"asc"}))},A=()=>{o.trim()&&v({resource:"groups",values:{name:o,academic_year:c,vendor_id:1},successNotification:()=>({message:"Grupa zostaa utworzona",type:"success"})},{onSuccess:()=>{i(!1),l(""),j()}})},D=L=>{confirm("Czy na pewno chcesz usun t grup?")&&S({resource:"groups",id:L,successNotification:()=>({message:"Grupa zostaa usunita",type:"success"})},{onSuccess:()=>j()})},P=async L=>{_({resource:"groups",id:L.id,values:{is_active:!L.is_active},successNotification:()=>({message:L.is_active?"Grupa dezaktywowana":"Grupa aktywowana",type:"success"})},{onSuccess:()=>j()})},R=({column:L})=>h.key!==L?e.jsx($t,{className:"w-4 h-4 opacity-20"}):h.direction==="asc"?e.jsx($t,{className:"w-4 h-4"}):e.jsx(dt,{className:"w-4 h-4"}),q=g;return e.jsxs(H,{children:[e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Zarzdzanie grupami i klasami"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Tw贸rz grupy i przypisuj do nich uczni贸w"})]}),e.jsxs(M,{onClick:()=>i(!0),children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Nowa grupa"]})]}),e.jsx(Gb,{}),e.jsx(I,{children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(In,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(Q,{placeholder:"Szukaj grupy po nazwie lub roku akademickim...",value:u,onChange:L=>m(L.target.value),className:"pl-9"})]})})}),e.jsx(I,{children:e.jsx(E,{className:"p-0",children:q?e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"adowanie grup..."}):p.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(de,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground/50"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:u?"Nie znaleziono grup":"Brak grup w systemie"}),e.jsxs(M,{onClick:()=>i(!0),children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Utw贸rz pierwsz grup"]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(En,{children:[e.jsx(Rn,{children:e.jsxs(St,{children:[e.jsx(le,{className:"cursor-pointer select-none",onClick:()=>N("name"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Nazwa grupy",e.jsx(R,{column:"name"})]})}),e.jsx(le,{className:"cursor-pointer select-none",onClick:()=>N("academic_year"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Rok akademicki",e.jsx(R,{column:"academic_year"})]})}),e.jsx(le,{className:"cursor-pointer select-none text-center",onClick:()=>N("memberCount"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Liczba uczni贸w",e.jsx(R,{column:"memberCount"})]})}),e.jsx(le,{className:"text-center",children:"Status"}),e.jsx(le,{className:"text-center",children:"Akcje"})]})}),e.jsx(Ln,{children:p.map(L=>e.jsxs(St,{children:[e.jsx(ce,{className:"font-medium",children:L.name}),e.jsx(ce,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(js,{className:"w-4 h-4 text-muted-foreground"}),L.academic_year]})}),e.jsx(ce,{className:"text-center",children:e.jsxs(V,{variant:"secondary",children:[T[L.id]||0," uczni贸w"]})}),e.jsx(ce,{className:"text-center",children:e.jsx(qt,{checked:L.is_active,onCheckedChange:()=>P(L)})}),e.jsx(ce,{children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs(M,{size:"sm",variant:"outline",onClick:()=>{s(L),a(!0)},children:[e.jsx(de,{className:"w-4 h-4 mr-1"}),"Zarzdzaj"]}),e.jsx(M,{size:"sm",variant:"ghost",onClick:()=>D(L.id),className:"text-red-600 hover:bg-red-50",children:e.jsx(Ft,{className:"w-4 h-4"})})]})})]},L.id))})]})})})})]}),e.jsx(Cn,{open:n,onOpenChange:i,children:e.jsxs(en,{children:[e.jsx(tn,{children:e.jsx(sn,{children:"Utw贸rz now grup"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(gr,{htmlFor:"name",children:"Nazwa grupy"}),e.jsx(Q,{id:"name",value:o,onChange:L=>l(L.target.value),placeholder:"np. Klasa 1A"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(gr,{htmlFor:"year",children:"Rok akademicki"}),e.jsx(Q,{id:"year",value:c,onChange:L=>d(L.target.value),placeholder:"np. 2024/2025"})]})]}),e.jsxs(ao,{children:[e.jsx(M,{variant:"outline",onClick:()=>i(!1),children:"Anuluj"}),e.jsx(M,{onClick:A,disabled:C||!o.trim(),children:"Utw贸rz grup"})]})]})}),e.jsx(Wb,{group:t,open:r,onOpenChange:a,onMembersUpdate:b})]})},Hb={name:"permissions",list:"/admin/permissions",meta:{label:"Zarzdzanie dostpem",icon:e.jsx(uw,{className:"h-4 w-4"})}},Qb={name:"permissions-users",list:"/admin/permissions/users",meta:{label:"U偶ytkownicy",icon:e.jsx(de,{className:"h-4 w-4"}),parent:"permissions"}},Yb={name:"permissions-groups",list:"/admin/permissions/groups",meta:{label:"Grupy i klasy",icon:e.jsx(mw,{className:"h-4 w-4"}),parent:"permissions"}},Jb={name:"permissions-access",list:"/admin/permissions/access",meta:{label:"Dostp do kurs贸w",icon:e.jsx(rt,{className:"h-4 w-4"}),parent:"permissions"}},Xb=[e.jsx(K,{path:"permissions",element:e.jsx(rs,{to:"/admin/permissions/users",replace:!0})},"permissions-default"),e.jsx(K,{path:"permissions/users",element:e.jsx(Kb,{})},"permissions-users"),e.jsx(K,{path:"permissions/groups",element:e.jsx(Zb,{})},"permissions-groups"),e.jsx(K,{path:"permissions/access",element:e.jsx(Ub,{})},"permissions-access")],$o=[Hb,Qb,Yb,Jb],ev={"between-center":"flex justify-between items-center gap-2",center:"flex justify-center items-center gap-2",start:"flex justify-start items-center gap-2",end:"flex justify-end items-center gap-2"},J=({children:t,variant:s="between-center",className:n=""})=>{const i=ev[s],r=n?`${i} ${n}`:i;return e.jsx("div",{className:r,children:t})},tv={"1-2-3":"grid gap-6 md:grid-cols-2 lg:grid-cols-3","1-2-2":"grid gap-6 md:grid-cols-2","1-1-1":"grid gap-6","2-2-4":"grid gap-6 grid-cols-2 lg:grid-cols-4"},yt=({children:t,variant:s="1-2-3",className:n=""})=>{const i=tv[s],r=n?`${i} ${n}`:i;return e.jsx("div",{className:r,children:t})},Cp=({current:t,pageSize:s,total:n,setCurrent:i,setPageSize:r,itemName:a="element贸w",pageSizeOptions:o=[10,20,50]})=>{const l=Math.ceil(n/s),c=(t-1)*s+1,d=Math.min(t*s,n),u=t>1,m=t<l,h=()=>{const y=[];if(l<=5)for(let g=1;g<=l;g++)y.push(g);else{y.push(1),t>3&&y.push("...");const g=Math.max(2,t-1),j=Math.min(l-1,t+1);for(let w=g;w<=j;w++)y.push(w);t<l-2&&y.push("..."),y.push(l)}return y};return n===0?null:e.jsxs(J,{className:"mt-6",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Pokazuje ",c,"-",d," z ",n," ",a]}),e.jsxs(J,{className:"gap-2",children:[r&&e.jsxs(ge,{value:s.toString(),onValueChange:y=>{r(parseInt(y)),i(1)},children:[e.jsx(fe,{className:"w-[100px]",children:e.jsx(je,{})}),e.jsx(xe,{children:o.map(y=>e.jsxs(W,{value:y.toString(),children:[y," / str."]},y))})]}),e.jsx(M,{variant:"outline",size:"sm",onClick:()=>i(t-1),disabled:!u,children:e.jsx(hw,{className:"w-4 h-4"})}),e.jsx("div",{className:"hidden sm:flex gap-1",children:h().map((y,x)=>y==="..."?e.jsx("span",{className:"px-3 py-1 text-sm text-muted-foreground",children:"..."},`ellipsis-${x}`):e.jsx(M,{variant:t===y?"default":"outline",size:"sm",onClick:()=>i(y),className:"min-w-[40px]",children:y},y))}),e.jsxs("div",{className:"flex sm:hidden items-center px-3 text-sm",children:[t," / ",l]}),e.jsx(M,{variant:"outline",size:"sm",onClick:()=>i(t+1),disabled:!m,children:e.jsx(be,{className:"w-4 h-4"})})]})]})},sv={card:{wrap:"space-y-0",title:"font-medium",description:"text-muted-foreground"},lg:{wrap:"space-y-0",title:"text-3xl font-bold tracking-tight",description:"text-muted-foreground"},md:{wrap:"space-y-0",title:"font-medium",description:"text-muted-foreground"},sm:{wrap:"space-y-1",title:"font-medium text-sm text-muted-foreground mb-1",description:"text-sm"}},ue=({title:t,description:s,variant:n="lg"})=>{const i=sv[n],r=()=>{switch(n){case"lg":return e.jsx("h1",{className:i.title,children:t});case"md":return e.jsx("h2",{className:i.title,children:t});case"sm":return e.jsx("h3",{className:i.title,children:t});default:return e.jsx("h1",{className:i.title,children:t})}};return n==="card"?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"text-lg font-semibold leading-tight flex items-center gap-2",children:t}),e.jsx(so,{className:"text-sm text-muted-foreground mt-2",children:s})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:i.wrap,children:[r(),e.jsx("p",{className:`prose ${i.description}`,children:s})]})})},nv=()=>{const{tableQuery:{data:t,isLoading:s,isError:n},current:i,setCurrent:r,pageSize:a,setFilters:o}=Yh({sorters:{initial:[{field:"created_at",order:"desc"}]}}),l=xc({isLoading:s,isError:n});return l||e.jsxs(H,{children:[e.jsx(ue,{title:"Organizacje",description:"Lista wszystkich organizacji w systemie"}),e.jsx(J,{children:e.jsx(Q,{placeholder:"Szukaj organizacji...",className:"max-w-sm",onChange:c=>{o([{operator:"or",value:[{field:"name",operator:"contains",value:c.target.value},{field:"subdomain",operator:"contains",value:c.target.value}]}])}})}),e.jsx(yt,{children:t?.data?.map(c=>e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs(J,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(ep,{className:"w-5 h-5"}),c.name]}),e.jsx(V,{variant:c.is_active?"default":"secondary",children:c.is_active?"Aktywna":"Nieaktywna"})]})}),e.jsxs(E,{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(pw,{className:"w-3 h-3"}),e.jsxs("span",{children:[c.subdomain,".example.com"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(js,{className:"w-3 h-3"}),e.jsxs("span",{children:["Utworzono: ",new Date(c.created_at).toLocaleDateString("pl-PL")]})]})]})]},c.id))}),e.jsx(Cp,{current:i,pageSize:a,total:t?.total||0,setCurrent:r,itemName:"organizacji"})]})},su={name:"vendors",list:"/admin/vendors",meta:{label:"Organizacje",icon:e.jsx(ep,{className:"h-4 w-4"})}},iv=[e.jsx(K,{path:"vendors",element:e.jsx(nv,{})},"vendors-list")];function rv(t,s){let n;try{n=t()}catch{return}return{getItem:r=>{var a;const o=c=>c===null?null:JSON.parse(c,void 0),l=(a=n.getItem(r))!=null?a:null;return l instanceof Promise?l.then(o):o(l)},setItem:(r,a)=>n.setItem(r,JSON.stringify(a,void 0)),removeItem:r=>n.removeItem(r)}}const wl=t=>s=>{try{const n=t(s);return n instanceof Promise?n:{then(i){return wl(i)(n)},catch(i){return this}}}catch(n){return{then(i){return this},catch(i){return wl(i)(n)}}}},av=(t,s)=>(n,i,r)=>{let a={storage:rv(()=>localStorage),partialize:g=>g,version:0,merge:(g,j)=>({...j,...g}),...s},o=!1;const l=new Set,c=new Set;let d=a.storage;if(!d)return t((...g)=>{console.warn(`[zustand persist middleware] Unable to update item '${a.name}', the given storage is currently unavailable.`),n(...g)},i,r);const u=()=>{const g=a.partialize({...i()});return d.setItem(a.name,{state:g,version:a.version})},m=r.setState;r.setState=(g,j)=>{m(g,j),u()};const h=t((...g)=>{n(...g),u()},i,r);r.getInitialState=()=>h;let y;const x=()=>{var g,j;if(!d)return;o=!1,l.forEach(b=>{var v;return b((v=i())!=null?v:h)});const w=((j=a.onRehydrateStorage)==null?void 0:j.call(a,(g=i())!=null?g:h))||void 0;return wl(d.getItem.bind(d))(a.name).then(b=>{if(b)if(typeof b.version=="number"&&b.version!==a.version){if(a.migrate){const v=a.migrate(b.state,b.version);return v instanceof Promise?v.then(C=>[!0,C]):[!0,v]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,b.state];return[!1,void 0]}).then(b=>{var v;const[C,_]=b;if(y=a.merge(_,(v=i())!=null?v:h),n(y,!0),C)return u()}).then(()=>{w?.(y,void 0),y=i(),o=!0,c.forEach(b=>b(y))}).catch(b=>{w?.(void 0,b)})};return r.persist={setOptions:g=>{a={...a,...g},g.storage&&(d=g.storage)},clearStorage:()=>{d?.removeItem(a.name)},getOptions:()=>a,rehydrate:()=>x(),hasHydrated:()=>o,onHydrate:g=>(l.add(g),()=>{l.delete(g)}),onFinishHydration:g=>(c.add(g),()=>{c.delete(g)})},a.skipHydration||x(),y||h},_p=av,ws=Gh()(_p((t,s)=>({steps:{},schemas:{},registerStep:(n,i,r=!1)=>{t(a=>({schemas:{...a.schemas,[n]:{schema:i,clearOnNext:r}}}))},setStepData:(n,i)=>{t(r=>({steps:{...r.steps,[n]:{...r.steps[n],...i}}}))},getStepData:n=>s().steps[n]||{},clearStep:n=>{t(i=>({steps:{...i.steps,[n]:{}}}))},clearAll:()=>t({steps:{}})}),{name:"step-store"})),ov=Gh()(_p((t,s)=>({snapshots:[],saveSnapshot:n=>{const i=ws.getState().steps,r={id:Date.now().toString(),name:n,data:i,created:Date.now()};t(a=>({snapshots:[...a.snapshots,r]}))},loadSnapshot:n=>{const i=s().snapshots.find(r=>r.id===n);if(i){const r=ws.getState();r.clearAll(),Object.entries(i.data).forEach(([a,o])=>{r.setStepData(a,o)})}},deleteSnapshot:n=>{t(i=>({snapshots:i.snapshots.filter(r=>r.id!==n)}))},listSnapshots:()=>s().snapshots}),{name:"snapshot-store"}));function Tp(){const[t,s]=f.useState(!1),[n,i]=f.useState(""),[r,a]=f.useState(""),{snapshots:o,saveSnapshot:l,loadSnapshot:c,deleteSnapshot:d}=ov();f.useEffect(()=>{const x=g=>{g.key==="Escape"&&s(!1)};return window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)},[]);const u=f.useMemo(()=>[...o].sort((x,g)=>g.created-x.created),[o]),m=f.useMemo(()=>{const x=r.trim().toLowerCase();return x?u.filter(g=>g.name.toLowerCase().includes(x)):u},[u,r]),h=()=>{const x=new Date().toLocaleString();l(`Snapshot ${x}`)},y=()=>{const x=n.trim();x&&(l(x),i(""))};return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>s(!0),title:"Snapshoty",className:"fixed right-4 bottom-4 bg-black text-white p-3 rounded-full shadow hover:bg-gray-900",children:""}),t&&e.jsxs("div",{className:"fixed right-0 top-0 h-full w-64 bg-white border-l z-50 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b",children:[e.jsx("div",{className:"font-semibold text-sm",children:"Snapshoty"}),e.jsx("button",{onClick:()=>s(!1),className:"text-gray-500 hover:text-black text-lg leading-none","aria-label":"Zamknij",title:"Zamknij",children:""})]}),e.jsxs("div",{className:"p-3 border-b space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"border px-2 py-1 rounded w-full text-sm",placeholder:"Nazwa snapshotu",value:n,onChange:x=>i(x.target.value),onKeyDown:x=>x.key==="Enter"&&y()}),e.jsx("button",{onClick:y,className:"bg-blue-600 hover:bg-blue-700 text-white text-xs px-3 rounded",children:"Zapisz"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:h,className:"text-xs text-blue-700 underline",children:"Szybki zapis"}),e.jsx("input",{className:"border px-2 py-1 rounded text-xs w-32",placeholder:"Szukaj",value:r,onChange:x=>a(x.target.value)})]})]}),e.jsx("div",{className:"p-3 overflow-y-auto text-sm space-y-2",children:m.length===0?e.jsx("div",{className:"text-gray-500 text-xs text-center mt-4",children:"Brak snapshot贸w"}):m.map(x=>e.jsxs("div",{className:"border rounded p-2",children:[e.jsx("div",{className:"font-medium truncate",title:x.name,children:x.name}),e.jsx("div",{className:"text-[11px] text-gray-500",children:new Date(x.created).toLocaleString()}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:()=>c(x.id),className:"bg-green-600 hover:bg-green-700 text-white text-xs px-2 py-1 rounded",children:"Wczytaj"}),e.jsx("button",{onClick:()=>{confirm(`Usun ${x.name}?`)&&d(x.id)},className:"bg-red-500 hover:bg-red-600 text-white text-xs px-2 py-1 rounded",children:"Usu"})]})]},x.id))})]})]})}function lv(){const t=ae(),{steps:s,clearAll:n}=ws(),i=!!s?.step1,r=!!s?.step1?.outline,a=!!s?.step2,o=s?.step2?.refined,l=()=>{n(),t("/admin/course-structure/step1",{replace:!0})};return e.jsxs(H,{children:[e.jsxs("div",{className:"relative overflow-hidden rounded-2xl border mb-6",children:[e.jsx("div",{className:"absolute inset-0 bg-purple-50"}),e.jsxs("div",{className:"relative px-6 py-8 flex items-center gap-3",children:[e.jsx("div",{className:"shrink-0 inline-flex h-10 w-10 items-center justify-center rounded-xl bg-black text-white",children:e.jsx(_i,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-semibold leading-tight",children:"Generator kurs贸w  panel"}),e.jsx("p",{className:"text-sm text-zinc-600",children:"W 2 krokach wygenerujesz szkic kursu i rozpiszesz tematy lekcji z pomoc LLM."})]}),e.jsx("div",{className:"hidden md:block",children:e.jsxs(M,{onClick:l,className:"inline-flex items-center gap-2",children:["Nowy kurs",e.jsx(be,{className:"w-4 h-4"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(I,{className:"lg:col-span-2",children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"w-5 h-5"}),"Szybki start"]})}),e.jsxs(E,{className:"space-y-5",children:[e.jsxs("div",{className:"rounded-xl border p-4",children:[e.jsxs("ol",{className:"list-decimal list-inside text-sm text-zinc-700 space-y-1",children:[e.jsx("li",{children:"Krok 1  podstawy kursu (temat, grupa docelowa, poziom)."}),e.jsx("li",{children:"Krok 2  doprecyzowanie listy modu贸w i lekcji."})]}),e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row gap-2",children:[e.jsxs(M,{onClick:l,className:"flex-1 inline-flex items-center gap-2",children:["Rozpocznij",e.jsx(be,{className:"w-4 h-4"})]}),e.jsx(M,{asChild:!0,variant:"secondary",className:"flex-1",children:e.jsxs(Le,{to:"/admin/course-structure/step4",className:"inline-flex items-center gap-2",children:["Edytuj istniejce kursy",e.jsx(be,{className:"w-4 h-4"})]})})]})]}),i||a?e.jsx(I,{className:"bg-muted/40",children:e.jsxs(E,{className:"pt-6",children:[e.jsxs("p",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(fw,{className:"w-4 h-4"}),"Ostatnia sesja"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-medium text-foreground",children:o.courseTitle}),e.jsxs("div",{className:"text-xs",children:[o.subject,"  ",String(o.level),o.isMaturaCourse?"  Maturalny":""]}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx(M,{size:"sm",onClick:()=>t("/admin/course-structure/step2"),children:"Kontynuuj w kroku 2"}),e.jsx(M,{size:"sm",variant:"outline",onClick:()=>t("/admin/course-structure/step1"),children:"Podgld kroku 1"}),e.jsx(M,{size:"sm",variant:"ghost",onClick:()=>n(),className:"text-red-600 hover:text-red-700",children:"Wyczy sesj"})]})]}):r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-medium text-foreground",children:s?.step1?.outline?.title||"Szkic kursu"}),e.jsxs("div",{className:"text-xs",children:[s?.step1?.outline?.subject||s?.step1?.subject," "," ",s?.step1?.outline?.level||s?.step1?.level]}),e.jsx("div",{className:"mt-3",children:e.jsx(M,{size:"sm",onClick:()=>t("/admin/course-structure/step2"),children:"Przejd藕 do kroku 2"})})]}):e.jsx("div",{className:"text-sm",children:"Brak zapisanych szkic贸w do wznowienia."})})]})}):null]})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5"}),"Jak to dziaa?"]})}),e.jsxs(E,{className:"space-y-3",children:[e.jsxs(he,{children:[e.jsx(cn,{className:"h-4 w-4"}),e.jsx(pe,{className:"text-xs",children:"Kreator mo偶e uwzgldni najnowsz (2025) podstaw programow LO (PL) dla kurs贸w maturalnych."})]}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-2",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-foreground",children:"Krok 1:"})," podaj parametry kursu, wybierz poziom i (opcjonalnie) zgodno z podstaw."]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-foreground",children:"Krok 2:"})," wygeneruj list lekcji (z opisami), zweryfikuj i zapisz."]})]}),e.jsx("div",{className:"pt-2",children:e.jsxs(M,{onClick:l,variant:"outline",className:"w-full inline-flex items-center justify-center gap-2",children:["Przejd藕 do kroku 1",e.jsx(be,{className:"w-4 h-4"})]})})]})]})]})]})}function bl(t){if(!t)return Gd();switch(t.type){case"string":return t.required?Yd():Yd().optional();case"number":return t.required?Qd():Qd().optional();case"boolean":return t.required?Hd():Hd().optional();case"array":return Rw(bl(t.items||{}));case"object":{if(!t.properties)return Zd({});const s={};for(const[n,i]of Object.entries(t.properties))s[n]=bl(i);return Zd(s)}default:return Gd()}}function vl(t,s=0){const n=" ".repeat(s);switch(t.type){case"string":return`${n}string${t.required?" (wymagane)":""}`;case"number":return`${n}number${t.required?" (wymagane)":""}`;case"boolean":return`${n}boolean${t.required?" (wymagane)":""}`;case"enum":return`${n}enum: ${t.options?.join(" | ")}`+(t.required?" (wymagane)":"");case"array":return`${n}array${t.minItems?` (min ${t.minItems})`:""}${t.maxItems?` (max ${t.maxItems})`:""}, element:
`+vl(t.items||{},s+2);case"object":return t.properties?n+`{
`+Object.entries(t.properties).map(([i,r])=>`${n}  ${i}: ${vl(r,s+4)}`).join(`
`)+`
`+n+"}":`${n}object`;default:return`${n}any`}}function cv(t){return`锔 Odpowiedz wycznie poprawnym JSON-em zgodnym z poni偶sz struktur:

`+vl(t,0)}class fa extends Error{constructor(n,i,r){super(n);ts(this,"status");ts(this,"info");this.name="LLMError",this.status=r,this.info=i}}async function On(t,s,n="json"){let i=t;n==="json"&&s&&(i+=`

`+cv(s));const r=await fetch("http://localhost:3001/api/chat",{method:"POST",headers:{"content-type":"application/json","x-api-key":"ce040e01e5b1b24f530a541f89e2409b328cf51efc6ba295c85ba1858072498b"},body:JSON.stringify({message:i,model:"gemini-2.5-flash",responseFormat:n})}),a=await r.text();let o=null;try{o=a?JSON.parse(a):null}catch{}if(!r.ok){const d=o?.error||o?.message||o?.details||r.statusText||"Bd wywoania LLM";throw new fa(d,o??{raw:a},r.status)}const l=o??{},c=l.response||l.text||l.message||"";if(n==="json"){const d=c.replace(/```json\s*|\s*```/g,"").trim();let u;try{u=JSON.parse(d)}catch{throw new fa("Niepoprawny JSON z modelu",{raw:c})}if(s){const m=bl(s);try{return m.parse(u)}catch(h){throw new fa("Bd walidacji odpowiedzi LLM",{zodIssues:h?.issues??h,parsed:u})}}return u}return c}const jc=["Matematyka","Biologia","Chemia","Fizyka","Informatyka","Geografia","Historia","Polski","Angielski"],dv={Matematyka:"Matematyka",Biologia:"Biologia",Chemia:"Chemia",Fizyka:"Fizyka",Informatyka:"Informatyka",Geografia:"Geografia",Historia:"Historia",Polski:"Jzyk polski",Angielski:"Jzyk obcy nowo偶ytny"},uv=[{id:"pl-lo-2025-math",label:"Podstawa programowa LO (2025)  Matematyka",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/matematyka",subjects:["Matematyka"],outcomes:{Matematyka:["Rozwizuje r贸wnania i nier贸wnoci oraz interpretuje wyniki.","Analizuje funkcje i wykresy; stosuje wasnoci do rozwizywania zada.","Geometria paska i przestrzenna w praktycznych zastosowaniach.","Rachunek prawdopodobiestwa i statystyka opisowa do wnioskowania.","Modeluje problemy tekstowe z u偶yciem narzdzi matematycznych."]}},{id:"pl-lo-2025-it",label:"Podstawa programowa LO (2025)  Informatyka",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/informatyka",subjects:["Informatyka"],outcomes:{Informatyka:["Projektuje i analizuje proste algorytmy; implementuje je.","Dobiera i stosuje struktury danych.","Pisze, uruchamia i testuje programy.","Podstawy sieci i bezpieczestwa informacji.","Wsp贸praca zespoowa (repozytoria, wersjonowanie)."]}},{id:"pl-lo-2025-polish",label:"Podstawa programowa LO (2025)  Jzyk polski",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/jezyk-polski",subjects:["Polski"],outcomes:{Polski:["Analizuje i interpretuje teksty literackie i nieliterackie.","wiadomie posuguje si rodkami jzykowymi w wypowiedzi.","Tworzy wypowiedzi pisemne zgodne z wymogami gatunku.","Rozpoznaje konteksty kulturowe i historyczne utwor贸w.","Korzysta z r贸偶nych 藕r贸de informacji i je weryfikuje."]}},{id:"pl-lo-2025-bio",label:"Podstawa programowa LO (2025)  Biologia",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/biologia",subjects:["Biologia"],outcomes:{Biologia:["Wyjania zjawiska biologiczne w oparciu o struktur i funkcj.","Planuje i interpretuje proste dowiadczenia biologiczne.","Analizuje dziedziczenie cech i zmienno organizm贸w.","Rozumie podstawy ekologii i ochrony rodowiska.","Korzysta z danych biologicznych do wnioskowania."]}},{id:"pl-lo-2025-phy",label:"Podstawa programowa LO (2025)  Fizyka",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/fizyka",subjects:["Fizyka"],outcomes:{Fizyka:["Opisuje i wyjania zjawiska fizyczne z u偶yciem poj i praw fizyki.","Wykonuje pomiary, szacuje niepewnoci i analizuje wyniki.","Stosuje zasady dynamiki, energii i pdu w zadaniach.","Interpretuje wykresy i zale偶noci wielkoci fizycznych.","Rozwizuje zadania obliczeniowe, uzasadniajc tok rozumowania."]}},{id:"pl-lo-2025-chem-podst",label:"Podstawa programowa LO (2025)  Chemia (podstawowy)",year:2025,level:"podstawowy",sourceUrl:"https://podstawaprogramowa.pl/Liceum-technikum/Chemia",subjects:["Chemia"],outcomes:{Chemia:["Stosuje zasady BHP w pracowni chemicznej; rozpoznaje piktogramy i prowadzi proste dowiadczenia.","Opisuje budow atomu i okresowo waciwoci pierwiastk贸w; zapisuje proste konfiguracje elektronowe.","Rozr贸偶nia i charakteryzuje wizania (jonowe, kowalencyjne, metaliczne) i przewiduje waciwoci substancji.","Posuguje si pojciami mol, masa molowa, objto molowa; wykonuje obliczenia stechiometryczne.","Pisze i bilansuje r贸wnania reakcji, w tym redoks; wyznacza stopnie utlenienia.","Analizuje roztwory: oblicza st偶enie procentowe i molowe; opisuje rozpuszczalno i czynniki j zmieniajce.","Opisuje kwasowo-zasadowo: pH, wska藕niki, moc kwas贸w/zasad; rozwizuje proste zadania obliczeniowe.","Wyjania czynniki wpywajce na szybko reakcji; opisuje r贸wnowagi chemiczne i zasad Le Chateliera.","Charakteryzuje waciwoci gaz贸w i cieczy; stosuje r贸wnanie gazu doskonaego w prostych zadaniach.","Rozpoznaje podstawowe grupy funkcyjne w chemii organicznej; podaje waciwoci i reakcje charakterystyczne.","Interpretuje i krytycznie analizuje dane (tabele, wykresy, schematy) oraz formuuje wnioski.","Wskazuje zastosowania zwizk贸w chemicznych w 偶yciu codziennym, rodowisku i przemyle; ocenia wpyw na rodowisko."]}},{id:"pl-lo-2025-chem-rozsz",label:"Podstawa programowa LO (2025)  Chemia (rozszerzony)",year:2025,level:"rozszerzony",sourceUrl:"https://podstawaprogramowa.pl/Liceum-technikum/Chemia",subjects:["Chemia"],outcomes:{Chemia:["Wykonuje zo偶one obliczenia stechiometryczne (odczynnik ograniczajcy, wydajno, mieszanie roztwor贸w).","Stosuje prawa termochemii: H reakcji, prawo Hessa; jakociowo interpretuje wpyw S i G na spontaniczno.","Analizuje r贸wnowagi: zapisuje wyra偶enia Kc/Kp, szacuje przesunicia r贸wnowagi (Le Chatelier), rozwizuje proste ukady z K.","Opisuje i oblicza zagadnienia kwas-zasada: stae dysocjacji, hydroliza soli, bufor i r贸wnanie HendersonaHasselbalcha.","Projektuje i interpretuje miareczkowania (kwaszasada, redoks); szkicuje krzywe miareczkowania i dobiera wska藕niki.","Stosuje podstawy kinetyki: prawo szybkoci, rzd reakcji z danych dowiadczalnych, pojcie energii aktywacji (Arrhenius jakociowo).","Wykorzystuje elektrochemi: buduje schematy ogniw, oblicza SEM ze standardowych potencja贸w; jakociowo stosuje r贸wnanie Nernsta.","Posuguje si iloczynem rozpuszczalnoci (Ksp) do przewidywania strcania; analizuje r贸wnowagi strceniowe.","Rozpoznaje i opisuje mechanizmy podstawowych reakcji organicznych (substytucja/addycja/eliminacja na poziomie jakociowym).","Analizuje izomeri (strukturalna, geometryczna, optyczna) i konsekwencje stereochemiczne waciwoci zwizk贸w.","Charakteryzuje polimery (addycja, kondensacja), makroczsteczki i ich zastosowania; wskazuje aspekty rodowiskowe.","Stosuje elementy analizy jakociowej i instrumentalnej (chromatografia w ujciu szkolnym, proste widma) do identyfikacji zwizk贸w."]}},{id:"pl-lo-2025-geo",label:"Podstawa programowa LO (2025)  Geografia",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/geografia",subjects:["Geografia"],outcomes:{Geografia:["Analizuje mapy, dane statystyczne i obrazy Ziemi.","Wyjania procesy przyrodnicze i spoeczno-ekonomiczne.","Ocena wpywu dziaalnoci czowieka na rodowisko.","Interpretuje wska藕niki demograficzne i gospodarcze.","Korzysta z narzdzi GIS/geo-danych na poziomie podstawowym."]}},{id:"pl-lo-2025-hist",label:"Podstawa programowa LO (2025)  Historia",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/historia",subjects:["Historia"],outcomes:{Historia:["Porzdkuje wydarzenia w czasie i przestrzeni (chronologia, mapa).","Analizuje i interpretuje 藕r贸da historyczne.","Wyjania przyczyny i skutki zjawisk historycznych.","Rozpoznaje spory interpretacyjne i r贸偶ne narracje.","Formuuje argumenty i wnioski w dyskusji o przeszoci."]}},{id:"pl-lo-2025-eng",label:"Podstawa programowa LO (2025)  Jzyk obcy nowo偶ytny (Angielski)",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/jezyk-obcy-nowozytny",subjects:["Angielski"],outcomes:{Angielski:["Rozumie typowe wypowiedzi ustne i pisemne w kontekcie szkolnym.","Komunikuje si w codziennych sytuacjach i w tematach szkolnych.","Pisze kr贸tkie wypowiedzi u偶ytkowe zgodnie z celem i odbiorc.","Rozwija zakres rodk贸w jzykowych (sownictwo, gramatyka).","Stosuje strategie uczenia si i korzysta z r贸偶nych 藕r贸de."]}}];function mv(t){return jc.find(n=>n===t)??null}function yc(t){if(!t)return null;const s=mv(t);if(!s)return null;const n=dv[s],i=uv.filter(a=>a.subjects.includes(s)||a.subjects.includes(n));return i.length===0?null:[...i].sort((a,o)=>{const l=a.year??0,c=o.year??0;return c!==l?c-l:a.id.localeCompare(o.id)})[0]??null}const nu={type:"object",properties:{title:{type:"string"},subject:{type:"string",required:!0},level:{type:"string",required:!0},isMaturaCourse:{type:"boolean",required:!0},topics:{type:"array",minItems:5,items:{type:"object",properties:{title:{type:"string",required:!0},description:{type:"string",required:!0}}}}}};function hv({custom:t,generated:s,activeIsCustom:n}){const i=(t||"").trim(),r=(s||"").trim();return!i&&!r?null:e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-primary/80",children:"NAZWA KURSU"}),e.jsxs("div",{children:[" ",e.jsx("span",{className:n?"font-medium":"",children:i}),n&&e.jsx("span",{className:"ml-2 text-xs text-primary/80",children:"(aktywna)"})]}),e.jsxs("div",{children:[e.jsx("span",{className:n?"":"font-medium",children:r}),!n&&e.jsx("span",{className:"ml-2 text-xs text-primary/80",children:"(aktywna)"})]})]})}function Fo({children:t}){return e.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-xs border bg-primary/10 border-primary text-primary",children:t})}function pv({subjectActive:t,levelActive:s,isMatura:n}){return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wide text-muted-foreground",children:"Szczeg贸y"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[t&&e.jsx(Fo,{children:t}),s&&e.jsx(Fo,{children:s}),e.jsx(Fo,{children:n?"maturalny":"niematuralny"})]})]})}function fv(){const{registerStep:t,setStepData:s,getStepData:n}=ws(),i=n("step1")||{};f.useEffect(()=>{t("step1",nu),i.subject||s("step1",{subject:"Matematyka",level:"podstawowy",isMaturaCourse:!0,alignToCurriculum:!0,useCustomTitle:!1})},[]);const r=f.useMemo(()=>yc(i.subject),[i.subject]),[a,o]=f.useState(!1),l=async()=>{s("step1",{isGenerating:!0});try{const x=r?.outcomes?.[i.subject]??[],g=i.isMaturaCourse&&i.alignToCurriculum&&r?`
Uwzgldnij zgodno z podstaw programow LO (PL).
(Dokument: ${r.label}${r.year?`  ${r.year}`:""})
Wymagania do pokrycia:
${x.map((b,v)=>`${v+1}. ${b}`).join(`
`)}
Jeli to mo偶liwe, sygnalizuj pokrycie wymaga w nawiasie, np. "[PP]".
          `.trim():"",j=`
Wygeneruj szkic kursu dla nauczyciela:
- przedmiot: ${i.subject}
- poziom: ${i.level}
- charakter: ${i.isMaturaCourse?"maturalny":"niematuralny"}
${g?`
${g}
`:""}

Szkic ma by zwizy, klarowny i praktyczny dla planowania lekcji. Zadbaj, by tematy byy sensownie dobrane do poziomu.
      `.trim(),w=await On(j,nu);s("step1",{outline:w,isGenerating:!1})}catch{s("step1",{isGenerating:!1})}},c=!!(i.isMaturaCourse&&r&&i.alignToCurriculum),d=(i.title||"").trim(),u=(i.outline?.title||"").trim(),m=!!(i.useCustomTitle&&d),h=m?d:u||(i.subject&&i.level?`${i.subject}  kurs ${i.level}`:"Szkic kursu"),y=r?.outcomes?.[i.subject]??[];return e.jsxs(H,{children:[e.jsx(ue,{title:"Krok 1 ",description:"Szkic kursu"}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Parametry kursu"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs(ge,{value:i.subject||"Matematyka",onValueChange:x=>s("step1",{subject:x}),disabled:i.isGenerating,children:[e.jsx(fe,{children:e.jsx(je,{placeholder:"Wybierz przedmiot"})}),e.jsx(xe,{children:jc.map(x=>e.jsx(W,{value:x,children:x},x))})]}),e.jsxs(ge,{value:i.level||"podstawowy",onValueChange:x=>s("step1",{level:x}),disabled:i.isGenerating,children:[e.jsx(fe,{children:e.jsx(je,{placeholder:"Wybierz poziom"})}),e.jsxs(xe,{children:[e.jsx(W,{value:"podstawowy",children:"Podstawowy"}),e.jsx(W,{value:"rozszerzony",children:"Rozszerzony"})]})]}),e.jsx(Q,{placeholder:"Tytu kursu (opcjonalnie)",value:i.title||"",onChange:x=>s("step1",{title:x.target.value}),disabled:i.isGenerating}),e.jsx(I,{className:"bg-muted/40 border-dashed",children:e.jsxs(E,{className:"space-y-3 pt-4",children:[(i.title||"").trim()?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{checked:!!i.useCustomTitle,onCheckedChange:x=>s("step1",{useCustomTitle:!!x}),disabled:i.isGenerating}),e.jsxs("span",{className:"text-sm",children:["U偶yj ",e.jsx("strong",{children:"mojej nazwy"})," przy zapisie (zamiast wygenerowanej)"]})]}):null,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{checked:i.isMaturaCourse||!1,onCheckedChange:x=>s("step1",{isMaturaCourse:!!x,alignToCurriculum:x?i.alignToCurriculum:!1}),disabled:i.isGenerating}),e.jsx("span",{className:"text-sm",children:"Kurs maturalny"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{checked:i.alignToCurriculum||!1,onCheckedChange:x=>s("step1",{alignToCurriculum:!!x}),disabled:i.isGenerating}),e.jsxs("span",{className:"text-sm",children:["Uwzgldnij ",e.jsx("strong",{children:"najnowsz (2025)"})," podstaw programow LO (PL)"]})]})]})}),c&&e.jsxs(e.Fragment,{children:[e.jsxs(he,{children:[e.jsx(cn,{className:"h-4 w-4"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsxs(pe,{className:"text-xs",children:["Dokument: ",e.jsx("strong",{children:r?.label}),r?.year?`  ${r.year}`:""]}),y.length>0&&e.jsx(M,{type:"button",size:"sm",variant:"outline",className:"h-7 px-2 text-xs shrink-0",onClick:()=>o(x=>!x),children:a?"Ukryj wymagania":`Poka偶 wymagania (${y.length})`})]})]}),a&&e.jsx("ul",{className:"text-xs list-disc pl-5 space-y-1 max-h-40 overflow-auto rounded-md border p-2",children:y.map((x,g)=>e.jsx("li",{className:"leading-snug",children:x},g))})]}),e.jsx(M,{onClick:l,disabled:i.isGenerating,className:"w-full",children:i.isGenerating?e.jsxs(e.Fragment,{children:[e.jsx(Et,{className:"w-4 h-4 animate-spin"}),"Generowanie..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"w-4 h-4"}),"Generuj szkic"]})})]})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Podgld szkicu"})}),e.jsx(E,{children:i.isGenerating?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(Et,{className:"w-6 h-6 animate-spin"})}):i.outline?e.jsxs("div",{className:"space-y-5",children:[e.jsx(hv,{custom:d,generated:u,activeIsCustom:m}),e.jsx(pv,{subjectActive:i.subject,levelActive:i.level,isMatura:i.isMaturaCourse}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-auto pr-1",children:i.outline.topics?.map((x,g)=>e.jsxs(I,{className:"p-3",children:[e.jsxs("div",{className:"font-medium",children:[g+1,". ",x.title]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:x.description})]},g))}),e.jsx(M,{asChild:!0,className:"w-full",children:e.jsx(Le,{to:"/admin/course-structure/step2",children:"Dalej "})})]}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("div",{className:"font-medium",children:h}),e.jsx("div",{className:"text-xs mt-1",children:"Kliknij Generuj szkic"})]})})]})]}),e.jsx(Tp,{})]})}const iu={type:"object",properties:{courseTitle:{type:"string",required:!0},courseDescription:{type:"string"},subject:{type:"string",required:!0},level:{type:"string",required:!0},isMaturaCourse:{type:"boolean",required:!0},topics:{type:"array",minItems:1,items:{type:"object",properties:{title:{type:"string",required:!0},description:{type:"string",required:!0},position:{type:"number",required:!0},is_published:{type:"boolean",required:!0}}}}}},ru=950;function xv(t){return String(t??"").trim().toLowerCase()==="rozszerzony"?"rozszerzony":"podstawowy"}function gv(){const{registerStep:t,setStepData:s,getStepData:n}=ws(),i=ae(),r=n("step1")||{},a=n("step2")||{},[o,l]=f.useState(!1);f.useEffect(()=>{if(t("step2",iu),a.targetCount||s("step2",{targetCount:15}),!a.titleSource){const m=r.useCustomTitle&&r.title?.trim()?"custom":"generated";s("step2",{titleSource:m})}r.outline||i("/admin/course-structure/step1")},[]);const c=async()=>{if(!r.outline){s("step2",{error:"Brak danych z kroku 1"});return}s("step2",{isGenerating:!0,error:null,errorDetails:null});const m=String(r.subject||r.outline?.subject||"").trim(),h=xv(r.level||r.outline?.level),y=!!(r.isMaturaCourse??r.outline?.isMaturaCourse);let x=`
Rozwi szkic kursu do dokadnie ${a.targetCount} temat贸w lekcji, logicznie uporzdkowanych od podstaw do bardziej zaawansowanych.
Wygeneruj tytuy i kr贸tkie opisy (23 zdania) z perspektywy nauczyciela przygotowujcego plan pracy.
Kontekst:
- tytu szkicu: ${r.outline.title}
- przedmiot: ${m}
- poziom: ${h}
- kurs ${y?"maturalny":"niematuralny"}
- g贸wne tematy szkicu: ${(r.outline.topics||[]).map(g=>g.title).join(", ")}

Zachowaj sp贸jno terminologii i adekwatno do poziomu. Jeli kurs maturalny  uwzgldnij wymagania egzaminacyjne w zakresie doboru temat贸w.
    `.trim();x.length>ru&&(x=x.slice(0,ru-3)+"...");try{const g=await On(x,iu),j=g.courseTitle||g.title||r.outline.title,b=(a.titleSource||(r.useCustomTitle&&r.title?.trim()?"custom":"generated"))==="custom"&&r.title?.trim()?r.title.trim():j,v={...g,courseTitle:b,subject:m,level:h,isMaturaCourse:y,topics:(g.topics||[]).map((C,_)=>({...C,position:Number(C.position||_+1),is_published:!1}))};s("step2",{refined:v,isGenerating:!1,error:null,errorDetails:null,generatedTitle:j})}catch(g){console.error("Bd generowania:",g);let j;g instanceof fa?j={message:g.message,status:g.status,...g.info&&typeof g.info=="object"?g.info:{raw:g.info}}:g instanceof Error?j={message:g.message}:j={error:g},s("step2",{isGenerating:!1,error:"Nie udao si wygenerowa temat贸w. Spr贸buj ponownie.",errorDetails:j})}},d=()=>{i("/admin/course-structure/step3",{state:{refined:a.refined,outline:r.outline}})},u=a.titleSource==="custom"&&r.title?.trim()?r.title.trim():a.generatedTitle||r.outline?.title;return e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsx("h1",{className:"text-2xl font-semibold mb-6",children:"Krok 2  Szczeg贸owe tematy lekcji"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Konfiguracja"})}),e.jsxs(E,{className:"space-y-4",children:[r.outline&&e.jsxs(he,{children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsxs(pe,{children:[e.jsx("strong",{children:"Rozwijamy kurs:"})," ",r.outline.title,e.jsx("br",{}),e.jsxs("span",{className:"text-muted-foreground",children:[String(r.subject||r.outline.subject),"  ",String(r.level||r.outline.level),!!(r.isMaturaCourse||r.outline.isMaturaCourse)&&"  Maturalny"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"殴r贸do tytuu kursu"}),r.title?.trim()?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{type:"button",variant:a.titleSource==="custom"?"default":"outline",onClick:()=>s("step2",{titleSource:"custom"}),className:"flex-1",children:"Moja nazwa"}),e.jsx(M,{type:"button",variant:a.titleSource==="generated"?"default":"outline",onClick:()=>s("step2",{titleSource:"generated"}),className:"flex-1",children:"Wygenerowana"})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[" Moja: ",e.jsx("strong",{children:r.title.trim()}),e.jsx("br",{})," Wygenerowana: ",e.jsx("strong",{children:a.generatedTitle||r.outline?.title})]}),e.jsxs("div",{className:"text-xs",children:["Zostanie zapisane: ",e.jsx("strong",{children:u})]})]}):e.jsx("div",{className:"text-xs text-muted-foreground",children:"Brak wasnej nazwy z kroku 1  zostanie u偶yta wygenerowana."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Liczba temat贸w lekcji"}),e.jsx(Q,{type:"number",min:"5",max:"50",value:a.targetCount||15,onChange:m=>s("step2",{targetCount:Number(m.target.value)}),disabled:a.isGenerating}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Zalecane: 10-20 dla kursu podstawowego, 20-30 dla rozszerzonego"})]}),a.error&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(he,{variant:"destructive",children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsx(pe,{children:a.error})]}),a.errorDetails&&e.jsxs(I,{children:[e.jsx(F,{className:"py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx($,{className:"text-sm",children:"Szczeg贸y bdu"}),e.jsx(M,{variant:"ghost",size:"sm",onClick:()=>l(m=>!m),className:"h-7",children:o?e.jsx($t,{className:"w-4 h-4"}):e.jsx(dt,{className:"w-4 h-4"})})]})}),o&&e.jsxs(E,{className:"pt-0",children:[e.jsx(Xt,{className:"font-mono text-xs h-40",readOnly:!0,value:JSON.stringify(a.errorDetails,null,2)}),"limits"in a.errorDetails&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-2",children:[e.jsx("strong",{children:"Wskaz贸wka:"})," Twoja wiadomo moga przekroczy limit (",a.errorDetails.limits?.maxMessageLength," znak贸w). Spr贸buj zmniejszy liczb temat贸w lub usun cz kontekstu."]}),typeof a.errorDetails?.status=="number"&&a.errorDetails.status>=500&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-2",children:[e.jsx("strong",{children:"Wskaz贸wka:"})," Usuga modelu chwilowo przeci偶ona (HTTP ",a.errorDetails.status,"). Spr贸buj ponownie za chwil."]})]})]})]}),e.jsx(M,{onClick:c,disabled:a.isGenerating||!r.outline,className:"w-full",children:a.isGenerating?e.jsxs(e.Fragment,{children:[e.jsx(Et,{className:"w-4 h-4 animate-spin"}),"Generowanie temat贸w..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"w-4 h-4"}),"Generuj ",a.targetCount," temat贸w"]})}),a.refined&&e.jsx(I,{className:"bg-muted",children:e.jsxs(E,{className:"pt-6",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Wygenerowano:"}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("div",{children:[" ",a.refined.topics?.length||0," temat贸w"]}),e.jsxs("div",{children:[" ",a.refined.courseDescription?"":""," Opis kursu"]}),e.jsxs("div",{children:[" Poziom: ",a.refined.level]})]})]})})]})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Podgld temat贸w"})}),e.jsx(E,{children:a.isGenerating?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-muted-foreground",children:[e.jsx(Et,{className:"w-8 h-8 animate-spin mb-3"}),e.jsxs("p",{className:"text-sm",children:["Generowanie ",a.targetCount," temat贸w..."]}),e.jsx("p",{className:"text-xs mt-1",children:"To mo偶e potrwa do 30 sekund"})]}):a.refined?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mb-4",children:e.jsxs(E,{className:"pt-6",children:[e.jsx("h3",{className:"font-bold",children:a.refined.courseTitle}),a.refined.courseDescription&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:a.refined.courseDescription}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[a.refined.subject,"  ",a.refined.level,a.refined.isMaturaCourse?"  Maturalny":""]})]})}),e.jsx(tt,{className:"h-[400px] mb-4",children:e.jsx("div",{className:"space-y-2",children:a.refined.topics?.map(m=>e.jsx(I,{className:"p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("span",{className:"text-muted-foreground text-sm",children:[m.position,"."]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:m.title}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:m.description})]})]})},m.position))})}),e.jsxs(M,{onClick:d,className:"w-full",variant:"default",children:[e.jsx("span",{children:"Przejd藕 do zapisu"}),e.jsx(be,{className:"w-4 h-4"})]})]}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-sm",children:"Tematy pojawi si tutaj po wygenerowaniu"}),e.jsx("p",{className:"text-xs mt-2",children:'Wybierz liczb temat贸w i kliknij "Generuj"'})]})})]})]}),e.jsx(Tp,{})]})}function jv(t){return String(t??"").trim().toLowerCase()==="rozszerzony"?"rozszerzony":"podstawowy"}function yv(){const t=ae(),s=Ns(),{data:n}=Ze(),{steps:i,clearAll:r}=ws(),a=f.useMemo(()=>s?.state?.refined??i?.step2?.refined,[s?.state,i]),o=f.useMemo(()=>s?.state?.outline??i?.step1?.outline,[s?.state,i]),[l,c]=f.useState(!1),[d,u]=f.useState(null),[m,h]=f.useState(0),[y,x]=f.useState(null),{mutate:g}=Yt(),{mutate:j}=Yt(),w=async()=>{if(!a){x("Brak danych kursu (refined). Wr贸 do kroku 2.");return}x(null),c(!0),h(0);try{const v=jv(a.level),C=String(a.subject??o?.subject??"").trim(),_=!!a.isMaturaCourse,S=await new Promise((p,N)=>{g({resource:"courses",values:{title:a.courseTitle,description:a.courseDescription||"",vendor_id:Number(n?.vendor_id??0),is_published:!1,icon_emoji:o?.icon_emoji||"",subject:C,level:v,is_exam_course:_}},{onSuccess:A=>{const D=A?.data?.id;if(D==null)return N(new Error("Brak ID kursu"));p(D)},onError:A=>N(A)})});u(S);const z=typeof S=="string"?parseInt(S,10):S,k=a.topics?.length||0;for(let p=0;p<k;p++){const N=a.topics[p],A=Number(N.position??p+1);await new Promise(D=>{j({resource:"topics",values:{course_id:z,title:N.title,position:A,is_published:!!(N.is_published??!1)}},{onSuccess:()=>{h(P=>P+1),D()},onError:()=>D()})})}const T=a.topics?.length||0;t("/admin/course-structure/step4",{replace:!0,state:{courseId:z,courseTitle:a.courseTitle,topicsCount:T}}),r()}catch(v){console.error("Bd zapisu:",v),x(v?.message||"Nie udao si zapisa kursu.")}finally{c(!1)}};if(!a)return e.jsx("div",{className:"max-w-3xl mx-auto p-6",children:e.jsx(I,{children:e.jsxs(E,{className:"pt-6",children:[e.jsxs(he,{variant:"destructive",children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsxs(pe,{children:[e.jsx("span",{className:"font-medium",children:"Brak danych do zapisu"}),e.jsx("br",{}),"Wr贸 do kroku 2 i wygeneruj tematy kursu."]})]}),e.jsx(M,{asChild:!0,className:"mt-4",children:e.jsxs(Le,{to:"/admin/course-structure/step2",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Wr贸 do kroku 2"]})})]})})});const b=a.topics?.length>0?m/a.topics.length*100:0;return e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("header",{className:"flex items-center gap-2 mb-6",children:[e.jsx(Rs,{className:"w-5 h-5"}),e.jsx("h1",{className:"text-xl font-semibold",children:"Krok 3  Zapis kursu"})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Podsumowanie"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:a.courseTitle}),a.courseDescription&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:a.courseDescription}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-2",children:[a.subject,"  ",String(a.level),a.isMaturaCourse?"  Maturalny":""]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium mb-2",children:["Tematy (",a.topics.length,"):"]}),e.jsx(tt,{className:"h-64",children:e.jsxs("div",{className:"space-y-1 text-sm",children:[a.topics.slice(0,12).map((v,C)=>e.jsxs("div",{className:"border-l-2 border-muted pl-2",children:[e.jsxs("span",{className:"text-muted-foreground",children:[Number(v.position??C+1),"."]})," ",v.title]},C)),a.topics.length>12&&e.jsxs("div",{className:"text-xs text-muted-foreground italic",children:["... i ",a.topics.length-12," wicej"]})]})})]}),y&&e.jsxs(he,{variant:"destructive",children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsx(pe,{children:y})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(M,{onClick:w,disabled:l,className:"flex-1",children:[l?e.jsx(Et,{className:"w-4 h-4 animate-spin"}):e.jsx(Rs,{className:"w-4 h-4"}),l?"Zapisywanie...":"Zapisz kurs i tematy"]}),e.jsx(M,{asChild:!0,variant:"outline",children:e.jsx(Le,{to:"/admin/course-structure/step2",children:e.jsx(Ne,{className:"w-4 h-4"})})})]})]})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Status zapisu"})}),e.jsx(E,{children:!l&&!d?e.jsxs("p",{className:"text-sm text-muted-foreground",children:['Kliknij Zapisz kurs i tematy", aby utworzy kurs i'," ",a.topics.length," temat贸w."]}):l?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Et,{className:"w-4 h-4 animate-spin"}),"Zapisywanie temat贸w: ",m," / ",a.topics.length]}),e.jsx(is,{value:b,className:"w-full"})]}):d?e.jsxs(he,{children:[e.jsx(Rt,{className:"h-4 w-4"}),e.jsxs(pe,{children:[e.jsx("span",{className:"font-medium",children:"Zapisano pomylnie!"}),e.jsx("br",{}),"ID kursu: ",String(d)]})]}):null})]})]})]})}const wv={type:"object",properties:{courseTitle:{type:"string"},topics:{type:"array",minItems:1,items:{type:"object",properties:{title:{type:"string",required:!0},description:{type:"string",required:!0}}}}}};function bv(){const t=Ns(),s=ae(),n=t?.state?.courseId,i=t?.state?.courseTitle||"Nowy kurs",r=t?.state?.topicsCount||0,{data:a,isLoading:o,isError:l,refetch:c}=Z({resource:"courses",pagination:{current:1,pageSize:50},sorters:[{field:"id",order:"desc"}]}),d=a?.data??[],[u,m]=f.useState(n);f.useEffect(()=>{!u&&d.length>0&&m(d[0].id)},[u,d]),f.useEffect(()=>{c()},[]);const{data:h,isLoading:y,isError:x,refetch:g}=Z({resource:"topics",filters:u?[{field:"course_id",operator:"eq",value:typeof u=="string"?parseInt(u,10):u}]:[],sorters:[{field:"position",order:"asc"}],pagination:{current:1,pageSize:500},queryOptions:{enabled:!!u}});f.useEffect(()=>{u&&g()},[u]);const j=h?.data??[],w=f.useMemo(()=>{if(n!==void 0)return typeof n=="string"?parseInt(n,10):n},[n]),{mutate:b}=Is(),[v,C]=f.useState(null),_=async(O,G)=>{window.confirm(`Na pewno usun temat${G?`: ${G}`:""}? Tego nie mo偶na cofn.`)&&(C(O),await new Promise(ie=>{b({resource:"topics",id:O},{onSuccess:()=>{C(null),g(),ie()},onError:()=>{C(null),ie()}})}))},{mutate:S}=Is(),[z,k]=f.useState(!1),T=async()=>{if(!u)return;const G=d.find(ie=>Number(ie.id)===Number(u))?.title||`Kurs #${String(u)}`;window.confirm(`Usun kurs ${G}? Wszystkie jego tematy (i dalsze zale偶ne rekordy) zostan usunite kaskadowo. Tej operacji nie mo偶na cofn.`)&&(k(!0),await new Promise(ie=>{S({resource:"courses",id:u},{onSuccess:async()=>{k(!1),m(void 0),await c(),await g(),ie()},onError:()=>{k(!1),ie()}})}))},{mutate:p}=Yt(),[N,A]=f.useState(j.length||15),[D,P]=f.useState(!1),[R,q]=f.useState(0),L=async()=>{if(!u)return;const O=d.find(Ce=>Number(Ce.id)===Number(u)),G=O?.title||"Kurs",se=O?.description||"";if(window.confirm(`To zastpi WSZYSTKIE tematy kursu ${G}.

Kontynuowa?`)){P(!0),q(0);try{const Ce=`
Jeste metodykiem. Wygeneruj dokadnie ${N} temat贸w lekcji do kursu:
- Tytu kursu: ${G}
- Opis (jeli jest): ${se||"(brak)"}

Wypisz list temat贸w (tytu + kr贸tki opis 12 zdania) z narastajc trudnoci.
`.trim(),Tt=(await On(Ce,wv))?.topics||[],_e=j.filter(me=>me?.id!==void 0&&me?.id!==null);for(let me=0;me<_e.length;me++){const ut=_e[me].id;await new Promise(mt=>{b({resource:"topics",id:ut},{onSuccess:()=>mt(),onError:()=>mt()})}),q(Math.round((me+1)/(_e.length+Tt.length)*100))}for(let me=0;me<Tt.length;me++){const ut=Tt[me];await new Promise(mt=>{p({resource:"topics",values:{course_id:typeof u=="string"?parseInt(u,10):u,title:ut.title,position:me+1,is_published:!1}},{onSuccess:()=>{q(Math.round((_e.length+(me+1))/(_e.length+Tt.length)*100)),mt()},onError:()=>mt()})})}await g()}catch(Ce){console.error("Regeneracja temat贸w nie powioda si",Ce)}finally{P(!1),q(0)}}},U=()=>{if(!u)return;const O=d.find(G=>Number(G.id)===Number(u));s("/admin/course-structure/step5",{state:{courseId:typeof u=="string"?parseInt(u,10):u,courseTitle:O?.title||`Kurs #${String(u)}`,courseDescription:O?.description||"",currentCount:j.length}})};return e.jsxs("div",{className:"max-w-7xl mx-auto p-6 min-h-screen flex flex-col",children:[e.jsxs("header",{className:"flex items-center gap-2 mb-6",children:[e.jsx(tp,{className:"w-5 h-5 text-green-600"}),e.jsx("h1",{className:"text-xl font-semibold",children:"Krok 4  Zakoczone"})]}),n!==void 0&&e.jsxs(I,{className:"mb-6 border-green-200 bg-green-50/50",children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(xw,{className:"w-5 h-5 text-green-700"}),"Kurs utworzony"]})}),e.jsxs(E,{className:"space-y-2",children:[e.jsx(he,{children:e.jsxs(pe,{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:i}),r?e.jsxs(e.Fragment,{children:["  zapisano ",r," temat",r===1?"":r<5?"y":"贸w","."]}):null," ","(ID: ",String(n),")"]})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Nowy kurs jest wyr贸偶niony i zaznaczony  po prawej widzisz jego tematy."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-6 flex-1",children:[e.jsxs(I,{className:"lg:col-span-2 lg:h-full flex flex-col",children:[e.jsx(F,{children:e.jsx($,{children:"Wszystkie kursy"})}),e.jsx(E,{className:"flex-1 overflow-hidden",children:o?e.jsxs("div",{className:"space-y-2",children:[e.jsx(Mt,{className:"h-10 w-full"}),e.jsx(Mt,{className:"h-10 w-full"}),e.jsx(Mt,{className:"h-10 w-full"})]}):l?e.jsx(he,{variant:"destructive",children:e.jsx(pe,{children:"Nie udao si pobra listy kurs贸w."})}):d.length===0?e.jsx("div",{className:"text-sm text-muted-foreground py-4",children:"Brak kurs贸w."}):e.jsx(tt,{className:"h-full pr-2",children:e.jsx("div",{className:"space-y-2",children:d.map(O=>{const G=w!==void 0&&Number(O.id)===Number(w),se=u!==void 0&&Number(O.id)===Number(u);return e.jsx("button",{onClick:()=>m(O.id),className:["w-full text-left rounded-xl border px-3 py-2 transition",se?"border-black/80 bg-black text-white":"hover:bg-muted/60",G&&!se?"border-green-400":"",G&&se?"ring-2 ring-green-300":""].join(" "),children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:["font-medium",se?"text-white":"text-foreground"].join(" "),children:O.title||`Kurs #${O.id}`}),O.description?e.jsx("div",{className:["text-xs line-clamp-2",se?"text-white/80":"text-muted-foreground"].join(" "),children:O.description}):null]}),e.jsxs("div",{className:"shrink-0 flex items-center gap-2",children:[G&&e.jsx(V,{variant:se?"secondary":"default",children:"NOWY"}),!O.is_published&&e.jsx(V,{variant:se?"secondary":"outline",className:"text-[10px]",children:"szkic"})]})]})},O.id)})})})})]}),e.jsxs(I,{className:"lg:col-span-3 lg:h-full flex flex-col",children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center justify-between gap-2",children:[e.jsxs("span",{children:["Tematy:"," ",(()=>{const O=d.find(G=>Number(G.id)===Number(u));return O?.title?O.title:u?`Kurs #${String(u)}`:""})()]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(M,{size:"sm",variant:"destructive",onClick:T,disabled:!u||z||D||y,title:"Usu kurs wraz z powizanymi danymi",children:[e.jsx(Ft,{className:"w-4 h-4 mr-1"}),z?"Usuwanie...":"Usu kurs"]}),e.jsxs(M,{size:"sm",variant:"outline",onClick:U,disabled:!u||y,children:[e.jsx(Ke,{className:"w-4 h-4 mr-1"}),"Uzupenij braki"]})]})]})}),e.jsxs(E,{className:"flex-1 overflow-hidden space-y-4",children:[e.jsxs("div",{className:"rounded-xl border p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(sp,{className:"w-4 h-4"}),e.jsx("div",{className:"text-sm font-medium",children:"Wygeneruj od nowa"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{type:"number",min:5,max:50,value:N,onChange:O=>A(Number(O.target.value)),className:"max-w-[120px]",disabled:D||y||!u}),e.jsx(M,{size:"sm",onClick:L,disabled:D||y||!u||N<1,children:D?e.jsxs(e.Fragment,{children:[e.jsx(is,{value:R,className:"w-28 mr-2"}),"Przebudowa"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"w-4 h-4 mr-1"}),"Generuj ",N]})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Zastpi wszystkie istniejce tematy nowymi propozycjami (LLM) na podstawie tytuu/opisu kursu."})]}),u?y?e.jsxs("div",{className:"space-y-2",children:[e.jsx(Mt,{className:"h-16 w-full"}),e.jsx(Mt,{className:"h-16 w-full"}),e.jsx(Mt,{className:"h-16 w-full"})]}):x?e.jsx(he,{variant:"destructive",children:e.jsx(pe,{children:"Nie udao si pobra temat贸w dla wybranego kursu."})}):j.length===0?e.jsx("div",{className:"text-sm text-muted-foreground py-4",children:"Brak temat贸w dla tego kursu."}):e.jsx(tt,{className:"h-full",children:e.jsx("div",{className:"space-y-2",children:j.map((O,G)=>{const se=Number(O.position??G+1),ie=O?.id!==void 0&&O?.id!==null,Ce=ie&&v===O.id;return e.jsxs("div",{className:"rounded-xl border p-3 flex items-start gap-3",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[se,"."]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:O.title}),"description"in O&&O.description?e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:O.description}):null]}),e.jsx(M,{type:"button",size:"sm",variant:"ghost",className:"text-red-600 hover:text-red-700",disabled:!ie||Ce,onClick:()=>ie&&_(O.id,O.title),title:ie?"Usu temat":"Brak ID tematu",children:e.jsx(Ft,{className:"w-4 h-4"})})]},O.id??`row-${G}`)})})}):e.jsx("div",{className:"text-sm text-muted-foreground py-4",children:"Wybierz kurs z listy po lewej."})]})]})]})]})}const vv={type:"object",properties:{topics:{type:"array",minItems:1,items:{type:"object",properties:{title:{type:"string",required:!0},description:{type:"string",required:!0}}}}}};function Nv(){const t=ae(),s=Ns(),n=s?.state?.courseId,i=s?.state?.courseTitle||"Kurs",r=s?.state?.courseDescription||"";f.useEffect(()=>{n||t("/admin/course-structure/step4")},[n]);const{data:a,refetch:o,isLoading:l}=Z({resource:"topics",filters:n?[{field:"course_id",operator:"eq",value:typeof n=="string"?parseInt(n,10):n}]:[],sorters:[{field:"position",order:"asc"}],pagination:{current:1,pageSize:500},queryOptions:{enabled:!!n}}),c=f.useMemo(()=>a?.data??[],[a]),d=f.useMemo(()=>c.reduce((k,T)=>Math.max(k,Number(T.position??0)),0),[c]),[u,m]=f.useState(""),[h,y]=f.useState(!1),[x,g]=f.useState([]),[j,w]=f.useState({}),{mutate:b}=Yt(),v=k=>w(T=>({...T,[k]:!T[k]})),C=()=>w(Object.fromEntries(x.map((k,T)=>[T,!0]))),_=()=>w({}),S=async()=>{if(!n)return;const k=3;y(!0);try{const T=c.map(D=>D.title).filter(Boolean),p=`
Uzupenij kurs o NOWE tematy. Wygeneruj DOKADNIE ${k} propozycje (tytu + kr贸tki opis 12 zdania).
Unikaj powt贸rze wzgldem istniejcych temat贸w.
${u?`Preferowane kierunki / wskaz贸wki: ${u}`:""}
Dane kursu:
- Tytu: ${i}
- Opis: ${r||"(brak)"}
- Istniejce tematy: ${T.length?T.join("; "):"(brak)"}

Zwr贸 list obiekt贸w JSON zgodnych ze schematem.
`.trim(),A=(await On(p,vv))?.topics||[];g(A),w(Object.fromEntries(A.map((D,P)=>[P,!0])))}finally{y(!1)}},z=async()=>{if(!n||x.length===0)return;const k=x.filter((N,A)=>j[A]);if(k.length===0)return;const T=typeof n=="string"?parseInt(n,10):n;let p=d;for(let N=0;N<k.length;N++){p+=1;const A=k[N];await new Promise(D=>{b({resource:"topics",values:{course_id:T,title:A.title,position:p,is_published:!1}},{onSuccess:()=>D(),onError:()=>D()})})}await o(),t("/admin/course-structure/step4",{replace:!0,state:{courseId:n,courseTitle:i,topicsCount:c.length+k.length}})};return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsxs("header",{className:"flex items-center gap-2 mb-6",children:[e.jsx(Ke,{className:"w-5 h-5"}),e.jsx("h1",{className:"text-xl font-semibold",children:"Krok 5  Uzupenij brakujce tematy"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ys,{className:"w-4 h-4"}),"Kontekst kursu"]})}),e.jsxs(E,{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:i}),r&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:r})]}),e.jsxs("div",{className:"text-sm",children:["Aktualnie: ",e.jsx("strong",{children:c.length})," temat贸w"]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm",children:"Podpowied藕 dla generatora (opcjonalnie)"}),e.jsx(Q,{type:"text",placeholder:"Np. dodaj tematy z ekologii i ochrony rodowiska",value:u,onChange:k=>m(k.target.value)})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Poni偶ej lista istniejcych temat贸w  generator unika duplikat贸w."}),e.jsx(tt,{className:"h-[280px] pr-2",children:l?e.jsx("div",{className:"text-sm text-muted-foreground",children:"adowanie"}):c.length===0?e.jsx("div",{className:"text-sm text-muted-foreground",children:"Brak temat贸w."}):e.jsx("div",{className:"space-y-1 text-sm",children:c.map((k,T)=>e.jsxs("div",{className:"border-l-2 border-muted pl-2",children:[e.jsxs("span",{className:"text-muted-foreground",children:[Number(k.position??T+1),"."]})," ",k.title]},k.id??T))})}),e.jsxs("div",{className:"pt-2",children:[e.jsx(M,{asChild:!0,size:"sm",variant:"outline",className:"mr-2",children:e.jsxs(Le,{to:"/admin/course-structure/step4",children:[e.jsx(Ne,{className:"mr-1"}),"Wr贸"]})}),e.jsxs(M,{size:"sm",onClick:S,disabled:h,children:[e.jsx(_i,{}),h?"Generowanie...":"Generuj propozycje nowych temat贸w"]})]})]})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(gw,{className:"w-4 h-4"}),"Propozycje (zaznacz, kt贸re doda)"]})}),e.jsx(E,{children:x.length===0?e.jsxs(he,{children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsx(pe,{className:"text-sm",children:"Brak propozycji."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(M,{size:"sm",variant:"outline",onClick:C,children:"Zaznacz wszystko"}),e.jsx(M,{size:"sm",variant:"outline",onClick:_,children:"Wyczy zaznaczenie"}),e.jsxs("div",{className:"text-xs text-muted-foreground ml-auto",children:["Wybrane: ",x.filter((k,T)=>j[T]).length," / ",x.length]})]}),e.jsx(tt,{className:"h-[380px] pr-2",children:e.jsx("div",{className:"space-y-2",children:x.map((k,T)=>e.jsxs("div",{className:"rounded-xl border p-3 flex items-start gap-3",children:[e.jsx(Ge,{checked:!!j[T],onCheckedChange:()=>v(T),className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:k.title}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:k.description})]})]},T))})}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs(M,{onClick:z,className:"flex-1",disabled:x.every((k,T)=>!j[T]),children:["Zapisz wybrane",e.jsx(be,{className:"w-4 h-4 ml-1"})]}),e.jsx(M,{variant:"outline",className:"flex-1",onClick:()=>g([]),children:"Wyczy podgld"})]})]})})]})]})]})}const kv=[e.jsx(K,{path:"/course-structure",element:e.jsx(lv,{})},"course-dashboard"),e.jsx(K,{path:"/course-structure/step1",element:e.jsx(fv,{})},"course-step1"),e.jsx(K,{path:"/course-structure/step2",element:e.jsx(gv,{})},"course-step2"),e.jsx(K,{path:"/course-structure/step3",element:e.jsx(yv,{})},"course-step3"),e.jsx(K,{path:"/course-structure/step4",element:e.jsx(bv,{})},"course-step4"),e.jsx(K,{path:"/course-structure/step5",element:e.jsx(Nv,{})},"course-step5")],au={name:"course-structure",list:"/course-structure",create:"/course-structure/step1",meta:{canDelete:!1,label:"Generator kurs贸w",icon:e.jsx(_i,{className:"h-4 w-4"})}},zv=[{id:"course-structure",title:"Generator struktury kursu",description:"Stw贸rz kompletn struktur kursu z harmonogramem i tematami",icon:hr,path:"/admin/course-structure",color:"from-indigo-50 to-blue-50",borderColor:"border-indigo-200",iconBg:"bg-indigo-100",iconColor:"text-indigo-600",buttonBg:"bg-indigo-600 hover:bg-indigo-700",features:["Automatyczna analiza wymaga","Generowanie harmonogramu","Podzia na tygodnie i tematy","Zgodno z podstaw programow"],estimatedTime:"15-20 min",targetAudience:"Tw贸rcy nowych kurs贸w"},{id:"educational-material",title:"Kreator materia贸w edukacyjnych",description:"Generuj anga偶ujce materiay dydaktyczne dostosowane do wieku uczni贸w",icon:ye,path:"/admin/educational-material",color:"from-purple-50 to-pink-50",borderColor:"border-purple-200",iconBg:"bg-purple-100",iconColor:"text-purple-600",buttonBg:"bg-purple-600 hover:bg-purple-700",features:["Materiay dostosowane do wieku","wiczenia praktyczne","Formatowanie Markdown","Integracja z istniejcymi kursami"],estimatedTime:"10-15 min",targetAudience:"Nauczyciele wszystkich poziom贸w"},{id:"quiz-wizard",title:"Kreator quiz贸w",description:"Tw贸rz profesjonalne testy sprawdzajce z r贸偶nymi typami pyta",icon:ys,path:"/admin/quiz-wizard",color:"from-blue-50 to-cyan-50",borderColor:"border-blue-200",iconBg:"bg-blue-100",iconColor:"text-blue-600",buttonBg:"bg-blue-600 hover:bg-blue-700",features:["R贸偶ne typy pyta","Automatyczne wyjanienia","Konfiguracja parametr贸w","Inteligentne punktowanie"],estimatedTime:"10-15 min",targetAudience:"Do sprawdzania wiedzy"}],Sv=()=>{const t=ae();return e.jsxs(H,{children:[e.jsx(ue,{title:"Narzdzia AI dla nauczycieli",description:"Wykorzystaj sztuczn inteligencj do tworzenia wysokiej jakoci materia贸w edukacyjnych"}),e.jsx("div",{className:"mb-8 p-6 bg-gradient-to-r from-violet-50 to-purple-50 rounded-lg border border-purple-200",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:e.jsx(Ke,{className:"w-8 h-8 text-purple-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Przyspiesz tworzenie materia贸w z AI"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Nasze narzdzia AI pomagaj tworzy spersonalizowane materiay edukacyjne w uamku czasu potrzebnego na tradycyjne przygotowanie. Ka偶dy kreator prowadzi Ci krok po kroku przez proces tworzenia."}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(et,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{children:"Oszczdno czasu do 80%"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{children:"Dostosowane do programu nauczania"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{children:"Personalizacja dla r贸偶nych grup"})]})]})]})]})}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:zv.map(s=>{const n=s.icon;return e.jsxs(I,{className:`hover:shadow-lg transition-shadow cursor-pointer border-2 ${s.borderColor}`,onClick:()=>t(s.path),children:[e.jsxs(F,{children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${s.iconBg}`,children:e.jsx(n,{className:`w-6 h-6 ${s.iconColor}`})}),e.jsx(He,{className:"w-5 h-5 text-gray-400"})]}),e.jsx($,{className:"text-lg",children:s.title}),e.jsx(so,{children:s.description})]}),e.jsx(E,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-700 mb-2",children:"G贸wne funkcje:"}),e.jsx("ul",{className:"space-y-1",children:s.features.slice(0,3).map((i,r)=>e.jsxs("li",{className:"text-xs text-gray-600 flex items-start gap-1",children:[e.jsx("span",{className:"text-green-500 mt-0.5",children:""}),e.jsx("span",{children:i})]},r))})]}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:[e.jsx(et,{className:"w-3 h-3 inline mr-1"}),s.estimatedTime]}),e.jsxs(M,{size:"sm",className:`${s.buttonBg} text-white`,children:[e.jsx(_i,{className:"w-3 h-3 mr-1"}),"Rozpocznij"]})]})]})})]},s.id)})}),e.jsxs("div",{className:"mt-8 p-6 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(Re,{className:"w-5 h-5 text-blue-600"}),"Wskaz贸wki dla najlepszych rezultat贸w"]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 text-sm text-gray-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium mb-1",children:"Przed rozpoczciem:"}),e.jsxs("ul",{className:"space-y-1 text-gray-600",children:[e.jsx("li",{children:" Przygotuj podstawowe informacje o kursie"}),e.jsx("li",{children:" Okrel grup docelow i poziom"}),e.jsx("li",{children:" Zaplanuj cele edukacyjne"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium mb-1",children:"Podczas tworzenia:"}),e.jsxs("ul",{className:"space-y-1 text-gray-600",children:[e.jsx("li",{children:" Sprawdzaj podgldy na ka偶dym etapie"}),e.jsx("li",{children:" Dostosuj wygenerowane treci do potrzeb"}),e.jsx("li",{children:" Zapisuj regularnie postpy"})]})]})]})]})]})},Cv=[e.jsx(K,{path:"ai-tools",element:e.jsx(Sv,{})},"ai-tools")];function _v(){return e.jsxs(H,{children:[e.jsx(ue,{title:"Kreator materia贸w  panel",description:"Generuj sp贸jny materia Markdown dla wybranego tematu kursu"}),e.jsxs("div",{className:"relative overflow-hidden rounded-2xl border mb-6",children:[e.jsx("div",{className:"absolute inset-0 bg-blue-50"}),e.jsxs("div",{className:"relative px-6 py-8 flex items-center gap-3",children:[e.jsx("div",{className:"shrink-0 inline-flex h-10 w-10 items-center justify-center rounded-xl bg-black text-white",children:e.jsx(_i,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-semibold leading-tight",children:"Kreator materia贸w"}),e.jsx("p",{className:"text-sm text-zinc-600",children:"Wygeneruj tre lekcji (Markdown) dla jednego, wskazanego tematu  z opisem, przykadami i zadaniami."})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(M,{asChild:!0,children:e.jsxs(Le,{to:"/admin/educational-material/step1",className:"inline-flex items-center gap-2",children:["Nowa sesja",e.jsx(be,{className:"w-4 h-4"})]})})})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"w-5 h-5"}),"Szybki start"]})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("ol",{className:"list-decimal list-inside text-sm text-zinc-700 space-y-1",children:[e.jsx("li",{children:"Wybierz kurs i temat."}),e.jsx("li",{children:"Ustaw parametry (poziom, styl, dugo, zgodno z podstaw)."}),e.jsx("li",{children:"Wygeneruj pojedynczy materia."}),e.jsxs("li",{children:["Zapisz jako aktywno typu ",e.jsx("code",{children:"material"}),"."]})]}),e.jsx(M,{asChild:!0,className:"w-full",children:e.jsxs(Le,{to:"/admin/educational-material/step1",className:"inline-flex items-center gap-2",children:["Przejd藕 do kroku 1",e.jsx(be,{className:"w-4 h-4"})]})})]})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5"}),"Jakie treci generujemy?"]})}),e.jsxs(E,{className:"space-y-3 text-sm text-muted-foreground",children:[e.jsx("p",{children:"Struktura: kr贸tki wstp  wyjanienia  przykady  mini-wiczenia  podsumowanie."}),e.jsx("p",{children:"Format: czysty Markdown (obsugujesz ju偶 w widoku materiau)."}),e.jsxs(he,{children:[e.jsx(cn,{className:"h-4 w-4"}),e.jsxs(pe,{className:"text-xs",children:["Jeli kurs jest maturalny i wczysz zgodno z podstaw LO (2025), kreator dopasuje treci do wymaga z pliku ",e.jsx("code",{children:"curriculum.ts"}),"."]})]})]})]}),e.jsxs(I,{className:"lg:col-span-2",children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-5 h-5"}),"Dodawanie pyta kontrolnych (opcjonalne)"]})}),e.jsx(E,{children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Po wygenerowaniu materia贸w mo偶esz przej do kroku 4, aby doda pytania kontrolne do ka偶dej sekcji."}),e.jsxs("ul",{className:"text-sm text-zinc-700 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Przegldaj wygenerowane materiay wedug kurs贸w i temat贸w"}),e.jsx("li",{children:"Generuj pytania kontrolne dla ka偶dej sekcji materiau"}),e.jsx("li",{children:"Pytania s automatycznie formatowane w YAML i wstawiane do treci"}),e.jsx("li",{children:"Uczniowie musz odpowiedzie poprawnie, aby odhaczy sekcj"})]})]}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx(M,{asChild:!0,variant:"outline",children:e.jsxs(Le,{to:"/admin/educational-material/step4",className:"inline-flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4"}),"Zarzdzaj pytaniami"]})})})]})})]})]})]})}function Ap({value:t,onChange:s,showAlert:n=!0,label:i,placeholder:r="Wybierz kurs"}){const[a,o]=f.useState(!1),{data:l}=Z({resource:"courses",filters:a?[{field:"is_published",operator:"eq",value:!0}]:[],sorters:[{field:"created_at",order:"desc"}],pagination:{pageSize:100}}),c=l?.data?.find(d=>d.id===t);return e.jsxs("div",{className:"space-y-4",children:[i&&e.jsx("label",{className:"text-xs font-medium block",children:i}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted rounded-lg",children:[e.jsx(Ge,{checked:a,onCheckedChange:d=>o(!!d)}),e.jsx("label",{className:"text-sm cursor-pointer",children:"Pokazuj tylko opublikowane kursy"})]}),e.jsxs(ge,{value:t?String(t):"",onValueChange:d=>s(d?Number(d):null),children:[e.jsx(fe,{children:e.jsx(je,{placeholder:r})}),e.jsx(xe,{children:(l?.data||[]).length===0?e.jsx("div",{className:"p-3 text-xs text-muted-foreground",children:a?"Brak opublikowanych kurs贸w. Odznacz filtr.":"Brak kurs贸w. Najpierw wygeneruj kurs."}):(l?.data||[]).map(d=>e.jsx(W,{value:String(d.id),children:e.jsxs("div",{className:"flex items-center gap-2",children:[d.icon_emoji?`${d.icon_emoji} `:" ",e.jsx("span",{children:d.title}),!d.is_published&&e.jsxs(V,{variant:"outline",className:"ml-2 text-xs",children:[e.jsx(dn,{className:"w-3 h-3 mr-1"}),"Szkic"]})]})},d.id))})]}),n&&c&&!c.is_published&&e.jsxs(he,{children:[e.jsx(cn,{className:"h-4 w-4"}),e.jsx(pe,{className:"text-xs",children:"Wybrany kurs jest szkicem (nieopublikowany). Materiay zostan utworzone, ale nie bd widoczne dla uczni贸w dop贸ki nie opublikujesz kursu."})]})]})}function ou(t,s){const n=String(t);if(typeof s!="string")throw new TypeError("Expected character");let i=0,r=n.indexOf(s);for(;r!==-1;)i++,r=n.indexOf(s,r+s.length);return i}function Tv(t){if(typeof t!="string")throw new TypeError("Expected a string");return t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function Av(t,s,n){const r=Zh((n||{}).ignore||[]),a=Dv(s);let o=-1;for(;++o<a.length;)Wy(t,"text",l);function l(d,u){let m=-1,h;for(;++m<u.length;){const y=u[m],x=h?h.children:void 0;if(r(y,x?x.indexOf(y):void 0,h))return;h=y}if(h)return c(d,u)}function c(d,u){const m=u[u.length-1],h=a[o][0],y=a[o][1];let x=0;const j=m.children.indexOf(d);let w=!1,b=[];h.lastIndex=0;let v=h.exec(d.value);for(;v;){const C=v.index,_={index:v.index,input:v.input,stack:[...u,d]};let S=y(...v,_);if(typeof S=="string"&&(S=S.length>0?{type:"text",value:S}:void 0),S===!1?h.lastIndex=C+1:(x!==C&&b.push({type:"text",value:d.value.slice(x,C)}),Array.isArray(S)?b.push(...S):S&&b.push(S),x=C+v[0].length,w=!0),!h.global)break;v=h.exec(d.value)}return w?(x<d.value.length&&b.push({type:"text",value:d.value.slice(x)}),m.children.splice(j,1,...b)):b=[d],j+b.length}}function Dv(t){const s=[];if(!Array.isArray(t))throw new TypeError("Expected find and replace tuple or list of tuples");const n=!t[0]||Array.isArray(t[0])?t:[t];let i=-1;for(;++i<n.length;){const r=n[i];s.push([Pv(r[0]),Mv(r[1])])}return s}function Pv(t){return typeof t=="string"?new RegExp(Tv(t),"g"):t}function Mv(t){return typeof t=="function"?t:function(){return t}}const qo="phrasing",Bo=["autolink","link","image","label"];function Iv(){return{transforms:[qv],enter:{literalAutolink:Rv,literalAutolinkEmail:Uo,literalAutolinkHttp:Uo,literalAutolinkWww:Uo},exit:{literalAutolink:Fv,literalAutolinkEmail:$v,literalAutolinkHttp:Lv,literalAutolinkWww:Ov}}}function Ev(){return{unsafe:[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:qo,notInConstruct:Bo},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:qo,notInConstruct:Bo},{character:":",before:"[ps]",after:"\\/",inConstruct:qo,notInConstruct:Bo}]}}function Rv(t){this.enter({type:"link",title:null,url:"",children:[]},t)}function Uo(t){this.config.enter.autolinkProtocol.call(this,t)}function Lv(t){this.config.exit.autolinkProtocol.call(this,t)}function Ov(t){this.config.exit.data.call(this,t);const s=this.stack[this.stack.length-1];Ci(s.type==="link"),s.url="http://"+this.sliceSerialize(t)}function $v(t){this.config.exit.autolinkEmail.call(this,t)}function Fv(t){this.exit(t)}function qv(t){Av(t,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,Bv],[/(?<=^|\s|\p{P}|\p{S})([-.\w+]+)@([-\w]+(?:\.[-\w]+)+)/gu,Uv]],{ignore:["link","linkReference"]})}function Bv(t,s,n,i,r){let a="";if(!Dp(r)||(/^w/i.test(s)&&(n=s+n,s="",a="http://"),!Vv(n)))return!1;const o=Kv(n+i);if(!o[0])return!1;const l={type:"link",title:null,url:a+s+o[0],children:[{type:"text",value:s+o[0]}]};return o[1]?[l,{type:"text",value:o[1]}]:l}function Uv(t,s,n,i){return!Dp(i,!0)||/[-\d_]$/.test(n)?!1:{type:"link",title:null,url:"mailto:"+s+"@"+n,children:[{type:"text",value:s+"@"+n}]}}function Vv(t){const s=t.split(".");return!(s.length<2||s[s.length-1]&&(/_/.test(s[s.length-1])||!/[a-zA-Z\d]/.test(s[s.length-1]))||s[s.length-2]&&(/_/.test(s[s.length-2])||!/[a-zA-Z\d]/.test(s[s.length-2])))}function Kv(t){const s=/[!"&'),.:;<>?\]}]+$/.exec(t);if(!s)return[t,void 0];t=t.slice(0,s.index);let n=s[0],i=n.indexOf(")");const r=ou(t,"(");let a=ou(t,")");for(;i!==-1&&r>a;)t+=n.slice(0,i+1),n=n.slice(i+1),i=n.indexOf(")"),a++;return[t,n]}function Dp(t,s){const n=t.input.charCodeAt(t.index-1);return(t.index===0||fi(n)||oc(n))&&(!s||n!==47)}Pp.peek=e0;function Wv(){this.buffer()}function Gv(t){this.enter({type:"footnoteReference",identifier:"",label:""},t)}function Zv(){this.buffer()}function Hv(t){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},t)}function Qv(t){const s=this.resume(),n=this.stack[this.stack.length-1];Ci(n.type==="footnoteReference"),n.identifier=Rr(this.sliceSerialize(t)).toLowerCase(),n.label=s}function Yv(t){this.exit(t)}function Jv(t){const s=this.resume(),n=this.stack[this.stack.length-1];Ci(n.type==="footnoteDefinition"),n.identifier=Rr(this.sliceSerialize(t)).toLowerCase(),n.label=s}function Xv(t){this.exit(t)}function e0(){return"["}function Pp(t,s,n,i){const r=n.createTracker(i);let a=r.move("[^");const o=n.enter("footnoteReference"),l=n.enter("reference");return a+=r.move(n.safe(n.associationId(t),{after:"]",before:a})),l(),o(),a+=r.move("]"),a}function t0(){return{enter:{gfmFootnoteCallString:Wv,gfmFootnoteCall:Gv,gfmFootnoteDefinitionLabelString:Zv,gfmFootnoteDefinition:Hv},exit:{gfmFootnoteCallString:Qv,gfmFootnoteCall:Yv,gfmFootnoteDefinitionLabelString:Jv,gfmFootnoteDefinition:Xv}}}function s0(t){let s=!1;return t&&t.firstLineBlank&&(s=!0),{handlers:{footnoteDefinition:n,footnoteReference:Pp},unsafe:[{character:"[",inConstruct:["label","phrasing","reference"]}]};function n(i,r,a,o){const l=a.createTracker(o);let c=l.move("[^");const d=a.enter("footnoteDefinition"),u=a.enter("label");return c+=l.move(a.safe(a.associationId(i),{before:c,after:"]"})),u(),c+=l.move("]:"),i.children&&i.children.length>0&&(l.shift(4),c+=l.move((s?`
`:" ")+a.indentLines(a.containerFlow(i,l.current()),s?Mp:n0))),d(),c}}function n0(t,s,n){return s===0?t:Mp(t,s,n)}function Mp(t,s,n){return(n?"":"    ")+t}const i0=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"];Ip.peek=c0;function r0(){return{canContainEols:["delete"],enter:{strikethrough:o0},exit:{strikethrough:l0}}}function a0(){return{unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:i0}],handlers:{delete:Ip}}}function o0(t){this.enter({type:"delete",children:[]},t)}function l0(t){this.exit(t)}function Ip(t,s,n,i){const r=n.createTracker(i),a=n.enter("strikethrough");let o=r.move("~~");return o+=n.containerPhrasing(t,{...r.current(),before:o,after:"~"}),o+=r.move("~~"),a(),o}function c0(){return"~"}function d0(t){return t.length}function u0(t,s){const n=s||{},i=(n.align||[]).concat(),r=n.stringLength||d0,a=[],o=[],l=[],c=[];let d=0,u=-1;for(;++u<t.length;){const g=[],j=[];let w=-1;for(t[u].length>d&&(d=t[u].length);++w<t[u].length;){const b=m0(t[u][w]);if(n.alignDelimiters!==!1){const v=r(b);j[w]=v,(c[w]===void 0||v>c[w])&&(c[w]=v)}g.push(b)}o[u]=g,l[u]=j}let m=-1;if(typeof i=="object"&&"length"in i)for(;++m<d;)a[m]=lu(i[m]);else{const g=lu(i);for(;++m<d;)a[m]=g}m=-1;const h=[],y=[];for(;++m<d;){const g=a[m];let j="",w="";g===99?(j=":",w=":"):g===108?j=":":g===114&&(w=":");let b=n.alignDelimiters===!1?1:Math.max(1,c[m]-j.length-w.length);const v=j+"-".repeat(b)+w;n.alignDelimiters!==!1&&(b=j.length+b+w.length,b>c[m]&&(c[m]=b),y[m]=b),h[m]=v}o.splice(1,0,h),l.splice(1,0,y),u=-1;const x=[];for(;++u<o.length;){const g=o[u],j=l[u];m=-1;const w=[];for(;++m<d;){const b=g[m]||"";let v="",C="";if(n.alignDelimiters!==!1){const _=c[m]-(j[m]||0),S=a[m];S===114?v=" ".repeat(_):S===99?_%2?(v=" ".repeat(_/2+.5),C=" ".repeat(_/2-.5)):(v=" ".repeat(_/2),C=v):C=" ".repeat(_)}n.delimiterStart!==!1&&!m&&w.push("|"),n.padding!==!1&&!(n.alignDelimiters===!1&&b==="")&&(n.delimiterStart!==!1||m)&&w.push(" "),n.alignDelimiters!==!1&&w.push(v),w.push(b),n.alignDelimiters!==!1&&w.push(C),n.padding!==!1&&w.push(" "),(n.delimiterEnd!==!1||m!==d-1)&&w.push("|")}x.push(n.delimiterEnd===!1?w.join("").replace(/ +$/,""):w.join(""))}return x.join(`
`)}function m0(t){return t==null?"":String(t)}function lu(t){const s=typeof t=="string"?t.codePointAt(0):0;return s===67||s===99?99:s===76||s===108?108:s===82||s===114?114:0}function h0(t,s,n,i){const r=n.enter("blockquote"),a=n.createTracker(i);a.move("> "),a.shift(2);const o=n.indentLines(n.containerFlow(t,a.current()),p0);return r(),o}function p0(t,s,n){return">"+(n?"":" ")+t}function f0(t,s){return cu(t,s.inConstruct,!0)&&!cu(t,s.notInConstruct,!1)}function cu(t,s,n){if(typeof s=="string"&&(s=[s]),!s||s.length===0)return n;let i=-1;for(;++i<s.length;)if(t.includes(s[i]))return!0;return!1}function du(t,s,n,i){let r=-1;for(;++r<n.unsafe.length;)if(n.unsafe[r].character===`
`&&f0(n.stack,n.unsafe[r]))return/[ \t]/.test(i.before)?"":" ";return`\\
`}function x0(t,s){const n=String(t);let i=n.indexOf(s),r=i,a=0,o=0;if(typeof s!="string")throw new TypeError("Expected substring");for(;i!==-1;)i===r?++a>o&&(o=a):a=1,r=i+s.length,i=n.indexOf(s,r);return o}function g0(t,s){return!!(s.options.fences===!1&&t.value&&!t.lang&&/[^ \r\n]/.test(t.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(t.value))}function j0(t){const s=t.options.fence||"`";if(s!=="`"&&s!=="~")throw new Error("Cannot serialize code with `"+s+"` for `options.fence`, expected `` ` `` or `~`");return s}function y0(t,s,n,i){const r=j0(n),a=t.value||"",o=r==="`"?"GraveAccent":"Tilde";if(g0(t,n)){const m=n.enter("codeIndented"),h=n.indentLines(a,w0);return m(),h}const l=n.createTracker(i),c=r.repeat(Math.max(x0(a,r)+1,3)),d=n.enter("codeFenced");let u=l.move(c);if(t.lang){const m=n.enter(`codeFencedLang${o}`);u+=l.move(n.safe(t.lang,{before:u,after:" ",encode:["`"],...l.current()})),m()}if(t.lang&&t.meta){const m=n.enter(`codeFencedMeta${o}`);u+=l.move(" "),u+=l.move(n.safe(t.meta,{before:u,after:`
`,encode:["`"],...l.current()})),m()}return u+=l.move(`
`),a&&(u+=l.move(a+`
`)),u+=l.move(c),d(),u}function w0(t,s,n){return(n?"":"    ")+t}function wc(t){const s=t.options.quote||'"';if(s!=='"'&&s!=="'")throw new Error("Cannot serialize title with `"+s+"` for `options.quote`, expected `\"`, or `'`");return s}function b0(t,s,n,i){const r=wc(n),a=r==='"'?"Quote":"Apostrophe",o=n.enter("definition");let l=n.enter("label");const c=n.createTracker(i);let d=c.move("[");return d+=c.move(n.safe(n.associationId(t),{before:d,after:"]",...c.current()})),d+=c.move("]: "),l(),!t.url||/[\0- \u007F]/.test(t.url)?(l=n.enter("destinationLiteral"),d+=c.move("<"),d+=c.move(n.safe(t.url,{before:d,after:">",...c.current()})),d+=c.move(">")):(l=n.enter("destinationRaw"),d+=c.move(n.safe(t.url,{before:d,after:t.title?" ":`
`,...c.current()}))),l(),t.title&&(l=n.enter(`title${a}`),d+=c.move(" "+r),d+=c.move(n.safe(t.title,{before:d,after:r,...c.current()})),d+=c.move(r),l()),o(),d}function v0(t){const s=t.options.emphasis||"*";if(s!=="*"&&s!=="_")throw new Error("Cannot serialize emphasis with `"+s+"` for `options.emphasis`, expected `*`, or `_`");return s}function yr(t){return"&#x"+t.toString(16).toUpperCase()+";"}function Ta(t,s,n){const i=za(t),r=za(s);return i===void 0?r===void 0?n==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:r===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:i===1?r===void 0?{inside:!1,outside:!1}:r===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:r===void 0?{inside:!1,outside:!1}:r===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}Ep.peek=N0;function Ep(t,s,n,i){const r=v0(n),a=n.enter("emphasis"),o=n.createTracker(i),l=o.move(r);let c=o.move(n.containerPhrasing(t,{after:r,before:l,...o.current()}));const d=c.charCodeAt(0),u=Ta(i.before.charCodeAt(i.before.length-1),d,r);u.inside&&(c=yr(d)+c.slice(1));const m=c.charCodeAt(c.length-1),h=Ta(i.after.charCodeAt(0),m,r);h.inside&&(c=c.slice(0,-1)+yr(m));const y=o.move(r);return a(),n.attentionEncodeSurroundingInfo={after:h.outside,before:u.outside},l+c+y}function N0(t,s,n){return n.options.emphasis||"*"}function k0(t,s){let n=!1;return Gy(t,function(i){if("value"in i&&/\r?\n|\r/.test(i.value)||i.type==="break")return n=!0,Zy}),!!((!t.depth||t.depth<3)&&Hh(t)&&(s.options.setext||n))}function z0(t,s,n,i){const r=Math.max(Math.min(6,t.depth||1),1),a=n.createTracker(i);if(k0(t,n)){const u=n.enter("headingSetext"),m=n.enter("phrasing"),h=n.containerPhrasing(t,{...a.current(),before:`
`,after:`
`});return m(),u(),h+`
`+(r===1?"=":"-").repeat(h.length-(Math.max(h.lastIndexOf("\r"),h.lastIndexOf(`
`))+1))}const o="#".repeat(r),l=n.enter("headingAtx"),c=n.enter("phrasing");a.move(o+" ");let d=n.containerPhrasing(t,{before:"# ",after:`
`,...a.current()});return/^[\t ]/.test(d)&&(d=yr(d.charCodeAt(0))+d.slice(1)),d=d?o+" "+d:o,n.options.closeAtx&&(d+=" "+o),c(),l(),d}Rp.peek=S0;function Rp(t){return t.value||""}function S0(){return"<"}Lp.peek=C0;function Lp(t,s,n,i){const r=wc(n),a=r==='"'?"Quote":"Apostrophe",o=n.enter("image");let l=n.enter("label");const c=n.createTracker(i);let d=c.move("![");return d+=c.move(n.safe(t.alt,{before:d,after:"]",...c.current()})),d+=c.move("]("),l(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(l=n.enter("destinationLiteral"),d+=c.move("<"),d+=c.move(n.safe(t.url,{before:d,after:">",...c.current()})),d+=c.move(">")):(l=n.enter("destinationRaw"),d+=c.move(n.safe(t.url,{before:d,after:t.title?" ":")",...c.current()}))),l(),t.title&&(l=n.enter(`title${a}`),d+=c.move(" "+r),d+=c.move(n.safe(t.title,{before:d,after:r,...c.current()})),d+=c.move(r),l()),d+=c.move(")"),o(),d}function C0(){return"!"}Op.peek=_0;function Op(t,s,n,i){const r=t.referenceType,a=n.enter("imageReference");let o=n.enter("label");const l=n.createTracker(i);let c=l.move("![");const d=n.safe(t.alt,{before:c,after:"]",...l.current()});c+=l.move(d+"]["),o();const u=n.stack;n.stack=[],o=n.enter("reference");const m=n.safe(n.associationId(t),{before:c,after:"]",...l.current()});return o(),n.stack=u,a(),r==="full"||!d||d!==m?c+=l.move(m+"]"):r==="shortcut"?c=c.slice(0,-1):c+=l.move("]"),c}function _0(){return"!"}$p.peek=T0;function $p(t,s,n){let i=t.value||"",r="`",a=-1;for(;new RegExp("(^|[^`])"+r+"([^`]|$)").test(i);)r+="`";for(/[^ \r\n]/.test(i)&&(/^[ \r\n]/.test(i)&&/[ \r\n]$/.test(i)||/^`|`$/.test(i))&&(i=" "+i+" ");++a<n.unsafe.length;){const o=n.unsafe[a],l=n.compilePattern(o);let c;if(o.atBreak)for(;c=l.exec(i);){let d=c.index;i.charCodeAt(d)===10&&i.charCodeAt(d-1)===13&&d--,i=i.slice(0,d)+" "+i.slice(c.index+1)}}return r+i+r}function T0(){return"`"}function Fp(t,s){const n=Hh(t);return!!(!s.options.resourceLink&&t.url&&!t.title&&t.children&&t.children.length===1&&t.children[0].type==="text"&&(n===t.url||"mailto:"+n===t.url)&&/^[a-z][a-z+.-]+:/i.test(t.url)&&!/[\0- <>\u007F]/.test(t.url))}qp.peek=A0;function qp(t,s,n,i){const r=wc(n),a=r==='"'?"Quote":"Apostrophe",o=n.createTracker(i);let l,c;if(Fp(t,n)){const u=n.stack;n.stack=[],l=n.enter("autolink");let m=o.move("<");return m+=o.move(n.containerPhrasing(t,{before:m,after:">",...o.current()})),m+=o.move(">"),l(),n.stack=u,m}l=n.enter("link"),c=n.enter("label");let d=o.move("[");return d+=o.move(n.containerPhrasing(t,{before:d,after:"](",...o.current()})),d+=o.move("]("),c(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(c=n.enter("destinationLiteral"),d+=o.move("<"),d+=o.move(n.safe(t.url,{before:d,after:">",...o.current()})),d+=o.move(">")):(c=n.enter("destinationRaw"),d+=o.move(n.safe(t.url,{before:d,after:t.title?" ":")",...o.current()}))),c(),t.title&&(c=n.enter(`title${a}`),d+=o.move(" "+r),d+=o.move(n.safe(t.title,{before:d,after:r,...o.current()})),d+=o.move(r),c()),d+=o.move(")"),l(),d}function A0(t,s,n){return Fp(t,n)?"<":"["}Bp.peek=D0;function Bp(t,s,n,i){const r=t.referenceType,a=n.enter("linkReference");let o=n.enter("label");const l=n.createTracker(i);let c=l.move("[");const d=n.containerPhrasing(t,{before:c,after:"]",...l.current()});c+=l.move(d+"]["),o();const u=n.stack;n.stack=[],o=n.enter("reference");const m=n.safe(n.associationId(t),{before:c,after:"]",...l.current()});return o(),n.stack=u,a(),r==="full"||!d||d!==m?c+=l.move(m+"]"):r==="shortcut"?c=c.slice(0,-1):c+=l.move("]"),c}function D0(){return"["}function bc(t){const s=t.options.bullet||"*";if(s!=="*"&&s!=="+"&&s!=="-")throw new Error("Cannot serialize items with `"+s+"` for `options.bullet`, expected `*`, `+`, or `-`");return s}function P0(t){const s=bc(t),n=t.options.bulletOther;if(!n)return s==="*"?"-":"*";if(n!=="*"&&n!=="+"&&n!=="-")throw new Error("Cannot serialize items with `"+n+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(n===s)throw new Error("Expected `bullet` (`"+s+"`) and `bulletOther` (`"+n+"`) to be different");return n}function M0(t){const s=t.options.bulletOrdered||".";if(s!=="."&&s!==")")throw new Error("Cannot serialize items with `"+s+"` for `options.bulletOrdered`, expected `.` or `)`");return s}function Up(t){const s=t.options.rule||"*";if(s!=="*"&&s!=="-"&&s!=="_")throw new Error("Cannot serialize rules with `"+s+"` for `options.rule`, expected `*`, `-`, or `_`");return s}function I0(t,s,n,i){const r=n.enter("list"),a=n.bulletCurrent;let o=t.ordered?M0(n):bc(n);const l=t.ordered?o==="."?")":".":P0(n);let c=s&&n.bulletLastUsed?o===n.bulletLastUsed:!1;if(!t.ordered){const u=t.children?t.children[0]:void 0;if((o==="*"||o==="-")&&u&&(!u.children||!u.children[0])&&n.stack[n.stack.length-1]==="list"&&n.stack[n.stack.length-2]==="listItem"&&n.stack[n.stack.length-3]==="list"&&n.stack[n.stack.length-4]==="listItem"&&n.indexStack[n.indexStack.length-1]===0&&n.indexStack[n.indexStack.length-2]===0&&n.indexStack[n.indexStack.length-3]===0&&(c=!0),Up(n)===o&&u){let m=-1;for(;++m<t.children.length;){const h=t.children[m];if(h&&h.type==="listItem"&&h.children&&h.children[0]&&h.children[0].type==="thematicBreak"){c=!0;break}}}}c&&(o=l),n.bulletCurrent=o;const d=n.containerFlow(t,i);return n.bulletLastUsed=o,n.bulletCurrent=a,r(),d}function E0(t){const s=t.options.listItemIndent||"one";if(s!=="tab"&&s!=="one"&&s!=="mixed")throw new Error("Cannot serialize items with `"+s+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return s}function R0(t,s,n,i){const r=E0(n);let a=n.bulletCurrent||bc(n);s&&s.type==="list"&&s.ordered&&(a=(typeof s.start=="number"&&s.start>-1?s.start:1)+(n.options.incrementListMarker===!1?0:s.children.indexOf(t))+a);let o=a.length+1;(r==="tab"||r==="mixed"&&(s&&s.type==="list"&&s.spread||t.spread))&&(o=Math.ceil(o/4)*4);const l=n.createTracker(i);l.move(a+" ".repeat(o-a.length)),l.shift(o);const c=n.enter("listItem"),d=n.indentLines(n.containerFlow(t,l.current()),u);return c(),d;function u(m,h,y){return h?(y?"":" ".repeat(o))+m:(y?a:a+" ".repeat(o-a.length))+m}}function L0(t,s,n,i){const r=n.enter("paragraph"),a=n.enter("phrasing"),o=n.containerPhrasing(t,i);return a(),r(),o}const O0=Zh(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function $0(t,s,n,i){return(t.children.some(function(o){return O0(o)})?n.containerPhrasing:n.containerFlow).call(n,t,i)}function F0(t){const s=t.options.strong||"*";if(s!=="*"&&s!=="_")throw new Error("Cannot serialize strong with `"+s+"` for `options.strong`, expected `*`, or `_`");return s}Vp.peek=q0;function Vp(t,s,n,i){const r=F0(n),a=n.enter("strong"),o=n.createTracker(i),l=o.move(r+r);let c=o.move(n.containerPhrasing(t,{after:r,before:l,...o.current()}));const d=c.charCodeAt(0),u=Ta(i.before.charCodeAt(i.before.length-1),d,r);u.inside&&(c=yr(d)+c.slice(1));const m=c.charCodeAt(c.length-1),h=Ta(i.after.charCodeAt(0),m,r);h.inside&&(c=c.slice(0,-1)+yr(m));const y=o.move(r+r);return a(),n.attentionEncodeSurroundingInfo={after:h.outside,before:u.outside},l+c+y}function q0(t,s,n){return n.options.strong||"*"}function B0(t,s,n,i){return n.safe(t.value,i)}function U0(t){const s=t.options.ruleRepetition||3;if(s<3)throw new Error("Cannot serialize rules with repetition `"+s+"` for `options.ruleRepetition`, expected `3` or more");return s}function V0(t,s,n){const i=(Up(n)+(n.options.ruleSpaces?" ":"")).repeat(U0(n));return n.options.ruleSpaces?i.slice(0,-1):i}const Kp={blockquote:h0,break:du,code:y0,definition:b0,emphasis:Ep,hardBreak:du,heading:z0,html:Rp,image:Lp,imageReference:Op,inlineCode:$p,link:qp,linkReference:Bp,list:I0,listItem:R0,paragraph:L0,root:$0,strong:Vp,text:B0,thematicBreak:V0};function K0(){return{enter:{table:W0,tableData:uu,tableHeader:uu,tableRow:Z0},exit:{codeText:H0,table:G0,tableData:Vo,tableHeader:Vo,tableRow:Vo}}}function W0(t){const s=t._align;this.enter({type:"table",align:s.map(function(n){return n==="none"?null:n}),children:[]},t),this.data.inTable=!0}function G0(t){this.exit(t),this.data.inTable=void 0}function Z0(t){this.enter({type:"tableRow",children:[]},t)}function Vo(t){this.exit(t)}function uu(t){this.enter({type:"tableCell",children:[]},t)}function H0(t){let s=this.resume();this.data.inTable&&(s=s.replace(/\\([\\|])/g,Q0));const n=this.stack[this.stack.length-1];Ci(n.type==="inlineCode"),n.value=s,this.exit(t)}function Q0(t,s){return s==="|"?s:t}function Y0(t){const s=t||{},n=s.tableCellPadding,i=s.tablePipeAlign,r=s.stringLength,a=n?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:`
`,inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[	 :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{inlineCode:h,table:o,tableCell:c,tableRow:l}};function o(y,x,g,j){return d(u(y,g,j),y.align)}function l(y,x,g,j){const w=m(y,g,j),b=d([w]);return b.slice(0,b.indexOf(`
`))}function c(y,x,g,j){const w=g.enter("tableCell"),b=g.enter("phrasing"),v=g.containerPhrasing(y,{...j,before:a,after:a});return b(),w(),v}function d(y,x){return u0(y,{align:x,alignDelimiters:i,padding:n,stringLength:r})}function u(y,x,g){const j=y.children;let w=-1;const b=[],v=x.enter("table");for(;++w<j.length;)b[w]=m(j[w],x,g);return v(),b}function m(y,x,g){const j=y.children;let w=-1;const b=[],v=x.enter("tableRow");for(;++w<j.length;)b[w]=c(j[w],y,x,g);return v(),b}function h(y,x,g){let j=Kp.inlineCode(y,x,g);return g.stack.includes("tableCell")&&(j=j.replace(/\|/g,"\\$&")),j}}function J0(){return{exit:{taskListCheckValueChecked:mu,taskListCheckValueUnchecked:mu,paragraph:eN}}}function X0(){return{unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:tN}}}function mu(t){const s=this.stack[this.stack.length-2];Ci(s.type==="listItem"),s.checked=t.type==="taskListCheckValueChecked"}function eN(t){const s=this.stack[this.stack.length-2];if(s&&s.type==="listItem"&&typeof s.checked=="boolean"){const n=this.stack[this.stack.length-1];Ci(n.type==="paragraph");const i=n.children[0];if(i&&i.type==="text"){const r=s.children;let a=-1,o;for(;++a<r.length;){const l=r[a];if(l.type==="paragraph"){o=l;break}}o===n&&(i.value=i.value.slice(1),i.value.length===0?n.children.shift():n.position&&i.position&&typeof i.position.start.offset=="number"&&(i.position.start.column++,i.position.start.offset++,n.position.start=Object.assign({},i.position.start)))}}this.exit(t)}function tN(t,s,n,i){const r=t.children[0],a=typeof t.checked=="boolean"&&r&&r.type==="paragraph",o="["+(t.checked?"x":" ")+"] ",l=n.createTracker(i);a&&l.move(o);let c=Kp.listItem(t,s,n,{...i,...l.current()});return a&&(c=c.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,d)),c;function d(u){return u+o}}function sN(){return[Iv(),t0(),r0(),K0(),J0()]}function nN(t){return{extensions:[Ev(),s0(t),a0(),Y0(t),X0()]}}const iN={tokenize:dN,partial:!0},Wp={tokenize:uN,partial:!0},Gp={tokenize:mN,partial:!0},Zp={tokenize:hN,partial:!0},rN={tokenize:pN,partial:!0},Hp={name:"wwwAutolink",tokenize:lN,previous:Yp},Qp={name:"protocolAutolink",tokenize:cN,previous:Jp},Fs={name:"emailAutolink",tokenize:oN,previous:Xp},zs={};function aN(){return{text:zs}}let fn=48;for(;fn<123;)zs[fn]=Fs,fn++,fn===58?fn=65:fn===91&&(fn=97);zs[43]=Fs;zs[45]=Fs;zs[46]=Fs;zs[95]=Fs;zs[72]=[Fs,Qp];zs[104]=[Fs,Qp];zs[87]=[Fs,Hp];zs[119]=[Fs,Hp];function oN(t,s,n){const i=this;let r,a;return o;function o(m){return!Nl(m)||!Xp.call(i,i.previous)||vc(i.events)?n(m):(t.enter("literalAutolink"),t.enter("literalAutolinkEmail"),l(m))}function l(m){return Nl(m)?(t.consume(m),l):m===64?(t.consume(m),c):n(m)}function c(m){return m===46?t.check(rN,u,d)(m):m===45||m===95||lc(m)?(a=!0,t.consume(m),c):u(m)}function d(m){return t.consume(m),r=!0,c}function u(m){return a&&r&&mr(i.previous)?(t.exit("literalAutolinkEmail"),t.exit("literalAutolink"),s(m)):n(m)}}function lN(t,s,n){const i=this;return r;function r(o){return o!==87&&o!==119||!Yp.call(i,i.previous)||vc(i.events)?n(o):(t.enter("literalAutolink"),t.enter("literalAutolinkWww"),t.check(iN,t.attempt(Wp,t.attempt(Gp,a),n),n)(o))}function a(o){return t.exit("literalAutolinkWww"),t.exit("literalAutolink"),s(o)}}function cN(t,s,n){const i=this;let r="",a=!1;return o;function o(m){return(m===72||m===104)&&Jp.call(i,i.previous)&&!vc(i.events)?(t.enter("literalAutolink"),t.enter("literalAutolinkHttp"),r+=String.fromCodePoint(m),t.consume(m),l):n(m)}function l(m){if(mr(m)&&r.length<5)return r+=String.fromCodePoint(m),t.consume(m),l;if(m===58){const h=r.toLowerCase();if(h==="http"||h==="https")return t.consume(m),c}return n(m)}function c(m){return m===47?(t.consume(m),a?d:(a=!0,c)):n(m)}function d(m){return m===null||Hy(m)||Ot(m)||fi(m)||oc(m)?n(m):t.attempt(Wp,t.attempt(Gp,u),n)(m)}function u(m){return t.exit("literalAutolinkHttp"),t.exit("literalAutolink"),s(m)}}function dN(t,s,n){let i=0;return r;function r(o){return(o===87||o===119)&&i<3?(i++,t.consume(o),r):o===46&&i===3?(t.consume(o),a):n(o)}function a(o){return o===null?n(o):s(o)}}function uN(t,s,n){let i,r,a;return o;function o(d){return d===46||d===95?t.check(Zp,c,l)(d):d===null||Ot(d)||fi(d)||d!==45&&oc(d)?c(d):(a=!0,t.consume(d),o)}function l(d){return d===95?i=!0:(r=i,i=void 0),t.consume(d),o}function c(d){return r||i||!a?n(d):s(d)}}function mN(t,s){let n=0,i=0;return r;function r(o){return o===40?(n++,t.consume(o),r):o===41&&i<n?a(o):o===33||o===34||o===38||o===39||o===41||o===42||o===44||o===46||o===58||o===59||o===60||o===63||o===93||o===95||o===126?t.check(Zp,s,a)(o):o===null||Ot(o)||fi(o)?s(o):(t.consume(o),r)}function a(o){return o===41&&i++,t.consume(o),r}}function hN(t,s,n){return i;function i(l){return l===33||l===34||l===39||l===41||l===42||l===44||l===46||l===58||l===59||l===63||l===95||l===126?(t.consume(l),i):l===38?(t.consume(l),a):l===93?(t.consume(l),r):l===60||l===null||Ot(l)||fi(l)?s(l):n(l)}function r(l){return l===null||l===40||l===91||Ot(l)||fi(l)?s(l):i(l)}function a(l){return mr(l)?o(l):n(l)}function o(l){return l===59?(t.consume(l),i):mr(l)?(t.consume(l),o):n(l)}}function pN(t,s,n){return i;function i(a){return t.consume(a),r}function r(a){return lc(a)?n(a):s(a)}}function Yp(t){return t===null||t===40||t===42||t===95||t===91||t===93||t===126||Ot(t)}function Jp(t){return!mr(t)}function Xp(t){return!(t===47||Nl(t))}function Nl(t){return t===43||t===45||t===46||t===95||lc(t)}function vc(t){let s=t.length,n=!1;for(;s--;){const i=t[s][1];if((i.type==="labelLink"||i.type==="labelImage")&&!i._balanced){n=!0;break}if(i._gfmAutolinkLiteralWalkedInto){n=!1;break}}return t.length>0&&!n&&(t[t.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),n}const fN={tokenize:NN,partial:!0};function xN(){return{document:{91:{name:"gfmFootnoteDefinition",tokenize:wN,continuation:{tokenize:bN},exit:vN}},text:{91:{name:"gfmFootnoteCall",tokenize:yN},93:{name:"gfmPotentialFootnoteCall",add:"after",tokenize:gN,resolveTo:jN}}}}function gN(t,s,n){const i=this;let r=i.events.length;const a=i.parser.gfmFootnotes||(i.parser.gfmFootnotes=[]);let o;for(;r--;){const c=i.events[r][1];if(c.type==="labelImage"){o=c;break}if(c.type==="gfmFootnoteCall"||c.type==="labelLink"||c.type==="label"||c.type==="image"||c.type==="link")break}return l;function l(c){if(!o||!o._balanced)return n(c);const d=Rr(i.sliceSerialize({start:o.end,end:i.now()}));return d.codePointAt(0)!==94||!a.includes(d.slice(1))?n(c):(t.enter("gfmFootnoteCallLabelMarker"),t.consume(c),t.exit("gfmFootnoteCallLabelMarker"),s(c))}}function jN(t,s){let n=t.length;for(;n--;)if(t[n][1].type==="labelImage"&&t[n][0]==="enter"){t[n][1];break}t[n+1][1].type="data",t[n+3][1].type="gfmFootnoteCallLabelMarker";const i={type:"gfmFootnoteCall",start:Object.assign({},t[n+3][1].start),end:Object.assign({},t[t.length-1][1].end)},r={type:"gfmFootnoteCallMarker",start:Object.assign({},t[n+3][1].end),end:Object.assign({},t[n+3][1].end)};r.end.column++,r.end.offset++,r.end._bufferIndex++;const a={type:"gfmFootnoteCallString",start:Object.assign({},r.end),end:Object.assign({},t[t.length-1][1].start)},o={type:"chunkString",contentType:"string",start:Object.assign({},a.start),end:Object.assign({},a.end)},l=[t[n+1],t[n+2],["enter",i,s],t[n+3],t[n+4],["enter",r,s],["exit",r,s],["enter",a,s],["enter",o,s],["exit",o,s],["exit",a,s],t[t.length-2],t[t.length-1],["exit",i,s]];return t.splice(n,t.length-n+1,...l),t}function yN(t,s,n){const i=this,r=i.parser.gfmFootnotes||(i.parser.gfmFootnotes=[]);let a=0,o;return l;function l(m){return t.enter("gfmFootnoteCall"),t.enter("gfmFootnoteCallLabelMarker"),t.consume(m),t.exit("gfmFootnoteCallLabelMarker"),c}function c(m){return m!==94?n(m):(t.enter("gfmFootnoteCallMarker"),t.consume(m),t.exit("gfmFootnoteCallMarker"),t.enter("gfmFootnoteCallString"),t.enter("chunkString").contentType="string",d)}function d(m){if(a>999||m===93&&!o||m===null||m===91||Ot(m))return n(m);if(m===93){t.exit("chunkString");const h=t.exit("gfmFootnoteCallString");return r.includes(Rr(i.sliceSerialize(h)))?(t.enter("gfmFootnoteCallLabelMarker"),t.consume(m),t.exit("gfmFootnoteCallLabelMarker"),t.exit("gfmFootnoteCall"),s):n(m)}return Ot(m)||(o=!0),a++,t.consume(m),m===92?u:d}function u(m){return m===91||m===92||m===93?(t.consume(m),a++,d):d(m)}}function wN(t,s,n){const i=this,r=i.parser.gfmFootnotes||(i.parser.gfmFootnotes=[]);let a,o=0,l;return c;function c(x){return t.enter("gfmFootnoteDefinition")._container=!0,t.enter("gfmFootnoteDefinitionLabel"),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(x),t.exit("gfmFootnoteDefinitionLabelMarker"),d}function d(x){return x===94?(t.enter("gfmFootnoteDefinitionMarker"),t.consume(x),t.exit("gfmFootnoteDefinitionMarker"),t.enter("gfmFootnoteDefinitionLabelString"),t.enter("chunkString").contentType="string",u):n(x)}function u(x){if(o>999||x===93&&!l||x===null||x===91||Ot(x))return n(x);if(x===93){t.exit("chunkString");const g=t.exit("gfmFootnoteDefinitionLabelString");return a=Rr(i.sliceSerialize(g)),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(x),t.exit("gfmFootnoteDefinitionLabelMarker"),t.exit("gfmFootnoteDefinitionLabel"),h}return Ot(x)||(l=!0),o++,t.consume(x),x===92?m:u}function m(x){return x===91||x===92||x===93?(t.consume(x),o++,u):u(x)}function h(x){return x===58?(t.enter("definitionMarker"),t.consume(x),t.exit("definitionMarker"),r.includes(a)||r.push(a),Hs(t,y,"gfmFootnoteDefinitionWhitespace")):n(x)}function y(x){return s(x)}}function bN(t,s,n){return t.check(Qy,s,t.attempt(fN,s,n))}function vN(t){t.exit("gfmFootnoteDefinition")}function NN(t,s,n){const i=this;return Hs(t,r,"gfmFootnoteDefinitionIndent",5);function r(a){const o=i.events[i.events.length-1];return o&&o[1].type==="gfmFootnoteDefinitionIndent"&&o[2].sliceSerialize(o[1],!0).length===4?s(a):n(a)}}function kN(t){let n=(t||{}).singleTilde;const i={name:"strikethrough",tokenize:a,resolveAll:r};return n==null&&(n=!0),{text:{126:i},insideSpan:{null:[i]},attentionMarkers:{null:[126]}};function r(o,l){let c=-1;for(;++c<o.length;)if(o[c][0]==="enter"&&o[c][1].type==="strikethroughSequenceTemporary"&&o[c][1]._close){let d=c;for(;d--;)if(o[d][0]==="exit"&&o[d][1].type==="strikethroughSequenceTemporary"&&o[d][1]._open&&o[c][1].end.offset-o[c][1].start.offset===o[d][1].end.offset-o[d][1].start.offset){o[c][1].type="strikethroughSequence",o[d][1].type="strikethroughSequence";const u={type:"strikethrough",start:Object.assign({},o[d][1].start),end:Object.assign({},o[c][1].end)},m={type:"strikethroughText",start:Object.assign({},o[d][1].end),end:Object.assign({},o[c][1].start)},h=[["enter",u,l],["enter",o[d][1],l],["exit",o[d][1],l],["enter",m,l]],y=l.parser.constructs.insideSpan.null;y&&Lo(h,h.length,0,Yy(y,o.slice(d+1,c),l)),Lo(h,h.length,0,[["exit",m,l],["enter",o[c][1],l],["exit",o[c][1],l],["exit",u,l]]),Lo(o,d-1,c-d+3,h),c=d+h.length-2;break}}for(c=-1;++c<o.length;)o[c][1].type==="strikethroughSequenceTemporary"&&(o[c][1].type="data");return o}function a(o,l,c){const d=this.previous,u=this.events;let m=0;return h;function h(x){return d===126&&u[u.length-1][1].type!=="characterEscape"?c(x):(o.enter("strikethroughSequenceTemporary"),y(x))}function y(x){const g=za(d);if(x===126)return m>1?c(x):(o.consume(x),m++,y);if(m<2&&!n)return c(x);const j=o.exit("strikethroughSequenceTemporary"),w=za(x);return j._open=!w||w===2&&!!g,j._close=!g||g===2&&!!w,l(x)}}}class zN{constructor(){this.map=[]}add(s,n,i){SN(this,s,n,i)}consume(s){if(this.map.sort(function(a,o){return a[0]-o[0]}),this.map.length===0)return;let n=this.map.length;const i=[];for(;n>0;)n-=1,i.push(s.slice(this.map[n][0]+this.map[n][1]),this.map[n][2]),s.length=this.map[n][0];i.push(s.slice()),s.length=0;let r=i.pop();for(;r;){for(const a of r)s.push(a);r=i.pop()}this.map.length=0}}function SN(t,s,n,i){let r=0;if(!(n===0&&i.length===0)){for(;r<t.map.length;){if(t.map[r][0]===s){t.map[r][1]+=n,t.map[r][2].push(...i);return}r+=1}t.map.push([s,n,i])}}function CN(t,s){let n=!1;const i=[];for(;s<t.length;){const r=t[s];if(n){if(r[0]==="enter")r[1].type==="tableContent"&&i.push(t[s+1][1].type==="tableDelimiterMarker"?"left":"none");else if(r[1].type==="tableContent"){if(t[s-1][1].type==="tableDelimiterMarker"){const a=i.length-1;i[a]=i[a]==="left"?"center":"right"}}else if(r[1].type==="tableDelimiterRow")break}else r[0]==="enter"&&r[1].type==="tableDelimiterRow"&&(n=!0);s+=1}return i}function _N(){return{flow:{null:{name:"table",tokenize:TN,resolveAll:AN}}}}function TN(t,s,n){const i=this;let r=0,a=0,o;return l;function l(p){let N=i.events.length-1;for(;N>-1;){const P=i.events[N][1].type;if(P==="lineEnding"||P==="linePrefix")N--;else break}const A=N>-1?i.events[N][1].type:null,D=A==="tableHead"||A==="tableRow"?S:c;return D===S&&i.parser.lazy[i.now().line]?n(p):D(p)}function c(p){return t.enter("tableHead"),t.enter("tableRow"),d(p)}function d(p){return p===124||(o=!0,a+=1),u(p)}function u(p){return p===null?n(p):Ji(p)?a>1?(a=0,i.interrupt=!0,t.exit("tableRow"),t.enter("lineEnding"),t.consume(p),t.exit("lineEnding"),y):n(p):Jn(p)?Hs(t,u,"whitespace")(p):(a+=1,o&&(o=!1,r+=1),p===124?(t.enter("tableCellDivider"),t.consume(p),t.exit("tableCellDivider"),o=!0,u):(t.enter("data"),m(p)))}function m(p){return p===null||p===124||Ot(p)?(t.exit("data"),u(p)):(t.consume(p),p===92?h:m)}function h(p){return p===92||p===124?(t.consume(p),m):m(p)}function y(p){return i.interrupt=!1,i.parser.lazy[i.now().line]?n(p):(t.enter("tableDelimiterRow"),o=!1,Jn(p)?Hs(t,x,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(p):x(p))}function x(p){return p===45||p===58?j(p):p===124?(o=!0,t.enter("tableCellDivider"),t.consume(p),t.exit("tableCellDivider"),g):_(p)}function g(p){return Jn(p)?Hs(t,j,"whitespace")(p):j(p)}function j(p){return p===58?(a+=1,o=!0,t.enter("tableDelimiterMarker"),t.consume(p),t.exit("tableDelimiterMarker"),w):p===45?(a+=1,w(p)):p===null||Ji(p)?C(p):_(p)}function w(p){return p===45?(t.enter("tableDelimiterFiller"),b(p)):_(p)}function b(p){return p===45?(t.consume(p),b):p===58?(o=!0,t.exit("tableDelimiterFiller"),t.enter("tableDelimiterMarker"),t.consume(p),t.exit("tableDelimiterMarker"),v):(t.exit("tableDelimiterFiller"),v(p))}function v(p){return Jn(p)?Hs(t,C,"whitespace")(p):C(p)}function C(p){return p===124?x(p):p===null||Ji(p)?!o||r!==a?_(p):(t.exit("tableDelimiterRow"),t.exit("tableHead"),s(p)):_(p)}function _(p){return n(p)}function S(p){return t.enter("tableRow"),z(p)}function z(p){return p===124?(t.enter("tableCellDivider"),t.consume(p),t.exit("tableCellDivider"),z):p===null||Ji(p)?(t.exit("tableRow"),s(p)):Jn(p)?Hs(t,z,"whitespace")(p):(t.enter("data"),k(p))}function k(p){return p===null||p===124||Ot(p)?(t.exit("data"),z(p)):(t.consume(p),p===92?T:k)}function T(p){return p===92||p===124?(t.consume(p),k):k(p)}}function AN(t,s){let n=-1,i=!0,r=0,a=[0,0,0,0],o=[0,0,0,0],l=!1,c=0,d,u,m;const h=new zN;for(;++n<t.length;){const y=t[n],x=y[1];y[0]==="enter"?x.type==="tableHead"?(l=!1,c!==0&&(hu(h,s,c,d,u),u=void 0,c=0),d={type:"table",start:Object.assign({},x.start),end:Object.assign({},x.end)},h.add(n,0,[["enter",d,s]])):x.type==="tableRow"||x.type==="tableDelimiterRow"?(i=!0,m=void 0,a=[0,0,0,0],o=[0,n+1,0,0],l&&(l=!1,u={type:"tableBody",start:Object.assign({},x.start),end:Object.assign({},x.end)},h.add(n,0,[["enter",u,s]])),r=x.type==="tableDelimiterRow"?2:u?3:1):r&&(x.type==="data"||x.type==="tableDelimiterMarker"||x.type==="tableDelimiterFiller")?(i=!1,o[2]===0&&(a[1]!==0&&(o[0]=o[1],m=sa(h,s,a,r,void 0,m),a=[0,0,0,0]),o[2]=n)):x.type==="tableCellDivider"&&(i?i=!1:(a[1]!==0&&(o[0]=o[1],m=sa(h,s,a,r,void 0,m)),a=o,o=[a[1],n,0,0])):x.type==="tableHead"?(l=!0,c=n):x.type==="tableRow"||x.type==="tableDelimiterRow"?(c=n,a[1]!==0?(o[0]=o[1],m=sa(h,s,a,r,n,m)):o[1]!==0&&(m=sa(h,s,o,r,n,m)),r=0):r&&(x.type==="data"||x.type==="tableDelimiterMarker"||x.type==="tableDelimiterFiller")&&(o[3]=n)}for(c!==0&&hu(h,s,c,d,u),h.consume(s.events),n=-1;++n<s.events.length;){const y=s.events[n];y[0]==="enter"&&y[1].type==="table"&&(y[1]._align=CN(s.events,n))}return t}function sa(t,s,n,i,r,a){const o=i===1?"tableHeader":i===2?"tableDelimiter":"tableData",l="tableContent";n[0]!==0&&(a.end=Object.assign({},Xn(s.events,n[0])),t.add(n[0],0,[["exit",a,s]]));const c=Xn(s.events,n[1]);if(a={type:o,start:Object.assign({},c),end:Object.assign({},c)},t.add(n[1],0,[["enter",a,s]]),n[2]!==0){const d=Xn(s.events,n[2]),u=Xn(s.events,n[3]),m={type:l,start:Object.assign({},d),end:Object.assign({},u)};if(t.add(n[2],0,[["enter",m,s]]),i!==2){const h=s.events[n[2]],y=s.events[n[3]];if(h[1].end=Object.assign({},y[1].end),h[1].type="chunkText",h[1].contentType="text",n[3]>n[2]+1){const x=n[2]+1,g=n[3]-n[2]-1;t.add(x,g,[])}}t.add(n[3]+1,0,[["exit",m,s]])}return r!==void 0&&(a.end=Object.assign({},Xn(s.events,r)),t.add(r,0,[["exit",a,s]]),a=void 0),a}function hu(t,s,n,i,r){const a=[],o=Xn(s.events,n);r&&(r.end=Object.assign({},o),a.push(["exit",r,s])),i.end=Object.assign({},o),a.push(["exit",i,s]),t.add(n+1,0,a)}function Xn(t,s){const n=t[s],i=n[0]==="enter"?"start":"end";return n[1][i]}const DN={name:"tasklistCheck",tokenize:MN};function PN(){return{text:{91:DN}}}function MN(t,s,n){const i=this;return r;function r(c){return i.previous!==null||!i._gfmTasklistFirstContentOfListItem?n(c):(t.enter("taskListCheck"),t.enter("taskListCheckMarker"),t.consume(c),t.exit("taskListCheckMarker"),a)}function a(c){return Ot(c)?(t.enter("taskListCheckValueUnchecked"),t.consume(c),t.exit("taskListCheckValueUnchecked"),o):c===88||c===120?(t.enter("taskListCheckValueChecked"),t.consume(c),t.exit("taskListCheckValueChecked"),o):n(c)}function o(c){return c===93?(t.enter("taskListCheckMarker"),t.consume(c),t.exit("taskListCheckMarker"),t.exit("taskListCheck"),l):n(c)}function l(c){return Ji(c)?s(c):Jn(c)?t.check({tokenize:IN},s,n)(c):n(c)}}function IN(t,s,n){return Hs(t,i,"whitespace");function i(r){return r===null?n(r):s(r)}}function EN(t){return Jy([aN(),xN(),kN(t),_N(),PN()])}const RN={};function wi(t){const s=this,n=t||RN,i=s.data(),r=i.micromarkExtensions||(i.micromarkExtensions=[]),a=i.fromMarkdownExtensions||(i.fromMarkdownExtensions=[]),o=i.toMarkdownExtensions||(i.toMarkdownExtensions=[]);r.push(EN(n)),a.push(sN()),o.push(nN(n))}const wr=({content:t,metadata:s,showMetadata:n=!0,height:i="500px"})=>e.jsxs("div",{className:"space-y-4",children:[n&&s&&e.jsxs("div",{className:"grid grid-cols-3 gap-4 p-4 bg-muted rounded-lg",children:[s.duration_min&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[e.jsx(et,{className:"w-4 h-4"}),"Czas trwania"]}),e.jsxs("p",{className:"font-medium",children:[s.duration_min," minut"]})]}),s.position!==void 0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[e.jsx(jw,{className:"w-4 h-4"}),"Pozycja"]}),e.jsx("p",{className:"font-medium",children:s.position})]}),s.created_at&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[e.jsx(js,{className:"w-4 h-4"}),"Utworzono"]}),e.jsx("p",{className:"font-medium",children:new Date(s.created_at).toLocaleDateString("pl-PL")})]}),s.updated_at&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[e.jsx(js,{className:"w-4 h-4"}),"Ostatnia aktualizacja"]}),e.jsx("p",{className:"font-medium",children:new Date(s.updated_at).toLocaleDateString("pl-PL")})]})]}),e.jsx(tt,{className:"rounded-lg border p-4",style:{height:i},children:e.jsx("div",{className:"prose prose-sm max-w-none dark:prose-invert",children:e.jsx(xi,{remarkPlugins:[wi],children:t})})})]}),LN={type:"object",properties:{courseId:{type:"number",required:!0},topicId:{type:"number",required:!0},subject:{type:"string"},level:{type:"string"},isMaturaCourse:{type:"boolean"},alignToCurriculum:{type:"boolean"},defaultDuration:{type:"number"},style:{type:"string"},tone:{type:"string"},includeExercises:{type:"boolean"}}};function ON(){const{registerStep:t,setStepData:s,getStepData:n}=ws(),i=ae(),r=n("em_step1")||{},[a,o]=f.useState({open:!1,material:null});f.useEffect(()=>{t("em_step1",LN),r.subject||s("em_step1",{subject:"Matematyka",level:"podstawowy",isMaturaCourse:!0,alignToCurriculum:!0,style:"notebook",tone:"friendly",includeExercises:!0,defaultDuration:20})},[]);const{data:l}=Z({resource:"courses",sorters:[{field:"created_at",order:"desc"}],pagination:{pageSize:100}}),{data:c,isLoading:d}=Z({resource:"topics",filters:[{field:"course_id",operator:"eq",value:r.courseId||-1}],sorters:[{field:"position",order:"asc"}],pagination:{pageSize:500},queryOptions:{enabled:!!r.courseId}}),u=f.useMemo(()=>(c?.data||[]).map(C=>C.id),[c?.data]),{data:m}=Z({resource:"activities",filters:u.length>0?[{field:"topic_id",operator:"in",value:u},{field:"type",operator:"eq",value:"material"}]:[],sorters:[{field:"position",order:"asc"}],pagination:{pageSize:1e3},meta:{select:"id,topic_id,title,type,position,content,duration_min,created_at,is_published"},queryOptions:{enabled:u.length>0}}),h=f.useMemo(()=>{const C={};if(m?.data)for(const _ of m.data){const S=_.topic_id;C[S]||(C[S]={count:0,materials:[]}),C[S].count++,C[S].materials.push(_)}return C},[m?.data]);f.useEffect(()=>{s("em_step1",{topicId:void 0})},[r.courseId]);const y=f.useMemo(()=>l?.data?.find(C=>C.id===r.courseId),[l?.data,r.courseId]);f.useEffect(()=>{if(!y)return;const _=String(y.level||"").toLowerCase()==="rozszerzony"?"rozszerzony":"podstawowy";s("em_step1",{subject:y.subject||"Matematyka",level:_,isMaturaCourse:!!y.is_exam_course,alignToCurriculum:!!y.is_exam_course})},[y]);const[x,g]=f.useState(""),j=f.useMemo(()=>{const C=c?.data||[];if(!x.trim())return C;const _=x.toLowerCase();return C.filter(S=>String(S.title).toLowerCase().includes(_)||String(S.position).includes(_))},[c?.data,x]),w=f.useMemo(()=>yc(r.subject),[r.subject]),b=!!r.courseId&&!!r.topicId,v=(C,_)=>{_.stopPropagation(),o({open:!0,material:C})};return e.jsxs(H,{children:[e.jsx(ue,{title:"Krok 1",description:"Wyb贸r kursu, tematu i parametr贸w"}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[1.2fr,0.8fr]",children:[e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Kurs i temat"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsx(Ap,{value:r.courseId||null,onChange:C=>s("em_step1",{courseId:C||void 0}),showAlert:!0}),r.courseId&&e.jsxs("div",{className:"rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 border-b bg-muted/40",children:[e.jsx(In,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(Q,{value:x,onChange:C=>g(C.target.value),placeholder:"Filtruj tematy",className:"h-8"})]}),e.jsxs("div",{className:"divide-y",children:[d&&e.jsx("div",{className:"p-3 text-xs text-muted-foreground",children:"adowanie temat贸w"}),!d&&j.length===0&&e.jsx("div",{className:"p-3 text-xs text-muted-foreground",children:x?"Brak wynik贸w dla filtru.":"Ten kurs nie ma jeszcze temat贸w."}),j.map(C=>{const _=h[C.id],S=r.topicId===C.id;return e.jsx("button",{type:"button",onClick:()=>s("em_step1",{topicId:C.id}),className:["w-full text-left p-3 hover:bg-muted/50 transition",S?"bg-blue-50/60 ring-1 ring-blue-200":""].join(" "),children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx("span",{className:"shrink-0 inline-flex items-center justify-center w-5 h-5 rounded-full bg-primary/10 text-xs font-semibold",children:C.position}),e.jsx("span",{className:"truncate",children:C.title}),!C.is_published&&e.jsx(V,{variant:"outline",className:"text-xs shrink-0",children:e.jsx(dn,{className:"w-3 h-3"})})]}),S&&e.jsx("div",{className:"mt-2 ml-7",children:_?.count>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground mb-1",children:[e.jsx(zt,{className:"w-3 h-3"}),e.jsx("span",{children:"Materiay:"}),e.jsx(V,{variant:"secondary",className:"text-xs h-4 px-1",children:_.count})]}),e.jsx("ul",{className:"space-y-0.5 ml-4",children:_.materials.map(z=>e.jsx("li",{className:"text-[11px]",children:e.jsxs("button",{onClick:k=>v(z,k),className:"text-primary/70 hover:text-primary hover:underline inline-flex items-center gap-1 w-full text-left",children:[e.jsx("span",{className:"mr-1",children:""}),e.jsx("span",{className:"truncate flex-1",children:z.title}),e.jsx(Je,{className:"w-3 h-3 opacity-0 hover:opacity-100 transition-opacity flex-shrink-0"})]})},z.id))})]}):e.jsx("div",{className:"text-xs text-muted-foreground/50 italic",children:"Brak materia贸w"})})]}),e.jsx("div",{className:["shrink-0 w-3 h-3 rounded-full border mt-1",S?"bg-blue-500 border-blue-500":"bg-white"].join(" "),"aria-hidden":!0})]})},C.id)})]}),e.jsx("div",{className:"p-2 border-t text-[11px] text-muted-foreground",children:"Kliknij temat aby go wybra i zobaczy wszystkie materiay. Kliknij tytu materiau aby zobaczy podgld."})]})]})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Parametry generowania"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs(ge,{value:r.subject||"Matematyka",onValueChange:C=>s("em_step1",{subject:C}),children:[e.jsx(fe,{children:e.jsx(je,{placeholder:"Przedmiot"})}),e.jsx(xe,{children:jc.map(C=>e.jsx(W,{value:C,children:C},C))})]}),e.jsxs(ge,{value:r.level||"podstawowy",onValueChange:C=>s("em_step1",{level:C}),children:[e.jsx(fe,{children:e.jsx(je,{placeholder:"Poziom"})}),e.jsxs(xe,{children:[e.jsx(W,{value:"podstawowy",children:"Podstawowy"}),e.jsx(W,{value:"rozszerzony",children:"Rozszerzony"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{checked:r.isMaturaCourse||!1,onCheckedChange:C=>s("em_step1",{isMaturaCourse:!!C,alignToCurriculum:C?r.alignToCurriculum:!1})}),e.jsx("span",{className:"text-sm",children:"Kurs maturalny"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{checked:r.alignToCurriculum||!1,onCheckedChange:C=>s("em_step1",{alignToCurriculum:!!C}),disabled:!r.isMaturaCourse}),e.jsx("span",{className:"text-sm",children:"Uwzgldnij najnowsz (2025) podstaw LO (PL)"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-1",children:"Styl"}),e.jsxs(ge,{value:r.style||"notebook",onValueChange:C=>s("em_step1",{style:C}),children:[e.jsx(fe,{children:e.jsx(je,{placeholder:"Wybierz styl"})}),e.jsxs(xe,{children:[e.jsx(W,{value:"notebook",children:"Notatka z lekcji"}),e.jsx(W,{value:"exam",children:"Pod egzamin"}),e.jsx(W,{value:"concise",children:"Zwizy"})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-1",children:"Ton"}),e.jsxs(ge,{value:r.tone||"friendly",onValueChange:C=>s("em_step1",{tone:C}),children:[e.jsx(fe,{children:e.jsx(je,{placeholder:"Ton"})}),e.jsxs(xe,{children:[e.jsx(W,{value:"friendly",children:"Przystpny"}),e.jsx(W,{value:"neutral",children:"Neutralny"}),e.jsx(W,{value:"formal",children:"Formalny"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-1",children:"Domylny czas (min)"}),e.jsx(Q,{type:"number",min:5,value:r.defaultDuration??20,onChange:C=>s("em_step1",{defaultDuration:Number(C.target.value)})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{checked:r.includeExercises??!0,onCheckedChange:C=>s("em_step1",{includeExercises:!!C})}),e.jsx("span",{className:"text-sm",children:"Dodaj mini-wiczenia na kocu"})]}),r.isMaturaCourse&&r.alignToCurriculum&&w&&e.jsxs(he,{children:[e.jsx(cn,{className:"h-4 w-4"}),e.jsxs(pe,{className:"text-xs",children:["Dokument: ",e.jsx("strong",{children:w.label}),w.year?`  ${w.year}`:""]})]}),e.jsxs(M,{disabled:!b,className:"w-full",onClick:()=>i("/admin/educational-material/step2"),children:["Kontynuuj",e.jsx(be,{className:"w-4 h-4 ml-1"})]}),!b&&e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Wybierz kurs i temat aby kontynuowa"})]})]})]}),e.jsx(Cn,{open:a.open,onOpenChange:C=>{C||o({open:!1,material:null})},children:e.jsxs(en,{className:"max-w-4xl max-h-[90vh]",children:[e.jsxs(tn,{children:[e.jsxs(sn,{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-5 h-5"}),a.material?.title]}),e.jsxs(jr,{children:["Podgld materiau  ",a.material?.duration_min||20," min"]})]}),a.material&&e.jsx(wr,{content:a.material.content,metadata:{duration_min:a.material.duration_min,position:a.material.position,created_at:a.material.created_at},showMetadata:!0,height:"500px"})]})})]})}const $N={type:"object",properties:{title:{type:"string",required:!0},duration_min:{type:"number"},content_markdown:{type:"string",required:!0}}},FN={Matematyka:"u偶ywaj wzor贸w matematycznych w blokach kodu, pokazuj kroki rozwizania, dodawaj wykresy ASCII gdzie to mo偶liwe",Angielski:"dodaj tabele z odmian czasownik贸w, przykadowe dialogi, r贸偶nice British/American English",Informatyka:"u偶ywaj blok贸w kodu z komentarzami, pokazuj input/output, best practices",Fizyka:"wyjaniaj wzory krok po kroku, dodawaj jednostki, pokazuj zastosowania praktyczne",Chemia:"r贸wnania reakcji w blokach kodu, zasady bezpieczestwa, przykady z 偶ycia",Biologia:"u偶ywaj analogii do 偶ycia codziennego, pokazuj zale偶noci w ekosystemach",Historia:"dodawaj kontekst czasowy, mapy konceptualne wydarze, ciekawostki",Geografia:"opisuj zjawiska z przykadami regionalnymi, wpyw czowieka na rodowisko",Polski:"analizuj teksty krok po kroku, rodki stylistyczne z przykadami"},qN={podstawowy:"uczniowie 12-16 lat - u偶ywaj prostych analogii z 偶ycia codziennego, gier, social medi贸w, unikaj abstrakcji",rozszerzony:"uczniowie 16-19 lat - mog zrozumie abstrakcje, zainteresowani praktycznymi zastosowaniami i karier"};function BN(){const{getStepData:t,setStepData:s}=ws(),n=ae(),i=t("em_step1"),r=i?.courseId,a=i?.topicId,[o,l]=f.useState(null),[c,d]=f.useState(!1),[u,m]=f.useState(null),[h,y]=f.useState(null),[x,g]=f.useState(!1);f.useEffect(()=>{(!r||!a)&&n("/admin/educational-material/step1")},[r,a,n]);const{data:j}=Z({resource:"topics",filters:[{field:"course_id",operator:"eq",value:r||-1},{field:"id",operator:"eq",value:a||-1}],sorters:[{field:"position",order:"asc"}],pagination:{pageSize:1},queryOptions:{enabled:!!r&&!!a}}),w=f.useMemo(()=>(j?.data||[])[0],[j?.data]),b=f.useMemo(()=>{if(w?.id!=null)return typeof w.id=="string"?Number(w.id):w.id},[w?.id]),v=f.useMemo(()=>w?.position==null?0:typeof w.position=="string"?Number(w.position):w.position,[w?.position]),{data:C}=Xe({resource:"courses",id:String(r||""),meta:{select:"*"},queryOptions:{enabled:!!r}}),_=i?.isMaturaCourse&&i?.alignToCurriculum?yc(i?.subject):null,S=async()=>{if(!w||b==null)return;m(null),y(null),g(!1),d(!0),s("em_step2",{isGenerating:!0});const k=_?`
ZGODNO Z PODSTAW PROGRAMOW:
- Dokument: ${_.label}${_.year?`  ${_.year}`:""}
- Przedmiot: ${i.subject}
Oznacz fragmenty zgodne z wymaganiami tagiem [PP].
      `.trim():"",T=FN[i.subject||""]||"",p=qN[i.level||"podstawowy"]||"",N=`
Jeste dowiadczonym nauczycielem tworzcym anga偶ujcy materia edukacyjny.

KONTEKST:
- Kurs: ${C?.data?.title||"Kurs"}
- Temat lekcji: ${w.title} (lekcja ${v})
- Przedmiot: ${i.subject}
- Poziom: ${i.level} (${p})
- Typ kursu: ${i.isMaturaCourse?"maturalny":"podstawowy"}
- Czas trwania: ${i.defaultDuration??20} minut

${k}

WYMAGANIA PEDAGOGICZNE:
1. Jzyk: ${i.level==="podstawowy"?"prosty, bezporedni, z analogiami do 偶ycia codziennego":"precyzyjny z terminologi fachow, ale wci偶 przystpny"}
2. Ton: ${i.tone==="friendly"?'przyjazny, bezporedni (u偶ywaj "poznamy", "zobaczysz", "odkryjesz")':i.tone==="formal"?"profesjonalny ale przystpny":"neutralny, rzeczowy"}
3. Przedmiot: ${T}

STRUKTURA MATERIAU (zachowaj dokadnie t kolejno):

# [Tytu z elementem przycigajcym uwag - u偶yj kreatywnego sformuowania]

[Akapit wprowadzajcy - 2-3 zdania ${i.tone==="friendly"?"entuzjastyczne":"profesjonalne"}, 
wyjanij dlaczego ten temat jest wa偶ny/ciekawy/przydatny]

##  Cele lekcji
Po tej lekcji bdziesz:
- [Czasownik w formie dokonanej: poznasz/zrozumiesz/nauczysz si - konkretna wiedza]
- [Czasownik w formie dokonanej: potrafisz/zastosujesz - konkretna umiejtno]
- [Czasownik w formie dokonanej: rozr贸偶nisz/przeanalizujesz - konkretne zastosowanie]

##  Kluczowe pojcia

**[Pojcie 1]:** [Definicja prostym jzykiem, max 2 zdania]

**[Pojcie 2]:** [Definicja z mini-przykadem w nawiasie]

**[Pojcie 3]:** [Definicja z odniesieniem do 偶ycia codziennego]

[Dodaj 3-5 poj kluczowych dla tematu]

##  Szczeg贸owe om贸wienie

### [Podtemat 1 - najwa偶niejszy koncept]

[Akapit wyjaniajcy z analogi lub metafor odpowiedni do wieku]

[Jeli to przedmiot cisy, dodaj wz贸r/r贸wnanie/kod:]
\`\`\`
[przykad]
\`\`\`

**Kluczowe zasady:**
- [Zasada 1 z kr贸tkim wyjanieniem]
- [Zasada 2 z przykadem]
- [Zasada 3 - do zapamitania]

**Przykad praktyczny:**
[Opisz konkretn sytuacj gdzie to si stosuje]

### [Podtemat 2 - rozwinicie lub drugi aspekt]

[Wyjanienie z kontekstem praktycznym]

${i.subject==="Angielski"||i.subject==="Matematyka"||i.subject==="Chemia"?`
**Tabela pomocnicza:**
| [Nag贸wek 1] | [Nag贸wek 2] | [Nag贸wek 3] |
|--------------|--------------|--------------|
| [Przykad] | [Przykad] | [Przykad] |
| [Przykad] | [Przykad] | [Przykad] |
| [Przykad] | [Przykad] | [Przykad] |
`:""}

### [Podtemat 3 - zastosowania lub podsumowanie]

[Poczenie wszystkich element贸w w cao]

##  Przykady z 偶ycia

1. **[Sytuacja codzienna]:** [Opis jak temat wystpuje w codziennym 偶yciu ucznia]

2. **[Zastosowanie praktyczne]:** [Gdzie spotkamy to w realnym wiecie/karierze]

3. **[Ciekawostka]:** [Co fascynujcego co zainteresuje uczni贸w w tym wieku]

## 锔 Czste bdy i puapki

 **Bd:** [Opis typowego bdu uczni贸w]
 **Poprawnie:** [Jak zrobi to dobrze z wyjanieniem dlaczego]

${i.includeExercises?`
## 锔 wiczenia do samodzielnej pracy

###  Rozgrzewka (poziom podstawowy)
1. [Proste wiczenie na zrozumienie definicji]
2. [wiczenie na rozpoznawanie]

###  Trening (poziom redni)  
3. [Zadanie wymagajce zastosowania wiedzy]
4. [Zadanie czce r贸偶ne elementy tematu]

###  Wyzwanie (poziom zaawansowany)
5. [Zadanie problemowe lub kreatywne wymagajce mylenia]

 **Wskaz贸wka do zadania 5:** [Podpowied藕 nie zdradzajca rozwizania]
`:""}

##  Podsumowanie

###  Najwa偶niejsze do zapamitania:
- **[Absolutne minimum]** - jeli zapamitasz tylko jedn rzecz
- **[Kluczowa zasada/wz贸r]** - fundament tematu
- **[Praktyczne zastosowanie]** - jak u偶y tej wiedzy

###  Po tej lekcji potrafisz:
- [Konkretna umiejtno 1]
- [Konkretna umiejtno 2]
- [Konkretna umiejtno 3]

${i.isMaturaCourse?`
###  Na maturze:
[Wskaz贸wka jak ten temat pojawia si na egzaminie - typy zada, na co zwr贸ci uwag]
`:""}

---
* Nastpny krok: Ten temat jest fundamentem dla [wska偶 co bdzie dalej]. Jeli go opanujesz, [zachta do dalszej nauki].*

DODATKOWE WYTYCZNE:
- U偶ywaj emoji jako ikon sekcji (max 1-2 na sekcj)
- Formatuj kluczowe terminy **pogrubion czcionk**
- Tw贸rz listy dla przejrzystoci
- Dodawaj tabele gdzie zwikszaj zrozumienie
- Przykady kodu/wzor贸w/r贸wna w blokach \`\`\`
- Proporcje: 40% wyjanienia, 40% przykady, 20% wiczenia
- Dugo: 800-1200 s贸w
- Unikaj ciany tekstu - u偶ywaj akapit贸w, list, tabel

Generuj materia w czystym Markdown. Bd藕 konkretny, praktyczny i anga偶ujcy dla grupy wiekowej ${p}.
    `.trim();try{const A=await On(N,$N),D={topic_id:b,position:v,title:A.title||w.title,duration_min:A.duration_min??i.defaultDuration??20,content_markdown:A.content_markdown};l(D)}catch(A){const D=A?.message?.toString()?.includes("503")||A?.details?.toString()?.includes?.("503")?"Bd komunikacji z Gemini":A?.message||"Nie udao si wygenerowa materiau.";m(D);const P=A?.info??A?.response??{message:A?.message,status:A?.status||A?.statusCode,details:A?.details,hint:A?.hint,raw:A};y(P)}finally{d(!1),s("em_step2",{isGenerating:!1})}},z=()=>{o&&n("/admin/educational-material/step3",{state:{item:o}})};return e.jsxs(H,{children:[e.jsx(ue,{title:"Krok 2",description:"Generowanie materiau edukacyjnego"}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[0.9fr,1.1fr]",children:[e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-5 h-5"}),"Panel generowania"]})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-lg bg-muted p-4 space-y-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Kurs:"})," ",e.jsx("span",{className:"font-medium",children:C?.data?.title||"-"})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Temat:"})," ",e.jsx("span",{className:"font-medium",children:w?`${v}. ${w.title}`:"-"})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx(V,{variant:"outline",children:i.subject}),e.jsx(V,{variant:"outline",children:i.level}),i.isMaturaCourse&&e.jsx(V,{variant:"default",children:"Maturalny"})]})]}),e.jsxs(he,{children:[e.jsx(ye,{className:"h-4 w-4"}),e.jsxs(pe,{className:"text-xs",children:[e.jsx("strong",{children:"Styl:"})," ",i.style==="notebook"?"Notatka z lekcji":i.style==="exam"?"Przygotowanie do egzaminu":"Zwizy",e.jsx("br",{}),e.jsx("strong",{children:"Ton:"})," ",i.tone==="friendly"?"Przyjazny":i.tone==="formal"?"Formalny":"Neutralny",e.jsx("br",{}),e.jsx("strong",{children:"wiczenia:"})," ",i.includeExercises?"Tak (3 poziomy trudnoci)":"Nie"]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(M,{onClick:S,disabled:c,className:"w-full",size:"lg",children:c?e.jsxs(e.Fragment,{children:[e.jsx(Et,{className:"w-4 h-4 mr-2 animate-spin"}),"Generowanie materiau..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"}),"Wygeneruj materia wysokiej jakoci"]})}),e.jsxs(M,{variant:"default",onClick:z,disabled:!o||c,className:"w-full",children:["Przejd藕 do zapisu",e.jsx(be,{className:"w-4 h-4 ml-1"})]})]}),u&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(he,{variant:"destructive",children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsx(pe,{children:u})]}),(h?.status||h?.statusCode||(typeof h=="object"&&"error"in h&&h.error?.includes?.("503")?503:void 0))===503?e.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"Wskaz贸wka:"})," Model jest przeci偶ony (HTTP 503). Spr贸buj ponownie za chwil lub zmie model/zmniejsz objto kontekstu."]}):null,h&&e.jsxs(I,{children:[e.jsx(F,{className:"py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx($,{className:"text-sm",children:"Szczeg贸y bdu"}),e.jsx(M,{variant:"ghost",size:"sm",onClick:()=>g(k=>!k),className:"h-7",children:x?e.jsx($t,{className:"w-4 h-4"}):e.jsx(dt,{className:"w-4 h-4"})})]})}),x&&e.jsx(E,{className:"pt-0",children:e.jsx(Xt,{className:"font-mono text-xs h-40",readOnly:!0,value:(()=>{try{return JSON.stringify(h,null,2)}catch{return String(h)}})()})})]})]}),c&&e.jsxs("div",{className:"text-center text-sm text-muted-foreground space-y-1",children:[e.jsx("p",{children:"Tworz anga偶ujcy materia..."}),e.jsx("p",{className:"text-xs",children:"To mo偶e potrwa 20-30 sekund"})]})]})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Podgld materiau"})}),e.jsx(E,{children:o?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mb-3 bg-muted",children:e.jsxs(E,{className:"pt-6",children:[e.jsx("div",{className:"font-semibold",children:o.title}),e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-3 mt-2",children:[e.jsxs("span",{children:["憋 ",o.duration_min??20," min"]}),e.jsxs("span",{children:[" ",o.content_markdown.length," znak贸w"]})]})]})}),e.jsx(tt,{className:"h-[500px] rounded-lg border p-4",children:e.jsx("div",{className:"prose prose-sm max-w-none dark:prose-invert",children:e.jsx(xi,{remarkPlugins:[wi],children:o.content_markdown})})})]}):e.jsx("div",{className:"flex flex-col items-center justify-center py-16 text-muted-foreground",children:c?e.jsxs(e.Fragment,{children:[e.jsx(Et,{className:"w-8 h-8 mb-3 animate-spin"}),e.jsx("div",{className:"text-sm",children:"Generowanie struktury..."}),e.jsx("div",{className:"text-xs mt-2",children:"Dodawanie przykad贸w..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"w-8 h-8 mb-3 opacity-50"}),e.jsx("div",{className:"text-sm",children:"Brak wygenerowanego materiau"}),e.jsx("div",{className:"text-xs mt-1",children:'Kliknij "Wygeneruj materia"'})]})})})]})]})]})}function UN(){const t=ae(),s=Ns(),{mutate:n}=Yt(),i=f.useMemo(()=>s?.state?.item??null,[s?.state?.item]),[r,a]=f.useState(i?.title??""),[o,l]=f.useState(!1),[c,d]=f.useState(!1),[u,m]=f.useState(null),[h,y]=f.useState(null),{data:x}=Z({resource:"activities",filters:i?[{field:"topic_id",operator:"eq",value:i.topic_id}]:[],sorters:[{field:"position",order:"desc"}],pagination:{pageSize:1},queryOptions:{enabled:!!i?.topic_id}});f.useEffect(()=>{i||t("/admin/educational-material/step2")},[i,t]);const g=async()=>{if(i){if(!r||r.trim().length<3){m("Tytu musi mie minimum 3 znaki.");return}if(!i.content_markdown||i.content_markdown.trim().length<50){m("Materia jest zbyt kr贸tki. Wr贸 do kroku 2 i wygeneruj ponownie.");return}d(!0),m(null);try{const j=Number(i.topic_id),w=x?.data?.[0],b=w?.position?Number(w.position)+1:1,v=await new Promise((C,_)=>{n({resource:"activities",values:{topic_id:j,type:"material",title:r.trim(),content:i.content_markdown,duration_min:i.duration_min??20,position:b,is_published:o}},{onSuccess:S=>{const z=S?.data?.id;if(z){const k=typeof z=="string"?parseInt(z,10):z;y(k),C(k)}else _(new Error("Nie otrzymano ID aktywnoci"))},onError:S=>{console.error("Bd zapisu:",S),_(S)}})})}catch(j){console.error("Bd podczas zapisu:",j),j?.code==="23505"?m("Materia o tym tytule ju偶 istnieje w tym temacie. Zmie tytu."):j?.code==="23503"?m("Nieprawidowy temat. Odwie偶 stron i spr贸buj ponownie."):j?.message?m(j.message):m("Nie udao si zapisa materiau. Spr贸buj ponownie."),d(!1)}}};return i?e.jsxs(H,{children:[e.jsx(ue,{title:"Krok 3",description:"Zapis materiau do bazy"}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Ustawienia zapisu"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:["Tytu materiau ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(Q,{value:r,onChange:j=>a(j.target.value),placeholder:"np. Wprowadzenie do tematu",disabled:c||h!==null}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Tytu bdzie widoczny dla uczni贸w"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:"Opublikuj od razu"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Materia bdzie widoczny dla uczni贸w"})]}),e.jsx(qt,{checked:o,onCheckedChange:l,disabled:c||h!==null})]}),u&&e.jsxs(he,{variant:"destructive",children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsx(pe,{children:u})]}),h&&e.jsxs(he,{className:"border-green-200 bg-green-50",children:[e.jsx(Rt,{className:"h-4 w-4 text-green-600"}),e.jsxs(pe,{className:"text-green-900",children:[e.jsx("span",{className:"font-medium",children:"Materia zapisany!"}),e.jsx("br",{}),"ID: ",h,e.jsx("br",{}),e.jsx("span",{className:"text-xs",children:"Mo偶esz teraz doda pytania kontrolne lub przej do podgldu."})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{onClick:g,disabled:c||h!==null||!r.trim(),className:"flex-1",children:c?e.jsxs(e.Fragment,{children:[e.jsx(Rs,{className:"w-4 h-4 mr-2 animate-pulse"}),"Zapisywanie..."]}):h?e.jsxs(e.Fragment,{children:[e.jsx(Rt,{className:"w-4 h-4 mr-2"}),"Zapisano!"]}):e.jsxs(e.Fragment,{children:[e.jsx(Rs,{className:"w-4 h-4 mr-2"}),"Zapisz materia"]})}),e.jsx(M,{asChild:!0,variant:"outline",disabled:c,children:e.jsxs(Le,{to:"/admin/educational-material/step2",children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Wr贸"]})})]}),h&&e.jsxs("div",{className:"pt-4 border-t space-y-2",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Co dalej?"}),e.jsx(M,{asChild:!0,variant:"default",className:"w-full",children:e.jsxs(Le,{to:"/admin/educational-material/step4",children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Dodaj pytania kontrolne (krok 4)"]})}),e.jsx(M,{asChild:!0,variant:"outline",className:"w-full",children:e.jsx(Le,{to:"/admin/educational-material/step1",children:"Stw贸rz kolejny materia"})})]})]})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Podsumowanie materiau"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"ID Tematu"}),e.jsx("div",{className:"font-medium",children:i.topic_id})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Wygenerowany tytu"}),e.jsx("div",{className:"font-medium",children:i.title})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Czas trwania"}),e.jsxs("div",{className:"font-medium",children:[i.duration_min??20," minut"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Dugo treci"}),e.jsxs("div",{className:"font-medium",children:[i.content_markdown.length," znak贸w"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Pozycja w temacie"}),e.jsx("div",{className:"font-medium",children:x?.data?.[0]?.position?`${Number(x.data[0].position)+1} (po ${x.data.length} istniejcych)`:"1 (pierwszy materia)"})]})]}),e.jsxs(he,{children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsx(pe,{className:"text-xs",children:"Po zapisie materia bdzie dostpny w module aktywnoci. Mo偶esz go p贸藕niej edytowa, doda pytania kontrolne i przypisa do grup uczni贸w."})]})]})]})]})]}):e.jsxs(H,{children:[e.jsx(ue,{title:"Krok 3",description:"Zapis materiau"}),e.jsx(I,{children:e.jsx(E,{className:"pt-6",children:e.jsxs(he,{variant:"destructive",children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsxs(pe,{children:["Brak danych z poprzedniego kroku.",e.jsx(Le,{to:"/admin/educational-material/step2",className:"underline ml-1",children:"Wr贸 do kroku 2"})]})]})})})]})}const Nc=Symbol.for("yaml.alias"),kl=Symbol.for("yaml.document"),Js=Symbol.for("yaml.map"),ef=Symbol.for("yaml.pair"),bs=Symbol.for("yaml.scalar"),Ti=Symbol.for("yaml.seq"),es=Symbol.for("yaml.node.type"),un=t=>!!t&&typeof t=="object"&&t[es]===Nc,$n=t=>!!t&&typeof t=="object"&&t[es]===kl,Ai=t=>!!t&&typeof t=="object"&&t[es]===Js,Ae=t=>!!t&&typeof t=="object"&&t[es]===ef,ke=t=>!!t&&typeof t=="object"&&t[es]===bs,Di=t=>!!t&&typeof t=="object"&&t[es]===Ti;function De(t){if(t&&typeof t=="object")switch(t[es]){case Js:case Ti:return!0}return!1}function Ie(t){if(t&&typeof t=="object")switch(t[es]){case Nc:case Js:case bs:case Ti:return!0}return!1}const tf=t=>(ke(t)||De(t))&&!!t.anchor,vt=Symbol("break visit"),sf=Symbol("skip children"),ps=Symbol("remove node");function Fn(t,s){const n=nf(s);$n(t)?ei(null,t.contents,n,Object.freeze([t]))===ps&&(t.contents=null):ei(null,t,n,Object.freeze([]))}Fn.BREAK=vt;Fn.SKIP=sf;Fn.REMOVE=ps;function ei(t,s,n,i){const r=rf(t,s,n,i);if(Ie(r)||Ae(r))return af(t,i,r),ei(t,r,n,i);if(typeof r!="symbol"){if(De(s)){i=Object.freeze(i.concat(s));for(let a=0;a<s.items.length;++a){const o=ei(a,s.items[a],n,i);if(typeof o=="number")a=o-1;else{if(o===vt)return vt;o===ps&&(s.items.splice(a,1),a-=1)}}}else if(Ae(s)){i=Object.freeze(i.concat(s));const a=ei("key",s.key,n,i);if(a===vt)return vt;a===ps&&(s.key=null);const o=ei("value",s.value,n,i);if(o===vt)return vt;o===ps&&(s.value=null)}}return r}async function oo(t,s){const n=nf(s);$n(t)?await ti(null,t.contents,n,Object.freeze([t]))===ps&&(t.contents=null):await ti(null,t,n,Object.freeze([]))}oo.BREAK=vt;oo.SKIP=sf;oo.REMOVE=ps;async function ti(t,s,n,i){const r=await rf(t,s,n,i);if(Ie(r)||Ae(r))return af(t,i,r),ti(t,r,n,i);if(typeof r!="symbol"){if(De(s)){i=Object.freeze(i.concat(s));for(let a=0;a<s.items.length;++a){const o=await ti(a,s.items[a],n,i);if(typeof o=="number")a=o-1;else{if(o===vt)return vt;o===ps&&(s.items.splice(a,1),a-=1)}}}else if(Ae(s)){i=Object.freeze(i.concat(s));const a=await ti("key",s.key,n,i);if(a===vt)return vt;a===ps&&(s.key=null);const o=await ti("value",s.value,n,i);if(o===vt)return vt;o===ps&&(s.value=null)}}return r}function nf(t){return typeof t=="object"&&(t.Collection||t.Node||t.Value)?Object.assign({Alias:t.Node,Map:t.Node,Scalar:t.Node,Seq:t.Node},t.Value&&{Map:t.Value,Scalar:t.Value,Seq:t.Value},t.Collection&&{Map:t.Collection,Seq:t.Collection},t):t}function rf(t,s,n,i){if(typeof n=="function")return n(t,s,i);if(Ai(s))return n.Map?.(t,s,i);if(Di(s))return n.Seq?.(t,s,i);if(Ae(s))return n.Pair?.(t,s,i);if(ke(s))return n.Scalar?.(t,s,i);if(un(s))return n.Alias?.(t,s,i)}function af(t,s,n){const i=s[s.length-1];if(De(i))i.items[t]=n;else if(Ae(i))t==="key"?i.key=n:i.value=n;else if($n(i))i.contents=n;else{const r=un(i)?"alias":"scalar";throw new Error(`Cannot replace node with ${r} parent`)}}const VN={"!":"%21",",":"%2C","[":"%5B","]":"%5D","{":"%7B","}":"%7D"},KN=t=>t.replace(/[!,[\]{}]/g,s=>VN[s]);class pt{constructor(s,n){this.docStart=null,this.docEnd=!1,this.yaml=Object.assign({},pt.defaultYaml,s),this.tags=Object.assign({},pt.defaultTags,n)}clone(){const s=new pt(this.yaml,this.tags);return s.docStart=this.docStart,s}atDocument(){const s=new pt(this.yaml,this.tags);switch(this.yaml.version){case"1.1":this.atNextDocument=!0;break;case"1.2":this.atNextDocument=!1,this.yaml={explicit:pt.defaultYaml.explicit,version:"1.2"},this.tags=Object.assign({},pt.defaultTags);break}return s}add(s,n){this.atNextDocument&&(this.yaml={explicit:pt.defaultYaml.explicit,version:"1.1"},this.tags=Object.assign({},pt.defaultTags),this.atNextDocument=!1);const i=s.trim().split(/[ \t]+/),r=i.shift();switch(r){case"%TAG":{if(i.length!==2&&(n(0,"%TAG directive should contain exactly two parts"),i.length<2))return!1;const[a,o]=i;return this.tags[a]=o,!0}case"%YAML":{if(this.yaml.explicit=!0,i.length!==1)return n(0,"%YAML directive should contain exactly one part"),!1;const[a]=i;if(a==="1.1"||a==="1.2")return this.yaml.version=a,!0;{const o=/^\d+\.\d+$/.test(a);return n(6,`Unsupported YAML version ${a}`,o),!1}}default:return n(0,`Unknown directive ${r}`,!0),!1}}tagName(s,n){if(s==="!")return"!";if(s[0]!=="!")return n(`Not a valid tag: ${s}`),null;if(s[1]==="<"){const o=s.slice(2,-1);return o==="!"||o==="!!"?(n(`Verbatim tags aren't resolved, so ${s} is invalid.`),null):(s[s.length-1]!==">"&&n("Verbatim tags must end with a >"),o)}const[,i,r]=s.match(/^(.*!)([^!]*)$/s);r||n(`The ${s} tag has no suffix`);const a=this.tags[i];if(a)try{return a+decodeURIComponent(r)}catch(o){return n(String(o)),null}return i==="!"?s:(n(`Could not resolve tag: ${s}`),null)}tagString(s){for(const[n,i]of Object.entries(this.tags))if(s.startsWith(i))return n+KN(s.substring(i.length));return s[0]==="!"?s:`!<${s}>`}toString(s){const n=this.yaml.explicit?[`%YAML ${this.yaml.version||"1.2"}`]:[],i=Object.entries(this.tags);let r;if(s&&i.length>0&&Ie(s.contents)){const a={};Fn(s.contents,(o,l)=>{Ie(l)&&l.tag&&(a[l.tag]=!0)}),r=Object.keys(a)}else r=[];for(const[a,o]of i)a==="!!"&&o==="tag:yaml.org,2002:"||(!s||r.some(l=>l.startsWith(o)))&&n.push(`%TAG ${a} ${o}`);return n.join(`
`)}}pt.defaultYaml={explicit:!1,version:"1.2"};pt.defaultTags={"!!":"tag:yaml.org,2002:"};function of(t){if(/[\x00-\x19\s,[\]{}]/.test(t)){const n=`Anchor must not contain whitespace or control characters: ${JSON.stringify(t)}`;throw new Error(n)}return!0}function lf(t){const s=new Set;return Fn(t,{Value(n,i){i.anchor&&s.add(i.anchor)}}),s}function cf(t,s){for(let n=1;;++n){const i=`${t}${n}`;if(!s.has(i))return i}}function WN(t,s){const n=[],i=new Map;let r=null;return{onAnchor:a=>{n.push(a),r??(r=lf(t));const o=cf(s,r);return r.add(o),o},setAnchors:()=>{for(const a of n){const o=i.get(a);if(typeof o=="object"&&o.anchor&&(ke(o.node)||De(o.node)))o.node.anchor=o.anchor;else{const l=new Error("Failed to resolve repeated object (this should not happen)");throw l.source=a,l}}},sourceObjects:i}}function si(t,s,n,i){if(i&&typeof i=="object")if(Array.isArray(i))for(let r=0,a=i.length;r<a;++r){const o=i[r],l=si(t,i,String(r),o);l===void 0?delete i[r]:l!==o&&(i[r]=l)}else if(i instanceof Map)for(const r of Array.from(i.keys())){const a=i.get(r),o=si(t,i,r,a);o===void 0?i.delete(r):o!==a&&i.set(r,o)}else if(i instanceof Set)for(const r of Array.from(i)){const a=si(t,i,r,r);a===void 0?i.delete(r):a!==r&&(i.delete(r),i.add(a))}else for(const[r,a]of Object.entries(i)){const o=si(t,i,r,a);o===void 0?delete i[r]:o!==a&&(i[r]=o)}return t.call(s,n,i)}function Zt(t,s,n){if(Array.isArray(t))return t.map((i,r)=>Zt(i,String(r),n));if(t&&typeof t.toJSON=="function"){if(!n||!tf(t))return t.toJSON(s,n);const i={aliasCount:0,count:1,res:void 0};n.anchors.set(t,i),n.onCreate=a=>{i.res=a,delete n.onCreate};const r=t.toJSON(s,n);return n.onCreate&&n.onCreate(r),r}return typeof t=="bigint"&&!n?.keep?Number(t):t}class kc{constructor(s){Object.defineProperty(this,es,{value:s})}clone(){const s=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return this.range&&(s.range=this.range.slice()),s}toJS(s,{mapAsMap:n,maxAliasCount:i,onAnchor:r,reviver:a}={}){if(!$n(s))throw new TypeError("A document argument is required");const o={anchors:new Map,doc:s,keep:!0,mapAsMap:n===!0,mapKeyWarned:!1,maxAliasCount:typeof i=="number"?i:100},l=Zt(this,"",o);if(typeof r=="function")for(const{count:c,res:d}of o.anchors.values())r(d,c);return typeof a=="function"?si(a,{"":l},"",l):l}}class lo extends kc{constructor(s){super(Nc),this.source=s,Object.defineProperty(this,"tag",{set(){throw new Error("Alias nodes cannot have tags")}})}resolve(s,n){let i;n?.aliasResolveCache?i=n.aliasResolveCache:(i=[],Fn(s,{Node:(a,o)=>{(un(o)||tf(o))&&i.push(o)}}),n&&(n.aliasResolveCache=i));let r;for(const a of i){if(a===this)break;a.anchor===this.source&&(r=a)}return r}toJSON(s,n){if(!n)return{source:this.source};const{anchors:i,doc:r,maxAliasCount:a}=n,o=this.resolve(r,n);if(!o){const c=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new ReferenceError(c)}let l=i.get(o);if(l||(Zt(o,null,n),l=i.get(o)),!l||l.res===void 0){const c="This should not happen: Alias anchor was not resolved?";throw new ReferenceError(c)}if(a>=0&&(l.count+=1,l.aliasCount===0&&(l.aliasCount=xa(r,o,i)),l.count*l.aliasCount>a)){const c="Excessive alias count indicates a resource exhaustion attack";throw new ReferenceError(c)}return l.res}toString(s,n,i){const r=`*${this.source}`;if(s){if(of(this.source),s.options.verifyAliasOrder&&!s.anchors.has(this.source)){const a=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new Error(a)}if(s.implicitKey)return`${r} `}return r}}function xa(t,s,n){if(un(s)){const i=s.resolve(t),r=n&&i&&n.get(i);return r?r.count*r.aliasCount:0}else if(De(s)){let i=0;for(const r of s.items){const a=xa(t,r,n);a>i&&(i=a)}return i}else if(Ae(s)){const i=xa(t,s.key,n),r=xa(t,s.value,n);return Math.max(i,r)}return 1}const df=t=>!t||typeof t!="function"&&typeof t!="object";class ne extends kc{constructor(s){super(bs),this.value=s}toJSON(s,n){return n?.keep?this.value:Zt(this.value,s,n)}toString(){return String(this.value)}}ne.BLOCK_FOLDED="BLOCK_FOLDED";ne.BLOCK_LITERAL="BLOCK_LITERAL";ne.PLAIN="PLAIN";ne.QUOTE_DOUBLE="QUOTE_DOUBLE";ne.QUOTE_SINGLE="QUOTE_SINGLE";const GN="tag:yaml.org,2002:";function ZN(t,s,n){if(s){const i=n.filter(a=>a.tag===s),r=i.find(a=>!a.format)??i[0];if(!r)throw new Error(`Tag ${s} not found`);return r}return n.find(i=>i.identify?.(t)&&!i.format)}function br(t,s,n){if($n(t)&&(t=t.contents),Ie(t))return t;if(Ae(t)){const m=n.schema[Js].createNode?.(n.schema,null,n);return m.items.push(t),m}(t instanceof String||t instanceof Number||t instanceof Boolean||typeof BigInt<"u"&&t instanceof BigInt)&&(t=t.valueOf());const{aliasDuplicateObjects:i,onAnchor:r,onTagObj:a,schema:o,sourceObjects:l}=n;let c;if(i&&t&&typeof t=="object"){if(c=l.get(t),c)return c.anchor??(c.anchor=r(t)),new lo(c.anchor);c={anchor:null,node:null},l.set(t,c)}s?.startsWith("!!")&&(s=GN+s.slice(2));let d=ZN(t,s,o.tags);if(!d){if(t&&typeof t.toJSON=="function"&&(t=t.toJSON()),!t||typeof t!="object"){const m=new ne(t);return c&&(c.node=m),m}d=t instanceof Map?o[Js]:Symbol.iterator in Object(t)?o[Ti]:o[Js]}a&&(a(d),delete n.onTagObj);const u=d?.createNode?d.createNode(n.schema,t,n):typeof d?.nodeClass?.from=="function"?d.nodeClass.from(n.schema,t,n):new ne(t);return s?u.tag=s:d.default||(u.tag=d.tag),c&&(c.node=u),u}function Aa(t,s,n){let i=n;for(let r=s.length-1;r>=0;--r){const a=s[r];if(typeof a=="number"&&Number.isInteger(a)&&a>=0){const o=[];o[a]=i,i=o}else i=new Map([[a,i]])}return br(i,void 0,{aliasDuplicateObjects:!1,keepUndefined:!1,onAnchor:()=>{throw new Error("This should not happen, please report a bug.")},schema:t,sourceObjects:new Map})}const Xi=t=>t==null||typeof t=="object"&&!!t[Symbol.iterator]().next().done;let uf=class extends kc{constructor(s,n){super(s),Object.defineProperty(this,"schema",{value:n,configurable:!0,enumerable:!1,writable:!0})}clone(s){const n=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return s&&(n.schema=s),n.items=n.items.map(i=>Ie(i)||Ae(i)?i.clone(s):i),this.range&&(n.range=this.range.slice()),n}addIn(s,n){if(Xi(s))this.add(n);else{const[i,...r]=s,a=this.get(i,!0);if(De(a))a.addIn(r,n);else if(a===void 0&&this.schema)this.set(i,Aa(this.schema,r,n));else throw new Error(`Expected YAML collection at ${i}. Remaining path: ${r}`)}}deleteIn(s){const[n,...i]=s;if(i.length===0)return this.delete(n);const r=this.get(n,!0);if(De(r))return r.deleteIn(i);throw new Error(`Expected YAML collection at ${n}. Remaining path: ${i}`)}getIn(s,n){const[i,...r]=s,a=this.get(i,!0);return r.length===0?!n&&ke(a)?a.value:a:De(a)?a.getIn(r,n):void 0}hasAllNullValues(s){return this.items.every(n=>{if(!Ae(n))return!1;const i=n.value;return i==null||s&&ke(i)&&i.value==null&&!i.commentBefore&&!i.comment&&!i.tag})}hasIn(s){const[n,...i]=s;if(i.length===0)return this.has(n);const r=this.get(n,!0);return De(r)?r.hasIn(i):!1}setIn(s,n){const[i,...r]=s;if(r.length===0)this.set(i,n);else{const a=this.get(i,!0);if(De(a))a.setIn(r,n);else if(a===void 0&&this.schema)this.set(i,Aa(this.schema,r,n));else throw new Error(`Expected YAML collection at ${i}. Remaining path: ${r}`)}}};const HN=t=>t.replace(/^(?!$)(?: $)?/gm,"#");function Ps(t,s){return/^\n+$/.test(t)?t.substring(1):s?t.replace(/^(?! *$)/gm,s):t}const jn=(t,s,n)=>t.endsWith(`
`)?Ps(n,s):n.includes(`
`)?`
`+Ps(n,s):(t.endsWith(" ")?"":" ")+n,mf="flow",zl="block",ga="quoted";function co(t,s,n="flow",{indentAtStart:i,lineWidth:r=80,minContentWidth:a=20,onFold:o,onOverflow:l}={}){if(!r||r<0)return t;r<a&&(a=0);const c=Math.max(1+a,1+r-s.length);if(t.length<=c)return t;const d=[],u={};let m=r-s.length;typeof i=="number"&&(i>r-Math.max(2,a)?d.push(0):m=r-i);let h,y,x=!1,g=-1,j=-1,w=-1;n===zl&&(g=pu(t,g,s.length),g!==-1&&(m=g+c));for(let v;v=t[g+=1];){if(n===ga&&v==="\\"){switch(j=g,t[g+1]){case"x":g+=3;break;case"u":g+=5;break;case"U":g+=9;break;default:g+=1}w=g}if(v===`
`)n===zl&&(g=pu(t,g,s.length)),m=g+s.length+c,h=void 0;else{if(v===" "&&y&&y!==" "&&y!==`
`&&y!=="	"){const C=t[g+1];C&&C!==" "&&C!==`
`&&C!=="	"&&(h=g)}if(g>=m)if(h)d.push(h),m=h+c,h=void 0;else if(n===ga){for(;y===" "||y==="	";)y=v,v=t[g+=1],x=!0;const C=g>w+1?g-2:j-1;if(u[C])return t;d.push(C),u[C]=!0,m=C+c,h=void 0}else x=!0}y=v}if(x&&l&&l(),d.length===0)return t;o&&o();let b=t.slice(0,d[0]);for(let v=0;v<d.length;++v){const C=d[v],_=d[v+1]||t.length;C===0?b=`
${s}${t.slice(0,_)}`:(n===ga&&u[C]&&(b+=`${t[C]}\\`),b+=`
${s}${t.slice(C+1,_)}`)}return b}function pu(t,s,n){let i=s,r=s+1,a=t[r];for(;a===" "||a==="	";)if(s<r+n)a=t[++s];else{do a=t[++s];while(a&&a!==`
`);i=s,r=s+1,a=t[r]}return i}const uo=(t,s)=>({indentAtStart:s?t.indent.length:t.indentAtStart,lineWidth:t.options.lineWidth,minContentWidth:t.options.minContentWidth}),mo=t=>/^(%|---|\.\.\.)/m.test(t);function QN(t,s,n){if(!s||s<0)return!1;const i=s-n,r=t.length;if(r<=i)return!1;for(let a=0,o=0;a<r;++a)if(t[a]===`
`){if(a-o>i)return!0;if(o=a+1,r-o<=i)return!1}return!0}function sr(t,s){const n=JSON.stringify(t);if(s.options.doubleQuotedAsJSON)return n;const{implicitKey:i}=s,r=s.options.doubleQuotedMinMultiLineLength,a=s.indent||(mo(t)?"  ":"");let o="",l=0;for(let c=0,d=n[c];d;d=n[++c])if(d===" "&&n[c+1]==="\\"&&n[c+2]==="n"&&(o+=n.slice(l,c)+"\\ ",c+=1,l=c,d="\\"),d==="\\")switch(n[c+1]){case"u":{o+=n.slice(l,c);const u=n.substr(c+2,4);switch(u){case"0000":o+="\\0";break;case"0007":o+="\\a";break;case"000b":o+="\\v";break;case"001b":o+="\\e";break;case"0085":o+="\\N";break;case"00a0":o+="\\_";break;case"2028":o+="\\L";break;case"2029":o+="\\P";break;default:u.substr(0,2)==="00"?o+="\\x"+u.substr(2):o+=n.substr(c,6)}c+=5,l=c+1}break;case"n":if(i||n[c+2]==='"'||n.length<r)c+=1;else{for(o+=n.slice(l,c)+`

`;n[c+2]==="\\"&&n[c+3]==="n"&&n[c+4]!=='"';)o+=`
`,c+=2;o+=a,n[c+2]===" "&&(o+="\\"),c+=1,l=c+1}break;default:c+=1}return o=l?o+n.slice(l):n,i?o:co(o,a,ga,uo(s,!1))}function Sl(t,s){if(s.options.singleQuote===!1||s.implicitKey&&t.includes(`
`)||/[ \t]\n|\n[ \t]/.test(t))return sr(t,s);const n=s.indent||(mo(t)?"  ":""),i="'"+t.replace(/'/g,"''").replace(/\n+/g,`$&
${n}`)+"'";return s.implicitKey?i:co(i,n,mf,uo(s,!1))}function ni(t,s){const{singleQuote:n}=s.options;let i;if(n===!1)i=sr;else{const r=t.includes('"'),a=t.includes("'");r&&!a?i=Sl:a&&!r?i=sr:i=n?Sl:sr}return i(t,s)}let Cl;try{Cl=new RegExp(`(^|(?<!
))
+(?!
|$)`,"g")}catch{Cl=/\n+(?!\n|$)/g}function ja({comment:t,type:s,value:n},i,r,a){const{blockQuote:o,commentString:l,lineWidth:c}=i.options;if(!o||/\n[\t ]+$/.test(n)||/^\s*$/.test(n))return ni(n,i);const d=i.indent||(i.forceBlockIndent||mo(n)?"  ":""),u=o==="literal"?!0:o==="folded"||s===ne.BLOCK_FOLDED?!1:s===ne.BLOCK_LITERAL?!0:!QN(n,c,d.length);if(!n)return u?`|
`:`>
`;let m,h;for(h=n.length;h>0;--h){const _=n[h-1];if(_!==`
`&&_!=="	"&&_!==" ")break}let y=n.substring(h);const x=y.indexOf(`
`);x===-1?m="-":n===y||x!==y.length-1?(m="+",a&&a()):m="",y&&(n=n.slice(0,-y.length),y[y.length-1]===`
`&&(y=y.slice(0,-1)),y=y.replace(Cl,`$&${d}`));let g=!1,j,w=-1;for(j=0;j<n.length;++j){const _=n[j];if(_===" ")g=!0;else if(_===`
`)w=j;else break}let b=n.substring(0,w<j?w+1:j);b&&(n=n.substring(b.length),b=b.replace(/\n+/g,`$&${d}`));let C=(g?d?"2":"1":"")+m;if(t&&(C+=" "+l(t.replace(/ ?[\r\n]+/g," ")),r&&r()),!u){const _=n.replace(/\n+/g,`
$&`).replace(/(?:^|\n)([\t ].*)(?:([\n\t ]*)\n(?![\n\t ]))?/g,"$1$2").replace(/\n+/g,`$&${d}`);let S=!1;const z=uo(i,!0);o!=="folded"&&s!==ne.BLOCK_FOLDED&&(z.onOverflow=()=>{S=!0});const k=co(`${b}${_}${y}`,d,zl,z);if(!S)return`>${C}
${d}${k}`}return n=n.replace(/\n+/g,`$&${d}`),`|${C}
${d}${b}${n}${y}`}function YN(t,s,n,i){const{type:r,value:a}=t,{actualString:o,implicitKey:l,indent:c,indentStep:d,inFlow:u}=s;if(l&&a.includes(`
`)||u&&/[[\]{},]/.test(a))return ni(a,s);if(/^[\n\t ,[\]{}#&*!|>'"%@`]|^[?-]$|^[?-][ \t]|[\n:][ \t]|[ \t]\n|[\n\t ]#|[\n\t :]$/.test(a))return l||u||!a.includes(`
`)?ni(a,s):ja(t,s,n,i);if(!l&&!u&&r!==ne.PLAIN&&a.includes(`
`))return ja(t,s,n,i);if(mo(a)){if(c==="")return s.forceBlockIndent=!0,ja(t,s,n,i);if(l&&c===d)return ni(a,s)}const m=a.replace(/\n+/g,`$&
${c}`);if(o){const h=g=>g.default&&g.tag!=="tag:yaml.org,2002:str"&&g.test?.test(m),{compat:y,tags:x}=s.doc.schema;if(x.some(h)||y?.some(h))return ni(a,s)}return l?m:co(m,c,mf,uo(s,!1))}function Fr(t,s,n,i){const{implicitKey:r,inFlow:a}=s,o=typeof t.value=="string"?t:Object.assign({},t,{value:String(t.value)});let{type:l}=t;l!==ne.QUOTE_DOUBLE&&/[\x00-\x08\x0b-\x1f\x7f-\x9f\u{D800}-\u{DFFF}]/u.test(o.value)&&(l=ne.QUOTE_DOUBLE);const c=u=>{switch(u){case ne.BLOCK_FOLDED:case ne.BLOCK_LITERAL:return r||a?ni(o.value,s):ja(o,s,n,i);case ne.QUOTE_DOUBLE:return sr(o.value,s);case ne.QUOTE_SINGLE:return Sl(o.value,s);case ne.PLAIN:return YN(o,s,n,i);default:return null}};let d=c(l);if(d===null){const{defaultKeyType:u,defaultStringType:m}=s.options,h=r&&u||m;if(d=c(h),d===null)throw new Error(`Unsupported default string type ${h}`)}return d}function hf(t,s){const n=Object.assign({blockQuote:!0,commentString:HN,defaultKeyType:null,defaultStringType:"PLAIN",directives:null,doubleQuotedAsJSON:!1,doubleQuotedMinMultiLineLength:40,falseStr:"false",flowCollectionPadding:!0,indentSeq:!0,lineWidth:80,minContentWidth:20,nullStr:"null",simpleKeys:!1,singleQuote:null,trueStr:"true",verifyAliasOrder:!0},t.schema.toStringOptions,s);let i;switch(n.collectionStyle){case"block":i=!1;break;case"flow":i=!0;break;default:i=null}return{anchors:new Set,doc:t,flowCollectionPadding:n.flowCollectionPadding?" ":"",indent:"",indentStep:typeof n.indent=="number"?" ".repeat(n.indent):"  ",inFlow:i,options:n}}function JN(t,s){if(s.tag){const r=t.filter(a=>a.tag===s.tag);if(r.length>0)return r.find(a=>a.format===s.format)??r[0]}let n,i;if(ke(s)){i=s.value;let r=t.filter(a=>a.identify?.(i));if(r.length>1){const a=r.filter(o=>o.test);a.length>0&&(r=a)}n=r.find(a=>a.format===s.format)??r.find(a=>!a.format)}else i=s,n=t.find(r=>r.nodeClass&&i instanceof r.nodeClass);if(!n){const r=i?.constructor?.name??(i===null?"null":typeof i);throw new Error(`Tag not resolved for ${r} value`)}return n}function XN(t,s,{anchors:n,doc:i}){if(!i.directives)return"";const r=[],a=(ke(t)||De(t))&&t.anchor;a&&of(a)&&(n.add(a),r.push(`&${a}`));const o=t.tag??(s.default?null:s.tag);return o&&r.push(i.directives.tagString(o)),r.join(" ")}function bi(t,s,n,i){if(Ae(t))return t.toString(s,n,i);if(un(t)){if(s.doc.directives)return t.toString(s);if(s.resolvedAliases?.has(t))throw new TypeError("Cannot stringify circular structure without alias nodes");s.resolvedAliases?s.resolvedAliases.add(t):s.resolvedAliases=new Set([t]),t=t.resolve(s.doc)}let r;const a=Ie(t)?t:s.doc.createNode(t,{onTagObj:c=>r=c});r??(r=JN(s.doc.schema.tags,a));const o=XN(a,r,s);o.length>0&&(s.indentAtStart=(s.indentAtStart??0)+o.length+1);const l=typeof r.stringify=="function"?r.stringify(a,s,n,i):ke(a)?Fr(a,s,n,i):a.toString(s,n,i);return o?ke(a)||l[0]==="{"||l[0]==="["?`${o} ${l}`:`${o}
${s.indent}${l}`:l}function ek({key:t,value:s},n,i,r){const{allNullValues:a,doc:o,indent:l,indentStep:c,options:{commentString:d,indentSeq:u,simpleKeys:m}}=n;let h=Ie(t)&&t.comment||null;if(m){if(h)throw new Error("With simple keys, key nodes cannot have comments");if(De(t)||!Ie(t)&&typeof t=="object"){const z="With simple keys, collection cannot be used as a key value";throw new Error(z)}}let y=!m&&(!t||h&&s==null&&!n.inFlow||De(t)||(ke(t)?t.type===ne.BLOCK_FOLDED||t.type===ne.BLOCK_LITERAL:typeof t=="object"));n=Object.assign({},n,{allNullValues:!1,implicitKey:!y&&(m||!a),indent:l+c});let x=!1,g=!1,j=bi(t,n,()=>x=!0,()=>g=!0);if(!y&&!n.inFlow&&j.length>1024){if(m)throw new Error("With simple keys, single line scalar must not span more than 1024 characters");y=!0}if(n.inFlow){if(a||s==null)return x&&i&&i(),j===""?"?":y?`? ${j}`:j}else if(a&&!m||s==null&&y)return j=`? ${j}`,h&&!x?j+=jn(j,n.indent,d(h)):g&&r&&r(),j;x&&(h=null),y?(h&&(j+=jn(j,n.indent,d(h))),j=`? ${j}
${l}:`):(j=`${j}:`,h&&(j+=jn(j,n.indent,d(h))));let w,b,v;Ie(s)?(w=!!s.spaceBefore,b=s.commentBefore,v=s.comment):(w=!1,b=null,v=null,s&&typeof s=="object"&&(s=o.createNode(s))),n.implicitKey=!1,!y&&!h&&ke(s)&&(n.indentAtStart=j.length+1),g=!1,!u&&c.length>=2&&!n.inFlow&&!y&&Di(s)&&!s.flow&&!s.tag&&!s.anchor&&(n.indent=n.indent.substring(2));let C=!1;const _=bi(s,n,()=>C=!0,()=>g=!0);let S=" ";if(h||w||b){if(S=w?`
`:"",b){const z=d(b);S+=`
${Ps(z,n.indent)}`}_===""&&!n.inFlow?S===`
`&&(S=`

`):S+=`
${n.indent}`}else if(!y&&De(s)){const z=_[0],k=_.indexOf(`
`),T=k!==-1,p=n.inFlow??s.flow??s.items.length===0;if(T||!p){let N=!1;if(T&&(z==="&"||z==="!")){let A=_.indexOf(" ");z==="&"&&A!==-1&&A<k&&_[A+1]==="!"&&(A=_.indexOf(" ",A+1)),(A===-1||k<A)&&(N=!0)}N||(S=`
${n.indent}`)}}else(_===""||_[0]===`
`)&&(S="");return j+=S+_,n.inFlow?C&&i&&i():v&&!C?j+=jn(j,n.indent,d(v)):g&&r&&r(),j}function pf(t,s){(t==="debug"||t==="warn")&&console.warn(s)}const na="<<",Ms={identify:t=>t===na||typeof t=="symbol"&&t.description===na,default:"key",tag:"tag:yaml.org,2002:merge",test:/^<<$/,resolve:()=>Object.assign(new ne(Symbol(na)),{addToJSMap:ff}),stringify:()=>na},tk=(t,s)=>(Ms.identify(s)||ke(s)&&(!s.type||s.type===ne.PLAIN)&&Ms.identify(s.value))&&t?.doc.schema.tags.some(n=>n.tag===Ms.tag&&n.default);function ff(t,s,n){if(n=t&&un(n)?n.resolve(t.doc):n,Di(n))for(const i of n.items)Ko(t,s,i);else if(Array.isArray(n))for(const i of n)Ko(t,s,i);else Ko(t,s,n)}function Ko(t,s,n){const i=t&&un(n)?n.resolve(t.doc):n;if(!Ai(i))throw new Error("Merge sources must be maps or map aliases");const r=i.toJSON(null,t,Map);for(const[a,o]of r)s instanceof Map?s.has(a)||s.set(a,o):s instanceof Set?s.add(a):Object.prototype.hasOwnProperty.call(s,a)||Object.defineProperty(s,a,{value:o,writable:!0,enumerable:!0,configurable:!0});return s}function xf(t,s,{key:n,value:i}){if(Ie(n)&&n.addToJSMap)n.addToJSMap(t,s,i);else if(tk(t,n))ff(t,s,i);else{const r=Zt(n,"",t);if(s instanceof Map)s.set(r,Zt(i,r,t));else if(s instanceof Set)s.add(r);else{const a=sk(n,r,t),o=Zt(i,a,t);a in s?Object.defineProperty(s,a,{value:o,writable:!0,enumerable:!0,configurable:!0}):s[a]=o}}return s}function sk(t,s,n){if(s===null)return"";if(typeof s!="object")return String(s);if(Ie(t)&&n?.doc){const i=hf(n.doc,{});i.anchors=new Set;for(const a of n.anchors.keys())i.anchors.add(a.anchor);i.inFlow=!0,i.inStringifyKey=!0;const r=t.toString(i);if(!n.mapKeyWarned){let a=JSON.stringify(r);a.length>40&&(a=a.substring(0,36)+'..."'),pf(n.doc.options.logLevel,`Keys with collection values will be stringified due to JS Object restrictions: ${a}. Set mapAsMap: true to use object keys.`),n.mapKeyWarned=!0}return r}return JSON.stringify(s)}function zc(t,s,n){const i=br(t,void 0,n),r=br(s,void 0,n);return new lt(i,r)}class lt{constructor(s,n=null){Object.defineProperty(this,es,{value:ef}),this.key=s,this.value=n}clone(s){let{key:n,value:i}=this;return Ie(n)&&(n=n.clone(s)),Ie(i)&&(i=i.clone(s)),new lt(n,i)}toJSON(s,n){const i=n?.mapAsMap?new Map:{};return xf(n,i,this)}toString(s,n,i){return s?.doc?ek(this,s,n,i):JSON.stringify(this)}}function gf(t,s,n){return(s.inFlow??t.flow?ik:nk)(t,s,n)}function nk({comment:t,items:s},n,{blockItemPrefix:i,flowChars:r,itemIndent:a,onChompKeep:o,onComment:l}){const{indent:c,options:{commentString:d}}=n,u=Object.assign({},n,{indent:a,type:null});let m=!1;const h=[];for(let x=0;x<s.length;++x){const g=s[x];let j=null;if(Ie(g))!m&&g.spaceBefore&&h.push(""),Da(n,h,g.commentBefore,m),g.comment&&(j=g.comment);else if(Ae(g)){const b=Ie(g.key)?g.key:null;b&&(!m&&b.spaceBefore&&h.push(""),Da(n,h,b.commentBefore,m))}m=!1;let w=bi(g,u,()=>j=null,()=>m=!0);j&&(w+=jn(w,a,d(j))),m&&j&&(m=!1),h.push(i+w)}let y;if(h.length===0)y=r.start+r.end;else{y=h[0];for(let x=1;x<h.length;++x){const g=h[x];y+=g?`
${c}${g}`:`
`}}return t?(y+=`
`+Ps(d(t),c),l&&l()):m&&o&&o(),y}function ik({items:t},s,{flowChars:n,itemIndent:i}){const{indent:r,indentStep:a,flowCollectionPadding:o,options:{commentString:l}}=s;i+=a;const c=Object.assign({},s,{indent:i,inFlow:!0,type:null});let d=!1,u=0;const m=[];for(let x=0;x<t.length;++x){const g=t[x];let j=null;if(Ie(g))g.spaceBefore&&m.push(""),Da(s,m,g.commentBefore,!1),g.comment&&(j=g.comment);else if(Ae(g)){const b=Ie(g.key)?g.key:null;b&&(b.spaceBefore&&m.push(""),Da(s,m,b.commentBefore,!1),b.comment&&(d=!0));const v=Ie(g.value)?g.value:null;v?(v.comment&&(j=v.comment),v.commentBefore&&(d=!0)):g.value==null&&b?.comment&&(j=b.comment)}j&&(d=!0);let w=bi(g,c,()=>j=null);x<t.length-1&&(w+=","),j&&(w+=jn(w,i,l(j))),!d&&(m.length>u||w.includes(`
`))&&(d=!0),m.push(w),u=m.length}const{start:h,end:y}=n;if(m.length===0)return h+y;if(!d){const x=m.reduce((g,j)=>g+j.length+2,2);d=s.options.lineWidth>0&&x>s.options.lineWidth}if(d){let x=h;for(const g of m)x+=g?`
${a}${r}${g}`:`
`;return`${x}
${r}${y}`}else return`${h}${o}${m.join(" ")}${o}${y}`}function Da({indent:t,options:{commentString:s}},n,i,r){if(i&&r&&(i=i.replace(/^\n+/,"")),i){const a=Ps(s(i),t);n.push(a.trimStart())}}function yn(t,s){const n=ke(s)?s.value:s;for(const i of t)if(Ae(i)&&(i.key===s||i.key===n||ke(i.key)&&i.key.value===n))return i}class It extends uf{static get tagName(){return"tag:yaml.org,2002:map"}constructor(s){super(Js,s),this.items=[]}static from(s,n,i){const{keepUndefined:r,replacer:a}=i,o=new this(s),l=(c,d)=>{if(typeof a=="function")d=a.call(n,c,d);else if(Array.isArray(a)&&!a.includes(c))return;(d!==void 0||r)&&o.items.push(zc(c,d,i))};if(n instanceof Map)for(const[c,d]of n)l(c,d);else if(n&&typeof n=="object")for(const c of Object.keys(n))l(c,n[c]);return typeof s.sortMapEntries=="function"&&o.items.sort(s.sortMapEntries),o}add(s,n){let i;Ae(s)?i=s:!s||typeof s!="object"||!("key"in s)?i=new lt(s,s?.value):i=new lt(s.key,s.value);const r=yn(this.items,i.key),a=this.schema?.sortMapEntries;if(r){if(!n)throw new Error(`Key ${i.key} already set`);ke(r.value)&&df(i.value)?r.value.value=i.value:r.value=i.value}else if(a){const o=this.items.findIndex(l=>a(i,l)<0);o===-1?this.items.push(i):this.items.splice(o,0,i)}else this.items.push(i)}delete(s){const n=yn(this.items,s);return n?this.items.splice(this.items.indexOf(n),1).length>0:!1}get(s,n){const r=yn(this.items,s)?.value;return(!n&&ke(r)?r.value:r)??void 0}has(s){return!!yn(this.items,s)}set(s,n){this.add(new lt(s,n),!0)}toJSON(s,n,i){const r=i?new i:n?.mapAsMap?new Map:{};n?.onCreate&&n.onCreate(r);for(const a of this.items)xf(n,r,a);return r}toString(s,n,i){if(!s)return JSON.stringify(this);for(const r of this.items)if(!Ae(r))throw new Error(`Map items must all be pairs; found ${JSON.stringify(r)} instead`);return!s.allNullValues&&this.hasAllNullValues(!1)&&(s=Object.assign({},s,{allNullValues:!0})),gf(this,s,{blockItemPrefix:"",flowChars:{start:"{",end:"}"},itemIndent:s.indent||"",onChompKeep:i,onComment:n})}}const Pi={collection:"map",default:!0,nodeClass:It,tag:"tag:yaml.org,2002:map",resolve(t,s){return Ai(t)||s("Expected a mapping for this tag"),t},createNode:(t,s,n)=>It.from(t,s,n)};class nn extends uf{static get tagName(){return"tag:yaml.org,2002:seq"}constructor(s){super(Ti,s),this.items=[]}add(s){this.items.push(s)}delete(s){const n=ia(s);return typeof n!="number"?!1:this.items.splice(n,1).length>0}get(s,n){const i=ia(s);if(typeof i!="number")return;const r=this.items[i];return!n&&ke(r)?r.value:r}has(s){const n=ia(s);return typeof n=="number"&&n<this.items.length}set(s,n){const i=ia(s);if(typeof i!="number")throw new Error(`Expected a valid index, not ${s}.`);const r=this.items[i];ke(r)&&df(n)?r.value=n:this.items[i]=n}toJSON(s,n){const i=[];n?.onCreate&&n.onCreate(i);let r=0;for(const a of this.items)i.push(Zt(a,String(r++),n));return i}toString(s,n,i){return s?gf(this,s,{blockItemPrefix:"- ",flowChars:{start:"[",end:"]"},itemIndent:(s.indent||"")+"  ",onChompKeep:i,onComment:n}):JSON.stringify(this)}static from(s,n,i){const{replacer:r}=i,a=new this(s);if(n&&Symbol.iterator in Object(n)){let o=0;for(let l of n){if(typeof r=="function"){const c=n instanceof Set?l:String(o++);l=r.call(n,c,l)}a.items.push(br(l,void 0,i))}}return a}}function ia(t){let s=ke(t)?t.value:t;return s&&typeof s=="string"&&(s=Number(s)),typeof s=="number"&&Number.isInteger(s)&&s>=0?s:null}const Mi={collection:"seq",default:!0,nodeClass:nn,tag:"tag:yaml.org,2002:seq",resolve(t,s){return Di(t)||s("Expected a sequence for this tag"),t},createNode:(t,s,n)=>nn.from(t,s,n)},ho={identify:t=>typeof t=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:t=>t,stringify(t,s,n,i){return s=Object.assign({actualString:!0},s),Fr(t,s,n,i)}},po={identify:t=>t==null,createNode:()=>new ne(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:()=>new ne(null),stringify:({source:t},s)=>typeof t=="string"&&po.test.test(t)?t:s.options.nullStr},Sc={identify:t=>typeof t=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,resolve:t=>new ne(t[0]==="t"||t[0]==="T"),stringify({source:t,value:s},n){if(t&&Sc.test.test(t)){const i=t[0]==="t"||t[0]==="T";if(s===i)return t}return s?n.options.trueStr:n.options.falseStr}};function os({format:t,minFractionDigits:s,tag:n,value:i}){if(typeof i=="bigint")return String(i);const r=typeof i=="number"?i:Number(i);if(!isFinite(r))return isNaN(r)?".nan":r<0?"-.inf":".inf";let a=JSON.stringify(i);if(!t&&s&&(!n||n==="tag:yaml.org,2002:float")&&/^\d/.test(a)){let o=a.indexOf(".");o<0&&(o=a.length,a+=".");let l=s-(a.length-o-1);for(;l-- >0;)a+="0"}return a}const jf={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:t=>t.slice(-3).toLowerCase()==="nan"?NaN:t[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:os},yf={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:\.[0-9]+|[0-9]+(?:\.[0-9]*)?)[eE][-+]?[0-9]+$/,resolve:t=>parseFloat(t),stringify(t){const s=Number(t.value);return isFinite(s)?s.toExponential():os(t)}},wf={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:\.[0-9]+|[0-9]+\.[0-9]*)$/,resolve(t){const s=new ne(parseFloat(t)),n=t.indexOf(".");return n!==-1&&t[t.length-1]==="0"&&(s.minFractionDigits=t.length-n-1),s},stringify:os},fo=t=>typeof t=="bigint"||Number.isInteger(t),Cc=(t,s,n,{intAsBigInt:i})=>i?BigInt(t):parseInt(t.substring(s),n);function bf(t,s,n){const{value:i}=t;return fo(i)&&i>=0?n+i.toString(s):os(t)}const vf={identify:t=>fo(t)&&t>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^0o[0-7]+$/,resolve:(t,s,n)=>Cc(t,2,8,n),stringify:t=>bf(t,8,"0o")},Nf={identify:fo,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9]+$/,resolve:(t,s,n)=>Cc(t,0,10,n),stringify:os},kf={identify:t=>fo(t)&&t>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^0x[0-9a-fA-F]+$/,resolve:(t,s,n)=>Cc(t,2,16,n),stringify:t=>bf(t,16,"0x")},rk=[Pi,Mi,ho,po,Sc,vf,Nf,kf,jf,yf,wf];function fu(t){return typeof t=="bigint"||Number.isInteger(t)}const ra=({value:t})=>JSON.stringify(t),ak=[{identify:t=>typeof t=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:t=>t,stringify:ra},{identify:t=>t==null,createNode:()=>new ne(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^null$/,resolve:()=>null,stringify:ra},{identify:t=>typeof t=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^true$|^false$/,resolve:t=>t==="true",stringify:ra},{identify:fu,default:!0,tag:"tag:yaml.org,2002:int",test:/^-?(?:0|[1-9][0-9]*)$/,resolve:(t,s,{intAsBigInt:n})=>n?BigInt(t):parseInt(t,10),stringify:({value:t})=>fu(t)?t.toString():JSON.stringify(t)},{identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^-?(?:0|[1-9][0-9]*)(?:\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,resolve:t=>parseFloat(t),stringify:ra}],ok={default:!0,tag:"",test:/^/,resolve(t,s){return s(`Unresolved plain scalar ${JSON.stringify(t)}`),t}},lk=[Pi,Mi].concat(ak,ok),_c={identify:t=>t instanceof Uint8Array,default:!1,tag:"tag:yaml.org,2002:binary",resolve(t,s){if(typeof atob=="function"){const n=atob(t.replace(/[\n\r]/g,"")),i=new Uint8Array(n.length);for(let r=0;r<n.length;++r)i[r]=n.charCodeAt(r);return i}else return s("This environment does not support reading binary tags; either Buffer or atob is required"),t},stringify({comment:t,type:s,value:n},i,r,a){if(!n)return"";const o=n;let l;if(typeof btoa=="function"){let c="";for(let d=0;d<o.length;++d)c+=String.fromCharCode(o[d]);l=btoa(c)}else throw new Error("This environment does not support writing binary tags; either Buffer or btoa is required");if(s??(s=ne.BLOCK_LITERAL),s!==ne.QUOTE_DOUBLE){const c=Math.max(i.options.lineWidth-i.indent.length,i.options.minContentWidth),d=Math.ceil(l.length/c),u=new Array(d);for(let m=0,h=0;m<d;++m,h+=c)u[m]=l.substr(h,c);l=u.join(s===ne.BLOCK_LITERAL?`
`:" ")}return Fr({comment:t,type:s,value:l},i,r,a)}};function zf(t,s){if(Di(t))for(let n=0;n<t.items.length;++n){let i=t.items[n];if(!Ae(i)){if(Ai(i)){i.items.length>1&&s("Each pair must have its own sequence indicator");const r=i.items[0]||new lt(new ne(null));if(i.commentBefore&&(r.key.commentBefore=r.key.commentBefore?`${i.commentBefore}
${r.key.commentBefore}`:i.commentBefore),i.comment){const a=r.value??r.key;a.comment=a.comment?`${i.comment}
${a.comment}`:i.comment}i=r}t.items[n]=Ae(i)?i:new lt(i)}}else s("Expected a sequence for this tag");return t}function Sf(t,s,n){const{replacer:i}=n,r=new nn(t);r.tag="tag:yaml.org,2002:pairs";let a=0;if(s&&Symbol.iterator in Object(s))for(let o of s){typeof i=="function"&&(o=i.call(s,String(a++),o));let l,c;if(Array.isArray(o))if(o.length===2)l=o[0],c=o[1];else throw new TypeError(`Expected [key, value] tuple: ${o}`);else if(o&&o instanceof Object){const d=Object.keys(o);if(d.length===1)l=d[0],c=o[l];else throw new TypeError(`Expected tuple with one key, not ${d.length} keys`)}else l=o;r.items.push(zc(l,c,n))}return r}const Tc={collection:"seq",default:!1,tag:"tag:yaml.org,2002:pairs",resolve:zf,createNode:Sf};class di extends nn{constructor(){super(),this.add=It.prototype.add.bind(this),this.delete=It.prototype.delete.bind(this),this.get=It.prototype.get.bind(this),this.has=It.prototype.has.bind(this),this.set=It.prototype.set.bind(this),this.tag=di.tag}toJSON(s,n){if(!n)return super.toJSON(s);const i=new Map;n?.onCreate&&n.onCreate(i);for(const r of this.items){let a,o;if(Ae(r)?(a=Zt(r.key,"",n),o=Zt(r.value,a,n)):a=Zt(r,"",n),i.has(a))throw new Error("Ordered maps must not include duplicate keys");i.set(a,o)}return i}static from(s,n,i){const r=Sf(s,n,i),a=new this;return a.items=r.items,a}}di.tag="tag:yaml.org,2002:omap";const Ac={collection:"seq",identify:t=>t instanceof Map,nodeClass:di,default:!1,tag:"tag:yaml.org,2002:omap",resolve(t,s){const n=zf(t,s),i=[];for(const{key:r}of n.items)ke(r)&&(i.includes(r.value)?s(`Ordered maps must not include duplicate keys: ${r.value}`):i.push(r.value));return Object.assign(new di,n)},createNode:(t,s,n)=>di.from(t,s,n)};function Cf({value:t,source:s},n){return s&&(t?_f:Tf).test.test(s)?s:t?n.options.trueStr:n.options.falseStr}const _f={identify:t=>t===!0,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,resolve:()=>new ne(!0),stringify:Cf},Tf={identify:t=>t===!1,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/,resolve:()=>new ne(!1),stringify:Cf},ck={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:t=>t.slice(-3).toLowerCase()==="nan"?NaN:t[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:os},dk={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:[0-9][0-9_]*)?(?:\.[0-9_]*)?[eE][-+]?[0-9]+$/,resolve:t=>parseFloat(t.replace(/_/g,"")),stringify(t){const s=Number(t.value);return isFinite(s)?s.toExponential():os(t)}},uk={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:[0-9][0-9_]*)?\.[0-9_]*$/,resolve(t){const s=new ne(parseFloat(t.replace(/_/g,""))),n=t.indexOf(".");if(n!==-1){const i=t.substring(n+1).replace(/_/g,"");i[i.length-1]==="0"&&(s.minFractionDigits=i.length)}return s},stringify:os},qr=t=>typeof t=="bigint"||Number.isInteger(t);function xo(t,s,n,{intAsBigInt:i}){const r=t[0];if((r==="-"||r==="+")&&(s+=1),t=t.substring(s).replace(/_/g,""),i){switch(n){case 2:t=`0b${t}`;break;case 8:t=`0o${t}`;break;case 16:t=`0x${t}`;break}const o=BigInt(t);return r==="-"?BigInt(-1)*o:o}const a=parseInt(t,n);return r==="-"?-1*a:a}function Dc(t,s,n){const{value:i}=t;if(qr(i)){const r=i.toString(s);return i<0?"-"+n+r.substr(1):n+r}return os(t)}const mk={identify:qr,default:!0,tag:"tag:yaml.org,2002:int",format:"BIN",test:/^[-+]?0b[0-1_]+$/,resolve:(t,s,n)=>xo(t,2,2,n),stringify:t=>Dc(t,2,"0b")},hk={identify:qr,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^[-+]?0[0-7_]+$/,resolve:(t,s,n)=>xo(t,1,8,n),stringify:t=>Dc(t,8,"0")},pk={identify:qr,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9][0-9_]*$/,resolve:(t,s,n)=>xo(t,0,10,n),stringify:os},fk={identify:qr,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^[-+]?0x[0-9a-fA-F_]+$/,resolve:(t,s,n)=>xo(t,2,16,n),stringify:t=>Dc(t,16,"0x")};class ui extends It{constructor(s){super(s),this.tag=ui.tag}add(s){let n;Ae(s)?n=s:s&&typeof s=="object"&&"key"in s&&"value"in s&&s.value===null?n=new lt(s.key,null):n=new lt(s,null),yn(this.items,n.key)||this.items.push(n)}get(s,n){const i=yn(this.items,s);return!n&&Ae(i)?ke(i.key)?i.key.value:i.key:i}set(s,n){if(typeof n!="boolean")throw new Error(`Expected boolean value for set(key, value) in a YAML set, not ${typeof n}`);const i=yn(this.items,s);i&&!n?this.items.splice(this.items.indexOf(i),1):!i&&n&&this.items.push(new lt(s))}toJSON(s,n){return super.toJSON(s,n,Set)}toString(s,n,i){if(!s)return JSON.stringify(this);if(this.hasAllNullValues(!0))return super.toString(Object.assign({},s,{allNullValues:!0}),n,i);throw new Error("Set items must all have null values")}static from(s,n,i){const{replacer:r}=i,a=new this(s);if(n&&Symbol.iterator in Object(n))for(let o of n)typeof r=="function"&&(o=r.call(n,o,o)),a.items.push(zc(o,null,i));return a}}ui.tag="tag:yaml.org,2002:set";const Pc={collection:"map",identify:t=>t instanceof Set,nodeClass:ui,default:!1,tag:"tag:yaml.org,2002:set",createNode:(t,s,n)=>ui.from(t,s,n),resolve(t,s){if(Ai(t)){if(t.hasAllNullValues(!0))return Object.assign(new ui,t);s("Set items must all have null values")}else s("Expected a mapping for this tag");return t}};function Mc(t,s){const n=t[0],i=n==="-"||n==="+"?t.substring(1):t,r=o=>s?BigInt(o):Number(o),a=i.replace(/_/g,"").split(":").reduce((o,l)=>o*r(60)+r(l),r(0));return n==="-"?r(-1)*a:a}function Af(t){let{value:s}=t,n=o=>o;if(typeof s=="bigint")n=o=>BigInt(o);else if(isNaN(s)||!isFinite(s))return os(t);let i="";s<0&&(i="-",s*=n(-1));const r=n(60),a=[s%r];return s<60?a.unshift(0):(s=(s-a[0])/r,a.unshift(s%r),s>=60&&(s=(s-a[0])/r,a.unshift(s))),i+a.map(o=>String(o).padStart(2,"0")).join(":").replace(/000000\d*$/,"")}const Df={identify:t=>typeof t=="bigint"||Number.isInteger(t),default:!0,tag:"tag:yaml.org,2002:int",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,resolve:(t,s,{intAsBigInt:n})=>Mc(t,n),stringify:Af},Pf={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\.[0-9_]*$/,resolve:t=>Mc(t,!1),stringify:Af},go={identify:t=>t instanceof Date,default:!0,tag:"tag:yaml.org,2002:timestamp",test:RegExp("^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})(?:(?:t|T|[ \\t]+)([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\.[0-9]+)?)(?:[ \\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?)?$"),resolve(t){const s=t.match(go.test);if(!s)throw new Error("!!timestamp expects a date, starting with yyyy-mm-dd");const[,n,i,r,a,o,l]=s.map(Number),c=s[7]?Number((s[7]+"00").substr(1,3)):0;let d=Date.UTC(n,i-1,r,a||0,o||0,l||0,c);const u=s[8];if(u&&u!=="Z"){let m=Mc(u,!1);Math.abs(m)<30&&(m*=60),d-=6e4*m}return new Date(d)},stringify:({value:t})=>t?.toISOString().replace(/(T00:00:00)?\.000Z$/,"")??""},xu=[Pi,Mi,ho,po,_f,Tf,mk,hk,pk,fk,ck,dk,uk,_c,Ms,Ac,Tc,Pc,Df,Pf,go],gu=new Map([["core",rk],["failsafe",[Pi,Mi,ho]],["json",lk],["yaml11",xu],["yaml-1.1",xu]]),ju={binary:_c,bool:Sc,float:wf,floatExp:yf,floatNaN:jf,floatTime:Pf,int:Nf,intHex:kf,intOct:vf,intTime:Df,map:Pi,merge:Ms,null:po,omap:Ac,pairs:Tc,seq:Mi,set:Pc,timestamp:go},xk={"tag:yaml.org,2002:binary":_c,"tag:yaml.org,2002:merge":Ms,"tag:yaml.org,2002:omap":Ac,"tag:yaml.org,2002:pairs":Tc,"tag:yaml.org,2002:set":Pc,"tag:yaml.org,2002:timestamp":go};function Wo(t,s,n){const i=gu.get(s);if(i&&!t)return n&&!i.includes(Ms)?i.concat(Ms):i.slice();let r=i;if(!r)if(Array.isArray(t))r=[];else{const a=Array.from(gu.keys()).filter(o=>o!=="yaml11").map(o=>JSON.stringify(o)).join(", ");throw new Error(`Unknown schema "${s}"; use one of ${a} or define customTags array`)}if(Array.isArray(t))for(const a of t)r=r.concat(a);else typeof t=="function"&&(r=t(r.slice()));return n&&(r=r.concat(Ms)),r.reduce((a,o)=>{const l=typeof o=="string"?ju[o]:o;if(!l){const c=JSON.stringify(o),d=Object.keys(ju).map(u=>JSON.stringify(u)).join(", ");throw new Error(`Unknown custom tag ${c}; use one of ${d}`)}return a.includes(l)||a.push(l),a},[])}const gk=(t,s)=>t.key<s.key?-1:t.key>s.key?1:0;class jo{constructor({compat:s,customTags:n,merge:i,resolveKnownTags:r,schema:a,sortMapEntries:o,toStringDefaults:l}){this.compat=Array.isArray(s)?Wo(s,"compat"):s?Wo(null,s):null,this.name=typeof a=="string"&&a||"core",this.knownTags=r?xk:{},this.tags=Wo(n,this.name,i),this.toStringOptions=l??null,Object.defineProperty(this,Js,{value:Pi}),Object.defineProperty(this,bs,{value:ho}),Object.defineProperty(this,Ti,{value:Mi}),this.sortMapEntries=typeof o=="function"?o:o===!0?gk:null}clone(){const s=Object.create(jo.prototype,Object.getOwnPropertyDescriptors(this));return s.tags=this.tags.slice(),s}}function jk(t,s){const n=[];let i=s.directives===!0;if(s.directives!==!1&&t.directives){const c=t.directives.toString(t);c?(n.push(c),i=!0):t.directives.docStart&&(i=!0)}i&&n.push("---");const r=hf(t,s),{commentString:a}=r.options;if(t.commentBefore){n.length!==1&&n.unshift("");const c=a(t.commentBefore);n.unshift(Ps(c,""))}let o=!1,l=null;if(t.contents){if(Ie(t.contents)){if(t.contents.spaceBefore&&i&&n.push(""),t.contents.commentBefore){const u=a(t.contents.commentBefore);n.push(Ps(u,""))}r.forceBlockIndent=!!t.comment,l=t.contents.comment}const c=l?void 0:()=>o=!0;let d=bi(t.contents,r,()=>l=null,c);l&&(d+=jn(d,"",a(l))),(d[0]==="|"||d[0]===">")&&n[n.length-1]==="---"?n[n.length-1]=`--- ${d}`:n.push(d)}else n.push(bi(t.contents,r));if(t.directives?.docEnd)if(t.comment){const c=a(t.comment);c.includes(`
`)?(n.push("..."),n.push(Ps(c,""))):n.push(`... ${c}`)}else n.push("...");else{let c=t.comment;c&&o&&(c=c.replace(/^\n+/,"")),c&&((!o||l)&&n[n.length-1]!==""&&n.push(""),n.push(Ps(a(c),"")))}return n.join(`
`)+`
`}class Ii{constructor(s,n,i){this.commentBefore=null,this.comment=null,this.errors=[],this.warnings=[],Object.defineProperty(this,es,{value:kl});let r=null;typeof n=="function"||Array.isArray(n)?r=n:i===void 0&&n&&(i=n,n=void 0);const a=Object.assign({intAsBigInt:!1,keepSourceTokens:!1,logLevel:"warn",prettyErrors:!0,strict:!0,stringKeys:!1,uniqueKeys:!0,version:"1.2"},i);this.options=a;let{version:o}=a;i?._directives?(this.directives=i._directives.atDocument(),this.directives.yaml.explicit&&(o=this.directives.yaml.version)):this.directives=new pt({version:o}),this.setSchema(o,i),this.contents=s===void 0?null:this.createNode(s,r,i)}clone(){const s=Object.create(Ii.prototype,{[es]:{value:kl}});return s.commentBefore=this.commentBefore,s.comment=this.comment,s.errors=this.errors.slice(),s.warnings=this.warnings.slice(),s.options=Object.assign({},this.options),this.directives&&(s.directives=this.directives.clone()),s.schema=this.schema.clone(),s.contents=Ie(this.contents)?this.contents.clone(s.schema):this.contents,this.range&&(s.range=this.range.slice()),s}add(s){Qn(this.contents)&&this.contents.add(s)}addIn(s,n){Qn(this.contents)&&this.contents.addIn(s,n)}createAlias(s,n){if(!s.anchor){const i=lf(this);s.anchor=!n||i.has(n)?cf(n||"a",i):n}return new lo(s.anchor)}createNode(s,n,i){let r;if(typeof n=="function")s=n.call({"":s},"",s),r=n;else if(Array.isArray(n)){const j=b=>typeof b=="number"||b instanceof String||b instanceof Number,w=n.filter(j).map(String);w.length>0&&(n=n.concat(w)),r=n}else i===void 0&&n&&(i=n,n=void 0);const{aliasDuplicateObjects:a,anchorPrefix:o,flow:l,keepUndefined:c,onTagObj:d,tag:u}=i??{},{onAnchor:m,setAnchors:h,sourceObjects:y}=WN(this,o||"a"),x={aliasDuplicateObjects:a??!0,keepUndefined:c??!1,onAnchor:m,onTagObj:d,replacer:r,schema:this.schema,sourceObjects:y},g=br(s,u,x);return l&&De(g)&&(g.flow=!0),h(),g}createPair(s,n,i={}){const r=this.createNode(s,null,i),a=this.createNode(n,null,i);return new lt(r,a)}delete(s){return Qn(this.contents)?this.contents.delete(s):!1}deleteIn(s){return Xi(s)?this.contents==null?!1:(this.contents=null,!0):Qn(this.contents)?this.contents.deleteIn(s):!1}get(s,n){return De(this.contents)?this.contents.get(s,n):void 0}getIn(s,n){return Xi(s)?!n&&ke(this.contents)?this.contents.value:this.contents:De(this.contents)?this.contents.getIn(s,n):void 0}has(s){return De(this.contents)?this.contents.has(s):!1}hasIn(s){return Xi(s)?this.contents!==void 0:De(this.contents)?this.contents.hasIn(s):!1}set(s,n){this.contents==null?this.contents=Aa(this.schema,[s],n):Qn(this.contents)&&this.contents.set(s,n)}setIn(s,n){Xi(s)?this.contents=n:this.contents==null?this.contents=Aa(this.schema,Array.from(s),n):Qn(this.contents)&&this.contents.setIn(s,n)}setSchema(s,n={}){typeof s=="number"&&(s=String(s));let i;switch(s){case"1.1":this.directives?this.directives.yaml.version="1.1":this.directives=new pt({version:"1.1"}),i={resolveKnownTags:!1,schema:"yaml-1.1"};break;case"1.2":case"next":this.directives?this.directives.yaml.version=s:this.directives=new pt({version:s}),i={resolveKnownTags:!0,schema:"core"};break;case null:this.directives&&delete this.directives,i=null;break;default:{const r=JSON.stringify(s);throw new Error(`Expected '1.1', '1.2' or null as first argument, but found: ${r}`)}}if(n.schema instanceof Object)this.schema=n.schema;else if(i)this.schema=new jo(Object.assign(i,n));else throw new Error("With a null YAML version, the { schema: Schema } option is required")}toJS({json:s,jsonArg:n,mapAsMap:i,maxAliasCount:r,onAnchor:a,reviver:o}={}){const l={anchors:new Map,doc:this,keep:!s,mapAsMap:i===!0,mapKeyWarned:!1,maxAliasCount:typeof r=="number"?r:100},c=Zt(this.contents,n??"",l);if(typeof a=="function")for(const{count:d,res:u}of l.anchors.values())a(u,d);return typeof o=="function"?si(o,{"":c},"",c):c}toJSON(s,n){return this.toJS({json:!0,jsonArg:s,mapAsMap:!1,onAnchor:n})}toString(s={}){if(this.errors.length>0)throw new Error("Document with errors cannot be stringified");if("indent"in s&&(!Number.isInteger(s.indent)||Number(s.indent)<=0)){const n=JSON.stringify(s.indent);throw new Error(`"indent" option must be a positive integer, not ${n}`)}return jk(this,s)}}function Qn(t){if(De(t))return!0;throw new Error("Expected a YAML collection as document contents")}class Ic extends Error{constructor(s,n,i,r){super(),this.name=s,this.code=i,this.message=r,this.pos=n}}class wn extends Ic{constructor(s,n,i){super("YAMLParseError",s,n,i)}}class Mf extends Ic{constructor(s,n,i){super("YAMLWarning",s,n,i)}}const Pa=(t,s)=>n=>{if(n.pos[0]===-1)return;n.linePos=n.pos.map(l=>s.linePos(l));const{line:i,col:r}=n.linePos[0];n.message+=` at line ${i}, column ${r}`;let a=r-1,o=t.substring(s.lineStarts[i-1],s.lineStarts[i]).replace(/[\n\r]+$/,"");if(a>=60&&o.length>80){const l=Math.min(a-39,o.length-79);o=""+o.substring(l),a-=l-1}if(o.length>80&&(o=o.substring(0,79)+""),i>1&&/^ *$/.test(o.substring(0,a))){let l=t.substring(s.lineStarts[i-2],s.lineStarts[i-1]);l.length>80&&(l=l.substring(0,79)+`
`),o=l+o}if(/[^ ]/.test(o)){let l=1;const c=n.linePos[1];c&&c.line===i&&c.col>r&&(l=Math.max(1,Math.min(c.col-r,80-a)));const d=" ".repeat(a)+"^".repeat(l);n.message+=`:

${o}
${d}
`}};function vi(t,{flow:s,indicator:n,next:i,offset:r,onError:a,parentIndent:o,startOnNewline:l}){let c=!1,d=l,u=l,m="",h="",y=!1,x=!1,g=null,j=null,w=null,b=null,v=null,C=null,_=null;for(const k of t)switch(x&&(k.type!=="space"&&k.type!=="newline"&&k.type!=="comma"&&a(k.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),x=!1),g&&(d&&k.type!=="comment"&&k.type!=="newline"&&a(g,"TAB_AS_INDENT","Tabs are not allowed as indentation"),g=null),k.type){case"space":!s&&(n!=="doc-start"||i?.type!=="flow-collection")&&k.source.includes("	")&&(g=k),u=!0;break;case"comment":{u||a(k,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const T=k.source.substring(1)||" ";m?m+=h+T:m=T,h="",d=!1;break}case"newline":d?m?m+=k.source:(!C||n!=="seq-item-ind")&&(c=!0):h+=k.source,d=!0,y=!0,(j||w)&&(b=k),u=!0;break;case"anchor":j&&a(k,"MULTIPLE_ANCHORS","A node can have at most one anchor"),k.source.endsWith(":")&&a(k.offset+k.source.length-1,"BAD_ALIAS","Anchor ending in : is ambiguous",!0),j=k,_??(_=k.offset),d=!1,u=!1,x=!0;break;case"tag":{w&&a(k,"MULTIPLE_TAGS","A node can have at most one tag"),w=k,_??(_=k.offset),d=!1,u=!1,x=!0;break}case n:(j||w)&&a(k,"BAD_PROP_ORDER",`Anchors and tags must be after the ${k.source} indicator`),C&&a(k,"UNEXPECTED_TOKEN",`Unexpected ${k.source} in ${s??"collection"}`),C=k,d=n==="seq-item-ind"||n==="explicit-key-ind",u=!1;break;case"comma":if(s){v&&a(k,"UNEXPECTED_TOKEN",`Unexpected , in ${s}`),v=k,d=!1,u=!1;break}default:a(k,"UNEXPECTED_TOKEN",`Unexpected ${k.type} token`),d=!1,u=!1}const S=t[t.length-1],z=S?S.offset+S.source.length:r;return x&&i&&i.type!=="space"&&i.type!=="newline"&&i.type!=="comma"&&(i.type!=="scalar"||i.source!=="")&&a(i.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),g&&(d&&g.indent<=o||i?.type==="block-map"||i?.type==="block-seq")&&a(g,"TAB_AS_INDENT","Tabs are not allowed as indentation"),{comma:v,found:C,spaceBefore:c,comment:m,hasNewline:y,anchor:j,tag:w,newlineAfterProp:b,end:z,start:_??z}}function vr(t){if(!t)return null;switch(t.type){case"alias":case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":if(t.source.includes(`
`))return!0;if(t.end){for(const s of t.end)if(s.type==="newline")return!0}return!1;case"flow-collection":for(const s of t.items){for(const n of s.start)if(n.type==="newline")return!0;if(s.sep){for(const n of s.sep)if(n.type==="newline")return!0}if(vr(s.key)||vr(s.value))return!0}return!1;default:return!0}}function _l(t,s,n){if(s?.type==="flow-collection"){const i=s.end[0];i.indent===t&&(i.source==="]"||i.source==="}")&&vr(s)&&n(i,"BAD_INDENT","Flow end indicator should be more indented than parent",!0)}}function If(t,s,n){const{uniqueKeys:i}=t.options;if(i===!1)return!1;const r=typeof i=="function"?i:(a,o)=>a===o||ke(a)&&ke(o)&&a.value===o.value;return s.some(a=>r(a.key,n))}const yu="All mapping items must start at the same column";function yk({composeNode:t,composeEmptyNode:s},n,i,r,a){const o=a?.nodeClass??It,l=new o(n.schema);n.atRoot&&(n.atRoot=!1);let c=i.offset,d=null;for(const u of i.items){const{start:m,key:h,sep:y,value:x}=u,g=vi(m,{indicator:"explicit-key-ind",next:h??y?.[0],offset:c,onError:r,parentIndent:i.indent,startOnNewline:!0}),j=!g.found;if(j){if(h&&(h.type==="block-seq"?r(c,"BLOCK_AS_IMPLICIT_KEY","A block sequence may not be used as an implicit map key"):"indent"in h&&h.indent!==i.indent&&r(c,"BAD_INDENT",yu)),!g.anchor&&!g.tag&&!y){d=g.end,g.comment&&(l.comment?l.comment+=`
`+g.comment:l.comment=g.comment);continue}(g.newlineAfterProp||vr(h))&&r(h??m[m.length-1],"MULTILINE_IMPLICIT_KEY","Implicit keys need to be on a single line")}else g.found?.indent!==i.indent&&r(c,"BAD_INDENT",yu);n.atKey=!0;const w=g.end,b=h?t(n,h,g,r):s(n,w,m,null,g,r);n.schema.compat&&_l(i.indent,h,r),n.atKey=!1,If(n,l.items,b)&&r(w,"DUPLICATE_KEY","Map keys must be unique");const v=vi(y??[],{indicator:"map-value-ind",next:x,offset:b.range[2],onError:r,parentIndent:i.indent,startOnNewline:!h||h.type==="block-scalar"});if(c=v.end,v.found){j&&(x?.type==="block-map"&&!v.hasNewline&&r(c,"BLOCK_AS_IMPLICIT_KEY","Nested mappings are not allowed in compact mappings"),n.options.strict&&g.start<v.found.offset-1024&&r(b.range,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit block mapping key"));const C=x?t(n,x,v,r):s(n,c,y,null,v,r);n.schema.compat&&_l(i.indent,x,r),c=C.range[2];const _=new lt(b,C);n.options.keepSourceTokens&&(_.srcToken=u),l.items.push(_)}else{j&&r(b.range,"MISSING_CHAR","Implicit map keys need to be followed by map values"),v.comment&&(b.comment?b.comment+=`
`+v.comment:b.comment=v.comment);const C=new lt(b);n.options.keepSourceTokens&&(C.srcToken=u),l.items.push(C)}}return d&&d<c&&r(d,"IMPOSSIBLE","Map comment with trailing content"),l.range=[i.offset,c,d??c],l}function wk({composeNode:t,composeEmptyNode:s},n,i,r,a){const o=a?.nodeClass??nn,l=new o(n.schema);n.atRoot&&(n.atRoot=!1),n.atKey&&(n.atKey=!1);let c=i.offset,d=null;for(const{start:u,value:m}of i.items){const h=vi(u,{indicator:"seq-item-ind",next:m,offset:c,onError:r,parentIndent:i.indent,startOnNewline:!0});if(!h.found)if(h.anchor||h.tag||m)m&&m.type==="block-seq"?r(h.end,"BAD_INDENT","All sequence items must start at the same column"):r(c,"MISSING_CHAR","Sequence item without - indicator");else{d=h.end,h.comment&&(l.comment=h.comment);continue}const y=m?t(n,m,h,r):s(n,h.end,u,null,h,r);n.schema.compat&&_l(i.indent,m,r),c=y.range[2],l.items.push(y)}return l.range=[i.offset,c,d??c],l}function Br(t,s,n,i){let r="";if(t){let a=!1,o="";for(const l of t){const{source:c,type:d}=l;switch(d){case"space":a=!0;break;case"comment":{n&&!a&&i(l,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const u=c.substring(1)||" ";r?r+=o+u:r=u,o="";break}case"newline":r&&(o+=c),a=!0;break;default:i(l,"UNEXPECTED_TOKEN",`Unexpected ${d} at node end`)}s+=c.length}}return{comment:r,offset:s}}const Go="Block collections are not allowed within flow collections",Zo=t=>t&&(t.type==="block-map"||t.type==="block-seq");function bk({composeNode:t,composeEmptyNode:s},n,i,r,a){const o=i.start.source==="{",l=o?"flow map":"flow sequence",c=a?.nodeClass??(o?It:nn),d=new c(n.schema);d.flow=!0;const u=n.atRoot;u&&(n.atRoot=!1),n.atKey&&(n.atKey=!1);let m=i.offset+i.start.source.length;for(let j=0;j<i.items.length;++j){const w=i.items[j],{start:b,key:v,sep:C,value:_}=w,S=vi(b,{flow:l,indicator:"explicit-key-ind",next:v??C?.[0],offset:m,onError:r,parentIndent:i.indent,startOnNewline:!1});if(!S.found){if(!S.anchor&&!S.tag&&!C&&!_){j===0&&S.comma?r(S.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${l}`):j<i.items.length-1&&r(S.start,"UNEXPECTED_TOKEN",`Unexpected empty item in ${l}`),S.comment&&(d.comment?d.comment+=`
`+S.comment:d.comment=S.comment),m=S.end;continue}!o&&n.options.strict&&vr(v)&&r(v,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line")}if(j===0)S.comma&&r(S.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${l}`);else if(S.comma||r(S.start,"MISSING_CHAR",`Missing , between ${l} items`),S.comment){let z="";e:for(const k of b)switch(k.type){case"comma":case"space":break;case"comment":z=k.source.substring(1);break e;default:break e}if(z){let k=d.items[d.items.length-1];Ae(k)&&(k=k.value??k.key),k.comment?k.comment+=`
`+z:k.comment=z,S.comment=S.comment.substring(z.length+1)}}if(!o&&!C&&!S.found){const z=_?t(n,_,S,r):s(n,S.end,C,null,S,r);d.items.push(z),m=z.range[2],Zo(_)&&r(z.range,"BLOCK_IN_FLOW",Go)}else{n.atKey=!0;const z=S.end,k=v?t(n,v,S,r):s(n,z,b,null,S,r);Zo(v)&&r(k.range,"BLOCK_IN_FLOW",Go),n.atKey=!1;const T=vi(C??[],{flow:l,indicator:"map-value-ind",next:_,offset:k.range[2],onError:r,parentIndent:i.indent,startOnNewline:!1});if(T.found){if(!o&&!S.found&&n.options.strict){if(C)for(const A of C){if(A===T.found)break;if(A.type==="newline"){r(A,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line");break}}S.start<T.found.offset-1024&&r(T.found,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit flow sequence key")}}else _&&("source"in _&&_.source&&_.source[0]===":"?r(_,"MISSING_CHAR",`Missing space after : in ${l}`):r(T.start,"MISSING_CHAR",`Missing , or : between ${l} items`));const p=_?t(n,_,T,r):T.found?s(n,T.end,C,null,T,r):null;p?Zo(_)&&r(p.range,"BLOCK_IN_FLOW",Go):T.comment&&(k.comment?k.comment+=`
`+T.comment:k.comment=T.comment);const N=new lt(k,p);if(n.options.keepSourceTokens&&(N.srcToken=w),o){const A=d;If(n,A.items,k)&&r(z,"DUPLICATE_KEY","Map keys must be unique"),A.items.push(N)}else{const A=new It(n.schema);A.flow=!0,A.items.push(N);const D=(p??k).range;A.range=[k.range[0],D[1],D[2]],d.items.push(A)}m=p?p.range[2]:T.end}}const h=o?"}":"]",[y,...x]=i.end;let g=m;if(y&&y.source===h)g=y.offset+y.source.length;else{const j=l[0].toUpperCase()+l.substring(1),w=u?`${j} must end with a ${h}`:`${j} in block collection must be sufficiently indented and end with a ${h}`;r(m,u?"MISSING_CHAR":"BAD_INDENT",w),y&&y.source.length!==1&&x.unshift(y)}if(x.length>0){const j=Br(x,g,n.options.strict,r);j.comment&&(d.comment?d.comment+=`
`+j.comment:d.comment=j.comment),d.range=[i.offset,g,j.offset]}else d.range=[i.offset,g,g];return d}function Ho(t,s,n,i,r,a){const o=n.type==="block-map"?yk(t,s,n,i,a):n.type==="block-seq"?wk(t,s,n,i,a):bk(t,s,n,i,a),l=o.constructor;return r==="!"||r===l.tagName?(o.tag=l.tagName,o):(r&&(o.tag=r),o)}function vk(t,s,n,i,r){const a=i.tag,o=a?s.directives.tagName(a.source,h=>r(a,"TAG_RESOLVE_FAILED",h)):null;if(n.type==="block-seq"){const{anchor:h,newlineAfterProp:y}=i,x=h&&a?h.offset>a.offset?h:a:h??a;x&&(!y||y.offset<x.offset)&&r(x,"MISSING_CHAR","Missing newline after block sequence props")}const l=n.type==="block-map"?"map":n.type==="block-seq"?"seq":n.start.source==="{"?"map":"seq";if(!a||!o||o==="!"||o===It.tagName&&l==="map"||o===nn.tagName&&l==="seq")return Ho(t,s,n,r,o);let c=s.schema.tags.find(h=>h.tag===o&&h.collection===l);if(!c){const h=s.schema.knownTags[o];if(h&&h.collection===l)s.schema.tags.push(Object.assign({},h,{default:!1})),c=h;else return h?r(a,"BAD_COLLECTION_TYPE",`${h.tag} used for ${l} collection, but expects ${h.collection??"scalar"}`,!0):r(a,"TAG_RESOLVE_FAILED",`Unresolved tag: ${o}`,!0),Ho(t,s,n,r,o)}const d=Ho(t,s,n,r,o,c),u=c.resolve?.(d,h=>r(a,"TAG_RESOLVE_FAILED",h),s.options)??d,m=Ie(u)?u:new ne(u);return m.range=d.range,m.tag=o,c?.format&&(m.format=c.format),m}function Ef(t,s,n){const i=s.offset,r=Nk(s,t.options.strict,n);if(!r)return{value:"",type:null,comment:"",range:[i,i,i]};const a=r.mode===">"?ne.BLOCK_FOLDED:ne.BLOCK_LITERAL,o=s.source?kk(s.source):[];let l=o.length;for(let g=o.length-1;g>=0;--g){const j=o[g][1];if(j===""||j==="\r")l=g;else break}if(l===0){const g=r.chomp==="+"&&o.length>0?`
`.repeat(Math.max(1,o.length-1)):"";let j=i+r.length;return s.source&&(j+=s.source.length),{value:g,type:a,comment:r.comment,range:[i,j,j]}}let c=s.indent+r.indent,d=s.offset+r.length,u=0;for(let g=0;g<l;++g){const[j,w]=o[g];if(w===""||w==="\r")r.indent===0&&j.length>c&&(c=j.length);else{j.length<c&&n(d+j.length,"MISSING_CHAR","Block scalars with more-indented leading empty lines must use an explicit indentation indicator"),r.indent===0&&(c=j.length),u=g,c===0&&!t.atRoot&&n(d,"BAD_INDENT","Block scalar values in collections must be indented");break}d+=j.length+w.length+1}for(let g=o.length-1;g>=l;--g)o[g][0].length>c&&(l=g+1);let m="",h="",y=!1;for(let g=0;g<u;++g)m+=o[g][0].slice(c)+`
`;for(let g=u;g<l;++g){let[j,w]=o[g];d+=j.length+w.length+1;const b=w[w.length-1]==="\r";if(b&&(w=w.slice(0,-1)),w&&j.length<c){const C=`Block scalar lines must not be less indented than their ${r.indent?"explicit indentation indicator":"first line"}`;n(d-w.length-(b?2:1),"BAD_INDENT",C),j=""}a===ne.BLOCK_LITERAL?(m+=h+j.slice(c)+w,h=`
`):j.length>c||w[0]==="	"?(h===" "?h=`
`:!y&&h===`
`&&(h=`

`),m+=h+j.slice(c)+w,h=`
`,y=!0):w===""?h===`
`?m+=`
`:h=`
`:(m+=h+w,h=" ",y=!1)}switch(r.chomp){case"-":break;case"+":for(let g=l;g<o.length;++g)m+=`
`+o[g][0].slice(c);m[m.length-1]!==`
`&&(m+=`
`);break;default:m+=`
`}const x=i+r.length+s.source.length;return{value:m,type:a,comment:r.comment,range:[i,x,x]}}function Nk({offset:t,props:s},n,i){if(s[0].type!=="block-scalar-header")return i(s[0],"IMPOSSIBLE","Block scalar header not found"),null;const{source:r}=s[0],a=r[0];let o=0,l="",c=-1;for(let h=1;h<r.length;++h){const y=r[h];if(!l&&(y==="-"||y==="+"))l=y;else{const x=Number(y);!o&&x?o=x:c===-1&&(c=t+h)}}c!==-1&&i(c,"UNEXPECTED_TOKEN",`Block scalar header includes extra characters: ${r}`);let d=!1,u="",m=r.length;for(let h=1;h<s.length;++h){const y=s[h];switch(y.type){case"space":d=!0;case"newline":m+=y.source.length;break;case"comment":n&&!d&&i(y,"MISSING_CHAR","Comments must be separated from other tokens by white space characters"),m+=y.source.length,u=y.source.substring(1);break;case"error":i(y,"UNEXPECTED_TOKEN",y.message),m+=y.source.length;break;default:{const x=`Unexpected token in block scalar header: ${y.type}`;i(y,"UNEXPECTED_TOKEN",x);const g=y.source;g&&typeof g=="string"&&(m+=g.length)}}}return{mode:a,indent:o,chomp:l,comment:u,length:m}}function kk(t){const s=t.split(/\n( *)/),n=s[0],i=n.match(/^( *)/),a=[i?.[1]?[i[1],n.slice(i[1].length)]:["",n]];for(let o=1;o<s.length;o+=2)a.push([s[o],s[o+1]]);return a}function Rf(t,s,n){const{offset:i,type:r,source:a,end:o}=t;let l,c;const d=(h,y,x)=>n(i+h,y,x);switch(r){case"scalar":l=ne.PLAIN,c=zk(a,d);break;case"single-quoted-scalar":l=ne.QUOTE_SINGLE,c=Sk(a,d);break;case"double-quoted-scalar":l=ne.QUOTE_DOUBLE,c=Ck(a,d);break;default:return n(t,"UNEXPECTED_TOKEN",`Expected a flow scalar value, but found: ${r}`),{value:"",type:null,comment:"",range:[i,i+a.length,i+a.length]}}const u=i+a.length,m=Br(o,u,s,n);return{value:c,type:l,comment:m.comment,range:[i,u,m.offset]}}function zk(t,s){let n="";switch(t[0]){case"	":n="a tab character";break;case",":n="flow indicator character ,";break;case"%":n="directive indicator character %";break;case"|":case">":{n=`block scalar indicator ${t[0]}`;break}case"@":case"`":{n=`reserved character ${t[0]}`;break}}return n&&s(0,"BAD_SCALAR_START",`Plain value cannot start with ${n}`),Lf(t)}function Sk(t,s){return(t[t.length-1]!=="'"||t.length===1)&&s(t.length,"MISSING_CHAR","Missing closing 'quote"),Lf(t.slice(1,-1)).replace(/''/g,"'")}function Lf(t){let s,n;try{s=new RegExp(`(.*?)(?<![ 	])[ 	]*\r?
`,"sy"),n=new RegExp(`[ 	]*(.*?)(?:(?<![ 	])[ 	]*)?\r?
`,"sy")}catch{s=/(.*?)[ \t]*\r?\n/sy,n=/[ \t]*(.*?)[ \t]*\r?\n/sy}let i=s.exec(t);if(!i)return t;let r=i[1],a=" ",o=s.lastIndex;for(n.lastIndex=o;i=n.exec(t);)i[1]===""?a===`
`?r+=a:a=`
`:(r+=a+i[1],a=" "),o=n.lastIndex;const l=/[ \t]*(.*)/sy;return l.lastIndex=o,i=l.exec(t),r+a+(i?.[1]??"")}function Ck(t,s){let n="";for(let i=1;i<t.length-1;++i){const r=t[i];if(!(r==="\r"&&t[i+1]===`
`))if(r===`
`){const{fold:a,offset:o}=_k(t,i);n+=a,i=o}else if(r==="\\"){let a=t[++i];const o=Tk[a];if(o)n+=o;else if(a===`
`)for(a=t[i+1];a===" "||a==="	";)a=t[++i+1];else if(a==="\r"&&t[i+1]===`
`)for(a=t[++i+1];a===" "||a==="	";)a=t[++i+1];else if(a==="x"||a==="u"||a==="U"){const l={x:2,u:4,U:8}[a];n+=Ak(t,i+1,l,s),i+=l}else{const l=t.substr(i-1,2);s(i-1,"BAD_DQ_ESCAPE",`Invalid escape sequence ${l}`),n+=l}}else if(r===" "||r==="	"){const a=i;let o=t[i+1];for(;o===" "||o==="	";)o=t[++i+1];o!==`
`&&!(o==="\r"&&t[i+2]===`
`)&&(n+=i>a?t.slice(a,i+1):r)}else n+=r}return(t[t.length-1]!=='"'||t.length===1)&&s(t.length,"MISSING_CHAR",'Missing closing "quote'),n}function _k(t,s){let n="",i=t[s+1];for(;(i===" "||i==="	"||i===`
`||i==="\r")&&!(i==="\r"&&t[s+2]!==`
`);)i===`
`&&(n+=`
`),s+=1,i=t[s+1];return n||(n=" "),{fold:n,offset:s}}const Tk={0:"\0",a:"\x07",b:"\b",e:"\x1B",f:"\f",n:`
`,r:"\r",t:"	",v:"\v",N:"",_:"",L:"\u2028",P:"\u2029"," ":" ",'"':'"',"/":"/","\\":"\\","	":"	"};function Ak(t,s,n,i){const r=t.substr(s,n),o=r.length===n&&/^[0-9a-fA-F]+$/.test(r)?parseInt(r,16):NaN;if(isNaN(o)){const l=t.substr(s-2,n+2);return i(s-2,"BAD_DQ_ESCAPE",`Invalid escape sequence ${l}`),l}return String.fromCodePoint(o)}function Of(t,s,n,i){const{value:r,type:a,comment:o,range:l}=s.type==="block-scalar"?Ef(t,s,i):Rf(s,t.options.strict,i),c=n?t.directives.tagName(n.source,m=>i(n,"TAG_RESOLVE_FAILED",m)):null;let d;t.options.stringKeys&&t.atKey?d=t.schema[bs]:c?d=Dk(t.schema,r,c,n,i):s.type==="scalar"?d=Pk(t,r,s,i):d=t.schema[bs];let u;try{const m=d.resolve(r,h=>i(n??s,"TAG_RESOLVE_FAILED",h),t.options);u=ke(m)?m:new ne(m)}catch(m){const h=m instanceof Error?m.message:String(m);i(n??s,"TAG_RESOLVE_FAILED",h),u=new ne(r)}return u.range=l,u.source=r,a&&(u.type=a),c&&(u.tag=c),d.format&&(u.format=d.format),o&&(u.comment=o),u}function Dk(t,s,n,i,r){if(n==="!")return t[bs];const a=[];for(const l of t.tags)if(!l.collection&&l.tag===n)if(l.default&&l.test)a.push(l);else return l;for(const l of a)if(l.test?.test(s))return l;const o=t.knownTags[n];return o&&!o.collection?(t.tags.push(Object.assign({},o,{default:!1,test:void 0})),o):(r(i,"TAG_RESOLVE_FAILED",`Unresolved tag: ${n}`,n!=="tag:yaml.org,2002:str"),t[bs])}function Pk({atKey:t,directives:s,schema:n},i,r,a){const o=n.tags.find(l=>(l.default===!0||t&&l.default==="key")&&l.test?.test(i))||n[bs];if(n.compat){const l=n.compat.find(c=>c.default&&c.test?.test(i))??n[bs];if(o.tag!==l.tag){const c=s.tagString(o.tag),d=s.tagString(l.tag),u=`Value may be parsed as either ${c} or ${d}`;a(r,"TAG_RESOLVE_FAILED",u,!0)}}return o}function Mk(t,s,n){if(s){n??(n=s.length);for(let i=n-1;i>=0;--i){let r=s[i];switch(r.type){case"space":case"comment":case"newline":t-=r.source.length;continue}for(r=s[++i];r?.type==="space";)t+=r.source.length,r=s[++i];break}}return t}const Ik={composeNode:$f,composeEmptyNode:Ec};function $f(t,s,n,i){const r=t.atKey,{spaceBefore:a,comment:o,anchor:l,tag:c}=n;let d,u=!0;switch(s.type){case"alias":d=Ek(t,s,i),(l||c)&&i(s,"ALIAS_PROPS","An alias node must not specify any properties");break;case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"block-scalar":d=Of(t,s,c,i),l&&(d.anchor=l.source.substring(1));break;case"block-map":case"block-seq":case"flow-collection":d=vk(Ik,t,s,n,i),l&&(d.anchor=l.source.substring(1));break;default:{const m=s.type==="error"?s.message:`Unsupported token (type: ${s.type})`;i(s,"UNEXPECTED_TOKEN",m),d=Ec(t,s.offset,void 0,null,n,i),u=!1}}return l&&d.anchor===""&&i(l,"BAD_ALIAS","Anchor cannot be an empty string"),r&&t.options.stringKeys&&(!ke(d)||typeof d.value!="string"||d.tag&&d.tag!=="tag:yaml.org,2002:str")&&i(c??s,"NON_STRING_KEY","With stringKeys, all keys must be strings"),a&&(d.spaceBefore=!0),o&&(s.type==="scalar"&&s.source===""?d.comment=o:d.commentBefore=o),t.options.keepSourceTokens&&u&&(d.srcToken=s),d}function Ec(t,s,n,i,{spaceBefore:r,comment:a,anchor:o,tag:l,end:c},d){const u={type:"scalar",offset:Mk(s,n,i),indent:-1,source:""},m=Of(t,u,l,d);return o&&(m.anchor=o.source.substring(1),m.anchor===""&&d(o,"BAD_ALIAS","Anchor cannot be an empty string")),r&&(m.spaceBefore=!0),a&&(m.comment=a,m.range[2]=c),m}function Ek({options:t},{offset:s,source:n,end:i},r){const a=new lo(n.substring(1));a.source===""&&r(s,"BAD_ALIAS","Alias cannot be an empty string"),a.source.endsWith(":")&&r(s+n.length-1,"BAD_ALIAS","Alias ending in : is ambiguous",!0);const o=s+n.length,l=Br(i,o,t.strict,r);return a.range=[s,o,l.offset],l.comment&&(a.comment=l.comment),a}function Rk(t,s,{offset:n,start:i,value:r,end:a},o){const l=Object.assign({_directives:s},t),c=new Ii(void 0,l),d={atKey:!1,atRoot:!0,directives:c.directives,options:c.options,schema:c.schema},u=vi(i,{indicator:"doc-start",next:r??a?.[0],offset:n,onError:o,parentIndent:0,startOnNewline:!0});u.found&&(c.directives.docStart=!0,r&&(r.type==="block-map"||r.type==="block-seq")&&!u.hasNewline&&o(u.end,"MISSING_CHAR","Block collection cannot start on same line with directives-end marker")),c.contents=r?$f(d,r,u,o):Ec(d,u.end,i,null,u,o);const m=c.contents.range[2],h=Br(a,m,!1,o);return h.comment&&(c.comment=h.comment),c.range=[n,m,h.offset],c}function Gi(t){if(typeof t=="number")return[t,t+1];if(Array.isArray(t))return t.length===2?t:[t[0],t[1]];const{offset:s,source:n}=t;return[s,s+(typeof n=="string"?n.length:1)]}function wu(t){let s="",n=!1,i=!1;for(let r=0;r<t.length;++r){const a=t[r];switch(a[0]){case"#":s+=(s===""?"":i?`

`:`
`)+(a.substring(1)||" "),n=!0,i=!1;break;case"%":t[r+1]?.[0]!=="#"&&(r+=1),n=!1;break;default:n||(i=!0),n=!1}}return{comment:s,afterEmptyLine:i}}class Rc{constructor(s={}){this.doc=null,this.atDirectives=!1,this.prelude=[],this.errors=[],this.warnings=[],this.onError=(n,i,r,a)=>{const o=Gi(n);a?this.warnings.push(new Mf(o,i,r)):this.errors.push(new wn(o,i,r))},this.directives=new pt({version:s.version||"1.2"}),this.options=s}decorate(s,n){const{comment:i,afterEmptyLine:r}=wu(this.prelude);if(i){const a=s.contents;if(n)s.comment=s.comment?`${s.comment}
${i}`:i;else if(r||s.directives.docStart||!a)s.commentBefore=i;else if(De(a)&&!a.flow&&a.items.length>0){let o=a.items[0];Ae(o)&&(o=o.key);const l=o.commentBefore;o.commentBefore=l?`${i}
${l}`:i}else{const o=a.commentBefore;a.commentBefore=o?`${i}
${o}`:i}}n?(Array.prototype.push.apply(s.errors,this.errors),Array.prototype.push.apply(s.warnings,this.warnings)):(s.errors=this.errors,s.warnings=this.warnings),this.prelude=[],this.errors=[],this.warnings=[]}streamInfo(){return{comment:wu(this.prelude).comment,directives:this.directives,errors:this.errors,warnings:this.warnings}}*compose(s,n=!1,i=-1){for(const r of s)yield*this.next(r);yield*this.end(n,i)}*next(s){switch(s.type){case"directive":this.directives.add(s.source,(n,i,r)=>{const a=Gi(s);a[0]+=n,this.onError(a,"BAD_DIRECTIVE",i,r)}),this.prelude.push(s.source),this.atDirectives=!0;break;case"document":{const n=Rk(this.options,this.directives,s,this.onError);this.atDirectives&&!n.directives.docStart&&this.onError(s,"MISSING_CHAR","Missing directives-end/doc-start indicator line"),this.decorate(n,!1),this.doc&&(yield this.doc),this.doc=n,this.atDirectives=!1;break}case"byte-order-mark":case"space":break;case"comment":case"newline":this.prelude.push(s.source);break;case"error":{const n=s.source?`${s.message}: ${JSON.stringify(s.source)}`:s.message,i=new wn(Gi(s),"UNEXPECTED_TOKEN",n);this.atDirectives||!this.doc?this.errors.push(i):this.doc.errors.push(i);break}case"doc-end":{if(!this.doc){const i="Unexpected doc-end without preceding document";this.errors.push(new wn(Gi(s),"UNEXPECTED_TOKEN",i));break}this.doc.directives.docEnd=!0;const n=Br(s.end,s.offset+s.source.length,this.doc.options.strict,this.onError);if(this.decorate(this.doc,!0),n.comment){const i=this.doc.comment;this.doc.comment=i?`${i}
${n.comment}`:n.comment}this.doc.range[2]=n.offset;break}default:this.errors.push(new wn(Gi(s),"UNEXPECTED_TOKEN",`Unsupported token ${s.type}`))}}*end(s=!1,n=-1){if(this.doc)this.decorate(this.doc,!0),yield this.doc,this.doc=null;else if(s){const i=Object.assign({_directives:this.directives},this.options),r=new Ii(void 0,i);this.atDirectives&&this.onError(n,"MISSING_CHAR","Missing directives-end indicator line"),r.range=[0,n,n],this.decorate(r,!1),yield r}}}function Lk(t,s=!0,n){if(t){const i=(r,a,o)=>{const l=typeof r=="number"?r:Array.isArray(r)?r[0]:r.offset;if(n)n(l,a,o);else throw new wn([l,l+1],a,o)};switch(t.type){case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return Rf(t,s,i);case"block-scalar":return Ef({options:{strict:s}},t,i)}}return null}function Ok(t,s){const{implicitKey:n=!1,indent:i,inFlow:r=!1,offset:a=-1,type:o="PLAIN"}=s,l=Fr({type:o,value:t},{implicitKey:n,indent:i>0?" ".repeat(i):"",inFlow:r,options:{blockQuote:!0,lineWidth:-1}}),c=s.end??[{type:"newline",offset:-1,indent:i,source:`
`}];switch(l[0]){case"|":case">":{const d=l.indexOf(`
`),u=l.substring(0,d),m=l.substring(d+1)+`
`,h=[{type:"block-scalar-header",offset:a,indent:i,source:u}];return Ff(h,c)||h.push({type:"newline",offset:-1,indent:i,source:`
`}),{type:"block-scalar",offset:a,indent:i,props:h,source:m}}case'"':return{type:"double-quoted-scalar",offset:a,indent:i,source:l,end:c};case"'":return{type:"single-quoted-scalar",offset:a,indent:i,source:l,end:c};default:return{type:"scalar",offset:a,indent:i,source:l,end:c}}}function $k(t,s,n={}){let{afterKey:i=!1,implicitKey:r=!1,inFlow:a=!1,type:o}=n,l="indent"in t?t.indent:null;if(i&&typeof l=="number"&&(l+=2),!o)switch(t.type){case"single-quoted-scalar":o="QUOTE_SINGLE";break;case"double-quoted-scalar":o="QUOTE_DOUBLE";break;case"block-scalar":{const d=t.props[0];if(d.type!=="block-scalar-header")throw new Error("Invalid block scalar header");o=d.source[0]===">"?"BLOCK_FOLDED":"BLOCK_LITERAL";break}default:o="PLAIN"}const c=Fr({type:o,value:s},{implicitKey:r||l===null,indent:l!==null&&l>0?" ".repeat(l):"",inFlow:a,options:{blockQuote:!0,lineWidth:-1}});switch(c[0]){case"|":case">":Fk(t,c);break;case'"':Qo(t,c,"double-quoted-scalar");break;case"'":Qo(t,c,"single-quoted-scalar");break;default:Qo(t,c,"scalar")}}function Fk(t,s){const n=s.indexOf(`
`),i=s.substring(0,n),r=s.substring(n+1)+`
`;if(t.type==="block-scalar"){const a=t.props[0];if(a.type!=="block-scalar-header")throw new Error("Invalid block scalar header");a.source=i,t.source=r}else{const{offset:a}=t,o="indent"in t?t.indent:-1,l=[{type:"block-scalar-header",offset:a,indent:o,source:i}];Ff(l,"end"in t?t.end:void 0)||l.push({type:"newline",offset:-1,indent:o,source:`
`});for(const c of Object.keys(t))c!=="type"&&c!=="offset"&&delete t[c];Object.assign(t,{type:"block-scalar",indent:o,props:l,source:r})}}function Ff(t,s){if(s)for(const n of s)switch(n.type){case"space":case"comment":t.push(n);break;case"newline":return t.push(n),!0}return!1}function Qo(t,s,n){switch(t.type){case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":t.type=n,t.source=s;break;case"block-scalar":{const i=t.props.slice(1);let r=s.length;t.props[0].type==="block-scalar-header"&&(r-=t.props[0].source.length);for(const a of i)a.offset+=r;delete t.props,Object.assign(t,{type:n,source:s,end:i});break}case"block-map":case"block-seq":{const r={type:"newline",offset:t.offset+s.length,indent:t.indent,source:`
`};delete t.items,Object.assign(t,{type:n,source:s,end:[r]});break}default:{const i="indent"in t?t.indent:-1,r="end"in t&&Array.isArray(t.end)?t.end.filter(a=>a.type==="space"||a.type==="comment"||a.type==="newline"):[];for(const a of Object.keys(t))a!=="type"&&a!=="offset"&&delete t[a];Object.assign(t,{type:n,indent:i,source:s,end:r})}}}const qk=t=>"type"in t?Ma(t):ya(t);function Ma(t){switch(t.type){case"block-scalar":{let s="";for(const n of t.props)s+=Ma(n);return s+t.source}case"block-map":case"block-seq":{let s="";for(const n of t.items)s+=ya(n);return s}case"flow-collection":{let s=t.start.source;for(const n of t.items)s+=ya(n);for(const n of t.end)s+=n.source;return s}case"document":{let s=ya(t);if(t.end)for(const n of t.end)s+=n.source;return s}default:{let s=t.source;if("end"in t&&t.end)for(const n of t.end)s+=n.source;return s}}}function ya({start:t,key:s,sep:n,value:i}){let r="";for(const a of t)r+=a.source;if(s&&(r+=Ma(s)),n)for(const a of n)r+=a.source;return i&&(r+=Ma(i)),r}const Tl=Symbol("break visit"),Bk=Symbol("skip children"),qf=Symbol("remove item");function _n(t,s){"type"in t&&t.type==="document"&&(t={start:t.start,value:t.value}),Bf(Object.freeze([]),t,s)}_n.BREAK=Tl;_n.SKIP=Bk;_n.REMOVE=qf;_n.itemAtPath=(t,s)=>{let n=t;for(const[i,r]of s){const a=n?.[i];if(a&&"items"in a)n=a.items[r];else return}return n};_n.parentCollection=(t,s)=>{const n=_n.itemAtPath(t,s.slice(0,-1)),i=s[s.length-1][0],r=n?.[i];if(r&&"items"in r)return r;throw new Error("Parent collection not found")};function Bf(t,s,n){let i=n(s,t);if(typeof i=="symbol")return i;for(const r of["key","value"]){const a=s[r];if(a&&"items"in a){for(let o=0;o<a.items.length;++o){const l=Bf(Object.freeze(t.concat([[r,o]])),a.items[o],n);if(typeof l=="number")o=l-1;else{if(l===Tl)return Tl;l===qf&&(a.items.splice(o,1),o-=1)}}typeof i=="function"&&r==="key"&&(i=i(s,t))}}return typeof i=="function"?i(s,t):i}const yo="\uFEFF",wo="",bo="",Nr="",Uk=t=>!!t&&"items"in t,Vk=t=>!!t&&(t.type==="scalar"||t.type==="single-quoted-scalar"||t.type==="double-quoted-scalar"||t.type==="block-scalar");function Kk(t){switch(t){case yo:return"<BOM>";case wo:return"<DOC>";case bo:return"<FLOW_END>";case Nr:return"<SCALAR>";default:return JSON.stringify(t)}}function Uf(t){switch(t){case yo:return"byte-order-mark";case wo:return"doc-mode";case bo:return"flow-error-end";case Nr:return"scalar";case"---":return"doc-start";case"...":return"doc-end";case"":case`
`:case`\r
`:return"newline";case"-":return"seq-item-ind";case"?":return"explicit-key-ind";case":":return"map-value-ind";case"{":return"flow-map-start";case"}":return"flow-map-end";case"[":return"flow-seq-start";case"]":return"flow-seq-end";case",":return"comma"}switch(t[0]){case" ":case"	":return"space";case"#":return"comment";case"%":return"directive-line";case"*":return"alias";case"&":return"anchor";case"!":return"tag";case"'":return"single-quoted-scalar";case'"':return"double-quoted-scalar";case"|":case">":return"block-scalar-header"}return null}const Wk=Object.freeze(Object.defineProperty({__proto__:null,BOM:yo,DOCUMENT:wo,FLOW_END:bo,SCALAR:Nr,createScalarToken:Ok,isCollection:Uk,isScalar:Vk,prettyToken:Kk,resolveAsScalar:Lk,setScalarValue:$k,stringify:qk,tokenType:Uf,visit:_n},Symbol.toStringTag,{value:"Module"}));function ss(t){switch(t){case void 0:case" ":case`
`:case"\r":case"	":return!0;default:return!1}}const bu=new Set("0123456789ABCDEFabcdef"),Gk=new Set("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-#;/?:@&=+$_.!~*'()"),aa=new Set(",[]{}"),Zk=new Set(` ,[]{}
\r	`),Yo=t=>!t||Zk.has(t);class Vf{constructor(){this.atEnd=!1,this.blockScalarIndent=-1,this.blockScalarKeep=!1,this.buffer="",this.flowKey=!1,this.flowLevel=0,this.indentNext=0,this.indentValue=0,this.lineEndPos=null,this.next=null,this.pos=0}*lex(s,n=!1){if(s){if(typeof s!="string")throw TypeError("source is not a string");this.buffer=this.buffer?this.buffer+s:s,this.lineEndPos=null}this.atEnd=!n;let i=this.next??"stream";for(;i&&(n||this.hasChars(1));)i=yield*this.parseNext(i)}atLineEnd(){let s=this.pos,n=this.buffer[s];for(;n===" "||n==="	";)n=this.buffer[++s];return!n||n==="#"||n===`
`?!0:n==="\r"?this.buffer[s+1]===`
`:!1}charAt(s){return this.buffer[this.pos+s]}continueScalar(s){let n=this.buffer[s];if(this.indentNext>0){let i=0;for(;n===" ";)n=this.buffer[++i+s];if(n==="\r"){const r=this.buffer[i+s+1];if(r===`
`||!r&&!this.atEnd)return s+i+1}return n===`
`||i>=this.indentNext||!n&&!this.atEnd?s+i:-1}if(n==="-"||n==="."){const i=this.buffer.substr(s,3);if((i==="---"||i==="...")&&ss(this.buffer[s+3]))return-1}return s}getLine(){let s=this.lineEndPos;return(typeof s!="number"||s!==-1&&s<this.pos)&&(s=this.buffer.indexOf(`
`,this.pos),this.lineEndPos=s),s===-1?this.atEnd?this.buffer.substring(this.pos):null:(this.buffer[s-1]==="\r"&&(s-=1),this.buffer.substring(this.pos,s))}hasChars(s){return this.pos+s<=this.buffer.length}setNext(s){return this.buffer=this.buffer.substring(this.pos),this.pos=0,this.lineEndPos=null,this.next=s,null}peek(s){return this.buffer.substr(this.pos,s)}*parseNext(s){switch(s){case"stream":return yield*this.parseStream();case"line-start":return yield*this.parseLineStart();case"block-start":return yield*this.parseBlockStart();case"doc":return yield*this.parseDocument();case"flow":return yield*this.parseFlowCollection();case"quoted-scalar":return yield*this.parseQuotedScalar();case"block-scalar":return yield*this.parseBlockScalar();case"plain-scalar":return yield*this.parsePlainScalar()}}*parseStream(){let s=this.getLine();if(s===null)return this.setNext("stream");if(s[0]===yo&&(yield*this.pushCount(1),s=s.substring(1)),s[0]==="%"){let n=s.length,i=s.indexOf("#");for(;i!==-1;){const a=s[i-1];if(a===" "||a==="	"){n=i-1;break}else i=s.indexOf("#",i+1)}for(;;){const a=s[n-1];if(a===" "||a==="	")n-=1;else break}const r=(yield*this.pushCount(n))+(yield*this.pushSpaces(!0));return yield*this.pushCount(s.length-r),this.pushNewline(),"stream"}if(this.atLineEnd()){const n=yield*this.pushSpaces(!0);return yield*this.pushCount(s.length-n),yield*this.pushNewline(),"stream"}return yield wo,yield*this.parseLineStart()}*parseLineStart(){const s=this.charAt(0);if(!s&&!this.atEnd)return this.setNext("line-start");if(s==="-"||s==="."){if(!this.atEnd&&!this.hasChars(4))return this.setNext("line-start");const n=this.peek(3);if((n==="---"||n==="...")&&ss(this.charAt(3)))return yield*this.pushCount(3),this.indentValue=0,this.indentNext=0,n==="---"?"doc":"stream"}return this.indentValue=yield*this.pushSpaces(!1),this.indentNext>this.indentValue&&!ss(this.charAt(1))&&(this.indentNext=this.indentValue),yield*this.parseBlockStart()}*parseBlockStart(){const[s,n]=this.peek(2);if(!n&&!this.atEnd)return this.setNext("block-start");if((s==="-"||s==="?"||s===":")&&ss(n)){const i=(yield*this.pushCount(1))+(yield*this.pushSpaces(!0));return this.indentNext=this.indentValue+1,this.indentValue+=i,yield*this.parseBlockStart()}return"doc"}*parseDocument(){yield*this.pushSpaces(!0);const s=this.getLine();if(s===null)return this.setNext("doc");let n=yield*this.pushIndicators();switch(s[n]){case"#":yield*this.pushCount(s.length-n);case void 0:return yield*this.pushNewline(),yield*this.parseLineStart();case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel=1,"flow";case"}":case"]":return yield*this.pushCount(1),"doc";case"*":return yield*this.pushUntil(Yo),"doc";case'"':case"'":return yield*this.parseQuotedScalar();case"|":case">":return n+=yield*this.parseBlockScalarHeader(),n+=yield*this.pushSpaces(!0),yield*this.pushCount(s.length-n),yield*this.pushNewline(),yield*this.parseBlockScalar();default:return yield*this.parsePlainScalar()}}*parseFlowCollection(){let s,n,i=-1;do s=yield*this.pushNewline(),s>0?(n=yield*this.pushSpaces(!1),this.indentValue=i=n):n=0,n+=yield*this.pushSpaces(!0);while(s+n>0);const r=this.getLine();if(r===null)return this.setNext("flow");if((i!==-1&&i<this.indentNext&&r[0]!=="#"||i===0&&(r.startsWith("---")||r.startsWith("..."))&&ss(r[3]))&&!(i===this.indentNext-1&&this.flowLevel===1&&(r[0]==="]"||r[0]==="}")))return this.flowLevel=0,yield bo,yield*this.parseLineStart();let a=0;for(;r[a]===",";)a+=yield*this.pushCount(1),a+=yield*this.pushSpaces(!0),this.flowKey=!1;switch(a+=yield*this.pushIndicators(),r[a]){case void 0:return"flow";case"#":return yield*this.pushCount(r.length-a),"flow";case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel+=1,"flow";case"}":case"]":return yield*this.pushCount(1),this.flowKey=!0,this.flowLevel-=1,this.flowLevel?"flow":"doc";case"*":return yield*this.pushUntil(Yo),"flow";case'"':case"'":return this.flowKey=!0,yield*this.parseQuotedScalar();case":":{const o=this.charAt(1);if(this.flowKey||ss(o)||o===",")return this.flowKey=!1,yield*this.pushCount(1),yield*this.pushSpaces(!0),"flow"}default:return this.flowKey=!1,yield*this.parsePlainScalar()}}*parseQuotedScalar(){const s=this.charAt(0);let n=this.buffer.indexOf(s,this.pos+1);if(s==="'")for(;n!==-1&&this.buffer[n+1]==="'";)n=this.buffer.indexOf("'",n+2);else for(;n!==-1;){let a=0;for(;this.buffer[n-1-a]==="\\";)a+=1;if(a%2===0)break;n=this.buffer.indexOf('"',n+1)}const i=this.buffer.substring(0,n);let r=i.indexOf(`
`,this.pos);if(r!==-1){for(;r!==-1;){const a=this.continueScalar(r+1);if(a===-1)break;r=i.indexOf(`
`,a)}r!==-1&&(n=r-(i[r-1]==="\r"?2:1))}if(n===-1){if(!this.atEnd)return this.setNext("quoted-scalar");n=this.buffer.length}return yield*this.pushToIndex(n+1,!1),this.flowLevel?"flow":"doc"}*parseBlockScalarHeader(){this.blockScalarIndent=-1,this.blockScalarKeep=!1;let s=this.pos;for(;;){const n=this.buffer[++s];if(n==="+")this.blockScalarKeep=!0;else if(n>"0"&&n<="9")this.blockScalarIndent=Number(n)-1;else if(n!=="-")break}return yield*this.pushUntil(n=>ss(n)||n==="#")}*parseBlockScalar(){let s=this.pos-1,n=0,i;e:for(let a=this.pos;i=this.buffer[a];++a)switch(i){case" ":n+=1;break;case`
`:s=a,n=0;break;case"\r":{const o=this.buffer[a+1];if(!o&&!this.atEnd)return this.setNext("block-scalar");if(o===`
`)break}default:break e}if(!i&&!this.atEnd)return this.setNext("block-scalar");if(n>=this.indentNext){this.blockScalarIndent===-1?this.indentNext=n:this.indentNext=this.blockScalarIndent+(this.indentNext===0?1:this.indentNext);do{const a=this.continueScalar(s+1);if(a===-1)break;s=this.buffer.indexOf(`
`,a)}while(s!==-1);if(s===-1){if(!this.atEnd)return this.setNext("block-scalar");s=this.buffer.length}}let r=s+1;for(i=this.buffer[r];i===" ";)i=this.buffer[++r];if(i==="	"){for(;i==="	"||i===" "||i==="\r"||i===`
`;)i=this.buffer[++r];s=r-1}else if(!this.blockScalarKeep)do{let a=s-1,o=this.buffer[a];o==="\r"&&(o=this.buffer[--a]);const l=a;for(;o===" ";)o=this.buffer[--a];if(o===`
`&&a>=this.pos&&a+1+n>l)s=a;else break}while(!0);return yield Nr,yield*this.pushToIndex(s+1,!0),yield*this.parseLineStart()}*parsePlainScalar(){const s=this.flowLevel>0;let n=this.pos-1,i=this.pos-1,r;for(;r=this.buffer[++i];)if(r===":"){const a=this.buffer[i+1];if(ss(a)||s&&aa.has(a))break;n=i}else if(ss(r)){let a=this.buffer[i+1];if(r==="\r"&&(a===`
`?(i+=1,r=`
`,a=this.buffer[i+1]):n=i),a==="#"||s&&aa.has(a))break;if(r===`
`){const o=this.continueScalar(i+1);if(o===-1)break;i=Math.max(i,o-2)}}else{if(s&&aa.has(r))break;n=i}return!r&&!this.atEnd?this.setNext("plain-scalar"):(yield Nr,yield*this.pushToIndex(n+1,!0),s?"flow":"doc")}*pushCount(s){return s>0?(yield this.buffer.substr(this.pos,s),this.pos+=s,s):0}*pushToIndex(s,n){const i=this.buffer.slice(this.pos,s);return i?(yield i,this.pos+=i.length,i.length):(n&&(yield""),0)}*pushIndicators(){switch(this.charAt(0)){case"!":return(yield*this.pushTag())+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"&":return(yield*this.pushUntil(Yo))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"-":case"?":case":":{const s=this.flowLevel>0,n=this.charAt(1);if(ss(n)||s&&aa.has(n))return s?this.flowKey&&(this.flowKey=!1):this.indentNext=this.indentValue+1,(yield*this.pushCount(1))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators())}}return 0}*pushTag(){if(this.charAt(1)==="<"){let s=this.pos+2,n=this.buffer[s];for(;!ss(n)&&n!==">";)n=this.buffer[++s];return yield*this.pushToIndex(n===">"?s+1:s,!1)}else{let s=this.pos+1,n=this.buffer[s];for(;n;)if(Gk.has(n))n=this.buffer[++s];else if(n==="%"&&bu.has(this.buffer[s+1])&&bu.has(this.buffer[s+2]))n=this.buffer[s+=3];else break;return yield*this.pushToIndex(s,!1)}}*pushNewline(){const s=this.buffer[this.pos];return s===`
`?yield*this.pushCount(1):s==="\r"&&this.charAt(1)===`
`?yield*this.pushCount(2):0}*pushSpaces(s){let n=this.pos-1,i;do i=this.buffer[++n];while(i===" "||s&&i==="	");const r=n-this.pos;return r>0&&(yield this.buffer.substr(this.pos,r),this.pos=n),r}*pushUntil(s){let n=this.pos,i=this.buffer[n];for(;!s(i);)i=this.buffer[++n];return yield*this.pushToIndex(n,!1)}}class Kf{constructor(){this.lineStarts=[],this.addNewLine=s=>this.lineStarts.push(s),this.linePos=s=>{let n=0,i=this.lineStarts.length;for(;n<i;){const a=n+i>>1;this.lineStarts[a]<s?n=a+1:i=a}if(this.lineStarts[n]===s)return{line:n+1,col:1};if(n===0)return{line:0,col:s};const r=this.lineStarts[n-1];return{line:n,col:s-r+1}}}}function Gs(t,s){for(let n=0;n<t.length;++n)if(t[n].type===s)return!0;return!1}function vu(t){for(let s=0;s<t.length;++s)switch(t[s].type){case"space":case"comment":case"newline":break;default:return s}return-1}function Wf(t){switch(t?.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"flow-collection":return!0;default:return!1}}function oa(t){switch(t.type){case"document":return t.start;case"block-map":{const s=t.items[t.items.length-1];return s.sep??s.start}case"block-seq":return t.items[t.items.length-1].start;default:return[]}}function Yn(t){if(t.length===0)return[];let s=t.length;e:for(;--s>=0;)switch(t[s].type){case"doc-start":case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":case"newline":break e}for(;t[++s]?.type==="space";);return t.splice(s,t.length)}function Nu(t){if(t.start.type==="flow-seq-start")for(const s of t.items)s.sep&&!s.value&&!Gs(s.start,"explicit-key-ind")&&!Gs(s.sep,"map-value-ind")&&(s.key&&(s.value=s.key),delete s.key,Wf(s.value)?s.value.end?Array.prototype.push.apply(s.value.end,s.sep):s.value.end=s.sep:Array.prototype.push.apply(s.start,s.sep),delete s.sep)}class Lc{constructor(s){this.atNewLine=!0,this.atScalar=!1,this.indent=0,this.offset=0,this.onKeyLine=!1,this.stack=[],this.source="",this.type="",this.lexer=new Vf,this.onNewLine=s}*parse(s,n=!1){this.onNewLine&&this.offset===0&&this.onNewLine(0);for(const i of this.lexer.lex(s,n))yield*this.next(i);n||(yield*this.end())}*next(s){if(this.source=s,this.atScalar){this.atScalar=!1,yield*this.step(),this.offset+=s.length;return}const n=Uf(s);if(n)if(n==="scalar")this.atNewLine=!1,this.atScalar=!0,this.type="scalar";else{switch(this.type=n,yield*this.step(),n){case"newline":this.atNewLine=!0,this.indent=0,this.onNewLine&&this.onNewLine(this.offset+s.length);break;case"space":this.atNewLine&&s[0]===" "&&(this.indent+=s.length);break;case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":this.atNewLine&&(this.indent+=s.length);break;case"doc-mode":case"flow-error-end":return;default:this.atNewLine=!1}this.offset+=s.length}else{const i=`Not a YAML token: ${s}`;yield*this.pop({type:"error",offset:this.offset,message:i,source:s}),this.offset+=s.length}}*end(){for(;this.stack.length>0;)yield*this.pop()}get sourceToken(){return{type:this.type,offset:this.offset,indent:this.indent,source:this.source}}*step(){const s=this.peek(1);if(this.type==="doc-end"&&(!s||s.type!=="doc-end")){for(;this.stack.length>0;)yield*this.pop();this.stack.push({type:"doc-end",offset:this.offset,source:this.source});return}if(!s)return yield*this.stream();switch(s.type){case"document":return yield*this.document(s);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return yield*this.scalar(s);case"block-scalar":return yield*this.blockScalar(s);case"block-map":return yield*this.blockMap(s);case"block-seq":return yield*this.blockSequence(s);case"flow-collection":return yield*this.flowCollection(s);case"doc-end":return yield*this.documentEnd(s)}yield*this.pop()}peek(s){return this.stack[this.stack.length-s]}*pop(s){const n=s??this.stack.pop();if(!n)yield{type:"error",offset:this.offset,source:"",message:"Tried to pop an empty stack"};else if(this.stack.length===0)yield n;else{const i=this.peek(1);switch(n.type==="block-scalar"?n.indent="indent"in i?i.indent:0:n.type==="flow-collection"&&i.type==="document"&&(n.indent=0),n.type==="flow-collection"&&Nu(n),i.type){case"document":i.value=n;break;case"block-scalar":i.props.push(n);break;case"block-map":{const r=i.items[i.items.length-1];if(r.value){i.items.push({start:[],key:n,sep:[]}),this.onKeyLine=!0;return}else if(r.sep)r.value=n;else{Object.assign(r,{key:n,sep:[]}),this.onKeyLine=!r.explicitKey;return}break}case"block-seq":{const r=i.items[i.items.length-1];r.value?i.items.push({start:[],value:n}):r.value=n;break}case"flow-collection":{const r=i.items[i.items.length-1];!r||r.value?i.items.push({start:[],key:n,sep:[]}):r.sep?r.value=n:Object.assign(r,{key:n,sep:[]});return}default:yield*this.pop(),yield*this.pop(n)}if((i.type==="document"||i.type==="block-map"||i.type==="block-seq")&&(n.type==="block-map"||n.type==="block-seq")){const r=n.items[n.items.length-1];r&&!r.sep&&!r.value&&r.start.length>0&&vu(r.start)===-1&&(n.indent===0||r.start.every(a=>a.type!=="comment"||a.indent<n.indent))&&(i.type==="document"?i.end=r.start:i.items.push({start:r.start}),n.items.splice(-1,1))}}}*stream(){switch(this.type){case"directive-line":yield{type:"directive",offset:this.offset,source:this.source};return;case"byte-order-mark":case"space":case"comment":case"newline":yield this.sourceToken;return;case"doc-mode":case"doc-start":{const s={type:"document",offset:this.offset,start:[]};this.type==="doc-start"&&s.start.push(this.sourceToken),this.stack.push(s);return}}yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML stream`,source:this.source}}*document(s){if(s.value)return yield*this.lineEnd(s);switch(this.type){case"doc-start":{vu(s.start)!==-1?(yield*this.pop(),yield*this.step()):s.start.push(this.sourceToken);return}case"anchor":case"tag":case"space":case"comment":case"newline":s.start.push(this.sourceToken);return}const n=this.startBlockValue(s);n?this.stack.push(n):yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML document`,source:this.source}}*scalar(s){if(this.type==="map-value-ind"){const n=oa(this.peek(2)),i=Yn(n);let r;s.end?(r=s.end,r.push(this.sourceToken),delete s.end):r=[this.sourceToken];const a={type:"block-map",offset:s.offset,indent:s.indent,items:[{start:i,key:s,sep:r}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=a}else yield*this.lineEnd(s)}*blockScalar(s){switch(this.type){case"space":case"comment":case"newline":s.props.push(this.sourceToken);return;case"scalar":if(s.source=this.source,this.atNewLine=!0,this.indent=0,this.onNewLine){let n=this.source.indexOf(`
`)+1;for(;n!==0;)this.onNewLine(this.offset+n),n=this.source.indexOf(`
`,n)+1}yield*this.pop();break;default:yield*this.pop(),yield*this.step()}}*blockMap(s){const n=s.items[s.items.length-1];switch(this.type){case"newline":if(this.onKeyLine=!1,n.value){const i="end"in n.value?n.value.end:void 0;(Array.isArray(i)?i[i.length-1]:void 0)?.type==="comment"?i?.push(this.sourceToken):s.items.push({start:[this.sourceToken]})}else n.sep?n.sep.push(this.sourceToken):n.start.push(this.sourceToken);return;case"space":case"comment":if(n.value)s.items.push({start:[this.sourceToken]});else if(n.sep)n.sep.push(this.sourceToken);else{if(this.atIndentedComment(n.start,s.indent)){const r=s.items[s.items.length-2]?.value?.end;if(Array.isArray(r)){Array.prototype.push.apply(r,n.start),r.push(this.sourceToken),s.items.pop();return}}n.start.push(this.sourceToken)}return}if(this.indent>=s.indent){const i=!this.onKeyLine&&this.indent===s.indent,r=i&&(n.sep||n.explicitKey)&&this.type!=="seq-item-ind";let a=[];if(r&&n.sep&&!n.value){const o=[];for(let l=0;l<n.sep.length;++l){const c=n.sep[l];switch(c.type){case"newline":o.push(l);break;case"space":break;case"comment":c.indent>s.indent&&(o.length=0);break;default:o.length=0}}o.length>=2&&(a=n.sep.splice(o[1]))}switch(this.type){case"anchor":case"tag":r||n.value?(a.push(this.sourceToken),s.items.push({start:a}),this.onKeyLine=!0):n.sep?n.sep.push(this.sourceToken):n.start.push(this.sourceToken);return;case"explicit-key-ind":!n.sep&&!n.explicitKey?(n.start.push(this.sourceToken),n.explicitKey=!0):r||n.value?(a.push(this.sourceToken),s.items.push({start:a,explicitKey:!0})):this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken],explicitKey:!0}]}),this.onKeyLine=!0;return;case"map-value-ind":if(n.explicitKey)if(n.sep)if(n.value)s.items.push({start:[],key:null,sep:[this.sourceToken]});else if(Gs(n.sep,"map-value-ind"))this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:a,key:null,sep:[this.sourceToken]}]});else if(Wf(n.key)&&!Gs(n.sep,"newline")){const o=Yn(n.start),l=n.key,c=n.sep;c.push(this.sourceToken),delete n.key,delete n.sep,this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:o,key:l,sep:c}]})}else a.length>0?n.sep=n.sep.concat(a,this.sourceToken):n.sep.push(this.sourceToken);else if(Gs(n.start,"newline"))Object.assign(n,{key:null,sep:[this.sourceToken]});else{const o=Yn(n.start);this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:o,key:null,sep:[this.sourceToken]}]})}else n.sep?n.value||r?s.items.push({start:a,key:null,sep:[this.sourceToken]}):Gs(n.sep,"map-value-ind")?this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[],key:null,sep:[this.sourceToken]}]}):n.sep.push(this.sourceToken):Object.assign(n,{key:null,sep:[this.sourceToken]});this.onKeyLine=!0;return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const o=this.flowScalar(this.type);r||n.value?(s.items.push({start:a,key:o,sep:[]}),this.onKeyLine=!0):n.sep?this.stack.push(o):(Object.assign(n,{key:o,sep:[]}),this.onKeyLine=!0);return}default:{const o=this.startBlockValue(s);if(o){if(o.type==="block-seq"){if(!n.explicitKey&&n.sep&&!Gs(n.sep,"newline")){yield*this.pop({type:"error",offset:this.offset,message:"Unexpected block-seq-ind on same line with key",source:this.source});return}}else i&&s.items.push({start:a});this.stack.push(o);return}}}}yield*this.pop(),yield*this.step()}*blockSequence(s){const n=s.items[s.items.length-1];switch(this.type){case"newline":if(n.value){const i="end"in n.value?n.value.end:void 0;(Array.isArray(i)?i[i.length-1]:void 0)?.type==="comment"?i?.push(this.sourceToken):s.items.push({start:[this.sourceToken]})}else n.start.push(this.sourceToken);return;case"space":case"comment":if(n.value)s.items.push({start:[this.sourceToken]});else{if(this.atIndentedComment(n.start,s.indent)){const r=s.items[s.items.length-2]?.value?.end;if(Array.isArray(r)){Array.prototype.push.apply(r,n.start),r.push(this.sourceToken),s.items.pop();return}}n.start.push(this.sourceToken)}return;case"anchor":case"tag":if(n.value||this.indent<=s.indent)break;n.start.push(this.sourceToken);return;case"seq-item-ind":if(this.indent!==s.indent)break;n.value||Gs(n.start,"seq-item-ind")?s.items.push({start:[this.sourceToken]}):n.start.push(this.sourceToken);return}if(this.indent>s.indent){const i=this.startBlockValue(s);if(i){this.stack.push(i);return}}yield*this.pop(),yield*this.step()}*flowCollection(s){const n=s.items[s.items.length-1];if(this.type==="flow-error-end"){let i;do yield*this.pop(),i=this.peek(1);while(i&&i.type==="flow-collection")}else if(s.end.length===0){switch(this.type){case"comma":case"explicit-key-ind":!n||n.sep?s.items.push({start:[this.sourceToken]}):n.start.push(this.sourceToken);return;case"map-value-ind":!n||n.value?s.items.push({start:[],key:null,sep:[this.sourceToken]}):n.sep?n.sep.push(this.sourceToken):Object.assign(n,{key:null,sep:[this.sourceToken]});return;case"space":case"comment":case"newline":case"anchor":case"tag":!n||n.value?s.items.push({start:[this.sourceToken]}):n.sep?n.sep.push(this.sourceToken):n.start.push(this.sourceToken);return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const r=this.flowScalar(this.type);!n||n.value?s.items.push({start:[],key:r,sep:[]}):n.sep?this.stack.push(r):Object.assign(n,{key:r,sep:[]});return}case"flow-map-end":case"flow-seq-end":s.end.push(this.sourceToken);return}const i=this.startBlockValue(s);i?this.stack.push(i):(yield*this.pop(),yield*this.step())}else{const i=this.peek(2);if(i.type==="block-map"&&(this.type==="map-value-ind"&&i.indent===s.indent||this.type==="newline"&&!i.items[i.items.length-1].sep))yield*this.pop(),yield*this.step();else if(this.type==="map-value-ind"&&i.type!=="flow-collection"){const r=oa(i),a=Yn(r);Nu(s);const o=s.end.splice(1,s.end.length);o.push(this.sourceToken);const l={type:"block-map",offset:s.offset,indent:s.indent,items:[{start:a,key:s,sep:o}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=l}else yield*this.lineEnd(s)}}flowScalar(s){if(this.onNewLine){let n=this.source.indexOf(`
`)+1;for(;n!==0;)this.onNewLine(this.offset+n),n=this.source.indexOf(`
`,n)+1}return{type:s,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(s){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken],source:""};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":{this.onKeyLine=!0;const n=oa(s),i=Yn(n);return i.push(this.sourceToken),{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:i,explicitKey:!0}]}}case"map-value-ind":{this.onKeyLine=!0;const n=oa(s),i=Yn(n);return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:i,key:null,sep:[this.sourceToken]}]}}}return null}atIndentedComment(s,n){return this.type!=="comment"||this.indent<=n?!1:s.every(i=>i.type==="newline"||i.type==="space")}*documentEnd(s){this.type!=="doc-mode"&&(s.end?s.end.push(this.sourceToken):s.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop()))}*lineEnd(s){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":yield*this.pop(),yield*this.step();break;case"newline":this.onKeyLine=!1;case"space":case"comment":default:s.end?s.end.push(this.sourceToken):s.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop())}}}function Gf(t){const s=t.prettyErrors!==!1;return{lineCounter:t.lineCounter||s&&new Kf||null,prettyErrors:s}}function Hk(t,s={}){const{lineCounter:n,prettyErrors:i}=Gf(s),r=new Lc(n?.addNewLine),a=new Rc(s),o=Array.from(a.compose(r.parse(t)));if(i&&n)for(const l of o)l.errors.forEach(Pa(t,n)),l.warnings.forEach(Pa(t,n));return o.length>0?o:Object.assign([],{empty:!0},a.streamInfo())}function Zf(t,s={}){const{lineCounter:n,prettyErrors:i}=Gf(s),r=new Lc(n?.addNewLine),a=new Rc(s);let o=null;for(const l of a.compose(r.parse(t),!0,t.length))if(!o)o=l;else if(o.options.logLevel!=="silent"){o.errors.push(new wn(l.range.slice(0,2),"MULTIPLE_DOCS","Source contains multiple documents; please use YAML.parseAllDocuments()"));break}return i&&n&&(o.errors.forEach(Pa(t,n)),o.warnings.forEach(Pa(t,n))),o}function Qk(t,s,n){let i;typeof s=="function"?i=s:n===void 0&&s&&typeof s=="object"&&(n=s);const r=Zf(t,n);if(!r)return null;if(r.warnings.forEach(a=>pf(r.options.logLevel,a)),r.errors.length>0){if(r.options.logLevel!=="silent")throw r.errors[0];r.errors=[]}return r.toJS(Object.assign({reviver:i},n))}function Yk(t,s,n){let i=null;if(typeof s=="function"||Array.isArray(s)?i=s:n===void 0&&s&&(n=s),typeof n=="string"&&(n=n.length),typeof n=="number"){const r=Math.round(n);n=r<1?void 0:r>8?{indent:8}:{indent:r}}if(t===void 0){const{keepUndefined:r}=n??s??{};if(!r)return}return $n(t)&&!i?t.toString(n):new Ii(t,i,n).toString(n)}const Hf=Object.freeze(Object.defineProperty({__proto__:null,Alias:lo,CST:Wk,Composer:Rc,Document:Ii,Lexer:Vf,LineCounter:Kf,Pair:lt,Parser:Lc,Scalar:ne,Schema:jo,YAMLError:Ic,YAMLMap:It,YAMLParseError:wn,YAMLSeq:nn,YAMLWarning:Mf,isAlias:un,isCollection:De,isDocument:$n,isMap:Ai,isNode:Ie,isPair:Ae,isScalar:ke,isSeq:Di,parse:Qk,parseAllDocuments:Hk,parseDocument:Zf,stringify:Yk,visit:Fn,visitAsync:oo},Symbol.toStringTag,{value:"Module"})),Jk={type:"object",properties:{question:{type:"string",required:!0},options:{type:"array",items:{type:"string"},minItems:4,maxItems:4,required:!0},answerIndex:{type:"number",minimum:0,maximum:3,required:!0},explanation:{type:"string"}}};function Xk(){const t=ae(),{mutate:s}=Mn(),[n,i]=f.useState(null),[r,a]=f.useState(null),[o,l]=f.useState(null),[c,d]=f.useState({}),[u,m]=f.useState({activityId:null,sectionId:null}),[h,y]=f.useState(null),[x,g]=f.useState({open:!1,activity:null}),[j,w]=f.useState({open:!1,quiz:null,activityId:null,sectionId:null,sectionTitle:null,sectionContent:null}),{data:b}=Z({resource:"topics",filters:n?[{field:"course_id",operator:"eq",value:n}]:[],sorters:[{field:"position",order:"asc"}],pagination:{pageSize:500},queryOptions:{enabled:!!n}}),{data:v,refetch:C}=Z({resource:"activities",filters:r?[{field:"topic_id",operator:"eq",value:r},{field:"type",operator:"eq",value:"material"}]:[],sorters:[{field:"position",order:"asc"}],pagination:{pageSize:100},meta:{select:"*, topics(title, position, courses(title))"},queryOptions:{enabled:!!r}}),_=N=>N.split(/\n(?=##\s+)/g).map((D,P)=>{const R=D.match(/^##\s+(.+?)$/m),q=R?R[1].trim():`Sekcja ${P+1}`,L=D.replace(/^##\s+.+?\n/,"").trim(),U=q.toLowerCase().replace(/[^\p{Letter}\p{Number}]+/gu,"-").replace(/(^-|-$)/g,"")||`section-${P}`,O=/```quiz[\s\S]*?```/g.test(L);return{id:U,title:q,content:L,hasQuiz:O}}),S=N=>{const A=N.match(/```quiz\s*?\n([\s\S]*?)```/);if(!A)return null;try{const D=A[1],P=Hf.parse(D);if(P.question&&Array.isArray(P.options)&&typeof P.answerIndex=="number")return P}catch(D){console.error("Failed to parse quiz:",D)}return null},z=(N,A)=>{d(D=>({...D,[N]:D[N]===A?null:A}))},k=async(N,A,D,P)=>{m({activityId:N.id,sectionId:A});try{const R=`
Jeste ekspertem od tworzenia pyta kontrolnych do materia贸w edukacyjnych.

KONTEKST LEKCJI:
- Tytu materiau: ${N.title}
- Kurs: ${N.topics?.courses?.title||"Kurs"}
- Temat: ${N.topics?.title||"Temat"}

SEKCJA DO KTREJ TWORZYSZ PYTANIE:
- Tytu sekcji: ${D}
- Tre sekcji:
"""
${P}
"""

WYTYCZNE:
1. Pytanie MUSI sprawdza zrozumienie KLUCZOWEGO konceptu z tej konkretnej sekcji
2. Pytanie powinno by jasne i jednoznaczne
3. Opcje odpowiedzi powinny by wiarygodne (dystraktory podobne do poprawnej odpowiedzi)
4. Poziom trudnoci: redni (nie za atwe, nie za trudne)
5. Unikaj pyta typu "wszystkie powy偶sze" lub "偶adne z powy偶szych"
6. Pytanie powinno testowa ZROZUMIENIE, nie pami fakt贸w
7. Jzyk pytania dopasuj do wieku uczni贸w (liceum/technikum)

WA呕NE:
- answerIndex to indeks poprawnej odpowiedzi (0-3)
- options to dokadnie 4 opcje odpowiedzi
- explanation to kr贸tkie wyjanienie dlaczego ta odpowied藕 jest poprawna

Wygeneruj jedno pytanie kontrolne w formacie JSON.
      `.trim(),q=await On(R,Jk);if(q&&q.question&&q.options&&typeof q.answerIndex=="number")w({open:!0,quiz:{question:q.question,options:q.options,answerIndex:q.answerIndex},activityId:N.id,sectionId:A,sectionTitle:D,sectionContent:P});else throw new Error("Nieprawidowa struktura wygenerowanego pytania")}catch(R){console.error("Error generating quiz:",R),Y.error("Nie udao si wygenerowa pytania")}finally{m({activityId:null,sectionId:null})}},T=async()=>{if(!(!j.quiz||!j.activityId||!j.sectionId)){y(j.activityId);try{const N=v?.data?.find(L=>L.id===j.activityId);if(!N)throw new Error("Nie znaleziono aktywnoci");const D=_(N.content).findIndex(L=>L.id===j.sectionId);if(D===-1)throw new Error("Nie znaleziono sekcji");const P=`\`\`\`quiz
question: "${j.quiz.question}"
options:
${j.quiz.options.map(L=>`  - "${L}"`).join(`
`)}
answerIndex: ${j.quiz.answerIndex}
\`\`\``;let R=N.content;const q=R.split(/\n(?=##\s+)/g);q[D]&&(q[D]=q[D].replace(/```quiz[\s\S]*?```/g,""),q[D]=q[D].trim()+`

`+P),R=q.join(`
`),await new Promise((L,U)=>{s({resource:"activities",id:j.activityId.toString(),values:{content:R}},{onSuccess:()=>{Y.success("Pytanie kontrolne zostao dodane!"),w({open:!1,quiz:null,activityId:null,sectionId:null,sectionTitle:null,sectionContent:null}),C(),L()},onError:O=>{console.error("Error updating activity:",O),U(O)}})})}catch(N){console.error("Error saving quiz:",N),Y.error("Nie udao si zapisa pytania")}finally{y(null)}}},p=N=>{g({open:!0,activity:N})};return e.jsxs(H,{children:[e.jsx(ue,{title:"Krok 4 (opcjonalny)",description:"Dodaj pytania kontrolne do wygenerowanych materia贸w"}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[300px,1fr]",children:[e.jsxs(I,{className:"h-fit",children:[e.jsx(F,{children:e.jsx($,{className:"text-base",children:"Wyb贸r materia贸w"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsx(Ap,{value:n,onChange:N=>{i(N),a(null),l(null),d({})},label:"Kurs",showAlert:!1}),n&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium mb-1 block",children:"Temat"}),e.jsxs("select",{value:r||"",onChange:N=>{a(N.target.value?Number(N.target.value):null),l(null),d({})},className:"w-full rounded-md border px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Wybierz temat"}),(b?.data||[]).map(N=>e.jsxs("option",{value:N.id,children:[N.position,". ",N.title]},N.id))]})]}),r&&v?.data&&e.jsxs(he,{children:[e.jsx(zt,{className:"h-4 w-4"}),e.jsxs(pe,{className:"text-xs",children:["Znaleziono ",e.jsx("strong",{children:v.data.length})," materia贸w"]})]}),e.jsx(M,{variant:"outline",onClick:()=>t("/admin/educational-material"),className:"w-full",size:"sm",children:"Powr贸t do panelu"})]})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-5 h-5"}),"Materiay do uzupenienia"]})}),e.jsx(E,{children:r?v?.data?.length?e.jsx("div",{className:"space-y-4",children:v.data.map(N=>{const A=_(N.content),D=A.filter(R=>R.hasQuiz).length,P=o===N.id;return e.jsxs("div",{className:"rounded-lg border overflow-hidden",children:[e.jsx("button",{onClick:()=>l(P?null:N.id),className:"w-full p-4 text-left hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:N.title}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[A.length," sekcji"]}),D>0&&e.jsxs(V,{variant:"secondary",className:"text-xs",children:[e.jsx(Re,{className:"w-3 h-3 mr-1"}),D," ",D===1?"pytanie":"pyta"]}),N.is_published&&e.jsxs(V,{variant:"default",className:"text-xs",children:[e.jsx(Je,{className:"w-3 h-3 mr-1"}),"Opublikowany"]})]})]}),e.jsx(be,{className:`w-5 h-5 text-muted-foreground transition-transform ${P?"rotate-90":""}`})]})}),P&&e.jsx("div",{className:"border-t",children:e.jsxs(gc,{defaultValue:"sections",className:"w-full",children:[e.jsxs(io,{className:"w-full justify-start rounded-none border-b",children:[e.jsx(Wt,{value:"sections",children:"Sekcje i pytania"}),e.jsx(Wt,{value:"preview",children:"Podgld"})]}),e.jsx(Gt,{value:"sections",className:"p-4 space-y-3",children:A.map(R=>{const q=S(R.content),L=u.activityId===N.id&&u.sectionId===R.id,U=c[N.id]===R.id;return e.jsxs("div",{className:"rounded-lg border overflow-hidden",children:[e.jsxs("div",{className:"flex items-start justify-between p-3 gap-3",children:[e.jsxs("button",{onClick:()=>z(N.id,R.id),className:"flex-1 flex items-start gap-2 text-left hover:opacity-70 transition-opacity",children:[U?e.jsx(dt,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-muted-foreground"}):e.jsx(be,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-muted-foreground"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-sm",children:R.title}),q&&e.jsxs(V,{variant:"secondary",className:"text-xs mt-1",children:[e.jsx(Re,{className:"w-3 h-3 mr-1"}),"Zawiera pytanie"]})]})]}),e.jsx("div",{className:"flex-shrink-0",children:q?e.jsxs(M,{size:"sm",variant:"outline",onClick:()=>k(N,R.id,R.title,R.content),disabled:L,children:[L?e.jsx(Et,{className:"w-3 h-3 animate-spin"}):e.jsx(pr,{className:"w-3 h-3"}),e.jsx("span",{className:"ml-1",children:"Zamie"})]}):e.jsxs(M,{size:"sm",onClick:()=>k(N,R.id,R.title,R.content),disabled:L,children:[L?e.jsx(Et,{className:"w-3 h-3 animate-spin"}):e.jsx(Fe,{className:"w-3 h-3"}),e.jsx("span",{className:"ml-1",children:"Dodaj pytanie"})]})})]}),U&&e.jsx("div",{className:"border-t bg-muted/30",children:e.jsx(tt,{className:"max-h-[300px]",children:e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"prose prose-sm max-w-none dark:prose-invert",children:e.jsx(xi,{remarkPlugins:[wi],children:R.content.replace(/```quiz[\s\S]*?```/g,"")})}),q&&e.jsx("div",{className:"mt-4 p-3 bg-background rounded-lg border",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Re,{className:"w-4 h-4 mt-0.5 text-primary flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm mb-2",children:q.question}),e.jsx("div",{className:"space-y-1",children:q.options.map((O,G)=>e.jsxs("div",{className:`text-xs p-2 rounded ${G===q.answerIndex?"bg-green-100 dark:bg-green-900/30 text-green-900 dark:text-green-100 font-medium":"bg-muted"}`,children:[G+1,". ",O,G===q.answerIndex&&" "]},G))})]})]})})]})})})]},R.id)})}),e.jsxs(Gt,{value:"preview",className:"p-4",children:[e.jsxs(M,{variant:"outline",className:"w-full mb-4",onClick:()=>p(N),children:[e.jsx(Je,{className:"w-4 h-4 mr-2"}),"Otw贸rz podgld w penym oknie"]}),e.jsx(tt,{className:"h-[400px] rounded-lg border p-4",children:e.jsx("div",{className:"prose prose-sm max-w-none dark:prose-invert",children:e.jsx(xi,{remarkPlugins:[wi],children:N.content})})})]})]})})]},N.id)})}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(zt,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Brak materia贸w w wybranym temacie"})]}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Re,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Wybierz kurs i temat aby zobaczy materiay"})]})})]})]}),e.jsx(Cn,{open:x.open,onOpenChange:N=>{N||g({open:!1,activity:null})},children:e.jsxs(en,{className:"max-w-4xl max-h-[90vh]",children:[e.jsxs(tn,{children:[e.jsx(sn,{children:x.activity?.title}),e.jsxs(jr,{children:[x.activity?.topics?.courses?.title,"  ",x.activity?.topics?.title]})]}),x.activity&&e.jsx(wr,{content:x.activity.content,metadata:{duration_min:x.activity.duration_min,position:x.activity.position,created_at:x.activity.created_at,updated_at:x.activity.updated_at},showMetadata:!0,height:"500px"})]})}),e.jsx(Cn,{open:j.open,onOpenChange:N=>{!N&&!h&&w({open:!1,quiz:null,activityId:null,sectionId:null,sectionTitle:null,sectionContent:null})},children:e.jsxs(en,{className:"max-w-2xl",children:[e.jsxs(tn,{children:[e.jsx(sn,{children:"Wygenerowane pytanie kontrolne"}),e.jsxs(jr,{children:["Sekcja: ",j.sectionTitle]})]}),j.quiz&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-lg border p-4 bg-muted/50",children:[e.jsx("p",{className:"font-medium mb-3",children:j.quiz.question}),e.jsx("div",{className:"space-y-2",children:j.quiz.options.map((N,A)=>e.jsxs("div",{className:`flex items-center gap-2 p-2 rounded ${A===j.quiz?.answerIndex?"bg-green-100 dark:bg-green-900/30 border border-green-300":""}`,children:[e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center ${A===j.quiz?.answerIndex?"border-green-500 bg-green-500":"border-gray-300"}`,children:A===j.quiz?.answerIndex&&e.jsx(Rt,{className:"w-3 h-3 text-white"})}),e.jsx("span",{className:"text-sm",children:N})]},A))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Kod YAML (do wstawienia):"}),e.jsx("div",{className:"rounded-lg border bg-background p-3 font-mono text-xs overflow-x-auto",children:e.jsx("pre",{children:`\`\`\`quiz
question: "${j.quiz.question}"
options:
${j.quiz.options.map(N=>`  - "${N}"`).join(`
`)}
answerIndex: ${j.quiz.answerIndex}
\`\`\``})})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(M,{variant:"outline",onClick:()=>w({open:!1,quiz:null,activityId:null,sectionId:null,sectionTitle:null,sectionContent:null}),disabled:h!==null,children:"Anuluj"}),e.jsxs(M,{variant:"outline",onClick:()=>{if(j.activityId&&j.sectionId&&j.sectionTitle&&j.sectionContent){const N=v?.data?.find(A=>A.id===j.activityId);N&&k(N,j.sectionId,j.sectionTitle,j.sectionContent)}},disabled:h!==null,children:[e.jsx(pr,{className:"w-4 h-4 mr-1"}),"Wygeneruj ponownie"]}),e.jsx(M,{onClick:T,disabled:h!==null,children:h?e.jsxs(e.Fragment,{children:[e.jsx(Et,{className:"w-4 h-4 mr-1 animate-spin"}),"Zapisywanie..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Rs,{className:"w-4 h-4 mr-1"}),"Zapisz pytanie"]})})]})]})]})})]})}const ez=[e.jsx(K,{path:"/educational-material",element:e.jsx(_v,{})},"em-dashboard"),e.jsx(K,{path:"/educational-material/step1",element:e.jsx(ON,{})},"em-step1"),e.jsx(K,{path:"/educational-material/step2",element:e.jsx(BN,{})},"em-step2"),e.jsx(K,{path:"/educational-material/step3",element:e.jsx(UN,{})},"em-step3"),e.jsx(K,{path:"/educational-material/step4",element:e.jsx(Xk,{})},"em-step4")],ku={name:"educational-material",list:"/educational-material",create:"/educational-material/step1",meta:{canDelete:!1,label:"Kreator materia贸w",icon:e.jsx(ye,{className:"h-4 w-4"})}};function tz(){return e.jsxs(H,{children:[e.jsx(ue,{title:"Kreator quiz贸w  panel",description:"Wygeneruj pytania na podstawie istniejcych materia贸w edukacyjnych"}),e.jsxs("div",{className:"relative overflow-hidden rounded-2xl border mb-6",children:[e.jsx("div",{className:"absolute inset-0 bg-cyan-50"}),e.jsxs("div",{className:"relative px-6 py-8 flex items-center gap-3",children:[e.jsx("div",{className:"shrink-0 inline-flex h-10 w-10 items-center justify-center rounded-xl bg-black text-white",children:e.jsx(ys,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-semibold leading-tight",children:"Kreator quiz贸w"}),e.jsx("p",{className:"text-sm text-zinc-600",children:"Wybierz kurs, temat i materia, a potem wygeneruj zestaw pyta wielokrotnego wyboru z poprawnymi odpowiedziami i wyjanieniami."})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(M,{asChild:!0,children:e.jsxs(Le,{to:"/admin/quiz-wizard/step1",className:"inline-flex items-center gap-2",children:["Nowa sesja",e.jsx(be,{className:"w-4 h-4"})]})})})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(I,{children:[e.jsxs(F,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"w-5 h-5"}),"Szybki start"]}),e.jsx(so,{children:"3 kroki do gotowego quizu"})]}),e.jsxs(E,{className:"space-y-3 text-sm",children:[e.jsxs("ol",{className:"list-decimal list-inside space-y-1 text-zinc-700",children:[e.jsx("li",{children:"Wybierz kurs  temat  materia (Markdown)."}),e.jsx("li",{children:"Ustaw parametry (liczba pyta, poziom trudnoci, wyjanienia)."}),e.jsxs("li",{children:["Wygeneruj pytania i zapisz quiz do bazy (Supabase) jako aktywno typu ",e.jsx("code",{children:"quiz"}),"."]})]}),e.jsx(M,{asChild:!0,className:"w-full",children:e.jsxs(Le,{to:"/admin/quiz-wizard/step1",className:"inline-flex items-center gap-2",children:["Przejd藕 do kroku 1",e.jsx(be,{className:"w-4 h-4"})]})})]})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-5 h-5"}),"Jak generujemy pytania?"]})}),e.jsxs(E,{className:"space-y-3 text-sm text-muted-foreground",children:[e.jsx("p",{children:"Model analizuje tre materiau i tworzy pytania sprawdzajce zrozumienie kluczowych koncepcji."}),e.jsx("p",{children:"Format generatu: JSON  zapis w treci aktywnoci jako YAML (lista pyta)."}),e.jsxs(he,{children:[e.jsx(cn,{className:"h-4 w-4"}),e.jsx(pe,{className:"text-xs",children:"Quiz jest tworzony w tym samym temacie co materia. Mo偶esz go p贸藕niej przypisa do grup uczni贸w."})]})]})]})]})]})}function sz({topicId:t,selectedMaterialId:s,onSelectMaterial:n,showPreview:i=!1,showMaterialCount:r=!1,highlightColor:a="blue",className:o=""}){const[l,c]=f.useState(""),[d,u]=f.useState({open:!1,material:null}),{data:m,isLoading:h}=Z({resource:"activities",filters:t?[{field:"topic_id",operator:"eq",value:t},{field:"type",operator:"eq",value:"material"}]:[],sorters:[{field:"position",order:"asc"}],pagination:{pageSize:1e3},meta:{select:i?"id,topic_id,title,position,is_published,content,duration_min,created_at":"id,topic_id,title,position,is_published"},queryOptions:{enabled:!!t}}),y=f.useMemo(()=>{const w=m?.data||[];if(!l.trim())return w;const b=l.toLowerCase();return w.filter(v=>String(v.title).toLowerCase().includes(b)||String(v.position).includes(b))},[m?.data,l]),x=(w,b)=>{b.stopPropagation(),i&&u({open:!0,material:w})},j={blue:{selected:"bg-blue-50/60 ring-1 ring-blue-200",radio:"bg-blue-500 border-blue-500"},cyan:{selected:"bg-cyan-50/60 ring-1 ring-cyan-200",radio:"bg-cyan-500 border-cyan-500"}}[a];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`rounded-lg border ${o}`,children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 border-b bg-muted/40",children:[e.jsx(In,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(Q,{value:l,onChange:w=>c(w.target.value),placeholder:"Filtruj materiay",className:"h-8"})]}),e.jsxs("div",{className:"divide-y",children:[h&&e.jsx("div",{className:"p-3 text-xs text-muted-foreground",children:"adowanie materia贸w"}),!h&&y.length===0&&e.jsx("div",{className:"p-3 text-xs text-muted-foreground",children:l?"Brak wynik贸w dla filtru.":"Brak materia贸w w tym temacie."}),y.map(w=>{const b=s===w.id;return e.jsx("button",{type:"button",onClick:()=>n(w.id),className:["w-full text-left p-3 hover:bg-muted/50 transition",b?j.selected:""].join(" "),children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx("span",{className:"shrink-0 inline-flex items-center justify-center w-5 h-5 rounded-full bg-primary/10 text-xs font-semibold",children:w.position}),e.jsx("span",{className:"truncate",children:w.title}),!w.is_published&&e.jsx(V,{variant:"outline",className:"text-xs shrink-0",children:e.jsx(dn,{className:"w-3 h-3"})})]}),i&&e.jsxs("button",{onClick:v=>x(w,v),className:"mt-1 ml-7 text-xs text-primary/70 hover:text-primary hover:underline inline-flex items-center gap-1",children:[e.jsx(Je,{className:"w-3 h-3"}),"Zobacz tre"]}),r&&w.duration_min&&e.jsxs("div",{className:"mt-1 ml-7 text-xs text-muted-foreground",children:[e.jsx(zt,{className:"w-3 h-3 inline mr-1"}),w.duration_min," min"]})]}),e.jsx("div",{className:["shrink-0 w-3 h-3 rounded-full border mt-1",b?j.radio:"bg-white"].join(" "),"aria-hidden":!0})]})},w.id)})]}),e.jsxs("div",{className:"p-2 border-t text-[11px] text-muted-foreground",children:["Kliknij materia",i?" lub zobacz tre":"",", aby go wybra."]})]}),i&&e.jsx(Cn,{open:d.open,onOpenChange:w=>{w||u({open:!1,material:null})},children:e.jsxs(en,{className:"max-w-6xl max-h-[90vh]",children:[e.jsxs(tn,{children:[e.jsxs(sn,{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-5 h-5"}),d.material?.title]}),e.jsxs(jr,{children:["Podgld materiau  ",d.material?.duration_min||20," min"]})]}),d.material&&e.jsx(wr,{content:d.material.content,metadata:{duration_min:d.material.duration_min,position:d.material.position,created_at:d.material.created_at},showMetadata:!0,height:"500px"})]})})]})}const nz={type:"object",properties:{courseId:{type:"number",required:!0},topicId:{type:"number",required:!0},materialId:{type:"number",required:!0},count:{type:"number"},difficulty:{type:"string"},includeExplanations:{type:"boolean"},randomized:{type:"boolean"},passingScore:{type:"number"},timeLimit:{type:"number"},maxAttempts:{type:"number"}}};function iz(){const{registerStep:t,setStepData:s,getStepData:n}=ws(),i=ae(),r=n("qw_step1")||{},[a,o]=f.useState(!0);f.useEffect(()=>{t("qw_step1",nz),r.count||s("qw_step1",{count:10,difficulty:"mixed",includeExplanations:!0,randomized:!0,passingScore:70,timeLimit:void 0,maxAttempts:void 0})},[]);const{data:l}=Z({resource:"courses",filters:a?[{field:"is_published",operator:"eq",value:!0}]:[],sorters:[{field:"created_at",order:"desc"}],pagination:{pageSize:100}}),{data:c}=Z({resource:"topics",filters:[{field:"course_id",operator:"eq",value:r.courseId||-1}],sorters:[{field:"position",order:"asc"}],pagination:{pageSize:500},queryOptions:{enabled:!!r.courseId}}),d=!!r.courseId&&!!r.topicId&&!!r.materialId;return e.jsxs(H,{children:[e.jsx(ue,{title:"Krok 1",description:"Wyb贸r materiau oraz parametr贸w quizu"}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[1.2fr,0.8fr]",children:[e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Kurs  temat  materia"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted rounded-lg",children:[e.jsx(Ge,{checked:a,onCheckedChange:u=>o(!!u)}),e.jsx("label",{className:"text-sm cursor-pointer",children:"Tylko opublikowane kursy"})]}),e.jsxs(ge,{value:r.courseId?String(r.courseId):"",onValueChange:u=>s("qw_step1",{courseId:Number(u),topicId:void 0,materialId:void 0}),children:[e.jsx(fe,{children:e.jsx(je,{placeholder:"Wybierz kurs"})}),e.jsx(xe,{children:(l?.data||[]).map(u=>e.jsx(W,{value:String(u.id),children:e.jsxs("div",{className:"flex items-center gap-2",children:[u.icon_emoji?`${u.icon_emoji} `:" ",e.jsx("span",{children:u.title}),!u.is_published&&e.jsxs(V,{variant:"outline",className:"ml-2 text-xs",children:[e.jsx(dn,{className:"w-3 h-3"}),"Szkic"]})]})},u.id))})]}),e.jsxs(ge,{value:r.topicId?String(r.topicId):"",onValueChange:u=>s("qw_step1",{topicId:Number(u),materialId:void 0}),disabled:!r.courseId,children:[e.jsx(fe,{children:e.jsx(je,{placeholder:"Wybierz temat"})}),e.jsx(xe,{children:(c?.data||[]).map(u=>e.jsxs(W,{value:String(u.id),children:[u.position,". ",u.title]},u.id))})]}),r.topicId&&e.jsx(sz,{topicId:r.topicId,selectedMaterialId:r.materialId||null,onSelectMaterial:u=>s("qw_step1",{materialId:u}),showPreview:!0,highlightColor:"cyan"})]})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Parametry generowania"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(yw,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Steruj zakresem i poziomem pyta"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-1",children:"Liczba pyta"}),e.jsx(Q,{type:"number",min:3,max:30,value:r.count??10,onChange:u=>s("qw_step1",{count:Number(u.target.value)})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-1",children:"Poziom trudnoci"}),e.jsxs(ge,{value:r.difficulty||"mixed",onValueChange:u=>s("qw_step1",{difficulty:u}),children:[e.jsx(fe,{children:e.jsx(je,{placeholder:"Wybierz poziom"})}),e.jsxs(xe,{children:[e.jsx(W,{value:"mixed",children:"Mieszany"}),e.jsx(W,{value:"easy",children:"atwy"}),e.jsx(W,{value:"medium",children:"redni"}),e.jsx(W,{value:"hard",children:"Trudny"})]})]})]}),e.jsxs("div",{className:"border-t pt-3 space-y-3",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Parametry quizu"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs mb-1",children:["Wynik zaliczajcy (%)",e.jsx("span",{className:"text-muted-foreground ml-1",children:"domylnie: 70%"})]}),e.jsx(Q,{type:"number",min:0,max:100,value:r.passingScore??70,onChange:u=>s("qw_step1",{passingScore:Number(u.target.value)})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs mb-1",children:["Limit czasu (minuty)",e.jsx("span",{className:"text-muted-foreground ml-1",children:"opcjonalne"})]}),e.jsx(Q,{type:"number",min:1,max:180,placeholder:"Brak limitu",value:r.timeLimit??"",onChange:u=>s("qw_step1",{timeLimit:u.target.value?Number(u.target.value):void 0})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs mb-1",children:["Max. liczba pr贸b",e.jsx("span",{className:"text-muted-foreground ml-1",children:"opcjonalne"})]}),e.jsx(Q,{type:"number",min:1,max:10,placeholder:"Bez limitu",value:r.maxAttempts??"",onChange:u=>s("qw_step1",{maxAttempts:u.target.value?Number(u.target.value):void 0})})]})]}),e.jsxs("div",{className:"border-t pt-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{checked:r.includeExplanations??!0,onCheckedChange:u=>s("qw_step1",{includeExplanations:!!u})}),e.jsx("span",{className:"text-sm",children:"Dodaj wyjanienia do poprawnych odpowiedzi"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{checked:r.randomized??!0,onCheckedChange:u=>s("qw_step1",{randomized:!!u})}),e.jsx("span",{className:"text-sm",children:"Losuj kolejno odpowiedzi"})]})]}),e.jsxs(he,{children:[e.jsx(cn,{className:"h-4 w-4"}),e.jsx(pe,{className:"text-xs",children:"Pytania bd tworzone na podstawie treci wybranego materiau. Upewnij si, 偶e materia jest kompletny."})]}),e.jsxs(M,{disabled:!d,className:"w-full",onClick:()=>i("/admin/quiz-wizard/step2"),children:["Kontynuuj",e.jsx(be,{className:"w-4 h-4 ml-1"})]}),!d&&e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Wybierz kurs, temat i materia aby kontynuowa"})]})]})]})]})}const rz={type:"object",properties:{items:{type:"array",minItems:3,items:{type:"object",properties:{question:{type:"string",required:!0},options:{type:"array",items:{type:"string"},minItems:4,maxItems:4,required:!0},answerIndex:{type:"number",minimum:0,maximum:3,required:!0},explanation:{type:"string"}}},required:!0}}};function az(){const{getStepData:t,setStepData:s}=ws(),n=ae(),i=t("qw_step1"),r=i?.materialId,a=i?.topicId,[o,l]=f.useState(null),[c,d]=f.useState(!1),[u,m]=f.useState(null),[h,y]=f.useState(null),[x,g]=f.useState(!1);f.useEffect(()=>{(!r||!a)&&n("/admin/quiz-wizard/step1")},[r,a,n]);const{data:j}=Xe({resource:"activities",id:String(r||""),meta:{select:"*"},queryOptions:{enabled:!!r}}),w=async()=>{if(!j?.data)return;m(null),y(null),g(!1),d(!0),s("qw_step2",{isGenerating:!0});const v=`
Jeste nauczycielem tworzcym pytania testowe na podstawie materiau edukacyjnego (Markdown).

PARAMETRY QUIZU:
- liczba pyta: ${i.count??10}
- poziom trudnoci: ${i.difficulty??"mixed"}
- losuj kolejno odpowiedzi: ${i.randomized?"tak":"nie"}
- dodawaj wyjanienia: ${i.includeExplanations?"tak":"nie"}

MATERIA (藕r贸do, Markdown):
"""
${j.data.content}
"""

WYTYCZNE:
1) Pytania musz testowa zrozumienie kluczowych idei z materiau (nie pamici贸wka).
2) Ka偶de pytanie ma DOKADNIE 4 opcje odpowiedzi.
3) answerIndex wskazuje poprawn odpowied藕 (0-3).
4) Unikaj opcji "wszystkie/偶adne z powy偶szych".
5) Jeli "dodawaj wyjanienia" = tak  pole explanation ma kr贸tkie uzasadnienie odpowiedzi.
6) Zweryfikuj sp贸jno logiczn i brak wieloznacznoci.

ZWR WYCZNIE JSON ze struktur:
{
  "items": [
    { "question": "...", "options": ["A","B","C","D"], "answerIndex": 0, "explanation": "..." }
  ]
}
    `.trim();try{const C=await On(v,rz),_=Array.isArray(C.items)?C.items:[];if(_.length<3)throw new Error("Za mao poprawnych pyta w odpowiedzi modelu.");const S={material_id:j.data.id,topic_id:j.data.topic_id,title:`${j.data.title}  Quiz`,items:_};l(S)}catch(C){const _=C?.message?.toString()?.includes("503")||C?.details?.toString()?.includes?.("503")?"Bd komunikacji z modelem (503)":C?.message||"Nie udao si wygenerowa quizu.";m(_);const S=C?.info??C?.response??{message:C?.message,status:C?.status||C?.statusCode,details:C?.details,raw:C};y(S)}finally{d(!1),s("qw_step2",{isGenerating:!1})}},b=()=>{o&&n("/admin/quiz-wizard/step3",{state:{item:o}})};return e.jsxs(H,{children:[e.jsx(ue,{title:"Krok 2",description:"Generowanie pyta na podstawie materiau"}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[0.9fr,1.1fr]",children:[e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-5 h-5"}),"Panel generowania"]})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-lg bg-muted p-4 space-y-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Materia:"})," ",e.jsx("span",{className:"font-medium",children:j?.data?.title||"-"})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx(V,{variant:"outline",children:i.difficulty??"mixed"}),e.jsx(V,{variant:"outline",children:(i.count??10)+" pyta"}),i.includeExplanations&&e.jsx(V,{variant:"default",children:"Wyjanienia"})]})]}),e.jsxs(he,{children:[e.jsx(ye,{className:"h-4 w-4"}),e.jsx(pe,{className:"text-xs",children:"Pytania bd dotyczyy treci wybranego materiau. Mo偶esz je p贸藕niej edytowa przed zapisem."})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(M,{onClick:w,disabled:c,className:"w-full",size:"lg",children:c?e.jsxs(e.Fragment,{children:[e.jsx(Et,{className:"w-4 h-4 mr-2 animate-spin"}),"Generowanie pyta..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"}),"Wygeneruj pytania"]})}),e.jsxs(M,{variant:"default",onClick:b,disabled:!o||c,className:"w-full",children:["Przejd藕 do zapisu",e.jsx(be,{className:"w-4 h-4 ml-1"})]})]}),u&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(he,{variant:"destructive",children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsx(pe,{children:u})]}),h&&e.jsxs(I,{children:[e.jsx(F,{className:"py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx($,{className:"text-sm",children:"Szczeg贸y bdu"}),e.jsx(M,{variant:"ghost",size:"sm",onClick:()=>g(v=>!v),className:"h-7",children:x?e.jsx($t,{className:"w-4 h-4"}):e.jsx(dt,{className:"w-4 h-4"})})]})}),x&&e.jsx(E,{className:"pt-0",children:e.jsx(Xt,{className:"font-mono text-xs h-40",readOnly:!0,value:(()=>{try{return JSON.stringify(h,null,2)}catch{return String(h)}})()})})]})]}),c&&e.jsxs("div",{className:"text-center text-sm text-muted-foreground space-y-1",children:[e.jsx("p",{children:"Analizuj materia i tworz pytania..."}),e.jsx("p",{className:"text-xs",children:"To mo偶e potrwa kilkanacie sekund"})]})]})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Podgld pyta"})}),e.jsx(E,{children:o?e.jsx(tt,{className:"h-[500px] rounded-lg border p-4",children:e.jsx("div",{className:"space-y-4",children:o.items.map((v,C)=>e.jsxs("div",{className:"rounded-lg border p-3",children:[e.jsxs("div",{className:"text-sm font-medium mb-2",children:[C+1,". ",v.question]}),e.jsx("ul",{className:"text-sm space-y-1",children:v.options.map((_,S)=>e.jsxs("li",{className:S===v.answerIndex?"font-medium":"",children:[String.fromCharCode(65+S),". ",_," ",S===v.answerIndex?"":""]},S))}),v.explanation&&e.jsxs("div",{className:"mt-2 text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium",children:"Wyjanienie: "}),v.explanation]})]},C))})}):e.jsx("div",{className:"flex flex-col items-center justify-center py-16 text-muted-foreground",children:c?e.jsxs(e.Fragment,{children:[e.jsx(Et,{className:"w-8 h-8 mb-3 animate-spin"}),e.jsx("div",{className:"text-sm",children:"Generowanie pyta..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"w-8 h-8 mb-3 opacity-50"}),e.jsx("div",{className:"text-sm",children:"Brak wygenerowanych pyta"}),e.jsx("div",{className:"text-xs mt-1",children:'Kliknij "Wygeneruj pytania"'})]})})})]})]})]})}function oz(){const t=ae(),s=Ns(),{mutate:n}=Yt(),{mutate:i}=Yt(),r=f.useMemo(()=>s?.state?.item??null,[s?.state?.item]),a=f.useMemo(()=>{try{const k=localStorage.getItem("formWizard_qw_step1");if(k)return JSON.parse(k)}catch(k){console.error("Failed to parse step1 data:",k)}return{}},[]),[o,l]=f.useState(r?.title??""),[c,d]=f.useState(!1),[u,m]=f.useState(r?.items??[]),[h,y]=f.useState(!1),[x,g]=f.useState(null),[j,w]=f.useState(null),[b,v]=f.useState(""),{data:C}=Z({resource:"activities",filters:r?[{field:"topic_id",operator:"eq",value:r.topic_id}]:[],sorters:[{field:"position",order:"desc"}],pagination:{pageSize:1},queryOptions:{enabled:!!r?.topic_id}});f.useEffect(()=>{r||t("/admin/quiz-wizard/step2")},[r,t]);const _=k=>{m(T=>T.filter((p,N)=>N!==k))},S=(k,T,p)=>{m(N=>N.map((A,D)=>D===k?{...A,[T]:p}:A))},z=async()=>{if(r){if(!o||o.trim().length<3){g("Tytu musi mie minimum 3 znaki.");return}if(u.length===0){g("Quiz musi mie przynajmniej jedno pytanie.");return}for(let k=0;k<u.length;k++){const T=u[k];if(!T.question||T.question.trim().length<5){g(`Pytanie ${k+1}: tre pytania jest za kr贸tka (min. 5 znak贸w).`);return}if(!T.options||T.options.length!==4){g(`Pytanie ${k+1}: musi mie dokadnie 4 opcje odpowiedzi.`);return}if(T.answerIndex<0||T.answerIndex>3){g(`Pytanie ${k+1}: nieprawidowy indeks poprawnej odpowiedzi.`);return}for(let p=0;p<T.options.length;p++)if(!T.options[p]||T.options[p].trim().length<1){g(`Pytanie ${k+1}, opcja ${p+1}: nie mo偶e by pusta.`);return}}y(!0),g(null),v("Tworzenie aktywnoci quizu...");try{const k=Number(r.topic_id),T=C?.data?.[0],p=T?.position?Number(T.position)+1:1,N=a.passingScore??70,A=a.timeLimit??null,D=a.maxAttempts??null,P=Math.ceil(u.length*1.5);v("Zapisywanie aktywnoci...");const R=await new Promise((q,L)=>{n({resource:"activities",values:{topic_id:k,type:"quiz",title:o.trim(),content:null,duration_min:P,passing_score:N,time_limit:A,max_attempts:D,position:p,is_published:c}},{onSuccess:U=>{const O=U?.data?.id;if(O){const G=typeof O=="string"?parseInt(O,10):O;q(G)}else L(new Error("Nie otrzymano ID aktywnoci"))},onError:U=>L(U)})});w(R),v(`Zapisywanie pyta (0/${u.length})...`);for(let q=0;q<u.length;q++){const L=u[q];v(`Zapisywanie pyta (${q+1}/${u.length})...`);const U=L.options.map((O,G)=>({id:G+1,text:O.trim(),is_correct:G===L.answerIndex}));await new Promise((O,G)=>{i({resource:"questions",values:{activity_id:R,question:L.question.trim(),options:U,points:L.points??1,position:q+1,explanation:L.explanation?.trim()||null}},{onSuccess:()=>O(),onError:se=>G(se)})})}v("Quiz zapisany pomylnie!")}catch(k){console.error("Save error:",k),k?.code==="23505"?g("Quiz o tym tytule ju偶 istnieje w tym temacie. Zmie tytu."):k?.code==="23503"?g("Nieprawidowy temat lub aktywno. Odwie偶 stron i spr贸buj ponownie."):k?.message?g(k.message):g("Nie udao si zapisa quizu. Spr贸buj ponownie."),y(!1),w(null),v("")}}};return r?e.jsxs(H,{children:[e.jsx(ue,{title:"Krok 3",description:"Edycja i zapis quizu do bazy"}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[0.7fr,1.3fr]",children:[e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Ustawienia zapisu"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:["Tytu quizu ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(Q,{value:o,onChange:k=>l(k.target.value),placeholder:"np. Quiz do materiau: Wprowadzenie do ...",disabled:h||j!==null}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Tytu bdzie widoczny dla uczni贸w"})]}),e.jsxs("div",{className:"rounded-lg border p-3 space-y-2 text-xs",children:[e.jsx("div",{className:"font-medium",children:"Parametry quizu:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-muted-foreground",children:[e.jsx("div",{children:"Wynik zaliczajcy:"}),e.jsxs("div",{className:"font-medium text-foreground",children:[a.passingScore??70,"%"]}),e.jsx("div",{children:"Limit czasu:"}),e.jsx("div",{className:"font-medium text-foreground",children:a.timeLimit?`${a.timeLimit} min`:"Brak"}),e.jsx("div",{children:"Max. pr贸b:"}),e.jsx("div",{className:"font-medium text-foreground",children:a.maxAttempts??"Bez limitu"}),e.jsx("div",{children:"Liczba pyta:"}),e.jsx("div",{className:"font-medium text-foreground",children:u.length})]})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:"Opublikuj od razu"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Quiz bdzie widoczny dla uczni贸w"})]}),e.jsx(qt,{checked:c,onCheckedChange:d,disabled:h||j!==null})]}),x&&e.jsxs(he,{variant:"destructive",children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsx(pe,{children:x})]}),b&&e.jsx(he,{className:"border-blue-200 bg-blue-50",children:e.jsx(pe,{className:"text-blue-900 text-sm",children:b})}),j&&e.jsxs(he,{className:"border-green-200 bg-green-50",children:[e.jsx(Rt,{className:"h-4 w-4 text-green-600"}),e.jsxs(pe,{className:"text-green-900",children:[e.jsx("span",{className:"font-medium",children:"Quiz zapisany!"}),e.jsx("br",{}),"ID aktywnoci: ",j,e.jsx("br",{}),"Liczba pyta: ",u.length,e.jsx("br",{}),e.jsx("span",{className:"text-xs",children:"Mo偶esz wr贸ci do panelu lub doda kolejny quiz."})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{onClick:z,disabled:h||j!==null||!o.trim()||u.length===0,className:"flex-1",children:h?e.jsxs(e.Fragment,{children:[e.jsx(Rs,{className:"w-4 h-4 mr-2 animate-pulse"}),"Zapisywanie..."]}):j?e.jsxs(e.Fragment,{children:[e.jsx(Rt,{className:"w-4 h-4 mr-2"}),"Zapisano!"]}):e.jsxs(e.Fragment,{children:[e.jsx(Rs,{className:"w-4 h-4 mr-2"}),"Zapisz quiz"]})}),e.jsx(M,{asChild:!0,variant:"outline",disabled:h,children:e.jsxs(Le,{to:"/admin/quiz-wizard/step2",children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Wr贸"]})})]}),j&&e.jsx(M,{asChild:!0,variant:"default",className:"w-full",children:e.jsx(Le,{to:"/admin/quiz-wizard",children:"Wr贸 do panelu"})})]})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Edycja pyta (",u.length,")"]}),e.jsxs(V,{variant:"outline",children:[u.length," pyta"]})]})}),e.jsxs(E,{children:[e.jsx(tt,{className:"h-[600px] pr-4",children:e.jsx("div",{className:"space-y-4",children:u.length===0?e.jsxs(he,{children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsx(pe,{children:"Brak pyta w quizie. Wr贸 do kroku 2 i wygeneruj pytania."})]}):u.map((k,T)=>e.jsxs("div",{className:"rounded-lg border p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{className:"text-xs text-muted-foreground",children:["Pytanie ",T+1]}),e.jsx(Q,{value:k.question,onChange:p=>S(T,"question",p.target.value),disabled:h||j!==null,className:"mt-1"})]}),e.jsx(M,{variant:"ghost",size:"sm",onClick:()=>_(T),disabled:h||j!==null,className:"shrink-0 text-destructive hover:text-destructive",children:e.jsx(Ft,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Odpowiedzi"}),k.options.map((p,N)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:["shrink-0 w-4 h-4 rounded-full border-2 flex items-center justify-center",N===k.answerIndex?"border-green-500 bg-green-500":"border-gray-300"].join(" "),children:N===k.answerIndex&&e.jsx(Rt,{className:"w-3 h-3 text-white"})}),e.jsx(Q,{value:p,onChange:A=>{const D=[...k.options];D[N]=A.target.value,S(T,"options",D)},disabled:h||j!==null,className:"flex-1",placeholder:`Opcja ${String.fromCharCode(65+N)}`}),e.jsx(M,{variant:"ghost",size:"sm",onClick:()=>S(T,"answerIndex",N),disabled:h||j!==null,className:N===k.answerIndex?"text-green-600":"",children:N===k.answerIndex?" Poprawna":"Ustaw"})]},N))]}),k.explanation&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Wyjanienie"}),e.jsx(Q,{value:k.explanation,onChange:p=>S(T,"explanation",p.target.value),disabled:h||j!==null,className:"mt-1"})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2 border-t",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Punkty:"}),e.jsx(Q,{type:"number",min:1,max:10,value:k.points??1,onChange:p=>S(T,"points",Number(p.target.value)),disabled:h||j!==null,className:"w-20"})]})]},T))})}),e.jsxs("div",{className:"mt-4 text-xs text-muted-foreground",children:["Pytania zostan zapisane do tabeli ",e.jsx("code",{className:"bg-muted px-1 py-0.5 rounded",children:"questions"})," z referencj do aktywnoci. Ka偶da opcja bdzie miaa flag ",e.jsx("code",{className:"bg-muted px-1 py-0.5 rounded",children:"is_correct"}),"."]})]})]})]})]}):e.jsxs(H,{children:[e.jsx(ue,{title:"Krok 3",description:"Zapis quizu"}),e.jsx(I,{children:e.jsx(E,{className:"pt-6",children:e.jsxs(he,{variant:"destructive",children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsxs(pe,{children:["Brak danych z poprzedniego kroku.",e.jsx(Le,{to:"/admin/quiz-wizard/step2",className:"underline ml-1",children:"Wr贸 do kroku 2"})]})]})})})]})}const lz=[e.jsx(K,{path:"/quiz-wizard",element:e.jsx(tz,{})},"quiz-dashboard"),e.jsx(K,{path:"/quiz-wizard/step1",element:e.jsx(iz,{})},"quiz-step1"),e.jsx(K,{path:"/quiz-wizard/step2",element:e.jsx(az,{})},"quiz-step2"),e.jsx(K,{path:"/quiz-wizard/step3",element:e.jsx(oz,{})},"quiz-step3")],zu={name:"quiz-wizard",list:"/quiz-wizard",create:"/quiz-wizard/step1",meta:{canDelete:!1,label:"Kreator quiz贸w",icon:e.jsx(ys,{className:"h-4 w-4"})}},cz=[...Fb,...Xb,...iv,...Cv,...kv,...ez,...lz],dz=()=>e.jsx(Wa,{children:e.jsxs(K,{element:e.jsx(Ob,{children:e.jsx(ac,{})}),children:[e.jsx(K,{index:!0,element:e.jsx(rs,{to:"dashboard/overview",replace:!0})}),e.jsx(K,{path:"dashboard",element:e.jsx(rs,{to:"dashboard/overview",replace:!0})}),cz]})}),uz=f.lazy(()=>Promise.resolve({default:dz})),Qf=({text:t,colorClass:s})=>e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-background",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`inline-block h-12 w-12 animate-spin rounded-full border-4 border-current border-r-transparent ${s}`}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:t})]})}),mz=({children:t})=>{const{data:s,isLoading:n}=Ze();if(n||!s)return e.jsx(Qf,{text:"Sprawdzanie uprawnie...",colorClass:"border-red-600"});if(s.role!=="admin"){const i=s.role==="teacher"?"/teacher/dashboard":"/student/dashboard";return e.jsx(rs,{to:i,replace:!0})}return e.jsx(e.Fragment,{children:t})},hz=e.jsx(K,{path:"/admin/*",element:e.jsx(dc,{fallback:e.jsx(uc,{to:"/login"}),children:e.jsx(mz,{children:e.jsx(f.Suspense,{fallback:e.jsx(Qf,{text:"adowanie panelu administratora...",colorClass:"border-red-600"}),children:e.jsx(uz,{})})})},"admin-auth")}),pz=({onClose:t})=>{const{mutate:s}=Za(),{menuItems:n}=Qh(),{data:i}=Ze(),r=()=>{t&&t()};return e.jsxs("div",{className:"flex h-full w-64 flex-col border-r bg-background",children:[e.jsxs("div",{className:"flex h-16 items-center justify-between border-b px-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Lr,{className:"h-6 w-6 mr-2"}),e.jsx("span",{className:"font-semibold",children:"Smart Up"})]}),t&&e.jsx(M,{variant:"ghost",size:"sm",onClick:t,className:"lg:hidden",children:e.jsx(Jt,{className:"h-4 w-4"})})]}),e.jsx(tt,{className:"flex-1 px-3 py-4",children:e.jsx("nav",{className:"space-y-4",children:n.map(a=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(pi,{to:a.route??"/",onClick:r,className:({isActive:o})=>B("flex items-center justify-between rounded-md px-3 py-2 text-sm font-semibold transition-colors hover:bg-accent hover:text-accent-foreground",o?"bg-accent text-accent-foreground":"text-foreground"),children:[e.jsxs("span",{className:"flex items-center",children:[a.icon&&e.jsx("span",{className:"mr-3",children:a.icon}),a.label]}),e.jsx(dt,{className:"h-4 w-4 opacity-60"})]}),a.children&&a.children.length>0&&e.jsx("div",{className:"ml-3 border-l pl-3 space-y-1",children:a.children.map(o=>e.jsxs(pi,{to:o.route??"/",onClick:r,className:({isActive:l})=>B("flex items-center rounded-md px-3 py-2 text-sm transition-colors hover:bg-accent hover:text-accent-foreground",l?"bg-accent text-accent-foreground":"text-muted-foreground"),children:[o.icon&&e.jsx("span",{className:"mr-3",children:o.icon}),o.label]},o.key))})]},a.key))})}),e.jsx(no,{}),e.jsx(xp,{className:"border-b"}),e.jsx("div",{className:"p-4",children:e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>{s(),t&&t()},className:"w-full justify-start",children:[e.jsx(Xa,{className:"mr-2 h-4 w-4"}),"Logout"]})})]})},fz=({children:t})=>{const[s,n]=f.useState(!1),i=()=>{n(!s)};return e.jsx("div",{className:"min-h-screen bg-stone-200 relative overflow-x-hidden",children:e.jsxs("div",{className:"flex relative",children:[s&&e.jsx("div",{className:"fixed inset-0 z-40 bg-purple-900/20 backdrop-blur-sm lg:hidden",onClick:()=>n(!1)}),e.jsx("aside",{className:`
            h-screen w-64 transform transition-transform duration-300 ease-in-out
            fixed left-0 top-0 z-50
            ${s?"translate-x-0":"-translate-x-full"}
            lg:translate-x-0
            bg-background/95 backdrop-blur-md border-r border-purple-200/20
          `,children:e.jsx(pz,{onClose:()=>n(!1)})}),e.jsxs("main",{className:"flex-1 lg:ml-64 min-w-0 relative z-10",children:[e.jsxs("div",{className:"sticky top-0 z-30 flex h-16 items-center border-b border-purple-200/20 bg-background/80 backdrop-blur-md px-4 lg:hidden",children:[e.jsx(M,{variant:"ghost",size:"sm",onClick:i,className:"mr-2 hover:bg-purple-100/20 hover:text-purple-700",children:e.jsx(Lr,{className:"h-6 w-6"})}),e.jsx("span",{className:"font-semibold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:"Smart Up"})]}),t]})]})})},xz=()=>{const{data:t,isLoading:s}=Ze(),[n,i]=f.useState(null),[r,a]=f.useState(!0);return f.useEffect(()=>{if(s||!t?.vendor_id){a(!1);return}let o=!0;return(async()=>{try{const[c,d,u,m,h]=await Promise.all([X.from("users").select("*",{count:"exact",head:!0}).eq("vendor_id",t.vendor_id),X.from("courses").select("*",{count:"exact"}).eq("vendor_id",t.vendor_id),X.from("activities").select("*, topics!inner(course_id, courses!inner(vendor_id))",{count:"exact"}).eq("topics.courses.vendor_id",t.vendor_id),X.from("activity_progress").select("score, completed_at").not("completed_at","is",null),X.from("user_stats").select("total_points")]);if(!o)return;const y=m.data?.length?m.data.reduce((g,j)=>g+(j.score||0),0)/m.data.length:0,x=h.data?.reduce((g,j)=>g+j.total_points,0)||0;i({totalUsers:c.count||0,activeUsers:c.count||0,totalCourses:d.count||0,publishedCourses:d.data?.filter(g=>g.is_published).length||0,totalActivities:u.count||0,completedActivities:m.data?.length||0,averageScore:Math.round(y),totalPoints:x})}catch(c){console.error("Error fetching dashboard stats:",c)}finally{o&&a(!1)}})(),()=>{o=!1}},[t?.vendor_id,s]),r||s?e.jsx(H,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):t?e.jsxs(H,{children:[e.jsx(ue,{title:"Dashboard",description:"Przegld statystyk systemu e-learning"}),e.jsxs(yt,{variant:"1-2-2",children:[e.jsxs(I,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"U偶ytkownicy"}),e.jsx(de,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n?.totalUsers||0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[n?.activeUsers||0," aktywnych"]})]})]}),e.jsxs(I,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Kursy"}),e.jsx(ye,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n?.totalCourses||0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[n?.publishedCourses||0," opublikowanych"]})]})]}),e.jsxs(I,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Aktywnoci"}),e.jsx(Or,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n?.totalActivities||0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[n?.completedActivities||0," ukoczonych"]})]})]}),e.jsxs(I,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"redni wynik"}),e.jsx(Be,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[n?.averageScore||0,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"z wszystkich quiz贸w"})]})]})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Aktywno w ostatnich 7 dniach"})}),e.jsx(E,{children:e.jsxs("div",{className:"h-[300px] flex items-center justify-center text-muted-foreground",children:[e.jsx(xt,{className:"h-8 w-8 mr-2"}),"Wykres aktywnoci (do implementacji)"]})})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Top 5 u偶ytkownik贸w"})}),e.jsx(E,{children:e.jsx("div",{className:"space-y-4",children:[1,2,3,4,5].map(o=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(qe,{className:`h-5 w-5 ${o<=3?"text-yellow-500":"text-muted-foreground"}`}),e.jsxs("span",{children:["U偶ytkownik ",o]})]}),e.jsxs("span",{className:"font-semibold",children:[1e3-o*100," pkt"]})]},o))})})]})]}):e.jsx(H,{children:e.jsx("div",{className:"text-center text-muted-foreground",children:"Nie mo偶na zaadowa danych u偶ytkownika"})})},gz=[e.jsx(K,{path:"/dashboard/overview",element:e.jsx(xz,{})},"dashboard")];var Al=["Enter"," "],jz=["ArrowDown","PageUp","Home"],Yf=["ArrowUp","PageDown","End"],yz=[...jz,...Yf],wz={ltr:[...Al,"ArrowRight"],rtl:[...Al,"ArrowLeft"]},bz={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Ur="Menu",[kr,vz,Nz]=_y(Ur),[qn,Jf]=rc(Ur,[Nz,Uh,Vh]),vo=Uh(),Xf=Vh(),[kz,Bn]=qn(Ur),[zz,Vr]=qn(Ur),ex=t=>{const{__scopeMenu:s,open:n=!1,children:i,dir:r,onOpenChange:a,modal:o=!0}=t,l=vo(s),[c,d]=f.useState(null),u=f.useRef(!1),m=Wh(a),h=qy(r);return f.useEffect(()=>{const y=()=>{u.current=!0,document.addEventListener("pointerdown",x,{capture:!0,once:!0}),document.addEventListener("pointermove",x,{capture:!0,once:!0})},x=()=>u.current=!1;return document.addEventListener("keydown",y,{capture:!0}),()=>{document.removeEventListener("keydown",y,{capture:!0}),document.removeEventListener("pointerdown",x,{capture:!0}),document.removeEventListener("pointermove",x,{capture:!0})}},[]),e.jsx(By,{...l,children:e.jsx(kz,{scope:s,open:n,onOpenChange:m,content:c,onContentChange:d,children:e.jsx(zz,{scope:s,onClose:f.useCallback(()=>m(!1),[m]),isUsingKeyboardRef:u,dir:h,modal:o,children:i})})})};ex.displayName=Ur;var Sz="MenuAnchor",Oc=f.forwardRef((t,s)=>{const{__scopeMenu:n,...i}=t,r=vo(n);return e.jsx(Ay,{...r,...i,ref:s})});Oc.displayName=Sz;var $c="MenuPortal",[Cz,tx]=qn($c,{forceMount:void 0}),sx=t=>{const{__scopeMenu:s,forceMount:n,children:i,container:r}=t,a=Bn($c,s);return e.jsx(Cz,{scope:s,forceMount:n,children:e.jsx(Ka,{present:n||a.open,children:e.jsx(Ty,{asChild:!0,container:r,children:i})})})};sx.displayName=$c;var Ht="MenuContent",[_z,Fc]=qn(Ht),nx=f.forwardRef((t,s)=>{const n=tx(Ht,t.__scopeMenu),{forceMount:i=n.forceMount,...r}=t,a=Bn(Ht,t.__scopeMenu),o=Vr(Ht,t.__scopeMenu);return e.jsx(kr.Provider,{scope:t.__scopeMenu,children:e.jsx(Ka,{present:i||a.open,children:e.jsx(kr.Slot,{scope:t.__scopeMenu,children:o.modal?e.jsx(Tz,{...r,ref:s}):e.jsx(Az,{...r,ref:s})})})})}),Tz=f.forwardRef((t,s)=>{const n=Bn(Ht,t.__scopeMenu),i=f.useRef(null),r=Pn(s,i);return f.useEffect(()=>{const a=i.current;if(a)return $y(a)},[]),e.jsx(qc,{...t,ref:r,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:Se(t.onFocusOutside,a=>a.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),Az=f.forwardRef((t,s)=>{const n=Bn(Ht,t.__scopeMenu);return e.jsx(qc,{...t,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),Dz=Iy("MenuContent.ScrollLock"),qc=f.forwardRef((t,s)=>{const{__scopeMenu:n,loop:i=!1,trapFocus:r,onOpenAutoFocus:a,onCloseAutoFocus:o,disableOutsidePointerEvents:l,onEntryFocus:c,onEscapeKeyDown:d,onPointerDownOutside:u,onFocusOutside:m,onInteractOutside:h,onDismiss:y,disableOutsideScroll:x,...g}=t,j=Bn(Ht,n),w=Vr(Ht,n),b=vo(n),v=Xf(n),C=vz(n),[_,S]=f.useState(null),z=f.useRef(null),k=Pn(s,z,j.onContentChange),T=f.useRef(0),p=f.useRef(""),N=f.useRef(0),A=f.useRef(null),D=f.useRef("right"),P=f.useRef(0),R=x?My:f.Fragment,q=x?{as:Dz,allowPinchZoom:!0}:void 0,L=O=>{const G=p.current+O,se=C().filter(me=>!me.disabled),ie=document.activeElement,Ce=se.find(me=>me.ref.current===ie)?.textValue,bt=se.map(me=>me.textValue),Tt=Uz(bt,G,Ce),_e=se.find(me=>me.textValue===Tt)?.ref.current;(function me(ut){p.current=ut,window.clearTimeout(T.current),ut!==""&&(T.current=window.setTimeout(()=>me(""),1e3))})(G),_e&&setTimeout(()=>_e.focus())};f.useEffect(()=>()=>window.clearTimeout(T.current),[]),Py();const U=f.useCallback(O=>D.current===A.current?.side&&Kz(O,A.current?.area),[]);return e.jsx(_z,{scope:n,searchRef:p,onItemEnter:f.useCallback(O=>{U(O)&&O.preventDefault()},[U]),onItemLeave:f.useCallback(O=>{U(O)||(z.current?.focus(),S(null))},[U]),onTriggerLeave:f.useCallback(O=>{U(O)&&O.preventDefault()},[U]),pointerGraceTimerRef:N,onPointerGraceIntentChange:f.useCallback(O=>{A.current=O},[]),children:e.jsx(R,{...q,children:e.jsx(Ey,{asChild:!0,trapped:r,onMountAutoFocus:Se(a,O=>{O.preventDefault(),z.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:e.jsx(Ry,{asChild:!0,disableOutsidePointerEvents:l,onEscapeKeyDown:d,onPointerDownOutside:u,onFocusOutside:m,onInteractOutside:h,onDismiss:y,children:e.jsx(Ly,{asChild:!0,...v,dir:w.dir,orientation:"vertical",loop:i,currentTabStopId:_,onCurrentTabStopIdChange:S,onEntryFocus:Se(c,O=>{w.isUsingKeyboardRef.current||O.preventDefault()}),preventScrollOnEntryFocus:!0,children:e.jsx(Oy,{role:"menu","aria-orientation":"vertical","data-state":yx(j.open),"data-radix-menu-content":"",dir:w.dir,...b,...g,ref:k,style:{outline:"none",...g.style},onKeyDown:Se(g.onKeyDown,O=>{const se=O.target.closest("[data-radix-menu-content]")===O.currentTarget,ie=O.ctrlKey||O.altKey||O.metaKey,Ce=O.key.length===1;se&&(O.key==="Tab"&&O.preventDefault(),!ie&&Ce&&L(O.key));const bt=z.current;if(O.target!==bt||!yz.includes(O.key))return;O.preventDefault();const _e=C().filter(me=>!me.disabled).map(me=>me.ref.current);Yf.includes(O.key)&&_e.reverse(),qz(_e)}),onBlur:Se(t.onBlur,O=>{O.currentTarget.contains(O.target)||(window.clearTimeout(T.current),p.current="")}),onPointerMove:Se(t.onPointerMove,zr(O=>{const G=O.target,se=P.current!==O.clientX;if(O.currentTarget.contains(G)&&se){const ie=O.clientX>P.current?"right":"left";D.current=ie,P.current=O.clientX}}))})})})})})})});nx.displayName=Ht;var Pz="MenuGroup",Bc=f.forwardRef((t,s)=>{const{__scopeMenu:n,...i}=t;return e.jsx(on.div,{role:"group",...i,ref:s})});Bc.displayName=Pz;var Mz="MenuLabel",ix=f.forwardRef((t,s)=>{const{__scopeMenu:n,...i}=t;return e.jsx(on.div,{...i,ref:s})});ix.displayName=Mz;var Ia="MenuItem",Su="menu.itemSelect",No=f.forwardRef((t,s)=>{const{disabled:n=!1,onSelect:i,...r}=t,a=f.useRef(null),o=Vr(Ia,t.__scopeMenu),l=Fc(Ia,t.__scopeMenu),c=Pn(s,a),d=f.useRef(!1),u=()=>{const m=a.current;if(!n&&m){const h=new CustomEvent(Su,{bubbles:!0,cancelable:!0});m.addEventListener(Su,y=>i?.(y),{once:!0}),Fy(m,h),h.defaultPrevented?d.current=!1:o.onClose()}};return e.jsx(rx,{...r,ref:c,disabled:n,onClick:Se(t.onClick,u),onPointerDown:m=>{t.onPointerDown?.(m),d.current=!0},onPointerUp:Se(t.onPointerUp,m=>{d.current||m.currentTarget?.click()}),onKeyDown:Se(t.onKeyDown,m=>{const h=l.searchRef.current!=="";n||h&&m.key===" "||Al.includes(m.key)&&(m.currentTarget.click(),m.preventDefault())})})});No.displayName=Ia;var rx=f.forwardRef((t,s)=>{const{__scopeMenu:n,disabled:i=!1,textValue:r,...a}=t,o=Fc(Ia,n),l=Xf(n),c=f.useRef(null),d=Pn(s,c),[u,m]=f.useState(!1),[h,y]=f.useState("");return f.useEffect(()=>{const x=c.current;x&&y((x.textContent??"").trim())},[a.children]),e.jsx(kr.ItemSlot,{scope:n,disabled:i,textValue:r??h,children:e.jsx(Dy,{asChild:!0,...l,focusable:!i,children:e.jsx(on.div,{role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":i||void 0,"data-disabled":i?"":void 0,...a,ref:d,onPointerMove:Se(t.onPointerMove,zr(x=>{i?o.onItemLeave(x):(o.onItemEnter(x),x.defaultPrevented||x.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Se(t.onPointerLeave,zr(x=>o.onItemLeave(x))),onFocus:Se(t.onFocus,()=>m(!0)),onBlur:Se(t.onBlur,()=>m(!1))})})})}),Iz="MenuCheckboxItem",ax=f.forwardRef((t,s)=>{const{checked:n=!1,onCheckedChange:i,...r}=t;return e.jsx(ux,{scope:t.__scopeMenu,checked:n,children:e.jsx(No,{role:"menuitemcheckbox","aria-checked":Ea(n)?"mixed":n,...r,ref:s,"data-state":Vc(n),onSelect:Se(r.onSelect,()=>i?.(Ea(n)?!0:!n),{checkForDefaultPrevented:!1})})})});ax.displayName=Iz;var ox="MenuRadioGroup",[Ez,Rz]=qn(ox,{value:void 0,onValueChange:()=>{}}),lx=f.forwardRef((t,s)=>{const{value:n,onValueChange:i,...r}=t,a=Wh(i);return e.jsx(Ez,{scope:t.__scopeMenu,value:n,onValueChange:a,children:e.jsx(Bc,{...r,ref:s})})});lx.displayName=ox;var cx="MenuRadioItem",dx=f.forwardRef((t,s)=>{const{value:n,...i}=t,r=Rz(cx,t.__scopeMenu),a=n===r.value;return e.jsx(ux,{scope:t.__scopeMenu,checked:a,children:e.jsx(No,{role:"menuitemradio","aria-checked":a,...i,ref:s,"data-state":Vc(a),onSelect:Se(i.onSelect,()=>r.onValueChange?.(n),{checkForDefaultPrevented:!1})})})});dx.displayName=cx;var Uc="MenuItemIndicator",[ux,Lz]=qn(Uc,{checked:!1}),mx=f.forwardRef((t,s)=>{const{__scopeMenu:n,forceMount:i,...r}=t,a=Lz(Uc,n);return e.jsx(Ka,{present:i||Ea(a.checked)||a.checked===!0,children:e.jsx(on.span,{...r,ref:s,"data-state":Vc(a.checked)})})});mx.displayName=Uc;var Oz="MenuSeparator",hx=f.forwardRef((t,s)=>{const{__scopeMenu:n,...i}=t;return e.jsx(on.div,{role:"separator","aria-orientation":"horizontal",...i,ref:s})});hx.displayName=Oz;var $z="MenuArrow",px=f.forwardRef((t,s)=>{const{__scopeMenu:n,...i}=t,r=vo(n);return e.jsx(Uy,{...r,...i,ref:s})});px.displayName=$z;var Fz="MenuSub",[hP,fx]=qn(Fz),er="MenuSubTrigger",xx=f.forwardRef((t,s)=>{const n=Bn(er,t.__scopeMenu),i=Vr(er,t.__scopeMenu),r=fx(er,t.__scopeMenu),a=Fc(er,t.__scopeMenu),o=f.useRef(null),{pointerGraceTimerRef:l,onPointerGraceIntentChange:c}=a,d={__scopeMenu:t.__scopeMenu},u=f.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return f.useEffect(()=>u,[u]),f.useEffect(()=>{const m=l.current;return()=>{window.clearTimeout(m),c(null)}},[l,c]),e.jsx(Oc,{asChild:!0,...d,children:e.jsx(rx,{id:r.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":r.contentId,"data-state":yx(n.open),...t,ref:Kh(s,r.onTriggerChange),onClick:m=>{t.onClick?.(m),!(t.disabled||m.defaultPrevented)&&(m.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:Se(t.onPointerMove,zr(m=>{a.onItemEnter(m),!m.defaultPrevented&&!t.disabled&&!n.open&&!o.current&&(a.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{n.onOpenChange(!0),u()},100))})),onPointerLeave:Se(t.onPointerLeave,zr(m=>{u();const h=n.content?.getBoundingClientRect();if(h){const y=n.content?.dataset.side,x=y==="right",g=x?-5:5,j=h[x?"left":"right"],w=h[x?"right":"left"];a.onPointerGraceIntentChange({area:[{x:m.clientX+g,y:m.clientY},{x:j,y:h.top},{x:w,y:h.top},{x:w,y:h.bottom},{x:j,y:h.bottom}],side:y}),window.clearTimeout(l.current),l.current=window.setTimeout(()=>a.onPointerGraceIntentChange(null),300)}else{if(a.onTriggerLeave(m),m.defaultPrevented)return;a.onPointerGraceIntentChange(null)}})),onKeyDown:Se(t.onKeyDown,m=>{const h=a.searchRef.current!=="";t.disabled||h&&m.key===" "||wz[i.dir].includes(m.key)&&(n.onOpenChange(!0),n.content?.focus(),m.preventDefault())})})})});xx.displayName=er;var gx="MenuSubContent",jx=f.forwardRef((t,s)=>{const n=tx(Ht,t.__scopeMenu),{forceMount:i=n.forceMount,...r}=t,a=Bn(Ht,t.__scopeMenu),o=Vr(Ht,t.__scopeMenu),l=fx(gx,t.__scopeMenu),c=f.useRef(null),d=Pn(s,c);return e.jsx(kr.Provider,{scope:t.__scopeMenu,children:e.jsx(Ka,{present:i||a.open,children:e.jsx(kr.Slot,{scope:t.__scopeMenu,children:e.jsx(qc,{id:l.contentId,"aria-labelledby":l.triggerId,...r,ref:d,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:u=>{o.isUsingKeyboardRef.current&&c.current?.focus(),u.preventDefault()},onCloseAutoFocus:u=>u.preventDefault(),onFocusOutside:Se(t.onFocusOutside,u=>{u.target!==l.trigger&&a.onOpenChange(!1)}),onEscapeKeyDown:Se(t.onEscapeKeyDown,u=>{o.onClose(),u.preventDefault()}),onKeyDown:Se(t.onKeyDown,u=>{const m=u.currentTarget.contains(u.target),h=bz[o.dir].includes(u.key);m&&h&&(a.onOpenChange(!1),l.trigger?.focus(),u.preventDefault())})})})})})});jx.displayName=gx;function yx(t){return t?"open":"closed"}function Ea(t){return t==="indeterminate"}function Vc(t){return Ea(t)?"indeterminate":t?"checked":"unchecked"}function qz(t){const s=document.activeElement;for(const n of t)if(n===s||(n.focus(),document.activeElement!==s))return}function Bz(t,s){return t.map((n,i)=>t[(s+i)%t.length])}function Uz(t,s,n){const r=s.length>1&&Array.from(s).every(d=>d===s[0])?s[0]:s,a=n?t.indexOf(n):-1;let o=Bz(t,Math.max(a,0));r.length===1&&(o=o.filter(d=>d!==n));const c=o.find(d=>d.toLowerCase().startsWith(r.toLowerCase()));return c!==n?c:void 0}function Vz(t,s){const{x:n,y:i}=t;let r=!1;for(let a=0,o=s.length-1;a<s.length;o=a++){const l=s[a],c=s[o],d=l.x,u=l.y,m=c.x,h=c.y;u>i!=h>i&&n<(m-d)*(i-u)/(h-u)+d&&(r=!r)}return r}function Kz(t,s){if(!s)return!1;const n={x:t.clientX,y:t.clientY};return Vz(n,s)}function zr(t){return s=>s.pointerType==="mouse"?t(s):void 0}var Wz=ex,Gz=Oc,Zz=sx,Hz=nx,Qz=Bc,Yz=ix,Jz=No,Xz=ax,e1=lx,t1=dx,s1=mx,n1=hx,i1=px,r1=xx,a1=jx,ko="DropdownMenu",[o1,pP]=rc(ko,[Jf]),wt=Jf(),[l1,wx]=o1(ko),bx=t=>{const{__scopeDropdownMenu:s,children:n,dir:i,open:r,defaultOpen:a,onOpenChange:o,modal:l=!0}=t,c=wt(s),d=f.useRef(null),[u,m]=Rh({prop:r,defaultProp:a??!1,onChange:o,caller:ko});return e.jsx(l1,{scope:s,triggerId:Bd(),triggerRef:d,contentId:Bd(),open:u,onOpenChange:m,onOpenToggle:f.useCallback(()=>m(h=>!h),[m]),modal:l,children:e.jsx(Wz,{...c,open:u,onOpenChange:m,dir:i,modal:l,children:n})})};bx.displayName=ko;var vx="DropdownMenuTrigger",Nx=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,disabled:i=!1,...r}=t,a=wx(vx,n),o=wt(n);return e.jsx(Gz,{asChild:!0,...o,children:e.jsx(on.button,{type:"button",id:a.triggerId,"aria-haspopup":"menu","aria-expanded":a.open,"aria-controls":a.open?a.contentId:void 0,"data-state":a.open?"open":"closed","data-disabled":i?"":void 0,disabled:i,...r,ref:Kh(s,a.triggerRef),onPointerDown:Se(t.onPointerDown,l=>{!i&&l.button===0&&l.ctrlKey===!1&&(a.onOpenToggle(),a.open||l.preventDefault())}),onKeyDown:Se(t.onKeyDown,l=>{i||(["Enter"," "].includes(l.key)&&a.onOpenToggle(),l.key==="ArrowDown"&&a.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(l.key)&&l.preventDefault())})})})});Nx.displayName=vx;var c1="DropdownMenuPortal",kx=t=>{const{__scopeDropdownMenu:s,...n}=t,i=wt(s);return e.jsx(Zz,{...i,...n})};kx.displayName=c1;var zx="DropdownMenuContent",Sx=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=wx(zx,n),a=wt(n),o=f.useRef(!1);return e.jsx(Hz,{id:r.contentId,"aria-labelledby":r.triggerId,...a,...i,ref:s,onCloseAutoFocus:Se(t.onCloseAutoFocus,l=>{o.current||r.triggerRef.current?.focus(),o.current=!1,l.preventDefault()}),onInteractOutside:Se(t.onInteractOutside,l=>{const c=l.detail.originalEvent,d=c.button===0&&c.ctrlKey===!0,u=c.button===2||d;(!r.modal||u)&&(o.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Sx.displayName=zx;var d1="DropdownMenuGroup",u1=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=wt(n);return e.jsx(Qz,{...r,...i,ref:s})});u1.displayName=d1;var m1="DropdownMenuLabel",Cx=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=wt(n);return e.jsx(Yz,{...r,...i,ref:s})});Cx.displayName=m1;var h1="DropdownMenuItem",_x=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=wt(n);return e.jsx(Jz,{...r,...i,ref:s})});_x.displayName=h1;var p1="DropdownMenuCheckboxItem",Tx=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=wt(n);return e.jsx(Xz,{...r,...i,ref:s})});Tx.displayName=p1;var f1="DropdownMenuRadioGroup",x1=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=wt(n);return e.jsx(e1,{...r,...i,ref:s})});x1.displayName=f1;var g1="DropdownMenuRadioItem",Ax=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=wt(n);return e.jsx(t1,{...r,...i,ref:s})});Ax.displayName=g1;var j1="DropdownMenuItemIndicator",Dx=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=wt(n);return e.jsx(s1,{...r,...i,ref:s})});Dx.displayName=j1;var y1="DropdownMenuSeparator",Px=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=wt(n);return e.jsx(n1,{...r,...i,ref:s})});Px.displayName=y1;var w1="DropdownMenuArrow",b1=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=wt(n);return e.jsx(i1,{...r,...i,ref:s})});b1.displayName=w1;var v1="DropdownMenuSubTrigger",Mx=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=wt(n);return e.jsx(r1,{...r,...i,ref:s})});Mx.displayName=v1;var N1="DropdownMenuSubContent",Ix=f.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=wt(n);return e.jsx(a1,{...r,...i,ref:s,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Ix.displayName=N1;var k1=bx,z1=Nx,S1=kx,Ex=Sx,Rx=Cx,Lx=_x,Ox=Tx,$x=Ax,Fx=Dx,qx=Px,Bx=Mx,Ux=Ix;const Ni=k1,ki=z1,C1=f.forwardRef(({className:t,inset:s,children:n,...i},r)=>e.jsxs(Bx,{ref:r,className:B("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s&&"pl-8",t),...i,children:[n,e.jsx(be,{className:"ml-auto"})]}));C1.displayName=Bx.displayName;const _1=f.forwardRef(({className:t,...s},n)=>e.jsx(Ux,{ref:n,className:B("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...s}));_1.displayName=Ux.displayName;const Tn=f.forwardRef(({className:t,sideOffset:s=4,...n},i)=>e.jsx(S1,{children:e.jsx(Ex,{ref:i,sideOffset:s,className:B("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...n})}));Tn.displayName=Ex.displayName;const ve=f.forwardRef(({className:t,inset:s,...n},i)=>e.jsx(Lx,{ref:i,className:B("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",s&&"pl-8",t),...n}));ve.displayName=Lx.displayName;const T1=f.forwardRef(({className:t,children:s,checked:n,...i},r)=>e.jsxs(Ox,{ref:r,className:B("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:n,...i,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Fx,{children:e.jsx(rt,{className:"h-4 w-4"})})}),s]}));T1.displayName=Ox.displayName;const A1=f.forwardRef(({className:t,children:s,...n},i)=>e.jsxs($x,{ref:i,className:B("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Fx,{children:e.jsx(pa,{className:"h-2 w-2 fill-current"})})}),s]}));A1.displayName=$x.displayName;const Vx=f.forwardRef(({className:t,inset:s,...n},i)=>e.jsx(Rx,{ref:i,className:B("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",t),...n}));Vx.displayName=Rx.displayName;const jt=f.forwardRef(({className:t,...s},n)=>e.jsx(qx,{ref:n,className:B("-mx-1 my-1 h-px bg-muted",t),...s}));jt.displayName=qx.displayName;const D1=()=>{const t=ae(),s=Ns(),n=()=>{const o=`${s.pathname}${s.search}`;sessionStorage.setItem("returnUrl",o)};return{navigateWithReturn:o=>{n(),t(o)},goBack:o=>{const l=sessionStorage.getItem("returnUrl");l?(sessionStorage.removeItem("returnUrl"),t(l)):t(o||-1)},saveReturnUrl:n,navigateToWizard:(o,l)=>{l&&sessionStorage.setItem("wizardContext",JSON.stringify(l)),n(),t(o)},currentUrl:`${s.pathname}${s.search}`}},Dl=t=>{const{mutate:s,isLoading:n}=Mn();return{togglePublish:async(r,a,o,l)=>{s({resource:t,id:r,values:{is_published:!a}},{onSuccess:()=>{Y.success(a?`${o} zosta ukryty`:`${o} zosta opublikowany`),l?.()},onError:c=>{Y.error("Nie udao si zmieni statusu publikacji"),console.error("Publish toggle error:",c)}})},isToggling:n}},Cu=t=>{const{mutate:s}=Mn(),n=Jh(),[i,r]=f.useState(!1);return{updatePosition:f.useCallback(async(o,l)=>{if(!i){r(!0);try{await new Promise((c,d)=>{s({resource:t,id:o,values:{position:l},mutationMode:"optimistic"},{onSuccess:()=>{console.log(`Updated position for ${t} ${o} to ${l}`),c()},onError:u=>d(u)})}),setTimeout(()=>{n({resource:t,invalidates:["list"]})},1e3)}catch(c){console.error("Position update error:",c),Y.error("Nie udao si zaktualizowa pozycji"),await n({resource:t,invalidates:["list"]})}finally{r(!1)}}},[t,s,n,i]),isUpdating:i}},P1=t=>{const{data:s,isLoading:n}=Xe({resource:"courses",id:t,queryOptions:{enabled:!!t}}),{data:i,isLoading:r,refetch:a}=Z({resource:"topics",filters:[{field:"course_id",operator:"eq",value:t}],sorters:[{field:"position",order:"asc"}],pagination:{mode:"off"},meta:{select:"*, activities(count)"},queryOptions:{enabled:!!t}}),{data:o,refetch:l}=Z({resource:"activities",filters:[{field:"topic_id",operator:"in",value:i?.data?.map(j=>j.id)||[]}],sorters:[{field:"position",order:"asc"}],pagination:{mode:"off"},meta:{select:"*, questions(count)"},queryOptions:{enabled:!!i?.data?.length}}),{data:c}=Z({resource:"course_access",filters:[{field:"course_id",operator:"eq",value:t}],queryOptions:{enabled:!!t}}),d=c?.data?.filter(j=>j.group_id).map(j=>j.group_id)||[],{data:u}=Z({resource:"groups",filters:d.length>0?[{field:"id",operator:"in",value:d}]:[],pagination:{mode:"off"},queryOptions:{enabled:d.length>0}}),{data:m}=Z({resource:"group_members",filters:d.length>0?[{field:"group_id",operator:"in",value:d}]:[],pagination:{mode:"off"},meta:{select:"group_id"},queryOptions:{enabled:d.length>0}}),h=n||r,y={topicsCount:i?.total||0,activitiesCount:o?.total||0,accessCount:c?.total||0},x=j=>o?.data?.filter(w=>w.topic_id===j)||[],g=j=>m?.data?.filter(w=>w.group_id===j).length||0;return{course:s?.data,topics:i?.data||[],activities:o?.data||[],groups:u?.data||[],access:c?.data||[],stats:y,isLoading:h,refetchTopics:a,refetchActivities:l,getActivitiesForTopic:x,getMembersCountForGroup:g}},M1=()=>{const{create:t,edit:s,show:n}=ct(),{mutate:i}=Is(),{togglePublish:r}=Dl("courses"),{data:a}=Ze(),[o,l]=f.useState(""),{data:c,isLoading:d,isError:u,refetch:m}=Z({resource:"courses",pagination:{mode:"off"},sorters:[{field:"created_at",order:"desc"}]}),{data:h,isLoading:y}=Z({resource:"course_access",filters:a?.role==="teacher"?[{field:"teacher_id",operator:"eq",value:a?.id}]:[],pagination:{mode:"off"},queryOptions:{enabled:!!a?.id&&a?.role==="teacher"}}),{data:x}=Z({resource:"topics",pagination:{mode:"off"},meta:{select:"course_id"}}),{data:g}=Z({resource:"course_access",pagination:{mode:"off"},meta:{select:"course_id"}}),j=f.useMemo(()=>h?.data?.map(p=>p.course_id)||[],[h?.data]),w=f.useMemo(()=>{let p=c?.data||[];return a?.role==="teacher"&&(p=p.filter(N=>j.includes(N.id))),o&&(p=p.filter(N=>N.title.toLowerCase().includes(o.toLowerCase()))),p},[c?.data,j,a?.role,o]),b=p=>{const N=x?.data?.filter(D=>D.course_id===p).length||0,A=g?.data?.filter(D=>D.course_id===p).length||0;return{topicsCount:N,accessCount:A}},v=(p,N)=>{confirm(`Czy na pewno chcesz usun kurs "${N}"?`)&&i({resource:"courses",id:p},{onSuccess:()=>{Y.success("Kurs zosta usunity"),m()}})},C=(p,N,A)=>{N&&A&&sessionStorage.setItem("wizardContext",JSON.stringify({courseId:N,courseTitle:A})),window.location.href=p},_=d||a?.role==="teacher"&&y,z=xc({isLoading:_,isError:u});if(z)return z;const k=a?.role==="teacher",T=a?.role==="admin";return e.jsxs(H,{children:[e.jsxs(J,{children:[e.jsx(ue,{title:"Moje kursy",description:T?"Zarzdzaj wszystkimi kursami w systemie":"Kursy, kt贸re prowadzisz"}),T&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ts,{children:e.jsxs(As,{children:[e.jsx(Ds,{asChild:!0,children:e.jsxs(M,{variant:"outline",onClick:()=>C("/teacher/course-structure/step1"),children:[e.jsx(hr,{className:"w-4 h-4 mr-2"}),e.jsx(Ke,{className:"w-3 h-3"})]})}),e.jsx(us,{children:e.jsx("p",{children:"Stw贸rz kurs z pomoc AI"})})]})}),e.jsxs(M,{onClick:()=>t("courses"),children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Dodaj kurs"]})]})]}),e.jsxs(J,{children:[e.jsx(Q,{placeholder:"Szukaj kurs贸w...",className:"max-w-sm",value:o,onChange:p=>l(p.target.value)}),k&&e.jsx(V,{variant:"outline",children:"Pokazuj tylko kursy, kt贸re prowadzisz"})]}),e.jsx(yt,{children:w.map(p=>{const N=b(p.id);return e.jsxs(I,{className:`relative cursor-pointer transition-all duration-200 ${p.is_published?"hover:shadow-lg":"opacity-80 hover:opacity-90 "}`,onClick:A=>{A.target.closest('[role="menu"]')||n("courses",p.id)},children:[e.jsx(F,{children:e.jsxs(J,{children:[e.jsxs($,{className:"flex items-center gap-2 min-w-0",children:[e.jsx("span",{className:"flex-shrink-0",children:p.icon_emoji?e.jsx("span",{className:"text-2xl",children:p.icon_emoji}):e.jsx(ye,{className:"w-5 h-5"})}),e.jsx(Ts,{delayDuration:200,children:e.jsxs(As,{children:[e.jsx(Ds,{asChild:!0,children:e.jsx("span",{className:"truncate",children:p.title})}),p.title.length>30&&e.jsx(us,{children:e.jsx("p",{className:"max-w-xs",children:p.title})})]})})]}),e.jsxs(Ni,{children:[e.jsx(ki,{asChild:!0,children:e.jsx(M,{variant:"ghost",size:"sm",onClick:A=>A.stopPropagation(),children:e.jsx(eo,{className:"h-4 w-4"})})}),e.jsxs(Tn,{align:"end",children:[e.jsxs(ve,{onClick:()=>n("courses",p.id),children:[e.jsx(Je,{className:"mr-2 h-4 w-4"}),"Podgld"]}),T&&e.jsxs(e.Fragment,{children:[e.jsxs(ve,{onClick:()=>s("courses",p.id),children:[e.jsx(ks,{className:"mr-2 h-4 w-4"}),"Edytuj"]}),e.jsx(jt,{}),e.jsx(ve,{onClick:()=>r(p.id,p.is_published,p.title,m),children:p.is_published?e.jsxs(e.Fragment,{children:[e.jsx(dn,{className:"mr-2 h-4 w-4"}),"Ukryj kurs"]}):e.jsxs(e.Fragment,{children:[e.jsx(Je,{className:"mr-2 h-4 w-4"}),"Opublikuj kurs"]})})]}),e.jsx(jt,{}),e.jsxs(ve,{onClick:()=>C("/teacher/educational-material/step1",p.id,p.title),className:"text-purple-600 focus:text-purple-600",children:[e.jsx(Ke,{className:"mr-2 h-4 w-4"}),"Generuj materia z AI"]}),e.jsxs(ve,{onClick:()=>C("/teacher/quiz-wizard/step1",p.id,p.title),className:"text-blue-600 focus:text-blue-600",children:[e.jsx(ys,{className:"mr-2 h-4 w-4"}),"Generuj quiz z AI"]}),T&&e.jsxs(e.Fragment,{children:[e.jsx(jt,{}),e.jsxs(ve,{onClick:()=>v(p.id,p.title),className:"text-red-600 focus:text-red-600",children:[e.jsx(Ft,{className:"mr-2 h-4 w-4"}),"Usu"]})]})]})]})]})}),e.jsxs(E,{children:[p.description&&e.jsx("p",{className:"text-sm text-muted-foreground mb-3 line-clamp-2",children:p.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex gap-2",children:e.jsx(V,{variant:p.is_published?"default":"secondary",className:p.is_published?"bg-green-600":"",children:p.is_published?"Opublikowany":"Szkic"})}),e.jsxs("div",{className:"flex gap-3 text-sm text-muted-foreground",children:[e.jsx(Ts,{children:e.jsxs(As,{children:[e.jsx(Ds,{asChild:!0,children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(zt,{className:"w-3 h-3"}),N.topicsCount]})}),e.jsx(us,{children:e.jsx("p",{children:"Liczba temat贸w"})})]})}),e.jsx(Ts,{children:e.jsxs(As,{children:[e.jsx(Ds,{asChild:!0,children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(de,{className:"w-3 h-3"}),N.accessCount]})}),e.jsx(us,{children:e.jsx("p",{children:"Liczba przypisa"})})]})})]})]}),p.created_at&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-xs text-muted-foreground",children:[e.jsx(et,{className:"w-3 h-3"}),e.jsxs("span",{children:["Utworzono:"," ",new Date(p.created_at).toLocaleDateString("pl-PL")]})]})]})]},p.id)})}),w.length===0&&e.jsx(I,{className:"border-dashed border-2",children:e.jsx(E,{className:"text-center py-12",children:k?e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Nie prowadzisz jeszcze 偶adnych kurs贸w"}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:"Administrator systemu tworzy kursy i przypisuje do nich nauczycieli. Skontaktuj si z administratorem, aby uzyska dostp do kurs贸w, kt贸re bdziesz prowadzi."}),e.jsx("div",{className:"flex gap-3 justify-center",children:e.jsxs(M,{variant:"outline",disabled:!0,children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Kursy tworzy administrator"]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(hr,{className:"w-12 h-12 mx-auto mb-4 text-indigo-600"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Brak kurs贸w"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Rozpocznij od stworzenia pierwszego kursu"}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsxs(M,{variant:"outline",onClick:()=>t("courses"),children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Dodaj rcznie"]}),e.jsxs(M,{onClick:()=>C("/teacher/course-structure/step1"),className:"bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700",children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"}),"Wygeneruj z AI"]})]})]})})})]})},mn=({children:t,onSubmit:s,className:n="",...i})=>{const r="space-y-6",a=n?`${r} ${n}`:r;return e.jsx("form",{onSubmit:s,className:a,...i,children:t})},re=({children:t,label:s,htmlFor:n,error:i,required:r=!1,className:a="",hint:o})=>{const l="space-y-2",c=a?`${l} ${a}`:l,d=()=>s?typeof s=="string"?e.jsxs(gr,{htmlFor:n,children:[s,r&&e.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}):e.jsxs(gr,{htmlFor:n,className:"flex items-center",children:[s,r&&e.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}):null,u=f.isValidElement(t)?f.cloneElement(t,{className:`${t.props.className||""} ${i?"border-red-500 ring-1 ring-red-500":""}`.trim()}):t;return e.jsxs("div",{className:c,children:[d(),u,o&&!i&&e.jsx("p",{className:"text-sm text-muted-foreground",children:o}),i&&e.jsx("p",{className:"text-sm text-red-500",children:i})]})},hn=({children:t,className:s=""})=>{const n="flex justify-end items-center gap-4 pt-6 border-t",i=s?`${n} ${s}`:n;return e.jsx("div",{className:i,children:t})},I1=["","","","","猸","","","","锔","М"],E1=()=>{const{list:t}=ct(),{data:s}=Ze(),[n,i]=f.useState(!1),{refineCore:{onFinish:r},register:a,handleSubmit:o,setValue:l,watch:c,formState:{errors:d,isSubmitting:u}}=ln({defaultValues:{title:"",description:"",vendor_id:s?.vendor_id||0,is_published:!1,icon_emoji:""}}),m=c("icon_emoji");return e.jsxs(H,{children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>t("courses"),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Powr贸t do listy"]}),e.jsx(J,{children:e.jsx(ue,{title:"Dodaj kurs",description:"Utw贸rz nowy kurs w systemie"})}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Informacje o kursie"})}),e.jsx(E,{children:e.jsxs(mn,{onSubmit:o(r),children:[e.jsxs(yt,{variant:"1-2-2",children:[e.jsx(re,{label:"Tytu kursu",htmlFor:"title",error:d.title?.message?.toString(),required:!0,children:e.jsx(Q,{id:"title",placeholder:"np. Podstawy programowania",...a("title",{required:"Tytu kursu jest wymagany",minLength:{value:3,message:"Tytu musi mie minimum 3 znaki"}})})}),e.jsx(re,{label:"Ikona kursu",htmlFor:"icon_emoji",children:e.jsxs("div",{className:"relative",children:[e.jsxs(M,{type:"button",variant:"outline",className:"w-full justify-start",onClick:()=>i(!n),children:[e.jsx("span",{className:"text-2xl mr-2",children:m||""}),"Wybierz ikon"]}),n&&e.jsx("div",{className:"absolute top-full mt-2 p-2 bg-white border rounded-lg shadow-lg z-10",children:e.jsx("div",{className:"grid grid-cols-5 gap-2",children:I1.map(h=>e.jsx("button",{type:"button",className:"p-2 hover:bg-gray-100 rounded text-2xl",onClick:()=>{l("icon_emoji",h),i(!1)},children:h},h))})})]})})]}),e.jsx(re,{label:"Opis kursu",htmlFor:"description",error:d.description?.message?.toString(),children:e.jsx(Xt,{id:"description",placeholder:"Opisz czego uczniowie naucz si na tym kursie...",rows:4,...a("description")})}),e.jsx(re,{label:"Status publikacji",children:e.jsxs(J,{variant:"start",children:[e.jsx(qt,{checked:c("is_published")||!1,onCheckedChange:h=>l("is_published",h)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Opublikuj kurs od razu (mo偶esz to zmieni p贸藕niej)"})]})}),e.jsxs(hn,{children:[e.jsx(M,{type:"button",variant:"outline",onClick:()=>t("courses"),children:"Anuluj"}),e.jsx(M,{type:"submit",disabled:u,children:u?"Tworzenie...":"Utw贸rz kurs"})]})]})})]})]})},R1=["","","","","猸","","","","锔","М"],L1=()=>{const{list:t}=ct(),{id:s}=Ct(),[n,i]=f.useState(!1),{data:r,isLoading:a}=Xe({resource:"courses",id:s,liveMode:"off"}),{refineCore:{onFinish:o},register:l,handleSubmit:c,setValue:d,watch:u,formState:{errors:m,isSubmitting:h}}=ln({refineCoreProps:{resource:"courses",id:s,liveMode:"off"}}),y=u("icon_emoji");return a?e.jsx(H,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):e.jsxs(H,{children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>t("courses"),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Powr贸t do listy"]}),e.jsx(J,{children:e.jsx(ue,{title:"Edytuj kurs",description:`Edycja kursu: ${r?.data?.title}`})}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Informacje o kursie"})}),e.jsx(E,{children:e.jsxs(mn,{onSubmit:c(o),children:[e.jsxs(yt,{variant:"1-2-2",children:[e.jsx(re,{label:"Tytu kursu",htmlFor:"title",error:m.title?.message,required:!0,children:e.jsx(Q,{id:"title",placeholder:"np. Podstawy programowania",...l("title",{required:"Tytu kursu jest wymagany",minLength:{value:3,message:"Tytu musi mie minimum 3 znaki"}})})}),e.jsx(re,{label:"Ikona kursu",htmlFor:"icon_emoji",children:e.jsxs("div",{className:"relative",children:[e.jsxs(M,{type:"button",variant:"outline",className:"w-full justify-start",onClick:()=>i(!n),children:[e.jsx("span",{className:"text-2xl mr-2",children:y||""}),"Wybierz ikon"]}),n&&e.jsx("div",{className:"absolute top-full mt-2 p-2 bg-white border rounded-lg shadow-lg z-10",children:e.jsx("div",{className:"grid grid-cols-5 gap-2",children:R1.map(x=>e.jsx("button",{type:"button",className:"p-2 hover:bg-gray-100 rounded text-2xl",onClick:()=>{d("icon_emoji",x),i(!1)},children:x},x))})})]})})]}),e.jsx(re,{label:"Opis kursu",htmlFor:"description",error:m.description?.message,children:e.jsx(Xt,{id:"description",placeholder:"Opisz czego uczniowie naucz si na tym kursie...",rows:4,...l("description")})}),e.jsx(re,{label:"Status publikacji",children:e.jsxs(J,{variant:"start",children:[e.jsx(qt,{checked:u("is_published")||!1,onCheckedChange:x=>d("is_published",x)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Kurs jest opublikowany i widoczny dla uczni贸w"})]})}),e.jsxs(hn,{children:[e.jsx(M,{type:"button",variant:"outline",onClick:()=>t("courses"),children:"Anuluj"}),e.jsx(M,{type:"submit",disabled:h,children:h?"Zapisywanie...":"Zapisz zmiany"})]})]})})]})]})},O1=({topic:t,isExpanded:s,onToggle:n,onDelete:i,onEdit:r,onTogglePublish:a,onNavigateToWizard:o,courseId:l,courseTitle:c,children:d,activitiesCount:u,dragHandleProps:m})=>{const h=ae(),y=g=>{const j=window.location.pathname+window.location.search;sessionStorage.setItem("returnUrl",j),h(g)},x=(g,j)=>{o&&o(g,{courseId:l,courseTitle:c,topicId:t.id,topicTitle:t.title,...j})};return e.jsxs("div",{className:`border-2 rounded-lg overflow-hidden group ${s?"shadow-lg border-primary":"border-border hover:border-primary/50"}`,children:[e.jsx("div",{className:`p-4 ${s?"bg-primary text-primary-foreground":"bg-background hover:bg-muted"}`,children:e.jsxs(J,{children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("button",{onClick:n,className:`p-1 rounded ${s?"text-primary-foreground hover:bg-primary-foreground/20":"hover:bg-muted"}`,"aria-label":s?"Zwi temat":"Rozwi temat",children:s?e.jsx(dt,{className:"w-5 h-5"}):e.jsx(be,{className:"w-5 h-5"})}),e.jsx("div",{className:"cursor-move",...m,children:e.jsx(np,{className:`w-4 h-4 ${s?"text-primary-foreground/70":"text-muted-foreground"}`})}),e.jsxs("div",{className:"flex-1 cursor-pointer group",onClick:n,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h4",{className:`font-semibold text-base ${s?"text-primary-foreground":"group-hover:text-primary"}`,children:["Temat ",t.position,": ",t.title]}),e.jsx(V,{variant:t.is_published?s?"secondary":"default":"outline",className:s?"bg-primary-foreground/20 text-primary-foreground border-primary-foreground/30":"",children:t.is_published?"Opublikowany":"Szkic"})]}),e.jsx("div",{className:"flex items-center gap-4 mt-1",children:e.jsxs("span",{className:`text-sm flex items-center gap-1 ${s?"text-primary-foreground/80":"text-muted-foreground"}`,children:[e.jsx(zt,{className:"w-3 h-3"}),u," ",u===1?"aktywno":"aktywnoci"]})})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(Ni,{children:[e.jsx(ki,{asChild:!0,children:e.jsx(M,{size:"sm",variant:s?"secondary":"ghost",title:"Dodaj aktywno",className:`h-8 w-8 p-0 ${s?"bg-primary-foreground/20 hover:bg-primary-foreground/30 text-primary-foreground":""}`,children:e.jsx(Fe,{className:"h-4 w-4"})})}),e.jsxs(Tn,{align:"end",children:[e.jsx(Vx,{children:"Dodaj tre"}),e.jsxs(ve,{onClick:()=>y(`/activities/create?topic_id=${t.id}`),children:[e.jsx(Fe,{className:"mr-2 h-4 w-4"}),"Dodaj rcznie"]}),e.jsx(jt,{}),e.jsxs(ve,{onClick:()=>x("/teacher/educational-material/step1"),className:"text-purple-600 focus:text-purple-600",children:[e.jsx(Ke,{className:"mr-2 h-4 w-4"}),"Generuj materia z AI"]}),e.jsxs(ve,{onClick:()=>x("/teacher/quiz-wizard/step1"),className:"text-blue-600 focus:text-blue-600",children:[e.jsx(ys,{className:"mr-2 h-4 w-4"}),"Generuj quiz z AI"]})]})]}),e.jsxs(Ni,{children:[e.jsx(ki,{asChild:!0,children:e.jsx(M,{variant:s?"secondary":"ghost",size:"sm",className:`h-8 w-8 p-0 ${s?"bg-primary-foreground/20 hover:bg-primary-foreground/30 text-primary-foreground":""}`,children:e.jsx(eo,{className:"h-4 w-4"})})}),e.jsxs(Tn,{align:"end",children:[e.jsxs(ve,{onClick:()=>r("teacher/topics",t.id),children:[e.jsx(ks,{className:"mr-2 h-4 w-4"}),"Edytuj temat"]}),e.jsx(jt,{}),e.jsx(ve,{onClick:()=>a(t.id,t.is_published,t.title),children:t.is_published?e.jsxs(e.Fragment,{children:[e.jsx(dn,{className:"mr-2 h-4 w-4"}),"Ukryj temat"]}):e.jsxs(e.Fragment,{children:[e.jsx(Je,{className:"mr-2 h-4 w-4"}),"Opublikuj temat"]})}),e.jsx(jt,{}),e.jsxs(ve,{onClick:()=>i(t.id,t.title),className:"text-red-600 focus:text-red-600",children:[e.jsx(Ft,{className:"mr-2 h-4 w-4"}),"Usu temat"]})]})]})]})]})}),s&&e.jsx("div",{className:"p-4 bg-muted/20 border-t-2 border-primary",children:e.jsx("div",{className:"space-y-2",children:d})})]})},$1=({activity:t,topicPosition:s,onDelete:n,onEdit:i,onTogglePublish:r,dragHandleProps:a})=>{const o=ae(),l=()=>t.type==="quiz"?e.jsx("div",{className:"p-2 bg-blue-600 rounded-lg",children:e.jsx(Re,{className:"w-5 h-5 text-white"})}):e.jsx("div",{className:"p-2 bg-green-600 rounded-lg",children:e.jsx(zt,{className:"w-5 h-5 text-white"})}),c=()=>t.type==="quiz"?"Quiz":"Materia";return e.jsxs("div",{className:"group flex items-center gap-4 p-4 bg-white border-2 rounded-lg hover:border-primary/50 transition-all duration-200",children:[e.jsx("div",{className:"cursor-move opacity-0 group-hover:opacity-100 transition-opacity",...a,children:e.jsx(np,{className:"w-4 h-4 text-muted-foreground"})}),l(),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("h5",{className:"font-semibold text-sm text-foreground",children:[s,".",t.position," ",t.title]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{variant:t.type==="quiz"?"default":"secondary",className:"text-xs font-medium",children:c()}),t.type==="quiz"&&t._count?.questions!==void 0&&e.jsxs(V,{variant:"outline",className:"text-xs font-medium border-2",children:[e.jsx(Ys,{className:"w-3 h-3 mr-1"}),t._count.questions," ",t._count.questions===1?"pytanie":"pyta"]}),e.jsx(V,{variant:t.is_published?"default":"outline",className:`text-xs font-medium ${t.is_published?"bg-green-600 hover:bg-green-700":"border-2"}`,children:t.is_published?e.jsxs(e.Fragment,{children:[e.jsx(tp,{className:"w-3 h-3 mr-1"}),"Opublikowany"]}):"Szkic"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-muted-foreground",children:[t.duration_min&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(et,{className:"w-3 h-3"}),e.jsxs("span",{children:[t.duration_min," min"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(de,{className:"w-3 h-3"}),e.jsx("span",{children:"0 ukocze"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[t.type==="quiz"&&e.jsx(M,{size:"sm",variant:"ghost",onClick:()=>o(`/teacher/questions/manage/${t.id}`),title:"Zarzdzaj pytaniami",className:"h-8 w-8 p-0",children:e.jsx(Ys,{className:"h-4 w-4"})}),e.jsx(M,{size:"sm",variant:"ghost",onClick:()=>o(`/teacher/activities/show/${t.id}`),title:"Podgld",className:"h-8 w-8 p-0",children:e.jsx(Je,{className:"h-4 w-4"})}),e.jsxs(Ni,{children:[e.jsx(ki,{asChild:!0,children:e.jsx(M,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(eo,{className:"h-4 w-4"})})}),e.jsxs(Tn,{align:"end",children:[e.jsxs(ve,{onClick:()=>o(`/teacher/activities/show/${t.id}`),children:[e.jsx(Je,{className:"mr-2 h-4 w-4"}),"Podgld"]}),e.jsxs(ve,{onClick:()=>i("teacher/activities",t.id),children:[e.jsx(ks,{className:"mr-2 h-4 w-4"}),"Edytuj"]}),e.jsx(jt,{}),e.jsx(ve,{onClick:()=>r(t.id,t.is_published,t.title),children:t.is_published?e.jsxs(e.Fragment,{children:[e.jsx(dn,{className:"mr-2 h-4 w-4"}),"Ukryj aktywno"]}):e.jsxs(e.Fragment,{children:[e.jsx(Je,{className:"mr-2 h-4 w-4"}),"Opublikuj aktywno"]})}),t.type==="quiz"&&e.jsxs(e.Fragment,{children:[e.jsx(jt,{}),e.jsxs(ve,{onClick:()=>o(`/teacher/questions/manage/${t.id}`),className:"text-blue-600 focus:text-blue-600",children:[e.jsx(Ys,{className:"mr-2 h-4 w-4"}),"Zarzdzaj pytaniami"]}),e.jsxs(ve,{onClick:()=>o(`/teacher/questions/create?activity_id=${t.id}`),className:"text-blue-600 focus:text-blue-600",children:[e.jsx(Fe,{className:"mr-2 h-4 w-4"}),"Dodaj pytanie"]})]}),e.jsx(jt,{}),e.jsxs(ve,{onClick:()=>n(t.id,t.title),className:"text-red-600 focus:text-red-600",children:[e.jsx(Ft,{className:"mr-2 h-4 w-4"}),"Usu"]})]})]})]})]})},F1=({course:t})=>t?e.jsx(I,{className:"flex-1",children:e.jsx(E,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[t.icon_emoji&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-3xl",children:t.icon_emoji})})}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold",children:t.title}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:t.is_published?"Opublikowany":"Szkic"}),t.created_at&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Utworzony: ",new Date(t.created_at).toLocaleDateString("pl-PL")]})]})]}),t.description&&e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsx("p",{className:"text-muted-foreground leading-relaxed whitespace-pre-wrap",children:t.description})})]})]})})}):null,q1=({group:t,membersCount:s})=>e.jsx(I,{className:"hover:shadow-md transition-shadow",children:e.jsx(E,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-base mb-1",children:t.name}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(js,{className:"w-3 h-3"}),t.academic_year]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(de,{className:"w-3 h-3"}),s," ",s===1?"ucze":(s>1&&s<5,"uczni贸w")]})]})]}),e.jsx(V,{variant:t.is_active?"default":"secondary",children:t.is_active?"Aktywna":"Nieaktywna"})]})})});function B1(){for(var t=arguments.length,s=new Array(t),n=0;n<t;n++)s[n]=arguments[n];return f.useMemo(()=>i=>{s.forEach(r=>r(i))},s)}const zo=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Ei(t){const s=Object.prototype.toString.call(t);return s==="[object Window]"||s==="[object global]"}function Kc(t){return"nodeType"in t}function _t(t){var s,n;return t?Ei(t)?t:Kc(t)&&(s=(n=t.ownerDocument)==null?void 0:n.defaultView)!=null?s:window:window}function Wc(t){const{Document:s}=_t(t);return t instanceof s}function Kr(t){return Ei(t)?!1:t instanceof _t(t).HTMLElement}function Kx(t){return t instanceof _t(t).SVGElement}function Ri(t){return t?Ei(t)?t.document:Kc(t)?Wc(t)?t:Kr(t)||Kx(t)?t.ownerDocument:document:document:document}const vs=zo?f.useLayoutEffect:f.useEffect;function Gc(t){const s=f.useRef(t);return vs(()=>{s.current=t}),f.useCallback(function(){for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return s.current==null?void 0:s.current(...i)},[])}function U1(){const t=f.useRef(null),s=f.useCallback((i,r)=>{t.current=setInterval(i,r)},[]),n=f.useCallback(()=>{t.current!==null&&(clearInterval(t.current),t.current=null)},[]);return[s,n]}function Sr(t,s){s===void 0&&(s=[t]);const n=f.useRef(t);return vs(()=>{n.current!==t&&(n.current=t)},s),n}function Wr(t,s){const n=f.useRef();return f.useMemo(()=>{const i=t(n.current);return n.current=i,i},[...s])}function Ra(t){const s=Gc(t),n=f.useRef(null),i=f.useCallback(r=>{r!==n.current&&s?.(r,n.current),n.current=r},[]);return[n,i]}function Pl(t){const s=f.useRef();return f.useEffect(()=>{s.current=t},[t]),s.current}let Jo={};function Gr(t,s){return f.useMemo(()=>{if(s)return s;const n=Jo[t]==null?0:Jo[t]+1;return Jo[t]=n,t+"-"+n},[t,s])}function Wx(t){return function(s){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return i.reduce((a,o)=>{const l=Object.entries(o);for(const[c,d]of l){const u=a[c];u!=null&&(a[c]=u+t*d)}return a},{...s})}}const mi=Wx(1),Cr=Wx(-1);function V1(t){return"clientX"in t&&"clientY"in t}function Zc(t){if(!t)return!1;const{KeyboardEvent:s}=_t(t.target);return s&&t instanceof s}function K1(t){if(!t)return!1;const{TouchEvent:s}=_t(t.target);return s&&t instanceof s}function Ml(t){if(K1(t)){if(t.touches&&t.touches.length){const{clientX:s,clientY:n}=t.touches[0];return{x:s,y:n}}else if(t.changedTouches&&t.changedTouches.length){const{clientX:s,clientY:n}=t.changedTouches[0];return{x:s,y:n}}}return V1(t)?{x:t.clientX,y:t.clientY}:null}const _r=Object.freeze({Translate:{toString(t){if(!t)return;const{x:s,y:n}=t;return"translate3d("+(s?Math.round(s):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(t){if(!t)return;const{scaleX:s,scaleY:n}=t;return"scaleX("+s+") scaleY("+n+")"}},Transform:{toString(t){if(t)return[_r.Translate.toString(t),_r.Scale.toString(t)].join(" ")}},Transition:{toString(t){let{property:s,duration:n,easing:i}=t;return s+" "+n+"ms "+i}}}),_u="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function W1(t){return t.matches(_u)?t:t.querySelector(_u)}const G1={display:"none"};function Z1(t){let{id:s,value:n}=t;return te.createElement("div",{id:s,style:G1},n)}function H1(t){let{id:s,announcement:n,ariaLiveType:i="assertive"}=t;const r={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return te.createElement("div",{id:s,style:r,role:"status","aria-live":i,"aria-atomic":!0},n)}function Q1(){const[t,s]=f.useState("");return{announce:f.useCallback(i=>{i!=null&&s(i)},[]),announcement:t}}const Gx=f.createContext(null);function Y1(t){const s=f.useContext(Gx);f.useEffect(()=>{if(!s)throw new Error("useDndMonitor must be used within a children of <DndContext>");return s(t)},[t,s])}function J1(){const[t]=f.useState(()=>new Set),s=f.useCallback(i=>(t.add(i),()=>t.delete(i)),[t]);return[f.useCallback(i=>{let{type:r,event:a}=i;t.forEach(o=>{var l;return(l=o[r])==null?void 0:l.call(o,a)})},[t]),s]}const X1={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},eS={onDragStart(t){let{active:s}=t;return"Picked up draggable item "+s.id+"."},onDragOver(t){let{active:s,over:n}=t;return n?"Draggable item "+s.id+" was moved over droppable area "+n.id+".":"Draggable item "+s.id+" is no longer over a droppable area."},onDragEnd(t){let{active:s,over:n}=t;return n?"Draggable item "+s.id+" was dropped over droppable area "+n.id:"Draggable item "+s.id+" was dropped."},onDragCancel(t){let{active:s}=t;return"Dragging was cancelled. Draggable item "+s.id+" was dropped."}};function tS(t){let{announcements:s=eS,container:n,hiddenTextDescribedById:i,screenReaderInstructions:r=X1}=t;const{announce:a,announcement:o}=Q1(),l=Gr("DndLiveRegion"),[c,d]=f.useState(!1);if(f.useEffect(()=>{d(!0)},[]),Y1(f.useMemo(()=>({onDragStart(m){let{active:h}=m;a(s.onDragStart({active:h}))},onDragMove(m){let{active:h,over:y}=m;s.onDragMove&&a(s.onDragMove({active:h,over:y}))},onDragOver(m){let{active:h,over:y}=m;a(s.onDragOver({active:h,over:y}))},onDragEnd(m){let{active:h,over:y}=m;a(s.onDragEnd({active:h,over:y}))},onDragCancel(m){let{active:h,over:y}=m;a(s.onDragCancel({active:h,over:y}))}}),[a,s])),!c)return null;const u=te.createElement(te.Fragment,null,te.createElement(Z1,{id:i,value:r.draggable}),te.createElement(H1,{id:l,announcement:o}));return n?Yi.createPortal(u,n):u}var We;(function(t){t.DragStart="dragStart",t.DragMove="dragMove",t.DragEnd="dragEnd",t.DragCancel="dragCancel",t.DragOver="dragOver",t.RegisterDroppable="registerDroppable",t.SetDroppableDisabled="setDroppableDisabled",t.UnregisterDroppable="unregisterDroppable"})(We||(We={}));function La(){}function Tu(t,s){return f.useMemo(()=>({sensor:t,options:s??{}}),[t,s])}function sS(){for(var t=arguments.length,s=new Array(t),n=0;n<t;n++)s[n]=arguments[n];return f.useMemo(()=>[...s].filter(i=>i!=null),[...s])}const as=Object.freeze({x:0,y:0});function Zx(t,s){return Math.sqrt(Math.pow(t.x-s.x,2)+Math.pow(t.y-s.y,2))}function Hx(t,s){let{data:{value:n}}=t,{data:{value:i}}=s;return n-i}function nS(t,s){let{data:{value:n}}=t,{data:{value:i}}=s;return i-n}function Au(t){let{left:s,top:n,height:i,width:r}=t;return[{x:s,y:n},{x:s+r,y:n},{x:s,y:n+i},{x:s+r,y:n+i}]}function Qx(t,s){if(!t||t.length===0)return null;const[n]=t;return n[s]}function Du(t,s,n){return s===void 0&&(s=t.left),n===void 0&&(n=t.top),{x:s+t.width*.5,y:n+t.height*.5}}const iS=t=>{let{collisionRect:s,droppableRects:n,droppableContainers:i}=t;const r=Du(s,s.left,s.top),a=[];for(const o of i){const{id:l}=o,c=n.get(l);if(c){const d=Zx(Du(c),r);a.push({id:l,data:{droppableContainer:o,value:d}})}}return a.sort(Hx)},rS=t=>{let{collisionRect:s,droppableRects:n,droppableContainers:i}=t;const r=Au(s),a=[];for(const o of i){const{id:l}=o,c=n.get(l);if(c){const d=Au(c),u=r.reduce((h,y,x)=>h+Zx(d[x],y),0),m=Number((u/4).toFixed(4));a.push({id:l,data:{droppableContainer:o,value:m}})}}return a.sort(Hx)};function aS(t,s){const n=Math.max(s.top,t.top),i=Math.max(s.left,t.left),r=Math.min(s.left+s.width,t.left+t.width),a=Math.min(s.top+s.height,t.top+t.height),o=r-i,l=a-n;if(i<r&&n<a){const c=s.width*s.height,d=t.width*t.height,u=o*l,m=u/(c+d-u);return Number(m.toFixed(4))}return 0}const oS=t=>{let{collisionRect:s,droppableRects:n,droppableContainers:i}=t;const r=[];for(const a of i){const{id:o}=a,l=n.get(o);if(l){const c=aS(l,s);c>0&&r.push({id:o,data:{droppableContainer:a,value:c}})}}return r.sort(nS)};function lS(t,s,n){return{...t,scaleX:s&&n?s.width/n.width:1,scaleY:s&&n?s.height/n.height:1}}function Yx(t,s){return t&&s?{x:t.left-s.left,y:t.top-s.top}:as}function cS(t){return function(n){for(var i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];return r.reduce((o,l)=>({...o,top:o.top+t*l.y,bottom:o.bottom+t*l.y,left:o.left+t*l.x,right:o.right+t*l.x}),{...n})}}const dS=cS(1);function uS(t){if(t.startsWith("matrix3d(")){const s=t.slice(9,-1).split(/, /);return{x:+s[12],y:+s[13],scaleX:+s[0],scaleY:+s[5]}}else if(t.startsWith("matrix(")){const s=t.slice(7,-1).split(/, /);return{x:+s[4],y:+s[5],scaleX:+s[0],scaleY:+s[3]}}return null}function mS(t,s,n){const i=uS(s);if(!i)return t;const{scaleX:r,scaleY:a,x:o,y:l}=i,c=t.left-o-(1-r)*parseFloat(n),d=t.top-l-(1-a)*parseFloat(n.slice(n.indexOf(" ")+1)),u=r?t.width/r:t.width,m=a?t.height/a:t.height;return{width:u,height:m,top:d,right:c+u,bottom:d+m,left:c}}const hS={ignoreTransform:!1};function Li(t,s){s===void 0&&(s=hS);let n=t.getBoundingClientRect();if(s.ignoreTransform){const{transform:d,transformOrigin:u}=_t(t).getComputedStyle(t);d&&(n=mS(n,d,u))}const{top:i,left:r,width:a,height:o,bottom:l,right:c}=n;return{top:i,left:r,width:a,height:o,bottom:l,right:c}}function Pu(t){return Li(t,{ignoreTransform:!0})}function pS(t){const s=t.innerWidth,n=t.innerHeight;return{top:0,left:0,right:s,bottom:n,width:s,height:n}}function fS(t,s){return s===void 0&&(s=_t(t).getComputedStyle(t)),s.position==="fixed"}function xS(t,s){s===void 0&&(s=_t(t).getComputedStyle(t));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(r=>{const a=s[r];return typeof a=="string"?n.test(a):!1})}function So(t,s){const n=[];function i(r){if(s!=null&&n.length>=s||!r)return n;if(Wc(r)&&r.scrollingElement!=null&&!n.includes(r.scrollingElement))return n.push(r.scrollingElement),n;if(!Kr(r)||Kx(r)||n.includes(r))return n;const a=_t(t).getComputedStyle(r);return r!==t&&xS(r,a)&&n.push(r),fS(r,a)?n:i(r.parentNode)}return t?i(t):n}function Jx(t){const[s]=So(t,1);return s??null}function Xo(t){return!zo||!t?null:Ei(t)?t:Kc(t)?Wc(t)||t===Ri(t).scrollingElement?window:Kr(t)?t:null:null}function Xx(t){return Ei(t)?t.scrollX:t.scrollLeft}function eg(t){return Ei(t)?t.scrollY:t.scrollTop}function Il(t){return{x:Xx(t),y:eg(t)}}var Qe;(function(t){t[t.Forward=1]="Forward",t[t.Backward=-1]="Backward"})(Qe||(Qe={}));function tg(t){return!zo||!t?!1:t===document.scrollingElement}function sg(t){const s={x:0,y:0},n=tg(t)?{height:window.innerHeight,width:window.innerWidth}:{height:t.clientHeight,width:t.clientWidth},i={x:t.scrollWidth-n.width,y:t.scrollHeight-n.height},r=t.scrollTop<=s.y,a=t.scrollLeft<=s.x,o=t.scrollTop>=i.y,l=t.scrollLeft>=i.x;return{isTop:r,isLeft:a,isBottom:o,isRight:l,maxScroll:i,minScroll:s}}const gS={x:.2,y:.2};function jS(t,s,n,i,r){let{top:a,left:o,right:l,bottom:c}=n;i===void 0&&(i=10),r===void 0&&(r=gS);const{isTop:d,isBottom:u,isLeft:m,isRight:h}=sg(t),y={x:0,y:0},x={x:0,y:0},g={height:s.height*r.y,width:s.width*r.x};return!d&&a<=s.top+g.height?(y.y=Qe.Backward,x.y=i*Math.abs((s.top+g.height-a)/g.height)):!u&&c>=s.bottom-g.height&&(y.y=Qe.Forward,x.y=i*Math.abs((s.bottom-g.height-c)/g.height)),!h&&l>=s.right-g.width?(y.x=Qe.Forward,x.x=i*Math.abs((s.right-g.width-l)/g.width)):!m&&o<=s.left+g.width&&(y.x=Qe.Backward,x.x=i*Math.abs((s.left+g.width-o)/g.width)),{direction:y,speed:x}}function yS(t){if(t===document.scrollingElement){const{innerWidth:a,innerHeight:o}=window;return{top:0,left:0,right:a,bottom:o,width:a,height:o}}const{top:s,left:n,right:i,bottom:r}=t.getBoundingClientRect();return{top:s,left:n,right:i,bottom:r,width:t.clientWidth,height:t.clientHeight}}function ng(t){return t.reduce((s,n)=>mi(s,Il(n)),as)}function wS(t){return t.reduce((s,n)=>s+Xx(n),0)}function bS(t){return t.reduce((s,n)=>s+eg(n),0)}function vS(t,s){if(s===void 0&&(s=Li),!t)return;const{top:n,left:i,bottom:r,right:a}=s(t);Jx(t)&&(r<=0||a<=0||n>=window.innerHeight||i>=window.innerWidth)&&t.scrollIntoView({block:"center",inline:"center"})}const NS=[["x",["left","right"],wS],["y",["top","bottom"],bS]];class Hc{constructor(s,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const i=So(n),r=ng(i);this.rect={...s},this.width=s.width,this.height=s.height;for(const[a,o,l]of NS)for(const c of o)Object.defineProperty(this,c,{get:()=>{const d=l(i),u=r[a]-d;return this.rect[c]+u},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class nr{constructor(s){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var i;return(i=this.target)==null?void 0:i.removeEventListener(...n)})},this.target=s}add(s,n,i){var r;(r=this.target)==null||r.addEventListener(s,n,i),this.listeners.push([s,n,i])}}function kS(t){const{EventTarget:s}=_t(t);return t instanceof s?t:Ri(t)}function el(t,s){const n=Math.abs(t.x),i=Math.abs(t.y);return typeof s=="number"?Math.sqrt(n**2+i**2)>s:"x"in s&&"y"in s?n>s.x&&i>s.y:"x"in s?n>s.x:"y"in s?i>s.y:!1}var Kt;(function(t){t.Click="click",t.DragStart="dragstart",t.Keydown="keydown",t.ContextMenu="contextmenu",t.Resize="resize",t.SelectionChange="selectionchange",t.VisibilityChange="visibilitychange"})(Kt||(Kt={}));function Mu(t){t.preventDefault()}function zS(t){t.stopPropagation()}var oe;(function(t){t.Space="Space",t.Down="ArrowDown",t.Right="ArrowRight",t.Left="ArrowLeft",t.Up="ArrowUp",t.Esc="Escape",t.Enter="Enter",t.Tab="Tab"})(oe||(oe={}));const ig={start:[oe.Space,oe.Enter],cancel:[oe.Esc],end:[oe.Space,oe.Enter,oe.Tab]},SS=(t,s)=>{let{currentCoordinates:n}=s;switch(t.code){case oe.Right:return{...n,x:n.x+25};case oe.Left:return{...n,x:n.x-25};case oe.Down:return{...n,y:n.y+25};case oe.Up:return{...n,y:n.y-25}}};class Qc{constructor(s){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=s;const{event:{target:n}}=s;this.props=s,this.listeners=new nr(Ri(n)),this.windowListeners=new nr(_t(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Kt.Resize,this.handleCancel),this.windowListeners.add(Kt.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Kt.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:s,onStart:n}=this.props,i=s.node.current;i&&vS(i),n(as)}handleKeyDown(s){if(Zc(s)){const{active:n,context:i,options:r}=this.props,{keyboardCodes:a=ig,coordinateGetter:o=SS,scrollBehavior:l="smooth"}=r,{code:c}=s;if(a.end.includes(c)){this.handleEnd(s);return}if(a.cancel.includes(c)){this.handleCancel(s);return}const{collisionRect:d}=i.current,u=d?{x:d.left,y:d.top}:as;this.referenceCoordinates||(this.referenceCoordinates=u);const m=o(s,{active:n,context:i.current,currentCoordinates:u});if(m){const h=Cr(m,u),y={x:0,y:0},{scrollableAncestors:x}=i.current;for(const g of x){const j=s.code,{isTop:w,isRight:b,isLeft:v,isBottom:C,maxScroll:_,minScroll:S}=sg(g),z=yS(g),k={x:Math.min(j===oe.Right?z.right-z.width/2:z.right,Math.max(j===oe.Right?z.left:z.left+z.width/2,m.x)),y:Math.min(j===oe.Down?z.bottom-z.height/2:z.bottom,Math.max(j===oe.Down?z.top:z.top+z.height/2,m.y))},T=j===oe.Right&&!b||j===oe.Left&&!v,p=j===oe.Down&&!C||j===oe.Up&&!w;if(T&&k.x!==m.x){const N=g.scrollLeft+h.x,A=j===oe.Right&&N<=_.x||j===oe.Left&&N>=S.x;if(A&&!h.y){g.scrollTo({left:N,behavior:l});return}A?y.x=g.scrollLeft-N:y.x=j===oe.Right?g.scrollLeft-_.x:g.scrollLeft-S.x,y.x&&g.scrollBy({left:-y.x,behavior:l});break}else if(p&&k.y!==m.y){const N=g.scrollTop+h.y,A=j===oe.Down&&N<=_.y||j===oe.Up&&N>=S.y;if(A&&!h.x){g.scrollTo({top:N,behavior:l});return}A?y.y=g.scrollTop-N:y.y=j===oe.Down?g.scrollTop-_.y:g.scrollTop-S.y,y.y&&g.scrollBy({top:-y.y,behavior:l});break}}this.handleMove(s,mi(Cr(m,this.referenceCoordinates),y))}}}handleMove(s,n){const{onMove:i}=this.props;s.preventDefault(),i(n)}handleEnd(s){const{onEnd:n}=this.props;s.preventDefault(),this.detach(),n()}handleCancel(s){const{onCancel:n}=this.props;s.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Qc.activators=[{eventName:"onKeyDown",handler:(t,s,n)=>{let{keyboardCodes:i=ig,onActivation:r}=s,{active:a}=n;const{code:o}=t.nativeEvent;if(i.start.includes(o)){const l=a.activatorNode.current;return l&&t.target!==l?!1:(t.preventDefault(),r?.({event:t.nativeEvent}),!0)}return!1}}];function Iu(t){return!!(t&&"distance"in t)}function Eu(t){return!!(t&&"delay"in t)}class Yc{constructor(s,n,i){var r;i===void 0&&(i=kS(s.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=s,this.events=n;const{event:a}=s,{target:o}=a;this.props=s,this.events=n,this.document=Ri(o),this.documentListeners=new nr(this.document),this.listeners=new nr(i),this.windowListeners=new nr(_t(o)),this.initialCoordinates=(r=Ml(a))!=null?r:as,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:s,props:{options:{activationConstraint:n,bypassActivationConstraint:i}}}=this;if(this.listeners.add(s.move.name,this.handleMove,{passive:!1}),this.listeners.add(s.end.name,this.handleEnd),s.cancel&&this.listeners.add(s.cancel.name,this.handleCancel),this.windowListeners.add(Kt.Resize,this.handleCancel),this.windowListeners.add(Kt.DragStart,Mu),this.windowListeners.add(Kt.VisibilityChange,this.handleCancel),this.windowListeners.add(Kt.ContextMenu,Mu),this.documentListeners.add(Kt.Keydown,this.handleKeydown),n){if(i!=null&&i({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Eu(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(Iu(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(s,n){const{active:i,onPending:r}=this.props;r(i,s,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:s}=this,{onStart:n}=this.props;s&&(this.activated=!0,this.documentListeners.add(Kt.Click,zS,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Kt.SelectionChange,this.removeTextSelection),n(s))}handleMove(s){var n;const{activated:i,initialCoordinates:r,props:a}=this,{onMove:o,options:{activationConstraint:l}}=a;if(!r)return;const c=(n=Ml(s))!=null?n:as,d=Cr(r,c);if(!i&&l){if(Iu(l)){if(l.tolerance!=null&&el(d,l.tolerance))return this.handleCancel();if(el(d,l.distance))return this.handleStart()}if(Eu(l)&&el(d,l.tolerance))return this.handleCancel();this.handlePending(l,d);return}s.cancelable&&s.preventDefault(),o(c)}handleEnd(){const{onAbort:s,onEnd:n}=this.props;this.detach(),this.activated||s(this.props.active),n()}handleCancel(){const{onAbort:s,onCancel:n}=this.props;this.detach(),this.activated||s(this.props.active),n()}handleKeydown(s){s.code===oe.Esc&&this.handleCancel()}removeTextSelection(){var s;(s=this.document.getSelection())==null||s.removeAllRanges()}}const CS={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Jc extends Yc{constructor(s){const{event:n}=s,i=Ri(n.target);super(s,CS,i)}}Jc.activators=[{eventName:"onPointerDown",handler:(t,s)=>{let{nativeEvent:n}=t,{onActivation:i}=s;return!n.isPrimary||n.button!==0?!1:(i?.({event:n}),!0)}}];const _S={move:{name:"mousemove"},end:{name:"mouseup"}};var El;(function(t){t[t.RightClick=2]="RightClick"})(El||(El={}));class TS extends Yc{constructor(s){super(s,_S,Ri(s.event.target))}}TS.activators=[{eventName:"onMouseDown",handler:(t,s)=>{let{nativeEvent:n}=t,{onActivation:i}=s;return n.button===El.RightClick?!1:(i?.({event:n}),!0)}}];const tl={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class AS extends Yc{constructor(s){super(s,tl)}static setup(){return window.addEventListener(tl.move.name,s,{capture:!1,passive:!1}),function(){window.removeEventListener(tl.move.name,s)};function s(){}}}AS.activators=[{eventName:"onTouchStart",handler:(t,s)=>{let{nativeEvent:n}=t,{onActivation:i}=s;const{touches:r}=n;return r.length>1?!1:(i?.({event:n}),!0)}}];var ir;(function(t){t[t.Pointer=0]="Pointer",t[t.DraggableRect=1]="DraggableRect"})(ir||(ir={}));var Oa;(function(t){t[t.TreeOrder=0]="TreeOrder",t[t.ReversedTreeOrder=1]="ReversedTreeOrder"})(Oa||(Oa={}));function DS(t){let{acceleration:s,activator:n=ir.Pointer,canScroll:i,draggingRect:r,enabled:a,interval:o=5,order:l=Oa.TreeOrder,pointerCoordinates:c,scrollableAncestors:d,scrollableAncestorRects:u,delta:m,threshold:h}=t;const y=MS({delta:m,disabled:!a}),[x,g]=U1(),j=f.useRef({x:0,y:0}),w=f.useRef({x:0,y:0}),b=f.useMemo(()=>{switch(n){case ir.Pointer:return c?{top:c.y,bottom:c.y,left:c.x,right:c.x}:null;case ir.DraggableRect:return r}},[n,r,c]),v=f.useRef(null),C=f.useCallback(()=>{const S=v.current;if(!S)return;const z=j.current.x*w.current.x,k=j.current.y*w.current.y;S.scrollBy(z,k)},[]),_=f.useMemo(()=>l===Oa.TreeOrder?[...d].reverse():d,[l,d]);f.useEffect(()=>{if(!a||!d.length||!b){g();return}for(const S of _){if(i?.(S)===!1)continue;const z=d.indexOf(S),k=u[z];if(!k)continue;const{direction:T,speed:p}=jS(S,k,b,s,h);for(const N of["x","y"])y[N][T[N]]||(p[N]=0,T[N]=0);if(p.x>0||p.y>0){g(),v.current=S,x(C,o),j.current=p,w.current=T;return}}j.current={x:0,y:0},w.current={x:0,y:0},g()},[s,C,i,g,a,o,JSON.stringify(b),JSON.stringify(y),x,d,_,u,JSON.stringify(h)])}const PS={x:{[Qe.Backward]:!1,[Qe.Forward]:!1},y:{[Qe.Backward]:!1,[Qe.Forward]:!1}};function MS(t){let{delta:s,disabled:n}=t;const i=Pl(s);return Wr(r=>{if(n||!i||!r)return PS;const a={x:Math.sign(s.x-i.x),y:Math.sign(s.y-i.y)};return{x:{[Qe.Backward]:r.x[Qe.Backward]||a.x===-1,[Qe.Forward]:r.x[Qe.Forward]||a.x===1},y:{[Qe.Backward]:r.y[Qe.Backward]||a.y===-1,[Qe.Forward]:r.y[Qe.Forward]||a.y===1}}},[n,s,i])}function IS(t,s){const n=s!=null?t.get(s):void 0,i=n?n.node.current:null;return Wr(r=>{var a;return s==null?null:(a=i??r)!=null?a:null},[i,s])}function ES(t,s){return f.useMemo(()=>t.reduce((n,i)=>{const{sensor:r}=i,a=r.activators.map(o=>({eventName:o.eventName,handler:s(o.handler,i)}));return[...n,...a]},[]),[t,s])}var Tr;(function(t){t[t.Always=0]="Always",t[t.BeforeDragging=1]="BeforeDragging",t[t.WhileDragging=2]="WhileDragging"})(Tr||(Tr={}));var Rl;(function(t){t.Optimized="optimized"})(Rl||(Rl={}));const Ru=new Map;function RS(t,s){let{dragging:n,dependencies:i,config:r}=s;const[a,o]=f.useState(null),{frequency:l,measure:c,strategy:d}=r,u=f.useRef(t),m=j(),h=Sr(m),y=f.useCallback(function(w){w===void 0&&(w=[]),!h.current&&o(b=>b===null?w:b.concat(w.filter(v=>!b.includes(v))))},[h]),x=f.useRef(null),g=Wr(w=>{if(m&&!n)return Ru;if(!w||w===Ru||u.current!==t||a!=null){const b=new Map;for(let v of t){if(!v)continue;if(a&&a.length>0&&!a.includes(v.id)&&v.rect.current){b.set(v.id,v.rect.current);continue}const C=v.node.current,_=C?new Hc(c(C),C):null;v.rect.current=_,_&&b.set(v.id,_)}return b}return w},[t,a,n,m,c]);return f.useEffect(()=>{u.current=t},[t]),f.useEffect(()=>{m||y()},[n,m]),f.useEffect(()=>{a&&a.length>0&&o(null)},[JSON.stringify(a)]),f.useEffect(()=>{m||typeof l!="number"||x.current!==null||(x.current=setTimeout(()=>{y(),x.current=null},l))},[l,m,y,...i]),{droppableRects:g,measureDroppableContainers:y,measuringScheduled:a!=null};function j(){switch(d){case Tr.Always:return!1;case Tr.BeforeDragging:return n;default:return!n}}}function rg(t,s){return Wr(n=>t?n||(typeof s=="function"?s(t):t):null,[s,t])}function LS(t,s){return rg(t,s)}function OS(t){let{callback:s,disabled:n}=t;const i=Gc(s),r=f.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:a}=window;return new a(i)},[i,n]);return f.useEffect(()=>()=>r?.disconnect(),[r]),r}function Co(t){let{callback:s,disabled:n}=t;const i=Gc(s),r=f.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:a}=window;return new a(i)},[n]);return f.useEffect(()=>()=>r?.disconnect(),[r]),r}function $S(t){return new Hc(Li(t),t)}function Lu(t,s,n){s===void 0&&(s=$S);const[i,r]=f.useState(null);function a(){r(c=>{if(!t)return null;if(t.isConnected===!1){var d;return(d=c??n)!=null?d:null}const u=s(t);return JSON.stringify(c)===JSON.stringify(u)?c:u})}const o=OS({callback(c){if(t)for(const d of c){const{type:u,target:m}=d;if(u==="childList"&&m instanceof HTMLElement&&m.contains(t)){a();break}}}}),l=Co({callback:a});return vs(()=>{a(),t?(l?.observe(t),o?.observe(document.body,{childList:!0,subtree:!0})):(l?.disconnect(),o?.disconnect())},[t]),i}function FS(t){const s=rg(t);return Yx(t,s)}const Ou=[];function qS(t){const s=f.useRef(t),n=Wr(i=>t?i&&i!==Ou&&t&&s.current&&t.parentNode===s.current.parentNode?i:So(t):Ou,[t]);return f.useEffect(()=>{s.current=t},[t]),n}function BS(t){const[s,n]=f.useState(null),i=f.useRef(t),r=f.useCallback(a=>{const o=Xo(a.target);o&&n(l=>l?(l.set(o,Il(o)),new Map(l)):null)},[]);return f.useEffect(()=>{const a=i.current;if(t!==a){o(a);const l=t.map(c=>{const d=Xo(c);return d?(d.addEventListener("scroll",r,{passive:!0}),[d,Il(d)]):null}).filter(c=>c!=null);n(l.length?new Map(l):null),i.current=t}return()=>{o(t),o(a)};function o(l){l.forEach(c=>{const d=Xo(c);d?.removeEventListener("scroll",r)})}},[r,t]),f.useMemo(()=>t.length?s?Array.from(s.values()).reduce((a,o)=>mi(a,o),as):ng(t):as,[t,s])}function $u(t,s){s===void 0&&(s=[]);const n=f.useRef(null);return f.useEffect(()=>{n.current=null},s),f.useEffect(()=>{const i=t!==as;i&&!n.current&&(n.current=t),!i&&n.current&&(n.current=null)},[t]),n.current?Cr(t,n.current):as}function US(t){f.useEffect(()=>{if(!zo)return;const s=t.map(n=>{let{sensor:i}=n;return i.setup==null?void 0:i.setup()});return()=>{for(const n of s)n?.()}},t.map(s=>{let{sensor:n}=s;return n}))}function VS(t,s){return f.useMemo(()=>t.reduce((n,i)=>{let{eventName:r,handler:a}=i;return n[r]=o=>{a(o,s)},n},{}),[t,s])}function ag(t){return f.useMemo(()=>t?pS(t):null,[t])}const Fu=[];function KS(t,s){s===void 0&&(s=Li);const[n]=t,i=ag(n?_t(n):null),[r,a]=f.useState(Fu);function o(){a(()=>t.length?t.map(c=>tg(c)?i:new Hc(s(c),c)):Fu)}const l=Co({callback:o});return vs(()=>{l?.disconnect(),o(),t.forEach(c=>l?.observe(c))},[t]),r}function WS(t){if(!t)return null;if(t.children.length>1)return t;const s=t.children[0];return Kr(s)?s:t}function GS(t){let{measure:s}=t;const[n,i]=f.useState(null),r=f.useCallback(d=>{for(const{target:u}of d)if(Kr(u)){i(m=>{const h=s(u);return m?{...m,width:h.width,height:h.height}:h});break}},[s]),a=Co({callback:r}),o=f.useCallback(d=>{const u=WS(d);a?.disconnect(),u&&a?.observe(u),i(u?s(u):null)},[s,a]),[l,c]=Ra(o);return f.useMemo(()=>({nodeRef:l,rect:n,setRef:c}),[n,l,c])}const ZS=[{sensor:Jc,options:{}},{sensor:Qc,options:{}}],HS={current:{}},wa={draggable:{measure:Pu},droppable:{measure:Pu,strategy:Tr.WhileDragging,frequency:Rl.Optimized},dragOverlay:{measure:Li}};class rr extends Map{get(s){var n;return s!=null&&(n=super.get(s))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(s=>{let{disabled:n}=s;return!n})}getNodeFor(s){var n,i;return(n=(i=this.get(s))==null?void 0:i.node.current)!=null?n:void 0}}const QS={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new rr,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:La},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:wa,measureDroppableContainers:La,windowRect:null,measuringScheduled:!1},YS={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:La,draggableNodes:new Map,over:null,measureDroppableContainers:La},_o=f.createContext(YS),og=f.createContext(QS);function JS(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new rr}}}function XS(t,s){switch(s.type){case We.DragStart:return{...t,draggable:{...t.draggable,initialCoordinates:s.initialCoordinates,active:s.active}};case We.DragMove:return t.draggable.active==null?t:{...t,draggable:{...t.draggable,translate:{x:s.coordinates.x-t.draggable.initialCoordinates.x,y:s.coordinates.y-t.draggable.initialCoordinates.y}}};case We.DragEnd:case We.DragCancel:return{...t,draggable:{...t.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case We.RegisterDroppable:{const{element:n}=s,{id:i}=n,r=new rr(t.droppable.containers);return r.set(i,n),{...t,droppable:{...t.droppable,containers:r}}}case We.SetDroppableDisabled:{const{id:n,key:i,disabled:r}=s,a=t.droppable.containers.get(n);if(!a||i!==a.key)return t;const o=new rr(t.droppable.containers);return o.set(n,{...a,disabled:r}),{...t,droppable:{...t.droppable,containers:o}}}case We.UnregisterDroppable:{const{id:n,key:i}=s,r=t.droppable.containers.get(n);if(!r||i!==r.key)return t;const a=new rr(t.droppable.containers);return a.delete(n),{...t,droppable:{...t.droppable,containers:a}}}default:return t}}function e2(t){let{disabled:s}=t;const{active:n,activatorEvent:i,draggableNodes:r}=f.useContext(_o),a=Pl(i),o=Pl(n?.id);return f.useEffect(()=>{if(!s&&!i&&a&&o!=null){if(!Zc(a)||document.activeElement===a.target)return;const l=r.get(o);if(!l)return;const{activatorNode:c,node:d}=l;if(!c.current&&!d.current)return;requestAnimationFrame(()=>{for(const u of[c.current,d.current]){if(!u)continue;const m=W1(u);if(m){m.focus();break}}})}},[i,s,r,o,a]),null}function t2(t,s){let{transform:n,...i}=s;return t!=null&&t.length?t.reduce((r,a)=>a({transform:r,...i}),n):n}function s2(t){return f.useMemo(()=>({draggable:{...wa.draggable,...t?.draggable},droppable:{...wa.droppable,...t?.droppable},dragOverlay:{...wa.dragOverlay,...t?.dragOverlay}}),[t?.draggable,t?.droppable,t?.dragOverlay])}function n2(t){let{activeNode:s,measure:n,initialRect:i,config:r=!0}=t;const a=f.useRef(!1),{x:o,y:l}=typeof r=="boolean"?{x:r,y:r}:r;vs(()=>{if(!o&&!l||!s){a.current=!1;return}if(a.current||!i)return;const d=s?.node.current;if(!d||d.isConnected===!1)return;const u=n(d),m=Yx(u,i);if(o||(m.x=0),l||(m.y=0),a.current=!0,Math.abs(m.x)>0||Math.abs(m.y)>0){const h=Jx(d);h&&h.scrollBy({top:m.y,left:m.x})}},[s,o,l,i,n])}const lg=f.createContext({...as,scaleX:1,scaleY:1});var Zs;(function(t){t[t.Uninitialized=0]="Uninitialized",t[t.Initializing=1]="Initializing",t[t.Initialized=2]="Initialized"})(Zs||(Zs={}));const i2=f.memo(function(s){var n,i,r,a;let{id:o,accessibility:l,autoScroll:c=!0,children:d,sensors:u=ZS,collisionDetection:m=oS,measuring:h,modifiers:y,...x}=s;const g=f.useReducer(XS,void 0,JS),[j,w]=g,[b,v]=J1(),[C,_]=f.useState(Zs.Uninitialized),S=C===Zs.Initialized,{draggable:{active:z,nodes:k,translate:T},droppable:{containers:p}}=j,N=z!=null?k.get(z):null,A=f.useRef({initial:null,translated:null}),D=f.useMemo(()=>{var at;return z!=null?{id:z,data:(at=N?.data)!=null?at:HS,rect:A}:null},[z,N]),P=f.useRef(null),[R,q]=f.useState(null),[L,U]=f.useState(null),O=Sr(x,Object.values(x)),G=Gr("DndDescribedBy",o),se=f.useMemo(()=>p.getEnabled(),[p]),ie=s2(h),{droppableRects:Ce,measureDroppableContainers:bt,measuringScheduled:Tt}=RS(se,{dragging:S,dependencies:[T.x,T.y],config:ie.droppable}),_e=IS(k,z),me=f.useMemo(()=>L?Ml(L):null,[L]),ut=sy(),mt=LS(_e,ie.draggable.measure);n2({activeNode:z!=null?k.get(z):null,config:ut.layoutShiftCompensation,initialRect:mt,measure:ie.draggable.measure});const we=Lu(_e,ie.draggable.measure,mt),Bi=Lu(_e?_e.parentElement:null),ls=f.useRef({activatorEvent:null,active:null,activeNode:_e,collisionRect:null,collisions:null,droppableRects:Ce,draggableNodes:k,draggingNode:null,draggingNodeRect:null,droppableContainers:p,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Vn=p.getNodeFor((n=ls.current.over)==null?void 0:n.id),Ss=GS({measure:ie.dragOverlay.measure}),Kn=(i=Ss.nodeRef.current)!=null?i:_e,Wn=S?(r=Ss.rect)!=null?r:we:null,Id=!!(Ss.nodeRef.current&&Ss.rect),Ed=FS(Id?null:we),Io=ag(Kn?_t(Kn):null),qs=qS(S?Vn??_e:null),Xr=KS(qs),ea=t2(y,{transform:{x:T.x-Ed.x,y:T.y-Ed.y,scaleX:1,scaleY:1},activatorEvent:L,active:D,activeNodeRect:we,containerNodeRect:Bi,draggingNodeRect:Wn,over:ls.current.over,overlayNodeRect:Ss.rect,scrollableAncestors:qs,scrollableAncestorRects:Xr,windowRect:Io}),Rd=me?mi(me,T):null,Ld=BS(qs),Hj=$u(Ld),Qj=$u(Ld,[we]),Gn=mi(ea,Hj),Zn=Wn?dS(Wn,ea):null,Ui=D&&Zn?m({active:D,collisionRect:Zn,droppableRects:Ce,droppableContainers:se,pointerCoordinates:Rd}):null,Od=Qx(Ui,"id"),[Bs,$d]=f.useState(null),Yj=Id?ea:mi(ea,Qj),Jj=lS(Yj,(a=Bs?.rect)!=null?a:null,we),Eo=f.useRef(null),Fd=f.useCallback((at,At)=>{let{sensor:Dt,options:Us}=At;if(P.current==null)return;const Bt=k.get(P.current);if(!Bt)return;const Pt=at.nativeEvent,cs=new Dt({active:P.current,activeNode:Bt,event:Pt,options:Us,context:ls,onAbort(st){if(!k.get(st))return;const{onDragAbort:ds}=O.current,Cs={id:st};ds?.(Cs),b({type:"onDragAbort",event:Cs})},onPending(st,Vs,ds,Cs){if(!k.get(st))return;const{onDragPending:Ki}=O.current,Ks={id:st,constraint:Vs,initialCoordinates:ds,offset:Cs};Ki?.(Ks),b({type:"onDragPending",event:Ks})},onStart(st){const Vs=P.current;if(Vs==null)return;const ds=k.get(Vs);if(!ds)return;const{onDragStart:Cs}=O.current,Vi={activatorEvent:Pt,active:{id:Vs,data:ds.data,rect:A}};Yi.unstable_batchedUpdates(()=>{Cs?.(Vi),_(Zs.Initializing),w({type:We.DragStart,initialCoordinates:st,active:Vs}),b({type:"onDragStart",event:Vi}),q(Eo.current),U(Pt)})},onMove(st){w({type:We.DragMove,coordinates:st})},onEnd:Hn(We.DragEnd),onCancel:Hn(We.DragCancel)});Eo.current=cs;function Hn(st){return async function(){const{active:ds,collisions:Cs,over:Vi,scrollAdjustedTranslate:Ki}=ls.current;let Ks=null;if(ds&&Ki){const{cancelDrop:Wi}=O.current;Ks={activatorEvent:Pt,active:ds,collisions:Cs,delta:Ki,over:Vi},st===We.DragEnd&&typeof Wi=="function"&&await Promise.resolve(Wi(Ks))&&(st=We.DragCancel)}P.current=null,Yi.unstable_batchedUpdates(()=>{w({type:st}),_(Zs.Uninitialized),$d(null),q(null),U(null),Eo.current=null;const Wi=st===We.DragEnd?"onDragEnd":"onDragCancel";if(Ks){const Ro=O.current[Wi];Ro?.(Ks),b({type:Wi,event:Ks})}})}}},[k]),Xj=f.useCallback((at,At)=>(Dt,Us)=>{const Bt=Dt.nativeEvent,Pt=k.get(Us);if(P.current!==null||!Pt||Bt.dndKit||Bt.defaultPrevented)return;const cs={active:Pt};at(Dt,At.options,cs)===!0&&(Bt.dndKit={capturedBy:At.sensor},P.current=Us,Fd(Dt,At))},[k,Fd]),qd=ES(u,Xj);US(u),vs(()=>{we&&C===Zs.Initializing&&_(Zs.Initialized)},[we,C]),f.useEffect(()=>{const{onDragMove:at}=O.current,{active:At,activatorEvent:Dt,collisions:Us,over:Bt}=ls.current;if(!At||!Dt)return;const Pt={active:At,activatorEvent:Dt,collisions:Us,delta:{x:Gn.x,y:Gn.y},over:Bt};Yi.unstable_batchedUpdates(()=>{at?.(Pt),b({type:"onDragMove",event:Pt})})},[Gn.x,Gn.y]),f.useEffect(()=>{const{active:at,activatorEvent:At,collisions:Dt,droppableContainers:Us,scrollAdjustedTranslate:Bt}=ls.current;if(!at||P.current==null||!At||!Bt)return;const{onDragOver:Pt}=O.current,cs=Us.get(Od),Hn=cs&&cs.rect.current?{id:cs.id,rect:cs.rect.current,data:cs.data,disabled:cs.disabled}:null,st={active:at,activatorEvent:At,collisions:Dt,delta:{x:Bt.x,y:Bt.y},over:Hn};Yi.unstable_batchedUpdates(()=>{$d(Hn),Pt?.(st),b({type:"onDragOver",event:st})})},[Od]),vs(()=>{ls.current={activatorEvent:L,active:D,activeNode:_e,collisionRect:Zn,collisions:Ui,droppableRects:Ce,draggableNodes:k,draggingNode:Kn,draggingNodeRect:Wn,droppableContainers:p,over:Bs,scrollableAncestors:qs,scrollAdjustedTranslate:Gn},A.current={initial:Wn,translated:Zn}},[D,_e,Ui,Zn,k,Kn,Wn,Ce,p,Bs,qs,Gn]),DS({...ut,delta:T,draggingRect:Zn,pointerCoordinates:Rd,scrollableAncestors:qs,scrollableAncestorRects:Xr});const ey=f.useMemo(()=>({active:D,activeNode:_e,activeNodeRect:we,activatorEvent:L,collisions:Ui,containerNodeRect:Bi,dragOverlay:Ss,draggableNodes:k,droppableContainers:p,droppableRects:Ce,over:Bs,measureDroppableContainers:bt,scrollableAncestors:qs,scrollableAncestorRects:Xr,measuringConfiguration:ie,measuringScheduled:Tt,windowRect:Io}),[D,_e,we,L,Ui,Bi,Ss,k,p,Ce,Bs,bt,qs,Xr,ie,Tt,Io]),ty=f.useMemo(()=>({activatorEvent:L,activators:qd,active:D,activeNodeRect:we,ariaDescribedById:{draggable:G},dispatch:w,draggableNodes:k,over:Bs,measureDroppableContainers:bt}),[L,qd,D,we,w,G,k,Bs,bt]);return te.createElement(Gx.Provider,{value:v},te.createElement(_o.Provider,{value:ty},te.createElement(og.Provider,{value:ey},te.createElement(lg.Provider,{value:Jj},d)),te.createElement(e2,{disabled:l?.restoreFocus===!1})),te.createElement(tS,{...l,hiddenTextDescribedById:G}));function sy(){const at=R?.autoScrollEnabled===!1,At=typeof c=="object"?c.enabled===!1:c===!1,Dt=S&&!at&&!At;return typeof c=="object"?{...c,enabled:Dt}:{enabled:Dt}}}),r2=f.createContext(null),qu="button",a2="Draggable";function o2(t){let{id:s,data:n,disabled:i=!1,attributes:r}=t;const a=Gr(a2),{activators:o,activatorEvent:l,active:c,activeNodeRect:d,ariaDescribedById:u,draggableNodes:m,over:h}=f.useContext(_o),{role:y=qu,roleDescription:x="draggable",tabIndex:g=0}=r??{},j=c?.id===s,w=f.useContext(j?lg:r2),[b,v]=Ra(),[C,_]=Ra(),S=VS(o,s),z=Sr(n);vs(()=>(m.set(s,{id:s,key:a,node:b,activatorNode:C,data:z}),()=>{const T=m.get(s);T&&T.key===a&&m.delete(s)}),[m,s]);const k=f.useMemo(()=>({role:y,tabIndex:g,"aria-disabled":i,"aria-pressed":j&&y===qu?!0:void 0,"aria-roledescription":x,"aria-describedby":u.draggable}),[i,y,g,j,x,u.draggable]);return{active:c,activatorEvent:l,activeNodeRect:d,attributes:k,isDragging:j,listeners:i?void 0:S,node:b,over:h,setNodeRef:v,setActivatorNodeRef:_,transform:w}}function l2(){return f.useContext(og)}const c2="Droppable",d2={timeout:25};function u2(t){let{data:s,disabled:n=!1,id:i,resizeObserverConfig:r}=t;const a=Gr(c2),{active:o,dispatch:l,over:c,measureDroppableContainers:d}=f.useContext(_o),u=f.useRef({disabled:n}),m=f.useRef(!1),h=f.useRef(null),y=f.useRef(null),{disabled:x,updateMeasurementsFor:g,timeout:j}={...d2,...r},w=Sr(g??i),b=f.useCallback(()=>{if(!m.current){m.current=!0;return}y.current!=null&&clearTimeout(y.current),y.current=setTimeout(()=>{d(Array.isArray(w.current)?w.current:[w.current]),y.current=null},j)},[j]),v=Co({callback:b,disabled:x||!o}),C=f.useCallback((k,T)=>{v&&(T&&(v.unobserve(T),m.current=!1),k&&v.observe(k))},[v]),[_,S]=Ra(C),z=Sr(s);return f.useEffect(()=>{!v||!_.current||(v.disconnect(),m.current=!1,v.observe(_.current))},[_,v]),f.useEffect(()=>(l({type:We.RegisterDroppable,element:{id:i,key:a,disabled:n,node:_,rect:h,data:z}}),()=>l({type:We.UnregisterDroppable,key:a,id:i})),[i]),f.useEffect(()=>{n!==u.current.disabled&&(l({type:We.SetDroppableDisabled,id:i,key:a,disabled:n}),u.current.disabled=n)},[i,a,n,l]),{active:o,rect:h,isOver:c?.id===i,node:_,over:c,setNodeRef:S}}function Xc(t,s,n){const i=t.slice();return i.splice(n<0?i.length+n:n,0,i.splice(s,1)[0]),i}function m2(t,s){return t.reduce((n,i,r)=>{const a=s.get(i);return a&&(n[r]=a),n},Array(t.length))}function la(t){return t!==null&&t>=0}function h2(t,s){if(t===s)return!0;if(t.length!==s.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==s[n])return!1;return!0}function p2(t){return typeof t=="boolean"?{draggable:t,droppable:t}:t}const cg=t=>{let{rects:s,activeIndex:n,overIndex:i,index:r}=t;const a=Xc(s,i,n),o=s[r],l=a[r];return!l||!o?null:{x:l.left-o.left,y:l.top-o.top,scaleX:l.width/o.width,scaleY:l.height/o.height}},ca={scaleX:1,scaleY:1},f2=t=>{var s;let{activeIndex:n,activeNodeRect:i,index:r,rects:a,overIndex:o}=t;const l=(s=a[n])!=null?s:i;if(!l)return null;if(r===n){const d=a[o];return d?{x:0,y:n<o?d.top+d.height-(l.top+l.height):d.top-l.top,...ca}:null}const c=x2(a,r,n);return r>n&&r<=o?{x:0,y:-l.height-c,...ca}:r<n&&r>=o?{x:0,y:l.height+c,...ca}:{x:0,y:0,...ca}};function x2(t,s,n){const i=t[s],r=t[s-1],a=t[s+1];return i?n<s?r?i.top-(r.top+r.height):a?a.top-(i.top+i.height):0:a?a.top-(i.top+i.height):r?i.top-(r.top+r.height):0:0}const dg="Sortable",ug=te.createContext({activeIndex:-1,containerId:dg,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:cg,disabled:{draggable:!1,droppable:!1}});function g2(t){let{children:s,id:n,items:i,strategy:r=cg,disabled:a=!1}=t;const{active:o,dragOverlay:l,droppableRects:c,over:d,measureDroppableContainers:u}=l2(),m=Gr(dg,n),h=l.rect!==null,y=f.useMemo(()=>i.map(S=>typeof S=="object"&&"id"in S?S.id:S),[i]),x=o!=null,g=o?y.indexOf(o.id):-1,j=d?y.indexOf(d.id):-1,w=f.useRef(y),b=!h2(y,w.current),v=j!==-1&&g===-1||b,C=p2(a);vs(()=>{b&&x&&u(y)},[b,y,x,u]),f.useEffect(()=>{w.current=y},[y]);const _=f.useMemo(()=>({activeIndex:g,containerId:m,disabled:C,disableTransforms:v,items:y,overIndex:j,useDragOverlay:h,sortedRects:m2(y,c),strategy:r}),[g,m,C.draggable,C.droppable,v,y,j,c,h,r]);return te.createElement(ug.Provider,{value:_},s)}const j2=t=>{let{id:s,items:n,activeIndex:i,overIndex:r}=t;return Xc(n,i,r).indexOf(s)},y2=t=>{let{containerId:s,isSorting:n,wasDragging:i,index:r,items:a,newIndex:o,previousItems:l,previousContainerId:c,transition:d}=t;return!d||!i||l!==a&&r===o?!1:n?!0:o!==r&&s===c},w2={duration:200,easing:"ease"},mg="transform",b2=_r.Transition.toString({property:mg,duration:0,easing:"linear"}),v2={roleDescription:"sortable"};function N2(t){let{disabled:s,index:n,node:i,rect:r}=t;const[a,o]=f.useState(null),l=f.useRef(n);return vs(()=>{if(!s&&n!==l.current&&i.current){const c=r.current;if(c){const d=Li(i.current,{ignoreTransform:!0}),u={x:c.left-d.left,y:c.top-d.top,scaleX:c.width/d.width,scaleY:c.height/d.height};(u.x||u.y)&&o(u)}}n!==l.current&&(l.current=n)},[s,n,i,r]),f.useEffect(()=>{a&&o(null)},[a]),a}function k2(t){let{animateLayoutChanges:s=y2,attributes:n,disabled:i,data:r,getNewIndex:a=j2,id:o,strategy:l,resizeObserverConfig:c,transition:d=w2}=t;const{items:u,containerId:m,activeIndex:h,disabled:y,disableTransforms:x,sortedRects:g,overIndex:j,useDragOverlay:w,strategy:b}=f.useContext(ug),v=z2(i,y),C=u.indexOf(o),_=f.useMemo(()=>({sortable:{containerId:m,index:C,items:u},...r}),[m,r,C,u]),S=f.useMemo(()=>u.slice(u.indexOf(o)),[u,o]),{rect:z,node:k,isOver:T,setNodeRef:p}=u2({id:o,data:_,disabled:v.droppable,resizeObserverConfig:{updateMeasurementsFor:S,...c}}),{active:N,activatorEvent:A,activeNodeRect:D,attributes:P,setNodeRef:R,listeners:q,isDragging:L,over:U,setActivatorNodeRef:O,transform:G}=o2({id:o,data:_,attributes:{...v2,...n},disabled:v.draggable}),se=B1(p,R),ie=!!N,Ce=ie&&!x&&la(h)&&la(j),bt=!w&&L,Tt=bt&&Ce?G:null,me=Ce?Tt??(l??b)({rects:g,activeNodeRect:D,activeIndex:h,overIndex:j,index:C}):null,ut=la(h)&&la(j)?a({id:o,items:u,activeIndex:h,overIndex:j}):C,mt=N?.id,we=f.useRef({activeId:mt,items:u,newIndex:ut,containerId:m}),Bi=u!==we.current.items,ls=s({active:N,containerId:m,isDragging:L,isSorting:ie,id:o,index:C,items:u,newIndex:we.current.newIndex,previousItems:we.current.items,previousContainerId:we.current.containerId,transition:d,wasDragging:we.current.activeId!=null}),Vn=N2({disabled:!ls,index:C,node:k,rect:z});return f.useEffect(()=>{ie&&we.current.newIndex!==ut&&(we.current.newIndex=ut),m!==we.current.containerId&&(we.current.containerId=m),u!==we.current.items&&(we.current.items=u)},[ie,ut,m,u]),f.useEffect(()=>{if(mt===we.current.activeId)return;if(mt!=null&&we.current.activeId==null){we.current.activeId=mt;return}const Kn=setTimeout(()=>{we.current.activeId=mt},50);return()=>clearTimeout(Kn)},[mt]),{active:N,activeIndex:h,attributes:P,data:_,rect:z,index:C,newIndex:ut,items:u,isOver:T,isSorting:ie,isDragging:L,listeners:q,node:k,overIndex:j,over:U,setNodeRef:se,setActivatorNodeRef:O,setDroppableNodeRef:p,setDraggableNodeRef:R,transform:Vn??me,transition:Ss()};function Ss(){if(Vn||Bi&&we.current.newIndex===C)return b2;if(!(bt&&!Zc(A)||!d)&&(ie||ls))return _r.Transition.toString({...d,property:mg})}}function z2(t,s){var n,i;return typeof t=="boolean"?{draggable:t,droppable:!1}:{draggable:(n=t?.draggable)!=null?n:s.draggable,droppable:(i=t?.droppable)!=null?i:s.droppable}}function $a(t){if(!t)return!1;const s=t.data.current;return!!(s&&"sortable"in s&&typeof s.sortable=="object"&&"containerId"in s.sortable&&"items"in s.sortable&&"index"in s.sortable)}const S2=[oe.Down,oe.Right,oe.Up,oe.Left],C2=(t,s)=>{let{context:{active:n,collisionRect:i,droppableRects:r,droppableContainers:a,over:o,scrollableAncestors:l}}=s;if(S2.includes(t.code)){if(t.preventDefault(),!n||!i)return;const c=[];a.getEnabled().forEach(m=>{if(!m||m!=null&&m.disabled)return;const h=r.get(m.id);if(h)switch(t.code){case oe.Down:i.top<h.top&&c.push(m);break;case oe.Up:i.top>h.top&&c.push(m);break;case oe.Left:i.left>h.left&&c.push(m);break;case oe.Right:i.left<h.left&&c.push(m);break}});const d=rS({collisionRect:i,droppableRects:r,droppableContainers:c});let u=Qx(d,"id");if(u===o?.id&&d.length>1&&(u=d[1].id),u!=null){const m=a.get(n.id),h=a.get(u),y=h?r.get(h.id):null,x=h?.node.current;if(x&&y&&m&&h){const j=So(x).some((S,z)=>l[z]!==S),w=hg(m,h),b=_2(m,h),v=j||!w?{x:0,y:0}:{x:b?i.width-y.width:0,y:b?i.height-y.height:0},C={x:y.left,y:y.top};return v.x&&v.y?C:Cr(C,v)}}}};function hg(t,s){return!$a(t)||!$a(s)?!1:t.data.current.sortable.containerId===s.data.current.sortable.containerId}function _2(t,s){return!$a(t)||!$a(s)||!hg(t,s)?!1:t.data.current.sortable.index<s.data.current.sortable.index}const T2=()=>e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}),A2=({course:t,topicsCount:s,activitiesCount:n,accessCount:i})=>e.jsxs(yt,{variant:"2-2-4",children:[e.jsxs(I,{children:[e.jsx(F,{className:"pb-2",children:e.jsx($,{className:"text-sm font-medium",children:"Status"})}),e.jsx(E,{children:e.jsx(V,{variant:t?.is_published?"default":"secondary",children:t?.is_published?"Opublikowany":"Szkic"})})]}),e.jsxs(I,{children:[e.jsx(F,{className:"pb-2",children:e.jsx($,{className:"text-sm font-medium",children:"Tematy"})}),e.jsx(E,{children:e.jsx("div",{className:"text-2xl font-bold",children:s})})]}),e.jsxs(I,{children:[e.jsx(F,{className:"pb-2",children:e.jsx($,{className:"text-sm font-medium",children:"Aktywnoci"})}),e.jsx(E,{children:e.jsx("div",{className:"text-2xl font-bold",children:n})})]}),e.jsxs(I,{children:[e.jsx(F,{className:"pb-2",children:e.jsx($,{className:"text-sm font-medium",children:"Uczestnik贸w"})}),e.jsx(E,{children:e.jsx("div",{className:"text-2xl font-bold",children:i})})]})]}),D2=({id:t,disabled:s=!1,children:n})=>{const{attributes:i,listeners:r,setNodeRef:a,transform:o,transition:l,isDragging:c}=k2({id:t,disabled:s}),d={transform:_r.Transform.toString(o),transition:l,opacity:c?.5:1,cursor:c?"grabbing":"grab"},u=s?{}:{...i,...r,style:{cursor:c?"grabbing":"grab"}};return e.jsx("div",{ref:a,style:d,className:c?"z-50":"",children:n({dragHandleProps:u,isDragging:c})})},Bu=({items:t,renderItem:s,onReorder:n,className:i="space-y-2",disabled:r=!1})=>{const[a,o]=f.useState(t),[l,c]=f.useState(null),[d,u]=f.useState(null);f.useEffect(()=>{if(!d)o(t);else{const x=a.map(g=>{const j=t.find(w=>w.id===g.id);return j?{...j,position:g.position}:g});o(x)}},[t]);const m=sS(Tu(Jc,{activationConstraint:{distance:8}}),Tu(Qc,{coordinateGetter:C2})),h=x=>{c(Number(x.active.id))},y=x=>{const{active:g,over:j}=x;if(c(null),j&&g.id!==j.id){const w=a.findIndex(v=>v.id===Number(g.id)),b=a.findIndex(v=>v.id===Number(j.id));if(w!==-1&&b!==-1&&w!==b){let v;const C=a[w];if(b===0)v=a[0].position/2;else if(b===a.length-1)v=a[a.length-1].position+1e3;else if(w<b){const z=a[b],k=b+1<a.length?a[b+1]:null;k?v=(z.position+k.position)/2:v=z.position+1e3}else{const z=b>0?a[b-1]:null,k=a[b];z?v=(z.position+k.position)/2:v=k.position/2}const S=Xc(a,w,b).map(z=>z.id===C.id?{...z,position:v}:z);o(S),u({id:C.id,position:v}),n(C.id,v),setTimeout(()=>u(null),2e3)}}};return e.jsx(i2,{sensors:m,collisionDetection:iS,onDragStart:h,onDragEnd:y,children:e.jsx(g2,{items:a.map(x=>x.id),strategy:f2,children:e.jsx("div",{className:i,children:a.map((x,g)=>e.jsx(D2,{id:x.id,disabled:r||d!==null&&d.id!==x.id,children:j=>s(x,g,j.dragHandleProps)},x.id))})})})},P2=()=>{const{list:t,edit:s}=ct(),{id:n}=Ct(),[i,r]=Ga(),{navigateWithReturn:a,navigateToWizard:o}=D1(),{course:l,topics:c,groups:d,stats:u,isLoading:m,refetchTopics:h,refetchActivities:y,getActivitiesForTopic:x,getMembersCountForGroup:g}=P1(n),{togglePublish:j}=Dl("topics"),{togglePublish:w}=Dl("activities"),{updatePosition:b,isUpdating:v}=Cu("topics"),{updatePosition:C,isUpdating:_}=Cu("activities"),{mutate:S}=Is(),{mutate:z}=Is(),k=i.get("expanded");if(m)return e.jsx(T2,{});if(!l)return e.jsx(H,{children:e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Nie znaleziono kursu"})})});const T=P=>{k===P.toString()?(i.delete("expanded"),r(i)):r({expanded:P.toString()})},p=(P,R)=>{confirm(`Czy na pewno chcesz usun temat "${R}" wraz ze wszystkimi aktywnociami?`)&&S({resource:"topics",id:P},{onSuccess:()=>{Y.success("Temat zosta usunity"),h(),y(),k===P.toString()&&(i.delete("expanded"),r(i))}})},N=(P,R)=>{confirm(`Czy na pewno chcesz usun aktywno "${R}"?`)&&z({resource:"activities",id:P},{onSuccess:()=>{Y.success("Aktywno zostaa usunita"),y(),h()}})},A=async(P,R)=>{try{await b(P,R)}catch(q){console.error("Failed to reorder topic:",q)}},D=async(P,R)=>{try{await C(P,R)}catch(q){console.error("Failed to reorder activity:",q)}};return e.jsxs(H,{children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>t("courses"),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Powr贸t do listy"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Szczeg贸y kursu"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(M,{onClick:()=>a(`/teacher/course-structure/edit/${l?.id}`),size:"sm",variant:"secondary",children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"}),"Edytuj z AI"]}),e.jsxs(M,{onClick:()=>s("courses",l?.id??0),size:"sm",children:[e.jsx(ks,{className:"w-4 h-4 mr-2"}),"Edytuj kurs"]})]})]}),e.jsx(F1,{course:l})]}),e.jsx(A2,{course:l,topicsCount:u.topicsCount,activitiesCount:u.activitiesCount,accessCount:u.accessCount}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs(J,{children:[e.jsxs($,{className:"flex items-center gap-2",children:["Struktura kursu",(v||_)&&e.jsxs("span",{className:"text-sm font-normal text-muted-foreground flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),"Zapisywanie..."]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(M,{size:"sm",variant:"outline",onClick:()=>a(`/teacher/course-structure/edit/${l?.id}`),children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Dodaj tematy z AI"]}),e.jsxs(M,{size:"sm",onClick:()=>a(`/teacher/topics/create?course_id=${n}`),children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Dodaj temat"]})]})]})}),e.jsx(E,{children:c.length>0?e.jsx(Bu,{items:c,onReorder:A,disabled:v||_,renderItem:(P,R,q)=>{const L=x(P.id),U=k===P.id.toString();return e.jsx(O1,{topic:{...P,position:R+1},isExpanded:U,onToggle:()=>T(P.id),onDelete:p,onEdit:(O,G)=>a(`/${O}/edit/${G}`),onTogglePublish:(O,G,se)=>j(O,G,se,h),activitiesCount:L.length,onNavigateToWizard:o,courseId:Number(l?.id),courseTitle:l?.title,dragHandleProps:q,children:L.length>0?e.jsx(Bu,{items:L,onReorder:D,disabled:_,renderItem:(O,G,se)=>e.jsx($1,{activity:{...O,position:G+1},topicPosition:R+1,onDelete:N,onEdit:(ie,Ce)=>a(`/${ie}/edit/${Ce}`),onTogglePublish:(ie,Ce,bt)=>w(ie,Ce,bt,y),dragHandleProps:se},O.id)}):e.jsxs("div",{className:"text-center py-6 text-muted-foreground",children:[e.jsx("p",{children:"Brak aktywnoci w tym temacie"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-center mt-4",children:[e.jsxs(M,{size:"sm",variant:"outline",onClick:()=>a(`/activities/create?topic_id=${P.id}`),children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Dodaj rcznie"]}),e.jsxs(M,{size:"sm",onClick:()=>o("/teacher/educational-material/step1",{courseId:l?.id,courseTitle:l?.title,topicId:P.id,topicTitle:P.title}),children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"}),"Generuj materia z AI"]}),e.jsxs(M,{size:"sm",variant:"secondary",onClick:()=>o("/teacher/quiz-wizard/step1",{courseId:l?.id,courseTitle:l?.title,topicId:P.id,topicTitle:P.title}),children:[e.jsx(ys,{className:"w-4 h-4 mr-2"}),"Generuj quiz z AI"]})]})]})},P.id)}}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(zt,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Brak temat贸w w tym kursie"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center mt-4",children:[e.jsxs(M,{onClick:()=>a(`/topics/create?course_id=${n}`),children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Dodaj pierwszy temat"]}),e.jsxs(M,{variant:"secondary",onClick:()=>a(`/teacher/course-structure/edit/${l?.id}`),children:[e.jsx(hr,{className:"w-4 h-4 mr-2"}),"Wygeneruj struktur z AI"]})]})]})})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs(J,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5"}),"Grupy z dostpem"]}),e.jsxs(V,{variant:"outline",children:[d.length," ",d.length===1?"grupa":"grup"]})]})}),e.jsx(E,{children:d.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:d.map(P=>e.jsx(q1,{group:P,membersCount:g(P.id)},P.id))}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(de,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Brak przypisanych grup do tego kursu"}),e.jsx("p",{className:"text-sm mt-2",children:"Administrator mo偶e przypisa grupy w ustawieniach kursu"})]})})]}),e.jsxs(I,{className:"border-dashed border-2 bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-950/20 dark:to-blue-950/20",children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"w-5 h-5 text-purple-600"}),"Szybkie akcje AI"]})}),e.jsx(E,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx(M,{variant:"outline",className:"justify-start h-auto py-3 px-4 bg-white dark:bg-background",onClick:()=>a(`/teacher/course-structure/edit/${l?.id}`),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(hr,{className:"w-5 h-5 text-indigo-600 mt-0.5"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"Rozbuduj struktur kursu"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Dodaj nowe tematy z AI"})]})]})}),e.jsx(M,{variant:"outline",className:"justify-start h-auto py-3 px-4 bg-white dark:bg-background",onClick:()=>o("/educational-material/step1",{courseId:l?.id,courseTitle:l?.title}),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(_i,{className:"w-5 h-5 text-purple-600 mt-0.5"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"Generuj materia"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Stw贸rz treci z AI"})]})]})}),e.jsx(M,{variant:"outline",className:"justify-start h-auto py-3 px-4 bg-white dark:bg-background",onClick:()=>o("/quiz-wizard/step1",{courseId:l?.id,courseTitle:l?.title}),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ys,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"Stw贸rz quiz"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Quiz sprawdzajcy z AI"})]})]})})]})})]})]})},Uu={name:"courses",list:"/teacher/courses",create:"/teacher/courses/create",edit:"/teacher/courses/edit/:id",show:"/teacher/courses/show/:id",meta:{label:"Kursy",icon:e.jsx(ye,{className:"h-4 w-4"})}},M2=[e.jsx(K,{path:"courses",element:e.jsx(M1,{})},"courses-list"),e.jsx(K,{path:"courses/create",element:e.jsx(E1,{})},"courses-create"),e.jsx(K,{path:"courses/edit/:id",element:e.jsx(L1,{})},"courses-edit"),e.jsx(K,{path:"courses/show/:id",element:e.jsx(P2,{})},"courses-show")],I2=()=>{const{edit:t,list:s}=ct(),{mutate:n}=Mn(),{mutate:i}=Is(),[r,a]=f.useState("all"),[o,l]=f.useState(!1),[c,d]=f.useState(null),u=r!=="all"?[{field:"course_id",operator:"eq",value:r}]:[],{data:m,isLoading:h,refetch:y}=Z({resource:"topics",meta:{populate:["courses"]},filters:u,pagination:{pageSize:20},sorters:[{field:"courses.title",order:"asc"},{field:"position",order:"asc"}]}),{data:x}=Z({resource:"courses",pagination:{pageSize:100},sorters:[{field:"title",order:"asc"}]}),g=m?.data||[],j=x?.data||[],w=async v=>{await n({resource:"topics",id:v.id,values:{is_published:!v.is_published},successNotification:()=>({message:v.is_published?"Temat zosta ukryty":"Temat zosta opublikowany",type:"success"})}),y()},b=v=>{d(v),l(!0)};return e.jsxs(H,{children:[e.jsxs(J,{children:[e.jsx(ue,{title:"Tematy",description:"Zarzdzaj tematami kurs贸w"}),e.jsxs(J,{variant:"start",className:"gap-2",children:[j.length>0&&e.jsxs(ge,{value:r,onValueChange:a,children:[e.jsxs(fe,{className:"w-[250px]",children:[e.jsx(Xh,{className:"h-4 w-4 mr-2"}),e.jsx(je,{placeholder:"Filtruj po kursie"})]}),e.jsxs(xe,{children:[e.jsx(W,{value:"all",children:"Wszystkie kursy"}),e.jsx(jt,{}),j.map(v=>e.jsx(W,{value:v.id.toString(),children:v.title},v.id))]})]}),e.jsxs(M,{onClick:()=>s("courses"),children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Przejd藕 do kurs贸w"]})]})]}),e.jsx(I,{children:e.jsx(E,{className:"p-0",children:h?e.jsx("div",{className:"p-8",children:e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((v,C)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Mt,{className:"h-12 w-12"}),e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(Mt,{className:"h-4 w-3/4"}),e.jsx(Mt,{className:"h-4 w-1/2"})]})]},C))})}):g.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(ye,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium text-muted-foreground",children:r!=="all"?"Brak temat贸w w wybranym kursie":"Brak temat贸w"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Aby doda temat, przejd藕 do kursu"}),e.jsxs(M,{onClick:()=>s("courses"),children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Przejd藕 do kurs贸w"]})]}):e.jsxs(En,{children:[e.jsx(Rn,{children:e.jsxs(St,{children:[e.jsx(le,{className:"w-[50px]",children:"#"}),e.jsx(le,{children:"Tytu"}),e.jsx(le,{className:"w-[200px]",children:"Kurs"}),e.jsx(le,{className:"w-[120px]",children:"Status"}),e.jsx(le,{className:"w-[140px]",children:"Data utworzenia"}),e.jsx(le,{className:"text-right w-[80px]",children:"Akcje"})]})}),e.jsx(Ln,{children:g.map(v=>e.jsxs(St,{children:[e.jsx(ce,{className:"font-medium",children:e.jsx(V,{variant:"outline",className:"w-12 justify-center",children:v.position})}),e.jsx(ce,{children:e.jsx("div",{className:"font-medium",children:v.title})}),e.jsx(ce,{className:"max-w-[200px]",children:e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(ye,{className:"h-4 w-4 mr-2 text-muted-foreground shrink-0"}),e.jsx("span",{className:"truncate block",title:v.courses?.title||"Brak kursu",children:v.courses?.title||"Brak kursu"})]})}),e.jsx(ce,{children:e.jsx(V,{variant:v.is_published?"default":"secondary",children:v.is_published?"Opublikowany":"Szkic"})}),e.jsx(ce,{children:e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground",children:[e.jsx(et,{className:"h-4 w-4 mr-2"}),new Date(v.created_at).toLocaleDateString("pl-PL")]})}),e.jsx(ce,{className:"text-right",children:e.jsxs(Ni,{children:[e.jsx(ki,{asChild:!0,children:e.jsxs(M,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Otw贸rz menu"}),e.jsx(ww,{className:"h-4 w-4"})]})}),e.jsxs(Tn,{align:"end",children:[e.jsxs(ve,{onClick:()=>t("topics",v.id),children:[e.jsx(ks,{className:"mr-2 h-4 w-4"}),"Edytuj"]}),e.jsx(jt,{}),e.jsx(ve,{onClick:()=>w(v),children:v.is_published?e.jsxs(e.Fragment,{children:[e.jsx(Nn,{className:"mr-2 h-4 w-4"}),"Ukryj temat"]}):e.jsxs(e.Fragment,{children:[e.jsx(bw,{className:"mr-2 h-4 w-4"}),"Opublikuj temat"]})}),e.jsx(jt,{}),e.jsxs(ve,{onClick:()=>b(v),className:"text-destructive focus:text-destructive",children:[e.jsx(Ft,{className:"mr-2 h-4 w-4"}),"Usu temat"]})]})]})})]},v.id))})]})})})]})},E2=()=>{const{show:t}=ct(),s=ae(),[n]=Ga(),i=n.get("course_id"),{data:r}=Xe({resource:"courses",id:i,queryOptions:{enabled:!!i}}),{data:a,isLoading:o}=Z({resource:"topics",filters:[{field:"course_id",operator:"eq",value:i}],sorters:[{field:"position",order:"desc"}],pagination:{pageSize:1},queryOptions:{enabled:!!i}}),{refineCore:{onFinish:l},register:c,handleSubmit:d,setValue:u,watch:m,formState:{errors:h,isSubmitting:y}}=ln({defaultValues:{course_id:i?parseInt(i):void 0,is_published:!1,position:1},refineCoreProps:{successNotification:()=>({message:"Temat zosta utworzony",type:"success"}),redirect:!1,onMutationSuccess:()=>{i?t("courses",i):s("/courses")}}});f.useEffect(()=>{if(!o&&a&&a.data.length>0){const g=a.data[0].position+1;u("position",g)}},[a,o,u]);const x=()=>{i?t("courses",i):s("/courses")};return e.jsxs(H,{children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:x,children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Powr贸t do kursu"]}),e.jsx(J,{children:e.jsx(ue,{title:"Dodaj temat",description:r?.data?`Do kursu: ${r.data.title}`:"Utw贸rz nowy temat"})}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Informacje o temacie"})}),e.jsx(E,{children:e.jsxs(mn,{onSubmit:d(l),children:[e.jsx("input",{type:"hidden",...c("course_id")}),e.jsx(re,{label:"Tytu tematu",htmlFor:"title",error:h.title?.message,required:!0,children:e.jsx(Q,{id:"title",placeholder:"np. Wprowadzenie do zmiennych",...c("title",{required:"Tytu tematu jest wymagany",minLength:{value:3,message:"Tytu musi mie minimum 3 znaki"}})})}),e.jsx(re,{label:"Pozycja",htmlFor:"position",error:h.position?.message,required:!0,children:e.jsx(Q,{id:"position",type:"number",min:"1",disabled:!0,className:"bg-muted",...c("position",{required:"Pozycja jest wymagana",min:{value:1,message:"Pozycja musi by wiksza od 0"},valueAsNumber:!0})})}),e.jsx(re,{label:"Status publikacji",children:e.jsxs(J,{variant:"start",children:[e.jsx(qt,{checked:m("is_published")||!1,onCheckedChange:g=>u("is_published",g)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Opublikuj temat od razu"})]})}),e.jsxs(hn,{children:[e.jsx(M,{type:"button",variant:"outline",onClick:x,children:"Anuluj"}),e.jsx(M,{type:"submit",disabled:y||!i,children:y?"Tworzenie...":"Utw贸rz temat"})]})]})})]})]})},An=({variant:t="outline",size:s="sm",children:n="Powr贸t do kursu"})=>{const i=ae(),r=Ns(),a=()=>{const o=sessionStorage.getItem("returnUrl");if(o){sessionStorage.removeItem("returnUrl"),i(o);return}const c=new URLSearchParams(r.search).get("returnUrl");if(c){i(decodeURIComponent(c));return}i(-1)};return e.jsxs(M,{variant:t,size:s,onClick:a,children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),n]})},R2=()=>{const{show:t}=ct(),{id:s}=Ct(),n=ae(),{data:i,isLoading:r}=Xe({resource:"topics",id:s,liveMode:"off"}),a=i?.data,o=a?.course_id,{refineCore:{onFinish:l},register:c,handleSubmit:d,setValue:u,watch:m,formState:{errors:h,isSubmitting:y}}=ln({refineCoreProps:{resource:"topics",id:s,liveMode:"off",successNotification:()=>({message:"Temat zosta zaktualizowany",type:"success"}),redirect:!1,onMutationSuccess:()=>{const g=sessionStorage.getItem("returnUrl");g?(sessionStorage.removeItem("returnUrl"),n(g)):o&&n(`/teacher/courses/show/${o}?expanded=${s}`)}}}),x=()=>{const g=sessionStorage.getItem("returnUrl");g?(sessionStorage.removeItem("returnUrl"),n(g)):o?n(`/teacher/courses/show/${o}?expanded=${s}`):t("courses","")};return r?e.jsx(H,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):e.jsxs(H,{children:[e.jsx(An,{}),e.jsx(J,{children:e.jsx(ue,{title:"Edytuj temat",description:`Edycja: ${a?.title}`})}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Informacje o temacie"})}),e.jsx(E,{children:e.jsxs(mn,{onSubmit:d(l),children:[e.jsx(re,{label:"Tytu tematu",htmlFor:"title",error:h.title?.message,required:!0,children:e.jsx(Q,{id:"title",placeholder:"np. Wprowadzenie do zmiennych",...c("title",{required:"Tytu tematu jest wymagany",minLength:{value:3,message:"Tytu musi mie minimum 3 znaki"}})})}),e.jsx(re,{label:"Pozycja",htmlFor:"position",error:h.position?.message,required:!0,children:e.jsx(Q,{id:"position",type:"number",min:"1",...c("position",{required:"Pozycja jest wymagana",min:{value:1,message:"Pozycja musi by wiksza od 0"},valueAsNumber:!0})})}),e.jsx(re,{label:"Status publikacji",children:e.jsxs(J,{variant:"start",children:[e.jsx(qt,{checked:m("is_published")||!1,onCheckedChange:g=>u("is_published",g)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Temat jest opublikowany"})]})}),e.jsxs(hn,{children:[e.jsx(M,{type:"button",variant:"outline",onClick:x,children:"Anuluj"}),e.jsx(M,{type:"submit",disabled:y,children:y?"Zapisywanie...":"Zapisz zmiany"})]})]})})]})]})},Vu={name:"topics",list:"/teacher/topics",create:"/teacher/topics/create",edit:"/teacher/topics/edit/:id",meta:{label:"Tematy",icon:e.jsx(zt,{className:"h-4 w-4"})}},L2=[e.jsx(K,{path:"topics",element:e.jsx(I2,{})},"topics-list"),e.jsx(K,{path:"topics/create",element:e.jsx(E2,{})},"topics-create"),e.jsx(K,{path:"topics/edit/:id",element:e.jsx(R2,{})},"topics-edit")],O2=()=>{const{show:t}=ct(),s=ae(),[n]=Ga(),i=n.get("topic_id"),{data:r}=Xe({resource:"topics",id:i,meta:{select:"*, courses(*)"},queryOptions:{enabled:!!i}}),{data:a,isLoading:o}=Z({resource:"activities",filters:[{field:"topic_id",operator:"eq",value:i}],sorters:[{field:"position",order:"desc"}],pagination:{pageSize:1},queryOptions:{enabled:!!i}}),{refineCore:{onFinish:l},register:c,handleSubmit:d,setValue:u,watch:m,formState:{errors:h,isSubmitting:y}}=ln({defaultValues:{topic_id:i?parseInt(i):void 0,type:"material",is_published:!1,position:1,passing_score:70},refineCoreProps:{successNotification:!1,redirect:!1,onMutationSuccess:j=>{const w=r?.data?.course_id,b=j.data.type;if(Y.success("Aktywno zostaa utworzona"),b==="quiz")Y.info("Dodaj pytania do quizu"),s(`/teacher/questions/manage/${j.data.id}`);else{const v=sessionStorage.getItem("returnUrl");v?(sessionStorage.removeItem("returnUrl"),s(v)):s(w?`/teacher/courses/show/${w}?expanded=${i}`:"/teacher/courses")}}}}),x=m("type");f.useEffect(()=>{if(!o&&a&&a.data.length>0){const j=a.data[0].position+1;u("position",j)}},[a,o,u]);const g=()=>{const j=sessionStorage.getItem("returnUrl");j?(sessionStorage.removeItem("returnUrl"),s(j)):r?.data?.course_id?s(`/courses/show/${r.data.course_id}?expanded=${i}`):s("/courses")};return r?.data?.course_id,i?e.jsxs(H,{children:[e.jsx(An,{}),e.jsx(J,{children:e.jsx(ue,{title:"Dodaj aktywno",description:r?.data?e.jsxs("div",{children:[e.jsx("div",{className:"text-lg",children:r.data.courses?.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Temat ",r.data.position,": ",r.data.title]})]}):"Utw贸rz nowy materia lub quiz"})}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Informacje o aktywnoci"})}),e.jsx(E,{children:e.jsxs(mn,{onSubmit:d(l),children:[e.jsx("input",{type:"hidden",...c("topic_id")}),e.jsxs(yt,{variant:"1-2-2",children:[e.jsx(re,{label:"Typ aktywnoci",error:h.type?.message,required:!0,children:e.jsxs(ge,{value:x,onValueChange:j=>u("type",j),children:[e.jsx(fe,{children:e.jsx(je,{placeholder:"Wybierz typ"})}),e.jsxs(xe,{children:[e.jsx(W,{value:"material",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(zt,{className:"w-4 h-4"}),"Materia"]})}),e.jsx(W,{value:"quiz",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4"}),"Quiz"]})})]})]})}),e.jsx(re,{label:"Tytu",htmlFor:"title",error:h.title?.message,required:!0,children:e.jsx(Q,{id:"title",placeholder:x==="quiz"?"np. Test wiedzy z rozdziau":"np. Wprowadzenie do tematu",...c("title",{required:"Tytu jest wymagany",minLength:{value:3,message:"Tytu musi mie minimum 3 znaki"}})})}),e.jsx(re,{label:"Pozycja w temacie",htmlFor:"position",error:h.position?.message,required:!0,children:e.jsx(Q,{id:"position",type:"number",min:"1",disabled:!0,className:"bg-muted",...c("position",{required:"Pozycja jest wymagana",min:{value:1,message:"Pozycja musi by wiksza od 0"},valueAsNumber:!0})})}),e.jsx(re,{label:"Czas trwania (min)",htmlFor:"duration_min",hint:"Szacowany czas potrzebny na ukoczenie",children:e.jsx(Q,{id:"duration_min",type:"number",min:"1",placeholder:"np. 15",...c("duration_min",{min:{value:1,message:"Czas musi by wikszy od 0"},valueAsNumber:!0})})})]}),x==="material"&&e.jsx(re,{label:"Tre materiau",htmlFor:"content",error:h.content?.message,required:!0,hint:"Mo偶esz u偶ywa formatowania Markdown",children:e.jsx(Xt,{id:"content",placeholder:"Wprowad藕 tre materiau edukacyjnego...",rows:10,...c("content",{required:x==="material"?"Tre jest wymagana dla materiau":!1})})}),x==="quiz"&&e.jsxs(e.Fragment,{children:[e.jsxs(yt,{variant:"1-1-1",children:[e.jsx(re,{label:"Pr贸g zaliczenia (%)",htmlFor:"passing_score",error:h.passing_score?.message,hint:"Minimalny wynik do zaliczenia",children:e.jsx(Q,{id:"passing_score",type:"number",min:"0",max:"100",...c("passing_score",{min:{value:0,message:"Warto minimalna to 0"},max:{value:100,message:"Warto maksymalna to 100"},valueAsNumber:!0})})}),e.jsx(re,{label:"Limit czasu (min)",htmlFor:"time_limit",hint:"Pozostaw puste dla braku limitu",children:e.jsx(Q,{id:"time_limit",type:"number",min:"1",placeholder:"Brak limitu",...c("time_limit",{min:{value:1,message:"Limit musi by wikszy od 0"},valueAsNumber:!0})})}),e.jsx(re,{label:"Maksymalna liczba pr贸b",htmlFor:"max_attempts",hint:"Pozostaw puste dla nieograniczonej liczby",children:e.jsx(Q,{id:"max_attempts",type:"number",min:"1",placeholder:"Bez limitu",...c("max_attempts",{min:{value:1,message:"Minimum 1 pr贸ba"},valueAsNumber:!0})})})]}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{className:"text-blue-700 dark:text-blue-300",children:" Wskaz贸wka:"})," ",e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:"Po utworzeniu quizu zostaniesz przekierowany do ekranu dodawania pyta."})]})})]}),e.jsx(re,{label:"Status publikacji",children:e.jsxs(J,{variant:"start",children:[e.jsx(qt,{checked:m("is_published")||!1,onCheckedChange:j=>u("is_published",j)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Opublikuj aktywno od razu (uczniowie bd mogli j zobaczy)"})]})}),e.jsxs(hn,{children:[e.jsx(M,{type:"button",variant:"outline",onClick:g,disabled:y,children:"Anuluj"}),e.jsx(M,{type:"submit",disabled:y||!i,children:y?"Tworzenie...":x==="quiz"?"Utw贸rz i dodaj pytania":"Utw贸rz aktywno"})]})]})})]})]}):e.jsx(H,{children:e.jsx(I,{children:e.jsxs(E,{className:"text-center py-12",children:[e.jsx("p",{className:"text-lg font-medium text-muted-foreground mb-4",children:"Nie wybrano tematu"}),e.jsx(M,{onClick:()=>s("/courses"),children:"Przejd藕 do kurs贸w"})]})})})},$2=()=>{const{list:t}=ct(),{id:s}=Ct(),n=ae(),{data:i,isLoading:r}=Xe({resource:"activities",id:s,liveMode:"off",meta:{select:"*, topics(*, courses(*))"}}),{data:a}=Xe({resource:"questions",id:s,meta:{select:"count",filter:`activity_id.eq.${s}`},queryOptions:{enabled:!!s&&i?.data?.type==="quiz"}}),{refineCore:{onFinish:o,formLoading:l},register:c,handleSubmit:d,setValue:u,watch:m,reset:h,formState:{errors:y,isSubmitting:x}}=ln({refineCoreProps:{resource:"activities",id:s,liveMode:"off",redirect:!1,successNotification:!1,onMutationSuccess:()=>{const T=i?.data?.topics?.course_id,p=i?.data?.topic_id;Y.success("Aktywno zostaa zaktualizowana");const N=sessionStorage.getItem("returnUrl");N?(sessionStorage.removeItem("returnUrl"),n(N)):T?n(`/teacher/courses/show/${T}?expanded=${p}`):t("activities")},onMutationError:T=>{console.error("Bd podczas aktualizacji:",T),T?.code==="PGRST204"?Y.error("Bd konfiguracji - skontaktuj si z administratorem"):T?.code==="23505"?Y.error("Aktywno o tej pozycji ju偶 istnieje w tym temacie"):T?.code==="23503"?Y.error("Nieprawidowe powizanie z tematem"):T?.message?Y.error(`Bd: ${T.message}`):Y.error("Wystpi nieoczekiwany bd. Spr贸buj ponownie.")}}});f.useEffect(()=>{if(i?.data){const{topics:T,_count:p,questions:N,...A}=i.data;h(A)}},[i,h]);const g=m("type")||i?.data?.type||"material";if(r||l)return e.jsx(H,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const j=i?.data,w=j?.topics,b=w?.courses,v=b?.id,C=j?.topic_id,_=()=>{const T=sessionStorage.getItem("returnUrl");T?(sessionStorage.removeItem("returnUrl"),n(T)):v?n(`/teacher/courses/show/${v}?expanded=${C}`):t("activities")},S=()=>g==="quiz"?e.jsx(Re,{className:"w-6 h-6 text-blue-500"}):e.jsx(zt,{className:"w-6 h-6 text-green-500"}),z=()=>{const T=window.location.pathname+window.location.search;sessionStorage.setItem("returnUrl",T),n(`/teacher/questions/manage/${j?.id}`)},k=a?.data?.[0]?.count||0;return e.jsxs(H,{children:[e.jsx(An,{}),e.jsxs(J,{children:[e.jsx(ue,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[S(),"Edytuj aktywno"]}),description:e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-medium",children:j?.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[b?.title,"  Temat ",w?.position,": ",w?.title]})]})}),g==="quiz"&&e.jsxs(M,{onClick:z,variant:"outline",children:[e.jsx(Ys,{className:"w-4 h-4 mr-2"}),"Zarzdzaj pytaniami (",k,")"]})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Informacje o aktywnoci"})}),e.jsx(E,{children:e.jsxs(mn,{onSubmit:d(o),children:[e.jsxs(yt,{variant:"1-2-2",children:[e.jsxs(re,{label:"Typ aktywnoci",error:y.type?.message,required:!0,children:[e.jsxs(ge,{value:g,disabled:!0,children:[e.jsx(fe,{className:"bg-muted",children:e.jsx(je,{placeholder:"Wybierz typ"})}),e.jsxs(xe,{children:[e.jsx(W,{value:"material",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(zt,{className:"w-4 h-4"}),"Materia"]})}),e.jsx(W,{value:"quiz",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4"}),"Quiz"]})})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Typ aktywnoci nie mo偶e by zmieniony"})]}),e.jsx(re,{label:"Tytu",htmlFor:"title",error:y.title?.message,required:!0,children:e.jsx(Q,{id:"title",placeholder:g==="quiz"?"np. Test wiedzy":"np. Wprowadzenie",...c("title",{required:"Tytu jest wymagany",minLength:{value:3,message:"Tytu musi mie minimum 3 znaki"}})})}),e.jsx(re,{label:"Pozycja w temacie",htmlFor:"position",error:y.position?.message,required:!0,children:e.jsx(Q,{id:"position",type:"number",min:"1",...c("position",{required:"Pozycja jest wymagana",min:{value:1,message:"Pozycja musi by wiksza od 0"},valueAsNumber:!0})})}),e.jsx(re,{label:"Czas trwania (min)",htmlFor:"duration_min",hint:"Szacowany czas potrzebny na ukoczenie",children:e.jsx(Q,{id:"duration_min",type:"number",min:"1",placeholder:"np. 15",...c("duration_min",{min:{value:1,message:"Czas musi by wikszy od 0"},valueAsNumber:!0})})})]}),g==="material"&&e.jsx(re,{label:"Tre materiau",htmlFor:"content",error:y.content?.message,required:!0,hint:"Mo偶esz u偶ywa formatowania Markdown",children:e.jsx(Xt,{id:"content",placeholder:"Wprowad藕 tre materiau...",rows:10,...c("content",{required:g==="material"?"Tre jest wymagana dla materiau":!1})})}),g==="quiz"&&e.jsxs(e.Fragment,{children:[e.jsxs(yt,{variant:"1-1-1",children:[e.jsx(re,{label:"Pr贸g zaliczenia (%)",htmlFor:"passing_score",error:y.passing_score?.message,hint:"Minimalny wynik do zaliczenia",children:e.jsx(Q,{id:"passing_score",type:"number",min:"0",max:"100",...c("passing_score",{min:{value:0,message:"Warto minimalna to 0"},max:{value:100,message:"Warto maksymalna to 100"},valueAsNumber:!0})})}),e.jsx(re,{label:"Limit czasu (min)",htmlFor:"time_limit",hint:"Pozostaw puste dla braku limitu",children:e.jsx(Q,{id:"time_limit",type:"number",min:"1",placeholder:"Brak limitu",...c("time_limit",{min:{value:1,message:"Limit musi by wikszy od 0"},valueAsNumber:!0})})}),e.jsx(re,{label:"Maksymalna liczba pr贸b",htmlFor:"max_attempts",hint:"Pozostaw puste dla nieograniczonej liczby",children:e.jsx(Q,{id:"max_attempts",type:"number",min:"1",placeholder:"Bez limitu",...c("max_attempts",{min:{value:1,message:"Minimum 1 pr贸ba"},valueAsNumber:!0})})})]}),k>0&&e.jsx(I,{className:"mt-4 bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800",children:e.jsx(E,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium",children:["Ten quiz zawiera ",k," ",k===1?"pytanie":"pyta"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Mo偶esz zarzdza pytaniami klikajc przycisk powy偶ej"})]}),e.jsx(V,{variant:"outline",className:"text-lg px-3 py-1",children:k})]})})})]}),e.jsx(re,{label:"Status publikacji",children:e.jsxs(J,{variant:"start",children:[e.jsx(qt,{checked:m("is_published")||!1,onCheckedChange:T=>u("is_published",T)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Aktywno jest opublikowana (uczniowie mog j zobaczy)"})]})}),e.jsxs(hn,{children:[e.jsx(M,{type:"button",variant:"outline",onClick:_,disabled:x,children:"Anuluj"}),e.jsx(M,{type:"submit",disabled:x,children:x?"Zapisywanie...":"Zapisz zmiany"})]})]})})]})]})},F2=({activity:t})=>e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[1fr,300px]",children:[e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Tre materiau"})}),e.jsx(E,{children:t.content?e.jsx(wr,{content:t.content,showMetadata:!1,height:"600px"}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(zt,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Brak treci materiau"})]})})]}),e.jsxs(I,{children:[e.jsx(F,{className:"pb-3",children:e.jsx($,{className:"text-base",children:"Informacje"})}),e.jsx(E,{children:e.jsx(wr,{content:"",metadata:{duration_min:t.duration_min,position:t.position,created_at:t.created_at,updated_at:t.updated_at},showMetadata:!0,height:"0px"})})]})]}),q2=({activity:t,questionsCount:s,questionsData:n,questionsLoading:i,onNavigateToQuestions:r})=>{const a=n?.reduce((l,c)=>l+(c.points||0),0)||0,o=Math.ceil((t.passing_score||70)/100*a);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Parametry quizu"})}),e.jsx(E,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(et,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Czas trwania"})]}),e.jsxs("p",{className:"text-2xl font-bold",children:[t.duration_min||"-"," min"]})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Be,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Pr贸g zaliczenia"})]}),e.jsxs("p",{className:"text-2xl font-bold",children:[t.passing_score||70,"%"]})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(vw,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Limit czasu"})]}),e.jsx("p",{className:"text-2xl font-bold",children:t.time_limit?`${t.time_limit} min`:"Brak"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(pr,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Liczba pr贸b"})]}),e.jsx("p",{className:"text-2xl font-bold",children:t.max_attempts||"Bez limitu"})]})]})})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Pytania (",s,")"]}),s>0&&e.jsxs(M,{size:"sm",variant:"outline",onClick:()=>r(t.id),children:[e.jsx(ks,{className:"w-3 h-3 mr-1"}),"Zarzdzaj"]})]})}),e.jsx(E,{children:s===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Re,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground/30"}),e.jsx("p",{className:"text-lg font-medium text-muted-foreground mb-2",children:"Ten quiz nie ma jeszcze pyta"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"Dodaj pytania, aby uczniowie mogli rozwiza quiz"}),e.jsxs(M,{onClick:()=>r(t.id),children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Dodaj pierwsze pytanie"]})]}):i?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})}):e.jsx("div",{className:"space-y-2",children:n?.map((l,c)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg border bg-card hover:bg-muted/50 transition-colors",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center text-sm font-semibold",children:c+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[l.type==="single_choice"&&e.jsxs(V,{variant:"outline",className:"text-xs",children:[e.jsx(Rt,{className:"w-3 h-3 mr-1"}),"Jednokrotny wyb贸r"]}),l.type==="multiple_choice"&&e.jsxs(V,{variant:"outline",className:"text-xs",children:[e.jsx(Ys,{className:"w-3 h-3 mr-1"}),"Wielokrotny wyb贸r"]}),l.type==="true_false"&&e.jsxs(V,{variant:"outline",className:"text-xs",children:[e.jsx(Me,{className:"w-3 h-3 mr-1"}),"Prawda/Fasz"]}),e.jsxs(V,{variant:"secondary",className:"text-xs",children:[l.points," pkt"]})]}),e.jsx("p",{className:"text-sm font-medium line-clamp-2",children:l.content}),l.explanation&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-1",children:[e.jsx("span",{className:"font-medium",children:"Wyjanienie:"})," ",l.explanation]})]})]},l.id))})})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(I,{children:[e.jsx(F,{className:"pb-3",children:e.jsx($,{className:"text-base",children:"Statystyki"})}),e.jsx(E,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Liczba pyta"}),e.jsx("span",{className:"font-medium",children:s})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Maksymalna liczba punkt贸w"}),e.jsx("span",{className:"font-medium",children:a})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Wymagane punkty do zaliczenia"}),e.jsx("span",{className:"font-medium",children:o})]})]})})]}),e.jsxs(I,{children:[e.jsx(F,{className:"pb-3",children:e.jsx($,{className:"text-base",children:"Informacje"})}),e.jsx(E,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Pozycja w temacie"}),e.jsx("span",{className:"font-medium",children:t.position})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Data utworzenia"}),e.jsx("span",{className:"font-medium",children:new Date(t.created_at).toLocaleDateString("pl-PL")})]}),t.updated_at&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ostatnia aktualizacja"}),e.jsx("span",{className:"font-medium",children:new Date(t.updated_at).toLocaleDateString("pl-PL")})]})]})})]})]})]})},B2=()=>{const{edit:t}=ct(),{id:s}=Ct(),n=ae(),{data:i,isLoading:r}=Xe({resource:"activities",id:s,meta:{select:"*, topics(*, courses(*)), questions:questions(count)"}}),{data:a,isLoading:o}=Z({resource:"questions",filters:[{field:"activity_id",operator:"eq",value:parseInt(s)}],sorters:[{field:"position",order:"asc"}],queryOptions:{enabled:i?.data?.type==="quiz"&&!!s}});if(r)return e.jsx(H,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const l=i?.data;if(!l)return e.jsx(H,{children:e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Nie znaleziono aktywnoci"})})});const c=l.topics,d=c?.courses,u=l.questions?.[0]?.count||l._count?.questions||0,m=()=>{const g=window.location.pathname+window.location.search;sessionStorage.setItem("returnUrl",g),t("activities",l.id??"")},h=g=>{const j=window.location.pathname+window.location.search;sessionStorage.setItem("returnUrl",j),n(g)},y=()=>l.type==="quiz"?e.jsx(Re,{className:"w-5 h-5"}):e.jsx(zt,{className:"w-5 h-5"}),x=()=>l.type==="quiz"?"text-blue-500":"text-green-500";return e.jsxs(H,{children:[e.jsx(An,{}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"text-sm text-muted-foreground mb-2",children:[d?.title,"  Temat ",c?.position,": ",c?.title]}),e.jsxs(J,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg bg-muted ${x()}`,children:y()}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:l.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(V,{variant:l.type==="quiz"?"default":"secondary",children:l.type==="quiz"?"Quiz":"Materia"}),e.jsx(V,{variant:l.is_published?"default":"outline",children:l.is_published?e.jsxs(e.Fragment,{children:[e.jsx(Je,{className:"w-3 h-3 mr-1"})," Opublikowany"]}):e.jsxs(e.Fragment,{children:[e.jsx(dn,{className:"w-3 h-3 mr-1"})," Szkic"]})})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[l.type==="quiz"&&e.jsxs(M,{variant:"outline",onClick:()=>h(`/teacher/questions/manage/${l.id}`),children:[e.jsx(Ys,{className:"w-4 h-4 mr-2"}),"Zarzdzaj pytaniami (",u,")"]}),e.jsxs(M,{onClick:m,children:[e.jsx(ks,{className:"w-4 h-4 mr-2"}),"Edytuj"]})]})]})]}),l.type==="material"?e.jsx(F2,{activity:l}):e.jsx(q2,{activity:l,questionsCount:u,questionsData:a?.data,questionsLoading:o,onNavigateToQuestions:g=>h(`/teacher/questions/manage/${g}`)})]})},Ku={name:"activities",list:"/teacher/activities/create",create:"/teacher/activities/create",edit:"/teacher/activities/edit/:id",show:"/teacher/activities/show/:id",meta:{hide:!0}},U2=[e.jsx(K,{path:"activities/create",element:e.jsx(O2,{})},"activities-create"),e.jsx(K,{path:"activities/edit/:id",element:e.jsx($2,{})},"activities-edit"),e.jsx(K,{path:"activities/show/:id",element:e.jsx(B2,{})},"activities-show")],V2=()=>{const{create:t,edit:s,show:n}=ct(),i=ae(),{mutate:r}=Is(),{tableQuery:{data:a,isLoading:o,isError:l,refetch:c},current:d,setCurrent:u,pageSize:m,setFilters:h}=Yh({sorters:{initial:[{field:"created_at",order:"desc"}]},meta:{select:"*, group_members(count), course_access(count)"}}),y=xc({isLoading:o,isError:l});if(y)return y;const x=(b,v)=>{confirm(`Czy na pewno chcesz usun grup "${v}"? Ta akcja usunie r贸wnie偶 wszystkie przypisania uczni贸w i kurs贸w.`)&&r({resource:"groups",id:b},{onSuccess:()=>{Y.success("Grupa zostaa usunita"),c()},onError:()=>{Y.error("Bd podczas usuwania grupy")}})},g=(b,v)=>{v?.stopPropagation(),i(`/teacher/groups/${b}/assign-courses`)},j=(b,v)=>{v?.stopPropagation(),i(`/teacher/groups/${b}/assign-students`)},w=b=>!b||!Array.isArray(b)||b.length===0?0:b[0].count||0;return e.jsxs(H,{children:[e.jsxs(J,{children:[e.jsx(ue,{title:"Grupy",description:"Zarzdzaj grupami uczni贸w i przypisuj im kursy"}),e.jsxs(M,{onClick:()=>t("groups"),children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Dodaj grup"]})]}),e.jsx(J,{children:e.jsx(Q,{placeholder:"Szukaj grup...",className:"max-w-sm",onChange:b=>{h([{field:"name",operator:"contains",value:b.target.value}])}})}),a?.data?.length===0?e.jsx(I,{className:"border-dashed border-2",children:e.jsxs(E,{className:"text-center py-12",children:[e.jsx(de,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Brak grup"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Utw贸rz pierwsz grup, aby m贸c przypisywa uczni贸w do kurs贸w"}),e.jsxs(M,{onClick:()=>t("groups"),children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Utw贸rz pierwsz grup"]})]})}):e.jsx(yt,{children:a?.data?.map(b=>{const v=w(b.group_members),C=w(b.course_access);return e.jsxs(I,{className:"cursor-pointer transition-all hover:shadow-lg hover:border-primary/50 relative overflow-hidden",onClick:_=>{!_.target.closest('[role="menu"]')&&!_.target.closest(".quick-action")&&n("groups",b.id)},children:[!b.is_active&&e.jsx("div",{className:"absolute inset-0 bg-muted/50 z-10 pointer-events-none"}),e.jsx(F,{children:e.jsxs(J,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"truncate",children:b.name})]}),e.jsxs(Ni,{children:[e.jsx(ki,{asChild:!0,children:e.jsx(M,{variant:"ghost",size:"sm",onClick:_=>_.stopPropagation(),className:"relative z-20",children:e.jsx(eo,{className:"h-4 w-4"})})}),e.jsxs(Tn,{align:"end",children:[e.jsxs(ve,{onClick:()=>n("groups",b.id),children:[e.jsx(Je,{className:"mr-2 h-4 w-4"}),"Podgld"]}),e.jsxs(ve,{onClick:()=>s("groups",b.id),children:[e.jsx(ks,{className:"mr-2 h-4 w-4"}),"Edytuj"]}),e.jsx(jt,{}),e.jsxs(ve,{onClick:_=>j(b.id,_),className:"text-blue-600 focus:text-blue-600",children:[e.jsx(Es,{className:"mr-2 h-4 w-4"}),"Dodaj uczni贸w"]}),e.jsxs(ve,{onClick:_=>g(b.id,_),className:"text-green-600 focus:text-green-600",children:[e.jsx(ye,{className:"mr-2 h-4 w-4"}),"Przypisz kursy"]}),e.jsx(jt,{}),e.jsxs(ve,{onClick:()=>x(b.id,b.name),className:"text-red-600 focus:text-red-600",children:[e.jsx(Ft,{className:"mr-2 h-4 w-4"}),"Usu"]})]})]})]})}),e.jsx(E,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(js,{className:"w-4 h-4"}),e.jsxs("span",{children:["Rok akademicki: ",b.academic_year]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-background rounded-md",children:e.jsx(de,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Uczniowie"}),e.jsx("p",{className:"text-lg font-semibold",children:v})]})]})}),e.jsx("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-background rounded-md",children:e.jsx(ye,{className:"w-4 h-4 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Kursy"}),e.jsx("p",{className:"text-lg font-semibold",children:C})]})]})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsx(V,{variant:b.is_active?"default":"secondary",className:b.is_active?"bg-green-600":"",children:b.is_active?"Aktywna":"Nieaktywna"}),e.jsxs("div",{className:"flex gap-1",children:[v===0&&e.jsx(M,{size:"sm",variant:"ghost",className:"h-8 px-2 quick-action text-blue-600 hover:text-blue-700 hover:bg-blue-50",onClick:_=>j(b.id,_),title:"Dodaj uczni贸w",children:e.jsx(Es,{className:"h-4 w-4"})}),e.jsxs(M,{size:"sm",variant:"ghost",className:"h-8 px-2 quick-action text-green-600 hover:text-green-700 hover:bg-green-50",onClick:_=>g(b.id,_),title:"Przypisz kursy",children:[e.jsx(ye,{className:"h-4 w-4"}),e.jsx(He,{className:"h-3 w-3 ml-1"})]})]})]})]})})]},b.id)})}),e.jsx(Cp,{current:d,pageSize:m,total:a?.total||0,setCurrent:u,itemName:"grup"})]})},K2=()=>{const{list:t}=ct(),{data:s}=Ze(),{refineCore:{onFinish:n},register:i,handleSubmit:r,setValue:a,watch:o,formState:{errors:l,isSubmitting:c}}=ln({defaultValues:{name:"",vendor_id:s?.vendor_id||0,is_active:!0,academic_year:new Date().getFullYear().toString()+"/"+(new Date().getFullYear()+1).toString()}});return e.jsxs(H,{children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>t("groups"),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Powr贸t do listy"]}),e.jsx(J,{children:e.jsx(ue,{title:"Dodaj grup",description:"Utw贸rz now grup uczni贸w"})}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Informacje o grupie"})}),e.jsx(E,{children:e.jsxs(mn,{onSubmit:r(n),children:[e.jsx(re,{label:"Nazwa grupy",htmlFor:"name",error:l.name?.message?.toString(),required:!0,children:e.jsx(Q,{id:"name",placeholder:"np. Klasa 1A",...i("name",{required:"Nazwa grupy jest wymagana",minLength:{value:2,message:"Nazwa musi mie minimum 2 znaki"}})})}),e.jsx(re,{label:"Rok akademicki",htmlFor:"academic_year",error:l.academic_year?.message?.toString(),required:!0,children:e.jsx(Q,{id:"academic_year",placeholder:"np. 2024/2025",...i("academic_year",{required:"Rok akademicki jest wymagany",pattern:{value:/^\d{4}\/\d{4}$/,message:"Format: RRRR/RRRR (np. 2024/2025)"}})})}),e.jsx(re,{label:"Status grupy",children:e.jsxs(J,{variant:"start",children:[e.jsx(qt,{checked:o("is_active"),onCheckedChange:d=>a("is_active",d)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Grupa aktywna"})]})}),e.jsxs(hn,{children:[e.jsx(M,{type:"button",variant:"outline",onClick:()=>t("groups"),children:"Anuluj"}),e.jsx(M,{type:"submit",disabled:c,children:c?"Tworzenie...":"Utw贸rz grup"})]})]})})]})]})},W2=()=>{const{list:t}=ct(),{id:s}=Ct(),{data:n,isLoading:i}=Xe({resource:"groups",id:s,liveMode:"off"}),{refineCore:{onFinish:r},register:a,handleSubmit:o,setValue:l,watch:c,reset:d,formState:{errors:u,isSubmitting:m}}=ln({refineCoreProps:{resource:"groups",id:s,redirect:"list",liveMode:"off"}});return f.useEffect(()=>{n?.data&&d({name:n.data.name,academic_year:n.data.academic_year,is_active:n.data.is_active,vendor_id:n.data.vendor_id})},[n,d]),i?e.jsx(H,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):e.jsxs(H,{children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>t("groups"),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Powr贸t do listy"]}),e.jsx(J,{children:e.jsx(ue,{title:"Edytuj grup",description:`Edycja: ${n?.data?.name}`})}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Informacje o grupie"})}),e.jsx(E,{children:e.jsxs(mn,{onSubmit:o(r),children:[e.jsx(re,{label:"Nazwa grupy",htmlFor:"name",error:u.name?.message,required:!0,children:e.jsx(Q,{id:"name",placeholder:"np. Klasa 1A",...a("name",{required:"Nazwa grupy jest wymagana",minLength:{value:2,message:"Nazwa musi mie minimum 2 znaki"}})})}),e.jsx(re,{label:"Rok akademicki",htmlFor:"academic_year",error:u.academic_year?.message,required:!0,children:e.jsx(Q,{id:"academic_year",placeholder:"np. 2024/2025",...a("academic_year",{required:"Rok akademicki jest wymagany",pattern:{value:/^\d{4}\/\d{4}$/,message:"Format: RRRR/RRRR (np. 2024/2025)"}})})}),e.jsx(re,{label:"Status grupy",children:e.jsxs(J,{variant:"start",children:[e.jsx(qt,{checked:c("is_active"),onCheckedChange:h=>l("is_active",h)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Grupa aktywna"})]})}),e.jsxs(hn,{children:[e.jsx(M,{type:"button",variant:"outline",onClick:()=>t("groups"),children:"Anuluj"}),e.jsx(M,{type:"submit",disabled:m,children:m?"Zapisywanie...":"Zapisz zmiany"})]})]})})]})]})},G2=()=>{const{list:t,edit:s,show:n}=ct(),{id:i}=Ct(),r=ae(),a=Jh(),{data:o,isLoading:l}=Xe({resource:"groups",id:i,liveMode:"off"}),{data:c,isLoading:d}=Z({resource:"group_members",filters:[{field:"group_id",operator:"eq",value:i}],meta:{select:"*, users(*)"},queryOptions:{enabled:!!i},liveMode:"off"}),{data:u,isLoading:m}=Z({resource:"course_access",filters:[{field:"group_id",operator:"eq",value:i}],meta:{select:"*, courses(*)"},queryOptions:{enabled:!!i},liveMode:"off"}),h=async(w,b)=>{if(confirm(`Czy na pewno chcesz odpi kurs "${b}" od tej grupy?`))try{const{error:v}=await X.from("course_access").delete().eq("course_id",w).eq("group_id",parseInt(i));if(v)throw v;Y.success("Kurs zosta odpity od grupy"),a({resource:"course_access",invalidates:["list"]})}catch(v){console.error("Error removing course:",v),Y.error("Bd podczas odpinania kursu")}},y=async(w,b)=>{if(confirm(`Czy na pewno chcesz usun "${b}" z tej grupy?`))try{const{error:v}=await X.from("group_members").delete().eq("user_id",w).eq("group_id",parseInt(i));if(v)throw v;Y.success("Ucze zosta usunity z grupy"),a({resource:"group_members",invalidates:["list"]})}catch(v){console.error("Error removing member:",v),Y.error("Bd podczas usuwania ucznia z grupy")}};if(l||d||m)return e.jsx(H,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const x=o?.data,g=c?.total||0,j=u?.total||0;return e.jsxs(H,{children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>t("groups"),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Powr贸t do listy"]}),e.jsxs(J,{children:[e.jsxs("div",{children:[e.jsx(ue,{title:x?.name,description:`Rok akademicki: ${x?.academic_year}`}),!x?.is_active&&e.jsx(V,{variant:"secondary",className:"mt-2",children:"Grupa nieaktywna"})]}),e.jsxs(M,{onClick:()=>s("groups",x?.id??""),children:[e.jsx(ks,{className:"w-4 h-4 mr-2"}),"Edytuj grup"]})]}),!x?.is_active&&e.jsxs(he,{children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsx(pe,{children:"Ta grupa jest nieaktywna. Uczniowie nie maj dostpu do przypisanych kurs贸w."})]}),e.jsxs(yt,{variant:"2-2-4",children:[e.jsxs(I,{children:[e.jsx(F,{className:"pb-2",children:e.jsx($,{className:"text-sm font-medium",children:"Status"})}),e.jsx(E,{children:e.jsx(V,{variant:x?.is_active?"default":"secondary",className:x?.is_active?"bg-green-600":"",children:x?.is_active?"Aktywna":"Nieaktywna"})})]}),e.jsxs(I,{children:[e.jsx(F,{className:"pb-2",children:e.jsx($,{className:"text-sm font-medium",children:"Uczniowie"})}),e.jsx(E,{children:e.jsx("div",{className:"text-2xl font-bold",children:g})})]}),e.jsxs(I,{children:[e.jsx(F,{className:"pb-2",children:e.jsx($,{className:"text-sm font-medium",children:"Kursy"})}),e.jsx(E,{children:e.jsx("div",{className:"text-2xl font-bold",children:j})})]}),e.jsxs(I,{children:[e.jsx(F,{className:"pb-2",children:e.jsx($,{className:"text-sm font-medium",children:"Utworzono"})}),e.jsx(E,{children:e.jsx("div",{className:"text-sm",children:new Date(x?.created_at).toLocaleDateString("pl-PL")})})]})]}),e.jsxs(yt,{variant:"1-2-2",children:[e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs(J,{children:[e.jsx($,{children:"Uczniowie grupy"}),e.jsxs(M,{size:"sm",onClick:()=>r(`/teacher/groups/${i}/assign-students`),children:[e.jsx(Es,{className:"w-4 h-4 mr-2"}),"Dodaj ucznia"]})]})}),e.jsx(E,{children:c?.data?.length?e.jsx("div",{className:"space-y-2",children:c.data.map(w=>e.jsx("div",{className:"p-4 border rounded-lg hover:bg-muted/30 transition-all duration-200 group",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-muted/50 flex items-center justify-center flex-shrink-0",children:e.jsx(de,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-base leading-tight truncate pr-2",children:w.users?.full_name}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(Qa,{className:"h-3.5 w-3.5 text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:w.users?.email})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(Ts,{children:e.jsxs(As,{children:[e.jsx(Ds,{asChild:!0,children:e.jsx(M,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>n("users",w.user_id),children:e.jsx(Ud,{className:"h-4 w-4"})})}),e.jsx(us,{children:e.jsx("p",{children:"Zobacz profil"})})]})}),e.jsx(Ts,{children:e.jsxs(As,{children:[e.jsx(Ds,{asChild:!0,children:e.jsx(M,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-red-50",onClick:()=>y(w.user_id,w.users?.full_name),children:e.jsx(Ft,{className:"h-4 w-4 text-red-600"})})}),e.jsx(us,{children:e.jsx("p",{children:"Usu z grupy"})})]})})]})]})},w.user_id))}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(de,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Brak uczni贸w w grupie"}),e.jsxs(M,{size:"sm",variant:"outline",className:"mt-4",onClick:()=>r(`/teacher/groups/${i}/assign-students`),children:[e.jsx(Es,{className:"w-4 h-4 mr-2"}),"Dodaj pierwszego ucznia"]})]})})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs(J,{children:[e.jsx($,{children:"Przypisane kursy"}),e.jsxs(M,{size:"sm",onClick:()=>r(`/teacher/groups/${i}/assign-courses`),children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Przypisz kurs"]})]})}),e.jsx(E,{children:u?.data?.length?e.jsx("div",{className:"space-y-2",children:u.data.map(w=>e.jsx("div",{className:"p-4 border rounded-lg hover:bg-muted/30 transition-all duration-200 group",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:w.courses?.icon_emoji?e.jsx("div",{className:"h-10 w-10 rounded-lg bg-muted/50 flex items-center justify-center",children:e.jsx("span",{className:"text-xl",children:w.courses.icon_emoji})}):e.jsx("div",{className:"h-10 w-10 rounded-lg bg-muted/50 flex items-center justify-center",children:e.jsx(ye,{className:"h-5 w-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-base leading-tight truncate pr-2",children:w.courses?.title}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(js,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:new Date(w.assigned_at).toLocaleDateString("pl-PL")})]}),e.jsx(V,{variant:w.courses?.is_published?"default":"secondary",className:`text-xs ${w.courses?.is_published?"bg-green-100 text-green-700 hover:bg-green-100":""}`,children:w.courses?.is_published?"Opublikowany":"Szkic"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(Ts,{children:e.jsxs(As,{children:[e.jsx(Ds,{asChild:!0,children:e.jsx(M,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>n("courses",w.course_id),children:e.jsx(Ud,{className:"h-4 w-4"})})}),e.jsx(us,{children:e.jsx("p",{children:"Zobacz kurs"})})]})}),e.jsx(Ts,{children:e.jsxs(As,{children:[e.jsx(Ds,{asChild:!0,children:e.jsx(M,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-red-50",onClick:()=>h(w.course_id,w.courses?.title),children:e.jsx(Ft,{className:"h-4 w-4 text-red-600"})})}),e.jsx(us,{children:e.jsx("p",{children:"Odepnij kurs"})})]})})]})]})},w.course_id))}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ye,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Brak przypisanych kurs贸w"}),e.jsxs(M,{size:"sm",variant:"outline",className:"mt-4",onClick:()=>r(`/teacher/groups/${i}/assign-courses`),children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Przypisz pierwszy kurs"]})]})})]})]})]})},Z2=()=>{const{id:t}=Ct(),s=ae(),[n,i]=f.useState([]),[r,a]=f.useState(""),[o,l]=f.useState(!1),{data:c,isLoading:d}=Xe({resource:"groups",id:t}),{data:u,isLoading:m}=Z({resource:"courses",pagination:{mode:"off"},meta:{select:"*, topics(count)"}}),{data:h,isLoading:y}=Z({resource:"course_access",filters:[{field:"group_id",operator:"eq",value:parseInt(t)}],pagination:{mode:"off"},meta:{select:"course_id, group_id"}}),{mutate:x,isLoading:g}=Yt(),j=async()=>{if(n.length===0){Y.error("Wybierz przynajmniej jeden kurs");return}try{const p=n.map(N=>x({resource:"course_access",values:{course_id:N,group_id:parseInt(t)}},{onSuccess:()=>{console.log(`Course ${N} assigned successfully`)},onError:A=>{console.error("Error assigning course:",N,A)}}));await Promise.all(p),Y.success(`Przypisano ${n.length} ${n.length===1?"kurs":"kurs贸w"} do grupy`),s(`/groups/show/${t}`)}catch(p){Y.error("Bd podczas przypisywania kurs贸w"),console.error("Error details:",p)}};if(d||m||y)return e.jsx(H,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const w=c?.data,b=h?.data?.map(p=>p.course_id)||[];let v=u?.data?.filter(p=>!b.includes(p.id))||[];o&&(v=v.filter(p=>p.is_published));const C=v.filter(p=>p.title.toLowerCase().includes(r.toLowerCase())||p.description?.toLowerCase().includes(r.toLowerCase())),_=p=>{i(N=>N.includes(p)?N.filter(A=>A!==p):[...N,p])},S=()=>{i(C.map(p=>p.id))},z=()=>{i([])},k=v.filter(p=>p.is_published).length,T=v.length-k;return e.jsxs(H,{children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>s(`/teacher/groups/show/${t}`),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Powr贸t do grupy"]}),e.jsx(J,{children:e.jsx(ue,{title:"Przypisz kursy",description:`Przypisywanie kurs贸w do grupy: ${w?.name}`})}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs(J,{children:[e.jsxs("div",{children:[e.jsx($,{children:"Dostpne kursy"}),v.length>0&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[k," opublikowanych, ",T," szkic贸w"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>l(!o),className:o?"bg-primary text-primary-foreground":"",children:[e.jsx(Je,{className:"w-4 h-4 mr-2"}),"Tylko opublikowane"]}),e.jsxs(M,{variant:"outline",size:"sm",onClick:S,disabled:C.length===0,children:[e.jsx(rt,{className:"w-4 h-4 mr-2"}),"Zaznacz wszystkie"]}),e.jsxs(M,{variant:"outline",size:"sm",onClick:z,disabled:n.length===0,children:[e.jsx(Jt,{className:"w-4 h-4 mr-2"}),"Odznacz wszystkie"]})]})]})}),e.jsxs(E,{children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx(In,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(Q,{placeholder:"Szukaj kurs贸w po nazwie lub opisie...",value:r,onChange:p=>a(p.target.value),className:"pl-10"})]}),C.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:v.length===0?e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{className:"font-medium mb-1",children:"Wszystkie kursy s ju偶 przypisane"}),e.jsx("p",{className:"text-sm",children:"Ta grupa ma dostp do wszystkich dostpnych kurs贸w"}),e.jsx(M,{size:"sm",variant:"outline",className:"mt-4",onClick:()=>s("/courses"),children:"Przejd藕 do listy kurs贸w"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Nie znaleziono kurs贸w speniajcych kryteria"})]})}):e.jsx("div",{className:"space-y-2",children:C.map(p=>{const N=p._count?.topics||0;return e.jsxs("div",{className:`
                      flex items-center space-x-3 p-3 border rounded-lg 
                      cursor-pointer transition-all
                      ${n.includes(p.id)?"border-primary bg-primary/5":"hover:bg-muted/50"}
                    `,onClick:()=>_(p.id),children:[e.jsx(Ge,{checked:n.includes(p.id),onCheckedChange:()=>_(p.id),onClick:A=>A.stopPropagation()}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[p.icon_emoji&&e.jsx("span",{className:"text-xl",children:p.icon_emoji}),e.jsx("span",{className:"font-medium",children:p.title}),e.jsx(V,{variant:p.is_published?"default":"secondary",className:"text-xs",children:p.is_published?"Opublikowany":"Szkic"})]}),p.description&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:p.description}),e.jsx("div",{className:"flex items-center gap-4 mt-2 text-xs text-muted-foreground",children:e.jsxs("span",{children:[N," ",N===1?"temat":"temat贸w"]})})]}),e.jsx(Ts,{children:e.jsxs(As,{children:[e.jsx(Ds,{asChild:!0,children:e.jsx(M,{size:"sm",variant:"ghost",onClick:A=>{A.stopPropagation(),s(`/courses/show/${p.id}`)},children:e.jsx(Je,{className:"h-4 w-4"})})}),e.jsx(us,{children:e.jsx("p",{children:"Zobacz kurs"})})]})})]},p.id)})}),n.length>0&&e.jsxs("div",{className:"mt-6 p-4 bg-muted rounded-lg",children:[e.jsxs("p",{className:"text-sm text-muted-foreground mb-3",children:["Wybrano ",n.length," kurs贸w do przypisania"]}),e.jsxs(J,{children:[e.jsx(M,{variant:"outline",onClick:()=>s(`/teacher/groups/show/${t}`),children:"Anuluj"}),e.jsx(M,{onClick:j,disabled:g,children:g?"Przypisywanie...":"Przypisz kursy"})]})]})]})]})]})},H2=()=>{const{id:t}=Ct(),s=ae(),[n,i]=f.useState([]),[r,a]=f.useState(""),{data:o,isLoading:l}=Xe({resource:"groups",id:t}),{data:c,isLoading:d}=Z({resource:"users",filters:[{field:"role",operator:"eq",value:"student"}],pagination:{mode:"off"}}),{data:u,isLoading:m}=Z({resource:"group_members",filters:[{field:"group_id",operator:"eq",value:parseInt(t)}],pagination:{mode:"off"},meta:{select:"user_id, group_id"}}),{mutate:h,isLoading:y}=Yt(),x=async()=>{if(n.length===0){Y.error("Wybierz przynajmniej jednego ucznia");return}try{const S=n.map(z=>h({resource:"group_members",values:{user_id:z,group_id:parseInt(t)}},{onSuccess:()=>{console.log(`Student ${z} assigned successfully`)},onError:k=>{console.error("Error assigning student:",z,k)}}));await Promise.all(S),Y.success(`Dodano ${n.length} uczni贸w do grupy`),s(`/groups/show/${t}`)}catch(S){Y.error("Bd podczas dodawania uczni贸w"),console.error("Error details:",S)}};if(l||d||m)return e.jsx(H,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const g=o?.data,j=u?.data?.map(S=>S.user_id)||[],w=c?.data?.filter(S=>!j.includes(S.id))||[],b=w.filter(S=>S.full_name.toLowerCase().includes(r.toLowerCase())||S.email.toLowerCase().includes(r.toLowerCase())),v=S=>{i(z=>z.includes(S)?z.filter(k=>k!==S):[...z,S])},C=()=>{i(b.map(S=>S.id))},_=()=>{i([])};return e.jsxs(H,{children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>s(`/teacher/groups/show/${t}`),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Powr贸t do grupy"]}),e.jsx(J,{children:e.jsx(ue,{title:"Dodaj uczni贸w",description:`Dodawanie uczni贸w do grupy: ${g?.name}`})}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs(J,{children:[e.jsx($,{children:"Dostpni uczniowie"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:C,disabled:b.length===0,children:[e.jsx(rt,{className:"w-4 h-4 mr-2"}),"Zaznacz wszystkich"]}),e.jsxs(M,{variant:"outline",size:"sm",onClick:_,disabled:n.length===0,children:[e.jsx(Jt,{className:"w-4 h-4 mr-2"}),"Odznacz wszystkich"]})]})]})}),e.jsxs(E,{children:[e.jsx(Q,{placeholder:"Szukaj uczni贸w...",value:r,onChange:S=>a(S.target.value),className:"mb-4"}),b.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:w.length===0?e.jsxs(e.Fragment,{children:[e.jsx(Es,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Wszyscy uczniowie s ju偶 w tej grupie"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Es,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Nie znaleziono uczni贸w"})]})}):e.jsx("div",{className:"space-y-2",children:b.map(S=>e.jsxs("div",{className:"flex items-center space-x-3 p-3 border rounded-lg hover:bg-muted/50 cursor-pointer",onClick:()=>v(S.id),children:[e.jsx(Ge,{checked:n.includes(S.id),onCheckedChange:()=>v(S.id),onClick:z=>z.stopPropagation()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:S.full_name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Qa,{className:"w-3 h-3"}),S.email]})]}),e.jsx(V,{variant:"secondary",className:"text-xs",children:"Ucze"})]},S.id))}),n.length>0&&e.jsxs("div",{className:"mt-6 p-4 bg-muted rounded-lg",children:[e.jsxs("p",{className:"text-sm text-muted-foreground mb-3",children:["Wybrano ",n.length," uczni贸w do dodania"]}),e.jsxs(J,{children:[e.jsx(M,{variant:"outline",onClick:()=>s(`/teacher/groups/show/${t}`),children:"Anuluj"}),e.jsx(M,{onClick:x,disabled:y,children:y?"Dodawanie...":"Dodaj uczni贸w"})]})]})]})]})]})},Wu={name:"groups",list:"/teacher/groups",create:"/teacher/groups/create",edit:"/teacher/groups/edit/:id",show:"/teacher/groups/show/:id",meta:{label:"Grupy",icon:e.jsx(de,{className:"h-4 w-4"})}},Q2=[e.jsx(K,{path:"groups",element:e.jsx(V2,{})},"groups-list"),e.jsx(K,{path:"groups/create",element:e.jsx(K2,{})},"groups-create"),e.jsx(K,{path:"groups/edit/:id",element:e.jsx(W2,{})},"groups-edit"),e.jsx(K,{path:"groups/show/:id",element:e.jsx(G2,{})},"groups-show"),e.jsx(K,{path:"groups/:id/assign-courses",element:e.jsx(Z2,{})},"groups-assign-courses"),e.jsx(K,{path:"groups/:id/assign-students",element:e.jsx(H2,{})},"groups-assign-students")],Y2=()=>{const{show:t}=ct(),{data:s}=Ze(),[n,i]=f.useState(""),[r,a]=f.useState("all"),[o,l]=f.useState([]),[c,d]=f.useState([]),[u,m]=f.useState(!0);f.useEffect(()=>{(async()=>{if(s?.id){m(!0);try{const{data:g,error:j}=await X.from("course_access").select("course_id").eq("teacher_id",s.id);if(j)throw j;if(!g||g.length===0){l([]),d([]),m(!1);return}const w=[...new Set(g.map(N=>N.course_id))],{data:b,error:v}=await X.from("course_access").select("group_id").in("course_id",w).not("group_id","is",null);if(v)throw v;const C=[...new Set(b?.map(N=>N.group_id).filter(Boolean)||[])];if(C.length===0){l([]),d([]),m(!1);return}const{data:_,error:S}=await X.from("groups").select("*").in("id",C).order("name");if(S)throw S;const z=_?.map(N=>({id:N.id,name:N.name,academic_year:N.academic_year,vendor_id:N.vendor_id||0,is_active:N.is_active??!0,created_at:N.created_at||new Date().toISOString()}))||[];l(z);const{data:k,error:T}=await X.from("users").select(`
            *,
            user_stats(*),
            group_members!inner(
              group_id,
              user_id,
              joined_at,
              groups!inner(*)
            )
          `).in("group_members.group_id",C).eq("role","student").order("full_name");if(T)throw T;const p=k?.map(N=>({id:N.id,email:N.email,full_name:N.full_name,vendor_id:N.vendor_id,role:N.role,is_active:N.is_active,created_at:N.created_at,groups:N.group_members?.map(A=>({group_id:A.group_id,user_id:A.user_id,joined_at:A.joined_at,groups:A.groups}))||[],user_stats:N.user_stats?Array.isArray(N.user_stats)?N.user_stats:[N.user_stats]:[]}))||[];d(p)}catch(g){console.error("Error fetching students:",g),l([]),d([])}finally{m(!1)}}})()},[s]);const h=f.useMemo(()=>c.filter(x=>{const g=!n||x.full_name.toLowerCase().includes(n.toLowerCase())||x.email.toLowerCase().includes(n.toLowerCase()),j=r==="all"||x.groups?.some(w=>w.groups?.id.toString()===r);return g&&j}),[c,n,r]),y=x=>{if(!x)return{color:"text-gray-500",text:"Brak aktywnoci"};const g=Math.floor((new Date().getTime()-new Date(x).getTime())/(1e3*60*60*24));return g===0?{color:"text-green-600",text:"Dzisiaj"}:g===1?{color:"text-green-600",text:"Wczoraj"}:g<=7?{color:"text-yellow-600",text:`${g} dni temu`}:g<=30?{color:"text-orange-600",text:`${Math.floor(g/7)} tyg. temu`}:{color:"text-red-600",text:"Ponad miesic temu"}};return u?e.jsx(H,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):e.jsxs(H,{children:[e.jsx(J,{children:e.jsx(ue,{title:"Uczniowie z moich kurs贸w",description:`Uczniowie z grup kt贸re maj dostp do Twoich kurs贸w (${o.length} ${o.length===1?"grupa":o.length<5?"grupy":"grup"})`})}),e.jsxs(J,{className:"gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(In,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(Q,{placeholder:"Szukaj ucznia...",className:"pl-10",value:n,onChange:x=>i(x.target.value)})]}),o.length>0&&e.jsxs(ge,{value:r,onValueChange:a,children:[e.jsx(fe,{className:"w-[200px]",children:e.jsx(je,{placeholder:"Filtruj po grupie"})}),e.jsxs(xe,{children:[e.jsx(W,{value:"all",children:"Wszystkie grupy"}),o.map(x=>e.jsxs(W,{value:x.id.toString(),children:[x.name," (",x.academic_year,")"]},x.id))]})]})]}),o.length===0?e.jsx(I,{children:e.jsxs(E,{className:"p-12 text-center",children:[e.jsx(Me,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Nie masz przypisanych kurs贸w"}),e.jsx("p",{className:"text-muted-foreground",children:'Popro administratora o przypisanie Ci do kurs贸w. Administrator mo偶e to zrobi w module "Zarzdzanie dostpem"  "Dostp do kurs贸w"'})]})}):h.length===0&&c.length===0?e.jsx(I,{children:e.jsxs(E,{className:"p-12 text-center",children:[e.jsx(de,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Brak uczni贸w w grupach z Twoimi kursami"}),e.jsx("p",{className:"text-muted-foreground",children:"Uczniowie pojawi si tutaj, gdy administrator przypisze grupy do Twoich kurs贸w"})]})}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:[h.map(x=>{const g=x.user_stats?.[0],j=y(g?.last_active);return e.jsx(I,{className:"hover:shadow-md transition-shadow",children:e.jsxs(E,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(Nw,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm",children:x.full_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:x.email})]})]}),e.jsx(M,{variant:"ghost",size:"sm",onClick:()=>t("users",x.id),children:e.jsx(Je,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(de,{className:"w-3 h-3"}),"Grupa"]}),e.jsxs("div",{className:"flex gap-1 flex-wrap justify-end",children:[x.groups?.slice(0,2).map(w=>e.jsx(V,{variant:"outline",className:"text-xs",children:w.groups?.name},w.groups?.id)),x.groups?.length>2&&e.jsxs(V,{variant:"outline",className:"text-xs",children:["+",x.groups.length-2]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(qe,{className:"w-3 h-3"}),"Punkty"]}),e.jsxs("span",{className:"font-medium",children:[g?.total_points||0,e.jsxs("span",{className:"text-xs text-muted-foreground ml-1",children:["(poz. ",g?.current_level||1,")"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(gi,{className:"w-3 h-3"}),"Quizy"]}),e.jsx("span",{className:"font-medium",children:g?.quizzes_completed||0})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(et,{className:"w-3 h-3"}),"Aktywno"]}),e.jsx("span",{className:`font-medium ${j.color}`,children:j.text})]}),g&&g.daily_streak>0&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(xt,{className:"w-3 h-3"}),"Seria dni"]}),e.jsxs("span",{className:"font-medium text-orange-600",children:[" ",g.daily_streak]})]})]}),j.color==="text-red-600"&&e.jsx("div",{className:"mt-3 pt-3 border-t",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs text-orange-600",children:[e.jsx(Me,{className:"w-3 h-3"}),e.jsx("span",{children:"Ucze mo偶e potrzebowa wsparcia"})]})})]})},x.id)}),h.length===0&&c.length>0&&e.jsx(I,{className:"col-span-full",children:e.jsxs(E,{className:"p-12 text-center",children:[e.jsx(de,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Nie znaleziono uczni贸w speniajcych kryteria"})]})})]})]})},J2=()=>{const{list:t}=ct(),{id:s}=Ct(),{data:n}=Ze(),[i,r]=f.useState([]),[a,o]=f.useState([]),[l,c]=f.useState(!0),[d,u]=f.useState(null);if(f.useEffect(()=>{(async()=>{if(s){c(!0);try{const{data:b,error:v}=await X.from("users").select(`
            *,
            user_stats(*),
            group_members(
              group_id,
              user_id,
              joined_at,
              groups(*)
            )
          `).eq("id",s).single();if(v)throw v;if(b){const C={id:b.id,email:b.email,full_name:b.full_name,vendor_id:b.vendor_id,role:b.role,is_active:b.is_active,created_at:b.created_at,groups:b.group_members?.map(_=>({group_id:_.group_id,user_id:_.user_id,joined_at:_.joined_at,groups:_.groups}))||[],user_stats:b.user_stats?Array.isArray(b.user_stats)?b.user_stats:[b.user_stats]:[]};u(C)}}catch(b){console.error("Error fetching student data:",b)}finally{c(!1)}}})()},[s]),f.useEffect(()=>{(async()=>{if(!(!s||!n?.id))try{const{data:b}=await X.from("course_access").select("course_id").eq("teacher_id",n.id);if(!b||b.length===0)return;const v=b.map(S=>S.course_id),{data:C}=await X.from("courses").select(`
            id,
            title,
            topics!inner(
              id,
              title,
              activities!inner(
                id,
                type,
                activity_progress!left(
                  completed_at,
                  score,
                  attempts,
                  time_spent
                )
              )
            )
          `).in("id",v).eq("topics.activities.activity_progress.user_id",s);if(C){const S=C.map(z=>{let k=0,T=0,p=0,N=0,A=0,D=0,P=null;return z.topics?.forEach(R=>{R.activities?.forEach(q=>{k++;const L=q.activity_progress?.[0];L?.completed_at&&(T++,(!P||new Date(L.completed_at)>new Date(P))&&(P=L.completed_at)),q.type==="quiz"&&L?.score!==null&&(p+=L.score,N++,L.score>=70?A++:L.attempts>0&&D++)})}),{course_id:z.id,course_title:z.title,total_activities:k,completed_activities:T,avg_score:N>0?Math.round(p/N):0,quizzes_passed:A,quizzes_failed:D,last_activity:P||""}});r(S)}const{data:_}=await X.from("activity_progress").select(`
            *,
            activities(
              id,
              title,
              type,
              topics(
                title,
                courses(title)
              )
            )
          `).eq("user_id",s).order("completed_at",{ascending:!1,nullsFirst:!1}).limit(10);_&&o(_)}catch(b){console.error("Error fetching student progress:",b)}})()},[s,n]),l)return e.jsx(H,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const m=d,h=m?.user_stats?.[0],y=w=>w>=80?"text-green-600":w>=60?"text-yellow-600":"text-red-600",x=w=>w==="quiz"?"":"",g=w=>{const b=Math.floor(w/60),v=w%60;return b>0?`${b}h ${v}min`:`${v}min`},j=w=>{if(!w)return"text-gray-500";const b=Math.floor((new Date().getTime()-new Date(w).getTime())/(1e3*60*60*24));return b===0?"text-green-600":b<=7?"text-yellow-600":b<=30?"text-orange-600":"text-red-600"};return e.jsxs(H,{children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>t("users"),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Powr贸t do listy"]}),e.jsx(J,{children:e.jsxs("div",{children:[e.jsx(ue,{title:m?.full_name||"",description:m?.email||""}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[m?.groups?.map(w=>e.jsxs(V,{variant:"outline",children:[e.jsx(de,{className:"w-3 h-3 mr-1"}),w.groups?.name," (",w.groups?.academic_year,")"]},w.groups?.id)),!m?.is_active&&e.jsx(V,{variant:"destructive",children:"Nieaktywny"})]})]})}),e.jsxs(yt,{children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(ji,{className:"w-5 h-5"}),"Podsumowanie postp贸w"]})}),e.jsxs(E,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg",children:[e.jsx(qe,{className:"w-8 h-8 mx-auto mb-2 text-blue-600"}),e.jsx("p",{className:"text-2xl font-bold",children:h?.total_points||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Punkty"})]}),e.jsxs("div",{className:"text-center p-4 bg-purple-50 dark:bg-purple-950/20 rounded-lg",children:[e.jsx(Be,{className:"w-8 h-8 mx-auto mb-2 text-purple-600"}),e.jsx("p",{className:"text-2xl font-bold",children:h?.current_level||1}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Poziom"})]}),e.jsxs("div",{className:"text-center p-4 bg-green-50 dark:bg-green-950/20 rounded-lg",children:[e.jsx(Ls,{className:"w-8 h-8 mx-auto mb-2 text-green-600"}),e.jsx("p",{className:"text-2xl font-bold",children:h?.quizzes_completed||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ukoczone quizy"})]}),e.jsxs("div",{className:"text-center p-4 bg-orange-50 dark:bg-orange-950/20 rounded-lg",children:[e.jsx(xt,{className:"w-8 h-8 mx-auto mb-2 text-orange-600"}),e.jsx("p",{className:"text-2xl font-bold",children:h?.daily_streak||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Dni z rzdu"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 pt-4 border-t",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Perfekcyjne wyniki"}),e.jsxs("p",{className:"text-lg font-semibold text-green-600",children:[h?.perfect_scores||0,h&&h.quizzes_completed>0&&e.jsxs("span",{className:"text-sm text-muted-foreground ml-1",children:["(",Math.round(h.perfect_scores/h.quizzes_completed*100),"%)"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Czas nauki"}),e.jsx("p",{className:"text-lg font-semibold",children:h?g(h.total_time_spent):"0min"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Punkty/h (idle)"}),e.jsx("p",{className:"text-lg font-semibold",children:h?.idle_points_rate||1})]})]})]})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5"}),"Postpy w Twoich kursach"]})}),e.jsxs(E,{className:"space-y-4",children:[i.map(w=>{const b=w.total_activities>0?Math.round(w.completed_activities/w.total_activities*100):0;return e.jsxs("div",{className:"p-4 border rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold",children:w.course_title}),e.jsxs(V,{variant:b===100?"default":"outline",children:[b,"% ukoczone"]})]}),e.jsx(is,{value:b,className:"h-2"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Ukoczone"}),e.jsxs("p",{className:"font-medium",children:[w.completed_activities,"/",w.total_activities," aktywnoci"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"redni wynik"}),e.jsx("p",{className:`font-medium ${w.avg_score>0?y(w.avg_score):""}`,children:w.avg_score>0?`${w.avg_score}%`:"Brak"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Quizy"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-green-600 flex items-center",children:[e.jsx(Rt,{className:"w-3 h-3 mr-1"}),w.quizzes_passed]}),e.jsxs("span",{className:"text-red-600 flex items-center",children:[e.jsx(jl,{className:"w-3 h-3 mr-1"}),w.quizzes_failed]})]})]})]}),w.last_activity&&e.jsx("div",{className:"pt-2 border-t",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Ostatnia aktywno: ",new Date(w.last_activity).toLocaleDateString("pl-PL")]})})]},w.course_id)}),i.length===0&&e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Ucze nie rozpocz jeszcze 偶adnego z Twoich kurs贸w"})]})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Or,{className:"w-5 h-5"}),"Ostatnie aktywnoci"]})}),e.jsx(E,{children:e.jsxs("div",{className:"space-y-3",children:[a.map(w=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:w.activities&&x(w.activities.type)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:w.activities?.title}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[w.activities?.topics?.courses?.title,"  ",w.activities?.topics?.title]})]})]}),e.jsxs("div",{className:"text-right",children:[w.score!==null&&e.jsxs("p",{className:`font-medium ${y(w.score)}`,children:[w.score,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:w.completed_at?new Date(w.completed_at).toLocaleDateString("pl-PL"):new Date(w.started_at).toLocaleDateString("pl-PL")}),w.attempts>1&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Pr贸ba ",w.attempts]})]})]},`${w.user_id}-${w.activity_id}`)),a.length===0&&e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Brak aktywnoci do wywietlenia"})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs($,{className:"text-lg flex items-center gap-2",children:[e.jsx(et,{className:"w-4 h-4"}),"Czas nauki"]})}),e.jsxs(E,{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"czny czas"}),e.jsx("p",{className:"text-xl font-bold",children:h?g(h.total_time_spent):"0min"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ostatnia aktywno"}),e.jsx("p",{className:`text-sm font-medium ${j(h?.last_active)}`,children:h?.last_active?new Date(h.last_active).toLocaleDateString("pl-PL",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"Brak aktywnoci"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ostatnie pobieranie idle"}),e.jsx("p",{className:"text-sm font-medium",children:h?.last_idle_claim?new Date(h.last_idle_claim).toLocaleString("pl-PL",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Nigdy"})]})]})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs($,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ls,{className:"w-4 h-4"}),"Statystyki quiz贸w"]})}),e.jsxs(E,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Ukoczone"}),e.jsx("span",{className:"font-bold",children:h?.quizzes_completed||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Wyniki 100%"}),e.jsx("span",{className:"font-bold text-green-600",children:h?.perfect_scores||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Wsp贸czynnik"}),e.jsx("span",{className:"font-bold",children:h&&h.quizzes_completed>0?`${Math.round(h.perfect_scores/h.quizzes_completed*100)}%`:"0%"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"redni czas/quiz"}),e.jsx("span",{className:"font-bold",children:h&&h.quizzes_completed>0?g(Math.round(h.total_time_spent/h.quizzes_completed)):"0min"})]})]})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs($,{className:"text-lg flex items-center gap-2",children:[e.jsx(js,{className:"w-4 h-4"}),"Informacje"]})}),e.jsxs(E,{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Doczy"}),e.jsx("p",{className:"text-sm font-medium",children:m?.created_at&&new Date(m.created_at).toLocaleDateString("pl-PL",{year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Dni od rejestracji"}),e.jsxs("p",{className:"text-sm font-medium",children:[m?.created_at&&Math.floor((new Date().getTime()-new Date(m.created_at).getTime())/(1e3*60*60*24))," dni"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status konta"}),e.jsx("p",{className:"text-sm font-medium",children:m?.is_active?e.jsx("span",{className:"text-green-600",children:" Aktywny"}):e.jsx("span",{className:"text-red-600",children:" Nieaktywny"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Grupy"}),e.jsx("div",{className:"text-sm font-medium",children:m?.groups?.map(w=>e.jsxs("div",{children:[w.groups?.name," (",w.groups?.academic_year,")"]},w.groups?.id))})]})]})]})]})]})]})},X2={name:"users",list:"/teacher/users",show:"/teacher/users/show/:id",meta:{label:"Uczniowie",icon:e.jsx(de,{className:"h-4 w-4"})}},eC=[e.jsx(K,{path:"users",element:e.jsx(Y2,{})},"users-list"),e.jsx(K,{path:"users/show/:id",element:e.jsx(J2,{})},"users-show")],tC=t=>{const s=new Date(t);return new Date(Date.UTC(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate())).toISOString().slice(0,10)},sC=()=>{const t=ae(),s={queryOptions:{staleTime:1/0,gcTime:1800*1e3,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,refetchInterval:!1,retry:0}},{data:n}=Z({resource:"user_stats",filters:[{field:"last_active",operator:"gte",value:new Date(Date.now()-10080*60*1e3).toISOString().split("T")[0]}],pagination:{mode:"off"},...s}),{data:i}=Z({resource:"activity_progress",pagination:{mode:"off"},meta:{select:"*, activities(type, passing_score)",query:u=>u.not("completed_at","is",null)},...s}),{data:r}=Z({resource:"user_stats",pagination:{mode:"off"},sorters:[{field:"total_points",order:"desc"}],...s}),a=f.useMemo(()=>{const u=n?.data?.length||0,m=i?.data?.filter(w=>w.activities?.type==="quiz"&&w.score!==null).map(w=>Number(w.score))||[],h=m.length>0?Math.round(m.reduce((w,b)=>w+b,0)/m.length):0,y=i?.data?.length||0,x=i?.data?.filter(w=>w.completed_at).length||0,g=y>0?Math.round(x/y*100):0,j=r?.data?.reduce((w,b)=>w+Number(b.total_points),0)||0;return{activeUsers:u,activeUsersChange:12,avgQuizScore:h,avgQuizScoreChange:3,completionRate:g,completionRateChange:5,totalPoints:j,totalPointsChange:8}},[n?.data,i?.data,r?.data]),o=f.useMemo(()=>{const u=Array.from({length:7},(h,y)=>{const x=new Date;return x.setUTCDate(x.getUTCDate()-(6-y)),x.toISOString().slice(0,10)}),m=new Map;for(const h of u)m.set(h,{quizzes:0,materials:0});for(const h of i?.data||[]){if(!h?.started_at)continue;const y=tC(h.started_at);if(!m.has(y))continue;const x=m.get(y);h.activities?.type==="quiz"?x.quizzes+=1:h.activities?.type==="material"&&(x.materials+=1)}return u.map(h=>({date:new Date(h+"T00:00:00Z").toLocaleDateString("pl-PL",{weekday:"short",day:"numeric"}),quizzes:m.get(h).quizzes,materials:m.get(h).materials}))},[i?.data]),l=[{title:"Aktywni u偶ytkownicy",value:a.activeUsers,change:a.activeUsersChange,icon:de,color:"text-blue-600",bgColor:"bg-blue-50",link:"/teacher/reports/engagement"},{title:"redni wynik quiz贸w",value:`${a.avgQuizScore}%`,change:a.avgQuizScoreChange,icon:Be,color:"text-green-600",bgColor:"bg-green-50",link:"/teacher/reports/performance"},{title:"Wska藕nik ukocze",value:`${a.completionRate}%`,change:a.completionRateChange,icon:xt,color:"text-purple-600",bgColor:"bg-purple-50",link:"/teacher/reports/progress"},{title:"Suma punkt贸w",value:a.totalPoints.toLocaleString("pl-PL"),change:a.totalPointsChange,icon:qe,color:"text-orange-600",bgColor:"bg-orange-50",link:"/teacher/reports/gamification"}],c=[{to:"/teacher/reports/engagement",title:"Raport zaanga偶owania",description:"Aktywno u偶ytkownik贸w, czas nauki, trendy",icon:e.jsx(Or,{className:"h-5 w-5"}),color:"text-blue-600"},{to:"/teacher/reports/progress",title:"Raport postp贸w",description:"Postp kurs贸w, wska藕niki ukocze",icon:e.jsx(xt,{className:"h-5 w-5"}),color:"text-purple-600"},{to:"/teacher/reports/performance",title:"Raport wynik贸w",description:"Wyniki quiz贸w, najtrudniejsze pytania",icon:e.jsx(Be,{className:"h-5 w-5"}),color:"text-green-600"},{to:"/teacher/reports/gamification",title:"Raport gamifikacji",description:"Ranking punktowy, poziomy, osignicia",icon:e.jsx(qe,{className:"h-5 w-5"}),color:"text-orange-600"}],d=r?.data?.slice(0,5)||[];return e.jsxs(H,{children:[e.jsx(J,{children:e.jsx(ue,{title:"Centrum Raport贸w",description:"Kompleksowy przegld wynik贸w i postp贸w uczni贸w"})}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-6",children:l.map((u,m)=>e.jsxs(I,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>t(u.link),children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:u.title}),e.jsx("div",{className:`${u.bgColor} p-2 rounded-lg`,children:e.jsx(u.icon,{className:`h-4 w-4 ${u.color}`})})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:u.value}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e.jsxs("span",{className:u.change>0?"text-green-600":"text-red-600",children:[u.change>0?"+":"",u.change,"%"]})," ","vs. ostatnie 7 dni"]})]})]},m))}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3 mb-6",children:[e.jsxs(I,{className:"lg:col-span-2",children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Aktywno w ostatnich 7 dniach"}),e.jsx(M,{variant:"ghost",size:"sm",onClick:()=>t("/teacher/reports/engagement"),children:"Zobacz wicej "})]})}),e.jsx(E,{children:e.jsx("div",{style:{width:"100%",height:250},children:e.jsx($e,{width:"100%",height:"100%",children:e.jsxs(to,{data:o,children:[e.jsx(Lt,{strokeDasharray:"3 3"}),e.jsx(kt,{dataKey:"date"}),e.jsx(gt,{allowDecimals:!1}),e.jsx(Ve,{}),e.jsx(Xs,{type:"monotone",dataKey:"materials",stackId:"1",stroke:"#82ca9d",fill:"#82ca9d",name:"Materiay",isAnimationActive:!1,dot:!0}),e.jsx(Xs,{type:"monotone",dataKey:"quizzes",stackId:"1",stroke:"#8884d8",fill:"#8884d8",name:"Quizy",isAnimationActive:!1,dot:!0})]},`${o.map(u=>u.quizzes+u.materials).join("-")}`)})})})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Top 5 uczni贸w"}),e.jsx(qe,{className:"h-4 w-4 text-orange-600"})]})}),e.jsx(E,{children:e.jsx("div",{className:"space-y-3",children:d.map((u,m)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold
                      ${m===0?"bg-yellow-100 text-yellow-700":m===1?"bg-gray-100 text-gray-700":m===2?"bg-orange-100 text-orange-700":"bg-muted text-muted-foreground"}`,children:m+1}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium",children:["Ucze #",m+1]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Poziom ",u.current_level]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-bold",children:u.total_points}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"punkt贸w"})]})]},u.user_id))})})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Szczeg贸owe raporty"}),e.jsx(yt,{variant:"2-2-4",children:c.map(u=>e.jsxs(I,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>t(u.to),children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center gap-2 text-base",children:[e.jsx("span",{className:u.color,children:u.icon}),u.title]})}),e.jsx(E,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:u.description})})]},u.to))})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Ostatnie aktywnoci"})}),e.jsx(E,{children:e.jsx("div",{className:"space-y-2",children:i?.data?.slice(0,10).map(u=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b last:border-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{variant:u.activities?.type==="quiz"?"default":"secondary",children:u.activities?.type==="quiz"?"Quiz":"Materia"}),e.jsxs("span",{className:"text-sm",children:["Aktywno #",u.activity_id]})]}),e.jsxs("div",{className:"text-right",children:[u.score!==null&&e.jsxs("span",{className:"text-sm font-medium",children:[u.score,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(u.started_at).toLocaleDateString("pl-PL")})]})]},`${u.user_id}-${u.activity_id}`))})})]})]})},nC=()=>{const[t,s]=f.useState("7d"),[n,i]=f.useState("all"),r=ew()(),[a,o]=f.useState(!0),[l,c]=f.useState([]),[d,u]=f.useState([]),[m,h]=f.useState([]),[y,x]=f.useState([]),g=()=>{const p=new Date,N=new Date;switch(t){case"7d":N.setDate(N.getDate()-7);break;case"30d":N.setDate(N.getDate()-30);break;case"90d":N.setDate(N.getDate()-90);break}return{start:N,end:p}},{start:j,end:w}=g();f.useEffect(()=>{(async()=>{try{o(!0);const[N,A,D,P]=await Promise.all([r.getList({resource:"activity_progress",filters:[{field:"started_at",operator:"gte",value:j.toISOString()}],pagination:{mode:"off"}}),r.getList({resource:"activities",pagination:{mode:"off"},meta:{select:"id, type, topic_id"}}),r.getList({resource:"topics",pagination:{mode:"off"},meta:{select:"id, course_id"}}),r.getList({resource:"courses",filters:[{field:"is_published",operator:"eq",value:!0}],pagination:{mode:"off"}})]);c(N.data),u(A.data),h(D.data),x(P.data)}catch(N){console.error("Error fetching data:",N)}finally{o(!1)}})()},[]);const b=f.useMemo(()=>{if(!l.length||!d.length||!m.length)return[];const p=new Map(d.map(P=>[P.id,{type:P.type,topicId:P.topic_id}])),N=new Map(m.map(P=>[P.id,P.course_id])),A=l.map(P=>{const R=p.get(P.activity_id),q=R?.topicId?N.get(R.topicId):void 0;return{...P,activityType:R?.type,courseId:q}});if(n==="all")return A;const D=parseInt(n);return A.filter(P=>P.courseId===D)},[l,d,m,n]),v=f.useMemo(()=>{const p=new Set(b.map(R=>R.user_id)).size,N=b.reduce((R,q)=>R+(q.time_spent||0),0),A=p>0?(N/60/p).toFixed(1):"0",D=b.filter(R=>R.completed_at).length,P=b.length>0?Math.round(D/b.length*100):0;return{activeUsers:p,activeUsersChange:12,avgTimeHours:A,avgTimeChange:5,completedActivities:D,completedChange:18,engagementRate:P,engagementChange:3}},[b]),C=f.useMemo(()=>{const p=Math.ceil((w.getTime()-j.getTime())/864e5),N=[];for(let A=0;A<p;A++){const D=new Date(j);D.setDate(D.getDate()+A);const P=D.toISOString().split("T")[0],R=b.filter(L=>L.started_at.startsWith(P)),q=new Set(R.map(L=>L.user_id)).size;N.push({date:D.toLocaleDateString("pl-PL",{day:"numeric",month:"short"}),users:q})}return N},[b,j,w]),_=f.useMemo(()=>{const p=b.filter(D=>D.activityType==="quiz").length,N=b.filter(D=>D.activityType==="material").length;return p+N===0?[{name:"Brak danych",value:1,color:"#e5e7eb"}]:[{name:"Quizy",value:p,color:"#8884d8"},{name:"Materiay",value:N,color:"#82ca9d"}].filter(D=>D.value>0)},[b]),S=f.useMemo(()=>{const p=new Map;b.forEach(A=>{const D=p.get(A.user_id)||0;p.set(A.user_id,D+(A.time_spent||0))});const N=[{range:"0-30min",count:0,color:"#94a3b8"},{range:"30-60min",count:0,color:"#60a5fa"},{range:"1-2h",count:0,color:"#818cf8"},{range:"2-5h",count:0,color:"#a78bfa"},{range:"5h+",count:0,color:"#c084fc"}];return p.forEach(A=>{A<=30?N[0].count++:A<=60?N[1].count++:A<=120?N[2].count++:A<=300?N[3].count++:N[4].count++}),N.filter(A=>A.count>0)},[b]),z=f.useMemo(()=>{const p=Math.ceil((w.getTime()-j.getTime())/864e5),N=[];for(let A=0;A<p;A++){const D=new Date(j);D.setDate(D.getDate()+A);const P=D.toISOString().split("T")[0],R=b.filter(O=>O.started_at.startsWith(P)),q=R.filter(O=>O.completed_at).length,L=R.length,U=L>0?Math.round(q/L*100):0;N.push({date:D.toLocaleDateString("pl-PL",{day:"numeric",month:"short"}),rate:U,completed:q,total:L})}return N},[b,j,w]),k=[{label:"Aktywni u偶ytkownicy",value:v.activeUsers.toString(),icon:de,change:`+${v.activeUsersChange}%`,color:"text-blue-600",bgColor:"bg-blue-50"},{label:"redni czas nauki",value:`${v.avgTimeHours}h`,icon:et,change:`+${v.avgTimeChange}%`,color:"text-purple-600",bgColor:"bg-purple-50"},{label:"Ukoczone aktywnoci",value:v.completedActivities.toString(),icon:Or,change:`+${v.completedChange}%`,color:"text-green-600",bgColor:"bg-green-50"},{label:"Wska藕nik zaanga偶owania",value:`${v.engagementRate}%`,icon:xt,change:`+${v.engagementChange}%`,color:"text-orange-600",bgColor:"bg-orange-50"}],T=f.useMemo(()=>{if(!y.length||!b.length)return[];const p=new Map;return y.forEach(N=>{const A=typeof N.id=="number"?N.id:parseInt(N.id);isNaN(A)||p.set(A,{title:N.title||"",users:new Set,activities:0,completed:0})}),b.forEach(N=>{const A=N.courseId;if(A&&p.has(A)){const D=p.get(A);D&&(D.users.add(N.user_id),D.activities++,N.completed_at&&D.completed++)}}),Array.from(p.entries()).filter(([N,A])=>A.activities>0).map(([N,A])=>({id:N,title:A.title,users:A.users.size,activities:A.activities,completionRate:A.activities>0?Math.round(A.completed/A.activities*100):0})).sort((N,A)=>A.users-N.users).slice(0,5)},[b,y]);return a?e.jsx(H,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-muted-foreground",children:"adowanie danych..."})})}):e.jsxs(H,{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Le,{to:"/teacher/reports/overview",children:e.jsxs(M,{variant:"ghost",size:"sm",children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Powr贸t do centrum raport贸w"]})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Raport zaanga偶owania"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ge,{value:n,onValueChange:i,children:[e.jsx(fe,{className:"w-[200px]",children:e.jsx(je,{placeholder:"Wybierz kurs"})}),e.jsxs(xe,{children:[e.jsx(W,{value:"all",children:"Wszystkie kursy"}),y.map(p=>{const N=typeof p.id=="number"?p.id:parseInt(p.id);return e.jsx(W,{value:N.toString(),children:p.title},N)})]})]}),e.jsxs(ge,{value:t,onValueChange:s,children:[e.jsx(fe,{className:"w-[150px]",children:e.jsx(je,{})}),e.jsxs(xe,{children:[e.jsx(W,{value:"7d",children:"Ostatnie 7 dni"}),e.jsx(W,{value:"30d",children:"Ostatnie 30 dni"}),e.jsx(W,{value:"90d",children:"Ostatnie 90 dni"})]})]})]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-6",children:k.map((p,N)=>e.jsxs(I,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:p.label}),e.jsx("div",{className:`${p.bgColor} p-2 rounded-lg`,children:e.jsx(p.icon,{className:`h-4 w-4 ${p.color}`})})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:p.value}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"text-green-600",children:p.change})," vs. poprzedni okres"]})]})]},N))}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3 mb-6",children:[e.jsxs(I,{className:"lg:col-span-2",children:[e.jsx(F,{children:e.jsx($,{children:"Aktywni u偶ytkownicy w czasie"})}),e.jsx(E,{children:e.jsx($e,{width:"100%",height:300,children:e.jsxs(to,{data:C,children:[e.jsx(Lt,{strokeDasharray:"3 3"}),e.jsx(kt,{dataKey:"date"}),e.jsx(gt,{}),e.jsx(Ve,{}),e.jsx(Xs,{type:"monotone",dataKey:"users",stroke:"#8884d8",fill:"#8884d8",fillOpacity:.6,name:"Aktywni u偶ytkownicy",isAnimationActive:!1})]},`${C.map(p=>p.users).join("-")}`)})})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Typy aktywnoci"})}),e.jsx(E,{children:e.jsx($e,{width:"100%",height:300,children:e.jsxs(Ca,{children:[e.jsx(_a,{data:_,cx:"50%",cy:"50%",labelLine:!1,label:({name:p,percent:N})=>N!==void 0&&N>0?`${p}: ${(N*100).toFixed(0)}%`:"",outerRadius:80,fill:"#8884d8",dataKey:"value",isAnimationActive:!1,children:_.map((p,N)=>e.jsx(hs,{fill:p.color},`cell-${N}`))}),e.jsx(Ve,{})]})})})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2 mb-6",children:[e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Rozkad czasu nauki u偶ytkownik贸w"})}),e.jsx(E,{children:e.jsx($e,{width:"100%",height:250,children:e.jsxs($r,{data:S,children:[e.jsx(Lt,{strokeDasharray:"3 3"}),e.jsx(kt,{dataKey:"range"}),e.jsx(gt,{}),e.jsx(Ve,{}),e.jsx(yi,{dataKey:"count",name:"Liczba u偶ytkownik贸w",isAnimationActive:!1,children:S.map((p,N)=>e.jsx(hs,{fill:p.color},`cell-${N}`))})]},`${S.map(p=>p.count).join("-")}`)})})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Wska藕nik ukocze w czasie"})}),e.jsx(E,{children:e.jsx($e,{width:"100%",height:250,children:e.jsxs(op,{data:z,children:[e.jsx(Lt,{strokeDasharray:"3 3"}),e.jsx(kt,{dataKey:"date"}),e.jsx(gt,{}),e.jsx(Ve,{content:({active:p,payload:N})=>{if(p&&N&&N.length){const A=N[0].payload;return e.jsxs("div",{className:"bg-white p-2 border rounded shadow-sm",children:[e.jsx("p",{className:"font-medium text-sm",children:A.date}),e.jsxs("p",{className:"text-xs",children:["Wska藕nik: ",A.rate,"%"]}),e.jsxs("p",{className:"text-xs",children:["Ukoczone: ",A.completed,"/",A.total]})]})}return null}}),e.jsx(fc,{type:"monotone",dataKey:"rate",stroke:"#22c55e",strokeWidth:2,dot:{fill:"#22c55e"},name:"Wska藕nik ukocze %",isAnimationActive:!1})]},`${z.map(p=>p.rate).join("-")}`)})})]})]}),T.length>0&&e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Zaanga偶owanie wedug kurs贸w"})}),e.jsx(E,{children:e.jsx("div",{className:"space-y-3",children:T.map(p=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:p.title}),e.jsxs("div",{className:"flex gap-4 mt-1 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["U偶ytkownicy: ",p.users]}),e.jsxs("span",{children:["Aktywnoci: ",p.activities]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs(V,{variant:p.completionRate>=70?"default":"secondary",children:[p.completionRate,"% ukoczonych"]})})]},p.id))})})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Kluczowe wnioski"})}),e.jsx(E,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(js,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Trendy"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:v.activeUsers>0?`${v.activeUsers} unikalnych u偶ytkownik贸w aktywnych w wybranym okresie`:"Brak aktywnoci w wybranym okresie"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Wska藕nik ukocze"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[v.engagementRate,"% rozpocztych aktywnoci zostao ukoczonych"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"rednie zaanga偶owanie"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["rednio ",v.avgTimeHours," godzin nauki na u偶ytkownika"]})]})]})})]})]})},iC=()=>{const[t,s]=f.useState("all"),[n,i]=f.useState(null),[r,a]=f.useState("progress"),o={queryOptions:{staleTime:1/0,gcTime:1800*1e3,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,refetchInterval:!1,retry:0}},{data:l}=Z({resource:"courses",filters:[{field:"is_published",operator:"eq",value:!0}],pagination:{mode:"off"},...o}),{data:c}=Z({resource:"activities",filters:[{field:"is_published",operator:"eq",value:!0}],pagination:{mode:"off"},meta:{select:"id, topic_id, type, topics(id, course_id)"},...o}),{data:d}=Z({resource:"activity_progress",pagination:{mode:"off"},meta:{select:"*, activities(id, topic_id, type, topics(id, course_id))"},...o}),{data:u}=Z({resource:"groups",pagination:{mode:"off"},...o}),{data:m}=Z({resource:"group_members",pagination:{mode:"off"},filters:t!=="all"?[{field:"group_id",operator:"eq",value:parseInt(t)}]:[],...o}),h=f.useMemo(()=>{if(!l?.data||!c?.data||!d?.data)return[];const j=new Map;return l.data.forEach(w=>{const b=typeof w.id=="number"?w.id:parseInt(w.id),C=c.data.filter(P=>P.topics?.course_id===b).length,_=d.data.filter(P=>P.activities?.topics?.course_id===b),S=t!=="all"&&m?.data?_.filter(P=>m.data.some(R=>R.user_id===P.user_id)):_,z=new Set(S.map(P=>P.user_id)),k=new Map,T=new Map;S.forEach(P=>{if(P.completed_at){const R=k.get(P.user_id)||0;k.set(P.user_id,R+1)}if(P.score!==null&&P.score!==void 0){const R=T.get(P.user_id)||[];R.push(Number(P.score)),T.set(P.user_id,R)}});const p=k.size,N=p>0?Array.from(k.values()).reduce((P,R)=>P+R,0)/p:0,A=Array.from(T.values()).flat(),D=A.length>0?Math.round(A.reduce((P,R)=>P+R,0)/A.length):null;j.set(b,{courseId:b,courseTitle:w.title||"",totalActivities:C,completedActivities:Math.round(N),avgScore:D,totalStudents:z.size,activeStudents:p})}),Array.from(j.values()).filter(w=>w.totalActivities>0).sort((w,b)=>{const v=w.totalActivities>0?w.completedActivities/w.totalActivities:0;return(b.totalActivities>0?b.completedActivities/b.totalActivities:0)-v})},[l?.data,c?.data,d?.data,t,m?.data]),y=f.useMemo(()=>{if(!d?.data||!h.length)return[];const j=new Map;h.forEach(b=>{const v=d.data.filter(_=>_.activities?.topics?.course_id===b.courseId);(t!=="all"&&m?.data?v.filter(_=>m.data.some(S=>S.user_id===_.user_id)):v).forEach(_=>{j.has(_.user_id)||j.set(_.user_id,new Map);const S=j.get(_.user_id);S.has(b.courseId)||S.set(b.courseId,{userId:_.user_id,courseId:b.courseId,courseTitle:b.courseTitle,completedActivities:0,totalActivities:b.totalActivities,avgScore:null,lastActivity:null,timeSpent:0});const z=S.get(b.courseId);if(_.completed_at&&z.completedActivities++,_.score!==null&&_.score!==void 0){const k=[];z.avgScore!==null&&k.push(z.avgScore),k.push(Number(_.score)),z.avgScore=Math.round(k.reduce((T,p)=>T+p,0)/k.length)}z.timeSpent+=_.time_spent||0,(!z.lastActivity||new Date(_.started_at)>new Date(z.lastActivity))&&(z.lastActivity=_.started_at)})});const w=[];return j.forEach(b=>{b.forEach(v=>{w.push(v)})}),w.sort((b,v)=>{switch(r){case"progress":{const C=b.totalActivities>0?b.completedActivities/b.totalActivities:0;return(v.totalActivities>0?v.completedActivities/v.totalActivities:0)-C}case"score":return(v.avgScore||0)-(b.avgScore||0);case"activity":return new Date(v.lastActivity||0).getTime()-new Date(b.lastActivity||0).getTime();default:return 0}})},[d?.data,h,t,m?.data,r]),x=f.useMemo(()=>{const j=[{name:"Rozpoczli kurs",value:0,fill:"#8884d8"},{name:"Ukoczyli 25%",value:0,fill:"#83a6ed"},{name:"Ukoczyli 50%",value:0,fill:"#8dd1e1"},{name:"Ukoczyli 75%",value:0,fill:"#82ca9d"},{name:"Ukoczyli 100%",value:0,fill:"#67b26f"}],w=new Map;return y.forEach(b=>{const v=b.totalActivities>0?b.completedActivities/b.totalActivities*100:0,C=w.get(b.userId)||0;w.set(b.userId,Math.max(C,v))}),w.forEach(b=>{b>0&&j[0].value++,b>=25&&j[1].value++,b>=50&&j[2].value++,b>=75&&j[3].value++,b>=100&&j[4].value++}),j},[y]),g=f.useMemo(()=>{const j=new Set(y.map(_=>_.userId)).size,w=new Set(y.filter(_=>_.completedActivities>0).map(_=>_.userId)).size,b=h.length>0?Math.round(h.reduce((_,S)=>_+(S.totalActivities>0?S.completedActivities/S.totalActivities*100:0),0)/h.length):0,v=h.filter(_=>_.avgScore!==null),C=v.length>0?Math.round(v.reduce((_,S)=>_+S.avgScore,0)/v.length):0;return{totalStudents:j,activeStudents:w,avgCompletion:b,avgScore:C}},[y,h]);return e.jsxs(H,{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Le,{to:"/teacher/reports/overview",children:e.jsxs(M,{variant:"ghost",size:"sm",children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Powr贸t do centrum raport贸w"]})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Raport postp贸w"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ge,{value:t,onValueChange:s,children:[e.jsx(fe,{className:"w-[200px]",children:e.jsx(je,{placeholder:"Wybierz grup"})}),e.jsxs(xe,{children:[e.jsx(W,{value:"all",children:"Wszystkie grupy"}),u?.data?.map(j=>e.jsx(W,{value:j.id?.toString()||"",children:j.name||"Bez nazwy"},j.id||"unknown"))]})]}),e.jsxs(M,{variant:"outline",size:"sm",children:[e.jsx(ip,{className:"mr-2 h-4 w-4"}),"Eksportuj"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4 mb-6",children:[e.jsxs(I,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Wszyscy uczniowie"}),e.jsx(de,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:g.totalStudents}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"w wybranych grupach"})]})]}),e.jsxs(I,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Aktywni uczniowie"}),e.jsx(xt,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:g.activeStudents}),e.jsx("p",{className:"text-xs text-muted-foreground",children:g.totalStudents>0?`${Math.round(g.activeStudents/g.totalStudents*100)}% wszystkich`:"0% wszystkich"})]})]}),e.jsxs(I,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"redni postp"}),e.jsx(ye,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[g.avgCompletion,"%"]}),e.jsx(is,{value:g.avgCompletion,className:"mt-2"})]})]}),e.jsxs(I,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"redni wynik"}),e.jsx(Be,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[g.avgScore,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"z ukoczonych quiz贸w"})]})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2 mb-6",children:[e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Postp wedug kurs贸w"})}),e.jsx(E,{children:e.jsx($e,{width:"100%",height:300,children:e.jsxs($r,{data:h,layout:"vertical",children:[e.jsx(Lt,{strokeDasharray:"3 3"}),e.jsx(kt,{type:"number",domain:[0,100]}),e.jsx(gt,{dataKey:"courseTitle",type:"category",width:120,tick:{fontSize:12}}),e.jsx(Ve,{formatter:j=>`${j}%`,content:({active:j,payload:w})=>{if(j&&w&&w.length){const b=w[0].payload;return e.jsxs("div",{className:"bg-white p-2 border rounded shadow-sm",children:[e.jsx("p",{className:"font-medium text-sm",children:b.courseTitle}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Ukoczono: ",b.completedActivities,"/",b.totalActivities," aktywnoci"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Aktywnych: ",b.activeStudents,"/",b.totalStudents," uczni贸w"]}),b.avgScore!==null&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["redni wynik: ",b.avgScore,"%"]})]})}return null}}),e.jsx(yi,{dataKey:j=>j.totalActivities>0?Math.round(j.completedActivities/j.totalActivities*100):0,fill:"#8884d8",name:"Postp",isAnimationActive:!1})]},`${h.map(j=>j.courseId).join("-")}`)})})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Lejek ukocze"})}),e.jsx(E,{children:e.jsx($e,{width:"100%",height:300,children:e.jsxs(Lw,{children:[e.jsx(Ve,{}),e.jsxs(Ow,{dataKey:"value",data:x,isAnimationActive:!1,children:[e.jsx($w,{position:"center",fill:"#fff"}),x.map((j,w)=>e.jsx(hs,{fill:j.fill},`cell-${w}`))]})]})})})]})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Szczeg贸owe postpy uczni贸w"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(ge,{value:r,onValueChange:j=>a(j),children:[e.jsx(fe,{className:"w-[150px]",children:e.jsx(je,{})}),e.jsxs(xe,{children:[e.jsx(W,{value:"progress",children:"Sortuj wg postpu"}),e.jsx(W,{value:"score",children:"Sortuj wg wyniku"}),e.jsx(W,{value:"activity",children:"Sortuj wg aktywnoci"})]})]})})]})}),e.jsxs(E,{children:[e.jsx("div",{className:"rounded-md border",children:e.jsxs(En,{children:[e.jsx(Rn,{children:e.jsxs(St,{children:[e.jsx(le,{children:"Ucze"}),e.jsx(le,{children:"Kurs"}),e.jsx(le,{children:"Postp"}),e.jsx(le,{children:"redni wynik"}),e.jsx(le,{children:"Czas nauki"}),e.jsx(le,{children:"Ostatnia aktywno"})]})}),e.jsx(Ln,{children:y.slice(0,20).map((j,w)=>{const b=j.totalActivities>0?Math.round(j.completedActivities/j.totalActivities*100):0;return e.jsxs(St,{children:[e.jsxs(ce,{className:"font-medium",children:["Ucze #",w+1]}),e.jsx(ce,{children:j.courseTitle}),e.jsx(ce,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(is,{value:b,className:"w-[60px]"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[b,"%"]})]})}),e.jsx(ce,{children:j.avgScore!==null?e.jsxs(V,{variant:j.avgScore>=70?"default":"secondary",children:[j.avgScore,"%"]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsxs(ce,{children:[Math.floor(j.timeSpent/60),"h ",j.timeSpent%60,"m"]}),e.jsx(ce,{children:j.lastActivity?new Date(j.lastActivity).toLocaleDateString("pl-PL"):"-"})]},`${j.userId}-${j.courseId}`)})})]})}),y.length>20&&e.jsx("div",{className:"mt-4 text-center",children:e.jsxs(M,{variant:"outline",size:"sm",children:["Zobacz wszystkich (",y.length,")"]})})]})]})]})},pg=["#94a3b8","#60a5fa","#818cf8","#a78bfa","#c084fc","#e879f9","#f472b6","#fb923c","#fbbf24","#fde047"],Gu=t=>{const s=Math.min(Math.floor((t-1)/10),9);return pg[s]},rC=()=>{const[t,s]=f.useState("all"),[n,i]=f.useState("30d"),[r,a]=f.useState(!1),o=()=>{const S=new Date,z=new Date;switch(n){case"7d":z.setDate(z.getDate()-7);break;case"30d":z.setDate(z.getDate()-30);break;case"90d":z.setDate(z.getDate()-90);break}return{start:z,end:S}},{start:l}=o(),c={queryOptions:{staleTime:1/0,gcTime:1800*1e3,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,refetchInterval:!1,retry:0}},{data:d}=Z({resource:"user_stats",pagination:{mode:"off"},sorters:[{field:"total_points",order:"desc"}],meta:{select:"*, users(full_name, email, role)"},...c}),{data:u}=Z({resource:"groups",pagination:{mode:"off"},...c}),{data:m}=Z({resource:"group_members",filters:t!=="all"?[{field:"group_id",operator:"eq",value:parseInt(t)}]:[],pagination:{mode:"off"},...c}),{data:h}=Z({resource:"activity_progress",filters:[{field:"started_at",operator:"gte",value:l.toISOString()}],pagination:{mode:"off"},meta:{select:"*, activities(type)"},...c}),y=f.useMemo(()=>{let S=d?.data||[];if(S=S.filter(z=>!z.users?.role||z.users.role==="student"),t!=="all"&&m?.data){const z=m.data.map(k=>k.user_id);S=S.filter(k=>z.includes(k.user_id))}if(r){const z=new Date;z.setDate(z.getDate()-7),S=S.filter(k=>new Date(k.last_active)>z)}return S},[d?.data,t,m?.data,r]),x=f.useMemo(()=>{const S=y.length,z=y.reduce((N,A)=>N+A.total_points,0),k=S>0?Math.round(y.reduce((N,A)=>N+A.current_level,0)/S):0,T=y.filter(N=>N.daily_streak>0).length,p=Math.max(...y.map(N=>N.daily_streak),0);return{totalUsers:S,totalPoints:z,avgLevel:k,activeStreaks:T,maxStreak:p}},[y]),g=f.useMemo(()=>{const S=new Map;return y.forEach(z=>{const k=Math.floor((z.current_level-1)/10)*10+1;S.set(k,(S.get(k)||0)+1)}),Array.from(S.entries()).map(([z,k])=>({level:`${z}-${z+9}`,count:k,percentage:y.length>0?Math.round(k/y.length*100):0})).sort((z,k)=>parseInt(z.level)-parseInt(k.level))},[y]),j=f.useMemo(()=>y.slice(0,10),[y]),w=f.useMemo(()=>{if(!h?.data)return[];const S=new Map;return h.data.forEach(z=>{if(z.activities?.type==="quiz"&&z.completed_at){const k=S.get(z.user_id)||0;S.set(z.user_id,k+1)}}),y.map(z=>({points:z.total_points,quizzes:S.get(z.user_id)||0,level:z.current_level,streak:z.daily_streak,timeHours:Math.round((z.total_time_spent||0)/60)}))},[y,h?.data]),b=f.useMemo(()=>{const S=[{range:"0",count:0},{range:"1-3",count:0},{range:"4-7",count:0},{range:"8-14",count:0},{range:"15-30",count:0},{range:"30+",count:0}];return y.forEach(z=>{z.daily_streak===0?S[0].count++:z.daily_streak<=3?S[1].count++:z.daily_streak<=7?S[2].count++:z.daily_streak<=14?S[3].count++:z.daily_streak<=30?S[4].count++:S[5].count++}),S},[y]),v=f.useMemo(()=>{if(!h?.data)return[];const S=new Map,z=[];for(let k=13;k>=0;k--){const T=new Date;T.setDate(T.getDate()-k);const p=T.toISOString().split("T")[0];z.push(p),S.set(p,{points:0,activities:0})}return h.data.forEach(k=>{const T=k.started_at.split("T")[0];if(S.has(T)){const p=S.get(T);p.activities++,k.activities?.type==="material"&&k.completed_at?p.points+=10:k.activities?.type==="quiz"&&k.score!==null&&k.score!==void 0&&(p.points+=Math.round(20+k.score/100*30))}}),z.map(k=>({date:new Date(k+"T00:00:00").toLocaleDateString("pl-PL",{day:"numeric",month:"short"}),points:S.get(k)?.points||0}))},[h?.data]),C=f.useMemo(()=>{if(!h?.data)return[];let S=0,z=0;const k=y.filter(p=>p.daily_streak>0).length*5,T=y.filter(p=>p.current_level>1).length*50;return h.data.forEach(p=>{p.activities?.type==="quiz"&&p.score!==null&&p.score!==void 0?S+=Math.round(20+p.score/100*30):p.activities?.type==="material"&&p.completed_at&&(z+=10)}),[{type:"Ukoczone quizy",points:S,color:"#8884d8"},{type:"Materiay",points:z,color:"#82ca9d"},{type:"Codzienne logowanie",points:k,color:"#ffc658"},{type:"Awans poziom贸w",points:T,color:"#ff8042"}].filter(p=>p.points>0).sort((p,N)=>N.points-p.points)},[h?.data,y]),_=f.useMemo(()=>{if(!h?.data)return[];const S=new Map;return h.data.forEach(z=>{z.activities?.type==="quiz"&&z.completed_at&&S.set(z.user_id,(S.get(z.user_id)||0)+1)}),j.map(z=>({...z,quizzesCompleted:S.get(z.user_id)||0}))},[j,h?.data]);return e.jsxs(H,{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Le,{to:"/teacher/reports/overview",children:e.jsxs(M,{variant:"ghost",size:"sm",children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Powr贸t do centrum raport贸w"]})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Raport gamifikacji"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ge,{value:t,onValueChange:s,children:[e.jsx(fe,{className:"w-[200px]",children:e.jsx(je,{placeholder:"Wybierz grup"})}),e.jsxs(xe,{children:[e.jsx(W,{value:"all",children:"Wszystkie grupy"}),u?.data?.map(S=>e.jsx(W,{value:S.id.toString(),children:S.name},S.id))]})]}),e.jsxs(ge,{value:n,onValueChange:i,children:[e.jsx(fe,{className:"w-[150px]",children:e.jsx(je,{})}),e.jsxs(xe,{children:[e.jsx(W,{value:"7d",children:"Ostatnie 7 dni"}),e.jsx(W,{value:"30d",children:"Ostatnie 30 dni"}),e.jsx(W,{value:"90d",children:"Ostatnie 90 dni"})]})]}),e.jsx(M,{variant:r?"default":"outline",size:"sm",onClick:()=>a(!r),children:"Tylko aktywni"})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-5 mb-6",children:[e.jsxs(I,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Uczniowie"}),e.jsx(qe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:x.totalUsers}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"w rankingu"})]})]}),e.jsxs(I,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"czne punkty"}),e.jsx(Sn,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:x.totalPoints.toLocaleString("pl-PL")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"zdobytych"})]})]}),e.jsxs(I,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"redni poziom"}),e.jsx(rp,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:x.avgLevel}),e.jsx(is,{value:x.avgLevel/99*100,className:"mt-2 h-1"})]})]}),e.jsxs(I,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Aktywne serie"}),e.jsx(ms,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:x.activeStreaks}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"uczni贸w"})]})]}),e.jsxs(I,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Najdu偶sza seria"}),e.jsx(Ye,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:x.maxStreak}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"dni"})]})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3 mb-6",children:[e.jsxs(I,{className:"lg:col-span-2",children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"h-5 w-5 text-yellow-600"}),"Top 10 uczni贸w"]})}),e.jsx(E,{children:e.jsx("div",{className:"space-y-3",children:_.map((S,z)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold
                      ${z===0?"bg-yellow-100 text-yellow-700 ring-2 ring-yellow-500":z===1?"bg-gray-100 text-gray-700 ring-2 ring-gray-400":z===2?"bg-orange-100 text-orange-700 ring-2 ring-orange-500":"bg-muted text-muted-foreground"}`,children:z+1}),e.jsx(fr,{children:e.jsx(xr,{className:"text-xs",children:S.users?.full_name?S.users.full_name.split(" ").map(k=>k[0]).join("").toUpperCase():`U${z+1}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:S.users?.full_name||`Ucze #${z+1}`}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs(V,{variant:"outline",className:"text-xs",style:{borderColor:Gu(S.current_level),color:Gu(S.current_level)},children:["Poziom ",S.current_level]}),S.daily_streak>0&&e.jsxs(V,{variant:"secondary",className:"text-xs",children:[e.jsx(ms,{className:"w-3 h-3 mr-1"}),S.daily_streak," dni"]}),S.perfect_scores>0&&e.jsxs(V,{variant:"secondary",className:"text-xs",children:[e.jsx(Sn,{className:"w-3 h-3 mr-1"}),S.perfect_scores," perfect"]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold",children:S.total_points.toLocaleString("pl-PL")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"punkt贸w"})]})]},S.user_id))})})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Rozkad poziom贸w"})}),e.jsx(E,{children:e.jsx($e,{width:"100%",height:300,children:e.jsxs(Ca,{children:[e.jsx(_a,{data:g,cx:"50%",cy:"50%",labelLine:!1,label:({percentage:S})=>S>0?`${S}%`:"",outerRadius:80,fill:"#8884d8",dataKey:"count",isAnimationActive:!1,children:g.map((S,z)=>e.jsx(hs,{fill:pg[z]},`cell-${z}`))}),e.jsx(Ve,{}),e.jsx(ci,{formatter:(S,z)=>z?.payload&&"level"in z.payload?`Poziom ${z.payload.level}`:""})]})})})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2 mb-6",children:[e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Punkty vs Ukoczone quizy"})}),e.jsx(E,{children:e.jsx($e,{width:"100%",height:300,children:e.jsxs(lp,{children:[e.jsx(Lt,{strokeDasharray:"3 3"}),e.jsx(kt,{dataKey:"quizzes",name:"Ukoczone quizy"}),e.jsx(gt,{dataKey:"points",name:"Punkty"}),e.jsx(cp,{dataKey:"level",range:[50,200]}),e.jsx(Ve,{cursor:{strokeDasharray:"3 3"}}),e.jsx(dp,{name:"Uczniowie",data:w,fill:"#8884d8",isAnimationActive:!1})]})})})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Rozkad daily streaks"})}),e.jsx(E,{children:e.jsx($e,{width:"100%",height:300,children:e.jsxs($r,{data:b,children:[e.jsx(Lt,{strokeDasharray:"3 3"}),e.jsx(kt,{dataKey:"range"}),e.jsx(gt,{}),e.jsx(Ve,{}),e.jsx(yi,{dataKey:"count",fill:"#fbbf24",name:"Liczba uczni贸w",isAnimationActive:!1,children:b.map((S,z)=>e.jsx(hs,{fill:z===0?"#94a3b8":z<=2?"#fbbf24":z<=4?"#f97316":"#ef4444"},`cell-${z}`))})]},`${b.map(S=>S.count).join("-")}`)})})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Zdobywane punkty w czasie"})}),e.jsx(E,{children:e.jsx($e,{width:"100%",height:250,children:e.jsxs(op,{data:v,children:[e.jsx(Lt,{strokeDasharray:"3 3"}),e.jsx(kt,{dataKey:"date"}),e.jsx(gt,{}),e.jsx(Ve,{}),e.jsx(fc,{type:"monotone",dataKey:"points",stroke:"#8884d8",strokeWidth:2,dot:{fill:"#8884d8"},name:"Punkty",isAnimationActive:!1})]},`${v.map(S=>S.points).join("-")}`)})})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"殴r贸da punkt贸w"})}),e.jsx(E,{children:e.jsx($e,{width:"100%",height:250,children:e.jsxs(Ca,{children:[e.jsx(_a,{data:C,cx:"50%",cy:"50%",labelLine:!1,label:({value:S})=>S!==void 0&&S>0?`${S.toLocaleString("pl-PL")}`:"",outerRadius:80,fill:"#8884d8",dataKey:"points",isAnimationActive:!1,children:C.map((S,z)=>e.jsx(hs,{fill:S.color},`cell-${z}`))}),e.jsx(Ve,{}),e.jsx(ci,{})]})})})]})]}),e.jsxs(I,{className:"mt-6 bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-950/20 dark:to-blue-950/20",children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ls,{className:"h-5 w-5 text-purple-600"}),"Kluczowe osignicia"]})}),e.jsx(E,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Najaktywniejszy ucze"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[_[0]?.quizzesCompleted||0," ukoczonych quiz贸w"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xt,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Najwikszy wzrost"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["+",Math.round(x.totalPoints*.15).toLocaleString("pl-PL")," punkt贸w w tym okresie"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ms,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Zaanga偶owanie"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[x.totalUsers>0?Math.round(x.activeStreaks/x.totalUsers*100):0,"% uczni贸w ma aktywn seri"]})]})]})})]})]})},Zi={veryActive:"#22c55e",active:"#3b82f6",moderate:"#f59e0b",lowActivity:"#ef4444",inactive:"#6b7280"},ht={champions:"#8b5cf6",loyalists:"#3b82f6",potentials:"#10b981",newUsers:"#f59e0b",atRisk:"#ef4444",dormant:"#6b7280"},aC=()=>{const[t,s]=f.useState("30d"),[n,i]=f.useState("all"),[r,a]=f.useState("all"),o=f.useMemo(()=>({staleTime:1/0,gcTime:1800*1e3,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,refetchInterval:1e4,retry:0}),[]),{startISO:l}=f.useMemo(()=>{const p=new Date,N=new Date(p);switch(t){case"7d":N.setDate(N.getDate()-7);break;case"30d":N.setDate(N.getDate()-30);break;case"90d":N.setDate(N.getDate()-90);break}return N.setHours(0,0,0,0),{startISO:N.toISOString(),endISO:p.toISOString()}},[t]),c=f.useMemo(()=>n!=="all"?[{field:"role",operator:"eq",value:n}]:[],[n]),d=f.useMemo(()=>({select:"*, users!user_stats_user_id_fkey(email, full_name)"}),[]),u=f.useMemo(()=>({select:"*, activities(type)"}),[]),m=f.useMemo(()=>[{field:"started_at",operator:"gte",value:l}],[l]),{data:h}=Z({resource:"users",pagination:{mode:"off"},filters:c,queryOptions:o}),{data:y}=Z({resource:"user_stats",pagination:{mode:"off"},meta:d,queryOptions:o}),{data:x}=Z({resource:"activity_progress",filters:m,pagination:{mode:"off"},meta:u,queryOptions:o}),g=f.useMemo(()=>{if(!h?.data||!y?.data||!x?.data)return[];const p=new Map(y.data.map(A=>[A.user_id,A])),N=new Map;return x.data.forEach(A=>{const D=N.get(A.user_id)||[];D.push(A),N.set(A.user_id,D)}),h.data.map(A=>{const D=p.get(A.id),P=N.get(A.id)||[];let R;const q=D?.last_active?Math.floor((Date.now()-new Date(D.last_active).getTime())/(1e3*60*60*24)):999;D?q>30?R="dormant":q>14?R="atRisk":D.total_points<100&&q<7?R="newUsers":D.total_points>1e3&&D.daily_streak>7?R="champions":D.daily_streak>3?R="loyalists":R="potentials":R="dormant";const L=P.filter(O=>typeof O.score=="number"),U=L.length?Math.round(L.reduce((O,G)=>O+G.score,0)/L.length):null;return{...A,stats:D,activities:P,segment:R,daysSinceLastActive:q,avgScore:U}})},[h?.data,y?.data,x?.data]),j=f.useMemo(()=>r==="all"?g:g.filter(p=>p.segment===r),[g,r]),w=f.useMemo(()=>{const p=j.length,N=j.filter(L=>L.is_active).length,A=j.filter(L=>L.daysSinceLastActive<=7).length,D=j.filter(L=>L.stats),P=D.length?Math.round(D.reduce((L,U)=>L+(U.stats?.current_level||0),0)/D.length):0,R=D.filter(L=>(L.stats?.daily_streak||0)>0).length,q=D.length?Math.round(D.reduce((L,U)=>L+(U.stats?.total_time_spent||0),0)/D.length/60):0;return{total:p,active:N,activePercent:p>0?Math.round(N/p*100):0,activeLastWeek:A,activeLastWeekPercent:p>0?Math.round(A/p*100):0,avgLevel:P,withStreaks:R,streakPercent:p>0?Math.round(R/p*100):0,avgTimeHours:q}},[j]),b=f.useMemo(()=>{const p=[{name:"Champions",key:"champions",count:0,color:ht.champions,description:"Wysokie punkty, aktywna seria"},{name:"Lojalici",key:"loyalists",count:0,color:ht.loyalists,description:"Regularna aktywno"},{name:"Potencjalni",key:"potentials",count:0,color:ht.potentials,description:"Niska regularno"},{name:"Nowi",key:"newUsers",count:0,color:ht.newUsers,description:"Niedawno doczyli"},{name:"Zagro偶eni",key:"atRisk",count:0,color:ht.atRisk,description:"Spadek aktywnoci"},{name:"Nieaktywni",key:"dormant",count:0,color:ht.dormant,description:"Brak aktywnoci >30 dni"}],N={};return g.forEach(A=>{N[A.segment]=(N[A.segment]||0)+1}),p.map(A=>({...A,count:N[A.key]||0})).filter(A=>A.count>0)},[g]),v=f.useMemo(()=>{const p=[{name:"Champions",key:"champions",count:0,color:ht.champions,description:"Wysokie punkty, aktywna seria"},{name:"Lojalici",key:"loyalists",count:0,color:ht.loyalists,description:"Regularna aktywno"},{name:"Potencjalni",key:"potentials",count:0,color:ht.potentials,description:"Niska regularno"},{name:"Nowi",key:"newUsers",count:0,color:ht.newUsers,description:"Niedawno doczyli"},{name:"Zagro偶eni",key:"atRisk",count:0,color:ht.atRisk,description:"Spadek aktywnoci"},{name:"Nieaktywni",key:"dormant",count:0,color:ht.dormant,description:"Brak aktywnoci >30 dni"}],N={};return g.forEach(A=>{N[A.segment]=(N[A.segment]||0)+1}),p.map(A=>({...A,count:N[A.key]||0}))},[g]),C=f.useMemo(()=>{const p=[{name:"Bardzo aktywni",range:"Codziennie",count:0,color:Zi.veryActive},{name:"Aktywni",range:"2-6 dni/tydz",count:0,color:Zi.active},{name:"Umiarkowani",range:"1 dzie/tydz",count:0,color:Zi.moderate},{name:"Niska aktywno",range:"<1 dzie/tydz",count:0,color:Zi.lowActivity},{name:"Nieaktywni",range:"Brak",count:0,color:Zi.inactive}];return j.forEach(N=>{!N.stats||N.daysSinceLastActive>30?p[4].count++:N.daysSinceLastActive<=1?p[0].count++:N.daysSinceLastActive<=3?p[1].count++:N.daysSinceLastActive<=7?p[2].count++:p[3].count++}),p},[j]),_=f.useMemo(()=>{const p=new Map;return x?.data?.forEach(A=>{const D=A.started_at.slice(0,10),P=p.get(D)||new Set;P.add(A.user_id),p.set(D,P)}),Array.from(p.keys()).sort().slice(-30).map(A=>({date:new Date(A).toLocaleDateString("pl-PL",{day:"numeric",month:"short"}),activeUsers:p.get(A)?.size||0,newUsers:j.filter(D=>D.created_at?.slice(0,10)===A).length}))},[x?.data,j]),S=f.useMemo(()=>j.filter(p=>p.stats&&(p.stats.total_time_spent||0)>0).map(p=>({timeHours:Math.round((p.stats.total_time_spent||0)/60),points:p.stats.total_points,level:p.stats.current_level,streak:p.stats.daily_streak,segment:p.segment})),[j]),z=f.useMemo(()=>j.filter(p=>p.stats).sort((p,N)=>(N.stats?.total_points||0)-(p.stats?.total_points||0)).slice(0,10),[j]),k=f.useMemo(()=>{const p=new Map,N=4;return j.forEach(A=>{const D=new Date(A.created_at);D.setHours(0,0,0,0),D.setDate(D.getDate()-D.getDay());const P=D.toISOString().slice(0,10);p.has(P)||p.set(P,{total:0,retained:Array(N).fill(0)});const R=p.get(P);R.total++;for(let q=0;q<N;q++){const L=new Date(D);L.setDate(L.getDate()+q*7);const U=new Date(L);U.setDate(U.getDate()+7),A.activities.some(G=>{const se=new Date(G.started_at);return se>=L&&se<U})&&R.retained[q]++}}),Array.from(p.entries()).map(([A,D])=>({cohort:new Date(A).toLocaleDateString("pl-PL",{day:"numeric",month:"short"}),week0:100,week1:D.total>0?Math.round(D.retained[1]/D.total*100):0,week2:D.total>0?Math.round(D.retained[2]/D.total*100):0,week3:D.total>0?Math.round(D.retained[3]/D.total*100):0,total:D.total})).slice(-4)},[j]),T=[{label:"Wszyscy u偶ytkownicy",value:w.total.toString(),subValue:`${w.activePercent}% aktywnych`,icon:de,color:"text-blue-600",bgColor:"bg-blue-50"},{label:"Aktywni w ostatnim tygodniu",value:w.activeLastWeek.toString(),subValue:`${w.activeLastWeekPercent}% wszystkich`,icon:kw,color:"text-green-600",bgColor:"bg-green-50"},{label:"redni poziom",value:w.avgLevel.toString(),subValue:`${w.avgTimeHours}h rednio`,icon:Ls,color:"text-purple-600",bgColor:"bg-purple-50"},{label:"Z aktywn seri",value:w.withStreaks.toString(),subValue:`${w.streakPercent}% wszystkich`,icon:Ye,color:"text-orange-600",bgColor:"bg-orange-50"}];return e.jsxs(H,{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Le,{to:"/teacher/reports/overview",children:e.jsxs(M,{variant:"ghost",size:"sm",children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Powr贸t do centrum raport贸w"]})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Analiza u偶ytkownik贸w"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ge,{value:n,onValueChange:i,children:[e.jsx(fe,{className:"w-[150px]",children:e.jsx(je,{})}),e.jsxs(xe,{children:[e.jsx(W,{value:"all",children:"Wszystkie role"}),e.jsx(W,{value:"student",children:"Uczniowie"}),e.jsx(W,{value:"teacher",children:"Nauczyciele"}),e.jsx(W,{value:"admin",children:"Administratorzy"})]})]}),e.jsxs(ge,{value:r,onValueChange:a,children:[e.jsx(fe,{className:"w-[180px]",children:e.jsx(je,{})}),e.jsxs(xe,{children:[e.jsx(W,{value:"all",children:"Wszystkie segmenty"}),v.map(p=>e.jsxs(W,{value:p.key,children:[p.name," (",p.count,")"]},p.key))]})]}),e.jsxs(ge,{value:t,onValueChange:s,children:[e.jsx(fe,{className:"w-[150px]",children:e.jsx(je,{})}),e.jsxs(xe,{children:[e.jsx(W,{value:"7d",children:"Ostatnie 7 dni"}),e.jsx(W,{value:"30d",children:"Ostatnie 30 dni"}),e.jsx(W,{value:"90d",children:"Ostatnie 90 dni"})]})]})]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-6",children:T.map((p,N)=>e.jsxs(I,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:p.label}),e.jsx("div",{className:`${p.bgColor} p-2 rounded-lg`,children:e.jsx(p.icon,{className:`h-4 w-4 ${p.color}`})})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:p.value}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:p.subValue})]})]},N))}),e.jsxs(gc,{defaultValue:"segments",className:"space-y-4",children:[e.jsxs(io,{className:"grid w-full grid-cols-5",children:[e.jsx(Wt,{value:"segments",children:"Segmentacja"}),e.jsx(Wt,{value:"activity",children:"Aktywno"}),e.jsx(Wt,{value:"performance",children:"Wyniki"}),e.jsx(Wt,{value:"retention",children:"Retencja"}),e.jsx(Wt,{value:"leaderboard",children:"Ranking"})]}),e.jsxs(Gt,{value:"segments",className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Segmentacja u偶ytkownik贸w"})}),e.jsx(E,{children:b.length===0?e.jsx("div",{className:"text-sm text-muted-foreground p-6 border rounded-lg",children:"Brak danych do wywietlenia dla wybranego zakresu."}):e.jsx($e,{width:"100%",height:300,children:e.jsxs(Ca,{children:[e.jsx(_a,{data:b,cx:"50%",cy:"50%",outerRadius:100,dataKey:"count",label:({name:p,percent:N})=>N!==void 0?`${p}: ${(N*100).toFixed(0)}%`:p,isAnimationActive:!1,children:b.map((p,N)=>e.jsx(hs,{fill:p.color},`cell-${N}`))}),e.jsx(Ve,{})]})})})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Charakterystyka segment贸w"})}),e.jsx(E,{children:e.jsx("div",{className:"space-y-3",children:v.map(p=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:p.color}}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:p.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:p.description})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold",children:p.count}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"u偶ytkownik贸w"})]})]},p.key))})})]})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Vd,{className:"h-5 w-5 text-orange-600"}),"Kluczowe obserwacje"]})}),e.jsx(E,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[v.find(p=>p.key==="atRisk")?.count?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-orange-600",children:[e.jsx(zw,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"U偶ytkownicy zagro偶eni"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[v.find(p=>p.key==="atRisk")?.count," u偶ytkownik贸w wymaga uwagi  rozwa偶 wysanie powiadomie motywacyjnych"]})]}):null,v.find(p=>p.key==="champions")?.count?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-purple-600",children:[e.jsx(Ls,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Champions do wykorzystania"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[v.find(p=>p.key==="champions")?.count," najaktywniejszych u偶ytkownik贸w  mog by mentorami lub ambasadorami"]})]}):null,v.find(p=>p.key==="newUsers")?.count?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Nowi u偶ytkownicy"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[v.find(p=>p.key==="newUsers")?.count," nowych u偶ytkownik贸w  upewnij si, 偶e maj dobre wsparcie onboardingowe"]})]}):null]})})]})]}),e.jsxs(Gt,{value:"activity",className:"space-y-4",children:[e.jsx("div",{className:"grid gap-6 lg:grid-cols-2",children:e.jsxs(I,{className:"lg:col-span-2",children:[e.jsx(F,{children:e.jsx($,{children:"Wzorzec aktywnoci u偶ytkownik贸w"})}),e.jsx(E,{children:e.jsx($e,{width:"100%",height:300,children:e.jsxs(to,{data:_,children:[e.jsx(Lt,{strokeDasharray:"3 3"}),e.jsx(kt,{dataKey:"date"}),e.jsx(gt,{}),e.jsx(Ve,{}),e.jsx(ci,{}),e.jsx(Xs,{type:"monotone",dataKey:"activeUsers",stackId:"1",stroke:"#3b82f6",fill:"#3b82f6",fillOpacity:.6,name:"Aktywni u偶ytkownicy",isAnimationActive:!1}),e.jsx(Xs,{type:"monotone",dataKey:"newUsers",stackId:"1",stroke:"#10b981",fill:"#10b981",fillOpacity:.6,name:"Nowi u偶ytkownicy",isAnimationActive:!1})]})})})]})}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Poziomy aktywnoci"})}),e.jsx(E,{children:e.jsx($e,{width:"100%",height:250,children:e.jsxs($r,{data:C,children:[e.jsx(Lt,{strokeDasharray:"3 3"}),e.jsx(kt,{dataKey:"name"}),e.jsx(gt,{}),e.jsx(Ve,{}),e.jsx(yi,{dataKey:"count",name:"U偶ytkownicy",isAnimationActive:!1,children:C.map((p,N)=>e.jsx(hs,{fill:p.color},`cell-${N}`))})]})})})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Metryki zaanga偶owania"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Or,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"rednia czstotliwo logowania"})]}),e.jsx(V,{variant:"outline",children:"3.2 dni/tydzie"})]}),e.jsx(is,{value:64,className:"h-2"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(et,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"redni czas sesji"})]}),e.jsx(V,{variant:"outline",children:"24 min"})]}),e.jsx(is,{value:48,className:"h-2"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Ukoczenia na u偶ytkownika"})]}),e.jsx(V,{variant:"outline",children:"7.8 aktywnoci"})]}),e.jsx(is,{value:78,className:"h-2"})]})]})]})]})]}),e.jsxs(Gt,{value:"performance",className:"space-y-4",children:[e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Punkty vs Czas nauki"})}),e.jsx(E,{children:e.jsx($e,{width:"100%",height:400,children:e.jsxs(lp,{children:[e.jsx(Lt,{strokeDasharray:"3 3"}),e.jsx(kt,{dataKey:"timeHours",name:"Czas nauki (h)"}),e.jsx(gt,{dataKey:"points",name:"Punkty"}),e.jsx(cp,{dataKey:"level",range:[50,400]}),e.jsx(Ve,{cursor:{strokeDasharray:"3 3"}}),e.jsx(ci,{}),e.jsx(dp,{name:"U偶ytkownicy",data:S,fill:"#8884d8",isAnimationActive:!1,children:S.map((p,N)=>e.jsx(hs,{fill:ht[p.segment]||"#8884d8"},`cell-${N}`))})]})})})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Rozkad wynik贸w"})}),e.jsx(E,{children:e.jsx("div",{className:"space-y-4",children:[{label:"90-100%",count:j.filter(p=>p.avgScore!==null&&p.avgScore>=90).length,color:"#22c55e"},{label:"80-89%",count:j.filter(p=>p.avgScore!==null&&p.avgScore>=80&&p.avgScore<90).length,color:"#84cc16"},{label:"70-79%",count:j.filter(p=>p.avgScore!==null&&p.avgScore>=70&&p.avgScore<80).length,color:"#eab308"},{label:"60-69%",count:j.filter(p=>p.avgScore!==null&&p.avgScore>=60&&p.avgScore<70).length,color:"#f97316"},{label:"<60%",count:j.filter(p=>p.avgScore!==null&&p.avgScore<60).length,color:"#ef4444"}].map(p=>{const N=j.filter(D=>D.avgScore!==null).length,A=N>0?p.count/N*100:0;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:p.label}),e.jsxs("span",{className:"font-medium",children:[p.count," u偶ytkownik贸w"]})]}),e.jsx("div",{className:"relative h-8 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"absolute left-0 top-0 h-full transition-all duration-500",style:{width:`${A}%`,backgroundColor:p.color}})})]},p.label)})})})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Wska藕niki sukcesu"})}),e.jsx(E,{children:e.jsx($e,{width:"100%",height:250,children:e.jsxs(Fw,{cx:"50%",cy:"50%",innerRadius:"10%",outerRadius:"90%",data:[{name:"Ukoczenia",value:68,fill:"#8884d8"},{name:"Zdawalno",value:74,fill:"#82ca9d"},{name:"Zaanga偶owanie",value:82,fill:"#ffc658"}],children:[e.jsx(qw,{dataKey:"value",isAnimationActive:!1}),e.jsx(ci,{}),e.jsx(Ve,{})]})})})]})]})]}),e.jsxs(Gt,{value:"retention",className:"space-y-4",children:[e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Analiza kohortowa retencji"})}),e.jsxs(E,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(En,{children:[e.jsx(Rn,{children:e.jsxs(St,{children:[e.jsx(le,{children:"Kohorta"}),e.jsx(le,{className:"text-center",children:"Tydzie 0"}),e.jsx(le,{className:"text-center",children:"Tydzie 1"}),e.jsx(le,{className:"text-center",children:"Tydzie 2"}),e.jsx(le,{className:"text-center",children:"Tydzie 3"}),e.jsx(le,{className:"text-center",children:"Liczba u偶ytkownik贸w"})]})}),e.jsx(Ln,{children:k.map(p=>e.jsxs(St,{children:[e.jsx(ce,{className:"font-medium",children:p.cohort}),e.jsx(ce,{className:"text-center",children:e.jsxs("div",{className:"inline-flex items-center justify-center w-16 h-8 rounded",style:{backgroundColor:`rgba(34, 197, 94, ${p.week0/100})`},children:[p.week0,"%"]})}),e.jsx(ce,{className:"text-center",children:e.jsxs("div",{className:"inline-flex items-center justify-center w-16 h-8 rounded",style:{backgroundColor:`rgba(34, 197, 94, ${p.week1/100})`},children:[p.week1,"%"]})}),e.jsx(ce,{className:"text-center",children:e.jsxs("div",{className:"inline-flex items-center justify-center w-16 h-8 rounded",style:{backgroundColor:`rgba(34, 197, 94, ${p.week2/100})`},children:[p.week2,"%"]})}),e.jsx(ce,{className:"text-center",children:e.jsxs("div",{className:"inline-flex items-center justify-center w-16 h-8 rounded",style:{backgroundColor:`rgba(34, 197, 94, ${p.week3/100})`},children:[p.week3,"%"]})}),e.jsx(ce,{className:"text-center",children:p.total})]},p.cohort))})]})}),e.jsx("div",{className:"mt-4 p-4 bg-muted rounded-lg",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsx("strong",{children:"Interpretacja:"})," Wartoci pokazuj procent u偶ytkownik贸w z danej kohorty, kt贸rzy byli aktywni w kolejnych tygodniach po doczeniu."]})})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Czynniki wpywajce na retencj"})}),e.jsx(E,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ys,{className:"h-5 w-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Ukoczenie pierwszego quizu"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+42% retencji po 30 dniach"})]})]}),e.jsx(V,{variant:"default",children:"Kluczowy"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Be,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Osignicie 100 punkt贸w"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+28% retencji po 30 dniach"})]})]}),e.jsx(V,{variant:"secondary",children:"Wa偶ny"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(de,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Doczenie do grupy"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+15% retencji po 30 dniach"})]})]}),e.jsx(V,{variant:"outline",children:"Pomocny"})]})]})})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Prognoza churn"})}),e.jsx(E,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl font-bold text-orange-600 mb-2",children:v.find(p=>p.key==="atRisk")?.count||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"u偶ytkownik贸w zagro偶onych odejciem"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"G贸wne przyczyny:"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:" Brak aktywnoci powy偶ej 14 dni (78%)"}),e.jsx("li",{children:" Niskie wyniki quiz贸w (45%)"}),e.jsx("li",{children:" Brak postp贸w w kursie (34%)"}),e.jsx("li",{children:" Utrata daily streak (23%)"})]})]}),e.jsxs(M,{className:"w-full",variant:"outline",children:[e.jsx(Vd,{className:"mr-2 h-4 w-4"}),"Wygeneruj kampani reaktywacyjn"]})]})})]})]})]}),e.jsxs(Gt,{value:"leaderboard",className:"space-y-4",children:[e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"h-5 w-5 text-yellow-600"}),"Top 10 u偶ytkownik贸w"]})}),e.jsx(E,{children:e.jsx("div",{className:"space-y-3",children:z.map((p,N)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold
                        ${N===0?"bg-yellow-100 text-yellow-700 ring-2 ring-yellow-500":N===1?"bg-gray-100 text-gray-700 ring-2 ring-gray-400":N===2?"bg-orange-100 text-orange-700 ring-2 ring-orange-500":"bg-muted text-muted-foreground"}`,children:N+1}),e.jsx(fr,{children:e.jsx(xr,{className:"text-xs",children:p.full_name?.split(" ").map(A=>A[0]).join("")||p.email.substring(0,2).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:p.full_name||`U偶ytkownik ${N+1}`}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx(V,{variant:"outline",className:"text-xs",style:{borderColor:ht[p.segment]||"#8884d8",color:ht[p.segment]||"#8884d8"},children:v.find(A=>A.key===p.segment)?.name||p.segment}),e.jsxs(V,{variant:"secondary",className:"text-xs",children:["Poziom ",p.stats?.current_level||0]}),p.stats&&p.stats.daily_streak>0&&e.jsxs(V,{variant:"secondary",className:"text-xs",children:[e.jsx(Ye,{className:"w-3 h-3 mr-1"}),p.stats.daily_streak," dni"]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold",children:p.stats?.total_points.toLocaleString("pl-PL")||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"punkt贸w"})]})]},p.id))})})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{className:"text-base",children:"Najbardziej zaanga偶owani"})}),e.jsx(E,{children:e.jsx("div",{className:"space-y-3",children:j.filter(p=>p.stats).sort((p,N)=>(N.stats?.total_time_spent||0)-(p.stats?.total_time_spent||0)).slice(0,5).map((p,N)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:p.full_name||`U偶ytkownik ${N+1}`}),e.jsxs(V,{variant:"outline",children:[Math.round((p.stats?.total_time_spent||0)/60),"h"]})]},p.id))})})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{className:"text-base",children:"Najlepsze wyniki"})}),e.jsx(E,{children:e.jsx("div",{className:"space-y-3",children:j.filter(p=>p.avgScore!==null).sort((p,N)=>p.avgScore<N.avgScore?1:-1).slice(0,5).map((p,N)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:p.full_name||`U偶ytkownik ${N+1}`}),e.jsxs(V,{variant:p.avgScore>=80?"default":"secondary",children:[p.avgScore,"%"]})]},p.id))})})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{className:"text-base",children:"Najdu偶sze serie"})}),e.jsx(E,{children:e.jsx("div",{className:"space-y-3",children:j.filter(p=>p.stats).sort((p,N)=>(N.stats?.daily_streak||0)-(p.stats?.daily_streak||0)).slice(0,5).map((p,N)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:p.full_name||`U偶ytkownik ${N+1}`}),e.jsxs(V,{variant:"outline",children:[e.jsx(Ye,{className:"w-3 h-3 mr-1"}),p.stats?.daily_streak," dni"]})]},p.id))})})]})]})]})]})]})},oC=()=>{const[t,s]=f.useState("30d"),[n,i]=f.useState("all"),[r,a]=f.useState("all"),o={queryOptions:{staleTime:1/0,gcTime:1800*1e3,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,refetchInterval:!1,retry:0}},l=()=>{const z=new Date,k=new Date;switch(t){case"7d":k.setDate(k.getDate()-7);break;case"30d":k.setDate(k.getDate()-30);break;case"90d":k.setDate(k.getDate()-90);break}return{start:k,end:z}},{start:c}=l(),{data:d}=Z({resource:"questions",pagination:{mode:"off"},...o}),{data:u}=Z({resource:"courses",pagination:{mode:"off"},...o}),{data:m}=Z({resource:"topics",filters:n!=="all"?[{field:"course_id",operator:"eq",value:parseInt(n)}]:[],pagination:{mode:"off"},...o}),{data:h}=Z({resource:"activities",filters:[{field:"type",operator:"eq",value:"quiz"},{field:"is_published",operator:"eq",value:!0}],pagination:{mode:"off"},...o}),{data:y}=Z({resource:"activity_progress",filters:[{field:"started_at",operator:"gte",value:c.toISOString()}],pagination:{mode:"off"},meta:{query:z=>z.not("score","is",null)},...o}),x=f.useMemo(()=>{if(!h?.data||!m?.data||!u?.data)return[];const z=new Map(m.data.map(T=>[T.id,T])),k=new Map(u.data.map(T=>[T.id,T]));return h.data.map(T=>{const p=z.get(T.topic_id),N=p?k.get(p.course_id):void 0;return{...T,topicTitle:p?.title||"",courseId:N?.id,courseTitle:N?.title||""}})},[h?.data,m?.data,u?.data]),g=f.useMemo(()=>{let z=x;return n!=="all"&&(z=z.filter(k=>k.courseId===parseInt(n))),r!=="all"&&(z=z.filter(k=>k.topic_id===parseInt(r))),z},[x,n,r]),j=f.useMemo(()=>{if(!y?.data)return[];const z=g.map(k=>k.id);return y.data.filter(k=>z.includes(k.activity_id)&&k.score!==null&&k.score!==void 0)},[y?.data,g]),w=f.useMemo(()=>{const z=new Map;return g.forEach(k=>{const T=j.filter(p=>p.activity_id===k.id);if(T.length>0){const p=T.filter(D=>D.score!==null&&D.score!==void 0).map(D=>D.score);if(p.length===0)return;const N=Math.round(p.reduce((D,P)=>D+P,0)/p.length),A=Math.round(p.filter(D=>D>=(k.passing_score||70)).length/p.length*100);z.set(k.id,{activityId:k.id,activityTitle:k.title,topicTitle:k.topicTitle,courseTitle:k.courseTitle,attempts:T.length,avgScore:N,minScore:Math.min(...p),maxScore:Math.max(...p),passRate:A,passingScore:k.passing_score||70})}}),Array.from(z.values()).sort((k,T)=>k.avgScore-T.avgScore)},[g,j]),b=f.useMemo(()=>{const z=j.length,k=j.filter(P=>P.score!==null&&P.score!==void 0).map(P=>P.score),T=k.length>0?Math.round(k.reduce((P,R)=>P+R,0)/k.length):0,p=j.filter(P=>{if(P.score===null||P.score===void 0)return!1;const q=g.find(L=>L.id===P.activity_id)?.passing_score||70;return P.score>=q}).length,N=z>0?Math.round(p/z*100):0;return{totalAttempts:z,avgScore:T,avgScoreChange:3,passRate:N,passRateChange:5,uniqueStudents:new Set(j.map(P=>P.user_id)).size,totalQuizzes:g.length}},[j,g]),v=f.useMemo(()=>{const z=[{range:"0-20%",count:0,color:"#ef4444"},{range:"21-40%",count:0,color:"#f97316"},{range:"41-60%",count:0,color:"#eab308"},{range:"61-80%",count:0,color:"#84cc16"},{range:"81-100%",count:0,color:"#22c55e"}];return j.forEach(k=>{const T=k.score||0;T<=20?z[0].count++:T<=40?z[1].count++:T<=60?z[2].count++:T<=80?z[3].count++:z[4].count++}),z},[j]),C=f.useMemo(()=>{const z=new Map;return j.forEach(k=>{const T=g.find(p=>p.id===k.activity_id);if(T?.topicTitle&&k.score!==null&&k.score!==void 0){const p=z.get(T.topicTitle)||{scores:[],topic:T.topicTitle};p.scores.push(k.score),z.set(T.topicTitle,p)}}),Array.from(z.values()).map(({topic:k,scores:T})=>({topic:k.length>20?k.substring(0,20)+"...":k,avgScore:Math.round(T.reduce((p,N)=>p+N,0)/T.length),attempts:T.length})).slice(0,8)},[j,g]),_=f.useMemo(()=>{const z=new Map;return j.forEach(k=>{const T=new Date(k.started_at).toLocaleDateString("pl-PL"),p=z.get(T)||[];k.score!==null&&k.score!==void 0&&(p.push(k.score),z.set(T,p))}),Array.from(z.entries()).map(([k,T])=>({date:k,avgScore:Math.round(T.reduce((p,N)=>p+N,0)/T.length),attempts:T.length,minScore:Math.min(...T),maxScore:Math.max(...T)})).sort((k,T)=>new Date(k.date).getTime()-new Date(T.date).getTime()).slice(-14)},[j]),S=f.useMemo(()=>{if(!d?.data||!w.length)return[];const z=w.slice(0,5),k=[];return z.forEach(T=>{d.data.filter(N=>N.activity_id===T.activityId).sort((N,A)=>N.order_index-A.order_index).forEach((N,A)=>{let D="medium";T.avgScore<30?D="very-hard":T.avgScore<50?D="hard":T.avgScore<70?D="medium":D="easy",k.push({questionId:N.id,question:N.question,activityTitle:T.activityTitle,quizAttempts:T.attempts,avgQuizScore:T.avgScore,difficulty:D})})}),k.sort((T,p)=>T.avgQuizScore-p.avgQuizScore).slice(0,10)},[d?.data,w]);return e.jsxs(H,{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Le,{to:"/teacher/reports/overview",children:e.jsxs(M,{variant:"ghost",size:"sm",children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Powr贸t do centrum raport贸w"]})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Raport wynik贸w"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ge,{value:n,onValueChange:i,children:[e.jsx(fe,{className:"w-[200px]",children:e.jsx(je,{placeholder:"Wybierz kurs"})}),e.jsxs(xe,{children:[e.jsx(W,{value:"all",children:"Wszystkie kursy"}),u?.data?.map(z=>e.jsx(W,{value:z.id.toString(),children:z.title},z.id))]})]}),e.jsxs(ge,{value:r,onValueChange:a,disabled:n==="all",children:[e.jsx(fe,{className:"w-[200px]",children:e.jsx(je,{placeholder:"Wybierz temat"})}),e.jsxs(xe,{children:[e.jsx(W,{value:"all",children:"Wszystkie tematy"}),m?.data?.map(z=>e.jsx(W,{value:z.id.toString(),children:z.title},z.id))]})]}),e.jsxs(ge,{value:t,onValueChange:s,children:[e.jsx(fe,{className:"w-[150px]",children:e.jsx(je,{})}),e.jsxs(xe,{children:[e.jsx(W,{value:"7d",children:"Ostatnie 7 dni"}),e.jsx(W,{value:"30d",children:"Ostatnie 30 dni"}),e.jsx(W,{value:"90d",children:"Ostatnie 90 dni"})]})]}),e.jsxs(M,{variant:"outline",size:"sm",children:[e.jsx(ip,{className:"mr-2 h-4 w-4"}),"Eksportuj"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4 mb-6",children:[e.jsxs(I,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"redni wynik"}),e.jsx(Be,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[b.avgScore,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsxs("span",{className:b.avgScoreChange>0?"text-green-600":"text-red-600",children:[b.avgScoreChange>0?e.jsx(xt,{className:"inline h-3 w-3"}):e.jsx(Sw,{className:"inline h-3 w-3"})," ",Math.abs(b.avgScoreChange),"%"]})," ","vs. poprzedni okres"]})]})]}),e.jsxs(I,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Wska藕nik zdawalnoci"}),e.jsx(ji,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[b.passRate,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsxs("span",{className:b.passRateChange>0?"text-green-600":"text-red-600",children:[b.passRateChange>0?"+":"",b.passRateChange,"%"]})," ","vs. poprzedni okres"]})]})]}),e.jsxs(I,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Liczba podej"}),e.jsx(Re,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:b.totalAttempts}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[b.uniqueStudents," unikalnych uczni贸w"]})]})]}),e.jsxs(I,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Liczba quiz贸w"}),e.jsx(Be,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:b.totalQuizzes}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"aktywnych w okresie"})]})]})]}),e.jsxs(gc,{defaultValue:"distribution",className:"space-y-4",children:[e.jsxs(io,{children:[e.jsx(Wt,{value:"distribution",children:"Rozkad wynik贸w"}),e.jsx(Wt,{value:"topics",children:"Wyniki wedug temat贸w"}),e.jsx(Wt,{value:"trend",children:"Trend w czasie"}),e.jsx(Wt,{value:"difficult",children:"Najtrudniejsze pytania"})]}),e.jsx(Gt,{value:"distribution",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Rozkad wynik贸w"})}),e.jsx(E,{children:e.jsx($e,{width:"100%",height:300,children:e.jsxs($r,{data:v,children:[e.jsx(Lt,{strokeDasharray:"3 3"}),e.jsx(kt,{dataKey:"range"}),e.jsx(gt,{}),e.jsx(Ve,{}),e.jsx(yi,{dataKey:"count",name:"Liczba wynik贸w",isAnimationActive:!1,children:v.map((z,k)=>e.jsx(hs,{fill:z.color},`cell-${k}`))})]})})})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"h-4 w-4 text-orange-600"}),"Quizy wymagajce uwagi"]})}),e.jsx(E,{children:e.jsx("div",{className:"space-y-3",children:w.slice(0,5).map(z=>e.jsxs("div",{className:"space-y-2 pb-3 border-b last:border-0",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:z.activityTitle}),e.jsx("p",{className:"text-xs text-muted-foreground",children:z.topicTitle})]}),e.jsxs(V,{variant:z.avgScore<50?"destructive":"secondary",children:[z.avgScore,"%"]})]}),e.jsxs("div",{className:"flex gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Zdawalno: ",z.passRate,"%"]}),e.jsxs("span",{children:["Pr贸by: ",z.attempts]}),e.jsxs("span",{children:["Min/Max: ",z.minScore,"%/",z.maxScore,"%"]})]})]},z.activityId))})})]})]})}),e.jsx(Gt,{value:"topics",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"rednie wyniki wedug temat贸w"})}),e.jsx(E,{children:e.jsx($e,{width:"100%",height:400,children:e.jsxs(Bw,{data:C,children:[e.jsx(Uw,{}),e.jsx(Vw,{dataKey:"topic",tick:{fontSize:12}}),e.jsx(Kw,{domain:[0,100]}),e.jsx(Ww,{name:"redni wynik",dataKey:"avgScore",stroke:"#8884d8",fill:"#8884d8",fillOpacity:.6,isAnimationActive:!1}),e.jsx(Ve,{})]})})})]}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Szczeg贸owe wyniki"})}),e.jsx(E,{children:e.jsxs(En,{children:[e.jsx(Rn,{children:e.jsxs(St,{children:[e.jsx(le,{children:"Temat"}),e.jsx(le,{className:"text-right",children:"redni wynik"}),e.jsx(le,{className:"text-right",children:"Liczba pr贸b"})]})}),e.jsx(Ln,{children:C.map(z=>e.jsxs(St,{children:[e.jsx(ce,{className:"font-medium",children:z.topic}),e.jsx(ce,{className:"text-right",children:e.jsxs(V,{variant:z.avgScore>=70?"default":"secondary",children:[z.avgScore,"%"]})}),e.jsx(ce,{className:"text-right",children:z.attempts})]},z.topic))})]})})]})]})}),e.jsx(Gt,{value:"trend",className:"space-y-4",children:e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Trend wynik贸w w czasie"})}),e.jsx(E,{children:e.jsx($e,{width:"100%",height:400,children:e.jsxs(Gw,{data:_,children:[e.jsx(Lt,{strokeDasharray:"3 3"}),e.jsx(kt,{dataKey:"date"}),e.jsx(gt,{}),e.jsx(Ve,{}),e.jsx(ci,{}),e.jsx(Xs,{type:"monotone",dataKey:"maxScore",fill:"#8884d8",stroke:"#8884d8",fillOpacity:.2,name:"Max",isAnimationActive:!1}),e.jsx(Xs,{type:"monotone",dataKey:"minScore",fill:"#82ca9d",stroke:"#82ca9d",fillOpacity:.2,name:"Min",isAnimationActive:!1}),e.jsx(fc,{type:"monotone",dataKey:"avgScore",stroke:"#ff7300",strokeWidth:3,name:"rednia",dot:{fill:"#ff7300"},isAnimationActive:!1}),e.jsx(yi,{dataKey:"attempts",fill:"#ffc658",name:"Liczba pr贸b",yAxisId:"right",isAnimationActive:!1}),e.jsx(gt,{yAxisId:"right",orientation:"right"})]})})})]})}),e.jsx(Gt,{value:"difficult",className:"space-y-4",children:e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"h-5 w-5 text-red-600"}),"Najtrudniejsze pytania"]})}),e.jsxs(E,{children:[e.jsx("div",{className:"space-y-4",children:S.length>0?S.map((z,k)=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs(V,{variant:"outline",children:["#",k+1]}),e.jsxs(V,{variant:z.difficulty==="very-hard"?"destructive":z.difficulty==="hard"?"secondary":"default",children:["Quiz: ",z.avgQuizScore,"% rednio"]})]}),e.jsx("p",{className:"text-sm font-medium",children:z.question}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Z quizu: ",z.activityTitle,"  ",z.quizAttempts," podej"]})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"redni wynik quizu"}),e.jsxs("p",{className:"font-medium",children:[z.avgQuizScore,"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Liczba podej"}),e.jsx("p",{className:"font-medium",children:z.quizAttempts})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Poziom trudnoci"}),e.jsx(V,{variant:z.difficulty==="very-hard"?"destructive":z.difficulty==="hard"?"secondary":z.difficulty==="medium"?"outline":"default",children:z.difficulty==="very-hard"?"Bardzo trudne":z.difficulty==="hard"?"Trudne":z.difficulty==="medium"?"rednie":"atwe"})]})]})]},z.questionId)):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"Brak danych o pytaniach w wybranym okresie."}),e.jsx("p",{className:"text-sm mt-2",children:"Upewnij si, 偶e wybrane quizy maj pytania."})]})}),e.jsx("div",{className:"mt-4 p-4 bg-muted rounded-lg",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsx("strong",{children:"Wskaz贸wka:"})," Rozwa偶 dodanie dodatkowych materia贸w lub wyjanie do pyta z niskim wska藕nikiem poprawnych odpowiedzi."]})})]})]})})]})]})},lC={name:"reports",list:"/teacher/reports/overview",meta:{label:"Raporty",icon:e.jsx(ji,{className:"h-4 w-4"})}},Zu={name:"reports-engagement",list:"/teacher/reports/engagement",meta:{label:"Zaanga偶owanie"}},Hu={name:"reports-progress",list:"/teacher/reports/progress",meta:{label:"Postpy"}},Qu={name:"reports-performance",list:"/teacher/reports/performance",meta:{label:"Wyniki"}},Yu={name:"reports-gamification",list:"/teacher/reports/gamification",meta:{label:"Gamifikacja"}},Ju={name:"reports-summary",list:"/teacher/reports/summary",meta:{label:"U偶ytkownicy"}},cC=[e.jsx(K,{path:"reports",element:e.jsx(rs,{to:"overview",replace:!0})},"reports-root-redirect"),e.jsx(K,{path:"reports/overview",element:e.jsx(sC,{})},"reports-overview"),e.jsx(K,{path:"reports/engagement",element:e.jsx(nC,{})},"reports-engagement"),e.jsx(K,{path:"reports/progress",element:e.jsx(iC,{})},"reports-progress"),e.jsx(K,{path:"reports/performance",element:e.jsx(oC,{})},"reports-performance"),e.jsx(K,{path:"reports/gamification",element:e.jsx(rC,{})},"reports-gamification"),e.jsx(K,{path:"reports/summary",element:e.jsx(aC,{})},"reports-summary")],dC=()=>{const{activityId:t}=Ct();ae();const[s,n]=f.useState(null),[i,r]=f.useState(!1),{data:a,isLoading:o}=Xe({resource:"activities",id:t,meta:{select:"*, topics(*, courses(*))"}}),{data:l,isLoading:c,refetch:d}=Z({resource:"questions",filters:[{field:"activity_id",operator:"eq",value:parseInt(t)}],sorters:[{field:"position",order:"asc"}],pagination:{mode:"off"}}),{mutate:u}=Yt(),{mutate:m}=Mn(),{mutate:h}=Is();if(o||c)return e.jsx(H,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const y=a?.data,x=l?.data||[];return e.jsxs(H,{children:[e.jsx(An,{}),e.jsxs(J,{children:[e.jsx(ue,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-6 h-6 text-blue-500"}),"Pytania quizu"]}),description:e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-medium",children:y?.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[y?.topics?.courses?.title,"  Temat"," ",y?.topics?.position,": ",y?.topics?.title]})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(V,{variant:"outline",className:"text-base px-3 py-1",children:[x.length," ",x.length===1?"pytanie":"pyta"]}),e.jsxs(M,{onClick:()=>r(!0),disabled:i,children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Dodaj pytanie"]})]})]}),e.jsx(I,{className:"bg-muted/50",children:e.jsx(E,{className:"pt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Pr贸g zaliczenia:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[y?.passing_score||70,"%"]})]}),y?.time_limit&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Limit czasu:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[y.time_limit," min"]})]}),y?.max_attempts&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Max. pr贸b:"}),e.jsx("span",{className:"ml-2 font-medium",children:y.max_attempts})]})]})})}),i&&e.jsx(Xu,{activityId:parseInt(t),position:x.length+1,onSave:g=>{u({resource:"questions",values:g},{onSuccess:()=>{Y.success("Pytanie zostao dodane"),r(!1),d()}})},onCancel:()=>r(!1)}),e.jsx("div",{className:"space-y-4",children:x.map(g=>e.jsx("div",{children:s===g.id?e.jsx(Xu,{question:g,activityId:parseInt(t),position:g.position,onSave:j=>{m({resource:"questions",id:g.id,values:j},{onSuccess:()=>{Y.success("Pytanie zostao zaktualizowane"),n(null),d()}})},onCancel:()=>n(null)}):e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs(J,{children:[e.jsxs($,{className:"text-base",children:[e.jsxs("span",{className:"text-muted-foreground mr-2",children:["#",g.position]}),g.question]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(V,{variant:"outline",children:[g.points," pkt"]}),e.jsx(M,{variant:"outline",size:"sm",onClick:()=>n(g.id),children:e.jsx(ks,{className:"w-3 h-3"})}),e.jsx(M,{variant:"outline",size:"sm",onClick:()=>{confirm("Czy na pewno chcesz usun to pytanie?")&&h({resource:"questions",id:g.id},{onSuccess:()=>{Y.success("Pytanie zostao usunite"),d()}})},children:e.jsx(Ft,{className:"w-3 h-3 text-red-600"})})]})]})}),e.jsxs(E,{children:[e.jsx("div",{className:"space-y-2",children:g.options.map((j,w)=>e.jsxs("div",{className:`flex items-center gap-2 p-2 rounded ${j.is_correct?"bg-green-50 dark:bg-green-950/30 border border-green-200 dark:border-green-800":""}`,children:[j.is_correct?e.jsx(rt,{className:"w-4 h-4 text-green-600"}):e.jsx(Jt,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:j.is_correct?"font-medium":"",children:j.text})]},j.id||w))}),g.explanation&&e.jsxs("div",{className:"mt-4 p-3 bg-muted rounded",children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:"Wyjanienie:"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:g.explanation})]})]})]})},g.id))}),x.length===0&&!i&&e.jsx(I,{children:e.jsxs(E,{className:"text-center py-12",children:[e.jsx(Re,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground/50"}),e.jsx("p",{className:"text-lg font-medium text-muted-foreground mb-4",children:"Quiz nie ma jeszcze 偶adnych pyta"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"Dodaj pierwsze pytanie, aby uczniowie mogli rozwiza quiz"}),e.jsxs(M,{onClick:()=>r(!0),children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Dodaj pierwsze pytanie"]})]})}),x.length>0&&e.jsxs("div",{className:"flex justify-between items-center pt-6 border-t",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["cznie punkt贸w: ",x.reduce((g,j)=>g+j.points,0)]}),e.jsx(An,{variant:"outline",children:"Zakocz edycj"})]})]})},Xu=({question:t,activityId:s,position:n,onSave:i,onCancel:r})=>{const[a,o]=f.useState({question:t?.question||"",explanation:t?.explanation||"",points:t?.points||1,position:n,options:t?.options||[{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1}]}),l=()=>{if(!a.question.trim()){Y.error("Pytanie jest wymagane");return}const u=a.options.filter(h=>h.text.trim());if(u.length<2){Y.error("Dodaj przynajmniej 2 odpowiedzi");return}if(u.filter(h=>h.is_correct).length===0){Y.error("Zaznacz przynajmniej jedn poprawn odpowied藕");return}i({activity_id:s,question:a.question,explanation:a.explanation||null,points:a.points,position:a.position,options:u.map((h,y)=>({...h,position:y+1}))})},c=()=>{a.options.length<6&&o({...a,options:[...a.options,{text:"",is_correct:!1}]})},d=u=>{if(a.options.length>2){const m=a.options.filter((h,y)=>y!==u);o({...a,options:m})}};return e.jsxs(I,{className:"border-primary",children:[e.jsx(F,{children:e.jsx($,{children:t?"Edytuj pytanie":"Nowe pytanie"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Tre pytania"}),e.jsx(Xt,{placeholder:"Wprowad藕 tre pytania...",value:a.question,onChange:u=>o({...a,question:u.target.value}),className:"mt-1",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Liczba punkt贸w"}),e.jsx(Q,{type:"number",min:"1",value:a.points,onChange:u=>o({...a,points:parseInt(u.target.value)||1}),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Pozycja"}),e.jsx(Q,{type:"number",min:"1",value:a.position,onChange:u=>o({...a,position:parseInt(u.target.value)||1}),className:"mt-1"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Odpowiedzi"}),a.options.length<6&&e.jsxs(M,{type:"button",size:"sm",variant:"outline",onClick:c,children:[e.jsx(Fe,{className:"w-3 h-3 mr-1"}),"Dodaj opcj"]})]}),e.jsx("div",{className:"space-y-2",children:a.options.map((u,m)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ge,{checked:u.is_correct,onCheckedChange:h=>{const y=[...a.options];y[m].is_correct=h,o({...a,options:y})}}),e.jsx(Q,{placeholder:`Odpowied藕 ${m+1}`,value:u.text,onChange:h=>{const y=[...a.options];y[m].text=h.target.value,o({...a,options:y})},className:"flex-1"}),a.options.length>2&&e.jsx(M,{type:"button",variant:"ghost",size:"sm",onClick:()=>d(m),children:e.jsx(Jt,{className:"w-4 h-4"})})]},m))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Zaznacz checkbox przy poprawnych odpowiedziach. Mo偶esz zaznaczy wicej ni偶 jedn."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Wyjanienie (opcjonalne)"}),e.jsx(Xt,{placeholder:"Wyjanienie poprawnej odpowiedzi...",value:a.explanation,onChange:u=>o({...a,explanation:u.target.value}),className:"mt-1",rows:3})]}),e.jsxs(J,{children:[e.jsxs(M,{variant:"outline",onClick:r,children:[e.jsx(Jt,{className:"w-4 h-4 mr-2"}),"Anuluj"]}),e.jsxs(M,{onClick:l,children:[e.jsx(Rs,{className:"w-4 h-4 mr-2"}),"Zapisz pytanie"]})]})]})]})},uC=()=>{const[t]=Ga(),s=ae(),n=t.get("activity_id"),{data:i,isLoading:r}=Z({resource:"questions",filters:[{field:"activity_id",operator:"eq",value:parseInt(n)}],sorters:[{field:"position",order:"desc"}],pagination:{mode:"off"}}),[a,o]=f.useState({question:"",explanation:"",points:1,position:1,options:[{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1}]});f.useEffect(()=>{if(i?.data){const g=i.data.reduce((j,w)=>Math.max(j,w.position||0),0);o(j=>({...j,position:g+1}))}},[i]);const{data:l,isLoading:c}=Xe({resource:"activities",id:n,meta:{select:"*, topics(*, courses(*))"}}),{mutate:d,isLoading:u}=Yt();if(!n)return e.jsx(H,{children:e.jsx(I,{children:e.jsx(E,{className:"text-center py-12",children:e.jsx("p",{className:"text-lg font-medium text-muted-foreground",children:"Brak ID aktywnoci"})})})});if(c||r)return e.jsx(H,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const m=l?.data;if(!m||m.type!=="quiz")return e.jsx(H,{children:e.jsx(I,{children:e.jsx(E,{className:"text-center py-12",children:e.jsx("p",{className:"text-lg font-medium text-muted-foreground",children:"Nieprawidowa aktywno lub aktywno nie jest quizem"})})})});const h=()=>{if(!a.question.trim()){Y.error("Pytanie jest wymagane");return}const g=a.options.filter(w=>w.text.trim());if(g.length<2){Y.error("Dodaj przynajmniej 2 odpowiedzi");return}if(g.filter(w=>w.is_correct).length===0){Y.error("Zaznacz przynajmniej jedn poprawn odpowied藕");return}d({resource:"questions",values:{activity_id:parseInt(n),question:a.question,explanation:a.explanation||null,points:a.points,position:a.position,options:g.map((w,b)=>({id:b+1,text:w.text,is_correct:w.is_correct}))}},{onSuccess:()=>{Y.success("Pytanie zostao dodane"),s(`/teacher/questions/manage/${n}`)},onError:w=>{console.error("Bd podczas dodawania pytania:",w);const b=w?.code||w?.statusCode,v=w?.message||w?.error?.message;b==="23505"||b===23505?v?.includes("position")?Y.error("Pytanie o tej pozycji ju偶 istnieje. Zmie pozycj na inn warto."):Y.error("Wystpi konflikt z istniejcymi danymi. Sprawd藕 pozycj pytania."):b==="23503"||b===23503?Y.error("Nieprawidowe powizanie z aktywnoci."):b==="22P02"||b===22002?Y.error("Nieprawidowy format danych."):v?Y.error(`Bd: ${v}`):Y.error("Wystpi nieoczekiwany bd. Spr贸buj ponownie.")}})},y=()=>{a.options.length<6&&o({...a,options:[...a.options,{text:"",is_correct:!1}]})},x=g=>{if(a.options.length>2){const j=a.options.filter((w,b)=>b!==g);o({...a,options:j})}};return e.jsxs(H,{children:[e.jsx(An,{}),e.jsx(J,{children:e.jsx(ue,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-6 h-6 text-blue-500"}),"Dodaj pytanie do quizu"]}),description:e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-medium",children:m?.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[m?.topics?.courses?.title,"  Temat"," ",m?.topics?.position,": ",m?.topics?.title]})]})})}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsx($,{children:"Nowe pytanie"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Tre pytania"}),e.jsx(Xt,{placeholder:"Wprowad藕 tre pytania...",value:a.question,onChange:g=>o({...a,question:g.target.value}),className:"mt-1",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Liczba punkt贸w"}),e.jsx(Q,{type:"number",min:"1",value:a.points,onChange:g=>o({...a,points:parseInt(g.target.value)||1}),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Pozycja"}),e.jsx(Q,{type:"number",min:"1",value:a.position,onChange:g=>o({...a,position:parseInt(g.target.value)||1}),className:"mt-1"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Odpowiedzi"}),a.options.length<6&&e.jsxs(M,{type:"button",size:"sm",variant:"outline",onClick:y,children:[e.jsx(Fe,{className:"w-3 h-3 mr-1"}),"Dodaj opcj"]})]}),e.jsx("div",{className:"space-y-2",children:a.options.map((g,j)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ge,{checked:g.is_correct,onCheckedChange:w=>{const b=[...a.options];b[j].is_correct=w,o({...a,options:b})}}),e.jsx(Q,{placeholder:`Odpowied藕 ${j+1}`,value:g.text,onChange:w=>{const b=[...a.options];b[j].text=w.target.value,o({...a,options:b})},className:"flex-1"}),a.options.length>2&&e.jsx(M,{type:"button",variant:"ghost",size:"sm",onClick:()=>x(j),children:e.jsx(Jt,{className:"w-4 h-4"})})]},j))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Zaznacz checkbox przy poprawnych odpowiedziach. Mo偶esz zaznaczy wicej ni偶 jedn."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Wyjanienie (opcjonalne)"}),e.jsx(Xt,{placeholder:"Wyjanienie poprawnej odpowiedzi...",value:a.explanation,onChange:g=>o({...a,explanation:g.target.value}),className:"mt-1",rows:3})]}),e.jsxs(J,{children:[e.jsxs(M,{variant:"outline",onClick:()=>s(`/teacher/questions/manage/${n}`),children:[e.jsx(Jt,{className:"w-4 h-4 mr-2"}),"Anuluj"]}),e.jsxs(M,{onClick:h,disabled:u,children:[e.jsx(Rs,{className:"w-4 h-4 mr-2"}),u?"Zapisywanie...":"Zapisz pytanie"]})]})]})]})]})},mC=[e.jsx(K,{path:"/questions/manage/:activityId",element:e.jsx(dC,{})},"questions-manage"),e.jsx(K,{path:"/questions/create",element:e.jsx(uC,{})},"questions-create")],hC=[...gz,...M2,...L2,...U2,...mC,...Q2,...eC,...cC],pC=()=>e.jsx(Wa,{children:e.jsxs(K,{element:e.jsx(fz,{children:e.jsx(ac,{})}),children:[e.jsx(K,{index:!0,element:e.jsx(rs,{to:"dashboard/overview",replace:!0})}),e.jsx(K,{path:"dashboard",element:e.jsx(rs,{to:"dashboard/overview",replace:!0})}),hC]})}),fC=f.lazy(()=>Promise.resolve({default:pC})),fg=({text:t,colorClass:s})=>e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-background",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`inline-block h-12 w-12 animate-spin rounded-full border-4 border-current border-r-transparent ${s}`}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:t})]})}),xC=({children:t})=>{const{data:s,isLoading:n}=Ze();return n||!s?e.jsx(fg,{text:"Sprawdzanie uprawnie...",colorClass:"border-indigo-600"}):["teacher","admin"].includes(s.role)?e.jsx(e.Fragment,{children:t}):e.jsx(rs,{to:"/student/dashboard",replace:!0})},gC=e.jsx(K,{path:"/teacher/*",element:e.jsx(dc,{fallback:e.jsx(uc,{to:"/login"}),children:e.jsx(xC,{children:e.jsx(f.Suspense,{fallback:e.jsx(fg,{text:"adowanie panelu nauczyciela...",colorClass:"border-indigo-600"}),children:e.jsx(fC,{})})})},"teacher-auth")});class jC{constructor(){ts(this,"stats",{points:0,level:1,streak:0,idle_rate:1,next_level_points:200,quizzes_completed:0,perfect_scores:0,total_time:0,rank:0});ts(this,"listeners",new Set);ts(this,"channel",null);ts(this,"userId",null)}subscribe(s){return this.listeners.add(s),s(this.stats),()=>{this.listeners.delete(s)}}notify(){this.listeners.forEach(s=>s(this.stats))}async fetchStats(s){if(s)try{const{data:n,error:i}=await X.rpc("get_my_stats");if(i)throw i;n&&(console.log("Fetched stats from DB:",n),this.stats={points:n.points||0,level:n.level||1,streak:n.streak||0,idle_rate:n.idle_rate||1,next_level_points:n.next_level_points||200,quizzes_completed:n.quizzes_completed||0,perfect_scores:n.perfect_scores||0,total_time:n.total_time||0,rank:n.rank||0},this.notify())}catch(n){console.error("Error fetching stats:",n)}}setupSubscription(s){this.userId===s&&this.channel||(this.channel&&this.userId!==s&&(console.log("Closing old subscription for user:",this.userId),X.removeChannel(this.channel),this.channel=null),this.userId=s,console.log("Setting up global stats subscription for user:",s),this.channel=X.channel(`global-user-stats-${s}`).on("postgres_changes",{event:"*",schema:"public",table:"user_stats",filter:`user_id=eq.${s}`},n=>{console.log("user_stats change received:",n),this.fetchStats(s)}).on("postgres_changes",{event:"INSERT",schema:"public",table:"gamification_log",filter:`user_id=eq.${s}`},n=>{console.log("gamification_log INSERT received:",n),setTimeout(()=>this.fetchStats(s),300)}).subscribe(n=>{console.log("Global subscription status:",n)}),this.fetchStats(s))}cleanup(){this.channel&&(console.log("Cleaning up global subscription"),X.removeChannel(this.channel),this.channel=null,this.userId=null)}}const sl=new jC,Un=()=>{const{data:t}=Ze(),[s,n]=f.useState({points:0,level:1,streak:0,idle_rate:1,next_level_points:200,quizzes_completed:0,perfect_scores:0,total_time:0,rank:0}),[i,r]=f.useState(!0);f.useEffect(()=>t?.id?(sl.setupSubscription(t.id),sl.subscribe(l=>{n(l),r(!1)})):void 0,[t?.id]);const a=f.useCallback(async()=>{t?.id&&(r(!0),await sl.fetchStats(t.id),r(!1))},[t?.id]);return{stats:s,isLoading:i,refetch:a}},_s=new Map,Zr=(t,s,n)=>{const i=n?.cacheKey||`${t}-${JSON.stringify(s)}`,[r,a]=f.useState(()=>_s.get(i)||null),[o,l]=f.useState(!_s.has(i)),[c,d]=f.useState(null),u=f.useCallback(async(h=!1)=>{if(n?.enabled!==!1){if(!h&&_s.has(i)){a(_s.get(i)),l(!1);return}try{l(!0),d(null);const{data:y,error:x}=await X.rpc(t,s);if(x)throw x;_s.set(i,y),a(y),n?.onSuccess?.(y)}catch(y){d(y),n?.onError?.(y)}finally{l(!1)}}},[t,i,JSON.stringify(s),n?.enabled]);f.useEffect(()=>{u()},[u]);const m=f.useCallback(()=>{_s.delete(i)},[i]);return{data:r,isLoading:o,error:c,refetch:()=>u(!0),invalidate:m}},ar=t=>{t?Array.from(_s.keys()).forEach(s=>{s.includes(t)&&_s.delete(s)}):_s.clear()},yC=(t,s)=>{const[n,i]=f.useState([]),[r,a]=f.useState(!0),[o,l]=f.useState(null),c=f.useCallback(async()=>{if(s?.enabled!==!1)try{a(!0),l(null);let d=X.from(t).select(s?.select||"*");s?.filters?.forEach(h=>{switch(h.operator){case"eq":d=d.eq(h.field,h.value);break;case"in":d=d.in(h.field,h.value);break;case"contains":d=d.ilike(h.field,`%${h.value}%`);break}}),s?.sorts?.forEach(h=>{d=d.order(h.field,{ascending:h.order==="asc"})}),s?.limit&&(d=d.limit(s.limit));const{data:u,error:m}=await d;if(m)throw m;i(u||[])}catch(d){l(d)}finally{a(!1)}},[t,JSON.stringify(s)]);return f.useEffect(()=>{c()},[c]),{data:n,isLoading:r,error:o,refetch:c}},em=({onClose:t,variant:s="sidebar"})=>{const{mutate:n}=Za(),{data:i}=Ze(),r=Ns(),{stats:a}=Un(),o=[{path:"/student/dashboard",label:"G贸wna",icon:Cw},{path:"/student/gamification",label:"Ulepszenia",icon:yl},{path:"/student/leaderboard",label:"Ranking",icon:qe},{path:"/student/achievements",label:"Osignicia",icon:Ls},{path:"/student/profile",label:"Profil",icon:Sa}],l=()=>{t&&t()};return s==="bottom"?e.jsx("div",{className:"grid grid-cols-5 gap-1 p-1.5",children:o.map(c=>{const d=r.pathname===c.path;return e.jsxs(pi,{to:c.path,className:({isActive:u})=>B("relative flex flex-col items-center justify-center gap-1 rounded-lg p-3 transition-colors",u?"text-primary":"text-muted-foreground hover:text-foreground hover:bg-muted/50"),children:[e.jsx(c.icon,{className:"h-5 w-5"}),e.jsx("span",{className:"text-[11px] font-medium",children:c.label}),d&&e.jsx("i",{"aria-hidden":!0,className:"pointer-events-none absolute inset-x-6 -bottom-[3px] h-1 rounded-full bg-primary/70"})]},c.path)})}):e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsxs("div",{className:"h-16 px-6 border-b relative grid place-items-center justify-start overflow-hidden",children:[e.jsx("i",{"aria-hidden":!0,className:"absolute -right-10 -top-10 w-28 h-28 rounded-3xl bg-gradient-to-br from-primary/10 via-secondary/10 to-accent/10 rotate-45"}),e.jsxs("div",{className:"flex items-center gap-3 relative z-10",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-primary to-secondary text-white grid place-items-center shadow",children:e.jsx(gi,{className:"w-5 h-5"})}),e.jsx("strong",{className:"text-lg",children:"Smart Up"})]}),t&&e.jsx(M,{variant:"ghost",size:"sm",onClick:t,className:"absolute right-4 lg:hidden",children:e.jsx(Jt,{className:"h-4 w-4"})})]}),e.jsx("section",{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-primary/10 to-secondary/10 text-primary grid place-items-center font-bold",children:i?.full_name?.charAt(0)||"U"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 rounded-full bg-secondary text-white text-xs grid place-items-center font-bold",children:a.level})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-semibold truncate",children:i?.full_name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Poziom ",a.level,"  ",a.streak," dni"]})]})]})}),e.jsx("section",{className:"px-6 -mt-2 mb-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("article",{className:"rounded-xl border p-3 bg-primary/5 border-primary/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ye,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Punkty"})]}),e.jsx("p",{className:"text-lg font-bold",children:Math.floor(a.points)}),e.jsxs("p",{className:"text-xs text-primary",children:["+",a.idle_rate,"/h"]})]}),e.jsxs("article",{className:"rounded-xl border p-3 bg-destructive/5 border-destructive/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ms,{className:"w-4 h-4 text-destructive"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Seria"})]}),e.jsx("p",{className:"text-lg font-bold",children:a.streak}),e.jsx("p",{className:"text-xs text-destructive",children:"dni z rzdu"})]})]})}),e.jsx(tt,{className:"flex-1 px-4",children:e.jsx("nav",{className:"space-y-1",children:o.map(c=>e.jsxs(pi,{to:c.path,onClick:l,className:({isActive:d})=>B("relative w-full flex items-center gap-3 px-4 h-11 rounded-xl transition-colors",d?"bg-primary text-primary-foreground":"hover:bg-muted/50 text-muted-foreground hover:text-foreground"),children:[e.jsx(c.icon,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:c.label})]},c.path))})}),e.jsx(no,{}),e.jsxs("footer",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"px-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground mb-2",children:[e.jsxs("span",{children:["Poziom ",a.level]}),e.jsxs("span",{children:["Poziom ",a.level+1]})]}),e.jsx("div",{className:"h-1.5 rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-gradient-to-r from-primary via-secondary to-accent",style:{width:`${Math.max(0,Math.min(100,a.points%100))}%`}})})]}),e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>{n(),t&&t()},className:"w-full justify-center text-destructive border-destructive/30 bg-destructive/5 hover:bg-destructive/10",children:[e.jsx(Xa,{className:"mr-2 h-4 w-4"}),"Wyloguj"]})]})]})},wC=()=>e.jsx("div",{"aria-hidden":!0,className:"pointer-events-none fixed inset-0 z-0 overflow-hidden p-0 lg:p-2.5 lg:pb-28 pt-0",children:e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("div",{className:"absolute inset-0 bg-background rounded-3xl"}),e.jsxs("div",{className:"absolute inset-0 rounded-3xl overflow-hidden",children:[e.jsx("div",{className:"absolute w-[50vw] h-[50vh] bottom-0 left-0 translate-y-[25%] -translate-x-[25%] bg-orange rounded-full blur-[150px] opacity-70 dark:opacity-40"}),e.jsx("div",{className:"absolute w-[30vw] h-[30vh] bottom-0 left-1/2 -translate-x-1/2 translate-y-[20%] bg-yellow rounded-full blur-[100px] opacity-60 dark:opacity-30"}),e.jsx("div",{className:"absolute w-[50vw] h-[50vh] bottom-0 right-0 translate-y-[25%] translate-x-[25%] bg-purple rounded-full blur-[150px] opacity-70 dark:opacity-40"})]})]})}),bC=({stats:t,theme:s,onToggleTheme:n})=>{const[i,r]=f.useState(!1),{data:a}=Ze(),{mutate:o}=Za(),l=f.useMemo(()=>Math.floor(t.points),[t.points]);return e.jsx("header",{className:"sticky top-0 z-30 h-16 bg-card/80 backdrop-blur supports-[backdrop-filter]:bg-card/60 border-b shadow-sm hidden lg:block",children:e.jsxs("div",{className:"mx-auto max-w-6xl h-full px-4 lg:px-8 flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3 min-w-0",children:e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-base sm:text-lg font-semibold truncate",children:"Dashboard"}),e.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:["Witaj, ",a?.full_name?.split(" ")[0],"!"]})]})}),e.jsxs("div",{className:"flex items-center gap-2 lg:gap-3",children:[e.jsxs("button",{className:"relative p-2.5 rounded-xl hover:bg-muted focus-ring h-11 w-11 grid place-items-center","aria-label":"Powiadomienia",children:[e.jsx(ap,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("span",{className:"absolute top-1.5 right-1.5 w-2 h-2 bg-destructive rounded-full"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 lg:px-4 h-11 rounded-xl border bg-primary/10 border-primary/20",children:[e.jsx(Ye,{className:"w-4 h-4 text-primary animate-pulse"}),e.jsx("span",{className:"font-semibold text-sm lg:text-base tabular-nums min-w-[3ch] text-right",children:l.toLocaleString("pl-PL")}),e.jsxs("span",{className:"hidden md:block text-xs text-primary",children:["+",t.idle_rate,"/h"]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>r(!i),className:"flex items-center gap-2 px-1.5 h-11 rounded-xl hover:bg-muted focus-ring","aria-haspopup":"menu","aria-expanded":i,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-9 h-9 lg:w-10 lg:h-10 rounded-xl bg-gradient-to-br from-primary to-secondary text-white grid place-items-center font-bold",children:a?.full_name?.charAt(0)||"U"}),e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-4 h-4 lg:w-5 lg:h-5 rounded-full bg-accent text-white text-[10px] lg:text-xs grid place-items-center border-2 border-card",children:t.level})]}),e.jsx(dt,{className:"w-4 h-4 text-muted-foreground"})]}),i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>r(!1),"aria-hidden":"true"}),e.jsxs("menu",{className:"absolute right-0 mt-2 w-64 bg-card rounded-xl border shadow-soft-lg z-50 overflow-hidden",children:[e.jsxs("section",{className:"p-4 border-b",children:[e.jsx("p",{className:"font-semibold truncate",children:a?.full_name}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:a?.email})]}),e.jsxs("ul",{className:"p-2",children:[e.jsx("li",{children:e.jsxs("button",{onClick:()=>{n(),r(!1)},className:"w-full flex items-center gap-3 px-3 h-11 rounded-lg text-foreground/80 hover:text-foreground hover:bg-muted transition-colors",children:[s==="dark"?e.jsx(_w,{className:"w-4 h-4"}):e.jsx(Tw,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:s==="dark"?"Tryb jasny":"Tryb ciemny"})]})}),e.jsx("li",{children:e.jsxs("button",{onClick:()=>{window.location.href="/student/profile",r(!1)},className:"w-full flex items-center gap-3 px-3 h-11 rounded-lg text-foreground/80 hover:text-foreground hover:bg-muted transition-colors",children:[e.jsx(Sa,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Profil"})]})}),e.jsx("li",{children:e.jsxs("button",{onClick:()=>{window.location.href="/student/settings",r(!1)},className:"w-full flex items-center gap-3 px-3 h-11 rounded-lg text-foreground/80 hover:text-foreground hover:bg-muted transition-colors",children:[e.jsx(hc,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Ustawienia"})]})}),e.jsx("li",{children:e.jsxs("button",{onClick:()=>{window.location.href="/student/help",r(!1)},className:"w-full flex items-center gap-3 px-3 h-11 rounded-lg text-foreground/80 hover:text-foreground hover:bg-muted transition-colors",children:[e.jsx(Re,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Pomoc"})]})}),e.jsx("li",{children:e.jsxs("button",{onClick:()=>{o(),r(!1)},className:"w-full flex items-center gap-3 px-3 h-11 rounded-lg text-destructive hover:bg-destructive/10 transition-colors",children:[e.jsx(Xa,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Wyloguj"})]})})]})]})]})]})]})]})})},vC=({children:t})=>{const[s,n]=f.useState(!1),[i,r]=f.useState(()=>{const c=localStorage.getItem("theme");return c==="light"||c==="dark"?c:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}),{stats:a}=Un();f.useEffect(()=>{document.documentElement.classList.toggle("dark",i==="dark"),localStorage.setItem("theme",i)},[i]);const o=()=>{r(i==="dark"?"light":"dark")},l=()=>{n(!s)};return e.jsxs("div",{className:"min-h-screen bg-background relative overflow-x-hidden",children:[e.jsx(wC,{}),e.jsxs("div",{className:"flex relative",children:[s&&e.jsx("div",{className:"fixed inset-0 z-40 bg-black/30 dark:bg-black/50 backdrop-blur-sm lg:hidden",onClick:()=>n(!1)}),e.jsx("aside",{className:`
            h-screen w-80 transform transition-transform duration-300 ease-in-out
            fixed left-0 top-0 z-50
            ${s?"translate-x-0":"-translate-x-full"}
            lg:translate-x-0 lg:w-72
            bg-card/95 backdrop-blur-xl border-r
          `,children:e.jsx(em,{onClose:()=>n(!1)})}),e.jsxs("main",{className:"flex-1 lg:ml-72 min-w-0 relative z-10",children:[e.jsx("div",{className:"fixed top-0 left-72 right-0 z-30 hidden lg:block",children:e.jsx(bC,{stats:a,theme:i,onToggleTheme:o})}),e.jsxs("div",{className:"sticky top-0 z-30 flex h-16 items-center border-b bg-card/80 backdrop-blur supports-[backdrop-filter]:bg-card/60 px-4 lg:hidden",children:[e.jsx(M,{variant:"ghost",size:"sm",onClick:l,className:"mr-2",children:e.jsx(Lr,{className:"h-6 w-6"})}),e.jsx("span",{className:"font-semibold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",children:"Smart Up"})]}),e.jsx("div",{className:"min-h-[calc(100vh-4rem)] pb-32 lg:pb-24 lg:pt-16",children:t})]})]}),e.jsx("nav",{"aria-label":"Nawigacja dolna",className:"fixed py-3.5 bottom-0 z-40 left-0 right-0 lg:left-72 bg-card/95 backdrop-blur-xl border-t",children:e.jsx(em,{variant:"bottom"})})]})},ed=f.createContext({});function td(t){const s=f.useRef(null);return s.current===null&&(s.current=t()),s.current}const sd=typeof window<"u",xg=sd?f.useLayoutEffect:f.useEffect,To=f.createContext(null);function nd(t,s){t.indexOf(s)===-1&&t.push(s)}function id(t,s){const n=t.indexOf(s);n>-1&&t.splice(n,1)}const Os=(t,s,n)=>n>s?s:n<t?t:n;let rd=()=>{};const $s={},gg=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t);function jg(t){return typeof t=="object"&&t!==null}const yg=t=>/^0[^.\s]+$/u.test(t);function ad(t){let s;return()=>(s===void 0&&(s=t()),s)}const Qt=t=>t,NC=(t,s)=>n=>s(t(n)),Hr=(...t)=>t.reduce(NC),Ar=(t,s,n)=>{const i=s-t;return i===0?1:(n-t)/i};class od{constructor(){this.subscriptions=[]}add(s){return nd(this.subscriptions,s),()=>id(this.subscriptions,s)}notify(s,n,i){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](s,n,i);else for(let a=0;a<r;a++){const o=this.subscriptions[a];o&&o(s,n,i)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const fs=t=>t*1e3,xs=t=>t/1e3;function wg(t,s){return s?t*(1e3/s):0}const bg=(t,s,n)=>(((1-3*n+3*s)*t+(3*n-6*s))*t+3*s)*t,kC=1e-7,zC=12;function SC(t,s,n,i,r){let a,o,l=0;do o=s+(n-s)/2,a=bg(o,i,r)-t,a>0?n=o:s=o;while(Math.abs(a)>kC&&++l<zC);return o}function Qr(t,s,n,i){if(t===s&&n===i)return Qt;const r=a=>SC(a,0,1,t,n);return a=>a===0||a===1?a:bg(r(a),s,i)}const vg=t=>s=>s<=.5?t(2*s)/2:(2-t(2*(1-s)))/2,Ng=t=>s=>1-t(1-s),kg=Qr(.33,1.53,.69,.99),ld=Ng(kg),zg=vg(ld),Sg=t=>(t*=2)<1?.5*ld(t):.5*(2-Math.pow(2,-10*(t-1))),cd=t=>1-Math.sin(Math.acos(t)),Cg=Ng(cd),_g=vg(cd),CC=Qr(.42,0,1,1),_C=Qr(0,0,.58,1),Tg=Qr(.42,0,.58,1),TC=t=>Array.isArray(t)&&typeof t[0]!="number",Ag=t=>Array.isArray(t)&&typeof t[0]=="number",AC={linear:Qt,easeIn:CC,easeInOut:Tg,easeOut:_C,circIn:cd,circInOut:_g,circOut:Cg,backIn:ld,backInOut:zg,backOut:kg,anticipate:Sg},DC=t=>typeof t=="string",tm=t=>{if(Ag(t)){rd(t.length===4);const[s,n,i,r]=t;return Qr(s,n,i,r)}else if(DC(t))return AC[t];return t},da=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function PC(t,s){let n=new Set,i=new Set,r=!1,a=!1;const o=new WeakSet;let l={delta:0,timestamp:0,isProcessing:!1};function c(u){o.has(u)&&(d.schedule(u),t()),u(l)}const d={schedule:(u,m=!1,h=!1)=>{const x=h&&r?n:i;return m&&o.add(u),x.has(u)||x.add(u),u},cancel:u=>{i.delete(u),o.delete(u)},process:u=>{if(l=u,r){a=!0;return}r=!0,[n,i]=[i,n],n.forEach(c),n.clear(),r=!1,a&&(a=!1,d.process(u))}};return d}const MC=40;function Dg(t,s){let n=!1,i=!0;const r={delta:0,timestamp:0,isProcessing:!1},a=()=>n=!0,o=da.reduce((v,C)=>(v[C]=PC(a),v),{}),{setup:l,read:c,resolveKeyframes:d,preUpdate:u,update:m,preRender:h,render:y,postRender:x}=o,g=()=>{const v=$s.useManualTiming?r.timestamp:performance.now();n=!1,$s.useManualTiming||(r.delta=i?1e3/60:Math.max(Math.min(v-r.timestamp,MC),1)),r.timestamp=v,r.isProcessing=!0,l.process(r),c.process(r),d.process(r),u.process(r),m.process(r),h.process(r),y.process(r),x.process(r),r.isProcessing=!1,n&&s&&(i=!1,t(g))},j=()=>{n=!0,i=!0,r.isProcessing||t(g)};return{schedule:da.reduce((v,C)=>{const _=o[C];return v[C]=(S,z=!1,k=!1)=>(n||j(),_.schedule(S,z,k)),v},{}),cancel:v=>{for(let C=0;C<da.length;C++)o[da[C]].cancel(v)},state:r,steps:o}}const{schedule:Te,cancel:rn,state:nt,steps:nl}=Dg(typeof requestAnimationFrame<"u"?requestAnimationFrame:Qt,!0);let ba;function IC(){ba=void 0}const Nt={now:()=>(ba===void 0&&Nt.set(nt.isProcessing||$s.useManualTiming?nt.timestamp:performance.now()),ba),set:t=>{ba=t,queueMicrotask(IC)}},Pg=t=>s=>typeof s=="string"&&s.startsWith(t),dd=Pg("--"),EC=Pg("var(--"),ud=t=>EC(t)?RC.test(t.split("/*")[0].trim()):!1,RC=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Oi={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},Dr={...Oi,transform:t=>Os(0,1,t)},ua={...Oi,default:1},or=t=>Math.round(t*1e5)/1e5,md=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function LC(t){return t==null}const OC=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,hd=(t,s)=>n=>!!(typeof n=="string"&&OC.test(n)&&n.startsWith(t)||s&&!LC(n)&&Object.prototype.hasOwnProperty.call(n,s)),Mg=(t,s,n)=>i=>{if(typeof i!="string")return i;const[r,a,o,l]=i.match(md);return{[t]:parseFloat(r),[s]:parseFloat(a),[n]:parseFloat(o),alpha:l!==void 0?parseFloat(l):1}},$C=t=>Os(0,255,t),il={...Oi,transform:t=>Math.round($C(t))},bn={test:hd("rgb","red"),parse:Mg("red","green","blue"),transform:({red:t,green:s,blue:n,alpha:i=1})=>"rgba("+il.transform(t)+", "+il.transform(s)+", "+il.transform(n)+", "+or(Dr.transform(i))+")"};function FC(t){let s="",n="",i="",r="";return t.length>5?(s=t.substring(1,3),n=t.substring(3,5),i=t.substring(5,7),r=t.substring(7,9)):(s=t.substring(1,2),n=t.substring(2,3),i=t.substring(3,4),r=t.substring(4,5),s+=s,n+=n,i+=i,r+=r),{red:parseInt(s,16),green:parseInt(n,16),blue:parseInt(i,16),alpha:r?parseInt(r,16)/255:1}}const Ll={test:hd("#"),parse:FC,transform:bn.transform},Yr=t=>({test:s=>typeof s=="string"&&s.endsWith(t)&&s.split(" ").length===1,parse:parseFloat,transform:s=>`${s}${t}`}),Ws=Yr("deg"),gs=Yr("%"),ee=Yr("px"),qC=Yr("vh"),BC=Yr("vw"),sm={...gs,parse:t=>gs.parse(t)/100,transform:t=>gs.transform(t*100)},ii={test:hd("hsl","hue"),parse:Mg("hue","saturation","lightness"),transform:({hue:t,saturation:s,lightness:n,alpha:i=1})=>"hsla("+Math.round(t)+", "+gs.transform(or(s))+", "+gs.transform(or(n))+", "+or(Dr.transform(i))+")"},Ue={test:t=>bn.test(t)||Ll.test(t)||ii.test(t),parse:t=>bn.test(t)?bn.parse(t):ii.test(t)?ii.parse(t):Ll.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?bn.transform(t):ii.transform(t),getAnimatableNone:t=>{const s=Ue.parse(t);return s.alpha=0,Ue.transform(s)}},UC=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function VC(t){return isNaN(t)&&typeof t=="string"&&(t.match(md)?.length||0)+(t.match(UC)?.length||0)>0}const Ig="number",Eg="color",KC="var",WC="var(",nm="${}",GC=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Pr(t){const s=t.toString(),n=[],i={color:[],number:[],var:[]},r=[];let a=0;const l=s.replace(GC,c=>(Ue.test(c)?(i.color.push(a),r.push(Eg),n.push(Ue.parse(c))):c.startsWith(WC)?(i.var.push(a),r.push(KC),n.push(c)):(i.number.push(a),r.push(Ig),n.push(parseFloat(c))),++a,nm)).split(nm);return{values:n,split:l,indexes:i,types:r}}function Rg(t){return Pr(t).values}function Lg(t){const{split:s,types:n}=Pr(t),i=s.length;return r=>{let a="";for(let o=0;o<i;o++)if(a+=s[o],r[o]!==void 0){const l=n[o];l===Ig?a+=or(r[o]):l===Eg?a+=Ue.transform(r[o]):a+=r[o]}return a}}const ZC=t=>typeof t=="number"?0:Ue.test(t)?Ue.getAnimatableNone(t):t;function HC(t){const s=Rg(t);return Lg(t)(s.map(ZC))}const an={test:VC,parse:Rg,createTransformer:Lg,getAnimatableNone:HC};function rl(t,s,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(s-t)*6*n:n<1/2?s:n<2/3?t+(s-t)*(2/3-n)*6:t}function QC({hue:t,saturation:s,lightness:n,alpha:i}){t/=360,s/=100,n/=100;let r=0,a=0,o=0;if(!s)r=a=o=n;else{const l=n<.5?n*(1+s):n+s-n*s,c=2*n-l;r=rl(c,l,t+1/3),a=rl(c,l,t),o=rl(c,l,t-1/3)}return{red:Math.round(r*255),green:Math.round(a*255),blue:Math.round(o*255),alpha:i}}function Fa(t,s){return n=>n>0?s:t}const Pe=(t,s,n)=>t+(s-t)*n,al=(t,s,n)=>{const i=t*t,r=n*(s*s-i)+i;return r<0?0:Math.sqrt(r)},YC=[Ll,bn,ii],JC=t=>YC.find(s=>s.test(t));function im(t){const s=JC(t);if(!s)return!1;let n=s.parse(t);return s===ii&&(n=QC(n)),n}const rm=(t,s)=>{const n=im(t),i=im(s);if(!n||!i)return Fa(t,s);const r={...n};return a=>(r.red=al(n.red,i.red,a),r.green=al(n.green,i.green,a),r.blue=al(n.blue,i.blue,a),r.alpha=Pe(n.alpha,i.alpha,a),bn.transform(r))},Ol=new Set(["none","hidden"]);function XC(t,s){return Ol.has(t)?n=>n<=0?t:s:n=>n>=1?s:t}function e_(t,s){return n=>Pe(t,s,n)}function pd(t){return typeof t=="number"?e_:typeof t=="string"?ud(t)?Fa:Ue.test(t)?rm:n_:Array.isArray(t)?Og:typeof t=="object"?Ue.test(t)?rm:t_:Fa}function Og(t,s){const n=[...t],i=n.length,r=t.map((a,o)=>pd(a)(a,s[o]));return a=>{for(let o=0;o<i;o++)n[o]=r[o](a);return n}}function t_(t,s){const n={...t,...s},i={};for(const r in n)t[r]!==void 0&&s[r]!==void 0&&(i[r]=pd(t[r])(t[r],s[r]));return r=>{for(const a in i)n[a]=i[a](r);return n}}function s_(t,s){const n=[],i={color:0,var:0,number:0};for(let r=0;r<s.values.length;r++){const a=s.types[r],o=t.indexes[a][i[a]],l=t.values[o]??0;n[r]=l,i[a]++}return n}const n_=(t,s)=>{const n=an.createTransformer(s),i=Pr(t),r=Pr(s);return i.indexes.var.length===r.indexes.var.length&&i.indexes.color.length===r.indexes.color.length&&i.indexes.number.length>=r.indexes.number.length?Ol.has(t)&&!r.values.length||Ol.has(s)&&!i.values.length?XC(t,s):Hr(Og(s_(i,r),r.values),n):Fa(t,s)};function $g(t,s,n){return typeof t=="number"&&typeof s=="number"&&typeof n=="number"?Pe(t,s,n):pd(t)(t,s)}const i_=t=>{const s=({timestamp:n})=>t(n);return{start:(n=!0)=>Te.update(s,n),stop:()=>rn(s),now:()=>nt.isProcessing?nt.timestamp:Nt.now()}},Fg=(t,s,n=10)=>{let i="";const r=Math.max(Math.round(s/n),2);for(let a=0;a<r;a++)i+=Math.round(t(a/(r-1))*1e4)/1e4+", ";return`linear(${i.substring(0,i.length-2)})`},qa=2e4;function fd(t){let s=0;const n=50;let i=t.next(s);for(;!i.done&&s<qa;)s+=n,i=t.next(s);return s>=qa?1/0:s}function r_(t,s=100,n){const i=n({...t,keyframes:[0,s]}),r=Math.min(fd(i),qa);return{type:"keyframes",ease:a=>i.next(r*a).value/s,duration:xs(r)}}const a_=5;function qg(t,s,n){const i=Math.max(s-a_,0);return wg(n-t(i),s-i)}const Ee={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},ol=.001;function o_({duration:t=Ee.duration,bounce:s=Ee.bounce,velocity:n=Ee.velocity,mass:i=Ee.mass}){let r,a,o=1-s;o=Os(Ee.minDamping,Ee.maxDamping,o),t=Os(Ee.minDuration,Ee.maxDuration,xs(t)),o<1?(r=d=>{const u=d*o,m=u*t,h=u-n,y=$l(d,o),x=Math.exp(-m);return ol-h/y*x},a=d=>{const m=d*o*t,h=m*n+n,y=Math.pow(o,2)*Math.pow(d,2)*t,x=Math.exp(-m),g=$l(Math.pow(d,2),o);return(-r(d)+ol>0?-1:1)*((h-y)*x)/g}):(r=d=>{const u=Math.exp(-d*t),m=(d-n)*t+1;return-ol+u*m},a=d=>{const u=Math.exp(-d*t),m=(n-d)*(t*t);return u*m});const l=5/t,c=c_(r,a,l);if(t=fs(t),isNaN(c))return{stiffness:Ee.stiffness,damping:Ee.damping,duration:t};{const d=Math.pow(c,2)*i;return{stiffness:d,damping:o*2*Math.sqrt(i*d),duration:t}}}const l_=12;function c_(t,s,n){let i=n;for(let r=1;r<l_;r++)i=i-t(i)/s(i);return i}function $l(t,s){return t*Math.sqrt(1-s*s)}const d_=["duration","bounce"],u_=["stiffness","damping","mass"];function am(t,s){return s.some(n=>t[n]!==void 0)}function m_(t){let s={velocity:Ee.velocity,stiffness:Ee.stiffness,damping:Ee.damping,mass:Ee.mass,isResolvedFromDuration:!1,...t};if(!am(t,u_)&&am(t,d_))if(t.visualDuration){const n=t.visualDuration,i=2*Math.PI/(n*1.2),r=i*i,a=2*Os(.05,1,1-(t.bounce||0))*Math.sqrt(r);s={...s,mass:Ee.mass,stiffness:r,damping:a}}else{const n=o_(t);s={...s,...n,mass:Ee.mass},s.isResolvedFromDuration=!0}return s}function Ba(t=Ee.visualDuration,s=Ee.bounce){const n=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:s}:t;let{restSpeed:i,restDelta:r}=n;const a=n.keyframes[0],o=n.keyframes[n.keyframes.length-1],l={done:!1,value:a},{stiffness:c,damping:d,mass:u,duration:m,velocity:h,isResolvedFromDuration:y}=m_({...n,velocity:-xs(n.velocity||0)}),x=h||0,g=d/(2*Math.sqrt(c*u)),j=o-a,w=xs(Math.sqrt(c/u)),b=Math.abs(j)<5;i||(i=b?Ee.restSpeed.granular:Ee.restSpeed.default),r||(r=b?Ee.restDelta.granular:Ee.restDelta.default);let v;if(g<1){const _=$l(w,g);v=S=>{const z=Math.exp(-g*w*S);return o-z*((x+g*w*j)/_*Math.sin(_*S)+j*Math.cos(_*S))}}else if(g===1)v=_=>o-Math.exp(-w*_)*(j+(x+w*j)*_);else{const _=w*Math.sqrt(g*g-1);v=S=>{const z=Math.exp(-g*w*S),k=Math.min(_*S,300);return o-z*((x+g*w*j)*Math.sinh(k)+_*j*Math.cosh(k))/_}}const C={calculatedDuration:y&&m||null,next:_=>{const S=v(_);if(y)l.done=_>=m;else{let z=_===0?x:0;g<1&&(z=_===0?fs(x):qg(v,_,S));const k=Math.abs(z)<=i,T=Math.abs(o-S)<=r;l.done=k&&T}return l.value=l.done?o:S,l},toString:()=>{const _=Math.min(fd(C),qa),S=Fg(z=>C.next(_*z).value,_,30);return _+"ms "+S},toTransition:()=>{}};return C}Ba.applyToOptions=t=>{const s=r_(t,100,Ba);return t.ease=s.ease,t.duration=fs(s.duration),t.type="keyframes",t};function Fl({keyframes:t,velocity:s=0,power:n=.8,timeConstant:i=325,bounceDamping:r=10,bounceStiffness:a=500,modifyTarget:o,min:l,max:c,restDelta:d=.5,restSpeed:u}){const m=t[0],h={done:!1,value:m},y=k=>l!==void 0&&k<l||c!==void 0&&k>c,x=k=>l===void 0?c:c===void 0||Math.abs(l-k)<Math.abs(c-k)?l:c;let g=n*s;const j=m+g,w=o===void 0?j:o(j);w!==j&&(g=w-m);const b=k=>-g*Math.exp(-k/i),v=k=>w+b(k),C=k=>{const T=b(k),p=v(k);h.done=Math.abs(T)<=d,h.value=h.done?w:p};let _,S;const z=k=>{y(h.value)&&(_=k,S=Ba({keyframes:[h.value,x(h.value)],velocity:qg(v,k,h.value),damping:r,stiffness:a,restDelta:d,restSpeed:u}))};return z(0),{calculatedDuration:null,next:k=>{let T=!1;return!S&&_===void 0&&(T=!0,C(k),z(k)),_!==void 0&&k>=_?S.next(k-_):(!T&&C(k),h)}}}function h_(t,s,n){const i=[],r=n||$s.mix||$g,a=t.length-1;for(let o=0;o<a;o++){let l=r(t[o],t[o+1]);if(s){const c=Array.isArray(s)?s[o]||Qt:s;l=Hr(c,l)}i.push(l)}return i}function p_(t,s,{clamp:n=!0,ease:i,mixer:r}={}){const a=t.length;if(rd(a===s.length),a===1)return()=>s[0];if(a===2&&s[0]===s[1])return()=>s[1];const o=t[0]===t[1];t[0]>t[a-1]&&(t=[...t].reverse(),s=[...s].reverse());const l=h_(s,i,r),c=l.length,d=u=>{if(o&&u<t[0])return s[0];let m=0;if(c>1)for(;m<t.length-2&&!(u<t[m+1]);m++);const h=Ar(t[m],t[m+1],u);return l[m](h)};return n?u=>d(Os(t[0],t[a-1],u)):d}function f_(t,s){const n=t[t.length-1];for(let i=1;i<=s;i++){const r=Ar(0,s,i);t.push(Pe(n,1,r))}}function x_(t){const s=[0];return f_(s,t.length-1),s}function g_(t,s){return t.map(n=>n*s)}function j_(t,s){return t.map(()=>s||Tg).splice(0,t.length-1)}function lr({duration:t=300,keyframes:s,times:n,ease:i="easeInOut"}){const r=TC(i)?i.map(tm):tm(i),a={done:!1,value:s[0]},o=g_(n&&n.length===s.length?n:x_(s),t),l=p_(o,s,{ease:Array.isArray(r)?r:j_(s,r)});return{calculatedDuration:t,next:c=>(a.value=l(c),a.done=c>=t,a)}}const y_=t=>t!==null;function xd(t,{repeat:s,repeatType:n="loop"},i,r=1){const a=t.filter(y_),l=r<0||s&&n!=="loop"&&s%2===1?0:a.length-1;return!l||i===void 0?a[l]:i}const w_={decay:Fl,inertia:Fl,tween:lr,keyframes:lr,spring:Ba};function Bg(t){typeof t.type=="string"&&(t.type=w_[t.type])}class gd{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(s=>{this.resolve=s})}notifyFinished(){this.resolve()}then(s,n){return this.finished.then(s,n)}}const b_=t=>t/100;class jd extends gd{constructor(s){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:n}=this.options;n&&n.updatedAt!==Nt.now()&&this.tick(Nt.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=s,this.initAnimation(),this.play(),s.autoplay===!1&&this.pause()}initAnimation(){const{options:s}=this;Bg(s);const{type:n=lr,repeat:i=0,repeatDelay:r=0,repeatType:a,velocity:o=0}=s;let{keyframes:l}=s;const c=n||lr;c!==lr&&typeof l[0]!="number"&&(this.mixKeyframes=Hr(b_,$g(l[0],l[1])),l=[0,100]);const d=c({...s,keyframes:l});a==="mirror"&&(this.mirroredGenerator=c({...s,keyframes:[...l].reverse(),velocity:-o})),d.calculatedDuration===null&&(d.calculatedDuration=fd(d));const{calculatedDuration:u}=d;this.calculatedDuration=u,this.resolvedDuration=u+r,this.totalDuration=this.resolvedDuration*(i+1)-r,this.generator=d}updateTime(s){const n=Math.round(s-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=n}tick(s,n=!1){const{generator:i,totalDuration:r,mixKeyframes:a,mirroredGenerator:o,resolvedDuration:l,calculatedDuration:c}=this;if(this.startTime===null)return i.next(0);const{delay:d=0,keyframes:u,repeat:m,repeatType:h,repeatDelay:y,type:x,onUpdate:g,finalKeyframe:j}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,s):this.speed<0&&(this.startTime=Math.min(s-r/this.speed,this.startTime)),n?this.currentTime=s:this.updateTime(s);const w=this.currentTime-d*(this.playbackSpeed>=0?1:-1),b=this.playbackSpeed>=0?w<0:w>r;this.currentTime=Math.max(w,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=r);let v=this.currentTime,C=i;if(m){const k=Math.min(this.currentTime,r)/l;let T=Math.floor(k),p=k%1;!p&&k>=1&&(p=1),p===1&&T--,T=Math.min(T,m+1),!!(T%2)&&(h==="reverse"?(p=1-p,y&&(p-=y/l)):h==="mirror"&&(C=o)),v=Os(0,1,p)*l}const _=b?{done:!1,value:u[0]}:C.next(v);a&&(_.value=a(_.value));let{done:S}=_;!b&&c!==null&&(S=this.playbackSpeed>=0?this.currentTime>=r:this.currentTime<=0);const z=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&S);return z&&x!==Fl&&(_.value=xd(u,this.options,j,this.speed)),g&&g(_.value),z&&this.finish(),_}then(s,n){return this.finished.then(s,n)}get duration(){return xs(this.calculatedDuration)}get time(){return xs(this.currentTime)}set time(s){s=fs(s),this.currentTime=s,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=s:this.driver&&(this.startTime=this.driver.now()-s/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(s){this.updateTime(Nt.now());const n=this.playbackSpeed!==s;this.playbackSpeed=s,n&&(this.time=xs(this.currentTime))}play(){if(this.isStopped)return;const{driver:s=i_,startTime:n}=this.options;this.driver||(this.driver=s(r=>this.tick(r))),this.options.onPlay?.();const i=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=i):this.holdTime!==null?this.startTime=i-this.holdTime:this.startTime||(this.startTime=n??i),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Nt.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(s){return this.startTime=0,this.tick(s,!0)}attachTimeline(s){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),s.observe(this)}}function v_(t){for(let s=1;s<t.length;s++)t[s]??(t[s]=t[s-1])}const vn=t=>t*180/Math.PI,ql=t=>{const s=vn(Math.atan2(t[1],t[0]));return Bl(s)},N_={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:t=>(Math.abs(t[0])+Math.abs(t[3]))/2,rotate:ql,rotateZ:ql,skewX:t=>vn(Math.atan(t[1])),skewY:t=>vn(Math.atan(t[2])),skew:t=>(Math.abs(t[1])+Math.abs(t[2]))/2},Bl=t=>(t=t%360,t<0&&(t+=360),t),om=ql,lm=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),cm=t=>Math.sqrt(t[4]*t[4]+t[5]*t[5]),k_={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:lm,scaleY:cm,scale:t=>(lm(t)+cm(t))/2,rotateX:t=>Bl(vn(Math.atan2(t[6],t[5]))),rotateY:t=>Bl(vn(Math.atan2(-t[2],t[0]))),rotateZ:om,rotate:om,skewX:t=>vn(Math.atan(t[4])),skewY:t=>vn(Math.atan(t[1])),skew:t=>(Math.abs(t[1])+Math.abs(t[4]))/2};function Ul(t){return t.includes("scale")?1:0}function Vl(t,s){if(!t||t==="none")return Ul(s);const n=t.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let i,r;if(n)i=k_,r=n;else{const l=t.match(/^matrix\(([-\d.e\s,]+)\)$/u);i=N_,r=l}if(!r)return Ul(s);const a=i[s],o=r[1].split(",").map(S_);return typeof a=="function"?a(o):o[a]}const z_=(t,s)=>{const{transform:n="none"}=getComputedStyle(t);return Vl(n,s)};function S_(t){return parseFloat(t.trim())}const $i=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Fi=new Set($i),dm=t=>t===Oi||t===ee,C_=new Set(["x","y","z"]),__=$i.filter(t=>!C_.has(t));function T_(t){const s=[];return __.forEach(n=>{const i=t.getValue(n);i!==void 0&&(s.push([n,i.get()]),i.set(n.startsWith("scale")?1:0))}),s}const kn={width:({x:t},{paddingLeft:s="0",paddingRight:n="0"})=>t.max-t.min-parseFloat(s)-parseFloat(n),height:({y:t},{paddingTop:s="0",paddingBottom:n="0"})=>t.max-t.min-parseFloat(s)-parseFloat(n),top:(t,{top:s})=>parseFloat(s),left:(t,{left:s})=>parseFloat(s),bottom:({y:t},{top:s})=>parseFloat(s)+(t.max-t.min),right:({x:t},{left:s})=>parseFloat(s)+(t.max-t.min),x:(t,{transform:s})=>Vl(s,"x"),y:(t,{transform:s})=>Vl(s,"y")};kn.translateX=kn.x;kn.translateY=kn.y;const zn=new Set;let Kl=!1,Wl=!1,Gl=!1;function Ug(){if(Wl){const t=Array.from(zn).filter(i=>i.needsMeasurement),s=new Set(t.map(i=>i.element)),n=new Map;s.forEach(i=>{const r=T_(i);r.length&&(n.set(i,r),i.render())}),t.forEach(i=>i.measureInitialState()),s.forEach(i=>{i.render();const r=n.get(i);r&&r.forEach(([a,o])=>{i.getValue(a)?.set(o)})}),t.forEach(i=>i.measureEndState()),t.forEach(i=>{i.suspendedScrollY!==void 0&&window.scrollTo(0,i.suspendedScrollY)})}Wl=!1,Kl=!1,zn.forEach(t=>t.complete(Gl)),zn.clear()}function Vg(){zn.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(Wl=!0)})}function A_(){Gl=!0,Vg(),Ug(),Gl=!1}class yd{constructor(s,n,i,r,a,o=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...s],this.onComplete=n,this.name=i,this.motionValue=r,this.element=a,this.isAsync=o}scheduleResolve(){this.state="scheduled",this.isAsync?(zn.add(this),Kl||(Kl=!0,Te.read(Vg),Te.resolveKeyframes(Ug))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:s,name:n,element:i,motionValue:r}=this;if(s[0]===null){const a=r?.get(),o=s[s.length-1];if(a!==void 0)s[0]=a;else if(i&&n){const l=i.readValue(n,o);l!=null&&(s[0]=l)}s[0]===void 0&&(s[0]=o),r&&a===void 0&&r.set(s[0])}v_(s)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(s=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,s),zn.delete(this)}cancel(){this.state==="scheduled"&&(zn.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const D_=t=>t.startsWith("--");function P_(t,s,n){D_(s)?t.style.setProperty(s,n):t.style[s]=n}const M_=ad(()=>window.ScrollTimeline!==void 0),I_={};function E_(t,s){const n=ad(t);return()=>I_[s]??n()}const Kg=E_(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),tr=([t,s,n,i])=>`cubic-bezier(${t}, ${s}, ${n}, ${i})`,um={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:tr([0,.65,.55,1]),circOut:tr([.55,0,1,.45]),backIn:tr([.31,.01,.66,-.59]),backOut:tr([.33,1.53,.69,.99])};function Wg(t,s){if(t)return typeof t=="function"?Kg()?Fg(t,s):"ease-out":Ag(t)?tr(t):Array.isArray(t)?t.map(n=>Wg(n,s)||um.easeOut):um[t]}function R_(t,s,n,{delay:i=0,duration:r=300,repeat:a=0,repeatType:o="loop",ease:l="easeOut",times:c}={},d=void 0){const u={[s]:n};c&&(u.offset=c);const m=Wg(l,r);Array.isArray(m)&&(u.easing=m);const h={delay:i,duration:r,easing:Array.isArray(m)?"linear":m,fill:"both",iterations:a+1,direction:o==="reverse"?"alternate":"normal"};return d&&(h.pseudoElement=d),t.animate(u,h)}function Gg(t){return typeof t=="function"&&"applyToOptions"in t}function L_({type:t,...s}){return Gg(t)&&Kg()?t.applyToOptions(s):(s.duration??(s.duration=300),s.ease??(s.ease="easeOut"),s)}class O_ extends gd{constructor(s){if(super(),this.finishedTime=null,this.isStopped=!1,!s)return;const{element:n,name:i,keyframes:r,pseudoElement:a,allowFlatten:o=!1,finalKeyframe:l,onComplete:c}=s;this.isPseudoElement=!!a,this.allowFlatten=o,this.options=s,rd(typeof s.type!="string");const d=L_(s);this.animation=R_(n,i,r,d,a),d.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!a){const u=xd(r,this.options,l,this.speed);this.updateMotionValue?this.updateMotionValue(u):P_(n,i,u),this.animation.cancel()}c?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:s}=this;s==="idle"||s==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const s=this.animation.effect?.getComputedTiming?.().duration||0;return xs(Number(s))}get time(){return xs(Number(this.animation.currentTime)||0)}set time(s){this.finishedTime=null,this.animation.currentTime=fs(s)}get speed(){return this.animation.playbackRate}set speed(s){s<0&&(this.finishedTime=null),this.animation.playbackRate=s}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(s){this.animation.startTime=s}attachTimeline({timeline:s,observe:n}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,s&&M_()?(this.animation.timeline=s,Qt):n(this)}}const Zg={anticipate:Sg,backInOut:zg,circInOut:_g};function $_(t){return t in Zg}function F_(t){typeof t.ease=="string"&&$_(t.ease)&&(t.ease=Zg[t.ease])}const mm=10;class q_ extends O_{constructor(s){F_(s),Bg(s),super(s),s.startTime&&(this.startTime=s.startTime),this.options=s}updateMotionValue(s){const{motionValue:n,onUpdate:i,onComplete:r,element:a,...o}=this.options;if(!n)return;if(s!==void 0){n.set(s);return}const l=new jd({...o,autoplay:!1}),c=fs(this.finishedTime??this.time);n.setWithVelocity(l.sample(c-mm).value,l.sample(c).value,mm),l.stop()}}const hm=(t,s)=>s==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(an.test(t)||t==="0")&&!t.startsWith("url("));function B_(t){const s=t[0];if(t.length===1)return!0;for(let n=0;n<t.length;n++)if(t[n]!==s)return!0}function U_(t,s,n,i){const r=t[0];if(r===null)return!1;if(s==="display"||s==="visibility")return!0;const a=t[t.length-1],o=hm(r,s),l=hm(a,s);return!o||!l?!1:B_(t)||(n==="spring"||Gg(n))&&i}function Zl(t){t.duration=0,t.type}const V_=new Set(["opacity","clipPath","filter","transform"]),K_=ad(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function W_(t){const{motionValue:s,name:n,repeatDelay:i,repeatType:r,damping:a,type:o}=t;if(!(s?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:c,transformTemplate:d}=s.owner.getProps();return K_()&&n&&V_.has(n)&&(n!=="transform"||!d)&&!c&&!i&&r!=="mirror"&&a!==0&&o!=="inertia"}const G_=40;class Z_ extends gd{constructor({autoplay:s=!0,delay:n=0,type:i="keyframes",repeat:r=0,repeatDelay:a=0,repeatType:o="loop",keyframes:l,name:c,motionValue:d,element:u,...m}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=Nt.now();const h={autoplay:s,delay:n,type:i,repeat:r,repeatDelay:a,repeatType:o,name:c,motionValue:d,element:u,...m},y=u?.KeyframeResolver||yd;this.keyframeResolver=new y(l,(x,g,j)=>this.onKeyframesResolved(x,g,h,!j),c,d,u),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(s,n,i,r){this.keyframeResolver=void 0;const{name:a,type:o,velocity:l,delay:c,isHandoff:d,onUpdate:u}=i;this.resolvedAt=Nt.now(),U_(s,a,o,l)||(($s.instantAnimations||!c)&&u?.(xd(s,i,n)),s[0]=s[s.length-1],Zl(i),i.repeat=0);const h={startTime:r?this.resolvedAt?this.resolvedAt-this.createdAt>G_?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:n,...i,keyframes:s},y=!d&&W_(h)?new q_({...h,element:h.motionValue.owner.current}):new jd(h);y.finished.then(()=>this.notifyFinished()).catch(Qt),this.pendingTimeline&&(this.stopTimeline=y.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=y}get finished(){return this._animation?this.animation.finished:this._finished}then(s,n){return this.finished.finally(s).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),A_()),this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(s){this.animation.time=s}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(s){this.animation.speed=s}get startTime(){return this.animation.startTime}attachTimeline(s){return this._animation?this.stopTimeline=this.animation.attachTimeline(s):this.pendingTimeline=s,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const H_=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function Q_(t){const s=H_.exec(t);if(!s)return[,];const[,n,i,r]=s;return[`--${n??i}`,r]}function Hg(t,s,n=1){const[i,r]=Q_(t);if(!i)return;const a=window.getComputedStyle(s).getPropertyValue(i);if(a){const o=a.trim();return gg(o)?parseFloat(o):o}return ud(r)?Hg(r,s,n+1):r}function wd(t,s){return t?.[s]??t?.default??t}const Qg=new Set(["width","height","top","left","right","bottom",...$i]),Y_={test:t=>t==="auto",parse:t=>t},Yg=t=>s=>s.test(t),Jg=[Oi,ee,gs,Ws,BC,qC,Y_],pm=t=>Jg.find(Yg(t));function J_(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||yg(t):!0}const X_=new Set(["brightness","contrast","saturate","opacity"]);function e4(t){const[s,n]=t.slice(0,-1).split("(");if(s==="drop-shadow")return t;const[i]=n.match(md)||[];if(!i)return t;const r=n.replace(i,"");let a=X_.has(s)?1:0;return i!==n&&(a*=100),s+"("+a+r+")"}const t4=/\b([a-z-]*)\(.*?\)/gu,Hl={...an,getAnimatableNone:t=>{const s=t.match(t4);return s?s.map(e4).join(" "):t}},fm={...Oi,transform:Math.round},s4={rotate:Ws,rotateX:Ws,rotateY:Ws,rotateZ:Ws,scale:ua,scaleX:ua,scaleY:ua,scaleZ:ua,skew:Ws,skewX:Ws,skewY:Ws,distance:ee,translateX:ee,translateY:ee,translateZ:ee,x:ee,y:ee,z:ee,perspective:ee,transformPerspective:ee,opacity:Dr,originX:sm,originY:sm,originZ:ee},bd={borderWidth:ee,borderTopWidth:ee,borderRightWidth:ee,borderBottomWidth:ee,borderLeftWidth:ee,borderRadius:ee,radius:ee,borderTopLeftRadius:ee,borderTopRightRadius:ee,borderBottomRightRadius:ee,borderBottomLeftRadius:ee,width:ee,maxWidth:ee,height:ee,maxHeight:ee,top:ee,right:ee,bottom:ee,left:ee,padding:ee,paddingTop:ee,paddingRight:ee,paddingBottom:ee,paddingLeft:ee,margin:ee,marginTop:ee,marginRight:ee,marginBottom:ee,marginLeft:ee,backgroundPositionX:ee,backgroundPositionY:ee,...s4,zIndex:fm,fillOpacity:Dr,strokeOpacity:Dr,numOctaves:fm},n4={...bd,color:Ue,backgroundColor:Ue,outlineColor:Ue,fill:Ue,stroke:Ue,borderColor:Ue,borderTopColor:Ue,borderRightColor:Ue,borderBottomColor:Ue,borderLeftColor:Ue,filter:Hl,WebkitFilter:Hl},Xg=t=>n4[t];function ej(t,s){let n=Xg(t);return n!==Hl&&(n=an),n.getAnimatableNone?n.getAnimatableNone(s):void 0}const i4=new Set(["auto","none","0"]);function r4(t,s,n){let i=0,r;for(;i<t.length&&!r;){const a=t[i];typeof a=="string"&&!i4.has(a)&&Pr(a).values.length&&(r=t[i]),i++}if(r&&n)for(const a of s)t[a]=ej(n,r)}class a4 extends yd{constructor(s,n,i,r,a){super(s,n,i,r,a,!0)}readKeyframes(){const{unresolvedKeyframes:s,element:n,name:i}=this;if(!n||!n.current)return;super.readKeyframes();for(let c=0;c<s.length;c++){let d=s[c];if(typeof d=="string"&&(d=d.trim(),ud(d))){const u=Hg(d,n.current);u!==void 0&&(s[c]=u),c===s.length-1&&(this.finalKeyframe=d)}}if(this.resolveNoneKeyframes(),!Qg.has(i)||s.length!==2)return;const[r,a]=s,o=pm(r),l=pm(a);if(o!==l)if(dm(o)&&dm(l))for(let c=0;c<s.length;c++){const d=s[c];typeof d=="string"&&(s[c]=parseFloat(d))}else kn[i]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:s,name:n}=this,i=[];for(let r=0;r<s.length;r++)(s[r]===null||J_(s[r]))&&i.push(r);i.length&&r4(s,i,n)}measureInitialState(){const{element:s,unresolvedKeyframes:n,name:i}=this;if(!s||!s.current)return;i==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=kn[i](s.measureViewportBox(),window.getComputedStyle(s.current)),n[0]=this.measuredOrigin;const r=n[n.length-1];r!==void 0&&s.getValue(i,r).jump(r,!1)}measureEndState(){const{element:s,name:n,unresolvedKeyframes:i}=this;if(!s||!s.current)return;const r=s.getValue(n);r&&r.jump(this.measuredOrigin,!1);const a=i.length-1,o=i[a];i[a]=kn[n](s.measureViewportBox(),window.getComputedStyle(s.current)),o!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=o),this.removedTransforms?.length&&this.removedTransforms.forEach(([l,c])=>{s.getValue(l).set(c)}),this.resolveNoneKeyframes()}}function o4(t,s,n){if(t instanceof EventTarget)return[t];if(typeof t=="string"){let i=document;const r=n?.[t]??i.querySelectorAll(t);return r?Array.from(r):[]}return Array.from(t)}const tj=(t,s)=>s&&typeof t=="number"?s.transform(t):t;function sj(t){return jg(t)&&"offsetHeight"in t}const xm=30,l4=t=>!isNaN(parseFloat(t));class c4{constructor(s,n={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=i=>{const r=Nt.now();if(this.updatedAt!==r&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(i),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const a of this.dependents)a.dirty()},this.hasAnimated=!1,this.setCurrent(s),this.owner=n.owner}setCurrent(s){this.current=s,this.updatedAt=Nt.now(),this.canTrackVelocity===null&&s!==void 0&&(this.canTrackVelocity=l4(this.current))}setPrevFrameValue(s=this.current){this.prevFrameValue=s,this.prevUpdatedAt=this.updatedAt}onChange(s){return this.on("change",s)}on(s,n){this.events[s]||(this.events[s]=new od);const i=this.events[s].add(n);return s==="change"?()=>{i(),Te.read(()=>{this.events.change.getSize()||this.stop()})}:i}clearListeners(){for(const s in this.events)this.events[s].clear()}attach(s,n){this.passiveEffect=s,this.stopPassiveEffect=n}set(s){this.passiveEffect?this.passiveEffect(s,this.updateAndNotify):this.updateAndNotify(s)}setWithVelocity(s,n,i){this.set(n),this.prev=void 0,this.prevFrameValue=s,this.prevUpdatedAt=this.updatedAt-i}jump(s,n=!0){this.updateAndNotify(s),this.prev=s,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(s){this.dependents||(this.dependents=new Set),this.dependents.add(s)}removeDependent(s){this.dependents&&this.dependents.delete(s)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const s=Nt.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||s-this.updatedAt>xm)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,xm);return wg(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(s){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=s(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function zi(t,s){return new c4(t,s)}const{schedule:vd}=Dg(queueMicrotask,!1),ns={x:!1,y:!1};function nj(){return ns.x||ns.y}function d4(t){return t==="x"||t==="y"?ns[t]?null:(ns[t]=!0,()=>{ns[t]=!1}):ns.x||ns.y?null:(ns.x=ns.y=!0,()=>{ns.x=ns.y=!1})}function ij(t,s){const n=o4(t),i=new AbortController,r={passive:!0,...s,signal:i.signal};return[n,r,()=>i.abort()]}function gm(t){return!(t.pointerType==="touch"||nj())}function u4(t,s,n={}){const[i,r,a]=ij(t,n),o=l=>{if(!gm(l))return;const{target:c}=l,d=s(c,l);if(typeof d!="function"||!c)return;const u=m=>{gm(m)&&(d(m),c.removeEventListener("pointerleave",u))};c.addEventListener("pointerleave",u,r)};return i.forEach(l=>{l.addEventListener("pointerenter",o,r)}),a}const rj=(t,s)=>s?t===s?!0:rj(t,s.parentElement):!1,Nd=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,m4=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function h4(t){return m4.has(t.tagName)||t.tabIndex!==-1}const va=new WeakSet;function jm(t){return s=>{s.key==="Enter"&&t(s)}}function ll(t,s){t.dispatchEvent(new PointerEvent("pointer"+s,{isPrimary:!0,bubbles:!0}))}const p4=(t,s)=>{const n=t.currentTarget;if(!n)return;const i=jm(()=>{if(va.has(n))return;ll(n,"down");const r=jm(()=>{ll(n,"up")}),a=()=>ll(n,"cancel");n.addEventListener("keyup",r,s),n.addEventListener("blur",a,s)});n.addEventListener("keydown",i,s),n.addEventListener("blur",()=>n.removeEventListener("keydown",i),s)};function ym(t){return Nd(t)&&!nj()}function f4(t,s,n={}){const[i,r,a]=ij(t,n),o=l=>{const c=l.currentTarget;if(!ym(l))return;va.add(c);const d=s(c,l),u=(y,x)=>{window.removeEventListener("pointerup",m),window.removeEventListener("pointercancel",h),va.has(c)&&va.delete(c),ym(y)&&typeof d=="function"&&d(y,{success:x})},m=y=>{u(y,c===window||c===document||n.useGlobalTarget||rj(c,y.target))},h=y=>{u(y,!1)};window.addEventListener("pointerup",m,r),window.addEventListener("pointercancel",h,r)};return i.forEach(l=>{(n.useGlobalTarget?window:l).addEventListener("pointerdown",o,r),sj(l)&&(l.addEventListener("focus",d=>p4(d,r)),!h4(l)&&!l.hasAttribute("tabindex")&&(l.tabIndex=0))}),a}function aj(t){return jg(t)&&"ownerSVGElement"in t}function x4(t){return aj(t)&&t.tagName==="svg"}const ot=t=>!!(t&&t.getVelocity),g4=[...Jg,Ue,an],j4=t=>g4.find(Yg(t)),kd=f.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});class y4 extends f.Component{getSnapshotBeforeUpdate(s){const n=this.props.childRef.current;if(n&&s.isPresent&&!this.props.isPresent){const i=n.offsetParent,r=sj(i)&&i.offsetWidth||0,a=this.props.sizeRef.current;a.height=n.offsetHeight||0,a.width=n.offsetWidth||0,a.top=n.offsetTop,a.left=n.offsetLeft,a.right=r-a.width-a.left}return null}componentDidUpdate(){}render(){return this.props.children}}function w4({children:t,isPresent:s,anchorX:n,root:i}){const r=f.useId(),a=f.useRef(null),o=f.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:l}=f.useContext(kd);return f.useInsertionEffect(()=>{const{width:c,height:d,top:u,left:m,right:h}=o.current;if(s||!a.current||!c||!d)return;const y=n==="left"?`left: ${m}`:`right: ${h}`;a.current.dataset.motionPopId=r;const x=document.createElement("style");l&&(x.nonce=l);const g=i??document.head;return g.appendChild(x),x.sheet&&x.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${c}px !important;
            height: ${d}px !important;
            ${y}px !important;
            top: ${u}px !important;
          }
        `),()=>{g.contains(x)&&g.removeChild(x)}},[s]),e.jsx(y4,{isPresent:s,childRef:a,sizeRef:o,children:f.cloneElement(t,{ref:a})})}const b4=({children:t,initial:s,isPresent:n,onExitComplete:i,custom:r,presenceAffectsLayout:a,mode:o,anchorX:l,root:c})=>{const d=td(v4),u=f.useId();let m=!0,h=f.useMemo(()=>(m=!1,{id:u,initial:s,isPresent:n,custom:r,onExitComplete:y=>{d.set(y,!0);for(const x of d.values())if(!x)return;i&&i()},register:y=>(d.set(y,!1),()=>d.delete(y))}),[n,d,i]);return a&&m&&(h={...h}),f.useMemo(()=>{d.forEach((y,x)=>d.set(x,!1))},[n]),f.useEffect(()=>{!n&&!d.size&&i&&i()},[n]),o==="popLayout"&&(t=e.jsx(w4,{isPresent:n,anchorX:l,root:c,children:t})),e.jsx(To.Provider,{value:h,children:t})};function v4(){return new Map}function oj(t=!0){const s=f.useContext(To);if(s===null)return[!0,null];const{isPresent:n,onExitComplete:i,register:r}=s,a=f.useId();f.useEffect(()=>{if(t)return r(a)},[t]);const o=f.useCallback(()=>t&&i&&i(a),[a,i,t]);return!n&&i?[!1,o]:[!0]}const ma=t=>t.key||"";function wm(t){const s=[];return f.Children.forEach(t,n=>{f.isValidElement(n)&&s.push(n)}),s}const N4=({children:t,custom:s,initial:n=!0,onExitComplete:i,presenceAffectsLayout:r=!0,mode:a="sync",propagate:o=!1,anchorX:l="left",root:c})=>{const[d,u]=oj(o),m=f.useMemo(()=>wm(t),[t]),h=o&&!d?[]:m.map(ma),y=f.useRef(!0),x=f.useRef(m),g=td(()=>new Map),[j,w]=f.useState(m),[b,v]=f.useState(m);xg(()=>{y.current=!1,x.current=m;for(let S=0;S<b.length;S++){const z=ma(b[S]);h.includes(z)?g.delete(z):g.get(z)!==!0&&g.set(z,!1)}},[b,h.length,h.join("-")]);const C=[];if(m!==j){let S=[...m];for(let z=0;z<b.length;z++){const k=b[z],T=ma(k);h.includes(T)||(S.splice(z,0,k),C.push(k))}return a==="wait"&&C.length&&(S=C),v(wm(S)),w(m),null}const{forceRender:_}=f.useContext(ed);return e.jsx(e.Fragment,{children:b.map(S=>{const z=ma(S),k=o&&!d?!1:m===b||h.includes(z),T=()=>{if(g.has(z))g.set(z,!0);else return;let p=!0;g.forEach(N=>{N||(p=!1)}),p&&(_?.(),v(x.current),o&&u?.(),i&&i())};return e.jsx(b4,{isPresent:k,initial:!y.current||n?void 0:!1,custom:s,presenceAffectsLayout:r,mode:a,root:c,onExitComplete:k?void 0:T,anchorX:l,children:S},z)})})},lj=f.createContext({strict:!1}),bm={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Si={};for(const t in bm)Si[t]={isEnabled:s=>bm[t].some(n=>!!s[n])};function k4(t){for(const s in t)Si[s]={...Si[s],...t[s]}}const z4=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Ua(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||z4.has(t)}let cj=t=>!Ua(t);function S4(t){typeof t=="function"&&(cj=s=>s.startsWith("on")?!Ua(s):t(s))}try{S4(require("@emotion/is-prop-valid").default)}catch{}function C4(t,s,n){const i={};for(const r in t)r==="values"&&typeof t.values=="object"||(cj(r)||n===!0&&Ua(r)||!s&&!Ua(r)||t.draggable&&r.startsWith("onDrag"))&&(i[r]=t[r]);return i}const Ao=f.createContext({});function Do(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}function Mr(t){return typeof t=="string"||Array.isArray(t)}const zd=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Sd=["initial",...zd];function Po(t){return Do(t.animate)||Sd.some(s=>Mr(t[s]))}function dj(t){return!!(Po(t)||t.variants)}function _4(t,s){if(Po(t)){const{initial:n,animate:i}=t;return{initial:n===!1||Mr(n)?n:void 0,animate:Mr(i)?i:void 0}}return t.inherit!==!1?s:{}}function T4(t){const{initial:s,animate:n}=_4(t,f.useContext(Ao));return f.useMemo(()=>({initial:s,animate:n}),[vm(s),vm(n)])}function vm(t){return Array.isArray(t)?t.join(" "):t}const Ir={};function A4(t){for(const s in t)Ir[s]=t[s],dd(s)&&(Ir[s].isCSSVariable=!0)}function uj(t,{layout:s,layoutId:n}){return Fi.has(t)||t.startsWith("origin")||(s||n!==void 0)&&(!!Ir[t]||t==="opacity")}const D4={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},P4=$i.length;function M4(t,s,n){let i="",r=!0;for(let a=0;a<P4;a++){const o=$i[a],l=t[o];if(l===void 0)continue;let c=!0;if(typeof l=="number"?c=l===(o.startsWith("scale")?1:0):c=parseFloat(l)===0,!c||n){const d=tj(l,bd[o]);if(!c){r=!1;const u=D4[o]||o;i+=`${u}(${d}) `}n&&(s[o]=d)}}return i=i.trim(),n?i=n(s,r?"":i):r&&(i="none"),i}function Cd(t,s,n){const{style:i,vars:r,transformOrigin:a}=t;let o=!1,l=!1;for(const c in s){const d=s[c];if(Fi.has(c)){o=!0;continue}else if(dd(c)){r[c]=d;continue}else{const u=tj(d,bd[c]);c.startsWith("origin")?(l=!0,a[c]=u):i[c]=u}}if(s.transform||(o||n?i.transform=M4(s,t.transform,n):i.transform&&(i.transform="none")),l){const{originX:c="50%",originY:d="50%",originZ:u=0}=a;i.transformOrigin=`${c} ${d} ${u}`}}const _d=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function mj(t,s,n){for(const i in s)!ot(s[i])&&!uj(i,n)&&(t[i]=s[i])}function I4({transformTemplate:t},s){return f.useMemo(()=>{const n=_d();return Cd(n,s,t),Object.assign({},n.vars,n.style)},[s])}function E4(t,s){const n=t.style||{},i={};return mj(i,n,t),Object.assign(i,I4(t,s)),i}function R4(t,s){const n={},i=E4(t,s);return t.drag&&t.dragListener!==!1&&(n.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(n.tabIndex=0),n.style=i,n}const L4={offset:"stroke-dashoffset",array:"stroke-dasharray"},O4={offset:"strokeDashoffset",array:"strokeDasharray"};function $4(t,s,n=1,i=0,r=!0){t.pathLength=1;const a=r?L4:O4;t[a.offset]=ee.transform(-i);const o=ee.transform(s),l=ee.transform(n);t[a.array]=`${o} ${l}`}function hj(t,{attrX:s,attrY:n,attrScale:i,pathLength:r,pathSpacing:a=1,pathOffset:o=0,...l},c,d,u){if(Cd(t,l,d),c){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:m,style:h}=t;m.transform&&(h.transform=m.transform,delete m.transform),(h.transform||m.transformOrigin)&&(h.transformOrigin=m.transformOrigin??"50% 50%",delete m.transformOrigin),h.transform&&(h.transformBox=u?.transformBox??"fill-box",delete m.transformBox),s!==void 0&&(m.x=s),n!==void 0&&(m.y=n),i!==void 0&&(m.scale=i),r!==void 0&&$4(m,r,a,o,!1)}const pj=()=>({..._d(),attrs:{}}),fj=t=>typeof t=="string"&&t.toLowerCase()==="svg";function F4(t,s,n,i){const r=f.useMemo(()=>{const a=pj();return hj(a,s,fj(i),t.transformTemplate,t.style),{...a.attrs,style:{...a.style}}},[s]);if(t.style){const a={};mj(a,t.style,t),r.style={...a,...r.style}}return r}const q4=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Td(t){return typeof t!="string"||t.includes("-")?!1:!!(q4.indexOf(t)>-1||/[A-Z]/u.test(t))}function B4(t,s,n,{latestValues:i},r,a=!1){const l=(Td(t)?F4:R4)(s,i,r,t),c=C4(s,typeof t=="string",a),d=t!==f.Fragment?{...c,...l,ref:n}:{},{children:u}=s,m=f.useMemo(()=>ot(u)?u.get():u,[u]);return f.createElement(t,{...d,children:m})}function Nm(t){const s=[{},{}];return t?.values.forEach((n,i)=>{s[0][i]=n.get(),s[1][i]=n.getVelocity()}),s}function Ad(t,s,n,i){if(typeof s=="function"){const[r,a]=Nm(i);s=s(n!==void 0?n:t.custom,r,a)}if(typeof s=="string"&&(s=t.variants&&t.variants[s]),typeof s=="function"){const[r,a]=Nm(i);s=s(n!==void 0?n:t.custom,r,a)}return s}function Na(t){return ot(t)?t.get():t}function U4({scrapeMotionValuesFromProps:t,createRenderState:s},n,i,r){return{latestValues:V4(n,i,r,t),renderState:s()}}function V4(t,s,n,i){const r={},a=i(t,{});for(const h in a)r[h]=Na(a[h]);let{initial:o,animate:l}=t;const c=Po(t),d=dj(t);s&&d&&!c&&t.inherit!==!1&&(o===void 0&&(o=s.initial),l===void 0&&(l=s.animate));let u=n?n.initial===!1:!1;u=u||o===!1;const m=u?l:o;if(m&&typeof m!="boolean"&&!Do(m)){const h=Array.isArray(m)?m:[m];for(let y=0;y<h.length;y++){const x=Ad(t,h[y]);if(x){const{transitionEnd:g,transition:j,...w}=x;for(const b in w){let v=w[b];if(Array.isArray(v)){const C=u?v.length-1:0;v=v[C]}v!==null&&(r[b]=v)}for(const b in g)r[b]=g[b]}}}return r}const xj=t=>(s,n)=>{const i=f.useContext(Ao),r=f.useContext(To),a=()=>U4(t,s,i,r);return n?a():td(a)};function Dd(t,s,n){const{style:i}=t,r={};for(const a in i)(ot(i[a])||s.style&&ot(s.style[a])||uj(a,t)||n?.getValue(a)?.liveStyle!==void 0)&&(r[a]=i[a]);return r}const K4=xj({scrapeMotionValuesFromProps:Dd,createRenderState:_d});function gj(t,s,n){const i=Dd(t,s,n);for(const r in t)if(ot(t[r])||ot(s[r])){const a=$i.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;i[a]=t[r]}return i}const W4=xj({scrapeMotionValuesFromProps:gj,createRenderState:pj}),G4=Symbol.for("motionComponentSymbol");function ri(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function Z4(t,s,n){return f.useCallback(i=>{i&&t.onMount&&t.onMount(i),s&&(i?s.mount(i):s.unmount()),n&&(typeof n=="function"?n(i):ri(n)&&(n.current=i))},[s])}const Pd=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),H4="framerAppearId",jj="data-"+Pd(H4),yj=f.createContext({});function Q4(t,s,n,i,r){const{visualElement:a}=f.useContext(Ao),o=f.useContext(lj),l=f.useContext(To),c=f.useContext(kd).reducedMotion,d=f.useRef(null);i=i||o.renderer,!d.current&&i&&(d.current=i(t,{visualState:s,parent:a,props:n,presenceContext:l,blockInitialAnimation:l?l.initial===!1:!1,reducedMotionConfig:c}));const u=d.current,m=f.useContext(yj);u&&!u.projection&&r&&(u.type==="html"||u.type==="svg")&&Y4(d.current,n,r,m);const h=f.useRef(!1);f.useInsertionEffect(()=>{u&&h.current&&u.update(n,l)});const y=n[jj],x=f.useRef(!!y&&!window.MotionHandoffIsComplete?.(y)&&window.MotionHasOptimisedAnimation?.(y));return xg(()=>{u&&(h.current=!0,window.MotionIsMounted=!0,u.updateFeatures(),u.scheduleRenderMicrotask(),x.current&&u.animationState&&u.animationState.animateChanges())}),f.useEffect(()=>{u&&(!x.current&&u.animationState&&u.animationState.animateChanges(),x.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(y)}),x.current=!1),u.enteringChildren=void 0)}),u}function Y4(t,s,n,i){const{layoutId:r,layout:a,drag:o,dragConstraints:l,layoutScroll:c,layoutRoot:d,layoutCrossfade:u}=s;t.projection=new n(t.latestValues,s["data-framer-portal-id"]?void 0:wj(t.parent)),t.projection.setOptions({layoutId:r,layout:a,alwaysMeasureLayout:!!o||l&&ri(l),visualElement:t,animationType:typeof a=="string"?a:"both",initialPromotionConfig:i,crossfade:u,layoutScroll:c,layoutRoot:d})}function wj(t){if(t)return t.options.allowProjection!==!1?t.projection:wj(t.parent)}function cl(t,{forwardMotionProps:s=!1}={},n,i){n&&k4(n);const r=Td(t)?W4:K4;function a(l,c){let d;const u={...f.useContext(kd),...l,layoutId:J4(l)},{isStatic:m}=u,h=T4(l),y=r(l,m);if(!m&&sd){X4();const x=eT(u);d=x.MeasureLayout,h.visualElement=Q4(t,y,u,i,x.ProjectionNode)}return e.jsxs(Ao.Provider,{value:h,children:[d&&h.visualElement?e.jsx(d,{visualElement:h.visualElement,...u}):null,B4(t,l,Z4(y,h.visualElement,c),y,m,s)]})}a.displayName=`motion.${typeof t=="string"?t:`create(${t.displayName??t.name??""})`}`;const o=f.forwardRef(a);return o[G4]=t,o}function J4({layoutId:t}){const s=f.useContext(ed).id;return s&&t!==void 0?s+"-"+t:t}function X4(t,s){f.useContext(lj).strict}function eT(t){const{drag:s,layout:n}=Si;if(!s&&!n)return{};const i={...s,...n};return{MeasureLayout:s?.isEnabled(t)||n?.isEnabled(t)?i.MeasureLayout:void 0,ProjectionNode:i.ProjectionNode}}function tT(t,s){if(typeof Proxy>"u")return cl;const n=new Map,i=(a,o)=>cl(a,o,t,s),r=(a,o)=>i(a,o);return new Proxy(r,{get:(a,o)=>o==="create"?i:(n.has(o)||n.set(o,cl(o,void 0,t,s)),n.get(o))})}function bj({top:t,left:s,right:n,bottom:i}){return{x:{min:s,max:n},y:{min:t,max:i}}}function sT({x:t,y:s}){return{top:s.min,right:t.max,bottom:s.max,left:t.min}}function nT(t,s){if(!s)return t;const n=s({x:t.left,y:t.top}),i=s({x:t.right,y:t.bottom});return{top:n.y,left:n.x,bottom:i.y,right:i.x}}function dl(t){return t===void 0||t===1}function Ql({scale:t,scaleX:s,scaleY:n}){return!dl(t)||!dl(s)||!dl(n)}function gn(t){return Ql(t)||vj(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function vj(t){return km(t.x)||km(t.y)}function km(t){return t&&t!=="0%"}function Va(t,s,n){const i=t-n,r=s*i;return n+r}function zm(t,s,n,i,r){return r!==void 0&&(t=Va(t,r,i)),Va(t,n,i)+s}function Yl(t,s=0,n=1,i,r){t.min=zm(t.min,s,n,i,r),t.max=zm(t.max,s,n,i,r)}function Nj(t,{x:s,y:n}){Yl(t.x,s.translate,s.scale,s.originPoint),Yl(t.y,n.translate,n.scale,n.originPoint)}const Sm=.999999999999,Cm=1.0000000000001;function iT(t,s,n,i=!1){const r=n.length;if(!r)return;s.x=s.y=1;let a,o;for(let l=0;l<r;l++){a=n[l],o=a.projectionDelta;const{visualElement:c}=a.options;c&&c.props.style&&c.props.style.display==="contents"||(i&&a.options.layoutScroll&&a.scroll&&a!==a.root&&oi(t,{x:-a.scroll.offset.x,y:-a.scroll.offset.y}),o&&(s.x*=o.x.scale,s.y*=o.y.scale,Nj(t,o)),i&&gn(a.latestValues)&&oi(t,a.latestValues))}s.x<Cm&&s.x>Sm&&(s.x=1),s.y<Cm&&s.y>Sm&&(s.y=1)}function ai(t,s){t.min=t.min+s,t.max=t.max+s}function _m(t,s,n,i,r=.5){const a=Pe(t.min,t.max,r);Yl(t,s,n,a,i)}function oi(t,s){_m(t.x,s.x,s.scaleX,s.scale,s.originX),_m(t.y,s.y,s.scaleY,s.scale,s.originY)}function kj(t,s){return bj(nT(t.getBoundingClientRect(),s))}function rT(t,s,n){const i=kj(t,n),{scroll:r}=s;return r&&(ai(i.x,r.offset.x),ai(i.y,r.offset.y)),i}const Tm=()=>({translate:0,scale:1,origin:0,originPoint:0}),li=()=>({x:Tm(),y:Tm()}),Am=()=>({min:0,max:0}),Oe=()=>({x:Am(),y:Am()}),Jl={current:null},zj={current:!1};function aT(){if(zj.current=!0,!!sd)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),s=()=>Jl.current=t.matches;t.addEventListener("change",s),s()}else Jl.current=!1}const oT=new WeakMap;function lT(t,s,n){for(const i in s){const r=s[i],a=n[i];if(ot(r))t.addValue(i,r);else if(ot(a))t.addValue(i,zi(r,{owner:t}));else if(a!==r)if(t.hasValue(i)){const o=t.getValue(i);o.liveStyle===!0?o.jump(r):o.hasAnimated||o.set(r)}else{const o=t.getStaticValue(i);t.addValue(i,zi(o!==void 0?o:r,{owner:t}))}}for(const i in n)s[i]===void 0&&t.removeValue(i);return s}const Dm=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class cT{scrapeMotionValuesFromProps(s,n,i){return{}}constructor({parent:s,props:n,presenceContext:i,reducedMotionConfig:r,blockInitialAnimation:a,visualState:o},l={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=yd,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const h=Nt.now();this.renderScheduledAt<h&&(this.renderScheduledAt=h,Te.render(this.render,!1,!0))};const{latestValues:c,renderState:d}=o;this.latestValues=c,this.baseTarget={...c},this.initialValues=n.initial?{...c}:{},this.renderState=d,this.parent=s,this.props=n,this.presenceContext=i,this.depth=s?s.depth+1:0,this.reducedMotionConfig=r,this.options=l,this.blockInitialAnimation=!!a,this.isControllingVariants=Po(n),this.isVariantNode=dj(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(s&&s.current);const{willChange:u,...m}=this.scrapeMotionValuesFromProps(n,{},this);for(const h in m){const y=m[h];c[h]!==void 0&&ot(y)&&y.set(c[h])}}mount(s){this.current=s,oT.set(s,this),this.projection&&!this.projection.instance&&this.projection.mount(s),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,i)=>this.bindToMotionValue(i,n)),zj.current||aT(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Jl.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),rn(this.notifyUpdate),rn(this.render),this.valueSubscriptions.forEach(s=>s()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const s in this.events)this.events[s].clear();for(const s in this.features){const n=this.features[s];n&&(n.unmount(),n.isMounted=!1)}this.current=null}addChild(s){this.children.add(s),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(s)}removeChild(s){this.children.delete(s),this.enteringChildren&&this.enteringChildren.delete(s)}bindToMotionValue(s,n){this.valueSubscriptions.has(s)&&this.valueSubscriptions.get(s)();const i=Fi.has(s);i&&this.onBindTransform&&this.onBindTransform();const r=n.on("change",o=>{this.latestValues[s]=o,this.props.onUpdate&&Te.preRender(this.notifyUpdate),i&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let a;window.MotionCheckAppearSync&&(a=window.MotionCheckAppearSync(this,s,n)),this.valueSubscriptions.set(s,()=>{r(),a&&a(),n.owner&&n.stop()})}sortNodePosition(s){return!this.current||!this.sortInstanceNodePosition||this.type!==s.type?0:this.sortInstanceNodePosition(this.current,s.current)}updateFeatures(){let s="animation";for(s in Si){const n=Si[s];if(!n)continue;const{isEnabled:i,Feature:r}=n;if(!this.features[s]&&r&&i(this.props)&&(this.features[s]=new r(this)),this.features[s]){const a=this.features[s];a.isMounted?a.update():(a.mount(),a.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Oe()}getStaticValue(s){return this.latestValues[s]}setStaticValue(s,n){this.latestValues[s]=n}update(s,n){(s.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=s,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let i=0;i<Dm.length;i++){const r=Dm[i];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const a="on"+r,o=s[a];o&&(this.propEventSubscriptions[r]=this.on(r,o))}this.prevMotionValues=lT(this,this.scrapeMotionValuesFromProps(s,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(s){return this.props.variants?this.props.variants[s]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(s){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(s),()=>n.variantChildren.delete(s)}addValue(s,n){const i=this.values.get(s);n!==i&&(i&&this.removeValue(s),this.bindToMotionValue(s,n),this.values.set(s,n),this.latestValues[s]=n.get())}removeValue(s){this.values.delete(s);const n=this.valueSubscriptions.get(s);n&&(n(),this.valueSubscriptions.delete(s)),delete this.latestValues[s],this.removeValueFromRenderState(s,this.renderState)}hasValue(s){return this.values.has(s)}getValue(s,n){if(this.props.values&&this.props.values[s])return this.props.values[s];let i=this.values.get(s);return i===void 0&&n!==void 0&&(i=zi(n===null?void 0:n,{owner:this}),this.addValue(s,i)),i}readValue(s,n){let i=this.latestValues[s]!==void 0||!this.current?this.latestValues[s]:this.getBaseTargetFromProps(this.props,s)??this.readValueFromInstance(this.current,s,this.options);return i!=null&&(typeof i=="string"&&(gg(i)||yg(i))?i=parseFloat(i):!j4(i)&&an.test(n)&&(i=ej(s,n)),this.setBaseTarget(s,ot(i)?i.get():i)),ot(i)?i.get():i}setBaseTarget(s,n){this.baseTarget[s]=n}getBaseTarget(s){const{initial:n}=this.props;let i;if(typeof n=="string"||typeof n=="object"){const a=Ad(this.props,n,this.presenceContext?.custom);a&&(i=a[s])}if(n&&i!==void 0)return i;const r=this.getBaseTargetFromProps(this.props,s);return r!==void 0&&!ot(r)?r:this.initialValues[s]!==void 0&&i===void 0?void 0:this.baseTarget[s]}on(s,n){return this.events[s]||(this.events[s]=new od),this.events[s].add(n)}notify(s,...n){this.events[s]&&this.events[s].notify(...n)}scheduleRenderMicrotask(){vd.render(this.render)}}class Sj extends cT{constructor(){super(...arguments),this.KeyframeResolver=a4}sortInstanceNodePosition(s,n){return s.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(s,n){return s.style?s.style[n]:void 0}removeValueFromRenderState(s,{vars:n,style:i}){delete n[s],delete i[s]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:s}=this.props;ot(s)&&(this.childSubscription=s.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}function Cj(t,{style:s,vars:n},i,r){const a=t.style;let o;for(o in s)a[o]=s[o];r?.applyProjectionStyles(a,i);for(o in n)a.setProperty(o,n[o])}function dT(t){return window.getComputedStyle(t)}class uT extends Sj{constructor(){super(...arguments),this.type="html",this.renderInstance=Cj}readValueFromInstance(s,n){if(Fi.has(n))return this.projection?.isProjecting?Ul(n):z_(s,n);{const i=dT(s),r=(dd(n)?i.getPropertyValue(n):i[n])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(s,{transformPagePoint:n}){return kj(s,n)}build(s,n,i){Cd(s,n,i.transformTemplate)}scrapeMotionValuesFromProps(s,n,i){return Dd(s,n,i)}}const _j=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function mT(t,s,n,i){Cj(t,s,void 0,i);for(const r in s.attrs)t.setAttribute(_j.has(r)?r:Pd(r),s.attrs[r])}class hT extends Sj{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Oe}getBaseTargetFromProps(s,n){return s[n]}readValueFromInstance(s,n){if(Fi.has(n)){const i=Xg(n);return i&&i.default||0}return n=_j.has(n)?n:Pd(n),s.getAttribute(n)}scrapeMotionValuesFromProps(s,n,i){return gj(s,n,i)}build(s,n,i){hj(s,n,this.isSVGTag,i.transformTemplate,i.style)}renderInstance(s,n,i,r){mT(s,n,i,r)}mount(s){this.isSVGTag=fj(s.tagName),super.mount(s)}}const pT=(t,s)=>Td(t)?new hT(s):new uT(s,{allowProjection:t!==f.Fragment});function hi(t,s,n){const i=t.getProps();return Ad(i,s,n!==void 0?n:i.custom,t)}const Xl=t=>Array.isArray(t);function fT(t,s,n){t.hasValue(s)?t.getValue(s).set(n):t.addValue(s,zi(n))}function xT(t){return Xl(t)?t[t.length-1]||0:t}function gT(t,s){const n=hi(t,s);let{transitionEnd:i={},transition:r={},...a}=n||{};a={...a,...i};for(const o in a){const l=xT(a[o]);fT(t,o,l)}}function jT(t){return!!(ot(t)&&t.add)}function ec(t,s){const n=t.getValue("willChange");if(jT(n))return n.add(s);if(!n&&$s.WillChange){const i=new $s.WillChange("auto");t.addValue("willChange",i),i.add(s)}}function Tj(t){return t.props[jj]}const yT=t=>t!==null;function wT(t,{repeat:s,repeatType:n="loop"},i){const r=t.filter(yT),a=s&&n!=="loop"&&s%2===1?0:r.length-1;return r[a]}const bT={type:"spring",stiffness:500,damping:25,restSpeed:10},vT=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),NT={type:"keyframes",duration:.8},kT={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},zT=(t,{keyframes:s})=>s.length>2?NT:Fi.has(t)?t.startsWith("scale")?vT(s[1]):bT:kT;function ST({when:t,delay:s,delayChildren:n,staggerChildren:i,staggerDirection:r,repeat:a,repeatType:o,repeatDelay:l,from:c,elapsed:d,...u}){return!!Object.keys(u).length}const Md=(t,s,n,i={},r,a)=>o=>{const l=wd(i,t)||{},c=l.delay||i.delay||0;let{elapsed:d=0}=i;d=d-fs(c);const u={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:s.getVelocity(),...l,delay:-d,onUpdate:h=>{s.set(h),l.onUpdate&&l.onUpdate(h)},onComplete:()=>{o(),l.onComplete&&l.onComplete()},name:t,motionValue:s,element:a?void 0:r};ST(l)||Object.assign(u,zT(t,u)),u.duration&&(u.duration=fs(u.duration)),u.repeatDelay&&(u.repeatDelay=fs(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let m=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(Zl(u),u.delay===0&&(m=!0)),($s.instantAnimations||$s.skipAnimations)&&(m=!0,Zl(u),u.delay=0),u.allowFlatten=!l.type&&!l.ease,m&&!a&&s.get()!==void 0){const h=wT(u.keyframes,l);if(h!==void 0){Te.update(()=>{u.onUpdate(h),u.onComplete()});return}}return l.isSync?new jd(u):new Z_(u)};function CT({protectedKeys:t,needsAnimating:s},n){const i=t.hasOwnProperty(n)&&s[n]!==!0;return s[n]=!1,i}function Aj(t,s,{delay:n=0,transitionOverride:i,type:r}={}){let{transition:a=t.getDefaultTransition(),transitionEnd:o,...l}=s;i&&(a=i);const c=[],d=r&&t.animationState&&t.animationState.getState()[r];for(const u in l){const m=t.getValue(u,t.latestValues[u]??null),h=l[u];if(h===void 0||d&&CT(d,u))continue;const y={delay:n,...wd(a||{},u)},x=m.get();if(x!==void 0&&!m.isAnimating&&!Array.isArray(h)&&h===x&&!y.velocity)continue;let g=!1;if(window.MotionHandoffAnimation){const w=Tj(t);if(w){const b=window.MotionHandoffAnimation(w,u,Te);b!==null&&(y.startTime=b,g=!0)}}ec(t,u),m.start(Md(u,m,h,t.shouldReduceMotion&&Qg.has(u)?{type:!1}:y,t,g));const j=m.animation;j&&c.push(j)}return o&&Promise.all(c).then(()=>{Te.update(()=>{o&&gT(t,o)})}),c}function Dj(t,s,n,i=0,r=1){const a=Array.from(t).sort((d,u)=>d.sortNodePosition(u)).indexOf(s),o=t.size,l=(o-1)*i;return typeof n=="function"?n(a,o):r===1?a*i:l-a*i}function tc(t,s,n={}){const i=hi(t,s,n.type==="exit"?t.presenceContext?.custom:void 0);let{transition:r=t.getDefaultTransition()||{}}=i||{};n.transitionOverride&&(r=n.transitionOverride);const a=i?()=>Promise.all(Aj(t,i,n)):()=>Promise.resolve(),o=t.variantChildren&&t.variantChildren.size?(c=0)=>{const{delayChildren:d=0,staggerChildren:u,staggerDirection:m}=r;return _T(t,s,c,d,u,m,n)}:()=>Promise.resolve(),{when:l}=r;if(l){const[c,d]=l==="beforeChildren"?[a,o]:[o,a];return c().then(()=>d())}else return Promise.all([a(),o(n.delay)])}function _T(t,s,n=0,i=0,r=0,a=1,o){const l=[];for(const c of t.variantChildren)c.notify("AnimationStart",s),l.push(tc(c,s,{...o,delay:n+(typeof i=="function"?0:i)+Dj(t.variantChildren,c,i,r,a)}).then(()=>c.notify("AnimationComplete",s)));return Promise.all(l)}function TT(t,s,n={}){t.notify("AnimationStart",s);let i;if(Array.isArray(s)){const r=s.map(a=>tc(t,a,n));i=Promise.all(r)}else if(typeof s=="string")i=tc(t,s,n);else{const r=typeof s=="function"?hi(t,s,n.custom):s;i=Promise.all(Aj(t,r,n))}return i.then(()=>{t.notify("AnimationComplete",s)})}function Pj(t,s){if(!Array.isArray(s))return!1;const n=s.length;if(n!==t.length)return!1;for(let i=0;i<n;i++)if(s[i]!==t[i])return!1;return!0}const AT=Sd.length;function Mj(t){if(!t)return;if(!t.isControllingVariants){const n=t.parent?Mj(t.parent)||{}:{};return t.props.initial!==void 0&&(n.initial=t.props.initial),n}const s={};for(let n=0;n<AT;n++){const i=Sd[n],r=t.props[i];(Mr(r)||r===!1)&&(s[i]=r)}return s}const DT=[...zd].reverse(),PT=zd.length;function MT(t){return s=>Promise.all(s.map(({animation:n,options:i})=>TT(t,n,i)))}function IT(t){let s=MT(t),n=Pm(),i=!0;const r=c=>(d,u)=>{const m=hi(t,u,c==="exit"?t.presenceContext?.custom:void 0);if(m){const{transition:h,transitionEnd:y,...x}=m;d={...d,...x,...y}}return d};function a(c){s=c(t)}function o(c){const{props:d}=t,u=Mj(t.parent)||{},m=[],h=new Set;let y={},x=1/0;for(let j=0;j<PT;j++){const w=DT[j],b=n[w],v=d[w]!==void 0?d[w]:u[w],C=Mr(v),_=w===c?b.isActive:null;_===!1&&(x=j);let S=v===u[w]&&v!==d[w]&&C;if(S&&i&&t.manuallyAnimateOnMount&&(S=!1),b.protectedKeys={...y},!b.isActive&&_===null||!v&&!b.prevProp||Do(v)||typeof v=="boolean")continue;const z=ET(b.prevProp,v);let k=z||w===c&&b.isActive&&!S&&C||j>x&&C,T=!1;const p=Array.isArray(v)?v:[v];let N=p.reduce(r(w),{});_===!1&&(N={});const{prevResolvedValues:A={}}=b,D={...A,...N},P=L=>{k=!0,h.has(L)&&(T=!0,h.delete(L)),b.needsAnimating[L]=!0;const U=t.getValue(L);U&&(U.liveStyle=!1)};for(const L in D){const U=N[L],O=A[L];if(y.hasOwnProperty(L))continue;let G=!1;Xl(U)&&Xl(O)?G=!Pj(U,O):G=U!==O,G?U!=null?P(L):h.add(L):U!==void 0&&h.has(L)?P(L):b.protectedKeys[L]=!0}b.prevProp=v,b.prevResolvedValues=N,b.isActive&&(y={...y,...N}),i&&t.blockInitialAnimation&&(k=!1);const R=S&&z;k&&(!R||T)&&m.push(...p.map(L=>{const U={type:w};if(typeof L=="string"&&i&&!R&&t.manuallyAnimateOnMount&&t.parent){const{parent:O}=t,G=hi(O,L);if(O.enteringChildren&&G){const{delayChildren:se}=G.transition||{};U.delay=Dj(O.enteringChildren,t,se)}}return{animation:L,options:U}}))}if(h.size){const j={};if(typeof d.initial!="boolean"){const w=hi(t,Array.isArray(d.initial)?d.initial[0]:d.initial);w&&w.transition&&(j.transition=w.transition)}h.forEach(w=>{const b=t.getBaseTarget(w),v=t.getValue(w);v&&(v.liveStyle=!0),j[w]=b??null}),m.push({animation:j})}let g=!!m.length;return i&&(d.initial===!1||d.initial===d.animate)&&!t.manuallyAnimateOnMount&&(g=!1),i=!1,g?s(m):Promise.resolve()}function l(c,d){if(n[c].isActive===d)return Promise.resolve();t.variantChildren?.forEach(m=>m.animationState?.setActive(c,d)),n[c].isActive=d;const u=o(c);for(const m in n)n[m].protectedKeys={};return u}return{animateChanges:o,setActive:l,setAnimateFunction:a,getState:()=>n,reset:()=>{n=Pm(),i=!0}}}function ET(t,s){return typeof s=="string"?s!==t:Array.isArray(s)?!Pj(s,t):!1}function xn(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Pm(){return{animate:xn(!0),whileInView:xn(),whileHover:xn(),whileTap:xn(),whileDrag:xn(),whileFocus:xn(),exit:xn()}}class pn{constructor(s){this.isMounted=!1,this.node=s}update(){}}class RT extends pn{constructor(s){super(s),s.animationState||(s.animationState=IT(s))}updateAnimationControlsSubscription(){const{animate:s}=this.node.getProps();Do(s)&&(this.unmountControls=s.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:s}=this.node.getProps(),{animate:n}=this.node.prevProps||{};s!==n&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let LT=0;class OT extends pn{constructor(){super(...arguments),this.id=LT++}update(){if(!this.node.presenceContext)return;const{isPresent:s,onExitComplete:n}=this.node.presenceContext,{isPresent:i}=this.node.prevPresenceContext||{};if(!this.node.animationState||s===i)return;const r=this.node.animationState.setActive("exit",!s);n&&!s&&r.then(()=>{n(this.id)})}mount(){const{register:s,onExitComplete:n}=this.node.presenceContext||{};n&&n(this.id),s&&(this.unmount=s(this.id))}unmount(){}}const $T={animation:{Feature:RT},exit:{Feature:OT}};function Er(t,s,n,i={passive:!0}){return t.addEventListener(s,n,i),()=>t.removeEventListener(s,n)}function Jr(t){return{point:{x:t.pageX,y:t.pageY}}}const FT=t=>s=>Nd(s)&&t(s,Jr(s));function cr(t,s,n,i){return Er(t,s,FT(n),i)}const Ij=1e-4,qT=1-Ij,BT=1+Ij,Ej=.01,UT=0-Ej,VT=0+Ej;function ft(t){return t.max-t.min}function KT(t,s,n){return Math.abs(t-s)<=n}function Mm(t,s,n,i=.5){t.origin=i,t.originPoint=Pe(s.min,s.max,t.origin),t.scale=ft(n)/ft(s),t.translate=Pe(n.min,n.max,t.origin)-t.originPoint,(t.scale>=qT&&t.scale<=BT||isNaN(t.scale))&&(t.scale=1),(t.translate>=UT&&t.translate<=VT||isNaN(t.translate))&&(t.translate=0)}function dr(t,s,n,i){Mm(t.x,s.x,n.x,i?i.originX:void 0),Mm(t.y,s.y,n.y,i?i.originY:void 0)}function Im(t,s,n){t.min=n.min+s.min,t.max=t.min+ft(s)}function WT(t,s,n){Im(t.x,s.x,n.x),Im(t.y,s.y,n.y)}function Em(t,s,n){t.min=s.min-n.min,t.max=t.min+ft(s)}function ur(t,s,n){Em(t.x,s.x,n.x),Em(t.y,s.y,n.y)}function Vt(t){return[t("x"),t("y")]}const Rj=({current:t})=>t?t.ownerDocument.defaultView:null,Rm=(t,s)=>Math.abs(t-s);function GT(t,s){const n=Rm(t.x,s.x),i=Rm(t.y,s.y);return Math.sqrt(n**2+i**2)}class Lj{constructor(s,n,{transformPagePoint:i,contextWindow:r=window,dragSnapToOrigin:a=!1,distanceThreshold:o=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const h=ml(this.lastMoveEventInfo,this.history),y=this.startEvent!==null,x=GT(h.offset,{x:0,y:0})>=this.distanceThreshold;if(!y&&!x)return;const{point:g}=h,{timestamp:j}=nt;this.history.push({...g,timestamp:j});const{onStart:w,onMove:b}=this.handlers;y||(w&&w(this.lastMoveEvent,h),this.startEvent=this.lastMoveEvent),b&&b(this.lastMoveEvent,h)},this.handlePointerMove=(h,y)=>{this.lastMoveEvent=h,this.lastMoveEventInfo=ul(y,this.transformPagePoint),Te.update(this.updatePoint,!0)},this.handlePointerUp=(h,y)=>{this.end();const{onEnd:x,onSessionEnd:g,resumeAnimation:j}=this.handlers;if(this.dragSnapToOrigin&&j&&j(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const w=ml(h.type==="pointercancel"?this.lastMoveEventInfo:ul(y,this.transformPagePoint),this.history);this.startEvent&&x&&x(h,w),g&&g(h,w)},!Nd(s))return;this.dragSnapToOrigin=a,this.handlers=n,this.transformPagePoint=i,this.distanceThreshold=o,this.contextWindow=r||window;const l=Jr(s),c=ul(l,this.transformPagePoint),{point:d}=c,{timestamp:u}=nt;this.history=[{...d,timestamp:u}];const{onSessionStart:m}=n;m&&m(s,ml(c,this.history)),this.removeListeners=Hr(cr(this.contextWindow,"pointermove",this.handlePointerMove),cr(this.contextWindow,"pointerup",this.handlePointerUp),cr(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(s){this.handlers=s}end(){this.removeListeners&&this.removeListeners(),rn(this.updatePoint)}}function ul(t,s){return s?{point:s(t.point)}:t}function Lm(t,s){return{x:t.x-s.x,y:t.y-s.y}}function ml({point:t},s){return{point:t,delta:Lm(t,Oj(s)),offset:Lm(t,ZT(s)),velocity:HT(s,.1)}}function ZT(t){return t[0]}function Oj(t){return t[t.length-1]}function HT(t,s){if(t.length<2)return{x:0,y:0};let n=t.length-1,i=null;const r=Oj(t);for(;n>=0&&(i=t[n],!(r.timestamp-i.timestamp>fs(s)));)n--;if(!i)return{x:0,y:0};const a=xs(r.timestamp-i.timestamp);if(a===0)return{x:0,y:0};const o={x:(r.x-i.x)/a,y:(r.y-i.y)/a};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function QT(t,{min:s,max:n},i){return s!==void 0&&t<s?t=i?Pe(s,t,i.min):Math.max(t,s):n!==void 0&&t>n&&(t=i?Pe(n,t,i.max):Math.min(t,n)),t}function Om(t,s,n){return{min:s!==void 0?t.min+s:void 0,max:n!==void 0?t.max+n-(t.max-t.min):void 0}}function YT(t,{top:s,left:n,bottom:i,right:r}){return{x:Om(t.x,n,r),y:Om(t.y,s,i)}}function $m(t,s){let n=s.min-t.min,i=s.max-t.max;return s.max-s.min<t.max-t.min&&([n,i]=[i,n]),{min:n,max:i}}function JT(t,s){return{x:$m(t.x,s.x),y:$m(t.y,s.y)}}function XT(t,s){let n=.5;const i=ft(t),r=ft(s);return r>i?n=Ar(s.min,s.max-i,t.min):i>r&&(n=Ar(t.min,t.max-r,s.min)),Os(0,1,n)}function eA(t,s){const n={};return s.min!==void 0&&(n.min=s.min-t.min),s.max!==void 0&&(n.max=s.max-t.min),n}const sc=.35;function tA(t=sc){return t===!1?t=0:t===!0&&(t=sc),{x:Fm(t,"left","right"),y:Fm(t,"top","bottom")}}function Fm(t,s,n){return{min:qm(t,s),max:qm(t,n)}}function qm(t,s){return typeof t=="number"?t:t[s]||0}const sA=new WeakMap;class nA{constructor(s){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Oe(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=s}start(s,{snapToCursor:n=!1,distanceThreshold:i}={}){const{presenceContext:r}=this.visualElement;if(r&&r.isPresent===!1)return;const a=m=>{const{dragSnapToOrigin:h}=this.getProps();h?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(Jr(m).point)},o=(m,h)=>{const{drag:y,dragPropagation:x,onDragStart:g}=this.getProps();if(y&&!x&&(this.openDragLock&&this.openDragLock(),this.openDragLock=d4(y),!this.openDragLock))return;this.latestPointerEvent=m,this.latestPanInfo=h,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Vt(w=>{let b=this.getAxisMotionValue(w).get()||0;if(gs.test(b)){const{projection:v}=this.visualElement;if(v&&v.layout){const C=v.layout.layoutBox[w];C&&(b=ft(C)*(parseFloat(b)/100))}}this.originPoint[w]=b}),g&&Te.postRender(()=>g(m,h)),ec(this.visualElement,"transform");const{animationState:j}=this.visualElement;j&&j.setActive("whileDrag",!0)},l=(m,h)=>{this.latestPointerEvent=m,this.latestPanInfo=h;const{dragPropagation:y,dragDirectionLock:x,onDirectionLock:g,onDrag:j}=this.getProps();if(!y&&!this.openDragLock)return;const{offset:w}=h;if(x&&this.currentDirection===null){this.currentDirection=iA(w),this.currentDirection!==null&&g&&g(this.currentDirection);return}this.updateAxis("x",h.point,w),this.updateAxis("y",h.point,w),this.visualElement.render(),j&&j(m,h)},c=(m,h)=>{this.latestPointerEvent=m,this.latestPanInfo=h,this.stop(m,h),this.latestPointerEvent=null,this.latestPanInfo=null},d=()=>Vt(m=>this.getAnimationState(m)==="paused"&&this.getAxisMotionValue(m).animation?.play()),{dragSnapToOrigin:u}=this.getProps();this.panSession=new Lj(s,{onSessionStart:a,onStart:o,onMove:l,onSessionEnd:c,resumeAnimation:d},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:u,distanceThreshold:i,contextWindow:Rj(this.visualElement)})}stop(s,n){const i=s||this.latestPointerEvent,r=n||this.latestPanInfo,a=this.isDragging;if(this.cancel(),!a||!r||!i)return;const{velocity:o}=r;this.startAnimation(o);const{onDragEnd:l}=this.getProps();l&&Te.postRender(()=>l(i,r))}cancel(){this.isDragging=!1;const{projection:s,animationState:n}=this.visualElement;s&&(s.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:i}=this.getProps();!i&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(s,n,i){const{drag:r}=this.getProps();if(!i||!ha(s,r,this.currentDirection))return;const a=this.getAxisMotionValue(s);let o=this.originPoint[s]+i[s];this.constraints&&this.constraints[s]&&(o=QT(o,this.constraints[s],this.elastic[s])),a.set(o)}resolveConstraints(){const{dragConstraints:s,dragElastic:n}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,r=this.constraints;s&&ri(s)?this.constraints||(this.constraints=this.resolveRefConstraints()):s&&i?this.constraints=YT(i.layoutBox,s):this.constraints=!1,this.elastic=tA(n),r!==this.constraints&&i&&this.constraints&&!this.hasMutatedConstraints&&Vt(a=>{this.constraints!==!1&&this.getAxisMotionValue(a)&&(this.constraints[a]=eA(i.layoutBox[a],this.constraints[a]))})}resolveRefConstraints(){const{dragConstraints:s,onMeasureDragConstraints:n}=this.getProps();if(!s||!ri(s))return!1;const i=s.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const a=rT(i,r.root,this.visualElement.getTransformPagePoint());let o=JT(r.layout.layoutBox,a);if(n){const l=n(sT(o));this.hasMutatedConstraints=!!l,l&&(o=bj(l))}return o}startAnimation(s){const{drag:n,dragMomentum:i,dragElastic:r,dragTransition:a,dragSnapToOrigin:o,onDragTransitionEnd:l}=this.getProps(),c=this.constraints||{},d=Vt(u=>{if(!ha(u,n,this.currentDirection))return;let m=c&&c[u]||{};o&&(m={min:0,max:0});const h=r?200:1e6,y=r?40:1e7,x={type:"inertia",velocity:i?s[u]:0,bounceStiffness:h,bounceDamping:y,timeConstant:750,restDelta:1,restSpeed:10,...a,...m};return this.startAxisValueAnimation(u,x)});return Promise.all(d).then(l)}startAxisValueAnimation(s,n){const i=this.getAxisMotionValue(s);return ec(this.visualElement,s),i.start(Md(s,i,0,n,this.visualElement,!1))}stopAnimation(){Vt(s=>this.getAxisMotionValue(s).stop())}pauseAnimation(){Vt(s=>this.getAxisMotionValue(s).animation?.pause())}getAnimationState(s){return this.getAxisMotionValue(s).animation?.state}getAxisMotionValue(s){const n=`_drag${s.toUpperCase()}`,i=this.visualElement.getProps(),r=i[n];return r||this.visualElement.getValue(s,(i.initial?i.initial[s]:void 0)||0)}snapToCursor(s){Vt(n=>{const{drag:i}=this.getProps();if(!ha(n,i,this.currentDirection))return;const{projection:r}=this.visualElement,a=this.getAxisMotionValue(n);if(r&&r.layout){const{min:o,max:l}=r.layout.layoutBox[n];a.set(s[n]-Pe(o,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:s,dragConstraints:n}=this.getProps(),{projection:i}=this.visualElement;if(!ri(n)||!i||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};Vt(o=>{const l=this.getAxisMotionValue(o);if(l&&this.constraints!==!1){const c=l.get();r[o]=XT({min:c,max:c},this.constraints[o])}});const{transformTemplate:a}=this.visualElement.getProps();this.visualElement.current.style.transform=a?a({},""):"none",i.root&&i.root.updateScroll(),i.updateLayout(),this.resolveConstraints(),Vt(o=>{if(!ha(o,s,null))return;const l=this.getAxisMotionValue(o),{min:c,max:d}=this.constraints[o];l.set(Pe(c,d,r[o]))})}addListeners(){if(!this.visualElement.current)return;sA.set(this.visualElement,this);const s=this.visualElement.current,n=cr(s,"pointerdown",c=>{const{drag:d,dragListener:u=!0}=this.getProps();d&&u&&this.start(c)}),i=()=>{const{dragConstraints:c}=this.getProps();ri(c)&&c.current&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,a=r.addEventListener("measure",i);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),Te.read(i);const o=Er(window,"resize",()=>this.scalePositionWithinConstraints()),l=r.addEventListener("didUpdate",({delta:c,hasLayoutChanged:d})=>{this.isDragging&&d&&(Vt(u=>{const m=this.getAxisMotionValue(u);m&&(this.originPoint[u]+=c[u].translate,m.set(m.get()+c[u].translate))}),this.visualElement.render())});return()=>{o(),n(),a(),l&&l()}}getProps(){const s=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:i=!1,dragPropagation:r=!1,dragConstraints:a=!1,dragElastic:o=sc,dragMomentum:l=!0}=s;return{...s,drag:n,dragDirectionLock:i,dragPropagation:r,dragConstraints:a,dragElastic:o,dragMomentum:l}}}function ha(t,s,n){return(s===!0||s===t)&&(n===null||n===t)}function iA(t,s=10){let n=null;return Math.abs(t.y)>s?n="y":Math.abs(t.x)>s&&(n="x"),n}class rA extends pn{constructor(s){super(s),this.removeGroupControls=Qt,this.removeListeners=Qt,this.controls=new nA(s)}mount(){const{dragControls:s}=this.node.getProps();s&&(this.removeGroupControls=s.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Qt}unmount(){this.removeGroupControls(),this.removeListeners()}}const Bm=t=>(s,n)=>{t&&Te.postRender(()=>t(s,n))};class aA extends pn{constructor(){super(...arguments),this.removePointerDownListener=Qt}onPointerDown(s){this.session=new Lj(s,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Rj(this.node)})}createPanHandlers(){const{onPanSessionStart:s,onPanStart:n,onPan:i,onPanEnd:r}=this.node.getProps();return{onSessionStart:Bm(s),onStart:Bm(n),onMove:i,onEnd:(a,o)=>{delete this.session,r&&Te.postRender(()=>r(a,o))}}}mount(){this.removePointerDownListener=cr(this.node.current,"pointerdown",s=>this.onPointerDown(s))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const ka={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function Um(t,s){return s.max===s.min?0:t/(s.max-s.min)*100}const Hi={correct:(t,s)=>{if(!s.target)return t;if(typeof t=="string")if(ee.test(t))t=parseFloat(t);else return t;const n=Um(t,s.target.x),i=Um(t,s.target.y);return`${n}% ${i}%`}},oA={correct:(t,{treeScale:s,projectionDelta:n})=>{const i=t,r=an.parse(t);if(r.length>5)return i;const a=an.createTransformer(t),o=typeof r[0]!="number"?1:0,l=n.x.scale*s.x,c=n.y.scale*s.y;r[0+o]/=l,r[1+o]/=c;const d=Pe(l,c,.5);return typeof r[2+o]=="number"&&(r[2+o]/=d),typeof r[3+o]=="number"&&(r[3+o]/=d),a(r)}};let hl=!1;class lA extends f.Component{componentDidMount(){const{visualElement:s,layoutGroup:n,switchLayoutGroup:i,layoutId:r}=this.props,{projection:a}=s;A4(cA),a&&(n.group&&n.group.add(a),i&&i.register&&r&&i.register(a),hl&&a.root.didUpdate(),a.addEventListener("animationComplete",()=>{this.safeToRemove()}),a.setOptions({...a.options,onExitComplete:()=>this.safeToRemove()})),ka.hasEverUpdated=!0}getSnapshotBeforeUpdate(s){const{layoutDependency:n,visualElement:i,drag:r,isPresent:a}=this.props,{projection:o}=i;return o&&(o.isPresent=a,hl=!0,r||s.layoutDependency!==n||n===void 0||s.isPresent!==a?o.willUpdate():this.safeToRemove(),s.isPresent!==a&&(a?o.promote():o.relegate()||Te.postRender(()=>{const l=o.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:s}=this.props.visualElement;s&&(s.root.didUpdate(),vd.postRender(()=>{!s.currentAnimation&&s.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:s,layoutGroup:n,switchLayoutGroup:i}=this.props,{projection:r}=s;hl=!0,r&&(r.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(r),i&&i.deregister&&i.deregister(r))}safeToRemove(){const{safeToRemove:s}=this.props;s&&s()}render(){return null}}function $j(t){const[s,n]=oj(),i=f.useContext(ed);return e.jsx(lA,{...t,layoutGroup:i,switchLayoutGroup:f.useContext(yj),isPresent:s,safeToRemove:n})}const cA={borderRadius:{...Hi,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Hi,borderTopRightRadius:Hi,borderBottomLeftRadius:Hi,borderBottomRightRadius:Hi,boxShadow:oA};function dA(t,s,n){const i=ot(t)?t:zi(t);return i.start(Md("",i,s,n)),i.animation}const uA=(t,s)=>t.depth-s.depth;class mA{constructor(){this.children=[],this.isDirty=!1}add(s){nd(this.children,s),this.isDirty=!0}remove(s){id(this.children,s),this.isDirty=!0}forEach(s){this.isDirty&&this.children.sort(uA),this.isDirty=!1,this.children.forEach(s)}}function hA(t,s){const n=Nt.now(),i=({timestamp:r})=>{const a=r-n;a>=s&&(rn(i),t(a-s))};return Te.setup(i,!0),()=>rn(i)}const Fj=["TopLeft","TopRight","BottomLeft","BottomRight"],pA=Fj.length,Vm=t=>typeof t=="string"?parseFloat(t):t,Km=t=>typeof t=="number"||ee.test(t);function fA(t,s,n,i,r,a){r?(t.opacity=Pe(0,n.opacity??1,xA(i)),t.opacityExit=Pe(s.opacity??1,0,gA(i))):a&&(t.opacity=Pe(s.opacity??1,n.opacity??1,i));for(let o=0;o<pA;o++){const l=`border${Fj[o]}Radius`;let c=Wm(s,l),d=Wm(n,l);if(c===void 0&&d===void 0)continue;c||(c=0),d||(d=0),c===0||d===0||Km(c)===Km(d)?(t[l]=Math.max(Pe(Vm(c),Vm(d),i),0),(gs.test(d)||gs.test(c))&&(t[l]+="%")):t[l]=d}(s.rotate||n.rotate)&&(t.rotate=Pe(s.rotate||0,n.rotate||0,i))}function Wm(t,s){return t[s]!==void 0?t[s]:t.borderRadius}const xA=qj(0,.5,Cg),gA=qj(.5,.95,Qt);function qj(t,s,n){return i=>i<t?0:i>s?1:n(Ar(t,s,i))}function Gm(t,s){t.min=s.min,t.max=s.max}function Ut(t,s){Gm(t.x,s.x),Gm(t.y,s.y)}function Zm(t,s){t.translate=s.translate,t.scale=s.scale,t.originPoint=s.originPoint,t.origin=s.origin}function Hm(t,s,n,i,r){return t-=s,t=Va(t,1/n,i),r!==void 0&&(t=Va(t,1/r,i)),t}function jA(t,s=0,n=1,i=.5,r,a=t,o=t){if(gs.test(s)&&(s=parseFloat(s),s=Pe(o.min,o.max,s/100)-o.min),typeof s!="number")return;let l=Pe(a.min,a.max,i);t===a&&(l-=s),t.min=Hm(t.min,s,n,l,r),t.max=Hm(t.max,s,n,l,r)}function Qm(t,s,[n,i,r],a,o){jA(t,s[n],s[i],s[r],s.scale,a,o)}const yA=["x","scaleX","originX"],wA=["y","scaleY","originY"];function Ym(t,s,n,i){Qm(t.x,s,yA,n?n.x:void 0,i?i.x:void 0),Qm(t.y,s,wA,n?n.y:void 0,i?i.y:void 0)}function Jm(t){return t.translate===0&&t.scale===1}function Bj(t){return Jm(t.x)&&Jm(t.y)}function Xm(t,s){return t.min===s.min&&t.max===s.max}function bA(t,s){return Xm(t.x,s.x)&&Xm(t.y,s.y)}function eh(t,s){return Math.round(t.min)===Math.round(s.min)&&Math.round(t.max)===Math.round(s.max)}function Uj(t,s){return eh(t.x,s.x)&&eh(t.y,s.y)}function th(t){return ft(t.x)/ft(t.y)}function sh(t,s){return t.translate===s.translate&&t.scale===s.scale&&t.originPoint===s.originPoint}class vA{constructor(){this.members=[]}add(s){nd(this.members,s),s.scheduleRender()}remove(s){if(id(this.members,s),s===this.prevLead&&(this.prevLead=void 0),s===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(s){const n=this.members.findIndex(r=>s===r);if(n===0)return!1;let i;for(let r=n;r>=0;r--){const a=this.members[r];if(a.isPresent!==!1){i=a;break}}return i?(this.promote(i),!0):!1}promote(s,n){const i=this.lead;if(s!==i&&(this.prevLead=i,this.lead=s,s.show(),i)){i.instance&&i.scheduleRender(),s.scheduleRender(),s.resumeFrom=i,n&&(s.resumeFrom.preserveOpacity=!0),i.snapshot&&(s.snapshot=i.snapshot,s.snapshot.latestValues=i.animationValues||i.latestValues),s.root&&s.root.isUpdating&&(s.isLayoutDirty=!0);const{crossfade:r}=s.options;r===!1&&i.hide()}}exitAnimationComplete(){this.members.forEach(s=>{const{options:n,resumingFrom:i}=s;n.onExitComplete&&n.onExitComplete(),i&&i.options.onExitComplete&&i.options.onExitComplete()})}scheduleRender(){this.members.forEach(s=>{s.instance&&s.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function NA(t,s,n){let i="";const r=t.x.translate/s.x,a=t.y.translate/s.y,o=n?.z||0;if((r||a||o)&&(i=`translate3d(${r}px, ${a}px, ${o}px) `),(s.x!==1||s.y!==1)&&(i+=`scale(${1/s.x}, ${1/s.y}) `),n){const{transformPerspective:d,rotate:u,rotateX:m,rotateY:h,skewX:y,skewY:x}=n;d&&(i=`perspective(${d}px) ${i}`),u&&(i+=`rotate(${u}deg) `),m&&(i+=`rotateX(${m}deg) `),h&&(i+=`rotateY(${h}deg) `),y&&(i+=`skewX(${y}deg) `),x&&(i+=`skewY(${x}deg) `)}const l=t.x.scale*s.x,c=t.y.scale*s.y;return(l!==1||c!==1)&&(i+=`scale(${l}, ${c})`),i||"none"}const pl=["","X","Y","Z"],kA=1e3;let zA=0;function fl(t,s,n,i){const{latestValues:r}=s;r[t]&&(n[t]=r[t],s.setStaticValue(t,0),i&&(i[t]=0))}function Vj(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:s}=t.options;if(!s)return;const n=Tj(s);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:r,layoutId:a}=t.options;window.MotionCancelOptimisedAnimation(n,"transform",Te,!(r||a))}const{parent:i}=t;i&&!i.hasCheckedOptimisedAppear&&Vj(i)}function Kj({attachResizeListener:t,defaultParent:s,measureScroll:n,checkIsScrollRoot:i,resetTransform:r}){return class{constructor(o={},l=s?.()){this.id=zA++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(_A),this.nodes.forEach(PA),this.nodes.forEach(MA),this.nodes.forEach(TA)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new mA)}addEventListener(o,l){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new od),this.eventHandlers.get(o).add(l)}notifyListeners(o,...l){const c=this.eventHandlers.get(o);c&&c.notify(...l)}hasListeners(o){return this.eventHandlers.has(o)}mount(o){if(this.instance)return;this.isSVG=aj(o)&&!x4(o),this.instance=o;const{layoutId:l,layout:c,visualElement:d}=this.options;if(d&&!d.current&&d.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(c||l)&&(this.isLayoutDirty=!0),t){let u,m=0;const h=()=>this.root.updateBlockedByResize=!1;Te.read(()=>{m=window.innerWidth}),t(o,()=>{const y=window.innerWidth;y!==m&&(m=y,this.root.updateBlockedByResize=!0,u&&u(),u=hA(h,250),ka.hasAnimatedSinceResize&&(ka.hasAnimatedSinceResize=!1,this.nodes.forEach(rh)))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&d&&(l||c)&&this.addEventListener("didUpdate",({delta:u,hasLayoutChanged:m,hasRelativeLayoutChanged:h,layout:y})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const x=this.options.transition||d.getDefaultTransition()||OA,{onLayoutAnimationStart:g,onLayoutAnimationComplete:j}=d.getProps(),w=!this.targetLayout||!Uj(this.targetLayout,y),b=!m&&h;if(this.options.layoutRoot||this.resumeFrom||b||m&&(w||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const v={...wd(x,"layout"),onPlay:g,onComplete:j};(d.shouldReduceMotion||this.options.layoutRoot)&&(v.delay=0,v.type=!1),this.startAnimation(v),this.setAnimationOrigin(u,b)}else m||rh(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=y})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),rn(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(IA),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Vj(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const m=this.path[u];m.shouldResetTransform=!0,m.updateScroll("snapshot"),m.options.layoutRoot&&m.willUpdate(!1)}const{layoutId:l,layout:c}=this.options;if(l===void 0&&!c)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(nh);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(ih);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(DA),this.nodes.forEach(SA),this.nodes.forEach(CA)):this.nodes.forEach(ih),this.clearAllSnapshots();const l=Nt.now();nt.delta=Os(0,1e3/60,l-nt.timestamp),nt.timestamp=l,nt.isProcessing=!0,nl.update.process(nt),nl.preRender.process(nt),nl.render.process(nt),nt.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,vd.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(AA),this.sharedNodes.forEach(EA)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Te.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Te.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!ft(this.snapshot.measuredBox.x)&&!ft(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Oe(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let l=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(l=!1),l&&this.instance){const c=i(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:c,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!r)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,l=this.projectionDelta&&!Bj(this.projectionDelta),c=this.getTransformTemplate(),d=c?c(this.latestValues,""):void 0,u=d!==this.prevTransformTemplateValue;o&&this.instance&&(l||gn(this.latestValues)||u)&&(r(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const l=this.measurePageBox();let c=this.removeElementScroll(l);return o&&(c=this.removeTransform(c)),$A(c),{animationId:this.root.animationId,measuredBox:l,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:o}=this.options;if(!o)return Oe();const l=o.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(FA))){const{scroll:d}=this.root;d&&(ai(l.x,d.offset.x),ai(l.y,d.offset.y))}return l}removeElementScroll(o){const l=Oe();if(Ut(l,o),this.scroll?.wasRoot)return l;for(let c=0;c<this.path.length;c++){const d=this.path[c],{scroll:u,options:m}=d;d!==this.root&&u&&m.layoutScroll&&(u.wasRoot&&Ut(l,o),ai(l.x,u.offset.x),ai(l.y,u.offset.y))}return l}applyTransform(o,l=!1){const c=Oe();Ut(c,o);for(let d=0;d<this.path.length;d++){const u=this.path[d];!l&&u.options.layoutScroll&&u.scroll&&u!==u.root&&oi(c,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),gn(u.latestValues)&&oi(c,u.latestValues)}return gn(this.latestValues)&&oi(c,this.latestValues),c}removeTransform(o){const l=Oe();Ut(l,o);for(let c=0;c<this.path.length;c++){const d=this.path[c];if(!d.instance||!gn(d.latestValues))continue;Ql(d.latestValues)&&d.updateSnapshot();const u=Oe(),m=d.measurePageBox();Ut(u,m),Ym(l,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,u)}return gn(this.latestValues)&&Ym(l,this.latestValues),l}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==nt.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==l;if(!(o||c&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:u,layoutId:m}=this.options;if(!(!this.layout||!(u||m))){if(this.resolvedRelativeTargetAt=nt.timestamp,!this.targetDelta&&!this.relativeTarget){const h=this.getClosestProjectingParent();h&&h.layout&&this.animationProgress!==1?(this.relativeParent=h,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Oe(),this.relativeTargetOrigin=Oe(),ur(this.relativeTargetOrigin,this.layout.layoutBox,h.layout.layoutBox),Ut(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Oe(),this.targetWithTransforms=Oe()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),WT(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Ut(this.target,this.layout.layoutBox),Nj(this.target,this.targetDelta)):Ut(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const h=this.getClosestProjectingParent();h&&!!h.resumingFrom==!!this.resumingFrom&&!h.options.layoutScroll&&h.target&&this.animationProgress!==1?(this.relativeParent=h,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Oe(),this.relativeTargetOrigin=Oe(),ur(this.relativeTargetOrigin,this.target,h.target),Ut(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||Ql(this.parent.latestValues)||vj(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const o=this.getLead(),l=!!this.resumingFrom||this!==o;let c=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===nt.timestamp&&(c=!1),c)return;const{layout:d,layoutId:u}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(d||u))return;Ut(this.layoutCorrected,this.layout.layoutBox);const m=this.treeScale.x,h=this.treeScale.y;iT(this.layoutCorrected,this.treeScale,this.path,l),o.layout&&!o.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(o.target=o.layout.layoutBox,o.targetWithTransforms=Oe());const{target:y}=o;if(!y){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(Zm(this.prevProjectionDelta.x,this.projectionDelta.x),Zm(this.prevProjectionDelta.y,this.projectionDelta.y)),dr(this.projectionDelta,this.layoutCorrected,y,this.latestValues),(this.treeScale.x!==m||this.treeScale.y!==h||!sh(this.projectionDelta.x,this.prevProjectionDelta.x)||!sh(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",y))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){if(this.options.visualElement?.scheduleRender(),o){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=li(),this.projectionDelta=li(),this.projectionDeltaWithTransform=li()}setAnimationOrigin(o,l=!1){const c=this.snapshot,d=c?c.latestValues:{},u={...this.latestValues},m=li();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const h=Oe(),y=c?c.source:void 0,x=this.layout?this.layout.source:void 0,g=y!==x,j=this.getStack(),w=!j||j.members.length<=1,b=!!(g&&!w&&this.options.crossfade===!0&&!this.path.some(LA));this.animationProgress=0;let v;this.mixTargetDelta=C=>{const _=C/1e3;ah(m.x,o.x,_),ah(m.y,o.y,_),this.setTargetDelta(m),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(ur(h,this.layout.layoutBox,this.relativeParent.layout.layoutBox),RA(this.relativeTarget,this.relativeTargetOrigin,h,_),v&&bA(this.relativeTarget,v)&&(this.isProjectionDirty=!1),v||(v=Oe()),Ut(v,this.relativeTarget)),g&&(this.animationValues=u,fA(u,d,this.latestValues,_,b,w)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=_},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(rn(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Te.update(()=>{ka.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=zi(0)),this.currentAnimation=dA(this.motionValue,[0,1e3],{...o,velocity:0,isSync:!0,onUpdate:l=>{this.mixTargetDelta(l),o.onUpdate&&o.onUpdate(l)},onStop:()=>{},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(kA),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:l,target:c,layout:d,latestValues:u}=o;if(!(!l||!c||!d)){if(this!==o&&this.layout&&d&&Wj(this.options.animationType,this.layout.layoutBox,d.layoutBox)){c=this.target||Oe();const m=ft(this.layout.layoutBox.x);c.x.min=o.target.x.min,c.x.max=c.x.min+m;const h=ft(this.layout.layoutBox.y);c.y.min=o.target.y.min,c.y.max=c.y.min+h}Ut(l,c),oi(l,u),dr(this.projectionDeltaWithTransform,this.layoutCorrected,l,u)}}registerSharedNode(o,l){this.sharedNodes.has(o)||this.sharedNodes.set(o,new vA),this.sharedNodes.get(o).add(l);const d=l.options.initialPromotionConfig;l.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(l):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){const{layoutId:o}=this.options;return o?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:o}=this.options;return o?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:l,preserveFollowOpacity:c}={}){const d=this.getStack();d&&d.promote(this,c),o&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let l=!1;const{latestValues:c}=o;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(l=!0),!l)return;const d={};c.z&&fl("z",o,d,this.animationValues);for(let u=0;u<pl.length;u++)fl(`rotate${pl[u]}`,o,d,this.animationValues),fl(`skew${pl[u]}`,o,d,this.animationValues);o.render();for(const u in d)o.setStaticValue(u,d[u]),this.animationValues&&(this.animationValues[u]=d[u]);o.scheduleRender()}applyProjectionStyles(o,l){if(!this.instance||this.isSVG)return;if(!this.isVisible){o.visibility="hidden";return}const c=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,o.visibility="",o.opacity="",o.pointerEvents=Na(l?.pointerEvents)||"",o.transform=c?c(this.latestValues,""):"none";return}const d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){this.options.layoutId&&(o.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,o.pointerEvents=Na(l?.pointerEvents)||""),this.hasProjected&&!gn(this.latestValues)&&(o.transform=c?c({},""):"none",this.hasProjected=!1);return}o.visibility="";const u=d.animationValues||d.latestValues;this.applyTransformsToTarget();let m=NA(this.projectionDeltaWithTransform,this.treeScale,u);c&&(m=c(u,m)),o.transform=m;const{x:h,y}=this.projectionDelta;o.transformOrigin=`${h.origin*100}% ${y.origin*100}% 0`,d.animationValues?o.opacity=d===this?u.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:u.opacityExit:o.opacity=d===this?u.opacity!==void 0?u.opacity:"":u.opacityExit!==void 0?u.opacityExit:0;for(const x in Ir){if(u[x]===void 0)continue;const{correct:g,applyTo:j,isCSSVariable:w}=Ir[x],b=m==="none"?u[x]:g(u[x],d);if(j){const v=j.length;for(let C=0;C<v;C++)o[j[C]]=b}else w?this.options.visualElement.renderState.vars[x]=b:o[x]=b}this.options.layoutId&&(o.pointerEvents=d===this?Na(l?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>o.currentAnimation?.stop()),this.root.nodes.forEach(nh),this.root.sharedNodes.clear()}}}function SA(t){t.updateLayout()}function CA(t){const s=t.resumeFrom?.snapshot||t.snapshot;if(t.isLead()&&t.layout&&s&&t.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:i}=t.layout,{animationType:r}=t.options,a=s.source!==t.layout.source;r==="size"?Vt(u=>{const m=a?s.measuredBox[u]:s.layoutBox[u],h=ft(m);m.min=n[u].min,m.max=m.min+h}):Wj(r,s.layoutBox,n)&&Vt(u=>{const m=a?s.measuredBox[u]:s.layoutBox[u],h=ft(n[u]);m.max=m.min+h,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[u].max=t.relativeTarget[u].min+h)});const o=li();dr(o,n,s.layoutBox);const l=li();a?dr(l,t.applyTransform(i,!0),s.measuredBox):dr(l,n,s.layoutBox);const c=!Bj(o);let d=!1;if(!t.resumeFrom){const u=t.getClosestProjectingParent();if(u&&!u.resumeFrom){const{snapshot:m,layout:h}=u;if(m&&h){const y=Oe();ur(y,s.layoutBox,m.layoutBox);const x=Oe();ur(x,n,h.layoutBox),Uj(y,x)||(d=!0),u.options.layoutRoot&&(t.relativeTarget=x,t.relativeTargetOrigin=y,t.relativeParent=u)}}}t.notifyListeners("didUpdate",{layout:n,snapshot:s,delta:l,layoutDelta:o,hasLayoutChanged:c,hasRelativeLayoutChanged:d})}else if(t.isLead()){const{onExitComplete:n}=t.options;n&&n()}t.options.transition=void 0}function _A(t){t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function TA(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function AA(t){t.clearSnapshot()}function nh(t){t.clearMeasurements()}function ih(t){t.isLayoutDirty=!1}function DA(t){const{visualElement:s}=t.options;s&&s.getProps().onBeforeLayoutMeasure&&s.notify("BeforeLayoutMeasure"),t.resetTransform()}function rh(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function PA(t){t.resolveTargetDelta()}function MA(t){t.calcProjection()}function IA(t){t.resetSkewAndRotation()}function EA(t){t.removeLeadSnapshot()}function ah(t,s,n){t.translate=Pe(s.translate,0,n),t.scale=Pe(s.scale,1,n),t.origin=s.origin,t.originPoint=s.originPoint}function oh(t,s,n,i){t.min=Pe(s.min,n.min,i),t.max=Pe(s.max,n.max,i)}function RA(t,s,n,i){oh(t.x,s.x,n.x,i),oh(t.y,s.y,n.y,i)}function LA(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const OA={duration:.45,ease:[.4,0,.1,1]},lh=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),ch=lh("applewebkit/")&&!lh("chrome/")?Math.round:Qt;function dh(t){t.min=ch(t.min),t.max=ch(t.max)}function $A(t){dh(t.x),dh(t.y)}function Wj(t,s,n){return t==="position"||t==="preserve-aspect"&&!KT(th(s),th(n),.2)}function FA(t){return t!==t.root&&t.scroll?.wasRoot}const qA=Kj({attachResizeListener:(t,s)=>Er(t,"resize",s),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),xl={current:void 0},Gj=Kj({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!xl.current){const t=new qA({});t.mount(window),t.setOptions({layoutScroll:!0}),xl.current=t}return xl.current},resetTransform:(t,s)=>{t.style.transform=s!==void 0?s:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),BA={pan:{Feature:aA},drag:{Feature:rA,ProjectionNode:Gj,MeasureLayout:$j}};function uh(t,s,n){const{props:i}=t;t.animationState&&i.whileHover&&t.animationState.setActive("whileHover",n==="Start");const r="onHover"+n,a=i[r];a&&Te.postRender(()=>a(s,Jr(s)))}class UA extends pn{mount(){const{current:s}=this.node;s&&(this.unmount=u4(s,(n,i)=>(uh(this.node,i,"Start"),r=>uh(this.node,r,"End"))))}unmount(){}}class VA extends pn{constructor(){super(...arguments),this.isActive=!1}onFocus(){let s=!1;try{s=this.node.current.matches(":focus-visible")}catch{s=!0}!s||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Hr(Er(this.node.current,"focus",()=>this.onFocus()),Er(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function mh(t,s,n){const{props:i}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&i.whileTap&&t.animationState.setActive("whileTap",n==="Start");const r="onTap"+(n==="End"?"":n),a=i[r];a&&Te.postRender(()=>a(s,Jr(s)))}class KA extends pn{mount(){const{current:s}=this.node;s&&(this.unmount=f4(s,(n,i)=>(mh(this.node,i,"Start"),(r,{success:a})=>mh(this.node,r,a?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const nc=new WeakMap,gl=new WeakMap,WA=t=>{const s=nc.get(t.target);s&&s(t)},GA=t=>{t.forEach(WA)};function ZA({root:t,...s}){const n=t||document;gl.has(n)||gl.set(n,{});const i=gl.get(n),r=JSON.stringify(s);return i[r]||(i[r]=new IntersectionObserver(GA,{root:t,...s})),i[r]}function HA(t,s,n){const i=ZA(s);return nc.set(t,n),i.observe(t),()=>{nc.delete(t),i.unobserve(t)}}const QA={some:0,all:1};class YA extends pn{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:s={}}=this.node.getProps(),{root:n,margin:i,amount:r="some",once:a}=s,o={root:n?n.current:void 0,rootMargin:i,threshold:typeof r=="number"?r:QA[r]},l=c=>{const{isIntersecting:d}=c;if(this.isInView===d||(this.isInView=d,a&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:u,onViewportLeave:m}=this.node.getProps(),h=d?u:m;h&&h(c)};return HA(this.node.current,o,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:s,prevProps:n}=this.node;["amount","margin","root"].some(JA(s,n))&&this.startObserver()}unmount(){}}function JA({viewport:t={}},{viewport:s={}}={}){return n=>t[n]!==s[n]}const XA={inView:{Feature:YA},tap:{Feature:KA},focus:{Feature:VA},hover:{Feature:UA}},eD={layout:{ProjectionNode:Gj,MeasureLayout:$j}},tD={...$T,...XA,...BA,...eD},ze=tT(tD,pT),Mo={normal:.3,slow:.5},sD={stagger:.05},nD={default:[.4,0,.2,1]},iD={hidden:{opacity:0,y:20},visible:(t=0)=>({opacity:1,y:0,transition:{delay:t*sD.stagger,duration:Mo.normal,ease:nD.default}})},rD=(t,s=Mo.slow)=>{const[n,i]=te.useState(0),r=te.useRef(0);return te.useEffect(()=>{const a=r.current,o=t,l=Date.now(),c=()=>{const d=(Date.now()-l)/1e3,u=Math.min(d/s,1),m=1-Math.pow(1-u,3),h=Math.floor(a+(o-a)*m);i(h),u<1?requestAnimationFrame(c):r.current=o};requestAnimationFrame(c)},[t,s]),n},qi=({children:t,index:s=0,className:n="",...i})=>e.jsx(ze.div,{variants:iD,initial:"hidden",animate:"visible",custom:s,className:n,...i,children:t}),Dn=({value:t,className:s="bg-gray-100 rounded-full overflow-hidden",barClassName:n="h-full bg-gray-900",height:i="h-2"})=>e.jsx("div",{className:`${i} ${s}`,children:e.jsx(ze.div,{initial:{width:0},animate:{width:`${t}%`},transition:{duration:Mo.slow,ease:"easeOut"},className:n})}),it=({value:t,className:s="",duration:n=Mo.slow,prefix:i="",suffix:r=""})=>{const a=rD(t,n);return e.jsxs("span",{className:s,children:[i,a.toLocaleString("pl-PL"),r]})},aD=()=>e.jsxs("div",{className:"rounded-2xl border bg-card p-5 shadow-soft animate-pulse",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"h-8 w-8 rounded-md bg-muted/70"}),e.jsx("div",{className:"h-4 w-40 rounded bg-muted/70"})]}),e.jsx("div",{className:"h-5 w-16 rounded-full bg-muted/70"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"h-2 w-full rounded-full bg-muted/60"}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsx("div",{className:"h-3 w-16 rounded bg-muted/60"}),e.jsx("div",{className:"h-3 w-20 rounded bg-muted/60"})]})]}),e.jsx("div",{className:"mt-4 h-9 w-2/3 rounded-lg bg-muted/60"}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsx("div",{className:"h-6 w-16 rounded bg-muted/60"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"h-9 w-24 rounded-lg bg-muted/60"}),e.jsx("div",{className:"h-9 w-10 rounded-lg bg-muted/60"})]})]})]}),oD=()=>{const t=ae(),{data:s}=Ze(),{stats:n,refetch:i}=Un(),{data:r,isLoading:a}=Zr("get_my_courses"),[o,l]=te.useState(0),c=r||[],d=!a&&c.length===0;te.useEffect(()=>{const m=async()=>{try{const{data:y}=await X.rpc("check_claimable_rewards");l(y?.claimable_points||0)}catch{}};m();const h=setInterval(m,3e4);return()=>clearInterval(h)},[]);const u=async()=>{try{const{data:m,error:h}=await X.rpc("claim_daily_rewards");if(h)throw h;m&&(Y.success(`Odebrano ${m.total_earned} punkt贸w`),i(),l(0))}catch{Y.error("Nie mo偶na odebra nagr贸d")}};return e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8 pb-24 lg:pb-8",children:[e.jsxs(ze.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.45},className:"relative overflow-hidden rounded-2xl border",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/[0.12] via-secondary/[0.10] to-accent/[0.12]"}),e.jsx("div",{className:"absolute inset-0 opacity-[0.06]",style:{backgroundImage:`
                linear-gradient(to right, hsl(var(--ring)/0.35) 1px, transparent 1px),
                linear-gradient(to bottom, hsl(var(--ring)/0.35) 1px, transparent 1px)
              `,backgroundSize:"28px 28px"}})]}),e.jsxs("div",{className:"relative z-10 p-4 sm:p-6 md:p-8",children:[e.jsxs("div",{className:"space-y-6 md:hidden",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-xl font-bold tracking-tight",children:"Twoje tempo nauki"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.streak>0&&e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full border bg-background/60 px-3 py-1.5 shadow-soft",children:[e.jsx(ms,{className:"h-4 w-4 text-destructive"}),e.jsxs("span",{className:"text-sm font-medium",children:["Seria: ",e.jsx("span",{className:"tabular-nums",children:n.streak})," ","dni"]})]}),o>0&&e.jsxs("button",{onClick:u,className:"inline-flex items-center gap-2 rounded-lg bg-primary px-3 py-1.5 text-sm text-primary-foreground hover:bg-primary/90 focus-ring",children:[e.jsx(Kd,{className:"h-4 w-4"}),"Odbierz ",o," pkt"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:"rounded-xl border bg-card p-4 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Punkty"}),e.jsx(Ye,{className:"h-4 w-4 text-primary"})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("span",{className:"text-3xl font-semibold tabular-nums text-primary leading-none",children:e.jsx(it,{value:n.points})}),e.jsx("span",{className:"mb-1 text-sm text-muted-foreground",children:"pkt"})]}),e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:["+",e.jsx(it,{value:n.idle_rate}),"/h"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded-xl border bg-card p-4 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Poziom"}),e.jsx(Sn,{className:"h-4 w-4 text-secondary"})]}),e.jsx("span",{className:"text-2xl font-semibold text-secondary",children:n.level}),e.jsx("div",{className:"mt-2 h-1.5 w-full rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-secondary transition-all",style:{width:`${n.points%100}%`}})})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-4 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Premia"}),e.jsx(xt,{className:"h-4 w-4 text-accent"})]}),e.jsxs("span",{className:"text-2xl font-semibold text-accent",children:["+",e.jsx(it,{value:n.idle_rate})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"pkt/h"})]})]})]})]}),e.jsxs("div",{className:"hidden md:grid gap-8 md:grid-cols-12 md:items-center",children:[e.jsxs("div",{className:"md:col-span-4 space-y-4",children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Twoje tempo nauki"}),n.streak>0&&e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full border bg-background/60 px-3 py-1.5 shadow-soft",children:[e.jsx(ms,{className:"h-4 w-4 text-destructive"}),e.jsxs("span",{className:"text-sm font-medium",children:["Seria: ",e.jsx("span",{className:"tabular-nums",children:n.streak})," ","dni"]})]}),o>0&&e.jsxs("button",{onClick:u,className:"inline-flex items-center gap-2 rounded-lg bg-primary px-4 py-2 text-primary-foreground hover:bg-primary/90 focus-ring",children:[e.jsx(Kd,{className:"h-4 w-4"}),"Odbierz ",o," pkt"]})]}),e.jsx("div",{className:"md:col-span-8",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 md:gap-6",children:[e.jsxs("div",{className:"rounded-xl border bg-card p-5 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Punkty"}),e.jsx(Ye,{className:"h-4 w-4 text-primary"})]}),e.jsxs("div",{className:"mt-2 flex items-end gap-2",children:[e.jsx("span",{className:"text-4xl md:text-5xl font-semibold tabular-nums text-primary leading-none",children:e.jsx(it,{value:n.points})}),e.jsx("span",{className:"mb-[2px] text-sm text-muted-foreground",children:"pkt"})]}),e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:["+",e.jsx(it,{value:n.idle_rate}),"/h"]})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-5 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Poziom"}),e.jsx(Sn,{className:"h-4 w-4 text-secondary"})]}),e.jsx("div",{className:"mt-2 flex items-center gap-2",children:e.jsx("span",{className:"text-4xl md:text-5xl font-semibold text-secondary leading-none",children:n.level})}),e.jsx("div",{className:"mt-3 h-2 w-full rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-secondary transition-all",style:{width:`${n.points%100}%`}})}),e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:["Do kolejnego: ",100-n.points%100," pkt"]})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-5 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Premia"}),e.jsx(xt,{className:"h-4 w-4 text-accent"})]}),e.jsxs("div",{className:"mt-2 flex items-end gap-2",children:[e.jsxs("span",{className:"text-4xl md:text-5xl font-semibold text-accent leading-none",children:["+",e.jsx(it,{value:n.idle_rate})]}),e.jsx("span",{className:"mb-[2px] text-sm text-muted-foreground",children:"pkt/h"})]}),e.jsx("button",{onClick:()=>t("/student/gamification"),className:"mt-3 w-full rounded-lg border px-3 py-2 hover:bg-primary/5 focus-ring",children:"Gamifikacja"})]})]})})]})]})]}),e.jsxs(ze.section,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.4,delay:.05},className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-lg sm:text-xl md:text-2xl font-semibold tracking-tight",children:"Twoje kursy"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"To jest Twoja g贸wna cie偶ka  kontynuuj nauk tam, gdzie skoczye."})]}),e.jsxs("button",{onClick:()=>t("/student/courses"),className:"inline-flex items-center gap-1 sm:gap-2 rounded-lg border px-2 sm:px-3 py-1.5 sm:py-2 text-sm hover:bg-primary/5 focus-ring whitespace-nowrap",children:[e.jsx("span",{className:"hidden sm:inline",children:"Zobacz wszystkie"}),e.jsx("span",{className:"sm:hidden",children:"Wszystkie"}),e.jsx(He,{className:"h-4 w-4"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-5",children:[a&&Array.from({length:6}).map((m,h)=>e.jsx(aD,{},h)),!a&&c.slice(0,9).map(m=>{const h=m.progress_percent===100;return e.jsxs("div",{className:"group relative rounded-2xl border bg-card p-4 sm:p-5 shadow-soft hover:bg-muted/40 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("span",{className:"text-2xl sm:text-3xl shrink-0 leading-none",children:m.icon_emoji||""}),e.jsx("h4",{className:"font-semibold text-sm sm:text-base text-foreground line-clamp-2",children:m.title})]}),h?e.jsx("span",{className:"inline-flex items-center gap-1 rounded-full border border-green-600/30 bg-green-500/10 text-green-700 dark:text-green-400 px-2 sm:px-2.5 py-0.5 sm:py-1 text-[10px] sm:text-[11px] font-semibold",children:"Ukoczono"}):e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-primary/30 text-primary px-2 sm:px-2.5 py-0.5 sm:py-1 text-[10px] sm:text-[11px] font-semibold",children:[m.progress_percent,"%"]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"h-2 w-full rounded-full bg-muted",children:e.jsx("div",{className:`h-full rounded-full transition-all ${h?"bg-green-600":"bg-primary"}`,style:{width:`${m.progress_percent||0}%`}})}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"Ukoczono"}),e.jsxs("span",{className:"font-medium text-foreground",children:[m.completed_lessons||0,"/",m.total_lessons||10," lekcji"]})]})]}),m.next_activity&&e.jsxs("div",{className:"mt-3 sm:mt-4 flex items-center gap-2 rounded-lg border bg-background/60 px-2.5 sm:px-3 py-1.5 sm:py-2",children:[e.jsx(Aw,{className:"h-3.5 sm:h-4 w-3.5 sm:w-4 text-primary"}),e.jsx("p",{className:"text-xs sm:text-sm font-medium truncate",children:m.next_activity})]}),e.jsxs("div",{className:"mt-3 sm:mt-4 flex items-center justify-between",children:[m.points_available?e.jsxs("span",{className:"inline-flex rounded-md bg-orange-500/10 text-[10px] sm:text-[11px] font-semibold px-2 py-0.5 sm:py-1 text-orange-600",children:["+",m.points_available," pkt"]}):e.jsx("span",{}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>t(`/student/courses/${m.course_id}`),className:"rounded-lg bg-primary px-3 sm:px-4 py-1.5 sm:py-2 text-sm text-primary-foreground hover:bg-primary/90 focus-ring",children:"Kontynuuj"}),e.jsx("button",{onClick:()=>t(`/student/courses/${m.course_id}`),className:"rounded-lg border px-2.5 sm:px-3 py-1.5 sm:py-2 hover:bg-primary/5 focus-ring",title:"Szczeg贸y",children:e.jsx(He,{className:"h-3.5 sm:h-4 w-3.5 sm:w-4"})})]})]})]},m.course_id)}),d&&e.jsxs("div",{className:"col-span-full rounded-2xl border bg-card p-8 sm:p-10 text-center shadow-soft",children:[e.jsx("div",{className:"text-4xl sm:text-5xl",children:""}),e.jsx("h4",{className:"mt-3 sm:mt-4 text-base sm:text-lg font-semibold",children:"Zacznij swoj przygod"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:"Docz do kursu i odkryj nowy spos贸b nauki."}),e.jsx("button",{onClick:()=>t("/student/courses"),className:"mt-4 sm:mt-6 rounded-lg bg-secondary px-4 sm:px-5 py-2 sm:py-2.5 text-sm text-white hover:opacity-95 focus-ring",children:"Odkryj kursy"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"rounded-xl border bg-card/70 backdrop-blur-sm p-4 sm:p-5 shadow-md",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground font-medium",children:"Punkty"}),e.jsx(Ye,{className:"h-3.5 sm:h-4 w-3.5 sm:w-4 text-primary"})]}),e.jsx("p",{className:"mt-1.5 text-xl sm:text-2xl font-semibold tabular-nums text-foreground",children:e.jsx(it,{value:n.points})}),e.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:["+",e.jsx(it,{value:n.idle_rate}),"/h"]})]}),e.jsxs("div",{className:"rounded-xl border bg-card/70 backdrop-blur-sm p-4 sm:p-5 shadow-md",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground font-medium",children:"Poziom"}),e.jsx(qe,{className:"h-3.5 sm:h-4 w-3.5 sm:w-4 text-secondary"})]}),e.jsx("p",{className:"mt-1.5 text-xl sm:text-2xl font-semibold text-foreground",children:n.level}),e.jsx("div",{className:"mt-2 sm:mt-3",children:e.jsx(Dn,{value:n.points%100})})]}),e.jsxs("div",{className:"rounded-xl border bg-card/70 backdrop-blur-sm p-4 sm:p-5 shadow-md",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground font-medium",children:"Seria dni"}),e.jsx(ms,{className:"h-3.5 sm:h-4 w-3.5 sm:w-4 text-destructive"})]}),e.jsx("p",{className:"mt-1.5 text-xl sm:text-2xl font-semibold text-foreground",children:e.jsx(it,{value:n.streak})}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:"dni z rzdu"})]}),e.jsxs("div",{className:"rounded-xl border bg-card/70 backdrop-blur-sm p-4 sm:p-5 shadow-md",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground font-medium",children:"Tempo"}),e.jsx(xt,{className:"h-3.5 sm:h-4 w-3.5 sm:w-4 text-accent"})]}),e.jsxs("p",{className:"mt-1.5 text-xl sm:text-2xl font-semibold text-foreground",children:["+",e.jsx(it,{value:n.idle_rate})]}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:"punkt贸w/h"})]})]})]})},lD=[e.jsx(K,{path:"dashboard",element:e.jsx(oD,{})},"dashboard")],cD=()=>{const t=ae(),{data:s}=Zr("get_my_courses"),n=s||[];return e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8 pb-24 lg:pb-8",children:[e.jsxs(ze.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.45},className:"relative overflow-hidden rounded-2xl border",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0",children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/[0.12] via-secondary/[0.10] to-accent/[0.12]"})}),e.jsxs("div",{className:"relative z-10 p-4 sm:p-6 md:p-8",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Twoje kursy"}),e.jsx("p",{className:"mt-2 text-sm md:text-base text-muted-foreground",children:"Wybierz kurs i kontynuuj nauk w swoim tempie."})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-5",children:n.map((i,r)=>e.jsxs(qi,{index:r,className:"group relative rounded-2xl border bg-card p-4 sm:p-5 shadow-soft hover:bg-muted/40 transition-colors cursor-pointer",onClick:()=>t(`/student/courses/${i.course_id}`),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("span",{className:"text-2xl sm:text-3xl shrink-0 leading-none",children:i.icon_emoji||""}),e.jsx("h4",{className:"font-semibold text-sm sm:text-base text-foreground line-clamp-2",children:i.title})]}),e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-primary/30 text-primary px-2 sm:px-2.5 py-0.5 sm:py-1 text-[10px] sm:text-[11px] font-semibold",children:[i.progress_percent,"%"]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(Dn,{value:i.progress_percent})}),e.jsxs("button",{className:"mt-4 inline-flex items-center gap-1 text-sm font-medium text-primary",children:["Kontynuuj",e.jsx(He,{className:"h-4 w-4"})]})]},i.course_id))})]})},dD=[e.jsx(K,{path:"/courses",element:e.jsx(cD,{})},"courses-list")],uD=()=>e.jsxs("div",{className:"rounded-2xl border bg-card p-5 md:p-6 shadow-soft animate-pulse",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-muted/60"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-5 w-1/2 rounded bg-muted/60"}),e.jsx("div",{className:"h-4 w-3/4 rounded bg-muted/60"})]}),e.jsx("div",{className:"h-9 w-36 rounded-lg bg-muted/60"})]}),e.jsxs("div",{className:"mt-5",children:[e.jsx("div",{className:"h-2 w-full rounded-full bg-muted/60"}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsx("div",{className:"h-3 w-16 rounded bg-muted/60"}),e.jsx("div",{className:"h-3 w-10 rounded bg-muted/60"})]})]})]}),mD=()=>e.jsxs("div",{className:"rounded-2xl border bg-card p-4 md:p-5 shadow-soft animate-pulse",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-muted/60"}),e.jsx("div",{className:"h-4 w-2/5 rounded bg-muted/60"})]}),e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((t,s)=>e.jsx("div",{className:"h-14 rounded-xl border bg-muted/40"},s))})]}),hD=()=>{const{courseId:t}=Ct(),s=ae(),{data:n,isLoading:i}=Zr("get_course_structure",{p_course_id:parseInt(t)},{enabled:!!t}),{data:r}=yC("courses",{filters:[{field:"id",operator:"eq",value:parseInt(t)}],enabled:!!t}),a=te.useMemo(()=>{if(!n)return[];const d=n.reduce((h,y)=>{const x=`${y.topic_id}-${y.topic_title}`;return h[x]||(h[x]={id:y.topic_id,title:y.topic_title,position:y.topic_position,activities:[]}),y.activity_id&&h[x].activities.push({id:y.activity_id,title:y.activity_title,type:y.activity_type,position:y.activity_position,completed:y.is_completed,score:y.score}),h},{}),u=Object.values(d).sort((h,y)=>h.position-y.position);let m=!1;return u.map((h,y)=>{const x=h.activities.length>0&&h.activities.every(j=>j.completed),g=y===0||u[y-1].activities.length>0&&u[y-1].activities.every(j=>j.completed);return h.activities.sort((j,w)=>j.position-w.position),h.activities=h.activities.map(j=>{let w=!1;return j.completed?w=!0:g&&!m&&(w=!0,m=!0),{...j,isUnlocked:w}}),{...h,isCompleted:x,isUnlocked:g}})},[n]),o=te.useMemo(()=>{const d=a.flatMap(h=>h.activities),u=d.filter(h=>h.completed).length,m=d.length;return{totalActivities:m,completedActivities:u,progress:m>0?Math.round(u/m*100):0}},[a]),l=r?.[0],c=te.useMemo(()=>{for(const d of a){const u=d.activities.find(m=>!m.completed&&m.isUnlocked);if(u)return{topicId:d.id,activity:u,path:u.type==="quiz"?`/student/courses/${t}/quiz/${u.id}`:`/student/courses/${t}/lesson/${u.id}`}}return null},[a,t]);return i?e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8",children:[e.jsxs("button",{className:"inline-flex items-center gap-2 text-muted-foreground cursor-default",disabled:!0,children:[e.jsx(Ne,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Powr贸t"})]}),e.jsx(uD,{}),e.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((d,u)=>e.jsx(mD,{},u))})]}):l?e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8 pb-24 lg:pb-8",children:[e.jsxs("button",{onClick:()=>s("/student/dashboard#courses"),className:"flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx(Ne,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Powr贸t"})]}),e.jsxs(ze.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.45},className:"relative overflow-hidden rounded-2xl border",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/[0.12] via-secondary/[0.10] to-accent/[0.12]"}),e.jsx("div",{className:"absolute inset-0 opacity-[0.06]",style:{backgroundImage:`
                linear-gradient(to right, hsl(var(--ring)/0.35) 1px, transparent 1px),
                linear-gradient(to bottom, hsl(var(--ring)/0.35) 1px, transparent 1px)
              `,backgroundSize:"28px 28px"}})]}),e.jsx("div",{className:"relative z-10 p-4 sm:p-6 md:p-8",children:e.jsxs("div",{className:"grid md:grid-cols-12 gap-6 md:items-center",children:[e.jsxs("div",{className:"md:col-span-7 flex items-start gap-4 min-w-0",children:[e.jsx("div",{className:"text-5xl md:text-6xl leading-none shrink-0",children:l.icon_emoji||""}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-xl md:text-3xl font-bold tracking-tight",children:l.title}),l.description&&e.jsx("p",{className:"mt-2 text-sm md:text-base text-muted-foreground line-clamp-3",children:l.description}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border bg-background/60 px-3 py-1.5 shadow-soft",children:[e.jsx(et,{className:"h-4 w-4"}),e.jsxs("span",{className:"text-sm font-medium",children:["Ukoczone:"," ",e.jsx("span",{className:"tabular-nums",children:e.jsx(it,{value:o.completedActivities})}),"/",o.totalActivities]})]}),o.progress===100&&e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-green-600/30 bg-green-500/10 text-green-700 dark:text-green-400 px-3 py-1.5 shadow-soft text-sm font-semibold",children:[e.jsx(rt,{className:"h-4 w-4"}),"Kurs ukoczony"]})]})]})]}),e.jsx("div",{className:"md:col-span-5",children:e.jsxs("div",{className:"rounded-xl border bg-card p-4 md:p-5 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Postp kursu"}),e.jsxs("span",{className:"text-sm font-semibold",children:[o.progress,"%"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx(Dn,{value:o.progress})}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[c?e.jsxs("button",{onClick:()=>s(c.path),className:"flex-1 inline-flex items-center justify-center gap-2 rounded-lg bg-primary px-4 py-2 text-primary-foreground hover:bg-primary/90 focus-ring",children:["Kontynuuj",e.jsx(He,{className:"h-4 w-4"})]}):e.jsx("button",{disabled:!0,className:"flex-1 rounded-lg border px-4 py-2 text-muted-foreground cursor-default",title:"Brak kolejnej aktywnoci",children:"Wszystko ukoczone"}),e.jsx("button",{onClick:()=>s("/student/courses"),className:"rounded-lg border px-3 py-2 hover:bg-primary/5 focus-ring",title:"Wr贸 do listy",children:e.jsx(Ne,{className:"h-4 w-4"})})]})]})})]})})]}),e.jsx("div",{className:"space-y-6",children:a.map((d,u)=>e.jsxs(qi,{index:u,className:B("relative rounded-2xl border bg-card p-4 md:p-5 shadow-soft",!d.isUnlocked&&"opacity-60"),children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-3 md:mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:B("w-10 h-10 rounded-full flex items-center justify-center",d.isCompleted?"bg-green-600 text-white":d.isUnlocked?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground"),"aria-label":d.isCompleted?"Temat ukoczony":d.isUnlocked?"Temat odblokowany":"Temat zablokowany",children:d.isCompleted?e.jsx(rt,{className:"w-5 h-5"}):d.isUnlocked?e.jsx("span",{className:"font-semibold",children:d.position}):e.jsx(Nn,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-base md:text-lg font-semibold text-foreground",children:d.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[d.activities.filter(m=>m.completed).length," ","z ",d.activities.length," ukoczonych"]})]})]}),e.jsx("div",{className:"hidden md:block w-40",children:e.jsx(Dn,{value:d.activities.length?Math.round(d.activities.filter(m=>m.completed).length/d.activities.length*100):0})})]}),e.jsx("div",{className:"mt-3 md:mt-4 space-y-3",children:d.activities.map(m=>{const h=m.type==="quiz",y=m.type==="quiz"?`/student/courses/${t}/quiz/${m.id}`:`/student/courses/${t}/lesson/${m.id}`;return e.jsxs(ze.button,{whileHover:m.isUnlocked?{x:2}:{},whileTap:m.isUnlocked?{scale:.98}:{},onClick:()=>{m.isUnlocked&&s(y)},disabled:!m.isUnlocked,className:B("w-full flex items-center justify-between p-4 rounded-xl border transition-colors focus-ring",m.isUnlocked?"bg-background/60 hover:bg-primary/5":"bg-muted/40 cursor-not-allowed"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:B("w-8 h-8 rounded-lg flex items-center justify-center shrink-0",h?m.isUnlocked?"bg-purple-100":"bg-muted":m.isUnlocked?"bg-blue-100":"bg-muted"),children:m.isUnlocked?h?e.jsx(Ye,{className:"w-4 h-4 text-purple-600"}):e.jsx(et,{className:"w-4 h-4 text-blue-600"}):e.jsx(Nn,{className:"w-4 h-4 text-muted-foreground"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:B("font-medium",m.isUnlocked?"text-foreground":"text-muted-foreground"),children:m.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[h?"Quiz":"Materia",m.score!==null&&`  ${m.score}%`,!m.isUnlocked&&"  Zablokowane"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[!m.completed&&m.isUnlocked&&e.jsx("span",{className:"hidden sm:inline text-xs text-muted-foreground",children:"Przejd藕"}),m.completed?e.jsx(rt,{className:"w-5 h-5 text-green-600"}):m.isUnlocked?e.jsx(He,{className:"w-5 h-5 text-muted-foreground"}):e.jsx(Nn,{className:"w-4 h-4 text-muted-foreground"})]})]},m.id)})})]},d.id))})]}):e.jsxs("div",{className:"container mx-auto px-4 py-12 text-center",children:[e.jsx("div",{className:"text-5xl",children:"し锔"}),e.jsx("h2",{className:"mt-3 text-xl font-semibold",children:"Nie znaleziono kursu"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Spr贸buj wr贸ci do listy kurs贸w i wybra ponownie."}),e.jsx("button",{onClick:()=>s("/student/courses"),className:"mt-6 rounded-lg bg-primary px-4 py-2 text-primary-foreground hover:bg-primary/90 focus-ring",children:"Przejd藕 do kurs贸w"})]})},pD=[e.jsx(K,{path:"/courses/:courseId",element:e.jsx(hD,{})},"course-detail")],hh=t=>t.toLowerCase().replace(/[^\p{Letter}\p{Number}]+/gu,"-").replace(/(^-|-$)/g,"")||"sekcja",fD=(t,s)=>{const n=t.split(/\n(?=##\s+)/g);return n.length<=1&&!/^##\s+/.test(t)?[{id:hh(s||"Sekcja 1"),title:s||"Sekcja 1",content:t}]:n.map((i,r)=>{const o=(i.match(/^##\s+(.+?)\s*$/m)?.[1]||`Sekcja ${r+1}`).trim(),l=i.replace(/^##\s+.+?\n/,"").trim();return{id:hh(o),title:o,content:l}})},xD=/```quiz\s*?\n([\s\S]*?)```/g,gD=(t,s,n)=>{try{const i=Hf.parse(t),r=(i?.options||[]).map(String);return!i?.question||!Array.isArray(i?.options)||typeof i?.answerIndex!="number"||i.answerIndex<0||i.answerIndex>=r.length?null:{question:i.question,options:r,answerIndex:i.answerIndex,key:`${s}:${n}`}}catch{return null}},jD=t=>new Map(t.map(s=>[s.id,[...s.content.matchAll(xD)].map((n,i)=>gD(n[1],s.id,i)).filter(Boolean)])),ph=(t,s)=>{const[n,i]=te.useState(()=>{try{const r=localStorage.getItem(t);return r?JSON.parse(r):s}catch{return s}});return te.useEffect(()=>{try{localStorage.setItem(t,JSON.stringify(n))}catch(r){console.error("Bd zapisu do localStorage:",r)}},[t,n]),[n,i]},yD=()=>{const t=te.useRef(null);return{ref:t,say:n=>{t.current&&(t.current.textContent="",setTimeout(()=>t.current&&(t.current.textContent=n),30))}}},wD=()=>e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6",children:[e.jsx("div",{className:"h-5 w-24 rounded bg-muted/60"}),e.jsxs("div",{className:"rounded-2xl border bg-card p-6 shadow-soft animate-pulse",children:[e.jsx("div",{className:"h-6 w-2/3 rounded bg-muted/60 mb-2"}),e.jsx("div",{className:"h-4 w-40 rounded bg-muted/60"})]}),e.jsx("div",{className:"space-y-3",children:Array.from({length:10}).map((t,s)=>e.jsx("div",{className:"h-4 w-full rounded bg-muted/50"},s))}),e.jsx("div",{className:"h-10 w-48 rounded-lg bg-muted/60 ml-auto"})]}),fh={code:({inline:t,className:s="",children:n,...i})=>{const r=(s||"").toLowerCase();return!t&&r.includes("language-quiz")?null:e.jsx("code",{className:s,...i,children:n})},pre:t=>((Array.isArray(t.children)?t.children[0]:t.children)?.props?.className?.toLowerCase?.()||"").includes("language-quiz")?null:e.jsx("pre",{...t})},bD=({quiz:t,onClose:s,onPass:n})=>{const[i,r]=te.useState(null),[a,o]=te.useState(!1),l=()=>{const c=i!==null&&i===t.answerIndex;o(c),c?(Y.success("Poprawna odpowied藕!"),setTimeout(n,200)):Y.error("Niepoprawna odpowied藕  spr贸buj ponownie.")};return e.jsxs("div",{className:"fixed inset-0 z-[90] flex items-end sm:items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:s}),e.jsxs("div",{className:"relative z-[91] w-full sm:max-w-lg bg-background rounded-t-2xl sm:rounded-2xl border shadow-2xl p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold",children:"Pytanie kontrolne"}),e.jsx("button",{onClick:s,className:"p-1 rounded hover:bg-muted","aria-label":"Zamknij",children:e.jsx(Jt,{className:"h-5 w-5"})})]}),e.jsx("p",{className:"mb-3 text-sm sm:text-base",children:t.question}),e.jsx("div",{className:"space-y-2 mb-4",children:t.options.map((c,d)=>e.jsxs("label",{className:"flex items-center gap-2 rounded-md border px-3 py-2 cursor-pointer hover:bg-muted",children:[e.jsx("input",{type:"radio",name:"quiz-choice",className:"h-4 w-4",checked:i===d,onChange:()=>r(d),disabled:a}),e.jsx("span",{className:"text-sm",children:c})]},d))}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:s,className:"rounded-lg border px-3 py-1.5 text-sm hover:bg-muted",children:"Anuluj"}),e.jsx("button",{onClick:l,className:"rounded-lg border px-3 py-1.5 text-sm font-medium hover:bg-muted",disabled:a,children:"Zatwierd藕"})]})]})]})},vD=({lessonTitle:t,courseId:s,timeSpent:n,sectionsCount:i,quizzesCompleted:r,pointsEarned:a,nextLessonPath:o})=>{const l=ae(),c=d=>{const u=Math.floor(d/60),m=d%60;return u>0?`${u} min ${m} s`:`${m} s`};return e.jsx(ze.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"fixed inset-0 z-20 flex items-center justify-center p-4 bg-black/50",children:e.jsxs("div",{className:"w-full max-w-md rounded-2xl border bg-card p-6 shadow-2xl",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-green-100 dark:bg-green-900/30 mb-4",children:e.jsx(Rt,{className:"w-8 h-8 text-green-600"})}),e.jsx("h2",{className:"text-2xl font-bold",children:"Lekcja ukoczona! "}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:t})]}),e.jsxs("div",{className:"rounded-xl bg-primary/10 p-4 mb-6 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-3xl font-bold text-primary",children:[e.jsx(Ye,{className:"w-6 h-6"}),"+",a," punkt贸w"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"za ukoczenie materiau"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(et,{className:"w-5 h-5 mx-auto mb-1 text-blue-600"}),e.jsx("p",{className:"text-sm font-medium",children:c(n)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Czas nauki"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(ye,{className:"w-5 h-5 mx-auto mb-1 text-purple-600"}),e.jsx("p",{className:"text-sm font-medium",children:i}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Sekcji"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(qe,{className:"w-5 h-5 mx-auto mb-1 text-yellow-600"}),e.jsx("p",{className:"text-sm font-medium",children:r}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pyta"})]})]}),e.jsx("div",{className:"flex gap-3",children:o?e.jsxs("button",{onClick:()=>l(o),className:"flex-1 inline-flex items-center justify-center gap-2 rounded-lg bg-primary px-4 py-2.5 text-primary-foreground hover:bg-primary/90",children:["Nastpna lekcja",e.jsx(He,{className:"w-4 h-4"})]}):e.jsx("button",{onClick:()=>l(`/student/courses/${s}`),className:"flex-1 rounded-lg bg-primary px-4 py-2.5 text-primary-foreground hover:bg-primary/90",children:"Wr贸 do kursu"})})]})})},ND=()=>{const{courseId:t,lessonId:s}=Ct(),n=ae(),{refetch:i}=Un(),{data:r,isLoading:a}=Xe({resource:"activities",id:s,meta:{select:"*, topics(title, course_id, courses(title, icon_emoji))"}}),o=r?.data??{},l=o?.content_md??o?.markdown??o?.content,c=te.useMemo(()=>l?fD(l,o?.title??"Sekcja"):[],[l,o?.title]),d=te.useMemo(()=>jD(c),[c]),u=`lesson-progress:${s}`,m=`lesson-quiz:${s}`,[h,y]=ph(u,Object.fromEntries(c.map(D=>[D.id,!1]))),[x,g]=ph(m,{}),[j,w]=te.useState(null),[b,v]=te.useState(!1),[C]=te.useState(Date.now());te.useEffect(()=>{c.length&&y(D=>{const P={};return c.forEach(R=>P[R.id]=D[R.id]??!1),P})},[c.map(D=>D.id).join("|")]);const{ref:_,say:S}=yD(),z=c.findIndex(D=>!h[D.id]),k=z===-1,T=D=>{const[P]=d.get(D)??[];P&&w(P)},p=D=>{const P=c[D];if(!P||!(z===-1||D<=z)&&!h[P.id])return;if(h[P.id]){y(L=>({...L,[P.id]:!1})),S(`Sekcja ${D+1} cofnita.`);return}(d.get(P.id)??[]).length>0?T(P.id):(y(L=>({...L,[P.id]:!0})),S(`Sekcja ${D+1} odhaczona.`))},N=()=>{const D=j;if(w(null),!D)return;g(q=>({...q,[D.key]:!0}));const P=D.key.split(":")[0];y(q=>({...q,[P]:!0}));const R=c.findIndex(q=>q.id===P);S(`Sekcja ${R+1} odhaczona po pytaniu kontrolnym.`)},A=async()=>{if(!k)return Y.info("Najpierw odhacz wszystkie sekcje po kolei.");console.log("Starting lesson completion...");try{const{error:D}=await X.rpc("start_activity",{p_activity_id:parseInt(s)});if(D)throw console.error("Error starting activity:",D),D;console.log("Activity started, completing material...");const{data:P,error:R}=await X.rpc("complete_material",{p_activity_id:parseInt(s)});if(console.log("Complete material result:",P,"Error:",R),R)throw R;if(P){const q=Math.floor((Date.now()-C)/1e3);console.log("Material completed successfully"),v(!0);try{localStorage.removeItem(u),localStorage.removeItem(m)}catch(L){console.error("Bd zapisu do localStorage:",L)}ar("get_course_structure"),ar("get_my_courses"),setTimeout(()=>{console.log("Forcing stats refresh..."),i()},500),setTimeout(async()=>{console.log("Manually checking updated stats...");const{data:L,error:U}=await X.rpc("get_my_stats");console.log("New stats after completion:",L,"Error:",U)},1e3)}}catch(D){console.error("Failed to complete lesson:",D),Y.error("Nie udao si ukoczy lekcji")}};return e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-10 pb-28 lg:pb-16",children:[e.jsx("div",{ref:_,"aria-live":"polite",className:"sr-only"}),e.jsxs("button",{onClick:()=>n(`/student/courses/${t}`),className:"flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx(Ne,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Powr贸t do kursu"})]}),e.jsx("section",{className:"relative overflow-hidden rounded-2xl border bg-white dark:bg-card",children:e.jsx("div",{className:"relative z-10 p-5 sm:p-7 md:p-10",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-4xl md:text-5xl leading-none",children:o?.topics?.courses?.icon_emoji||""}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-muted-foreground flex items-center gap-2",children:[e.jsx("span",{className:"truncate",children:o?.topics?.courses?.title||""}),e.jsx("span",{children:""}),e.jsx("span",{className:"truncate",children:o?.topics?.title||""})]}),e.jsx("h1",{className:"mt-1 text-xl md:text-3xl font-bold tracking-tight",children:o?.title||"adowanie"}),o?.duration_min&&e.jsxs("div",{className:"mt-3 inline-flex items-center gap-2 rounded-full border bg-white/70 dark:bg-background/60 px-3 py-1.5 shadow-soft",children:[e.jsx(et,{className:"h-4 w-4"}),e.jsxs("span",{className:"text-sm font-medium",children:[o?.duration_min," min czytania"]})]})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1fr_280px] gap-10",children:[e.jsx("main",{children:a?e.jsx(wD,{}):e.jsxs("section",{children:[e.jsx("div",{className:"prose prose-neutral dark:prose-invert max-w-[72ch] mx-auto prose-headings:font-semibold prose-p:text-muted-foreground prose-p:leading-relaxed prose-li:leading-relaxed prose-headings:tracking-tight prose-img:rounded-xl prose-blockquote:rounded-xl md:prose-lg",children:c.length?c.map((D,P)=>{const R=!!h[D.id],q=!R&&P===z,U=!(z===-1||P<=z)&&!R,O=(d.get(D.id)??[])[0],G="rounded-[20px] border p-6 sm:p-7 md:p-8 shadow-sm transition-colors duration-200",se=R?"bg-emerald-50 dark:bg-emerald-950/25 border-emerald-300":q?"bg-white dark:bg-background border-neutral-200 shadow-md":U?"bg-white dark:bg-card border-dashed border-muted-foreground/40":"bg-white dark:bg-card border-neutral-200",ie=!R&&U?"filter blur-[2px] select-none pointer-events-none":"";return e.jsxs("div",{id:D.id,className:"mb-12 scroll-mt-28",children:[e.jsxs("div",{className:`${G} ${se}`,children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-3",children:[U&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border px-2.5 py-0.5 text-[11px] text-muted-foreground bg-white",children:[e.jsx(Nn,{className:"h-3.5 w-3.5"}),"Zablokowana"]}),R&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-emerald-300/60 bg-emerald-50/60 px-2.5 py-0.5 text-[11px] text-emerald-700 dark:text-emerald-300",children:[e.jsx(rt,{className:"h-3.5 w-3.5"}),"Ukoczona"]}),q&&!R&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border bg-white px-2.5 py-0.5 text-[11px]",children:[e.jsx(pa,{className:"h-3.5 w-3.5"}),"W trakcie"]}),O&&e.jsxs("button",{type:"button",onClick:()=>!R&&!U&&T(D.id),disabled:R||U,className:["inline-flex items-center gap-1 rounded-full border px-2.5 py-0.5 text-[11px]",R?"text-emerald-700 border-emerald-300/60 bg-emerald-50/60 dark:bg-emerald-950/25":U?"text-muted-foreground cursor-not-allowed bg-white dark:bg-background/40":"bg-white hover:bg-muted"].join(" "),title:R?"Pytanie rozwizane":U?"Najpierw odblokuj sekcj":"Kliknij, aby odpowiedzie","aria-label":"Pytanie kontrolne",children:[e.jsx(Re,{className:"h-3.5 w-3.5"}),O.question.length>72?O.question.slice(0,69)+"":O.question]})]}),e.jsxs("div",{className:ie,children:[e.jsx("h2",{className:"text-[22px] md:text-[26px] font-semibold tracking-tight m-0 mb-4",children:D.title||`Sekcja ${P+1}`}),e.jsx(xi,{remarkPlugins:[wi],components:fh,children:D.content})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsxs("label",{className:["inline-flex items-center gap-3",U?"cursor-not-allowed opacity-60":"cursor-pointer"].join(" "),title:U?"Najpierw ukocz poprzednie sekcje":R?"Sekcja odhaczona  klik, aby cofn":O?"Kliknij, aby odpowiedzie na pytanie":"Odhacz sekcj",children:[e.jsx("input",{type:"checkbox",className:"sr-only",checked:R,onChange:()=>!U&&p(P),disabled:U&&!R,"aria-label":`Odhacz sekcj: ${D.title||`Sekcja ${P+1}`}`}),e.jsx("span",{className:["inline-flex items-center gap-2 rounded-lg border px-3 py-2 text-sm font-medium shadow-soft transition-all",R?"bg-emerald-50/70 dark:bg-emerald-950/30 border-emerald-300/60 text-emerald-700 dark:text-emerald-300":"bg-white hover:bg-muted border-neutral-200"].join(" "),children:O&&!R?e.jsx("span",{className:"truncate max-w-[56ch]",children:O.question}):e.jsxs(e.Fragment,{children:[R?e.jsx(rt,{className:"h-4 w-4"}):e.jsx(pa,{className:"h-4 w-4"}),e.jsxs("span",{className:"whitespace-nowrap",children:[String(P+1).padStart(2,"0"),"  ",R?"Odhaczono":O?"Odhacz (pytanie)":"Odhacz sekcj"]})]})})]})})]}),e.jsx("div",{className:"h-8"})]},D.id)}):l?e.jsx(xi,{remarkPlugins:[wi],components:fh,children:l}):e.jsx("div",{dangerouslySetInnerHTML:{__html:o?.content||""}})}),!!c.length&&e.jsx("div",{className:"mt-10 flex justify-end",children:e.jsx("button",{onClick:A,className:"inline-flex items-center gap-2 rounded-lg border bg-white px-4 py-2 text-sm font-medium shadow-soft hover:bg-muted transition-colors disabled:opacity-60",disabled:!k,title:k?void 0:"Najpierw odhacz wszystkie sekcje",children:"Zakocz lekcj"})})]})}),e.jsx("aside",{children:e.jsxs("nav",{className:"border rounded-[14px] p-4 bg-white dark:bg-background/60 lg:sticky lg:top-28",children:[e.jsx("h2",{className:"text-sm font-semibold mb-3",children:"Spis treci"}),a?e.jsx("div",{className:"h-4 w-40 rounded bg-muted/60 animate-pulse"}):c.length?e.jsx("ol",{className:"space-y-1.5 text-sm",children:c.map((D,P)=>{const R=!!h[D.id],q=!R&&P===z,U=!(z===-1||P<=z)&&!R,O=()=>{U||document.getElementById(D.id)?.scrollIntoView({behavior:"smooth"})};return e.jsxs("li",{className:"flex items-center gap-1.5",children:[U?e.jsx(Nn,{className:"h-3.5 w-3.5 text-muted-foreground"}):R?e.jsx(rt,{className:"h-3.5 w-3.5 text-emerald-600"}):e.jsx(pa,{className:"h-3.5 w-3.5"}),e.jsxs("button",{onClick:O,className:["flex-1 text-left px-2 py-1 rounded transition-colors",U?"text-muted-foreground cursor-not-allowed":"hover:bg-muted",R?"text-emerald-700":"",q?"font-semibold underline":""].join(" "),disabled:U,children:[String(P+1).padStart(2,"0"),". ",D.title||`Sekcja ${P+1}`]})]},D.id)})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Brak sekcji."})]})})]}),j&&e.jsx(bD,{quiz:j,onClose:()=>w(null),onPass:N}),b&&e.jsx(vD,{lessonTitle:o?.title||"Lekcja",courseId:t,timeSpent:Math.floor((Date.now()-C)/1e3),sectionsCount:c.length,quizzesCompleted:Object.keys(x).length,pointsEarned:5,nextLessonPath:void 0})]})},kD=[e.jsx(K,{path:"/courses/:courseId/lesson/:lessonId",element:e.jsx(ND,{})},"lesson-view")],zD=()=>{const{courseId:t,quizId:s}=Ct(),n=ae(),{refetch:i}=Un(),[r,a]=te.useState(0),[o,l]=te.useState({}),[c,d]=te.useState(null),[u,m]=te.useState(!1),[h,y]=te.useState([]),[x,g]=te.useState(!0),{data:j,isLoading:w}=Xe({resource:"activities",id:s,meta:{select:"*, topics(title, course_id, courses(title, icon_emoji))"}});te.useEffect(()=>{(async()=>{if(s)try{await X.rpc("start_activity",{p_activity_id:parseInt(s)}),g(!0);const{data:R,error:q}=await X.rpc("get_quiz_questions",{p_activity_id:parseInt(s)});if(q)throw q;const L=typeof R=="string"?JSON.parse(R):R;y(Array.isArray(L)?L:[])}catch(R){console.error("Quiz init error:",R),Y.error("Bd podczas adowania quizu")}finally{g(!1)}})()},[s]),te.useEffect(()=>{j?.data?.time_limit&&c===null&&d(j.data.time_limit*60)},[j]),te.useEffect(()=>{if(c!==null&&c>0){const P=setTimeout(()=>d(c-1),1e3);return()=>clearTimeout(P)}else c===0&&k()},[c]);const b=j?.data,v=h[r],C=h.length>0?(r+1)/h.length*100:0,_=P=>{if(P.type)switch(P.type){case"single_choice":return"single";case"multiple_choice":return"multiple";case"true_false":return"true_false"}return"single"},S=P=>{switch(P){case"single":return{label:"Jednokrotny wyb贸r",icon:Rt};case"multiple":return{label:"Wielokrotny wyb贸r",icon:Ys};case"true_false":return{label:"Prawda/Fasz",icon:Me}}},z=(P,R,q)=>{if(q){const L=o[P]||[],U=L.includes(R)?L.filter(O=>O!==R):[...L,R];l(O=>({...O,[P]:U}))}else l(L=>({...L,[P]:R}))},k=async()=>{m(!0);try{const P=Object.entries(o).flatMap(([L,U])=>Array.isArray(U)?U.map(O=>({question_id:parseInt(L),option_id:O})):[{question_id:parseInt(L),option_id:U}]);console.log("Submitting quiz answers:",P);const{data:R,error:q}=await X.rpc("finish_quiz",{p_activity_id:parseInt(s),p_answers:P});if(q)throw q;R&&(console.log("Quiz finished successfully:",R),ar("get_course_structure"),ar("get_my_courses"),ar("get_my_stats"),setTimeout(()=>{console.log("Forcing stats refresh..."),i()},500),n(`/student/courses/${t}/quiz/${s}/result`,{state:{courseId:t,quizId:s,result:{...R,passing_score:b?.passing_score||70,max_attempts:b?.max_attempts,attempts_used:b?.attempts||1}}}))}catch(P){console.error("Failed to submit quiz:",P),Y.error("Nie udao si przesa odpowiedzi")}finally{m(!1)}};if(w||x)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});if(!v)return null;const T=_(v),p=S(T),N=T==="multiple",A=o[v.id],D=N?Array.isArray(A)&&A.length>0:A!==void 0;return e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 max-w-3xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("button",{onClick:()=>n(`/student/courses/${t}`),className:"flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx(Ne,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Zakocz quiz"})]}),c!==null&&e.jsxs("div",{className:B("flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium",c<60?"bg-red-100 text-red-700":"bg-muted text-foreground"),children:[e.jsx(et,{className:"w-4 h-4"}),Math.floor(c/60),":",String(c%60).padStart(2,"0")]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:b?.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Pytanie ",r+1," z ",h.length]}),e.jsx("span",{children:""}),e.jsxs("span",{children:[v.points," pkt"]}),e.jsx("span",{children:""}),e.jsxs(V,{variant:"outline",className:"text-xs",children:[e.jsx(p.icon,{className:"w-3 h-3 mr-1"}),p.label]})]})]}),e.jsx("div",{className:"h-1 bg-muted rounded-full overflow-hidden mb-8",children:e.jsx(ze.div,{initial:{width:0},animate:{width:`${C}%`},className:"h-full bg-primary"})}),e.jsx(N4,{mode:"wait",children:e.jsx(ze.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},transition:{duration:.2},children:e.jsxs("div",{className:"bg-card rounded-2xl border p-8 mb-8",children:[e.jsx("h2",{className:"text-lg font-medium mb-6",children:v.question}),N&&e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"锔 Zaznacz wszystkie poprawne odpowiedzi"}),e.jsx("div",{className:"space-y-3",children:v.options.map(P=>{const R=N?Array.isArray(A)&&A.includes(P.id):A===P.id;return e.jsx("label",{className:B("block p-4 rounded-xl border-2 cursor-pointer transition-all",R?"border-primary bg-primary/5":"border-border hover:border-muted-foreground"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:N?"checkbox":"radio",name:`question-${v.id}`,value:P.id,checked:R,onChange:()=>z(v.id,P.id,N),className:"sr-only"}),e.jsxs("div",{className:B("flex items-center justify-center flex-shrink-0",N?B("w-5 h-5 rounded border-2",R?"border-primary bg-primary text-primary-foreground":"border-muted-foreground"):B("w-5 h-5 rounded-full border-2",R?"border-primary":"border-muted-foreground")),children:[N&&R&&e.jsx(rt,{className:"w-3 h-3"}),!N&&R&&e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-primary"})]}),e.jsx("span",{className:"flex-1",children:P.text})]})},P.id)})})]})},v.id)}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>a(Math.max(0,r-1)),disabled:r===0,className:B("flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all",r===0?"text-muted-foreground cursor-not-allowed":"text-foreground hover:bg-muted"),children:[e.jsx(Ne,{className:"w-4 h-4"}),"Poprzednie"]}),e.jsx("div",{className:"flex gap-2",children:h.map((P,R)=>{const q=o[h[R]?.id],L=Array.isArray(q)?q.length>0:q!==void 0;return e.jsx("button",{onClick:()=>a(R),className:B("w-2 h-2 rounded-full transition-all",R===r?"bg-primary w-8":L?"bg-muted-foreground":"bg-muted")},R)})}),r<h.length-1?e.jsxs("button",{onClick:()=>a(r+1),disabled:!D,className:B("flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all",D?"bg-primary text-primary-foreground hover:bg-primary/90":"bg-muted text-muted-foreground cursor-not-allowed"),children:["Nastpne",e.jsx(He,{className:"w-4 h-4"})]}):e.jsxs("button",{onClick:k,disabled:u||Object.keys(o).length<h.length,className:B("flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all",u||Object.keys(o).length<h.length?"bg-muted text-muted-foreground cursor-not-allowed":"bg-green-500 text-white hover:bg-green-600"),children:[u?"Przesyanie...":"Zakocz quiz",e.jsx(rt,{className:"w-4 h-4"})]})]})]})},SD=()=>{const t=ae(),s=Ns(),{courseId:n,quizId:i,result:r}=s.state,a=b=>{const v=Math.floor(b/60),C=b%60;return`${v}:${String(C).padStart(2,"0")}`},o=b=>b>=90?"text-green-600":b>=70?"text-yellow-600":"text-red-600",l=b=>b<30?1:b<50?2:b<70?5:10+Math.floor((b-70)/3),c=r.max_attempts&&(r.attempts_used??0)<r.max_attempts,d=r.score===100,u=r.user_points||0,m=r.next_level_points||((r.user_level||1)+1)*100,h=u%100,y=m-u,x=h/100*100,g=r.question_results?.filter(b=>b.is_correct).length||0,j=r.question_results?.length||0,w=j-g;return e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-3xl",children:[e.jsxs(ze.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.3},className:"space-y-6",children:[e.jsx(I,{children:e.jsxs(E,{className:"pt-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:B("inline-flex items-center justify-center w-16 h-16 rounded-full mb-4",r.passed?"bg-green-100":"bg-orange-100"),children:e.jsx(qe,{className:B("w-8 h-8",r.passed?"text-green-600":"text-orange-600")})}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:r.passed?"Quiz zaliczony!":"Niezaliczone, ale zdobywasz punkty!"}),e.jsx("p",{className:"text-muted-foreground",children:r.passed?d?"Perfekcyjny wynik! Jeste mistrzem!":"Gratulacje! wietnie Ci poszo.":`Zdobywasz ${r.points_earned} punkt贸w za swoj pr贸b!`})]}),e.jsx("div",{className:"bg-muted/50 rounded-xl p-6 mb-6",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:B("text-5xl font-bold mb-2",o(r.score)),children:[r.score,"%"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Tw贸j wynik"})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx(Ye,{className:"w-4 h-4 text-yellow-600"}),e.jsx("span",{className:"font-semibold text-lg",children:r.points_earned})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Punkt贸w zdobytych"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx(et,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-semibold",children:a(r.time_spent)})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Czas"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx(Be,{className:"w-4 h-4 text-purple-600"}),e.jsxs("span",{className:"font-semibold",children:[r.passing_score,"%"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pr贸g zaliczenia"})]})]})]})}),e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs($,{className:"text-lg flex items-center gap-2",children:[e.jsx(ji,{className:"w-5 h-5"}),"Postp poziomu"]})}),e.jsx(E,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("span",{className:"font-medium",children:["Poziom ",r.user_level||1]}),e.jsxs("span",{className:"text-muted-foreground",children:[u," / ",m," punkt贸w"]}),e.jsxs("span",{className:"font-medium",children:["Poziom ",(r.user_level||1)+1]})]}),e.jsx(is,{value:x,className:"h-3"}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Do nastpnego poziomu pozostao:",e.jsxs("span",{className:"font-semibold text-foreground ml-1",children:[y," punkt贸w"]})]}),r.points_earned>0&&e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:["+",r.points_earned," punkt贸w z tego quizu!"]})]})]})})]}),r.question_results&&r.question_results.length>0&&e.jsxs(I,{children:[e.jsx(F,{children:e.jsxs($,{className:"text-lg flex items-center justify-between",children:[e.jsx("span",{children:"Analiza odpowiedzi"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(Rt,{className:"w-4 h-4"}),g]}),e.jsxs("span",{className:"flex items-center gap-1 text-red-600",children:[e.jsx(jl,{className:"w-4 h-4"}),w]})]})]})}),e.jsxs(E,{children:[e.jsx("div",{className:"space-y-3",children:r.question_results.map((b,v)=>e.jsx(ze.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:v*.05},className:B("p-4 rounded-lg border transition-all",b.is_correct?"bg-green-50 dark:bg-green-950/30 border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-950/30 border-red-200 dark:border-red-800"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:b.is_correct?e.jsx(Rt,{className:"w-5 h-5 text-green-600"}):e.jsx(jl,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h4",{className:"font-medium text-sm",children:["Pytanie ",v+1]}),e.jsxs("span",{className:B("text-sm font-semibold",b.is_correct?"text-green-600":"text-red-600"),children:[b.is_correct?`+${b.points}`:"0"," pkt"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:b.question_text}),e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-muted-foreground min-w-[120px]",children:"Twoja odpowied藕:"}),e.jsx("span",{className:B("font-medium flex-1",b.is_correct?"text-green-700 dark:text-green-400":"text-red-700 dark:text-red-400"),children:Array.isArray(b.your_answer)?b.your_answer.join(", "):b.your_answer||"Brak odpowiedzi"})]}),!b.is_correct&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-muted-foreground min-w-[120px]",children:"Poprawna odpowied藕:"}),e.jsx("span",{className:"font-medium text-green-700 dark:text-green-400 flex-1",children:Array.isArray(b.correct_answer)?b.correct_answer.join(", "):b.correct_answer})]})]})]})]})},b.question_id))}),e.jsxs("div",{className:"mt-6 p-4 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Skuteczno:"}),e.jsx("span",{className:"font-semibold",children:j>0?`${Math.round(g/j*100)}%`:"0%"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm mt-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"Zdobyte punkty:"}),e.jsxs("span",{className:"font-semibold",children:[r.question_results.filter(b=>b.is_correct).reduce((b,v)=>b+v.points,0)," / ",r.question_results.reduce((b,v)=>b+v.points,0)]})]})]})]})]}),e.jsxs(I,{className:B(r.points_earned>0?"border-primary/50":""),children:[e.jsx(F,{children:e.jsxs($,{className:"text-lg flex items-center gap-2",children:[e.jsx(xt,{className:"w-5 h-5"}),"Jak obliczylimy Twoje punkty"]})}),e.jsxs(E,{children:[e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Punkty bazowe za wynik ",r.score,"%:"]}),e.jsxs("span",{className:"font-medium tabular-nums",children:[r.base_points||l(r.score)," pkt"]})]}),r.multipliers?.quiz_multiplier&&r.multipliers.quiz_multiplier>1&&e.jsxs("div",{className:"flex justify-between items-center text-green-600 dark:text-green-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ys,{className:"w-3 h-3"}),'Ulepszenie "Szybki umys":']}),e.jsxs("span",{className:"font-medium",children:["",r.multipliers.quiz_multiplier]})]}),r.streak_days&&r.streak_days>0&&r.multipliers?.streak_multiplier&&e.jsxs("div",{className:"flex justify-between items-center text-orange-600 dark:text-orange-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ms,{className:"w-3 h-3"}),"Streak ",r.streak_days," dni:"]}),e.jsxs("span",{className:"font-medium",children:["",r.multipliers.streak_multiplier.toFixed(1)]})]}),d&&r.perfect_bonus&&r.perfect_bonus>0&&e.jsxs("div",{className:"flex justify-between items-center text-purple-600 dark:text-purple-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Dw,{className:"w-3 h-3"}),"Bonus perfekcjonisty:"]}),e.jsxs("span",{className:"font-medium",children:["+",r.perfect_bonus," pkt"]})]}),r.multipliers?.min_points&&r.score<30&&e.jsxs("div",{className:"flex justify-between items-center text-blue-600 dark:text-blue-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(pr,{className:"w-3 h-3"}),'Gwarancja "Druga szansa":']}),e.jsxs("span",{className:"font-medium",children:["min. ",r.multipliers.min_points," pkt"]})]}),e.jsx("div",{className:"pt-2 mt-2 border-t border-border/50",children:e.jsxs("div",{className:"flex justify-between items-center font-semibold",children:[e.jsx("span",{children:"cznie zdobywasz:"}),e.jsxs("span",{className:"text-lg text-primary",children:[r.points_earned," punkt贸w"]})]})})]}),(!r.multipliers?.quiz_multiplier||r.multipliers.quiz_multiplier===1)&&e.jsx("div",{className:"mt-3 p-2 bg-amber-50 dark:bg-amber-900/20 rounded-md",children:e.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-400 flex items-center gap-1",children:[e.jsx(Me,{className:"w-3 h-3 flex-shrink-0"}),"Wskaz贸wka: Kup ulepszenia w zakadce Idle aby zwikszy punkty z quiz贸w!"]})})]})]}),!r.passed&&e.jsx(I,{className:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800",children:e.jsxs(E,{className:"pt-6",children:[e.jsx("h4",{className:"font-medium text-sm mb-1 text-blue-700 dark:text-blue-400",children:"Nie poddawaj si! "}),e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-300",children:r.score>=60?`wietnie Ci idzie! Brakuje tylko ${r.passing_score-r.score}% do zaliczenia.`:r.score>=40?"Ju偶 prawie poowa! Przejrzyj materiay i spr贸buj ponownie.":"Ka偶da pr贸ba to krok naprz贸d. Wr贸 do materia贸w i pr贸buj dalej!"})]})}),e.jsxs("div",{className:"flex gap-3",children:[r.passed?e.jsxs("button",{onClick:()=>t(`/student/courses/${n}`),className:"flex-1 inline-flex items-center justify-center gap-2 rounded-lg bg-primary px-4 py-2.5 text-primary-foreground hover:bg-primary/90 focus-ring",children:["Kontynuuj kurs",e.jsx(He,{className:"w-4 h-4"})]}):e.jsx(e.Fragment,{children:c?e.jsxs("button",{onClick:()=>t(`/student/courses/${n}/quiz/${i}`),className:"flex-1 inline-flex items-center justify-center gap-2 rounded-lg bg-primary px-4 py-2.5 text-primary-foreground hover:bg-primary/90 focus-ring",children:[e.jsx(pr,{className:"w-4 h-4"}),"Spr贸buj ponownie"]}):e.jsx("button",{onClick:()=>t(`/student/courses/${n}`),className:"flex-1 rounded-lg border px-4 py-2.5 hover:bg-muted/50 focus-ring",children:"Wr贸 do kursu"})}),e.jsx("button",{onClick:()=>t("/student/dashboard"),className:"px-4 py-2.5 rounded-lg border hover:bg-muted/50 focus-ring",children:"Dashboard"})]}),r.max_attempts&&e.jsxs("p",{className:"text-center text-xs text-muted-foreground",children:["Wykorzystane pr贸by: ",r.attempts_used," z ",r.max_attempts]})]}),d&&e.jsx(ze.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.5},className:"mt-4 text-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:" Mistrzostwo! Twoja wiedza jest imponujca!"})})]})},CD=[e.jsx(K,{path:"/courses/:courseId/quiz/:quizId",element:e.jsx(zD,{})},"quiz-take"),e.jsx(K,{path:"/courses/:courseId/quiz/:quizId/result",element:e.jsx(SD,{})},"quiz-result")],_D={"":Ye,"":pc,"":ys,"":Mw,"":Pw},TD=()=>e.jsxs("div",{className:"rounded-2xl border bg-card p-6 shadow-soft animate-pulse",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-muted/70"}),e.jsxs("div",{children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted/70"}),e.jsx("div",{className:"mt-2 h-3 w-24 rounded bg-muted/60"})]})]}),e.jsx("div",{className:"h-5 w-16 rounded-full bg-muted/60"})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsx("div",{className:"h-3 w-full rounded bg-muted/60"}),e.jsx("div",{className:"h-3 w-2/3 rounded bg-muted/60"})]}),e.jsx("div",{className:"h-10 w-full rounded-lg bg-muted/60"})]}),AD=()=>{const{stats:t,refetch:s}=Un(),{data:n,isLoading:i,refetch:r}=Zr("get_idle_upgrades"),a=async l=>{try{const{data:c,error:d}=await X.rpc("buy_idle_upgrade",{p_upgrade_id:l});if(d)throw d;c&&(Y.success(`Ulepszenie zakupione! Poziom ${c.new_level}`),s(),r())}catch{Y.error("Niewystarczajca ilo punkt贸w")}},o=n||[];return e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8 pb-24 lg:pb-8",children:[e.jsxs(ze.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.45},className:"relative overflow-hidden rounded-2xl border",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/[0.12] via-secondary/[0.10] to-accent/[0.12]"}),e.jsx("div",{className:"absolute inset-0 opacity-[0.06]",style:{backgroundImage:`
                linear-gradient(to right, hsl(var(--ring)/0.35) 1px, transparent 1px),
                linear-gradient(to bottom, hsl(var(--ring)/0.35) 1px, transparent 1px)
              `,backgroundSize:"28px 28px"}})]}),e.jsx("div",{className:"relative z-10 p-4 sm:p-6 md:p-8",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-12 md:items-center",children:[e.jsxs("div",{className:"md:col-span-4 space-y-2",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Ulepszenia"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Inwestuj punkty, aby zwikszy tempo zdobywania kolejnych."})]}),e.jsxs("div",{className:"md:col-span-8 grid grid-cols-3 gap-4 md:gap-6",children:[e.jsxs("div",{className:"rounded-xl border bg-card p-5 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Punkty / h"}),e.jsx(xt,{className:"h-4 w-4 text-accent"})]}),e.jsx("div",{className:"mt-2 flex items-end gap-2",children:e.jsx("span",{className:"text-4xl md:text-5xl font-semibold text-accent leading-none tabular-nums",children:e.jsx(it,{value:t.idle_rate})})}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Premia za obecno."})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-5 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Twoje punkty"}),e.jsx(Ye,{className:"h-4 w-4 text-primary"})]}),e.jsxs("div",{className:"mt-2 flex items-end gap-2",children:[e.jsx("span",{className:"text-4xl md:text-5xl font-semibold text-primary leading-none tabular-nums",children:e.jsx(it,{value:t.points})}),e.jsx("span",{className:"mb-[2px] text-sm text-muted-foreground",children:"pkt"})]}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Wydaj je na ulepszenia poni偶ej."})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-5 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Do kolejnego poziomu"}),e.jsx(pc,{className:"h-4 w-4 text-secondary"})]}),e.jsx("div",{className:"mt-3",children:e.jsx(Dn,{value:t.points%100})}),e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:["Pozostao ",100-t.points%100," pkt"]})]})]})]})})]}),e.jsxs(ze.section,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.4,delay:.05},className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between gap-4",children:e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-lg sm:text-xl md:text-2xl font-semibold tracking-tight",children:"Dostpne ulepszenia"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Wybierz i zwiksz swoje tempo zdobywania punkt贸w."})]})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 sm:gap-5",children:[i&&Array.from({length:6}).map((l,c)=>e.jsx(TD,{},c)),!i&&o.map((l,c)=>{const d=t.points>=l.next_cost,u=_D[l.icon]||Ye;return e.jsxs(qi,{index:c,className:B("group relative rounded-2xl border bg-card p-5 shadow-soft hover:bg-muted/40 transition-colors"),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-muted flex items-center justify-center shrink-0",children:e.jsx(u,{className:"w-6 h-6 text-muted-foreground"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h4",{className:"font-semibold text-sm sm:text-base text-foreground line-clamp-2",children:l.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Poziom ",l.current_level]})]})]}),e.jsx("span",{className:B("inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-[11px] font-semibold border",d?"border-primary/30 text-primary":"border-muted-foreground/25 text-muted-foreground"),children:d?"Dostpne":"Za drogie"})]}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-xs sm:text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Aktualny bonus"}),e.jsxs("span",{className:"font-medium text-green-600 dark:text-green-400",children:["+",e.jsx(it,{value:l.total_bonus})," pkt/h"]})]}),e.jsxs("div",{className:"flex justify-between text-xs sm:text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Nastpny poziom"}),e.jsxs("span",{className:"font-medium",children:["+",l.bonus_per_level," pkt/h"]})]})]}),e.jsxs(ze.button,{whileHover:d?{scale:1.02}:{},whileTap:d?{scale:.98}:{},onClick:()=>a(l.id),disabled:!d,className:B("mt-4 w-full py-2.5 sm:py-3 rounded-lg font-medium focus-ring transition-colors",d?"bg-primary text-primary-foreground hover:bg-primary/90":"bg-muted text-muted-foreground cursor-not-allowed"),title:d?"Kup ulepszenie":"Brakuje punkt贸w",children:["Ulepsz za ",e.jsx(it,{value:l.next_cost})," pkt"]})]},l.id)})]})]})]})},DD=[e.jsx(K,{path:"/gamification",element:e.jsx(AD,{})},"gamification")],PD=()=>e.jsx("div",{className:"rounded-2xl border bg-card p-4 shadow-soft animate-pulse",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-8 h-5 rounded bg-muted/60"}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-muted/70"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted/60"}),e.jsx("div",{className:"mt-2 h-3 w-28 rounded bg-muted/50"})]}),e.jsx("div",{className:"h-5 w-16 rounded bg-muted/60"})]})}),MD=()=>{const{data:t}=Ze(),[s,n]=te.useState("all"),{data:i,isLoading:r,refetch:a,error:o}=Zr("get_leaderboard",{p_limit:20,p_filter:s});te.useEffect(()=>{let d=!1,u=!1;return(async()=>{if(!(d||u)){u=!0;try{await a()}finally{u=!1}}})(),()=>{d=!0}},[s]);const l=i||[],c=d=>{switch(d){case 1:return e.jsx(qe,{className:"w-5 h-5 text-yellow-500"});case 2:return e.jsx(rp,{className:"w-5 h-5 text-gray-400"});case 3:return e.jsx(Ls,{className:"w-5 h-5 text-orange-500"});default:return e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:d})}};return e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8 pb-24 lg:pb-8",children:[e.jsxs(ze.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.45},className:"relative overflow-hidden rounded-2xl border",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/[0.12] via-secondary/[0.10] to-accent/[0.12]"}),e.jsx("div",{className:"absolute inset-0 opacity-[0.06]",style:{backgroundImage:`
                linear-gradient(to right, hsl(var(--ring)/0.35) 1px, transparent 1px),
                linear-gradient(to bottom, hsl(var(--ring)/0.35) 1px, transparent 1px)
              `,backgroundSize:"28px 28px"}})]}),e.jsx("div",{className:"relative z-10 p-4 sm:p-6 md:p-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Ranking"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Top 20 u偶ytkownik贸w wedug punkt贸w."})]}),e.jsx("div",{className:"bg-muted rounded-lg p-1 inline-flex gap-1",children:[{value:"all",label:"Wszyscy"},{value:"students",label:"Uczniowie"},{value:"teachers",label:"Nauczyciele"}].map(d=>e.jsx("button",{onClick:()=>n(d.value),className:B("px-3 sm:px-4 py-1.5 rounded-md text-sm font-medium transition-colors",s===d.value?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:d.label},d.value))})]})})]}),e.jsxs(ze.section,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.4,delay:.05},className:"space-y-2",children:[r&&Array.from({length:4}).map((d,u)=>e.jsx(PD,{},u)),!r&&(o||l.length===0)&&e.jsxs("div",{className:"rounded-2xl border bg-card p-8 text-center shadow-soft",children:[e.jsx("div",{className:"text-4xl",children:"ゲ"}),e.jsx("h4",{className:"mt-3 text-base sm:text-lg font-semibold",children:"Brak wynik贸w"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:o?"Nie udao si pobra rankingu.":"Brak danych dla wybranego filtra."}),e.jsxs("button",{onClick:()=>a(),className:"mt-4 inline-flex items-center gap-2 rounded-lg border px-3 py-2 text-sm hover:bg-primary/5 focus-ring",children:[e.jsx(sp,{className:"w-4 h-4"}),"Spr贸buj ponownie"]})]}),!r&&l.length>0&&l.map((d,u)=>{const m=d.user_id===t?.id,h=d.rank<=3;return e.jsxs(qi,{index:u,className:B("flex items-center gap-4 p-4 rounded-2xl border shadow-soft transition-colors",m?"bg-primary text-primary-foreground border-primary/40":h?"bg-muted/50 border-border":"bg-card hover:bg-muted/40 border-border"),children:[e.jsx("div",{className:"w-8 flex justify-center",children:c(d.rank)}),e.jsx("div",{className:B("w-10 h-10 rounded-full flex items-center justify-center font-semibold shrink-0",m?"bg-primary-foreground text-primary":h?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground"),"aria-label":`Avatar u偶ytkownika ${d.full_name||"U偶ytkownik"}`,title:d.full_name||"U偶ytkownik",children:d.full_name?.charAt(0)??"U"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-medium truncate",children:[d.full_name||"U偶ytkownik",m&&e.jsx("span",{className:"ml-2 text-sm opacity-80",children:"(Ty)"})]}),e.jsxs("div",{className:B("text-sm",m?"text-primary-foreground/80":"text-muted-foreground"),children:["Poziom ",d.level,"  Seria ",d.streak," dni"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-semibold tabular-nums",children:e.jsx(it,{value:d.points})}),e.jsx("div",{className:B("text-xs",m?"text-primary-foreground/80":"text-muted-foreground"),children:"punkt贸w"})]})]},d.user_id||`${d.rank}-${u}`)})]})]})},ID=[e.jsx(K,{path:"/leaderboard",element:e.jsx(MD,{})},"leaderboard")],Qi=[{id:1,icon:ms,title:"Pierwszy Krok",description:"Ukocz pierwsz lekcj",unlocked:!0,rarity:"common",unlockedAt:"2024-01-15",progress:100},{id:2,icon:Sn,title:"Perfekcjonista",description:"Zdobd藕 100% w 10 quizach",unlocked:!0,rarity:"rare",unlockedAt:"2024-02-20",progress:100},{id:3,icon:Ye,title:"Byskawica",description:"Ukocz 5 lekcji w jeden dzie",unlocked:!1,rarity:"epic",progress:60},{id:4,icon:qe,title:"Mistrz",description:"Osignij poziom 50",unlocked:!1,rarity:"legendary",progress:24},{id:5,icon:Be,title:"Snajper",description:"Odpowiedz poprawnie na 100 pyta z rzdu",unlocked:!1,rarity:"epic",progress:45},{id:6,icon:pc,title:"Rakieta",description:"Ukocz kurs w mniej ni偶 tydzie",unlocked:!1,rarity:"rare",progress:0}],xh={common:{bg:"bg-muted",ring:"ring-1 ring-border",label:"Pospolite",badge:"border border-muted-foreground/20 text-muted-foreground bg-background/60"},rare:{bg:"bg-blue-500/10",ring:"ring-1 ring-blue-500/30",label:"Rzadkie",badge:"border border-blue-500/30 text-blue-600 dark:text-blue-400"},epic:{bg:"bg-purple-500/10",ring:"ring-1 ring-purple-500/30",label:"Epiczne",badge:"border border-purple-500/30 text-purple-600 dark:text-purple-400"},legendary:{bg:"bg-orange-500/10",ring:"ring-1 ring-orange-500/30",label:"Legendarne",badge:"border border-orange-500/30 text-orange-600 dark:text-orange-400"}},ED=()=>{const t=Qi.filter(i=>i.unlocked).length,s=Qi.length,n=Math.round(t/s*100);return e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8 pb-24 lg:pb-8",children:[e.jsxs(ze.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.45},className:"relative overflow-hidden rounded-2xl border",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/[0.12] via-secondary/[0.10] to-accent/[0.12]"}),e.jsx("div",{className:"absolute inset-0 opacity-[0.06]",style:{backgroundImage:`
                linear-gradient(to right, hsl(var(--ring)/0.35) 1px, transparent 1px),
                linear-gradient(to bottom, hsl(var(--ring)/0.35) 1px, transparent 1px)
              `,backgroundSize:"28px 28px"}})]}),e.jsxs("div",{className:"relative z-10 p-4 sm:p-6 md:p-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Osignicia"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Odblokowano"," ",e.jsx("span",{className:"font-semibold tabular-nums",children:t})," ","z"," ",e.jsx("span",{className:"font-semibold tabular-nums",children:s})," ","(",n,"%)"]})]}),e.jsxs("div",{className:"w-full md:w-96",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-1.5",children:[e.jsx("span",{className:"text-muted-foreground",children:"Postp osigni"}),e.jsxs("span",{className:"font-medium tabular-nums",children:[n,"%"]})]}),e.jsx(Dn,{value:n})]})]}),e.jsx("div",{className:"mt-4 grid grid-cols-2 sm:grid-cols-4 gap-2",children:Object.entries(xh).map(([i,r])=>{const a=Qi.filter(l=>l.rarity===i&&l.unlocked).length,o=Qi.filter(l=>l.rarity===i).length;return e.jsxs("div",{className:B("rounded-xl border bg-card/70 backdrop-blur-sm p-3 shadow-soft"),children:[e.jsxs("p",{className:"text-lg font-semibold tabular-nums",children:[a,"/",o]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.label})]},i)})})]})]}),e.jsx(ze.section,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.4,delay:.05},className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-5",children:Qi.map((i,r)=>{const a=xh[i.rarity],o=i.icon,l=i.unlocked?e.jsx("span",{className:B("inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-[11px] font-semibold",a.badge),children:"Odblokowane"}):e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-primary/30 text-primary px-2.5 py-1 text-[11px] font-semibold",children:[i.progress,"%"]});return e.jsxs(qi,{index:r,className:B("group relative rounded-2xl border bg-card p-5 shadow-soft hover:bg-muted/40 transition-colors",!i.unlocked&&"opacity-95"),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:B("w-12 h-12 rounded-xl flex items-center justify-center shrink-0",a.bg,a.ring),children:e.jsx(o,{className:"w-6 h-6"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm sm:text-base text-foreground line-clamp-2",children:i.title}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:i.description})]})]}),l]}),e.jsx("div",{className:"mt-4",children:i.unlocked?e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Odblokowano:"," ",e.jsx("span",{className:"font-medium",children:new Date(i.unlockedAt).toLocaleDateString("pl-PL")})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"Postp"}),e.jsxs("span",{className:"font-medium tabular-nums",children:[i.progress,"%"]})]}),e.jsx(Dn,{value:i.progress})]})})]},i.id)})})]})},RD=[e.jsx(K,{path:"/achievements",element:e.jsx(ED,{})},"achievements")],LD=()=>{const{data:t}=Ze(),{stats:s}=Un(),n=t?.full_name||t?.name||t?.email||"U偶ytkownik",i=(t?.full_name||t?.name||"U").split(" ").map(o=>o[0]).slice(0,2).join("").toUpperCase()||"U",r=(()=>{const o=t?.created_at;return(o?new Date(o):new Date).toLocaleDateString("pl-PL")})(),a=[{icon:qe,label:"Punkty",value:s.points,iconColor:"text-primary",highlight:"primary",counter:!0},{icon:Be,label:"Ukoczone quizy",value:s.quizzes_completed??0,iconColor:"text-green-600 dark:text-green-400",counter:!1},{icon:Sn,label:"Perfekcyjne wyniki",value:s.perfect_scores??0,iconColor:"text-yellow-600 dark:text-yellow-400",counter:!1},{icon:ms,label:"Najdu偶sza seria",value:`${s.streak??0} dni`,iconColor:"text-destructive",counter:!1},{icon:et,label:"Czas nauki",value:`${Math.max(0,Math.floor((s.total_time??0)/60))}h`,iconColor:"text-blue-600 dark:text-blue-400",counter:!1},{icon:qe,label:"Poziom",value:`Poziom ${s.level??1}`,iconColor:"text-secondary",counter:!1}];return e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8 pb-24 lg:pb-8",children:[e.jsxs(ze.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.45},className:"relative overflow-hidden rounded-2xl border",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/[0.12] via-secondary/[0.10] to-accent/[0.12]"}),e.jsx("div",{className:"absolute inset-0 opacity-[0.06]",style:{backgroundImage:`
                linear-gradient(to right, hsl(var(--ring)/0.35) 1px, transparent 1px),
                linear-gradient(to bottom, hsl(var(--ring)/0.35) 1px, transparent 1px)
              `,backgroundSize:"28px 28px"}})]}),e.jsx("div",{className:"relative z-10 p-4 sm:p-6 md:p-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-6",children:[e.jsxs("div",{className:"flex items-start gap-4 sm:gap-6",children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 rounded-2xl bg-primary text-primary-foreground flex items-center justify-center text-xl sm:text-2xl font-semibold shadow-soft",children:i}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:n}),e.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-muted-foreground",children:[t?.email&&e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[e.jsx(Qa,{className:"w-4 h-4 shrink-0"}),e.jsx("span",{className:"truncate",children:t.email})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(js,{className:"w-4 h-4"}),e.jsxs("span",{children:["Doczy ",r]})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("button",{className:"inline-flex items-center gap-2 rounded-lg border px-3 py-2 text-sm hover:bg-primary/5 focus-ring",children:[e.jsx(Iw,{className:"w-4 h-4"}),"Edytuj profil"]}),e.jsx("button",{className:"inline-flex items-center gap-2 rounded-lg bg-primary px-3 py-2 text-sm text-primary-foreground hover:bg-primary/90 focus-ring",children:"Ustawienia"})]})]})})]}),e.jsxs(ze.section,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.4,delay:.05},children:[e.jsx("h2",{className:"text-lg sm:text-xl md:text-2xl font-semibold tracking-tight mb-4",children:"Statystyki"}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-5",children:a.map((o,l)=>{const c=o.icon;return e.jsx(qi,{index:l,className:"group relative rounded-2xl border bg-card p-5 shadow-soft hover:bg-muted/40 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-muted flex items-center justify-center shrink-0",children:e.jsx(c,{className:`w-6 h-6 ${o.iconColor}`})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:`text-2xl font-semibold leading-none tabular-nums ${o.highlight==="primary"?"text-primary":o.highlight==="secondary"?"text-secondary":o.highlight==="accent"?"text-accent":"text-foreground"}`,children:o.counter?e.jsx(it,{value:Number(o.value)}):o.value}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:o.label})]})]})},o.label)})})]}),e.jsxs(ze.section,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.4,delay:.08},className:"space-y-4",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold tracking-tight",children:"Ustawienia"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:flex-wrap gap-3",children:[e.jsx(ze.button,{whileHover:{x:2},whileTap:{scale:.98},className:"w-full sm:w-auto sm:min-w-[220px] inline-flex items-center justify-center rounded-xl bg-primary text-primary-foreground px-4 py-3 shadow-soft hover:bg-primary/90 focus-ring",children:e.jsxs("span",{className:"inline-flex items-center gap-2 font-medium",children:[e.jsx(Nn,{className:"w-4 h-4"}),"Zmie haso"]})}),e.jsx(ze.button,{whileHover:{x:2},whileTap:{scale:.98},className:"w-full sm:w-auto sm:min-w-[220px] inline-flex items-center justify-center rounded-xl bg-secondary text-white px-4 py-3 shadow-soft hover:opacity-95 focus-ring",children:e.jsxs("span",{className:"inline-flex items-center gap-2 font-medium",children:[e.jsx(ap,{className:"w-4 h-4"}),"Ustawienia powiadomie"]})}),e.jsx(ze.button,{whileHover:{x:2},whileTap:{scale:.98},className:"w-full sm:w-auto sm:min-w-[220px] inline-flex items-center justify-center rounded-xl bg-destructive text-white px-4 py-3 shadow-soft hover:bg-destructive/90 focus-ring",children:e.jsxs("span",{className:"inline-flex items-center gap-2 font-medium",children:[e.jsx(Ft,{className:"w-4 h-4"}),"Usu konto"]})})]})]})]})},OD=[e.jsx(K,{path:"/profile",element:e.jsx(LD,{})},"profile")],$D=[...lD,...dD,...pD,...kD,...CD,...DD,...ID,...RD,...OD],FD=()=>e.jsx(Wa,{children:e.jsxs(K,{element:e.jsx(vC,{children:e.jsx(ac,{})}),children:[e.jsx(K,{index:!0,element:e.jsx(rs,{to:"dashboard",replace:!0})}),$D]})}),qD=f.lazy(()=>Promise.resolve({default:FD})),Zj=({text:t,colorClass:s})=>e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-background",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`inline-block h-12 w-12 animate-spin rounded-full border-4 border-current border-r-transparent ${s}`}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:t})]})}),BD=({children:t})=>{const{data:s,isLoading:n}=Ze();return n||!s?e.jsx(Zj,{text:"Sprawdzanie uprawnie...",colorClass:"border-blue-600"}):s.role!=="student"?e.jsx(rs,{to:"/teacher/dashboard/overview",replace:!0}):e.jsx(e.Fragment,{children:t})},UD=e.jsx(K,{path:"/student/*",element:e.jsx(dc,{fallback:e.jsx(uc,{to:"/login"}),children:e.jsx(BD,{children:e.jsx(f.Suspense,{fallback:e.jsx(Zj,{text:"adowanie panelu ucznia...",colorClass:"border-blue-600"}),children:e.jsx(qD,{})})})},"student-auth")}),VD={name:"ai-tools",list:"/admin/ai-tools",meta:{label:"Narzdzia AI",icon:e.jsx(Ke,{className:"h-4 w-4"})}},KD=$o.includes(su)?$o:[{name:"dashboard",list:"/admin/dashboard/overview",meta:{label:"Dashboard",icon:e.jsx(Ew,{className:"h-4 w-4"})}},su,...$o,VD,{...au,list:"/admin/course-structure",meta:{...au.meta,parent:"ai-tools"}},{...ku,list:"/admin/educational-material",meta:{...ku.meta,parent:"ai-tools"}},{...zu,list:"/admin/quiz-wizard",meta:{...zu.meta,parent:"ai-tools"}}],WD={name:"dashboard",list:"/teacher/dashboard/overview",meta:{label:"Zasoby edukacyjne",icon:e.jsx(ye,{className:"h-4 w-4"})}},GD=[WD,{...Uu,meta:{...Uu.meta,parent:"dashboard",label:"Kursy"}},{...Vu,meta:{...Vu.meta,parent:"dashboard",label:"Tematy"}},{...Ku,meta:{...Ku.meta,parent:"dashboard",hide:!0}},{...Wu,meta:{...Wu.meta,parent:"dashboard",label:"Grupy"}},X2,lC,{...Zu,meta:{...Zu.meta,parent:"reports"}},{...Hu,meta:{...Hu.meta,parent:"reports"}},{...Qu,meta:{...Qu.meta,parent:"reports"}},{...Yu,meta:{...Yu.meta,parent:"reports"}},{...Ju,meta:{...Ju.meta,parent:"reports"}}],ZD={name:"student-root",meta:{label:"Panel ucznia",route:"/student/dashboard/overview"}},HD=[ZD],QD=()=>{const t=ae(),[s,n]=f.useState(0),[i,r]=f.useState("");f.useEffect(()=>{const o=()=>n(window.scrollY);return window.addEventListener("scroll",o),()=>window.removeEventListener("scroll",o)},[]);const a=[{name:"Sty",value:65},{name:"Lut",value:72},{name:"Mar",value:78},{name:"Kwi",value:85},{name:"Maj",value:88},{name:"Cze",value:94}];return e.jsxs("div",{className:"min-h-screen bg-white text-foreground",children:[e.jsx("nav",{className:"fixed top-0 w-full z-50 bg-white/80 backdrop-blur-xl border-b border-gray-100",children:e.jsx("div",{className:"container mx-auto px-6 py-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-pink-600 to-purple-700 rounded-xl flex items-center justify-center",children:e.jsx(qe,{className:"w-5 h-5 text-white"})}),e.jsx("span",{className:"text-xl font-bold",children:"Smart Up"})]}),e.jsxs("div",{className:"hidden md:flex items-center gap-8",children:[e.jsx("a",{href:"#funkcje",className:"text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors",children:"Funkcje"}),e.jsx("a",{href:"#kursy",className:"text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors",children:"Kursy"}),e.jsx("a",{href:"#firma",className:"text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors",children:"Dla firm"}),e.jsx("a",{href:"#cennik",className:"text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors",children:"Cennik"}),e.jsx(M,{className:"bg-gray-900 hover:bg-gray-800 text-white text-sm px-6",onClick:()=>t("/login"),children:"Rozpocznij"})]})]})})}),e.jsx("section",{className:"pt-32 pb-20 overflow-hidden",children:e.jsx("div",{className:"container mx-auto px-6",children:e.jsxs("div",{className:"grid lg:grid-cols-12 gap-8 items-center",children:[e.jsxs("div",{className:"lg:col-span-5",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-purple-50 rounded-full mb-8",children:[e.jsx(Ye,{className:"w-4 h-4 text-purple-700"}),e.jsx("span",{className:"text-sm font-medium text-purple-700",children:"Gamifikacja w edukacji"})]}),e.jsxs("h1",{className:"text-5xl md:text-6xl font-bold leading-tight mb-6",children:["Nauka, kt贸ra",e.jsx("span",{className:"block text-transparent bg-clip-text bg-gradient-to-r from-pink-600 to-purple-700",children:"motywuje"})]}),e.jsx("p",{className:"text-lg text-gray-600 mb-8 leading-relaxed",children:"Przekszta edukacj w anga偶ujc przygod. System poziom贸w, punkt贸w i nagr贸d sprawia, 偶e nauka staje si uzale偶niajca."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-12",children:[e.jsxs(M,{size:"lg",className:"bg-gray-900 hover:bg-gray-800 text-white px-8",onClick:()=>t("/login"),children:["Zacznij za darmo",e.jsx(He,{className:"ml-2 h-4 w-4"})]}),e.jsx(M,{size:"lg",variant:"outline",className:"border-gray-300",children:"Zobacz demo"})]}),e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:"15k+"}),e.jsx("div",{className:"text-sm text-gray-500",children:"aktywnych uczni贸w"})]}),e.jsx("div",{className:"w-px h-12 bg-gray-200"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:"92%"}),e.jsx("div",{className:"text-sm text-gray-500",children:"ukoczalno"})]}),e.jsx("div",{className:"w-px h-12 bg-gray-200"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:"4.9"}),e.jsx("div",{className:"text-sm text-gray-500",children:"ocena"})]})]})]}),e.jsx("div",{className:"lg:col-span-7",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -inset-4 bg-gradient-to-r from-pink-600/5 to-purple-700/5 rounded-3xl blur-2xl"}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-6 py-4 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-pink-600 to-purple-700 rounded-lg flex items-center justify-center",children:e.jsx(qe,{className:"w-4 h-4 text-white"})}),e.jsx("span",{className:"font-semibold",children:"Dashboard ucznia"})]}),e.jsx(V,{className:"bg-green-50 text-green-700 border-green-200",children:"Online"})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-pink-50 to-pink-100 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Wd,{className:"w-5 h-5 text-pink-600"}),e.jsx("span",{className:"text-xs text-gray-500",children:"+125"})]}),e.jsx("div",{className:"text-2xl font-bold",children:"1,842"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Punkty XP"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Be,{className:"w-5 h-5 text-purple-700"}),e.jsx("span",{className:"text-xs text-gray-500",children:"75%"})]}),e.jsx("div",{className:"text-2xl font-bold",children:"Lvl 12"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Poziom"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-teal-50 to-teal-100 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ls,{className:"w-5 h-5 text-teal-600"}),e.jsx("span",{className:"text-xs text-gray-500",children:"New!"})]}),e.jsx("div",{className:"text-2xl font-bold",children:"24"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Odznaki"})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("span",{className:"text-sm font-medium",children:"Postp nauki"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ostatnie 6 miesicy"})]}),e.jsx($e,{width:"100%",height:120,children:e.jsxs(to,{data:a,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorProgress",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#db2777",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#db2777",stopOpacity:0})]})}),e.jsx(Xs,{type:"monotone",dataKey:"value",stroke:"#db2777",strokeWidth:2,fill:"url(#colorProgress)"}),e.jsx(kt,{dataKey:"name",axisLine:!1,tickLine:!1,tick:{fontSize:11}}),e.jsx(gt,{hide:!0})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Aktywne kursy"}),e.jsx("a",{href:"#",className:"text-purple-700 hover:underline",children:"Zobacz wszystkie"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-pink-600 to-purple-700 rounded-lg flex items-center justify-center",children:e.jsx(yl,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:"JavaScript: Gra w kodowanie"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Rozdzia 4 z 12"})]})]}),e.jsx(be,{className:"w-4 h-4 text-gray-400"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-teal-500 to-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(ji,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:"Analiza danych: Quest"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Rozdzia 7 z 10"})]})]}),e.jsx(be,{className:"w-4 h-4 text-gray-400"})]})]})]})]})]})]})})]})})}),e.jsx("section",{id:"funkcje",className:"py-20 bg-gray-50",children:e.jsxs("div",{className:"container mx-auto px-6",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsxs("h2",{className:"text-4xl font-bold mb-4",children:["Funkcje, kt贸re"," ",e.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-pink-600 to-purple-700",children:"anga偶uj"})]}),e.jsx("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto",children:"System zaprojektowany, aby uczyni nauk uzale偶niajc jak najlepsza gra"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-pink-600/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-pink-600 to-purple-700 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(qe,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-3",children:"System poziom贸w"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"99 poziom贸w do zdobycia. Ka偶dy poziom odblokowuje nowe mo偶liwoci i nagrody."}),e.jsxs("div",{className:"flex items-center text-sm text-pink-600 font-medium",children:["Dowiedz si wicej",e.jsx(He,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]}),e.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-700/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-purple-700 to-teal-500 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(Wd,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-3",children:"Idle Points"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Zdobywaj punkty nawet gdy nie uczysz si aktywnie. System pasywnego rozwoju."}),e.jsxs("div",{className:"flex items-center text-sm text-purple-700 font-medium",children:["Dowiedz si wicej",e.jsx(He,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]}),e.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-teal-500/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-teal-500 to-blue-600 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(Be,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-3",children:"Wyzwania"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Codzienne i tygodniowe wyzwania z dodatkowymi nagrodami za ukoczenie."}),e.jsxs("div",{className:"flex items-center text-sm text-teal-600 font-medium",children:["Dowiedz si wicej",e.jsx(He,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]}),e.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-orange-500/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-orange-500 to-yellow-500 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(de,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-3",children:"Rankingi"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Rywalizuj z innymi uczniami. Rankingi globalne, lokalne i grupowe."}),e.jsxs("div",{className:"flex items-center text-sm text-orange-600 font-medium",children:["Dowiedz si wicej",e.jsx(He,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]}),e.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-700/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-purple-700 to-pink-600 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(Ls,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-3",children:"Odznaki"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Kolekcjonuj unikalne odznaki za osignicia i kamienie milowe."}),e.jsxs("div",{className:"flex items-center text-sm text-purple-700 font-medium",children:["Dowiedz si wicej",e.jsx(He,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]}),e.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-teal-500/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-teal-500 to-purple-700 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(ji,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-3",children:"Analityka"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Szczeg贸owe statystyki postp贸w i personalizowane rekomendacje."}),e.jsxs("div",{className:"flex items-center text-sm text-teal-600 font-medium",children:["Dowiedz si wicej",e.jsx(He,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]})]})]})}),e.jsx("section",{className:"py-20 bg-white",children:e.jsxs("div",{className:"container mx-auto px-6",children:[e.jsxs("div",{className:"max-w-3xl mx-auto text-center mb-16",children:[e.jsxs("h2",{className:"text-4xl font-bold mb-4",children:["Jak to"," ",e.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-pink-600 to-purple-700",children:"dziaa"})]}),e.jsx("p",{className:"text-lg text-gray-600",children:"Cztery proste kroki do rozpoczcia nauki z gamifikacj"})]}),e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-1/2 transform -translate-x-1/2 top-0 bottom-0 w-0.5 bg-gray-200"}),e.jsx("div",{className:"space-y-12",children:[{number:"01",title:"Stw贸rz profil",description:"Wybierz swoj rol i spersonalizuj dowiadczenie nauki",icon:de,color:"from-pink-600 to-purple-700"},{number:"02",title:"Wybierz kursy",description:"Przegldaj bibliotek kurs贸w i wybierz te, kt贸re Ci interesuj",icon:gi,color:"from-purple-700 to-teal-500"},{number:"03",title:"Ucz si i graj",description:"Rozwizuj quizy, zdobywaj punkty i awansuj na kolejne poziomy",icon:yl,color:"from-teal-500 to-blue-600"},{number:"04",title:"led藕 postpy",description:"Monitoruj swoje osignicia i rywalizuj z innymi",icon:xt,color:"from-orange-500 to-yellow-500"}].map((o,l)=>e.jsx("div",{className:"relative",children:e.jsxs("div",{className:`flex items-center ${l%2===0?"flex-row":"flex-row-reverse"}`,children:[e.jsxs("div",{className:`w-5/12 ${l%2===0?"text-right pr-8":"text-left pl-8"}`,children:[e.jsxs("div",{className:`inline-flex items-center gap-4 mb-2 ${l%2===0?"flex-row-reverse":""}`,children:[e.jsx("h3",{className:"text-2xl font-bold",children:o.title}),e.jsx("span",{className:"text-4xl font-bold text-gray-200",children:o.number})]}),e.jsx("p",{className:"text-gray-600 text-lg",children:o.description})]}),e.jsx("div",{className:"w-2/12 flex justify-center",children:e.jsx("div",{className:`relative z-10 w-16 h-16 bg-gradient-to-br ${o.color} rounded-2xl flex items-center justify-center shadow-lg`,children:e.jsx(o.icon,{className:"w-8 h-8 text-white"})})}),e.jsx("div",{className:"w-5/12"})]})},l))})]})})]})}),e.jsx("section",{className:"py-20 bg-gradient-to-br from-gray-900 to-gray-800",children:e.jsx("div",{className:"container mx-auto px-6",children:e.jsx("div",{className:"grid md:grid-cols-4 gap-8",children:[{value:"15k+",label:"Aktywnych uczni贸w",icon:de},{value:"200+",label:"Kurs贸w",icon:gi},{value:"92%",label:"Ukoczalno",icon:Be},{value:"4.9/5",label:"Ocena",icon:Sn}].map((o,l)=>e.jsxs("div",{className:"text-center",children:[e.jsx(o.icon,{className:"w-8 h-8 mx-auto mb-4 text-white/60"}),e.jsx("div",{className:"text-4xl font-bold text-white mb-2",children:o.value}),e.jsx("div",{className:"text-sm text-white/60",children:o.label})]},l))})})}),e.jsx("section",{className:"py-20 bg-white",children:e.jsx("div",{className:"container mx-auto px-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[e.jsxs("h2",{className:"text-4xl font-bold mb-6",children:["Gotowy na nauk, kt贸ra"," ",e.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-pink-600 to-purple-700",children:"wciga"}),"?"]}),e.jsx("p",{className:"text-lg text-gray-600 mb-8 max-w-2xl mx-auto",children:"Docz do tysicy uczni贸w, kt贸rzy odkryli rado z nauki dziki gamifikacji. Pierwsze 30 dni gratis."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center mb-8",children:[e.jsx(Q,{type:"email",placeholder:"twoj@email.pl",value:i,onChange:o=>r(o.target.value),className:"max-w-xs h-12"}),e.jsxs(M,{size:"lg",className:"bg-gradient-to-r from-pink-600 to-purple-700 hover:opacity-90 text-white px-8 h-12",onClick:()=>t("/login"),children:["Rozpocznij za darmo",e.jsx(He,{className:"ml-2 h-4 w-4"})]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Bez karty kredytowej  Anuluj w ka偶dej chwili  Peny dostp"})]})})}),e.jsx("footer",{className:"bg-gray-900 text-white py-12",children:e.jsx("div",{className:"container mx-auto px-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-white/10 rounded-lg flex items-center justify-center",children:e.jsx(qe,{className:"w-4 h-4"})}),e.jsx("span",{className:"text-lg font-bold",children:"Smart Up"})]}),e.jsx("div",{className:"text-sm text-white/60",children:"漏 2025 Smart Up. Wszystkie prawa zastrze偶one."})]})})})]})},YD=new tw({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:!1,staleTime:300*1e3}}});function JD({children:t}){const{pathname:s}=Ns(),n=s.split("/")[1],i=n==="admin"?KD:n==="teacher"?GD:n==="student"?HD:[];return e.jsx(nw,{dataProvider:aw(X),authProvider:ib,routerProvider:iw,resources:i,options:{syncWithLocation:!0,warnWhenUnsavedChanges:!1,useNewQueryKeys:!0,disableTelemetry:!0},children:t})}function XD(){return e.jsx(sw,{client:YD,children:e.jsx(Ky,{children:e.jsx(JD,{children:e.jsxs(Wa,{children:[e.jsx(K,{path:"/",element:e.jsx(QD,{})}),fp,cb,mb,fb,hz,gC,UD,e.jsx(K,{path:"*",element:e.jsx(rs,{to:"/",replace:!0})})]})})})})}const eP=document.getElementById("root"),tP=Hw.createRoot(eP);tP.render(e.jsxs(te.StrictMode,{children:[e.jsx(XD,{}),e.jsx(Xy,{position:"top-right",richColors:!0,closeButton:!0,duration:4e3,toastOptions:{style:{width:"500px",fontSize:"20px"},className:"sonner-toast"}})]}));export{he as A,M as B,I as C,mn as F,Q as I,ue as L,pe as a,F as b,$ as c,so as d,E as e,re as f,hn as g,gr as h,hp as i,up as l,mp as r,X as s,pp as u};
