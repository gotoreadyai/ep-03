const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/LoginPage-C5UvB-E2.js","assets/radix-ui-BdNglvg2.js","assets/react-vendor-nLIND2rL.js","assets/refine-core-BpFEoGih.js","assets/NarrowCol-DUq-L8Qp.js","assets/ui-utils--B0ioAp-.js","assets/utils-CHXD4NPa.js","assets/refine-ui-CWV2tBaG.js","assets/forms-Dah7oaIm.js","assets/tables-Bp2ooZv7.js","assets/RegisterFlow-DeQ1fFRy.js","assets/ForgotPasswordPage-D6Sbvzf2.js","assets/UpdatePasswordPage-7zRnr-Ch.js"])))=>i.map(i=>d[i]);
var Kj=Object.defineProperty;var Wj=(t,s,n)=>s in t?Kj(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n;var hs=(t,s,n)=>Wj(t,typeof s!="symbol"?s+"":s,n);import{j as e,R as rh,I as ah,F as oh,S as Zl,a as lh,P as Gj,C as ch,b as dh,V as Hj,c as Zj,d as uh,e as Qj,T as mh,f as Yj,g as hh,h as fh,i as Xj,k as ph,l as Jj,L as xh,m as gh,n as ey,o as ty,p as jh,q as sy,r as ny,s as yh,t as bh,u as wh,v as vh,w as iy,x as Nh,y as ry,z as vn,A as kh,B as Ql,D as Hs,E as fe,G as ay,H as oy,J as ly,K as zh,M as cy,N as dy,O as uy,Q as Sh,U as my,W as Ch,X as hy,Y as _h,Z as Th,_ as fy,$ as Ah,a0 as py,a1 as xy,a2 as Dh,a3 as Ph,a4 as Mh,a5 as Da,a6 as gy,a7 as jy,a8 as yy,a9 as by,aa as wy,ab as vy,ac as Ny,ad as ky,ae as zy,af as Sy,ag as Cy,ah as _y,ai as Rh,aj as Ty,ak as Ay,al as Dy,am as Md}from"./radix-ui-BdNglvg2.js";import{k as Py,a as g,l as V,n as ti,N as $t,o as Pa,O as Yl,e as me,d as hi,u as mt,R as ee,h as Oi,p as Ma,L as bs,B as My}from"./react-vendor-nLIND2rL.js";import{t as H,c as Ih,v as Ry,o as fi,u as si,a as Xl,n as wr,b as da,d as Iy,e as Eh,E as Ey,f as Jl,g as Ji,m as wt,h as Ly,i as Oy,j as Ls,s as So,r as $y,k as $i,l as $n,p as Fy,M as al,q as Lh,T as By}from"./utils-CHXD4NPa.js";import{n as Le,M as Ra,d as Oh,H as ec,$ as Z,e as pi,X as fn,f as pn,I as $h,E as tc,o as sc,i as Ye,k as Fh,j as Xe,l as Uy,Q as Vy,m as qy,p as Ky,D as Wy}from"./refine-core-BpFEoGih.js";import{c as Gy,_ as Ia,k as Zs,I as Hy}from"./refine-ui-CWV2tBaG.js";import{t as Zy,c as Qy,U as ua,M as Ea,G as ni,a as nc,S as La,b as Oa,C as Rt,d as ss,e as Ge,X as Pt,f as vr,L as $a,g as oe,h as ws,B as Se,i as ic,I as Bh,j as Nr,k as Yy,l as Ct,F as Uh,m as Xy,T as Ee,n as jt,Z as Ue,P as Re,o as vs,p as ns,q as Jy,r as eb,s as tb,u as Vh,v as sb,A as kr,w as st,x as De,y as ea,z as er,E as Fa,D as _t,H as ls,J as Ba,K as Us,N as is,O as Ve,Q as dt,R as ge,V as qh,W as dn,Y as nb,_ as vt,$ as Ua,a0 as ib,a1 as un,a2 as rb,a3 as ab,a4 as ob,a5 as ol,a6 as xn,a7 as Fe,a8 as Rd,a9 as lb,aa as ii,ab as Ns,ac as ll,ad as Kh,ae as gn,af as Wh,ag as Zt,ah as cb,ai as Id,aj as db,ak as ub,al as ri,am as ma,an as mb,ao as cl,ap as Gh,aq as hb,ar as fb,as as Ed,at as pb,au as xb,av as rc,aw as gb,ax as jb,ay as yb,az as bb,aA as wb,aB as Ld}from"./ui-utils--B0ioAp-.js";import{R as Ae,A as Va,C as bt,X as ct,Y as nt,T as Me,a as Vs,P as ha,b as fa,c as Qt,B as zr,d as ai,L as Hh,e as ac,F as vb,f as Nb,g as kb,h as Qn,S as Zh,Z as Qh,i as Yh,j as zb,k as Sb,l as Cb,m as _b,n as Tb,o as Ab,p as Db,q as Pb}from"./tables-Bp2ooZv7.js";import{a as Od,o as $d,b as Mb,c as Fd,n as Bd,s as Ud}from"./forms-Dah7oaIm.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}})();var Br={},Vd;function Rb(){if(Vd)return Br;Vd=1;var t=Py();return Br.createRoot=t.createRoot,Br.hydrateRoot=t.hydrateRoot,Br}var Ib=Rb();const Eb="https://hqsyimochfcfqahcuprn.supabase.co",Lb="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhxc3lpbW9jaGZjZnFhaGN1cHJuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM4NjU4NTYsImV4cCI6MjA2OTQ0MTg1Nn0.KutvVrkDKuVyvrYQosU3SI6QrrMnWqDCSZ2E3fhCteI",Q=Gy(Eb,Lb,{db:{schema:"public"},auth:{persistSession:!0}}),F=(...t)=>Zy(Qy(t)),Ob={invalid_credentials:"Nieprawidłowy email lub hasło.","Invalid login credentials":"Nieprawidłowy email lub hasło.",email_not_confirmed:"Email nie został potwierdzony.","Email not confirmed":"Email nie został potwierdzony.",user_not_found:"Nie znaleziono użytkownika.","User not found":"Nie znaleziono użytkownika.",network_error:"Błąd połączenia z serwerem.","Too many requests":"Zbyt wiele prób. Spróbuj ponownie za chwilę."},$b=t=>{if(!t)return{message:"Nieznany błąd",name:"UnknownError",statusCode:500};const s=t.message||t.error_description||"";for(const[n,i]of Object.entries(Ob))if(s.includes(n))return{message:i,name:"LoginError",statusCode:t.code==="invalid_credentials"?401:400};return{message:s||"Błąd logowania",name:"LoginError",statusCode:400}},Xh={login:async(t,s)=>{try{if(!t||!s)return{success:!1,error:"Email i hasło są wymagane"};const{data:n,error:i}=await Q.auth.signInWithPassword({email:t.trim().toLowerCase(),password:s});if(i)return{success:!1,error:$b(i).message};if(!n.session)return{success:!1,error:"Nie udało się utworzyć sesji"};const{data:r}=await Q.from("users").select("role").eq("id",n.user.id).single();return{success:!0,redirectTo:r?.role==="admin"?"/admin/dashboard/overview":r?.role==="teacher"?"/teacher/dashboard/overview":r?.role==="student"?"/student/dashboard":"/profiles"}}catch(n){return{success:!1,error:n.message||"Nieznany błąd"}}},loginForRefine:async(t,s)=>{const n=await Xh.login(t,s);return n.success?n:{success:!1,error:{message:n.error,name:"LoginError",statusCode:400}}},checkAuth:async()=>{const{data:{session:t}}=await Q.auth.getSession();return!!t}},Fb={user_already_exists:"Konto z tym adresem email już istnieje","User already registered":"Konto z tym adresem email już istnieje","already exists":"Konto z tym adresem email już istnieje",weak_password:"Hasło musi mieć co najmniej 6 znaków","Password should be at least":"Hasło musi mieć co najmniej 6 znaków","Password cannot be longer than 72":"Hasło nie może być dłuższe niż 72 znaki",invalid_email:"Nieprawidłowy format adresu email","Invalid email":"Nieprawidłowy format adresu email",over_email_send_rate_limit:"Za szybko! Poczekaj 2 sekundy przed ponowną próbą"},qd=t=>{if(!t)return{message:"Nieznany błąd",name:"UnknownError",statusCode:500};const s=t.message||"";for(const[n,i]of Object.entries(Fb))if(s.includes(n)){let r=400;return n.includes("already")&&(r=409),n.includes("email_send_rate")&&(r=429),{message:i,name:"RegisterError",statusCode:r}}return{message:s||"Rejestracja nie powiodła się",name:"RegisterError",statusCode:400}},Jh={register:async(t,s,n)=>{try{const{data:i,error:r}=await Q.auth.signUp({email:t.trim().toLowerCase(),password:s,options:{data:{full_name:n.trim(),role:"student"},emailRedirectTo:`${window.location.origin}/login?verified=true`}});return r?{success:!1,error:qd(r).message}:i.user?{success:!0,needsEmailConfirmation:!i.session}:{success:!1,error:"Rejestracja nie powiodła się"}}catch(i){return{success:!1,error:i.message||"Błąd rejestracji"}}},registerForRefine:async(t,s,n)=>{const i=await Jh.register(t,s,n);return i.success?{success:!0,successNotification:i.needsEmailConfirmation?{message:"Rejestracja udana!",description:"Sprawdź email aby potwierdzić konto."}:{message:"Rejestracja udana!",description:"Możesz się teraz zalogować."}}:{success:!1,error:qd({message:i.error})}}},Bb={"User not found":"Nie znaleziono użytkownika z tym adresem email","Invalid email":"Nieprawidłowy format adresu email",over_email_send_rate_limit:"Za szybko! Poczekaj chwilę przed kolejną próbą",reset_password_rate_limit:"Zbyt wiele prób. Spróbuj ponownie za kilka minut"},Kd=t=>{if(!t)return{message:"Nieznany błąd",name:"UnknownError",statusCode:500};const s=t.message||"";for(const[n,i]of Object.entries(Bb))if(s.includes(n))return{message:i,name:"ForgotPasswordError",statusCode:n.includes("rate_limit")?429:400};return{message:s||"Błąd podczas wysyłania emaila",name:"ForgotPasswordError",statusCode:400}},ef={sendResetEmail:async t=>{try{const{error:s}=await Q.auth.resetPasswordForEmail(t.trim().toLowerCase(),{redirectTo:`${window.location.origin}/update-password`});return s?{success:!1,error:Kd(s).message}:{success:!0}}catch(s){return{success:!1,error:s.message||"Błąd podczas wysyłania emaila"}}},sendResetEmailForRefine:async t=>{const s=await ef.sendResetEmail(t);return s.success?{success:!0,successNotification:{message:"Email wysłany!",description:"Sprawdź swoją skrzynkę odbiorczą"}}:{success:!1,error:Kd({message:s.error})}}},Ub={"New password should be different":"Nowe hasło musi być inne niż obecne","Password should be at least":"Hasło musi mieć co najmniej 6 znaków","Invalid token":"Link wygasł lub jest nieprawidłowy",session_not_found:"Sesja wygasła. Spróbuj ponownie"},Wd=t=>{if(!t)return{message:"Nieznany błąd",name:"UnknownError",statusCode:500};const s=t.message||"";for(const[n,i]of Object.entries(Ub))if(s.includes(n))return{message:i,name:"UpdatePasswordError",statusCode:n.includes("token")||n.includes("session")?401:400};return{message:s||"Błąd aktualizacji hasła",name:"UpdatePasswordError",statusCode:400}},tf={checkSession:async()=>{try{const{data:t}=await Q.auth.getSession(),n=new URLSearchParams(window.location.hash.substring(1)).get("type");return!t.session&&n!=="recovery"?{isValid:!1,error:"Link wygasł lub jest nieprawidłowy"}:{isValid:!0}}catch{return{isValid:!1,error:"Błąd weryfikacji sesji"}}},updatePassword:async t=>{try{const{error:s}=await Q.auth.updateUser({password:t});return s?{success:!1,error:Wd(s).message}:{success:!0}}catch(s){return{success:!1,error:s.message||"Błąd aktualizacji hasła"}}},updatePasswordForRefine:async t=>{const s=await tf.updatePassword(t);return s.success?{success:!0,redirectTo:"/login?passwordChanged=true"}:{success:!1,error:Wd({message:s.error})}}};class Vb{constructor(){hs(this,"cache",null);hs(this,"lastFetch",0);hs(this,"CACHE_DURATION",300*1e3);hs(this,"fetchPromise",null)}async get(s=!1){const n=Date.now();if(!s&&this.cache&&n-this.lastFetch<this.CACHE_DURATION)return this.cache;if(this.fetchPromise)return this.fetchPromise;this.fetchPromise=this.fetchUser();const i=await this.fetchPromise;return this.fetchPromise=null,i}async fetchUser(){try{const{data:{session:s}}=await Q.auth.getSession();if(!s?.user)return this.clear(),null;const{data:n,error:i}=await Q.from("users").select("*").eq("id",s.user.id).single();if(i||!n){console.error("Error fetching user data:",i);const a={id:s.user.id,email:s.user.email||"",full_name:s.user.user_metadata?.full_name||s.user.email?.split("@")[0]||"User",vendor_id:1,role:"student"};return this.set(a),a}const r={id:n.id,email:n.email,full_name:n.full_name,vendor_id:n.vendor_id,role:n.role,is_active:n.is_active,created_at:n.created_at};return this.set(r),r}catch(s){return console.error("Error in fetchUser:",s),this.clear(),null}}set(s){this.cache=s,this.lastFetch=Date.now()}clear(){this.cache=null,this.lastFetch=0,this.fetchPromise=null}async refresh(){return this.get(!0)}}const Os=new Vb;Q.auth.onAuthStateChange((t,s)=>{t==="SIGNED_OUT"||!s?Os.clear():(t==="SIGNED_IN"||t==="TOKEN_REFRESHED")&&Os.get(!0)});const Co={logout:async()=>{try{Os.clear();const{error:t}=await Q.auth.signOut();return t?{success:!1,error:{message:"Błąd podczas wylogowania",name:"LogoutError",statusCode:500}}:{success:!0,redirectTo:"/login"}}catch{return{success:!1,error:{message:"Nieoczekiwany błąd podczas wylogowania",name:"LogoutError",statusCode:500}}}},check:async()=>{try{const{data:{session:t}}=await Q.auth.getSession();if(!t)return{authenticated:!1,redirectTo:"/login"};const s=t.expires_at;return s&&s*1e3<Date.now()?{authenticated:!1,redirectTo:"/login"}:{authenticated:!0}}catch{return{authenticated:!1,redirectTo:"/login"}}},handleError:async t=>(console.error("Auth error:",t),t?.statusCode===401?(Os.clear(),{redirectTo:"/login",logout:!0,error:t}):{error:t})},qb={login:async({email:t,password:s})=>{const n=await Xh.login(t,s);return n.success&&await Os.refresh(),n},logout:async()=>await Co.logout(),check:async()=>await Co.check(),getIdentity:async()=>await Os.get(),getPermissions:async()=>(await Os.get())?.role||null,register:async({email:t,password:s,name:n})=>await Jh.registerForRefine(t,s,n),forgotPassword:async({email:t})=>await ef.sendResetEmailForRefine(t),updatePassword:async({password:t})=>{const s=await tf.updatePasswordForRefine(t);return s.success&&await Os.clear(),s},onError:async t=>await Co.handleError(t)},oc=({isLoading:t,isError:s,loadingText:n="Loading...",errorMsg:i="Error loading data"})=>t?e.jsx("div",{className:"p-6 text-gray-600 animate-reverse-pulse",children:n}):s?e.jsx("div",{className:"p-6 text-red-500",children:i}):null;console.log("1. Login index.tsx - ładowanie modułu");const Kb=g.lazy(()=>(console.log("2. Login - rozpoczęcie lazy load"),Ia(()=>import("./LoginPage-C5UvB-E2.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])).then(t=>(console.log("3. Login - moduł załadowany",t),t)))),Wb=()=>(console.log("4. Login - renderowanie fallback"),e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Ładowanie logowania..."})]})})),sf=e.jsx(V,{path:"/login",element:e.jsx(g.Suspense,{fallback:e.jsx(Wb,{}),children:e.jsx(Kb,{})})});console.log("5. Login module exported",sf);const Gb=g.lazy(()=>Ia(()=>import("./RegisterFlow-DeQ1fFRy.js"),__vite__mapDeps([10,1,2,3,5,4,6,7,8,9]))),Hb=()=>e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Przygotowywanie rejestracji..."})]})}),Zb=e.jsx(V,{path:"/register/*",element:e.jsx(g.Suspense,{fallback:e.jsx(Hb,{}),children:e.jsx(Gb,{})})}),Qb=g.lazy(()=>Ia(()=>import("./ForgotPasswordPage-D6Sbvzf2.js"),__vite__mapDeps([11,1,2,3,4,5,6,7,8,9]))),Yb=()=>e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-yellow-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Ładowanie formularza resetowania..."})]})}),Xb=e.jsx(V,{path:"/forgot-password",element:e.jsx(g.Suspense,{fallback:e.jsx(Yb,{}),children:e.jsx(Qb,{})})}),Jb=g.lazy(()=>Ia(()=>import("./UpdatePasswordPage-7zRnr-Ch.js"),__vite__mapDeps([12,1,2,3,4,5,6,7,8,9]))),ew=()=>e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Weryfikacja linku resetowania..."})]})}),tw=e.jsx(V,{path:"/update-password",element:e.jsx(g.Suspense,{fallback:e.jsx(ew,{}),children:e.jsx(Jb,{})})}),tr=g.forwardRef(({className:t,...s},n)=>e.jsx(rh,{ref:n,className:F("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...s}));tr.displayName=rh.displayName;const sw=g.forwardRef(({className:t,...s},n)=>e.jsx(ah,{ref:n,className:F("aspect-square h-full w-full object-cover",t),...s}));sw.displayName=ah.displayName;const sr=g.forwardRef(({className:t,...s},n)=>e.jsx(oh,{ref:n,className:F("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...s}));sr.displayName=oh.displayName;function nn({className:t,...s}){return e.jsx("div",{className:F("animate-pulse rounded-md bg-primary/10",t),...s})}const nf=({className:t="",showRole:s=!0,showEmail:n=!0,compact:i=!1})=>{const{data:r,isLoading:a,error:o}=Le(),l=h=>{switch(h){case"admin":return e.jsx(La,{className:"h-3 w-3"});case"teacher":return e.jsx(nc,{className:"h-3 w-3"});case"student":return e.jsx(ni,{className:"h-3 w-3"});default:return e.jsx(ua,{className:"h-3 w-3"})}},c=h=>{switch(h){case"admin":return"Administrator";case"teacher":return"Nauczyciel";case"student":return"Uczeń";default:return"Użytkownik"}},d=h=>{switch(h){case"admin":return"text-purple-600 bg-purple-50";case"teacher":return"text-blue-600 bg-blue-50";case"student":return"text-green-600 bg-green-50";default:return"text-gray-600 bg-gray-50"}};if(a)return e.jsxs("div",{className:`flex items-center space-x-3 p-3 ${t}`,children:[e.jsx(nn,{className:"h-10 w-10 rounded-full"}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(nn,{className:"h-4 w-28"}),e.jsx(nn,{className:"h-3 w-20"}),s&&e.jsx(nn,{className:"h-3 w-16"})]})]});if(o||!r)return e.jsxs("div",{className:`flex items-center space-x-3 p-3 text-muted-foreground ${t}`,children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(ua,{className:"h-5 w-5 text-gray-400"})}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium text-gray-500",children:"Nie zalogowano"}),e.jsx("div",{className:"text-xs opacity-70",children:"Brak danych użytkownika"})]})]});const u=(h=>{if(!h)return"U";const p=h.trim().split(" ");return p.length>=2?`${p[0][0]}${p[p.length-1][0]}`.toUpperCase():h.slice(0,2).toUpperCase()})(r.full_name||r.email);return i?e.jsxs("div",{className:`flex items-center space-x-2 p-2 ${t}`,children:[e.jsx(tr,{className:"h-8 w-8",children:e.jsx(sr,{className:"bg-gradient-to-br from-purple-500 to-pink-500 text-white text-xs",children:u})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"font-medium text-sm truncate",children:r.full_name})})]}):e.jsxs("div",{className:`flex items-center space-x-3 px-4 pt-4 rounded-lg bg-white/50 backdrop-blur-sm border border-purple-100/20 ${t}`,children:[e.jsx(tr,{className:"h-12 w-12 ring-2 ring-purple-100 ring-offset-2",children:e.jsx(sr,{className:"bg-gradient-to-br from-purple-500 to-pink-500 text-white font-medium",children:u})}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-1",children:[e.jsx("div",{className:"font-semibold text-gray-900 truncate",title:r.full_name,children:r.full_name}),n&&r.email&&e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-500",children:[e.jsx(Ea,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate",title:r.email,children:r.email})]}),s&&r.role&&e.jsx("div",{className:"inline-flex items-center gap-1.5",children:e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full text-xs font-medium ${d(r.role)}`,children:[l(r.role),c(r.role)]})})]})]})},nw=Oa("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-3.5 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),$s=g.forwardRef(({className:t,variant:s,...n},i)=>e.jsx("div",{ref:i,role:"alert",className:F(nw({variant:s}),t),...n}));$s.displayName="Alert";const iw=g.forwardRef(({className:t,...s},n)=>e.jsx("h5",{ref:n,className:F("mb-1 font-medium leading-none tracking-tight",t),...s}));iw.displayName="AlertTitle";const Fs=g.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:F("text-sm [&_p]:leading-relaxed",t),...s}));Fs.displayName="AlertDescription";const rw=Oa("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function q({className:t,variant:s,asChild:n=!1,...i}){const r=n?Zl:"span";return e.jsx(r,{"data-slot":"badge",className:F(rw({variant:s}),t),...i})}const aw=g.forwardRef(({...t},s)=>e.jsx("nav",{ref:s,"aria-label":"breadcrumb",...t}));aw.displayName="Breadcrumb";const ow=g.forwardRef(({className:t,...s},n)=>e.jsx("ol",{ref:n,className:F("flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",t),...s}));ow.displayName="BreadcrumbList";const lw=g.forwardRef(({className:t,...s},n)=>e.jsx("li",{ref:n,className:F("inline-flex items-center gap-1.5",t),...s}));lw.displayName="BreadcrumbItem";const cw=g.forwardRef(({asChild:t,className:s,...n},i)=>{const r=t?Zl:"a";return e.jsx(r,{ref:i,className:F("transition-colors hover:text-foreground",s),...n})});cw.displayName="BreadcrumbLink";const dw=g.forwardRef(({className:t,...s},n)=>e.jsx("span",{ref:n,role:"link","aria-disabled":"true","aria-current":"page",className:F("font-normal text-foreground",t),...s}));dw.displayName="BreadcrumbPage";const uw=Oa("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),I=g.forwardRef(({className:t,variant:s,size:n,asChild:i=!1,...r},a)=>{const o=i?Zl:"button";return e.jsx(o,{className:F(uw({variant:s,size:n,className:t})),ref:a,...r})});I.displayName="Button";const M=g.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:F("rounded-xl border bg-card text-card-foreground shadow flex flex-col overflow-hidden",t),...s}));M.displayName="Card";const $=g.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:F("flex flex-col space-y-1.5 p-6 pb-3 bg-pink-200/25",t),...s}));$.displayName="CardHeader";const O=g.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:F("text-lg font-semibold leading-tight tracking-tight pt-3",t),...s}));O.displayName="CardTitle";const lc=g.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:F("text-sm text-muted-foreground",t),...s}));lc.displayName="CardDescription";const R=g.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:F("p-3 lg:p-6 pt-3 space-y-3 flex-1 bg-background",t),...s}));R.displayName="CardContent";const mw=g.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:F("flex items-center justify-between p-6 pt-0",t),...s}));mw.displayName="CardFooter";const hw=Oa("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),nr=g.forwardRef(({className:t,...s},n)=>e.jsx(lh,{ref:n,className:F(hw(),t),...s}));nr.displayName=lh.displayName;g.createContext({});g.createContext({});const J=g.forwardRef(({className:t,type:s,...n},i)=>e.jsx("input",{type:s,className:F("flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:i,...n}));J.displayName="Input";const fw=g.forwardRef(({className:t,align:s="center",sideOffset:n=4,...i},r)=>e.jsx(Gj,{children:e.jsx(ch,{ref:r,align:s,sideOffset:n,className:F("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",t),...i})}));fw.displayName=ch.displayName;const qs=g.forwardRef(({className:t,children:s,...n},i)=>e.jsxs(dh,{ref:i,className:F("relative overflow-hidden",t),...n,children:[e.jsx(Hj,{className:"h-full w-full rounded-[inherit]",children:s}),e.jsx(rf,{}),e.jsx(Zj,{})]}));qs.displayName=dh.displayName;const rf=g.forwardRef(({className:t,orientation:s="vertical",...n},i)=>e.jsx(uh,{ref:i,orientation:s,className:F("flex touch-none select-none transition-colors",s==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",s==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...n,children:e.jsx(Qj,{className:"relative flex-1 rounded-full bg-border"})}));rf.displayName=uh.displayName;const Ce=sy,_e=ny,we=g.forwardRef(({className:t,children:s,...n},i)=>e.jsxs(mh,{ref:i,className:F("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-background px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...n,children:[s,e.jsx(Yj,{asChild:!0,children:e.jsx(Rt,{className:"h-4 w-4 opacity-50"})})]}));we.displayName=mh.displayName;const af=g.forwardRef(({className:t,...s},n)=>e.jsx(hh,{ref:n,className:F("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(ss,{className:"h-4 w-4"})}));af.displayName=hh.displayName;const of=g.forwardRef(({className:t,...s},n)=>e.jsx(fh,{ref:n,className:F("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(Rt,{className:"h-4 w-4"})}));of.displayName=fh.displayName;const ve=g.forwardRef(({className:t,children:s,position:n="popper",...i},r)=>e.jsx(Xj,{children:e.jsxs(ph,{ref:r,className:F("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...i,children:[e.jsx(af,{}),e.jsx(Jj,{className:F("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),e.jsx(of,{})]})}));ve.displayName=ph.displayName;const pw=g.forwardRef(({className:t,...s},n)=>e.jsx(xh,{ref:n,className:F("px-2 py-1.5 text-sm font-semibold",t),...s}));pw.displayName=xh.displayName;const W=g.forwardRef(({className:t,children:s,...n},i)=>e.jsxs(gh,{ref:i,className:F("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[e.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ey,{children:e.jsx(Ge,{className:"h-4 w-4"})})}),e.jsx(ty,{children:s})]}));W.displayName=gh.displayName;const xw=g.forwardRef(({className:t,...s},n)=>e.jsx(jh,{ref:n,className:F("-mx-1 my-1 h-px bg-muted",t),...s}));xw.displayName=jh.displayName;const qa=g.forwardRef(({className:t,orientation:s="horizontal",decorative:n=!0,...i},r)=>e.jsx(yh,{ref:r,decorative:n,orientation:s,className:F("shrink-0 bg-border",s==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...i}));qa.displayName=yh.displayName;function Nn({className:t,...s}){return e.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:e.jsx("table",{"data-slot":"table",className:F("w-full caption-bottom text-sm",t),...s})})}function kn({className:t,...s}){return e.jsx("thead",{"data-slot":"table-header",className:F("[&_tr]:border-b",t),...s})}function zn({className:t,...s}){return e.jsx("tbody",{"data-slot":"table-body",className:F("[&_tr:last-child]:border-0",t),...s})}function ut({className:t,...s}){return e.jsx("tr",{"data-slot":"table-row",className:F("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...s})}function ie({className:t,...s}){return e.jsx("th",{"data-slot":"table-head",className:F("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...s})}function re({className:t,...s}){return e.jsx("td",{"data-slot":"table-cell",className:F("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...s})}const ks=g.forwardRef(({className:t,...s},n)=>e.jsx("textarea",{className:F("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:n,...s}));ks.displayName="Textarea";const lf=iy,cc=g.forwardRef(({className:t,...s},n)=>e.jsx(bh,{ref:n,className:F("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",t),...s}));cc.displayName=bh.displayName;const Wt=g.forwardRef(({className:t,...s},n)=>e.jsx(wh,{ref:n,className:F("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",t),...s}));Wt.displayName=wh.displayName;const Gt=g.forwardRef(({className:t,...s},n)=>e.jsx(vh,{ref:n,className:F("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...s}));Gt.displayName=vh.displayName;const rs=g.forwardRef(({className:t,...s},n)=>e.jsx(Nh,{ref:n,className:F("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...s,children:e.jsx(ry,{className:F("flex items-center justify-center text-current"),children:e.jsx(Ge,{className:"h-4 w-4"})})}));rs.displayName=Nh.displayName;var Ka="Switch",[gw,SD]=Ql(Ka),[jw,yw]=gw(Ka),cf=g.forwardRef((t,s)=>{const{__scopeSwitch:n,name:i,checked:r,defaultChecked:a,required:o,disabled:l,value:c="on",onCheckedChange:d,form:m,...u}=t,[h,p]=g.useState(null),j=vn(s,v=>p(v)),x=g.useRef(!1),b=h?m||!!h.closest("form"):!0,[w,y]=kh({prop:r,defaultProp:a??!1,onChange:d,caller:Ka});return e.jsxs(jw,{scope:n,checked:w,disabled:l,children:[e.jsx(Hs.button,{type:"button",role:"switch","aria-checked":w,"aria-required":o,"data-state":hf(w),"data-disabled":l?"":void 0,disabled:l,value:c,...u,ref:j,onClick:fe(t.onClick,v=>{y(_=>!_),b&&(x.current=v.isPropagationStopped(),x.current||v.stopPropagation())})}),b&&e.jsx(mf,{control:h,bubbles:!x.current,name:i,value:c,checked:w,required:o,disabled:l,form:m,style:{transform:"translateX(-100%)"}})]})});cf.displayName=Ka;var df="SwitchThumb",uf=g.forwardRef((t,s)=>{const{__scopeSwitch:n,...i}=t,r=yw(df,n);return e.jsx(Hs.span,{"data-state":hf(r.checked),"data-disabled":r.disabled?"":void 0,...i,ref:s})});uf.displayName=df;var bw="SwitchBubbleInput",mf=g.forwardRef(({__scopeSwitch:t,control:s,checked:n,bubbles:i=!0,...r},a)=>{const o=g.useRef(null),l=vn(o,a),c=ay(n),d=oy(s);return g.useEffect(()=>{const m=o.current;if(!m)return;const u=window.HTMLInputElement.prototype,p=Object.getOwnPropertyDescriptor(u,"checked").set;if(c!==n&&p){const j=new Event("click",{bubbles:i});p.call(m,n),m.dispatchEvent(j)}},[c,n,i]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n,...r,tabIndex:-1,ref:l,style:{...r.style,...d,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});mf.displayName=bw;function hf(t){return t?"checked":"unchecked"}var ff=cf,ww=uf;const Bt=g.forwardRef(({className:t,...s},n)=>e.jsx(ff,{className:F("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...s,ref:n,children:e.jsx(ww,{className:F("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));Bt.displayName=ff.displayName;const ps=cy,xs=dy,gs=uy,Ht=g.forwardRef(({className:t,sideOffset:s=4,...n},i)=>e.jsx(ly,{children:e.jsx(zh,{ref:i,sideOffset:s,className:F("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",t),...n})}));Ht.displayName=zh.displayName;const dc=fy,vw=my,pf=g.forwardRef(({className:t,...s},n)=>e.jsx(Sh,{ref:n,className:F("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s}));pf.displayName=Sh.displayName;const Wa=g.forwardRef(({className:t,children:s,...n},i)=>e.jsxs(vw,{children:[e.jsx(pf,{}),e.jsxs(Ch,{ref:i,className:F("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...n,children:[s,e.jsxs(hy,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(Pt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Wa.displayName=Ch.displayName;const Ga=({className:t,...s})=>e.jsx("div",{className:F("flex flex-col space-y-1.5 text-center sm:text-left",t),...s});Ga.displayName="DialogHeader";const Ha=({className:t,...s})=>e.jsx("div",{className:F("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s});Ha.displayName="DialogFooter";const Za=g.forwardRef(({className:t,...s},n)=>e.jsx(_h,{ref:n,className:F("text-lg font-semibold leading-none tracking-tight",t),...s}));Za.displayName=_h.displayName;const Nw=g.forwardRef(({className:t,...s},n)=>e.jsx(Th,{ref:n,className:F("text-sm text-muted-foreground",t),...s}));Nw.displayName=Th.displayName;const Yt=g.forwardRef(({className:t,value:s,...n},i)=>e.jsx(Ah,{ref:i,className:F("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",t),...n,children:e.jsx(py,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}));Yt.displayName=Ah.displayName;const kw=({onClose:t})=>{const{mutate:s}=Ra(),{menuItems:n}=Oh(),{data:i}=Le(),r=()=>{t&&t()};return e.jsxs("div",{className:"flex h-full w-64 flex-col border-r bg-background",children:[e.jsxs("div",{className:"flex h-16 items-center justify-between border-b px-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(vr,{className:"h-6 w-6 mr-2"}),e.jsx("span",{className:"font-semibold",children:"Smart Up"})]}),t&&e.jsx(I,{variant:"ghost",size:"sm",onClick:t,className:"lg:hidden",children:e.jsx(Pt,{className:"h-4 w-4"})})]}),e.jsx(qs,{className:"flex-1 px-3 py-4",children:e.jsx("nav",{className:"space-y-4",children:n.map(a=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ti,{to:a.route??"/",onClick:r,className:({isActive:o})=>F("flex items-center justify-between rounded-md px-3 py-2 text-sm font-semibold transition-colors hover:bg-accent hover:text-accent-foreground",o?"bg-accent text-accent-foreground":"text-foreground"),children:[e.jsxs("span",{className:"flex items-center",children:[a.icon&&e.jsx("span",{className:"mr-3",children:a.icon}),a.label]}),a.children&&a.children.length>0&&e.jsx(Rt,{className:"h-4 w-4 opacity-60"})]}),a.children&&a.children.length>0&&e.jsx("div",{className:"ml-3 border-l pl-3 space-y-1",children:a.children.map(o=>e.jsxs(ti,{to:o.route??"/",onClick:r,className:({isActive:l})=>F("flex items-center rounded-md px-3 py-2 text-sm transition-colors hover:bg-accent hover:text-accent-foreground",l?"bg-accent text-accent-foreground":"text-muted-foreground"),children:[o.icon&&e.jsx("span",{className:"mr-3",children:o.icon}),o.label]},o.key))})]},a.key))})}),e.jsx(qa,{}),e.jsx(nf,{className:"border-b"}),e.jsx("div",{className:"p-4",children:e.jsxs(I,{variant:"outline",size:"sm",onClick:()=>{s(),t&&t()},className:"w-full justify-start",children:[e.jsx($a,{className:"mr-2 h-4 w-4"}),"Logout"]})})]})},zw=({children:t})=>{const[s,n]=g.useState(!1),i=()=>{n(!s)};return e.jsx("div",{className:"min-h-screen bg-stone-200 relative overflow-x-hidden",children:e.jsxs("div",{className:"flex relative",children:[s&&e.jsx("div",{className:"fixed inset-0 z-40 bg-purple-900/20 backdrop-blur-sm lg:hidden",onClick:()=>n(!1)}),e.jsx("aside",{className:`
            h-screen w-64 transform transition-transform duration-300 ease-in-out
            fixed left-0 top-0 z-50
            ${s?"translate-x-0":"-translate-x-full"}
            lg:translate-x-0
            bg-background/95 backdrop-blur-md border-r border-purple-200/20
          `,children:e.jsx(kw,{onClose:()=>n(!1)})}),e.jsxs("main",{className:"flex-1 lg:ml-64 min-w-0 relative z-10",children:[e.jsxs("div",{className:"sticky top-0 z-30 flex h-16 items-center border-b border-purple-200/20 bg-background/80 backdrop-blur-md px-4 lg:hidden",children:[e.jsx(I,{variant:"ghost",size:"sm",onClick:i,className:"mr-2 hover:bg-purple-100/20 hover:text-purple-700",children:e.jsx(vr,{className:"h-6 w-6"})}),e.jsx("span",{className:"font-semibold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:"Smart Up"})]}),t]})]})})},Sw=()=>e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Admin Dashboard"}),e.jsx("p",{children:"Welcome to admin panel"})]}),Cw=[e.jsx(V,{path:"dashboard/overview",element:e.jsx(Sw,{})},"dashboard-overview")],G=({children:t})=>e.jsx("div",{className:"p-2 md:p-12 space-y-6 max-w-7xl mx-auto",children:t}),_w=({course:t,open:s,onOpenChange:n,onAccessUpdate:i})=>{const{open:r}=ec(),[a,o]=g.useState(""),[l,c]=g.useState(""),[d,m]=g.useState(!1),{data:u}=Z({resource:"groups",filters:[{field:"is_active",operator:"eq",value:!0}],pagination:{pageSize:1e3},sorters:[{field:"name",order:"asc"}],queryOptions:{enabled:s}}),{data:h}=Z({resource:"users",filters:[{field:"role",operator:"eq",value:"teacher"},{field:"is_active",operator:"eq",value:!0}],pagination:{pageSize:1e3},sorters:[{field:"full_name",order:"asc"}],queryOptions:{enabled:s}}),{data:p,refetch:j}=Z({resource:"course_access",filters:t?[{field:"course_id",operator:"eq",value:t.id}]:[],pagination:{pageSize:1e4},queryOptions:{enabled:s&&!!t}}),x=g.useMemo(()=>u?.data??[],[u]),b=g.useMemo(()=>h?.data??[],[h]),w=g.useMemo(()=>p?.data??[],[p]),y=g.useMemo(()=>{if(!t)return{groupAccess:{},teacherAccess:{}};const T={},f={};return w.forEach(S=>{S.group_id&&(T[S.group_id]=!0),S.teacher_id&&(f[S.teacher_id]=!0)}),{groupAccess:T,teacherAccess:f}},[t,w]),v=g.useMemo(()=>x.filter(T=>!a||T.name.toLowerCase().includes(a.toLowerCase())||T.academic_year.includes(a)),[x,a]),_=g.useMemo(()=>b.filter(T=>!l||T.full_name.toLowerCase().includes(l.toLowerCase())||T.email.toLowerCase().includes(l.toLowerCase())),[b,l]);g.useEffect(()=>{s||(o(""),c(""))},[s]);const C=async(T,f)=>{if(t){m(!0);try{if(f){const{error:S}=await Q.from("course_access").delete().eq("course_id",t.id).eq("group_id",T);if(S)throw S}else{const{error:S}=await Q.from("course_access").insert({course_id:t.id,group_id:T,teacher_id:null});if(S)throw S}r?.({type:"success",message:f?"Dostęp usunięty":"Dostęp przyznany"}),j(),i()}catch{r?.({type:"error",message:"Wystąpił błąd podczas zapisywania"})}finally{m(!1)}}},k=async(T,f)=>{if(t){m(!0);try{if(f){const{error:S}=await Q.from("course_access").delete().eq("course_id",t.id).eq("teacher_id",T);if(S)throw S}else{const{error:S}=await Q.from("course_access").insert({course_id:t.id,group_id:null,teacher_id:T});if(S)throw S}r?.({type:"success",message:f?"Dostęp usunięty":"Dostęp przyznany"}),j(),i()}catch{r?.({type:"error",message:"Wystąpił błąd podczas zapisywania"})}finally{m(!1)}}},N=Object.values(y.groupAccess).filter(Boolean).length,z=Object.values(y.teacherAccess).filter(Boolean).length;return e.jsx(dc,{open:s,onOpenChange:n,children:e.jsxs(Wa,{className:"max-w-4xl max-h-[80vh]",children:[e.jsx(Ga,{children:e.jsxs(Za,{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:t?.icon_emoji||"📚"}),e.jsxs("div",{children:[e.jsx("div",{children:"Zarządzaj dostępem do kursu"}),e.jsx("div",{className:"text-sm font-normal text-muted-foreground",children:t?.title})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 overflow-hidden",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"font-medium text-sm flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4"}),"Grupy z dostępem"]}),e.jsxs(q,{variant:"secondary",children:[N," z ",x.length]})]}),e.jsx(J,{placeholder:"Szukaj grupy...",value:a,onChange:T=>o(T.target.value),className:"h-9"}),e.jsx(qs,{className:"h-[350px] border rounded-lg p-3",children:e.jsx("div",{className:"space-y-2",children:v.map(T=>{const f=y.groupAccess[T.id]||!1;return e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border-2 cursor-pointer transition-all ${f?"border-primary bg-primary/5":"border-transparent hover:bg-muted"}`,children:[e.jsx(rs,{checked:f,onCheckedChange:()=>C(T.id,f),disabled:d}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:T.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:T.academic_year})]}),f&&e.jsx(Ge,{className:"w-4 h-4 text-primary"})]},T.id)})})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"font-medium text-sm flex items-center gap-2",children:[e.jsx(ws,{className:"w-4 h-4"}),"Nauczyciele prowadzący"]}),e.jsxs(q,{variant:"secondary",children:[z," z ",b.length]})]}),e.jsx(J,{placeholder:"Szukaj nauczyciela...",value:l,onChange:T=>c(T.target.value),className:"h-9"}),e.jsx(qs,{className:"h-[350px] border rounded-lg p-3",children:e.jsx("div",{className:"space-y-2",children:_.map(T=>{const f=y.teacherAccess[T.id]||!1;return e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border-2 cursor-pointer transition-all ${f?"border-primary bg-primary/5":"border-transparent hover:bg-muted"}`,children:[e.jsx(rs,{checked:f,onCheckedChange:()=>k(T.id,f),disabled:d}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:T.full_name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:T.email})]}),f&&e.jsx(Ge,{className:"w-4 h-4 text-primary"})]},T.id)})})})]})]}),e.jsxs(Ha,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Kurs dostępny dla ",e.jsxs("strong",{children:[N," grup"]})," i"," ",e.jsxs("strong",{children:[z," nauczycieli"]})]}),e.jsx(I,{variant:"outline",onClick:()=>n(!1),children:"Zamknij"})]})]})})},Tw=()=>{const[t,s]=g.useState(!1);return e.jsx(M,{className:"border-2 border-green-200/50 bg-gradient-to-br from-green-50/50 to-emerald-50/50 dark:from-green-950/20 dark:to-emerald-950/20",children:e.jsx(R,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-green-100 dark:bg-green-900/50 flex-shrink-0",children:e.jsx(Se,{className:"h-6 w-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"font-semibold text-lg flex items-center gap-2",children:["Zarządzanie dostępem do kursów",e.jsx(ic,{className:"h-4 w-4 text-green-500"})]}),e.jsx("button",{onClick:()=>s(!t),className:"p-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-green-600 dark:text-green-400","aria-label":t?"Zwiń szczegóły":"Rozwiń szczegóły",children:t?e.jsx(ss,{className:"h-5 w-5"}):e.jsx(Rt,{className:"h-5 w-5"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Kontroluj, które grupy i nauczyciele mają dostęp do poszczególnych kursów."}),t&&e.jsxs("div",{className:"mt-4 space-y-4 animate-in slide-in-from-top-2 duration-200",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900/50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/50 rounded-lg flex-shrink-0",children:e.jsx(oe,{className:"h-4 w-4 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:"Przypisz grupy"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Wybierz grupy, które będą miały dostęp do kursu"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/50 rounded-lg flex-shrink-0",children:e.jsx(ws,{className:"h-4 w-4 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:"Dodaj nauczycieli"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Wskaż nauczycieli prowadzących zajęcia"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/50 rounded-lg flex-shrink-0",children:e.jsx(La,{className:"h-4 w-4 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:"Kontroluj dostęp"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Zmiany są zapisywane automatycznie"})]})]})]}),e.jsx("div",{className:"p-3 bg-green-50 dark:bg-green-950/30 rounded-lg",children:e.jsxs("p",{className:"text-xs text-green-700 dark:text-green-300 flex items-start gap-2",children:[e.jsx(Bh,{className:"h-3 w-3 mt-0.5 flex-shrink-0"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Ważne:"}),' Najpierw utwórz grupy w module "Grupy i klasy", a następnie przypisz je do kursów tutaj.']})]})})]})]})]})})})},Aw=()=>{const[t,s]=g.useState(""),[n,i]=g.useState(null),[r,a]=g.useState(!1),[o,l]=g.useState({key:"title",direction:"asc"}),{data:c,isLoading:d}=Z({resource:"courses",filters:[{field:"is_published",operator:"eq",value:!0}],pagination:{pageSize:1e3},sorters:[{field:"title",order:"asc"}]}),{data:m,refetch:u}=Z({resource:"course_access",pagination:{pageSize:1e4}}),h=g.useMemo(()=>c?.data??[],[c]),p=g.useMemo(()=>m?.data??[],[m]),j=g.useMemo(()=>{const y={};return h.forEach(v=>{const _=p.filter(C=>C.course_id===v.id);y[v.id]={groupCount:_.filter(C=>C.group_id).length,teacherCount:_.filter(C=>C.teacher_id).length}}),y},[h,p]),x=g.useMemo(()=>{const y=h.filter(v=>t===""||v.title.toLowerCase().includes(t.toLowerCase()));return o.key&&y.sort((v,_)=>{let C,k;return o.key==="groupCount"?(C=j[v.id]?.groupCount||0,k=j[_.id]?.groupCount||0):o.key==="teacherCount"?(C=j[v.id]?.teacherCount||0,k=j[_.id]?.teacherCount||0):o.key&&o.key in v&&(C=v[o.key],k=_[o.key]),C<k?o.direction==="asc"?-1:1:C>k?o.direction==="asc"?1:-1:0}),y},[h,t,o,j]),b=y=>{l(v=>({key:y,direction:v.key===y&&v.direction==="asc"?"desc":"asc"}))},w=({column:y})=>o.key!==y?e.jsx(ss,{className:"w-4 h-4 opacity-20"}):o.direction==="asc"?e.jsx(ss,{className:"w-4 h-4"}):e.jsx(Rt,{className:"w-4 h-4"});return e.jsxs(G,{children:[e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Dostęp do kursów"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Zarządzaj dostępem grup i nauczycieli do kursów"})]}),e.jsx(Tw,{}),e.jsx(M,{children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(Nr,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(J,{placeholder:"Szukaj kursu po nazwie...",value:t,onChange:y=>s(y.target.value),className:"pl-9"})]})})}),e.jsx(M,{children:e.jsx(R,{className:"p-0",children:d?e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"Ładowanie kursów..."}):x.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(Se,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground/50"}),e.jsx("p",{className:"text-muted-foreground",children:t?"Nie znaleziono kursów":"Brak kursów w systemie"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Nn,{children:[e.jsx(kn,{children:e.jsxs(ut,{children:[e.jsx(ie,{className:"cursor-pointer select-none",onClick:()=>b("title"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Kurs",e.jsx(w,{column:"title"})]})}),e.jsx(ie,{className:"cursor-pointer select-none text-center",onClick:()=>b("groupCount"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Grupy z dostępem",e.jsx(w,{column:"groupCount"})]})}),e.jsx(ie,{className:"cursor-pointer select-none text-center",onClick:()=>b("teacherCount"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Nauczyciele",e.jsx(w,{column:"teacherCount"})]})}),e.jsx(ie,{className:"text-center",children:"Akcje"})]})}),e.jsx(zn,{children:x.map(y=>{const v=j[y.id]||{groupCount:0,teacherCount:0};return e.jsxs(ut,{children:[e.jsx(re,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:y.icon_emoji||"📚"}),e.jsx("div",{className:"font-medium",children:y.title})]})}),e.jsx(re,{className:"text-center",children:e.jsxs(q,{variant:v.groupCount>0?"default":"secondary",className:"gap-1",children:[e.jsx(oe,{className:"w-3 h-3"}),v.groupCount," grup"]})}),e.jsx(re,{className:"text-center",children:e.jsxs(q,{variant:v.teacherCount>0?"default":"secondary",className:"gap-1",children:[e.jsx(nc,{className:"w-3 h-3"}),v.teacherCount," nauczycieli"]})}),e.jsx(re,{className:"text-center",children:e.jsxs(I,{size:"sm",variant:"outline",onClick:()=>{i(y),a(!0)},children:[e.jsx(ic,{className:"w-4 h-4 mr-1"}),"Zarządzaj dostępem"]})})]},y.id)})})]})})})}),e.jsxs("div",{className:"text-sm text-muted-foreground text-center",children:["Wyświetlono ",x.length," z ",h.length," kursów"]})]}),e.jsx(_w,{course:n,open:r,onOpenChange:a,onAccessUpdate:u})]})},Dw=()=>{const[t,s]=g.useState(!1);return e.jsx(M,{className:"border-2 border-purple-200/50 bg-gradient-to-br from-purple-50/50 to-pink-50/50 dark:from-purple-950/20 dark:to-pink-950/20",children:e.jsx(R,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-purple-100 dark:bg-purple-900/50 flex-shrink-0",children:e.jsx(Yy,{className:"h-6 w-6 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"font-semibold text-lg flex items-center gap-2",children:["Jak zarządzać użytkownikami?",e.jsx(Ct,{className:"h-4 w-4 text-purple-500"})]}),e.jsx("button",{onClick:()=>s(!t),className:"p-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-purple-600 dark:text-purple-400","aria-label":t?"Zwiń szczegóły":"Rozwiń szczegóły",children:t?e.jsx(ss,{className:"h-5 w-5"}):e.jsx(Rt,{className:"h-5 w-5"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"System pozwala na łatwe zarządzanie rolami i statusami użytkowników."}),t&&e.jsxs("div",{className:"mt-4 space-y-4 animate-in slide-in-from-top-2 duration-200",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-purple-100 dark:bg-purple-900/50 text-sm font-bold text-purple-600 flex-shrink-0",children:"1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm mb-1",children:"Znajdź użytkownika"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Użyj wyszukiwarki lub filtrów, aby znaleźć konkretnego użytkownika"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-purple-100 dark:bg-purple-900/50 text-sm font-bold text-purple-600 flex-shrink-0",children:"2"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm mb-1",children:"Zmień rolę"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Wybierz nową rolę z rozwijanej listy: Uczeń, Nauczyciel lub Administrator"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-purple-100 dark:bg-purple-900/50 text-sm font-bold text-purple-600 flex-shrink-0",children:"3"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm mb-1",children:"Zarządzaj statusem"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Użyj przełącznika, aby aktywować lub dezaktywować konto użytkownika"})]})]})]}),e.jsx("div",{className:"p-3 bg-purple-50 dark:bg-purple-950/30 rounded-lg",children:e.jsxs("p",{className:"text-xs text-purple-700 dark:text-purple-300 flex items-start gap-2",children:[e.jsx(La,{className:"h-3 w-3 mt-0.5 flex-shrink-0"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Wskazówka:"})," Administratorzy mają pełen dostęp do systemu. Przyznawaj tę rolę z rozwagą."]})]})})]})]})]})})})},Pw=()=>{const{open:t}=ec(),[s,n]=g.useState(""),[i,r]=g.useState("all"),[a,o]=g.useState("all"),[l,c]=g.useState({key:"full_name",direction:"asc"}),{data:d,isLoading:m,refetch:u}=Z({resource:"users",pagination:{pageSize:1e4},sorters:[{field:"full_name",order:"asc"}]}),{mutate:h,isLoading:p}=pi(),j=d?.data??[],x=g.useMemo(()=>{const k=j.filter(N=>{const z=s===""||N.full_name.toLowerCase().includes(s.toLowerCase())||N.email.toLowerCase().includes(s.toLowerCase()),T=i==="all"||N.role===i,f=a==="all"||(a==="active"?N.is_active:!N.is_active);return z&&T&&f});return l.key&&k.sort((N,z)=>{const T=N[l.key],f=z[l.key];return T<f?l.direction==="asc"?-1:1:T>f?l.direction==="asc"?1:-1:0}),k},[j,s,i,a,l]),b=g.useMemo(()=>({total:j.length,students:j.filter(k=>k.role==="student").length,teachers:j.filter(k=>k.role==="teacher").length,admins:j.filter(k=>k.role==="admin").length,active:j.filter(k=>k.is_active).length,inactive:j.filter(k=>!k.is_active).length}),[j]),w=k=>{c(N=>({key:k,direction:N.key===k&&N.direction==="asc"?"desc":"asc"}))},y=async(k,N)=>{h({resource:"users",id:k,values:{is_active:!N},successNotification:()=>({message:N?"Konto dezaktywowane":"Konto aktywowane",type:"success"})},{onSuccess:()=>u()})},v=async(k,N)=>{h({resource:"users",id:k,values:{role:N},successNotification:()=>({message:"Rola zmieniona",type:"success"})},{onSuccess:()=>u()})},_=k=>{switch(k){case"admin":return e.jsxs(q,{variant:"destructive",children:[e.jsx(La,{className:"w-3 h-3 mr-1"}),"Administrator"]});case"teacher":return e.jsxs(q,{className:"bg-blue-500",children:[e.jsx(nc,{className:"w-3 h-3 mr-1"}),"Nauczyciel"]});default:return e.jsxs(q,{className:"bg-green-500",children:[e.jsx(ni,{className:"w-3 h-3 mr-1"}),"Uczeń"]})}},C=({column:k})=>l.key!==k?e.jsx(ss,{className:"w-4 h-4 opacity-20"}):l.direction==="asc"?e.jsx(ss,{className:"w-4 h-4"}):e.jsx(Rt,{className:"w-4 h-4"});return e.jsx(G,{children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Zarządzanie użytkownikami"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Zmień role użytkowników i zarządzaj ich dostępem do systemu"})]}),e.jsx(Dw,{}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-3",children:[e.jsx(M,{children:e.jsxs(R,{className:"p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:b.total}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Wszyscy"})]})}),e.jsx(M,{className:"border-green-200 bg-green-50/50 dark:bg-green-950/20",children:e.jsxs(R,{className:"p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:b.students}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Uczniowie"})]})}),e.jsx(M,{className:"border-blue-200 bg-blue-50/50 dark:bg-blue-950/20",children:e.jsxs(R,{className:"p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:b.teachers}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Nauczyciele"})]})}),e.jsx(M,{className:"border-red-200 bg-red-50/50 dark:bg-red-950/20",children:e.jsxs(R,{className:"p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:b.admins}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Admini"})]})}),e.jsx(M,{children:e.jsxs(R,{className:"p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:b.active}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Aktywni"})]})}),e.jsx(M,{children:e.jsxs(R,{className:"p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:b.inactive}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Nieaktywni"})]})})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsxs(O,{className:"text-base flex items-center gap-2",children:[e.jsx(Uh,{className:"w-4 h-4"}),"Filtry"]})}),e.jsx(R,{children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Nr,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(J,{placeholder:"Szukaj po imieniu lub emailu...",value:s,onChange:k=>n(k.target.value),className:"pl-9"})]})}),e.jsxs(Ce,{value:i,onValueChange:k=>r(k),children:[e.jsx(we,{className:"w-[180px]",children:e.jsx(_e,{placeholder:"Wszystkie role"})}),e.jsxs(ve,{children:[e.jsx(W,{value:"all",children:"Wszystkie role"}),e.jsx(W,{value:"student",children:"Tylko uczniowie"}),e.jsx(W,{value:"teacher",children:"Tylko nauczyciele"}),e.jsx(W,{value:"admin",children:"Tylko admini"})]})]}),e.jsxs(Ce,{value:a,onValueChange:k=>o(k),children:[e.jsx(we,{className:"w-[180px]",children:e.jsx(_e,{placeholder:"Wszystkie statusy"})}),e.jsxs(ve,{children:[e.jsx(W,{value:"all",children:"Wszystkie statusy"}),e.jsx(W,{value:"active",children:"Tylko aktywni"}),e.jsx(W,{value:"inactive",children:"Tylko nieaktywni"})]})]})]})})]}),e.jsx(M,{children:e.jsx(R,{className:"p-0",children:m?e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"Ładowanie użytkowników..."}):x.length===0?e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"Nie znaleziono użytkowników spełniających kryteria"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Nn,{children:[e.jsx(kn,{children:e.jsxs(ut,{children:[e.jsx(ie,{className:"cursor-pointer select-none",onClick:()=>w("full_name"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Imię i nazwisko",e.jsx(C,{column:"full_name"})]})}),e.jsx(ie,{className:"cursor-pointer select-none",onClick:()=>w("email"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Email",e.jsx(C,{column:"email"})]})}),e.jsx(ie,{className:"cursor-pointer select-none",onClick:()=>w("role"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Rola",e.jsx(C,{column:"role"})]})}),e.jsx(ie,{children:"Zmień rolę"}),e.jsx(ie,{className:"cursor-pointer select-none text-center",onClick:()=>w("is_active"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Status",e.jsx(C,{column:"is_active"})]})})]})}),e.jsx(zn,{children:x.map(k=>e.jsxs(ut,{className:k.is_active?"":"opacity-60",children:[e.jsx(re,{className:"font-medium",children:k.full_name}),e.jsx(re,{className:"text-sm text-muted-foreground",children:k.email}),e.jsx(re,{children:_(k.role)}),e.jsx(re,{children:e.jsxs(Ce,{value:k.role,onValueChange:N=>v(k.id,N),disabled:p,children:[e.jsx(we,{className:"w-[140px] h-8",children:e.jsx(_e,{})}),e.jsxs(ve,{children:[e.jsx(W,{value:"student",children:"Uczeń"}),e.jsx(W,{value:"teacher",children:"Nauczyciel"}),e.jsx(W,{value:"admin",children:"Administrator"})]})]})}),e.jsx(re,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Bt,{checked:k.is_active,onCheckedChange:()=>y(k.id,k.is_active),disabled:p}),e.jsx("span",{className:"text-sm",children:k.is_active?e.jsx(q,{variant:"outline",className:"text-green-600",children:"Aktywny"}):e.jsx(q,{variant:"destructive",children:"Nieaktywny"})})]})})]},k.id))})]})})})}),e.jsxs("div",{className:"text-sm text-muted-foreground text-center",children:["Wyświetlono ",x.length," z ",j.length," użytkowników"]})]})})},Mw=({group:t,open:s,onOpenChange:n,onMembersUpdate:i})=>{const{open:r}=ec(),[a,o]=g.useState(""),[l,c]=g.useState(new Set),{data:d}=Z({resource:"users",filters:[{field:"role",operator:"eq",value:"student"},{field:"is_active",operator:"eq",value:!0}],pagination:{pageSize:1e4},sorters:[{field:"full_name",order:"asc"}],queryOptions:{enabled:s}}),{data:m,refetch:u}=Z({resource:"group_members",filters:t?[{field:"group_id",operator:"eq",value:t.id}]:[],pagination:{pageSize:1e4},meta:{select:`
        *,
        users!inner(full_name, email)
      `},queryOptions:{enabled:s&&!!t}}),h=g.useMemo(()=>d?.data??[],[d]),p=g.useMemo(()=>m?.data??[],[m]),j=g.useMemo(()=>t?p.filter(v=>v.group_id===t.id):[],[t,p]),x=g.useMemo(()=>{if(!t)return[];const v=new Set(j.map(_=>_.user_id));return h.filter(_=>!(v.has(_.id)||a&&!_.full_name.toLowerCase().includes(a.toLowerCase())))},[h,t,j,a]);g.useEffect(()=>{s||(c(new Set),o(""))},[s]);const b=async()=>{if(!(!t||l.size===0))try{const v=Array.from(l).map(C=>({group_id:t.id,user_id:C})),{error:_}=await Q.from("group_members").insert(v);if(_)throw _;r?.({type:"success",message:`Dodano ${l.size} uczniów do grupy`}),c(new Set),o(""),u(),i()}catch{r?.({type:"error",message:"Nie udało się dodać uczniów"})}},w=async v=>{if(t)try{const{error:_}=await Q.from("group_members").delete().eq("group_id",t.id).eq("user_id",v);if(_)throw _;r?.({type:"success",message:"Uczeń usunięty z grupy"}),u(),i()}catch{r?.({type:"error",message:"Nie udało się usunąć ucznia"})}},y=()=>{n(!1),c(new Set),o("")};return e.jsx(dc,{open:s,onOpenChange:n,children:e.jsxs(Wa,{className:"max-w-4xl max-h-[80vh]",children:[e.jsx(Ga,{children:e.jsxs(Za,{children:["Zarządzaj uczniami w grupie: ",t?.name]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 overflow-hidden",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"font-medium text-sm",children:["Uczniowie w grupie (",j.length,")"]}),e.jsx("div",{className:"border rounded-lg p-3 h-[400px] overflow-y-auto",children:j.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Brak uczniów w grupie"}):e.jsx("div",{className:"space-y-2",children:j.map(v=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded hover:bg-muted",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:v.users?.full_name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:v.users?.email})]}),e.jsx(I,{size:"sm",variant:"ghost",onClick:()=>w(v.user_id),className:"text-red-600",children:e.jsx(Xy,{className:"w-4 h-4"})})]},v.user_id))})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"font-medium text-sm",children:["Dostępni uczniowie (",x.length,")"]}),e.jsx(J,{placeholder:"Szukaj ucznia...",value:a,onChange:v=>o(v.target.value),className:"h-9"}),e.jsx("div",{className:"border rounded-lg p-3 h-[350px] overflow-y-auto",children:x.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:a?"Nie znaleziono uczniów":"Wszyscy uczniowie są już w grupie"}):e.jsx("div",{className:"space-y-2",children:x.map(v=>e.jsxs("label",{className:"flex items-center gap-3 p-2 rounded hover:bg-muted cursor-pointer",children:[e.jsx(rs,{checked:l.has(v.id),onCheckedChange:_=>{const C=new Set(l);_?C.add(v.id):C.delete(v.id),c(C)}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:v.full_name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:v.email})]})]},v.id))})}),l.size>0&&e.jsxs(I,{onClick:b,className:"w-full",children:[e.jsx(ws,{className:"w-4 h-4 mr-2"}),"Dodaj zaznaczonych (",l.size,")"]})]})]}),e.jsx(Ha,{children:e.jsx(I,{variant:"outline",onClick:y,children:"Zamknij"})})]})})},Rw=()=>{const[t,s]=g.useState(!1);return e.jsx(M,{className:"border-2 border-blue-200/50 bg-gradient-to-br from-blue-50/50 to-indigo-50/50 dark:from-blue-950/20 dark:to-indigo-950/20",children:e.jsx(R,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-blue-100 dark:bg-blue-900/50 flex-shrink-0",children:e.jsx(Ee,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"font-semibold text-lg flex items-center gap-2",children:["System zarządzania grupami",e.jsx(oe,{className:"h-4 w-4 text-blue-500"})]}),e.jsx("button",{onClick:()=>s(!t),className:"p-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-blue-600 dark:text-blue-400","aria-label":t?"Zwiń szczegóły":"Rozwiń szczegóły",children:t?e.jsx(ss,{className:"h-5 w-5"}):e.jsx(Rt,{className:"h-5 w-5"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Twórz grupy i klasy, przypisuj uczniów i organizuj strukturę nauczania."}),t&&e.jsxs("div",{className:"mt-4 space-y-4 animate-in slide-in-from-top-2 duration-200",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-sm text-blue-700 dark:text-blue-300",children:"Tworzenie grup"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(jt,{className:"h-3 w-3 mt-0.5 text-blue-500 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:'Kliknij "Nowa grupa"'})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(jt,{className:"h-3 w-3 mt-0.5 text-blue-500 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:'Nadaj nazwę (np. "Klasa 1A")'})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(jt,{className:"h-3 w-3 mt-0.5 text-blue-500 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Określ rok akademicki"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-sm text-blue-700 dark:text-blue-300",children:"Zarządzanie uczniami"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(jt,{className:"h-3 w-3 mt-0.5 text-blue-500 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:'Kliknij "Zarządzaj" przy grupie'})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(jt,{className:"h-3 w-3 mt-0.5 text-blue-500 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Dodaj uczniów z listy"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(jt,{className:"h-3 w-3 mt-0.5 text-blue-500 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Usuń niepotrzebnych członków"})]})]})]})]}),e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-950/30 rounded-lg",children:e.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-300 flex items-start gap-2",children:[e.jsx(Ue,{className:"h-3 w-3 mt-0.5 flex-shrink-0"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Pro tip:"})," Grupy można dezaktywować bez usuwania - przydatne na koniec roku szkolnego!"]})]})})]})]})]})})})},Iw=()=>{const[t,s]=g.useState(null),[n,i]=g.useState(!1),[r,a]=g.useState(!1),[o,l]=g.useState(""),[c,d]=g.useState("2024/2025"),[m,u]=g.useState(""),[h,p]=g.useState({key:"name",direction:"asc"}),{data:j,isLoading:x,refetch:b}=Z({resource:"groups",pagination:{pageSize:1e3},sorters:[{field:"name",order:"asc"}]}),{data:w,refetch:y}=Z({resource:"group_members",pagination:{pageSize:1e4}}),{mutate:v,isLoading:_}=fn(),{mutate:C}=pi(),{mutate:k}=pn(),N=g.useMemo(()=>j?.data??[],[j]),z=g.useMemo(()=>w?.data??[],[w]),T=g.useMemo(()=>{const E={};return N.forEach(U=>{E[U.id]=z.filter(B=>B.group_id===U.id).length}),E},[N,z]),f=g.useMemo(()=>{const E=N.filter(U=>m===""||U.name.toLowerCase().includes(m.toLowerCase())||U.academic_year.includes(m));return h.key&&E.sort((U,B)=>{let ae,le;return h.key==="memberCount"?(ae=T[U.id]||0,le=T[B.id]||0):(ae=U[h.key],le=B[h.key]),ae<le?h.direction==="asc"?-1:1:ae>le?h.direction==="asc"?1:-1:0}),E},[N,m,h,T]),S=E=>{p(U=>({key:E,direction:U.key===E&&U.direction==="asc"?"desc":"asc"}))},A=()=>{o.trim()&&v({resource:"groups",values:{name:o,academic_year:c,vendor_id:1},successNotification:()=>({message:"Grupa została utworzona",type:"success"})},{onSuccess:()=>{i(!1),l(""),b()}})},D=E=>{confirm("Czy na pewno chcesz usunąć tę grupę?")&&k({resource:"groups",id:E,successNotification:()=>({message:"Grupa została usunięta",type:"success"})},{onSuccess:()=>b()})},P=async E=>{C({resource:"groups",id:E.id,values:{is_active:!E.is_active},successNotification:()=>({message:E.is_active?"Grupa dezaktywowana":"Grupa aktywowana",type:"success"})},{onSuccess:()=>b()})},L=({column:E})=>h.key!==E?e.jsx(ss,{className:"w-4 h-4 opacity-20"}):h.direction==="asc"?e.jsx(ss,{className:"w-4 h-4"}):e.jsx(Rt,{className:"w-4 h-4"}),K=x;return e.jsxs(G,{children:[e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Zarządzanie grupami i klasami"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Twórz grupy i przypisuj do nich uczniów"})]}),e.jsxs(I,{onClick:()=>i(!0),children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Nowa grupa"]})]}),e.jsx(Rw,{}),e.jsx(M,{children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(Nr,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(J,{placeholder:"Szukaj grupy po nazwie lub roku akademickim...",value:m,onChange:E=>u(E.target.value),className:"pl-9"})]})})}),e.jsx(M,{children:e.jsx(R,{className:"p-0",children:K?e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"Ładowanie grup..."}):f.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(oe,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground/50"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:m?"Nie znaleziono grup":"Brak grup w systemie"}),e.jsxs(I,{onClick:()=>i(!0),children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Utwórz pierwszą grupę"]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Nn,{children:[e.jsx(kn,{children:e.jsxs(ut,{children:[e.jsx(ie,{className:"cursor-pointer select-none",onClick:()=>S("name"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Nazwa grupy",e.jsx(L,{column:"name"})]})}),e.jsx(ie,{className:"cursor-pointer select-none",onClick:()=>S("academic_year"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Rok akademicki",e.jsx(L,{column:"academic_year"})]})}),e.jsx(ie,{className:"cursor-pointer select-none text-center",onClick:()=>S("memberCount"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Liczba uczniów",e.jsx(L,{column:"memberCount"})]})}),e.jsx(ie,{className:"text-center",children:"Status"}),e.jsx(ie,{className:"text-center",children:"Akcje"})]})}),e.jsx(zn,{children:f.map(E=>e.jsxs(ut,{children:[e.jsx(re,{className:"font-medium",children:E.name}),e.jsx(re,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(vs,{className:"w-4 h-4 text-muted-foreground"}),E.academic_year]})}),e.jsx(re,{className:"text-center",children:e.jsxs(q,{variant:"secondary",children:[T[E.id]||0," uczniów"]})}),e.jsx(re,{className:"text-center",children:e.jsx(Bt,{checked:E.is_active,onCheckedChange:()=>P(E)})}),e.jsx(re,{children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs(I,{size:"sm",variant:"outline",onClick:()=>{s(E),a(!0)},children:[e.jsx(oe,{className:"w-4 h-4 mr-1"}),"Zarządzaj"]}),e.jsx(I,{size:"sm",variant:"ghost",onClick:()=>D(E.id),className:"text-red-600 hover:bg-red-50",children:e.jsx(ns,{className:"w-4 h-4"})})]})})]},E.id))})]})})})})]}),e.jsx(dc,{open:n,onOpenChange:i,children:e.jsxs(Wa,{children:[e.jsx(Ga,{children:e.jsx(Za,{children:"Utwórz nową grupę"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(nr,{htmlFor:"name",children:"Nazwa grupy"}),e.jsx(J,{id:"name",value:o,onChange:E=>l(E.target.value),placeholder:"np. Klasa 1A"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(nr,{htmlFor:"year",children:"Rok akademicki"}),e.jsx(J,{id:"year",value:c,onChange:E=>d(E.target.value),placeholder:"np. 2024/2025"})]})]}),e.jsxs(Ha,{children:[e.jsx(I,{variant:"outline",onClick:()=>i(!1),children:"Anuluj"}),e.jsx(I,{onClick:A,disabled:_||!o.trim(),children:"Utwórz grupę"})]})]})}),e.jsx(Mw,{group:t,open:r,onOpenChange:a,onMembersUpdate:y})]})},Ew={name:"permissions",list:"/admin/permissions",meta:{label:"Zarządzanie dostępem",icon:e.jsx(Jy,{className:"h-4 w-4"})}},Lw={name:"permissions-users",list:"/admin/permissions/users",meta:{label:"Użytkownicy",icon:e.jsx(oe,{className:"h-4 w-4"}),parent:"permissions"}},Ow={name:"permissions-groups",list:"/admin/permissions/groups",meta:{label:"Grupy i klasy",icon:e.jsx(eb,{className:"h-4 w-4"}),parent:"permissions"}},$w={name:"permissions-access",list:"/admin/permissions/access",meta:{label:"Dostęp do kursów",icon:e.jsx(Ge,{className:"h-4 w-4"}),parent:"permissions"}},Fw=[e.jsx(V,{path:"permissions",element:e.jsx($t,{to:"/admin/permissions/users",replace:!0})},"permissions-default"),e.jsx(V,{path:"permissions/users",element:e.jsx(Pw,{})},"permissions-users"),e.jsx(V,{path:"permissions/groups",element:e.jsx(Iw,{})},"permissions-groups"),e.jsx(V,{path:"permissions/access",element:e.jsx(Aw,{})},"permissions-access")],_o=[Ew,Lw,Ow,$w],Bw={"between-center":"flex justify-between items-center gap-2",center:"flex justify-center items-center gap-2",start:"flex justify-start items-center gap-2",end:"flex justify-end items-center gap-2"},Y=({children:t,variant:s="between-center",className:n=""})=>{const i=Bw[s],r=n?`${i} ${n}`:i;return e.jsx("div",{className:r,children:t})},Uw={"1-2-3":"grid gap-6 md:grid-cols-2 lg:grid-cols-3","1-2-2":"grid gap-6 md:grid-cols-2","1-1-1":"grid gap-6","2-2-4":"grid gap-6 grid-cols-2 lg:grid-cols-4"},rt=({children:t,variant:s="1-2-3",className:n=""})=>{const i=Uw[s],r=n?`${i} ${n}`:i;return e.jsx("div",{className:r,children:t})},xf=({current:t,pageSize:s,total:n,setCurrent:i,setPageSize:r,itemName:a="elementów",pageSizeOptions:o=[10,20,50]})=>{const l=Math.ceil(n/s),c=(t-1)*s+1,d=Math.min(t*s,n),m=t>1,u=t<l,h=()=>{const p=[];if(l<=5)for(let x=1;x<=l;x++)p.push(x);else{p.push(1),t>3&&p.push("...");const x=Math.max(2,t-1),b=Math.min(l-1,t+1);for(let w=x;w<=b;w++)p.push(w);t<l-2&&p.push("..."),p.push(l)}return p};return n===0?null:e.jsxs(Y,{className:"mt-6",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Pokazuje ",c,"-",d," z ",n," ",a]}),e.jsxs(Y,{className:"gap-2",children:[r&&e.jsxs(Ce,{value:s.toString(),onValueChange:p=>{r(parseInt(p)),i(1)},children:[e.jsx(we,{className:"w-[100px]",children:e.jsx(_e,{})}),e.jsx(ve,{children:o.map(p=>e.jsxs(W,{value:p.toString(),children:[p," / str."]},p))})]}),e.jsx(I,{variant:"outline",size:"sm",onClick:()=>i(t-1),disabled:!m,children:e.jsx(tb,{className:"w-4 h-4"})}),e.jsx("div",{className:"hidden sm:flex gap-1",children:h().map((p,j)=>p==="..."?e.jsx("span",{className:"px-3 py-1 text-sm text-muted-foreground",children:"..."},`ellipsis-${j}`):e.jsx(I,{variant:t===p?"default":"outline",size:"sm",onClick:()=>i(p),className:"min-w-[40px]",children:p},p))}),e.jsxs("div",{className:"flex sm:hidden items-center px-3 text-sm",children:[t," / ",l]}),e.jsx(I,{variant:"outline",size:"sm",onClick:()=>i(t+1),disabled:!u,children:e.jsx(jt,{className:"w-4 h-4"})})]})]})},Vw={card:{wrap:"space-y-0",title:"font-medium",description:"text-muted-foreground"},lg:{wrap:"space-y-0",title:"text-3xl font-bold tracking-tight",description:"text-muted-foreground"},md:{wrap:"space-y-0",title:"font-medium",description:"text-muted-foreground"},sm:{wrap:"space-y-1",title:"font-medium text-sm text-muted-foreground mb-1",description:"text-sm"}},ke=({title:t,description:s,variant:n="lg"})=>{const i=Vw[n],r=()=>{switch(n){case"lg":return e.jsx("h1",{className:i.title,children:t});case"md":return e.jsx("h2",{className:i.title,children:t});case"sm":return e.jsx("h3",{className:i.title,children:t});default:return e.jsx("h1",{className:i.title,children:t})}};return n==="card"?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"text-lg font-semibold leading-tight flex items-center gap-2",children:t}),e.jsx(lc,{className:"text-sm text-muted-foreground mt-2",children:s})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:i.wrap,children:[r(),e.jsx("p",{className:`prose ${i.description}`,children:s})]})})},qw=()=>{const{tableQuery:{data:t,isLoading:s,isError:n},current:i,setCurrent:r,pageSize:a,setFilters:o}=$h({sorters:{initial:[{field:"created_at",order:"desc"}]}}),l=oc({isLoading:s,isError:n});return l||e.jsxs(G,{children:[e.jsx(ke,{title:"Organizacje",description:"Lista wszystkich organizacji w systemie"}),e.jsx(Y,{children:e.jsx(J,{placeholder:"Szukaj organizacji...",className:"max-w-sm",onChange:c=>{o([{operator:"or",value:[{field:"name",operator:"contains",value:c.target.value},{field:"subdomain",operator:"contains",value:c.target.value}]}])}})}),e.jsx(rt,{children:t?.data?.map(c=>e.jsxs(M,{children:[e.jsx($,{children:e.jsxs(Y,{children:[e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(Vh,{className:"w-5 h-5"}),c.name]}),e.jsx(q,{variant:c.is_active?"default":"secondary",children:c.is_active?"Aktywna":"Nieaktywna"})]})}),e.jsxs(R,{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(sb,{className:"w-3 h-3"}),e.jsxs("span",{children:[c.subdomain,".example.com"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(vs,{className:"w-3 h-3"}),e.jsxs("span",{children:["Utworzono: ",new Date(c.created_at).toLocaleDateString("pl-PL")]})]})]})]},c.id))}),e.jsx(xf,{current:i,pageSize:a,total:t?.total||0,setCurrent:r,itemName:"organizacji"})]})},Gd={name:"vendors",list:"/admin/vendors",meta:{label:"Organizacje",icon:e.jsx(Vh,{className:"h-4 w-4"})}},Kw=[e.jsx(V,{path:"vendors",element:e.jsx(qw,{})},"vendors-list")],Ww=[...Cw,...Fw,...Kw],Gw=()=>e.jsx(Pa,{children:e.jsxs(V,{element:e.jsx(zw,{children:e.jsx(Yl,{})}),children:[e.jsx(V,{index:!0,element:e.jsx($t,{to:"dashboard/overview",replace:!0})}),e.jsx(V,{path:"dashboard",element:e.jsx($t,{to:"dashboard/overview",replace:!0})}),Ww]})}),Hw=g.lazy(()=>Promise.resolve({default:Gw})),gf=({text:t,colorClass:s})=>e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-background",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`inline-block h-12 w-12 animate-spin rounded-full border-4 border-current border-r-transparent ${s}`}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:t})]})}),Zw=({children:t})=>{const{data:s,isLoading:n}=Le();if(n||!s)return e.jsx(gf,{text:"Sprawdzanie uprawnień...",colorClass:"border-red-600"});if(s.role!=="admin"){const i=s.role==="teacher"?"/teacher/dashboard":"/student/dashboard";return e.jsx($t,{to:i,replace:!0})}return e.jsx(e.Fragment,{children:t})},Qw=e.jsx(V,{path:"/admin/*",element:e.jsx(tc,{fallback:e.jsx(sc,{to:"/login"}),children:e.jsx(Zw,{children:e.jsx(g.Suspense,{fallback:e.jsx(gf,{text:"Ładowanie panelu administratora...",colorClass:"border-red-600"}),children:e.jsx(Hw,{})})})},"admin-auth")}),Yw=({onClose:t})=>{const{mutate:s}=Ra(),{menuItems:n}=Oh(),{data:i}=Le(),r=()=>{t&&t()};return e.jsxs("div",{className:"flex h-full w-64 flex-col border-r bg-background",children:[e.jsxs("div",{className:"flex h-16 items-center justify-between border-b px-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(vr,{className:"h-6 w-6 mr-2"}),e.jsx("span",{className:"font-semibold",children:"Smart Up"})]}),t&&e.jsx(I,{variant:"ghost",size:"sm",onClick:t,className:"lg:hidden",children:e.jsx(Pt,{className:"h-4 w-4"})})]}),e.jsx(qs,{className:"flex-1 px-3 py-4",children:e.jsx("nav",{className:"space-y-4",children:n.map(a=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ti,{to:a.route??"/",onClick:r,className:({isActive:o})=>F("flex items-center justify-between rounded-md px-3 py-2 text-sm font-semibold transition-colors hover:bg-accent hover:text-accent-foreground",o?"bg-accent text-accent-foreground":"text-foreground"),children:[e.jsxs("span",{className:"flex items-center",children:[a.icon&&e.jsx("span",{className:"mr-3",children:a.icon}),a.label]}),e.jsx(Rt,{className:"h-4 w-4 opacity-60"})]}),a.children&&a.children.length>0&&e.jsx("div",{className:"ml-3 border-l pl-3 space-y-1",children:a.children.map(o=>e.jsxs(ti,{to:o.route??"/",onClick:r,className:({isActive:l})=>F("flex items-center rounded-md px-3 py-2 text-sm transition-colors hover:bg-accent hover:text-accent-foreground",l?"bg-accent text-accent-foreground":"text-muted-foreground"),children:[o.icon&&e.jsx("span",{className:"mr-3",children:o.icon}),o.label]},o.key))})]},a.key))})}),e.jsx(qa,{}),e.jsx(nf,{className:"border-b"}),e.jsx("div",{className:"p-4",children:e.jsxs(I,{variant:"outline",size:"sm",onClick:()=>{s(),t&&t()},className:"w-full justify-start",children:[e.jsx($a,{className:"mr-2 h-4 w-4"}),"Logout"]})})]})},Xw=({children:t})=>{const[s,n]=g.useState(!1),i=()=>{n(!s)};return e.jsx("div",{className:"min-h-screen bg-stone-200 relative overflow-x-hidden",children:e.jsxs("div",{className:"flex relative",children:[s&&e.jsx("div",{className:"fixed inset-0 z-40 bg-purple-900/20 backdrop-blur-sm lg:hidden",onClick:()=>n(!1)}),e.jsx("aside",{className:`
            h-screen w-64 transform transition-transform duration-300 ease-in-out
            fixed left-0 top-0 z-50
            ${s?"translate-x-0":"-translate-x-full"}
            lg:translate-x-0
            bg-background/95 backdrop-blur-md border-r border-purple-200/20
          `,children:e.jsx(Yw,{onClose:()=>n(!1)})}),e.jsxs("main",{className:"flex-1 lg:ml-64 min-w-0 relative z-10",children:[e.jsxs("div",{className:"sticky top-0 z-30 flex h-16 items-center border-b border-purple-200/20 bg-background/80 backdrop-blur-md px-4 lg:hidden",children:[e.jsx(I,{variant:"ghost",size:"sm",onClick:i,className:"mr-2 hover:bg-purple-100/20 hover:text-purple-700",children:e.jsx(vr,{className:"h-6 w-6"})}),e.jsx("span",{className:"font-semibold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:"Smart Up"})]}),t]})]})})},Jw=()=>{const{data:t,isLoading:s}=Le(),[n,i]=g.useState(null),[r,a]=g.useState(!0);return g.useEffect(()=>{if(s||!t?.vendor_id){a(!1);return}let o=!0;return(async()=>{try{const[c,d,m,u,h]=await Promise.all([Q.from("users").select("*",{count:"exact",head:!0}).eq("vendor_id",t.vendor_id),Q.from("courses").select("*",{count:"exact"}).eq("vendor_id",t.vendor_id),Q.from("activities").select("*, topics!inner(course_id, courses!inner(vendor_id))",{count:"exact"}).eq("topics.courses.vendor_id",t.vendor_id),Q.from("activity_progress").select("score, completed_at").not("completed_at","is",null),Q.from("user_stats").select("total_points")]);if(!o)return;const p=u.data?.length?u.data.reduce((x,b)=>x+(b.score||0),0)/u.data.length:0,j=h.data?.reduce((x,b)=>x+b.total_points,0)||0;i({totalUsers:c.count||0,activeUsers:c.count||0,totalCourses:d.count||0,publishedCourses:d.data?.filter(x=>x.is_published).length||0,totalActivities:m.count||0,completedActivities:u.data?.length||0,averageScore:Math.round(p),totalPoints:j})}catch(c){console.error("Error fetching dashboard stats:",c)}finally{o&&a(!1)}})(),()=>{o=!1}},[t?.vendor_id,s]),r||s?e.jsx(G,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):t?e.jsxs(G,{children:[e.jsx(ke,{title:"Dashboard",description:"Przegląd statystyk systemu e-learning"}),e.jsxs(rt,{variant:"1-2-2",children:[e.jsxs(M,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(O,{className:"text-sm font-medium",children:"Użytkownicy"}),e.jsx(oe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(R,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n?.totalUsers||0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[n?.activeUsers||0," aktywnych"]})]})]}),e.jsxs(M,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(O,{className:"text-sm font-medium",children:"Kursy"}),e.jsx(Se,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(R,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n?.totalCourses||0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[n?.publishedCourses||0," opublikowanych"]})]})]}),e.jsxs(M,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(O,{className:"text-sm font-medium",children:"Aktywności"}),e.jsx(kr,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(R,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n?.totalActivities||0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[n?.completedActivities||0," ukończonych"]})]})]}),e.jsxs(M,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(O,{className:"text-sm font-medium",children:"Średni wynik"}),e.jsx(Ee,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(R,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[n?.averageScore||0,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"z wszystkich quizów"})]})]})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Aktywność w ostatnich 7 dniach"})}),e.jsx(R,{children:e.jsxs("div",{className:"h-[300px] flex items-center justify-center text-muted-foreground",children:[e.jsx(st,{className:"h-8 w-8 mr-2"}),"Wykres aktywności (do implementacji)"]})})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Top 5 użytkowników"})}),e.jsx(R,{children:e.jsx("div",{className:"space-y-4",children:[1,2,3,4,5].map(o=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(De,{className:`h-5 w-5 ${o<=3?"text-yellow-500":"text-muted-foreground"}`}),e.jsxs("span",{children:["Użytkownik ",o]})]}),e.jsxs("span",{className:"font-semibold",children:[1e3-o*100," pkt"]})]},o))})})]})]}):e.jsx(G,{children:e.jsx("div",{className:"text-center text-muted-foreground",children:"Nie można załadować danych użytkownika"})})},e0=[e.jsx(V,{path:"/dashboard/overview",element:e.jsx(Jw,{})},"dashboard")];var dl=["Enter"," "],t0=["ArrowDown","PageUp","Home"],jf=["ArrowUp","PageDown","End"],s0=[...t0,...jf],n0={ltr:[...dl,"ArrowRight"],rtl:[...dl,"ArrowLeft"]},i0={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Sr="Menu",[ir,r0,a0]=xy(Sr),[Sn,yf]=Ql(Sr,[a0,Dh,Ph]),Qa=Dh(),bf=Ph(),[o0,Cn]=Sn(Sr),[l0,Cr]=Sn(Sr),wf=t=>{const{__scopeMenu:s,open:n=!1,children:i,dir:r,onOpenChange:a,modal:o=!0}=t,l=Qa(s),[c,d]=g.useState(null),m=g.useRef(!1),u=Rh(a),h=Ty(r);return g.useEffect(()=>{const p=()=>{m.current=!0,document.addEventListener("pointerdown",j,{capture:!0,once:!0}),document.addEventListener("pointermove",j,{capture:!0,once:!0})},j=()=>m.current=!1;return document.addEventListener("keydown",p,{capture:!0}),()=>{document.removeEventListener("keydown",p,{capture:!0}),document.removeEventListener("pointerdown",j,{capture:!0}),document.removeEventListener("pointermove",j,{capture:!0})}},[]),e.jsx(Ay,{...l,children:e.jsx(o0,{scope:s,open:n,onOpenChange:u,content:c,onContentChange:d,children:e.jsx(l0,{scope:s,onClose:g.useCallback(()=>u(!1),[u]),isUsingKeyboardRef:m,dir:h,modal:o,children:i})})})};wf.displayName=Sr;var c0="MenuAnchor",uc=g.forwardRef((t,s)=>{const{__scopeMenu:n,...i}=t,r=Qa(n);return e.jsx(jy,{...r,...i,ref:s})});uc.displayName=c0;var mc="MenuPortal",[d0,vf]=Sn(mc,{forceMount:void 0}),Nf=t=>{const{__scopeMenu:s,forceMount:n,children:i,container:r}=t,a=Cn(mc,s);return e.jsx(d0,{scope:s,forceMount:n,children:e.jsx(Da,{present:n||a.open,children:e.jsx(gy,{asChild:!0,container:r,children:i})})})};Nf.displayName=mc;var Tt="MenuContent",[u0,hc]=Sn(Tt),kf=g.forwardRef((t,s)=>{const n=vf(Tt,t.__scopeMenu),{forceMount:i=n.forceMount,...r}=t,a=Cn(Tt,t.__scopeMenu),o=Cr(Tt,t.__scopeMenu);return e.jsx(ir.Provider,{scope:t.__scopeMenu,children:e.jsx(Da,{present:i||a.open,children:e.jsx(ir.Slot,{scope:t.__scopeMenu,children:o.modal?e.jsx(m0,{...r,ref:s}):e.jsx(h0,{...r,ref:s})})})})}),m0=g.forwardRef((t,s)=>{const n=Cn(Tt,t.__scopeMenu),i=g.useRef(null),r=vn(s,i);return g.useEffect(()=>{const a=i.current;if(a)return Cy(a)},[]),e.jsx(fc,{...t,ref:r,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:fe(t.onFocusOutside,a=>a.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),h0=g.forwardRef((t,s)=>{const n=Cn(Tt,t.__scopeMenu);return e.jsx(fc,{...t,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),f0=vy("MenuContent.ScrollLock"),fc=g.forwardRef((t,s)=>{const{__scopeMenu:n,loop:i=!1,trapFocus:r,onOpenAutoFocus:a,onCloseAutoFocus:o,disableOutsidePointerEvents:l,onEntryFocus:c,onEscapeKeyDown:d,onPointerDownOutside:m,onFocusOutside:u,onInteractOutside:h,onDismiss:p,disableOutsideScroll:j,...x}=t,b=Cn(Tt,n),w=Cr(Tt,n),y=Qa(n),v=bf(n),_=r0(n),[C,k]=g.useState(null),N=g.useRef(null),z=vn(s,N,b.onContentChange),T=g.useRef(0),f=g.useRef(""),S=g.useRef(0),A=g.useRef(null),D=g.useRef("right"),P=g.useRef(0),L=j?wy:g.Fragment,K=j?{as:f0,allowPinchZoom:!0}:void 0,E=B=>{const ae=f.current+B,le=_().filter($e=>!$e.disabled),pe=document.activeElement,ft=le.find($e=>$e.ref.current===pe)?.textValue,It=le.map($e=>$e.textValue),_s=S0(It,ae,ft),Oe=le.find($e=>$e.textValue===_s)?.ref.current;(function $e(Et){f.current=Et,window.clearTimeout(T.current),Et!==""&&(T.current=window.setTimeout(()=>$e(""),1e3))})(ae),Oe&&setTimeout(()=>Oe.focus())};g.useEffect(()=>()=>window.clearTimeout(T.current),[]),by();const U=g.useCallback(B=>D.current===A.current?.side&&_0(B,A.current?.area),[]);return e.jsx(u0,{scope:n,searchRef:f,onItemEnter:g.useCallback(B=>{U(B)&&B.preventDefault()},[U]),onItemLeave:g.useCallback(B=>{U(B)||(N.current?.focus(),k(null))},[U]),onTriggerLeave:g.useCallback(B=>{U(B)&&B.preventDefault()},[U]),pointerGraceTimerRef:S,onPointerGraceIntentChange:g.useCallback(B=>{A.current=B},[]),children:e.jsx(L,{...K,children:e.jsx(Ny,{asChild:!0,trapped:r,onMountAutoFocus:fe(a,B=>{B.preventDefault(),N.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:e.jsx(ky,{asChild:!0,disableOutsidePointerEvents:l,onEscapeKeyDown:d,onPointerDownOutside:m,onFocusOutside:u,onInteractOutside:h,onDismiss:p,children:e.jsx(zy,{asChild:!0,...v,dir:w.dir,orientation:"vertical",loop:i,currentTabStopId:C,onCurrentTabStopIdChange:k,onEntryFocus:fe(c,B=>{w.isUsingKeyboardRef.current||B.preventDefault()}),preventScrollOnEntryFocus:!0,children:e.jsx(Sy,{role:"menu","aria-orientation":"vertical","data-state":Ff(b.open),"data-radix-menu-content":"",dir:w.dir,...y,...x,ref:z,style:{outline:"none",...x.style},onKeyDown:fe(x.onKeyDown,B=>{const le=B.target.closest("[data-radix-menu-content]")===B.currentTarget,pe=B.ctrlKey||B.altKey||B.metaKey,ft=B.key.length===1;le&&(B.key==="Tab"&&B.preventDefault(),!pe&&ft&&E(B.key));const It=N.current;if(B.target!==It||!s0.includes(B.key))return;B.preventDefault();const Oe=_().filter($e=>!$e.disabled).map($e=>$e.ref.current);jf.includes(B.key)&&Oe.reverse(),k0(Oe)}),onBlur:fe(t.onBlur,B=>{B.currentTarget.contains(B.target)||(window.clearTimeout(T.current),f.current="")}),onPointerMove:fe(t.onPointerMove,rr(B=>{const ae=B.target,le=P.current!==B.clientX;if(B.currentTarget.contains(ae)&&le){const pe=B.clientX>P.current?"right":"left";D.current=pe,P.current=B.clientX}}))})})})})})})});kf.displayName=Tt;var p0="MenuGroup",pc=g.forwardRef((t,s)=>{const{__scopeMenu:n,...i}=t;return e.jsx(Hs.div,{role:"group",...i,ref:s})});pc.displayName=p0;var x0="MenuLabel",zf=g.forwardRef((t,s)=>{const{__scopeMenu:n,...i}=t;return e.jsx(Hs.div,{...i,ref:s})});zf.displayName=x0;var pa="MenuItem",Hd="menu.itemSelect",Ya=g.forwardRef((t,s)=>{const{disabled:n=!1,onSelect:i,...r}=t,a=g.useRef(null),o=Cr(pa,t.__scopeMenu),l=hc(pa,t.__scopeMenu),c=vn(s,a),d=g.useRef(!1),m=()=>{const u=a.current;if(!n&&u){const h=new CustomEvent(Hd,{bubbles:!0,cancelable:!0});u.addEventListener(Hd,p=>i?.(p),{once:!0}),_y(u,h),h.defaultPrevented?d.current=!1:o.onClose()}};return e.jsx(Sf,{...r,ref:c,disabled:n,onClick:fe(t.onClick,m),onPointerDown:u=>{t.onPointerDown?.(u),d.current=!0},onPointerUp:fe(t.onPointerUp,u=>{d.current||u.currentTarget?.click()}),onKeyDown:fe(t.onKeyDown,u=>{const h=l.searchRef.current!=="";n||h&&u.key===" "||dl.includes(u.key)&&(u.currentTarget.click(),u.preventDefault())})})});Ya.displayName=pa;var Sf=g.forwardRef((t,s)=>{const{__scopeMenu:n,disabled:i=!1,textValue:r,...a}=t,o=hc(pa,n),l=bf(n),c=g.useRef(null),d=vn(s,c),[m,u]=g.useState(!1),[h,p]=g.useState("");return g.useEffect(()=>{const j=c.current;j&&p((j.textContent??"").trim())},[a.children]),e.jsx(ir.ItemSlot,{scope:n,disabled:i,textValue:r??h,children:e.jsx(yy,{asChild:!0,...l,focusable:!i,children:e.jsx(Hs.div,{role:"menuitem","data-highlighted":m?"":void 0,"aria-disabled":i||void 0,"data-disabled":i?"":void 0,...a,ref:d,onPointerMove:fe(t.onPointerMove,rr(j=>{i?o.onItemLeave(j):(o.onItemEnter(j),j.defaultPrevented||j.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:fe(t.onPointerLeave,rr(j=>o.onItemLeave(j))),onFocus:fe(t.onFocus,()=>u(!0)),onBlur:fe(t.onBlur,()=>u(!1))})})})}),g0="MenuCheckboxItem",Cf=g.forwardRef((t,s)=>{const{checked:n=!1,onCheckedChange:i,...r}=t;return e.jsx(Pf,{scope:t.__scopeMenu,checked:n,children:e.jsx(Ya,{role:"menuitemcheckbox","aria-checked":xa(n)?"mixed":n,...r,ref:s,"data-state":gc(n),onSelect:fe(r.onSelect,()=>i?.(xa(n)?!0:!n),{checkForDefaultPrevented:!1})})})});Cf.displayName=g0;var _f="MenuRadioGroup",[j0,y0]=Sn(_f,{value:void 0,onValueChange:()=>{}}),Tf=g.forwardRef((t,s)=>{const{value:n,onValueChange:i,...r}=t,a=Rh(i);return e.jsx(j0,{scope:t.__scopeMenu,value:n,onValueChange:a,children:e.jsx(pc,{...r,ref:s})})});Tf.displayName=_f;var Af="MenuRadioItem",Df=g.forwardRef((t,s)=>{const{value:n,...i}=t,r=y0(Af,t.__scopeMenu),a=n===r.value;return e.jsx(Pf,{scope:t.__scopeMenu,checked:a,children:e.jsx(Ya,{role:"menuitemradio","aria-checked":a,...i,ref:s,"data-state":gc(a),onSelect:fe(i.onSelect,()=>r.onValueChange?.(n),{checkForDefaultPrevented:!1})})})});Df.displayName=Af;var xc="MenuItemIndicator",[Pf,b0]=Sn(xc,{checked:!1}),Mf=g.forwardRef((t,s)=>{const{__scopeMenu:n,forceMount:i,...r}=t,a=b0(xc,n);return e.jsx(Da,{present:i||xa(a.checked)||a.checked===!0,children:e.jsx(Hs.span,{...r,ref:s,"data-state":gc(a.checked)})})});Mf.displayName=xc;var w0="MenuSeparator",Rf=g.forwardRef((t,s)=>{const{__scopeMenu:n,...i}=t;return e.jsx(Hs.div,{role:"separator","aria-orientation":"horizontal",...i,ref:s})});Rf.displayName=w0;var v0="MenuArrow",If=g.forwardRef((t,s)=>{const{__scopeMenu:n,...i}=t,r=Qa(n);return e.jsx(Dy,{...r,...i,ref:s})});If.displayName=v0;var N0="MenuSub",[CD,Ef]=Sn(N0),Fi="MenuSubTrigger",Lf=g.forwardRef((t,s)=>{const n=Cn(Fi,t.__scopeMenu),i=Cr(Fi,t.__scopeMenu),r=Ef(Fi,t.__scopeMenu),a=hc(Fi,t.__scopeMenu),o=g.useRef(null),{pointerGraceTimerRef:l,onPointerGraceIntentChange:c}=a,d={__scopeMenu:t.__scopeMenu},m=g.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return g.useEffect(()=>m,[m]),g.useEffect(()=>{const u=l.current;return()=>{window.clearTimeout(u),c(null)}},[l,c]),e.jsx(uc,{asChild:!0,...d,children:e.jsx(Sf,{id:r.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":r.contentId,"data-state":Ff(n.open),...t,ref:Mh(s,r.onTriggerChange),onClick:u=>{t.onClick?.(u),!(t.disabled||u.defaultPrevented)&&(u.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:fe(t.onPointerMove,rr(u=>{a.onItemEnter(u),!u.defaultPrevented&&!t.disabled&&!n.open&&!o.current&&(a.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{n.onOpenChange(!0),m()},100))})),onPointerLeave:fe(t.onPointerLeave,rr(u=>{m();const h=n.content?.getBoundingClientRect();if(h){const p=n.content?.dataset.side,j=p==="right",x=j?-5:5,b=h[j?"left":"right"],w=h[j?"right":"left"];a.onPointerGraceIntentChange({area:[{x:u.clientX+x,y:u.clientY},{x:b,y:h.top},{x:w,y:h.top},{x:w,y:h.bottom},{x:b,y:h.bottom}],side:p}),window.clearTimeout(l.current),l.current=window.setTimeout(()=>a.onPointerGraceIntentChange(null),300)}else{if(a.onTriggerLeave(u),u.defaultPrevented)return;a.onPointerGraceIntentChange(null)}})),onKeyDown:fe(t.onKeyDown,u=>{const h=a.searchRef.current!=="";t.disabled||h&&u.key===" "||n0[i.dir].includes(u.key)&&(n.onOpenChange(!0),n.content?.focus(),u.preventDefault())})})})});Lf.displayName=Fi;var Of="MenuSubContent",$f=g.forwardRef((t,s)=>{const n=vf(Tt,t.__scopeMenu),{forceMount:i=n.forceMount,...r}=t,a=Cn(Tt,t.__scopeMenu),o=Cr(Tt,t.__scopeMenu),l=Ef(Of,t.__scopeMenu),c=g.useRef(null),d=vn(s,c);return e.jsx(ir.Provider,{scope:t.__scopeMenu,children:e.jsx(Da,{present:i||a.open,children:e.jsx(ir.Slot,{scope:t.__scopeMenu,children:e.jsx(fc,{id:l.contentId,"aria-labelledby":l.triggerId,...r,ref:d,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:m=>{o.isUsingKeyboardRef.current&&c.current?.focus(),m.preventDefault()},onCloseAutoFocus:m=>m.preventDefault(),onFocusOutside:fe(t.onFocusOutside,m=>{m.target!==l.trigger&&a.onOpenChange(!1)}),onEscapeKeyDown:fe(t.onEscapeKeyDown,m=>{o.onClose(),m.preventDefault()}),onKeyDown:fe(t.onKeyDown,m=>{const u=m.currentTarget.contains(m.target),h=i0[o.dir].includes(m.key);u&&h&&(a.onOpenChange(!1),l.trigger?.focus(),m.preventDefault())})})})})})});$f.displayName=Of;function Ff(t){return t?"open":"closed"}function xa(t){return t==="indeterminate"}function gc(t){return xa(t)?"indeterminate":t?"checked":"unchecked"}function k0(t){const s=document.activeElement;for(const n of t)if(n===s||(n.focus(),document.activeElement!==s))return}function z0(t,s){return t.map((n,i)=>t[(s+i)%t.length])}function S0(t,s,n){const r=s.length>1&&Array.from(s).every(d=>d===s[0])?s[0]:s,a=n?t.indexOf(n):-1;let o=z0(t,Math.max(a,0));r.length===1&&(o=o.filter(d=>d!==n));const c=o.find(d=>d.toLowerCase().startsWith(r.toLowerCase()));return c!==n?c:void 0}function C0(t,s){const{x:n,y:i}=t;let r=!1;for(let a=0,o=s.length-1;a<s.length;o=a++){const l=s[a],c=s[o],d=l.x,m=l.y,u=c.x,h=c.y;m>i!=h>i&&n<(u-d)*(i-m)/(h-m)+d&&(r=!r)}return r}function _0(t,s){if(!s)return!1;const n={x:t.clientX,y:t.clientY};return C0(n,s)}function rr(t){return s=>s.pointerType==="mouse"?t(s):void 0}var T0=wf,A0=uc,D0=Nf,P0=kf,M0=pc,R0=zf,I0=Ya,E0=Cf,L0=Tf,O0=Df,$0=Mf,F0=Rf,B0=If,U0=Lf,V0=$f,Xa="DropdownMenu",[q0,_D]=Ql(Xa,[yf]),at=yf(),[K0,Bf]=q0(Xa),Uf=t=>{const{__scopeDropdownMenu:s,children:n,dir:i,open:r,defaultOpen:a,onOpenChange:o,modal:l=!0}=t,c=at(s),d=g.useRef(null),[m,u]=kh({prop:r,defaultProp:a??!1,onChange:o,caller:Xa});return e.jsx(K0,{scope:s,triggerId:Md(),triggerRef:d,contentId:Md(),open:m,onOpenChange:u,onOpenToggle:g.useCallback(()=>u(h=>!h),[u]),modal:l,children:e.jsx(T0,{...c,open:m,onOpenChange:u,dir:i,modal:l,children:n})})};Uf.displayName=Xa;var Vf="DropdownMenuTrigger",qf=g.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,disabled:i=!1,...r}=t,a=Bf(Vf,n),o=at(n);return e.jsx(A0,{asChild:!0,...o,children:e.jsx(Hs.button,{type:"button",id:a.triggerId,"aria-haspopup":"menu","aria-expanded":a.open,"aria-controls":a.open?a.contentId:void 0,"data-state":a.open?"open":"closed","data-disabled":i?"":void 0,disabled:i,...r,ref:Mh(s,a.triggerRef),onPointerDown:fe(t.onPointerDown,l=>{!i&&l.button===0&&l.ctrlKey===!1&&(a.onOpenToggle(),a.open||l.preventDefault())}),onKeyDown:fe(t.onKeyDown,l=>{i||(["Enter"," "].includes(l.key)&&a.onOpenToggle(),l.key==="ArrowDown"&&a.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(l.key)&&l.preventDefault())})})})});qf.displayName=Vf;var W0="DropdownMenuPortal",Kf=t=>{const{__scopeDropdownMenu:s,...n}=t,i=at(s);return e.jsx(D0,{...i,...n})};Kf.displayName=W0;var Wf="DropdownMenuContent",Gf=g.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=Bf(Wf,n),a=at(n),o=g.useRef(!1);return e.jsx(P0,{id:r.contentId,"aria-labelledby":r.triggerId,...a,...i,ref:s,onCloseAutoFocus:fe(t.onCloseAutoFocus,l=>{o.current||r.triggerRef.current?.focus(),o.current=!1,l.preventDefault()}),onInteractOutside:fe(t.onInteractOutside,l=>{const c=l.detail.originalEvent,d=c.button===0&&c.ctrlKey===!0,m=c.button===2||d;(!r.modal||m)&&(o.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Gf.displayName=Wf;var G0="DropdownMenuGroup",H0=g.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=at(n);return e.jsx(M0,{...r,...i,ref:s})});H0.displayName=G0;var Z0="DropdownMenuLabel",Hf=g.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=at(n);return e.jsx(R0,{...r,...i,ref:s})});Hf.displayName=Z0;var Q0="DropdownMenuItem",Zf=g.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=at(n);return e.jsx(I0,{...r,...i,ref:s})});Zf.displayName=Q0;var Y0="DropdownMenuCheckboxItem",Qf=g.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=at(n);return e.jsx(E0,{...r,...i,ref:s})});Qf.displayName=Y0;var X0="DropdownMenuRadioGroup",J0=g.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=at(n);return e.jsx(L0,{...r,...i,ref:s})});J0.displayName=X0;var ev="DropdownMenuRadioItem",Yf=g.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=at(n);return e.jsx(O0,{...r,...i,ref:s})});Yf.displayName=ev;var tv="DropdownMenuItemIndicator",Xf=g.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=at(n);return e.jsx($0,{...r,...i,ref:s})});Xf.displayName=tv;var sv="DropdownMenuSeparator",Jf=g.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=at(n);return e.jsx(F0,{...r,...i,ref:s})});Jf.displayName=sv;var nv="DropdownMenuArrow",iv=g.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=at(n);return e.jsx(B0,{...r,...i,ref:s})});iv.displayName=nv;var rv="DropdownMenuSubTrigger",ep=g.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=at(n);return e.jsx(U0,{...r,...i,ref:s})});ep.displayName=rv;var av="DropdownMenuSubContent",tp=g.forwardRef((t,s)=>{const{__scopeDropdownMenu:n,...i}=t,r=at(n);return e.jsx(V0,{...r,...i,ref:s,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});tp.displayName=av;var ov=Uf,lv=qf,cv=Kf,sp=Gf,np=Hf,ip=Zf,rp=Qf,ap=Yf,op=Xf,lp=Jf,cp=ep,dp=tp;const oi=ov,li=lv,dv=g.forwardRef(({className:t,inset:s,children:n,...i},r)=>e.jsxs(cp,{ref:r,className:F("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s&&"pl-8",t),...i,children:[n,e.jsx(jt,{className:"ml-auto"})]}));dv.displayName=cp.displayName;const uv=g.forwardRef(({className:t,...s},n)=>e.jsx(dp,{ref:n,className:F("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...s}));uv.displayName=dp.displayName;const jn=g.forwardRef(({className:t,sideOffset:s=4,...n},i)=>e.jsx(cv,{children:e.jsx(sp,{ref:i,sideOffset:s,className:F("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...n})}));jn.displayName=sp.displayName;const de=g.forwardRef(({className:t,inset:s,...n},i)=>e.jsx(ip,{ref:i,className:F("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",s&&"pl-8",t),...n}));de.displayName=ip.displayName;const mv=g.forwardRef(({className:t,children:s,checked:n,...i},r)=>e.jsxs(rp,{ref:r,className:F("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:n,...i,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(op,{children:e.jsx(Ge,{className:"h-4 w-4"})})}),s]}));mv.displayName=rp.displayName;const hv=g.forwardRef(({className:t,children:s,...n},i)=>e.jsxs(ap,{ref:i,className:F("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(op,{children:e.jsx(ea,{className:"h-2 w-2 fill-current"})})}),s]}));hv.displayName=ap.displayName;const up=g.forwardRef(({className:t,inset:s,...n},i)=>e.jsx(np,{ref:i,className:F("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",t),...n}));up.displayName=np.displayName;const it=g.forwardRef(({className:t,...s},n)=>e.jsx(lp,{ref:n,className:F("-mx-1 my-1 h-px bg-muted",t),...s}));it.displayName=lp.displayName;const fv=()=>{const t=me(),s=hi(),n=()=>{const o=`${s.pathname}${s.search}`;sessionStorage.setItem("returnUrl",o)};return{navigateWithReturn:o=>{n(),t(o)},goBack:o=>{const l=sessionStorage.getItem("returnUrl");l?(sessionStorage.removeItem("returnUrl"),t(l)):t(o||-1)},saveReturnUrl:n,navigateToWizard:(o,l)=>{l&&sessionStorage.setItem("wizardContext",JSON.stringify(l)),n(),t(o)},currentUrl:`${s.pathname}${s.search}`}},ul=t=>{const{mutate:s,isLoading:n}=pi();return{togglePublish:async(r,a,o,l)=>{s({resource:t,id:r,values:{is_published:!a}},{onSuccess:()=>{H.success(a?`${o} został ukryty`:`${o} został opublikowany`),l?.()},onError:c=>{H.error("Nie udało się zmienić statusu publikacji"),console.error("Publish toggle error:",c)}})},isToggling:n}},Zd=t=>{const{mutate:s}=pi(),n=Fh(),[i,r]=g.useState(!1);return{updatePosition:g.useCallback(async(o,l)=>{if(!i){r(!0);try{await new Promise((c,d)=>{s({resource:t,id:o,values:{position:l},mutationMode:"optimistic"},{onSuccess:()=>{console.log(`Updated position for ${t} ${o} to ${l}`),c()},onError:m=>d(m)})}),setTimeout(()=>{n({resource:t,invalidates:["list"]})},1e3)}catch(c){console.error("Position update error:",c),H.error("Nie udało się zaktualizować pozycji"),await n({resource:t,invalidates:["list"]})}finally{r(!1)}}},[t,s,n,i]),isUpdating:i}},pv=t=>{const{data:s,isLoading:n}=Ye({resource:"courses",id:t,queryOptions:{enabled:!!t}}),{data:i,isLoading:r,refetch:a}=Z({resource:"topics",filters:[{field:"course_id",operator:"eq",value:t}],sorters:[{field:"position",order:"asc"}],pagination:{mode:"off"},meta:{select:"*, activities(count)"},queryOptions:{enabled:!!t}}),{data:o,refetch:l}=Z({resource:"activities",filters:[{field:"topic_id",operator:"in",value:i?.data?.map(h=>h.id)||[]}],sorters:[{field:"position",order:"asc"}],pagination:{mode:"off"},meta:{select:"*, questions(count)"},queryOptions:{enabled:!!i?.data?.length}}),{data:c}=Z({resource:"course_access",filters:[{field:"course_id",operator:"eq",value:t}],queryOptions:{enabled:!!t}}),d=n||r,m={topicsCount:i?.total||0,activitiesCount:o?.total||0,accessCount:c?.total||0},u=h=>o?.data?.filter(p=>p.topic_id===h)||[];return{course:s?.data,topics:i?.data||[],activities:o?.data||[],stats:m,isLoading:d,refetchTopics:a,refetchActivities:l,getActivitiesForTopic:u}},xv=()=>{const{create:t,edit:s,show:n}=Xe(),{mutate:i}=pn(),{togglePublish:r}=ul("courses"),{data:a}=Le(),[o,l]=g.useState(""),{data:c,isLoading:d,isError:m,refetch:u}=Z({resource:"courses",pagination:{mode:"off"},sorters:[{field:"created_at",order:"desc"}]}),{data:h,isLoading:p}=Z({resource:"course_access",filters:a?.role==="teacher"?[{field:"teacher_id",operator:"eq",value:a?.id}]:[],pagination:{mode:"off"},queryOptions:{enabled:!!a?.id&&a?.role==="teacher"}}),{data:j}=Z({resource:"topics",pagination:{mode:"off"},meta:{select:"course_id"}}),{data:x}=Z({resource:"course_access",pagination:{mode:"off"},meta:{select:"course_id"}}),b=g.useMemo(()=>h?.data?.map(f=>f.course_id)||[],[h?.data]),w=g.useMemo(()=>{let f=c?.data||[];return a?.role==="teacher"&&(f=f.filter(S=>b.includes(S.id))),o&&(f=f.filter(S=>S.title.toLowerCase().includes(o.toLowerCase()))),f},[c?.data,b,a?.role,o]),y=f=>{const S=j?.data?.filter(D=>D.course_id===f).length||0,A=x?.data?.filter(D=>D.course_id===f).length||0;return{topicsCount:S,accessCount:A}},v=(f,S)=>{confirm(`Czy na pewno chcesz usunąć kurs "${S}"?`)&&i({resource:"courses",id:f},{onSuccess:()=>{H.success("Kurs został usunięty"),u()}})},_=(f,S,A)=>{S&&A&&sessionStorage.setItem("wizardContext",JSON.stringify({courseId:S,courseTitle:A})),window.location.href=f},C=d||a?.role==="teacher"&&p,N=oc({isLoading:C,isError:m});if(N)return N;const z=a?.role==="teacher",T=a?.role==="admin";return e.jsxs(G,{children:[e.jsxs(Y,{children:[e.jsx(ke,{title:"Moje kursy",description:T?"Zarządzaj wszystkimi kursami w systemie":"Kursy, które prowadzisz"}),T&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ps,{children:e.jsxs(xs,{children:[e.jsx(gs,{asChild:!0,children:e.jsxs(I,{variant:"outline",onClick:()=>_("/teacher/course-structure/step1"),children:[e.jsx(er,{className:"w-4 h-4 mr-2"}),e.jsx(Ct,{className:"w-3 h-3"})]})}),e.jsx(Ht,{children:e.jsx("p",{children:"Stwórz kurs z pomocą AI"})})]})}),e.jsxs(I,{onClick:()=>t("courses"),children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Dodaj kurs"]})]})]}),e.jsxs(Y,{children:[e.jsx(J,{placeholder:"Szukaj kursów...",className:"max-w-sm",value:o,onChange:f=>l(f.target.value)}),z&&e.jsx(q,{variant:"outline",children:"Pokazuję tylko kursy, które prowadzisz"})]}),e.jsx(rt,{children:w.map(f=>{const S=y(f.id);return e.jsxs(M,{className:`relative cursor-pointer transition-all duration-200 ${f.is_published?"hover:shadow-lg":"opacity-80 hover:opacity-90 "}`,onClick:A=>{A.target.closest('[role="menu"]')||n("courses",f.id)},children:[e.jsx($,{children:e.jsxs(Y,{children:[e.jsxs(O,{className:"flex items-center gap-2 min-w-0",children:[e.jsx("span",{className:"flex-shrink-0",children:f.icon_emoji?e.jsx("span",{className:"text-2xl",children:f.icon_emoji}):e.jsx(Se,{className:"w-5 h-5"})}),e.jsx(ps,{delayDuration:200,children:e.jsxs(xs,{children:[e.jsx(gs,{asChild:!0,children:e.jsx("span",{className:"truncate",children:f.title})}),f.title.length>30&&e.jsx(Ht,{children:e.jsx("p",{className:"max-w-xs",children:f.title})})]})})]}),e.jsxs(oi,{children:[e.jsx(li,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"sm",onClick:A=>A.stopPropagation(),children:e.jsx(Fa,{className:"h-4 w-4"})})}),e.jsxs(jn,{align:"end",children:[e.jsxs(de,{onClick:()=>n("courses",f.id),children:[e.jsx(_t,{className:"mr-2 h-4 w-4"}),"Podgląd"]}),T&&e.jsxs(e.Fragment,{children:[e.jsxs(de,{onClick:()=>s("courses",f.id),children:[e.jsx(ls,{className:"mr-2 h-4 w-4"}),"Edytuj"]}),e.jsx(it,{}),e.jsx(de,{onClick:()=>r(f.id,f.is_published,f.title,u),children:f.is_published?e.jsxs(e.Fragment,{children:[e.jsx(Ba,{className:"mr-2 h-4 w-4"}),"Ukryj kurs"]}):e.jsxs(e.Fragment,{children:[e.jsx(_t,{className:"mr-2 h-4 w-4"}),"Opublikuj kurs"]})})]}),e.jsx(it,{}),e.jsxs(de,{onClick:()=>_("/teacher/educational-material/step1",f.id,f.title),className:"text-purple-600 focus:text-purple-600",children:[e.jsx(Ct,{className:"mr-2 h-4 w-4"}),"Generuj materiał z AI"]}),e.jsxs(de,{onClick:()=>_("/teacher/quiz-wizard/step1",f.id,f.title),className:"text-blue-600 focus:text-blue-600",children:[e.jsx(Us,{className:"mr-2 h-4 w-4"}),"Generuj quiz z AI"]}),T&&e.jsxs(e.Fragment,{children:[e.jsx(it,{}),e.jsxs(de,{onClick:()=>v(f.id,f.title),className:"text-red-600 focus:text-red-600",children:[e.jsx(ns,{className:"mr-2 h-4 w-4"}),"Usuń"]})]})]})]})]})}),e.jsxs(R,{children:[f.description&&e.jsx("p",{className:"text-sm text-muted-foreground mb-3 line-clamp-2",children:f.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex gap-2",children:e.jsx(q,{variant:f.is_published?"default":"secondary",className:f.is_published?"bg-green-600":"",children:f.is_published?"Opublikowany":"Szkic"})}),e.jsxs("div",{className:"flex gap-3 text-sm text-muted-foreground",children:[e.jsx(ps,{children:e.jsxs(xs,{children:[e.jsx(gs,{asChild:!0,children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(is,{className:"w-3 h-3"}),S.topicsCount]})}),e.jsx(Ht,{children:e.jsx("p",{children:"Liczba tematów"})})]})}),e.jsx(ps,{children:e.jsxs(xs,{children:[e.jsx(gs,{asChild:!0,children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3"}),S.accessCount]})}),e.jsx(Ht,{children:e.jsx("p",{children:"Liczba przypisań"})})]})})]})]}),f.created_at&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-xs text-muted-foreground",children:[e.jsx(Ve,{className:"w-3 h-3"}),e.jsxs("span",{children:["Utworzono:"," ",new Date(f.created_at).toLocaleDateString("pl-PL")]})]})]})]},f.id)})}),w.length===0&&e.jsx(M,{className:"border-dashed border-2",children:e.jsx(R,{className:"text-center py-12",children:z?e.jsxs(e.Fragment,{children:[e.jsx(dt,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Nie prowadzisz jeszcze żadnych kursów"}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:"Administrator systemu tworzy kursy i przypisuje do nich nauczycieli. Skontaktuj się z administratorem, aby uzyskać dostęp do kursów, które będziesz prowadzić."}),e.jsx("div",{className:"flex gap-3 justify-center",children:e.jsxs(I,{variant:"outline",disabled:!0,children:[e.jsx(dt,{className:"w-4 h-4 mr-2"}),"Kursy tworzy administrator"]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(er,{className:"w-12 h-12 mx-auto mb-4 text-indigo-600"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Brak kursów"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Rozpocznij od stworzenia pierwszego kursu"}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsxs(I,{variant:"outline",onClick:()=>t("courses"),children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Dodaj ręcznie"]}),e.jsxs(I,{onClick:()=>_("/teacher/course-structure/step1"),className:"bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700",children:[e.jsx(Ct,{className:"w-4 h-4 mr-2"}),"Wygeneruj z AI"]})]})]})})})]})},Qs=({children:t,onSubmit:s,className:n="",...i})=>{const r="space-y-6",a=n?`${r} ${n}`:r;return e.jsx("form",{onSubmit:s,className:a,...i,children:t})},se=({children:t,label:s,htmlFor:n,error:i,required:r=!1,className:a="",hint:o})=>{const l="space-y-2",c=a?`${l} ${a}`:l,d=()=>s?typeof s=="string"?e.jsxs(nr,{htmlFor:n,children:[s,r&&e.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}):e.jsxs(nr,{htmlFor:n,className:"flex items-center",children:[s,r&&e.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}):null,m=g.isValidElement(t)?g.cloneElement(t,{className:`${t.props.className||""} ${i?"border-red-500 ring-1 ring-red-500":""}`.trim()}):t;return e.jsxs("div",{className:c,children:[d(),m,o&&!i&&e.jsx("p",{className:"text-sm text-muted-foreground",children:o}),i&&e.jsx("p",{className:"text-sm text-red-500",children:i})]})},Ys=({children:t,className:s=""})=>{const n="flex justify-end items-center gap-4 pt-6 border-t",i=s?`${n} ${s}`:n;return e.jsx("div",{className:i,children:t})},gv=["📚","🎓","💡","🚀","⭐","🏆","🎯","📖","✏️","🧮"],jv=()=>{const{list:t}=Xe(),{data:s}=Le(),[n,i]=g.useState(!1),{refineCore:{onFinish:r},register:a,handleSubmit:o,setValue:l,watch:c,formState:{errors:d,isSubmitting:m}}=Zs({defaultValues:{title:"",description:"",vendor_id:s?.vendor_id||0,is_published:!1,icon_emoji:"📚"}}),u=c("icon_emoji");return e.jsxs(G,{children:[e.jsxs(I,{variant:"outline",size:"sm",onClick:()=>t("courses"),children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsx(Y,{children:e.jsx(ke,{title:"Dodaj kurs",description:"Utwórz nowy kurs w systemie"})}),e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Informacje o kursie"})}),e.jsx(R,{children:e.jsxs(Qs,{onSubmit:o(r),children:[e.jsxs(rt,{variant:"1-2-2",children:[e.jsx(se,{label:"Tytuł kursu",htmlFor:"title",error:d.title?.message?.toString(),required:!0,children:e.jsx(J,{id:"title",placeholder:"np. Podstawy programowania",...a("title",{required:"Tytuł kursu jest wymagany",minLength:{value:3,message:"Tytuł musi mieć minimum 3 znaki"}})})}),e.jsx(se,{label:"Ikona kursu",htmlFor:"icon_emoji",children:e.jsxs("div",{className:"relative",children:[e.jsxs(I,{type:"button",variant:"outline",className:"w-full justify-start",onClick:()=>i(!n),children:[e.jsx("span",{className:"text-2xl mr-2",children:u||"📚"}),"Wybierz ikonę"]}),n&&e.jsx("div",{className:"absolute top-full mt-2 p-2 bg-white border rounded-lg shadow-lg z-10",children:e.jsx("div",{className:"grid grid-cols-5 gap-2",children:gv.map(h=>e.jsx("button",{type:"button",className:"p-2 hover:bg-gray-100 rounded text-2xl",onClick:()=>{l("icon_emoji",h),i(!1)},children:h},h))})})]})})]}),e.jsx(se,{label:"Opis kursu",htmlFor:"description",error:d.description?.message?.toString(),children:e.jsx(ks,{id:"description",placeholder:"Opisz czego uczniowie nauczą się na tym kursie...",rows:4,...a("description")})}),e.jsx(se,{label:"Status publikacji",children:e.jsxs(Y,{variant:"start",children:[e.jsx(Bt,{checked:c("is_published")||!1,onCheckedChange:h=>l("is_published",h)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Opublikuj kurs od razu (możesz to zmienić później)"})]})}),e.jsxs(Ys,{children:[e.jsx(I,{type:"button",variant:"outline",onClick:()=>t("courses"),children:"Anuluj"}),e.jsx(I,{type:"submit",disabled:m,children:m?"Tworzenie...":"Utwórz kurs"})]})]})})]})]})},yv=["📚","🎓","💡","🚀","⭐","🏆","🎯","📖","✏️","🧮"],bv=()=>{const{list:t}=Xe(),{id:s}=mt(),[n,i]=g.useState(!1),{data:r,isLoading:a}=Ye({resource:"courses",id:s,liveMode:"off"}),{refineCore:{onFinish:o},register:l,handleSubmit:c,setValue:d,watch:m,formState:{errors:u,isSubmitting:h}}=Zs({refineCoreProps:{resource:"courses",id:s,liveMode:"off"}}),p=m("icon_emoji");return a?e.jsx(G,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):e.jsxs(G,{children:[e.jsxs(I,{variant:"outline",size:"sm",onClick:()=>t("courses"),children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsx(Y,{children:e.jsx(ke,{title:"Edytuj kurs",description:`Edycja kursu: ${r?.data?.title}`})}),e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Informacje o kursie"})}),e.jsx(R,{children:e.jsxs(Qs,{onSubmit:c(o),children:[e.jsxs(rt,{variant:"1-2-2",children:[e.jsx(se,{label:"Tytuł kursu",htmlFor:"title",error:u.title?.message,required:!0,children:e.jsx(J,{id:"title",placeholder:"np. Podstawy programowania",...l("title",{required:"Tytuł kursu jest wymagany",minLength:{value:3,message:"Tytuł musi mieć minimum 3 znaki"}})})}),e.jsx(se,{label:"Ikona kursu",htmlFor:"icon_emoji",children:e.jsxs("div",{className:"relative",children:[e.jsxs(I,{type:"button",variant:"outline",className:"w-full justify-start",onClick:()=>i(!n),children:[e.jsx("span",{className:"text-2xl mr-2",children:p||"📚"}),"Wybierz ikonę"]}),n&&e.jsx("div",{className:"absolute top-full mt-2 p-2 bg-white border rounded-lg shadow-lg z-10",children:e.jsx("div",{className:"grid grid-cols-5 gap-2",children:yv.map(j=>e.jsx("button",{type:"button",className:"p-2 hover:bg-gray-100 rounded text-2xl",onClick:()=>{d("icon_emoji",j),i(!1)},children:j},j))})})]})})]}),e.jsx(se,{label:"Opis kursu",htmlFor:"description",error:u.description?.message,children:e.jsx(ks,{id:"description",placeholder:"Opisz czego uczniowie nauczą się na tym kursie...",rows:4,...l("description")})}),e.jsx(se,{label:"Status publikacji",children:e.jsxs(Y,{variant:"start",children:[e.jsx(Bt,{checked:m("is_published")||!1,onCheckedChange:j=>d("is_published",j)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Kurs jest opublikowany i widoczny dla uczniów"})]})}),e.jsxs(Ys,{children:[e.jsx(I,{type:"button",variant:"outline",onClick:()=>t("courses"),children:"Anuluj"}),e.jsx(I,{type:"submit",disabled:h,children:h?"Zapisywanie...":"Zapisz zmiany"})]})]})})]})]})},wv=({topic:t,isExpanded:s,onToggle:n,onDelete:i,onEdit:r,onTogglePublish:a,onNavigateToWizard:o,courseId:l,courseTitle:c,children:d,activitiesCount:m,dragHandleProps:u})=>{const h=me(),p=x=>{const b=window.location.pathname+window.location.search;sessionStorage.setItem("returnUrl",b),h(x)},j=(x,b)=>{o&&o(x,{courseId:l,courseTitle:c,topicId:t.id,topicTitle:t.title,...b})};return e.jsxs("div",{className:`border-2 rounded-lg overflow-hidden group ${s?"shadow-lg border-primary":"border-border hover:border-primary/50"}`,children:[e.jsx("div",{className:`p-4 ${s?"bg-primary text-primary-foreground":"bg-background hover:bg-muted"}`,children:e.jsxs(Y,{children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("button",{onClick:n,className:`p-1 rounded ${s?"text-primary-foreground hover:bg-primary-foreground/20":"hover:bg-muted"}`,"aria-label":s?"Zwiń temat":"Rozwiń temat",children:s?e.jsx(Rt,{className:"w-5 h-5"}):e.jsx(jt,{className:"w-5 h-5"})}),e.jsx("div",{className:"cursor-move",...u,children:e.jsx(qh,{className:`w-4 h-4 ${s?"text-primary-foreground/70":"text-muted-foreground"}`})}),e.jsxs("div",{className:"flex-1 cursor-pointer group",onClick:n,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h4",{className:`font-semibold text-base ${s?"text-primary-foreground":"group-hover:text-primary"}`,children:["Temat ",t.position,": ",t.title]}),e.jsx(q,{variant:t.is_published?s?"secondary":"default":"outline",className:s?"bg-primary-foreground/20 text-primary-foreground border-primary-foreground/30":"",children:t.is_published?"Opublikowany":"Szkic"})]}),e.jsx("div",{className:"flex items-center gap-4 mt-1",children:e.jsxs("span",{className:`text-sm flex items-center gap-1 ${s?"text-primary-foreground/80":"text-muted-foreground"}`,children:[e.jsx(is,{className:"w-3 h-3"}),m," ",m===1?"aktywność":"aktywności"]})})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(oi,{children:[e.jsx(li,{asChild:!0,children:e.jsx(I,{size:"sm",variant:s?"secondary":"ghost",title:"Dodaj aktywność",className:`h-8 w-8 p-0 ${s?"bg-primary-foreground/20 hover:bg-primary-foreground/30 text-primary-foreground":""}`,children:e.jsx(Re,{className:"h-4 w-4"})})}),e.jsxs(jn,{align:"end",children:[e.jsx(up,{children:"Dodaj treść"}),e.jsxs(de,{onClick:()=>p(`/activities/create?topic_id=${t.id}`),children:[e.jsx(Re,{className:"mr-2 h-4 w-4"}),"Dodaj ręcznie"]}),e.jsx(it,{}),e.jsxs(de,{onClick:()=>j("/teacher/educational-material/step1"),className:"text-purple-600 focus:text-purple-600",children:[e.jsx(Ct,{className:"mr-2 h-4 w-4"}),"Generuj materiał z AI"]}),e.jsxs(de,{onClick:()=>j("/teacher/quiz-wizard/step1"),className:"text-blue-600 focus:text-blue-600",children:[e.jsx(Us,{className:"mr-2 h-4 w-4"}),"Generuj quiz z AI"]})]})]}),e.jsxs(oi,{children:[e.jsx(li,{asChild:!0,children:e.jsx(I,{variant:s?"secondary":"ghost",size:"sm",className:`h-8 w-8 p-0 ${s?"bg-primary-foreground/20 hover:bg-primary-foreground/30 text-primary-foreground":""}`,children:e.jsx(Fa,{className:"h-4 w-4"})})}),e.jsxs(jn,{align:"end",children:[e.jsxs(de,{onClick:()=>r("teacher/topics",t.id),children:[e.jsx(ls,{className:"mr-2 h-4 w-4"}),"Edytuj temat"]}),e.jsx(it,{}),e.jsx(de,{onClick:()=>a(t.id,t.is_published,t.title),children:t.is_published?e.jsxs(e.Fragment,{children:[e.jsx(Ba,{className:"mr-2 h-4 w-4"}),"Ukryj temat"]}):e.jsxs(e.Fragment,{children:[e.jsx(_t,{className:"mr-2 h-4 w-4"}),"Opublikuj temat"]})}),e.jsx(it,{}),e.jsxs(de,{onClick:()=>i(t.id,t.title),className:"text-red-600 focus:text-red-600",children:[e.jsx(ns,{className:"mr-2 h-4 w-4"}),"Usuń temat"]})]})]})]})]})}),s&&e.jsx("div",{className:"p-4 bg-muted/20 border-t-2 border-primary",children:e.jsx("div",{className:"space-y-2",children:d})})]})},vv=({activity:t,topicPosition:s,onDelete:n,onEdit:i,onTogglePublish:r,dragHandleProps:a})=>{const o=me(),l=()=>t.type==="quiz"?e.jsx("div",{className:"p-2 bg-blue-600 rounded-lg",children:e.jsx(vt,{className:"w-5 h-5 text-white"})}):e.jsx("div",{className:"p-2 bg-green-600 rounded-lg",children:e.jsx(is,{className:"w-5 h-5 text-white"})}),c=()=>t.type==="quiz"?"Quiz":"Materiał";return e.jsxs("div",{className:"group flex items-center gap-4 p-4 bg-white border-2 rounded-lg hover:border-primary/50 transition-all duration-200",children:[e.jsx("div",{className:"cursor-move opacity-0 group-hover:opacity-100 transition-opacity",...a,children:e.jsx(qh,{className:"w-4 h-4 text-muted-foreground"})}),l(),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("h5",{className:"font-semibold text-sm text-foreground",children:[s,".",t.position," ",t.title]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{variant:t.type==="quiz"?"default":"secondary",className:"text-xs font-medium",children:c()}),t.type==="quiz"&&t._count?.questions!==void 0&&e.jsxs(q,{variant:"outline",className:"text-xs font-medium border-2",children:[e.jsx(dn,{className:"w-3 h-3 mr-1"}),t._count.questions," ",t._count.questions===1?"pytanie":"pytań"]}),e.jsx(q,{variant:t.is_published?"default":"outline",className:`text-xs font-medium ${t.is_published?"bg-green-600 hover:bg-green-700":"border-2"}`,children:t.is_published?e.jsxs(e.Fragment,{children:[e.jsx(nb,{className:"w-3 h-3 mr-1"}),"Opublikowany"]}):"Szkic"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-muted-foreground",children:[t.duration_min&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ve,{className:"w-3 h-3"}),e.jsxs("span",{children:[t.duration_min," min"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3"}),e.jsx("span",{children:"0 ukończeń"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[t.type==="quiz"&&e.jsx(I,{size:"sm",variant:"ghost",onClick:()=>o(`/teacher/questions/manage/${t.id}`),title:"Zarządzaj pytaniami",className:"h-8 w-8 p-0",children:e.jsx(dn,{className:"h-4 w-4"})}),e.jsx(I,{size:"sm",variant:"ghost",onClick:()=>o(`/teacher/activities/show/${t.id}`),title:"Podgląd",className:"h-8 w-8 p-0",children:e.jsx(_t,{className:"h-4 w-4"})}),e.jsxs(oi,{children:[e.jsx(li,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(Fa,{className:"h-4 w-4"})})}),e.jsxs(jn,{align:"end",children:[e.jsxs(de,{onClick:()=>o(`/teacher/activities/show/${t.id}`),children:[e.jsx(_t,{className:"mr-2 h-4 w-4"}),"Podgląd"]}),e.jsxs(de,{onClick:()=>i("teacher/activities",t.id),children:[e.jsx(ls,{className:"mr-2 h-4 w-4"}),"Edytuj"]}),e.jsx(it,{}),e.jsx(de,{onClick:()=>r(t.id,t.is_published,t.title),children:t.is_published?e.jsxs(e.Fragment,{children:[e.jsx(Ba,{className:"mr-2 h-4 w-4"}),"Ukryj aktywność"]}):e.jsxs(e.Fragment,{children:[e.jsx(_t,{className:"mr-2 h-4 w-4"}),"Opublikuj aktywność"]})}),t.type==="quiz"&&e.jsxs(e.Fragment,{children:[e.jsx(it,{}),e.jsxs(de,{onClick:()=>o(`/teacher/questions/manage/${t.id}`),className:"text-blue-600 focus:text-blue-600",children:[e.jsx(dn,{className:"mr-2 h-4 w-4"}),"Zarządzaj pytaniami"]}),e.jsxs(de,{onClick:()=>o(`/teacher/questions/create?activity_id=${t.id}`),className:"text-blue-600 focus:text-blue-600",children:[e.jsx(Re,{className:"mr-2 h-4 w-4"}),"Dodaj pytanie"]})]}),e.jsx(it,{}),e.jsxs(de,{onClick:()=>n(t.id,t.title),className:"text-red-600 focus:text-red-600",children:[e.jsx(ns,{className:"mr-2 h-4 w-4"}),"Usuń"]})]})]})]})]})},Nv=({course:t})=>t?e.jsx(M,{className:"flex-1",children:e.jsx(R,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[t.icon_emoji&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-3xl",children:t.icon_emoji})})}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold",children:t.title}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:t.is_published?"Opublikowany":"Szkic"}),t.created_at&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Utworzony: ",new Date(t.created_at).toLocaleDateString("pl-PL")]})]})]}),t.description&&e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsx("p",{className:"text-muted-foreground leading-relaxed whitespace-pre-wrap",children:t.description})})]})]})})}):null;function kv(){for(var t=arguments.length,s=new Array(t),n=0;n<t;n++)s[n]=arguments[n];return g.useMemo(()=>i=>{s.forEach(r=>r(i))},s)}const Ja=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function xi(t){const s=Object.prototype.toString.call(t);return s==="[object Window]"||s==="[object global]"}function jc(t){return"nodeType"in t}function ht(t){var s,n;return t?xi(t)?t:jc(t)&&(s=(n=t.ownerDocument)==null?void 0:n.defaultView)!=null?s:window:window}function yc(t){const{Document:s}=ht(t);return t instanceof s}function _r(t){return xi(t)?!1:t instanceof ht(t).HTMLElement}function mp(t){return t instanceof ht(t).SVGElement}function gi(t){return t?xi(t)?t.document:jc(t)?yc(t)?t:_r(t)||mp(t)?t.ownerDocument:document:document:document}const as=Ja?g.useLayoutEffect:g.useEffect;function bc(t){const s=g.useRef(t);return as(()=>{s.current=t}),g.useCallback(function(){for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return s.current==null?void 0:s.current(...i)},[])}function zv(){const t=g.useRef(null),s=g.useCallback((i,r)=>{t.current=setInterval(i,r)},[]),n=g.useCallback(()=>{t.current!==null&&(clearInterval(t.current),t.current=null)},[]);return[s,n]}function ar(t,s){s===void 0&&(s=[t]);const n=g.useRef(t);return as(()=>{n.current!==t&&(n.current=t)},s),n}function Tr(t,s){const n=g.useRef();return g.useMemo(()=>{const i=t(n.current);return n.current=i,i},[...s])}function ga(t){const s=bc(t),n=g.useRef(null),i=g.useCallback(r=>{r!==n.current&&s?.(r,n.current),n.current=r},[]);return[n,i]}function ml(t){const s=g.useRef();return g.useEffect(()=>{s.current=t},[t]),s.current}let To={};function Ar(t,s){return g.useMemo(()=>{if(s)return s;const n=To[t]==null?0:To[t]+1;return To[t]=n,t+"-"+n},[t,s])}function hp(t){return function(s){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return i.reduce((a,o)=>{const l=Object.entries(o);for(const[c,d]of l){const m=a[c];m!=null&&(a[c]=m+t*d)}return a},{...s})}}const Yn=hp(1),or=hp(-1);function Sv(t){return"clientX"in t&&"clientY"in t}function wc(t){if(!t)return!1;const{KeyboardEvent:s}=ht(t.target);return s&&t instanceof s}function Cv(t){if(!t)return!1;const{TouchEvent:s}=ht(t.target);return s&&t instanceof s}function hl(t){if(Cv(t)){if(t.touches&&t.touches.length){const{clientX:s,clientY:n}=t.touches[0];return{x:s,y:n}}else if(t.changedTouches&&t.changedTouches.length){const{clientX:s,clientY:n}=t.changedTouches[0];return{x:s,y:n}}}return Sv(t)?{x:t.clientX,y:t.clientY}:null}const lr=Object.freeze({Translate:{toString(t){if(!t)return;const{x:s,y:n}=t;return"translate3d("+(s?Math.round(s):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(t){if(!t)return;const{scaleX:s,scaleY:n}=t;return"scaleX("+s+") scaleY("+n+")"}},Transform:{toString(t){if(t)return[lr.Translate.toString(t),lr.Scale.toString(t)].join(" ")}},Transition:{toString(t){let{property:s,duration:n,easing:i}=t;return s+" "+n+"ms "+i}}}),Qd="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function _v(t){return t.matches(Qd)?t:t.querySelector(Qd)}const Tv={display:"none"};function Av(t){let{id:s,value:n}=t;return ee.createElement("div",{id:s,style:Tv},n)}function Dv(t){let{id:s,announcement:n,ariaLiveType:i="assertive"}=t;const r={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return ee.createElement("div",{id:s,style:r,role:"status","aria-live":i,"aria-atomic":!0},n)}function Pv(){const[t,s]=g.useState("");return{announce:g.useCallback(i=>{i!=null&&s(i)},[]),announcement:t}}const fp=g.createContext(null);function Mv(t){const s=g.useContext(fp);g.useEffect(()=>{if(!s)throw new Error("useDndMonitor must be used within a children of <DndContext>");return s(t)},[t,s])}function Rv(){const[t]=g.useState(()=>new Set),s=g.useCallback(i=>(t.add(i),()=>t.delete(i)),[t]);return[g.useCallback(i=>{let{type:r,event:a}=i;t.forEach(o=>{var l;return(l=o[r])==null?void 0:l.call(o,a)})},[t]),s]}const Iv={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},Ev={onDragStart(t){let{active:s}=t;return"Picked up draggable item "+s.id+"."},onDragOver(t){let{active:s,over:n}=t;return n?"Draggable item "+s.id+" was moved over droppable area "+n.id+".":"Draggable item "+s.id+" is no longer over a droppable area."},onDragEnd(t){let{active:s,over:n}=t;return n?"Draggable item "+s.id+" was dropped over droppable area "+n.id:"Draggable item "+s.id+" was dropped."},onDragCancel(t){let{active:s}=t;return"Dragging was cancelled. Draggable item "+s.id+" was dropped."}};function Lv(t){let{announcements:s=Ev,container:n,hiddenTextDescribedById:i,screenReaderInstructions:r=Iv}=t;const{announce:a,announcement:o}=Pv(),l=Ar("DndLiveRegion"),[c,d]=g.useState(!1);if(g.useEffect(()=>{d(!0)},[]),Mv(g.useMemo(()=>({onDragStart(u){let{active:h}=u;a(s.onDragStart({active:h}))},onDragMove(u){let{active:h,over:p}=u;s.onDragMove&&a(s.onDragMove({active:h,over:p}))},onDragOver(u){let{active:h,over:p}=u;a(s.onDragOver({active:h,over:p}))},onDragEnd(u){let{active:h,over:p}=u;a(s.onDragEnd({active:h,over:p}))},onDragCancel(u){let{active:h,over:p}=u;a(s.onDragCancel({active:h,over:p}))}}),[a,s])),!c)return null;const m=ee.createElement(ee.Fragment,null,ee.createElement(Av,{id:i,value:r.draggable}),ee.createElement(Dv,{id:l,announcement:o}));return n?Oi.createPortal(m,n):m}var Ie;(function(t){t.DragStart="dragStart",t.DragMove="dragMove",t.DragEnd="dragEnd",t.DragCancel="dragCancel",t.DragOver="dragOver",t.RegisterDroppable="registerDroppable",t.SetDroppableDisabled="setDroppableDisabled",t.UnregisterDroppable="unregisterDroppable"})(Ie||(Ie={}));function ja(){}function Yd(t,s){return g.useMemo(()=>({sensor:t,options:s??{}}),[t,s])}function Ov(){for(var t=arguments.length,s=new Array(t),n=0;n<t;n++)s[n]=arguments[n];return g.useMemo(()=>[...s].filter(i=>i!=null),[...s])}const Ft=Object.freeze({x:0,y:0});function pp(t,s){return Math.sqrt(Math.pow(t.x-s.x,2)+Math.pow(t.y-s.y,2))}function xp(t,s){let{data:{value:n}}=t,{data:{value:i}}=s;return n-i}function $v(t,s){let{data:{value:n}}=t,{data:{value:i}}=s;return i-n}function Xd(t){let{left:s,top:n,height:i,width:r}=t;return[{x:s,y:n},{x:s+r,y:n},{x:s,y:n+i},{x:s+r,y:n+i}]}function gp(t,s){if(!t||t.length===0)return null;const[n]=t;return n[s]}function Jd(t,s,n){return s===void 0&&(s=t.left),n===void 0&&(n=t.top),{x:s+t.width*.5,y:n+t.height*.5}}const Fv=t=>{let{collisionRect:s,droppableRects:n,droppableContainers:i}=t;const r=Jd(s,s.left,s.top),a=[];for(const o of i){const{id:l}=o,c=n.get(l);if(c){const d=pp(Jd(c),r);a.push({id:l,data:{droppableContainer:o,value:d}})}}return a.sort(xp)},Bv=t=>{let{collisionRect:s,droppableRects:n,droppableContainers:i}=t;const r=Xd(s),a=[];for(const o of i){const{id:l}=o,c=n.get(l);if(c){const d=Xd(c),m=r.reduce((h,p,j)=>h+pp(d[j],p),0),u=Number((m/4).toFixed(4));a.push({id:l,data:{droppableContainer:o,value:u}})}}return a.sort(xp)};function Uv(t,s){const n=Math.max(s.top,t.top),i=Math.max(s.left,t.left),r=Math.min(s.left+s.width,t.left+t.width),a=Math.min(s.top+s.height,t.top+t.height),o=r-i,l=a-n;if(i<r&&n<a){const c=s.width*s.height,d=t.width*t.height,m=o*l,u=m/(c+d-m);return Number(u.toFixed(4))}return 0}const Vv=t=>{let{collisionRect:s,droppableRects:n,droppableContainers:i}=t;const r=[];for(const a of i){const{id:o}=a,l=n.get(o);if(l){const c=Uv(l,s);c>0&&r.push({id:o,data:{droppableContainer:a,value:c}})}}return r.sort($v)};function qv(t,s,n){return{...t,scaleX:s&&n?s.width/n.width:1,scaleY:s&&n?s.height/n.height:1}}function jp(t,s){return t&&s?{x:t.left-s.left,y:t.top-s.top}:Ft}function Kv(t){return function(n){for(var i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];return r.reduce((o,l)=>({...o,top:o.top+t*l.y,bottom:o.bottom+t*l.y,left:o.left+t*l.x,right:o.right+t*l.x}),{...n})}}const Wv=Kv(1);function Gv(t){if(t.startsWith("matrix3d(")){const s=t.slice(9,-1).split(/, /);return{x:+s[12],y:+s[13],scaleX:+s[0],scaleY:+s[5]}}else if(t.startsWith("matrix(")){const s=t.slice(7,-1).split(/, /);return{x:+s[4],y:+s[5],scaleX:+s[0],scaleY:+s[3]}}return null}function Hv(t,s,n){const i=Gv(s);if(!i)return t;const{scaleX:r,scaleY:a,x:o,y:l}=i,c=t.left-o-(1-r)*parseFloat(n),d=t.top-l-(1-a)*parseFloat(n.slice(n.indexOf(" ")+1)),m=r?t.width/r:t.width,u=a?t.height/a:t.height;return{width:m,height:u,top:d,right:c+m,bottom:d+u,left:c}}const Zv={ignoreTransform:!1};function ji(t,s){s===void 0&&(s=Zv);let n=t.getBoundingClientRect();if(s.ignoreTransform){const{transform:d,transformOrigin:m}=ht(t).getComputedStyle(t);d&&(n=Hv(n,d,m))}const{top:i,left:r,width:a,height:o,bottom:l,right:c}=n;return{top:i,left:r,width:a,height:o,bottom:l,right:c}}function eu(t){return ji(t,{ignoreTransform:!0})}function Qv(t){const s=t.innerWidth,n=t.innerHeight;return{top:0,left:0,right:s,bottom:n,width:s,height:n}}function Yv(t,s){return s===void 0&&(s=ht(t).getComputedStyle(t)),s.position==="fixed"}function Xv(t,s){s===void 0&&(s=ht(t).getComputedStyle(t));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(r=>{const a=s[r];return typeof a=="string"?n.test(a):!1})}function eo(t,s){const n=[];function i(r){if(s!=null&&n.length>=s||!r)return n;if(yc(r)&&r.scrollingElement!=null&&!n.includes(r.scrollingElement))return n.push(r.scrollingElement),n;if(!_r(r)||mp(r)||n.includes(r))return n;const a=ht(t).getComputedStyle(r);return r!==t&&Xv(r,a)&&n.push(r),Yv(r,a)?n:i(r.parentNode)}return t?i(t):n}function yp(t){const[s]=eo(t,1);return s??null}function Ao(t){return!Ja||!t?null:xi(t)?t:jc(t)?yc(t)||t===gi(t).scrollingElement?window:_r(t)?t:null:null}function bp(t){return xi(t)?t.scrollX:t.scrollLeft}function wp(t){return xi(t)?t.scrollY:t.scrollTop}function fl(t){return{x:bp(t),y:wp(t)}}var Be;(function(t){t[t.Forward=1]="Forward",t[t.Backward=-1]="Backward"})(Be||(Be={}));function vp(t){return!Ja||!t?!1:t===document.scrollingElement}function Np(t){const s={x:0,y:0},n=vp(t)?{height:window.innerHeight,width:window.innerWidth}:{height:t.clientHeight,width:t.clientWidth},i={x:t.scrollWidth-n.width,y:t.scrollHeight-n.height},r=t.scrollTop<=s.y,a=t.scrollLeft<=s.x,o=t.scrollTop>=i.y,l=t.scrollLeft>=i.x;return{isTop:r,isLeft:a,isBottom:o,isRight:l,maxScroll:i,minScroll:s}}const Jv={x:.2,y:.2};function eN(t,s,n,i,r){let{top:a,left:o,right:l,bottom:c}=n;i===void 0&&(i=10),r===void 0&&(r=Jv);const{isTop:d,isBottom:m,isLeft:u,isRight:h}=Np(t),p={x:0,y:0},j={x:0,y:0},x={height:s.height*r.y,width:s.width*r.x};return!d&&a<=s.top+x.height?(p.y=Be.Backward,j.y=i*Math.abs((s.top+x.height-a)/x.height)):!m&&c>=s.bottom-x.height&&(p.y=Be.Forward,j.y=i*Math.abs((s.bottom-x.height-c)/x.height)),!h&&l>=s.right-x.width?(p.x=Be.Forward,j.x=i*Math.abs((s.right-x.width-l)/x.width)):!u&&o<=s.left+x.width&&(p.x=Be.Backward,j.x=i*Math.abs((s.left+x.width-o)/x.width)),{direction:p,speed:j}}function tN(t){if(t===document.scrollingElement){const{innerWidth:a,innerHeight:o}=window;return{top:0,left:0,right:a,bottom:o,width:a,height:o}}const{top:s,left:n,right:i,bottom:r}=t.getBoundingClientRect();return{top:s,left:n,right:i,bottom:r,width:t.clientWidth,height:t.clientHeight}}function kp(t){return t.reduce((s,n)=>Yn(s,fl(n)),Ft)}function sN(t){return t.reduce((s,n)=>s+bp(n),0)}function nN(t){return t.reduce((s,n)=>s+wp(n),0)}function iN(t,s){if(s===void 0&&(s=ji),!t)return;const{top:n,left:i,bottom:r,right:a}=s(t);yp(t)&&(r<=0||a<=0||n>=window.innerHeight||i>=window.innerWidth)&&t.scrollIntoView({block:"center",inline:"center"})}const rN=[["x",["left","right"],sN],["y",["top","bottom"],nN]];class vc{constructor(s,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const i=eo(n),r=kp(i);this.rect={...s},this.width=s.width,this.height=s.height;for(const[a,o,l]of rN)for(const c of o)Object.defineProperty(this,c,{get:()=>{const d=l(i),m=r[a]-d;return this.rect[c]+m},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Vi{constructor(s){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var i;return(i=this.target)==null?void 0:i.removeEventListener(...n)})},this.target=s}add(s,n,i){var r;(r=this.target)==null||r.addEventListener(s,n,i),this.listeners.push([s,n,i])}}function aN(t){const{EventTarget:s}=ht(t);return t instanceof s?t:gi(t)}function Do(t,s){const n=Math.abs(t.x),i=Math.abs(t.y);return typeof s=="number"?Math.sqrt(n**2+i**2)>s:"x"in s&&"y"in s?n>s.x&&i>s.y:"x"in s?n>s.x:"y"in s?i>s.y:!1}var St;(function(t){t.Click="click",t.DragStart="dragstart",t.Keydown="keydown",t.ContextMenu="contextmenu",t.Resize="resize",t.SelectionChange="selectionchange",t.VisibilityChange="visibilitychange"})(St||(St={}));function tu(t){t.preventDefault()}function oN(t){t.stopPropagation()}var ne;(function(t){t.Space="Space",t.Down="ArrowDown",t.Right="ArrowRight",t.Left="ArrowLeft",t.Up="ArrowUp",t.Esc="Escape",t.Enter="Enter",t.Tab="Tab"})(ne||(ne={}));const zp={start:[ne.Space,ne.Enter],cancel:[ne.Esc],end:[ne.Space,ne.Enter,ne.Tab]},lN=(t,s)=>{let{currentCoordinates:n}=s;switch(t.code){case ne.Right:return{...n,x:n.x+25};case ne.Left:return{...n,x:n.x-25};case ne.Down:return{...n,y:n.y+25};case ne.Up:return{...n,y:n.y-25}}};class Nc{constructor(s){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=s;const{event:{target:n}}=s;this.props=s,this.listeners=new Vi(gi(n)),this.windowListeners=new Vi(ht(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(St.Resize,this.handleCancel),this.windowListeners.add(St.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(St.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:s,onStart:n}=this.props,i=s.node.current;i&&iN(i),n(Ft)}handleKeyDown(s){if(wc(s)){const{active:n,context:i,options:r}=this.props,{keyboardCodes:a=zp,coordinateGetter:o=lN,scrollBehavior:l="smooth"}=r,{code:c}=s;if(a.end.includes(c)){this.handleEnd(s);return}if(a.cancel.includes(c)){this.handleCancel(s);return}const{collisionRect:d}=i.current,m=d?{x:d.left,y:d.top}:Ft;this.referenceCoordinates||(this.referenceCoordinates=m);const u=o(s,{active:n,context:i.current,currentCoordinates:m});if(u){const h=or(u,m),p={x:0,y:0},{scrollableAncestors:j}=i.current;for(const x of j){const b=s.code,{isTop:w,isRight:y,isLeft:v,isBottom:_,maxScroll:C,minScroll:k}=Np(x),N=tN(x),z={x:Math.min(b===ne.Right?N.right-N.width/2:N.right,Math.max(b===ne.Right?N.left:N.left+N.width/2,u.x)),y:Math.min(b===ne.Down?N.bottom-N.height/2:N.bottom,Math.max(b===ne.Down?N.top:N.top+N.height/2,u.y))},T=b===ne.Right&&!y||b===ne.Left&&!v,f=b===ne.Down&&!_||b===ne.Up&&!w;if(T&&z.x!==u.x){const S=x.scrollLeft+h.x,A=b===ne.Right&&S<=C.x||b===ne.Left&&S>=k.x;if(A&&!h.y){x.scrollTo({left:S,behavior:l});return}A?p.x=x.scrollLeft-S:p.x=b===ne.Right?x.scrollLeft-C.x:x.scrollLeft-k.x,p.x&&x.scrollBy({left:-p.x,behavior:l});break}else if(f&&z.y!==u.y){const S=x.scrollTop+h.y,A=b===ne.Down&&S<=C.y||b===ne.Up&&S>=k.y;if(A&&!h.x){x.scrollTo({top:S,behavior:l});return}A?p.y=x.scrollTop-S:p.y=b===ne.Down?x.scrollTop-C.y:x.scrollTop-k.y,p.y&&x.scrollBy({top:-p.y,behavior:l});break}}this.handleMove(s,Yn(or(u,this.referenceCoordinates),p))}}}handleMove(s,n){const{onMove:i}=this.props;s.preventDefault(),i(n)}handleEnd(s){const{onEnd:n}=this.props;s.preventDefault(),this.detach(),n()}handleCancel(s){const{onCancel:n}=this.props;s.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Nc.activators=[{eventName:"onKeyDown",handler:(t,s,n)=>{let{keyboardCodes:i=zp,onActivation:r}=s,{active:a}=n;const{code:o}=t.nativeEvent;if(i.start.includes(o)){const l=a.activatorNode.current;return l&&t.target!==l?!1:(t.preventDefault(),r?.({event:t.nativeEvent}),!0)}return!1}}];function su(t){return!!(t&&"distance"in t)}function nu(t){return!!(t&&"delay"in t)}class kc{constructor(s,n,i){var r;i===void 0&&(i=aN(s.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=s,this.events=n;const{event:a}=s,{target:o}=a;this.props=s,this.events=n,this.document=gi(o),this.documentListeners=new Vi(this.document),this.listeners=new Vi(i),this.windowListeners=new Vi(ht(o)),this.initialCoordinates=(r=hl(a))!=null?r:Ft,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:s,props:{options:{activationConstraint:n,bypassActivationConstraint:i}}}=this;if(this.listeners.add(s.move.name,this.handleMove,{passive:!1}),this.listeners.add(s.end.name,this.handleEnd),s.cancel&&this.listeners.add(s.cancel.name,this.handleCancel),this.windowListeners.add(St.Resize,this.handleCancel),this.windowListeners.add(St.DragStart,tu),this.windowListeners.add(St.VisibilityChange,this.handleCancel),this.windowListeners.add(St.ContextMenu,tu),this.documentListeners.add(St.Keydown,this.handleKeydown),n){if(i!=null&&i({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(nu(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(su(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(s,n){const{active:i,onPending:r}=this.props;r(i,s,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:s}=this,{onStart:n}=this.props;s&&(this.activated=!0,this.documentListeners.add(St.Click,oN,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(St.SelectionChange,this.removeTextSelection),n(s))}handleMove(s){var n;const{activated:i,initialCoordinates:r,props:a}=this,{onMove:o,options:{activationConstraint:l}}=a;if(!r)return;const c=(n=hl(s))!=null?n:Ft,d=or(r,c);if(!i&&l){if(su(l)){if(l.tolerance!=null&&Do(d,l.tolerance))return this.handleCancel();if(Do(d,l.distance))return this.handleStart()}if(nu(l)&&Do(d,l.tolerance))return this.handleCancel();this.handlePending(l,d);return}s.cancelable&&s.preventDefault(),o(c)}handleEnd(){const{onAbort:s,onEnd:n}=this.props;this.detach(),this.activated||s(this.props.active),n()}handleCancel(){const{onAbort:s,onCancel:n}=this.props;this.detach(),this.activated||s(this.props.active),n()}handleKeydown(s){s.code===ne.Esc&&this.handleCancel()}removeTextSelection(){var s;(s=this.document.getSelection())==null||s.removeAllRanges()}}const cN={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class zc extends kc{constructor(s){const{event:n}=s,i=gi(n.target);super(s,cN,i)}}zc.activators=[{eventName:"onPointerDown",handler:(t,s)=>{let{nativeEvent:n}=t,{onActivation:i}=s;return!n.isPrimary||n.button!==0?!1:(i?.({event:n}),!0)}}];const dN={move:{name:"mousemove"},end:{name:"mouseup"}};var pl;(function(t){t[t.RightClick=2]="RightClick"})(pl||(pl={}));class uN extends kc{constructor(s){super(s,dN,gi(s.event.target))}}uN.activators=[{eventName:"onMouseDown",handler:(t,s)=>{let{nativeEvent:n}=t,{onActivation:i}=s;return n.button===pl.RightClick?!1:(i?.({event:n}),!0)}}];const Po={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class mN extends kc{constructor(s){super(s,Po)}static setup(){return window.addEventListener(Po.move.name,s,{capture:!1,passive:!1}),function(){window.removeEventListener(Po.move.name,s)};function s(){}}}mN.activators=[{eventName:"onTouchStart",handler:(t,s)=>{let{nativeEvent:n}=t,{onActivation:i}=s;const{touches:r}=n;return r.length>1?!1:(i?.({event:n}),!0)}}];var qi;(function(t){t[t.Pointer=0]="Pointer",t[t.DraggableRect=1]="DraggableRect"})(qi||(qi={}));var ya;(function(t){t[t.TreeOrder=0]="TreeOrder",t[t.ReversedTreeOrder=1]="ReversedTreeOrder"})(ya||(ya={}));function hN(t){let{acceleration:s,activator:n=qi.Pointer,canScroll:i,draggingRect:r,enabled:a,interval:o=5,order:l=ya.TreeOrder,pointerCoordinates:c,scrollableAncestors:d,scrollableAncestorRects:m,delta:u,threshold:h}=t;const p=pN({delta:u,disabled:!a}),[j,x]=zv(),b=g.useRef({x:0,y:0}),w=g.useRef({x:0,y:0}),y=g.useMemo(()=>{switch(n){case qi.Pointer:return c?{top:c.y,bottom:c.y,left:c.x,right:c.x}:null;case qi.DraggableRect:return r}},[n,r,c]),v=g.useRef(null),_=g.useCallback(()=>{const k=v.current;if(!k)return;const N=b.current.x*w.current.x,z=b.current.y*w.current.y;k.scrollBy(N,z)},[]),C=g.useMemo(()=>l===ya.TreeOrder?[...d].reverse():d,[l,d]);g.useEffect(()=>{if(!a||!d.length||!y){x();return}for(const k of C){if(i?.(k)===!1)continue;const N=d.indexOf(k),z=m[N];if(!z)continue;const{direction:T,speed:f}=eN(k,z,y,s,h);for(const S of["x","y"])p[S][T[S]]||(f[S]=0,T[S]=0);if(f.x>0||f.y>0){x(),v.current=k,j(_,o),b.current=f,w.current=T;return}}b.current={x:0,y:0},w.current={x:0,y:0},x()},[s,_,i,x,a,o,JSON.stringify(y),JSON.stringify(p),j,d,C,m,JSON.stringify(h)])}const fN={x:{[Be.Backward]:!1,[Be.Forward]:!1},y:{[Be.Backward]:!1,[Be.Forward]:!1}};function pN(t){let{delta:s,disabled:n}=t;const i=ml(s);return Tr(r=>{if(n||!i||!r)return fN;const a={x:Math.sign(s.x-i.x),y:Math.sign(s.y-i.y)};return{x:{[Be.Backward]:r.x[Be.Backward]||a.x===-1,[Be.Forward]:r.x[Be.Forward]||a.x===1},y:{[Be.Backward]:r.y[Be.Backward]||a.y===-1,[Be.Forward]:r.y[Be.Forward]||a.y===1}}},[n,s,i])}function xN(t,s){const n=s!=null?t.get(s):void 0,i=n?n.node.current:null;return Tr(r=>{var a;return s==null?null:(a=i??r)!=null?a:null},[i,s])}function gN(t,s){return g.useMemo(()=>t.reduce((n,i)=>{const{sensor:r}=i,a=r.activators.map(o=>({eventName:o.eventName,handler:s(o.handler,i)}));return[...n,...a]},[]),[t,s])}var cr;(function(t){t[t.Always=0]="Always",t[t.BeforeDragging=1]="BeforeDragging",t[t.WhileDragging=2]="WhileDragging"})(cr||(cr={}));var xl;(function(t){t.Optimized="optimized"})(xl||(xl={}));const iu=new Map;function jN(t,s){let{dragging:n,dependencies:i,config:r}=s;const[a,o]=g.useState(null),{frequency:l,measure:c,strategy:d}=r,m=g.useRef(t),u=b(),h=ar(u),p=g.useCallback(function(w){w===void 0&&(w=[]),!h.current&&o(y=>y===null?w:y.concat(w.filter(v=>!y.includes(v))))},[h]),j=g.useRef(null),x=Tr(w=>{if(u&&!n)return iu;if(!w||w===iu||m.current!==t||a!=null){const y=new Map;for(let v of t){if(!v)continue;if(a&&a.length>0&&!a.includes(v.id)&&v.rect.current){y.set(v.id,v.rect.current);continue}const _=v.node.current,C=_?new vc(c(_),_):null;v.rect.current=C,C&&y.set(v.id,C)}return y}return w},[t,a,n,u,c]);return g.useEffect(()=>{m.current=t},[t]),g.useEffect(()=>{u||p()},[n,u]),g.useEffect(()=>{a&&a.length>0&&o(null)},[JSON.stringify(a)]),g.useEffect(()=>{u||typeof l!="number"||j.current!==null||(j.current=setTimeout(()=>{p(),j.current=null},l))},[l,u,p,...i]),{droppableRects:x,measureDroppableContainers:p,measuringScheduled:a!=null};function b(){switch(d){case cr.Always:return!1;case cr.BeforeDragging:return n;default:return!n}}}function Sp(t,s){return Tr(n=>t?n||(typeof s=="function"?s(t):t):null,[s,t])}function yN(t,s){return Sp(t,s)}function bN(t){let{callback:s,disabled:n}=t;const i=bc(s),r=g.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:a}=window;return new a(i)},[i,n]);return g.useEffect(()=>()=>r?.disconnect(),[r]),r}function to(t){let{callback:s,disabled:n}=t;const i=bc(s),r=g.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:a}=window;return new a(i)},[n]);return g.useEffect(()=>()=>r?.disconnect(),[r]),r}function wN(t){return new vc(ji(t),t)}function ru(t,s,n){s===void 0&&(s=wN);const[i,r]=g.useState(null);function a(){r(c=>{if(!t)return null;if(t.isConnected===!1){var d;return(d=c??n)!=null?d:null}const m=s(t);return JSON.stringify(c)===JSON.stringify(m)?c:m})}const o=bN({callback(c){if(t)for(const d of c){const{type:m,target:u}=d;if(m==="childList"&&u instanceof HTMLElement&&u.contains(t)){a();break}}}}),l=to({callback:a});return as(()=>{a(),t?(l?.observe(t),o?.observe(document.body,{childList:!0,subtree:!0})):(l?.disconnect(),o?.disconnect())},[t]),i}function vN(t){const s=Sp(t);return jp(t,s)}const au=[];function NN(t){const s=g.useRef(t),n=Tr(i=>t?i&&i!==au&&t&&s.current&&t.parentNode===s.current.parentNode?i:eo(t):au,[t]);return g.useEffect(()=>{s.current=t},[t]),n}function kN(t){const[s,n]=g.useState(null),i=g.useRef(t),r=g.useCallback(a=>{const o=Ao(a.target);o&&n(l=>l?(l.set(o,fl(o)),new Map(l)):null)},[]);return g.useEffect(()=>{const a=i.current;if(t!==a){o(a);const l=t.map(c=>{const d=Ao(c);return d?(d.addEventListener("scroll",r,{passive:!0}),[d,fl(d)]):null}).filter(c=>c!=null);n(l.length?new Map(l):null),i.current=t}return()=>{o(t),o(a)};function o(l){l.forEach(c=>{const d=Ao(c);d?.removeEventListener("scroll",r)})}},[r,t]),g.useMemo(()=>t.length?s?Array.from(s.values()).reduce((a,o)=>Yn(a,o),Ft):kp(t):Ft,[t,s])}function ou(t,s){s===void 0&&(s=[]);const n=g.useRef(null);return g.useEffect(()=>{n.current=null},s),g.useEffect(()=>{const i=t!==Ft;i&&!n.current&&(n.current=t),!i&&n.current&&(n.current=null)},[t]),n.current?or(t,n.current):Ft}function zN(t){g.useEffect(()=>{if(!Ja)return;const s=t.map(n=>{let{sensor:i}=n;return i.setup==null?void 0:i.setup()});return()=>{for(const n of s)n?.()}},t.map(s=>{let{sensor:n}=s;return n}))}function SN(t,s){return g.useMemo(()=>t.reduce((n,i)=>{let{eventName:r,handler:a}=i;return n[r]=o=>{a(o,s)},n},{}),[t,s])}function Cp(t){return g.useMemo(()=>t?Qv(t):null,[t])}const lu=[];function CN(t,s){s===void 0&&(s=ji);const[n]=t,i=Cp(n?ht(n):null),[r,a]=g.useState(lu);function o(){a(()=>t.length?t.map(c=>vp(c)?i:new vc(s(c),c)):lu)}const l=to({callback:o});return as(()=>{l?.disconnect(),o(),t.forEach(c=>l?.observe(c))},[t]),r}function _N(t){if(!t)return null;if(t.children.length>1)return t;const s=t.children[0];return _r(s)?s:t}function TN(t){let{measure:s}=t;const[n,i]=g.useState(null),r=g.useCallback(d=>{for(const{target:m}of d)if(_r(m)){i(u=>{const h=s(m);return u?{...u,width:h.width,height:h.height}:h});break}},[s]),a=to({callback:r}),o=g.useCallback(d=>{const m=_N(d);a?.disconnect(),m&&a?.observe(m),i(m?s(m):null)},[s,a]),[l,c]=ga(o);return g.useMemo(()=>({nodeRef:l,rect:n,setRef:c}),[n,l,c])}const AN=[{sensor:zc,options:{}},{sensor:Nc,options:{}}],DN={current:{}},ta={draggable:{measure:eu},droppable:{measure:eu,strategy:cr.WhileDragging,frequency:xl.Optimized},dragOverlay:{measure:ji}};class Ki extends Map{get(s){var n;return s!=null&&(n=super.get(s))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(s=>{let{disabled:n}=s;return!n})}getNodeFor(s){var n,i;return(n=(i=this.get(s))==null?void 0:i.node.current)!=null?n:void 0}}const PN={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Ki,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:ja},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:ta,measureDroppableContainers:ja,windowRect:null,measuringScheduled:!1},MN={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:ja,draggableNodes:new Map,over:null,measureDroppableContainers:ja},so=g.createContext(MN),_p=g.createContext(PN);function RN(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Ki}}}function IN(t,s){switch(s.type){case Ie.DragStart:return{...t,draggable:{...t.draggable,initialCoordinates:s.initialCoordinates,active:s.active}};case Ie.DragMove:return t.draggable.active==null?t:{...t,draggable:{...t.draggable,translate:{x:s.coordinates.x-t.draggable.initialCoordinates.x,y:s.coordinates.y-t.draggable.initialCoordinates.y}}};case Ie.DragEnd:case Ie.DragCancel:return{...t,draggable:{...t.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Ie.RegisterDroppable:{const{element:n}=s,{id:i}=n,r=new Ki(t.droppable.containers);return r.set(i,n),{...t,droppable:{...t.droppable,containers:r}}}case Ie.SetDroppableDisabled:{const{id:n,key:i,disabled:r}=s,a=t.droppable.containers.get(n);if(!a||i!==a.key)return t;const o=new Ki(t.droppable.containers);return o.set(n,{...a,disabled:r}),{...t,droppable:{...t.droppable,containers:o}}}case Ie.UnregisterDroppable:{const{id:n,key:i}=s,r=t.droppable.containers.get(n);if(!r||i!==r.key)return t;const a=new Ki(t.droppable.containers);return a.delete(n),{...t,droppable:{...t.droppable,containers:a}}}default:return t}}function EN(t){let{disabled:s}=t;const{active:n,activatorEvent:i,draggableNodes:r}=g.useContext(so),a=ml(i),o=ml(n?.id);return g.useEffect(()=>{if(!s&&!i&&a&&o!=null){if(!wc(a)||document.activeElement===a.target)return;const l=r.get(o);if(!l)return;const{activatorNode:c,node:d}=l;if(!c.current&&!d.current)return;requestAnimationFrame(()=>{for(const m of[c.current,d.current]){if(!m)continue;const u=_v(m);if(u){u.focus();break}}})}},[i,s,r,o,a]),null}function LN(t,s){let{transform:n,...i}=s;return t!=null&&t.length?t.reduce((r,a)=>a({transform:r,...i}),n):n}function ON(t){return g.useMemo(()=>({draggable:{...ta.draggable,...t?.draggable},droppable:{...ta.droppable,...t?.droppable},dragOverlay:{...ta.dragOverlay,...t?.dragOverlay}}),[t?.draggable,t?.droppable,t?.dragOverlay])}function $N(t){let{activeNode:s,measure:n,initialRect:i,config:r=!0}=t;const a=g.useRef(!1),{x:o,y:l}=typeof r=="boolean"?{x:r,y:r}:r;as(()=>{if(!o&&!l||!s){a.current=!1;return}if(a.current||!i)return;const d=s?.node.current;if(!d||d.isConnected===!1)return;const m=n(d),u=jp(m,i);if(o||(u.x=0),l||(u.y=0),a.current=!0,Math.abs(u.x)>0||Math.abs(u.y)>0){const h=yp(d);h&&h.scrollBy({top:u.y,left:u.x})}},[s,o,l,i,n])}const Tp=g.createContext({...Ft,scaleX:1,scaleY:1});var Is;(function(t){t[t.Uninitialized=0]="Uninitialized",t[t.Initializing=1]="Initializing",t[t.Initialized=2]="Initialized"})(Is||(Is={}));const FN=g.memo(function(s){var n,i,r,a;let{id:o,accessibility:l,autoScroll:c=!0,children:d,sensors:m=AN,collisionDetection:u=Vv,measuring:h,modifiers:p,...j}=s;const x=g.useReducer(IN,void 0,RN),[b,w]=x,[y,v]=Rv(),[_,C]=g.useState(Is.Uninitialized),k=_===Is.Initialized,{draggable:{active:N,nodes:z,translate:T},droppable:{containers:f}}=b,S=N!=null?z.get(N):null,A=g.useRef({initial:null,translated:null}),D=g.useMemo(()=>{var He;return N!=null?{id:N,data:(He=S?.data)!=null?He:DN,rect:A}:null},[N,S]),P=g.useRef(null),[L,K]=g.useState(null),[E,U]=g.useState(null),B=ar(j,Object.values(j)),ae=Ar("DndDescribedBy",o),le=g.useMemo(()=>f.getEnabled(),[f]),pe=ON(h),{droppableRects:ft,measureDroppableContainers:It,measuringScheduled:_s}=jN(le,{dragging:k,dependencies:[T.x,T.y],config:pe.droppable}),Oe=xN(z,N),$e=g.useMemo(()=>E?hl(E):null,[E]),Et=qj(),ds=yN(Oe,pe.draggable.measure);$N({activeNode:N!=null?z.get(N):null,config:Et.layoutShiftCompensation,initialRect:ds,measure:pe.draggable.measure});const ce=ru(Oe,pe.draggable.measure,ds),Ti=ru(Oe?Oe.parentElement:null),Vt=g.useRef({activatorEvent:null,active:null,activeNode:Oe,collisionRect:null,collisions:null,droppableRects:ft,draggableNodes:z,draggingNode:null,draggingNodeRect:null,droppableContainers:f,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Dn=f.getNodeFor((n=Vt.current.over)==null?void 0:n.id),us=TN({measure:pe.dragOverlay.measure}),Pn=(i=us.nodeRef.current)!=null?i:Oe,Mn=k?(r=us.rect)!=null?r:ce:null,zd=!!(us.nodeRef.current&&us.rect),Sd=vN(zd?null:ce),No=Cp(Pn?ht(Pn):null),Ts=NN(k?Dn??Oe:null),$r=CN(Ts),Fr=LN(p,{transform:{x:T.x-Sd.x,y:T.y-Sd.y,scaleX:1,scaleY:1},activatorEvent:E,active:D,activeNodeRect:ce,containerNodeRect:Ti,draggingNodeRect:Mn,over:Vt.current.over,overlayNodeRect:us.rect,scrollableAncestors:Ts,scrollableAncestorRects:$r,windowRect:No}),Cd=$e?Yn($e,T):null,_d=kN(Ts),Lj=ou(_d),Oj=ou(_d,[ce]),Rn=Yn(Fr,Lj),In=Mn?Wv(Mn,Fr):null,Ai=D&&In?u({active:D,collisionRect:In,droppableRects:ft,droppableContainers:le,pointerCoordinates:Cd}):null,Td=gp(Ai,"id"),[As,Ad]=g.useState(null),$j=zd?Fr:Yn(Fr,Oj),Fj=qv($j,(a=As?.rect)!=null?a:null,ce),ko=g.useRef(null),Dd=g.useCallback((He,pt)=>{let{sensor:xt,options:Ds}=pt;if(P.current==null)return;const Nt=z.get(P.current);if(!Nt)return;const gt=He.nativeEvent,qt=new xt({active:P.current,activeNode:Nt,event:gt,options:Ds,context:Vt,onAbort(qe){if(!z.get(qe))return;const{onDragAbort:Kt}=B.current,ms={id:qe};Kt?.(ms),y({type:"onDragAbort",event:ms})},onPending(qe,Ps,Kt,ms){if(!z.get(qe))return;const{onDragPending:Pi}=B.current,Ms={id:qe,constraint:Ps,initialCoordinates:Kt,offset:ms};Pi?.(Ms),y({type:"onDragPending",event:Ms})},onStart(qe){const Ps=P.current;if(Ps==null)return;const Kt=z.get(Ps);if(!Kt)return;const{onDragStart:ms}=B.current,Di={activatorEvent:gt,active:{id:Ps,data:Kt.data,rect:A}};Oi.unstable_batchedUpdates(()=>{ms?.(Di),C(Is.Initializing),w({type:Ie.DragStart,initialCoordinates:qe,active:Ps}),y({type:"onDragStart",event:Di}),K(ko.current),U(gt)})},onMove(qe){w({type:Ie.DragMove,coordinates:qe})},onEnd:En(Ie.DragEnd),onCancel:En(Ie.DragCancel)});ko.current=qt;function En(qe){return async function(){const{active:Kt,collisions:ms,over:Di,scrollAdjustedTranslate:Pi}=Vt.current;let Ms=null;if(Kt&&Pi){const{cancelDrop:Mi}=B.current;Ms={activatorEvent:gt,active:Kt,collisions:ms,delta:Pi,over:Di},qe===Ie.DragEnd&&typeof Mi=="function"&&await Promise.resolve(Mi(Ms))&&(qe=Ie.DragCancel)}P.current=null,Oi.unstable_batchedUpdates(()=>{w({type:qe}),C(Is.Uninitialized),Ad(null),K(null),U(null),ko.current=null;const Mi=qe===Ie.DragEnd?"onDragEnd":"onDragCancel";if(Ms){const zo=B.current[Mi];zo?.(Ms),y({type:Mi,event:Ms})}})}}},[z]),Bj=g.useCallback((He,pt)=>(xt,Ds)=>{const Nt=xt.nativeEvent,gt=z.get(Ds);if(P.current!==null||!gt||Nt.dndKit||Nt.defaultPrevented)return;const qt={active:gt};He(xt,pt.options,qt)===!0&&(Nt.dndKit={capturedBy:pt.sensor},P.current=Ds,Dd(xt,pt))},[z,Dd]),Pd=gN(m,Bj);zN(m),as(()=>{ce&&_===Is.Initializing&&C(Is.Initialized)},[ce,_]),g.useEffect(()=>{const{onDragMove:He}=B.current,{active:pt,activatorEvent:xt,collisions:Ds,over:Nt}=Vt.current;if(!pt||!xt)return;const gt={active:pt,activatorEvent:xt,collisions:Ds,delta:{x:Rn.x,y:Rn.y},over:Nt};Oi.unstable_batchedUpdates(()=>{He?.(gt),y({type:"onDragMove",event:gt})})},[Rn.x,Rn.y]),g.useEffect(()=>{const{active:He,activatorEvent:pt,collisions:xt,droppableContainers:Ds,scrollAdjustedTranslate:Nt}=Vt.current;if(!He||P.current==null||!pt||!Nt)return;const{onDragOver:gt}=B.current,qt=Ds.get(Td),En=qt&&qt.rect.current?{id:qt.id,rect:qt.rect.current,data:qt.data,disabled:qt.disabled}:null,qe={active:He,activatorEvent:pt,collisions:xt,delta:{x:Nt.x,y:Nt.y},over:En};Oi.unstable_batchedUpdates(()=>{Ad(En),gt?.(qe),y({type:"onDragOver",event:qe})})},[Td]),as(()=>{Vt.current={activatorEvent:E,active:D,activeNode:Oe,collisionRect:In,collisions:Ai,droppableRects:ft,draggableNodes:z,draggingNode:Pn,draggingNodeRect:Mn,droppableContainers:f,over:As,scrollableAncestors:Ts,scrollAdjustedTranslate:Rn},A.current={initial:Mn,translated:In}},[D,Oe,Ai,In,z,Pn,Mn,ft,f,As,Ts,Rn]),hN({...Et,delta:T,draggingRect:In,pointerCoordinates:Cd,scrollableAncestors:Ts,scrollableAncestorRects:$r});const Uj=g.useMemo(()=>({active:D,activeNode:Oe,activeNodeRect:ce,activatorEvent:E,collisions:Ai,containerNodeRect:Ti,dragOverlay:us,draggableNodes:z,droppableContainers:f,droppableRects:ft,over:As,measureDroppableContainers:It,scrollableAncestors:Ts,scrollableAncestorRects:$r,measuringConfiguration:pe,measuringScheduled:_s,windowRect:No}),[D,Oe,ce,E,Ai,Ti,us,z,f,ft,As,It,Ts,$r,pe,_s,No]),Vj=g.useMemo(()=>({activatorEvent:E,activators:Pd,active:D,activeNodeRect:ce,ariaDescribedById:{draggable:ae},dispatch:w,draggableNodes:z,over:As,measureDroppableContainers:It}),[E,Pd,D,ce,w,ae,z,As,It]);return ee.createElement(fp.Provider,{value:v},ee.createElement(so.Provider,{value:Vj},ee.createElement(_p.Provider,{value:Uj},ee.createElement(Tp.Provider,{value:Fj},d)),ee.createElement(EN,{disabled:l?.restoreFocus===!1})),ee.createElement(Lv,{...l,hiddenTextDescribedById:ae}));function qj(){const He=L?.autoScrollEnabled===!1,pt=typeof c=="object"?c.enabled===!1:c===!1,xt=k&&!He&&!pt;return typeof c=="object"?{...c,enabled:xt}:{enabled:xt}}}),BN=g.createContext(null),cu="button",UN="Draggable";function VN(t){let{id:s,data:n,disabled:i=!1,attributes:r}=t;const a=Ar(UN),{activators:o,activatorEvent:l,active:c,activeNodeRect:d,ariaDescribedById:m,draggableNodes:u,over:h}=g.useContext(so),{role:p=cu,roleDescription:j="draggable",tabIndex:x=0}=r??{},b=c?.id===s,w=g.useContext(b?Tp:BN),[y,v]=ga(),[_,C]=ga(),k=SN(o,s),N=ar(n);as(()=>(u.set(s,{id:s,key:a,node:y,activatorNode:_,data:N}),()=>{const T=u.get(s);T&&T.key===a&&u.delete(s)}),[u,s]);const z=g.useMemo(()=>({role:p,tabIndex:x,"aria-disabled":i,"aria-pressed":b&&p===cu?!0:void 0,"aria-roledescription":j,"aria-describedby":m.draggable}),[i,p,x,b,j,m.draggable]);return{active:c,activatorEvent:l,activeNodeRect:d,attributes:z,isDragging:b,listeners:i?void 0:k,node:y,over:h,setNodeRef:v,setActivatorNodeRef:C,transform:w}}function qN(){return g.useContext(_p)}const KN="Droppable",WN={timeout:25};function GN(t){let{data:s,disabled:n=!1,id:i,resizeObserverConfig:r}=t;const a=Ar(KN),{active:o,dispatch:l,over:c,measureDroppableContainers:d}=g.useContext(so),m=g.useRef({disabled:n}),u=g.useRef(!1),h=g.useRef(null),p=g.useRef(null),{disabled:j,updateMeasurementsFor:x,timeout:b}={...WN,...r},w=ar(x??i),y=g.useCallback(()=>{if(!u.current){u.current=!0;return}p.current!=null&&clearTimeout(p.current),p.current=setTimeout(()=>{d(Array.isArray(w.current)?w.current:[w.current]),p.current=null},b)},[b]),v=to({callback:y,disabled:j||!o}),_=g.useCallback((z,T)=>{v&&(T&&(v.unobserve(T),u.current=!1),z&&v.observe(z))},[v]),[C,k]=ga(_),N=ar(s);return g.useEffect(()=>{!v||!C.current||(v.disconnect(),u.current=!1,v.observe(C.current))},[C,v]),g.useEffect(()=>(l({type:Ie.RegisterDroppable,element:{id:i,key:a,disabled:n,node:C,rect:h,data:N}}),()=>l({type:Ie.UnregisterDroppable,key:a,id:i})),[i]),g.useEffect(()=>{n!==m.current.disabled&&(l({type:Ie.SetDroppableDisabled,id:i,key:a,disabled:n}),m.current.disabled=n)},[i,a,n,l]),{active:o,rect:h,isOver:c?.id===i,node:C,over:c,setNodeRef:k}}function Sc(t,s,n){const i=t.slice();return i.splice(n<0?i.length+n:n,0,i.splice(s,1)[0]),i}function HN(t,s){return t.reduce((n,i,r)=>{const a=s.get(i);return a&&(n[r]=a),n},Array(t.length))}function Ur(t){return t!==null&&t>=0}function ZN(t,s){if(t===s)return!0;if(t.length!==s.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==s[n])return!1;return!0}function QN(t){return typeof t=="boolean"?{draggable:t,droppable:t}:t}const Ap=t=>{let{rects:s,activeIndex:n,overIndex:i,index:r}=t;const a=Sc(s,i,n),o=s[r],l=a[r];return!l||!o?null:{x:l.left-o.left,y:l.top-o.top,scaleX:l.width/o.width,scaleY:l.height/o.height}},Vr={scaleX:1,scaleY:1},YN=t=>{var s;let{activeIndex:n,activeNodeRect:i,index:r,rects:a,overIndex:o}=t;const l=(s=a[n])!=null?s:i;if(!l)return null;if(r===n){const d=a[o];return d?{x:0,y:n<o?d.top+d.height-(l.top+l.height):d.top-l.top,...Vr}:null}const c=XN(a,r,n);return r>n&&r<=o?{x:0,y:-l.height-c,...Vr}:r<n&&r>=o?{x:0,y:l.height+c,...Vr}:{x:0,y:0,...Vr}};function XN(t,s,n){const i=t[s],r=t[s-1],a=t[s+1];return i?n<s?r?i.top-(r.top+r.height):a?a.top-(i.top+i.height):0:a?a.top-(i.top+i.height):r?i.top-(r.top+r.height):0:0}const Dp="Sortable",Pp=ee.createContext({activeIndex:-1,containerId:Dp,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:Ap,disabled:{draggable:!1,droppable:!1}});function JN(t){let{children:s,id:n,items:i,strategy:r=Ap,disabled:a=!1}=t;const{active:o,dragOverlay:l,droppableRects:c,over:d,measureDroppableContainers:m}=qN(),u=Ar(Dp,n),h=l.rect!==null,p=g.useMemo(()=>i.map(k=>typeof k=="object"&&"id"in k?k.id:k),[i]),j=o!=null,x=o?p.indexOf(o.id):-1,b=d?p.indexOf(d.id):-1,w=g.useRef(p),y=!ZN(p,w.current),v=b!==-1&&x===-1||y,_=QN(a);as(()=>{y&&j&&m(p)},[y,p,j,m]),g.useEffect(()=>{w.current=p},[p]);const C=g.useMemo(()=>({activeIndex:x,containerId:u,disabled:_,disableTransforms:v,items:p,overIndex:b,useDragOverlay:h,sortedRects:HN(p,c),strategy:r}),[x,u,_.draggable,_.droppable,v,p,b,c,h,r]);return ee.createElement(Pp.Provider,{value:C},s)}const ek=t=>{let{id:s,items:n,activeIndex:i,overIndex:r}=t;return Sc(n,i,r).indexOf(s)},tk=t=>{let{containerId:s,isSorting:n,wasDragging:i,index:r,items:a,newIndex:o,previousItems:l,previousContainerId:c,transition:d}=t;return!d||!i||l!==a&&r===o?!1:n?!0:o!==r&&s===c},sk={duration:200,easing:"ease"},Mp="transform",nk=lr.Transition.toString({property:Mp,duration:0,easing:"linear"}),ik={roleDescription:"sortable"};function rk(t){let{disabled:s,index:n,node:i,rect:r}=t;const[a,o]=g.useState(null),l=g.useRef(n);return as(()=>{if(!s&&n!==l.current&&i.current){const c=r.current;if(c){const d=ji(i.current,{ignoreTransform:!0}),m={x:c.left-d.left,y:c.top-d.top,scaleX:c.width/d.width,scaleY:c.height/d.height};(m.x||m.y)&&o(m)}}n!==l.current&&(l.current=n)},[s,n,i,r]),g.useEffect(()=>{a&&o(null)},[a]),a}function ak(t){let{animateLayoutChanges:s=tk,attributes:n,disabled:i,data:r,getNewIndex:a=ek,id:o,strategy:l,resizeObserverConfig:c,transition:d=sk}=t;const{items:m,containerId:u,activeIndex:h,disabled:p,disableTransforms:j,sortedRects:x,overIndex:b,useDragOverlay:w,strategy:y}=g.useContext(Pp),v=ok(i,p),_=m.indexOf(o),C=g.useMemo(()=>({sortable:{containerId:u,index:_,items:m},...r}),[u,r,_,m]),k=g.useMemo(()=>m.slice(m.indexOf(o)),[m,o]),{rect:N,node:z,isOver:T,setNodeRef:f}=GN({id:o,data:C,disabled:v.droppable,resizeObserverConfig:{updateMeasurementsFor:k,...c}}),{active:S,activatorEvent:A,activeNodeRect:D,attributes:P,setNodeRef:L,listeners:K,isDragging:E,over:U,setActivatorNodeRef:B,transform:ae}=VN({id:o,data:C,attributes:{...ik,...n},disabled:v.draggable}),le=kv(f,L),pe=!!S,ft=pe&&!j&&Ur(h)&&Ur(b),It=!w&&E,_s=It&&ft?ae:null,$e=ft?_s??(l??y)({rects:x,activeNodeRect:D,activeIndex:h,overIndex:b,index:_}):null,Et=Ur(h)&&Ur(b)?a({id:o,items:m,activeIndex:h,overIndex:b}):_,ds=S?.id,ce=g.useRef({activeId:ds,items:m,newIndex:Et,containerId:u}),Ti=m!==ce.current.items,Vt=s({active:S,containerId:u,isDragging:E,isSorting:pe,id:o,index:_,items:m,newIndex:ce.current.newIndex,previousItems:ce.current.items,previousContainerId:ce.current.containerId,transition:d,wasDragging:ce.current.activeId!=null}),Dn=rk({disabled:!Vt,index:_,node:z,rect:N});return g.useEffect(()=>{pe&&ce.current.newIndex!==Et&&(ce.current.newIndex=Et),u!==ce.current.containerId&&(ce.current.containerId=u),m!==ce.current.items&&(ce.current.items=m)},[pe,Et,u,m]),g.useEffect(()=>{if(ds===ce.current.activeId)return;if(ds!=null&&ce.current.activeId==null){ce.current.activeId=ds;return}const Pn=setTimeout(()=>{ce.current.activeId=ds},50);return()=>clearTimeout(Pn)},[ds]),{active:S,activeIndex:h,attributes:P,data:C,rect:N,index:_,newIndex:Et,items:m,isOver:T,isSorting:pe,isDragging:E,listeners:K,node:z,overIndex:b,over:U,setNodeRef:le,setActivatorNodeRef:B,setDroppableNodeRef:f,setDraggableNodeRef:L,transform:Dn??$e,transition:us()};function us(){if(Dn||Ti&&ce.current.newIndex===_)return nk;if(!(It&&!wc(A)||!d)&&(pe||Vt))return lr.Transition.toString({...d,property:Mp})}}function ok(t,s){var n,i;return typeof t=="boolean"?{draggable:t,droppable:!1}:{draggable:(n=t?.draggable)!=null?n:s.draggable,droppable:(i=t?.droppable)!=null?i:s.droppable}}function ba(t){if(!t)return!1;const s=t.data.current;return!!(s&&"sortable"in s&&typeof s.sortable=="object"&&"containerId"in s.sortable&&"items"in s.sortable&&"index"in s.sortable)}const lk=[ne.Down,ne.Right,ne.Up,ne.Left],ck=(t,s)=>{let{context:{active:n,collisionRect:i,droppableRects:r,droppableContainers:a,over:o,scrollableAncestors:l}}=s;if(lk.includes(t.code)){if(t.preventDefault(),!n||!i)return;const c=[];a.getEnabled().forEach(u=>{if(!u||u!=null&&u.disabled)return;const h=r.get(u.id);if(h)switch(t.code){case ne.Down:i.top<h.top&&c.push(u);break;case ne.Up:i.top>h.top&&c.push(u);break;case ne.Left:i.left>h.left&&c.push(u);break;case ne.Right:i.left<h.left&&c.push(u);break}});const d=Bv({collisionRect:i,droppableRects:r,droppableContainers:c});let m=gp(d,"id");if(m===o?.id&&d.length>1&&(m=d[1].id),m!=null){const u=a.get(n.id),h=a.get(m),p=h?r.get(h.id):null,j=h?.node.current;if(j&&p&&u&&h){const b=eo(j).some((k,N)=>l[N]!==k),w=Rp(u,h),y=dk(u,h),v=b||!w?{x:0,y:0}:{x:y?i.width-p.width:0,y:y?i.height-p.height:0},_={x:p.left,y:p.top};return v.x&&v.y?_:or(_,v)}}}};function Rp(t,s){return!ba(t)||!ba(s)?!1:t.data.current.sortable.containerId===s.data.current.sortable.containerId}function dk(t,s){return!ba(t)||!ba(s)||!Rp(t,s)?!1:t.data.current.sortable.index<s.data.current.sortable.index}const uk=()=>e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}),mk=({course:t,topicsCount:s,activitiesCount:n,accessCount:i})=>e.jsxs(rt,{variant:"2-2-4",children:[e.jsxs(M,{children:[e.jsx($,{className:"pb-2",children:e.jsx(O,{className:"text-sm font-medium",children:"Status"})}),e.jsx(R,{children:e.jsx(q,{variant:t?.is_published?"default":"secondary",children:t?.is_published?"Opublikowany":"Szkic"})})]}),e.jsxs(M,{children:[e.jsx($,{className:"pb-2",children:e.jsx(O,{className:"text-sm font-medium",children:"Tematy"})}),e.jsx(R,{children:e.jsx("div",{className:"text-2xl font-bold",children:s})})]}),e.jsxs(M,{children:[e.jsx($,{className:"pb-2",children:e.jsx(O,{className:"text-sm font-medium",children:"Aktywności"})}),e.jsx(R,{children:e.jsx("div",{className:"text-2xl font-bold",children:n})})]}),e.jsxs(M,{children:[e.jsx($,{className:"pb-2",children:e.jsx(O,{className:"text-sm font-medium",children:"Uczestników"})}),e.jsx(R,{children:e.jsx("div",{className:"text-2xl font-bold",children:i})})]})]}),hk=({id:t,disabled:s=!1,children:n})=>{const{attributes:i,listeners:r,setNodeRef:a,transform:o,transition:l,isDragging:c}=ak({id:t,disabled:s}),d={transform:lr.Transform.toString(o),transition:l,opacity:c?.5:1,cursor:c?"grabbing":"grab"},m=s?{}:{...i,...r,style:{cursor:c?"grabbing":"grab"}};return e.jsx("div",{ref:a,style:d,className:c?"z-50":"",children:n({dragHandleProps:m,isDragging:c})})},du=({items:t,renderItem:s,onReorder:n,className:i="space-y-2",disabled:r=!1})=>{const[a,o]=g.useState(t),[l,c]=g.useState(null),[d,m]=g.useState(null);g.useEffect(()=>{if(!d)o(t);else{const j=a.map(x=>{const b=t.find(w=>w.id===x.id);return b?{...b,position:x.position}:x});o(j)}},[t]);const u=Ov(Yd(zc,{activationConstraint:{distance:8}}),Yd(Nc,{coordinateGetter:ck})),h=j=>{c(Number(j.active.id))},p=j=>{const{active:x,over:b}=j;if(c(null),b&&x.id!==b.id){const w=a.findIndex(v=>v.id===Number(x.id)),y=a.findIndex(v=>v.id===Number(b.id));if(w!==-1&&y!==-1&&w!==y){let v;const _=a[w];if(y===0)v=a[0].position/2;else if(y===a.length-1)v=a[a.length-1].position+1e3;else if(w<y){const N=a[y],z=y+1<a.length?a[y+1]:null;z?v=(N.position+z.position)/2:v=N.position+1e3}else{const N=y>0?a[y-1]:null,z=a[y];N?v=(N.position+z.position)/2:v=z.position/2}const k=Sc(a,w,y).map(N=>N.id===_.id?{...N,position:v}:N);o(k),m({id:_.id,position:v}),n(_.id,v),setTimeout(()=>m(null),2e3)}}};return e.jsx(FN,{sensors:u,collisionDetection:Fv,onDragStart:h,onDragEnd:p,children:e.jsx(JN,{items:a.map(j=>j.id),strategy:YN,children:e.jsx("div",{className:i,children:a.map((j,x)=>e.jsx(hk,{id:j.id,disabled:r||d!==null&&d.id!==j.id,children:b=>s(j,x,b.dragHandleProps)},j.id))})})})},fk=()=>{const{list:t,edit:s}=Xe(),{id:n}=mt(),[i,r]=Ma(),{navigateWithReturn:a,navigateToWizard:o}=fv(),{course:l,topics:c,stats:d,isLoading:m,refetchTopics:u,refetchActivities:h,getActivitiesForTopic:p}=pv(n),{togglePublish:j}=ul("topics"),{togglePublish:x}=ul("activities"),{updatePosition:b,isUpdating:w}=Zd("topics"),{updatePosition:y,isUpdating:v}=Zd("activities"),{mutate:_}=pn(),{mutate:C}=pn(),k=i.get("expanded");if(m)return e.jsx(uk,{});if(!l)return e.jsx(G,{children:e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Nie znaleziono kursu"})})});const N=A=>{k===A.toString()?(i.delete("expanded"),r(i)):r({expanded:A.toString()})},z=(A,D)=>{confirm(`Czy na pewno chcesz usunąć temat "${D}" wraz ze wszystkimi aktywnościami?`)&&_({resource:"topics",id:A},{onSuccess:()=>{H.success("Temat został usunięty"),u(),h(),k===A.toString()&&(i.delete("expanded"),r(i))}})},T=(A,D)=>{confirm(`Czy na pewno chcesz usunąć aktywność "${D}"?`)&&C({resource:"activities",id:A},{onSuccess:()=>{H.success("Aktywność została usunięta"),h(),u()}})},f=async(A,D)=>{try{await b(A,D)}catch(P){console.error("Failed to reorder topic:",P)}},S=async(A,D)=>{try{await y(A,D)}catch(P){console.error("Failed to reorder activity:",P)}};return e.jsxs(G,{children:[e.jsxs(I,{variant:"outline",size:"sm",onClick:()=>t("courses"),children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Szczegóły kursu"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(I,{onClick:()=>a(`/teacher/course-structure/edit/${l?.id}`),size:"sm",variant:"secondary",children:[e.jsx(Ct,{className:"w-4 h-4 mr-2"}),"Edytuj z AI"]}),e.jsxs(I,{onClick:()=>s("courses",l?.id??0),size:"sm",children:[e.jsx(ls,{className:"w-4 h-4 mr-2"}),"Edytuj kurs"]})]})]}),e.jsx(Nv,{course:l})]}),e.jsx(mk,{course:l,topicsCount:d.topicsCount,activitiesCount:d.activitiesCount,accessCount:d.accessCount}),e.jsxs(M,{children:[e.jsx($,{children:e.jsxs(Y,{children:[e.jsxs(O,{className:"flex items-center gap-2",children:["Struktura kursu",(w||v)&&e.jsxs("span",{className:"text-sm font-normal text-muted-foreground flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),"Zapisywanie..."]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(I,{size:"sm",variant:"outline",onClick:()=>a(`/teacher/course-structure/edit/${l?.id}`),children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Dodaj tematy z AI"]}),e.jsxs(I,{size:"sm",onClick:()=>a(`/teacher/topics/create?course_id=${n}`),children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Dodaj temat"]})]})]})}),e.jsx(R,{children:c.length>0?e.jsx(du,{items:c,onReorder:f,disabled:w||v,renderItem:(A,D,P)=>{const L=p(A.id),K=k===A.id.toString();return e.jsx(wv,{topic:{...A,position:D+1},isExpanded:K,onToggle:()=>N(A.id),onDelete:z,onEdit:(E,U)=>a(`/${E}/edit/${U}`),onTogglePublish:(E,U,B)=>j(E,U,B,u),activitiesCount:L.length,onNavigateToWizard:o,courseId:Number(l?.id),courseTitle:l?.title,dragHandleProps:P,children:L.length>0?e.jsx(du,{items:L,onReorder:S,disabled:v,renderItem:(E,U,B)=>e.jsx(vv,{activity:{...E,position:U+1},topicPosition:D+1,onDelete:T,onEdit:(ae,le)=>a(`/${ae}/edit/${le}`),onTogglePublish:(ae,le,pe)=>x(ae,le,pe,h),dragHandleProps:B},E.id)}):e.jsxs("div",{className:"text-center py-6 text-muted-foreground",children:[e.jsx("p",{children:"Brak aktywności w tym temacie"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-center mt-4",children:[e.jsxs(I,{size:"sm",variant:"outline",onClick:()=>a(`/activities/create?topic_id=${A.id}`),children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Dodaj ręcznie"]}),e.jsxs(I,{size:"sm",onClick:()=>o("/teacher/educational-material/step1",{courseId:l?.id,courseTitle:l?.title,topicId:A.id,topicTitle:A.title}),children:[e.jsx(Ct,{className:"w-4 h-4 mr-2"}),"Generuj materiał z AI"]}),e.jsxs(I,{size:"sm",variant:"secondary",onClick:()=>o("/teacher/quiz-wizard/step1",{courseId:l?.id,courseTitle:l?.title,topicId:A.id,topicTitle:A.title}),children:[e.jsx(Us,{className:"w-4 h-4 mr-2"}),"Generuj quiz z AI"]})]})]})},A.id)}}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(is,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Brak tematów w tym kursie"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center mt-4",children:[e.jsxs(I,{onClick:()=>a(`/topics/create?course_id=${n}`),children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Dodaj pierwszy temat"]}),e.jsxs(I,{variant:"secondary",onClick:()=>a(`/teacher/course-structure/edit/${l?.id}`),children:[e.jsx(er,{className:"w-4 h-4 mr-2"}),"Wygeneruj strukturę z AI"]})]})]})})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Grupy z dostępem"})}),e.jsx(R,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(oe,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Lista grup (do implementacji)"})]})})]}),e.jsxs(M,{className:"border-dashed border-2 bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-950/20 dark:to-blue-950/20",children:[e.jsx($,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(Ct,{className:"w-5 h-5 text-purple-600"}),"Szybkie akcje AI"]})}),e.jsx(R,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx(I,{variant:"outline",className:"justify-start h-auto py-3 px-4 bg-white dark:bg-background",onClick:()=>a(`/teacher/course-structure/edit/${l?.id}`),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(er,{className:"w-5 h-5 text-indigo-600 mt-0.5"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"Rozbuduj strukturę kursu"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Dodaj nowe tematy z AI"})]})]})}),e.jsx(I,{variant:"outline",className:"justify-start h-auto py-3 px-4 bg-white dark:bg-background",onClick:()=>o("/educational-material/step1",{courseId:l?.id,courseTitle:l?.title}),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ua,{className:"w-5 h-5 text-purple-600 mt-0.5"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"Generuj materiał"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Stwórz treści z AI"})]})]})}),e.jsx(I,{variant:"outline",className:"justify-start h-auto py-3 px-4 bg-white dark:bg-background",onClick:()=>o("/quiz-wizard/step1",{courseId:l?.id,courseTitle:l?.title}),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Us,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"Stwórz quiz"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Quiz sprawdzający z AI"})]})]})})]})})]})]})},uu={name:"courses",list:"/teacher/courses",create:"/teacher/courses/create",edit:"/teacher/courses/edit/:id",show:"/teacher/courses/show/:id",meta:{label:"Kursy",icon:e.jsx(Se,{className:"h-4 w-4"})}},pk=[e.jsx(V,{path:"courses",element:e.jsx(xv,{})},"courses-list"),e.jsx(V,{path:"courses/create",element:e.jsx(jv,{})},"courses-create"),e.jsx(V,{path:"courses/edit/:id",element:e.jsx(bv,{})},"courses-edit"),e.jsx(V,{path:"courses/show/:id",element:e.jsx(fk,{})},"courses-show")],xk=()=>{const{edit:t,list:s}=Xe(),{mutate:n}=pi(),{mutate:i}=pn(),[r,a]=g.useState("all"),[o,l]=g.useState(!1),[c,d]=g.useState(null),m=r!=="all"?[{field:"course_id",operator:"eq",value:r}]:[],{data:u,isLoading:h,refetch:p}=Z({resource:"topics",meta:{populate:["courses"]},filters:m,pagination:{pageSize:20},sorters:[{field:"courses.title",order:"asc"},{field:"position",order:"asc"}]}),{data:j}=Z({resource:"courses",pagination:{pageSize:100},sorters:[{field:"title",order:"asc"}]}),x=u?.data||[],b=j?.data||[],w=async v=>{await n({resource:"topics",id:v.id,values:{is_published:!v.is_published},successNotification:()=>({message:v.is_published?"Temat został ukryty":"Temat został opublikowany",type:"success"})}),p()},y=v=>{d(v),l(!0)};return e.jsxs(G,{children:[e.jsxs(Y,{children:[e.jsx(ke,{title:"Tematy",description:"Zarządzaj tematami kursów"}),e.jsxs(Y,{variant:"start",className:"gap-2",children:[b.length>0&&e.jsxs(Ce,{value:r,onValueChange:a,children:[e.jsxs(we,{className:"w-[250px]",children:[e.jsx(Uh,{className:"h-4 w-4 mr-2"}),e.jsx(_e,{placeholder:"Filtruj po kursie"})]}),e.jsxs(ve,{children:[e.jsx(W,{value:"all",children:"Wszystkie kursy"}),e.jsx(it,{}),b.map(v=>e.jsx(W,{value:v.id.toString(),children:v.title},v.id))]})]}),e.jsxs(I,{onClick:()=>s("courses"),children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Przejdź do kursów"]})]})]}),e.jsx(M,{children:e.jsx(R,{className:"p-0",children:h?e.jsx("div",{className:"p-8",children:e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((v,_)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(nn,{className:"h-12 w-12"}),e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(nn,{className:"h-4 w-3/4"}),e.jsx(nn,{className:"h-4 w-1/2"})]})]},_))})}):x.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Se,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium text-muted-foreground",children:r!=="all"?"Brak tematów w wybranym kursie":"Brak tematów"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Aby dodać temat, przejdź do kursu"}),e.jsxs(I,{onClick:()=>s("courses"),children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Przejdź do kursów"]})]}):e.jsxs(Nn,{children:[e.jsx(kn,{children:e.jsxs(ut,{children:[e.jsx(ie,{className:"w-[50px]",children:"#"}),e.jsx(ie,{children:"Tytuł"}),e.jsx(ie,{className:"w-[200px]",children:"Kurs"}),e.jsx(ie,{className:"w-[120px]",children:"Status"}),e.jsx(ie,{className:"w-[140px]",children:"Data utworzenia"}),e.jsx(ie,{className:"text-right w-[80px]",children:"Akcje"})]})}),e.jsx(zn,{children:x.map(v=>e.jsxs(ut,{children:[e.jsx(re,{className:"font-medium",children:e.jsx(q,{variant:"outline",className:"w-12 justify-center",children:v.position})}),e.jsx(re,{children:e.jsx("div",{className:"font-medium",children:v.title})}),e.jsx(re,{className:"max-w-[200px]",children:e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(Se,{className:"h-4 w-4 mr-2 text-muted-foreground shrink-0"}),e.jsx("span",{className:"truncate block",title:v.courses?.title||"Brak kursu",children:v.courses?.title||"Brak kursu"})]})}),e.jsx(re,{children:e.jsx(q,{variant:v.is_published?"default":"secondary",children:v.is_published?"Opublikowany":"Szkic"})}),e.jsx(re,{children:e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground",children:[e.jsx(Ve,{className:"h-4 w-4 mr-2"}),new Date(v.created_at).toLocaleDateString("pl-PL")]})}),e.jsx(re,{className:"text-right",children:e.jsxs(oi,{children:[e.jsx(li,{asChild:!0,children:e.jsxs(I,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Otwórz menu"}),e.jsx(ib,{className:"h-4 w-4"})]})}),e.jsxs(jn,{align:"end",children:[e.jsxs(de,{onClick:()=>t("topics",v.id),children:[e.jsx(ls,{className:"mr-2 h-4 w-4"}),"Edytuj"]}),e.jsx(it,{}),e.jsx(de,{onClick:()=>w(v),children:v.is_published?e.jsxs(e.Fragment,{children:[e.jsx(un,{className:"mr-2 h-4 w-4"}),"Ukryj temat"]}):e.jsxs(e.Fragment,{children:[e.jsx(rb,{className:"mr-2 h-4 w-4"}),"Opublikuj temat"]})}),e.jsx(it,{}),e.jsxs(de,{onClick:()=>y(v),className:"text-destructive focus:text-destructive",children:[e.jsx(ns,{className:"mr-2 h-4 w-4"}),"Usuń temat"]})]})]})})]},v.id))})]})})})]})},gk=()=>{const{show:t}=Xe(),s=me(),[n]=Ma(),i=n.get("course_id"),{data:r}=Ye({resource:"courses",id:i,queryOptions:{enabled:!!i}}),{data:a,isLoading:o}=Z({resource:"topics",filters:[{field:"course_id",operator:"eq",value:i}],sorters:[{field:"position",order:"desc"}],pagination:{pageSize:1},queryOptions:{enabled:!!i}}),{refineCore:{onFinish:l},register:c,handleSubmit:d,setValue:m,watch:u,formState:{errors:h,isSubmitting:p}}=Zs({defaultValues:{course_id:i?parseInt(i):void 0,is_published:!1,position:1},refineCoreProps:{successNotification:()=>({message:"Temat został utworzony",type:"success"}),redirect:!1,onMutationSuccess:()=>{i?t("courses",i):s("/courses")}}});g.useEffect(()=>{if(!o&&a&&a.data.length>0){const x=a.data[0].position+1;m("position",x)}},[a,o,m]);const j=()=>{i?t("courses",i):s("/courses")};return e.jsxs(G,{children:[e.jsxs(I,{variant:"outline",size:"sm",onClick:j,children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Powrót do kursu"]}),e.jsx(Y,{children:e.jsx(ke,{title:"Dodaj temat",description:r?.data?`Do kursu: ${r.data.title}`:"Utwórz nowy temat"})}),e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Informacje o temacie"})}),e.jsx(R,{children:e.jsxs(Qs,{onSubmit:d(l),children:[e.jsx("input",{type:"hidden",...c("course_id")}),e.jsx(se,{label:"Tytuł tematu",htmlFor:"title",error:h.title?.message,required:!0,children:e.jsx(J,{id:"title",placeholder:"np. Wprowadzenie do zmiennych",...c("title",{required:"Tytuł tematu jest wymagany",minLength:{value:3,message:"Tytuł musi mieć minimum 3 znaki"}})})}),e.jsx(se,{label:"Pozycja",htmlFor:"position",error:h.position?.message,required:!0,children:e.jsx(J,{id:"position",type:"number",min:"1",disabled:!0,className:"bg-muted",...c("position",{required:"Pozycja jest wymagana",min:{value:1,message:"Pozycja musi być większa od 0"},valueAsNumber:!0})})}),e.jsx(se,{label:"Status publikacji",children:e.jsxs(Y,{variant:"start",children:[e.jsx(Bt,{checked:u("is_published")||!1,onCheckedChange:x=>m("is_published",x)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Opublikuj temat od razu"})]})}),e.jsxs(Ys,{children:[e.jsx(I,{type:"button",variant:"outline",onClick:j,children:"Anuluj"}),e.jsx(I,{type:"submit",disabled:p||!i,children:p?"Tworzenie...":"Utwórz temat"})]})]})})]})]})},yn=({variant:t="outline",size:s="sm",children:n="Powrót do kursu"})=>{const i=me(),r=hi(),a=()=>{const o=sessionStorage.getItem("returnUrl");if(o){sessionStorage.removeItem("returnUrl"),i(o);return}const c=new URLSearchParams(r.search).get("returnUrl");if(c){i(decodeURIComponent(c));return}i(-1)};return e.jsxs(I,{variant:t,size:s,onClick:a,children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),n]})},jk=()=>{const{show:t}=Xe(),{id:s}=mt(),n=me(),{data:i,isLoading:r}=Ye({resource:"topics",id:s,liveMode:"off"}),a=i?.data,o=a?.course_id,{refineCore:{onFinish:l},register:c,handleSubmit:d,setValue:m,watch:u,formState:{errors:h,isSubmitting:p}}=Zs({refineCoreProps:{resource:"topics",id:s,liveMode:"off",successNotification:()=>({message:"Temat został zaktualizowany",type:"success"}),redirect:!1,onMutationSuccess:()=>{const x=sessionStorage.getItem("returnUrl");x?(sessionStorage.removeItem("returnUrl"),n(x)):o&&n(`/teacher/courses/show/${o}?expanded=${s}`)}}}),j=()=>{const x=sessionStorage.getItem("returnUrl");x?(sessionStorage.removeItem("returnUrl"),n(x)):o?n(`/teacher/courses/show/${o}?expanded=${s}`):t("courses","")};return r?e.jsx(G,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):e.jsxs(G,{children:[e.jsx(yn,{}),e.jsx(Y,{children:e.jsx(ke,{title:"Edytuj temat",description:`Edycja: ${a?.title}`})}),e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Informacje o temacie"})}),e.jsx(R,{children:e.jsxs(Qs,{onSubmit:d(l),children:[e.jsx(se,{label:"Tytuł tematu",htmlFor:"title",error:h.title?.message,required:!0,children:e.jsx(J,{id:"title",placeholder:"np. Wprowadzenie do zmiennych",...c("title",{required:"Tytuł tematu jest wymagany",minLength:{value:3,message:"Tytuł musi mieć minimum 3 znaki"}})})}),e.jsx(se,{label:"Pozycja",htmlFor:"position",error:h.position?.message,required:!0,children:e.jsx(J,{id:"position",type:"number",min:"1",...c("position",{required:"Pozycja jest wymagana",min:{value:1,message:"Pozycja musi być większa od 0"},valueAsNumber:!0})})}),e.jsx(se,{label:"Status publikacji",children:e.jsxs(Y,{variant:"start",children:[e.jsx(Bt,{checked:u("is_published")||!1,onCheckedChange:x=>m("is_published",x)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Temat jest opublikowany"})]})}),e.jsxs(Ys,{children:[e.jsx(I,{type:"button",variant:"outline",onClick:j,children:"Anuluj"}),e.jsx(I,{type:"submit",disabled:p,children:p?"Zapisywanie...":"Zapisz zmiany"})]})]})})]})]})},mu={name:"topics",list:"/teacher/topics",create:"/teacher/topics/create",edit:"/teacher/topics/edit/:id",meta:{label:"Tematy",icon:e.jsx(is,{className:"h-4 w-4"})}},yk=[e.jsx(V,{path:"topics",element:e.jsx(xk,{})},"topics-list"),e.jsx(V,{path:"topics/create",element:e.jsx(gk,{})},"topics-create"),e.jsx(V,{path:"topics/edit/:id",element:e.jsx(jk,{})},"topics-edit")],bk=()=>{const{show:t}=Xe(),s=me(),[n]=Ma(),i=n.get("topic_id"),{data:r}=Ye({resource:"topics",id:i,meta:{select:"*, courses(*)"},queryOptions:{enabled:!!i}}),{data:a,isLoading:o}=Z({resource:"activities",filters:[{field:"topic_id",operator:"eq",value:i}],sorters:[{field:"position",order:"desc"}],pagination:{pageSize:1},queryOptions:{enabled:!!i}}),{refineCore:{onFinish:l},register:c,handleSubmit:d,setValue:m,watch:u,formState:{errors:h,isSubmitting:p}}=Zs({defaultValues:{topic_id:i?parseInt(i):void 0,type:"material",is_published:!1,position:1,passing_score:70},refineCoreProps:{successNotification:!1,redirect:!1,onMutationSuccess:b=>{const w=r?.data?.course_id,y=b.data.type;if(H.success("Aktywność została utworzona"),y==="quiz")H.info("Dodaj pytania do quizu"),s(`/teacher/questions/manage/${b.data.id}`);else{const v=sessionStorage.getItem("returnUrl");v?(sessionStorage.removeItem("returnUrl"),s(v)):s(w?`/teacher/courses/show/${w}?expanded=${i}`:"/teacher/courses")}}}}),j=u("type");g.useEffect(()=>{if(!o&&a&&a.data.length>0){const b=a.data[0].position+1;m("position",b)}},[a,o,m]);const x=()=>{const b=sessionStorage.getItem("returnUrl");b?(sessionStorage.removeItem("returnUrl"),s(b)):r?.data?.course_id?s(`/courses/show/${r.data.course_id}?expanded=${i}`):s("/courses")};return r?.data?.course_id,i?e.jsxs(G,{children:[e.jsx(yn,{}),e.jsx(Y,{children:e.jsx(ke,{title:"Dodaj aktywność",description:r?.data?e.jsxs("div",{children:[e.jsx("div",{className:"text-lg",children:r.data.courses?.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Temat ",r.data.position,": ",r.data.title]})]}):"Utwórz nowy materiał lub quiz"})}),e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Informacje o aktywności"})}),e.jsx(R,{children:e.jsxs(Qs,{onSubmit:d(l),children:[e.jsx("input",{type:"hidden",...c("topic_id")}),e.jsxs(rt,{variant:"1-2-2",children:[e.jsx(se,{label:"Typ aktywności",error:h.type?.message,required:!0,children:e.jsxs(Ce,{value:j,onValueChange:b=>m("type",b),children:[e.jsx(we,{children:e.jsx(_e,{placeholder:"Wybierz typ"})}),e.jsxs(ve,{children:[e.jsx(W,{value:"material",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(is,{className:"w-4 h-4"}),"Materiał"]})}),e.jsx(W,{value:"quiz",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(vt,{className:"w-4 h-4"}),"Quiz"]})})]})]})}),e.jsx(se,{label:"Tytuł",htmlFor:"title",error:h.title?.message,required:!0,children:e.jsx(J,{id:"title",placeholder:j==="quiz"?"np. Test wiedzy z rozdziału":"np. Wprowadzenie do tematu",...c("title",{required:"Tytuł jest wymagany",minLength:{value:3,message:"Tytuł musi mieć minimum 3 znaki"}})})}),e.jsx(se,{label:"Pozycja w temacie",htmlFor:"position",error:h.position?.message,required:!0,children:e.jsx(J,{id:"position",type:"number",min:"1",disabled:!0,className:"bg-muted",...c("position",{required:"Pozycja jest wymagana",min:{value:1,message:"Pozycja musi być większa od 0"},valueAsNumber:!0})})}),e.jsx(se,{label:"Czas trwania (min)",htmlFor:"duration_min",hint:"Szacowany czas potrzebny na ukończenie",children:e.jsx(J,{id:"duration_min",type:"number",min:"1",placeholder:"np. 15",...c("duration_min",{min:{value:1,message:"Czas musi być większy od 0"},valueAsNumber:!0})})})]}),j==="material"&&e.jsx(se,{label:"Treść materiału",htmlFor:"content",error:h.content?.message,required:!0,hint:"Możesz używać formatowania Markdown",children:e.jsx(ks,{id:"content",placeholder:"Wprowadź treść materiału edukacyjnego...",rows:10,...c("content",{required:j==="material"?"Treść jest wymagana dla materiału":!1})})}),j==="quiz"&&e.jsxs(e.Fragment,{children:[e.jsxs(rt,{variant:"1-1-1",children:[e.jsx(se,{label:"Próg zaliczenia (%)",htmlFor:"passing_score",error:h.passing_score?.message,hint:"Minimalny wynik do zaliczenia",children:e.jsx(J,{id:"passing_score",type:"number",min:"0",max:"100",...c("passing_score",{min:{value:0,message:"Wartość minimalna to 0"},max:{value:100,message:"Wartość maksymalna to 100"},valueAsNumber:!0})})}),e.jsx(se,{label:"Limit czasu (min)",htmlFor:"time_limit",hint:"Pozostaw puste dla braku limitu",children:e.jsx(J,{id:"time_limit",type:"number",min:"1",placeholder:"Brak limitu",...c("time_limit",{min:{value:1,message:"Limit musi być większy od 0"},valueAsNumber:!0})})}),e.jsx(se,{label:"Maksymalna liczba prób",htmlFor:"max_attempts",hint:"Pozostaw puste dla nieograniczonej liczby",children:e.jsx(J,{id:"max_attempts",type:"number",min:"1",placeholder:"Bez limitu",...c("max_attempts",{min:{value:1,message:"Minimum 1 próba"},valueAsNumber:!0})})})]}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{className:"text-blue-700 dark:text-blue-300",children:"💡 Wskazówka:"})," ",e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:"Po utworzeniu quizu zostaniesz przekierowany do ekranu dodawania pytań."})]})})]}),e.jsx(se,{label:"Status publikacji",children:e.jsxs(Y,{variant:"start",children:[e.jsx(Bt,{checked:u("is_published")||!1,onCheckedChange:b=>m("is_published",b)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Opublikuj aktywność od razu (uczniowie będą mogli ją zobaczyć)"})]})}),e.jsxs(Ys,{children:[e.jsx(I,{type:"button",variant:"outline",onClick:x,disabled:p,children:"Anuluj"}),e.jsx(I,{type:"submit",disabled:p||!i,children:p?"Tworzenie...":j==="quiz"?"Utwórz i dodaj pytania":"Utwórz aktywność"})]})]})})]})]}):e.jsx(G,{children:e.jsx(M,{children:e.jsxs(R,{className:"text-center py-12",children:[e.jsx("p",{className:"text-lg font-medium text-muted-foreground mb-4",children:"Nie wybrano tematu"}),e.jsx(I,{onClick:()=>s("/courses"),children:"Przejdź do kursów"})]})})})},wk=()=>{const{list:t}=Xe(),{id:s}=mt(),n=me(),{data:i,isLoading:r}=Ye({resource:"activities",id:s,liveMode:"off",meta:{select:"*, topics(*, courses(*))"}}),{data:a}=Ye({resource:"questions",id:s,meta:{select:"count",filter:`activity_id.eq.${s}`},queryOptions:{enabled:!!s&&i?.data?.type==="quiz"}}),{refineCore:{onFinish:o,formLoading:l},register:c,handleSubmit:d,setValue:m,watch:u,reset:h,formState:{errors:p,isSubmitting:j}}=Zs({refineCoreProps:{resource:"activities",id:s,liveMode:"off",redirect:!1,successNotification:!1,onMutationSuccess:()=>{const T=i?.data?.topics?.course_id,f=i?.data?.topic_id;H.success("Aktywność została zaktualizowana");const S=sessionStorage.getItem("returnUrl");S?(sessionStorage.removeItem("returnUrl"),n(S)):T?n(`/teacher/courses/show/${T}?expanded=${f}`):t("activities")},onMutationError:T=>{console.error("Błąd podczas aktualizacji:",T),T?.code==="PGRST204"?H.error("Błąd konfiguracji - skontaktuj się z administratorem"):T?.code==="23505"?H.error("Aktywność o tej pozycji już istnieje w tym temacie"):T?.code==="23503"?H.error("Nieprawidłowe powiązanie z tematem"):T?.message?H.error(`Błąd: ${T.message}`):H.error("Wystąpił nieoczekiwany błąd. Spróbuj ponownie.")}}});g.useEffect(()=>{if(i?.data){const{topics:T,_count:f,questions:S,...A}=i.data;h(A)}},[i,h]);const x=u("type")||i?.data?.type||"material";if(r||l)return e.jsx(G,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const b=i?.data,w=b?.topics,y=w?.courses,v=y?.id,_=b?.topic_id,C=()=>{const T=sessionStorage.getItem("returnUrl");T?(sessionStorage.removeItem("returnUrl"),n(T)):v?n(`/teacher/courses/show/${v}?expanded=${_}`):t("activities")},k=()=>x==="quiz"?e.jsx(vt,{className:"w-6 h-6 text-blue-500"}):e.jsx(is,{className:"w-6 h-6 text-green-500"}),N=()=>{const T=window.location.pathname+window.location.search;sessionStorage.setItem("returnUrl",T),n(`/teacher/questions/manage/${b?.id}`)},z=a?.data?.[0]?.count||0;return e.jsxs(G,{children:[e.jsx(yn,{}),e.jsxs(Y,{children:[e.jsx(ke,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[k(),"Edytuj aktywność"]}),description:e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-medium",children:b?.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[y?.title," → Temat ",w?.position,": ",w?.title]})]})}),x==="quiz"&&e.jsxs(I,{onClick:N,variant:"outline",children:[e.jsx(dn,{className:"w-4 h-4 mr-2"}),"Zarządzaj pytaniami (",z,")"]})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Informacje o aktywności"})}),e.jsx(R,{children:e.jsxs(Qs,{onSubmit:d(o),children:[e.jsxs(rt,{variant:"1-2-2",children:[e.jsxs(se,{label:"Typ aktywności",error:p.type?.message,required:!0,children:[e.jsxs(Ce,{value:x,disabled:!0,children:[e.jsx(we,{className:"bg-muted",children:e.jsx(_e,{placeholder:"Wybierz typ"})}),e.jsxs(ve,{children:[e.jsx(W,{value:"material",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(is,{className:"w-4 h-4"}),"Materiał"]})}),e.jsx(W,{value:"quiz",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(vt,{className:"w-4 h-4"}),"Quiz"]})})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Typ aktywności nie może być zmieniony"})]}),e.jsx(se,{label:"Tytuł",htmlFor:"title",error:p.title?.message,required:!0,children:e.jsx(J,{id:"title",placeholder:x==="quiz"?"np. Test wiedzy":"np. Wprowadzenie",...c("title",{required:"Tytuł jest wymagany",minLength:{value:3,message:"Tytuł musi mieć minimum 3 znaki"}})})}),e.jsx(se,{label:"Pozycja w temacie",htmlFor:"position",error:p.position?.message,required:!0,children:e.jsx(J,{id:"position",type:"number",min:"1",...c("position",{required:"Pozycja jest wymagana",min:{value:1,message:"Pozycja musi być większa od 0"},valueAsNumber:!0})})}),e.jsx(se,{label:"Czas trwania (min)",htmlFor:"duration_min",hint:"Szacowany czas potrzebny na ukończenie",children:e.jsx(J,{id:"duration_min",type:"number",min:"1",placeholder:"np. 15",...c("duration_min",{min:{value:1,message:"Czas musi być większy od 0"},valueAsNumber:!0})})})]}),x==="material"&&e.jsx(se,{label:"Treść materiału",htmlFor:"content",error:p.content?.message,required:!0,hint:"Możesz używać formatowania Markdown",children:e.jsx(ks,{id:"content",placeholder:"Wprowadź treść materiału...",rows:10,...c("content",{required:x==="material"?"Treść jest wymagana dla materiału":!1})})}),x==="quiz"&&e.jsxs(e.Fragment,{children:[e.jsxs(rt,{variant:"1-1-1",children:[e.jsx(se,{label:"Próg zaliczenia (%)",htmlFor:"passing_score",error:p.passing_score?.message,hint:"Minimalny wynik do zaliczenia",children:e.jsx(J,{id:"passing_score",type:"number",min:"0",max:"100",...c("passing_score",{min:{value:0,message:"Wartość minimalna to 0"},max:{value:100,message:"Wartość maksymalna to 100"},valueAsNumber:!0})})}),e.jsx(se,{label:"Limit czasu (min)",htmlFor:"time_limit",hint:"Pozostaw puste dla braku limitu",children:e.jsx(J,{id:"time_limit",type:"number",min:"1",placeholder:"Brak limitu",...c("time_limit",{min:{value:1,message:"Limit musi być większy od 0"},valueAsNumber:!0})})}),e.jsx(se,{label:"Maksymalna liczba prób",htmlFor:"max_attempts",hint:"Pozostaw puste dla nieograniczonej liczby",children:e.jsx(J,{id:"max_attempts",type:"number",min:"1",placeholder:"Bez limitu",...c("max_attempts",{min:{value:1,message:"Minimum 1 próba"},valueAsNumber:!0})})})]}),z>0&&e.jsx(M,{className:"mt-4 bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800",children:e.jsx(R,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium",children:["Ten quiz zawiera ",z," ",z===1?"pytanie":"pytań"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Możesz zarządzać pytaniami klikając przycisk powyżej"})]}),e.jsx(q,{variant:"outline",className:"text-lg px-3 py-1",children:z})]})})})]}),e.jsx(se,{label:"Status publikacji",children:e.jsxs(Y,{variant:"start",children:[e.jsx(Bt,{checked:u("is_published")||!1,onCheckedChange:T=>m("is_published",T)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Aktywność jest opublikowana (uczniowie mogą ją zobaczyć)"})]})}),e.jsxs(Ys,{children:[e.jsx(I,{type:"button",variant:"outline",onClick:C,disabled:j,children:"Anuluj"}),e.jsx(I,{type:"submit",disabled:j,children:j?"Zapisywanie...":"Zapisz zmiany"})]})]})})]})]})};function hu(t,s){const n=String(t);if(typeof s!="string")throw new TypeError("Expected character");let i=0,r=n.indexOf(s);for(;r!==-1;)i++,r=n.indexOf(s,r+s.length);return i}function vk(t){if(typeof t!="string")throw new TypeError("Expected a string");return t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function Nk(t,s,n){const r=Ih((n||{}).ignore||[]),a=kk(s);let o=-1;for(;++o<a.length;)Ry(t,"text",l);function l(d,m){let u=-1,h;for(;++u<m.length;){const p=m[u],j=h?h.children:void 0;if(r(p,j?j.indexOf(p):void 0,h))return;h=p}if(h)return c(d,m)}function c(d,m){const u=m[m.length-1],h=a[o][0],p=a[o][1];let j=0;const b=u.children.indexOf(d);let w=!1,y=[];h.lastIndex=0;let v=h.exec(d.value);for(;v;){const _=v.index,C={index:v.index,input:v.input,stack:[...m,d]};let k=p(...v,C);if(typeof k=="string"&&(k=k.length>0?{type:"text",value:k}:void 0),k===!1?h.lastIndex=_+1:(j!==_&&y.push({type:"text",value:d.value.slice(j,_)}),Array.isArray(k)?y.push(...k):k&&y.push(k),j=_+v[0].length,w=!0),!h.global)break;v=h.exec(d.value)}return w?(j<d.value.length&&y.push({type:"text",value:d.value.slice(j)}),u.children.splice(b,1,...y)):y=[d],b+y.length}}function kk(t){const s=[];if(!Array.isArray(t))throw new TypeError("Expected find and replace tuple or list of tuples");const n=!t[0]||Array.isArray(t[0])?t:[t];let i=-1;for(;++i<n.length;){const r=n[i];s.push([zk(r[0]),Sk(r[1])])}return s}function zk(t){return typeof t=="string"?new RegExp(vk(t),"g"):t}function Sk(t){return typeof t=="function"?t:function(){return t}}const Mo="phrasing",Ro=["autolink","link","image","label"];function Ck(){return{transforms:[Rk],enter:{literalAutolink:Tk,literalAutolinkEmail:Io,literalAutolinkHttp:Io,literalAutolinkWww:Io},exit:{literalAutolink:Mk,literalAutolinkEmail:Pk,literalAutolinkHttp:Ak,literalAutolinkWww:Dk}}}function _k(){return{unsafe:[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:Mo,notInConstruct:Ro},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:Mo,notInConstruct:Ro},{character:":",before:"[ps]",after:"\\/",inConstruct:Mo,notInConstruct:Ro}]}}function Tk(t){this.enter({type:"link",title:null,url:"",children:[]},t)}function Io(t){this.config.enter.autolinkProtocol.call(this,t)}function Ak(t){this.config.exit.autolinkProtocol.call(this,t)}function Dk(t){this.config.exit.data.call(this,t);const s=this.stack[this.stack.length-1];fi(s.type==="link"),s.url="http://"+this.sliceSerialize(t)}function Pk(t){this.config.exit.autolinkEmail.call(this,t)}function Mk(t){this.exit(t)}function Rk(t){Nk(t,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,Ik],[/(?<=^|\s|\p{P}|\p{S})([-.\w+]+)@([-\w]+(?:\.[-\w]+)+)/gu,Ek]],{ignore:["link","linkReference"]})}function Ik(t,s,n,i,r){let a="";if(!Ip(r)||(/^w/i.test(s)&&(n=s+n,s="",a="http://"),!Lk(n)))return!1;const o=Ok(n+i);if(!o[0])return!1;const l={type:"link",title:null,url:a+s+o[0],children:[{type:"text",value:s+o[0]}]};return o[1]?[l,{type:"text",value:o[1]}]:l}function Ek(t,s,n,i){return!Ip(i,!0)||/[-\d_]$/.test(n)?!1:{type:"link",title:null,url:"mailto:"+s+"@"+n,children:[{type:"text",value:s+"@"+n}]}}function Lk(t){const s=t.split(".");return!(s.length<2||s[s.length-1]&&(/_/.test(s[s.length-1])||!/[a-zA-Z\d]/.test(s[s.length-1]))||s[s.length-2]&&(/_/.test(s[s.length-2])||!/[a-zA-Z\d]/.test(s[s.length-2])))}function Ok(t){const s=/[!"&'),.:;<>?\]}]+$/.exec(t);if(!s)return[t,void 0];t=t.slice(0,s.index);let n=s[0],i=n.indexOf(")");const r=hu(t,"(");let a=hu(t,")");for(;i!==-1&&r>a;)t+=n.slice(0,i+1),n=n.slice(i+1),i=n.indexOf(")"),a++;return[t,n]}function Ip(t,s){const n=t.input.charCodeAt(t.index-1);return(t.index===0||si(n)||Xl(n))&&(!s||n!==47)}Ep.peek=Gk;function $k(){this.buffer()}function Fk(t){this.enter({type:"footnoteReference",identifier:"",label:""},t)}function Bk(){this.buffer()}function Uk(t){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},t)}function Vk(t){const s=this.resume(),n=this.stack[this.stack.length-1];fi(n.type==="footnoteReference"),n.identifier=wr(this.sliceSerialize(t)).toLowerCase(),n.label=s}function qk(t){this.exit(t)}function Kk(t){const s=this.resume(),n=this.stack[this.stack.length-1];fi(n.type==="footnoteDefinition"),n.identifier=wr(this.sliceSerialize(t)).toLowerCase(),n.label=s}function Wk(t){this.exit(t)}function Gk(){return"["}function Ep(t,s,n,i){const r=n.createTracker(i);let a=r.move("[^");const o=n.enter("footnoteReference"),l=n.enter("reference");return a+=r.move(n.safe(n.associationId(t),{after:"]",before:a})),l(),o(),a+=r.move("]"),a}function Hk(){return{enter:{gfmFootnoteCallString:$k,gfmFootnoteCall:Fk,gfmFootnoteDefinitionLabelString:Bk,gfmFootnoteDefinition:Uk},exit:{gfmFootnoteCallString:Vk,gfmFootnoteCall:qk,gfmFootnoteDefinitionLabelString:Kk,gfmFootnoteDefinition:Wk}}}function Zk(t){let s=!1;return t&&t.firstLineBlank&&(s=!0),{handlers:{footnoteDefinition:n,footnoteReference:Ep},unsafe:[{character:"[",inConstruct:["label","phrasing","reference"]}]};function n(i,r,a,o){const l=a.createTracker(o);let c=l.move("[^");const d=a.enter("footnoteDefinition"),m=a.enter("label");return c+=l.move(a.safe(a.associationId(i),{before:c,after:"]"})),m(),c+=l.move("]:"),i.children&&i.children.length>0&&(l.shift(4),c+=l.move((s?`
`:" ")+a.indentLines(a.containerFlow(i,l.current()),s?Lp:Qk))),d(),c}}function Qk(t,s,n){return s===0?t:Lp(t,s,n)}function Lp(t,s,n){return(n?"":"    ")+t}const Yk=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"];Op.peek=s1;function Xk(){return{canContainEols:["delete"],enter:{strikethrough:e1},exit:{strikethrough:t1}}}function Jk(){return{unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:Yk}],handlers:{delete:Op}}}function e1(t){this.enter({type:"delete",children:[]},t)}function t1(t){this.exit(t)}function Op(t,s,n,i){const r=n.createTracker(i),a=n.enter("strikethrough");let o=r.move("~~");return o+=n.containerPhrasing(t,{...r.current(),before:o,after:"~"}),o+=r.move("~~"),a(),o}function s1(){return"~"}function n1(t){return t.length}function i1(t,s){const n=s||{},i=(n.align||[]).concat(),r=n.stringLength||n1,a=[],o=[],l=[],c=[];let d=0,m=-1;for(;++m<t.length;){const x=[],b=[];let w=-1;for(t[m].length>d&&(d=t[m].length);++w<t[m].length;){const y=r1(t[m][w]);if(n.alignDelimiters!==!1){const v=r(y);b[w]=v,(c[w]===void 0||v>c[w])&&(c[w]=v)}x.push(y)}o[m]=x,l[m]=b}let u=-1;if(typeof i=="object"&&"length"in i)for(;++u<d;)a[u]=fu(i[u]);else{const x=fu(i);for(;++u<d;)a[u]=x}u=-1;const h=[],p=[];for(;++u<d;){const x=a[u];let b="",w="";x===99?(b=":",w=":"):x===108?b=":":x===114&&(w=":");let y=n.alignDelimiters===!1?1:Math.max(1,c[u]-b.length-w.length);const v=b+"-".repeat(y)+w;n.alignDelimiters!==!1&&(y=b.length+y+w.length,y>c[u]&&(c[u]=y),p[u]=y),h[u]=v}o.splice(1,0,h),l.splice(1,0,p),m=-1;const j=[];for(;++m<o.length;){const x=o[m],b=l[m];u=-1;const w=[];for(;++u<d;){const y=x[u]||"";let v="",_="";if(n.alignDelimiters!==!1){const C=c[u]-(b[u]||0),k=a[u];k===114?v=" ".repeat(C):k===99?C%2?(v=" ".repeat(C/2+.5),_=" ".repeat(C/2-.5)):(v=" ".repeat(C/2),_=v):_=" ".repeat(C)}n.delimiterStart!==!1&&!u&&w.push("|"),n.padding!==!1&&!(n.alignDelimiters===!1&&y==="")&&(n.delimiterStart!==!1||u)&&w.push(" "),n.alignDelimiters!==!1&&w.push(v),w.push(y),n.alignDelimiters!==!1&&w.push(_),n.padding!==!1&&w.push(" "),(n.delimiterEnd!==!1||u!==d-1)&&w.push("|")}j.push(n.delimiterEnd===!1?w.join("").replace(/ +$/,""):w.join(""))}return j.join(`
`)}function r1(t){return t==null?"":String(t)}function fu(t){const s=typeof t=="string"?t.codePointAt(0):0;return s===67||s===99?99:s===76||s===108?108:s===82||s===114?114:0}function a1(t,s,n,i){const r=n.enter("blockquote"),a=n.createTracker(i);a.move("> "),a.shift(2);const o=n.indentLines(n.containerFlow(t,a.current()),o1);return r(),o}function o1(t,s,n){return">"+(n?"":" ")+t}function l1(t,s){return pu(t,s.inConstruct,!0)&&!pu(t,s.notInConstruct,!1)}function pu(t,s,n){if(typeof s=="string"&&(s=[s]),!s||s.length===0)return n;let i=-1;for(;++i<s.length;)if(t.includes(s[i]))return!0;return!1}function xu(t,s,n,i){let r=-1;for(;++r<n.unsafe.length;)if(n.unsafe[r].character===`
`&&l1(n.stack,n.unsafe[r]))return/[ \t]/.test(i.before)?"":" ";return`\\
`}function c1(t,s){const n=String(t);let i=n.indexOf(s),r=i,a=0,o=0;if(typeof s!="string")throw new TypeError("Expected substring");for(;i!==-1;)i===r?++a>o&&(o=a):a=1,r=i+s.length,i=n.indexOf(s,r);return o}function d1(t,s){return!!(s.options.fences===!1&&t.value&&!t.lang&&/[^ \r\n]/.test(t.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(t.value))}function u1(t){const s=t.options.fence||"`";if(s!=="`"&&s!=="~")throw new Error("Cannot serialize code with `"+s+"` for `options.fence`, expected `` ` `` or `~`");return s}function m1(t,s,n,i){const r=u1(n),a=t.value||"",o=r==="`"?"GraveAccent":"Tilde";if(d1(t,n)){const u=n.enter("codeIndented"),h=n.indentLines(a,h1);return u(),h}const l=n.createTracker(i),c=r.repeat(Math.max(c1(a,r)+1,3)),d=n.enter("codeFenced");let m=l.move(c);if(t.lang){const u=n.enter(`codeFencedLang${o}`);m+=l.move(n.safe(t.lang,{before:m,after:" ",encode:["`"],...l.current()})),u()}if(t.lang&&t.meta){const u=n.enter(`codeFencedMeta${o}`);m+=l.move(" "),m+=l.move(n.safe(t.meta,{before:m,after:`
`,encode:["`"],...l.current()})),u()}return m+=l.move(`
`),a&&(m+=l.move(a+`
`)),m+=l.move(c),d(),m}function h1(t,s,n){return(n?"":"    ")+t}function Cc(t){const s=t.options.quote||'"';if(s!=='"'&&s!=="'")throw new Error("Cannot serialize title with `"+s+"` for `options.quote`, expected `\"`, or `'`");return s}function f1(t,s,n,i){const r=Cc(n),a=r==='"'?"Quote":"Apostrophe",o=n.enter("definition");let l=n.enter("label");const c=n.createTracker(i);let d=c.move("[");return d+=c.move(n.safe(n.associationId(t),{before:d,after:"]",...c.current()})),d+=c.move("]: "),l(),!t.url||/[\0- \u007F]/.test(t.url)?(l=n.enter("destinationLiteral"),d+=c.move("<"),d+=c.move(n.safe(t.url,{before:d,after:">",...c.current()})),d+=c.move(">")):(l=n.enter("destinationRaw"),d+=c.move(n.safe(t.url,{before:d,after:t.title?" ":`
`,...c.current()}))),l(),t.title&&(l=n.enter(`title${a}`),d+=c.move(" "+r),d+=c.move(n.safe(t.title,{before:d,after:r,...c.current()})),d+=c.move(r),l()),o(),d}function p1(t){const s=t.options.emphasis||"*";if(s!=="*"&&s!=="_")throw new Error("Cannot serialize emphasis with `"+s+"` for `options.emphasis`, expected `*`, or `_`");return s}function dr(t){return"&#x"+t.toString(16).toUpperCase()+";"}function wa(t,s,n){const i=da(t),r=da(s);return i===void 0?r===void 0?n==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:r===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:i===1?r===void 0?{inside:!1,outside:!1}:r===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:r===void 0?{inside:!1,outside:!1}:r===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}$p.peek=x1;function $p(t,s,n,i){const r=p1(n),a=n.enter("emphasis"),o=n.createTracker(i),l=o.move(r);let c=o.move(n.containerPhrasing(t,{after:r,before:l,...o.current()}));const d=c.charCodeAt(0),m=wa(i.before.charCodeAt(i.before.length-1),d,r);m.inside&&(c=dr(d)+c.slice(1));const u=c.charCodeAt(c.length-1),h=wa(i.after.charCodeAt(0),u,r);h.inside&&(c=c.slice(0,-1)+dr(u));const p=o.move(r);return a(),n.attentionEncodeSurroundingInfo={after:h.outside,before:m.outside},l+c+p}function x1(t,s,n){return n.options.emphasis||"*"}function g1(t,s){let n=!1;return Iy(t,function(i){if("value"in i&&/\r?\n|\r/.test(i.value)||i.type==="break")return n=!0,Ey}),!!((!t.depth||t.depth<3)&&Eh(t)&&(s.options.setext||n))}function j1(t,s,n,i){const r=Math.max(Math.min(6,t.depth||1),1),a=n.createTracker(i);if(g1(t,n)){const m=n.enter("headingSetext"),u=n.enter("phrasing"),h=n.containerPhrasing(t,{...a.current(),before:`
`,after:`
`});return u(),m(),h+`
`+(r===1?"=":"-").repeat(h.length-(Math.max(h.lastIndexOf("\r"),h.lastIndexOf(`
`))+1))}const o="#".repeat(r),l=n.enter("headingAtx"),c=n.enter("phrasing");a.move(o+" ");let d=n.containerPhrasing(t,{before:"# ",after:`
`,...a.current()});return/^[\t ]/.test(d)&&(d=dr(d.charCodeAt(0))+d.slice(1)),d=d?o+" "+d:o,n.options.closeAtx&&(d+=" "+o),c(),l(),d}Fp.peek=y1;function Fp(t){return t.value||""}function y1(){return"<"}Bp.peek=b1;function Bp(t,s,n,i){const r=Cc(n),a=r==='"'?"Quote":"Apostrophe",o=n.enter("image");let l=n.enter("label");const c=n.createTracker(i);let d=c.move("![");return d+=c.move(n.safe(t.alt,{before:d,after:"]",...c.current()})),d+=c.move("]("),l(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(l=n.enter("destinationLiteral"),d+=c.move("<"),d+=c.move(n.safe(t.url,{before:d,after:">",...c.current()})),d+=c.move(">")):(l=n.enter("destinationRaw"),d+=c.move(n.safe(t.url,{before:d,after:t.title?" ":")",...c.current()}))),l(),t.title&&(l=n.enter(`title${a}`),d+=c.move(" "+r),d+=c.move(n.safe(t.title,{before:d,after:r,...c.current()})),d+=c.move(r),l()),d+=c.move(")"),o(),d}function b1(){return"!"}Up.peek=w1;function Up(t,s,n,i){const r=t.referenceType,a=n.enter("imageReference");let o=n.enter("label");const l=n.createTracker(i);let c=l.move("![");const d=n.safe(t.alt,{before:c,after:"]",...l.current()});c+=l.move(d+"]["),o();const m=n.stack;n.stack=[],o=n.enter("reference");const u=n.safe(n.associationId(t),{before:c,after:"]",...l.current()});return o(),n.stack=m,a(),r==="full"||!d||d!==u?c+=l.move(u+"]"):r==="shortcut"?c=c.slice(0,-1):c+=l.move("]"),c}function w1(){return"!"}Vp.peek=v1;function Vp(t,s,n){let i=t.value||"",r="`",a=-1;for(;new RegExp("(^|[^`])"+r+"([^`]|$)").test(i);)r+="`";for(/[^ \r\n]/.test(i)&&(/^[ \r\n]/.test(i)&&/[ \r\n]$/.test(i)||/^`|`$/.test(i))&&(i=" "+i+" ");++a<n.unsafe.length;){const o=n.unsafe[a],l=n.compilePattern(o);let c;if(o.atBreak)for(;c=l.exec(i);){let d=c.index;i.charCodeAt(d)===10&&i.charCodeAt(d-1)===13&&d--,i=i.slice(0,d)+" "+i.slice(c.index+1)}}return r+i+r}function v1(){return"`"}function qp(t,s){const n=Eh(t);return!!(!s.options.resourceLink&&t.url&&!t.title&&t.children&&t.children.length===1&&t.children[0].type==="text"&&(n===t.url||"mailto:"+n===t.url)&&/^[a-z][a-z+.-]+:/i.test(t.url)&&!/[\0- <>\u007F]/.test(t.url))}Kp.peek=N1;function Kp(t,s,n,i){const r=Cc(n),a=r==='"'?"Quote":"Apostrophe",o=n.createTracker(i);let l,c;if(qp(t,n)){const m=n.stack;n.stack=[],l=n.enter("autolink");let u=o.move("<");return u+=o.move(n.containerPhrasing(t,{before:u,after:">",...o.current()})),u+=o.move(">"),l(),n.stack=m,u}l=n.enter("link"),c=n.enter("label");let d=o.move("[");return d+=o.move(n.containerPhrasing(t,{before:d,after:"](",...o.current()})),d+=o.move("]("),c(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(c=n.enter("destinationLiteral"),d+=o.move("<"),d+=o.move(n.safe(t.url,{before:d,after:">",...o.current()})),d+=o.move(">")):(c=n.enter("destinationRaw"),d+=o.move(n.safe(t.url,{before:d,after:t.title?" ":")",...o.current()}))),c(),t.title&&(c=n.enter(`title${a}`),d+=o.move(" "+r),d+=o.move(n.safe(t.title,{before:d,after:r,...o.current()})),d+=o.move(r),c()),d+=o.move(")"),l(),d}function N1(t,s,n){return qp(t,n)?"<":"["}Wp.peek=k1;function Wp(t,s,n,i){const r=t.referenceType,a=n.enter("linkReference");let o=n.enter("label");const l=n.createTracker(i);let c=l.move("[");const d=n.containerPhrasing(t,{before:c,after:"]",...l.current()});c+=l.move(d+"]["),o();const m=n.stack;n.stack=[],o=n.enter("reference");const u=n.safe(n.associationId(t),{before:c,after:"]",...l.current()});return o(),n.stack=m,a(),r==="full"||!d||d!==u?c+=l.move(u+"]"):r==="shortcut"?c=c.slice(0,-1):c+=l.move("]"),c}function k1(){return"["}function _c(t){const s=t.options.bullet||"*";if(s!=="*"&&s!=="+"&&s!=="-")throw new Error("Cannot serialize items with `"+s+"` for `options.bullet`, expected `*`, `+`, or `-`");return s}function z1(t){const s=_c(t),n=t.options.bulletOther;if(!n)return s==="*"?"-":"*";if(n!=="*"&&n!=="+"&&n!=="-")throw new Error("Cannot serialize items with `"+n+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(n===s)throw new Error("Expected `bullet` (`"+s+"`) and `bulletOther` (`"+n+"`) to be different");return n}function S1(t){const s=t.options.bulletOrdered||".";if(s!=="."&&s!==")")throw new Error("Cannot serialize items with `"+s+"` for `options.bulletOrdered`, expected `.` or `)`");return s}function Gp(t){const s=t.options.rule||"*";if(s!=="*"&&s!=="-"&&s!=="_")throw new Error("Cannot serialize rules with `"+s+"` for `options.rule`, expected `*`, `-`, or `_`");return s}function C1(t,s,n,i){const r=n.enter("list"),a=n.bulletCurrent;let o=t.ordered?S1(n):_c(n);const l=t.ordered?o==="."?")":".":z1(n);let c=s&&n.bulletLastUsed?o===n.bulletLastUsed:!1;if(!t.ordered){const m=t.children?t.children[0]:void 0;if((o==="*"||o==="-")&&m&&(!m.children||!m.children[0])&&n.stack[n.stack.length-1]==="list"&&n.stack[n.stack.length-2]==="listItem"&&n.stack[n.stack.length-3]==="list"&&n.stack[n.stack.length-4]==="listItem"&&n.indexStack[n.indexStack.length-1]===0&&n.indexStack[n.indexStack.length-2]===0&&n.indexStack[n.indexStack.length-3]===0&&(c=!0),Gp(n)===o&&m){let u=-1;for(;++u<t.children.length;){const h=t.children[u];if(h&&h.type==="listItem"&&h.children&&h.children[0]&&h.children[0].type==="thematicBreak"){c=!0;break}}}}c&&(o=l),n.bulletCurrent=o;const d=n.containerFlow(t,i);return n.bulletLastUsed=o,n.bulletCurrent=a,r(),d}function _1(t){const s=t.options.listItemIndent||"one";if(s!=="tab"&&s!=="one"&&s!=="mixed")throw new Error("Cannot serialize items with `"+s+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return s}function T1(t,s,n,i){const r=_1(n);let a=n.bulletCurrent||_c(n);s&&s.type==="list"&&s.ordered&&(a=(typeof s.start=="number"&&s.start>-1?s.start:1)+(n.options.incrementListMarker===!1?0:s.children.indexOf(t))+a);let o=a.length+1;(r==="tab"||r==="mixed"&&(s&&s.type==="list"&&s.spread||t.spread))&&(o=Math.ceil(o/4)*4);const l=n.createTracker(i);l.move(a+" ".repeat(o-a.length)),l.shift(o);const c=n.enter("listItem"),d=n.indentLines(n.containerFlow(t,l.current()),m);return c(),d;function m(u,h,p){return h?(p?"":" ".repeat(o))+u:(p?a:a+" ".repeat(o-a.length))+u}}function A1(t,s,n,i){const r=n.enter("paragraph"),a=n.enter("phrasing"),o=n.containerPhrasing(t,i);return a(),r(),o}const D1=Ih(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function P1(t,s,n,i){return(t.children.some(function(o){return D1(o)})?n.containerPhrasing:n.containerFlow).call(n,t,i)}function M1(t){const s=t.options.strong||"*";if(s!=="*"&&s!=="_")throw new Error("Cannot serialize strong with `"+s+"` for `options.strong`, expected `*`, or `_`");return s}Hp.peek=R1;function Hp(t,s,n,i){const r=M1(n),a=n.enter("strong"),o=n.createTracker(i),l=o.move(r+r);let c=o.move(n.containerPhrasing(t,{after:r,before:l,...o.current()}));const d=c.charCodeAt(0),m=wa(i.before.charCodeAt(i.before.length-1),d,r);m.inside&&(c=dr(d)+c.slice(1));const u=c.charCodeAt(c.length-1),h=wa(i.after.charCodeAt(0),u,r);h.inside&&(c=c.slice(0,-1)+dr(u));const p=o.move(r+r);return a(),n.attentionEncodeSurroundingInfo={after:h.outside,before:m.outside},l+c+p}function R1(t,s,n){return n.options.strong||"*"}function I1(t,s,n,i){return n.safe(t.value,i)}function E1(t){const s=t.options.ruleRepetition||3;if(s<3)throw new Error("Cannot serialize rules with repetition `"+s+"` for `options.ruleRepetition`, expected `3` or more");return s}function L1(t,s,n){const i=(Gp(n)+(n.options.ruleSpaces?" ":"")).repeat(E1(n));return n.options.ruleSpaces?i.slice(0,-1):i}const Zp={blockquote:a1,break:xu,code:m1,definition:f1,emphasis:$p,hardBreak:xu,heading:j1,html:Fp,image:Bp,imageReference:Up,inlineCode:Vp,link:Kp,linkReference:Wp,list:C1,listItem:T1,paragraph:A1,root:P1,strong:Hp,text:I1,thematicBreak:L1};function O1(){return{enter:{table:$1,tableData:gu,tableHeader:gu,tableRow:B1},exit:{codeText:U1,table:F1,tableData:Eo,tableHeader:Eo,tableRow:Eo}}}function $1(t){const s=t._align;this.enter({type:"table",align:s.map(function(n){return n==="none"?null:n}),children:[]},t),this.data.inTable=!0}function F1(t){this.exit(t),this.data.inTable=void 0}function B1(t){this.enter({type:"tableRow",children:[]},t)}function Eo(t){this.exit(t)}function gu(t){this.enter({type:"tableCell",children:[]},t)}function U1(t){let s=this.resume();this.data.inTable&&(s=s.replace(/\\([\\|])/g,V1));const n=this.stack[this.stack.length-1];fi(n.type==="inlineCode"),n.value=s,this.exit(t)}function V1(t,s){return s==="|"?s:t}function q1(t){const s=t||{},n=s.tableCellPadding,i=s.tablePipeAlign,r=s.stringLength,a=n?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:`
`,inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[	 :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{inlineCode:h,table:o,tableCell:c,tableRow:l}};function o(p,j,x,b){return d(m(p,x,b),p.align)}function l(p,j,x,b){const w=u(p,x,b),y=d([w]);return y.slice(0,y.indexOf(`
`))}function c(p,j,x,b){const w=x.enter("tableCell"),y=x.enter("phrasing"),v=x.containerPhrasing(p,{...b,before:a,after:a});return y(),w(),v}function d(p,j){return i1(p,{align:j,alignDelimiters:i,padding:n,stringLength:r})}function m(p,j,x){const b=p.children;let w=-1;const y=[],v=j.enter("table");for(;++w<b.length;)y[w]=u(b[w],j,x);return v(),y}function u(p,j,x){const b=p.children;let w=-1;const y=[],v=j.enter("tableRow");for(;++w<b.length;)y[w]=c(b[w],p,j,x);return v(),y}function h(p,j,x){let b=Zp.inlineCode(p,j,x);return x.stack.includes("tableCell")&&(b=b.replace(/\|/g,"\\$&")),b}}function K1(){return{exit:{taskListCheckValueChecked:ju,taskListCheckValueUnchecked:ju,paragraph:G1}}}function W1(){return{unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:H1}}}function ju(t){const s=this.stack[this.stack.length-2];fi(s.type==="listItem"),s.checked=t.type==="taskListCheckValueChecked"}function G1(t){const s=this.stack[this.stack.length-2];if(s&&s.type==="listItem"&&typeof s.checked=="boolean"){const n=this.stack[this.stack.length-1];fi(n.type==="paragraph");const i=n.children[0];if(i&&i.type==="text"){const r=s.children;let a=-1,o;for(;++a<r.length;){const l=r[a];if(l.type==="paragraph"){o=l;break}}o===n&&(i.value=i.value.slice(1),i.value.length===0?n.children.shift():n.position&&i.position&&typeof i.position.start.offset=="number"&&(i.position.start.column++,i.position.start.offset++,n.position.start=Object.assign({},i.position.start)))}}this.exit(t)}function H1(t,s,n,i){const r=t.children[0],a=typeof t.checked=="boolean"&&r&&r.type==="paragraph",o="["+(t.checked?"x":" ")+"] ",l=n.createTracker(i);a&&l.move(o);let c=Zp.listItem(t,s,n,{...i,...l.current()});return a&&(c=c.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,d)),c;function d(m){return m+o}}function Z1(){return[Ck(),Hk(),Xk(),O1(),K1()]}function Q1(t){return{extensions:[_k(),Zk(t),Jk(),q1(t),W1()]}}const Y1={tokenize:nz,partial:!0},Qp={tokenize:iz,partial:!0},Yp={tokenize:rz,partial:!0},Xp={tokenize:az,partial:!0},X1={tokenize:oz,partial:!0},Jp={name:"wwwAutolink",tokenize:tz,previous:tx},ex={name:"protocolAutolink",tokenize:sz,previous:sx},Cs={name:"emailAutolink",tokenize:ez,previous:nx},cs={};function J1(){return{text:cs}}let en=48;for(;en<123;)cs[en]=Cs,en++,en===58?en=65:en===91&&(en=97);cs[43]=Cs;cs[45]=Cs;cs[46]=Cs;cs[95]=Cs;cs[72]=[Cs,ex];cs[104]=[Cs,ex];cs[87]=[Cs,Jp];cs[119]=[Cs,Jp];function ez(t,s,n){const i=this;let r,a;return o;function o(u){return!gl(u)||!nx.call(i,i.previous)||Tc(i.events)?n(u):(t.enter("literalAutolink"),t.enter("literalAutolinkEmail"),l(u))}function l(u){return gl(u)?(t.consume(u),l):u===64?(t.consume(u),c):n(u)}function c(u){return u===46?t.check(X1,m,d)(u):u===45||u===95||Jl(u)?(a=!0,t.consume(u),c):m(u)}function d(u){return t.consume(u),r=!0,c}function m(u){return a&&r&&Ji(i.previous)?(t.exit("literalAutolinkEmail"),t.exit("literalAutolink"),s(u)):n(u)}}function tz(t,s,n){const i=this;return r;function r(o){return o!==87&&o!==119||!tx.call(i,i.previous)||Tc(i.events)?n(o):(t.enter("literalAutolink"),t.enter("literalAutolinkWww"),t.check(Y1,t.attempt(Qp,t.attempt(Yp,a),n),n)(o))}function a(o){return t.exit("literalAutolinkWww"),t.exit("literalAutolink"),s(o)}}function sz(t,s,n){const i=this;let r="",a=!1;return o;function o(u){return(u===72||u===104)&&sx.call(i,i.previous)&&!Tc(i.events)?(t.enter("literalAutolink"),t.enter("literalAutolinkHttp"),r+=String.fromCodePoint(u),t.consume(u),l):n(u)}function l(u){if(Ji(u)&&r.length<5)return r+=String.fromCodePoint(u),t.consume(u),l;if(u===58){const h=r.toLowerCase();if(h==="http"||h==="https")return t.consume(u),c}return n(u)}function c(u){return u===47?(t.consume(u),a?d:(a=!0,c)):n(u)}function d(u){return u===null||Ly(u)||wt(u)||si(u)||Xl(u)?n(u):t.attempt(Qp,t.attempt(Yp,m),n)(u)}function m(u){return t.exit("literalAutolinkHttp"),t.exit("literalAutolink"),s(u)}}function nz(t,s,n){let i=0;return r;function r(o){return(o===87||o===119)&&i<3?(i++,t.consume(o),r):o===46&&i===3?(t.consume(o),a):n(o)}function a(o){return o===null?n(o):s(o)}}function iz(t,s,n){let i,r,a;return o;function o(d){return d===46||d===95?t.check(Xp,c,l)(d):d===null||wt(d)||si(d)||d!==45&&Xl(d)?c(d):(a=!0,t.consume(d),o)}function l(d){return d===95?i=!0:(r=i,i=void 0),t.consume(d),o}function c(d){return r||i||!a?n(d):s(d)}}function rz(t,s){let n=0,i=0;return r;function r(o){return o===40?(n++,t.consume(o),r):o===41&&i<n?a(o):o===33||o===34||o===38||o===39||o===41||o===42||o===44||o===46||o===58||o===59||o===60||o===63||o===93||o===95||o===126?t.check(Xp,s,a)(o):o===null||wt(o)||si(o)?s(o):(t.consume(o),r)}function a(o){return o===41&&i++,t.consume(o),r}}function az(t,s,n){return i;function i(l){return l===33||l===34||l===39||l===41||l===42||l===44||l===46||l===58||l===59||l===63||l===95||l===126?(t.consume(l),i):l===38?(t.consume(l),a):l===93?(t.consume(l),r):l===60||l===null||wt(l)||si(l)?s(l):n(l)}function r(l){return l===null||l===40||l===91||wt(l)||si(l)?s(l):i(l)}function a(l){return Ji(l)?o(l):n(l)}function o(l){return l===59?(t.consume(l),i):Ji(l)?(t.consume(l),o):n(l)}}function oz(t,s,n){return i;function i(a){return t.consume(a),r}function r(a){return Jl(a)?n(a):s(a)}}function tx(t){return t===null||t===40||t===42||t===95||t===91||t===93||t===126||wt(t)}function sx(t){return!Ji(t)}function nx(t){return!(t===47||gl(t))}function gl(t){return t===43||t===45||t===46||t===95||Jl(t)}function Tc(t){let s=t.length,n=!1;for(;s--;){const i=t[s][1];if((i.type==="labelLink"||i.type==="labelImage")&&!i._balanced){n=!0;break}if(i._gfmAutolinkLiteralWalkedInto){n=!1;break}}return t.length>0&&!n&&(t[t.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),n}const lz={tokenize:xz,partial:!0};function cz(){return{document:{91:{name:"gfmFootnoteDefinition",tokenize:hz,continuation:{tokenize:fz},exit:pz}},text:{91:{name:"gfmFootnoteCall",tokenize:mz},93:{name:"gfmPotentialFootnoteCall",add:"after",tokenize:dz,resolveTo:uz}}}}function dz(t,s,n){const i=this;let r=i.events.length;const a=i.parser.gfmFootnotes||(i.parser.gfmFootnotes=[]);let o;for(;r--;){const c=i.events[r][1];if(c.type==="labelImage"){o=c;break}if(c.type==="gfmFootnoteCall"||c.type==="labelLink"||c.type==="label"||c.type==="image"||c.type==="link")break}return l;function l(c){if(!o||!o._balanced)return n(c);const d=wr(i.sliceSerialize({start:o.end,end:i.now()}));return d.codePointAt(0)!==94||!a.includes(d.slice(1))?n(c):(t.enter("gfmFootnoteCallLabelMarker"),t.consume(c),t.exit("gfmFootnoteCallLabelMarker"),s(c))}}function uz(t,s){let n=t.length;for(;n--;)if(t[n][1].type==="labelImage"&&t[n][0]==="enter"){t[n][1];break}t[n+1][1].type="data",t[n+3][1].type="gfmFootnoteCallLabelMarker";const i={type:"gfmFootnoteCall",start:Object.assign({},t[n+3][1].start),end:Object.assign({},t[t.length-1][1].end)},r={type:"gfmFootnoteCallMarker",start:Object.assign({},t[n+3][1].end),end:Object.assign({},t[n+3][1].end)};r.end.column++,r.end.offset++,r.end._bufferIndex++;const a={type:"gfmFootnoteCallString",start:Object.assign({},r.end),end:Object.assign({},t[t.length-1][1].start)},o={type:"chunkString",contentType:"string",start:Object.assign({},a.start),end:Object.assign({},a.end)},l=[t[n+1],t[n+2],["enter",i,s],t[n+3],t[n+4],["enter",r,s],["exit",r,s],["enter",a,s],["enter",o,s],["exit",o,s],["exit",a,s],t[t.length-2],t[t.length-1],["exit",i,s]];return t.splice(n,t.length-n+1,...l),t}function mz(t,s,n){const i=this,r=i.parser.gfmFootnotes||(i.parser.gfmFootnotes=[]);let a=0,o;return l;function l(u){return t.enter("gfmFootnoteCall"),t.enter("gfmFootnoteCallLabelMarker"),t.consume(u),t.exit("gfmFootnoteCallLabelMarker"),c}function c(u){return u!==94?n(u):(t.enter("gfmFootnoteCallMarker"),t.consume(u),t.exit("gfmFootnoteCallMarker"),t.enter("gfmFootnoteCallString"),t.enter("chunkString").contentType="string",d)}function d(u){if(a>999||u===93&&!o||u===null||u===91||wt(u))return n(u);if(u===93){t.exit("chunkString");const h=t.exit("gfmFootnoteCallString");return r.includes(wr(i.sliceSerialize(h)))?(t.enter("gfmFootnoteCallLabelMarker"),t.consume(u),t.exit("gfmFootnoteCallLabelMarker"),t.exit("gfmFootnoteCall"),s):n(u)}return wt(u)||(o=!0),a++,t.consume(u),u===92?m:d}function m(u){return u===91||u===92||u===93?(t.consume(u),a++,d):d(u)}}function hz(t,s,n){const i=this,r=i.parser.gfmFootnotes||(i.parser.gfmFootnotes=[]);let a,o=0,l;return c;function c(j){return t.enter("gfmFootnoteDefinition")._container=!0,t.enter("gfmFootnoteDefinitionLabel"),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(j),t.exit("gfmFootnoteDefinitionLabelMarker"),d}function d(j){return j===94?(t.enter("gfmFootnoteDefinitionMarker"),t.consume(j),t.exit("gfmFootnoteDefinitionMarker"),t.enter("gfmFootnoteDefinitionLabelString"),t.enter("chunkString").contentType="string",m):n(j)}function m(j){if(o>999||j===93&&!l||j===null||j===91||wt(j))return n(j);if(j===93){t.exit("chunkString");const x=t.exit("gfmFootnoteDefinitionLabelString");return a=wr(i.sliceSerialize(x)),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(j),t.exit("gfmFootnoteDefinitionLabelMarker"),t.exit("gfmFootnoteDefinitionLabel"),h}return wt(j)||(l=!0),o++,t.consume(j),j===92?u:m}function u(j){return j===91||j===92||j===93?(t.consume(j),o++,m):m(j)}function h(j){return j===58?(t.enter("definitionMarker"),t.consume(j),t.exit("definitionMarker"),r.includes(a)||r.push(a),Ls(t,p,"gfmFootnoteDefinitionWhitespace")):n(j)}function p(j){return s(j)}}function fz(t,s,n){return t.check(Oy,s,t.attempt(lz,s,n))}function pz(t){t.exit("gfmFootnoteDefinition")}function xz(t,s,n){const i=this;return Ls(t,r,"gfmFootnoteDefinitionIndent",5);function r(a){const o=i.events[i.events.length-1];return o&&o[1].type==="gfmFootnoteDefinitionIndent"&&o[2].sliceSerialize(o[1],!0).length===4?s(a):n(a)}}function gz(t){let n=(t||{}).singleTilde;const i={name:"strikethrough",tokenize:a,resolveAll:r};return n==null&&(n=!0),{text:{126:i},insideSpan:{null:[i]},attentionMarkers:{null:[126]}};function r(o,l){let c=-1;for(;++c<o.length;)if(o[c][0]==="enter"&&o[c][1].type==="strikethroughSequenceTemporary"&&o[c][1]._close){let d=c;for(;d--;)if(o[d][0]==="exit"&&o[d][1].type==="strikethroughSequenceTemporary"&&o[d][1]._open&&o[c][1].end.offset-o[c][1].start.offset===o[d][1].end.offset-o[d][1].start.offset){o[c][1].type="strikethroughSequence",o[d][1].type="strikethroughSequence";const m={type:"strikethrough",start:Object.assign({},o[d][1].start),end:Object.assign({},o[c][1].end)},u={type:"strikethroughText",start:Object.assign({},o[d][1].end),end:Object.assign({},o[c][1].start)},h=[["enter",m,l],["enter",o[d][1],l],["exit",o[d][1],l],["enter",u,l]],p=l.parser.constructs.insideSpan.null;p&&So(h,h.length,0,$y(p,o.slice(d+1,c),l)),So(h,h.length,0,[["exit",u,l],["enter",o[c][1],l],["exit",o[c][1],l],["exit",m,l]]),So(o,d-1,c-d+3,h),c=d+h.length-2;break}}for(c=-1;++c<o.length;)o[c][1].type==="strikethroughSequenceTemporary"&&(o[c][1].type="data");return o}function a(o,l,c){const d=this.previous,m=this.events;let u=0;return h;function h(j){return d===126&&m[m.length-1][1].type!=="characterEscape"?c(j):(o.enter("strikethroughSequenceTemporary"),p(j))}function p(j){const x=da(d);if(j===126)return u>1?c(j):(o.consume(j),u++,p);if(u<2&&!n)return c(j);const b=o.exit("strikethroughSequenceTemporary"),w=da(j);return b._open=!w||w===2&&!!x,b._close=!x||x===2&&!!w,l(j)}}}class jz{constructor(){this.map=[]}add(s,n,i){yz(this,s,n,i)}consume(s){if(this.map.sort(function(a,o){return a[0]-o[0]}),this.map.length===0)return;let n=this.map.length;const i=[];for(;n>0;)n-=1,i.push(s.slice(this.map[n][0]+this.map[n][1]),this.map[n][2]),s.length=this.map[n][0];i.push(s.slice()),s.length=0;let r=i.pop();for(;r;){for(const a of r)s.push(a);r=i.pop()}this.map.length=0}}function yz(t,s,n,i){let r=0;if(!(n===0&&i.length===0)){for(;r<t.map.length;){if(t.map[r][0]===s){t.map[r][1]+=n,t.map[r][2].push(...i);return}r+=1}t.map.push([s,n,i])}}function bz(t,s){let n=!1;const i=[];for(;s<t.length;){const r=t[s];if(n){if(r[0]==="enter")r[1].type==="tableContent"&&i.push(t[s+1][1].type==="tableDelimiterMarker"?"left":"none");else if(r[1].type==="tableContent"){if(t[s-1][1].type==="tableDelimiterMarker"){const a=i.length-1;i[a]=i[a]==="left"?"center":"right"}}else if(r[1].type==="tableDelimiterRow")break}else r[0]==="enter"&&r[1].type==="tableDelimiterRow"&&(n=!0);s+=1}return i}function wz(){return{flow:{null:{name:"table",tokenize:vz,resolveAll:Nz}}}}function vz(t,s,n){const i=this;let r=0,a=0,o;return l;function l(f){let S=i.events.length-1;for(;S>-1;){const P=i.events[S][1].type;if(P==="lineEnding"||P==="linePrefix")S--;else break}const A=S>-1?i.events[S][1].type:null,D=A==="tableHead"||A==="tableRow"?k:c;return D===k&&i.parser.lazy[i.now().line]?n(f):D(f)}function c(f){return t.enter("tableHead"),t.enter("tableRow"),d(f)}function d(f){return f===124||(o=!0,a+=1),m(f)}function m(f){return f===null?n(f):$i(f)?a>1?(a=0,i.interrupt=!0,t.exit("tableRow"),t.enter("lineEnding"),t.consume(f),t.exit("lineEnding"),p):n(f):$n(f)?Ls(t,m,"whitespace")(f):(a+=1,o&&(o=!1,r+=1),f===124?(t.enter("tableCellDivider"),t.consume(f),t.exit("tableCellDivider"),o=!0,m):(t.enter("data"),u(f)))}function u(f){return f===null||f===124||wt(f)?(t.exit("data"),m(f)):(t.consume(f),f===92?h:u)}function h(f){return f===92||f===124?(t.consume(f),u):u(f)}function p(f){return i.interrupt=!1,i.parser.lazy[i.now().line]?n(f):(t.enter("tableDelimiterRow"),o=!1,$n(f)?Ls(t,j,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(f):j(f))}function j(f){return f===45||f===58?b(f):f===124?(o=!0,t.enter("tableCellDivider"),t.consume(f),t.exit("tableCellDivider"),x):C(f)}function x(f){return $n(f)?Ls(t,b,"whitespace")(f):b(f)}function b(f){return f===58?(a+=1,o=!0,t.enter("tableDelimiterMarker"),t.consume(f),t.exit("tableDelimiterMarker"),w):f===45?(a+=1,w(f)):f===null||$i(f)?_(f):C(f)}function w(f){return f===45?(t.enter("tableDelimiterFiller"),y(f)):C(f)}function y(f){return f===45?(t.consume(f),y):f===58?(o=!0,t.exit("tableDelimiterFiller"),t.enter("tableDelimiterMarker"),t.consume(f),t.exit("tableDelimiterMarker"),v):(t.exit("tableDelimiterFiller"),v(f))}function v(f){return $n(f)?Ls(t,_,"whitespace")(f):_(f)}function _(f){return f===124?j(f):f===null||$i(f)?!o||r!==a?C(f):(t.exit("tableDelimiterRow"),t.exit("tableHead"),s(f)):C(f)}function C(f){return n(f)}function k(f){return t.enter("tableRow"),N(f)}function N(f){return f===124?(t.enter("tableCellDivider"),t.consume(f),t.exit("tableCellDivider"),N):f===null||$i(f)?(t.exit("tableRow"),s(f)):$n(f)?Ls(t,N,"whitespace")(f):(t.enter("data"),z(f))}function z(f){return f===null||f===124||wt(f)?(t.exit("data"),N(f)):(t.consume(f),f===92?T:z)}function T(f){return f===92||f===124?(t.consume(f),z):z(f)}}function Nz(t,s){let n=-1,i=!0,r=0,a=[0,0,0,0],o=[0,0,0,0],l=!1,c=0,d,m,u;const h=new jz;for(;++n<t.length;){const p=t[n],j=p[1];p[0]==="enter"?j.type==="tableHead"?(l=!1,c!==0&&(yu(h,s,c,d,m),m=void 0,c=0),d={type:"table",start:Object.assign({},j.start),end:Object.assign({},j.end)},h.add(n,0,[["enter",d,s]])):j.type==="tableRow"||j.type==="tableDelimiterRow"?(i=!0,u=void 0,a=[0,0,0,0],o=[0,n+1,0,0],l&&(l=!1,m={type:"tableBody",start:Object.assign({},j.start),end:Object.assign({},j.end)},h.add(n,0,[["enter",m,s]])),r=j.type==="tableDelimiterRow"?2:m?3:1):r&&(j.type==="data"||j.type==="tableDelimiterMarker"||j.type==="tableDelimiterFiller")?(i=!1,o[2]===0&&(a[1]!==0&&(o[0]=o[1],u=qr(h,s,a,r,void 0,u),a=[0,0,0,0]),o[2]=n)):j.type==="tableCellDivider"&&(i?i=!1:(a[1]!==0&&(o[0]=o[1],u=qr(h,s,a,r,void 0,u)),a=o,o=[a[1],n,0,0])):j.type==="tableHead"?(l=!0,c=n):j.type==="tableRow"||j.type==="tableDelimiterRow"?(c=n,a[1]!==0?(o[0]=o[1],u=qr(h,s,a,r,n,u)):o[1]!==0&&(u=qr(h,s,o,r,n,u)),r=0):r&&(j.type==="data"||j.type==="tableDelimiterMarker"||j.type==="tableDelimiterFiller")&&(o[3]=n)}for(c!==0&&yu(h,s,c,d,m),h.consume(s.events),n=-1;++n<s.events.length;){const p=s.events[n];p[0]==="enter"&&p[1].type==="table"&&(p[1]._align=bz(s.events,n))}return t}function qr(t,s,n,i,r,a){const o=i===1?"tableHeader":i===2?"tableDelimiter":"tableData",l="tableContent";n[0]!==0&&(a.end=Object.assign({},Fn(s.events,n[0])),t.add(n[0],0,[["exit",a,s]]));const c=Fn(s.events,n[1]);if(a={type:o,start:Object.assign({},c),end:Object.assign({},c)},t.add(n[1],0,[["enter",a,s]]),n[2]!==0){const d=Fn(s.events,n[2]),m=Fn(s.events,n[3]),u={type:l,start:Object.assign({},d),end:Object.assign({},m)};if(t.add(n[2],0,[["enter",u,s]]),i!==2){const h=s.events[n[2]],p=s.events[n[3]];if(h[1].end=Object.assign({},p[1].end),h[1].type="chunkText",h[1].contentType="text",n[3]>n[2]+1){const j=n[2]+1,x=n[3]-n[2]-1;t.add(j,x,[])}}t.add(n[3]+1,0,[["exit",u,s]])}return r!==void 0&&(a.end=Object.assign({},Fn(s.events,r)),t.add(r,0,[["exit",a,s]]),a=void 0),a}function yu(t,s,n,i,r){const a=[],o=Fn(s.events,n);r&&(r.end=Object.assign({},o),a.push(["exit",r,s])),i.end=Object.assign({},o),a.push(["exit",i,s]),t.add(n+1,0,a)}function Fn(t,s){const n=t[s],i=n[0]==="enter"?"start":"end";return n[1][i]}const kz={name:"tasklistCheck",tokenize:Sz};function zz(){return{text:{91:kz}}}function Sz(t,s,n){const i=this;return r;function r(c){return i.previous!==null||!i._gfmTasklistFirstContentOfListItem?n(c):(t.enter("taskListCheck"),t.enter("taskListCheckMarker"),t.consume(c),t.exit("taskListCheckMarker"),a)}function a(c){return wt(c)?(t.enter("taskListCheckValueUnchecked"),t.consume(c),t.exit("taskListCheckValueUnchecked"),o):c===88||c===120?(t.enter("taskListCheckValueChecked"),t.consume(c),t.exit("taskListCheckValueChecked"),o):n(c)}function o(c){return c===93?(t.enter("taskListCheckMarker"),t.consume(c),t.exit("taskListCheckMarker"),t.exit("taskListCheck"),l):n(c)}function l(c){return $i(c)?s(c):$n(c)?t.check({tokenize:Cz},s,n)(c):n(c)}}function Cz(t,s,n){return Ls(t,i,"whitespace");function i(r){return r===null?n(r):s(r)}}function _z(t){return Fy([J1(),cz(),gz(t),wz(),zz()])}const Tz={};function jl(t){const s=this,n=t||Tz,i=s.data(),r=i.micromarkExtensions||(i.micromarkExtensions=[]),a=i.fromMarkdownExtensions||(i.fromMarkdownExtensions=[]),o=i.toMarkdownExtensions||(i.toMarkdownExtensions=[]);r.push(_z(n)),a.push(Z1()),o.push(Q1(n))}const Az=({activity:t})=>e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[1fr,300px]",children:[e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Treść materiału"})}),e.jsx(R,{children:t.content?e.jsx("div",{className:"prose max-w-none",children:e.jsx(al,{remarkPlugins:[jl],children:t.content})}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(is,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Brak treści materiału"})]})})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs(M,{children:[e.jsx($,{className:"pb-3",children:e.jsx(O,{className:"text-base",children:"Informacje"})}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[e.jsx(Ve,{className:"w-4 h-4"}),"Czas trwania"]}),e.jsxs("p",{className:"font-medium",children:[t.duration_min||"-"," minut"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[e.jsx(ab,{className:"w-4 h-4"}),"Pozycja w temacie"]}),e.jsx("p",{className:"font-medium",children:t.position})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[e.jsx(vs,{className:"w-4 h-4"}),"Data utworzenia"]}),e.jsx("p",{className:"font-medium",children:new Date(t.created_at).toLocaleDateString("pl-PL")})]}),t.updated_at&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[e.jsx(vs,{className:"w-4 h-4"}),"Ostatnia aktualizacja"]}),e.jsx("p",{className:"font-medium",children:new Date(t.updated_at).toLocaleDateString("pl-PL")})]})]})]})})]}),Dz=({activity:t,questionsCount:s,questionsData:n,questionsLoading:i,onNavigateToQuestions:r})=>{const a=n?.reduce((l,c)=>l+(c.points||0),0)||0,o=Math.ceil((t.passing_score||70)/100*a);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Parametry quizu"})}),e.jsx(R,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ve,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Czas trwania"})]}),e.jsxs("p",{className:"text-2xl font-bold",children:[t.duration_min||"-"," min"]})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ee,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Próg zaliczenia"})]}),e.jsxs("p",{className:"text-2xl font-bold",children:[t.passing_score||70,"%"]})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ob,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Limit czasu"})]}),e.jsx("p",{className:"text-2xl font-bold",children:t.time_limit?`${t.time_limit} min`:"Brak"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ol,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Liczba prób"})]}),e.jsx("p",{className:"text-2xl font-bold",children:t.max_attempts||"Bez limitu"})]})]})})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsxs(O,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Pytania (",s,")"]}),s>0&&e.jsxs(I,{size:"sm",variant:"outline",onClick:()=>r(t.id),children:[e.jsx(ls,{className:"w-3 h-3 mr-1"}),"Zarządzaj"]})]})}),e.jsx(R,{children:s===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(vt,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground/30"}),e.jsx("p",{className:"text-lg font-medium text-muted-foreground mb-2",children:"Ten quiz nie ma jeszcze pytań"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"Dodaj pytania, aby uczniowie mogli rozwiązać quiz"}),e.jsxs(I,{onClick:()=>r(t.id),children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Dodaj pierwsze pytanie"]})]}):i?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})}):e.jsx("div",{className:"space-y-2",children:n?.map((l,c)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg border bg-card hover:bg-muted/50 transition-colors",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center text-sm font-semibold",children:c+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[l.type==="single_choice"&&e.jsxs(q,{variant:"outline",className:"text-xs",children:[e.jsx(xn,{className:"w-3 h-3 mr-1"}),"Jednokrotny wybór"]}),l.type==="multiple_choice"&&e.jsxs(q,{variant:"outline",className:"text-xs",children:[e.jsx(dn,{className:"w-3 h-3 mr-1"}),"Wielokrotny wybór"]}),l.type==="true_false"&&e.jsxs(q,{variant:"outline",className:"text-xs",children:[e.jsx(dt,{className:"w-3 h-3 mr-1"}),"Prawda/Fałsz"]}),e.jsxs(q,{variant:"secondary",className:"text-xs",children:[l.points," pkt"]})]}),e.jsx("p",{className:"text-sm font-medium line-clamp-2",children:l.content}),l.explanation&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-1",children:[e.jsx("span",{className:"font-medium",children:"Wyjaśnienie:"})," ",l.explanation]})]})]},l.id))})})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(M,{children:[e.jsx($,{className:"pb-3",children:e.jsx(O,{className:"text-base",children:"Statystyki"})}),e.jsx(R,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Liczba pytań"}),e.jsx("span",{className:"font-medium",children:s})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Maksymalna liczba punktów"}),e.jsx("span",{className:"font-medium",children:a})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Wymagane punkty do zaliczenia"}),e.jsx("span",{className:"font-medium",children:o})]})]})})]}),e.jsxs(M,{children:[e.jsx($,{className:"pb-3",children:e.jsx(O,{className:"text-base",children:"Informacje"})}),e.jsx(R,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Pozycja w temacie"}),e.jsx("span",{className:"font-medium",children:t.position})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Data utworzenia"}),e.jsx("span",{className:"font-medium",children:new Date(t.created_at).toLocaleDateString("pl-PL")})]}),t.updated_at&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ostatnia aktualizacja"}),e.jsx("span",{className:"font-medium",children:new Date(t.updated_at).toLocaleDateString("pl-PL")})]})]})})]})]})]})},Pz=()=>{const{edit:t}=Xe(),{id:s}=mt(),n=me(),{data:i,isLoading:r}=Ye({resource:"activities",id:s,meta:{select:"*, topics(*, courses(*)), questions:questions(count)"}}),{data:a,isLoading:o}=Z({resource:"questions",filters:[{field:"activity_id",operator:"eq",value:parseInt(s)}],sorters:[{field:"position",order:"asc"}],queryOptions:{enabled:i?.data?.type==="quiz"&&!!s}});if(r)return e.jsx(G,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const l=i?.data;if(!l)return e.jsx(G,{children:e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Nie znaleziono aktywności"})})});const c=l.topics,d=c?.courses,m=l.questions?.[0]?.count||l._count?.questions||0,u=()=>{const x=window.location.pathname+window.location.search;sessionStorage.setItem("returnUrl",x),t("activities",l.id??"")},h=x=>{const b=window.location.pathname+window.location.search;sessionStorage.setItem("returnUrl",b),n(x)},p=()=>l.type==="quiz"?e.jsx(vt,{className:"w-5 h-5"}):e.jsx(is,{className:"w-5 h-5"}),j=()=>l.type==="quiz"?"text-blue-500":"text-green-500";return e.jsxs(G,{children:[e.jsx(yn,{}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"text-sm text-muted-foreground mb-2",children:[d?.title," → Temat ",c?.position,": ",c?.title]}),e.jsxs(Y,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg bg-muted ${j()}`,children:p()}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:l.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(q,{variant:l.type==="quiz"?"default":"secondary",children:l.type==="quiz"?"Quiz":"Materiał"}),e.jsx(q,{variant:l.is_published?"default":"outline",children:l.is_published?e.jsxs(e.Fragment,{children:[e.jsx(_t,{className:"w-3 h-3 mr-1"})," Opublikowany"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ba,{className:"w-3 h-3 mr-1"})," Szkic"]})})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[l.type==="quiz"&&e.jsxs(I,{variant:"outline",onClick:()=>h(`/teacher/questions/manage/${l.id}`),children:[e.jsx(dn,{className:"w-4 h-4 mr-2"}),"Zarządzaj pytaniami (",m,")"]}),e.jsxs(I,{onClick:u,children:[e.jsx(ls,{className:"w-4 h-4 mr-2"}),"Edytuj"]})]})]})]}),l.type==="material"?e.jsx(Az,{activity:l}):e.jsx(Dz,{activity:l,questionsCount:m,questionsData:a?.data,questionsLoading:o,onNavigateToQuestions:x=>h(`/teacher/questions/manage/${x}`)})]})},bu={name:"activities",list:"/teacher/activities/create",create:"/teacher/activities/create",edit:"/teacher/activities/edit/:id",show:"/teacher/activities/show/:id",meta:{hide:!0}},Mz=[e.jsx(V,{path:"activities/create",element:e.jsx(bk,{})},"activities-create"),e.jsx(V,{path:"activities/edit/:id",element:e.jsx(wk,{})},"activities-edit"),e.jsx(V,{path:"activities/show/:id",element:e.jsx(Pz,{})},"activities-show")],Rz=()=>{const{create:t,edit:s,show:n}=Xe(),i=me(),{mutate:r}=pn(),{tableQuery:{data:a,isLoading:o,isError:l,refetch:c},current:d,setCurrent:m,pageSize:u,setFilters:h}=$h({sorters:{initial:[{field:"created_at",order:"desc"}]},meta:{select:"*, group_members(count), course_access(count)"}}),p=oc({isLoading:o,isError:l});if(p)return p;const j=(y,v)=>{confirm(`Czy na pewno chcesz usunąć grupę "${v}"? Ta akcja usunie również wszystkie przypisania uczniów i kursów.`)&&r({resource:"groups",id:y},{onSuccess:()=>{H.success("Grupa została usunięta"),c()},onError:()=>{H.error("Błąd podczas usuwania grupy")}})},x=(y,v)=>{v?.stopPropagation(),i(`/teacher/groups/${y}/assign-courses`)},b=(y,v)=>{v?.stopPropagation(),i(`/teacher/groups/${y}/assign-students`)},w=y=>!y||!Array.isArray(y)||y.length===0?0:y[0].count||0;return e.jsxs(G,{children:[e.jsxs(Y,{children:[e.jsx(ke,{title:"Grupy",description:"Zarządzaj grupami uczniów i przypisuj im kursy"}),e.jsxs(I,{onClick:()=>t("groups"),children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Dodaj grupę"]})]}),e.jsx(Y,{children:e.jsx(J,{placeholder:"Szukaj grup...",className:"max-w-sm",onChange:y=>{h([{field:"name",operator:"contains",value:y.target.value}])}})}),a?.data?.length===0?e.jsx(M,{className:"border-dashed border-2",children:e.jsxs(R,{className:"text-center py-12",children:[e.jsx(oe,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Brak grup"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Utwórz pierwszą grupę, aby móc przypisywać uczniów do kursów"}),e.jsxs(I,{onClick:()=>t("groups"),children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Utwórz pierwszą grupę"]})]})}):e.jsx(rt,{children:a?.data?.map(y=>{const v=w(y.group_members),_=w(y.course_access);return e.jsxs(M,{className:"cursor-pointer transition-all hover:shadow-lg hover:border-primary/50 relative overflow-hidden",onClick:C=>{!C.target.closest('[role="menu"]')&&!C.target.closest(".quick-action")&&n("groups",y.id)},children:[!y.is_active&&e.jsx("div",{className:"absolute inset-0 bg-muted/50 z-10 pointer-events-none"}),e.jsx($,{children:e.jsxs(Y,{children:[e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"truncate",children:y.name})]}),e.jsxs(oi,{children:[e.jsx(li,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"sm",onClick:C=>C.stopPropagation(),className:"relative z-20",children:e.jsx(Fa,{className:"h-4 w-4"})})}),e.jsxs(jn,{align:"end",children:[e.jsxs(de,{onClick:()=>n("groups",y.id),children:[e.jsx(_t,{className:"mr-2 h-4 w-4"}),"Podgląd"]}),e.jsxs(de,{onClick:()=>s("groups",y.id),children:[e.jsx(ls,{className:"mr-2 h-4 w-4"}),"Edytuj"]}),e.jsx(it,{}),e.jsxs(de,{onClick:C=>b(y.id,C),className:"text-blue-600 focus:text-blue-600",children:[e.jsx(ws,{className:"mr-2 h-4 w-4"}),"Dodaj uczniów"]}),e.jsxs(de,{onClick:C=>x(y.id,C),className:"text-green-600 focus:text-green-600",children:[e.jsx(Se,{className:"mr-2 h-4 w-4"}),"Przypisz kursy"]}),e.jsx(it,{}),e.jsxs(de,{onClick:()=>j(y.id,y.name),className:"text-red-600 focus:text-red-600",children:[e.jsx(ns,{className:"mr-2 h-4 w-4"}),"Usuń"]})]})]})]})}),e.jsx(R,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(vs,{className:"w-4 h-4"}),e.jsxs("span",{children:["Rok akademicki: ",y.academic_year]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-background rounded-md",children:e.jsx(oe,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Uczniowie"}),e.jsx("p",{className:"text-lg font-semibold",children:v})]})]})}),e.jsx("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-background rounded-md",children:e.jsx(Se,{className:"w-4 h-4 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Kursy"}),e.jsx("p",{className:"text-lg font-semibold",children:_})]})]})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsx(q,{variant:y.is_active?"default":"secondary",className:y.is_active?"bg-green-600":"",children:y.is_active?"Aktywna":"Nieaktywna"}),e.jsxs("div",{className:"flex gap-1",children:[v===0&&e.jsx(I,{size:"sm",variant:"ghost",className:"h-8 px-2 quick-action text-blue-600 hover:text-blue-700 hover:bg-blue-50",onClick:C=>b(y.id,C),title:"Dodaj uczniów",children:e.jsx(ws,{className:"h-4 w-4"})}),e.jsxs(I,{size:"sm",variant:"ghost",className:"h-8 px-2 quick-action text-green-600 hover:text-green-700 hover:bg-green-50",onClick:C=>x(y.id,C),title:"Przypisz kursy",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsx(Fe,{className:"h-3 w-3 ml-1"})]})]})]})]})})]},y.id)})}),e.jsx(xf,{current:d,pageSize:u,total:a?.total||0,setCurrent:m,itemName:"grup"})]})},Iz=()=>{const{list:t}=Xe(),{data:s}=Le(),{refineCore:{onFinish:n},register:i,handleSubmit:r,setValue:a,watch:o,formState:{errors:l,isSubmitting:c}}=Zs({defaultValues:{name:"",vendor_id:s?.vendor_id||0,is_active:!0,academic_year:new Date().getFullYear().toString()+"/"+(new Date().getFullYear()+1).toString()}});return e.jsxs(G,{children:[e.jsxs(I,{variant:"outline",size:"sm",onClick:()=>t("groups"),children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsx(Y,{children:e.jsx(ke,{title:"Dodaj grupę",description:"Utwórz nową grupę uczniów"})}),e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Informacje o grupie"})}),e.jsx(R,{children:e.jsxs(Qs,{onSubmit:r(n),children:[e.jsx(se,{label:"Nazwa grupy",htmlFor:"name",error:l.name?.message?.toString(),required:!0,children:e.jsx(J,{id:"name",placeholder:"np. Klasa 1A",...i("name",{required:"Nazwa grupy jest wymagana",minLength:{value:2,message:"Nazwa musi mieć minimum 2 znaki"}})})}),e.jsx(se,{label:"Rok akademicki",htmlFor:"academic_year",error:l.academic_year?.message?.toString(),required:!0,children:e.jsx(J,{id:"academic_year",placeholder:"np. 2024/2025",...i("academic_year",{required:"Rok akademicki jest wymagany",pattern:{value:/^\d{4}\/\d{4}$/,message:"Format: RRRR/RRRR (np. 2024/2025)"}})})}),e.jsx(se,{label:"Status grupy",children:e.jsxs(Y,{variant:"start",children:[e.jsx(Bt,{checked:o("is_active"),onCheckedChange:d=>a("is_active",d)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Grupa aktywna"})]})}),e.jsxs(Ys,{children:[e.jsx(I,{type:"button",variant:"outline",onClick:()=>t("groups"),children:"Anuluj"}),e.jsx(I,{type:"submit",disabled:c,children:c?"Tworzenie...":"Utwórz grupę"})]})]})})]})]})},Ez=()=>{const{list:t}=Xe(),{id:s}=mt(),{data:n,isLoading:i}=Ye({resource:"groups",id:s,liveMode:"off"}),{refineCore:{onFinish:r},register:a,handleSubmit:o,setValue:l,watch:c,reset:d,formState:{errors:m,isSubmitting:u}}=Zs({refineCoreProps:{resource:"groups",id:s,redirect:"list",liveMode:"off"}});return g.useEffect(()=>{n?.data&&d({name:n.data.name,academic_year:n.data.academic_year,is_active:n.data.is_active,vendor_id:n.data.vendor_id})},[n,d]),i?e.jsx(G,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):e.jsxs(G,{children:[e.jsxs(I,{variant:"outline",size:"sm",onClick:()=>t("groups"),children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsx(Y,{children:e.jsx(ke,{title:"Edytuj grupę",description:`Edycja: ${n?.data?.name}`})}),e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Informacje o grupie"})}),e.jsx(R,{children:e.jsxs(Qs,{onSubmit:o(r),children:[e.jsx(se,{label:"Nazwa grupy",htmlFor:"name",error:m.name?.message,required:!0,children:e.jsx(J,{id:"name",placeholder:"np. Klasa 1A",...a("name",{required:"Nazwa grupy jest wymagana",minLength:{value:2,message:"Nazwa musi mieć minimum 2 znaki"}})})}),e.jsx(se,{label:"Rok akademicki",htmlFor:"academic_year",error:m.academic_year?.message,required:!0,children:e.jsx(J,{id:"academic_year",placeholder:"np. 2024/2025",...a("academic_year",{required:"Rok akademicki jest wymagany",pattern:{value:/^\d{4}\/\d{4}$/,message:"Format: RRRR/RRRR (np. 2024/2025)"}})})}),e.jsx(se,{label:"Status grupy",children:e.jsxs(Y,{variant:"start",children:[e.jsx(Bt,{checked:c("is_active"),onCheckedChange:h=>l("is_active",h)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Grupa aktywna"})]})}),e.jsxs(Ys,{children:[e.jsx(I,{type:"button",variant:"outline",onClick:()=>t("groups"),children:"Anuluj"}),e.jsx(I,{type:"submit",disabled:u,children:u?"Zapisywanie...":"Zapisz zmiany"})]})]})})]})]})},Lz=()=>{const{list:t,edit:s,show:n}=Xe(),{id:i}=mt(),r=me(),a=Fh(),{data:o,isLoading:l}=Ye({resource:"groups",id:i,liveMode:"off"}),{data:c,isLoading:d}=Z({resource:"group_members",filters:[{field:"group_id",operator:"eq",value:i}],meta:{select:"*, users(*)"},queryOptions:{enabled:!!i},liveMode:"off"}),{data:m,isLoading:u}=Z({resource:"course_access",filters:[{field:"group_id",operator:"eq",value:i}],meta:{select:"*, courses(*)"},queryOptions:{enabled:!!i},liveMode:"off"}),h=async(w,y)=>{if(confirm(`Czy na pewno chcesz odpiąć kurs "${y}" od tej grupy?`))try{const{error:v}=await Q.from("course_access").delete().eq("course_id",w).eq("group_id",parseInt(i));if(v)throw v;H.success("Kurs został odpięty od grupy"),a({resource:"course_access",invalidates:["list"]})}catch(v){console.error("Error removing course:",v),H.error("Błąd podczas odpinania kursu")}},p=async(w,y)=>{if(confirm(`Czy na pewno chcesz usunąć "${y}" z tej grupy?`))try{const{error:v}=await Q.from("group_members").delete().eq("user_id",w).eq("group_id",parseInt(i));if(v)throw v;H.success("Uczeń został usunięty z grupy"),a({resource:"group_members",invalidates:["list"]})}catch(v){console.error("Error removing member:",v),H.error("Błąd podczas usuwania ucznia z grupy")}};if(l||d||u)return e.jsx(G,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const j=o?.data,x=c?.total||0,b=m?.total||0;return e.jsxs(G,{children:[e.jsxs(I,{variant:"outline",size:"sm",onClick:()=>t("groups"),children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsxs(Y,{children:[e.jsxs("div",{children:[e.jsx(ke,{title:j?.name,description:`Rok akademicki: ${j?.academic_year}`}),!j?.is_active&&e.jsx(q,{variant:"secondary",className:"mt-2",children:"Grupa nieaktywna"})]}),e.jsxs(I,{onClick:()=>s("groups",j?.id??""),children:[e.jsx(ls,{className:"w-4 h-4 mr-2"}),"Edytuj grupę"]})]}),!j?.is_active&&e.jsxs($s,{children:[e.jsx(dt,{className:"h-4 w-4"}),e.jsx(Fs,{children:"Ta grupa jest nieaktywna. Uczniowie nie mają dostępu do przypisanych kursów."})]}),e.jsxs(rt,{variant:"2-2-4",children:[e.jsxs(M,{children:[e.jsx($,{className:"pb-2",children:e.jsx(O,{className:"text-sm font-medium",children:"Status"})}),e.jsx(R,{children:e.jsx(q,{variant:j?.is_active?"default":"secondary",className:j?.is_active?"bg-green-600":"",children:j?.is_active?"Aktywna":"Nieaktywna"})})]}),e.jsxs(M,{children:[e.jsx($,{className:"pb-2",children:e.jsx(O,{className:"text-sm font-medium",children:"Uczniowie"})}),e.jsx(R,{children:e.jsx("div",{className:"text-2xl font-bold",children:x})})]}),e.jsxs(M,{children:[e.jsx($,{className:"pb-2",children:e.jsx(O,{className:"text-sm font-medium",children:"Kursy"})}),e.jsx(R,{children:e.jsx("div",{className:"text-2xl font-bold",children:b})})]}),e.jsxs(M,{children:[e.jsx($,{className:"pb-2",children:e.jsx(O,{className:"text-sm font-medium",children:"Utworzono"})}),e.jsx(R,{children:e.jsx("div",{className:"text-sm",children:new Date(j?.created_at).toLocaleDateString("pl-PL")})})]})]}),e.jsxs(rt,{variant:"1-2-2",children:[e.jsxs(M,{children:[e.jsx($,{children:e.jsxs(Y,{children:[e.jsx(O,{children:"Uczniowie grupy"}),e.jsxs(I,{size:"sm",onClick:()=>r(`/teacher/groups/${i}/assign-students`),children:[e.jsx(ws,{className:"w-4 h-4 mr-2"}),"Dodaj ucznia"]})]})}),e.jsx(R,{children:c?.data?.length?e.jsx("div",{className:"space-y-2",children:c.data.map(w=>e.jsx("div",{className:"p-4 border rounded-lg hover:bg-muted/30 transition-all duration-200 group",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-muted/50 flex items-center justify-center flex-shrink-0",children:e.jsx(oe,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-base leading-tight truncate pr-2",children:w.users?.full_name}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(Ea,{className:"h-3.5 w-3.5 text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:w.users?.email})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(ps,{children:e.jsxs(xs,{children:[e.jsx(gs,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>n("users",w.user_id),children:e.jsx(Rd,{className:"h-4 w-4"})})}),e.jsx(Ht,{children:e.jsx("p",{children:"Zobacz profil"})})]})}),e.jsx(ps,{children:e.jsxs(xs,{children:[e.jsx(gs,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-red-50",onClick:()=>p(w.user_id,w.users?.full_name),children:e.jsx(ns,{className:"h-4 w-4 text-red-600"})})}),e.jsx(Ht,{children:e.jsx("p",{children:"Usuń z grupy"})})]})})]})]})},w.user_id))}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(oe,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Brak uczniów w grupie"}),e.jsxs(I,{size:"sm",variant:"outline",className:"mt-4",onClick:()=>r(`/teacher/groups/${i}/assign-students`),children:[e.jsx(ws,{className:"w-4 h-4 mr-2"}),"Dodaj pierwszego ucznia"]})]})})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsxs(Y,{children:[e.jsx(O,{children:"Przypisane kursy"}),e.jsxs(I,{size:"sm",onClick:()=>r(`/teacher/groups/${i}/assign-courses`),children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Przypisz kurs"]})]})}),e.jsx(R,{children:m?.data?.length?e.jsx("div",{className:"space-y-2",children:m.data.map(w=>e.jsx("div",{className:"p-4 border rounded-lg hover:bg-muted/30 transition-all duration-200 group",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:w.courses?.icon_emoji?e.jsx("div",{className:"h-10 w-10 rounded-lg bg-muted/50 flex items-center justify-center",children:e.jsx("span",{className:"text-xl",children:w.courses.icon_emoji})}):e.jsx("div",{className:"h-10 w-10 rounded-lg bg-muted/50 flex items-center justify-center",children:e.jsx(Se,{className:"h-5 w-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-base leading-tight truncate pr-2",children:w.courses?.title}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(vs,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:new Date(w.assigned_at).toLocaleDateString("pl-PL")})]}),e.jsx(q,{variant:w.courses?.is_published?"default":"secondary",className:`text-xs ${w.courses?.is_published?"bg-green-100 text-green-700 hover:bg-green-100":""}`,children:w.courses?.is_published?"Opublikowany":"Szkic"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(ps,{children:e.jsxs(xs,{children:[e.jsx(gs,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>n("courses",w.course_id),children:e.jsx(Rd,{className:"h-4 w-4"})})}),e.jsx(Ht,{children:e.jsx("p",{children:"Zobacz kurs"})})]})}),e.jsx(ps,{children:e.jsxs(xs,{children:[e.jsx(gs,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-red-50",onClick:()=>h(w.course_id,w.courses?.title),children:e.jsx(ns,{className:"h-4 w-4 text-red-600"})})}),e.jsx(Ht,{children:e.jsx("p",{children:"Odepnij kurs"})})]})})]})]})},w.course_id))}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Se,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Brak przypisanych kursów"}),e.jsxs(I,{size:"sm",variant:"outline",className:"mt-4",onClick:()=>r(`/teacher/groups/${i}/assign-courses`),children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Przypisz pierwszy kurs"]})]})})]})]})]})},Oz=()=>{const{id:t}=mt(),s=me(),[n,i]=g.useState([]),[r,a]=g.useState(""),[o,l]=g.useState(!1),{data:c,isLoading:d}=Ye({resource:"groups",id:t}),{data:m,isLoading:u}=Z({resource:"courses",pagination:{mode:"off"},meta:{select:"*, topics(count)"}}),{data:h,isLoading:p}=Z({resource:"course_access",filters:[{field:"group_id",operator:"eq",value:parseInt(t)}],pagination:{mode:"off"},meta:{select:"course_id, group_id"}}),{mutate:j,isLoading:x}=fn(),b=async()=>{if(n.length===0){H.error("Wybierz przynajmniej jeden kurs");return}try{const f=n.map(S=>j({resource:"course_access",values:{course_id:S,group_id:parseInt(t)}},{onSuccess:()=>{console.log(`Course ${S} assigned successfully`)},onError:A=>{console.error("Error assigning course:",S,A)}}));await Promise.all(f),H.success(`Przypisano ${n.length} ${n.length===1?"kurs":"kursów"} do grupy`),s(`/groups/show/${t}`)}catch(f){H.error("Błąd podczas przypisywania kursów"),console.error("Error details:",f)}};if(d||u||p)return e.jsx(G,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const w=c?.data,y=h?.data?.map(f=>f.course_id)||[];let v=m?.data?.filter(f=>!y.includes(f.id))||[];o&&(v=v.filter(f=>f.is_published));const _=v.filter(f=>f.title.toLowerCase().includes(r.toLowerCase())||f.description?.toLowerCase().includes(r.toLowerCase())),C=f=>{i(S=>S.includes(f)?S.filter(A=>A!==f):[...S,f])},k=()=>{i(_.map(f=>f.id))},N=()=>{i([])},z=v.filter(f=>f.is_published).length,T=v.length-z;return e.jsxs(G,{children:[e.jsxs(I,{variant:"outline",size:"sm",onClick:()=>s(`/teacher/groups/show/${t}`),children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Powrót do grupy"]}),e.jsx(Y,{children:e.jsx(ke,{title:"Przypisz kursy",description:`Przypisywanie kursów do grupy: ${w?.name}`})}),e.jsxs(M,{children:[e.jsx($,{children:e.jsxs(Y,{children:[e.jsxs("div",{children:[e.jsx(O,{children:"Dostępne kursy"}),v.length>0&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[z," opublikowanych, ",T," szkiców"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(I,{variant:"outline",size:"sm",onClick:()=>l(!o),className:o?"bg-primary text-primary-foreground":"",children:[e.jsx(_t,{className:"w-4 h-4 mr-2"}),"Tylko opublikowane"]}),e.jsxs(I,{variant:"outline",size:"sm",onClick:k,disabled:_.length===0,children:[e.jsx(Ge,{className:"w-4 h-4 mr-2"}),"Zaznacz wszystkie"]}),e.jsxs(I,{variant:"outline",size:"sm",onClick:N,disabled:n.length===0,children:[e.jsx(Pt,{className:"w-4 h-4 mr-2"}),"Odznacz wszystkie"]})]})]})}),e.jsxs(R,{children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Nr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(J,{placeholder:"Szukaj kursów po nazwie lub opisie...",value:r,onChange:f=>a(f.target.value),className:"pl-10"})]}),_.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:v.length===0?e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{className:"font-medium mb-1",children:"Wszystkie kursy są już przypisane"}),e.jsx("p",{className:"text-sm",children:"Ta grupa ma dostęp do wszystkich dostępnych kursów"}),e.jsx(I,{size:"sm",variant:"outline",className:"mt-4",onClick:()=>s("/courses"),children:"Przejdź do listy kursów"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Nie znaleziono kursów spełniających kryteria"})]})}):e.jsx("div",{className:"space-y-2",children:_.map(f=>{const S=f._count?.topics||0;return e.jsxs("div",{className:`
                      flex items-center space-x-3 p-3 border rounded-lg 
                      cursor-pointer transition-all
                      ${n.includes(f.id)?"border-primary bg-primary/5":"hover:bg-muted/50"}
                    `,onClick:()=>C(f.id),children:[e.jsx(rs,{checked:n.includes(f.id),onCheckedChange:()=>C(f.id),onClick:A=>A.stopPropagation()}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[f.icon_emoji&&e.jsx("span",{className:"text-xl",children:f.icon_emoji}),e.jsx("span",{className:"font-medium",children:f.title}),e.jsx(q,{variant:f.is_published?"default":"secondary",className:"text-xs",children:f.is_published?"Opublikowany":"Szkic"})]}),f.description&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.description}),e.jsx("div",{className:"flex items-center gap-4 mt-2 text-xs text-muted-foreground",children:e.jsxs("span",{children:[S," ",S===1?"temat":"tematów"]})})]}),e.jsx(ps,{children:e.jsxs(xs,{children:[e.jsx(gs,{asChild:!0,children:e.jsx(I,{size:"sm",variant:"ghost",onClick:A=>{A.stopPropagation(),s(`/courses/show/${f.id}`)},children:e.jsx(_t,{className:"h-4 w-4"})})}),e.jsx(Ht,{children:e.jsx("p",{children:"Zobacz kurs"})})]})})]},f.id)})}),n.length>0&&e.jsxs("div",{className:"mt-6 p-4 bg-muted rounded-lg",children:[e.jsxs("p",{className:"text-sm text-muted-foreground mb-3",children:["Wybrano ",n.length," kursów do przypisania"]}),e.jsxs(Y,{children:[e.jsx(I,{variant:"outline",onClick:()=>s(`/teacher/groups/show/${t}`),children:"Anuluj"}),e.jsx(I,{onClick:b,disabled:x,children:x?"Przypisywanie...":"Przypisz kursy"})]})]})]})]})]})},$z=()=>{const{id:t}=mt(),s=me(),[n,i]=g.useState([]),[r,a]=g.useState(""),{data:o,isLoading:l}=Ye({resource:"groups",id:t}),{data:c,isLoading:d}=Z({resource:"users",filters:[{field:"role",operator:"eq",value:"student"}],pagination:{mode:"off"}}),{data:m,isLoading:u}=Z({resource:"group_members",filters:[{field:"group_id",operator:"eq",value:parseInt(t)}],pagination:{mode:"off"},meta:{select:"user_id, group_id"}}),{mutate:h,isLoading:p}=fn(),j=async()=>{if(n.length===0){H.error("Wybierz przynajmniej jednego ucznia");return}try{const k=n.map(N=>h({resource:"group_members",values:{user_id:N,group_id:parseInt(t)}},{onSuccess:()=>{console.log(`Student ${N} assigned successfully`)},onError:z=>{console.error("Error assigning student:",N,z)}}));await Promise.all(k),H.success(`Dodano ${n.length} uczniów do grupy`),s(`/groups/show/${t}`)}catch(k){H.error("Błąd podczas dodawania uczniów"),console.error("Error details:",k)}};if(l||d||u)return e.jsx(G,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const x=o?.data,b=m?.data?.map(k=>k.user_id)||[],w=c?.data?.filter(k=>!b.includes(k.id))||[],y=w.filter(k=>k.full_name.toLowerCase().includes(r.toLowerCase())||k.email.toLowerCase().includes(r.toLowerCase())),v=k=>{i(N=>N.includes(k)?N.filter(z=>z!==k):[...N,k])},_=()=>{i(y.map(k=>k.id))},C=()=>{i([])};return e.jsxs(G,{children:[e.jsxs(I,{variant:"outline",size:"sm",onClick:()=>s(`/teacher/groups/show/${t}`),children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Powrót do grupy"]}),e.jsx(Y,{children:e.jsx(ke,{title:"Dodaj uczniów",description:`Dodawanie uczniów do grupy: ${x?.name}`})}),e.jsxs(M,{children:[e.jsx($,{children:e.jsxs(Y,{children:[e.jsx(O,{children:"Dostępni uczniowie"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(I,{variant:"outline",size:"sm",onClick:_,disabled:y.length===0,children:[e.jsx(Ge,{className:"w-4 h-4 mr-2"}),"Zaznacz wszystkich"]}),e.jsxs(I,{variant:"outline",size:"sm",onClick:C,disabled:n.length===0,children:[e.jsx(Pt,{className:"w-4 h-4 mr-2"}),"Odznacz wszystkich"]})]})]})}),e.jsxs(R,{children:[e.jsx(J,{placeholder:"Szukaj uczniów...",value:r,onChange:k=>a(k.target.value),className:"mb-4"}),y.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:w.length===0?e.jsxs(e.Fragment,{children:[e.jsx(ws,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Wszyscy uczniowie są już w tej grupie"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ws,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Nie znaleziono uczniów"})]})}):e.jsx("div",{className:"space-y-2",children:y.map(k=>e.jsxs("div",{className:"flex items-center space-x-3 p-3 border rounded-lg hover:bg-muted/50 cursor-pointer",onClick:()=>v(k.id),children:[e.jsx(rs,{checked:n.includes(k.id),onCheckedChange:()=>v(k.id),onClick:N=>N.stopPropagation()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:k.full_name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Ea,{className:"w-3 h-3"}),k.email]})]}),e.jsx(q,{variant:"secondary",className:"text-xs",children:"Uczeń"})]},k.id))}),n.length>0&&e.jsxs("div",{className:"mt-6 p-4 bg-muted rounded-lg",children:[e.jsxs("p",{className:"text-sm text-muted-foreground mb-3",children:["Wybrano ",n.length," uczniów do dodania"]}),e.jsxs(Y,{children:[e.jsx(I,{variant:"outline",onClick:()=>s(`/teacher/groups/show/${t}`),children:"Anuluj"}),e.jsx(I,{onClick:j,disabled:p,children:p?"Dodawanie...":"Dodaj uczniów"})]})]})]})]})]})},wu={name:"groups",list:"/teacher/groups",create:"/teacher/groups/create",edit:"/teacher/groups/edit/:id",show:"/teacher/groups/show/:id",meta:{label:"Grupy",icon:e.jsx(oe,{className:"h-4 w-4"})}},Fz=[e.jsx(V,{path:"groups",element:e.jsx(Rz,{})},"groups-list"),e.jsx(V,{path:"groups/create",element:e.jsx(Iz,{})},"groups-create"),e.jsx(V,{path:"groups/edit/:id",element:e.jsx(Ez,{})},"groups-edit"),e.jsx(V,{path:"groups/show/:id",element:e.jsx(Lz,{})},"groups-show"),e.jsx(V,{path:"groups/:id/assign-courses",element:e.jsx(Oz,{})},"groups-assign-courses"),e.jsx(V,{path:"groups/:id/assign-students",element:e.jsx($z,{})},"groups-assign-students")],Bz=()=>{const{show:t}=Xe(),{data:s}=Le(),[n,i]=g.useState(""),[r,a]=g.useState("all"),[o,l]=g.useState([]),[c,d]=g.useState([]),[m,u]=g.useState(!0);g.useEffect(()=>{(async()=>{if(s?.id){u(!0);try{const{data:x,error:b}=await Q.from("course_access").select("course_id").eq("teacher_id",s.id);if(b)throw b;if(!x||x.length===0){l([]),d([]),u(!1);return}const w=[...new Set(x.map(S=>S.course_id))],{data:y,error:v}=await Q.from("course_access").select("group_id").in("course_id",w).not("group_id","is",null);if(v)throw v;const _=[...new Set(y?.map(S=>S.group_id).filter(Boolean)||[])];if(_.length===0){l([]),d([]),u(!1);return}const{data:C,error:k}=await Q.from("groups").select("*").in("id",_).order("name");if(k)throw k;const N=C?.map(S=>({id:S.id,name:S.name,academic_year:S.academic_year,vendor_id:S.vendor_id||0,is_active:S.is_active??!0,created_at:S.created_at||new Date().toISOString()}))||[];l(N);const{data:z,error:T}=await Q.from("users").select(`
            *,
            user_stats(*),
            group_members!inner(
              group_id,
              user_id,
              joined_at,
              groups!inner(*)
            )
          `).in("group_members.group_id",_).eq("role","student").order("full_name");if(T)throw T;const f=z?.map(S=>({id:S.id,email:S.email,full_name:S.full_name,vendor_id:S.vendor_id,role:S.role,is_active:S.is_active,created_at:S.created_at,groups:S.group_members?.map(A=>({group_id:A.group_id,user_id:A.user_id,joined_at:A.joined_at,groups:A.groups}))||[],user_stats:S.user_stats?Array.isArray(S.user_stats)?S.user_stats:[S.user_stats]:[]}))||[];d(f)}catch(x){console.error("Error fetching students:",x),l([]),d([])}finally{u(!1)}}})()},[s]);const h=g.useMemo(()=>c.filter(j=>{const x=!n||j.full_name.toLowerCase().includes(n.toLowerCase())||j.email.toLowerCase().includes(n.toLowerCase()),b=r==="all"||j.groups?.some(w=>w.groups?.id.toString()===r);return x&&b}),[c,n,r]),p=j=>{if(!j)return{color:"text-gray-500",text:"Brak aktywności"};const x=Math.floor((new Date().getTime()-new Date(j).getTime())/(1e3*60*60*24));return x===0?{color:"text-green-600",text:"Dzisiaj"}:x===1?{color:"text-green-600",text:"Wczoraj"}:x<=7?{color:"text-yellow-600",text:`${x} dni temu`}:x<=30?{color:"text-orange-600",text:`${Math.floor(x/7)} tyg. temu`}:{color:"text-red-600",text:"Ponad miesiąc temu"}};return m?e.jsx(G,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):e.jsxs(G,{children:[e.jsx(Y,{children:e.jsx(ke,{title:"Uczniowie z moich kursów",description:`Uczniowie z grup które mają dostęp do Twoich kursów (${o.length} ${o.length===1?"grupa":o.length<5?"grupy":"grup"})`})}),e.jsxs(Y,{className:"gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(Nr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(J,{placeholder:"Szukaj ucznia...",className:"pl-10",value:n,onChange:j=>i(j.target.value)})]}),o.length>0&&e.jsxs(Ce,{value:r,onValueChange:a,children:[e.jsx(we,{className:"w-[200px]",children:e.jsx(_e,{placeholder:"Filtruj po grupie"})}),e.jsxs(ve,{children:[e.jsx(W,{value:"all",children:"Wszystkie grupy"}),o.map(j=>e.jsxs(W,{value:j.id.toString(),children:[j.name," (",j.academic_year,")"]},j.id))]})]})]}),o.length===0?e.jsx(M,{children:e.jsxs(R,{className:"p-12 text-center",children:[e.jsx(dt,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Nie masz przypisanych kursów"}),e.jsx("p",{className:"text-muted-foreground",children:'Poproś administratora o przypisanie Cię do kursów. Administrator może to zrobić w module "Zarządzanie dostępem" → "Dostęp do kursów"'})]})}):h.length===0&&c.length===0?e.jsx(M,{children:e.jsxs(R,{className:"p-12 text-center",children:[e.jsx(oe,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Brak uczniów w grupach z Twoimi kursami"}),e.jsx("p",{className:"text-muted-foreground",children:"Uczniowie pojawią się tutaj, gdy administrator przypisze grupy do Twoich kursów"})]})}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:[h.map(j=>{const x=j.user_stats?.[0],b=p(x?.last_active);return e.jsx(M,{className:"hover:shadow-md transition-shadow",children:e.jsxs(R,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(lb,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm",children:j.full_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:j.email})]})]}),e.jsx(I,{variant:"ghost",size:"sm",onClick:()=>t("users",j.id),children:e.jsx(_t,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3"}),"Grupa"]}),e.jsxs("div",{className:"flex gap-1 flex-wrap justify-end",children:[j.groups?.slice(0,2).map(w=>e.jsx(q,{variant:"outline",className:"text-xs",children:w.groups?.name},w.groups?.id)),j.groups?.length>2&&e.jsxs(q,{variant:"outline",className:"text-xs",children:["+",j.groups.length-2]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(De,{className:"w-3 h-3"}),"Punkty"]}),e.jsxs("span",{className:"font-medium",children:[x?.total_points||0,e.jsxs("span",{className:"text-xs text-muted-foreground ml-1",children:["(poz. ",x?.current_level||1,")"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(ni,{className:"w-3 h-3"}),"Quizy"]}),e.jsx("span",{className:"font-medium",children:x?.quizzes_completed||0})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(Ve,{className:"w-3 h-3"}),"Aktywność"]}),e.jsx("span",{className:`font-medium ${b.color}`,children:b.text})]}),x&&x.daily_streak>0&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(st,{className:"w-3 h-3"}),"Seria dni"]}),e.jsxs("span",{className:"font-medium text-orange-600",children:["🔥 ",x.daily_streak]})]})]}),b.color==="text-red-600"&&e.jsx("div",{className:"mt-3 pt-3 border-t",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs text-orange-600",children:[e.jsx(dt,{className:"w-3 h-3"}),e.jsx("span",{children:"Uczeń może potrzebować wsparcia"})]})})]})},j.id)}),h.length===0&&c.length>0&&e.jsx(M,{className:"col-span-full",children:e.jsxs(R,{className:"p-12 text-center",children:[e.jsx(oe,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Nie znaleziono uczniów spełniających kryteria"})]})})]})]})},Uz=()=>{const{list:t}=Xe(),{id:s}=mt(),{data:n}=Le(),[i,r]=g.useState([]),[a,o]=g.useState([]),[l,c]=g.useState(!0),[d,m]=g.useState(null);if(g.useEffect(()=>{(async()=>{if(s){c(!0);try{const{data:y,error:v}=await Q.from("users").select(`
            *,
            user_stats(*),
            group_members(
              group_id,
              user_id,
              joined_at,
              groups(*)
            )
          `).eq("id",s).single();if(v)throw v;if(y){const _={id:y.id,email:y.email,full_name:y.full_name,vendor_id:y.vendor_id,role:y.role,is_active:y.is_active,created_at:y.created_at,groups:y.group_members?.map(C=>({group_id:C.group_id,user_id:C.user_id,joined_at:C.joined_at,groups:C.groups}))||[],user_stats:y.user_stats?Array.isArray(y.user_stats)?y.user_stats:[y.user_stats]:[]};m(_)}}catch(y){console.error("Error fetching student data:",y)}finally{c(!1)}}})()},[s]),g.useEffect(()=>{(async()=>{if(!(!s||!n?.id))try{const{data:y}=await Q.from("course_access").select("course_id").eq("teacher_id",n.id);if(!y||y.length===0)return;const v=y.map(k=>k.course_id),{data:_}=await Q.from("courses").select(`
            id,
            title,
            topics!inner(
              id,
              title,
              activities!inner(
                id,
                type,
                activity_progress!left(
                  completed_at,
                  score,
                  attempts,
                  time_spent
                )
              )
            )
          `).in("id",v).eq("topics.activities.activity_progress.user_id",s);if(_){const k=_.map(N=>{let z=0,T=0,f=0,S=0,A=0,D=0,P=null;return N.topics?.forEach(L=>{L.activities?.forEach(K=>{z++;const E=K.activity_progress?.[0];E?.completed_at&&(T++,(!P||new Date(E.completed_at)>new Date(P))&&(P=E.completed_at)),K.type==="quiz"&&E?.score!==null&&(f+=E.score,S++,E.score>=70?A++:E.attempts>0&&D++)})}),{course_id:N.id,course_title:N.title,total_activities:z,completed_activities:T,avg_score:S>0?Math.round(f/S):0,quizzes_passed:A,quizzes_failed:D,last_activity:P||""}});r(k)}const{data:C}=await Q.from("activity_progress").select(`
            *,
            activities(
              id,
              title,
              type,
              topics(
                title,
                courses(title)
              )
            )
          `).eq("user_id",s).order("completed_at",{ascending:!1,nullsFirst:!1}).limit(10);C&&o(C)}catch(y){console.error("Error fetching student progress:",y)}})()},[s,n]),l)return e.jsx(G,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const u=d,h=u?.user_stats?.[0],p=w=>w>=80?"text-green-600":w>=60?"text-yellow-600":"text-red-600",j=w=>w==="quiz"?"📝":"📚",x=w=>{const y=Math.floor(w/60),v=w%60;return y>0?`${y}h ${v}min`:`${v}min`},b=w=>{if(!w)return"text-gray-500";const y=Math.floor((new Date().getTime()-new Date(w).getTime())/(1e3*60*60*24));return y===0?"text-green-600":y<=7?"text-yellow-600":y<=30?"text-orange-600":"text-red-600"};return e.jsxs(G,{children:[e.jsxs(I,{variant:"outline",size:"sm",onClick:()=>t("users"),children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsx(Y,{children:e.jsxs("div",{children:[e.jsx(ke,{title:u?.full_name||"",description:u?.email||""}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[u?.groups?.map(w=>e.jsxs(q,{variant:"outline",children:[e.jsx(oe,{className:"w-3 h-3 mr-1"}),w.groups?.name," (",w.groups?.academic_year,")"]},w.groups?.id)),!u?.is_active&&e.jsx(q,{variant:"destructive",children:"Nieaktywny"})]})]})}),e.jsxs(rt,{children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(M,{children:[e.jsx($,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(ii,{className:"w-5 h-5"}),"Podsumowanie postępów"]})}),e.jsxs(R,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg",children:[e.jsx(De,{className:"w-8 h-8 mx-auto mb-2 text-blue-600"}),e.jsx("p",{className:"text-2xl font-bold",children:h?.total_points||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Punkty"})]}),e.jsxs("div",{className:"text-center p-4 bg-purple-50 dark:bg-purple-950/20 rounded-lg",children:[e.jsx(Ee,{className:"w-8 h-8 mx-auto mb-2 text-purple-600"}),e.jsx("p",{className:"text-2xl font-bold",children:h?.current_level||1}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Poziom"})]}),e.jsxs("div",{className:"text-center p-4 bg-green-50 dark:bg-green-950/20 rounded-lg",children:[e.jsx(Ns,{className:"w-8 h-8 mx-auto mb-2 text-green-600"}),e.jsx("p",{className:"text-2xl font-bold",children:h?.quizzes_completed||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ukończone quizy"})]}),e.jsxs("div",{className:"text-center p-4 bg-orange-50 dark:bg-orange-950/20 rounded-lg",children:[e.jsx(st,{className:"w-8 h-8 mx-auto mb-2 text-orange-600"}),e.jsx("p",{className:"text-2xl font-bold",children:h?.daily_streak||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Dni z rzędu"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 pt-4 border-t",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Perfekcyjne wyniki"}),e.jsxs("p",{className:"text-lg font-semibold text-green-600",children:[h?.perfect_scores||0,h&&h.quizzes_completed>0&&e.jsxs("span",{className:"text-sm text-muted-foreground ml-1",children:["(",Math.round(h.perfect_scores/h.quizzes_completed*100),"%)"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Czas nauki"}),e.jsx("p",{className:"text-lg font-semibold",children:h?x(h.total_time_spent):"0min"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Punkty/h (idle)"}),e.jsx("p",{className:"text-lg font-semibold",children:h?.idle_points_rate||1})]})]})]})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-5 h-5"}),"Postępy w Twoich kursach"]})}),e.jsxs(R,{className:"space-y-4",children:[i.map(w=>{const y=w.total_activities>0?Math.round(w.completed_activities/w.total_activities*100):0;return e.jsxs("div",{className:"p-4 border rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold",children:w.course_title}),e.jsxs(q,{variant:y===100?"default":"outline",children:[y,"% ukończone"]})]}),e.jsx(Yt,{value:y,className:"h-2"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Ukończone"}),e.jsxs("p",{className:"font-medium",children:[w.completed_activities,"/",w.total_activities," aktywności"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Średni wynik"}),e.jsx("p",{className:`font-medium ${w.avg_score>0?p(w.avg_score):""}`,children:w.avg_score>0?`${w.avg_score}%`:"Brak"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Quizy"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-green-600 flex items-center",children:[e.jsx(xn,{className:"w-3 h-3 mr-1"}),w.quizzes_passed]}),e.jsxs("span",{className:"text-red-600 flex items-center",children:[e.jsx(ll,{className:"w-3 h-3 mr-1"}),w.quizzes_failed]})]})]})]}),w.last_activity&&e.jsx("div",{className:"pt-2 border-t",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Ostatnia aktywność: ",new Date(w.last_activity).toLocaleDateString("pl-PL")]})})]},w.course_id)}),i.length===0&&e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Uczeń nie rozpoczął jeszcze żadnego z Twoich kursów"})]})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(kr,{className:"w-5 h-5"}),"Ostatnie aktywności"]})}),e.jsx(R,{children:e.jsxs("div",{className:"space-y-3",children:[a.map(w=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:w.activities&&j(w.activities.type)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:w.activities?.title}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[w.activities?.topics?.courses?.title," • ",w.activities?.topics?.title]})]})]}),e.jsxs("div",{className:"text-right",children:[w.score!==null&&e.jsxs("p",{className:`font-medium ${p(w.score)}`,children:[w.score,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:w.completed_at?new Date(w.completed_at).toLocaleDateString("pl-PL"):new Date(w.started_at).toLocaleDateString("pl-PL")}),w.attempts>1&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Próba ",w.attempts]})]})]},`${w.user_id}-${w.activity_id}`)),a.length===0&&e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Brak aktywności do wyświetlenia"})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(M,{children:[e.jsx($,{children:e.jsxs(O,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ve,{className:"w-4 h-4"}),"Czas nauki"]})}),e.jsxs(R,{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Łączny czas"}),e.jsx("p",{className:"text-xl font-bold",children:h?x(h.total_time_spent):"0min"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ostatnia aktywność"}),e.jsx("p",{className:`text-sm font-medium ${b(h?.last_active)}`,children:h?.last_active?new Date(h.last_active).toLocaleDateString("pl-PL",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"Brak aktywności"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ostatnie pobieranie idle"}),e.jsx("p",{className:"text-sm font-medium",children:h?.last_idle_claim?new Date(h.last_idle_claim).toLocaleString("pl-PL",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Nigdy"})]})]})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsxs(O,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ns,{className:"w-4 h-4"}),"Statystyki quizów"]})}),e.jsxs(R,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Ukończone"}),e.jsx("span",{className:"font-bold",children:h?.quizzes_completed||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Wyniki 100%"}),e.jsx("span",{className:"font-bold text-green-600",children:h?.perfect_scores||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Współczynnik"}),e.jsx("span",{className:"font-bold",children:h&&h.quizzes_completed>0?`${Math.round(h.perfect_scores/h.quizzes_completed*100)}%`:"0%"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Średni czas/quiz"}),e.jsx("span",{className:"font-bold",children:h&&h.quizzes_completed>0?x(Math.round(h.total_time_spent/h.quizzes_completed)):"0min"})]})]})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsxs(O,{className:"text-lg flex items-center gap-2",children:[e.jsx(vs,{className:"w-4 h-4"}),"Informacje"]})}),e.jsxs(R,{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Dołączył"}),e.jsx("p",{className:"text-sm font-medium",children:u?.created_at&&new Date(u.created_at).toLocaleDateString("pl-PL",{year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Dni od rejestracji"}),e.jsxs("p",{className:"text-sm font-medium",children:[u?.created_at&&Math.floor((new Date().getTime()-new Date(u.created_at).getTime())/(1e3*60*60*24))," dni"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status konta"}),e.jsx("p",{className:"text-sm font-medium",children:u?.is_active?e.jsx("span",{className:"text-green-600",children:"✓ Aktywny"}):e.jsx("span",{className:"text-red-600",children:"✗ Nieaktywny"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Grupy"}),e.jsx("div",{className:"text-sm font-medium",children:u?.groups?.map(w=>e.jsxs("div",{children:[w.groups?.name," (",w.groups?.academic_year,")"]},w.groups?.id))})]})]})]})]})]})]})},Vz={name:"users",list:"/teacher/users",show:"/teacher/users/show/:id",meta:{label:"Uczniowie",icon:e.jsx(oe,{className:"h-4 w-4"})}},qz=[e.jsx(V,{path:"users",element:e.jsx(Bz,{})},"users-list"),e.jsx(V,{path:"users/show/:id",element:e.jsx(Uz,{})},"users-show")],Kz=t=>{const s=new Date(t);return new Date(Date.UTC(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate())).toISOString().slice(0,10)},Wz=()=>{const t=me(),s={queryOptions:{staleTime:1/0,gcTime:1800*1e3,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,refetchInterval:!1,retry:0}},{data:n}=Z({resource:"user_stats",filters:[{field:"last_active",operator:"gte",value:new Date(Date.now()-10080*60*1e3).toISOString().split("T")[0]}],pagination:{mode:"off"},...s}),{data:i}=Z({resource:"activity_progress",pagination:{mode:"off"},meta:{select:"*, activities(type, passing_score)",query:m=>m.not("completed_at","is",null)},...s}),{data:r}=Z({resource:"user_stats",pagination:{mode:"off"},sorters:[{field:"total_points",order:"desc"}],...s}),a=g.useMemo(()=>{const m=n?.data?.length||0,u=i?.data?.filter(w=>w.activities?.type==="quiz"&&w.score!==null).map(w=>Number(w.score))||[],h=u.length>0?Math.round(u.reduce((w,y)=>w+y,0)/u.length):0,p=i?.data?.length||0,j=i?.data?.filter(w=>w.completed_at).length||0,x=p>0?Math.round(j/p*100):0,b=r?.data?.reduce((w,y)=>w+Number(y.total_points),0)||0;return{activeUsers:m,activeUsersChange:12,avgQuizScore:h,avgQuizScoreChange:3,completionRate:x,completionRateChange:5,totalPoints:b,totalPointsChange:8}},[n?.data,i?.data,r?.data]),o=g.useMemo(()=>{const m=Array.from({length:7},(h,p)=>{const j=new Date;return j.setUTCDate(j.getUTCDate()-(6-p)),j.toISOString().slice(0,10)}),u=new Map;for(const h of m)u.set(h,{quizzes:0,materials:0});for(const h of i?.data||[]){if(!h?.started_at)continue;const p=Kz(h.started_at);if(!u.has(p))continue;const j=u.get(p);h.activities?.type==="quiz"?j.quizzes+=1:h.activities?.type==="material"&&(j.materials+=1)}return m.map(h=>({date:new Date(h+"T00:00:00Z").toLocaleDateString("pl-PL",{weekday:"short",day:"numeric"}),quizzes:u.get(h).quizzes,materials:u.get(h).materials}))},[i?.data]),l=[{title:"Aktywni użytkownicy",value:a.activeUsers,change:a.activeUsersChange,icon:oe,color:"text-blue-600",bgColor:"bg-blue-50",link:"/teacher/reports/engagement"},{title:"Średni wynik quizów",value:`${a.avgQuizScore}%`,change:a.avgQuizScoreChange,icon:Ee,color:"text-green-600",bgColor:"bg-green-50",link:"/teacher/reports/performance"},{title:"Wskaźnik ukończeń",value:`${a.completionRate}%`,change:a.completionRateChange,icon:st,color:"text-purple-600",bgColor:"bg-purple-50",link:"/teacher/reports/progress"},{title:"Suma punktów",value:a.totalPoints.toLocaleString("pl-PL"),change:a.totalPointsChange,icon:De,color:"text-orange-600",bgColor:"bg-orange-50",link:"/teacher/reports/gamification"}],c=[{to:"/teacher/reports/engagement",title:"Raport zaangażowania",description:"Aktywność użytkowników, czas nauki, trendy",icon:e.jsx(kr,{className:"h-5 w-5"}),color:"text-blue-600"},{to:"/teacher/reports/progress",title:"Raport postępów",description:"Postęp kursów, wskaźniki ukończeń",icon:e.jsx(st,{className:"h-5 w-5"}),color:"text-purple-600"},{to:"/teacher/reports/performance",title:"Raport wyników",description:"Wyniki quizów, najtrudniejsze pytania",icon:e.jsx(Ee,{className:"h-5 w-5"}),color:"text-green-600"},{to:"/teacher/reports/gamification",title:"Raport gamifikacji",description:"Ranking punktowy, poziomy, osiągnięcia",icon:e.jsx(De,{className:"h-5 w-5"}),color:"text-orange-600"}],d=r?.data?.slice(0,5)||[];return e.jsxs(G,{children:[e.jsx(Y,{children:e.jsx(ke,{title:"Centrum Raportów",description:"Kompleksowy przegląd wyników i postępów uczniów"})}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-6",children:l.map((m,u)=>e.jsxs(M,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>t(m.link),children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(O,{className:"text-sm font-medium",children:m.title}),e.jsx("div",{className:`${m.bgColor} p-2 rounded-lg`,children:e.jsx(m.icon,{className:`h-4 w-4 ${m.color}`})})]}),e.jsxs(R,{children:[e.jsx("div",{className:"text-2xl font-bold",children:m.value}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e.jsxs("span",{className:m.change>0?"text-green-600":"text-red-600",children:[m.change>0?"+":"",m.change,"%"]})," ","vs. ostatnie 7 dni"]})]})]},u))}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3 mb-6",children:[e.jsxs(M,{className:"lg:col-span-2",children:[e.jsx($,{children:e.jsxs(O,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Aktywność w ostatnich 7 dniach"}),e.jsx(I,{variant:"ghost",size:"sm",onClick:()=>t("/teacher/reports/engagement"),children:"Zobacz więcej →"})]})}),e.jsx(R,{children:e.jsx("div",{style:{width:"100%",height:250},children:e.jsx(Ae,{width:"100%",height:"100%",children:e.jsxs(Va,{data:o,children:[e.jsx(bt,{strokeDasharray:"3 3"}),e.jsx(ct,{dataKey:"date"}),e.jsx(nt,{allowDecimals:!1}),e.jsx(Me,{}),e.jsx(Vs,{type:"monotone",dataKey:"materials",stackId:"1",stroke:"#82ca9d",fill:"#82ca9d",name:"Materiały",isAnimationActive:!1,dot:!0}),e.jsx(Vs,{type:"monotone",dataKey:"quizzes",stackId:"1",stroke:"#8884d8",fill:"#8884d8",name:"Quizy",isAnimationActive:!1,dot:!0})]},`${o.map(m=>m.quizzes+m.materials).join("-")}`)})})})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsxs(O,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Top 5 uczniów"}),e.jsx(De,{className:"h-4 w-4 text-orange-600"})]})}),e.jsx(R,{children:e.jsx("div",{className:"space-y-3",children:d.map((m,u)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold
                      ${u===0?"bg-yellow-100 text-yellow-700":u===1?"bg-gray-100 text-gray-700":u===2?"bg-orange-100 text-orange-700":"bg-muted text-muted-foreground"}`,children:u+1}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium",children:["Uczeń #",u+1]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Poziom ",m.current_level]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-bold",children:m.total_points}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"punktów"})]})]},m.user_id))})})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Szczegółowe raporty"}),e.jsx(rt,{variant:"2-2-4",children:c.map(m=>e.jsxs(M,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>t(m.to),children:[e.jsx($,{children:e.jsxs(O,{className:"flex items-center gap-2 text-base",children:[e.jsx("span",{className:m.color,children:m.icon}),m.title]})}),e.jsx(R,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:m.description})})]},m.to))})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Ostatnie aktywności"})}),e.jsx(R,{children:e.jsx("div",{className:"space-y-2",children:i?.data?.slice(0,10).map(m=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b last:border-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{variant:m.activities?.type==="quiz"?"default":"secondary",children:m.activities?.type==="quiz"?"Quiz":"Materiał"}),e.jsxs("span",{className:"text-sm",children:["Aktywność #",m.activity_id]})]}),e.jsxs("div",{className:"text-right",children:[m.score!==null&&e.jsxs("span",{className:"text-sm font-medium",children:[m.score,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(m.started_at).toLocaleDateString("pl-PL")})]})]},`${m.user_id}-${m.activity_id}`))})})]})]})},Gz=()=>{const[t,s]=g.useState("7d"),[n,i]=g.useState("all"),r=Uy()(),[a,o]=g.useState(!0),[l,c]=g.useState([]),[d,m]=g.useState([]),[u,h]=g.useState([]),[p,j]=g.useState([]),x=()=>{const f=new Date,S=new Date;switch(t){case"7d":S.setDate(S.getDate()-7);break;case"30d":S.setDate(S.getDate()-30);break;case"90d":S.setDate(S.getDate()-90);break}return{start:S,end:f}},{start:b,end:w}=x();g.useEffect(()=>{(async()=>{try{o(!0);const[S,A,D,P]=await Promise.all([r.getList({resource:"activity_progress",filters:[{field:"started_at",operator:"gte",value:b.toISOString()}],pagination:{mode:"off"}}),r.getList({resource:"activities",pagination:{mode:"off"},meta:{select:"id, type, topic_id"}}),r.getList({resource:"topics",pagination:{mode:"off"},meta:{select:"id, course_id"}}),r.getList({resource:"courses",filters:[{field:"is_published",operator:"eq",value:!0}],pagination:{mode:"off"}})]);c(S.data),m(A.data),h(D.data),j(P.data)}catch(S){console.error("Error fetching data:",S)}finally{o(!1)}})()},[]);const y=g.useMemo(()=>{if(!l.length||!d.length||!u.length)return[];const f=new Map(d.map(P=>[P.id,{type:P.type,topicId:P.topic_id}])),S=new Map(u.map(P=>[P.id,P.course_id])),A=l.map(P=>{const L=f.get(P.activity_id),K=L?.topicId?S.get(L.topicId):void 0;return{...P,activityType:L?.type,courseId:K}});if(n==="all")return A;const D=parseInt(n);return A.filter(P=>P.courseId===D)},[l,d,u,n]),v=g.useMemo(()=>{const f=new Set(y.map(L=>L.user_id)).size,S=y.reduce((L,K)=>L+(K.time_spent||0),0),A=f>0?(S/60/f).toFixed(1):"0",D=y.filter(L=>L.completed_at).length,P=y.length>0?Math.round(D/y.length*100):0;return{activeUsers:f,activeUsersChange:12,avgTimeHours:A,avgTimeChange:5,completedActivities:D,completedChange:18,engagementRate:P,engagementChange:3}},[y]),_=g.useMemo(()=>{const f=Math.ceil((w.getTime()-b.getTime())/864e5),S=[];for(let A=0;A<f;A++){const D=new Date(b);D.setDate(D.getDate()+A);const P=D.toISOString().split("T")[0],L=y.filter(E=>E.started_at.startsWith(P)),K=new Set(L.map(E=>E.user_id)).size;S.push({date:D.toLocaleDateString("pl-PL",{day:"numeric",month:"short"}),users:K})}return S},[y,b,w]),C=g.useMemo(()=>{const f=y.filter(D=>D.activityType==="quiz").length,S=y.filter(D=>D.activityType==="material").length;return f+S===0?[{name:"Brak danych",value:1,color:"#e5e7eb"}]:[{name:"Quizy",value:f,color:"#8884d8"},{name:"Materiały",value:S,color:"#82ca9d"}].filter(D=>D.value>0)},[y]),k=g.useMemo(()=>{const f=new Map;y.forEach(A=>{const D=f.get(A.user_id)||0;f.set(A.user_id,D+(A.time_spent||0))});const S=[{range:"0-30min",count:0,color:"#94a3b8"},{range:"30-60min",count:0,color:"#60a5fa"},{range:"1-2h",count:0,color:"#818cf8"},{range:"2-5h",count:0,color:"#a78bfa"},{range:"5h+",count:0,color:"#c084fc"}];return f.forEach(A=>{A<=30?S[0].count++:A<=60?S[1].count++:A<=120?S[2].count++:A<=300?S[3].count++:S[4].count++}),S.filter(A=>A.count>0)},[y]),N=g.useMemo(()=>{const f=Math.ceil((w.getTime()-b.getTime())/864e5),S=[];for(let A=0;A<f;A++){const D=new Date(b);D.setDate(D.getDate()+A);const P=D.toISOString().split("T")[0],L=y.filter(B=>B.started_at.startsWith(P)),K=L.filter(B=>B.completed_at).length,E=L.length,U=E>0?Math.round(K/E*100):0;S.push({date:D.toLocaleDateString("pl-PL",{day:"numeric",month:"short"}),rate:U,completed:K,total:E})}return S},[y,b,w]),z=[{label:"Aktywni użytkownicy",value:v.activeUsers.toString(),icon:oe,change:`+${v.activeUsersChange}%`,color:"text-blue-600",bgColor:"bg-blue-50"},{label:"Średni czas nauki",value:`${v.avgTimeHours}h`,icon:Ve,change:`+${v.avgTimeChange}%`,color:"text-purple-600",bgColor:"bg-purple-50"},{label:"Ukończone aktywności",value:v.completedActivities.toString(),icon:kr,change:`+${v.completedChange}%`,color:"text-green-600",bgColor:"bg-green-50"},{label:"Wskaźnik zaangażowania",value:`${v.engagementRate}%`,icon:st,change:`+${v.engagementChange}%`,color:"text-orange-600",bgColor:"bg-orange-50"}],T=g.useMemo(()=>{if(!p.length||!y.length)return[];const f=new Map;return p.forEach(S=>{const A=typeof S.id=="number"?S.id:parseInt(S.id);isNaN(A)||f.set(A,{title:S.title||"",users:new Set,activities:0,completed:0})}),y.forEach(S=>{const A=S.courseId;if(A&&f.has(A)){const D=f.get(A);D&&(D.users.add(S.user_id),D.activities++,S.completed_at&&D.completed++)}}),Array.from(f.entries()).filter(([S,A])=>A.activities>0).map(([S,A])=>({id:S,title:A.title,users:A.users.size,activities:A.activities,completionRate:A.activities>0?Math.round(A.completed/A.activities*100):0})).sort((S,A)=>A.users-S.users).slice(0,5)},[y,p]);return a?e.jsx(G,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-muted-foreground",children:"Ładowanie danych..."})})}):e.jsxs(G,{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(bs,{to:"/teacher/reports/overview",children:e.jsxs(I,{variant:"ghost",size:"sm",children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),"Powrót do centrum raportów"]})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Raport zaangażowania"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Ce,{value:n,onValueChange:i,children:[e.jsx(we,{className:"w-[200px]",children:e.jsx(_e,{placeholder:"Wybierz kurs"})}),e.jsxs(ve,{children:[e.jsx(W,{value:"all",children:"Wszystkie kursy"}),p.map(f=>{const S=typeof f.id=="number"?f.id:parseInt(f.id);return e.jsx(W,{value:S.toString(),children:f.title},S)})]})]}),e.jsxs(Ce,{value:t,onValueChange:s,children:[e.jsx(we,{className:"w-[150px]",children:e.jsx(_e,{})}),e.jsxs(ve,{children:[e.jsx(W,{value:"7d",children:"Ostatnie 7 dni"}),e.jsx(W,{value:"30d",children:"Ostatnie 30 dni"}),e.jsx(W,{value:"90d",children:"Ostatnie 90 dni"})]})]})]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-6",children:z.map((f,S)=>e.jsxs(M,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(O,{className:"text-sm font-medium",children:f.label}),e.jsx("div",{className:`${f.bgColor} p-2 rounded-lg`,children:e.jsx(f.icon,{className:`h-4 w-4 ${f.color}`})})]}),e.jsxs(R,{children:[e.jsx("div",{className:"text-2xl font-bold",children:f.value}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"text-green-600",children:f.change})," vs. poprzedni okres"]})]})]},S))}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3 mb-6",children:[e.jsxs(M,{className:"lg:col-span-2",children:[e.jsx($,{children:e.jsx(O,{children:"Aktywni użytkownicy w czasie"})}),e.jsx(R,{children:e.jsx(Ae,{width:"100%",height:300,children:e.jsxs(Va,{data:_,children:[e.jsx(bt,{strokeDasharray:"3 3"}),e.jsx(ct,{dataKey:"date"}),e.jsx(nt,{}),e.jsx(Me,{}),e.jsx(Vs,{type:"monotone",dataKey:"users",stroke:"#8884d8",fill:"#8884d8",fillOpacity:.6,name:"Aktywni użytkownicy",isAnimationActive:!1})]},`${_.map(f=>f.users).join("-")}`)})})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Typy aktywności"})}),e.jsx(R,{children:e.jsx(Ae,{width:"100%",height:300,children:e.jsxs(ha,{children:[e.jsx(fa,{data:C,cx:"50%",cy:"50%",labelLine:!1,label:({name:f,percent:S})=>S!==void 0&&S>0?`${f}: ${(S*100).toFixed(0)}%`:"",outerRadius:80,fill:"#8884d8",dataKey:"value",isAnimationActive:!1,children:C.map((f,S)=>e.jsx(Qt,{fill:f.color},`cell-${S}`))}),e.jsx(Me,{})]})})})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2 mb-6",children:[e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Rozkład czasu nauki użytkowników"})}),e.jsx(R,{children:e.jsx(Ae,{width:"100%",height:250,children:e.jsxs(zr,{data:k,children:[e.jsx(bt,{strokeDasharray:"3 3"}),e.jsx(ct,{dataKey:"range"}),e.jsx(nt,{}),e.jsx(Me,{}),e.jsx(ai,{dataKey:"count",name:"Liczba użytkowników",isAnimationActive:!1,children:k.map((f,S)=>e.jsx(Qt,{fill:f.color},`cell-${S}`))})]},`${k.map(f=>f.count).join("-")}`)})})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Wskaźnik ukończeń w czasie"})}),e.jsx(R,{children:e.jsx(Ae,{width:"100%",height:250,children:e.jsxs(Hh,{data:N,children:[e.jsx(bt,{strokeDasharray:"3 3"}),e.jsx(ct,{dataKey:"date"}),e.jsx(nt,{}),e.jsx(Me,{content:({active:f,payload:S})=>{if(f&&S&&S.length){const A=S[0].payload;return e.jsxs("div",{className:"bg-white p-2 border rounded shadow-sm",children:[e.jsx("p",{className:"font-medium text-sm",children:A.date}),e.jsxs("p",{className:"text-xs",children:["Wskaźnik: ",A.rate,"%"]}),e.jsxs("p",{className:"text-xs",children:["Ukończone: ",A.completed,"/",A.total]})]})}return null}}),e.jsx(ac,{type:"monotone",dataKey:"rate",stroke:"#22c55e",strokeWidth:2,dot:{fill:"#22c55e"},name:"Wskaźnik ukończeń %",isAnimationActive:!1})]},`${N.map(f=>f.rate).join("-")}`)})})]})]}),T.length>0&&e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Zaangażowanie według kursów"})}),e.jsx(R,{children:e.jsx("div",{className:"space-y-3",children:T.map(f=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:f.title}),e.jsxs("div",{className:"flex gap-4 mt-1 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Użytkownicy: ",f.users]}),e.jsxs("span",{children:["Aktywności: ",f.activities]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs(q,{variant:f.completionRate>=70?"default":"secondary",children:[f.completionRate,"% ukończonych"]})})]},f.id))})})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Kluczowe wnioski"})}),e.jsx(R,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(vs,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Trendy"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:v.activeUsers>0?`${v.activeUsers} unikalnych użytkowników aktywnych w wybranym okresie`:"Brak aktywności w wybranym okresie"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Wskaźnik ukończeń"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[v.engagementRate,"% rozpoczętych aktywności zostało ukończonych"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_t,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Średnie zaangażowanie"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Średnio ",v.avgTimeHours," godzin nauki na użytkownika"]})]})]})})]})]})},Hz=()=>{const[t,s]=g.useState("all"),[n,i]=g.useState(null),[r,a]=g.useState("progress"),o={queryOptions:{staleTime:1/0,gcTime:1800*1e3,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,refetchInterval:!1,retry:0}},{data:l}=Z({resource:"courses",filters:[{field:"is_published",operator:"eq",value:!0}],pagination:{mode:"off"},...o}),{data:c}=Z({resource:"activities",filters:[{field:"is_published",operator:"eq",value:!0}],pagination:{mode:"off"},meta:{select:"id, topic_id, type, topics(id, course_id)"},...o}),{data:d}=Z({resource:"activity_progress",pagination:{mode:"off"},meta:{select:"*, activities(id, topic_id, type, topics(id, course_id))"},...o}),{data:m}=Z({resource:"groups",pagination:{mode:"off"},...o}),{data:u}=Z({resource:"group_members",pagination:{mode:"off"},filters:t!=="all"?[{field:"group_id",operator:"eq",value:parseInt(t)}]:[],...o}),h=g.useMemo(()=>{if(!l?.data||!c?.data||!d?.data)return[];const b=new Map;return l.data.forEach(w=>{const y=typeof w.id=="number"?w.id:parseInt(w.id),_=c.data.filter(P=>P.topics?.course_id===y).length,C=d.data.filter(P=>P.activities?.topics?.course_id===y),k=t!=="all"&&u?.data?C.filter(P=>u.data.some(L=>L.user_id===P.user_id)):C,N=new Set(k.map(P=>P.user_id)),z=new Map,T=new Map;k.forEach(P=>{if(P.completed_at){const L=z.get(P.user_id)||0;z.set(P.user_id,L+1)}if(P.score!==null&&P.score!==void 0){const L=T.get(P.user_id)||[];L.push(Number(P.score)),T.set(P.user_id,L)}});const f=z.size,S=f>0?Array.from(z.values()).reduce((P,L)=>P+L,0)/f:0,A=Array.from(T.values()).flat(),D=A.length>0?Math.round(A.reduce((P,L)=>P+L,0)/A.length):null;b.set(y,{courseId:y,courseTitle:w.title||"",totalActivities:_,completedActivities:Math.round(S),avgScore:D,totalStudents:N.size,activeStudents:f})}),Array.from(b.values()).filter(w=>w.totalActivities>0).sort((w,y)=>{const v=w.totalActivities>0?w.completedActivities/w.totalActivities:0;return(y.totalActivities>0?y.completedActivities/y.totalActivities:0)-v})},[l?.data,c?.data,d?.data,t,u?.data]),p=g.useMemo(()=>{if(!d?.data||!h.length)return[];const b=new Map;h.forEach(y=>{const v=d.data.filter(C=>C.activities?.topics?.course_id===y.courseId);(t!=="all"&&u?.data?v.filter(C=>u.data.some(k=>k.user_id===C.user_id)):v).forEach(C=>{b.has(C.user_id)||b.set(C.user_id,new Map);const k=b.get(C.user_id);k.has(y.courseId)||k.set(y.courseId,{userId:C.user_id,courseId:y.courseId,courseTitle:y.courseTitle,completedActivities:0,totalActivities:y.totalActivities,avgScore:null,lastActivity:null,timeSpent:0});const N=k.get(y.courseId);if(C.completed_at&&N.completedActivities++,C.score!==null&&C.score!==void 0){const z=[];N.avgScore!==null&&z.push(N.avgScore),z.push(Number(C.score)),N.avgScore=Math.round(z.reduce((T,f)=>T+f,0)/z.length)}N.timeSpent+=C.time_spent||0,(!N.lastActivity||new Date(C.started_at)>new Date(N.lastActivity))&&(N.lastActivity=C.started_at)})});const w=[];return b.forEach(y=>{y.forEach(v=>{w.push(v)})}),w.sort((y,v)=>{switch(r){case"progress":{const _=y.totalActivities>0?y.completedActivities/y.totalActivities:0;return(v.totalActivities>0?v.completedActivities/v.totalActivities:0)-_}case"score":return(v.avgScore||0)-(y.avgScore||0);case"activity":return new Date(v.lastActivity||0).getTime()-new Date(y.lastActivity||0).getTime();default:return 0}})},[d?.data,h,t,u?.data,r]),j=g.useMemo(()=>{const b=[{name:"Rozpoczęli kurs",value:0,fill:"#8884d8"},{name:"Ukończyli 25%",value:0,fill:"#83a6ed"},{name:"Ukończyli 50%",value:0,fill:"#8dd1e1"},{name:"Ukończyli 75%",value:0,fill:"#82ca9d"},{name:"Ukończyli 100%",value:0,fill:"#67b26f"}],w=new Map;return p.forEach(y=>{const v=y.totalActivities>0?y.completedActivities/y.totalActivities*100:0,_=w.get(y.userId)||0;w.set(y.userId,Math.max(_,v))}),w.forEach(y=>{y>0&&b[0].value++,y>=25&&b[1].value++,y>=50&&b[2].value++,y>=75&&b[3].value++,y>=100&&b[4].value++}),b},[p]),x=g.useMemo(()=>{const b=new Set(p.map(C=>C.userId)).size,w=new Set(p.filter(C=>C.completedActivities>0).map(C=>C.userId)).size,y=h.length>0?Math.round(h.reduce((C,k)=>C+(k.totalActivities>0?k.completedActivities/k.totalActivities*100:0),0)/h.length):0,v=h.filter(C=>C.avgScore!==null),_=v.length>0?Math.round(v.reduce((C,k)=>C+k.avgScore,0)/v.length):0;return{totalStudents:b,activeStudents:w,avgCompletion:y,avgScore:_}},[p,h]);return e.jsxs(G,{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(bs,{to:"/teacher/reports/overview",children:e.jsxs(I,{variant:"ghost",size:"sm",children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),"Powrót do centrum raportów"]})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Raport postępów"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Ce,{value:t,onValueChange:s,children:[e.jsx(we,{className:"w-[200px]",children:e.jsx(_e,{placeholder:"Wybierz grupę"})}),e.jsxs(ve,{children:[e.jsx(W,{value:"all",children:"Wszystkie grupy"}),m?.data?.map(b=>e.jsx(W,{value:b.id?.toString()||"",children:b.name||"Bez nazwy"},b.id||"unknown"))]})]}),e.jsxs(I,{variant:"outline",size:"sm",children:[e.jsx(Kh,{className:"mr-2 h-4 w-4"}),"Eksportuj"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4 mb-6",children:[e.jsxs(M,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(O,{className:"text-sm font-medium",children:"Wszyscy uczniowie"}),e.jsx(oe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(R,{children:[e.jsx("div",{className:"text-2xl font-bold",children:x.totalStudents}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"w wybranych grupach"})]})]}),e.jsxs(M,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(O,{className:"text-sm font-medium",children:"Aktywni uczniowie"}),e.jsx(st,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(R,{children:[e.jsx("div",{className:"text-2xl font-bold",children:x.activeStudents}),e.jsx("p",{className:"text-xs text-muted-foreground",children:x.totalStudents>0?`${Math.round(x.activeStudents/x.totalStudents*100)}% wszystkich`:"0% wszystkich"})]})]}),e.jsxs(M,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(O,{className:"text-sm font-medium",children:"Średni postęp"}),e.jsx(Se,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(R,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[x.avgCompletion,"%"]}),e.jsx(Yt,{value:x.avgCompletion,className:"mt-2"})]})]}),e.jsxs(M,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(O,{className:"text-sm font-medium",children:"Średni wynik"}),e.jsx(Ee,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(R,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[x.avgScore,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"z ukończonych quizów"})]})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2 mb-6",children:[e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Postęp według kursów"})}),e.jsx(R,{children:e.jsx(Ae,{width:"100%",height:300,children:e.jsxs(zr,{data:h,layout:"vertical",children:[e.jsx(bt,{strokeDasharray:"3 3"}),e.jsx(ct,{type:"number",domain:[0,100]}),e.jsx(nt,{dataKey:"courseTitle",type:"category",width:120,tick:{fontSize:12}}),e.jsx(Me,{formatter:b=>`${b}%`,content:({active:b,payload:w})=>{if(b&&w&&w.length){const y=w[0].payload;return e.jsxs("div",{className:"bg-white p-2 border rounded shadow-sm",children:[e.jsx("p",{className:"font-medium text-sm",children:y.courseTitle}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Ukończono: ",y.completedActivities,"/",y.totalActivities," aktywności"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Aktywnych: ",y.activeStudents,"/",y.totalStudents," uczniów"]}),y.avgScore!==null&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Średni wynik: ",y.avgScore,"%"]})]})}return null}}),e.jsx(ai,{dataKey:b=>b.totalActivities>0?Math.round(b.completedActivities/b.totalActivities*100):0,fill:"#8884d8",name:"Postęp",isAnimationActive:!1})]},`${h.map(b=>b.courseId).join("-")}`)})})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Lejek ukończeń"})}),e.jsx(R,{children:e.jsx(Ae,{width:"100%",height:300,children:e.jsxs(vb,{children:[e.jsx(Me,{}),e.jsxs(Nb,{dataKey:"value",data:j,isAnimationActive:!1,children:[e.jsx(kb,{position:"center",fill:"#fff"}),j.map((b,w)=>e.jsx(Qt,{fill:b.fill},`cell-${w}`))]})]})})})]})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsxs(O,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Szczegółowe postępy uczniów"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(Ce,{value:r,onValueChange:b=>a(b),children:[e.jsx(we,{className:"w-[150px]",children:e.jsx(_e,{})}),e.jsxs(ve,{children:[e.jsx(W,{value:"progress",children:"Sortuj wg postępu"}),e.jsx(W,{value:"score",children:"Sortuj wg wyniku"}),e.jsx(W,{value:"activity",children:"Sortuj wg aktywności"})]})]})})]})}),e.jsxs(R,{children:[e.jsx("div",{className:"rounded-md border",children:e.jsxs(Nn,{children:[e.jsx(kn,{children:e.jsxs(ut,{children:[e.jsx(ie,{children:"Uczeń"}),e.jsx(ie,{children:"Kurs"}),e.jsx(ie,{children:"Postęp"}),e.jsx(ie,{children:"Średni wynik"}),e.jsx(ie,{children:"Czas nauki"}),e.jsx(ie,{children:"Ostatnia aktywność"})]})}),e.jsx(zn,{children:p.slice(0,20).map((b,w)=>{const y=b.totalActivities>0?Math.round(b.completedActivities/b.totalActivities*100):0;return e.jsxs(ut,{children:[e.jsxs(re,{className:"font-medium",children:["Uczeń #",w+1]}),e.jsx(re,{children:b.courseTitle}),e.jsx(re,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Yt,{value:y,className:"w-[60px]"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[y,"%"]})]})}),e.jsx(re,{children:b.avgScore!==null?e.jsxs(q,{variant:b.avgScore>=70?"default":"secondary",children:[b.avgScore,"%"]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsxs(re,{children:[Math.floor(b.timeSpent/60),"h ",b.timeSpent%60,"m"]}),e.jsx(re,{children:b.lastActivity?new Date(b.lastActivity).toLocaleDateString("pl-PL"):"-"})]},`${b.userId}-${b.courseId}`)})})]})}),p.length>20&&e.jsx("div",{className:"mt-4 text-center",children:e.jsxs(I,{variant:"outline",size:"sm",children:["Zobacz wszystkich (",p.length,")"]})})]})]})]})},ix=["#94a3b8","#60a5fa","#818cf8","#a78bfa","#c084fc","#e879f9","#f472b6","#fb923c","#fbbf24","#fde047"],vu=t=>{const s=Math.min(Math.floor((t-1)/10),9);return ix[s]},Zz=()=>{const[t,s]=g.useState("all"),[n,i]=g.useState("30d"),[r,a]=g.useState(!1),o=()=>{const k=new Date,N=new Date;switch(n){case"7d":N.setDate(N.getDate()-7);break;case"30d":N.setDate(N.getDate()-30);break;case"90d":N.setDate(N.getDate()-90);break}return{start:N,end:k}},{start:l}=o(),c={queryOptions:{staleTime:1/0,gcTime:1800*1e3,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,refetchInterval:!1,retry:0}},{data:d}=Z({resource:"user_stats",pagination:{mode:"off"},sorters:[{field:"total_points",order:"desc"}],meta:{select:"*, users(full_name, email, role)"},...c}),{data:m}=Z({resource:"groups",pagination:{mode:"off"},...c}),{data:u}=Z({resource:"group_members",filters:t!=="all"?[{field:"group_id",operator:"eq",value:parseInt(t)}]:[],pagination:{mode:"off"},...c}),{data:h}=Z({resource:"activity_progress",filters:[{field:"started_at",operator:"gte",value:l.toISOString()}],pagination:{mode:"off"},meta:{select:"*, activities(type)"},...c}),p=g.useMemo(()=>{let k=d?.data||[];if(k=k.filter(N=>!N.users?.role||N.users.role==="student"),t!=="all"&&u?.data){const N=u.data.map(z=>z.user_id);k=k.filter(z=>N.includes(z.user_id))}if(r){const N=new Date;N.setDate(N.getDate()-7),k=k.filter(z=>new Date(z.last_active)>N)}return k},[d?.data,t,u?.data,r]),j=g.useMemo(()=>{const k=p.length,N=p.reduce((S,A)=>S+A.total_points,0),z=k>0?Math.round(p.reduce((S,A)=>S+A.current_level,0)/k):0,T=p.filter(S=>S.daily_streak>0).length,f=Math.max(...p.map(S=>S.daily_streak),0);return{totalUsers:k,totalPoints:N,avgLevel:z,activeStreaks:T,maxStreak:f}},[p]),x=g.useMemo(()=>{const k=new Map;return p.forEach(N=>{const z=Math.floor((N.current_level-1)/10)*10+1;k.set(z,(k.get(z)||0)+1)}),Array.from(k.entries()).map(([N,z])=>({level:`${N}-${N+9}`,count:z,percentage:p.length>0?Math.round(z/p.length*100):0})).sort((N,z)=>parseInt(N.level)-parseInt(z.level))},[p]),b=g.useMemo(()=>p.slice(0,10),[p]),w=g.useMemo(()=>{if(!h?.data)return[];const k=new Map;return h.data.forEach(N=>{if(N.activities?.type==="quiz"&&N.completed_at){const z=k.get(N.user_id)||0;k.set(N.user_id,z+1)}}),p.map(N=>({points:N.total_points,quizzes:k.get(N.user_id)||0,level:N.current_level,streak:N.daily_streak,timeHours:Math.round((N.total_time_spent||0)/60)}))},[p,h?.data]),y=g.useMemo(()=>{const k=[{range:"0",count:0},{range:"1-3",count:0},{range:"4-7",count:0},{range:"8-14",count:0},{range:"15-30",count:0},{range:"30+",count:0}];return p.forEach(N=>{N.daily_streak===0?k[0].count++:N.daily_streak<=3?k[1].count++:N.daily_streak<=7?k[2].count++:N.daily_streak<=14?k[3].count++:N.daily_streak<=30?k[4].count++:k[5].count++}),k},[p]),v=g.useMemo(()=>{if(!h?.data)return[];const k=new Map,N=[];for(let z=13;z>=0;z--){const T=new Date;T.setDate(T.getDate()-z);const f=T.toISOString().split("T")[0];N.push(f),k.set(f,{points:0,activities:0})}return h.data.forEach(z=>{const T=z.started_at.split("T")[0];if(k.has(T)){const f=k.get(T);f.activities++,z.activities?.type==="material"&&z.completed_at?f.points+=10:z.activities?.type==="quiz"&&z.score!==null&&z.score!==void 0&&(f.points+=Math.round(20+z.score/100*30))}}),N.map(z=>({date:new Date(z+"T00:00:00").toLocaleDateString("pl-PL",{day:"numeric",month:"short"}),points:k.get(z)?.points||0}))},[h?.data]),_=g.useMemo(()=>{if(!h?.data)return[];let k=0,N=0;const z=p.filter(f=>f.daily_streak>0).length*5,T=p.filter(f=>f.current_level>1).length*50;return h.data.forEach(f=>{f.activities?.type==="quiz"&&f.score!==null&&f.score!==void 0?k+=Math.round(20+f.score/100*30):f.activities?.type==="material"&&f.completed_at&&(N+=10)}),[{type:"Ukończone quizy",points:k,color:"#8884d8"},{type:"Materiały",points:N,color:"#82ca9d"},{type:"Codzienne logowanie",points:z,color:"#ffc658"},{type:"Awans poziomów",points:T,color:"#ff8042"}].filter(f=>f.points>0).sort((f,S)=>S.points-f.points)},[h?.data,p]),C=g.useMemo(()=>{if(!h?.data)return[];const k=new Map;return h.data.forEach(N=>{N.activities?.type==="quiz"&&N.completed_at&&k.set(N.user_id,(k.get(N.user_id)||0)+1)}),b.map(N=>({...N,quizzesCompleted:k.get(N.user_id)||0}))},[b,h?.data]);return e.jsxs(G,{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(bs,{to:"/teacher/reports/overview",children:e.jsxs(I,{variant:"ghost",size:"sm",children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),"Powrót do centrum raportów"]})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Raport gamifikacji"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Ce,{value:t,onValueChange:s,children:[e.jsx(we,{className:"w-[200px]",children:e.jsx(_e,{placeholder:"Wybierz grupę"})}),e.jsxs(ve,{children:[e.jsx(W,{value:"all",children:"Wszystkie grupy"}),m?.data?.map(k=>e.jsx(W,{value:k.id.toString(),children:k.name},k.id))]})]}),e.jsxs(Ce,{value:n,onValueChange:i,children:[e.jsx(we,{className:"w-[150px]",children:e.jsx(_e,{})}),e.jsxs(ve,{children:[e.jsx(W,{value:"7d",children:"Ostatnie 7 dni"}),e.jsx(W,{value:"30d",children:"Ostatnie 30 dni"}),e.jsx(W,{value:"90d",children:"Ostatnie 90 dni"})]})]}),e.jsx(I,{variant:r?"default":"outline",size:"sm",onClick:()=>a(!r),children:"Tylko aktywni"})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-5 mb-6",children:[e.jsxs(M,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(O,{className:"text-sm font-medium",children:"Uczniowie"}),e.jsx(De,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(R,{children:[e.jsx("div",{className:"text-2xl font-bold",children:j.totalUsers}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"w rankingu"})]})]}),e.jsxs(M,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(O,{className:"text-sm font-medium",children:"Łączne punkty"}),e.jsx(gn,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(R,{children:[e.jsx("div",{className:"text-2xl font-bold",children:j.totalPoints.toLocaleString("pl-PL")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"zdobytych"})]})]}),e.jsxs(M,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(O,{className:"text-sm font-medium",children:"Średni poziom"}),e.jsx(Wh,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(R,{children:[e.jsx("div",{className:"text-2xl font-bold",children:j.avgLevel}),e.jsx(Yt,{value:j.avgLevel/99*100,className:"mt-2 h-1"})]})]}),e.jsxs(M,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(O,{className:"text-sm font-medium",children:"Aktywne serie"}),e.jsx(Zt,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(R,{children:[e.jsx("div",{className:"text-2xl font-bold",children:j.activeStreaks}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"uczniów"})]})]}),e.jsxs(M,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(O,{className:"text-sm font-medium",children:"Najdłuższa seria"}),e.jsx(Ue,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(R,{children:[e.jsx("div",{className:"text-2xl font-bold",children:j.maxStreak}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"dni"})]})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3 mb-6",children:[e.jsxs(M,{className:"lg:col-span-2",children:[e.jsx($,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-5 w-5 text-yellow-600"}),"Top 10 uczniów"]})}),e.jsx(R,{children:e.jsx("div",{className:"space-y-3",children:C.map((k,N)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold
                      ${N===0?"bg-yellow-100 text-yellow-700 ring-2 ring-yellow-500":N===1?"bg-gray-100 text-gray-700 ring-2 ring-gray-400":N===2?"bg-orange-100 text-orange-700 ring-2 ring-orange-500":"bg-muted text-muted-foreground"}`,children:N+1}),e.jsx(tr,{children:e.jsx(sr,{className:"text-xs",children:k.users?.full_name?k.users.full_name.split(" ").map(z=>z[0]).join("").toUpperCase():`U${N+1}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:k.users?.full_name||`Uczeń #${N+1}`}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs(q,{variant:"outline",className:"text-xs",style:{borderColor:vu(k.current_level),color:vu(k.current_level)},children:["Poziom ",k.current_level]}),k.daily_streak>0&&e.jsxs(q,{variant:"secondary",className:"text-xs",children:[e.jsx(Zt,{className:"w-3 h-3 mr-1"}),k.daily_streak," dni"]}),k.perfect_scores>0&&e.jsxs(q,{variant:"secondary",className:"text-xs",children:[e.jsx(gn,{className:"w-3 h-3 mr-1"}),k.perfect_scores," perfect"]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold",children:k.total_points.toLocaleString("pl-PL")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"punktów"})]})]},k.user_id))})})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Rozkład poziomów"})}),e.jsx(R,{children:e.jsx(Ae,{width:"100%",height:300,children:e.jsxs(ha,{children:[e.jsx(fa,{data:x,cx:"50%",cy:"50%",labelLine:!1,label:({percentage:k})=>k>0?`${k}%`:"",outerRadius:80,fill:"#8884d8",dataKey:"count",isAnimationActive:!1,children:x.map((k,N)=>e.jsx(Qt,{fill:ix[N]},`cell-${N}`))}),e.jsx(Me,{}),e.jsx(Qn,{formatter:(k,N)=>N?.payload&&"level"in N.payload?`Poziom ${N.payload.level}`:""})]})})})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2 mb-6",children:[e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Punkty vs Ukończone quizy"})}),e.jsx(R,{children:e.jsx(Ae,{width:"100%",height:300,children:e.jsxs(Zh,{children:[e.jsx(bt,{strokeDasharray:"3 3"}),e.jsx(ct,{dataKey:"quizzes",name:"Ukończone quizy"}),e.jsx(nt,{dataKey:"points",name:"Punkty"}),e.jsx(Qh,{dataKey:"level",range:[50,200]}),e.jsx(Me,{cursor:{strokeDasharray:"3 3"}}),e.jsx(Yh,{name:"Uczniowie",data:w,fill:"#8884d8",isAnimationActive:!1})]})})})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Rozkład daily streaks"})}),e.jsx(R,{children:e.jsx(Ae,{width:"100%",height:300,children:e.jsxs(zr,{data:y,children:[e.jsx(bt,{strokeDasharray:"3 3"}),e.jsx(ct,{dataKey:"range"}),e.jsx(nt,{}),e.jsx(Me,{}),e.jsx(ai,{dataKey:"count",fill:"#fbbf24",name:"Liczba uczniów",isAnimationActive:!1,children:y.map((k,N)=>e.jsx(Qt,{fill:N===0?"#94a3b8":N<=2?"#fbbf24":N<=4?"#f97316":"#ef4444"},`cell-${N}`))})]},`${y.map(k=>k.count).join("-")}`)})})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Zdobywane punkty w czasie"})}),e.jsx(R,{children:e.jsx(Ae,{width:"100%",height:250,children:e.jsxs(Hh,{data:v,children:[e.jsx(bt,{strokeDasharray:"3 3"}),e.jsx(ct,{dataKey:"date"}),e.jsx(nt,{}),e.jsx(Me,{}),e.jsx(ac,{type:"monotone",dataKey:"points",stroke:"#8884d8",strokeWidth:2,dot:{fill:"#8884d8"},name:"Punkty",isAnimationActive:!1})]},`${v.map(k=>k.points).join("-")}`)})})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Źródła punktów"})}),e.jsx(R,{children:e.jsx(Ae,{width:"100%",height:250,children:e.jsxs(ha,{children:[e.jsx(fa,{data:_,cx:"50%",cy:"50%",labelLine:!1,label:({value:k})=>k!==void 0&&k>0?`${k.toLocaleString("pl-PL")}`:"",outerRadius:80,fill:"#8884d8",dataKey:"points",isAnimationActive:!1,children:_.map((k,N)=>e.jsx(Qt,{fill:k.color},`cell-${N}`))}),e.jsx(Me,{}),e.jsx(Qn,{})]})})})]})]}),e.jsxs(M,{className:"mt-6 bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-950/20 dark:to-blue-950/20",children:[e.jsx($,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(Ns,{className:"h-5 w-5 text-purple-600"}),"Kluczowe osiągnięcia"]})}),e.jsx(R,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Najaktywniejszy uczeń"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[C[0]?.quizzesCompleted||0," ukończonych quizów"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(st,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Największy wzrost"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["+",Math.round(j.totalPoints*.15).toLocaleString("pl-PL")," punktów w tym okresie"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Zt,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Zaangażowanie"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[j.totalUsers>0?Math.round(j.activeStreaks/j.totalUsers*100):0,"% uczniów ma aktywną serię"]})]})]})})]})]})},Ri={veryActive:"#22c55e",active:"#3b82f6",moderate:"#f59e0b",lowActivity:"#ef4444",inactive:"#6b7280"},Je={champions:"#8b5cf6",loyalists:"#3b82f6",potentials:"#10b981",newUsers:"#f59e0b",atRisk:"#ef4444",dormant:"#6b7280"},Qz=()=>{const[t,s]=g.useState("30d"),[n,i]=g.useState("all"),[r,a]=g.useState("all"),o=g.useMemo(()=>({staleTime:1/0,gcTime:1800*1e3,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,refetchInterval:1e4,retry:0}),[]),{startISO:l}=g.useMemo(()=>{const f=new Date,S=new Date(f);switch(t){case"7d":S.setDate(S.getDate()-7);break;case"30d":S.setDate(S.getDate()-30);break;case"90d":S.setDate(S.getDate()-90);break}return S.setHours(0,0,0,0),{startISO:S.toISOString(),endISO:f.toISOString()}},[t]),c=g.useMemo(()=>n!=="all"?[{field:"role",operator:"eq",value:n}]:[],[n]),d=g.useMemo(()=>({select:"*, users!user_stats_user_id_fkey(email, full_name)"}),[]),m=g.useMemo(()=>({select:"*, activities(type)"}),[]),u=g.useMemo(()=>[{field:"started_at",operator:"gte",value:l}],[l]),{data:h}=Z({resource:"users",pagination:{mode:"off"},filters:c,queryOptions:o}),{data:p}=Z({resource:"user_stats",pagination:{mode:"off"},meta:d,queryOptions:o}),{data:j}=Z({resource:"activity_progress",filters:u,pagination:{mode:"off"},meta:m,queryOptions:o}),x=g.useMemo(()=>{if(!h?.data||!p?.data||!j?.data)return[];const f=new Map(p.data.map(A=>[A.user_id,A])),S=new Map;return j.data.forEach(A=>{const D=S.get(A.user_id)||[];D.push(A),S.set(A.user_id,D)}),h.data.map(A=>{const D=f.get(A.id),P=S.get(A.id)||[];let L;const K=D?.last_active?Math.floor((Date.now()-new Date(D.last_active).getTime())/(1e3*60*60*24)):999;D?K>30?L="dormant":K>14?L="atRisk":D.total_points<100&&K<7?L="newUsers":D.total_points>1e3&&D.daily_streak>7?L="champions":D.daily_streak>3?L="loyalists":L="potentials":L="dormant";const E=P.filter(B=>typeof B.score=="number"),U=E.length?Math.round(E.reduce((B,ae)=>B+ae.score,0)/E.length):null;return{...A,stats:D,activities:P,segment:L,daysSinceLastActive:K,avgScore:U}})},[h?.data,p?.data,j?.data]),b=g.useMemo(()=>r==="all"?x:x.filter(f=>f.segment===r),[x,r]),w=g.useMemo(()=>{const f=b.length,S=b.filter(E=>E.is_active).length,A=b.filter(E=>E.daysSinceLastActive<=7).length,D=b.filter(E=>E.stats),P=D.length?Math.round(D.reduce((E,U)=>E+(U.stats?.current_level||0),0)/D.length):0,L=D.filter(E=>(E.stats?.daily_streak||0)>0).length,K=D.length?Math.round(D.reduce((E,U)=>E+(U.stats?.total_time_spent||0),0)/D.length/60):0;return{total:f,active:S,activePercent:f>0?Math.round(S/f*100):0,activeLastWeek:A,activeLastWeekPercent:f>0?Math.round(A/f*100):0,avgLevel:P,withStreaks:L,streakPercent:f>0?Math.round(L/f*100):0,avgTimeHours:K}},[b]),y=g.useMemo(()=>{const f=[{name:"Champions",key:"champions",count:0,color:Je.champions,description:"Wysokie punkty, aktywna seria"},{name:"Lojaliści",key:"loyalists",count:0,color:Je.loyalists,description:"Regularna aktywność"},{name:"Potencjalni",key:"potentials",count:0,color:Je.potentials,description:"Niska regularność"},{name:"Nowi",key:"newUsers",count:0,color:Je.newUsers,description:"Niedawno dołączyli"},{name:"Zagrożeni",key:"atRisk",count:0,color:Je.atRisk,description:"Spadek aktywności"},{name:"Nieaktywni",key:"dormant",count:0,color:Je.dormant,description:"Brak aktywności >30 dni"}],S={};return x.forEach(A=>{S[A.segment]=(S[A.segment]||0)+1}),f.map(A=>({...A,count:S[A.key]||0})).filter(A=>A.count>0)},[x]),v=g.useMemo(()=>{const f=[{name:"Champions",key:"champions",count:0,color:Je.champions,description:"Wysokie punkty, aktywna seria"},{name:"Lojaliści",key:"loyalists",count:0,color:Je.loyalists,description:"Regularna aktywność"},{name:"Potencjalni",key:"potentials",count:0,color:Je.potentials,description:"Niska regularność"},{name:"Nowi",key:"newUsers",count:0,color:Je.newUsers,description:"Niedawno dołączyli"},{name:"Zagrożeni",key:"atRisk",count:0,color:Je.atRisk,description:"Spadek aktywności"},{name:"Nieaktywni",key:"dormant",count:0,color:Je.dormant,description:"Brak aktywności >30 dni"}],S={};return x.forEach(A=>{S[A.segment]=(S[A.segment]||0)+1}),f.map(A=>({...A,count:S[A.key]||0}))},[x]),_=g.useMemo(()=>{const f=[{name:"Bardzo aktywni",range:"Codziennie",count:0,color:Ri.veryActive},{name:"Aktywni",range:"2-6 dni/tydz",count:0,color:Ri.active},{name:"Umiarkowani",range:"1 dzień/tydz",count:0,color:Ri.moderate},{name:"Niska aktywność",range:"<1 dzień/tydz",count:0,color:Ri.lowActivity},{name:"Nieaktywni",range:"Brak",count:0,color:Ri.inactive}];return b.forEach(S=>{!S.stats||S.daysSinceLastActive>30?f[4].count++:S.daysSinceLastActive<=1?f[0].count++:S.daysSinceLastActive<=3?f[1].count++:S.daysSinceLastActive<=7?f[2].count++:f[3].count++}),f},[b]),C=g.useMemo(()=>{const f=new Map;return j?.data?.forEach(A=>{const D=A.started_at.slice(0,10),P=f.get(D)||new Set;P.add(A.user_id),f.set(D,P)}),Array.from(f.keys()).sort().slice(-30).map(A=>({date:new Date(A).toLocaleDateString("pl-PL",{day:"numeric",month:"short"}),activeUsers:f.get(A)?.size||0,newUsers:b.filter(D=>D.created_at?.slice(0,10)===A).length}))},[j?.data,b]),k=g.useMemo(()=>b.filter(f=>f.stats&&(f.stats.total_time_spent||0)>0).map(f=>({timeHours:Math.round((f.stats.total_time_spent||0)/60),points:f.stats.total_points,level:f.stats.current_level,streak:f.stats.daily_streak,segment:f.segment})),[b]),N=g.useMemo(()=>b.filter(f=>f.stats).sort((f,S)=>(S.stats?.total_points||0)-(f.stats?.total_points||0)).slice(0,10),[b]),z=g.useMemo(()=>{const f=new Map,S=4;return b.forEach(A=>{const D=new Date(A.created_at);D.setHours(0,0,0,0),D.setDate(D.getDate()-D.getDay());const P=D.toISOString().slice(0,10);f.has(P)||f.set(P,{total:0,retained:Array(S).fill(0)});const L=f.get(P);L.total++;for(let K=0;K<S;K++){const E=new Date(D);E.setDate(E.getDate()+K*7);const U=new Date(E);U.setDate(U.getDate()+7),A.activities.some(ae=>{const le=new Date(ae.started_at);return le>=E&&le<U})&&L.retained[K]++}}),Array.from(f.entries()).map(([A,D])=>({cohort:new Date(A).toLocaleDateString("pl-PL",{day:"numeric",month:"short"}),week0:100,week1:D.total>0?Math.round(D.retained[1]/D.total*100):0,week2:D.total>0?Math.round(D.retained[2]/D.total*100):0,week3:D.total>0?Math.round(D.retained[3]/D.total*100):0,total:D.total})).slice(-4)},[b]),T=[{label:"Wszyscy użytkownicy",value:w.total.toString(),subValue:`${w.activePercent}% aktywnych`,icon:oe,color:"text-blue-600",bgColor:"bg-blue-50"},{label:"Aktywni w ostatnim tygodniu",value:w.activeLastWeek.toString(),subValue:`${w.activeLastWeekPercent}% wszystkich`,icon:cb,color:"text-green-600",bgColor:"bg-green-50"},{label:"Średni poziom",value:w.avgLevel.toString(),subValue:`${w.avgTimeHours}h średnio`,icon:Ns,color:"text-purple-600",bgColor:"bg-purple-50"},{label:"Z aktywną serią",value:w.withStreaks.toString(),subValue:`${w.streakPercent}% wszystkich`,icon:Ue,color:"text-orange-600",bgColor:"bg-orange-50"}];return e.jsxs(G,{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(bs,{to:"/teacher/reports/overview",children:e.jsxs(I,{variant:"ghost",size:"sm",children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),"Powrót do centrum raportów"]})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Analiza użytkowników"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Ce,{value:n,onValueChange:i,children:[e.jsx(we,{className:"w-[150px]",children:e.jsx(_e,{})}),e.jsxs(ve,{children:[e.jsx(W,{value:"all",children:"Wszystkie role"}),e.jsx(W,{value:"student",children:"Uczniowie"}),e.jsx(W,{value:"teacher",children:"Nauczyciele"}),e.jsx(W,{value:"admin",children:"Administratorzy"})]})]}),e.jsxs(Ce,{value:r,onValueChange:a,children:[e.jsx(we,{className:"w-[180px]",children:e.jsx(_e,{})}),e.jsxs(ve,{children:[e.jsx(W,{value:"all",children:"Wszystkie segmenty"}),v.map(f=>e.jsxs(W,{value:f.key,children:[f.name," (",f.count,")"]},f.key))]})]}),e.jsxs(Ce,{value:t,onValueChange:s,children:[e.jsx(we,{className:"w-[150px]",children:e.jsx(_e,{})}),e.jsxs(ve,{children:[e.jsx(W,{value:"7d",children:"Ostatnie 7 dni"}),e.jsx(W,{value:"30d",children:"Ostatnie 30 dni"}),e.jsx(W,{value:"90d",children:"Ostatnie 90 dni"})]})]})]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-6",children:T.map((f,S)=>e.jsxs(M,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(O,{className:"text-sm font-medium",children:f.label}),e.jsx("div",{className:`${f.bgColor} p-2 rounded-lg`,children:e.jsx(f.icon,{className:`h-4 w-4 ${f.color}`})})]}),e.jsxs(R,{children:[e.jsx("div",{className:"text-2xl font-bold",children:f.value}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:f.subValue})]})]},S))}),e.jsxs(lf,{defaultValue:"segments",className:"space-y-4",children:[e.jsxs(cc,{className:"grid w-full grid-cols-5",children:[e.jsx(Wt,{value:"segments",children:"Segmentacja"}),e.jsx(Wt,{value:"activity",children:"Aktywność"}),e.jsx(Wt,{value:"performance",children:"Wyniki"}),e.jsx(Wt,{value:"retention",children:"Retencja"}),e.jsx(Wt,{value:"leaderboard",children:"Ranking"})]}),e.jsxs(Gt,{value:"segments",className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Segmentacja użytkowników"})}),e.jsx(R,{children:y.length===0?e.jsx("div",{className:"text-sm text-muted-foreground p-6 border rounded-lg",children:"Brak danych do wyświetlenia dla wybranego zakresu."}):e.jsx(Ae,{width:"100%",height:300,children:e.jsxs(ha,{children:[e.jsx(fa,{data:y,cx:"50%",cy:"50%",outerRadius:100,dataKey:"count",label:({name:f,percent:S})=>S!==void 0?`${f}: ${(S*100).toFixed(0)}%`:f,isAnimationActive:!1,children:y.map((f,S)=>e.jsx(Qt,{fill:f.color},`cell-${S}`))}),e.jsx(Me,{})]})})})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Charakterystyka segmentów"})}),e.jsx(R,{children:e.jsx("div",{className:"space-y-3",children:v.map(f=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:f.color}}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:f.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:f.description})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold",children:f.count}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"użytkowników"})]})]},f.key))})})]})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(Id,{className:"h-5 w-5 text-orange-600"}),"Kluczowe obserwacje"]})}),e.jsx(R,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[v.find(f=>f.key==="atRisk")?.count?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-orange-600",children:[e.jsx(db,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Użytkownicy zagrożeni"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[v.find(f=>f.key==="atRisk")?.count," użytkowników wymaga uwagi – rozważ wysłanie powiadomień motywacyjnych"]})]}):null,v.find(f=>f.key==="champions")?.count?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-purple-600",children:[e.jsx(Ns,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Champions do wykorzystania"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[v.find(f=>f.key==="champions")?.count," najaktywniejszych użytkowników – mogą być mentorami lub ambasadorami"]})]}):null,v.find(f=>f.key==="newUsers")?.count?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Nowi użytkownicy"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[v.find(f=>f.key==="newUsers")?.count," nowych użytkowników – upewnij się, że mają dobre wsparcie onboardingowe"]})]}):null]})})]})]}),e.jsxs(Gt,{value:"activity",className:"space-y-4",children:[e.jsx("div",{className:"grid gap-6 lg:grid-cols-2",children:e.jsxs(M,{className:"lg:col-span-2",children:[e.jsx($,{children:e.jsx(O,{children:"Wzorzec aktywności użytkowników"})}),e.jsx(R,{children:e.jsx(Ae,{width:"100%",height:300,children:e.jsxs(Va,{data:C,children:[e.jsx(bt,{strokeDasharray:"3 3"}),e.jsx(ct,{dataKey:"date"}),e.jsx(nt,{}),e.jsx(Me,{}),e.jsx(Qn,{}),e.jsx(Vs,{type:"monotone",dataKey:"activeUsers",stackId:"1",stroke:"#3b82f6",fill:"#3b82f6",fillOpacity:.6,name:"Aktywni użytkownicy",isAnimationActive:!1}),e.jsx(Vs,{type:"monotone",dataKey:"newUsers",stackId:"1",stroke:"#10b981",fill:"#10b981",fillOpacity:.6,name:"Nowi użytkownicy",isAnimationActive:!1})]})})})]})}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Poziomy aktywności"})}),e.jsx(R,{children:e.jsx(Ae,{width:"100%",height:250,children:e.jsxs(zr,{data:_,children:[e.jsx(bt,{strokeDasharray:"3 3"}),e.jsx(ct,{dataKey:"name"}),e.jsx(nt,{}),e.jsx(Me,{}),e.jsx(ai,{dataKey:"count",name:"Użytkownicy",isAnimationActive:!1,children:_.map((f,S)=>e.jsx(Qt,{fill:f.color},`cell-${S}`))})]})})})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Metryki zaangażowania"})}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(kr,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Średnia częstotliwość logowania"})]}),e.jsx(q,{variant:"outline",children:"3.2 dni/tydzień"})]}),e.jsx(Yt,{value:64,className:"h-2"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Średni czas sesji"})]}),e.jsx(q,{variant:"outline",children:"24 min"})]}),e.jsx(Yt,{value:48,className:"h-2"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Ukończenia na użytkownika"})]}),e.jsx(q,{variant:"outline",children:"7.8 aktywności"})]}),e.jsx(Yt,{value:78,className:"h-2"})]})]})]})]})]}),e.jsxs(Gt,{value:"performance",className:"space-y-4",children:[e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Punkty vs Czas nauki"})}),e.jsx(R,{children:e.jsx(Ae,{width:"100%",height:400,children:e.jsxs(Zh,{children:[e.jsx(bt,{strokeDasharray:"3 3"}),e.jsx(ct,{dataKey:"timeHours",name:"Czas nauki (h)"}),e.jsx(nt,{dataKey:"points",name:"Punkty"}),e.jsx(Qh,{dataKey:"level",range:[50,400]}),e.jsx(Me,{cursor:{strokeDasharray:"3 3"}}),e.jsx(Qn,{}),e.jsx(Yh,{name:"Użytkownicy",data:k,fill:"#8884d8",isAnimationActive:!1,children:k.map((f,S)=>e.jsx(Qt,{fill:Je[f.segment]||"#8884d8"},`cell-${S}`))})]})})})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Rozkład wyników"})}),e.jsx(R,{children:e.jsx("div",{className:"space-y-4",children:[{label:"90-100%",count:b.filter(f=>f.avgScore!==null&&f.avgScore>=90).length,color:"#22c55e"},{label:"80-89%",count:b.filter(f=>f.avgScore!==null&&f.avgScore>=80&&f.avgScore<90).length,color:"#84cc16"},{label:"70-79%",count:b.filter(f=>f.avgScore!==null&&f.avgScore>=70&&f.avgScore<80).length,color:"#eab308"},{label:"60-69%",count:b.filter(f=>f.avgScore!==null&&f.avgScore>=60&&f.avgScore<70).length,color:"#f97316"},{label:"<60%",count:b.filter(f=>f.avgScore!==null&&f.avgScore<60).length,color:"#ef4444"}].map(f=>{const S=b.filter(D=>D.avgScore!==null).length,A=S>0?f.count/S*100:0;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:f.label}),e.jsxs("span",{className:"font-medium",children:[f.count," użytkowników"]})]}),e.jsx("div",{className:"relative h-8 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"absolute left-0 top-0 h-full transition-all duration-500",style:{width:`${A}%`,backgroundColor:f.color}})})]},f.label)})})})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Wskaźniki sukcesu"})}),e.jsx(R,{children:e.jsx(Ae,{width:"100%",height:250,children:e.jsxs(zb,{cx:"50%",cy:"50%",innerRadius:"10%",outerRadius:"90%",data:[{name:"Ukończenia",value:68,fill:"#8884d8"},{name:"Zdawalność",value:74,fill:"#82ca9d"},{name:"Zaangażowanie",value:82,fill:"#ffc658"}],children:[e.jsx(Sb,{dataKey:"value",isAnimationActive:!1}),e.jsx(Qn,{}),e.jsx(Me,{})]})})})]})]})]}),e.jsxs(Gt,{value:"retention",className:"space-y-4",children:[e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Analiza kohortowa retencji"})}),e.jsxs(R,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Nn,{children:[e.jsx(kn,{children:e.jsxs(ut,{children:[e.jsx(ie,{children:"Kohorta"}),e.jsx(ie,{className:"text-center",children:"Tydzień 0"}),e.jsx(ie,{className:"text-center",children:"Tydzień 1"}),e.jsx(ie,{className:"text-center",children:"Tydzień 2"}),e.jsx(ie,{className:"text-center",children:"Tydzień 3"}),e.jsx(ie,{className:"text-center",children:"Liczba użytkowników"})]})}),e.jsx(zn,{children:z.map(f=>e.jsxs(ut,{children:[e.jsx(re,{className:"font-medium",children:f.cohort}),e.jsx(re,{className:"text-center",children:e.jsxs("div",{className:"inline-flex items-center justify-center w-16 h-8 rounded",style:{backgroundColor:`rgba(34, 197, 94, ${f.week0/100})`},children:[f.week0,"%"]})}),e.jsx(re,{className:"text-center",children:e.jsxs("div",{className:"inline-flex items-center justify-center w-16 h-8 rounded",style:{backgroundColor:`rgba(34, 197, 94, ${f.week1/100})`},children:[f.week1,"%"]})}),e.jsx(re,{className:"text-center",children:e.jsxs("div",{className:"inline-flex items-center justify-center w-16 h-8 rounded",style:{backgroundColor:`rgba(34, 197, 94, ${f.week2/100})`},children:[f.week2,"%"]})}),e.jsx(re,{className:"text-center",children:e.jsxs("div",{className:"inline-flex items-center justify-center w-16 h-8 rounded",style:{backgroundColor:`rgba(34, 197, 94, ${f.week3/100})`},children:[f.week3,"%"]})}),e.jsx(re,{className:"text-center",children:f.total})]},f.cohort))})]})}),e.jsx("div",{className:"mt-4 p-4 bg-muted rounded-lg",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsx("strong",{children:"Interpretacja:"})," Wartości pokazują procent użytkowników z danej kohorty, którzy byli aktywni w kolejnych tygodniach po dołączeniu."]})})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Czynniki wpływające na retencję"})}),e.jsx(R,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Us,{className:"h-5 w-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Ukończenie pierwszego quizu"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+42% retencji po 30 dniach"})]})]}),e.jsx(q,{variant:"default",children:"Kluczowy"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ee,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Osiągnięcie 100 punktów"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+28% retencji po 30 dniach"})]})]}),e.jsx(q,{variant:"secondary",children:"Ważny"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(oe,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Dołączenie do grupy"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+15% retencji po 30 dniach"})]})]}),e.jsx(q,{variant:"outline",children:"Pomocny"})]})]})})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Prognoza churn"})}),e.jsx(R,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl font-bold text-orange-600 mb-2",children:v.find(f=>f.key==="atRisk")?.count||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"użytkowników zagrożonych odejściem"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Główne przyczyny:"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:"• Brak aktywności powyżej 14 dni (78%)"}),e.jsx("li",{children:"• Niskie wyniki quizów (45%)"}),e.jsx("li",{children:"• Brak postępów w kursie (34%)"}),e.jsx("li",{children:"• Utrata daily streak (23%)"})]})]}),e.jsxs(I,{className:"w-full",variant:"outline",children:[e.jsx(Id,{className:"mr-2 h-4 w-4"}),"Wygeneruj kampanię reaktywacyjną"]})]})})]})]})]}),e.jsxs(Gt,{value:"leaderboard",className:"space-y-4",children:[e.jsxs(M,{children:[e.jsx($,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-5 w-5 text-yellow-600"}),"Top 10 użytkowników"]})}),e.jsx(R,{children:e.jsx("div",{className:"space-y-3",children:N.map((f,S)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold
                        ${S===0?"bg-yellow-100 text-yellow-700 ring-2 ring-yellow-500":S===1?"bg-gray-100 text-gray-700 ring-2 ring-gray-400":S===2?"bg-orange-100 text-orange-700 ring-2 ring-orange-500":"bg-muted text-muted-foreground"}`,children:S+1}),e.jsx(tr,{children:e.jsx(sr,{className:"text-xs",children:f.full_name?.split(" ").map(A=>A[0]).join("")||f.email.substring(0,2).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:f.full_name||`Użytkownik ${S+1}`}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx(q,{variant:"outline",className:"text-xs",style:{borderColor:Je[f.segment]||"#8884d8",color:Je[f.segment]||"#8884d8"},children:v.find(A=>A.key===f.segment)?.name||f.segment}),e.jsxs(q,{variant:"secondary",className:"text-xs",children:["Poziom ",f.stats?.current_level||0]}),f.stats&&f.stats.daily_streak>0&&e.jsxs(q,{variant:"secondary",className:"text-xs",children:[e.jsx(Ue,{className:"w-3 h-3 mr-1"}),f.stats.daily_streak," dni"]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold",children:f.stats?.total_points.toLocaleString("pl-PL")||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"punktów"})]})]},f.id))})})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{className:"text-base",children:"Najbardziej zaangażowani"})}),e.jsx(R,{children:e.jsx("div",{className:"space-y-3",children:b.filter(f=>f.stats).sort((f,S)=>(S.stats?.total_time_spent||0)-(f.stats?.total_time_spent||0)).slice(0,5).map((f,S)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:f.full_name||`Użytkownik ${S+1}`}),e.jsxs(q,{variant:"outline",children:[Math.round((f.stats?.total_time_spent||0)/60),"h"]})]},f.id))})})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{className:"text-base",children:"Najlepsze wyniki"})}),e.jsx(R,{children:e.jsx("div",{className:"space-y-3",children:b.filter(f=>f.avgScore!==null).sort((f,S)=>f.avgScore<S.avgScore?1:-1).slice(0,5).map((f,S)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:f.full_name||`Użytkownik ${S+1}`}),e.jsxs(q,{variant:f.avgScore>=80?"default":"secondary",children:[f.avgScore,"%"]})]},f.id))})})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{className:"text-base",children:"Najdłuższe serie"})}),e.jsx(R,{children:e.jsx("div",{className:"space-y-3",children:b.filter(f=>f.stats).sort((f,S)=>(S.stats?.daily_streak||0)-(f.stats?.daily_streak||0)).slice(0,5).map((f,S)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:f.full_name||`Użytkownik ${S+1}`}),e.jsxs(q,{variant:"outline",children:[e.jsx(Ue,{className:"w-3 h-3 mr-1"}),f.stats?.daily_streak," dni"]})]},f.id))})})]})]})]})]})]})},Yz=()=>{const[t,s]=g.useState("30d"),[n,i]=g.useState("all"),[r,a]=g.useState("all"),o={queryOptions:{staleTime:1/0,gcTime:1800*1e3,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,refetchInterval:!1,retry:0}},l=()=>{const N=new Date,z=new Date;switch(t){case"7d":z.setDate(z.getDate()-7);break;case"30d":z.setDate(z.getDate()-30);break;case"90d":z.setDate(z.getDate()-90);break}return{start:z,end:N}},{start:c}=l(),{data:d}=Z({resource:"questions",pagination:{mode:"off"},...o}),{data:m}=Z({resource:"courses",pagination:{mode:"off"},...o}),{data:u}=Z({resource:"topics",filters:n!=="all"?[{field:"course_id",operator:"eq",value:parseInt(n)}]:[],pagination:{mode:"off"},...o}),{data:h}=Z({resource:"activities",filters:[{field:"type",operator:"eq",value:"quiz"},{field:"is_published",operator:"eq",value:!0}],pagination:{mode:"off"},...o}),{data:p}=Z({resource:"activity_progress",filters:[{field:"started_at",operator:"gte",value:c.toISOString()}],pagination:{mode:"off"},meta:{query:N=>N.not("score","is",null)},...o}),j=g.useMemo(()=>{if(!h?.data||!u?.data||!m?.data)return[];const N=new Map(u.data.map(T=>[T.id,T])),z=new Map(m.data.map(T=>[T.id,T]));return h.data.map(T=>{const f=N.get(T.topic_id),S=f?z.get(f.course_id):void 0;return{...T,topicTitle:f?.title||"",courseId:S?.id,courseTitle:S?.title||""}})},[h?.data,u?.data,m?.data]),x=g.useMemo(()=>{let N=j;return n!=="all"&&(N=N.filter(z=>z.courseId===parseInt(n))),r!=="all"&&(N=N.filter(z=>z.topic_id===parseInt(r))),N},[j,n,r]),b=g.useMemo(()=>{if(!p?.data)return[];const N=x.map(z=>z.id);return p.data.filter(z=>N.includes(z.activity_id)&&z.score!==null&&z.score!==void 0)},[p?.data,x]),w=g.useMemo(()=>{const N=new Map;return x.forEach(z=>{const T=b.filter(f=>f.activity_id===z.id);if(T.length>0){const f=T.filter(D=>D.score!==null&&D.score!==void 0).map(D=>D.score);if(f.length===0)return;const S=Math.round(f.reduce((D,P)=>D+P,0)/f.length),A=Math.round(f.filter(D=>D>=(z.passing_score||70)).length/f.length*100);N.set(z.id,{activityId:z.id,activityTitle:z.title,topicTitle:z.topicTitle,courseTitle:z.courseTitle,attempts:T.length,avgScore:S,minScore:Math.min(...f),maxScore:Math.max(...f),passRate:A,passingScore:z.passing_score||70})}}),Array.from(N.values()).sort((z,T)=>z.avgScore-T.avgScore)},[x,b]),y=g.useMemo(()=>{const N=b.length,z=b.filter(P=>P.score!==null&&P.score!==void 0).map(P=>P.score),T=z.length>0?Math.round(z.reduce((P,L)=>P+L,0)/z.length):0,f=b.filter(P=>{if(P.score===null||P.score===void 0)return!1;const K=x.find(E=>E.id===P.activity_id)?.passing_score||70;return P.score>=K}).length,S=N>0?Math.round(f/N*100):0;return{totalAttempts:N,avgScore:T,avgScoreChange:3,passRate:S,passRateChange:5,uniqueStudents:new Set(b.map(P=>P.user_id)).size,totalQuizzes:x.length}},[b,x]),v=g.useMemo(()=>{const N=[{range:"0-20%",count:0,color:"#ef4444"},{range:"21-40%",count:0,color:"#f97316"},{range:"41-60%",count:0,color:"#eab308"},{range:"61-80%",count:0,color:"#84cc16"},{range:"81-100%",count:0,color:"#22c55e"}];return b.forEach(z=>{const T=z.score||0;T<=20?N[0].count++:T<=40?N[1].count++:T<=60?N[2].count++:T<=80?N[3].count++:N[4].count++}),N},[b]),_=g.useMemo(()=>{const N=new Map;return b.forEach(z=>{const T=x.find(f=>f.id===z.activity_id);if(T?.topicTitle&&z.score!==null&&z.score!==void 0){const f=N.get(T.topicTitle)||{scores:[],topic:T.topicTitle};f.scores.push(z.score),N.set(T.topicTitle,f)}}),Array.from(N.values()).map(({topic:z,scores:T})=>({topic:z.length>20?z.substring(0,20)+"...":z,avgScore:Math.round(T.reduce((f,S)=>f+S,0)/T.length),attempts:T.length})).slice(0,8)},[b,x]),C=g.useMemo(()=>{const N=new Map;return b.forEach(z=>{const T=new Date(z.started_at).toLocaleDateString("pl-PL"),f=N.get(T)||[];z.score!==null&&z.score!==void 0&&(f.push(z.score),N.set(T,f))}),Array.from(N.entries()).map(([z,T])=>({date:z,avgScore:Math.round(T.reduce((f,S)=>f+S,0)/T.length),attempts:T.length,minScore:Math.min(...T),maxScore:Math.max(...T)})).sort((z,T)=>new Date(z.date).getTime()-new Date(T.date).getTime()).slice(-14)},[b]),k=g.useMemo(()=>{if(!d?.data||!w.length)return[];const N=w.slice(0,5),z=[];return N.forEach(T=>{d.data.filter(S=>S.activity_id===T.activityId).sort((S,A)=>S.order_index-A.order_index).forEach((S,A)=>{let D="medium";T.avgScore<30?D="very-hard":T.avgScore<50?D="hard":T.avgScore<70?D="medium":D="easy",z.push({questionId:S.id,question:S.question,activityTitle:T.activityTitle,quizAttempts:T.attempts,avgQuizScore:T.avgScore,difficulty:D})})}),z.sort((T,f)=>T.avgQuizScore-f.avgQuizScore).slice(0,10)},[d?.data,w]);return e.jsxs(G,{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(bs,{to:"/teacher/reports/overview",children:e.jsxs(I,{variant:"ghost",size:"sm",children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),"Powrót do centrum raportów"]})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Raport wyników"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Ce,{value:n,onValueChange:i,children:[e.jsx(we,{className:"w-[200px]",children:e.jsx(_e,{placeholder:"Wybierz kurs"})}),e.jsxs(ve,{children:[e.jsx(W,{value:"all",children:"Wszystkie kursy"}),m?.data?.map(N=>e.jsx(W,{value:N.id.toString(),children:N.title},N.id))]})]}),e.jsxs(Ce,{value:r,onValueChange:a,disabled:n==="all",children:[e.jsx(we,{className:"w-[200px]",children:e.jsx(_e,{placeholder:"Wybierz temat"})}),e.jsxs(ve,{children:[e.jsx(W,{value:"all",children:"Wszystkie tematy"}),u?.data?.map(N=>e.jsx(W,{value:N.id.toString(),children:N.title},N.id))]})]}),e.jsxs(Ce,{value:t,onValueChange:s,children:[e.jsx(we,{className:"w-[150px]",children:e.jsx(_e,{})}),e.jsxs(ve,{children:[e.jsx(W,{value:"7d",children:"Ostatnie 7 dni"}),e.jsx(W,{value:"30d",children:"Ostatnie 30 dni"}),e.jsx(W,{value:"90d",children:"Ostatnie 90 dni"})]})]}),e.jsxs(I,{variant:"outline",size:"sm",children:[e.jsx(Kh,{className:"mr-2 h-4 w-4"}),"Eksportuj"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4 mb-6",children:[e.jsxs(M,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(O,{className:"text-sm font-medium",children:"Średni wynik"}),e.jsx(Ee,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(R,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[y.avgScore,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsxs("span",{className:y.avgScoreChange>0?"text-green-600":"text-red-600",children:[y.avgScoreChange>0?e.jsx(st,{className:"inline h-3 w-3"}):e.jsx(ub,{className:"inline h-3 w-3"})," ",Math.abs(y.avgScoreChange),"%"]})," ","vs. poprzedni okres"]})]})]}),e.jsxs(M,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(O,{className:"text-sm font-medium",children:"Wskaźnik zdawalności"}),e.jsx(ii,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(R,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[y.passRate,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsxs("span",{className:y.passRateChange>0?"text-green-600":"text-red-600",children:[y.passRateChange>0?"+":"",y.passRateChange,"%"]})," ","vs. poprzedni okres"]})]})]}),e.jsxs(M,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(O,{className:"text-sm font-medium",children:"Liczba podejść"}),e.jsx(vt,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(R,{children:[e.jsx("div",{className:"text-2xl font-bold",children:y.totalAttempts}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[y.uniqueStudents," unikalnych uczniów"]})]})]}),e.jsxs(M,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(O,{className:"text-sm font-medium",children:"Liczba quizów"}),e.jsx(Ee,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(R,{children:[e.jsx("div",{className:"text-2xl font-bold",children:y.totalQuizzes}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"aktywnych w okresie"})]})]})]}),e.jsxs(lf,{defaultValue:"distribution",className:"space-y-4",children:[e.jsxs(cc,{children:[e.jsx(Wt,{value:"distribution",children:"Rozkład wyników"}),e.jsx(Wt,{value:"topics",children:"Wyniki według tematów"}),e.jsx(Wt,{value:"trend",children:"Trend w czasie"}),e.jsx(Wt,{value:"difficult",children:"Najtrudniejsze pytania"})]}),e.jsx(Gt,{value:"distribution",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Rozkład wyników"})}),e.jsx(R,{children:e.jsx(Ae,{width:"100%",height:300,children:e.jsxs(zr,{data:v,children:[e.jsx(bt,{strokeDasharray:"3 3"}),e.jsx(ct,{dataKey:"range"}),e.jsx(nt,{}),e.jsx(Me,{}),e.jsx(ai,{dataKey:"count",name:"Liczba wyników",isAnimationActive:!1,children:v.map((N,z)=>e.jsx(Qt,{fill:N.color},`cell-${z}`))})]})})})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(dt,{className:"h-4 w-4 text-orange-600"}),"Quizy wymagające uwagi"]})}),e.jsx(R,{children:e.jsx("div",{className:"space-y-3",children:w.slice(0,5).map(N=>e.jsxs("div",{className:"space-y-2 pb-3 border-b last:border-0",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:N.activityTitle}),e.jsx("p",{className:"text-xs text-muted-foreground",children:N.topicTitle})]}),e.jsxs(q,{variant:N.avgScore<50?"destructive":"secondary",children:[N.avgScore,"%"]})]}),e.jsxs("div",{className:"flex gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Zdawalność: ",N.passRate,"%"]}),e.jsxs("span",{children:["Próby: ",N.attempts]}),e.jsxs("span",{children:["Min/Max: ",N.minScore,"%/",N.maxScore,"%"]})]})]},N.activityId))})})]})]})}),e.jsx(Gt,{value:"topics",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Średnie wyniki według tematów"})}),e.jsx(R,{children:e.jsx(Ae,{width:"100%",height:400,children:e.jsxs(Cb,{data:_,children:[e.jsx(_b,{}),e.jsx(Tb,{dataKey:"topic",tick:{fontSize:12}}),e.jsx(Ab,{domain:[0,100]}),e.jsx(Db,{name:"Średni wynik",dataKey:"avgScore",stroke:"#8884d8",fill:"#8884d8",fillOpacity:.6,isAnimationActive:!1}),e.jsx(Me,{})]})})})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Szczegółowe wyniki"})}),e.jsx(R,{children:e.jsxs(Nn,{children:[e.jsx(kn,{children:e.jsxs(ut,{children:[e.jsx(ie,{children:"Temat"}),e.jsx(ie,{className:"text-right",children:"Średni wynik"}),e.jsx(ie,{className:"text-right",children:"Liczba prób"})]})}),e.jsx(zn,{children:_.map(N=>e.jsxs(ut,{children:[e.jsx(re,{className:"font-medium",children:N.topic}),e.jsx(re,{className:"text-right",children:e.jsxs(q,{variant:N.avgScore>=70?"default":"secondary",children:[N.avgScore,"%"]})}),e.jsx(re,{className:"text-right",children:N.attempts})]},N.topic))})]})})]})]})}),e.jsx(Gt,{value:"trend",className:"space-y-4",children:e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Trend wyników w czasie"})}),e.jsx(R,{children:e.jsx(Ae,{width:"100%",height:400,children:e.jsxs(Pb,{data:C,children:[e.jsx(bt,{strokeDasharray:"3 3"}),e.jsx(ct,{dataKey:"date"}),e.jsx(nt,{}),e.jsx(Me,{}),e.jsx(Qn,{}),e.jsx(Vs,{type:"monotone",dataKey:"maxScore",fill:"#8884d8",stroke:"#8884d8",fillOpacity:.2,name:"Max",isAnimationActive:!1}),e.jsx(Vs,{type:"monotone",dataKey:"minScore",fill:"#82ca9d",stroke:"#82ca9d",fillOpacity:.2,name:"Min",isAnimationActive:!1}),e.jsx(ac,{type:"monotone",dataKey:"avgScore",stroke:"#ff7300",strokeWidth:3,name:"Średnia",dot:{fill:"#ff7300"},isAnimationActive:!1}),e.jsx(ai,{dataKey:"attempts",fill:"#ffc658",name:"Liczba prób",yAxisId:"right",isAnimationActive:!1}),e.jsx(nt,{yAxisId:"right",orientation:"right"})]})})})]})}),e.jsx(Gt,{value:"difficult",className:"space-y-4",children:e.jsxs(M,{children:[e.jsx($,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(dt,{className:"h-5 w-5 text-red-600"}),"Najtrudniejsze pytania"]})}),e.jsxs(R,{children:[e.jsx("div",{className:"space-y-4",children:k.length>0?k.map((N,z)=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs(q,{variant:"outline",children:["#",z+1]}),e.jsxs(q,{variant:N.difficulty==="very-hard"?"destructive":N.difficulty==="hard"?"secondary":"default",children:["Quiz: ",N.avgQuizScore,"% średnio"]})]}),e.jsx("p",{className:"text-sm font-medium",children:N.question}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Z quizu: ",N.activityTitle," • ",N.quizAttempts," podejść"]})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Średni wynik quizu"}),e.jsxs("p",{className:"font-medium",children:[N.avgQuizScore,"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Liczba podejść"}),e.jsx("p",{className:"font-medium",children:N.quizAttempts})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Poziom trudności"}),e.jsx(q,{variant:N.difficulty==="very-hard"?"destructive":N.difficulty==="hard"?"secondary":N.difficulty==="medium"?"outline":"default",children:N.difficulty==="very-hard"?"Bardzo trudne":N.difficulty==="hard"?"Trudne":N.difficulty==="medium"?"Średnie":"Łatwe"})]})]})]},N.questionId)):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"Brak danych o pytaniach w wybranym okresie."}),e.jsx("p",{className:"text-sm mt-2",children:"Upewnij się, że wybrane quizy mają pytania."})]})}),e.jsx("div",{className:"mt-4 p-4 bg-muted rounded-lg",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsx("strong",{children:"Wskazówka:"})," Rozważ dodanie dodatkowych materiałów lub wyjaśnień do pytań z niskim wskaźnikiem poprawnych odpowiedzi."]})})]})]})})]})]})},Xz={name:"reports",list:"/teacher/reports/overview",meta:{label:"Raporty",icon:e.jsx(ii,{className:"h-4 w-4"})}},Nu={name:"reports-engagement",list:"/teacher/reports/engagement",meta:{label:"Zaangażowanie"}},ku={name:"reports-progress",list:"/teacher/reports/progress",meta:{label:"Postępy"}},zu={name:"reports-performance",list:"/teacher/reports/performance",meta:{label:"Wyniki"}},Su={name:"reports-gamification",list:"/teacher/reports/gamification",meta:{label:"Gamifikacja"}},Cu={name:"reports-summary",list:"/teacher/reports/summary",meta:{label:"Użytkownicy"}},Jz=[e.jsx(V,{path:"reports",element:e.jsx($t,{to:"overview",replace:!0})},"reports-root-redirect"),e.jsx(V,{path:"reports/overview",element:e.jsx(Wz,{})},"reports-overview"),e.jsx(V,{path:"reports/engagement",element:e.jsx(Gz,{})},"reports-engagement"),e.jsx(V,{path:"reports/progress",element:e.jsx(Hz,{})},"reports-progress"),e.jsx(V,{path:"reports/performance",element:e.jsx(Yz,{})},"reports-performance"),e.jsx(V,{path:"reports/gamification",element:e.jsx(Zz,{})},"reports-gamification"),e.jsx(V,{path:"reports/summary",element:e.jsx(Qz,{})},"reports-summary")];function eS(){return e.jsxs("div",{className:"max-w-3xl mx-auto p-6",children:[e.jsxs("header",{className:"flex items-center gap-3 mb-6",children:[e.jsx(Ua,{className:"w-6 h-6"}),e.jsx("h1",{className:"text-2xl font-semibold",children:"Generator kursów — panel"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-zinc-600",children:"Ten kreator w 2 krokach wygeneruje szkic Twojego kursu przy pomocy LLM."}),e.jsxs("div",{className:"rounded-2xl border p-4 shadow-sm bg-white",children:[e.jsx("h2",{className:"font-medium mb-2",children:"Szybki start"}),e.jsxs("ol",{className:"list-decimal list-inside text-sm text-zinc-700 space-y-1",children:[e.jsx("li",{children:"W kroku 1 przekaż podstawy (temat, grupa docelowa, poziom)."}),e.jsx("li",{children:"W kroku 2 doprecyzuj strukturę modułów i lekcji."})]}),e.jsxs(bs,{to:"/teacher/course-structure/step1",className:"inline-flex items-center gap-2 mt-4 px-4 py-2 rounded-xl bg-black text-white text-sm hover:opacity-90",children:["Rozpocznij",e.jsx(jt,{className:"w-4 h-4"})]})]})]})]})}function yl(t){if(!t)return Od();switch(t.type){case"string":return t.required?Ud():Ud().optional();case"number":return t.required?Bd():Bd().optional();case"boolean":return t.required?Fd():Fd().optional();case"array":return Mb(yl(t.items||{}));case"object":{if(!t.properties)return $d({});const s={};for(const[n,i]of Object.entries(t.properties))s[n]=yl(i);return $d(s)}default:return Od()}}function bl(t,s=0){const n=" ".repeat(s);switch(t.type){case"string":return`${n}string${t.required?" (wymagane)":""}`;case"number":return`${n}number${t.required?" (wymagane)":""}`;case"boolean":return`${n}boolean${t.required?" (wymagane)":""}`;case"enum":return`${n}enum: ${t.options?.join(" | ")}`+(t.required?" (wymagane)":"");case"array":return`${n}array${t.minItems?` (min ${t.minItems})`:""}${t.maxItems?` (max ${t.maxItems})`:""}, element:
`+bl(t.items||{},s+2);case"object":return t.properties?n+`{
`+Object.entries(t.properties).map(([i,r])=>`${n}  ${i}: ${bl(r,s+4)}`).join(`
`)+`
`+n+"}":`${n}object`;default:return`${n}any`}}function tS(t){return`⚠️ Odpowiedz wyłącznie poprawnym JSON-em zgodnym z poniższą strukturą:

`+bl(t,0)}async function rx(t,s,n="json"){let i=t;n==="json"&&s&&(i+=`

`+tS(s));const o=(await(await fetch("http://localhost:3001/api/chat",{method:"POST",headers:{"content-type":"application/json","x-api-key":"ce040e01e5b1b24f530a541f89e2409b328cf51efc6ba295c85ba1858072498b"},body:JSON.stringify({message:i,model:"gemini-1.5-flash",responseFormat:n})})).json()).response||"";if(n==="json"){const l=o.replace(/```json\s*|\s*```/g,"").trim(),c=JSON.parse(l);return s?yl(s).parse(c):c}return o}function sS(t,s){let n;try{n=t()}catch{return}return{getItem:r=>{var a;const o=c=>c===null?null:JSON.parse(c,void 0),l=(a=n.getItem(r))!=null?a:null;return l instanceof Promise?l.then(o):o(l)},setItem:(r,a)=>n.setItem(r,JSON.stringify(a,void 0)),removeItem:r=>n.removeItem(r)}}const wl=t=>s=>{try{const n=t(s);return n instanceof Promise?n:{then(i){return wl(i)(n)},catch(i){return this}}}catch(n){return{then(i){return this},catch(i){return wl(i)(n)}}}},nS=(t,s)=>(n,i,r)=>{let a={storage:sS(()=>localStorage),partialize:x=>x,version:0,merge:(x,b)=>({...b,...x}),...s},o=!1;const l=new Set,c=new Set;let d=a.storage;if(!d)return t((...x)=>{console.warn(`[zustand persist middleware] Unable to update item '${a.name}', the given storage is currently unavailable.`),n(...x)},i,r);const m=()=>{const x=a.partialize({...i()});return d.setItem(a.name,{state:x,version:a.version})},u=r.setState;r.setState=(x,b)=>{u(x,b),m()};const h=t((...x)=>{n(...x),m()},i,r);r.getInitialState=()=>h;let p;const j=()=>{var x,b;if(!d)return;o=!1,l.forEach(y=>{var v;return y((v=i())!=null?v:h)});const w=((b=a.onRehydrateStorage)==null?void 0:b.call(a,(x=i())!=null?x:h))||void 0;return wl(d.getItem.bind(d))(a.name).then(y=>{if(y)if(typeof y.version=="number"&&y.version!==a.version){if(a.migrate){const v=a.migrate(y.state,y.version);return v instanceof Promise?v.then(_=>[!0,_]):[!0,v]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,y.state];return[!1,void 0]}).then(y=>{var v;const[_,C]=y;if(p=a.merge(C,(v=i())!=null?v:h),n(p,!0),_)return m()}).then(()=>{w?.(p,void 0),p=i(),o=!0,c.forEach(y=>y(p))}).catch(y=>{w?.(void 0,y)})};return r.persist={setOptions:x=>{a={...a,...x},x.storage&&(d=x.storage)},clearStorage:()=>{d?.removeItem(a.name)},getOptions:()=>a,rehydrate:()=>j(),hasHydrated:()=>o,onHydrate:x=>(l.add(x),()=>{l.delete(x)}),onFinishHydration:x=>(c.add(x),()=>{c.delete(x)})},a.skipHydration||j(),p||h},ax=nS,ur=Lh()(ax((t,s)=>({steps:{},schemas:{},registerStep:(n,i,r=!1)=>{t(a=>({schemas:{...a.schemas,[n]:{schema:i,clearOnNext:r}}}))},setStepData:(n,i)=>{t(r=>({steps:{...r.steps,[n]:{...r.steps[n],...i}}}))},getStepData:n=>s().steps[n]||{},clearStep:n=>{t(i=>({steps:{...i.steps,[n]:{}}}))},clearAll:()=>t({steps:{}})}),{name:"step-store"})),iS=Lh()(ax((t,s)=>({snapshots:[],saveSnapshot:n=>{const i=ur.getState().steps,r={id:Date.now().toString(),name:n,data:i,created:Date.now()};t(a=>({snapshots:[...a.snapshots,r]}))},loadSnapshot:n=>{const i=s().snapshots.find(r=>r.id===n);if(i){const r=ur.getState();r.clearAll(),Object.entries(i.data).forEach(([a,o])=>{r.setStepData(a,o)})}},deleteSnapshot:n=>{t(i=>({snapshots:i.snapshots.filter(r=>r.id!==n)}))},listSnapshots:()=>s().snapshots}),{name:"snapshot-store"}));function ox(){const[t,s]=g.useState(!1),[n,i]=g.useState(""),[r,a]=g.useState(""),{snapshots:o,saveSnapshot:l,loadSnapshot:c,deleteSnapshot:d}=iS();g.useEffect(()=>{const j=x=>{x.key==="Escape"&&s(!1)};return window.addEventListener("keydown",j),()=>window.removeEventListener("keydown",j)},[]);const m=g.useMemo(()=>[...o].sort((j,x)=>x.created-j.created),[o]),u=g.useMemo(()=>{const j=r.trim().toLowerCase();return j?m.filter(x=>x.name.toLowerCase().includes(j)):m},[m,r]),h=()=>{const j=new Date().toLocaleString();l(`Snapshot ${j}`)},p=()=>{const j=n.trim();j&&(l(j),i(""))};return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>s(!0),title:"Snapshoty",className:"fixed right-4 bottom-4 bg-black text-white p-3 rounded-full shadow hover:bg-gray-900",children:"📸"}),t&&e.jsxs("div",{className:"fixed right-0 top-0 h-full w-64 bg-white border-l z-50 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b",children:[e.jsx("div",{className:"font-semibold text-sm",children:"Snapshoty"}),e.jsx("button",{onClick:()=>s(!1),className:"text-gray-500 hover:text-black text-lg leading-none","aria-label":"Zamknij",title:"Zamknij",children:"×"})]}),e.jsxs("div",{className:"p-3 border-b space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"border px-2 py-1 rounded w-full text-sm",placeholder:"Nazwa snapshotu",value:n,onChange:j=>i(j.target.value),onKeyDown:j=>j.key==="Enter"&&p()}),e.jsx("button",{onClick:p,className:"bg-blue-600 hover:bg-blue-700 text-white text-xs px-3 rounded",children:"Zapisz"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:h,className:"text-xs text-blue-700 underline",children:"Szybki zapis"}),e.jsx("input",{className:"border px-2 py-1 rounded text-xs w-32",placeholder:"Szukaj…",value:r,onChange:j=>a(j.target.value)})]})]}),e.jsx("div",{className:"p-3 overflow-y-auto text-sm space-y-2",children:u.length===0?e.jsx("div",{className:"text-gray-500 text-xs text-center mt-4",children:"Brak snapshotów"}):u.map(j=>e.jsxs("div",{className:"border rounded p-2",children:[e.jsx("div",{className:"font-medium truncate",title:j.name,children:j.name}),e.jsx("div",{className:"text-[11px] text-gray-500",children:new Date(j.created).toLocaleString()}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:()=>c(j.id),className:"bg-green-600 hover:bg-green-700 text-white text-xs px-2 py-1 rounded",children:"Wczytaj"}),e.jsx("button",{onClick:()=>{confirm(`Usunąć „${j.name}”?`)&&d(j.id)},className:"bg-red-500 hover:bg-red-600 text-white text-xs px-2 py-1 rounded",children:"Usuń"})]})]},j.id))})]})]})}const lx=["Matematyka","Biologia","Chemia","Fizyka","Informatyka","Geografia","Historia","Polski","Angielski"],rS={Matematyka:"Matematyka",Biologia:"Biologia",Chemia:"Chemia",Fizyka:"Fizyka",Informatyka:"Informatyka",Geografia:"Geografia",Historia:"Historia",Polski:"Język polski",Angielski:"Język obcy nowożytny"},aS=[{id:"pl-lo-2025-math",label:"Podstawa programowa LO (2025) — Matematyka",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/matematyka",subjects:["Matematyka"],outcomes:{Matematyka:["Rozwiązuje równania i nierówności oraz interpretuje wyniki.","Analizuje funkcje i wykresy; stosuje własności do rozwiązywania zadań.","Geometria płaska i przestrzenna w praktycznych zastosowaniach.","Rachunek prawdopodobieństwa i statystyka opisowa do wnioskowania.","Modeluje problemy tekstowe z użyciem narzędzi matematycznych."]}},{id:"pl-lo-2025-it",label:"Podstawa programowa LO (2025) — Informatyka",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/informatyka",subjects:["Informatyka"],outcomes:{Informatyka:["Projektuje i analizuje proste algorytmy; implementuje je.","Dobiera i stosuje struktury danych.","Pisze, uruchamia i testuje programy.","Podstawy sieci i bezpieczeństwa informacji.","Współpraca zespołowa (repozytoria, wersjonowanie)."]}},{id:"pl-lo-2025-polish",label:"Podstawa programowa LO (2025) — Język polski",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/jezyk-polski",subjects:["Polski"],outcomes:{Polski:["Analizuje i interpretuje teksty literackie i nieliterackie.","Świadomie posługuje się środkami językowymi w wypowiedzi.","Tworzy wypowiedzi pisemne zgodne z wymogami gatunku.","Rozpoznaje konteksty kulturowe i historyczne utworów.","Korzysta z różnych źródeł informacji i je weryfikuje."]}},{id:"pl-lo-2025-bio",label:"Podstawa programowa LO (2025) — Biologia",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/biologia",subjects:["Biologia"],outcomes:{Biologia:["Wyjaśnia zjawiska biologiczne w oparciu o strukturę i funkcję.","Planuje i interpretuje proste doświadczenia biologiczne.","Analizuje dziedziczenie cech i zmienność organizmów.","Rozumie podstawy ekologii i ochrony środowiska.","Korzysta z danych biologicznych do wnioskowania."]}},{id:"pl-lo-2025-phy",label:"Podstawa programowa LO (2025) — Fizyka",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/fizyka",subjects:["Fizyka"],outcomes:{Fizyka:["Opisuje i wyjaśnia zjawiska fizyczne z użyciem pojęć i praw fizyki.","Wykonuje pomiary, szacuje niepewności i analizuje wyniki.","Stosuje zasady dynamiki, energii i pędu w zadaniach.","Interpretuje wykresy i zależności wielkości fizycznych.","Rozwiązuje zadania obliczeniowe, uzasadniając tok rozumowania."]}},{id:"pl-lo-2025-chem-podst",label:"Podstawa programowa LO (2025) — Chemia (podstawowy)",year:2025,level:"podstawowy",sourceUrl:"https://podstawaprogramowa.pl/Liceum-technikum/Chemia",subjects:["Chemia"],outcomes:{Chemia:["Stosuje zasady BHP w pracowni chemicznej; rozpoznaje piktogramy i prowadzi proste doświadczenia.","Opisuje budowę atomu i okresowość właściwości pierwiastków; zapisuje proste konfiguracje elektronowe.","Rozróżnia i charakteryzuje wiązania (jonowe, kowalencyjne, metaliczne) i przewiduje właściwości substancji.","Posługuje się pojęciami mol, masa molowa, objętość molowa; wykonuje obliczenia stechiometryczne.","Pisze i bilansuje równania reakcji, w tym redoks; wyznacza stopnie utlenienia.","Analizuje roztwory: oblicza stężenie procentowe i molowe; opisuje rozpuszczalność i czynniki ją zmieniające.","Opisuje kwasowo-zasadowość: pH, wskaźniki, moc kwasów/zasad; rozwiązuje proste zadania obliczeniowe.","Wyjaśnia czynniki wpływające na szybkość reakcji; opisuje równowagi chemiczne i zasadę Le Chateliera.","Charakteryzuje właściwości gazów i cieczy; stosuje równanie gazu doskonałego w prostych zadaniach.","Rozpoznaje podstawowe grupy funkcyjne w chemii organicznej; podaje właściwości i reakcje charakterystyczne.","Interpretuje i krytycznie analizuje dane (tabele, wykresy, schematy) oraz formułuje wnioski.","Wskazuje zastosowania związków chemicznych w życiu codziennym, środowisku i przemyśle; ocenia wpływ na środowisko."]}},{id:"pl-lo-2025-chem-rozsz",label:"Podstawa programowa LO (2025) — Chemia (rozszerzony)",year:2025,level:"rozszerzony",sourceUrl:"https://podstawaprogramowa.pl/Liceum-technikum/Chemia",subjects:["Chemia"],outcomes:{Chemia:["Wykonuje złożone obliczenia stechiometryczne (odczynnik ograniczający, wydajność, mieszanie roztworów).","Stosuje prawa termochemii: ΔH reakcji, prawo Hessa; jakościowo interpretuje wpływ ΔS i ΔG na spontaniczność.","Analizuje równowagi: zapisuje wyrażenia Kc/Kp, szacuje przesunięcia równowagi (Le Chatelier), rozwiązuje proste układy z K.","Opisuje i oblicza zagadnienia kwas-zasada: stałe dysocjacji, hydroliza soli, bufor i równanie Hendersona–Hasselbalcha.","Projektuje i interpretuje miareczkowania (kwas–zasada, redoks); szkicuje krzywe miareczkowania i dobiera wskaźniki.","Stosuje podstawy kinetyki: prawo szybkości, rząd reakcji z danych doświadczalnych, pojęcie energii aktywacji (Arrhenius jakościowo).","Wykorzystuje elektrochemię: buduje schematy ogniw, oblicza SEM ze standardowych potencjałów; jakościowo stosuje równanie Nernsta.","Posługuje się iloczynem rozpuszczalności (Ksp) do przewidywania strącania; analizuje równowagi strąceniowe.","Rozpoznaje i opisuje mechanizmy podstawowych reakcji organicznych (substytucja/addycja/eliminacja na poziomie jakościowym).","Analizuje izomerię (strukturalna, geometryczna, optyczna) i konsekwencje stereochemiczne właściwości związków.","Charakteryzuje polimery (addycja, kondensacja), makrocząsteczki i ich zastosowania; wskazuje aspekty środowiskowe.","Stosuje elementy analizy jakościowej i instrumentalnej (chromatografia w ujęciu szkolnym, proste widma) do identyfikacji związków."]}},{id:"pl-lo-2025-geo",label:"Podstawa programowa LO (2025) — Geografia",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/geografia",subjects:["Geografia"],outcomes:{Geografia:["Analizuje mapy, dane statystyczne i obrazy Ziemi.","Wyjaśnia procesy przyrodnicze i społeczno-ekonomiczne.","Ocena wpływu działalności człowieka na środowisko.","Interpretuje wskaźniki demograficzne i gospodarcze.","Korzysta z narzędzi GIS/geo-danych na poziomie podstawowym."]}},{id:"pl-lo-2025-hist",label:"Podstawa programowa LO (2025) — Historia",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/historia",subjects:["Historia"],outcomes:{Historia:["Porządkuje wydarzenia w czasie i przestrzeni (chronologia, mapa).","Analizuje i interpretuje źródła historyczne.","Wyjaśnia przyczyny i skutki zjawisk historycznych.","Rozpoznaje spory interpretacyjne i różne narracje.","Formułuje argumenty i wnioski w dyskusji o przeszłości."]}},{id:"pl-lo-2025-eng",label:"Podstawa programowa LO (2025) — Język obcy nowożytny (Angielski)",year:2025,sourceUrl:"https://www.podstawaprogramowa.pl/liceum-technikum/jezyk-obcy-nowozytny",subjects:["Angielski"],outcomes:{Angielski:["Rozumie typowe wypowiedzi ustne i pisemne w kontekście szkolnym.","Komunikuje się w codziennych sytuacjach i w tematach szkolnych.","Pisze krótkie wypowiedzi użytkowe zgodnie z celem i odbiorcą.","Rozwija zakres środków językowych (słownictwo, gramatyka).","Stosuje strategie uczenia się i korzysta z różnych źródeł."]}}];function oS(t){return lx.find(n=>n===t)??null}function lS(t){if(!t)return null;const s=oS(t);if(!s)return null;const n=rS[s],i=aS.filter(a=>a.subjects.includes(s)||a.subjects.includes(n));return i.length===0?null:[...i].sort((a,o)=>{const l=a.year??0,c=o.year??0;return c!==l?c-l:a.id.localeCompare(o.id)})[0]??null}const _u={type:"object",properties:{title:{type:"string"},subject:{type:"string",required:!0},level:{type:"string",required:!0},isMaturaCourse:{type:"boolean",required:!0},topics:{type:"array",minItems:5,items:{type:"object",properties:{title:{type:"string",required:!0},description:{type:"string",required:!0}}}}}};function cS(){const{registerStep:t,setStepData:s,getStepData:n}=ur(),i=n("step1")||{};g.useEffect(()=>{t("step1",_u),i.subject||s("step1",{subject:"Matematyka",level:"podstawowy",isMaturaCourse:!0,alignToCurriculum:!0})},[]);const r=g.useMemo(()=>lS(i.subject),[i.subject]),[a,o]=g.useState(!1),l=async()=>{s("step1",{isGenerating:!0});try{const u=r?.outcomes?.[i.subject]??[],h=i.isMaturaCourse&&i.alignToCurriculum&&r?`
Uwzględnij zgodność z podstawą programową LO (PL).
(Dokument: ${r.label}${r.year?` • ${r.year}`:""})
Wymagania do pokrycia:
${u.map((x,b)=>`${b+1}. ${x}`).join(`
`)}
Jeśli to możliwe, sygnalizuj pokrycie wymagań w nawiasie, np. "[PP]".
          `.trim():"",p=`
Wygeneruj szkic kursu dla nauczyciela:
- przedmiot: ${i.subject}
- poziom: ${i.level}
- charakter: ${i.isMaturaCourse?"maturalny":"niematuralny"}
${h?`
${h}
`:""}

Szkic ma być zwięzły, klarowny i praktyczny dla planowania lekcji. Zadbaj, by tematy były sensownie dobrane do poziomu.
      `.trim(),j=await rx(p,_u);s("step1",{outline:j,isGenerating:!1})}catch{s("step1",{isGenerating:!1})}},c=!!(i.isMaturaCourse&&r&&i.alignToCurriculum),d=i.outline?.title||(i.subject&&i.level?`${i.subject} — kurs ${i.level}`:"Szkic kursu"),m=r?.outcomes?.[i.subject]??[];return e.jsxs(G,{children:[e.jsx(ke,{title:"Krok 1 ",description:"Szkic kursu"}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Parametry kursu"})}),e.jsxs(R,{className:"space-y-4",children:[e.jsx(J,{placeholder:"Tytuł kursu (opcjonalnie)",value:i.title||"",onChange:u=>s("step1",{title:u.target.value}),disabled:i.isGenerating}),e.jsxs(Ce,{value:i.subject||"Matematyka",onValueChange:u=>s("step1",{subject:u}),disabled:i.isGenerating,children:[e.jsx(we,{children:e.jsx(_e,{placeholder:"Wybierz przedmiot"})}),e.jsx(ve,{children:lx.map(u=>e.jsx(W,{value:u,children:u},u))})]}),e.jsxs(Ce,{value:i.level||"podstawowy",onValueChange:u=>s("step1",{level:u}),disabled:i.isGenerating,children:[e.jsx(we,{children:e.jsx(_e,{placeholder:"Wybierz poziom"})}),e.jsxs(ve,{children:[e.jsx(W,{value:"podstawowy",children:"Podstawowy"}),e.jsx(W,{value:"rozszerzony",children:"Rozszerzony"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rs,{checked:i.isMaturaCourse||!1,onCheckedChange:u=>s("step1",{isMaturaCourse:u,alignToCurriculum:u?i.alignToCurriculum:!1}),disabled:i.isGenerating}),e.jsx("span",{className:"text-sm",children:"Kurs maturalny"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rs,{checked:i.alignToCurriculum||!1,onCheckedChange:u=>s("step1",{alignToCurriculum:u}),disabled:i.isGenerating||!i.isMaturaCourse}),e.jsxs("span",{className:"text-sm",children:["Uwzględnij ",e.jsx("strong",{children:"najnowszą (2025)"})," podstawę programową LO (PL)"]})]}),c&&e.jsxs(e.Fragment,{children:[e.jsxs($s,{children:[e.jsx(Bh,{className:"h-4 w-4"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsxs(Fs,{className:"text-xs",children:["Dokument: ",e.jsx("strong",{children:r?.label}),r?.year?` • ${r.year}`:""]}),m.length>0&&e.jsx(I,{type:"button",size:"sm",variant:"outline",className:"h-7 px-2 text-xs shrink-0",onClick:()=>o(u=>!u),children:a?"Ukryj wymagania":`Pokaż wymagania (${m.length})`})]})]}),a&&e.jsx("ul",{className:"text-xs list-disc pl-5 space-y-1 max-h-40 overflow-auto rounded-md border p-2",children:m.map((u,h)=>e.jsx("li",{className:"leading-snug",children:u},h))})]}),e.jsx(I,{onClick:l,disabled:i.isGenerating,className:"w-full",children:i.isGenerating?e.jsxs(e.Fragment,{children:[e.jsx(ri,{className:"w-4 h-4 animate-spin"}),"Generowanie..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ct,{className:"w-4 h-4"}),"Generuj szkic"]})})]})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Podgląd szkicu"})}),e.jsx(R,{children:i.isGenerating?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ri,{className:"w-6 h-6 animate-spin"})}):i.outline?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold",children:d}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[i.outline.subject||i.subject," • ",i.outline.level||i.level]})]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-auto pr-1",children:i.outline.topics?.map((u,h)=>e.jsxs(M,{className:"p-3",children:[e.jsxs("div",{className:"font-medium",children:[h+1,". ",u.title]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:u.description})]},h))}),e.jsx(I,{asChild:!0,className:"w-full",children:e.jsx(bs,{to:"/teacher/course-structure/step2",children:"Dalej →"})})]}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("div",{className:"font-medium",children:d}),e.jsx("div",{className:"text-xs mt-1",children:"Kliknij „Generuj szkic”"})]})})]})]}),e.jsx(ox,{})]})}const Tu={type:"object",properties:{courseTitle:{type:"string",required:!0},courseDescription:{type:"string"},subject:{type:"string",required:!0},level:{type:"string",required:!0},isMaturaCourse:{type:"boolean",required:!0},topics:{type:"array",minItems:1,items:{type:"object",properties:{title:{type:"string",required:!0},description:{type:"string",required:!0},position:{type:"number",required:!0},is_published:{type:"boolean",required:!0}}}}}};function dS(){const{registerStep:t,setStepData:s,getStepData:n}=ur(),i=me(),r=n("step1"),a=n("step2");g.useEffect(()=>{t("step2",Tu),a.targetCount||s("step2",{targetCount:15}),r.outline||i("/teacher/course-structure/step1")},[]);const o=async()=>{if(!r.outline){s("step2",{error:"Brak danych z kroku 1"});return}s("step2",{isGenerating:!0,error:null});const c=`
Rozwiń szkic kursu do dokładnie ${a.targetCount} tematów lekcji, logicznie uporządkowanych od podstaw do bardziej zaawansowanych.
Wygeneruj tytuły i krótkie opisy (2–3 zdania) z perspektywy nauczyciela przygotowującego plan pracy.
Kontekst:
- tytuł szkicu: ${r.outline.title}
- przedmiot: ${r.outline.subject}
- poziom: ${r.outline.level}
- kurs ${r.outline.isMaturaCourse?"maturalny":"niematuralny"}
- główne tematy szkicu: ${r.outline.topics?.map(d=>d.title).join(", ")}

Zachowaj spójność terminologii i adekwatność do poziomu. Jeśli kurs maturalny — uwzględnij wymagania egzaminacyjne w zakresie doboru tematów.
    `.trim();try{const d=await rx(c,Tu),m={...d,courseTitle:d.courseTitle||d.title||r.outline.title,subject:d.subject||r.outline.subject,level:d.level||r.outline.level,isMaturaCourse:d.isMaturaCourse??r.outline.isMaturaCourse,topics:(d.topics||[]).map((u,h)=>({...u,position:u.position||h+1,is_published:!1}))};s("step2",{refined:m,isGenerating:!1,error:null})}catch(d){console.error("Błąd generowania:",d),s("step2",{isGenerating:!1,error:"Nie udało się wygenerować tematów. Spróbuj ponownie."})}},l=()=>{i("/teacher/course-structure/step3",{state:{refined:a.refined,outline:r.outline}})};return e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsx("h1",{className:"text-2xl font-semibold mb-6",children:"Krok 2 — Szczegółowe tematy lekcji"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Konfiguracja"})}),e.jsxs(R,{className:"space-y-4",children:[r.outline&&e.jsxs($s,{children:[e.jsx(dt,{className:"h-4 w-4"}),e.jsxs(Fs,{children:[e.jsx("strong",{children:"Rozwijamy kurs:"})," ",r.outline.title,e.jsx("br",{}),e.jsxs("span",{className:"text-muted-foreground",children:[r.outline.subject," • ",r.outline.level,r.outline.isMaturaCourse&&" • Maturalny"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Liczba tematów lekcji"}),e.jsx(J,{type:"number",min:"5",max:"50",value:a.targetCount||15,onChange:c=>s("step2",{targetCount:Number(c.target.value)}),disabled:a.isGenerating}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Zalecane: 10-20 dla kursu podstawowego, 20-30 dla rozszerzonego"})]}),a.error&&e.jsxs($s,{variant:"destructive",children:[e.jsx(dt,{className:"h-4 w-4"}),e.jsx(Fs,{children:a.error})]}),e.jsx(I,{onClick:o,disabled:a.isGenerating||!r.outline,className:"w-full",children:a.isGenerating?e.jsxs(e.Fragment,{children:[e.jsx(ri,{className:"w-4 h-4 animate-spin"}),"Generowanie tematów..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ct,{className:"w-4 h-4"}),"Generuj ",a.targetCount," tematów"]})}),a.refined&&e.jsx(M,{className:"bg-muted",children:e.jsxs(R,{className:"pt-6",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Wygenerowano:"}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("div",{children:["• ",a.refined.topics?.length||0," tematów"]}),e.jsxs("div",{children:["• ",a.refined.courseDescription?"✓":"✗"," Opis kursu"]}),e.jsxs("div",{children:["• Poziom: ",a.refined.level]})]})]})})]})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Podgląd tematów"})}),e.jsx(R,{children:a.isGenerating?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-muted-foreground",children:[e.jsx(ri,{className:"w-8 h-8 animate-spin mb-3"}),e.jsxs("p",{className:"text-sm",children:["Generowanie ",a.targetCount," tematów..."]}),e.jsx("p",{className:"text-xs mt-1",children:"To może potrwać do 30 sekund"})]}):a.refined?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"mb-4",children:e.jsxs(R,{className:"pt-6",children:[e.jsx("h3",{className:"font-bold",children:a.refined.courseTitle}),a.refined.courseDescription&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:a.refined.courseDescription})]})}),e.jsx(qs,{className:"h-[400px] mb-4",children:e.jsx("div",{className:"space-y-2",children:a.refined.topics?.map(c=>e.jsx(M,{className:"p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("span",{className:"text-muted-foreground text-sm",children:[c.position,"."]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:c.title}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:c.description})]})]})},c.position))})}),e.jsxs(I,{onClick:l,className:"w-full",variant:"default",children:[e.jsx("span",{children:"Przejdź do zapisu"}),e.jsx(jt,{className:"w-4 h-4"})]})]}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{className:"text-sm",children:"Tematy pojawią się tutaj po wygenerowaniu"}),e.jsx("p",{className:"text-xs mt-2",children:'Wybierz liczbę tematów i kliknij "Generuj"'})]})})]})]}),e.jsx(ox,{})]})}function uS(){const t=me(),s=hi(),{data:n}=Le(),{steps:i,clearAll:r}=ur(),a=g.useMemo(()=>s?.state?.refined??i?.step2?.refined,[s?.state,i]),o=g.useMemo(()=>s?.state?.outline??i?.step1?.outline,[s?.state,i]),[l,c]=g.useState(!1),[d,m]=g.useState(null),[u,h]=g.useState(0),[p,j]=g.useState(null),{mutate:x}=fn(),{mutate:b}=fn(),w=async()=>{if(!a){j("Brak danych kursu (refined). Wróć do kroku 2.");return}j(null),c(!0),h(0);try{const v=await new Promise((k,N)=>{x({resource:"courses",values:{title:a.courseTitle,description:a.courseDescription||"",vendor_id:n?.vendor_id??0,is_published:!1,icon_emoji:o?.icon_emoji||"📚"}},{onSuccess:z=>{const T=z?.data?.id;if(T==null)return N(new Error("Brak ID kursu"));k(T)},onError:z=>N(z)})});m(v);const _=typeof v=="string"?parseInt(v,10):v,C=a.topics?.length||0;for(let k=0;k<C;k++){const N=a.topics[k];await new Promise(z=>{b({resource:"topics",values:{course_id:_,title:N.title,description:N.description,position:N.position||k+1,is_published:N.is_published||!1}},{onSuccess:()=>{h(T=>T+1),z()},onError:()=>{console.error(`Błąd zapisu tematu ${k+1}/${C}`),z()}})})}r(),t("/teacher/ai-tools",{replace:!0})}catch(v){console.error("Błąd zapisu:",v),j(v?.message||"Nie udało się zapisać kursu.")}finally{c(!1)}};if(!a)return e.jsx("div",{className:"max-w-3xl mx-auto p-6",children:e.jsx(M,{children:e.jsxs(R,{className:"pt-6",children:[e.jsxs($s,{variant:"destructive",children:[e.jsx(dt,{className:"h-4 w-4"}),e.jsxs(Fs,{children:[e.jsx("span",{className:"font-medium",children:"Brak danych do zapisu"}),e.jsx("br",{}),"Wróć do kroku 2 i wygeneruj tematy kursu."]})]}),e.jsx(I,{asChild:!0,className:"mt-4",children:e.jsxs(bs,{to:"/teacher/course-structure/step2",children:[e.jsx(ge,{className:"w-4 h-4"}),"Wróć do kroku 2"]})})]})})});const y=a.topics?.length>0?u/a.topics.length*100:0;return e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("header",{className:"flex items-center gap-2 mb-6",children:[e.jsx(ma,{className:"w-5 h-5"}),e.jsx("h1",{className:"text-xl font-semibold",children:"Krok 3 — Zapis kursu"})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Podsumowanie"})}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:a.courseTitle}),a.courseDescription&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:a.courseDescription}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-2",children:[a.subject," • ",String(a.level),a.isMaturaCourse?" • Maturalny":""]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium mb-2",children:["Tematy (",a.topics.length,"):"]}),e.jsx(qs,{className:"h-64",children:e.jsxs("div",{className:"space-y-1 text-sm",children:[a.topics.slice(0,12).map((v,_)=>e.jsxs("div",{className:"border-l-2 border-muted pl-2",children:[e.jsxs("span",{className:"text-muted-foreground",children:[v.position||_+1,"."]})," ",v.title]},_)),a.topics.length>12&&e.jsxs("div",{className:"text-xs text-muted-foreground italic",children:["... i ",a.topics.length-12," więcej"]})]})})]}),p&&e.jsxs($s,{variant:"destructive",children:[e.jsx(dt,{className:"h-4 w-4"}),e.jsx(Fs,{children:p})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(I,{onClick:w,disabled:l,className:"flex-1",children:[l?e.jsx(ri,{className:"w-4 h-4 animate-spin"}):e.jsx(ma,{className:"w-4 h-4"}),l?"Zapisywanie...":"Zapisz kurs i tematy"]}),e.jsx(I,{asChild:!0,variant:"outline",children:e.jsx(bs,{to:"/teacher/course-structure/step2",children:e.jsx(ge,{className:"w-4 h-4"})})})]})]})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Status zapisu"})}),e.jsx(R,{children:!l&&!d?e.jsxs("p",{className:"text-sm text-muted-foreground",children:['Kliknij „Zapisz kurs i tematy", aby utworzyć kurs i ',a.topics.length," tematów."]}):l?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ri,{className:"w-4 h-4 animate-spin"}),"Zapisywanie tematów: ",u," / ",a.topics.length]}),e.jsx(Yt,{value:y,className:"w-full"})]}):d?e.jsxs($s,{children:[e.jsx(xn,{className:"h-4 w-4"}),e.jsxs(Fs,{children:[e.jsx("span",{className:"font-medium",children:"Zapisano pomyślnie!"}),e.jsx("br",{}),"ID kursu: ",String(d)]})]}):null})]})]})]})}const mS=[e.jsx(V,{path:"/course-structure",element:e.jsx(eS,{})},"course-dashboard"),e.jsx(V,{path:"/course-structure/step1",element:e.jsx(cS,{})},"course-step1"),e.jsx(V,{path:"/course-structure/step2",element:e.jsx(dS,{})},"course-step2"),e.jsx(V,{path:"/course-structure/step3",element:e.jsx(uS,{})},"course-step3")],Au={name:"course-structure",list:"/course-structure",create:"/course-structure/step1",meta:{canDelete:!1,label:"Generator kursów",icon:e.jsx(Ua,{className:"h-4 w-4"})}},hS=()=>{const{activityId:t}=mt();me();const[s,n]=g.useState(null),[i,r]=g.useState(!1),{data:a,isLoading:o}=Ye({resource:"activities",id:t,meta:{select:"*, topics(*, courses(*))"}}),{data:l,isLoading:c,refetch:d}=Z({resource:"questions",filters:[{field:"activity_id",operator:"eq",value:parseInt(t)}],sorters:[{field:"position",order:"asc"}],pagination:{mode:"off"}}),{mutate:m}=fn(),{mutate:u}=pi(),{mutate:h}=pn();if(o||c)return e.jsx(G,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const p=a?.data,j=l?.data||[];return e.jsxs(G,{children:[e.jsx(yn,{}),e.jsxs(Y,{children:[e.jsx(ke,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(vt,{className:"w-6 h-6 text-blue-500"}),"Pytania quizu"]}),description:e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-medium",children:p?.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[p?.topics?.courses?.title," → Temat"," ",p?.topics?.position,": ",p?.topics?.title]})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(q,{variant:"outline",className:"text-base px-3 py-1",children:[j.length," ",j.length===1?"pytanie":"pytań"]}),e.jsxs(I,{onClick:()=>r(!0),disabled:i,children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Dodaj pytanie"]})]})]}),e.jsx(M,{className:"bg-muted/50",children:e.jsx(R,{className:"pt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Próg zaliczenia:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[p?.passing_score||70,"%"]})]}),p?.time_limit&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Limit czasu:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[p.time_limit," min"]})]}),p?.max_attempts&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Max. prób:"}),e.jsx("span",{className:"ml-2 font-medium",children:p.max_attempts})]})]})})}),i&&e.jsx(Du,{activityId:parseInt(t),position:j.length+1,onSave:x=>{m({resource:"questions",values:x},{onSuccess:()=>{H.success("Pytanie zostało dodane"),r(!1),d()}})},onCancel:()=>r(!1)}),e.jsx("div",{className:"space-y-4",children:j.map(x=>e.jsx("div",{children:s===x.id?e.jsx(Du,{question:x,activityId:parseInt(t),position:x.position,onSave:b=>{u({resource:"questions",id:x.id,values:b},{onSuccess:()=>{H.success("Pytanie zostało zaktualizowane"),n(null),d()}})},onCancel:()=>n(null)}):e.jsxs(M,{children:[e.jsx($,{children:e.jsxs(Y,{children:[e.jsxs(O,{className:"text-base",children:[e.jsxs("span",{className:"text-muted-foreground mr-2",children:["#",x.position]}),x.question]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(q,{variant:"outline",children:[x.points," pkt"]}),e.jsx(I,{variant:"outline",size:"sm",onClick:()=>n(x.id),children:e.jsx(ls,{className:"w-3 h-3"})}),e.jsx(I,{variant:"outline",size:"sm",onClick:()=>{confirm("Czy na pewno chcesz usunąć to pytanie?")&&h({resource:"questions",id:x.id},{onSuccess:()=>{H.success("Pytanie zostało usunięte"),d()}})},children:e.jsx(ns,{className:"w-3 h-3 text-red-600"})})]})]})}),e.jsxs(R,{children:[e.jsx("div",{className:"space-y-2",children:x.options.map((b,w)=>e.jsxs("div",{className:`flex items-center gap-2 p-2 rounded ${b.is_correct?"bg-green-50 dark:bg-green-950/30 border border-green-200 dark:border-green-800":""}`,children:[b.is_correct?e.jsx(Ge,{className:"w-4 h-4 text-green-600"}):e.jsx(Pt,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:b.is_correct?"font-medium":"",children:b.text})]},b.id||w))}),x.explanation&&e.jsxs("div",{className:"mt-4 p-3 bg-muted rounded",children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:"Wyjaśnienie:"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:x.explanation})]})]})]})},x.id))}),j.length===0&&!i&&e.jsx(M,{children:e.jsxs(R,{className:"text-center py-12",children:[e.jsx(vt,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground/50"}),e.jsx("p",{className:"text-lg font-medium text-muted-foreground mb-4",children:"Quiz nie ma jeszcze żadnych pytań"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"Dodaj pierwsze pytanie, aby uczniowie mogli rozwiązać quiz"}),e.jsxs(I,{onClick:()=>r(!0),children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Dodaj pierwsze pytanie"]})]})}),j.length>0&&e.jsxs("div",{className:"flex justify-between items-center pt-6 border-t",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Łącznie punktów: ",j.reduce((x,b)=>x+b.points,0)]}),e.jsx(yn,{variant:"outline",children:"Zakończ edycję"})]})]})},Du=({question:t,activityId:s,position:n,onSave:i,onCancel:r})=>{const[a,o]=g.useState({question:t?.question||"",explanation:t?.explanation||"",points:t?.points||1,position:n,options:t?.options||[{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1}]}),l=()=>{if(!a.question.trim()){H.error("Pytanie jest wymagane");return}const m=a.options.filter(h=>h.text.trim());if(m.length<2){H.error("Dodaj przynajmniej 2 odpowiedzi");return}if(m.filter(h=>h.is_correct).length===0){H.error("Zaznacz przynajmniej jedną poprawną odpowiedź");return}i({activity_id:s,question:a.question,explanation:a.explanation||null,points:a.points,position:a.position,options:m.map((h,p)=>({...h,position:p+1}))})},c=()=>{a.options.length<6&&o({...a,options:[...a.options,{text:"",is_correct:!1}]})},d=m=>{if(a.options.length>2){const u=a.options.filter((h,p)=>p!==m);o({...a,options:u})}};return e.jsxs(M,{className:"border-primary",children:[e.jsx($,{children:e.jsx(O,{children:t?"Edytuj pytanie":"Nowe pytanie"})}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Treść pytania"}),e.jsx(ks,{placeholder:"Wprowadź treść pytania...",value:a.question,onChange:m=>o({...a,question:m.target.value}),className:"mt-1",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Liczba punktów"}),e.jsx(J,{type:"number",min:"1",value:a.points,onChange:m=>o({...a,points:parseInt(m.target.value)||1}),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Pozycja"}),e.jsx(J,{type:"number",min:"1",value:a.position,onChange:m=>o({...a,position:parseInt(m.target.value)||1}),className:"mt-1"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Odpowiedzi"}),a.options.length<6&&e.jsxs(I,{type:"button",size:"sm",variant:"outline",onClick:c,children:[e.jsx(Re,{className:"w-3 h-3 mr-1"}),"Dodaj opcję"]})]}),e.jsx("div",{className:"space-y-2",children:a.options.map((m,u)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(rs,{checked:m.is_correct,onCheckedChange:h=>{const p=[...a.options];p[u].is_correct=h,o({...a,options:p})}}),e.jsx(J,{placeholder:`Odpowiedź ${u+1}`,value:m.text,onChange:h=>{const p=[...a.options];p[u].text=h.target.value,o({...a,options:p})},className:"flex-1"}),a.options.length>2&&e.jsx(I,{type:"button",variant:"ghost",size:"sm",onClick:()=>d(u),children:e.jsx(Pt,{className:"w-4 h-4"})})]},u))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Zaznacz checkbox przy poprawnych odpowiedziach. Możesz zaznaczyć więcej niż jedną."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Wyjaśnienie (opcjonalne)"}),e.jsx(ks,{placeholder:"Wyjaśnienie poprawnej odpowiedzi...",value:a.explanation,onChange:m=>o({...a,explanation:m.target.value}),className:"mt-1",rows:3})]}),e.jsxs(Y,{children:[e.jsxs(I,{variant:"outline",onClick:r,children:[e.jsx(Pt,{className:"w-4 h-4 mr-2"}),"Anuluj"]}),e.jsxs(I,{onClick:l,children:[e.jsx(ma,{className:"w-4 h-4 mr-2"}),"Zapisz pytanie"]})]})]})]})},fS=()=>{const[t]=Ma(),s=me(),n=t.get("activity_id"),{data:i,isLoading:r}=Z({resource:"questions",filters:[{field:"activity_id",operator:"eq",value:parseInt(n)}],sorters:[{field:"position",order:"desc"}],pagination:{mode:"off"}}),[a,o]=g.useState({question:"",explanation:"",points:1,position:1,options:[{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1}]});g.useEffect(()=>{if(i?.data){const x=i.data.reduce((b,w)=>Math.max(b,w.position||0),0);o(b=>({...b,position:x+1}))}},[i]);const{data:l,isLoading:c}=Ye({resource:"activities",id:n,meta:{select:"*, topics(*, courses(*))"}}),{mutate:d,isLoading:m}=fn();if(!n)return e.jsx(G,{children:e.jsx(M,{children:e.jsx(R,{className:"text-center py-12",children:e.jsx("p",{className:"text-lg font-medium text-muted-foreground",children:"Brak ID aktywności"})})})});if(c||r)return e.jsx(G,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const u=l?.data;if(!u||u.type!=="quiz")return e.jsx(G,{children:e.jsx(M,{children:e.jsx(R,{className:"text-center py-12",children:e.jsx("p",{className:"text-lg font-medium text-muted-foreground",children:"Nieprawidłowa aktywność lub aktywność nie jest quizem"})})})});const h=()=>{if(!a.question.trim()){H.error("Pytanie jest wymagane");return}const x=a.options.filter(w=>w.text.trim());if(x.length<2){H.error("Dodaj przynajmniej 2 odpowiedzi");return}if(x.filter(w=>w.is_correct).length===0){H.error("Zaznacz przynajmniej jedną poprawną odpowiedź");return}d({resource:"questions",values:{activity_id:parseInt(n),question:a.question,explanation:a.explanation||null,points:a.points,position:a.position,options:x.map((w,y)=>({id:y+1,text:w.text,is_correct:w.is_correct}))}},{onSuccess:()=>{H.success("Pytanie zostało dodane"),s(`/teacher/questions/manage/${n}`)},onError:w=>{console.error("Błąd podczas dodawania pytania:",w);const y=w?.code||w?.statusCode,v=w?.message||w?.error?.message;y==="23505"||y===23505?v?.includes("position")?H.error("Pytanie o tej pozycji już istnieje. Zmień pozycję na inną wartość."):H.error("Wystąpił konflikt z istniejącymi danymi. Sprawdź pozycję pytania."):y==="23503"||y===23503?H.error("Nieprawidłowe powiązanie z aktywnością."):y==="22P02"||y===22002?H.error("Nieprawidłowy format danych."):v?H.error(`Błąd: ${v}`):H.error("Wystąpił nieoczekiwany błąd. Spróbuj ponownie.")}})},p=()=>{a.options.length<6&&o({...a,options:[...a.options,{text:"",is_correct:!1}]})},j=x=>{if(a.options.length>2){const b=a.options.filter((w,y)=>y!==x);o({...a,options:b})}};return e.jsxs(G,{children:[e.jsx(yn,{}),e.jsx(Y,{children:e.jsx(ke,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(vt,{className:"w-6 h-6 text-blue-500"}),"Dodaj pytanie do quizu"]}),description:e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-medium",children:u?.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[u?.topics?.courses?.title," → Temat"," ",u?.topics?.position,": ",u?.topics?.title]})]})})}),e.jsxs(M,{children:[e.jsx($,{children:e.jsx(O,{children:"Nowe pytanie"})}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Treść pytania"}),e.jsx(ks,{placeholder:"Wprowadź treść pytania...",value:a.question,onChange:x=>o({...a,question:x.target.value}),className:"mt-1",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Liczba punktów"}),e.jsx(J,{type:"number",min:"1",value:a.points,onChange:x=>o({...a,points:parseInt(x.target.value)||1}),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Pozycja"}),e.jsx(J,{type:"number",min:"1",value:a.position,onChange:x=>o({...a,position:parseInt(x.target.value)||1}),className:"mt-1"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Odpowiedzi"}),a.options.length<6&&e.jsxs(I,{type:"button",size:"sm",variant:"outline",onClick:p,children:[e.jsx(Re,{className:"w-3 h-3 mr-1"}),"Dodaj opcję"]})]}),e.jsx("div",{className:"space-y-2",children:a.options.map((x,b)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(rs,{checked:x.is_correct,onCheckedChange:w=>{const y=[...a.options];y[b].is_correct=w,o({...a,options:y})}}),e.jsx(J,{placeholder:`Odpowiedź ${b+1}`,value:x.text,onChange:w=>{const y=[...a.options];y[b].text=w.target.value,o({...a,options:y})},className:"flex-1"}),a.options.length>2&&e.jsx(I,{type:"button",variant:"ghost",size:"sm",onClick:()=>j(b),children:e.jsx(Pt,{className:"w-4 h-4"})})]},b))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Zaznacz checkbox przy poprawnych odpowiedziach. Możesz zaznaczyć więcej niż jedną."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Wyjaśnienie (opcjonalne)"}),e.jsx(ks,{placeholder:"Wyjaśnienie poprawnej odpowiedzi...",value:a.explanation,onChange:x=>o({...a,explanation:x.target.value}),className:"mt-1",rows:3})]}),e.jsxs(Y,{children:[e.jsxs(I,{variant:"outline",onClick:()=>s(`/teacher/questions/manage/${n}`),children:[e.jsx(Pt,{className:"w-4 h-4 mr-2"}),"Anuluj"]}),e.jsxs(I,{onClick:h,disabled:m,children:[e.jsx(ma,{className:"w-4 h-4 mr-2"}),m?"Zapisywanie...":"Zapisz pytanie"]})]})]})]})]})},pS=[e.jsx(V,{path:"/questions/manage/:activityId",element:e.jsx(hS,{})},"questions-manage"),e.jsx(V,{path:"/questions/create",element:e.jsx(fS,{})},"questions-create")],xS=[{id:"course-structure",title:"Generator struktury kursu",description:"Stwórz kompletną strukturę kursu z harmonogramem i tematami",icon:er,path:"/teacher/course-structure",color:"from-indigo-50 to-blue-50",borderColor:"border-indigo-200",iconBg:"bg-indigo-100",iconColor:"text-indigo-600",buttonBg:"bg-indigo-600 hover:bg-indigo-700",features:["Automatyczna analiza wymagań","Generowanie harmonogramu","Podział na tygodnie i tematy","Zgodność z podstawą programową"],estimatedTime:"15-20 min",targetAudience:"Twórcy nowych kursów"},{id:"educational-material",title:"Kreator materiałów edukacyjnych",description:"Generuj angażujące materiały dydaktyczne dostosowane do wieku uczniów",icon:Se,path:"/teacher/educational-material",color:"from-purple-50 to-pink-50",borderColor:"border-purple-200",iconBg:"bg-purple-100",iconColor:"text-purple-600",buttonBg:"bg-purple-600 hover:bg-purple-700",features:["Materiały dostosowane do wieku","Ćwiczenia praktyczne","Formatowanie Markdown","Integracja z istniejącymi kursami"],estimatedTime:"10-15 min",targetAudience:"Nauczyciele wszystkich poziomów"},{id:"quiz-wizard",title:"Kreator quizów",description:"Twórz profesjonalne testy sprawdzające z różnymi typami pytań",icon:Us,path:"/teacher/quiz-wizard",color:"from-blue-50 to-cyan-50",borderColor:"border-blue-200",iconBg:"bg-blue-100",iconColor:"text-blue-600",buttonBg:"bg-blue-600 hover:bg-blue-700",features:["Różne typy pytań","Automatyczne wyjaśnienia","Konfiguracja parametrów","Inteligentne punktowanie"],estimatedTime:"10-15 min",targetAudience:"Do sprawdzania wiedzy"}],gS=()=>{const t=me();return e.jsxs(G,{children:[e.jsx(ke,{title:"Narzędzia AI dla nauczycieli",description:"Wykorzystaj sztuczną inteligencję do tworzenia wysokiej jakości materiałów edukacyjnych"}),e.jsx("div",{className:"mb-8 p-6 bg-gradient-to-r from-violet-50 to-purple-50 rounded-lg border border-purple-200",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:e.jsx(Ct,{className:"w-8 h-8 text-purple-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Przyspiesz tworzenie materiałów z AI"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Nasze narzędzia AI pomagają tworzyć spersonalizowane materiały edukacyjne w ułamku czasu potrzebnego na tradycyjne przygotowanie. Każdy kreator prowadzi Cię krok po kroku przez proces tworzenia."}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{children:"Oszczędność czasu do 80%"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{children:"Dostosowane do programu nauczania"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{children:"Personalizacja dla różnych grup"})]})]})]})]})}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:xS.map(s=>{const n=s.icon;return e.jsxs(M,{className:`hover:shadow-lg transition-shadow cursor-pointer border-2 ${s.borderColor}`,onClick:()=>t(s.path),children:[e.jsxs($,{children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${s.iconBg}`,children:e.jsx(n,{className:`w-6 h-6 ${s.iconColor}`})}),e.jsx(Fe,{className:"w-5 h-5 text-gray-400"})]}),e.jsx(O,{className:"text-lg",children:s.title}),e.jsx(lc,{children:s.description})]}),e.jsx(R,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-700 mb-2",children:"Główne funkcje:"}),e.jsx("ul",{className:"space-y-1",children:s.features.slice(0,3).map((i,r)=>e.jsxs("li",{className:"text-xs text-gray-600 flex items-start gap-1",children:[e.jsx("span",{className:"text-green-500 mt-0.5",children:"•"}),e.jsx("span",{children:i})]},r))})]}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:[e.jsx(Ve,{className:"w-3 h-3 inline mr-1"}),s.estimatedTime]}),e.jsxs(I,{size:"sm",className:`${s.buttonBg} text-white`,children:[e.jsx(Ua,{className:"w-3 h-3 mr-1"}),"Rozpocznij"]})]})]})})]},s.id)})}),e.jsxs("div",{className:"mt-8 p-6 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(vt,{className:"w-5 h-5 text-blue-600"}),"Wskazówki dla najlepszych rezultatów"]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 text-sm text-gray-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium mb-1",children:"Przed rozpoczęciem:"}),e.jsxs("ul",{className:"space-y-1 text-gray-600",children:[e.jsx("li",{children:"• Przygotuj podstawowe informacje o kursie"}),e.jsx("li",{children:"• Określ grupę docelową i poziom"}),e.jsx("li",{children:"• Zaplanuj cele edukacyjne"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium mb-1",children:"Podczas tworzenia:"}),e.jsxs("ul",{className:"space-y-1 text-gray-600",children:[e.jsx("li",{children:"• Sprawdzaj podglądy na każdym etapie"}),e.jsx("li",{children:"• Dostosuj wygenerowane treści do potrzeb"}),e.jsx("li",{children:"• Zapisuj regularnie postępy"})]})]})]})]})]})},jS=[e.jsx(V,{path:"ai-tools",element:e.jsx(gS,{})},"ai-tools")],yS=[...e0,...pk,...yk,...jS,...Mz,...pS,...mS,...Fz,...qz,...Jz],bS=()=>e.jsx(Pa,{children:e.jsxs(V,{element:e.jsx(Xw,{children:e.jsx(Yl,{})}),children:[e.jsx(V,{index:!0,element:e.jsx($t,{to:"dashboard/overview",replace:!0})}),e.jsx(V,{path:"dashboard",element:e.jsx($t,{to:"dashboard/overview",replace:!0})}),yS]})}),wS=g.lazy(()=>Promise.resolve({default:bS})),cx=({text:t,colorClass:s})=>e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-background",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`inline-block h-12 w-12 animate-spin rounded-full border-4 border-current border-r-transparent ${s}`}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:t})]})}),vS=({children:t})=>{const{data:s,isLoading:n}=Le();return n||!s?e.jsx(cx,{text:"Sprawdzanie uprawnień...",colorClass:"border-indigo-600"}):["teacher","admin"].includes(s.role)?e.jsx(e.Fragment,{children:t}):e.jsx($t,{to:"/student/dashboard",replace:!0})},NS=e.jsx(V,{path:"/teacher/*",element:e.jsx(tc,{fallback:e.jsx(sc,{to:"/login"}),children:e.jsx(vS,{children:e.jsx(g.Suspense,{fallback:e.jsx(cx,{text:"Ładowanie panelu nauczyciela...",colorClass:"border-indigo-600"}),children:e.jsx(wS,{})})})},"teacher-auth")});class kS{constructor(){hs(this,"stats",{points:0,level:1,streak:0,idle_rate:1,next_level_points:200,quizzes_completed:0,perfect_scores:0,total_time:0,rank:0});hs(this,"listeners",new Set);hs(this,"channel",null);hs(this,"userId",null)}subscribe(s){return this.listeners.add(s),s(this.stats),()=>{this.listeners.delete(s)}}notify(){this.listeners.forEach(s=>s(this.stats))}async fetchStats(s){if(s)try{const{data:n,error:i}=await Q.rpc("get_my_stats");if(i)throw i;n&&(console.log("Fetched stats from DB:",n),this.stats={points:n.points||0,level:n.level||1,streak:n.streak||0,idle_rate:n.idle_rate||1,next_level_points:n.next_level_points||200,quizzes_completed:n.quizzes_completed||0,perfect_scores:n.perfect_scores||0,total_time:n.total_time||0,rank:n.rank||0},this.notify())}catch(n){console.error("Error fetching stats:",n)}}setupSubscription(s){this.userId===s&&this.channel||(this.channel&&this.userId!==s&&(console.log("Closing old subscription for user:",this.userId),Q.removeChannel(this.channel),this.channel=null),this.userId=s,console.log("Setting up global stats subscription for user:",s),this.channel=Q.channel(`global-user-stats-${s}`).on("postgres_changes",{event:"*",schema:"public",table:"user_stats",filter:`user_id=eq.${s}`},n=>{console.log("user_stats change received:",n),this.fetchStats(s)}).on("postgres_changes",{event:"INSERT",schema:"public",table:"gamification_log",filter:`user_id=eq.${s}`},n=>{console.log("gamification_log INSERT received:",n),setTimeout(()=>this.fetchStats(s),300)}).subscribe(n=>{console.log("Global subscription status:",n)}),this.fetchStats(s))}cleanup(){this.channel&&(console.log("Cleaning up global subscription"),Q.removeChannel(this.channel),this.channel=null,this.userId=null)}}const Lo=new kS,_n=()=>{const{data:t}=Le(),[s,n]=g.useState({points:0,level:1,streak:0,idle_rate:1,next_level_points:200,quizzes_completed:0,perfect_scores:0,total_time:0,rank:0}),[i,r]=g.useState(!0);g.useEffect(()=>t?.id?(Lo.setupSubscription(t.id),Lo.subscribe(l=>{n(l),r(!1)})):void 0,[t?.id]);const a=g.useCallback(async()=>{t?.id&&(r(!0),await Lo.fetchStats(t.id),r(!1))},[t?.id]);return{stats:s,isLoading:i,refetch:a}},fs=new Map,Dr=(t,s,n)=>{const i=n?.cacheKey||`${t}-${JSON.stringify(s)}`,[r,a]=g.useState(()=>fs.get(i)||null),[o,l]=g.useState(!fs.has(i)),[c,d]=g.useState(null),m=g.useCallback(async(h=!1)=>{if(n?.enabled!==!1){if(!h&&fs.has(i)){a(fs.get(i)),l(!1);return}try{l(!0),d(null);const{data:p,error:j}=await Q.rpc(t,s);if(j)throw j;fs.set(i,p),a(p),n?.onSuccess?.(p)}catch(p){d(p),n?.onError?.(p)}finally{l(!1)}}},[t,i,JSON.stringify(s),n?.enabled]);g.useEffect(()=>{m()},[m]);const u=g.useCallback(()=>{fs.delete(i)},[i]);return{data:r,isLoading:o,error:c,refetch:()=>m(!0),invalidate:u}},Wi=t=>{t?Array.from(fs.keys()).forEach(s=>{s.includes(t)&&fs.delete(s)}):fs.clear()},zS=(t,s)=>{const[n,i]=g.useState([]),[r,a]=g.useState(!0),[o,l]=g.useState(null),c=g.useCallback(async()=>{if(s?.enabled!==!1)try{a(!0),l(null);let d=Q.from(t).select(s?.select||"*");s?.filters?.forEach(h=>{switch(h.operator){case"eq":d=d.eq(h.field,h.value);break;case"in":d=d.in(h.field,h.value);break;case"contains":d=d.ilike(h.field,`%${h.value}%`);break}}),s?.sorts?.forEach(h=>{d=d.order(h.field,{ascending:h.order==="asc"})}),s?.limit&&(d=d.limit(s.limit));const{data:m,error:u}=await d;if(u)throw u;i(m||[])}catch(d){l(d)}finally{a(!1)}},[t,JSON.stringify(s)]);return g.useEffect(()=>{c()},[c]),{data:n,isLoading:r,error:o,refetch:c}},Pu=({onClose:t,variant:s="sidebar"})=>{const{mutate:n}=Ra(),{data:i}=Le(),r=hi(),{stats:a}=_n(),o=[{path:"/student/dashboard",label:"Główna",icon:mb},{path:"/student/gamification",label:"Ulepszenia",icon:cl},{path:"/student/leaderboard",label:"Ranking",icon:De},{path:"/student/achievements",label:"Osiągnięcia",icon:Ns},{path:"/student/profile",label:"Profil",icon:ua}],l=()=>{t&&t()};return s==="bottom"?e.jsx("div",{className:"grid grid-cols-5 gap-1 p-1.5",children:o.map(c=>{const d=r.pathname===c.path;return e.jsxs(ti,{to:c.path,className:({isActive:m})=>F("relative flex flex-col items-center justify-center gap-1 rounded-lg p-3 transition-colors",m?"text-primary":"text-muted-foreground hover:text-foreground hover:bg-muted/50"),children:[e.jsx(c.icon,{className:"h-5 w-5"}),e.jsx("span",{className:"text-[11px] font-medium",children:c.label}),d&&e.jsx("i",{"aria-hidden":!0,className:"pointer-events-none absolute inset-x-6 -bottom-[3px] h-1 rounded-full bg-primary/70"})]},c.path)})}):e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsxs("div",{className:"h-16 px-6 border-b relative grid place-items-center justify-start overflow-hidden",children:[e.jsx("i",{"aria-hidden":!0,className:"absolute -right-10 -top-10 w-28 h-28 rounded-3xl bg-gradient-to-br from-primary/10 via-secondary/10 to-accent/10 rotate-45"}),e.jsxs("div",{className:"flex items-center gap-3 relative z-10",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-primary to-secondary text-white grid place-items-center shadow",children:e.jsx(ni,{className:"w-5 h-5"})}),e.jsx("strong",{className:"text-lg",children:"Smart Up"})]}),t&&e.jsx(I,{variant:"ghost",size:"sm",onClick:t,className:"absolute right-4 lg:hidden",children:e.jsx(Pt,{className:"h-4 w-4"})})]}),e.jsx("section",{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-primary/10 to-secondary/10 text-primary grid place-items-center font-bold",children:i?.full_name?.charAt(0)||"U"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 rounded-full bg-secondary text-white text-xs grid place-items-center font-bold",children:a.level})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-semibold truncate",children:i?.full_name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Poziom ",a.level," • ",a.streak," dni"]})]})]})}),e.jsx("section",{className:"px-6 -mt-2 mb-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("article",{className:"rounded-xl border p-3 bg-primary/5 border-primary/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ue,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Punkty"})]}),e.jsx("p",{className:"text-lg font-bold",children:Math.floor(a.points)}),e.jsxs("p",{className:"text-xs text-primary",children:["+",a.idle_rate,"/h"]})]}),e.jsxs("article",{className:"rounded-xl border p-3 bg-destructive/5 border-destructive/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Zt,{className:"w-4 h-4 text-destructive"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Seria"})]}),e.jsx("p",{className:"text-lg font-bold",children:a.streak}),e.jsx("p",{className:"text-xs text-destructive",children:"dni z rzędu"})]})]})}),e.jsx(qs,{className:"flex-1 px-4",children:e.jsx("nav",{className:"space-y-1",children:o.map(c=>e.jsxs(ti,{to:c.path,onClick:l,className:({isActive:d})=>F("relative w-full flex items-center gap-3 px-4 h-11 rounded-xl transition-colors",d?"bg-primary text-primary-foreground":"hover:bg-muted/50 text-muted-foreground hover:text-foreground"),children:[e.jsx(c.icon,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:c.label})]},c.path))})}),e.jsx(qa,{}),e.jsxs("footer",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"px-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground mb-2",children:[e.jsxs("span",{children:["Poziom ",a.level]}),e.jsxs("span",{children:["Poziom ",a.level+1]})]}),e.jsx("div",{className:"h-1.5 rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-gradient-to-r from-primary via-secondary to-accent",style:{width:`${Math.max(0,Math.min(100,a.points%100))}%`}})})]}),e.jsxs(I,{variant:"outline",size:"sm",onClick:()=>{n(),t&&t()},className:"w-full justify-center text-destructive border-destructive/30 bg-destructive/5 hover:bg-destructive/10",children:[e.jsx($a,{className:"mr-2 h-4 w-4"}),"Wyloguj"]})]})]})},SS=()=>e.jsx("div",{"aria-hidden":!0,className:"pointer-events-none fixed inset-0 z-0 overflow-hidden p-0 lg:p-2.5 lg:pb-28 pt-0",children:e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("div",{className:"absolute inset-0 bg-background rounded-3xl"}),e.jsxs("div",{className:"absolute inset-0 rounded-3xl overflow-hidden",children:[e.jsx("div",{className:"absolute w-[50vw] h-[50vh] bottom-0 left-0 translate-y-[25%] -translate-x-[25%] bg-orange rounded-full blur-[150px] opacity-70 dark:opacity-40"}),e.jsx("div",{className:"absolute w-[30vw] h-[30vh] bottom-0 left-1/2 -translate-x-1/2 translate-y-[20%] bg-yellow rounded-full blur-[100px] opacity-60 dark:opacity-30"}),e.jsx("div",{className:"absolute w-[50vw] h-[50vh] bottom-0 right-0 translate-y-[25%] translate-x-[25%] bg-purple rounded-full blur-[150px] opacity-70 dark:opacity-40"})]})]})}),CS=({stats:t,theme:s,onToggleTheme:n})=>{const[i,r]=g.useState(!1),{data:a}=Le(),{mutate:o}=Ra(),l=g.useMemo(()=>Math.floor(t.points),[t.points]);return e.jsx("header",{className:"sticky top-0 z-30 h-16 bg-card/80 backdrop-blur supports-[backdrop-filter]:bg-card/60 border-b shadow-sm hidden lg:block",children:e.jsxs("div",{className:"mx-auto max-w-6xl h-full px-4 lg:px-8 flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3 min-w-0",children:e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-base sm:text-lg font-semibold truncate",children:"Dashboard"}),e.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:["Witaj, ",a?.full_name?.split(" ")[0],"!"]})]})}),e.jsxs("div",{className:"flex items-center gap-2 lg:gap-3",children:[e.jsxs("button",{className:"relative p-2.5 rounded-xl hover:bg-muted focus-ring h-11 w-11 grid place-items-center","aria-label":"Powiadomienia",children:[e.jsx(Gh,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("span",{className:"absolute top-1.5 right-1.5 w-2 h-2 bg-destructive rounded-full"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 lg:px-4 h-11 rounded-xl border bg-primary/10 border-primary/20",children:[e.jsx(Ue,{className:"w-4 h-4 text-primary animate-pulse"}),e.jsx("span",{className:"font-semibold text-sm lg:text-base tabular-nums min-w-[3ch] text-right",children:l.toLocaleString("pl-PL")}),e.jsxs("span",{className:"hidden md:block text-xs text-primary",children:["+",t.idle_rate,"/h"]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>r(!i),className:"flex items-center gap-2 px-1.5 h-11 rounded-xl hover:bg-muted focus-ring","aria-haspopup":"menu","aria-expanded":i,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-9 h-9 lg:w-10 lg:h-10 rounded-xl bg-gradient-to-br from-primary to-secondary text-white grid place-items-center font-bold",children:a?.full_name?.charAt(0)||"U"}),e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-4 h-4 lg:w-5 lg:h-5 rounded-full bg-accent text-white text-[10px] lg:text-xs grid place-items-center border-2 border-card",children:t.level})]}),e.jsx(Rt,{className:"w-4 h-4 text-muted-foreground"})]}),i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>r(!1),"aria-hidden":"true"}),e.jsxs("menu",{className:"absolute right-0 mt-2 w-64 bg-card rounded-xl border shadow-soft-lg z-50 overflow-hidden",children:[e.jsxs("section",{className:"p-4 border-b",children:[e.jsx("p",{className:"font-semibold truncate",children:a?.full_name}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:a?.email})]}),e.jsxs("ul",{className:"p-2",children:[e.jsx("li",{children:e.jsxs("button",{onClick:()=>{n(),r(!1)},className:"w-full flex items-center gap-3 px-3 h-11 rounded-lg text-foreground/80 hover:text-foreground hover:bg-muted transition-colors",children:[s==="dark"?e.jsx(hb,{className:"w-4 h-4"}):e.jsx(fb,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:s==="dark"?"Tryb jasny":"Tryb ciemny"})]})}),e.jsx("li",{children:e.jsxs("button",{onClick:()=>{window.location.href="/student/profile",r(!1)},className:"w-full flex items-center gap-3 px-3 h-11 rounded-lg text-foreground/80 hover:text-foreground hover:bg-muted transition-colors",children:[e.jsx(ua,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Profil"})]})}),e.jsx("li",{children:e.jsxs("button",{onClick:()=>{window.location.href="/student/settings",r(!1)},className:"w-full flex items-center gap-3 px-3 h-11 rounded-lg text-foreground/80 hover:text-foreground hover:bg-muted transition-colors",children:[e.jsx(ic,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Ustawienia"})]})}),e.jsx("li",{children:e.jsxs("button",{onClick:()=>{window.location.href="/student/help",r(!1)},className:"w-full flex items-center gap-3 px-3 h-11 rounded-lg text-foreground/80 hover:text-foreground hover:bg-muted transition-colors",children:[e.jsx(vt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Pomoc"})]})}),e.jsx("li",{children:e.jsxs("button",{onClick:()=>{o(),r(!1)},className:"w-full flex items-center gap-3 px-3 h-11 rounded-lg text-destructive hover:bg-destructive/10 transition-colors",children:[e.jsx($a,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Wyloguj"})]})})]})]})]})]})]})]})})},_S=({children:t})=>{const[s,n]=g.useState(!1),[i,r]=g.useState(()=>{const c=localStorage.getItem("theme");return c==="light"||c==="dark"?c:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}),{stats:a}=_n();g.useEffect(()=>{document.documentElement.classList.toggle("dark",i==="dark"),localStorage.setItem("theme",i)},[i]);const o=()=>{r(i==="dark"?"light":"dark")},l=()=>{n(!s)};return e.jsxs("div",{className:"min-h-screen bg-background relative overflow-x-hidden",children:[e.jsx(SS,{}),e.jsxs("div",{className:"flex relative",children:[s&&e.jsx("div",{className:"fixed inset-0 z-40 bg-black/30 dark:bg-black/50 backdrop-blur-sm lg:hidden",onClick:()=>n(!1)}),e.jsx("aside",{className:`
            h-screen w-80 transform transition-transform duration-300 ease-in-out
            fixed left-0 top-0 z-50
            ${s?"translate-x-0":"-translate-x-full"}
            lg:translate-x-0 lg:w-72
            bg-card/95 backdrop-blur-xl border-r
          `,children:e.jsx(Pu,{onClose:()=>n(!1)})}),e.jsxs("main",{className:"flex-1 lg:ml-72 min-w-0 relative z-10",children:[e.jsx("div",{className:"fixed top-0 left-72 right-0 z-30 hidden lg:block",children:e.jsx(CS,{stats:a,theme:i,onToggleTheme:o})}),e.jsxs("div",{className:"sticky top-0 z-30 flex h-16 items-center border-b bg-card/80 backdrop-blur supports-[backdrop-filter]:bg-card/60 px-4 lg:hidden",children:[e.jsx(I,{variant:"ghost",size:"sm",onClick:l,className:"mr-2",children:e.jsx(vr,{className:"h-6 w-6"})}),e.jsx("span",{className:"font-semibold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",children:"Smart Up"})]}),e.jsx("div",{className:"min-h-[calc(100vh-4rem)] pb-32 lg:pb-24 lg:pt-16",children:t})]})]}),e.jsx("nav",{"aria-label":"Nawigacja dolna",className:"fixed py-3.5 bottom-0 z-40 left-0 right-0 lg:left-72 bg-card/95 backdrop-blur-xl border-t",children:e.jsx(Pu,{variant:"bottom"})})]})},Ac=g.createContext({});function Dc(t){const s=g.useRef(null);return s.current===null&&(s.current=t()),s.current}const Pc=typeof window<"u",dx=Pc?g.useLayoutEffect:g.useEffect,no=g.createContext(null);function Mc(t,s){t.indexOf(s)===-1&&t.push(s)}function Rc(t,s){const n=t.indexOf(s);n>-1&&t.splice(n,1)}const zs=(t,s,n)=>n>s?s:n<t?t:n;let Ic=()=>{};const Ss={},ux=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t);function mx(t){return typeof t=="object"&&t!==null}const hx=t=>/^0[^.\s]+$/u.test(t);function Ec(t){let s;return()=>(s===void 0&&(s=t()),s)}const At=t=>t,TS=(t,s)=>n=>s(t(n)),Pr=(...t)=>t.reduce(TS),mr=(t,s,n)=>{const i=s-t;return i===0?1:(n-t)/i};class Lc{constructor(){this.subscriptions=[]}add(s){return Mc(this.subscriptions,s),()=>Rc(this.subscriptions,s)}notify(s,n,i){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](s,n,i);else for(let a=0;a<r;a++){const o=this.subscriptions[a];o&&o(s,n,i)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Xt=t=>t*1e3,Jt=t=>t/1e3;function fx(t,s){return s?t*(1e3/s):0}const px=(t,s,n)=>(((1-3*n+3*s)*t+(3*n-6*s))*t+3*s)*t,AS=1e-7,DS=12;function PS(t,s,n,i,r){let a,o,l=0;do o=s+(n-s)/2,a=px(o,i,r)-t,a>0?n=o:s=o;while(Math.abs(a)>AS&&++l<DS);return o}function Mr(t,s,n,i){if(t===s&&n===i)return At;const r=a=>PS(a,0,1,t,n);return a=>a===0||a===1?a:px(r(a),s,i)}const xx=t=>s=>s<=.5?t(2*s)/2:(2-t(2*(1-s)))/2,gx=t=>s=>1-t(1-s),jx=Mr(.33,1.53,.69,.99),Oc=gx(jx),yx=xx(Oc),bx=t=>(t*=2)<1?.5*Oc(t):.5*(2-Math.pow(2,-10*(t-1))),$c=t=>1-Math.sin(Math.acos(t)),wx=gx($c),vx=xx($c),MS=Mr(.42,0,1,1),RS=Mr(0,0,.58,1),Nx=Mr(.42,0,.58,1),IS=t=>Array.isArray(t)&&typeof t[0]!="number",kx=t=>Array.isArray(t)&&typeof t[0]=="number",ES={linear:At,easeIn:MS,easeInOut:Nx,easeOut:RS,circIn:$c,circInOut:vx,circOut:wx,backIn:Oc,backInOut:yx,backOut:jx,anticipate:bx},LS=t=>typeof t=="string",Mu=t=>{if(kx(t)){Ic(t.length===4);const[s,n,i,r]=t;return Mr(s,n,i,r)}else if(LS(t))return ES[t];return t},Kr=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function OS(t,s){let n=new Set,i=new Set,r=!1,a=!1;const o=new WeakSet;let l={delta:0,timestamp:0,isProcessing:!1};function c(m){o.has(m)&&(d.schedule(m),t()),m(l)}const d={schedule:(m,u=!1,h=!1)=>{const j=h&&r?n:i;return u&&o.add(m),j.has(m)||j.add(m),m},cancel:m=>{i.delete(m),o.delete(m)},process:m=>{if(l=m,r){a=!0;return}r=!0,[n,i]=[i,n],n.forEach(c),n.clear(),r=!1,a&&(a=!1,d.process(m))}};return d}const $S=40;function zx(t,s){let n=!1,i=!0;const r={delta:0,timestamp:0,isProcessing:!1},a=()=>n=!0,o=Kr.reduce((v,_)=>(v[_]=OS(a),v),{}),{setup:l,read:c,resolveKeyframes:d,preUpdate:m,update:u,preRender:h,render:p,postRender:j}=o,x=()=>{const v=Ss.useManualTiming?r.timestamp:performance.now();n=!1,Ss.useManualTiming||(r.delta=i?1e3/60:Math.max(Math.min(v-r.timestamp,$S),1)),r.timestamp=v,r.isProcessing=!0,l.process(r),c.process(r),d.process(r),m.process(r),u.process(r),h.process(r),p.process(r),j.process(r),r.isProcessing=!1,n&&s&&(i=!1,t(x))},b=()=>{n=!0,i=!0,r.isProcessing||t(x)};return{schedule:Kr.reduce((v,_)=>{const C=o[_];return v[_]=(k,N=!1,z=!1)=>(n||b(),C.schedule(k,N,z)),v},{}),cancel:v=>{for(let _=0;_<Kr.length;_++)o[Kr[_]].cancel(v)},state:r,steps:o}}const{schedule:xe,cancel:Ks,state:Ke,steps:Oo}=zx(typeof requestAnimationFrame<"u"?requestAnimationFrame:At,!0);let sa;function FS(){sa=void 0}const lt={now:()=>(sa===void 0&&lt.set(Ke.isProcessing||Ss.useManualTiming?Ke.timestamp:performance.now()),sa),set:t=>{sa=t,queueMicrotask(FS)}},Sx=t=>s=>typeof s=="string"&&s.startsWith(t),Fc=Sx("--"),BS=Sx("var(--"),Bc=t=>BS(t)?US.test(t.split("/*")[0].trim()):!1,US=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,yi={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},hr={...yi,transform:t=>zs(0,1,t)},Wr={...yi,default:1},Gi=t=>Math.round(t*1e5)/1e5,Uc=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function VS(t){return t==null}const qS=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Vc=(t,s)=>n=>!!(typeof n=="string"&&qS.test(n)&&n.startsWith(t)||s&&!VS(n)&&Object.prototype.hasOwnProperty.call(n,s)),Cx=(t,s,n)=>i=>{if(typeof i!="string")return i;const[r,a,o,l]=i.match(Uc);return{[t]:parseFloat(r),[s]:parseFloat(a),[n]:parseFloat(o),alpha:l!==void 0?parseFloat(l):1}},KS=t=>zs(0,255,t),$o={...yi,transform:t=>Math.round(KS(t))},rn={test:Vc("rgb","red"),parse:Cx("red","green","blue"),transform:({red:t,green:s,blue:n,alpha:i=1})=>"rgba("+$o.transform(t)+", "+$o.transform(s)+", "+$o.transform(n)+", "+Gi(hr.transform(i))+")"};function WS(t){let s="",n="",i="",r="";return t.length>5?(s=t.substring(1,3),n=t.substring(3,5),i=t.substring(5,7),r=t.substring(7,9)):(s=t.substring(1,2),n=t.substring(2,3),i=t.substring(3,4),r=t.substring(4,5),s+=s,n+=n,i+=i,r+=r),{red:parseInt(s,16),green:parseInt(n,16),blue:parseInt(i,16),alpha:r?parseInt(r,16)/255:1}}const vl={test:Vc("#"),parse:WS,transform:rn.transform},Rr=t=>({test:s=>typeof s=="string"&&s.endsWith(t)&&s.split(" ").length===1,parse:parseFloat,transform:s=>`${s}${t}`}),Rs=Rr("deg"),es=Rr("%"),X=Rr("px"),GS=Rr("vh"),HS=Rr("vw"),Ru={...es,parse:t=>es.parse(t)/100,transform:t=>es.transform(t*100)},Bn={test:Vc("hsl","hue"),parse:Cx("hue","saturation","lightness"),transform:({hue:t,saturation:s,lightness:n,alpha:i=1})=>"hsla("+Math.round(t)+", "+es.transform(Gi(s))+", "+es.transform(Gi(n))+", "+Gi(hr.transform(i))+")"},Pe={test:t=>rn.test(t)||vl.test(t)||Bn.test(t),parse:t=>rn.test(t)?rn.parse(t):Bn.test(t)?Bn.parse(t):vl.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?rn.transform(t):Bn.transform(t),getAnimatableNone:t=>{const s=Pe.parse(t);return s.alpha=0,Pe.transform(s)}},ZS=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function QS(t){return isNaN(t)&&typeof t=="string"&&(t.match(Uc)?.length||0)+(t.match(ZS)?.length||0)>0}const _x="number",Tx="color",YS="var",XS="var(",Iu="${}",JS=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function fr(t){const s=t.toString(),n=[],i={color:[],number:[],var:[]},r=[];let a=0;const l=s.replace(JS,c=>(Pe.test(c)?(i.color.push(a),r.push(Tx),n.push(Pe.parse(c))):c.startsWith(XS)?(i.var.push(a),r.push(YS),n.push(c)):(i.number.push(a),r.push(_x),n.push(parseFloat(c))),++a,Iu)).split(Iu);return{values:n,split:l,indexes:i,types:r}}function Ax(t){return fr(t).values}function Dx(t){const{split:s,types:n}=fr(t),i=s.length;return r=>{let a="";for(let o=0;o<i;o++)if(a+=s[o],r[o]!==void 0){const l=n[o];l===_x?a+=Gi(r[o]):l===Tx?a+=Pe.transform(r[o]):a+=r[o]}return a}}const e2=t=>typeof t=="number"?0:Pe.test(t)?Pe.getAnimatableNone(t):t;function t2(t){const s=Ax(t);return Dx(t)(s.map(e2))}const Ws={test:QS,parse:Ax,createTransformer:Dx,getAnimatableNone:t2};function Fo(t,s,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(s-t)*6*n:n<1/2?s:n<2/3?t+(s-t)*(2/3-n)*6:t}function s2({hue:t,saturation:s,lightness:n,alpha:i}){t/=360,s/=100,n/=100;let r=0,a=0,o=0;if(!s)r=a=o=n;else{const l=n<.5?n*(1+s):n+s-n*s,c=2*n-l;r=Fo(c,l,t+1/3),a=Fo(c,l,t),o=Fo(c,l,t-1/3)}return{red:Math.round(r*255),green:Math.round(a*255),blue:Math.round(o*255),alpha:i}}function va(t,s){return n=>n>0?s:t}const ye=(t,s,n)=>t+(s-t)*n,Bo=(t,s,n)=>{const i=t*t,r=n*(s*s-i)+i;return r<0?0:Math.sqrt(r)},n2=[vl,rn,Bn],i2=t=>n2.find(s=>s.test(t));function Eu(t){const s=i2(t);if(!s)return!1;let n=s.parse(t);return s===Bn&&(n=s2(n)),n}const Lu=(t,s)=>{const n=Eu(t),i=Eu(s);if(!n||!i)return va(t,s);const r={...n};return a=>(r.red=Bo(n.red,i.red,a),r.green=Bo(n.green,i.green,a),r.blue=Bo(n.blue,i.blue,a),r.alpha=ye(n.alpha,i.alpha,a),rn.transform(r))},Nl=new Set(["none","hidden"]);function r2(t,s){return Nl.has(t)?n=>n<=0?t:s:n=>n>=1?s:t}function a2(t,s){return n=>ye(t,s,n)}function qc(t){return typeof t=="number"?a2:typeof t=="string"?Bc(t)?va:Pe.test(t)?Lu:c2:Array.isArray(t)?Px:typeof t=="object"?Pe.test(t)?Lu:o2:va}function Px(t,s){const n=[...t],i=n.length,r=t.map((a,o)=>qc(a)(a,s[o]));return a=>{for(let o=0;o<i;o++)n[o]=r[o](a);return n}}function o2(t,s){const n={...t,...s},i={};for(const r in n)t[r]!==void 0&&s[r]!==void 0&&(i[r]=qc(t[r])(t[r],s[r]));return r=>{for(const a in i)n[a]=i[a](r);return n}}function l2(t,s){const n=[],i={color:0,var:0,number:0};for(let r=0;r<s.values.length;r++){const a=s.types[r],o=t.indexes[a][i[a]],l=t.values[o]??0;n[r]=l,i[a]++}return n}const c2=(t,s)=>{const n=Ws.createTransformer(s),i=fr(t),r=fr(s);return i.indexes.var.length===r.indexes.var.length&&i.indexes.color.length===r.indexes.color.length&&i.indexes.number.length>=r.indexes.number.length?Nl.has(t)&&!r.values.length||Nl.has(s)&&!i.values.length?r2(t,s):Pr(Px(l2(i,r),r.values),n):va(t,s)};function Mx(t,s,n){return typeof t=="number"&&typeof s=="number"&&typeof n=="number"?ye(t,s,n):qc(t)(t,s)}const d2=t=>{const s=({timestamp:n})=>t(n);return{start:(n=!0)=>xe.update(s,n),stop:()=>Ks(s),now:()=>Ke.isProcessing?Ke.timestamp:lt.now()}},Rx=(t,s,n=10)=>{let i="";const r=Math.max(Math.round(s/n),2);for(let a=0;a<r;a++)i+=Math.round(t(a/(r-1))*1e4)/1e4+", ";return`linear(${i.substring(0,i.length-2)})`},Na=2e4;function Kc(t){let s=0;const n=50;let i=t.next(s);for(;!i.done&&s<Na;)s+=n,i=t.next(s);return s>=Na?1/0:s}function u2(t,s=100,n){const i=n({...t,keyframes:[0,s]}),r=Math.min(Kc(i),Na);return{type:"keyframes",ease:a=>i.next(r*a).value/s,duration:Jt(r)}}const m2=5;function Ix(t,s,n){const i=Math.max(s-m2,0);return fx(n-t(i),s-i)}const ze={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Uo=.001;function h2({duration:t=ze.duration,bounce:s=ze.bounce,velocity:n=ze.velocity,mass:i=ze.mass}){let r,a,o=1-s;o=zs(ze.minDamping,ze.maxDamping,o),t=zs(ze.minDuration,ze.maxDuration,Jt(t)),o<1?(r=d=>{const m=d*o,u=m*t,h=m-n,p=kl(d,o),j=Math.exp(-u);return Uo-h/p*j},a=d=>{const u=d*o*t,h=u*n+n,p=Math.pow(o,2)*Math.pow(d,2)*t,j=Math.exp(-u),x=kl(Math.pow(d,2),o);return(-r(d)+Uo>0?-1:1)*((h-p)*j)/x}):(r=d=>{const m=Math.exp(-d*t),u=(d-n)*t+1;return-Uo+m*u},a=d=>{const m=Math.exp(-d*t),u=(n-d)*(t*t);return m*u});const l=5/t,c=p2(r,a,l);if(t=Xt(t),isNaN(c))return{stiffness:ze.stiffness,damping:ze.damping,duration:t};{const d=Math.pow(c,2)*i;return{stiffness:d,damping:o*2*Math.sqrt(i*d),duration:t}}}const f2=12;function p2(t,s,n){let i=n;for(let r=1;r<f2;r++)i=i-t(i)/s(i);return i}function kl(t,s){return t*Math.sqrt(1-s*s)}const x2=["duration","bounce"],g2=["stiffness","damping","mass"];function Ou(t,s){return s.some(n=>t[n]!==void 0)}function j2(t){let s={velocity:ze.velocity,stiffness:ze.stiffness,damping:ze.damping,mass:ze.mass,isResolvedFromDuration:!1,...t};if(!Ou(t,g2)&&Ou(t,x2))if(t.visualDuration){const n=t.visualDuration,i=2*Math.PI/(n*1.2),r=i*i,a=2*zs(.05,1,1-(t.bounce||0))*Math.sqrt(r);s={...s,mass:ze.mass,stiffness:r,damping:a}}else{const n=h2(t);s={...s,...n,mass:ze.mass},s.isResolvedFromDuration=!0}return s}function ka(t=ze.visualDuration,s=ze.bounce){const n=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:s}:t;let{restSpeed:i,restDelta:r}=n;const a=n.keyframes[0],o=n.keyframes[n.keyframes.length-1],l={done:!1,value:a},{stiffness:c,damping:d,mass:m,duration:u,velocity:h,isResolvedFromDuration:p}=j2({...n,velocity:-Jt(n.velocity||0)}),j=h||0,x=d/(2*Math.sqrt(c*m)),b=o-a,w=Jt(Math.sqrt(c/m)),y=Math.abs(b)<5;i||(i=y?ze.restSpeed.granular:ze.restSpeed.default),r||(r=y?ze.restDelta.granular:ze.restDelta.default);let v;if(x<1){const C=kl(w,x);v=k=>{const N=Math.exp(-x*w*k);return o-N*((j+x*w*b)/C*Math.sin(C*k)+b*Math.cos(C*k))}}else if(x===1)v=C=>o-Math.exp(-w*C)*(b+(j+w*b)*C);else{const C=w*Math.sqrt(x*x-1);v=k=>{const N=Math.exp(-x*w*k),z=Math.min(C*k,300);return o-N*((j+x*w*b)*Math.sinh(z)+C*b*Math.cosh(z))/C}}const _={calculatedDuration:p&&u||null,next:C=>{const k=v(C);if(p)l.done=C>=u;else{let N=C===0?j:0;x<1&&(N=C===0?Xt(j):Ix(v,C,k));const z=Math.abs(N)<=i,T=Math.abs(o-k)<=r;l.done=z&&T}return l.value=l.done?o:k,l},toString:()=>{const C=Math.min(Kc(_),Na),k=Rx(N=>_.next(C*N).value,C,30);return C+"ms "+k},toTransition:()=>{}};return _}ka.applyToOptions=t=>{const s=u2(t,100,ka);return t.ease=s.ease,t.duration=Xt(s.duration),t.type="keyframes",t};function zl({keyframes:t,velocity:s=0,power:n=.8,timeConstant:i=325,bounceDamping:r=10,bounceStiffness:a=500,modifyTarget:o,min:l,max:c,restDelta:d=.5,restSpeed:m}){const u=t[0],h={done:!1,value:u},p=z=>l!==void 0&&z<l||c!==void 0&&z>c,j=z=>l===void 0?c:c===void 0||Math.abs(l-z)<Math.abs(c-z)?l:c;let x=n*s;const b=u+x,w=o===void 0?b:o(b);w!==b&&(x=w-u);const y=z=>-x*Math.exp(-z/i),v=z=>w+y(z),_=z=>{const T=y(z),f=v(z);h.done=Math.abs(T)<=d,h.value=h.done?w:f};let C,k;const N=z=>{p(h.value)&&(C=z,k=ka({keyframes:[h.value,j(h.value)],velocity:Ix(v,z,h.value),damping:r,stiffness:a,restDelta:d,restSpeed:m}))};return N(0),{calculatedDuration:null,next:z=>{let T=!1;return!k&&C===void 0&&(T=!0,_(z),N(z)),C!==void 0&&z>=C?k.next(z-C):(!T&&_(z),h)}}}function y2(t,s,n){const i=[],r=n||Ss.mix||Mx,a=t.length-1;for(let o=0;o<a;o++){let l=r(t[o],t[o+1]);if(s){const c=Array.isArray(s)?s[o]||At:s;l=Pr(c,l)}i.push(l)}return i}function b2(t,s,{clamp:n=!0,ease:i,mixer:r}={}){const a=t.length;if(Ic(a===s.length),a===1)return()=>s[0];if(a===2&&s[0]===s[1])return()=>s[1];const o=t[0]===t[1];t[0]>t[a-1]&&(t=[...t].reverse(),s=[...s].reverse());const l=y2(s,i,r),c=l.length,d=m=>{if(o&&m<t[0])return s[0];let u=0;if(c>1)for(;u<t.length-2&&!(m<t[u+1]);u++);const h=mr(t[u],t[u+1],m);return l[u](h)};return n?m=>d(zs(t[0],t[a-1],m)):d}function w2(t,s){const n=t[t.length-1];for(let i=1;i<=s;i++){const r=mr(0,s,i);t.push(ye(n,1,r))}}function v2(t){const s=[0];return w2(s,t.length-1),s}function N2(t,s){return t.map(n=>n*s)}function k2(t,s){return t.map(()=>s||Nx).splice(0,t.length-1)}function Hi({duration:t=300,keyframes:s,times:n,ease:i="easeInOut"}){const r=IS(i)?i.map(Mu):Mu(i),a={done:!1,value:s[0]},o=N2(n&&n.length===s.length?n:v2(s),t),l=b2(o,s,{ease:Array.isArray(r)?r:k2(s,r)});return{calculatedDuration:t,next:c=>(a.value=l(c),a.done=c>=t,a)}}const z2=t=>t!==null;function Wc(t,{repeat:s,repeatType:n="loop"},i,r=1){const a=t.filter(z2),l=r<0||s&&n!=="loop"&&s%2===1?0:a.length-1;return!l||i===void 0?a[l]:i}const S2={decay:zl,inertia:zl,tween:Hi,keyframes:Hi,spring:ka};function Ex(t){typeof t.type=="string"&&(t.type=S2[t.type])}class Gc{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(s=>{this.resolve=s})}notifyFinished(){this.resolve()}then(s,n){return this.finished.then(s,n)}}const C2=t=>t/100;class Hc extends Gc{constructor(s){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:n}=this.options;n&&n.updatedAt!==lt.now()&&this.tick(lt.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=s,this.initAnimation(),this.play(),s.autoplay===!1&&this.pause()}initAnimation(){const{options:s}=this;Ex(s);const{type:n=Hi,repeat:i=0,repeatDelay:r=0,repeatType:a,velocity:o=0}=s;let{keyframes:l}=s;const c=n||Hi;c!==Hi&&typeof l[0]!="number"&&(this.mixKeyframes=Pr(C2,Mx(l[0],l[1])),l=[0,100]);const d=c({...s,keyframes:l});a==="mirror"&&(this.mirroredGenerator=c({...s,keyframes:[...l].reverse(),velocity:-o})),d.calculatedDuration===null&&(d.calculatedDuration=Kc(d));const{calculatedDuration:m}=d;this.calculatedDuration=m,this.resolvedDuration=m+r,this.totalDuration=this.resolvedDuration*(i+1)-r,this.generator=d}updateTime(s){const n=Math.round(s-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=n}tick(s,n=!1){const{generator:i,totalDuration:r,mixKeyframes:a,mirroredGenerator:o,resolvedDuration:l,calculatedDuration:c}=this;if(this.startTime===null)return i.next(0);const{delay:d=0,keyframes:m,repeat:u,repeatType:h,repeatDelay:p,type:j,onUpdate:x,finalKeyframe:b}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,s):this.speed<0&&(this.startTime=Math.min(s-r/this.speed,this.startTime)),n?this.currentTime=s:this.updateTime(s);const w=this.currentTime-d*(this.playbackSpeed>=0?1:-1),y=this.playbackSpeed>=0?w<0:w>r;this.currentTime=Math.max(w,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=r);let v=this.currentTime,_=i;if(u){const z=Math.min(this.currentTime,r)/l;let T=Math.floor(z),f=z%1;!f&&z>=1&&(f=1),f===1&&T--,T=Math.min(T,u+1),!!(T%2)&&(h==="reverse"?(f=1-f,p&&(f-=p/l)):h==="mirror"&&(_=o)),v=zs(0,1,f)*l}const C=y?{done:!1,value:m[0]}:_.next(v);a&&(C.value=a(C.value));let{done:k}=C;!y&&c!==null&&(k=this.playbackSpeed>=0?this.currentTime>=r:this.currentTime<=0);const N=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&k);return N&&j!==zl&&(C.value=Wc(m,this.options,b,this.speed)),x&&x(C.value),N&&this.finish(),C}then(s,n){return this.finished.then(s,n)}get duration(){return Jt(this.calculatedDuration)}get time(){return Jt(this.currentTime)}set time(s){s=Xt(s),this.currentTime=s,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=s:this.driver&&(this.startTime=this.driver.now()-s/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(s){this.updateTime(lt.now());const n=this.playbackSpeed!==s;this.playbackSpeed=s,n&&(this.time=Jt(this.currentTime))}play(){if(this.isStopped)return;const{driver:s=d2,startTime:n}=this.options;this.driver||(this.driver=s(r=>this.tick(r))),this.options.onPlay?.();const i=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=i):this.holdTime!==null?this.startTime=i-this.holdTime:this.startTime||(this.startTime=n??i),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(lt.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(s){return this.startTime=0,this.tick(s,!0)}attachTimeline(s){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),s.observe(this)}}function _2(t){for(let s=1;s<t.length;s++)t[s]??(t[s]=t[s-1])}const an=t=>t*180/Math.PI,Sl=t=>{const s=an(Math.atan2(t[1],t[0]));return Cl(s)},T2={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:t=>(Math.abs(t[0])+Math.abs(t[3]))/2,rotate:Sl,rotateZ:Sl,skewX:t=>an(Math.atan(t[1])),skewY:t=>an(Math.atan(t[2])),skew:t=>(Math.abs(t[1])+Math.abs(t[2]))/2},Cl=t=>(t=t%360,t<0&&(t+=360),t),$u=Sl,Fu=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),Bu=t=>Math.sqrt(t[4]*t[4]+t[5]*t[5]),A2={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:Fu,scaleY:Bu,scale:t=>(Fu(t)+Bu(t))/2,rotateX:t=>Cl(an(Math.atan2(t[6],t[5]))),rotateY:t=>Cl(an(Math.atan2(-t[2],t[0]))),rotateZ:$u,rotate:$u,skewX:t=>an(Math.atan(t[4])),skewY:t=>an(Math.atan(t[1])),skew:t=>(Math.abs(t[1])+Math.abs(t[4]))/2};function _l(t){return t.includes("scale")?1:0}function Tl(t,s){if(!t||t==="none")return _l(s);const n=t.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let i,r;if(n)i=A2,r=n;else{const l=t.match(/^matrix\(([-\d.e\s,]+)\)$/u);i=T2,r=l}if(!r)return _l(s);const a=i[s],o=r[1].split(",").map(P2);return typeof a=="function"?a(o):o[a]}const D2=(t,s)=>{const{transform:n="none"}=getComputedStyle(t);return Tl(n,s)};function P2(t){return parseFloat(t.trim())}const bi=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],wi=new Set(bi),Uu=t=>t===yi||t===X,M2=new Set(["x","y","z"]),R2=bi.filter(t=>!M2.has(t));function I2(t){const s=[];return R2.forEach(n=>{const i=t.getValue(n);i!==void 0&&(s.push([n,i.get()]),i.set(n.startsWith("scale")?1:0))}),s}const mn={width:({x:t},{paddingLeft:s="0",paddingRight:n="0"})=>t.max-t.min-parseFloat(s)-parseFloat(n),height:({y:t},{paddingTop:s="0",paddingBottom:n="0"})=>t.max-t.min-parseFloat(s)-parseFloat(n),top:(t,{top:s})=>parseFloat(s),left:(t,{left:s})=>parseFloat(s),bottom:({y:t},{top:s})=>parseFloat(s)+(t.max-t.min),right:({x:t},{left:s})=>parseFloat(s)+(t.max-t.min),x:(t,{transform:s})=>Tl(s,"x"),y:(t,{transform:s})=>Tl(s,"y")};mn.translateX=mn.x;mn.translateY=mn.y;const hn=new Set;let Al=!1,Dl=!1,Pl=!1;function Lx(){if(Dl){const t=Array.from(hn).filter(i=>i.needsMeasurement),s=new Set(t.map(i=>i.element)),n=new Map;s.forEach(i=>{const r=I2(i);r.length&&(n.set(i,r),i.render())}),t.forEach(i=>i.measureInitialState()),s.forEach(i=>{i.render();const r=n.get(i);r&&r.forEach(([a,o])=>{i.getValue(a)?.set(o)})}),t.forEach(i=>i.measureEndState()),t.forEach(i=>{i.suspendedScrollY!==void 0&&window.scrollTo(0,i.suspendedScrollY)})}Dl=!1,Al=!1,hn.forEach(t=>t.complete(Pl)),hn.clear()}function Ox(){hn.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(Dl=!0)})}function E2(){Pl=!0,Ox(),Lx(),Pl=!1}class Zc{constructor(s,n,i,r,a,o=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...s],this.onComplete=n,this.name=i,this.motionValue=r,this.element=a,this.isAsync=o}scheduleResolve(){this.state="scheduled",this.isAsync?(hn.add(this),Al||(Al=!0,xe.read(Ox),xe.resolveKeyframes(Lx))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:s,name:n,element:i,motionValue:r}=this;if(s[0]===null){const a=r?.get(),o=s[s.length-1];if(a!==void 0)s[0]=a;else if(i&&n){const l=i.readValue(n,o);l!=null&&(s[0]=l)}s[0]===void 0&&(s[0]=o),r&&a===void 0&&r.set(s[0])}_2(s)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(s=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,s),hn.delete(this)}cancel(){this.state==="scheduled"&&(hn.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const L2=t=>t.startsWith("--");function O2(t,s,n){L2(s)?t.style.setProperty(s,n):t.style[s]=n}const $2=Ec(()=>window.ScrollTimeline!==void 0),F2={};function B2(t,s){const n=Ec(t);return()=>F2[s]??n()}const $x=B2(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Bi=([t,s,n,i])=>`cubic-bezier(${t}, ${s}, ${n}, ${i})`,Vu={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Bi([0,.65,.55,1]),circOut:Bi([.55,0,1,.45]),backIn:Bi([.31,.01,.66,-.59]),backOut:Bi([.33,1.53,.69,.99])};function Fx(t,s){if(t)return typeof t=="function"?$x()?Rx(t,s):"ease-out":kx(t)?Bi(t):Array.isArray(t)?t.map(n=>Fx(n,s)||Vu.easeOut):Vu[t]}function U2(t,s,n,{delay:i=0,duration:r=300,repeat:a=0,repeatType:o="loop",ease:l="easeOut",times:c}={},d=void 0){const m={[s]:n};c&&(m.offset=c);const u=Fx(l,r);Array.isArray(u)&&(m.easing=u);const h={delay:i,duration:r,easing:Array.isArray(u)?"linear":u,fill:"both",iterations:a+1,direction:o==="reverse"?"alternate":"normal"};return d&&(h.pseudoElement=d),t.animate(m,h)}function Bx(t){return typeof t=="function"&&"applyToOptions"in t}function V2({type:t,...s}){return Bx(t)&&$x()?t.applyToOptions(s):(s.duration??(s.duration=300),s.ease??(s.ease="easeOut"),s)}class q2 extends Gc{constructor(s){if(super(),this.finishedTime=null,this.isStopped=!1,!s)return;const{element:n,name:i,keyframes:r,pseudoElement:a,allowFlatten:o=!1,finalKeyframe:l,onComplete:c}=s;this.isPseudoElement=!!a,this.allowFlatten=o,this.options=s,Ic(typeof s.type!="string");const d=V2(s);this.animation=U2(n,i,r,d,a),d.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!a){const m=Wc(r,this.options,l,this.speed);this.updateMotionValue?this.updateMotionValue(m):O2(n,i,m),this.animation.cancel()}c?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:s}=this;s==="idle"||s==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const s=this.animation.effect?.getComputedTiming?.().duration||0;return Jt(Number(s))}get time(){return Jt(Number(this.animation.currentTime)||0)}set time(s){this.finishedTime=null,this.animation.currentTime=Xt(s)}get speed(){return this.animation.playbackRate}set speed(s){s<0&&(this.finishedTime=null),this.animation.playbackRate=s}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(s){this.animation.startTime=s}attachTimeline({timeline:s,observe:n}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,s&&$2()?(this.animation.timeline=s,At):n(this)}}const Ux={anticipate:bx,backInOut:yx,circInOut:vx};function K2(t){return t in Ux}function W2(t){typeof t.ease=="string"&&K2(t.ease)&&(t.ease=Ux[t.ease])}const qu=10;class G2 extends q2{constructor(s){W2(s),Ex(s),super(s),s.startTime&&(this.startTime=s.startTime),this.options=s}updateMotionValue(s){const{motionValue:n,onUpdate:i,onComplete:r,element:a,...o}=this.options;if(!n)return;if(s!==void 0){n.set(s);return}const l=new Hc({...o,autoplay:!1}),c=Xt(this.finishedTime??this.time);n.setWithVelocity(l.sample(c-qu).value,l.sample(c).value,qu),l.stop()}}const Ku=(t,s)=>s==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(Ws.test(t)||t==="0")&&!t.startsWith("url("));function H2(t){const s=t[0];if(t.length===1)return!0;for(let n=0;n<t.length;n++)if(t[n]!==s)return!0}function Z2(t,s,n,i){const r=t[0];if(r===null)return!1;if(s==="display"||s==="visibility")return!0;const a=t[t.length-1],o=Ku(r,s),l=Ku(a,s);return!o||!l?!1:H2(t)||(n==="spring"||Bx(n))&&i}function Ml(t){t.duration=0,t.type}const Q2=new Set(["opacity","clipPath","filter","transform"]),Y2=Ec(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function X2(t){const{motionValue:s,name:n,repeatDelay:i,repeatType:r,damping:a,type:o}=t;if(!(s?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:c,transformTemplate:d}=s.owner.getProps();return Y2()&&n&&Q2.has(n)&&(n!=="transform"||!d)&&!c&&!i&&r!=="mirror"&&a!==0&&o!=="inertia"}const J2=40;class eC extends Gc{constructor({autoplay:s=!0,delay:n=0,type:i="keyframes",repeat:r=0,repeatDelay:a=0,repeatType:o="loop",keyframes:l,name:c,motionValue:d,element:m,...u}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=lt.now();const h={autoplay:s,delay:n,type:i,repeat:r,repeatDelay:a,repeatType:o,name:c,motionValue:d,element:m,...u},p=m?.KeyframeResolver||Zc;this.keyframeResolver=new p(l,(j,x,b)=>this.onKeyframesResolved(j,x,h,!b),c,d,m),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(s,n,i,r){this.keyframeResolver=void 0;const{name:a,type:o,velocity:l,delay:c,isHandoff:d,onUpdate:m}=i;this.resolvedAt=lt.now(),Z2(s,a,o,l)||((Ss.instantAnimations||!c)&&m?.(Wc(s,i,n)),s[0]=s[s.length-1],Ml(i),i.repeat=0);const h={startTime:r?this.resolvedAt?this.resolvedAt-this.createdAt>J2?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:n,...i,keyframes:s},p=!d&&X2(h)?new G2({...h,element:h.motionValue.owner.current}):new Hc(h);p.finished.then(()=>this.notifyFinished()).catch(At),this.pendingTimeline&&(this.stopTimeline=p.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=p}get finished(){return this._animation?this.animation.finished:this._finished}then(s,n){return this.finished.finally(s).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),E2()),this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(s){this.animation.time=s}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(s){this.animation.speed=s}get startTime(){return this.animation.startTime}attachTimeline(s){return this._animation?this.stopTimeline=this.animation.attachTimeline(s):this.pendingTimeline=s,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const tC=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function sC(t){const s=tC.exec(t);if(!s)return[,];const[,n,i,r]=s;return[`--${n??i}`,r]}function Vx(t,s,n=1){const[i,r]=sC(t);if(!i)return;const a=window.getComputedStyle(s).getPropertyValue(i);if(a){const o=a.trim();return ux(o)?parseFloat(o):o}return Bc(r)?Vx(r,s,n+1):r}function Qc(t,s){return t?.[s]??t?.default??t}const qx=new Set(["width","height","top","left","right","bottom",...bi]),nC={test:t=>t==="auto",parse:t=>t},Kx=t=>s=>s.test(t),Wx=[yi,X,es,Rs,HS,GS,nC],Wu=t=>Wx.find(Kx(t));function iC(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||hx(t):!0}const rC=new Set(["brightness","contrast","saturate","opacity"]);function aC(t){const[s,n]=t.slice(0,-1).split("(");if(s==="drop-shadow")return t;const[i]=n.match(Uc)||[];if(!i)return t;const r=n.replace(i,"");let a=rC.has(s)?1:0;return i!==n&&(a*=100),s+"("+a+r+")"}const oC=/\b([a-z-]*)\(.*?\)/gu,Rl={...Ws,getAnimatableNone:t=>{const s=t.match(oC);return s?s.map(aC).join(" "):t}},Gu={...yi,transform:Math.round},lC={rotate:Rs,rotateX:Rs,rotateY:Rs,rotateZ:Rs,scale:Wr,scaleX:Wr,scaleY:Wr,scaleZ:Wr,skew:Rs,skewX:Rs,skewY:Rs,distance:X,translateX:X,translateY:X,translateZ:X,x:X,y:X,z:X,perspective:X,transformPerspective:X,opacity:hr,originX:Ru,originY:Ru,originZ:X},Yc={borderWidth:X,borderTopWidth:X,borderRightWidth:X,borderBottomWidth:X,borderLeftWidth:X,borderRadius:X,radius:X,borderTopLeftRadius:X,borderTopRightRadius:X,borderBottomRightRadius:X,borderBottomLeftRadius:X,width:X,maxWidth:X,height:X,maxHeight:X,top:X,right:X,bottom:X,left:X,padding:X,paddingTop:X,paddingRight:X,paddingBottom:X,paddingLeft:X,margin:X,marginTop:X,marginRight:X,marginBottom:X,marginLeft:X,backgroundPositionX:X,backgroundPositionY:X,...lC,zIndex:Gu,fillOpacity:hr,strokeOpacity:hr,numOctaves:Gu},cC={...Yc,color:Pe,backgroundColor:Pe,outlineColor:Pe,fill:Pe,stroke:Pe,borderColor:Pe,borderTopColor:Pe,borderRightColor:Pe,borderBottomColor:Pe,borderLeftColor:Pe,filter:Rl,WebkitFilter:Rl},Gx=t=>cC[t];function Hx(t,s){let n=Gx(t);return n!==Rl&&(n=Ws),n.getAnimatableNone?n.getAnimatableNone(s):void 0}const dC=new Set(["auto","none","0"]);function uC(t,s,n){let i=0,r;for(;i<t.length&&!r;){const a=t[i];typeof a=="string"&&!dC.has(a)&&fr(a).values.length&&(r=t[i]),i++}if(r&&n)for(const a of s)t[a]=Hx(n,r)}class mC extends Zc{constructor(s,n,i,r,a){super(s,n,i,r,a,!0)}readKeyframes(){const{unresolvedKeyframes:s,element:n,name:i}=this;if(!n||!n.current)return;super.readKeyframes();for(let c=0;c<s.length;c++){let d=s[c];if(typeof d=="string"&&(d=d.trim(),Bc(d))){const m=Vx(d,n.current);m!==void 0&&(s[c]=m),c===s.length-1&&(this.finalKeyframe=d)}}if(this.resolveNoneKeyframes(),!qx.has(i)||s.length!==2)return;const[r,a]=s,o=Wu(r),l=Wu(a);if(o!==l)if(Uu(o)&&Uu(l))for(let c=0;c<s.length;c++){const d=s[c];typeof d=="string"&&(s[c]=parseFloat(d))}else mn[i]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:s,name:n}=this,i=[];for(let r=0;r<s.length;r++)(s[r]===null||iC(s[r]))&&i.push(r);i.length&&uC(s,i,n)}measureInitialState(){const{element:s,unresolvedKeyframes:n,name:i}=this;if(!s||!s.current)return;i==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=mn[i](s.measureViewportBox(),window.getComputedStyle(s.current)),n[0]=this.measuredOrigin;const r=n[n.length-1];r!==void 0&&s.getValue(i,r).jump(r,!1)}measureEndState(){const{element:s,name:n,unresolvedKeyframes:i}=this;if(!s||!s.current)return;const r=s.getValue(n);r&&r.jump(this.measuredOrigin,!1);const a=i.length-1,o=i[a];i[a]=mn[n](s.measureViewportBox(),window.getComputedStyle(s.current)),o!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=o),this.removedTransforms?.length&&this.removedTransforms.forEach(([l,c])=>{s.getValue(l).set(c)}),this.resolveNoneKeyframes()}}function hC(t,s,n){if(t instanceof EventTarget)return[t];if(typeof t=="string"){let i=document;const r=n?.[t]??i.querySelectorAll(t);return r?Array.from(r):[]}return Array.from(t)}const Zx=(t,s)=>s&&typeof t=="number"?s.transform(t):t;function Qx(t){return mx(t)&&"offsetHeight"in t}const Hu=30,fC=t=>!isNaN(parseFloat(t));class pC{constructor(s,n={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=i=>{const r=lt.now();if(this.updatedAt!==r&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(i),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const a of this.dependents)a.dirty()},this.hasAnimated=!1,this.setCurrent(s),this.owner=n.owner}setCurrent(s){this.current=s,this.updatedAt=lt.now(),this.canTrackVelocity===null&&s!==void 0&&(this.canTrackVelocity=fC(this.current))}setPrevFrameValue(s=this.current){this.prevFrameValue=s,this.prevUpdatedAt=this.updatedAt}onChange(s){return this.on("change",s)}on(s,n){this.events[s]||(this.events[s]=new Lc);const i=this.events[s].add(n);return s==="change"?()=>{i(),xe.read(()=>{this.events.change.getSize()||this.stop()})}:i}clearListeners(){for(const s in this.events)this.events[s].clear()}attach(s,n){this.passiveEffect=s,this.stopPassiveEffect=n}set(s){this.passiveEffect?this.passiveEffect(s,this.updateAndNotify):this.updateAndNotify(s)}setWithVelocity(s,n,i){this.set(n),this.prev=void 0,this.prevFrameValue=s,this.prevUpdatedAt=this.updatedAt-i}jump(s,n=!0){this.updateAndNotify(s),this.prev=s,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(s){this.dependents||(this.dependents=new Set),this.dependents.add(s)}removeDependent(s){this.dependents&&this.dependents.delete(s)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const s=lt.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||s-this.updatedAt>Hu)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,Hu);return fx(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(s){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=s(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function ci(t,s){return new pC(t,s)}const{schedule:Xc}=zx(queueMicrotask,!1),Ot={x:!1,y:!1};function Yx(){return Ot.x||Ot.y}function xC(t){return t==="x"||t==="y"?Ot[t]?null:(Ot[t]=!0,()=>{Ot[t]=!1}):Ot.x||Ot.y?null:(Ot.x=Ot.y=!0,()=>{Ot.x=Ot.y=!1})}function Xx(t,s){const n=hC(t),i=new AbortController,r={passive:!0,...s,signal:i.signal};return[n,r,()=>i.abort()]}function Zu(t){return!(t.pointerType==="touch"||Yx())}function gC(t,s,n={}){const[i,r,a]=Xx(t,n),o=l=>{if(!Zu(l))return;const{target:c}=l,d=s(c,l);if(typeof d!="function"||!c)return;const m=u=>{Zu(u)&&(d(u),c.removeEventListener("pointerleave",m))};c.addEventListener("pointerleave",m,r)};return i.forEach(l=>{l.addEventListener("pointerenter",o,r)}),a}const Jx=(t,s)=>s?t===s?!0:Jx(t,s.parentElement):!1,Jc=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,jC=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function yC(t){return jC.has(t.tagName)||t.tabIndex!==-1}const na=new WeakSet;function Qu(t){return s=>{s.key==="Enter"&&t(s)}}function Vo(t,s){t.dispatchEvent(new PointerEvent("pointer"+s,{isPrimary:!0,bubbles:!0}))}const bC=(t,s)=>{const n=t.currentTarget;if(!n)return;const i=Qu(()=>{if(na.has(n))return;Vo(n,"down");const r=Qu(()=>{Vo(n,"up")}),a=()=>Vo(n,"cancel");n.addEventListener("keyup",r,s),n.addEventListener("blur",a,s)});n.addEventListener("keydown",i,s),n.addEventListener("blur",()=>n.removeEventListener("keydown",i),s)};function Yu(t){return Jc(t)&&!Yx()}function wC(t,s,n={}){const[i,r,a]=Xx(t,n),o=l=>{const c=l.currentTarget;if(!Yu(l))return;na.add(c);const d=s(c,l),m=(p,j)=>{window.removeEventListener("pointerup",u),window.removeEventListener("pointercancel",h),na.has(c)&&na.delete(c),Yu(p)&&typeof d=="function"&&d(p,{success:j})},u=p=>{m(p,c===window||c===document||n.useGlobalTarget||Jx(c,p.target))},h=p=>{m(p,!1)};window.addEventListener("pointerup",u,r),window.addEventListener("pointercancel",h,r)};return i.forEach(l=>{(n.useGlobalTarget?window:l).addEventListener("pointerdown",o,r),Qx(l)&&(l.addEventListener("focus",d=>bC(d,r)),!yC(l)&&!l.hasAttribute("tabindex")&&(l.tabIndex=0))}),a}function eg(t){return mx(t)&&"ownerSVGElement"in t}function vC(t){return eg(t)&&t.tagName==="svg"}const Ze=t=>!!(t&&t.getVelocity),NC=[...Wx,Pe,Ws],kC=t=>NC.find(Kx(t)),ed=g.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});class zC extends g.Component{getSnapshotBeforeUpdate(s){const n=this.props.childRef.current;if(n&&s.isPresent&&!this.props.isPresent){const i=n.offsetParent,r=Qx(i)&&i.offsetWidth||0,a=this.props.sizeRef.current;a.height=n.offsetHeight||0,a.width=n.offsetWidth||0,a.top=n.offsetTop,a.left=n.offsetLeft,a.right=r-a.width-a.left}return null}componentDidUpdate(){}render(){return this.props.children}}function SC({children:t,isPresent:s,anchorX:n,root:i}){const r=g.useId(),a=g.useRef(null),o=g.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:l}=g.useContext(ed);return g.useInsertionEffect(()=>{const{width:c,height:d,top:m,left:u,right:h}=o.current;if(s||!a.current||!c||!d)return;const p=n==="left"?`left: ${u}`:`right: ${h}`;a.current.dataset.motionPopId=r;const j=document.createElement("style");l&&(j.nonce=l);const x=i??document.head;return x.appendChild(j),j.sheet&&j.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${c}px !important;
            height: ${d}px !important;
            ${p}px !important;
            top: ${m}px !important;
          }
        `),()=>{x.contains(j)&&x.removeChild(j)}},[s]),e.jsx(zC,{isPresent:s,childRef:a,sizeRef:o,children:g.cloneElement(t,{ref:a})})}const CC=({children:t,initial:s,isPresent:n,onExitComplete:i,custom:r,presenceAffectsLayout:a,mode:o,anchorX:l,root:c})=>{const d=Dc(_C),m=g.useId();let u=!0,h=g.useMemo(()=>(u=!1,{id:m,initial:s,isPresent:n,custom:r,onExitComplete:p=>{d.set(p,!0);for(const j of d.values())if(!j)return;i&&i()},register:p=>(d.set(p,!1),()=>d.delete(p))}),[n,d,i]);return a&&u&&(h={...h}),g.useMemo(()=>{d.forEach((p,j)=>d.set(j,!1))},[n]),g.useEffect(()=>{!n&&!d.size&&i&&i()},[n]),o==="popLayout"&&(t=e.jsx(SC,{isPresent:n,anchorX:l,root:c,children:t})),e.jsx(no.Provider,{value:h,children:t})};function _C(){return new Map}function tg(t=!0){const s=g.useContext(no);if(s===null)return[!0,null];const{isPresent:n,onExitComplete:i,register:r}=s,a=g.useId();g.useEffect(()=>{if(t)return r(a)},[t]);const o=g.useCallback(()=>t&&i&&i(a),[a,i,t]);return!n&&i?[!1,o]:[!0]}const Gr=t=>t.key||"";function Xu(t){const s=[];return g.Children.forEach(t,n=>{g.isValidElement(n)&&s.push(n)}),s}const TC=({children:t,custom:s,initial:n=!0,onExitComplete:i,presenceAffectsLayout:r=!0,mode:a="sync",propagate:o=!1,anchorX:l="left",root:c})=>{const[d,m]=tg(o),u=g.useMemo(()=>Xu(t),[t]),h=o&&!d?[]:u.map(Gr),p=g.useRef(!0),j=g.useRef(u),x=Dc(()=>new Map),[b,w]=g.useState(u),[y,v]=g.useState(u);dx(()=>{p.current=!1,j.current=u;for(let k=0;k<y.length;k++){const N=Gr(y[k]);h.includes(N)?x.delete(N):x.get(N)!==!0&&x.set(N,!1)}},[y,h.length,h.join("-")]);const _=[];if(u!==b){let k=[...u];for(let N=0;N<y.length;N++){const z=y[N],T=Gr(z);h.includes(T)||(k.splice(N,0,z),_.push(z))}return a==="wait"&&_.length&&(k=_),v(Xu(k)),w(u),null}const{forceRender:C}=g.useContext(Ac);return e.jsx(e.Fragment,{children:y.map(k=>{const N=Gr(k),z=o&&!d?!1:u===y||h.includes(N),T=()=>{if(x.has(N))x.set(N,!0);else return;let f=!0;x.forEach(S=>{S||(f=!1)}),f&&(C?.(),v(j.current),o&&m?.(),i&&i())};return e.jsx(CC,{isPresent:z,initial:!p.current||n?void 0:!1,custom:s,presenceAffectsLayout:r,mode:a,root:c,onExitComplete:z?void 0:T,anchorX:l,children:k},N)})})},sg=g.createContext({strict:!1}),Ju={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},di={};for(const t in Ju)di[t]={isEnabled:s=>Ju[t].some(n=>!!s[n])};function AC(t){for(const s in t)di[s]={...di[s],...t[s]}}const DC=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function za(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||DC.has(t)}let ng=t=>!za(t);function PC(t){typeof t=="function"&&(ng=s=>s.startsWith("on")?!za(s):t(s))}try{PC(require("@emotion/is-prop-valid").default)}catch{}function MC(t,s,n){const i={};for(const r in t)r==="values"&&typeof t.values=="object"||(ng(r)||n===!0&&za(r)||!s&&!za(r)||t.draggable&&r.startsWith("onDrag"))&&(i[r]=t[r]);return i}const io=g.createContext({});function ro(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}function pr(t){return typeof t=="string"||Array.isArray(t)}const td=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],sd=["initial",...td];function ao(t){return ro(t.animate)||sd.some(s=>pr(t[s]))}function ig(t){return!!(ao(t)||t.variants)}function RC(t,s){if(ao(t)){const{initial:n,animate:i}=t;return{initial:n===!1||pr(n)?n:void 0,animate:pr(i)?i:void 0}}return t.inherit!==!1?s:{}}function IC(t){const{initial:s,animate:n}=RC(t,g.useContext(io));return g.useMemo(()=>({initial:s,animate:n}),[em(s),em(n)])}function em(t){return Array.isArray(t)?t.join(" "):t}const xr={};function EC(t){for(const s in t)xr[s]=t[s],Fc(s)&&(xr[s].isCSSVariable=!0)}function rg(t,{layout:s,layoutId:n}){return wi.has(t)||t.startsWith("origin")||(s||n!==void 0)&&(!!xr[t]||t==="opacity")}const LC={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},OC=bi.length;function $C(t,s,n){let i="",r=!0;for(let a=0;a<OC;a++){const o=bi[a],l=t[o];if(l===void 0)continue;let c=!0;if(typeof l=="number"?c=l===(o.startsWith("scale")?1:0):c=parseFloat(l)===0,!c||n){const d=Zx(l,Yc[o]);if(!c){r=!1;const m=LC[o]||o;i+=`${m}(${d}) `}n&&(s[o]=d)}}return i=i.trim(),n?i=n(s,r?"":i):r&&(i="none"),i}function nd(t,s,n){const{style:i,vars:r,transformOrigin:a}=t;let o=!1,l=!1;for(const c in s){const d=s[c];if(wi.has(c)){o=!0;continue}else if(Fc(c)){r[c]=d;continue}else{const m=Zx(d,Yc[c]);c.startsWith("origin")?(l=!0,a[c]=m):i[c]=m}}if(s.transform||(o||n?i.transform=$C(s,t.transform,n):i.transform&&(i.transform="none")),l){const{originX:c="50%",originY:d="50%",originZ:m=0}=a;i.transformOrigin=`${c} ${d} ${m}`}}const id=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function ag(t,s,n){for(const i in s)!Ze(s[i])&&!rg(i,n)&&(t[i]=s[i])}function FC({transformTemplate:t},s){return g.useMemo(()=>{const n=id();return nd(n,s,t),Object.assign({},n.vars,n.style)},[s])}function BC(t,s){const n=t.style||{},i={};return ag(i,n,t),Object.assign(i,FC(t,s)),i}function UC(t,s){const n={},i=BC(t,s);return t.drag&&t.dragListener!==!1&&(n.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(n.tabIndex=0),n.style=i,n}const VC={offset:"stroke-dashoffset",array:"stroke-dasharray"},qC={offset:"strokeDashoffset",array:"strokeDasharray"};function KC(t,s,n=1,i=0,r=!0){t.pathLength=1;const a=r?VC:qC;t[a.offset]=X.transform(-i);const o=X.transform(s),l=X.transform(n);t[a.array]=`${o} ${l}`}function og(t,{attrX:s,attrY:n,attrScale:i,pathLength:r,pathSpacing:a=1,pathOffset:o=0,...l},c,d,m){if(nd(t,l,d),c){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:u,style:h}=t;u.transform&&(h.transform=u.transform,delete u.transform),(h.transform||u.transformOrigin)&&(h.transformOrigin=u.transformOrigin??"50% 50%",delete u.transformOrigin),h.transform&&(h.transformBox=m?.transformBox??"fill-box",delete u.transformBox),s!==void 0&&(u.x=s),n!==void 0&&(u.y=n),i!==void 0&&(u.scale=i),r!==void 0&&KC(u,r,a,o,!1)}const lg=()=>({...id(),attrs:{}}),cg=t=>typeof t=="string"&&t.toLowerCase()==="svg";function WC(t,s,n,i){const r=g.useMemo(()=>{const a=lg();return og(a,s,cg(i),t.transformTemplate,t.style),{...a.attrs,style:{...a.style}}},[s]);if(t.style){const a={};ag(a,t.style,t),r.style={...a,...r.style}}return r}const GC=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function rd(t){return typeof t!="string"||t.includes("-")?!1:!!(GC.indexOf(t)>-1||/[A-Z]/u.test(t))}function HC(t,s,n,{latestValues:i},r,a=!1){const l=(rd(t)?WC:UC)(s,i,r,t),c=MC(s,typeof t=="string",a),d=t!==g.Fragment?{...c,...l,ref:n}:{},{children:m}=s,u=g.useMemo(()=>Ze(m)?m.get():m,[m]);return g.createElement(t,{...d,children:u})}function tm(t){const s=[{},{}];return t?.values.forEach((n,i)=>{s[0][i]=n.get(),s[1][i]=n.getVelocity()}),s}function ad(t,s,n,i){if(typeof s=="function"){const[r,a]=tm(i);s=s(n!==void 0?n:t.custom,r,a)}if(typeof s=="string"&&(s=t.variants&&t.variants[s]),typeof s=="function"){const[r,a]=tm(i);s=s(n!==void 0?n:t.custom,r,a)}return s}function ia(t){return Ze(t)?t.get():t}function ZC({scrapeMotionValuesFromProps:t,createRenderState:s},n,i,r){return{latestValues:QC(n,i,r,t),renderState:s()}}function QC(t,s,n,i){const r={},a=i(t,{});for(const h in a)r[h]=ia(a[h]);let{initial:o,animate:l}=t;const c=ao(t),d=ig(t);s&&d&&!c&&t.inherit!==!1&&(o===void 0&&(o=s.initial),l===void 0&&(l=s.animate));let m=n?n.initial===!1:!1;m=m||o===!1;const u=m?l:o;if(u&&typeof u!="boolean"&&!ro(u)){const h=Array.isArray(u)?u:[u];for(let p=0;p<h.length;p++){const j=ad(t,h[p]);if(j){const{transitionEnd:x,transition:b,...w}=j;for(const y in w){let v=w[y];if(Array.isArray(v)){const _=m?v.length-1:0;v=v[_]}v!==null&&(r[y]=v)}for(const y in x)r[y]=x[y]}}}return r}const dg=t=>(s,n)=>{const i=g.useContext(io),r=g.useContext(no),a=()=>ZC(t,s,i,r);return n?a():Dc(a)};function od(t,s,n){const{style:i}=t,r={};for(const a in i)(Ze(i[a])||s.style&&Ze(s.style[a])||rg(a,t)||n?.getValue(a)?.liveStyle!==void 0)&&(r[a]=i[a]);return r}const YC=dg({scrapeMotionValuesFromProps:od,createRenderState:id});function ug(t,s,n){const i=od(t,s,n);for(const r in t)if(Ze(t[r])||Ze(s[r])){const a=bi.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;i[a]=t[r]}return i}const XC=dg({scrapeMotionValuesFromProps:ug,createRenderState:lg}),JC=Symbol.for("motionComponentSymbol");function Un(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function e_(t,s,n){return g.useCallback(i=>{i&&t.onMount&&t.onMount(i),s&&(i?s.mount(i):s.unmount()),n&&(typeof n=="function"?n(i):Un(n)&&(n.current=i))},[s])}const ld=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),t_="framerAppearId",mg="data-"+ld(t_),hg=g.createContext({});function s_(t,s,n,i,r){const{visualElement:a}=g.useContext(io),o=g.useContext(sg),l=g.useContext(no),c=g.useContext(ed).reducedMotion,d=g.useRef(null);i=i||o.renderer,!d.current&&i&&(d.current=i(t,{visualState:s,parent:a,props:n,presenceContext:l,blockInitialAnimation:l?l.initial===!1:!1,reducedMotionConfig:c}));const m=d.current,u=g.useContext(hg);m&&!m.projection&&r&&(m.type==="html"||m.type==="svg")&&n_(d.current,n,r,u);const h=g.useRef(!1);g.useInsertionEffect(()=>{m&&h.current&&m.update(n,l)});const p=n[mg],j=g.useRef(!!p&&!window.MotionHandoffIsComplete?.(p)&&window.MotionHasOptimisedAnimation?.(p));return dx(()=>{m&&(h.current=!0,window.MotionIsMounted=!0,m.updateFeatures(),m.scheduleRenderMicrotask(),j.current&&m.animationState&&m.animationState.animateChanges())}),g.useEffect(()=>{m&&(!j.current&&m.animationState&&m.animationState.animateChanges(),j.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(p)}),j.current=!1),m.enteringChildren=void 0)}),m}function n_(t,s,n,i){const{layoutId:r,layout:a,drag:o,dragConstraints:l,layoutScroll:c,layoutRoot:d,layoutCrossfade:m}=s;t.projection=new n(t.latestValues,s["data-framer-portal-id"]?void 0:fg(t.parent)),t.projection.setOptions({layoutId:r,layout:a,alwaysMeasureLayout:!!o||l&&Un(l),visualElement:t,animationType:typeof a=="string"?a:"both",initialPromotionConfig:i,crossfade:m,layoutScroll:c,layoutRoot:d})}function fg(t){if(t)return t.options.allowProjection!==!1?t.projection:fg(t.parent)}function qo(t,{forwardMotionProps:s=!1}={},n,i){n&&AC(n);const r=rd(t)?XC:YC;function a(l,c){let d;const m={...g.useContext(ed),...l,layoutId:i_(l)},{isStatic:u}=m,h=IC(l),p=r(l,u);if(!u&&Pc){r_();const j=a_(m);d=j.MeasureLayout,h.visualElement=s_(t,p,m,i,j.ProjectionNode)}return e.jsxs(io.Provider,{value:h,children:[d&&h.visualElement?e.jsx(d,{visualElement:h.visualElement,...m}):null,HC(t,l,e_(p,h.visualElement,c),p,u,s)]})}a.displayName=`motion.${typeof t=="string"?t:`create(${t.displayName??t.name??""})`}`;const o=g.forwardRef(a);return o[JC]=t,o}function i_({layoutId:t}){const s=g.useContext(Ac).id;return s&&t!==void 0?s+"-"+t:t}function r_(t,s){g.useContext(sg).strict}function a_(t){const{drag:s,layout:n}=di;if(!s&&!n)return{};const i={...s,...n};return{MeasureLayout:s?.isEnabled(t)||n?.isEnabled(t)?i.MeasureLayout:void 0,ProjectionNode:i.ProjectionNode}}function o_(t,s){if(typeof Proxy>"u")return qo;const n=new Map,i=(a,o)=>qo(a,o,t,s),r=(a,o)=>i(a,o);return new Proxy(r,{get:(a,o)=>o==="create"?i:(n.has(o)||n.set(o,qo(o,void 0,t,s)),n.get(o))})}function pg({top:t,left:s,right:n,bottom:i}){return{x:{min:s,max:n},y:{min:t,max:i}}}function l_({x:t,y:s}){return{top:s.min,right:t.max,bottom:s.max,left:t.min}}function c_(t,s){if(!s)return t;const n=s({x:t.left,y:t.top}),i=s({x:t.right,y:t.bottom});return{top:n.y,left:n.x,bottom:i.y,right:i.x}}function Ko(t){return t===void 0||t===1}function Il({scale:t,scaleX:s,scaleY:n}){return!Ko(t)||!Ko(s)||!Ko(n)}function sn(t){return Il(t)||xg(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function xg(t){return sm(t.x)||sm(t.y)}function sm(t){return t&&t!=="0%"}function Sa(t,s,n){const i=t-n,r=s*i;return n+r}function nm(t,s,n,i,r){return r!==void 0&&(t=Sa(t,r,i)),Sa(t,n,i)+s}function El(t,s=0,n=1,i,r){t.min=nm(t.min,s,n,i,r),t.max=nm(t.max,s,n,i,r)}function gg(t,{x:s,y:n}){El(t.x,s.translate,s.scale,s.originPoint),El(t.y,n.translate,n.scale,n.originPoint)}const im=.999999999999,rm=1.0000000000001;function d_(t,s,n,i=!1){const r=n.length;if(!r)return;s.x=s.y=1;let a,o;for(let l=0;l<r;l++){a=n[l],o=a.projectionDelta;const{visualElement:c}=a.options;c&&c.props.style&&c.props.style.display==="contents"||(i&&a.options.layoutScroll&&a.scroll&&a!==a.root&&qn(t,{x:-a.scroll.offset.x,y:-a.scroll.offset.y}),o&&(s.x*=o.x.scale,s.y*=o.y.scale,gg(t,o)),i&&sn(a.latestValues)&&qn(t,a.latestValues))}s.x<rm&&s.x>im&&(s.x=1),s.y<rm&&s.y>im&&(s.y=1)}function Vn(t,s){t.min=t.min+s,t.max=t.max+s}function am(t,s,n,i,r=.5){const a=ye(t.min,t.max,r);El(t,s,n,a,i)}function qn(t,s){am(t.x,s.x,s.scaleX,s.scale,s.originX),am(t.y,s.y,s.scaleY,s.scale,s.originY)}function jg(t,s){return pg(c_(t.getBoundingClientRect(),s))}function u_(t,s,n){const i=jg(t,n),{scroll:r}=s;return r&&(Vn(i.x,r.offset.x),Vn(i.y,r.offset.y)),i}const om=()=>({translate:0,scale:1,origin:0,originPoint:0}),Kn=()=>({x:om(),y:om()}),lm=()=>({min:0,max:0}),Te=()=>({x:lm(),y:lm()}),Ll={current:null},yg={current:!1};function m_(){if(yg.current=!0,!!Pc)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),s=()=>Ll.current=t.matches;t.addEventListener("change",s),s()}else Ll.current=!1}const h_=new WeakMap;function f_(t,s,n){for(const i in s){const r=s[i],a=n[i];if(Ze(r))t.addValue(i,r);else if(Ze(a))t.addValue(i,ci(r,{owner:t}));else if(a!==r)if(t.hasValue(i)){const o=t.getValue(i);o.liveStyle===!0?o.jump(r):o.hasAnimated||o.set(r)}else{const o=t.getStaticValue(i);t.addValue(i,ci(o!==void 0?o:r,{owner:t}))}}for(const i in n)s[i]===void 0&&t.removeValue(i);return s}const cm=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class p_{scrapeMotionValuesFromProps(s,n,i){return{}}constructor({parent:s,props:n,presenceContext:i,reducedMotionConfig:r,blockInitialAnimation:a,visualState:o},l={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Zc,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const h=lt.now();this.renderScheduledAt<h&&(this.renderScheduledAt=h,xe.render(this.render,!1,!0))};const{latestValues:c,renderState:d}=o;this.latestValues=c,this.baseTarget={...c},this.initialValues=n.initial?{...c}:{},this.renderState=d,this.parent=s,this.props=n,this.presenceContext=i,this.depth=s?s.depth+1:0,this.reducedMotionConfig=r,this.options=l,this.blockInitialAnimation=!!a,this.isControllingVariants=ao(n),this.isVariantNode=ig(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(s&&s.current);const{willChange:m,...u}=this.scrapeMotionValuesFromProps(n,{},this);for(const h in u){const p=u[h];c[h]!==void 0&&Ze(p)&&p.set(c[h])}}mount(s){this.current=s,h_.set(s,this),this.projection&&!this.projection.instance&&this.projection.mount(s),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,i)=>this.bindToMotionValue(i,n)),yg.current||m_(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Ll.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),Ks(this.notifyUpdate),Ks(this.render),this.valueSubscriptions.forEach(s=>s()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const s in this.events)this.events[s].clear();for(const s in this.features){const n=this.features[s];n&&(n.unmount(),n.isMounted=!1)}this.current=null}addChild(s){this.children.add(s),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(s)}removeChild(s){this.children.delete(s),this.enteringChildren&&this.enteringChildren.delete(s)}bindToMotionValue(s,n){this.valueSubscriptions.has(s)&&this.valueSubscriptions.get(s)();const i=wi.has(s);i&&this.onBindTransform&&this.onBindTransform();const r=n.on("change",o=>{this.latestValues[s]=o,this.props.onUpdate&&xe.preRender(this.notifyUpdate),i&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let a;window.MotionCheckAppearSync&&(a=window.MotionCheckAppearSync(this,s,n)),this.valueSubscriptions.set(s,()=>{r(),a&&a(),n.owner&&n.stop()})}sortNodePosition(s){return!this.current||!this.sortInstanceNodePosition||this.type!==s.type?0:this.sortInstanceNodePosition(this.current,s.current)}updateFeatures(){let s="animation";for(s in di){const n=di[s];if(!n)continue;const{isEnabled:i,Feature:r}=n;if(!this.features[s]&&r&&i(this.props)&&(this.features[s]=new r(this)),this.features[s]){const a=this.features[s];a.isMounted?a.update():(a.mount(),a.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Te()}getStaticValue(s){return this.latestValues[s]}setStaticValue(s,n){this.latestValues[s]=n}update(s,n){(s.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=s,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let i=0;i<cm.length;i++){const r=cm[i];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const a="on"+r,o=s[a];o&&(this.propEventSubscriptions[r]=this.on(r,o))}this.prevMotionValues=f_(this,this.scrapeMotionValuesFromProps(s,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(s){return this.props.variants?this.props.variants[s]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(s){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(s),()=>n.variantChildren.delete(s)}addValue(s,n){const i=this.values.get(s);n!==i&&(i&&this.removeValue(s),this.bindToMotionValue(s,n),this.values.set(s,n),this.latestValues[s]=n.get())}removeValue(s){this.values.delete(s);const n=this.valueSubscriptions.get(s);n&&(n(),this.valueSubscriptions.delete(s)),delete this.latestValues[s],this.removeValueFromRenderState(s,this.renderState)}hasValue(s){return this.values.has(s)}getValue(s,n){if(this.props.values&&this.props.values[s])return this.props.values[s];let i=this.values.get(s);return i===void 0&&n!==void 0&&(i=ci(n===null?void 0:n,{owner:this}),this.addValue(s,i)),i}readValue(s,n){let i=this.latestValues[s]!==void 0||!this.current?this.latestValues[s]:this.getBaseTargetFromProps(this.props,s)??this.readValueFromInstance(this.current,s,this.options);return i!=null&&(typeof i=="string"&&(ux(i)||hx(i))?i=parseFloat(i):!kC(i)&&Ws.test(n)&&(i=Hx(s,n)),this.setBaseTarget(s,Ze(i)?i.get():i)),Ze(i)?i.get():i}setBaseTarget(s,n){this.baseTarget[s]=n}getBaseTarget(s){const{initial:n}=this.props;let i;if(typeof n=="string"||typeof n=="object"){const a=ad(this.props,n,this.presenceContext?.custom);a&&(i=a[s])}if(n&&i!==void 0)return i;const r=this.getBaseTargetFromProps(this.props,s);return r!==void 0&&!Ze(r)?r:this.initialValues[s]!==void 0&&i===void 0?void 0:this.baseTarget[s]}on(s,n){return this.events[s]||(this.events[s]=new Lc),this.events[s].add(n)}notify(s,...n){this.events[s]&&this.events[s].notify(...n)}scheduleRenderMicrotask(){Xc.render(this.render)}}class bg extends p_{constructor(){super(...arguments),this.KeyframeResolver=mC}sortInstanceNodePosition(s,n){return s.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(s,n){return s.style?s.style[n]:void 0}removeValueFromRenderState(s,{vars:n,style:i}){delete n[s],delete i[s]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:s}=this.props;Ze(s)&&(this.childSubscription=s.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}function wg(t,{style:s,vars:n},i,r){const a=t.style;let o;for(o in s)a[o]=s[o];r?.applyProjectionStyles(a,i);for(o in n)a.setProperty(o,n[o])}function x_(t){return window.getComputedStyle(t)}class g_ extends bg{constructor(){super(...arguments),this.type="html",this.renderInstance=wg}readValueFromInstance(s,n){if(wi.has(n))return this.projection?.isProjecting?_l(n):D2(s,n);{const i=x_(s),r=(Fc(n)?i.getPropertyValue(n):i[n])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(s,{transformPagePoint:n}){return jg(s,n)}build(s,n,i){nd(s,n,i.transformTemplate)}scrapeMotionValuesFromProps(s,n,i){return od(s,n,i)}}const vg=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function j_(t,s,n,i){wg(t,s,void 0,i);for(const r in s.attrs)t.setAttribute(vg.has(r)?r:ld(r),s.attrs[r])}class y_ extends bg{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Te}getBaseTargetFromProps(s,n){return s[n]}readValueFromInstance(s,n){if(wi.has(n)){const i=Gx(n);return i&&i.default||0}return n=vg.has(n)?n:ld(n),s.getAttribute(n)}scrapeMotionValuesFromProps(s,n,i){return ug(s,n,i)}build(s,n,i){og(s,n,this.isSVGTag,i.transformTemplate,i.style)}renderInstance(s,n,i,r){j_(s,n,i,r)}mount(s){this.isSVGTag=cg(s.tagName),super.mount(s)}}const b_=(t,s)=>rd(t)?new y_(s):new g_(s,{allowProjection:t!==g.Fragment});function Xn(t,s,n){const i=t.getProps();return ad(i,s,n!==void 0?n:i.custom,t)}const Ol=t=>Array.isArray(t);function w_(t,s,n){t.hasValue(s)?t.getValue(s).set(n):t.addValue(s,ci(n))}function v_(t){return Ol(t)?t[t.length-1]||0:t}function N_(t,s){const n=Xn(t,s);let{transitionEnd:i={},transition:r={},...a}=n||{};a={...a,...i};for(const o in a){const l=v_(a[o]);w_(t,o,l)}}function k_(t){return!!(Ze(t)&&t.add)}function $l(t,s){const n=t.getValue("willChange");if(k_(n))return n.add(s);if(!n&&Ss.WillChange){const i=new Ss.WillChange("auto");t.addValue("willChange",i),i.add(s)}}function Ng(t){return t.props[mg]}const z_=t=>t!==null;function S_(t,{repeat:s,repeatType:n="loop"},i){const r=t.filter(z_),a=s&&n!=="loop"&&s%2===1?0:r.length-1;return r[a]}const C_={type:"spring",stiffness:500,damping:25,restSpeed:10},__=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),T_={type:"keyframes",duration:.8},A_={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},D_=(t,{keyframes:s})=>s.length>2?T_:wi.has(t)?t.startsWith("scale")?__(s[1]):C_:A_;function P_({when:t,delay:s,delayChildren:n,staggerChildren:i,staggerDirection:r,repeat:a,repeatType:o,repeatDelay:l,from:c,elapsed:d,...m}){return!!Object.keys(m).length}const cd=(t,s,n,i={},r,a)=>o=>{const l=Qc(i,t)||{},c=l.delay||i.delay||0;let{elapsed:d=0}=i;d=d-Xt(c);const m={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:s.getVelocity(),...l,delay:-d,onUpdate:h=>{s.set(h),l.onUpdate&&l.onUpdate(h)},onComplete:()=>{o(),l.onComplete&&l.onComplete()},name:t,motionValue:s,element:a?void 0:r};P_(l)||Object.assign(m,D_(t,m)),m.duration&&(m.duration=Xt(m.duration)),m.repeatDelay&&(m.repeatDelay=Xt(m.repeatDelay)),m.from!==void 0&&(m.keyframes[0]=m.from);let u=!1;if((m.type===!1||m.duration===0&&!m.repeatDelay)&&(Ml(m),m.delay===0&&(u=!0)),(Ss.instantAnimations||Ss.skipAnimations)&&(u=!0,Ml(m),m.delay=0),m.allowFlatten=!l.type&&!l.ease,u&&!a&&s.get()!==void 0){const h=S_(m.keyframes,l);if(h!==void 0){xe.update(()=>{m.onUpdate(h),m.onComplete()});return}}return l.isSync?new Hc(m):new eC(m)};function M_({protectedKeys:t,needsAnimating:s},n){const i=t.hasOwnProperty(n)&&s[n]!==!0;return s[n]=!1,i}function kg(t,s,{delay:n=0,transitionOverride:i,type:r}={}){let{transition:a=t.getDefaultTransition(),transitionEnd:o,...l}=s;i&&(a=i);const c=[],d=r&&t.animationState&&t.animationState.getState()[r];for(const m in l){const u=t.getValue(m,t.latestValues[m]??null),h=l[m];if(h===void 0||d&&M_(d,m))continue;const p={delay:n,...Qc(a||{},m)},j=u.get();if(j!==void 0&&!u.isAnimating&&!Array.isArray(h)&&h===j&&!p.velocity)continue;let x=!1;if(window.MotionHandoffAnimation){const w=Ng(t);if(w){const y=window.MotionHandoffAnimation(w,m,xe);y!==null&&(p.startTime=y,x=!0)}}$l(t,m),u.start(cd(m,u,h,t.shouldReduceMotion&&qx.has(m)?{type:!1}:p,t,x));const b=u.animation;b&&c.push(b)}return o&&Promise.all(c).then(()=>{xe.update(()=>{o&&N_(t,o)})}),c}function zg(t,s,n,i=0,r=1){const a=Array.from(t).sort((d,m)=>d.sortNodePosition(m)).indexOf(s),o=t.size,l=(o-1)*i;return typeof n=="function"?n(a,o):r===1?a*i:l-a*i}function Fl(t,s,n={}){const i=Xn(t,s,n.type==="exit"?t.presenceContext?.custom:void 0);let{transition:r=t.getDefaultTransition()||{}}=i||{};n.transitionOverride&&(r=n.transitionOverride);const a=i?()=>Promise.all(kg(t,i,n)):()=>Promise.resolve(),o=t.variantChildren&&t.variantChildren.size?(c=0)=>{const{delayChildren:d=0,staggerChildren:m,staggerDirection:u}=r;return R_(t,s,c,d,m,u,n)}:()=>Promise.resolve(),{when:l}=r;if(l){const[c,d]=l==="beforeChildren"?[a,o]:[o,a];return c().then(()=>d())}else return Promise.all([a(),o(n.delay)])}function R_(t,s,n=0,i=0,r=0,a=1,o){const l=[];for(const c of t.variantChildren)c.notify("AnimationStart",s),l.push(Fl(c,s,{...o,delay:n+(typeof i=="function"?0:i)+zg(t.variantChildren,c,i,r,a)}).then(()=>c.notify("AnimationComplete",s)));return Promise.all(l)}function I_(t,s,n={}){t.notify("AnimationStart",s);let i;if(Array.isArray(s)){const r=s.map(a=>Fl(t,a,n));i=Promise.all(r)}else if(typeof s=="string")i=Fl(t,s,n);else{const r=typeof s=="function"?Xn(t,s,n.custom):s;i=Promise.all(kg(t,r,n))}return i.then(()=>{t.notify("AnimationComplete",s)})}function Sg(t,s){if(!Array.isArray(s))return!1;const n=s.length;if(n!==t.length)return!1;for(let i=0;i<n;i++)if(s[i]!==t[i])return!1;return!0}const E_=sd.length;function Cg(t){if(!t)return;if(!t.isControllingVariants){const n=t.parent?Cg(t.parent)||{}:{};return t.props.initial!==void 0&&(n.initial=t.props.initial),n}const s={};for(let n=0;n<E_;n++){const i=sd[n],r=t.props[i];(pr(r)||r===!1)&&(s[i]=r)}return s}const L_=[...td].reverse(),O_=td.length;function $_(t){return s=>Promise.all(s.map(({animation:n,options:i})=>I_(t,n,i)))}function F_(t){let s=$_(t),n=dm(),i=!0;const r=c=>(d,m)=>{const u=Xn(t,m,c==="exit"?t.presenceContext?.custom:void 0);if(u){const{transition:h,transitionEnd:p,...j}=u;d={...d,...j,...p}}return d};function a(c){s=c(t)}function o(c){const{props:d}=t,m=Cg(t.parent)||{},u=[],h=new Set;let p={},j=1/0;for(let b=0;b<O_;b++){const w=L_[b],y=n[w],v=d[w]!==void 0?d[w]:m[w],_=pr(v),C=w===c?y.isActive:null;C===!1&&(j=b);let k=v===m[w]&&v!==d[w]&&_;if(k&&i&&t.manuallyAnimateOnMount&&(k=!1),y.protectedKeys={...p},!y.isActive&&C===null||!v&&!y.prevProp||ro(v)||typeof v=="boolean")continue;const N=B_(y.prevProp,v);let z=N||w===c&&y.isActive&&!k&&_||b>j&&_,T=!1;const f=Array.isArray(v)?v:[v];let S=f.reduce(r(w),{});C===!1&&(S={});const{prevResolvedValues:A={}}=y,D={...A,...S},P=E=>{z=!0,h.has(E)&&(T=!0,h.delete(E)),y.needsAnimating[E]=!0;const U=t.getValue(E);U&&(U.liveStyle=!1)};for(const E in D){const U=S[E],B=A[E];if(p.hasOwnProperty(E))continue;let ae=!1;Ol(U)&&Ol(B)?ae=!Sg(U,B):ae=U!==B,ae?U!=null?P(E):h.add(E):U!==void 0&&h.has(E)?P(E):y.protectedKeys[E]=!0}y.prevProp=v,y.prevResolvedValues=S,y.isActive&&(p={...p,...S}),i&&t.blockInitialAnimation&&(z=!1);const L=k&&N;z&&(!L||T)&&u.push(...f.map(E=>{const U={type:w};if(typeof E=="string"&&i&&!L&&t.manuallyAnimateOnMount&&t.parent){const{parent:B}=t,ae=Xn(B,E);if(B.enteringChildren&&ae){const{delayChildren:le}=ae.transition||{};U.delay=zg(B.enteringChildren,t,le)}}return{animation:E,options:U}}))}if(h.size){const b={};if(typeof d.initial!="boolean"){const w=Xn(t,Array.isArray(d.initial)?d.initial[0]:d.initial);w&&w.transition&&(b.transition=w.transition)}h.forEach(w=>{const y=t.getBaseTarget(w),v=t.getValue(w);v&&(v.liveStyle=!0),b[w]=y??null}),u.push({animation:b})}let x=!!u.length;return i&&(d.initial===!1||d.initial===d.animate)&&!t.manuallyAnimateOnMount&&(x=!1),i=!1,x?s(u):Promise.resolve()}function l(c,d){if(n[c].isActive===d)return Promise.resolve();t.variantChildren?.forEach(u=>u.animationState?.setActive(c,d)),n[c].isActive=d;const m=o(c);for(const u in n)n[u].protectedKeys={};return m}return{animateChanges:o,setActive:l,setAnimateFunction:a,getState:()=>n,reset:()=>{n=dm(),i=!0}}}function B_(t,s){return typeof s=="string"?s!==t:Array.isArray(s)?!Sg(s,t):!1}function tn(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function dm(){return{animate:tn(!0),whileInView:tn(),whileHover:tn(),whileTap:tn(),whileDrag:tn(),whileFocus:tn(),exit:tn()}}class Xs{constructor(s){this.isMounted=!1,this.node=s}update(){}}class U_ extends Xs{constructor(s){super(s),s.animationState||(s.animationState=F_(s))}updateAnimationControlsSubscription(){const{animate:s}=this.node.getProps();ro(s)&&(this.unmountControls=s.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:s}=this.node.getProps(),{animate:n}=this.node.prevProps||{};s!==n&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let V_=0;class q_ extends Xs{constructor(){super(...arguments),this.id=V_++}update(){if(!this.node.presenceContext)return;const{isPresent:s,onExitComplete:n}=this.node.presenceContext,{isPresent:i}=this.node.prevPresenceContext||{};if(!this.node.animationState||s===i)return;const r=this.node.animationState.setActive("exit",!s);n&&!s&&r.then(()=>{n(this.id)})}mount(){const{register:s,onExitComplete:n}=this.node.presenceContext||{};n&&n(this.id),s&&(this.unmount=s(this.id))}unmount(){}}const K_={animation:{Feature:U_},exit:{Feature:q_}};function gr(t,s,n,i={passive:!0}){return t.addEventListener(s,n,i),()=>t.removeEventListener(s,n)}function Ir(t){return{point:{x:t.pageX,y:t.pageY}}}const W_=t=>s=>Jc(s)&&t(s,Ir(s));function Zi(t,s,n,i){return gr(t,s,W_(n),i)}const _g=1e-4,G_=1-_g,H_=1+_g,Tg=.01,Z_=0-Tg,Q_=0+Tg;function tt(t){return t.max-t.min}function Y_(t,s,n){return Math.abs(t-s)<=n}function um(t,s,n,i=.5){t.origin=i,t.originPoint=ye(s.min,s.max,t.origin),t.scale=tt(n)/tt(s),t.translate=ye(n.min,n.max,t.origin)-t.originPoint,(t.scale>=G_&&t.scale<=H_||isNaN(t.scale))&&(t.scale=1),(t.translate>=Z_&&t.translate<=Q_||isNaN(t.translate))&&(t.translate=0)}function Qi(t,s,n,i){um(t.x,s.x,n.x,i?i.originX:void 0),um(t.y,s.y,n.y,i?i.originY:void 0)}function mm(t,s,n){t.min=n.min+s.min,t.max=t.min+tt(s)}function X_(t,s,n){mm(t.x,s.x,n.x),mm(t.y,s.y,n.y)}function hm(t,s,n){t.min=s.min-n.min,t.max=t.min+tt(s)}function Yi(t,s,n){hm(t.x,s.x,n.x),hm(t.y,s.y,n.y)}function zt(t){return[t("x"),t("y")]}const Ag=({current:t})=>t?t.ownerDocument.defaultView:null,fm=(t,s)=>Math.abs(t-s);function J_(t,s){const n=fm(t.x,s.x),i=fm(t.y,s.y);return Math.sqrt(n**2+i**2)}class Dg{constructor(s,n,{transformPagePoint:i,contextWindow:r=window,dragSnapToOrigin:a=!1,distanceThreshold:o=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const h=Go(this.lastMoveEventInfo,this.history),p=this.startEvent!==null,j=J_(h.offset,{x:0,y:0})>=this.distanceThreshold;if(!p&&!j)return;const{point:x}=h,{timestamp:b}=Ke;this.history.push({...x,timestamp:b});const{onStart:w,onMove:y}=this.handlers;p||(w&&w(this.lastMoveEvent,h),this.startEvent=this.lastMoveEvent),y&&y(this.lastMoveEvent,h)},this.handlePointerMove=(h,p)=>{this.lastMoveEvent=h,this.lastMoveEventInfo=Wo(p,this.transformPagePoint),xe.update(this.updatePoint,!0)},this.handlePointerUp=(h,p)=>{this.end();const{onEnd:j,onSessionEnd:x,resumeAnimation:b}=this.handlers;if(this.dragSnapToOrigin&&b&&b(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const w=Go(h.type==="pointercancel"?this.lastMoveEventInfo:Wo(p,this.transformPagePoint),this.history);this.startEvent&&j&&j(h,w),x&&x(h,w)},!Jc(s))return;this.dragSnapToOrigin=a,this.handlers=n,this.transformPagePoint=i,this.distanceThreshold=o,this.contextWindow=r||window;const l=Ir(s),c=Wo(l,this.transformPagePoint),{point:d}=c,{timestamp:m}=Ke;this.history=[{...d,timestamp:m}];const{onSessionStart:u}=n;u&&u(s,Go(c,this.history)),this.removeListeners=Pr(Zi(this.contextWindow,"pointermove",this.handlePointerMove),Zi(this.contextWindow,"pointerup",this.handlePointerUp),Zi(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(s){this.handlers=s}end(){this.removeListeners&&this.removeListeners(),Ks(this.updatePoint)}}function Wo(t,s){return s?{point:s(t.point)}:t}function pm(t,s){return{x:t.x-s.x,y:t.y-s.y}}function Go({point:t},s){return{point:t,delta:pm(t,Pg(s)),offset:pm(t,e4(s)),velocity:t4(s,.1)}}function e4(t){return t[0]}function Pg(t){return t[t.length-1]}function t4(t,s){if(t.length<2)return{x:0,y:0};let n=t.length-1,i=null;const r=Pg(t);for(;n>=0&&(i=t[n],!(r.timestamp-i.timestamp>Xt(s)));)n--;if(!i)return{x:0,y:0};const a=Jt(r.timestamp-i.timestamp);if(a===0)return{x:0,y:0};const o={x:(r.x-i.x)/a,y:(r.y-i.y)/a};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function s4(t,{min:s,max:n},i){return s!==void 0&&t<s?t=i?ye(s,t,i.min):Math.max(t,s):n!==void 0&&t>n&&(t=i?ye(n,t,i.max):Math.min(t,n)),t}function xm(t,s,n){return{min:s!==void 0?t.min+s:void 0,max:n!==void 0?t.max+n-(t.max-t.min):void 0}}function n4(t,{top:s,left:n,bottom:i,right:r}){return{x:xm(t.x,n,r),y:xm(t.y,s,i)}}function gm(t,s){let n=s.min-t.min,i=s.max-t.max;return s.max-s.min<t.max-t.min&&([n,i]=[i,n]),{min:n,max:i}}function i4(t,s){return{x:gm(t.x,s.x),y:gm(t.y,s.y)}}function r4(t,s){let n=.5;const i=tt(t),r=tt(s);return r>i?n=mr(s.min,s.max-i,t.min):i>r&&(n=mr(t.min,t.max-r,s.min)),zs(0,1,n)}function a4(t,s){const n={};return s.min!==void 0&&(n.min=s.min-t.min),s.max!==void 0&&(n.max=s.max-t.min),n}const Bl=.35;function o4(t=Bl){return t===!1?t=0:t===!0&&(t=Bl),{x:jm(t,"left","right"),y:jm(t,"top","bottom")}}function jm(t,s,n){return{min:ym(t,s),max:ym(t,n)}}function ym(t,s){return typeof t=="number"?t:t[s]||0}const l4=new WeakMap;class c4{constructor(s){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Te(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=s}start(s,{snapToCursor:n=!1,distanceThreshold:i}={}){const{presenceContext:r}=this.visualElement;if(r&&r.isPresent===!1)return;const a=u=>{const{dragSnapToOrigin:h}=this.getProps();h?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(Ir(u).point)},o=(u,h)=>{const{drag:p,dragPropagation:j,onDragStart:x}=this.getProps();if(p&&!j&&(this.openDragLock&&this.openDragLock(),this.openDragLock=xC(p),!this.openDragLock))return;this.latestPointerEvent=u,this.latestPanInfo=h,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),zt(w=>{let y=this.getAxisMotionValue(w).get()||0;if(es.test(y)){const{projection:v}=this.visualElement;if(v&&v.layout){const _=v.layout.layoutBox[w];_&&(y=tt(_)*(parseFloat(y)/100))}}this.originPoint[w]=y}),x&&xe.postRender(()=>x(u,h)),$l(this.visualElement,"transform");const{animationState:b}=this.visualElement;b&&b.setActive("whileDrag",!0)},l=(u,h)=>{this.latestPointerEvent=u,this.latestPanInfo=h;const{dragPropagation:p,dragDirectionLock:j,onDirectionLock:x,onDrag:b}=this.getProps();if(!p&&!this.openDragLock)return;const{offset:w}=h;if(j&&this.currentDirection===null){this.currentDirection=d4(w),this.currentDirection!==null&&x&&x(this.currentDirection);return}this.updateAxis("x",h.point,w),this.updateAxis("y",h.point,w),this.visualElement.render(),b&&b(u,h)},c=(u,h)=>{this.latestPointerEvent=u,this.latestPanInfo=h,this.stop(u,h),this.latestPointerEvent=null,this.latestPanInfo=null},d=()=>zt(u=>this.getAnimationState(u)==="paused"&&this.getAxisMotionValue(u).animation?.play()),{dragSnapToOrigin:m}=this.getProps();this.panSession=new Dg(s,{onSessionStart:a,onStart:o,onMove:l,onSessionEnd:c,resumeAnimation:d},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:m,distanceThreshold:i,contextWindow:Ag(this.visualElement)})}stop(s,n){const i=s||this.latestPointerEvent,r=n||this.latestPanInfo,a=this.isDragging;if(this.cancel(),!a||!r||!i)return;const{velocity:o}=r;this.startAnimation(o);const{onDragEnd:l}=this.getProps();l&&xe.postRender(()=>l(i,r))}cancel(){this.isDragging=!1;const{projection:s,animationState:n}=this.visualElement;s&&(s.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:i}=this.getProps();!i&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(s,n,i){const{drag:r}=this.getProps();if(!i||!Hr(s,r,this.currentDirection))return;const a=this.getAxisMotionValue(s);let o=this.originPoint[s]+i[s];this.constraints&&this.constraints[s]&&(o=s4(o,this.constraints[s],this.elastic[s])),a.set(o)}resolveConstraints(){const{dragConstraints:s,dragElastic:n}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,r=this.constraints;s&&Un(s)?this.constraints||(this.constraints=this.resolveRefConstraints()):s&&i?this.constraints=n4(i.layoutBox,s):this.constraints=!1,this.elastic=o4(n),r!==this.constraints&&i&&this.constraints&&!this.hasMutatedConstraints&&zt(a=>{this.constraints!==!1&&this.getAxisMotionValue(a)&&(this.constraints[a]=a4(i.layoutBox[a],this.constraints[a]))})}resolveRefConstraints(){const{dragConstraints:s,onMeasureDragConstraints:n}=this.getProps();if(!s||!Un(s))return!1;const i=s.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const a=u_(i,r.root,this.visualElement.getTransformPagePoint());let o=i4(r.layout.layoutBox,a);if(n){const l=n(l_(o));this.hasMutatedConstraints=!!l,l&&(o=pg(l))}return o}startAnimation(s){const{drag:n,dragMomentum:i,dragElastic:r,dragTransition:a,dragSnapToOrigin:o,onDragTransitionEnd:l}=this.getProps(),c=this.constraints||{},d=zt(m=>{if(!Hr(m,n,this.currentDirection))return;let u=c&&c[m]||{};o&&(u={min:0,max:0});const h=r?200:1e6,p=r?40:1e7,j={type:"inertia",velocity:i?s[m]:0,bounceStiffness:h,bounceDamping:p,timeConstant:750,restDelta:1,restSpeed:10,...a,...u};return this.startAxisValueAnimation(m,j)});return Promise.all(d).then(l)}startAxisValueAnimation(s,n){const i=this.getAxisMotionValue(s);return $l(this.visualElement,s),i.start(cd(s,i,0,n,this.visualElement,!1))}stopAnimation(){zt(s=>this.getAxisMotionValue(s).stop())}pauseAnimation(){zt(s=>this.getAxisMotionValue(s).animation?.pause())}getAnimationState(s){return this.getAxisMotionValue(s).animation?.state}getAxisMotionValue(s){const n=`_drag${s.toUpperCase()}`,i=this.visualElement.getProps(),r=i[n];return r||this.visualElement.getValue(s,(i.initial?i.initial[s]:void 0)||0)}snapToCursor(s){zt(n=>{const{drag:i}=this.getProps();if(!Hr(n,i,this.currentDirection))return;const{projection:r}=this.visualElement,a=this.getAxisMotionValue(n);if(r&&r.layout){const{min:o,max:l}=r.layout.layoutBox[n];a.set(s[n]-ye(o,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:s,dragConstraints:n}=this.getProps(),{projection:i}=this.visualElement;if(!Un(n)||!i||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};zt(o=>{const l=this.getAxisMotionValue(o);if(l&&this.constraints!==!1){const c=l.get();r[o]=r4({min:c,max:c},this.constraints[o])}});const{transformTemplate:a}=this.visualElement.getProps();this.visualElement.current.style.transform=a?a({},""):"none",i.root&&i.root.updateScroll(),i.updateLayout(),this.resolveConstraints(),zt(o=>{if(!Hr(o,s,null))return;const l=this.getAxisMotionValue(o),{min:c,max:d}=this.constraints[o];l.set(ye(c,d,r[o]))})}addListeners(){if(!this.visualElement.current)return;l4.set(this.visualElement,this);const s=this.visualElement.current,n=Zi(s,"pointerdown",c=>{const{drag:d,dragListener:m=!0}=this.getProps();d&&m&&this.start(c)}),i=()=>{const{dragConstraints:c}=this.getProps();Un(c)&&c.current&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,a=r.addEventListener("measure",i);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),xe.read(i);const o=gr(window,"resize",()=>this.scalePositionWithinConstraints()),l=r.addEventListener("didUpdate",({delta:c,hasLayoutChanged:d})=>{this.isDragging&&d&&(zt(m=>{const u=this.getAxisMotionValue(m);u&&(this.originPoint[m]+=c[m].translate,u.set(u.get()+c[m].translate))}),this.visualElement.render())});return()=>{o(),n(),a(),l&&l()}}getProps(){const s=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:i=!1,dragPropagation:r=!1,dragConstraints:a=!1,dragElastic:o=Bl,dragMomentum:l=!0}=s;return{...s,drag:n,dragDirectionLock:i,dragPropagation:r,dragConstraints:a,dragElastic:o,dragMomentum:l}}}function Hr(t,s,n){return(s===!0||s===t)&&(n===null||n===t)}function d4(t,s=10){let n=null;return Math.abs(t.y)>s?n="y":Math.abs(t.x)>s&&(n="x"),n}class u4 extends Xs{constructor(s){super(s),this.removeGroupControls=At,this.removeListeners=At,this.controls=new c4(s)}mount(){const{dragControls:s}=this.node.getProps();s&&(this.removeGroupControls=s.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||At}unmount(){this.removeGroupControls(),this.removeListeners()}}const bm=t=>(s,n)=>{t&&xe.postRender(()=>t(s,n))};class m4 extends Xs{constructor(){super(...arguments),this.removePointerDownListener=At}onPointerDown(s){this.session=new Dg(s,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Ag(this.node)})}createPanHandlers(){const{onPanSessionStart:s,onPanStart:n,onPan:i,onPanEnd:r}=this.node.getProps();return{onSessionStart:bm(s),onStart:bm(n),onMove:i,onEnd:(a,o)=>{delete this.session,r&&xe.postRender(()=>r(a,o))}}}mount(){this.removePointerDownListener=Zi(this.node.current,"pointerdown",s=>this.onPointerDown(s))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const ra={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function wm(t,s){return s.max===s.min?0:t/(s.max-s.min)*100}const Ii={correct:(t,s)=>{if(!s.target)return t;if(typeof t=="string")if(X.test(t))t=parseFloat(t);else return t;const n=wm(t,s.target.x),i=wm(t,s.target.y);return`${n}% ${i}%`}},h4={correct:(t,{treeScale:s,projectionDelta:n})=>{const i=t,r=Ws.parse(t);if(r.length>5)return i;const a=Ws.createTransformer(t),o=typeof r[0]!="number"?1:0,l=n.x.scale*s.x,c=n.y.scale*s.y;r[0+o]/=l,r[1+o]/=c;const d=ye(l,c,.5);return typeof r[2+o]=="number"&&(r[2+o]/=d),typeof r[3+o]=="number"&&(r[3+o]/=d),a(r)}};let Ho=!1;class f4 extends g.Component{componentDidMount(){const{visualElement:s,layoutGroup:n,switchLayoutGroup:i,layoutId:r}=this.props,{projection:a}=s;EC(p4),a&&(n.group&&n.group.add(a),i&&i.register&&r&&i.register(a),Ho&&a.root.didUpdate(),a.addEventListener("animationComplete",()=>{this.safeToRemove()}),a.setOptions({...a.options,onExitComplete:()=>this.safeToRemove()})),ra.hasEverUpdated=!0}getSnapshotBeforeUpdate(s){const{layoutDependency:n,visualElement:i,drag:r,isPresent:a}=this.props,{projection:o}=i;return o&&(o.isPresent=a,Ho=!0,r||s.layoutDependency!==n||n===void 0||s.isPresent!==a?o.willUpdate():this.safeToRemove(),s.isPresent!==a&&(a?o.promote():o.relegate()||xe.postRender(()=>{const l=o.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:s}=this.props.visualElement;s&&(s.root.didUpdate(),Xc.postRender(()=>{!s.currentAnimation&&s.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:s,layoutGroup:n,switchLayoutGroup:i}=this.props,{projection:r}=s;Ho=!0,r&&(r.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(r),i&&i.deregister&&i.deregister(r))}safeToRemove(){const{safeToRemove:s}=this.props;s&&s()}render(){return null}}function Mg(t){const[s,n]=tg(),i=g.useContext(Ac);return e.jsx(f4,{...t,layoutGroup:i,switchLayoutGroup:g.useContext(hg),isPresent:s,safeToRemove:n})}const p4={borderRadius:{...Ii,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Ii,borderTopRightRadius:Ii,borderBottomLeftRadius:Ii,borderBottomRightRadius:Ii,boxShadow:h4};function x4(t,s,n){const i=Ze(t)?t:ci(t);return i.start(cd("",i,s,n)),i.animation}const g4=(t,s)=>t.depth-s.depth;class j4{constructor(){this.children=[],this.isDirty=!1}add(s){Mc(this.children,s),this.isDirty=!0}remove(s){Rc(this.children,s),this.isDirty=!0}forEach(s){this.isDirty&&this.children.sort(g4),this.isDirty=!1,this.children.forEach(s)}}function y4(t,s){const n=lt.now(),i=({timestamp:r})=>{const a=r-n;a>=s&&(Ks(i),t(a-s))};return xe.setup(i,!0),()=>Ks(i)}const Rg=["TopLeft","TopRight","BottomLeft","BottomRight"],b4=Rg.length,vm=t=>typeof t=="string"?parseFloat(t):t,Nm=t=>typeof t=="number"||X.test(t);function w4(t,s,n,i,r,a){r?(t.opacity=ye(0,n.opacity??1,v4(i)),t.opacityExit=ye(s.opacity??1,0,N4(i))):a&&(t.opacity=ye(s.opacity??1,n.opacity??1,i));for(let o=0;o<b4;o++){const l=`border${Rg[o]}Radius`;let c=km(s,l),d=km(n,l);if(c===void 0&&d===void 0)continue;c||(c=0),d||(d=0),c===0||d===0||Nm(c)===Nm(d)?(t[l]=Math.max(ye(vm(c),vm(d),i),0),(es.test(d)||es.test(c))&&(t[l]+="%")):t[l]=d}(s.rotate||n.rotate)&&(t.rotate=ye(s.rotate||0,n.rotate||0,i))}function km(t,s){return t[s]!==void 0?t[s]:t.borderRadius}const v4=Ig(0,.5,wx),N4=Ig(.5,.95,At);function Ig(t,s,n){return i=>i<t?0:i>s?1:n(mr(t,s,i))}function zm(t,s){t.min=s.min,t.max=s.max}function kt(t,s){zm(t.x,s.x),zm(t.y,s.y)}function Sm(t,s){t.translate=s.translate,t.scale=s.scale,t.originPoint=s.originPoint,t.origin=s.origin}function Cm(t,s,n,i,r){return t-=s,t=Sa(t,1/n,i),r!==void 0&&(t=Sa(t,1/r,i)),t}function k4(t,s=0,n=1,i=.5,r,a=t,o=t){if(es.test(s)&&(s=parseFloat(s),s=ye(o.min,o.max,s/100)-o.min),typeof s!="number")return;let l=ye(a.min,a.max,i);t===a&&(l-=s),t.min=Cm(t.min,s,n,l,r),t.max=Cm(t.max,s,n,l,r)}function _m(t,s,[n,i,r],a,o){k4(t,s[n],s[i],s[r],s.scale,a,o)}const z4=["x","scaleX","originX"],S4=["y","scaleY","originY"];function Tm(t,s,n,i){_m(t.x,s,z4,n?n.x:void 0,i?i.x:void 0),_m(t.y,s,S4,n?n.y:void 0,i?i.y:void 0)}function Am(t){return t.translate===0&&t.scale===1}function Eg(t){return Am(t.x)&&Am(t.y)}function Dm(t,s){return t.min===s.min&&t.max===s.max}function C4(t,s){return Dm(t.x,s.x)&&Dm(t.y,s.y)}function Pm(t,s){return Math.round(t.min)===Math.round(s.min)&&Math.round(t.max)===Math.round(s.max)}function Lg(t,s){return Pm(t.x,s.x)&&Pm(t.y,s.y)}function Mm(t){return tt(t.x)/tt(t.y)}function Rm(t,s){return t.translate===s.translate&&t.scale===s.scale&&t.originPoint===s.originPoint}class _4{constructor(){this.members=[]}add(s){Mc(this.members,s),s.scheduleRender()}remove(s){if(Rc(this.members,s),s===this.prevLead&&(this.prevLead=void 0),s===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(s){const n=this.members.findIndex(r=>s===r);if(n===0)return!1;let i;for(let r=n;r>=0;r--){const a=this.members[r];if(a.isPresent!==!1){i=a;break}}return i?(this.promote(i),!0):!1}promote(s,n){const i=this.lead;if(s!==i&&(this.prevLead=i,this.lead=s,s.show(),i)){i.instance&&i.scheduleRender(),s.scheduleRender(),s.resumeFrom=i,n&&(s.resumeFrom.preserveOpacity=!0),i.snapshot&&(s.snapshot=i.snapshot,s.snapshot.latestValues=i.animationValues||i.latestValues),s.root&&s.root.isUpdating&&(s.isLayoutDirty=!0);const{crossfade:r}=s.options;r===!1&&i.hide()}}exitAnimationComplete(){this.members.forEach(s=>{const{options:n,resumingFrom:i}=s;n.onExitComplete&&n.onExitComplete(),i&&i.options.onExitComplete&&i.options.onExitComplete()})}scheduleRender(){this.members.forEach(s=>{s.instance&&s.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function T4(t,s,n){let i="";const r=t.x.translate/s.x,a=t.y.translate/s.y,o=n?.z||0;if((r||a||o)&&(i=`translate3d(${r}px, ${a}px, ${o}px) `),(s.x!==1||s.y!==1)&&(i+=`scale(${1/s.x}, ${1/s.y}) `),n){const{transformPerspective:d,rotate:m,rotateX:u,rotateY:h,skewX:p,skewY:j}=n;d&&(i=`perspective(${d}px) ${i}`),m&&(i+=`rotate(${m}deg) `),u&&(i+=`rotateX(${u}deg) `),h&&(i+=`rotateY(${h}deg) `),p&&(i+=`skewX(${p}deg) `),j&&(i+=`skewY(${j}deg) `)}const l=t.x.scale*s.x,c=t.y.scale*s.y;return(l!==1||c!==1)&&(i+=`scale(${l}, ${c})`),i||"none"}const Zo=["","X","Y","Z"],A4=1e3;let D4=0;function Qo(t,s,n,i){const{latestValues:r}=s;r[t]&&(n[t]=r[t],s.setStaticValue(t,0),i&&(i[t]=0))}function Og(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:s}=t.options;if(!s)return;const n=Ng(s);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:r,layoutId:a}=t.options;window.MotionCancelOptimisedAnimation(n,"transform",xe,!(r||a))}const{parent:i}=t;i&&!i.hasCheckedOptimisedAppear&&Og(i)}function $g({attachResizeListener:t,defaultParent:s,measureScroll:n,checkIsScrollRoot:i,resetTransform:r}){return class{constructor(o={},l=s?.()){this.id=D4++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(R4),this.nodes.forEach(O4),this.nodes.forEach($4),this.nodes.forEach(I4)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new j4)}addEventListener(o,l){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new Lc),this.eventHandlers.get(o).add(l)}notifyListeners(o,...l){const c=this.eventHandlers.get(o);c&&c.notify(...l)}hasListeners(o){return this.eventHandlers.has(o)}mount(o){if(this.instance)return;this.isSVG=eg(o)&&!vC(o),this.instance=o;const{layoutId:l,layout:c,visualElement:d}=this.options;if(d&&!d.current&&d.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(c||l)&&(this.isLayoutDirty=!0),t){let m,u=0;const h=()=>this.root.updateBlockedByResize=!1;xe.read(()=>{u=window.innerWidth}),t(o,()=>{const p=window.innerWidth;p!==u&&(u=p,this.root.updateBlockedByResize=!0,m&&m(),m=y4(h,250),ra.hasAnimatedSinceResize&&(ra.hasAnimatedSinceResize=!1,this.nodes.forEach(Lm)))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&d&&(l||c)&&this.addEventListener("didUpdate",({delta:m,hasLayoutChanged:u,hasRelativeLayoutChanged:h,layout:p})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const j=this.options.transition||d.getDefaultTransition()||q4,{onLayoutAnimationStart:x,onLayoutAnimationComplete:b}=d.getProps(),w=!this.targetLayout||!Lg(this.targetLayout,p),y=!u&&h;if(this.options.layoutRoot||this.resumeFrom||y||u&&(w||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const v={...Qc(j,"layout"),onPlay:x,onComplete:b};(d.shouldReduceMotion||this.options.layoutRoot)&&(v.delay=0,v.type=!1),this.startAnimation(v),this.setAnimationOrigin(m,y)}else u||Lm(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=p})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Ks(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(F4),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Og(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let m=0;m<this.path.length;m++){const u=this.path[m];u.shouldResetTransform=!0,u.updateScroll("snapshot"),u.options.layoutRoot&&u.willUpdate(!1)}const{layoutId:l,layout:c}=this.options;if(l===void 0&&!c)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(Im);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(Em);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(L4),this.nodes.forEach(P4),this.nodes.forEach(M4)):this.nodes.forEach(Em),this.clearAllSnapshots();const l=lt.now();Ke.delta=zs(0,1e3/60,l-Ke.timestamp),Ke.timestamp=l,Ke.isProcessing=!0,Oo.update.process(Ke),Oo.preRender.process(Ke),Oo.render.process(Ke),Ke.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Xc.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(E4),this.sharedNodes.forEach(B4)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,xe.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){xe.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!tt(this.snapshot.measuredBox.x)&&!tt(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Te(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let l=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(l=!1),l&&this.instance){const c=i(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:c,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!r)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,l=this.projectionDelta&&!Eg(this.projectionDelta),c=this.getTransformTemplate(),d=c?c(this.latestValues,""):void 0,m=d!==this.prevTransformTemplateValue;o&&this.instance&&(l||sn(this.latestValues)||m)&&(r(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const l=this.measurePageBox();let c=this.removeElementScroll(l);return o&&(c=this.removeTransform(c)),K4(c),{animationId:this.root.animationId,measuredBox:l,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:o}=this.options;if(!o)return Te();const l=o.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(W4))){const{scroll:d}=this.root;d&&(Vn(l.x,d.offset.x),Vn(l.y,d.offset.y))}return l}removeElementScroll(o){const l=Te();if(kt(l,o),this.scroll?.wasRoot)return l;for(let c=0;c<this.path.length;c++){const d=this.path[c],{scroll:m,options:u}=d;d!==this.root&&m&&u.layoutScroll&&(m.wasRoot&&kt(l,o),Vn(l.x,m.offset.x),Vn(l.y,m.offset.y))}return l}applyTransform(o,l=!1){const c=Te();kt(c,o);for(let d=0;d<this.path.length;d++){const m=this.path[d];!l&&m.options.layoutScroll&&m.scroll&&m!==m.root&&qn(c,{x:-m.scroll.offset.x,y:-m.scroll.offset.y}),sn(m.latestValues)&&qn(c,m.latestValues)}return sn(this.latestValues)&&qn(c,this.latestValues),c}removeTransform(o){const l=Te();kt(l,o);for(let c=0;c<this.path.length;c++){const d=this.path[c];if(!d.instance||!sn(d.latestValues))continue;Il(d.latestValues)&&d.updateSnapshot();const m=Te(),u=d.measurePageBox();kt(m,u),Tm(l,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,m)}return sn(this.latestValues)&&Tm(l,this.latestValues),l}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ke.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==l;if(!(o||c&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:m,layoutId:u}=this.options;if(!(!this.layout||!(m||u))){if(this.resolvedRelativeTargetAt=Ke.timestamp,!this.targetDelta&&!this.relativeTarget){const h=this.getClosestProjectingParent();h&&h.layout&&this.animationProgress!==1?(this.relativeParent=h,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Te(),this.relativeTargetOrigin=Te(),Yi(this.relativeTargetOrigin,this.layout.layoutBox,h.layout.layoutBox),kt(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Te(),this.targetWithTransforms=Te()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),X_(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):kt(this.target,this.layout.layoutBox),gg(this.target,this.targetDelta)):kt(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const h=this.getClosestProjectingParent();h&&!!h.resumingFrom==!!this.resumingFrom&&!h.options.layoutScroll&&h.target&&this.animationProgress!==1?(this.relativeParent=h,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Te(),this.relativeTargetOrigin=Te(),Yi(this.relativeTargetOrigin,this.target,h.target),kt(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||Il(this.parent.latestValues)||xg(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const o=this.getLead(),l=!!this.resumingFrom||this!==o;let c=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===Ke.timestamp&&(c=!1),c)return;const{layout:d,layoutId:m}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(d||m))return;kt(this.layoutCorrected,this.layout.layoutBox);const u=this.treeScale.x,h=this.treeScale.y;d_(this.layoutCorrected,this.treeScale,this.path,l),o.layout&&!o.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(o.target=o.layout.layoutBox,o.targetWithTransforms=Te());const{target:p}=o;if(!p){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(Sm(this.prevProjectionDelta.x,this.projectionDelta.x),Sm(this.prevProjectionDelta.y,this.projectionDelta.y)),Qi(this.projectionDelta,this.layoutCorrected,p,this.latestValues),(this.treeScale.x!==u||this.treeScale.y!==h||!Rm(this.projectionDelta.x,this.prevProjectionDelta.x)||!Rm(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",p))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){if(this.options.visualElement?.scheduleRender(),o){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Kn(),this.projectionDelta=Kn(),this.projectionDeltaWithTransform=Kn()}setAnimationOrigin(o,l=!1){const c=this.snapshot,d=c?c.latestValues:{},m={...this.latestValues},u=Kn();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const h=Te(),p=c?c.source:void 0,j=this.layout?this.layout.source:void 0,x=p!==j,b=this.getStack(),w=!b||b.members.length<=1,y=!!(x&&!w&&this.options.crossfade===!0&&!this.path.some(V4));this.animationProgress=0;let v;this.mixTargetDelta=_=>{const C=_/1e3;Om(u.x,o.x,C),Om(u.y,o.y,C),this.setTargetDelta(u),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Yi(h,this.layout.layoutBox,this.relativeParent.layout.layoutBox),U4(this.relativeTarget,this.relativeTargetOrigin,h,C),v&&C4(this.relativeTarget,v)&&(this.isProjectionDirty=!1),v||(v=Te()),kt(v,this.relativeTarget)),x&&(this.animationValues=m,w4(m,d,this.latestValues,C,y,w)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=C},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(Ks(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=xe.update(()=>{ra.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=ci(0)),this.currentAnimation=x4(this.motionValue,[0,1e3],{...o,velocity:0,isSync:!0,onUpdate:l=>{this.mixTargetDelta(l),o.onUpdate&&o.onUpdate(l)},onStop:()=>{},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(A4),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:l,target:c,layout:d,latestValues:m}=o;if(!(!l||!c||!d)){if(this!==o&&this.layout&&d&&Fg(this.options.animationType,this.layout.layoutBox,d.layoutBox)){c=this.target||Te();const u=tt(this.layout.layoutBox.x);c.x.min=o.target.x.min,c.x.max=c.x.min+u;const h=tt(this.layout.layoutBox.y);c.y.min=o.target.y.min,c.y.max=c.y.min+h}kt(l,c),qn(l,m),Qi(this.projectionDeltaWithTransform,this.layoutCorrected,l,m)}}registerSharedNode(o,l){this.sharedNodes.has(o)||this.sharedNodes.set(o,new _4),this.sharedNodes.get(o).add(l);const d=l.options.initialPromotionConfig;l.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(l):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){const{layoutId:o}=this.options;return o?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:o}=this.options;return o?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:l,preserveFollowOpacity:c}={}){const d=this.getStack();d&&d.promote(this,c),o&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let l=!1;const{latestValues:c}=o;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(l=!0),!l)return;const d={};c.z&&Qo("z",o,d,this.animationValues);for(let m=0;m<Zo.length;m++)Qo(`rotate${Zo[m]}`,o,d,this.animationValues),Qo(`skew${Zo[m]}`,o,d,this.animationValues);o.render();for(const m in d)o.setStaticValue(m,d[m]),this.animationValues&&(this.animationValues[m]=d[m]);o.scheduleRender()}applyProjectionStyles(o,l){if(!this.instance||this.isSVG)return;if(!this.isVisible){o.visibility="hidden";return}const c=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,o.visibility="",o.opacity="",o.pointerEvents=ia(l?.pointerEvents)||"",o.transform=c?c(this.latestValues,""):"none";return}const d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){this.options.layoutId&&(o.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,o.pointerEvents=ia(l?.pointerEvents)||""),this.hasProjected&&!sn(this.latestValues)&&(o.transform=c?c({},""):"none",this.hasProjected=!1);return}o.visibility="";const m=d.animationValues||d.latestValues;this.applyTransformsToTarget();let u=T4(this.projectionDeltaWithTransform,this.treeScale,m);c&&(u=c(m,u)),o.transform=u;const{x:h,y:p}=this.projectionDelta;o.transformOrigin=`${h.origin*100}% ${p.origin*100}% 0`,d.animationValues?o.opacity=d===this?m.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:m.opacityExit:o.opacity=d===this?m.opacity!==void 0?m.opacity:"":m.opacityExit!==void 0?m.opacityExit:0;for(const j in xr){if(m[j]===void 0)continue;const{correct:x,applyTo:b,isCSSVariable:w}=xr[j],y=u==="none"?m[j]:x(m[j],d);if(b){const v=b.length;for(let _=0;_<v;_++)o[b[_]]=y}else w?this.options.visualElement.renderState.vars[j]=y:o[j]=y}this.options.layoutId&&(o.pointerEvents=d===this?ia(l?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>o.currentAnimation?.stop()),this.root.nodes.forEach(Im),this.root.sharedNodes.clear()}}}function P4(t){t.updateLayout()}function M4(t){const s=t.resumeFrom?.snapshot||t.snapshot;if(t.isLead()&&t.layout&&s&&t.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:i}=t.layout,{animationType:r}=t.options,a=s.source!==t.layout.source;r==="size"?zt(m=>{const u=a?s.measuredBox[m]:s.layoutBox[m],h=tt(u);u.min=n[m].min,u.max=u.min+h}):Fg(r,s.layoutBox,n)&&zt(m=>{const u=a?s.measuredBox[m]:s.layoutBox[m],h=tt(n[m]);u.max=u.min+h,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[m].max=t.relativeTarget[m].min+h)});const o=Kn();Qi(o,n,s.layoutBox);const l=Kn();a?Qi(l,t.applyTransform(i,!0),s.measuredBox):Qi(l,n,s.layoutBox);const c=!Eg(o);let d=!1;if(!t.resumeFrom){const m=t.getClosestProjectingParent();if(m&&!m.resumeFrom){const{snapshot:u,layout:h}=m;if(u&&h){const p=Te();Yi(p,s.layoutBox,u.layoutBox);const j=Te();Yi(j,n,h.layoutBox),Lg(p,j)||(d=!0),m.options.layoutRoot&&(t.relativeTarget=j,t.relativeTargetOrigin=p,t.relativeParent=m)}}}t.notifyListeners("didUpdate",{layout:n,snapshot:s,delta:l,layoutDelta:o,hasLayoutChanged:c,hasRelativeLayoutChanged:d})}else if(t.isLead()){const{onExitComplete:n}=t.options;n&&n()}t.options.transition=void 0}function R4(t){t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function I4(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function E4(t){t.clearSnapshot()}function Im(t){t.clearMeasurements()}function Em(t){t.isLayoutDirty=!1}function L4(t){const{visualElement:s}=t.options;s&&s.getProps().onBeforeLayoutMeasure&&s.notify("BeforeLayoutMeasure"),t.resetTransform()}function Lm(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function O4(t){t.resolveTargetDelta()}function $4(t){t.calcProjection()}function F4(t){t.resetSkewAndRotation()}function B4(t){t.removeLeadSnapshot()}function Om(t,s,n){t.translate=ye(s.translate,0,n),t.scale=ye(s.scale,1,n),t.origin=s.origin,t.originPoint=s.originPoint}function $m(t,s,n,i){t.min=ye(s.min,n.min,i),t.max=ye(s.max,n.max,i)}function U4(t,s,n,i){$m(t.x,s.x,n.x,i),$m(t.y,s.y,n.y,i)}function V4(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const q4={duration:.45,ease:[.4,0,.1,1]},Fm=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),Bm=Fm("applewebkit/")&&!Fm("chrome/")?Math.round:At;function Um(t){t.min=Bm(t.min),t.max=Bm(t.max)}function K4(t){Um(t.x),Um(t.y)}function Fg(t,s,n){return t==="position"||t==="preserve-aspect"&&!Y_(Mm(s),Mm(n),.2)}function W4(t){return t!==t.root&&t.scroll?.wasRoot}const G4=$g({attachResizeListener:(t,s)=>gr(t,"resize",s),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Yo={current:void 0},Bg=$g({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!Yo.current){const t=new G4({});t.mount(window),t.setOptions({layoutScroll:!0}),Yo.current=t}return Yo.current},resetTransform:(t,s)=>{t.style.transform=s!==void 0?s:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),H4={pan:{Feature:m4},drag:{Feature:u4,ProjectionNode:Bg,MeasureLayout:Mg}};function Vm(t,s,n){const{props:i}=t;t.animationState&&i.whileHover&&t.animationState.setActive("whileHover",n==="Start");const r="onHover"+n,a=i[r];a&&xe.postRender(()=>a(s,Ir(s)))}class Z4 extends Xs{mount(){const{current:s}=this.node;s&&(this.unmount=gC(s,(n,i)=>(Vm(this.node,i,"Start"),r=>Vm(this.node,r,"End"))))}unmount(){}}class Q4 extends Xs{constructor(){super(...arguments),this.isActive=!1}onFocus(){let s=!1;try{s=this.node.current.matches(":focus-visible")}catch{s=!0}!s||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Pr(gr(this.node.current,"focus",()=>this.onFocus()),gr(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function qm(t,s,n){const{props:i}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&i.whileTap&&t.animationState.setActive("whileTap",n==="Start");const r="onTap"+(n==="End"?"":n),a=i[r];a&&xe.postRender(()=>a(s,Ir(s)))}class Y4 extends Xs{mount(){const{current:s}=this.node;s&&(this.unmount=wC(s,(n,i)=>(qm(this.node,i,"Start"),(r,{success:a})=>qm(this.node,r,a?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Ul=new WeakMap,Xo=new WeakMap,X4=t=>{const s=Ul.get(t.target);s&&s(t)},J4=t=>{t.forEach(X4)};function eT({root:t,...s}){const n=t||document;Xo.has(n)||Xo.set(n,{});const i=Xo.get(n),r=JSON.stringify(s);return i[r]||(i[r]=new IntersectionObserver(J4,{root:t,...s})),i[r]}function tT(t,s,n){const i=eT(s);return Ul.set(t,n),i.observe(t),()=>{Ul.delete(t),i.unobserve(t)}}const sT={some:0,all:1};class nT extends Xs{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:s={}}=this.node.getProps(),{root:n,margin:i,amount:r="some",once:a}=s,o={root:n?n.current:void 0,rootMargin:i,threshold:typeof r=="number"?r:sT[r]},l=c=>{const{isIntersecting:d}=c;if(this.isInView===d||(this.isInView=d,a&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:m,onViewportLeave:u}=this.node.getProps(),h=d?m:u;h&&h(c)};return tT(this.node.current,o,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:s,prevProps:n}=this.node;["amount","margin","root"].some(iT(s,n))&&this.startObserver()}unmount(){}}function iT({viewport:t={}},{viewport:s={}}={}){return n=>t[n]!==s[n]}const rT={inView:{Feature:nT},tap:{Feature:Y4},focus:{Feature:Q4},hover:{Feature:Z4}},aT={layout:{ProjectionNode:Bg,MeasureLayout:Mg}},oT={...K_,...rT,...H4,...aT},he=o_(oT,b_),oo={normal:.3,slow:.5},lT={stagger:.05},cT={default:[.4,0,.2,1]},dT={hidden:{opacity:0,y:20},visible:(t=0)=>({opacity:1,y:0,transition:{delay:t*lT.stagger,duration:oo.normal,ease:cT.default}})},uT=(t,s=oo.slow)=>{const[n,i]=ee.useState(0),r=ee.useRef(0);return ee.useEffect(()=>{const a=r.current,o=t,l=Date.now(),c=()=>{const d=(Date.now()-l)/1e3,m=Math.min(d/s,1),u=1-Math.pow(1-m,3),h=Math.floor(a+(o-a)*u);i(h),m<1?requestAnimationFrame(c):r.current=o};requestAnimationFrame(c)},[t,s]),n},vi=({children:t,index:s=0,className:n="",...i})=>e.jsx(he.div,{variants:dT,initial:"hidden",animate:"visible",custom:s,className:n,...i,children:t}),bn=({value:t,className:s="bg-gray-100 rounded-full overflow-hidden",barClassName:n="h-full bg-gray-900",height:i="h-2"})=>e.jsx("div",{className:`${i} ${s}`,children:e.jsx(he.div,{initial:{width:0},animate:{width:`${t}%`},transition:{duration:oo.slow,ease:"easeOut"},className:n})}),We=({value:t,className:s="",duration:n=oo.slow,prefix:i="",suffix:r=""})=>{const a=uT(t,n);return e.jsxs("span",{className:s,children:[i,a.toLocaleString("pl-PL"),r]})},mT=()=>e.jsxs("div",{className:"rounded-2xl border bg-card p-5 shadow-soft animate-pulse",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"h-8 w-8 rounded-md bg-muted/70"}),e.jsx("div",{className:"h-4 w-40 rounded bg-muted/70"})]}),e.jsx("div",{className:"h-5 w-16 rounded-full bg-muted/70"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"h-2 w-full rounded-full bg-muted/60"}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsx("div",{className:"h-3 w-16 rounded bg-muted/60"}),e.jsx("div",{className:"h-3 w-20 rounded bg-muted/60"})]})]}),e.jsx("div",{className:"mt-4 h-9 w-2/3 rounded-lg bg-muted/60"}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsx("div",{className:"h-6 w-16 rounded bg-muted/60"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"h-9 w-24 rounded-lg bg-muted/60"}),e.jsx("div",{className:"h-9 w-10 rounded-lg bg-muted/60"})]})]})]}),hT=()=>{const t=me(),{data:s}=Le(),{stats:n,refetch:i}=_n(),{data:r,isLoading:a}=Dr("get_my_courses"),[o,l]=ee.useState(0),c=r||[],d=!a&&c.length===0;ee.useEffect(()=>{const u=async()=>{try{const{data:p}=await Q.rpc("check_claimable_rewards");l(p?.claimable_points||0)}catch{}};u();const h=setInterval(u,3e4);return()=>clearInterval(h)},[]);const m=async()=>{try{const{data:u,error:h}=await Q.rpc("claim_daily_rewards");if(h)throw h;u&&(H.success(`Odebrano ${u.total_earned} punktów`),i(),l(0))}catch{H.error("Nie można odebrać nagród")}};return e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8 pb-24 lg:pb-8",children:[e.jsxs(he.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.45},className:"relative overflow-hidden rounded-2xl border",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/[0.12] via-secondary/[0.10] to-accent/[0.12]"}),e.jsx("div",{className:"absolute inset-0 opacity-[0.06]",style:{backgroundImage:`
                linear-gradient(to right, hsl(var(--ring)/0.35) 1px, transparent 1px),
                linear-gradient(to bottom, hsl(var(--ring)/0.35) 1px, transparent 1px)
              `,backgroundSize:"28px 28px"}})]}),e.jsxs("div",{className:"relative z-10 p-4 sm:p-6 md:p-8",children:[e.jsxs("div",{className:"space-y-6 md:hidden",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-xl font-bold tracking-tight",children:"Twoje tempo nauki"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.streak>0&&e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full border bg-background/60 px-3 py-1.5 shadow-soft",children:[e.jsx(Zt,{className:"h-4 w-4 text-destructive"}),e.jsxs("span",{className:"text-sm font-medium",children:["Seria: ",e.jsx("span",{className:"tabular-nums",children:n.streak})," ","dni"]})]}),o>0&&e.jsxs("button",{onClick:m,className:"inline-flex items-center gap-2 rounded-lg bg-primary px-3 py-1.5 text-sm text-primary-foreground hover:bg-primary/90 focus-ring",children:[e.jsx(Ed,{className:"h-4 w-4"}),"Odbierz ",o," pkt"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:"rounded-xl border bg-card p-4 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Punkty"}),e.jsx(Ue,{className:"h-4 w-4 text-primary"})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("span",{className:"text-3xl font-semibold tabular-nums text-primary leading-none",children:e.jsx(We,{value:n.points})}),e.jsx("span",{className:"mb-1 text-sm text-muted-foreground",children:"pkt"})]}),e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:["+",e.jsx(We,{value:n.idle_rate}),"/h"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded-xl border bg-card p-4 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Poziom"}),e.jsx(gn,{className:"h-4 w-4 text-secondary"})]}),e.jsx("span",{className:"text-2xl font-semibold text-secondary",children:n.level}),e.jsx("div",{className:"mt-2 h-1.5 w-full rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-secondary transition-all",style:{width:`${n.points%100}%`}})})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-4 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Premia"}),e.jsx(st,{className:"h-4 w-4 text-accent"})]}),e.jsxs("span",{className:"text-2xl font-semibold text-accent",children:["+",e.jsx(We,{value:n.idle_rate})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"pkt/h"})]})]})]})]}),e.jsxs("div",{className:"hidden md:grid gap-8 md:grid-cols-12 md:items-center",children:[e.jsxs("div",{className:"md:col-span-4 space-y-4",children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Twoje tempo nauki"}),n.streak>0&&e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full border bg-background/60 px-3 py-1.5 shadow-soft",children:[e.jsx(Zt,{className:"h-4 w-4 text-destructive"}),e.jsxs("span",{className:"text-sm font-medium",children:["Seria: ",e.jsx("span",{className:"tabular-nums",children:n.streak})," ","dni"]})]}),o>0&&e.jsxs("button",{onClick:m,className:"inline-flex items-center gap-2 rounded-lg bg-primary px-4 py-2 text-primary-foreground hover:bg-primary/90 focus-ring",children:[e.jsx(Ed,{className:"h-4 w-4"}),"Odbierz ",o," pkt"]})]}),e.jsx("div",{className:"md:col-span-8",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 md:gap-6",children:[e.jsxs("div",{className:"rounded-xl border bg-card p-5 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Punkty"}),e.jsx(Ue,{className:"h-4 w-4 text-primary"})]}),e.jsxs("div",{className:"mt-2 flex items-end gap-2",children:[e.jsx("span",{className:"text-4xl md:text-5xl font-semibold tabular-nums text-primary leading-none",children:e.jsx(We,{value:n.points})}),e.jsx("span",{className:"mb-[2px] text-sm text-muted-foreground",children:"pkt"})]}),e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:["+",e.jsx(We,{value:n.idle_rate}),"/h"]})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-5 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Poziom"}),e.jsx(gn,{className:"h-4 w-4 text-secondary"})]}),e.jsx("div",{className:"mt-2 flex items-center gap-2",children:e.jsx("span",{className:"text-4xl md:text-5xl font-semibold text-secondary leading-none",children:n.level})}),e.jsx("div",{className:"mt-3 h-2 w-full rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-secondary transition-all",style:{width:`${n.points%100}%`}})}),e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:["Do kolejnego: ",100-n.points%100," pkt"]})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-5 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Premia"}),e.jsx(st,{className:"h-4 w-4 text-accent"})]}),e.jsxs("div",{className:"mt-2 flex items-end gap-2",children:[e.jsxs("span",{className:"text-4xl md:text-5xl font-semibold text-accent leading-none",children:["+",e.jsx(We,{value:n.idle_rate})]}),e.jsx("span",{className:"mb-[2px] text-sm text-muted-foreground",children:"pkt/h"})]}),e.jsx("button",{onClick:()=>t("/student/gamification"),className:"mt-3 w-full rounded-lg border px-3 py-2 hover:bg-primary/5 focus-ring",children:"Gamifikacja"})]})]})})]})]})]}),e.jsxs(he.section,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.4,delay:.05},className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-lg sm:text-xl md:text-2xl font-semibold tracking-tight",children:"Twoje kursy"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"To jest Twoja główna ścieżka — kontynuuj naukę tam, gdzie skończyłeś."})]}),e.jsxs("button",{onClick:()=>t("/student/courses"),className:"inline-flex items-center gap-1 sm:gap-2 rounded-lg border px-2 sm:px-3 py-1.5 sm:py-2 text-sm hover:bg-primary/5 focus-ring whitespace-nowrap",children:[e.jsx("span",{className:"hidden sm:inline",children:"Zobacz wszystkie"}),e.jsx("span",{className:"sm:hidden",children:"Wszystkie"}),e.jsx(Fe,{className:"h-4 w-4"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-5",children:[a&&Array.from({length:6}).map((u,h)=>e.jsx(mT,{},h)),!a&&c.slice(0,9).map(u=>{const h=u.progress_percent===100;return e.jsxs("div",{className:"group relative rounded-2xl border bg-card p-4 sm:p-5 shadow-soft hover:bg-muted/40 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("span",{className:"text-2xl sm:text-3xl shrink-0 leading-none",children:u.icon_emoji||"📚"}),e.jsx("h4",{className:"font-semibold text-sm sm:text-base text-foreground line-clamp-2",children:u.title})]}),h?e.jsx("span",{className:"inline-flex items-center gap-1 rounded-full border border-green-600/30 bg-green-500/10 text-green-700 dark:text-green-400 px-2 sm:px-2.5 py-0.5 sm:py-1 text-[10px] sm:text-[11px] font-semibold",children:"Ukończono"}):e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-primary/30 text-primary px-2 sm:px-2.5 py-0.5 sm:py-1 text-[10px] sm:text-[11px] font-semibold",children:[u.progress_percent,"%"]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"h-2 w-full rounded-full bg-muted",children:e.jsx("div",{className:`h-full rounded-full transition-all ${h?"bg-green-600":"bg-primary"}`,style:{width:`${u.progress_percent||0}%`}})}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"Ukończono"}),e.jsxs("span",{className:"font-medium text-foreground",children:[u.completed_lessons||0,"/",u.total_lessons||10," lekcji"]})]})]}),u.next_activity&&e.jsxs("div",{className:"mt-3 sm:mt-4 flex items-center gap-2 rounded-lg border bg-background/60 px-2.5 sm:px-3 py-1.5 sm:py-2",children:[e.jsx(pb,{className:"h-3.5 sm:h-4 w-3.5 sm:w-4 text-primary"}),e.jsx("p",{className:"text-xs sm:text-sm font-medium truncate",children:u.next_activity})]}),e.jsxs("div",{className:"mt-3 sm:mt-4 flex items-center justify-between",children:[u.points_available?e.jsxs("span",{className:"inline-flex rounded-md bg-orange-500/10 text-[10px] sm:text-[11px] font-semibold px-2 py-0.5 sm:py-1 text-orange-600",children:["+",u.points_available," pkt"]}):e.jsx("span",{}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>t(`/student/courses/${u.course_id}`),className:"rounded-lg bg-primary px-3 sm:px-4 py-1.5 sm:py-2 text-sm text-primary-foreground hover:bg-primary/90 focus-ring",children:"Kontynuuj"}),e.jsx("button",{onClick:()=>t(`/student/courses/${u.course_id}`),className:"rounded-lg border px-2.5 sm:px-3 py-1.5 sm:py-2 hover:bg-primary/5 focus-ring",title:"Szczegóły",children:e.jsx(Fe,{className:"h-3.5 sm:h-4 w-3.5 sm:w-4"})})]})]})]},u.course_id)}),d&&e.jsxs("div",{className:"col-span-full rounded-2xl border bg-card p-8 sm:p-10 text-center shadow-soft",children:[e.jsx("div",{className:"text-4xl sm:text-5xl",children:"🚀"}),e.jsx("h4",{className:"mt-3 sm:mt-4 text-base sm:text-lg font-semibold",children:"Zacznij swoją przygodę"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:"Dołącz do kursu i odkryj nowy sposób nauki."}),e.jsx("button",{onClick:()=>t("/student/courses"),className:"mt-4 sm:mt-6 rounded-lg bg-secondary px-4 sm:px-5 py-2 sm:py-2.5 text-sm text-white hover:opacity-95 focus-ring",children:"Odkryj kursy"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"rounded-xl border bg-card/70 backdrop-blur-sm p-4 sm:p-5 shadow-md",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground font-medium",children:"Punkty"}),e.jsx(Ue,{className:"h-3.5 sm:h-4 w-3.5 sm:w-4 text-primary"})]}),e.jsx("p",{className:"mt-1.5 text-xl sm:text-2xl font-semibold tabular-nums text-foreground",children:e.jsx(We,{value:n.points})}),e.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:["+",e.jsx(We,{value:n.idle_rate}),"/h"]})]}),e.jsxs("div",{className:"rounded-xl border bg-card/70 backdrop-blur-sm p-4 sm:p-5 shadow-md",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground font-medium",children:"Poziom"}),e.jsx(De,{className:"h-3.5 sm:h-4 w-3.5 sm:w-4 text-secondary"})]}),e.jsx("p",{className:"mt-1.5 text-xl sm:text-2xl font-semibold text-foreground",children:n.level}),e.jsx("div",{className:"mt-2 sm:mt-3",children:e.jsx(bn,{value:n.points%100})})]}),e.jsxs("div",{className:"rounded-xl border bg-card/70 backdrop-blur-sm p-4 sm:p-5 shadow-md",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground font-medium",children:"Seria dni"}),e.jsx(Zt,{className:"h-3.5 sm:h-4 w-3.5 sm:w-4 text-destructive"})]}),e.jsx("p",{className:"mt-1.5 text-xl sm:text-2xl font-semibold text-foreground",children:e.jsx(We,{value:n.streak})}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:"dni z rzędu"})]}),e.jsxs("div",{className:"rounded-xl border bg-card/70 backdrop-blur-sm p-4 sm:p-5 shadow-md",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground font-medium",children:"Tempo"}),e.jsx(st,{className:"h-3.5 sm:h-4 w-3.5 sm:w-4 text-accent"})]}),e.jsxs("p",{className:"mt-1.5 text-xl sm:text-2xl font-semibold text-foreground",children:["+",e.jsx(We,{value:n.idle_rate})]}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground mt-0.5",children:"punktów/h"})]})]})]})},fT=[e.jsx(V,{path:"dashboard",element:e.jsx(hT,{})},"dashboard")],pT=()=>{const t=me(),{data:s}=Dr("get_my_courses"),n=s||[];return e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8 pb-24 lg:pb-8",children:[e.jsxs(he.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.45},className:"relative overflow-hidden rounded-2xl border",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0",children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/[0.12] via-secondary/[0.10] to-accent/[0.12]"})}),e.jsxs("div",{className:"relative z-10 p-4 sm:p-6 md:p-8",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Twoje kursy"}),e.jsx("p",{className:"mt-2 text-sm md:text-base text-muted-foreground",children:"Wybierz kurs i kontynuuj naukę w swoim tempie."})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-5",children:n.map((i,r)=>e.jsxs(vi,{index:r,className:"group relative rounded-2xl border bg-card p-4 sm:p-5 shadow-soft hover:bg-muted/40 transition-colors cursor-pointer",onClick:()=>t(`/student/courses/${i.course_id}`),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("span",{className:"text-2xl sm:text-3xl shrink-0 leading-none",children:i.icon_emoji||"📚"}),e.jsx("h4",{className:"font-semibold text-sm sm:text-base text-foreground line-clamp-2",children:i.title})]}),e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-primary/30 text-primary px-2 sm:px-2.5 py-0.5 sm:py-1 text-[10px] sm:text-[11px] font-semibold",children:[i.progress_percent,"%"]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(bn,{value:i.progress_percent})}),e.jsxs("button",{className:"mt-4 inline-flex items-center gap-1 text-sm font-medium text-primary",children:["Kontynuuj",e.jsx(Fe,{className:"h-4 w-4"})]})]},i.course_id))})]})},xT=[e.jsx(V,{path:"/courses",element:e.jsx(pT,{})},"courses-list")],gT=()=>e.jsxs("div",{className:"rounded-2xl border bg-card p-5 md:p-6 shadow-soft animate-pulse",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-muted/60"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-5 w-1/2 rounded bg-muted/60"}),e.jsx("div",{className:"h-4 w-3/4 rounded bg-muted/60"})]}),e.jsx("div",{className:"h-9 w-36 rounded-lg bg-muted/60"})]}),e.jsxs("div",{className:"mt-5",children:[e.jsx("div",{className:"h-2 w-full rounded-full bg-muted/60"}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsx("div",{className:"h-3 w-16 rounded bg-muted/60"}),e.jsx("div",{className:"h-3 w-10 rounded bg-muted/60"})]})]})]}),jT=()=>e.jsxs("div",{className:"rounded-2xl border bg-card p-4 md:p-5 shadow-soft animate-pulse",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-muted/60"}),e.jsx("div",{className:"h-4 w-2/5 rounded bg-muted/60"})]}),e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((t,s)=>e.jsx("div",{className:"h-14 rounded-xl border bg-muted/40"},s))})]}),yT=()=>{const{courseId:t}=mt(),s=me(),{data:n,isLoading:i}=Dr("get_course_structure",{p_course_id:parseInt(t)},{enabled:!!t}),{data:r}=zS("courses",{filters:[{field:"id",operator:"eq",value:parseInt(t)}],enabled:!!t}),a=ee.useMemo(()=>{if(!n)return[];const d=n.reduce((h,p)=>{const j=`${p.topic_id}-${p.topic_title}`;return h[j]||(h[j]={id:p.topic_id,title:p.topic_title,position:p.topic_position,activities:[]}),p.activity_id&&h[j].activities.push({id:p.activity_id,title:p.activity_title,type:p.activity_type,position:p.activity_position,completed:p.is_completed,score:p.score}),h},{}),m=Object.values(d).sort((h,p)=>h.position-p.position);let u=!1;return m.map((h,p)=>{const j=h.activities.length>0&&h.activities.every(b=>b.completed),x=p===0||m[p-1].activities.length>0&&m[p-1].activities.every(b=>b.completed);return h.activities.sort((b,w)=>b.position-w.position),h.activities=h.activities.map(b=>{let w=!1;return b.completed?w=!0:x&&!u&&(w=!0,u=!0),{...b,isUnlocked:w}}),{...h,isCompleted:j,isUnlocked:x}})},[n]),o=ee.useMemo(()=>{const d=a.flatMap(h=>h.activities),m=d.filter(h=>h.completed).length,u=d.length;return{totalActivities:u,completedActivities:m,progress:u>0?Math.round(m/u*100):0}},[a]),l=r?.[0],c=ee.useMemo(()=>{for(const d of a){const m=d.activities.find(u=>!u.completed&&u.isUnlocked);if(m)return{topicId:d.id,activity:m,path:m.type==="quiz"?`/student/courses/${t}/quiz/${m.id}`:`/student/courses/${t}/lesson/${m.id}`}}return null},[a,t]);return i?e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8",children:[e.jsxs("button",{className:"inline-flex items-center gap-2 text-muted-foreground cursor-default",disabled:!0,children:[e.jsx(ge,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Powrót"})]}),e.jsx(gT,{}),e.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((d,m)=>e.jsx(jT,{},m))})]}):l?e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8 pb-24 lg:pb-8",children:[e.jsxs("button",{onClick:()=>s("/student/dashboard#courses"),className:"flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx(ge,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Powrót"})]}),e.jsxs(he.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.45},className:"relative overflow-hidden rounded-2xl border",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/[0.12] via-secondary/[0.10] to-accent/[0.12]"}),e.jsx("div",{className:"absolute inset-0 opacity-[0.06]",style:{backgroundImage:`
                linear-gradient(to right, hsl(var(--ring)/0.35) 1px, transparent 1px),
                linear-gradient(to bottom, hsl(var(--ring)/0.35) 1px, transparent 1px)
              `,backgroundSize:"28px 28px"}})]}),e.jsx("div",{className:"relative z-10 p-4 sm:p-6 md:p-8",children:e.jsxs("div",{className:"grid md:grid-cols-12 gap-6 md:items-center",children:[e.jsxs("div",{className:"md:col-span-7 flex items-start gap-4 min-w-0",children:[e.jsx("div",{className:"text-5xl md:text-6xl leading-none shrink-0",children:l.icon_emoji||"📚"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-xl md:text-3xl font-bold tracking-tight",children:l.title}),l.description&&e.jsx("p",{className:"mt-2 text-sm md:text-base text-muted-foreground line-clamp-3",children:l.description}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border bg-background/60 px-3 py-1.5 shadow-soft",children:[e.jsx(Ve,{className:"h-4 w-4"}),e.jsxs("span",{className:"text-sm font-medium",children:["Ukończone:"," ",e.jsx("span",{className:"tabular-nums",children:e.jsx(We,{value:o.completedActivities})}),"/",o.totalActivities]})]}),o.progress===100&&e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-green-600/30 bg-green-500/10 text-green-700 dark:text-green-400 px-3 py-1.5 shadow-soft text-sm font-semibold",children:[e.jsx(Ge,{className:"h-4 w-4"}),"Kurs ukończony"]})]})]})]}),e.jsx("div",{className:"md:col-span-5",children:e.jsxs("div",{className:"rounded-xl border bg-card p-4 md:p-5 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Postęp kursu"}),e.jsxs("span",{className:"text-sm font-semibold",children:[o.progress,"%"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx(bn,{value:o.progress})}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[c?e.jsxs("button",{onClick:()=>s(c.path),className:"flex-1 inline-flex items-center justify-center gap-2 rounded-lg bg-primary px-4 py-2 text-primary-foreground hover:bg-primary/90 focus-ring",children:["Kontynuuj",e.jsx(Fe,{className:"h-4 w-4"})]}):e.jsx("button",{disabled:!0,className:"flex-1 rounded-lg border px-4 py-2 text-muted-foreground cursor-default",title:"Brak kolejnej aktywności",children:"Wszystko ukończone"}),e.jsx("button",{onClick:()=>s("/student/courses"),className:"rounded-lg border px-3 py-2 hover:bg-primary/5 focus-ring",title:"Wróć do listy",children:e.jsx(ge,{className:"h-4 w-4"})})]})]})})]})})]}),e.jsx("div",{className:"space-y-6",children:a.map((d,m)=>e.jsxs(vi,{index:m,className:F("relative rounded-2xl border bg-card p-4 md:p-5 shadow-soft",!d.isUnlocked&&"opacity-60"),children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-3 md:mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:F("w-10 h-10 rounded-full flex items-center justify-center",d.isCompleted?"bg-green-600 text-white":d.isUnlocked?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground"),"aria-label":d.isCompleted?"Temat ukończony":d.isUnlocked?"Temat odblokowany":"Temat zablokowany",children:d.isCompleted?e.jsx(Ge,{className:"w-5 h-5"}):d.isUnlocked?e.jsx("span",{className:"font-semibold",children:d.position}):e.jsx(un,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-base md:text-lg font-semibold text-foreground",children:d.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[d.activities.filter(u=>u.completed).length," ","z ",d.activities.length," ukończonych"]})]})]}),e.jsx("div",{className:"hidden md:block w-40",children:e.jsx(bn,{value:d.activities.length?Math.round(d.activities.filter(u=>u.completed).length/d.activities.length*100):0})})]}),e.jsx("div",{className:"mt-3 md:mt-4 space-y-3",children:d.activities.map(u=>{const h=u.type==="quiz",p=u.type==="quiz"?`/student/courses/${t}/quiz/${u.id}`:`/student/courses/${t}/lesson/${u.id}`;return e.jsxs(he.button,{whileHover:u.isUnlocked?{x:2}:{},whileTap:u.isUnlocked?{scale:.98}:{},onClick:()=>{u.isUnlocked&&s(p)},disabled:!u.isUnlocked,className:F("w-full flex items-center justify-between p-4 rounded-xl border transition-colors focus-ring",u.isUnlocked?"bg-background/60 hover:bg-primary/5":"bg-muted/40 cursor-not-allowed"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:F("w-8 h-8 rounded-lg flex items-center justify-center shrink-0",h?u.isUnlocked?"bg-purple-100":"bg-muted":u.isUnlocked?"bg-blue-100":"bg-muted"),children:u.isUnlocked?h?e.jsx(Ue,{className:"w-4 h-4 text-purple-600"}):e.jsx(Ve,{className:"w-4 h-4 text-blue-600"}):e.jsx(un,{className:"w-4 h-4 text-muted-foreground"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:F("font-medium",u.isUnlocked?"text-foreground":"text-muted-foreground"),children:u.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[h?"Quiz":"Materiał",u.score!==null&&` • ${u.score}%`,!u.isUnlocked&&" • Zablokowane"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[!u.completed&&u.isUnlocked&&e.jsx("span",{className:"hidden sm:inline text-xs text-muted-foreground",children:"Przejdź"}),u.completed?e.jsx(Ge,{className:"w-5 h-5 text-green-600"}):u.isUnlocked?e.jsx(Fe,{className:"w-5 h-5 text-muted-foreground"}):e.jsx(un,{className:"w-4 h-4 text-muted-foreground"})]})]},u.id)})})]},d.id))})]}):e.jsxs("div",{className:"container mx-auto px-4 py-12 text-center",children:[e.jsx("div",{className:"text-5xl",children:"🤷‍♂️"}),e.jsx("h2",{className:"mt-3 text-xl font-semibold",children:"Nie znaleziono kursu"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Spróbuj wrócić do listy kursów i wybrać ponownie."}),e.jsx("button",{onClick:()=>s("/student/courses"),className:"mt-6 rounded-lg bg-primary px-4 py-2 text-primary-foreground hover:bg-primary/90 focus-ring",children:"Przejdź do kursów"})]})},bT=[e.jsx(V,{path:"/courses/:courseId",element:e.jsx(yT,{})},"course-detail")],dd=Symbol.for("yaml.alias"),Vl=Symbol.for("yaml.document"),Bs=Symbol.for("yaml.map"),Ug=Symbol.for("yaml.pair"),os=Symbol.for("yaml.scalar"),Ni=Symbol.for("yaml.seq"),Mt=Symbol.for("yaml.node.type"),Js=t=>!!t&&typeof t=="object"&&t[Mt]===dd,Tn=t=>!!t&&typeof t=="object"&&t[Mt]===Vl,ki=t=>!!t&&typeof t=="object"&&t[Mt]===Bs,je=t=>!!t&&typeof t=="object"&&t[Mt]===Ug,ue=t=>!!t&&typeof t=="object"&&t[Mt]===os,zi=t=>!!t&&typeof t=="object"&&t[Mt]===Ni;function be(t){if(t&&typeof t=="object")switch(t[Mt]){case Bs:case Ni:return!0}return!1}function Ne(t){if(t&&typeof t=="object")switch(t[Mt]){case dd:case Bs:case os:case Ni:return!0}return!1}const Vg=t=>(ue(t)||be(t))&&!!t.anchor,ot=Symbol("break visit"),qg=Symbol("skip children"),ts=Symbol("remove node");function An(t,s){const n=Kg(s);Tn(t)?Wn(null,t.contents,n,Object.freeze([t]))===ts&&(t.contents=null):Wn(null,t,n,Object.freeze([]))}An.BREAK=ot;An.SKIP=qg;An.REMOVE=ts;function Wn(t,s,n,i){const r=Wg(t,s,n,i);if(Ne(r)||je(r))return Gg(t,i,r),Wn(t,r,n,i);if(typeof r!="symbol"){if(be(s)){i=Object.freeze(i.concat(s));for(let a=0;a<s.items.length;++a){const o=Wn(a,s.items[a],n,i);if(typeof o=="number")a=o-1;else{if(o===ot)return ot;o===ts&&(s.items.splice(a,1),a-=1)}}}else if(je(s)){i=Object.freeze(i.concat(s));const a=Wn("key",s.key,n,i);if(a===ot)return ot;a===ts&&(s.key=null);const o=Wn("value",s.value,n,i);if(o===ot)return ot;o===ts&&(s.value=null)}}return r}async function lo(t,s){const n=Kg(s);Tn(t)?await Gn(null,t.contents,n,Object.freeze([t]))===ts&&(t.contents=null):await Gn(null,t,n,Object.freeze([]))}lo.BREAK=ot;lo.SKIP=qg;lo.REMOVE=ts;async function Gn(t,s,n,i){const r=await Wg(t,s,n,i);if(Ne(r)||je(r))return Gg(t,i,r),Gn(t,r,n,i);if(typeof r!="symbol"){if(be(s)){i=Object.freeze(i.concat(s));for(let a=0;a<s.items.length;++a){const o=await Gn(a,s.items[a],n,i);if(typeof o=="number")a=o-1;else{if(o===ot)return ot;o===ts&&(s.items.splice(a,1),a-=1)}}}else if(je(s)){i=Object.freeze(i.concat(s));const a=await Gn("key",s.key,n,i);if(a===ot)return ot;a===ts&&(s.key=null);const o=await Gn("value",s.value,n,i);if(o===ot)return ot;o===ts&&(s.value=null)}}return r}function Kg(t){return typeof t=="object"&&(t.Collection||t.Node||t.Value)?Object.assign({Alias:t.Node,Map:t.Node,Scalar:t.Node,Seq:t.Node},t.Value&&{Map:t.Value,Scalar:t.Value,Seq:t.Value},t.Collection&&{Map:t.Collection,Seq:t.Collection},t):t}function Wg(t,s,n,i){if(typeof n=="function")return n(t,s,i);if(ki(s))return n.Map?.(t,s,i);if(zi(s))return n.Seq?.(t,s,i);if(je(s))return n.Pair?.(t,s,i);if(ue(s))return n.Scalar?.(t,s,i);if(Js(s))return n.Alias?.(t,s,i)}function Gg(t,s,n){const i=s[s.length-1];if(be(i))i.items[t]=n;else if(je(i))t==="key"?i.key=n:i.value=n;else if(Tn(i))i.contents=n;else{const r=Js(i)?"alias":"scalar";throw new Error(`Cannot replace node with ${r} parent`)}}const wT={"!":"%21",",":"%2C","[":"%5B","]":"%5D","{":"%7B","}":"%7D"},vT=t=>t.replace(/[!,[\]{}]/g,s=>wT[s]);class et{constructor(s,n){this.docStart=null,this.docEnd=!1,this.yaml=Object.assign({},et.defaultYaml,s),this.tags=Object.assign({},et.defaultTags,n)}clone(){const s=new et(this.yaml,this.tags);return s.docStart=this.docStart,s}atDocument(){const s=new et(this.yaml,this.tags);switch(this.yaml.version){case"1.1":this.atNextDocument=!0;break;case"1.2":this.atNextDocument=!1,this.yaml={explicit:et.defaultYaml.explicit,version:"1.2"},this.tags=Object.assign({},et.defaultTags);break}return s}add(s,n){this.atNextDocument&&(this.yaml={explicit:et.defaultYaml.explicit,version:"1.1"},this.tags=Object.assign({},et.defaultTags),this.atNextDocument=!1);const i=s.trim().split(/[ \t]+/),r=i.shift();switch(r){case"%TAG":{if(i.length!==2&&(n(0,"%TAG directive should contain exactly two parts"),i.length<2))return!1;const[a,o]=i;return this.tags[a]=o,!0}case"%YAML":{if(this.yaml.explicit=!0,i.length!==1)return n(0,"%YAML directive should contain exactly one part"),!1;const[a]=i;if(a==="1.1"||a==="1.2")return this.yaml.version=a,!0;{const o=/^\d+\.\d+$/.test(a);return n(6,`Unsupported YAML version ${a}`,o),!1}}default:return n(0,`Unknown directive ${r}`,!0),!1}}tagName(s,n){if(s==="!")return"!";if(s[0]!=="!")return n(`Not a valid tag: ${s}`),null;if(s[1]==="<"){const o=s.slice(2,-1);return o==="!"||o==="!!"?(n(`Verbatim tags aren't resolved, so ${s} is invalid.`),null):(s[s.length-1]!==">"&&n("Verbatim tags must end with a >"),o)}const[,i,r]=s.match(/^(.*!)([^!]*)$/s);r||n(`The ${s} tag has no suffix`);const a=this.tags[i];if(a)try{return a+decodeURIComponent(r)}catch(o){return n(String(o)),null}return i==="!"?s:(n(`Could not resolve tag: ${s}`),null)}tagString(s){for(const[n,i]of Object.entries(this.tags))if(s.startsWith(i))return n+vT(s.substring(i.length));return s[0]==="!"?s:`!<${s}>`}toString(s){const n=this.yaml.explicit?[`%YAML ${this.yaml.version||"1.2"}`]:[],i=Object.entries(this.tags);let r;if(s&&i.length>0&&Ne(s.contents)){const a={};An(s.contents,(o,l)=>{Ne(l)&&l.tag&&(a[l.tag]=!0)}),r=Object.keys(a)}else r=[];for(const[a,o]of i)a==="!!"&&o==="tag:yaml.org,2002:"||(!s||r.some(l=>l.startsWith(o)))&&n.push(`%TAG ${a} ${o}`);return n.join(`
`)}}et.defaultYaml={explicit:!1,version:"1.2"};et.defaultTags={"!!":"tag:yaml.org,2002:"};function Hg(t){if(/[\x00-\x19\s,[\]{}]/.test(t)){const n=`Anchor must not contain whitespace or control characters: ${JSON.stringify(t)}`;throw new Error(n)}return!0}function Zg(t){const s=new Set;return An(t,{Value(n,i){i.anchor&&s.add(i.anchor)}}),s}function Qg(t,s){for(let n=1;;++n){const i=`${t}${n}`;if(!s.has(i))return i}}function NT(t,s){const n=[],i=new Map;let r=null;return{onAnchor:a=>{n.push(a),r??(r=Zg(t));const o=Qg(s,r);return r.add(o),o},setAnchors:()=>{for(const a of n){const o=i.get(a);if(typeof o=="object"&&o.anchor&&(ue(o.node)||be(o.node)))o.node.anchor=o.anchor;else{const l=new Error("Failed to resolve repeated object (this should not happen)");throw l.source=a,l}}},sourceObjects:i}}function Hn(t,s,n,i){if(i&&typeof i=="object")if(Array.isArray(i))for(let r=0,a=i.length;r<a;++r){const o=i[r],l=Hn(t,i,String(r),o);l===void 0?delete i[r]:l!==o&&(i[r]=l)}else if(i instanceof Map)for(const r of Array.from(i.keys())){const a=i.get(r),o=Hn(t,i,r,a);o===void 0?i.delete(r):o!==a&&i.set(r,o)}else if(i instanceof Set)for(const r of Array.from(i)){const a=Hn(t,i,r,r);a===void 0?i.delete(r):a!==r&&(i.delete(r),i.add(a))}else for(const[r,a]of Object.entries(i)){const o=Hn(t,i,r,a);o===void 0?delete i[r]:o!==a&&(i[r]=o)}return t.call(s,n,i)}function Dt(t,s,n){if(Array.isArray(t))return t.map((i,r)=>Dt(i,String(r),n));if(t&&typeof t.toJSON=="function"){if(!n||!Vg(t))return t.toJSON(s,n);const i={aliasCount:0,count:1,res:void 0};n.anchors.set(t,i),n.onCreate=a=>{i.res=a,delete n.onCreate};const r=t.toJSON(s,n);return n.onCreate&&n.onCreate(r),r}return typeof t=="bigint"&&!n?.keep?Number(t):t}class ud{constructor(s){Object.defineProperty(this,Mt,{value:s})}clone(){const s=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return this.range&&(s.range=this.range.slice()),s}toJS(s,{mapAsMap:n,maxAliasCount:i,onAnchor:r,reviver:a}={}){if(!Tn(s))throw new TypeError("A document argument is required");const o={anchors:new Map,doc:s,keep:!0,mapAsMap:n===!0,mapKeyWarned:!1,maxAliasCount:typeof i=="number"?i:100},l=Dt(this,"",o);if(typeof r=="function")for(const{count:c,res:d}of o.anchors.values())r(d,c);return typeof a=="function"?Hn(a,{"":l},"",l):l}}class co extends ud{constructor(s){super(dd),this.source=s,Object.defineProperty(this,"tag",{set(){throw new Error("Alias nodes cannot have tags")}})}resolve(s,n){let i;n?.aliasResolveCache?i=n.aliasResolveCache:(i=[],An(s,{Node:(a,o)=>{(Js(o)||Vg(o))&&i.push(o)}}),n&&(n.aliasResolveCache=i));let r;for(const a of i){if(a===this)break;a.anchor===this.source&&(r=a)}return r}toJSON(s,n){if(!n)return{source:this.source};const{anchors:i,doc:r,maxAliasCount:a}=n,o=this.resolve(r,n);if(!o){const c=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new ReferenceError(c)}let l=i.get(o);if(l||(Dt(o,null,n),l=i.get(o)),!l||l.res===void 0){const c="This should not happen: Alias anchor was not resolved?";throw new ReferenceError(c)}if(a>=0&&(l.count+=1,l.aliasCount===0&&(l.aliasCount=aa(r,o,i)),l.count*l.aliasCount>a)){const c="Excessive alias count indicates a resource exhaustion attack";throw new ReferenceError(c)}return l.res}toString(s,n,i){const r=`*${this.source}`;if(s){if(Hg(this.source),s.options.verifyAliasOrder&&!s.anchors.has(this.source)){const a=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new Error(a)}if(s.implicitKey)return`${r} `}return r}}function aa(t,s,n){if(Js(s)){const i=s.resolve(t),r=n&&i&&n.get(i);return r?r.count*r.aliasCount:0}else if(be(s)){let i=0;for(const r of s.items){const a=aa(t,r,n);a>i&&(i=a)}return i}else if(je(s)){const i=aa(t,s.key,n),r=aa(t,s.value,n);return Math.max(i,r)}return 1}const Yg=t=>!t||typeof t!="function"&&typeof t!="object";class te extends ud{constructor(s){super(os),this.value=s}toJSON(s,n){return n?.keep?this.value:Dt(this.value,s,n)}toString(){return String(this.value)}}te.BLOCK_FOLDED="BLOCK_FOLDED";te.BLOCK_LITERAL="BLOCK_LITERAL";te.PLAIN="PLAIN";te.QUOTE_DOUBLE="QUOTE_DOUBLE";te.QUOTE_SINGLE="QUOTE_SINGLE";const kT="tag:yaml.org,2002:";function zT(t,s,n){if(s){const i=n.filter(a=>a.tag===s),r=i.find(a=>!a.format)??i[0];if(!r)throw new Error(`Tag ${s} not found`);return r}return n.find(i=>i.identify?.(t)&&!i.format)}function jr(t,s,n){if(Tn(t)&&(t=t.contents),Ne(t))return t;if(je(t)){const u=n.schema[Bs].createNode?.(n.schema,null,n);return u.items.push(t),u}(t instanceof String||t instanceof Number||t instanceof Boolean||typeof BigInt<"u"&&t instanceof BigInt)&&(t=t.valueOf());const{aliasDuplicateObjects:i,onAnchor:r,onTagObj:a,schema:o,sourceObjects:l}=n;let c;if(i&&t&&typeof t=="object"){if(c=l.get(t),c)return c.anchor??(c.anchor=r(t)),new co(c.anchor);c={anchor:null,node:null},l.set(t,c)}s?.startsWith("!!")&&(s=kT+s.slice(2));let d=zT(t,s,o.tags);if(!d){if(t&&typeof t.toJSON=="function"&&(t=t.toJSON()),!t||typeof t!="object"){const u=new te(t);return c&&(c.node=u),u}d=t instanceof Map?o[Bs]:Symbol.iterator in Object(t)?o[Ni]:o[Bs]}a&&(a(d),delete n.onTagObj);const m=d?.createNode?d.createNode(n.schema,t,n):typeof d?.nodeClass?.from=="function"?d.nodeClass.from(n.schema,t,n):new te(t);return s?m.tag=s:d.default||(m.tag=d.tag),c&&(c.node=m),m}function Ca(t,s,n){let i=n;for(let r=s.length-1;r>=0;--r){const a=s[r];if(typeof a=="number"&&Number.isInteger(a)&&a>=0){const o=[];o[a]=i,i=o}else i=new Map([[a,i]])}return jr(i,void 0,{aliasDuplicateObjects:!1,keepUndefined:!1,onAnchor:()=>{throw new Error("This should not happen, please report a bug.")},schema:t,sourceObjects:new Map})}const Ui=t=>t==null||typeof t=="object"&&!!t[Symbol.iterator]().next().done;class Xg extends ud{constructor(s,n){super(s),Object.defineProperty(this,"schema",{value:n,configurable:!0,enumerable:!1,writable:!0})}clone(s){const n=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return s&&(n.schema=s),n.items=n.items.map(i=>Ne(i)||je(i)?i.clone(s):i),this.range&&(n.range=this.range.slice()),n}addIn(s,n){if(Ui(s))this.add(n);else{const[i,...r]=s,a=this.get(i,!0);if(be(a))a.addIn(r,n);else if(a===void 0&&this.schema)this.set(i,Ca(this.schema,r,n));else throw new Error(`Expected YAML collection at ${i}. Remaining path: ${r}`)}}deleteIn(s){const[n,...i]=s;if(i.length===0)return this.delete(n);const r=this.get(n,!0);if(be(r))return r.deleteIn(i);throw new Error(`Expected YAML collection at ${n}. Remaining path: ${i}`)}getIn(s,n){const[i,...r]=s,a=this.get(i,!0);return r.length===0?!n&&ue(a)?a.value:a:be(a)?a.getIn(r,n):void 0}hasAllNullValues(s){return this.items.every(n=>{if(!je(n))return!1;const i=n.value;return i==null||s&&ue(i)&&i.value==null&&!i.commentBefore&&!i.comment&&!i.tag})}hasIn(s){const[n,...i]=s;if(i.length===0)return this.has(n);const r=this.get(n,!0);return be(r)?r.hasIn(i):!1}setIn(s,n){const[i,...r]=s;if(r.length===0)this.set(i,n);else{const a=this.get(i,!0);if(be(a))a.setIn(r,n);else if(a===void 0&&this.schema)this.set(i,Ca(this.schema,r,n));else throw new Error(`Expected YAML collection at ${i}. Remaining path: ${r}`)}}}const ST=t=>t.replace(/^(?!$)(?: $)?/gm,"#");function js(t,s){return/^\n+$/.test(t)?t.substring(1):s?t.replace(/^(?! *$)/gm,s):t}const on=(t,s,n)=>t.endsWith(`
`)?js(n,s):n.includes(`
`)?`
`+js(n,s):(t.endsWith(" ")?"":" ")+n,Jg="flow",ql="block",oa="quoted";function uo(t,s,n="flow",{indentAtStart:i,lineWidth:r=80,minContentWidth:a=20,onFold:o,onOverflow:l}={}){if(!r||r<0)return t;r<a&&(a=0);const c=Math.max(1+a,1+r-s.length);if(t.length<=c)return t;const d=[],m={};let u=r-s.length;typeof i=="number"&&(i>r-Math.max(2,a)?d.push(0):u=r-i);let h,p,j=!1,x=-1,b=-1,w=-1;n===ql&&(x=Km(t,x,s.length),x!==-1&&(u=x+c));for(let v;v=t[x+=1];){if(n===oa&&v==="\\"){switch(b=x,t[x+1]){case"x":x+=3;break;case"u":x+=5;break;case"U":x+=9;break;default:x+=1}w=x}if(v===`
`)n===ql&&(x=Km(t,x,s.length)),u=x+s.length+c,h=void 0;else{if(v===" "&&p&&p!==" "&&p!==`
`&&p!=="	"){const _=t[x+1];_&&_!==" "&&_!==`
`&&_!=="	"&&(h=x)}if(x>=u)if(h)d.push(h),u=h+c,h=void 0;else if(n===oa){for(;p===" "||p==="	";)p=v,v=t[x+=1],j=!0;const _=x>w+1?x-2:b-1;if(m[_])return t;d.push(_),m[_]=!0,u=_+c,h=void 0}else j=!0}p=v}if(j&&l&&l(),d.length===0)return t;o&&o();let y=t.slice(0,d[0]);for(let v=0;v<d.length;++v){const _=d[v],C=d[v+1]||t.length;_===0?y=`
${s}${t.slice(0,C)}`:(n===oa&&m[_]&&(y+=`${t[_]}\\`),y+=`
${s}${t.slice(_+1,C)}`)}return y}function Km(t,s,n){let i=s,r=s+1,a=t[r];for(;a===" "||a==="	";)if(s<r+n)a=t[++s];else{do a=t[++s];while(a&&a!==`
`);i=s,r=s+1,a=t[r]}return i}const mo=(t,s)=>({indentAtStart:s?t.indent.length:t.indentAtStart,lineWidth:t.options.lineWidth,minContentWidth:t.options.minContentWidth}),ho=t=>/^(%|---|\.\.\.)/m.test(t);function CT(t,s,n){if(!s||s<0)return!1;const i=s-n,r=t.length;if(r<=i)return!1;for(let a=0,o=0;a<r;++a)if(t[a]===`
`){if(a-o>i)return!0;if(o=a+1,r-o<=i)return!1}return!0}function Xi(t,s){const n=JSON.stringify(t);if(s.options.doubleQuotedAsJSON)return n;const{implicitKey:i}=s,r=s.options.doubleQuotedMinMultiLineLength,a=s.indent||(ho(t)?"  ":"");let o="",l=0;for(let c=0,d=n[c];d;d=n[++c])if(d===" "&&n[c+1]==="\\"&&n[c+2]==="n"&&(o+=n.slice(l,c)+"\\ ",c+=1,l=c,d="\\"),d==="\\")switch(n[c+1]){case"u":{o+=n.slice(l,c);const m=n.substr(c+2,4);switch(m){case"0000":o+="\\0";break;case"0007":o+="\\a";break;case"000b":o+="\\v";break;case"001b":o+="\\e";break;case"0085":o+="\\N";break;case"00a0":o+="\\_";break;case"2028":o+="\\L";break;case"2029":o+="\\P";break;default:m.substr(0,2)==="00"?o+="\\x"+m.substr(2):o+=n.substr(c,6)}c+=5,l=c+1}break;case"n":if(i||n[c+2]==='"'||n.length<r)c+=1;else{for(o+=n.slice(l,c)+`

`;n[c+2]==="\\"&&n[c+3]==="n"&&n[c+4]!=='"';)o+=`
`,c+=2;o+=a,n[c+2]===" "&&(o+="\\"),c+=1,l=c+1}break;default:c+=1}return o=l?o+n.slice(l):n,i?o:uo(o,a,oa,mo(s,!1))}function Kl(t,s){if(s.options.singleQuote===!1||s.implicitKey&&t.includes(`
`)||/[ \t]\n|\n[ \t]/.test(t))return Xi(t,s);const n=s.indent||(ho(t)?"  ":""),i="'"+t.replace(/'/g,"''").replace(/\n+/g,`$&
${n}`)+"'";return s.implicitKey?i:uo(i,n,Jg,mo(s,!1))}function Zn(t,s){const{singleQuote:n}=s.options;let i;if(n===!1)i=Xi;else{const r=t.includes('"'),a=t.includes("'");r&&!a?i=Kl:a&&!r?i=Xi:i=n?Kl:Xi}return i(t,s)}let Wl;try{Wl=new RegExp(`(^|(?<!
))
+(?!
|$)`,"g")}catch{Wl=/\n+(?!\n|$)/g}function la({comment:t,type:s,value:n},i,r,a){const{blockQuote:o,commentString:l,lineWidth:c}=i.options;if(!o||/\n[\t ]+$/.test(n)||/^\s*$/.test(n))return Zn(n,i);const d=i.indent||(i.forceBlockIndent||ho(n)?"  ":""),m=o==="literal"?!0:o==="folded"||s===te.BLOCK_FOLDED?!1:s===te.BLOCK_LITERAL?!0:!CT(n,c,d.length);if(!n)return m?`|
`:`>
`;let u,h;for(h=n.length;h>0;--h){const C=n[h-1];if(C!==`
`&&C!=="	"&&C!==" ")break}let p=n.substring(h);const j=p.indexOf(`
`);j===-1?u="-":n===p||j!==p.length-1?(u="+",a&&a()):u="",p&&(n=n.slice(0,-p.length),p[p.length-1]===`
`&&(p=p.slice(0,-1)),p=p.replace(Wl,`$&${d}`));let x=!1,b,w=-1;for(b=0;b<n.length;++b){const C=n[b];if(C===" ")x=!0;else if(C===`
`)w=b;else break}let y=n.substring(0,w<b?w+1:b);y&&(n=n.substring(y.length),y=y.replace(/\n+/g,`$&${d}`));let _=(x?d?"2":"1":"")+u;if(t&&(_+=" "+l(t.replace(/ ?[\r\n]+/g," ")),r&&r()),!m){const C=n.replace(/\n+/g,`
$&`).replace(/(?:^|\n)([\t ].*)(?:([\n\t ]*)\n(?![\n\t ]))?/g,"$1$2").replace(/\n+/g,`$&${d}`);let k=!1;const N=mo(i,!0);o!=="folded"&&s!==te.BLOCK_FOLDED&&(N.onOverflow=()=>{k=!0});const z=uo(`${y}${C}${p}`,d,ql,N);if(!k)return`>${_}
${d}${z}`}return n=n.replace(/\n+/g,`$&${d}`),`|${_}
${d}${y}${n}${p}`}function _T(t,s,n,i){const{type:r,value:a}=t,{actualString:o,implicitKey:l,indent:c,indentStep:d,inFlow:m}=s;if(l&&a.includes(`
`)||m&&/[[\]{},]/.test(a))return Zn(a,s);if(/^[\n\t ,[\]{}#&*!|>'"%@`]|^[?-]$|^[?-][ \t]|[\n:][ \t]|[ \t]\n|[\n\t ]#|[\n\t :]$/.test(a))return l||m||!a.includes(`
`)?Zn(a,s):la(t,s,n,i);if(!l&&!m&&r!==te.PLAIN&&a.includes(`
`))return la(t,s,n,i);if(ho(a)){if(c==="")return s.forceBlockIndent=!0,la(t,s,n,i);if(l&&c===d)return Zn(a,s)}const u=a.replace(/\n+/g,`$&
${c}`);if(o){const h=x=>x.default&&x.tag!=="tag:yaml.org,2002:str"&&x.test?.test(u),{compat:p,tags:j}=s.doc.schema;if(j.some(h)||p?.some(h))return Zn(a,s)}return l?u:uo(u,c,Jg,mo(s,!1))}function Er(t,s,n,i){const{implicitKey:r,inFlow:a}=s,o=typeof t.value=="string"?t:Object.assign({},t,{value:String(t.value)});let{type:l}=t;l!==te.QUOTE_DOUBLE&&/[\x00-\x08\x0b-\x1f\x7f-\x9f\u{D800}-\u{DFFF}]/u.test(o.value)&&(l=te.QUOTE_DOUBLE);const c=m=>{switch(m){case te.BLOCK_FOLDED:case te.BLOCK_LITERAL:return r||a?Zn(o.value,s):la(o,s,n,i);case te.QUOTE_DOUBLE:return Xi(o.value,s);case te.QUOTE_SINGLE:return Kl(o.value,s);case te.PLAIN:return _T(o,s,n,i);default:return null}};let d=c(l);if(d===null){const{defaultKeyType:m,defaultStringType:u}=s.options,h=r&&m||u;if(d=c(h),d===null)throw new Error(`Unsupported default string type ${h}`)}return d}function ej(t,s){const n=Object.assign({blockQuote:!0,commentString:ST,defaultKeyType:null,defaultStringType:"PLAIN",directives:null,doubleQuotedAsJSON:!1,doubleQuotedMinMultiLineLength:40,falseStr:"false",flowCollectionPadding:!0,indentSeq:!0,lineWidth:80,minContentWidth:20,nullStr:"null",simpleKeys:!1,singleQuote:null,trueStr:"true",verifyAliasOrder:!0},t.schema.toStringOptions,s);let i;switch(n.collectionStyle){case"block":i=!1;break;case"flow":i=!0;break;default:i=null}return{anchors:new Set,doc:t,flowCollectionPadding:n.flowCollectionPadding?" ":"",indent:"",indentStep:typeof n.indent=="number"?" ".repeat(n.indent):"  ",inFlow:i,options:n}}function TT(t,s){if(s.tag){const r=t.filter(a=>a.tag===s.tag);if(r.length>0)return r.find(a=>a.format===s.format)??r[0]}let n,i;if(ue(s)){i=s.value;let r=t.filter(a=>a.identify?.(i));if(r.length>1){const a=r.filter(o=>o.test);a.length>0&&(r=a)}n=r.find(a=>a.format===s.format)??r.find(a=>!a.format)}else i=s,n=t.find(r=>r.nodeClass&&i instanceof r.nodeClass);if(!n){const r=i?.constructor?.name??(i===null?"null":typeof i);throw new Error(`Tag not resolved for ${r} value`)}return n}function AT(t,s,{anchors:n,doc:i}){if(!i.directives)return"";const r=[],a=(ue(t)||be(t))&&t.anchor;a&&Hg(a)&&(n.add(a),r.push(`&${a}`));const o=t.tag??(s.default?null:s.tag);return o&&r.push(i.directives.tagString(o)),r.join(" ")}function ui(t,s,n,i){if(je(t))return t.toString(s,n,i);if(Js(t)){if(s.doc.directives)return t.toString(s);if(s.resolvedAliases?.has(t))throw new TypeError("Cannot stringify circular structure without alias nodes");s.resolvedAliases?s.resolvedAliases.add(t):s.resolvedAliases=new Set([t]),t=t.resolve(s.doc)}let r;const a=Ne(t)?t:s.doc.createNode(t,{onTagObj:c=>r=c});r??(r=TT(s.doc.schema.tags,a));const o=AT(a,r,s);o.length>0&&(s.indentAtStart=(s.indentAtStart??0)+o.length+1);const l=typeof r.stringify=="function"?r.stringify(a,s,n,i):ue(a)?Er(a,s,n,i):a.toString(s,n,i);return o?ue(a)||l[0]==="{"||l[0]==="["?`${o} ${l}`:`${o}
${s.indent}${l}`:l}function DT({key:t,value:s},n,i,r){const{allNullValues:a,doc:o,indent:l,indentStep:c,options:{commentString:d,indentSeq:m,simpleKeys:u}}=n;let h=Ne(t)&&t.comment||null;if(u){if(h)throw new Error("With simple keys, key nodes cannot have comments");if(be(t)||!Ne(t)&&typeof t=="object"){const N="With simple keys, collection cannot be used as a key value";throw new Error(N)}}let p=!u&&(!t||h&&s==null&&!n.inFlow||be(t)||(ue(t)?t.type===te.BLOCK_FOLDED||t.type===te.BLOCK_LITERAL:typeof t=="object"));n=Object.assign({},n,{allNullValues:!1,implicitKey:!p&&(u||!a),indent:l+c});let j=!1,x=!1,b=ui(t,n,()=>j=!0,()=>x=!0);if(!p&&!n.inFlow&&b.length>1024){if(u)throw new Error("With simple keys, single line scalar must not span more than 1024 characters");p=!0}if(n.inFlow){if(a||s==null)return j&&i&&i(),b===""?"?":p?`? ${b}`:b}else if(a&&!u||s==null&&p)return b=`? ${b}`,h&&!j?b+=on(b,n.indent,d(h)):x&&r&&r(),b;j&&(h=null),p?(h&&(b+=on(b,n.indent,d(h))),b=`? ${b}
${l}:`):(b=`${b}:`,h&&(b+=on(b,n.indent,d(h))));let w,y,v;Ne(s)?(w=!!s.spaceBefore,y=s.commentBefore,v=s.comment):(w=!1,y=null,v=null,s&&typeof s=="object"&&(s=o.createNode(s))),n.implicitKey=!1,!p&&!h&&ue(s)&&(n.indentAtStart=b.length+1),x=!1,!m&&c.length>=2&&!n.inFlow&&!p&&zi(s)&&!s.flow&&!s.tag&&!s.anchor&&(n.indent=n.indent.substring(2));let _=!1;const C=ui(s,n,()=>_=!0,()=>x=!0);let k=" ";if(h||w||y){if(k=w?`
`:"",y){const N=d(y);k+=`
${js(N,n.indent)}`}C===""&&!n.inFlow?k===`
`&&(k=`

`):k+=`
${n.indent}`}else if(!p&&be(s)){const N=C[0],z=C.indexOf(`
`),T=z!==-1,f=n.inFlow??s.flow??s.items.length===0;if(T||!f){let S=!1;if(T&&(N==="&"||N==="!")){let A=C.indexOf(" ");N==="&"&&A!==-1&&A<z&&C[A+1]==="!"&&(A=C.indexOf(" ",A+1)),(A===-1||z<A)&&(S=!0)}S||(k=`
${n.indent}`)}}else(C===""||C[0]===`
`)&&(k="");return b+=k+C,n.inFlow?_&&i&&i():v&&!_?b+=on(b,n.indent,d(v)):x&&r&&r(),b}function tj(t,s){(t==="debug"||t==="warn")&&console.warn(s)}const Zr="<<",ys={identify:t=>t===Zr||typeof t=="symbol"&&t.description===Zr,default:"key",tag:"tag:yaml.org,2002:merge",test:/^<<$/,resolve:()=>Object.assign(new te(Symbol(Zr)),{addToJSMap:sj}),stringify:()=>Zr},PT=(t,s)=>(ys.identify(s)||ue(s)&&(!s.type||s.type===te.PLAIN)&&ys.identify(s.value))&&t?.doc.schema.tags.some(n=>n.tag===ys.tag&&n.default);function sj(t,s,n){if(n=t&&Js(n)?n.resolve(t.doc):n,zi(n))for(const i of n.items)Jo(t,s,i);else if(Array.isArray(n))for(const i of n)Jo(t,s,i);else Jo(t,s,n)}function Jo(t,s,n){const i=t&&Js(n)?n.resolve(t.doc):n;if(!ki(i))throw new Error("Merge sources must be maps or map aliases");const r=i.toJSON(null,t,Map);for(const[a,o]of r)s instanceof Map?s.has(a)||s.set(a,o):s instanceof Set?s.add(a):Object.prototype.hasOwnProperty.call(s,a)||Object.defineProperty(s,a,{value:o,writable:!0,enumerable:!0,configurable:!0});return s}function nj(t,s,{key:n,value:i}){if(Ne(n)&&n.addToJSMap)n.addToJSMap(t,s,i);else if(PT(t,n))sj(t,s,i);else{const r=Dt(n,"",t);if(s instanceof Map)s.set(r,Dt(i,r,t));else if(s instanceof Set)s.add(r);else{const a=MT(n,r,t),o=Dt(i,a,t);a in s?Object.defineProperty(s,a,{value:o,writable:!0,enumerable:!0,configurable:!0}):s[a]=o}}return s}function MT(t,s,n){if(s===null)return"";if(typeof s!="object")return String(s);if(Ne(t)&&n?.doc){const i=ej(n.doc,{});i.anchors=new Set;for(const a of n.anchors.keys())i.anchors.add(a.anchor);i.inFlow=!0,i.inStringifyKey=!0;const r=t.toString(i);if(!n.mapKeyWarned){let a=JSON.stringify(r);a.length>40&&(a=a.substring(0,36)+'..."'),tj(n.doc.options.logLevel,`Keys with collection values will be stringified due to JS Object restrictions: ${a}. Set mapAsMap: true to use object keys.`),n.mapKeyWarned=!0}return r}return JSON.stringify(s)}function md(t,s,n){const i=jr(t,void 0,n),r=jr(s,void 0,n);return new Qe(i,r)}class Qe{constructor(s,n=null){Object.defineProperty(this,Mt,{value:Ug}),this.key=s,this.value=n}clone(s){let{key:n,value:i}=this;return Ne(n)&&(n=n.clone(s)),Ne(i)&&(i=i.clone(s)),new Qe(n,i)}toJSON(s,n){const i=n?.mapAsMap?new Map:{};return nj(n,i,this)}toString(s,n,i){return s?.doc?DT(this,s,n,i):JSON.stringify(this)}}function ij(t,s,n){return(s.inFlow??t.flow?IT:RT)(t,s,n)}function RT({comment:t,items:s},n,{blockItemPrefix:i,flowChars:r,itemIndent:a,onChompKeep:o,onComment:l}){const{indent:c,options:{commentString:d}}=n,m=Object.assign({},n,{indent:a,type:null});let u=!1;const h=[];for(let j=0;j<s.length;++j){const x=s[j];let b=null;if(Ne(x))!u&&x.spaceBefore&&h.push(""),_a(n,h,x.commentBefore,u),x.comment&&(b=x.comment);else if(je(x)){const y=Ne(x.key)?x.key:null;y&&(!u&&y.spaceBefore&&h.push(""),_a(n,h,y.commentBefore,u))}u=!1;let w=ui(x,m,()=>b=null,()=>u=!0);b&&(w+=on(w,a,d(b))),u&&b&&(u=!1),h.push(i+w)}let p;if(h.length===0)p=r.start+r.end;else{p=h[0];for(let j=1;j<h.length;++j){const x=h[j];p+=x?`
${c}${x}`:`
`}}return t?(p+=`
`+js(d(t),c),l&&l()):u&&o&&o(),p}function IT({items:t},s,{flowChars:n,itemIndent:i}){const{indent:r,indentStep:a,flowCollectionPadding:o,options:{commentString:l}}=s;i+=a;const c=Object.assign({},s,{indent:i,inFlow:!0,type:null});let d=!1,m=0;const u=[];for(let j=0;j<t.length;++j){const x=t[j];let b=null;if(Ne(x))x.spaceBefore&&u.push(""),_a(s,u,x.commentBefore,!1),x.comment&&(b=x.comment);else if(je(x)){const y=Ne(x.key)?x.key:null;y&&(y.spaceBefore&&u.push(""),_a(s,u,y.commentBefore,!1),y.comment&&(d=!0));const v=Ne(x.value)?x.value:null;v?(v.comment&&(b=v.comment),v.commentBefore&&(d=!0)):x.value==null&&y?.comment&&(b=y.comment)}b&&(d=!0);let w=ui(x,c,()=>b=null);j<t.length-1&&(w+=","),b&&(w+=on(w,i,l(b))),!d&&(u.length>m||w.includes(`
`))&&(d=!0),u.push(w),m=u.length}const{start:h,end:p}=n;if(u.length===0)return h+p;if(!d){const j=u.reduce((x,b)=>x+b.length+2,2);d=s.options.lineWidth>0&&j>s.options.lineWidth}if(d){let j=h;for(const x of u)j+=x?`
${a}${r}${x}`:`
`;return`${j}
${r}${p}`}else return`${h}${o}${u.join(" ")}${o}${p}`}function _a({indent:t,options:{commentString:s}},n,i,r){if(i&&r&&(i=i.replace(/^\n+/,"")),i){const a=js(s(i),t);n.push(a.trimStart())}}function ln(t,s){const n=ue(s)?s.value:s;for(const i of t)if(je(i)&&(i.key===s||i.key===n||ue(i.key)&&i.key.value===n))return i}class yt extends Xg{static get tagName(){return"tag:yaml.org,2002:map"}constructor(s){super(Bs,s),this.items=[]}static from(s,n,i){const{keepUndefined:r,replacer:a}=i,o=new this(s),l=(c,d)=>{if(typeof a=="function")d=a.call(n,c,d);else if(Array.isArray(a)&&!a.includes(c))return;(d!==void 0||r)&&o.items.push(md(c,d,i))};if(n instanceof Map)for(const[c,d]of n)l(c,d);else if(n&&typeof n=="object")for(const c of Object.keys(n))l(c,n[c]);return typeof s.sortMapEntries=="function"&&o.items.sort(s.sortMapEntries),o}add(s,n){let i;je(s)?i=s:!s||typeof s!="object"||!("key"in s)?i=new Qe(s,s?.value):i=new Qe(s.key,s.value);const r=ln(this.items,i.key),a=this.schema?.sortMapEntries;if(r){if(!n)throw new Error(`Key ${i.key} already set`);ue(r.value)&&Yg(i.value)?r.value.value=i.value:r.value=i.value}else if(a){const o=this.items.findIndex(l=>a(i,l)<0);o===-1?this.items.push(i):this.items.splice(o,0,i)}else this.items.push(i)}delete(s){const n=ln(this.items,s);return n?this.items.splice(this.items.indexOf(n),1).length>0:!1}get(s,n){const r=ln(this.items,s)?.value;return(!n&&ue(r)?r.value:r)??void 0}has(s){return!!ln(this.items,s)}set(s,n){this.add(new Qe(s,n),!0)}toJSON(s,n,i){const r=i?new i:n?.mapAsMap?new Map:{};n?.onCreate&&n.onCreate(r);for(const a of this.items)nj(n,r,a);return r}toString(s,n,i){if(!s)return JSON.stringify(this);for(const r of this.items)if(!je(r))throw new Error(`Map items must all be pairs; found ${JSON.stringify(r)} instead`);return!s.allNullValues&&this.hasAllNullValues(!1)&&(s=Object.assign({},s,{allNullValues:!0})),ij(this,s,{blockItemPrefix:"",flowChars:{start:"{",end:"}"},itemIndent:s.indent||"",onChompKeep:i,onComment:n})}}const Si={collection:"map",default:!0,nodeClass:yt,tag:"tag:yaml.org,2002:map",resolve(t,s){return ki(t)||s("Expected a mapping for this tag"),t},createNode:(t,s,n)=>yt.from(t,s,n)};class Gs extends Xg{static get tagName(){return"tag:yaml.org,2002:seq"}constructor(s){super(Ni,s),this.items=[]}add(s){this.items.push(s)}delete(s){const n=Qr(s);return typeof n!="number"?!1:this.items.splice(n,1).length>0}get(s,n){const i=Qr(s);if(typeof i!="number")return;const r=this.items[i];return!n&&ue(r)?r.value:r}has(s){const n=Qr(s);return typeof n=="number"&&n<this.items.length}set(s,n){const i=Qr(s);if(typeof i!="number")throw new Error(`Expected a valid index, not ${s}.`);const r=this.items[i];ue(r)&&Yg(n)?r.value=n:this.items[i]=n}toJSON(s,n){const i=[];n?.onCreate&&n.onCreate(i);let r=0;for(const a of this.items)i.push(Dt(a,String(r++),n));return i}toString(s,n,i){return s?ij(this,s,{blockItemPrefix:"- ",flowChars:{start:"[",end:"]"},itemIndent:(s.indent||"")+"  ",onChompKeep:i,onComment:n}):JSON.stringify(this)}static from(s,n,i){const{replacer:r}=i,a=new this(s);if(n&&Symbol.iterator in Object(n)){let o=0;for(let l of n){if(typeof r=="function"){const c=n instanceof Set?l:String(o++);l=r.call(n,c,l)}a.items.push(jr(l,void 0,i))}}return a}}function Qr(t){let s=ue(t)?t.value:t;return s&&typeof s=="string"&&(s=Number(s)),typeof s=="number"&&Number.isInteger(s)&&s>=0?s:null}const Ci={collection:"seq",default:!0,nodeClass:Gs,tag:"tag:yaml.org,2002:seq",resolve(t,s){return zi(t)||s("Expected a sequence for this tag"),t},createNode:(t,s,n)=>Gs.from(t,s,n)},fo={identify:t=>typeof t=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:t=>t,stringify(t,s,n,i){return s=Object.assign({actualString:!0},s),Er(t,s,n,i)}},po={identify:t=>t==null,createNode:()=>new te(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:()=>new te(null),stringify:({source:t},s)=>typeof t=="string"&&po.test.test(t)?t:s.options.nullStr},hd={identify:t=>typeof t=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,resolve:t=>new te(t[0]==="t"||t[0]==="T"),stringify({source:t,value:s},n){if(t&&hd.test.test(t)){const i=t[0]==="t"||t[0]==="T";if(s===i)return t}return s?n.options.trueStr:n.options.falseStr}};function Ut({format:t,minFractionDigits:s,tag:n,value:i}){if(typeof i=="bigint")return String(i);const r=typeof i=="number"?i:Number(i);if(!isFinite(r))return isNaN(r)?".nan":r<0?"-.inf":".inf";let a=JSON.stringify(i);if(!t&&s&&(!n||n==="tag:yaml.org,2002:float")&&/^\d/.test(a)){let o=a.indexOf(".");o<0&&(o=a.length,a+=".");let l=s-(a.length-o-1);for(;l-- >0;)a+="0"}return a}const rj={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:t=>t.slice(-3).toLowerCase()==="nan"?NaN:t[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:Ut},aj={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:\.[0-9]+|[0-9]+(?:\.[0-9]*)?)[eE][-+]?[0-9]+$/,resolve:t=>parseFloat(t),stringify(t){const s=Number(t.value);return isFinite(s)?s.toExponential():Ut(t)}},oj={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:\.[0-9]+|[0-9]+\.[0-9]*)$/,resolve(t){const s=new te(parseFloat(t)),n=t.indexOf(".");return n!==-1&&t[t.length-1]==="0"&&(s.minFractionDigits=t.length-n-1),s},stringify:Ut},xo=t=>typeof t=="bigint"||Number.isInteger(t),fd=(t,s,n,{intAsBigInt:i})=>i?BigInt(t):parseInt(t.substring(s),n);function lj(t,s,n){const{value:i}=t;return xo(i)&&i>=0?n+i.toString(s):Ut(t)}const cj={identify:t=>xo(t)&&t>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^0o[0-7]+$/,resolve:(t,s,n)=>fd(t,2,8,n),stringify:t=>lj(t,8,"0o")},dj={identify:xo,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9]+$/,resolve:(t,s,n)=>fd(t,0,10,n),stringify:Ut},uj={identify:t=>xo(t)&&t>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^0x[0-9a-fA-F]+$/,resolve:(t,s,n)=>fd(t,2,16,n),stringify:t=>lj(t,16,"0x")},ET=[Si,Ci,fo,po,hd,cj,dj,uj,rj,aj,oj];function Wm(t){return typeof t=="bigint"||Number.isInteger(t)}const Yr=({value:t})=>JSON.stringify(t),LT=[{identify:t=>typeof t=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:t=>t,stringify:Yr},{identify:t=>t==null,createNode:()=>new te(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^null$/,resolve:()=>null,stringify:Yr},{identify:t=>typeof t=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^true$|^false$/,resolve:t=>t==="true",stringify:Yr},{identify:Wm,default:!0,tag:"tag:yaml.org,2002:int",test:/^-?(?:0|[1-9][0-9]*)$/,resolve:(t,s,{intAsBigInt:n})=>n?BigInt(t):parseInt(t,10),stringify:({value:t})=>Wm(t)?t.toString():JSON.stringify(t)},{identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^-?(?:0|[1-9][0-9]*)(?:\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,resolve:t=>parseFloat(t),stringify:Yr}],OT={default:!0,tag:"",test:/^/,resolve(t,s){return s(`Unresolved plain scalar ${JSON.stringify(t)}`),t}},$T=[Si,Ci].concat(LT,OT),pd={identify:t=>t instanceof Uint8Array,default:!1,tag:"tag:yaml.org,2002:binary",resolve(t,s){if(typeof atob=="function"){const n=atob(t.replace(/[\n\r]/g,"")),i=new Uint8Array(n.length);for(let r=0;r<n.length;++r)i[r]=n.charCodeAt(r);return i}else return s("This environment does not support reading binary tags; either Buffer or atob is required"),t},stringify({comment:t,type:s,value:n},i,r,a){if(!n)return"";const o=n;let l;if(typeof btoa=="function"){let c="";for(let d=0;d<o.length;++d)c+=String.fromCharCode(o[d]);l=btoa(c)}else throw new Error("This environment does not support writing binary tags; either Buffer or btoa is required");if(s??(s=te.BLOCK_LITERAL),s!==te.QUOTE_DOUBLE){const c=Math.max(i.options.lineWidth-i.indent.length,i.options.minContentWidth),d=Math.ceil(l.length/c),m=new Array(d);for(let u=0,h=0;u<d;++u,h+=c)m[u]=l.substr(h,c);l=m.join(s===te.BLOCK_LITERAL?`
`:" ")}return Er({comment:t,type:s,value:l},i,r,a)}};function mj(t,s){if(zi(t))for(let n=0;n<t.items.length;++n){let i=t.items[n];if(!je(i)){if(ki(i)){i.items.length>1&&s("Each pair must have its own sequence indicator");const r=i.items[0]||new Qe(new te(null));if(i.commentBefore&&(r.key.commentBefore=r.key.commentBefore?`${i.commentBefore}
${r.key.commentBefore}`:i.commentBefore),i.comment){const a=r.value??r.key;a.comment=a.comment?`${i.comment}
${a.comment}`:i.comment}i=r}t.items[n]=je(i)?i:new Qe(i)}}else s("Expected a sequence for this tag");return t}function hj(t,s,n){const{replacer:i}=n,r=new Gs(t);r.tag="tag:yaml.org,2002:pairs";let a=0;if(s&&Symbol.iterator in Object(s))for(let o of s){typeof i=="function"&&(o=i.call(s,String(a++),o));let l,c;if(Array.isArray(o))if(o.length===2)l=o[0],c=o[1];else throw new TypeError(`Expected [key, value] tuple: ${o}`);else if(o&&o instanceof Object){const d=Object.keys(o);if(d.length===1)l=d[0],c=o[l];else throw new TypeError(`Expected tuple with one key, not ${d.length} keys`)}else l=o;r.items.push(md(l,c,n))}return r}const xd={collection:"seq",default:!1,tag:"tag:yaml.org,2002:pairs",resolve:mj,createNode:hj};class Jn extends Gs{constructor(){super(),this.add=yt.prototype.add.bind(this),this.delete=yt.prototype.delete.bind(this),this.get=yt.prototype.get.bind(this),this.has=yt.prototype.has.bind(this),this.set=yt.prototype.set.bind(this),this.tag=Jn.tag}toJSON(s,n){if(!n)return super.toJSON(s);const i=new Map;n?.onCreate&&n.onCreate(i);for(const r of this.items){let a,o;if(je(r)?(a=Dt(r.key,"",n),o=Dt(r.value,a,n)):a=Dt(r,"",n),i.has(a))throw new Error("Ordered maps must not include duplicate keys");i.set(a,o)}return i}static from(s,n,i){const r=hj(s,n,i),a=new this;return a.items=r.items,a}}Jn.tag="tag:yaml.org,2002:omap";const gd={collection:"seq",identify:t=>t instanceof Map,nodeClass:Jn,default:!1,tag:"tag:yaml.org,2002:omap",resolve(t,s){const n=mj(t,s),i=[];for(const{key:r}of n.items)ue(r)&&(i.includes(r.value)?s(`Ordered maps must not include duplicate keys: ${r.value}`):i.push(r.value));return Object.assign(new Jn,n)},createNode:(t,s,n)=>Jn.from(t,s,n)};function fj({value:t,source:s},n){return s&&(t?pj:xj).test.test(s)?s:t?n.options.trueStr:n.options.falseStr}const pj={identify:t=>t===!0,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,resolve:()=>new te(!0),stringify:fj},xj={identify:t=>t===!1,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/,resolve:()=>new te(!1),stringify:fj},FT={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:t=>t.slice(-3).toLowerCase()==="nan"?NaN:t[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:Ut},BT={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:[0-9][0-9_]*)?(?:\.[0-9_]*)?[eE][-+]?[0-9]+$/,resolve:t=>parseFloat(t.replace(/_/g,"")),stringify(t){const s=Number(t.value);return isFinite(s)?s.toExponential():Ut(t)}},UT={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:[0-9][0-9_]*)?\.[0-9_]*$/,resolve(t){const s=new te(parseFloat(t.replace(/_/g,""))),n=t.indexOf(".");if(n!==-1){const i=t.substring(n+1).replace(/_/g,"");i[i.length-1]==="0"&&(s.minFractionDigits=i.length)}return s},stringify:Ut},Lr=t=>typeof t=="bigint"||Number.isInteger(t);function go(t,s,n,{intAsBigInt:i}){const r=t[0];if((r==="-"||r==="+")&&(s+=1),t=t.substring(s).replace(/_/g,""),i){switch(n){case 2:t=`0b${t}`;break;case 8:t=`0o${t}`;break;case 16:t=`0x${t}`;break}const o=BigInt(t);return r==="-"?BigInt(-1)*o:o}const a=parseInt(t,n);return r==="-"?-1*a:a}function jd(t,s,n){const{value:i}=t;if(Lr(i)){const r=i.toString(s);return i<0?"-"+n+r.substr(1):n+r}return Ut(t)}const VT={identify:Lr,default:!0,tag:"tag:yaml.org,2002:int",format:"BIN",test:/^[-+]?0b[0-1_]+$/,resolve:(t,s,n)=>go(t,2,2,n),stringify:t=>jd(t,2,"0b")},qT={identify:Lr,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^[-+]?0[0-7_]+$/,resolve:(t,s,n)=>go(t,1,8,n),stringify:t=>jd(t,8,"0")},KT={identify:Lr,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9][0-9_]*$/,resolve:(t,s,n)=>go(t,0,10,n),stringify:Ut},WT={identify:Lr,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^[-+]?0x[0-9a-fA-F_]+$/,resolve:(t,s,n)=>go(t,2,16,n),stringify:t=>jd(t,16,"0x")};class ei extends yt{constructor(s){super(s),this.tag=ei.tag}add(s){let n;je(s)?n=s:s&&typeof s=="object"&&"key"in s&&"value"in s&&s.value===null?n=new Qe(s.key,null):n=new Qe(s,null),ln(this.items,n.key)||this.items.push(n)}get(s,n){const i=ln(this.items,s);return!n&&je(i)?ue(i.key)?i.key.value:i.key:i}set(s,n){if(typeof n!="boolean")throw new Error(`Expected boolean value for set(key, value) in a YAML set, not ${typeof n}`);const i=ln(this.items,s);i&&!n?this.items.splice(this.items.indexOf(i),1):!i&&n&&this.items.push(new Qe(s))}toJSON(s,n){return super.toJSON(s,n,Set)}toString(s,n,i){if(!s)return JSON.stringify(this);if(this.hasAllNullValues(!0))return super.toString(Object.assign({},s,{allNullValues:!0}),n,i);throw new Error("Set items must all have null values")}static from(s,n,i){const{replacer:r}=i,a=new this(s);if(n&&Symbol.iterator in Object(n))for(let o of n)typeof r=="function"&&(o=r.call(n,o,o)),a.items.push(md(o,null,i));return a}}ei.tag="tag:yaml.org,2002:set";const yd={collection:"map",identify:t=>t instanceof Set,nodeClass:ei,default:!1,tag:"tag:yaml.org,2002:set",createNode:(t,s,n)=>ei.from(t,s,n),resolve(t,s){if(ki(t)){if(t.hasAllNullValues(!0))return Object.assign(new ei,t);s("Set items must all have null values")}else s("Expected a mapping for this tag");return t}};function bd(t,s){const n=t[0],i=n==="-"||n==="+"?t.substring(1):t,r=o=>s?BigInt(o):Number(o),a=i.replace(/_/g,"").split(":").reduce((o,l)=>o*r(60)+r(l),r(0));return n==="-"?r(-1)*a:a}function gj(t){let{value:s}=t,n=o=>o;if(typeof s=="bigint")n=o=>BigInt(o);else if(isNaN(s)||!isFinite(s))return Ut(t);let i="";s<0&&(i="-",s*=n(-1));const r=n(60),a=[s%r];return s<60?a.unshift(0):(s=(s-a[0])/r,a.unshift(s%r),s>=60&&(s=(s-a[0])/r,a.unshift(s))),i+a.map(o=>String(o).padStart(2,"0")).join(":").replace(/000000\d*$/,"")}const jj={identify:t=>typeof t=="bigint"||Number.isInteger(t),default:!0,tag:"tag:yaml.org,2002:int",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,resolve:(t,s,{intAsBigInt:n})=>bd(t,n),stringify:gj},yj={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\.[0-9_]*$/,resolve:t=>bd(t,!1),stringify:gj},jo={identify:t=>t instanceof Date,default:!0,tag:"tag:yaml.org,2002:timestamp",test:RegExp("^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})(?:(?:t|T|[ \\t]+)([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\.[0-9]+)?)(?:[ \\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?)?$"),resolve(t){const s=t.match(jo.test);if(!s)throw new Error("!!timestamp expects a date, starting with yyyy-mm-dd");const[,n,i,r,a,o,l]=s.map(Number),c=s[7]?Number((s[7]+"00").substr(1,3)):0;let d=Date.UTC(n,i-1,r,a||0,o||0,l||0,c);const m=s[8];if(m&&m!=="Z"){let u=bd(m,!1);Math.abs(u)<30&&(u*=60),d-=6e4*u}return new Date(d)},stringify:({value:t})=>t?.toISOString().replace(/(T00:00:00)?\.000Z$/,"")??""},Gm=[Si,Ci,fo,po,pj,xj,VT,qT,KT,WT,FT,BT,UT,pd,ys,gd,xd,yd,jj,yj,jo],Hm=new Map([["core",ET],["failsafe",[Si,Ci,fo]],["json",$T],["yaml11",Gm],["yaml-1.1",Gm]]),Zm={binary:pd,bool:hd,float:oj,floatExp:aj,floatNaN:rj,floatTime:yj,int:dj,intHex:uj,intOct:cj,intTime:jj,map:Si,merge:ys,null:po,omap:gd,pairs:xd,seq:Ci,set:yd,timestamp:jo},GT={"tag:yaml.org,2002:binary":pd,"tag:yaml.org,2002:merge":ys,"tag:yaml.org,2002:omap":gd,"tag:yaml.org,2002:pairs":xd,"tag:yaml.org,2002:set":yd,"tag:yaml.org,2002:timestamp":jo};function el(t,s,n){const i=Hm.get(s);if(i&&!t)return n&&!i.includes(ys)?i.concat(ys):i.slice();let r=i;if(!r)if(Array.isArray(t))r=[];else{const a=Array.from(Hm.keys()).filter(o=>o!=="yaml11").map(o=>JSON.stringify(o)).join(", ");throw new Error(`Unknown schema "${s}"; use one of ${a} or define customTags array`)}if(Array.isArray(t))for(const a of t)r=r.concat(a);else typeof t=="function"&&(r=t(r.slice()));return n&&(r=r.concat(ys)),r.reduce((a,o)=>{const l=typeof o=="string"?Zm[o]:o;if(!l){const c=JSON.stringify(o),d=Object.keys(Zm).map(m=>JSON.stringify(m)).join(", ");throw new Error(`Unknown custom tag ${c}; use one of ${d}`)}return a.includes(l)||a.push(l),a},[])}const HT=(t,s)=>t.key<s.key?-1:t.key>s.key?1:0;class yo{constructor({compat:s,customTags:n,merge:i,resolveKnownTags:r,schema:a,sortMapEntries:o,toStringDefaults:l}){this.compat=Array.isArray(s)?el(s,"compat"):s?el(null,s):null,this.name=typeof a=="string"&&a||"core",this.knownTags=r?GT:{},this.tags=el(n,this.name,i),this.toStringOptions=l??null,Object.defineProperty(this,Bs,{value:Si}),Object.defineProperty(this,os,{value:fo}),Object.defineProperty(this,Ni,{value:Ci}),this.sortMapEntries=typeof o=="function"?o:o===!0?HT:null}clone(){const s=Object.create(yo.prototype,Object.getOwnPropertyDescriptors(this));return s.tags=this.tags.slice(),s}}function ZT(t,s){const n=[];let i=s.directives===!0;if(s.directives!==!1&&t.directives){const c=t.directives.toString(t);c?(n.push(c),i=!0):t.directives.docStart&&(i=!0)}i&&n.push("---");const r=ej(t,s),{commentString:a}=r.options;if(t.commentBefore){n.length!==1&&n.unshift("");const c=a(t.commentBefore);n.unshift(js(c,""))}let o=!1,l=null;if(t.contents){if(Ne(t.contents)){if(t.contents.spaceBefore&&i&&n.push(""),t.contents.commentBefore){const m=a(t.contents.commentBefore);n.push(js(m,""))}r.forceBlockIndent=!!t.comment,l=t.contents.comment}const c=l?void 0:()=>o=!0;let d=ui(t.contents,r,()=>l=null,c);l&&(d+=on(d,"",a(l))),(d[0]==="|"||d[0]===">")&&n[n.length-1]==="---"?n[n.length-1]=`--- ${d}`:n.push(d)}else n.push(ui(t.contents,r));if(t.directives?.docEnd)if(t.comment){const c=a(t.comment);c.includes(`
`)?(n.push("..."),n.push(js(c,""))):n.push(`... ${c}`)}else n.push("...");else{let c=t.comment;c&&o&&(c=c.replace(/^\n+/,"")),c&&((!o||l)&&n[n.length-1]!==""&&n.push(""),n.push(js(a(c),"")))}return n.join(`
`)+`
`}class _i{constructor(s,n,i){this.commentBefore=null,this.comment=null,this.errors=[],this.warnings=[],Object.defineProperty(this,Mt,{value:Vl});let r=null;typeof n=="function"||Array.isArray(n)?r=n:i===void 0&&n&&(i=n,n=void 0);const a=Object.assign({intAsBigInt:!1,keepSourceTokens:!1,logLevel:"warn",prettyErrors:!0,strict:!0,stringKeys:!1,uniqueKeys:!0,version:"1.2"},i);this.options=a;let{version:o}=a;i?._directives?(this.directives=i._directives.atDocument(),this.directives.yaml.explicit&&(o=this.directives.yaml.version)):this.directives=new et({version:o}),this.setSchema(o,i),this.contents=s===void 0?null:this.createNode(s,r,i)}clone(){const s=Object.create(_i.prototype,{[Mt]:{value:Vl}});return s.commentBefore=this.commentBefore,s.comment=this.comment,s.errors=this.errors.slice(),s.warnings=this.warnings.slice(),s.options=Object.assign({},this.options),this.directives&&(s.directives=this.directives.clone()),s.schema=this.schema.clone(),s.contents=Ne(this.contents)?this.contents.clone(s.schema):this.contents,this.range&&(s.range=this.range.slice()),s}add(s){Ln(this.contents)&&this.contents.add(s)}addIn(s,n){Ln(this.contents)&&this.contents.addIn(s,n)}createAlias(s,n){if(!s.anchor){const i=Zg(this);s.anchor=!n||i.has(n)?Qg(n||"a",i):n}return new co(s.anchor)}createNode(s,n,i){let r;if(typeof n=="function")s=n.call({"":s},"",s),r=n;else if(Array.isArray(n)){const b=y=>typeof y=="number"||y instanceof String||y instanceof Number,w=n.filter(b).map(String);w.length>0&&(n=n.concat(w)),r=n}else i===void 0&&n&&(i=n,n=void 0);const{aliasDuplicateObjects:a,anchorPrefix:o,flow:l,keepUndefined:c,onTagObj:d,tag:m}=i??{},{onAnchor:u,setAnchors:h,sourceObjects:p}=NT(this,o||"a"),j={aliasDuplicateObjects:a??!0,keepUndefined:c??!1,onAnchor:u,onTagObj:d,replacer:r,schema:this.schema,sourceObjects:p},x=jr(s,m,j);return l&&be(x)&&(x.flow=!0),h(),x}createPair(s,n,i={}){const r=this.createNode(s,null,i),a=this.createNode(n,null,i);return new Qe(r,a)}delete(s){return Ln(this.contents)?this.contents.delete(s):!1}deleteIn(s){return Ui(s)?this.contents==null?!1:(this.contents=null,!0):Ln(this.contents)?this.contents.deleteIn(s):!1}get(s,n){return be(this.contents)?this.contents.get(s,n):void 0}getIn(s,n){return Ui(s)?!n&&ue(this.contents)?this.contents.value:this.contents:be(this.contents)?this.contents.getIn(s,n):void 0}has(s){return be(this.contents)?this.contents.has(s):!1}hasIn(s){return Ui(s)?this.contents!==void 0:be(this.contents)?this.contents.hasIn(s):!1}set(s,n){this.contents==null?this.contents=Ca(this.schema,[s],n):Ln(this.contents)&&this.contents.set(s,n)}setIn(s,n){Ui(s)?this.contents=n:this.contents==null?this.contents=Ca(this.schema,Array.from(s),n):Ln(this.contents)&&this.contents.setIn(s,n)}setSchema(s,n={}){typeof s=="number"&&(s=String(s));let i;switch(s){case"1.1":this.directives?this.directives.yaml.version="1.1":this.directives=new et({version:"1.1"}),i={resolveKnownTags:!1,schema:"yaml-1.1"};break;case"1.2":case"next":this.directives?this.directives.yaml.version=s:this.directives=new et({version:s}),i={resolveKnownTags:!0,schema:"core"};break;case null:this.directives&&delete this.directives,i=null;break;default:{const r=JSON.stringify(s);throw new Error(`Expected '1.1', '1.2' or null as first argument, but found: ${r}`)}}if(n.schema instanceof Object)this.schema=n.schema;else if(i)this.schema=new yo(Object.assign(i,n));else throw new Error("With a null YAML version, the { schema: Schema } option is required")}toJS({json:s,jsonArg:n,mapAsMap:i,maxAliasCount:r,onAnchor:a,reviver:o}={}){const l={anchors:new Map,doc:this,keep:!s,mapAsMap:i===!0,mapKeyWarned:!1,maxAliasCount:typeof r=="number"?r:100},c=Dt(this.contents,n??"",l);if(typeof a=="function")for(const{count:d,res:m}of l.anchors.values())a(m,d);return typeof o=="function"?Hn(o,{"":c},"",c):c}toJSON(s,n){return this.toJS({json:!0,jsonArg:s,mapAsMap:!1,onAnchor:n})}toString(s={}){if(this.errors.length>0)throw new Error("Document with errors cannot be stringified");if("indent"in s&&(!Number.isInteger(s.indent)||Number(s.indent)<=0)){const n=JSON.stringify(s.indent);throw new Error(`"indent" option must be a positive integer, not ${n}`)}return ZT(this,s)}}function Ln(t){if(be(t))return!0;throw new Error("Expected a YAML collection as document contents")}class wd extends Error{constructor(s,n,i,r){super(),this.name=s,this.code=i,this.message=r,this.pos=n}}class cn extends wd{constructor(s,n,i){super("YAMLParseError",s,n,i)}}class bj extends wd{constructor(s,n,i){super("YAMLWarning",s,n,i)}}const Ta=(t,s)=>n=>{if(n.pos[0]===-1)return;n.linePos=n.pos.map(l=>s.linePos(l));const{line:i,col:r}=n.linePos[0];n.message+=` at line ${i}, column ${r}`;let a=r-1,o=t.substring(s.lineStarts[i-1],s.lineStarts[i]).replace(/[\n\r]+$/,"");if(a>=60&&o.length>80){const l=Math.min(a-39,o.length-79);o="…"+o.substring(l),a-=l-1}if(o.length>80&&(o=o.substring(0,79)+"…"),i>1&&/^ *$/.test(o.substring(0,a))){let l=t.substring(s.lineStarts[i-2],s.lineStarts[i-1]);l.length>80&&(l=l.substring(0,79)+`…
`),o=l+o}if(/[^ ]/.test(o)){let l=1;const c=n.linePos[1];c&&c.line===i&&c.col>r&&(l=Math.max(1,Math.min(c.col-r,80-a)));const d=" ".repeat(a)+"^".repeat(l);n.message+=`:

${o}
${d}
`}};function mi(t,{flow:s,indicator:n,next:i,offset:r,onError:a,parentIndent:o,startOnNewline:l}){let c=!1,d=l,m=l,u="",h="",p=!1,j=!1,x=null,b=null,w=null,y=null,v=null,_=null,C=null;for(const z of t)switch(j&&(z.type!=="space"&&z.type!=="newline"&&z.type!=="comma"&&a(z.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),j=!1),x&&(d&&z.type!=="comment"&&z.type!=="newline"&&a(x,"TAB_AS_INDENT","Tabs are not allowed as indentation"),x=null),z.type){case"space":!s&&(n!=="doc-start"||i?.type!=="flow-collection")&&z.source.includes("	")&&(x=z),m=!0;break;case"comment":{m||a(z,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const T=z.source.substring(1)||" ";u?u+=h+T:u=T,h="",d=!1;break}case"newline":d?u?u+=z.source:(!_||n!=="seq-item-ind")&&(c=!0):h+=z.source,d=!0,p=!0,(b||w)&&(y=z),m=!0;break;case"anchor":b&&a(z,"MULTIPLE_ANCHORS","A node can have at most one anchor"),z.source.endsWith(":")&&a(z.offset+z.source.length-1,"BAD_ALIAS","Anchor ending in : is ambiguous",!0),b=z,C??(C=z.offset),d=!1,m=!1,j=!0;break;case"tag":{w&&a(z,"MULTIPLE_TAGS","A node can have at most one tag"),w=z,C??(C=z.offset),d=!1,m=!1,j=!0;break}case n:(b||w)&&a(z,"BAD_PROP_ORDER",`Anchors and tags must be after the ${z.source} indicator`),_&&a(z,"UNEXPECTED_TOKEN",`Unexpected ${z.source} in ${s??"collection"}`),_=z,d=n==="seq-item-ind"||n==="explicit-key-ind",m=!1;break;case"comma":if(s){v&&a(z,"UNEXPECTED_TOKEN",`Unexpected , in ${s}`),v=z,d=!1,m=!1;break}default:a(z,"UNEXPECTED_TOKEN",`Unexpected ${z.type} token`),d=!1,m=!1}const k=t[t.length-1],N=k?k.offset+k.source.length:r;return j&&i&&i.type!=="space"&&i.type!=="newline"&&i.type!=="comma"&&(i.type!=="scalar"||i.source!=="")&&a(i.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),x&&(d&&x.indent<=o||i?.type==="block-map"||i?.type==="block-seq")&&a(x,"TAB_AS_INDENT","Tabs are not allowed as indentation"),{comma:v,found:_,spaceBefore:c,comment:u,hasNewline:p,anchor:b,tag:w,newlineAfterProp:y,end:N,start:C??N}}function yr(t){if(!t)return null;switch(t.type){case"alias":case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":if(t.source.includes(`
`))return!0;if(t.end){for(const s of t.end)if(s.type==="newline")return!0}return!1;case"flow-collection":for(const s of t.items){for(const n of s.start)if(n.type==="newline")return!0;if(s.sep){for(const n of s.sep)if(n.type==="newline")return!0}if(yr(s.key)||yr(s.value))return!0}return!1;default:return!0}}function Gl(t,s,n){if(s?.type==="flow-collection"){const i=s.end[0];i.indent===t&&(i.source==="]"||i.source==="}")&&yr(s)&&n(i,"BAD_INDENT","Flow end indicator should be more indented than parent",!0)}}function wj(t,s,n){const{uniqueKeys:i}=t.options;if(i===!1)return!1;const r=typeof i=="function"?i:(a,o)=>a===o||ue(a)&&ue(o)&&a.value===o.value;return s.some(a=>r(a.key,n))}const Qm="All mapping items must start at the same column";function QT({composeNode:t,composeEmptyNode:s},n,i,r,a){const o=a?.nodeClass??yt,l=new o(n.schema);n.atRoot&&(n.atRoot=!1);let c=i.offset,d=null;for(const m of i.items){const{start:u,key:h,sep:p,value:j}=m,x=mi(u,{indicator:"explicit-key-ind",next:h??p?.[0],offset:c,onError:r,parentIndent:i.indent,startOnNewline:!0}),b=!x.found;if(b){if(h&&(h.type==="block-seq"?r(c,"BLOCK_AS_IMPLICIT_KEY","A block sequence may not be used as an implicit map key"):"indent"in h&&h.indent!==i.indent&&r(c,"BAD_INDENT",Qm)),!x.anchor&&!x.tag&&!p){d=x.end,x.comment&&(l.comment?l.comment+=`
`+x.comment:l.comment=x.comment);continue}(x.newlineAfterProp||yr(h))&&r(h??u[u.length-1],"MULTILINE_IMPLICIT_KEY","Implicit keys need to be on a single line")}else x.found?.indent!==i.indent&&r(c,"BAD_INDENT",Qm);n.atKey=!0;const w=x.end,y=h?t(n,h,x,r):s(n,w,u,null,x,r);n.schema.compat&&Gl(i.indent,h,r),n.atKey=!1,wj(n,l.items,y)&&r(w,"DUPLICATE_KEY","Map keys must be unique");const v=mi(p??[],{indicator:"map-value-ind",next:j,offset:y.range[2],onError:r,parentIndent:i.indent,startOnNewline:!h||h.type==="block-scalar"});if(c=v.end,v.found){b&&(j?.type==="block-map"&&!v.hasNewline&&r(c,"BLOCK_AS_IMPLICIT_KEY","Nested mappings are not allowed in compact mappings"),n.options.strict&&x.start<v.found.offset-1024&&r(y.range,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit block mapping key"));const _=j?t(n,j,v,r):s(n,c,p,null,v,r);n.schema.compat&&Gl(i.indent,j,r),c=_.range[2];const C=new Qe(y,_);n.options.keepSourceTokens&&(C.srcToken=m),l.items.push(C)}else{b&&r(y.range,"MISSING_CHAR","Implicit map keys need to be followed by map values"),v.comment&&(y.comment?y.comment+=`
`+v.comment:y.comment=v.comment);const _=new Qe(y);n.options.keepSourceTokens&&(_.srcToken=m),l.items.push(_)}}return d&&d<c&&r(d,"IMPOSSIBLE","Map comment with trailing content"),l.range=[i.offset,c,d??c],l}function YT({composeNode:t,composeEmptyNode:s},n,i,r,a){const o=a?.nodeClass??Gs,l=new o(n.schema);n.atRoot&&(n.atRoot=!1),n.atKey&&(n.atKey=!1);let c=i.offset,d=null;for(const{start:m,value:u}of i.items){const h=mi(m,{indicator:"seq-item-ind",next:u,offset:c,onError:r,parentIndent:i.indent,startOnNewline:!0});if(!h.found)if(h.anchor||h.tag||u)u&&u.type==="block-seq"?r(h.end,"BAD_INDENT","All sequence items must start at the same column"):r(c,"MISSING_CHAR","Sequence item without - indicator");else{d=h.end,h.comment&&(l.comment=h.comment);continue}const p=u?t(n,u,h,r):s(n,h.end,m,null,h,r);n.schema.compat&&Gl(i.indent,u,r),c=p.range[2],l.items.push(p)}return l.range=[i.offset,c,d??c],l}function Or(t,s,n,i){let r="";if(t){let a=!1,o="";for(const l of t){const{source:c,type:d}=l;switch(d){case"space":a=!0;break;case"comment":{n&&!a&&i(l,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const m=c.substring(1)||" ";r?r+=o+m:r=m,o="";break}case"newline":r&&(o+=c),a=!0;break;default:i(l,"UNEXPECTED_TOKEN",`Unexpected ${d} at node end`)}s+=c.length}}return{comment:r,offset:s}}const tl="Block collections are not allowed within flow collections",sl=t=>t&&(t.type==="block-map"||t.type==="block-seq");function XT({composeNode:t,composeEmptyNode:s},n,i,r,a){const o=i.start.source==="{",l=o?"flow map":"flow sequence",c=a?.nodeClass??(o?yt:Gs),d=new c(n.schema);d.flow=!0;const m=n.atRoot;m&&(n.atRoot=!1),n.atKey&&(n.atKey=!1);let u=i.offset+i.start.source.length;for(let b=0;b<i.items.length;++b){const w=i.items[b],{start:y,key:v,sep:_,value:C}=w,k=mi(y,{flow:l,indicator:"explicit-key-ind",next:v??_?.[0],offset:u,onError:r,parentIndent:i.indent,startOnNewline:!1});if(!k.found){if(!k.anchor&&!k.tag&&!_&&!C){b===0&&k.comma?r(k.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${l}`):b<i.items.length-1&&r(k.start,"UNEXPECTED_TOKEN",`Unexpected empty item in ${l}`),k.comment&&(d.comment?d.comment+=`
`+k.comment:d.comment=k.comment),u=k.end;continue}!o&&n.options.strict&&yr(v)&&r(v,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line")}if(b===0)k.comma&&r(k.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${l}`);else if(k.comma||r(k.start,"MISSING_CHAR",`Missing , between ${l} items`),k.comment){let N="";e:for(const z of y)switch(z.type){case"comma":case"space":break;case"comment":N=z.source.substring(1);break e;default:break e}if(N){let z=d.items[d.items.length-1];je(z)&&(z=z.value??z.key),z.comment?z.comment+=`
`+N:z.comment=N,k.comment=k.comment.substring(N.length+1)}}if(!o&&!_&&!k.found){const N=C?t(n,C,k,r):s(n,k.end,_,null,k,r);d.items.push(N),u=N.range[2],sl(C)&&r(N.range,"BLOCK_IN_FLOW",tl)}else{n.atKey=!0;const N=k.end,z=v?t(n,v,k,r):s(n,N,y,null,k,r);sl(v)&&r(z.range,"BLOCK_IN_FLOW",tl),n.atKey=!1;const T=mi(_??[],{flow:l,indicator:"map-value-ind",next:C,offset:z.range[2],onError:r,parentIndent:i.indent,startOnNewline:!1});if(T.found){if(!o&&!k.found&&n.options.strict){if(_)for(const A of _){if(A===T.found)break;if(A.type==="newline"){r(A,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line");break}}k.start<T.found.offset-1024&&r(T.found,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit flow sequence key")}}else C&&("source"in C&&C.source&&C.source[0]===":"?r(C,"MISSING_CHAR",`Missing space after : in ${l}`):r(T.start,"MISSING_CHAR",`Missing , or : between ${l} items`));const f=C?t(n,C,T,r):T.found?s(n,T.end,_,null,T,r):null;f?sl(C)&&r(f.range,"BLOCK_IN_FLOW",tl):T.comment&&(z.comment?z.comment+=`
`+T.comment:z.comment=T.comment);const S=new Qe(z,f);if(n.options.keepSourceTokens&&(S.srcToken=w),o){const A=d;wj(n,A.items,z)&&r(N,"DUPLICATE_KEY","Map keys must be unique"),A.items.push(S)}else{const A=new yt(n.schema);A.flow=!0,A.items.push(S);const D=(f??z).range;A.range=[z.range[0],D[1],D[2]],d.items.push(A)}u=f?f.range[2]:T.end}}const h=o?"}":"]",[p,...j]=i.end;let x=u;if(p&&p.source===h)x=p.offset+p.source.length;else{const b=l[0].toUpperCase()+l.substring(1),w=m?`${b} must end with a ${h}`:`${b} in block collection must be sufficiently indented and end with a ${h}`;r(u,m?"MISSING_CHAR":"BAD_INDENT",w),p&&p.source.length!==1&&j.unshift(p)}if(j.length>0){const b=Or(j,x,n.options.strict,r);b.comment&&(d.comment?d.comment+=`
`+b.comment:d.comment=b.comment),d.range=[i.offset,x,b.offset]}else d.range=[i.offset,x,x];return d}function nl(t,s,n,i,r,a){const o=n.type==="block-map"?QT(t,s,n,i,a):n.type==="block-seq"?YT(t,s,n,i,a):XT(t,s,n,i,a),l=o.constructor;return r==="!"||r===l.tagName?(o.tag=l.tagName,o):(r&&(o.tag=r),o)}function JT(t,s,n,i,r){const a=i.tag,o=a?s.directives.tagName(a.source,h=>r(a,"TAG_RESOLVE_FAILED",h)):null;if(n.type==="block-seq"){const{anchor:h,newlineAfterProp:p}=i,j=h&&a?h.offset>a.offset?h:a:h??a;j&&(!p||p.offset<j.offset)&&r(j,"MISSING_CHAR","Missing newline after block sequence props")}const l=n.type==="block-map"?"map":n.type==="block-seq"?"seq":n.start.source==="{"?"map":"seq";if(!a||!o||o==="!"||o===yt.tagName&&l==="map"||o===Gs.tagName&&l==="seq")return nl(t,s,n,r,o);let c=s.schema.tags.find(h=>h.tag===o&&h.collection===l);if(!c){const h=s.schema.knownTags[o];if(h&&h.collection===l)s.schema.tags.push(Object.assign({},h,{default:!1})),c=h;else return h?r(a,"BAD_COLLECTION_TYPE",`${h.tag} used for ${l} collection, but expects ${h.collection??"scalar"}`,!0):r(a,"TAG_RESOLVE_FAILED",`Unresolved tag: ${o}`,!0),nl(t,s,n,r,o)}const d=nl(t,s,n,r,o,c),m=c.resolve?.(d,h=>r(a,"TAG_RESOLVE_FAILED",h),s.options)??d,u=Ne(m)?m:new te(m);return u.range=d.range,u.tag=o,c?.format&&(u.format=c.format),u}function vj(t,s,n){const i=s.offset,r=eA(s,t.options.strict,n);if(!r)return{value:"",type:null,comment:"",range:[i,i,i]};const a=r.mode===">"?te.BLOCK_FOLDED:te.BLOCK_LITERAL,o=s.source?tA(s.source):[];let l=o.length;for(let x=o.length-1;x>=0;--x){const b=o[x][1];if(b===""||b==="\r")l=x;else break}if(l===0){const x=r.chomp==="+"&&o.length>0?`
`.repeat(Math.max(1,o.length-1)):"";let b=i+r.length;return s.source&&(b+=s.source.length),{value:x,type:a,comment:r.comment,range:[i,b,b]}}let c=s.indent+r.indent,d=s.offset+r.length,m=0;for(let x=0;x<l;++x){const[b,w]=o[x];if(w===""||w==="\r")r.indent===0&&b.length>c&&(c=b.length);else{b.length<c&&n(d+b.length,"MISSING_CHAR","Block scalars with more-indented leading empty lines must use an explicit indentation indicator"),r.indent===0&&(c=b.length),m=x,c===0&&!t.atRoot&&n(d,"BAD_INDENT","Block scalar values in collections must be indented");break}d+=b.length+w.length+1}for(let x=o.length-1;x>=l;--x)o[x][0].length>c&&(l=x+1);let u="",h="",p=!1;for(let x=0;x<m;++x)u+=o[x][0].slice(c)+`
`;for(let x=m;x<l;++x){let[b,w]=o[x];d+=b.length+w.length+1;const y=w[w.length-1]==="\r";if(y&&(w=w.slice(0,-1)),w&&b.length<c){const _=`Block scalar lines must not be less indented than their ${r.indent?"explicit indentation indicator":"first line"}`;n(d-w.length-(y?2:1),"BAD_INDENT",_),b=""}a===te.BLOCK_LITERAL?(u+=h+b.slice(c)+w,h=`
`):b.length>c||w[0]==="	"?(h===" "?h=`
`:!p&&h===`
`&&(h=`

`),u+=h+b.slice(c)+w,h=`
`,p=!0):w===""?h===`
`?u+=`
`:h=`
`:(u+=h+w,h=" ",p=!1)}switch(r.chomp){case"-":break;case"+":for(let x=l;x<o.length;++x)u+=`
`+o[x][0].slice(c);u[u.length-1]!==`
`&&(u+=`
`);break;default:u+=`
`}const j=i+r.length+s.source.length;return{value:u,type:a,comment:r.comment,range:[i,j,j]}}function eA({offset:t,props:s},n,i){if(s[0].type!=="block-scalar-header")return i(s[0],"IMPOSSIBLE","Block scalar header not found"),null;const{source:r}=s[0],a=r[0];let o=0,l="",c=-1;for(let h=1;h<r.length;++h){const p=r[h];if(!l&&(p==="-"||p==="+"))l=p;else{const j=Number(p);!o&&j?o=j:c===-1&&(c=t+h)}}c!==-1&&i(c,"UNEXPECTED_TOKEN",`Block scalar header includes extra characters: ${r}`);let d=!1,m="",u=r.length;for(let h=1;h<s.length;++h){const p=s[h];switch(p.type){case"space":d=!0;case"newline":u+=p.source.length;break;case"comment":n&&!d&&i(p,"MISSING_CHAR","Comments must be separated from other tokens by white space characters"),u+=p.source.length,m=p.source.substring(1);break;case"error":i(p,"UNEXPECTED_TOKEN",p.message),u+=p.source.length;break;default:{const j=`Unexpected token in block scalar header: ${p.type}`;i(p,"UNEXPECTED_TOKEN",j);const x=p.source;x&&typeof x=="string"&&(u+=x.length)}}}return{mode:a,indent:o,chomp:l,comment:m,length:u}}function tA(t){const s=t.split(/\n( *)/),n=s[0],i=n.match(/^( *)/),a=[i?.[1]?[i[1],n.slice(i[1].length)]:["",n]];for(let o=1;o<s.length;o+=2)a.push([s[o],s[o+1]]);return a}function Nj(t,s,n){const{offset:i,type:r,source:a,end:o}=t;let l,c;const d=(h,p,j)=>n(i+h,p,j);switch(r){case"scalar":l=te.PLAIN,c=sA(a,d);break;case"single-quoted-scalar":l=te.QUOTE_SINGLE,c=nA(a,d);break;case"double-quoted-scalar":l=te.QUOTE_DOUBLE,c=iA(a,d);break;default:return n(t,"UNEXPECTED_TOKEN",`Expected a flow scalar value, but found: ${r}`),{value:"",type:null,comment:"",range:[i,i+a.length,i+a.length]}}const m=i+a.length,u=Or(o,m,s,n);return{value:c,type:l,comment:u.comment,range:[i,m,u.offset]}}function sA(t,s){let n="";switch(t[0]){case"	":n="a tab character";break;case",":n="flow indicator character ,";break;case"%":n="directive indicator character %";break;case"|":case">":{n=`block scalar indicator ${t[0]}`;break}case"@":case"`":{n=`reserved character ${t[0]}`;break}}return n&&s(0,"BAD_SCALAR_START",`Plain value cannot start with ${n}`),kj(t)}function nA(t,s){return(t[t.length-1]!=="'"||t.length===1)&&s(t.length,"MISSING_CHAR","Missing closing 'quote"),kj(t.slice(1,-1)).replace(/''/g,"'")}function kj(t){let s,n;try{s=new RegExp(`(.*?)(?<![ 	])[ 	]*\r?
`,"sy"),n=new RegExp(`[ 	]*(.*?)(?:(?<![ 	])[ 	]*)?\r?
`,"sy")}catch{s=/(.*?)[ \t]*\r?\n/sy,n=/[ \t]*(.*?)[ \t]*\r?\n/sy}let i=s.exec(t);if(!i)return t;let r=i[1],a=" ",o=s.lastIndex;for(n.lastIndex=o;i=n.exec(t);)i[1]===""?a===`
`?r+=a:a=`
`:(r+=a+i[1],a=" "),o=n.lastIndex;const l=/[ \t]*(.*)/sy;return l.lastIndex=o,i=l.exec(t),r+a+(i?.[1]??"")}function iA(t,s){let n="";for(let i=1;i<t.length-1;++i){const r=t[i];if(!(r==="\r"&&t[i+1]===`
`))if(r===`
`){const{fold:a,offset:o}=rA(t,i);n+=a,i=o}else if(r==="\\"){let a=t[++i];const o=aA[a];if(o)n+=o;else if(a===`
`)for(a=t[i+1];a===" "||a==="	";)a=t[++i+1];else if(a==="\r"&&t[i+1]===`
`)for(a=t[++i+1];a===" "||a==="	";)a=t[++i+1];else if(a==="x"||a==="u"||a==="U"){const l={x:2,u:4,U:8}[a];n+=oA(t,i+1,l,s),i+=l}else{const l=t.substr(i-1,2);s(i-1,"BAD_DQ_ESCAPE",`Invalid escape sequence ${l}`),n+=l}}else if(r===" "||r==="	"){const a=i;let o=t[i+1];for(;o===" "||o==="	";)o=t[++i+1];o!==`
`&&!(o==="\r"&&t[i+2]===`
`)&&(n+=i>a?t.slice(a,i+1):r)}else n+=r}return(t[t.length-1]!=='"'||t.length===1)&&s(t.length,"MISSING_CHAR",'Missing closing "quote'),n}function rA(t,s){let n="",i=t[s+1];for(;(i===" "||i==="	"||i===`
`||i==="\r")&&!(i==="\r"&&t[s+2]!==`
`);)i===`
`&&(n+=`
`),s+=1,i=t[s+1];return n||(n=" "),{fold:n,offset:s}}const aA={0:"\0",a:"\x07",b:"\b",e:"\x1B",f:"\f",n:`
`,r:"\r",t:"	",v:"\v",N:"",_:" ",L:"\u2028",P:"\u2029"," ":" ",'"':'"',"/":"/","\\":"\\","	":"	"};function oA(t,s,n,i){const r=t.substr(s,n),o=r.length===n&&/^[0-9a-fA-F]+$/.test(r)?parseInt(r,16):NaN;if(isNaN(o)){const l=t.substr(s-2,n+2);return i(s-2,"BAD_DQ_ESCAPE",`Invalid escape sequence ${l}`),l}return String.fromCodePoint(o)}function zj(t,s,n,i){const{value:r,type:a,comment:o,range:l}=s.type==="block-scalar"?vj(t,s,i):Nj(s,t.options.strict,i),c=n?t.directives.tagName(n.source,u=>i(n,"TAG_RESOLVE_FAILED",u)):null;let d;t.options.stringKeys&&t.atKey?d=t.schema[os]:c?d=lA(t.schema,r,c,n,i):s.type==="scalar"?d=cA(t,r,s,i):d=t.schema[os];let m;try{const u=d.resolve(r,h=>i(n??s,"TAG_RESOLVE_FAILED",h),t.options);m=ue(u)?u:new te(u)}catch(u){const h=u instanceof Error?u.message:String(u);i(n??s,"TAG_RESOLVE_FAILED",h),m=new te(r)}return m.range=l,m.source=r,a&&(m.type=a),c&&(m.tag=c),d.format&&(m.format=d.format),o&&(m.comment=o),m}function lA(t,s,n,i,r){if(n==="!")return t[os];const a=[];for(const l of t.tags)if(!l.collection&&l.tag===n)if(l.default&&l.test)a.push(l);else return l;for(const l of a)if(l.test?.test(s))return l;const o=t.knownTags[n];return o&&!o.collection?(t.tags.push(Object.assign({},o,{default:!1,test:void 0})),o):(r(i,"TAG_RESOLVE_FAILED",`Unresolved tag: ${n}`,n!=="tag:yaml.org,2002:str"),t[os])}function cA({atKey:t,directives:s,schema:n},i,r,a){const o=n.tags.find(l=>(l.default===!0||t&&l.default==="key")&&l.test?.test(i))||n[os];if(n.compat){const l=n.compat.find(c=>c.default&&c.test?.test(i))??n[os];if(o.tag!==l.tag){const c=s.tagString(o.tag),d=s.tagString(l.tag),m=`Value may be parsed as either ${c} or ${d}`;a(r,"TAG_RESOLVE_FAILED",m,!0)}}return o}function dA(t,s,n){if(s){n??(n=s.length);for(let i=n-1;i>=0;--i){let r=s[i];switch(r.type){case"space":case"comment":case"newline":t-=r.source.length;continue}for(r=s[++i];r?.type==="space";)t+=r.source.length,r=s[++i];break}}return t}const uA={composeNode:Sj,composeEmptyNode:vd};function Sj(t,s,n,i){const r=t.atKey,{spaceBefore:a,comment:o,anchor:l,tag:c}=n;let d,m=!0;switch(s.type){case"alias":d=mA(t,s,i),(l||c)&&i(s,"ALIAS_PROPS","An alias node must not specify any properties");break;case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"block-scalar":d=zj(t,s,c,i),l&&(d.anchor=l.source.substring(1));break;case"block-map":case"block-seq":case"flow-collection":d=JT(uA,t,s,n,i),l&&(d.anchor=l.source.substring(1));break;default:{const u=s.type==="error"?s.message:`Unsupported token (type: ${s.type})`;i(s,"UNEXPECTED_TOKEN",u),d=vd(t,s.offset,void 0,null,n,i),m=!1}}return l&&d.anchor===""&&i(l,"BAD_ALIAS","Anchor cannot be an empty string"),r&&t.options.stringKeys&&(!ue(d)||typeof d.value!="string"||d.tag&&d.tag!=="tag:yaml.org,2002:str")&&i(c??s,"NON_STRING_KEY","With stringKeys, all keys must be strings"),a&&(d.spaceBefore=!0),o&&(s.type==="scalar"&&s.source===""?d.comment=o:d.commentBefore=o),t.options.keepSourceTokens&&m&&(d.srcToken=s),d}function vd(t,s,n,i,{spaceBefore:r,comment:a,anchor:o,tag:l,end:c},d){const m={type:"scalar",offset:dA(s,n,i),indent:-1,source:""},u=zj(t,m,l,d);return o&&(u.anchor=o.source.substring(1),u.anchor===""&&d(o,"BAD_ALIAS","Anchor cannot be an empty string")),r&&(u.spaceBefore=!0),a&&(u.comment=a,u.range[2]=c),u}function mA({options:t},{offset:s,source:n,end:i},r){const a=new co(n.substring(1));a.source===""&&r(s,"BAD_ALIAS","Alias cannot be an empty string"),a.source.endsWith(":")&&r(s+n.length-1,"BAD_ALIAS","Alias ending in : is ambiguous",!0);const o=s+n.length,l=Or(i,o,t.strict,r);return a.range=[s,o,l.offset],l.comment&&(a.comment=l.comment),a}function hA(t,s,{offset:n,start:i,value:r,end:a},o){const l=Object.assign({_directives:s},t),c=new _i(void 0,l),d={atKey:!1,atRoot:!0,directives:c.directives,options:c.options,schema:c.schema},m=mi(i,{indicator:"doc-start",next:r??a?.[0],offset:n,onError:o,parentIndent:0,startOnNewline:!0});m.found&&(c.directives.docStart=!0,r&&(r.type==="block-map"||r.type==="block-seq")&&!m.hasNewline&&o(m.end,"MISSING_CHAR","Block collection cannot start on same line with directives-end marker")),c.contents=r?Sj(d,r,m,o):vd(d,m.end,i,null,m,o);const u=c.contents.range[2],h=Or(a,u,!1,o);return h.comment&&(c.comment=h.comment),c.range=[n,u,h.offset],c}function Ei(t){if(typeof t=="number")return[t,t+1];if(Array.isArray(t))return t.length===2?t:[t[0],t[1]];const{offset:s,source:n}=t;return[s,s+(typeof n=="string"?n.length:1)]}function Ym(t){let s="",n=!1,i=!1;for(let r=0;r<t.length;++r){const a=t[r];switch(a[0]){case"#":s+=(s===""?"":i?`

`:`
`)+(a.substring(1)||" "),n=!0,i=!1;break;case"%":t[r+1]?.[0]!=="#"&&(r+=1),n=!1;break;default:n||(i=!0),n=!1}}return{comment:s,afterEmptyLine:i}}class Nd{constructor(s={}){this.doc=null,this.atDirectives=!1,this.prelude=[],this.errors=[],this.warnings=[],this.onError=(n,i,r,a)=>{const o=Ei(n);a?this.warnings.push(new bj(o,i,r)):this.errors.push(new cn(o,i,r))},this.directives=new et({version:s.version||"1.2"}),this.options=s}decorate(s,n){const{comment:i,afterEmptyLine:r}=Ym(this.prelude);if(i){const a=s.contents;if(n)s.comment=s.comment?`${s.comment}
${i}`:i;else if(r||s.directives.docStart||!a)s.commentBefore=i;else if(be(a)&&!a.flow&&a.items.length>0){let o=a.items[0];je(o)&&(o=o.key);const l=o.commentBefore;o.commentBefore=l?`${i}
${l}`:i}else{const o=a.commentBefore;a.commentBefore=o?`${i}
${o}`:i}}n?(Array.prototype.push.apply(s.errors,this.errors),Array.prototype.push.apply(s.warnings,this.warnings)):(s.errors=this.errors,s.warnings=this.warnings),this.prelude=[],this.errors=[],this.warnings=[]}streamInfo(){return{comment:Ym(this.prelude).comment,directives:this.directives,errors:this.errors,warnings:this.warnings}}*compose(s,n=!1,i=-1){for(const r of s)yield*this.next(r);yield*this.end(n,i)}*next(s){switch(s.type){case"directive":this.directives.add(s.source,(n,i,r)=>{const a=Ei(s);a[0]+=n,this.onError(a,"BAD_DIRECTIVE",i,r)}),this.prelude.push(s.source),this.atDirectives=!0;break;case"document":{const n=hA(this.options,this.directives,s,this.onError);this.atDirectives&&!n.directives.docStart&&this.onError(s,"MISSING_CHAR","Missing directives-end/doc-start indicator line"),this.decorate(n,!1),this.doc&&(yield this.doc),this.doc=n,this.atDirectives=!1;break}case"byte-order-mark":case"space":break;case"comment":case"newline":this.prelude.push(s.source);break;case"error":{const n=s.source?`${s.message}: ${JSON.stringify(s.source)}`:s.message,i=new cn(Ei(s),"UNEXPECTED_TOKEN",n);this.atDirectives||!this.doc?this.errors.push(i):this.doc.errors.push(i);break}case"doc-end":{if(!this.doc){const i="Unexpected doc-end without preceding document";this.errors.push(new cn(Ei(s),"UNEXPECTED_TOKEN",i));break}this.doc.directives.docEnd=!0;const n=Or(s.end,s.offset+s.source.length,this.doc.options.strict,this.onError);if(this.decorate(this.doc,!0),n.comment){const i=this.doc.comment;this.doc.comment=i?`${i}
${n.comment}`:n.comment}this.doc.range[2]=n.offset;break}default:this.errors.push(new cn(Ei(s),"UNEXPECTED_TOKEN",`Unsupported token ${s.type}`))}}*end(s=!1,n=-1){if(this.doc)this.decorate(this.doc,!0),yield this.doc,this.doc=null;else if(s){const i=Object.assign({_directives:this.directives},this.options),r=new _i(void 0,i);this.atDirectives&&this.onError(n,"MISSING_CHAR","Missing directives-end indicator line"),r.range=[0,n,n],this.decorate(r,!1),yield r}}}function fA(t,s=!0,n){if(t){const i=(r,a,o)=>{const l=typeof r=="number"?r:Array.isArray(r)?r[0]:r.offset;if(n)n(l,a,o);else throw new cn([l,l+1],a,o)};switch(t.type){case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return Nj(t,s,i);case"block-scalar":return vj({options:{strict:s}},t,i)}}return null}function pA(t,s){const{implicitKey:n=!1,indent:i,inFlow:r=!1,offset:a=-1,type:o="PLAIN"}=s,l=Er({type:o,value:t},{implicitKey:n,indent:i>0?" ".repeat(i):"",inFlow:r,options:{blockQuote:!0,lineWidth:-1}}),c=s.end??[{type:"newline",offset:-1,indent:i,source:`
`}];switch(l[0]){case"|":case">":{const d=l.indexOf(`
`),m=l.substring(0,d),u=l.substring(d+1)+`
`,h=[{type:"block-scalar-header",offset:a,indent:i,source:m}];return Cj(h,c)||h.push({type:"newline",offset:-1,indent:i,source:`
`}),{type:"block-scalar",offset:a,indent:i,props:h,source:u}}case'"':return{type:"double-quoted-scalar",offset:a,indent:i,source:l,end:c};case"'":return{type:"single-quoted-scalar",offset:a,indent:i,source:l,end:c};default:return{type:"scalar",offset:a,indent:i,source:l,end:c}}}function xA(t,s,n={}){let{afterKey:i=!1,implicitKey:r=!1,inFlow:a=!1,type:o}=n,l="indent"in t?t.indent:null;if(i&&typeof l=="number"&&(l+=2),!o)switch(t.type){case"single-quoted-scalar":o="QUOTE_SINGLE";break;case"double-quoted-scalar":o="QUOTE_DOUBLE";break;case"block-scalar":{const d=t.props[0];if(d.type!=="block-scalar-header")throw new Error("Invalid block scalar header");o=d.source[0]===">"?"BLOCK_FOLDED":"BLOCK_LITERAL";break}default:o="PLAIN"}const c=Er({type:o,value:s},{implicitKey:r||l===null,indent:l!==null&&l>0?" ".repeat(l):"",inFlow:a,options:{blockQuote:!0,lineWidth:-1}});switch(c[0]){case"|":case">":gA(t,c);break;case'"':il(t,c,"double-quoted-scalar");break;case"'":il(t,c,"single-quoted-scalar");break;default:il(t,c,"scalar")}}function gA(t,s){const n=s.indexOf(`
`),i=s.substring(0,n),r=s.substring(n+1)+`
`;if(t.type==="block-scalar"){const a=t.props[0];if(a.type!=="block-scalar-header")throw new Error("Invalid block scalar header");a.source=i,t.source=r}else{const{offset:a}=t,o="indent"in t?t.indent:-1,l=[{type:"block-scalar-header",offset:a,indent:o,source:i}];Cj(l,"end"in t?t.end:void 0)||l.push({type:"newline",offset:-1,indent:o,source:`
`});for(const c of Object.keys(t))c!=="type"&&c!=="offset"&&delete t[c];Object.assign(t,{type:"block-scalar",indent:o,props:l,source:r})}}function Cj(t,s){if(s)for(const n of s)switch(n.type){case"space":case"comment":t.push(n);break;case"newline":return t.push(n),!0}return!1}function il(t,s,n){switch(t.type){case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":t.type=n,t.source=s;break;case"block-scalar":{const i=t.props.slice(1);let r=s.length;t.props[0].type==="block-scalar-header"&&(r-=t.props[0].source.length);for(const a of i)a.offset+=r;delete t.props,Object.assign(t,{type:n,source:s,end:i});break}case"block-map":case"block-seq":{const r={type:"newline",offset:t.offset+s.length,indent:t.indent,source:`
`};delete t.items,Object.assign(t,{type:n,source:s,end:[r]});break}default:{const i="indent"in t?t.indent:-1,r="end"in t&&Array.isArray(t.end)?t.end.filter(a=>a.type==="space"||a.type==="comment"||a.type==="newline"):[];for(const a of Object.keys(t))a!=="type"&&a!=="offset"&&delete t[a];Object.assign(t,{type:n,indent:i,source:s,end:r})}}}const jA=t=>"type"in t?Aa(t):ca(t);function Aa(t){switch(t.type){case"block-scalar":{let s="";for(const n of t.props)s+=Aa(n);return s+t.source}case"block-map":case"block-seq":{let s="";for(const n of t.items)s+=ca(n);return s}case"flow-collection":{let s=t.start.source;for(const n of t.items)s+=ca(n);for(const n of t.end)s+=n.source;return s}case"document":{let s=ca(t);if(t.end)for(const n of t.end)s+=n.source;return s}default:{let s=t.source;if("end"in t&&t.end)for(const n of t.end)s+=n.source;return s}}}function ca({start:t,key:s,sep:n,value:i}){let r="";for(const a of t)r+=a.source;if(s&&(r+=Aa(s)),n)for(const a of n)r+=a.source;return i&&(r+=Aa(i)),r}const Hl=Symbol("break visit"),yA=Symbol("skip children"),_j=Symbol("remove item");function wn(t,s){"type"in t&&t.type==="document"&&(t={start:t.start,value:t.value}),Tj(Object.freeze([]),t,s)}wn.BREAK=Hl;wn.SKIP=yA;wn.REMOVE=_j;wn.itemAtPath=(t,s)=>{let n=t;for(const[i,r]of s){const a=n?.[i];if(a&&"items"in a)n=a.items[r];else return}return n};wn.parentCollection=(t,s)=>{const n=wn.itemAtPath(t,s.slice(0,-1)),i=s[s.length-1][0],r=n?.[i];if(r&&"items"in r)return r;throw new Error("Parent collection not found")};function Tj(t,s,n){let i=n(s,t);if(typeof i=="symbol")return i;for(const r of["key","value"]){const a=s[r];if(a&&"items"in a){for(let o=0;o<a.items.length;++o){const l=Tj(Object.freeze(t.concat([[r,o]])),a.items[o],n);if(typeof l=="number")o=l-1;else{if(l===Hl)return Hl;l===_j&&(a.items.splice(o,1),o-=1)}}typeof i=="function"&&r==="key"&&(i=i(s,t))}}return typeof i=="function"?i(s,t):i}const bo="\uFEFF",wo="",vo="",br="",bA=t=>!!t&&"items"in t,wA=t=>!!t&&(t.type==="scalar"||t.type==="single-quoted-scalar"||t.type==="double-quoted-scalar"||t.type==="block-scalar");function vA(t){switch(t){case bo:return"<BOM>";case wo:return"<DOC>";case vo:return"<FLOW_END>";case br:return"<SCALAR>";default:return JSON.stringify(t)}}function Aj(t){switch(t){case bo:return"byte-order-mark";case wo:return"doc-mode";case vo:return"flow-error-end";case br:return"scalar";case"---":return"doc-start";case"...":return"doc-end";case"":case`
`:case`\r
`:return"newline";case"-":return"seq-item-ind";case"?":return"explicit-key-ind";case":":return"map-value-ind";case"{":return"flow-map-start";case"}":return"flow-map-end";case"[":return"flow-seq-start";case"]":return"flow-seq-end";case",":return"comma"}switch(t[0]){case" ":case"	":return"space";case"#":return"comment";case"%":return"directive-line";case"*":return"alias";case"&":return"anchor";case"!":return"tag";case"'":return"single-quoted-scalar";case'"':return"double-quoted-scalar";case"|":case">":return"block-scalar-header"}return null}const NA=Object.freeze(Object.defineProperty({__proto__:null,BOM:bo,DOCUMENT:wo,FLOW_END:vo,SCALAR:br,createScalarToken:pA,isCollection:bA,isScalar:wA,prettyToken:vA,resolveAsScalar:fA,setScalarValue:xA,stringify:jA,tokenType:Aj,visit:wn},Symbol.toStringTag,{value:"Module"}));function Lt(t){switch(t){case void 0:case" ":case`
`:case"\r":case"	":return!0;default:return!1}}const Xm=new Set("0123456789ABCDEFabcdef"),kA=new Set("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-#;/?:@&=+$_.!~*'()"),Xr=new Set(",[]{}"),zA=new Set(` ,[]{}
\r	`),rl=t=>!t||zA.has(t);class Dj{constructor(){this.atEnd=!1,this.blockScalarIndent=-1,this.blockScalarKeep=!1,this.buffer="",this.flowKey=!1,this.flowLevel=0,this.indentNext=0,this.indentValue=0,this.lineEndPos=null,this.next=null,this.pos=0}*lex(s,n=!1){if(s){if(typeof s!="string")throw TypeError("source is not a string");this.buffer=this.buffer?this.buffer+s:s,this.lineEndPos=null}this.atEnd=!n;let i=this.next??"stream";for(;i&&(n||this.hasChars(1));)i=yield*this.parseNext(i)}atLineEnd(){let s=this.pos,n=this.buffer[s];for(;n===" "||n==="	";)n=this.buffer[++s];return!n||n==="#"||n===`
`?!0:n==="\r"?this.buffer[s+1]===`
`:!1}charAt(s){return this.buffer[this.pos+s]}continueScalar(s){let n=this.buffer[s];if(this.indentNext>0){let i=0;for(;n===" ";)n=this.buffer[++i+s];if(n==="\r"){const r=this.buffer[i+s+1];if(r===`
`||!r&&!this.atEnd)return s+i+1}return n===`
`||i>=this.indentNext||!n&&!this.atEnd?s+i:-1}if(n==="-"||n==="."){const i=this.buffer.substr(s,3);if((i==="---"||i==="...")&&Lt(this.buffer[s+3]))return-1}return s}getLine(){let s=this.lineEndPos;return(typeof s!="number"||s!==-1&&s<this.pos)&&(s=this.buffer.indexOf(`
`,this.pos),this.lineEndPos=s),s===-1?this.atEnd?this.buffer.substring(this.pos):null:(this.buffer[s-1]==="\r"&&(s-=1),this.buffer.substring(this.pos,s))}hasChars(s){return this.pos+s<=this.buffer.length}setNext(s){return this.buffer=this.buffer.substring(this.pos),this.pos=0,this.lineEndPos=null,this.next=s,null}peek(s){return this.buffer.substr(this.pos,s)}*parseNext(s){switch(s){case"stream":return yield*this.parseStream();case"line-start":return yield*this.parseLineStart();case"block-start":return yield*this.parseBlockStart();case"doc":return yield*this.parseDocument();case"flow":return yield*this.parseFlowCollection();case"quoted-scalar":return yield*this.parseQuotedScalar();case"block-scalar":return yield*this.parseBlockScalar();case"plain-scalar":return yield*this.parsePlainScalar()}}*parseStream(){let s=this.getLine();if(s===null)return this.setNext("stream");if(s[0]===bo&&(yield*this.pushCount(1),s=s.substring(1)),s[0]==="%"){let n=s.length,i=s.indexOf("#");for(;i!==-1;){const a=s[i-1];if(a===" "||a==="	"){n=i-1;break}else i=s.indexOf("#",i+1)}for(;;){const a=s[n-1];if(a===" "||a==="	")n-=1;else break}const r=(yield*this.pushCount(n))+(yield*this.pushSpaces(!0));return yield*this.pushCount(s.length-r),this.pushNewline(),"stream"}if(this.atLineEnd()){const n=yield*this.pushSpaces(!0);return yield*this.pushCount(s.length-n),yield*this.pushNewline(),"stream"}return yield wo,yield*this.parseLineStart()}*parseLineStart(){const s=this.charAt(0);if(!s&&!this.atEnd)return this.setNext("line-start");if(s==="-"||s==="."){if(!this.atEnd&&!this.hasChars(4))return this.setNext("line-start");const n=this.peek(3);if((n==="---"||n==="...")&&Lt(this.charAt(3)))return yield*this.pushCount(3),this.indentValue=0,this.indentNext=0,n==="---"?"doc":"stream"}return this.indentValue=yield*this.pushSpaces(!1),this.indentNext>this.indentValue&&!Lt(this.charAt(1))&&(this.indentNext=this.indentValue),yield*this.parseBlockStart()}*parseBlockStart(){const[s,n]=this.peek(2);if(!n&&!this.atEnd)return this.setNext("block-start");if((s==="-"||s==="?"||s===":")&&Lt(n)){const i=(yield*this.pushCount(1))+(yield*this.pushSpaces(!0));return this.indentNext=this.indentValue+1,this.indentValue+=i,yield*this.parseBlockStart()}return"doc"}*parseDocument(){yield*this.pushSpaces(!0);const s=this.getLine();if(s===null)return this.setNext("doc");let n=yield*this.pushIndicators();switch(s[n]){case"#":yield*this.pushCount(s.length-n);case void 0:return yield*this.pushNewline(),yield*this.parseLineStart();case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel=1,"flow";case"}":case"]":return yield*this.pushCount(1),"doc";case"*":return yield*this.pushUntil(rl),"doc";case'"':case"'":return yield*this.parseQuotedScalar();case"|":case">":return n+=yield*this.parseBlockScalarHeader(),n+=yield*this.pushSpaces(!0),yield*this.pushCount(s.length-n),yield*this.pushNewline(),yield*this.parseBlockScalar();default:return yield*this.parsePlainScalar()}}*parseFlowCollection(){let s,n,i=-1;do s=yield*this.pushNewline(),s>0?(n=yield*this.pushSpaces(!1),this.indentValue=i=n):n=0,n+=yield*this.pushSpaces(!0);while(s+n>0);const r=this.getLine();if(r===null)return this.setNext("flow");if((i!==-1&&i<this.indentNext&&r[0]!=="#"||i===0&&(r.startsWith("---")||r.startsWith("..."))&&Lt(r[3]))&&!(i===this.indentNext-1&&this.flowLevel===1&&(r[0]==="]"||r[0]==="}")))return this.flowLevel=0,yield vo,yield*this.parseLineStart();let a=0;for(;r[a]===",";)a+=yield*this.pushCount(1),a+=yield*this.pushSpaces(!0),this.flowKey=!1;switch(a+=yield*this.pushIndicators(),r[a]){case void 0:return"flow";case"#":return yield*this.pushCount(r.length-a),"flow";case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel+=1,"flow";case"}":case"]":return yield*this.pushCount(1),this.flowKey=!0,this.flowLevel-=1,this.flowLevel?"flow":"doc";case"*":return yield*this.pushUntil(rl),"flow";case'"':case"'":return this.flowKey=!0,yield*this.parseQuotedScalar();case":":{const o=this.charAt(1);if(this.flowKey||Lt(o)||o===",")return this.flowKey=!1,yield*this.pushCount(1),yield*this.pushSpaces(!0),"flow"}default:return this.flowKey=!1,yield*this.parsePlainScalar()}}*parseQuotedScalar(){const s=this.charAt(0);let n=this.buffer.indexOf(s,this.pos+1);if(s==="'")for(;n!==-1&&this.buffer[n+1]==="'";)n=this.buffer.indexOf("'",n+2);else for(;n!==-1;){let a=0;for(;this.buffer[n-1-a]==="\\";)a+=1;if(a%2===0)break;n=this.buffer.indexOf('"',n+1)}const i=this.buffer.substring(0,n);let r=i.indexOf(`
`,this.pos);if(r!==-1){for(;r!==-1;){const a=this.continueScalar(r+1);if(a===-1)break;r=i.indexOf(`
`,a)}r!==-1&&(n=r-(i[r-1]==="\r"?2:1))}if(n===-1){if(!this.atEnd)return this.setNext("quoted-scalar");n=this.buffer.length}return yield*this.pushToIndex(n+1,!1),this.flowLevel?"flow":"doc"}*parseBlockScalarHeader(){this.blockScalarIndent=-1,this.blockScalarKeep=!1;let s=this.pos;for(;;){const n=this.buffer[++s];if(n==="+")this.blockScalarKeep=!0;else if(n>"0"&&n<="9")this.blockScalarIndent=Number(n)-1;else if(n!=="-")break}return yield*this.pushUntil(n=>Lt(n)||n==="#")}*parseBlockScalar(){let s=this.pos-1,n=0,i;e:for(let a=this.pos;i=this.buffer[a];++a)switch(i){case" ":n+=1;break;case`
`:s=a,n=0;break;case"\r":{const o=this.buffer[a+1];if(!o&&!this.atEnd)return this.setNext("block-scalar");if(o===`
`)break}default:break e}if(!i&&!this.atEnd)return this.setNext("block-scalar");if(n>=this.indentNext){this.blockScalarIndent===-1?this.indentNext=n:this.indentNext=this.blockScalarIndent+(this.indentNext===0?1:this.indentNext);do{const a=this.continueScalar(s+1);if(a===-1)break;s=this.buffer.indexOf(`
`,a)}while(s!==-1);if(s===-1){if(!this.atEnd)return this.setNext("block-scalar");s=this.buffer.length}}let r=s+1;for(i=this.buffer[r];i===" ";)i=this.buffer[++r];if(i==="	"){for(;i==="	"||i===" "||i==="\r"||i===`
`;)i=this.buffer[++r];s=r-1}else if(!this.blockScalarKeep)do{let a=s-1,o=this.buffer[a];o==="\r"&&(o=this.buffer[--a]);const l=a;for(;o===" ";)o=this.buffer[--a];if(o===`
`&&a>=this.pos&&a+1+n>l)s=a;else break}while(!0);return yield br,yield*this.pushToIndex(s+1,!0),yield*this.parseLineStart()}*parsePlainScalar(){const s=this.flowLevel>0;let n=this.pos-1,i=this.pos-1,r;for(;r=this.buffer[++i];)if(r===":"){const a=this.buffer[i+1];if(Lt(a)||s&&Xr.has(a))break;n=i}else if(Lt(r)){let a=this.buffer[i+1];if(r==="\r"&&(a===`
`?(i+=1,r=`
`,a=this.buffer[i+1]):n=i),a==="#"||s&&Xr.has(a))break;if(r===`
`){const o=this.continueScalar(i+1);if(o===-1)break;i=Math.max(i,o-2)}}else{if(s&&Xr.has(r))break;n=i}return!r&&!this.atEnd?this.setNext("plain-scalar"):(yield br,yield*this.pushToIndex(n+1,!0),s?"flow":"doc")}*pushCount(s){return s>0?(yield this.buffer.substr(this.pos,s),this.pos+=s,s):0}*pushToIndex(s,n){const i=this.buffer.slice(this.pos,s);return i?(yield i,this.pos+=i.length,i.length):(n&&(yield""),0)}*pushIndicators(){switch(this.charAt(0)){case"!":return(yield*this.pushTag())+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"&":return(yield*this.pushUntil(rl))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"-":case"?":case":":{const s=this.flowLevel>0,n=this.charAt(1);if(Lt(n)||s&&Xr.has(n))return s?this.flowKey&&(this.flowKey=!1):this.indentNext=this.indentValue+1,(yield*this.pushCount(1))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators())}}return 0}*pushTag(){if(this.charAt(1)==="<"){let s=this.pos+2,n=this.buffer[s];for(;!Lt(n)&&n!==">";)n=this.buffer[++s];return yield*this.pushToIndex(n===">"?s+1:s,!1)}else{let s=this.pos+1,n=this.buffer[s];for(;n;)if(kA.has(n))n=this.buffer[++s];else if(n==="%"&&Xm.has(this.buffer[s+1])&&Xm.has(this.buffer[s+2]))n=this.buffer[s+=3];else break;return yield*this.pushToIndex(s,!1)}}*pushNewline(){const s=this.buffer[this.pos];return s===`
`?yield*this.pushCount(1):s==="\r"&&this.charAt(1)===`
`?yield*this.pushCount(2):0}*pushSpaces(s){let n=this.pos-1,i;do i=this.buffer[++n];while(i===" "||s&&i==="	");const r=n-this.pos;return r>0&&(yield this.buffer.substr(this.pos,r),this.pos=n),r}*pushUntil(s){let n=this.pos,i=this.buffer[n];for(;!s(i);)i=this.buffer[++n];return yield*this.pushToIndex(n,!1)}}class Pj{constructor(){this.lineStarts=[],this.addNewLine=s=>this.lineStarts.push(s),this.linePos=s=>{let n=0,i=this.lineStarts.length;for(;n<i;){const a=n+i>>1;this.lineStarts[a]<s?n=a+1:i=a}if(this.lineStarts[n]===s)return{line:n+1,col:1};if(n===0)return{line:0,col:s};const r=this.lineStarts[n-1];return{line:n,col:s-r+1}}}}function Es(t,s){for(let n=0;n<t.length;++n)if(t[n].type===s)return!0;return!1}function Jm(t){for(let s=0;s<t.length;++s)switch(t[s].type){case"space":case"comment":case"newline":break;default:return s}return-1}function Mj(t){switch(t?.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"flow-collection":return!0;default:return!1}}function Jr(t){switch(t.type){case"document":return t.start;case"block-map":{const s=t.items[t.items.length-1];return s.sep??s.start}case"block-seq":return t.items[t.items.length-1].start;default:return[]}}function On(t){if(t.length===0)return[];let s=t.length;e:for(;--s>=0;)switch(t[s].type){case"doc-start":case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":case"newline":break e}for(;t[++s]?.type==="space";);return t.splice(s,t.length)}function eh(t){if(t.start.type==="flow-seq-start")for(const s of t.items)s.sep&&!s.value&&!Es(s.start,"explicit-key-ind")&&!Es(s.sep,"map-value-ind")&&(s.key&&(s.value=s.key),delete s.key,Mj(s.value)?s.value.end?Array.prototype.push.apply(s.value.end,s.sep):s.value.end=s.sep:Array.prototype.push.apply(s.start,s.sep),delete s.sep)}class kd{constructor(s){this.atNewLine=!0,this.atScalar=!1,this.indent=0,this.offset=0,this.onKeyLine=!1,this.stack=[],this.source="",this.type="",this.lexer=new Dj,this.onNewLine=s}*parse(s,n=!1){this.onNewLine&&this.offset===0&&this.onNewLine(0);for(const i of this.lexer.lex(s,n))yield*this.next(i);n||(yield*this.end())}*next(s){if(this.source=s,this.atScalar){this.atScalar=!1,yield*this.step(),this.offset+=s.length;return}const n=Aj(s);if(n)if(n==="scalar")this.atNewLine=!1,this.atScalar=!0,this.type="scalar";else{switch(this.type=n,yield*this.step(),n){case"newline":this.atNewLine=!0,this.indent=0,this.onNewLine&&this.onNewLine(this.offset+s.length);break;case"space":this.atNewLine&&s[0]===" "&&(this.indent+=s.length);break;case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":this.atNewLine&&(this.indent+=s.length);break;case"doc-mode":case"flow-error-end":return;default:this.atNewLine=!1}this.offset+=s.length}else{const i=`Not a YAML token: ${s}`;yield*this.pop({type:"error",offset:this.offset,message:i,source:s}),this.offset+=s.length}}*end(){for(;this.stack.length>0;)yield*this.pop()}get sourceToken(){return{type:this.type,offset:this.offset,indent:this.indent,source:this.source}}*step(){const s=this.peek(1);if(this.type==="doc-end"&&(!s||s.type!=="doc-end")){for(;this.stack.length>0;)yield*this.pop();this.stack.push({type:"doc-end",offset:this.offset,source:this.source});return}if(!s)return yield*this.stream();switch(s.type){case"document":return yield*this.document(s);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return yield*this.scalar(s);case"block-scalar":return yield*this.blockScalar(s);case"block-map":return yield*this.blockMap(s);case"block-seq":return yield*this.blockSequence(s);case"flow-collection":return yield*this.flowCollection(s);case"doc-end":return yield*this.documentEnd(s)}yield*this.pop()}peek(s){return this.stack[this.stack.length-s]}*pop(s){const n=s??this.stack.pop();if(!n)yield{type:"error",offset:this.offset,source:"",message:"Tried to pop an empty stack"};else if(this.stack.length===0)yield n;else{const i=this.peek(1);switch(n.type==="block-scalar"?n.indent="indent"in i?i.indent:0:n.type==="flow-collection"&&i.type==="document"&&(n.indent=0),n.type==="flow-collection"&&eh(n),i.type){case"document":i.value=n;break;case"block-scalar":i.props.push(n);break;case"block-map":{const r=i.items[i.items.length-1];if(r.value){i.items.push({start:[],key:n,sep:[]}),this.onKeyLine=!0;return}else if(r.sep)r.value=n;else{Object.assign(r,{key:n,sep:[]}),this.onKeyLine=!r.explicitKey;return}break}case"block-seq":{const r=i.items[i.items.length-1];r.value?i.items.push({start:[],value:n}):r.value=n;break}case"flow-collection":{const r=i.items[i.items.length-1];!r||r.value?i.items.push({start:[],key:n,sep:[]}):r.sep?r.value=n:Object.assign(r,{key:n,sep:[]});return}default:yield*this.pop(),yield*this.pop(n)}if((i.type==="document"||i.type==="block-map"||i.type==="block-seq")&&(n.type==="block-map"||n.type==="block-seq")){const r=n.items[n.items.length-1];r&&!r.sep&&!r.value&&r.start.length>0&&Jm(r.start)===-1&&(n.indent===0||r.start.every(a=>a.type!=="comment"||a.indent<n.indent))&&(i.type==="document"?i.end=r.start:i.items.push({start:r.start}),n.items.splice(-1,1))}}}*stream(){switch(this.type){case"directive-line":yield{type:"directive",offset:this.offset,source:this.source};return;case"byte-order-mark":case"space":case"comment":case"newline":yield this.sourceToken;return;case"doc-mode":case"doc-start":{const s={type:"document",offset:this.offset,start:[]};this.type==="doc-start"&&s.start.push(this.sourceToken),this.stack.push(s);return}}yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML stream`,source:this.source}}*document(s){if(s.value)return yield*this.lineEnd(s);switch(this.type){case"doc-start":{Jm(s.start)!==-1?(yield*this.pop(),yield*this.step()):s.start.push(this.sourceToken);return}case"anchor":case"tag":case"space":case"comment":case"newline":s.start.push(this.sourceToken);return}const n=this.startBlockValue(s);n?this.stack.push(n):yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML document`,source:this.source}}*scalar(s){if(this.type==="map-value-ind"){const n=Jr(this.peek(2)),i=On(n);let r;s.end?(r=s.end,r.push(this.sourceToken),delete s.end):r=[this.sourceToken];const a={type:"block-map",offset:s.offset,indent:s.indent,items:[{start:i,key:s,sep:r}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=a}else yield*this.lineEnd(s)}*blockScalar(s){switch(this.type){case"space":case"comment":case"newline":s.props.push(this.sourceToken);return;case"scalar":if(s.source=this.source,this.atNewLine=!0,this.indent=0,this.onNewLine){let n=this.source.indexOf(`
`)+1;for(;n!==0;)this.onNewLine(this.offset+n),n=this.source.indexOf(`
`,n)+1}yield*this.pop();break;default:yield*this.pop(),yield*this.step()}}*blockMap(s){const n=s.items[s.items.length-1];switch(this.type){case"newline":if(this.onKeyLine=!1,n.value){const i="end"in n.value?n.value.end:void 0;(Array.isArray(i)?i[i.length-1]:void 0)?.type==="comment"?i?.push(this.sourceToken):s.items.push({start:[this.sourceToken]})}else n.sep?n.sep.push(this.sourceToken):n.start.push(this.sourceToken);return;case"space":case"comment":if(n.value)s.items.push({start:[this.sourceToken]});else if(n.sep)n.sep.push(this.sourceToken);else{if(this.atIndentedComment(n.start,s.indent)){const r=s.items[s.items.length-2]?.value?.end;if(Array.isArray(r)){Array.prototype.push.apply(r,n.start),r.push(this.sourceToken),s.items.pop();return}}n.start.push(this.sourceToken)}return}if(this.indent>=s.indent){const i=!this.onKeyLine&&this.indent===s.indent,r=i&&(n.sep||n.explicitKey)&&this.type!=="seq-item-ind";let a=[];if(r&&n.sep&&!n.value){const o=[];for(let l=0;l<n.sep.length;++l){const c=n.sep[l];switch(c.type){case"newline":o.push(l);break;case"space":break;case"comment":c.indent>s.indent&&(o.length=0);break;default:o.length=0}}o.length>=2&&(a=n.sep.splice(o[1]))}switch(this.type){case"anchor":case"tag":r||n.value?(a.push(this.sourceToken),s.items.push({start:a}),this.onKeyLine=!0):n.sep?n.sep.push(this.sourceToken):n.start.push(this.sourceToken);return;case"explicit-key-ind":!n.sep&&!n.explicitKey?(n.start.push(this.sourceToken),n.explicitKey=!0):r||n.value?(a.push(this.sourceToken),s.items.push({start:a,explicitKey:!0})):this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken],explicitKey:!0}]}),this.onKeyLine=!0;return;case"map-value-ind":if(n.explicitKey)if(n.sep)if(n.value)s.items.push({start:[],key:null,sep:[this.sourceToken]});else if(Es(n.sep,"map-value-ind"))this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:a,key:null,sep:[this.sourceToken]}]});else if(Mj(n.key)&&!Es(n.sep,"newline")){const o=On(n.start),l=n.key,c=n.sep;c.push(this.sourceToken),delete n.key,delete n.sep,this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:o,key:l,sep:c}]})}else a.length>0?n.sep=n.sep.concat(a,this.sourceToken):n.sep.push(this.sourceToken);else if(Es(n.start,"newline"))Object.assign(n,{key:null,sep:[this.sourceToken]});else{const o=On(n.start);this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:o,key:null,sep:[this.sourceToken]}]})}else n.sep?n.value||r?s.items.push({start:a,key:null,sep:[this.sourceToken]}):Es(n.sep,"map-value-ind")?this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[],key:null,sep:[this.sourceToken]}]}):n.sep.push(this.sourceToken):Object.assign(n,{key:null,sep:[this.sourceToken]});this.onKeyLine=!0;return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const o=this.flowScalar(this.type);r||n.value?(s.items.push({start:a,key:o,sep:[]}),this.onKeyLine=!0):n.sep?this.stack.push(o):(Object.assign(n,{key:o,sep:[]}),this.onKeyLine=!0);return}default:{const o=this.startBlockValue(s);if(o){if(o.type==="block-seq"){if(!n.explicitKey&&n.sep&&!Es(n.sep,"newline")){yield*this.pop({type:"error",offset:this.offset,message:"Unexpected block-seq-ind on same line with key",source:this.source});return}}else i&&s.items.push({start:a});this.stack.push(o);return}}}}yield*this.pop(),yield*this.step()}*blockSequence(s){const n=s.items[s.items.length-1];switch(this.type){case"newline":if(n.value){const i="end"in n.value?n.value.end:void 0;(Array.isArray(i)?i[i.length-1]:void 0)?.type==="comment"?i?.push(this.sourceToken):s.items.push({start:[this.sourceToken]})}else n.start.push(this.sourceToken);return;case"space":case"comment":if(n.value)s.items.push({start:[this.sourceToken]});else{if(this.atIndentedComment(n.start,s.indent)){const r=s.items[s.items.length-2]?.value?.end;if(Array.isArray(r)){Array.prototype.push.apply(r,n.start),r.push(this.sourceToken),s.items.pop();return}}n.start.push(this.sourceToken)}return;case"anchor":case"tag":if(n.value||this.indent<=s.indent)break;n.start.push(this.sourceToken);return;case"seq-item-ind":if(this.indent!==s.indent)break;n.value||Es(n.start,"seq-item-ind")?s.items.push({start:[this.sourceToken]}):n.start.push(this.sourceToken);return}if(this.indent>s.indent){const i=this.startBlockValue(s);if(i){this.stack.push(i);return}}yield*this.pop(),yield*this.step()}*flowCollection(s){const n=s.items[s.items.length-1];if(this.type==="flow-error-end"){let i;do yield*this.pop(),i=this.peek(1);while(i&&i.type==="flow-collection")}else if(s.end.length===0){switch(this.type){case"comma":case"explicit-key-ind":!n||n.sep?s.items.push({start:[this.sourceToken]}):n.start.push(this.sourceToken);return;case"map-value-ind":!n||n.value?s.items.push({start:[],key:null,sep:[this.sourceToken]}):n.sep?n.sep.push(this.sourceToken):Object.assign(n,{key:null,sep:[this.sourceToken]});return;case"space":case"comment":case"newline":case"anchor":case"tag":!n||n.value?s.items.push({start:[this.sourceToken]}):n.sep?n.sep.push(this.sourceToken):n.start.push(this.sourceToken);return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const r=this.flowScalar(this.type);!n||n.value?s.items.push({start:[],key:r,sep:[]}):n.sep?this.stack.push(r):Object.assign(n,{key:r,sep:[]});return}case"flow-map-end":case"flow-seq-end":s.end.push(this.sourceToken);return}const i=this.startBlockValue(s);i?this.stack.push(i):(yield*this.pop(),yield*this.step())}else{const i=this.peek(2);if(i.type==="block-map"&&(this.type==="map-value-ind"&&i.indent===s.indent||this.type==="newline"&&!i.items[i.items.length-1].sep))yield*this.pop(),yield*this.step();else if(this.type==="map-value-ind"&&i.type!=="flow-collection"){const r=Jr(i),a=On(r);eh(s);const o=s.end.splice(1,s.end.length);o.push(this.sourceToken);const l={type:"block-map",offset:s.offset,indent:s.indent,items:[{start:a,key:s,sep:o}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=l}else yield*this.lineEnd(s)}}flowScalar(s){if(this.onNewLine){let n=this.source.indexOf(`
`)+1;for(;n!==0;)this.onNewLine(this.offset+n),n=this.source.indexOf(`
`,n)+1}return{type:s,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(s){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken],source:""};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":{this.onKeyLine=!0;const n=Jr(s),i=On(n);return i.push(this.sourceToken),{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:i,explicitKey:!0}]}}case"map-value-ind":{this.onKeyLine=!0;const n=Jr(s),i=On(n);return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:i,key:null,sep:[this.sourceToken]}]}}}return null}atIndentedComment(s,n){return this.type!=="comment"||this.indent<=n?!1:s.every(i=>i.type==="newline"||i.type==="space")}*documentEnd(s){this.type!=="doc-mode"&&(s.end?s.end.push(this.sourceToken):s.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop()))}*lineEnd(s){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":yield*this.pop(),yield*this.step();break;case"newline":this.onKeyLine=!1;case"space":case"comment":default:s.end?s.end.push(this.sourceToken):s.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop())}}}function Rj(t){const s=t.prettyErrors!==!1;return{lineCounter:t.lineCounter||s&&new Pj||null,prettyErrors:s}}function SA(t,s={}){const{lineCounter:n,prettyErrors:i}=Rj(s),r=new kd(n?.addNewLine),a=new Nd(s),o=Array.from(a.compose(r.parse(t)));if(i&&n)for(const l of o)l.errors.forEach(Ta(t,n)),l.warnings.forEach(Ta(t,n));return o.length>0?o:Object.assign([],{empty:!0},a.streamInfo())}function Ij(t,s={}){const{lineCounter:n,prettyErrors:i}=Rj(s),r=new kd(n?.addNewLine),a=new Nd(s);let o=null;for(const l of a.compose(r.parse(t),!0,t.length))if(!o)o=l;else if(o.options.logLevel!=="silent"){o.errors.push(new cn(l.range.slice(0,2),"MULTIPLE_DOCS","Source contains multiple documents; please use YAML.parseAllDocuments()"));break}return i&&n&&(o.errors.forEach(Ta(t,n)),o.warnings.forEach(Ta(t,n))),o}function CA(t,s,n){let i;typeof s=="function"?i=s:n===void 0&&s&&typeof s=="object"&&(n=s);const r=Ij(t,n);if(!r)return null;if(r.warnings.forEach(a=>tj(r.options.logLevel,a)),r.errors.length>0){if(r.options.logLevel!=="silent")throw r.errors[0];r.errors=[]}return r.toJS(Object.assign({reviver:i},n))}function _A(t,s,n){let i=null;if(typeof s=="function"||Array.isArray(s)?i=s:n===void 0&&s&&(n=s),typeof n=="string"&&(n=n.length),typeof n=="number"){const r=Math.round(n);n=r<1?void 0:r>8?{indent:8}:{indent:r}}if(t===void 0){const{keepUndefined:r}=n??s??{};if(!r)return}return Tn(t)&&!i?t.toString(n):new _i(t,i,n).toString(n)}const TA=Object.freeze(Object.defineProperty({__proto__:null,Alias:co,CST:NA,Composer:Nd,Document:_i,Lexer:Dj,LineCounter:Pj,Pair:Qe,Parser:kd,Scalar:te,Schema:yo,YAMLError:wd,YAMLMap:yt,YAMLParseError:cn,YAMLSeq:Gs,YAMLWarning:bj,isAlias:Js,isCollection:be,isDocument:Tn,isMap:ki,isNode:Ne,isPair:je,isScalar:ue,isSeq:zi,parse:CA,parseAllDocuments:SA,parseDocument:Ij,stringify:_A,visit:An,visitAsync:lo},Symbol.toStringTag,{value:"Module"})),th=t=>t.toLowerCase().replace(/[^\p{Letter}\p{Number}]+/gu,"-").replace(/(^-|-$)/g,"")||"sekcja",AA=(t,s)=>{const n=t.split(/\n(?=##\s+)/g);return n.length<=1&&!/^##\s+/.test(t)?[{id:th(s||"Sekcja 1"),title:s||"Sekcja 1",content:t}]:n.map((i,r)=>{const o=(i.match(/^##\s+(.+?)\s*$/m)?.[1]||`Sekcja ${r+1}`).trim(),l=i.replace(/^##\s+.+?\n/,"").trim();return{id:th(o),title:o,content:l}})},DA=/```quiz\s*?\n([\s\S]*?)```/g,PA=(t,s,n)=>{try{const i=TA.parse(t),r=(i?.options||[]).map(String);return!i?.question||!Array.isArray(i?.options)||typeof i?.answerIndex!="number"||i.answerIndex<0||i.answerIndex>=r.length?null:{question:i.question,options:r,answerIndex:i.answerIndex,key:`${s}:${n}`}}catch{return null}},MA=t=>new Map(t.map(s=>[s.id,[...s.content.matchAll(DA)].map((n,i)=>PA(n[1],s.id,i)).filter(Boolean)])),sh=(t,s)=>{const[n,i]=ee.useState(()=>{try{const r=localStorage.getItem(t);return r?JSON.parse(r):s}catch{return s}});return ee.useEffect(()=>{try{localStorage.setItem(t,JSON.stringify(n))}catch(r){console.error("Błąd zapisu do localStorage:",r)}},[t,n]),[n,i]},RA=()=>{const t=ee.useRef(null);return{ref:t,say:n=>{t.current&&(t.current.textContent="",setTimeout(()=>t.current&&(t.current.textContent=n),30))}}},IA=()=>e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6",children:[e.jsx("div",{className:"h-5 w-24 rounded bg-muted/60"}),e.jsxs("div",{className:"rounded-2xl border bg-card p-6 shadow-soft animate-pulse",children:[e.jsx("div",{className:"h-6 w-2/3 rounded bg-muted/60 mb-2"}),e.jsx("div",{className:"h-4 w-40 rounded bg-muted/60"})]}),e.jsx("div",{className:"space-y-3",children:Array.from({length:10}).map((t,s)=>e.jsx("div",{className:"h-4 w-full rounded bg-muted/50"},s))}),e.jsx("div",{className:"h-10 w-48 rounded-lg bg-muted/60 ml-auto"})]}),nh={code:({inline:t,className:s="",children:n,...i})=>{const r=(s||"").toLowerCase();return!t&&r.includes("language-quiz")?null:e.jsx("code",{className:s,...i,children:n})},pre:t=>((Array.isArray(t.children)?t.children[0]:t.children)?.props?.className?.toLowerCase?.()||"").includes("language-quiz")?null:e.jsx("pre",{...t})},EA=({quiz:t,onClose:s,onPass:n})=>{const[i,r]=ee.useState(null),[a,o]=ee.useState(!1),l=()=>{const c=i!==null&&i===t.answerIndex;o(c),c?(H.success("Poprawna odpowiedź!"),setTimeout(n,200)):H.error("Niepoprawna odpowiedź — spróbuj ponownie.")};return e.jsxs("div",{className:"fixed inset-0 z-[90] flex items-end sm:items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:s}),e.jsxs("div",{className:"relative z-[91] w-full sm:max-w-lg bg-background rounded-t-2xl sm:rounded-2xl border shadow-2xl p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold",children:"Pytanie kontrolne"}),e.jsx("button",{onClick:s,className:"p-1 rounded hover:bg-muted","aria-label":"Zamknij",children:e.jsx(Pt,{className:"h-5 w-5"})})]}),e.jsx("p",{className:"mb-3 text-sm sm:text-base",children:t.question}),e.jsx("div",{className:"space-y-2 mb-4",children:t.options.map((c,d)=>e.jsxs("label",{className:"flex items-center gap-2 rounded-md border px-3 py-2 cursor-pointer hover:bg-muted",children:[e.jsx("input",{type:"radio",name:"quiz-choice",className:"h-4 w-4",checked:i===d,onChange:()=>r(d),disabled:a}),e.jsx("span",{className:"text-sm",children:c})]},d))}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:s,className:"rounded-lg border px-3 py-1.5 text-sm hover:bg-muted",children:"Anuluj"}),e.jsx("button",{onClick:l,className:"rounded-lg border px-3 py-1.5 text-sm font-medium hover:bg-muted",disabled:a,children:"Zatwierdź"})]})]})]})},LA=({lessonTitle:t,courseId:s,timeSpent:n,sectionsCount:i,quizzesCompleted:r,pointsEarned:a,nextLessonPath:o})=>{const l=me(),c=d=>{const m=Math.floor(d/60),u=d%60;return m>0?`${m} min ${u} s`:`${u} s`};return e.jsx(he.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"fixed inset-0 z-20 flex items-center justify-center p-4 bg-black/50",children:e.jsxs("div",{className:"w-full max-w-md rounded-2xl border bg-card p-6 shadow-2xl",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-green-100 dark:bg-green-900/30 mb-4",children:e.jsx(xn,{className:"w-8 h-8 text-green-600"})}),e.jsx("h2",{className:"text-2xl font-bold",children:"Lekcja ukończona! 🎉"}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:t})]}),e.jsxs("div",{className:"rounded-xl bg-primary/10 p-4 mb-6 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-3xl font-bold text-primary",children:[e.jsx(Ue,{className:"w-6 h-6"}),"+",a," punktów"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"za ukończenie materiału"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(Ve,{className:"w-5 h-5 mx-auto mb-1 text-blue-600"}),e.jsx("p",{className:"text-sm font-medium",children:c(n)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Czas nauki"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(Se,{className:"w-5 h-5 mx-auto mb-1 text-purple-600"}),e.jsx("p",{className:"text-sm font-medium",children:i}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Sekcji"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(De,{className:"w-5 h-5 mx-auto mb-1 text-yellow-600"}),e.jsx("p",{className:"text-sm font-medium",children:r}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pytań"})]})]}),e.jsx("div",{className:"flex gap-3",children:o?e.jsxs("button",{onClick:()=>l(o),className:"flex-1 inline-flex items-center justify-center gap-2 rounded-lg bg-primary px-4 py-2.5 text-primary-foreground hover:bg-primary/90",children:["Następna lekcja",e.jsx(Fe,{className:"w-4 h-4"})]}):e.jsx("button",{onClick:()=>l(`/student/courses/${s}`),className:"flex-1 rounded-lg bg-primary px-4 py-2.5 text-primary-foreground hover:bg-primary/90",children:"Wróć do kursu"})})]})})},OA=()=>{const{courseId:t,lessonId:s}=mt(),n=me(),{refetch:i}=_n(),{data:r,isLoading:a}=Ye({resource:"activities",id:s,meta:{select:"*, topics(title, course_id, courses(title, icon_emoji))"}}),o=r?.data??{},l=o?.content_md??o?.markdown??o?.content,c=ee.useMemo(()=>l?AA(l,o?.title??"Sekcja"):[],[l,o?.title]),d=ee.useMemo(()=>MA(c),[c]),m=`lesson-progress:${s}`,u=`lesson-quiz:${s}`,[h,p]=sh(m,Object.fromEntries(c.map(D=>[D.id,!1]))),[j,x]=sh(u,{}),[b,w]=ee.useState(null),[y,v]=ee.useState(!1),[_]=ee.useState(Date.now());ee.useEffect(()=>{c.length&&p(D=>{const P={};return c.forEach(L=>P[L.id]=D[L.id]??!1),P})},[c.map(D=>D.id).join("|")]);const{ref:C,say:k}=RA(),N=c.findIndex(D=>!h[D.id]),z=N===-1,T=D=>{const[P]=d.get(D)??[];P&&w(P)},f=D=>{const P=c[D];if(!P||!(N===-1||D<=N)&&!h[P.id])return;if(h[P.id]){p(E=>({...E,[P.id]:!1})),k(`Sekcja ${D+1} cofnięta.`);return}(d.get(P.id)??[]).length>0?T(P.id):(p(E=>({...E,[P.id]:!0})),k(`Sekcja ${D+1} odhaczona.`))},S=()=>{const D=b;if(w(null),!D)return;x(K=>({...K,[D.key]:!0}));const P=D.key.split(":")[0];p(K=>({...K,[P]:!0}));const L=c.findIndex(K=>K.id===P);k(`Sekcja ${L+1} odhaczona po pytaniu kontrolnym.`)},A=async()=>{if(!z)return H.info("Najpierw odhacz wszystkie sekcje po kolei.");console.log("Starting lesson completion...");try{const{error:D}=await Q.rpc("start_activity",{p_activity_id:parseInt(s)});if(D)throw console.error("Error starting activity:",D),D;console.log("Activity started, completing material...");const{data:P,error:L}=await Q.rpc("complete_material",{p_activity_id:parseInt(s)});if(console.log("Complete material result:",P,"Error:",L),L)throw L;if(P){const K=Math.floor((Date.now()-_)/1e3);console.log("Material completed successfully"),v(!0);try{localStorage.removeItem(m),localStorage.removeItem(u)}catch(E){console.error("Błąd zapisu do localStorage:",E)}Wi("get_course_structure"),Wi("get_my_courses"),setTimeout(()=>{console.log("Forcing stats refresh..."),i()},500),setTimeout(async()=>{console.log("Manually checking updated stats...");const{data:E,error:U}=await Q.rpc("get_my_stats");console.log("New stats after completion:",E,"Error:",U)},1e3)}}catch(D){console.error("Failed to complete lesson:",D),H.error("Nie udało się ukończyć lekcji")}};return e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-10 pb-28 lg:pb-16",children:[e.jsx("div",{ref:C,"aria-live":"polite",className:"sr-only"}),e.jsxs("button",{onClick:()=>n(`/student/courses/${t}`),className:"flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx(ge,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Powrót do kursu"})]}),e.jsx("section",{className:"relative overflow-hidden rounded-2xl border bg-white dark:bg-card",children:e.jsx("div",{className:"relative z-10 p-5 sm:p-7 md:p-10",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-4xl md:text-5xl leading-none",children:o?.topics?.courses?.icon_emoji||"📚"}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-muted-foreground flex items-center gap-2",children:[e.jsx("span",{className:"truncate",children:o?.topics?.courses?.title||"…"}),e.jsx("span",{children:"•"}),e.jsx("span",{className:"truncate",children:o?.topics?.title||"…"})]}),e.jsx("h1",{className:"mt-1 text-xl md:text-3xl font-bold tracking-tight",children:o?.title||"Ładowanie…"}),o?.duration_min&&e.jsxs("div",{className:"mt-3 inline-flex items-center gap-2 rounded-full border bg-white/70 dark:bg-background/60 px-3 py-1.5 shadow-soft",children:[e.jsx(Ve,{className:"h-4 w-4"}),e.jsxs("span",{className:"text-sm font-medium",children:[o?.duration_min," min czytania"]})]})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1fr_280px] gap-10",children:[e.jsx("main",{children:a?e.jsx(IA,{}):e.jsxs("section",{children:[e.jsx("div",{className:"prose prose-neutral dark:prose-invert max-w-[72ch] mx-auto prose-headings:font-semibold prose-p:text-muted-foreground prose-p:leading-relaxed prose-li:leading-relaxed prose-headings:tracking-tight prose-img:rounded-xl prose-blockquote:rounded-xl md:prose-lg",children:c.length?c.map((D,P)=>{const L=!!h[D.id],K=!L&&P===N,U=!(N===-1||P<=N)&&!L,B=(d.get(D.id)??[])[0],ae="rounded-[20px] border p-6 sm:p-7 md:p-8 shadow-sm transition-colors duration-200",le=L?"bg-emerald-50 dark:bg-emerald-950/25 border-emerald-300":K?"bg-white dark:bg-background border-neutral-200 shadow-md":U?"bg-white dark:bg-card border-dashed border-muted-foreground/40":"bg-white dark:bg-card border-neutral-200",pe=!L&&U?"filter blur-[2px] select-none pointer-events-none":"";return e.jsxs("div",{id:D.id,className:"mb-12 scroll-mt-28",children:[e.jsxs("div",{className:`${ae} ${le}`,children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-3",children:[U&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border px-2.5 py-0.5 text-[11px] text-muted-foreground bg-white",children:[e.jsx(un,{className:"h-3.5 w-3.5"}),"Zablokowana"]}),L&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-emerald-300/60 bg-emerald-50/60 px-2.5 py-0.5 text-[11px] text-emerald-700 dark:text-emerald-300",children:[e.jsx(Ge,{className:"h-3.5 w-3.5"}),"Ukończona"]}),K&&!L&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border bg-white px-2.5 py-0.5 text-[11px]",children:[e.jsx(ea,{className:"h-3.5 w-3.5"}),"W trakcie"]}),B&&e.jsxs("button",{type:"button",onClick:()=>!L&&!U&&T(D.id),disabled:L||U,className:["inline-flex items-center gap-1 rounded-full border px-2.5 py-0.5 text-[11px]",L?"text-emerald-700 border-emerald-300/60 bg-emerald-50/60 dark:bg-emerald-950/25":U?"text-muted-foreground cursor-not-allowed bg-white dark:bg-background/40":"bg-white hover:bg-muted"].join(" "),title:L?"Pytanie rozwiązane":U?"Najpierw odblokuj sekcję":"Kliknij, aby odpowiedzieć","aria-label":"Pytanie kontrolne",children:[e.jsx(vt,{className:"h-3.5 w-3.5"}),B.question.length>72?B.question.slice(0,69)+"…":B.question]})]}),e.jsxs("div",{className:pe,children:[e.jsx("h2",{className:"text-[22px] md:text-[26px] font-semibold tracking-tight m-0 mb-4",children:D.title||`Sekcja ${P+1}`}),e.jsx(al,{remarkPlugins:[jl],components:nh,children:D.content})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsxs("label",{className:["inline-flex items-center gap-3",U?"cursor-not-allowed opacity-60":"cursor-pointer"].join(" "),title:U?"Najpierw ukończ poprzednie sekcje":L?"Sekcja odhaczona — klik, aby cofnąć":B?"Kliknij, aby odpowiedzieć na pytanie":"Odhacz sekcję",children:[e.jsx("input",{type:"checkbox",className:"sr-only",checked:L,onChange:()=>!U&&f(P),disabled:U&&!L,"aria-label":`Odhacz sekcję: ${D.title||`Sekcja ${P+1}`}`}),e.jsx("span",{className:["inline-flex items-center gap-2 rounded-lg border px-3 py-2 text-sm font-medium shadow-soft transition-all",L?"bg-emerald-50/70 dark:bg-emerald-950/30 border-emerald-300/60 text-emerald-700 dark:text-emerald-300":"bg-white hover:bg-muted border-neutral-200"].join(" "),children:B&&!L?e.jsx("span",{className:"truncate max-w-[56ch]",children:B.question}):e.jsxs(e.Fragment,{children:[L?e.jsx(Ge,{className:"h-4 w-4"}):e.jsx(ea,{className:"h-4 w-4"}),e.jsxs("span",{className:"whitespace-nowrap",children:[String(P+1).padStart(2,"0")," • ",L?"Odhaczono":B?"Odhacz (pytanie)":"Odhacz sekcję"]})]})})]})})]}),e.jsx("div",{className:"h-8"})]},D.id)}):l?e.jsx(al,{remarkPlugins:[jl],components:nh,children:l}):e.jsx("div",{dangerouslySetInnerHTML:{__html:o?.content||""}})}),!!c.length&&e.jsx("div",{className:"mt-10 flex justify-end",children:e.jsx("button",{onClick:A,className:"inline-flex items-center gap-2 rounded-lg border bg-white px-4 py-2 text-sm font-medium shadow-soft hover:bg-muted transition-colors disabled:opacity-60",disabled:!z,title:z?void 0:"Najpierw odhacz wszystkie sekcje",children:"Zakończ lekcję"})})]})}),e.jsx("aside",{children:e.jsxs("nav",{className:"border rounded-[14px] p-4 bg-white dark:bg-background/60 lg:sticky lg:top-28",children:[e.jsx("h2",{className:"text-sm font-semibold mb-3",children:"Spis treści"}),a?e.jsx("div",{className:"h-4 w-40 rounded bg-muted/60 animate-pulse"}):c.length?e.jsx("ol",{className:"space-y-1.5 text-sm",children:c.map((D,P)=>{const L=!!h[D.id],K=!L&&P===N,U=!(N===-1||P<=N)&&!L,B=()=>{U||document.getElementById(D.id)?.scrollIntoView({behavior:"smooth"})};return e.jsxs("li",{className:"flex items-center gap-1.5",children:[U?e.jsx(un,{className:"h-3.5 w-3.5 text-muted-foreground"}):L?e.jsx(Ge,{className:"h-3.5 w-3.5 text-emerald-600"}):e.jsx(ea,{className:"h-3.5 w-3.5"}),e.jsxs("button",{onClick:B,className:["flex-1 text-left px-2 py-1 rounded transition-colors",U?"text-muted-foreground cursor-not-allowed":"hover:bg-muted",L?"text-emerald-700":"",K?"font-semibold underline":""].join(" "),disabled:U,children:[String(P+1).padStart(2,"0"),". ",D.title||`Sekcja ${P+1}`]})]},D.id)})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Brak sekcji."})]})})]}),b&&e.jsx(EA,{quiz:b,onClose:()=>w(null),onPass:S}),y&&e.jsx(LA,{lessonTitle:o?.title||"Lekcja",courseId:t,timeSpent:Math.floor((Date.now()-_)/1e3),sectionsCount:c.length,quizzesCompleted:Object.keys(j).length,pointsEarned:5,nextLessonPath:void 0})]})},$A=[e.jsx(V,{path:"/courses/:courseId/lesson/:lessonId",element:e.jsx(OA,{})},"lesson-view")],FA=()=>{const{courseId:t,quizId:s}=mt(),n=me(),{refetch:i}=_n(),[r,a]=ee.useState(0),[o,l]=ee.useState({}),[c,d]=ee.useState(null),[m,u]=ee.useState(!1),[h,p]=ee.useState([]),[j,x]=ee.useState(!0),{data:b,isLoading:w}=Ye({resource:"activities",id:s,meta:{select:"*, topics(title, course_id, courses(title, icon_emoji))"}});ee.useEffect(()=>{(async()=>{if(s)try{await Q.rpc("start_activity",{p_activity_id:parseInt(s)}),x(!0);const{data:L,error:K}=await Q.rpc("get_quiz_questions",{p_activity_id:parseInt(s)});if(K)throw K;const E=typeof L=="string"?JSON.parse(L):L;p(Array.isArray(E)?E:[])}catch(L){console.error("Quiz init error:",L),H.error("Błąd podczas ładowania quizu")}finally{x(!1)}})()},[s]),ee.useEffect(()=>{b?.data?.time_limit&&c===null&&d(b.data.time_limit*60)},[b]),ee.useEffect(()=>{if(c!==null&&c>0){const P=setTimeout(()=>d(c-1),1e3);return()=>clearTimeout(P)}else c===0&&z()},[c]);const y=b?.data,v=h[r],_=h.length>0?(r+1)/h.length*100:0,C=P=>{if(P.type)switch(P.type){case"single_choice":return"single";case"multiple_choice":return"multiple";case"true_false":return"true_false"}return"single"},k=P=>{switch(P){case"single":return{label:"Jednokrotny wybór",icon:xn};case"multiple":return{label:"Wielokrotny wybór",icon:dn};case"true_false":return{label:"Prawda/Fałsz",icon:dt}}},N=(P,L,K)=>{if(K){const E=o[P]||[],U=E.includes(L)?E.filter(B=>B!==L):[...E,L];l(B=>({...B,[P]:U}))}else l(E=>({...E,[P]:L}))},z=async()=>{u(!0);try{const P=Object.entries(o).flatMap(([E,U])=>Array.isArray(U)?U.map(B=>({question_id:parseInt(E),option_id:B})):[{question_id:parseInt(E),option_id:U}]);console.log("Submitting quiz answers:",P);const{data:L,error:K}=await Q.rpc("finish_quiz",{p_activity_id:parseInt(s),p_answers:P});if(K)throw K;L&&(console.log("Quiz finished successfully:",L),Wi("get_course_structure"),Wi("get_my_courses"),Wi("get_my_stats"),setTimeout(()=>{console.log("Forcing stats refresh..."),i()},500),n(`/student/courses/${t}/quiz/${s}/result`,{state:{courseId:t,quizId:s,result:{...L,passing_score:y?.passing_score||70,max_attempts:y?.max_attempts,attempts_used:y?.attempts||1}}}))}catch(P){console.error("Failed to submit quiz:",P),H.error("Nie udało się przesłać odpowiedzi")}finally{u(!1)}};if(w||j)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});if(!v)return null;const T=C(v),f=k(T),S=T==="multiple",A=o[v.id],D=S?Array.isArray(A)&&A.length>0:A!==void 0;return e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 max-w-3xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("button",{onClick:()=>n(`/student/courses/${t}`),className:"flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx(ge,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Zakończ quiz"})]}),c!==null&&e.jsxs("div",{className:F("flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium",c<60?"bg-red-100 text-red-700":"bg-muted text-foreground"),children:[e.jsx(Ve,{className:"w-4 h-4"}),Math.floor(c/60),":",String(c%60).padStart(2,"0")]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:y?.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Pytanie ",r+1," z ",h.length]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[v.points," pkt"]}),e.jsx("span",{children:"•"}),e.jsxs(q,{variant:"outline",className:"text-xs",children:[e.jsx(f.icon,{className:"w-3 h-3 mr-1"}),f.label]})]})]}),e.jsx("div",{className:"h-1 bg-muted rounded-full overflow-hidden mb-8",children:e.jsx(he.div,{initial:{width:0},animate:{width:`${_}%`},className:"h-full bg-primary"})}),e.jsx(TC,{mode:"wait",children:e.jsx(he.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},transition:{duration:.2},children:e.jsxs("div",{className:"bg-card rounded-2xl border p-8 mb-8",children:[e.jsx("h2",{className:"text-lg font-medium mb-6",children:v.question}),S&&e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"⚠️ Zaznacz wszystkie poprawne odpowiedzi"}),e.jsx("div",{className:"space-y-3",children:v.options.map(P=>{const L=S?Array.isArray(A)&&A.includes(P.id):A===P.id;return e.jsx("label",{className:F("block p-4 rounded-xl border-2 cursor-pointer transition-all",L?"border-primary bg-primary/5":"border-border hover:border-muted-foreground"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:S?"checkbox":"radio",name:`question-${v.id}`,value:P.id,checked:L,onChange:()=>N(v.id,P.id,S),className:"sr-only"}),e.jsxs("div",{className:F("flex items-center justify-center flex-shrink-0",S?F("w-5 h-5 rounded border-2",L?"border-primary bg-primary text-primary-foreground":"border-muted-foreground"):F("w-5 h-5 rounded-full border-2",L?"border-primary":"border-muted-foreground")),children:[S&&L&&e.jsx(Ge,{className:"w-3 h-3"}),!S&&L&&e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-primary"})]}),e.jsx("span",{className:"flex-1",children:P.text})]})},P.id)})})]})},v.id)}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>a(Math.max(0,r-1)),disabled:r===0,className:F("flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all",r===0?"text-muted-foreground cursor-not-allowed":"text-foreground hover:bg-muted"),children:[e.jsx(ge,{className:"w-4 h-4"}),"Poprzednie"]}),e.jsx("div",{className:"flex gap-2",children:h.map((P,L)=>{const K=o[h[L]?.id],E=Array.isArray(K)?K.length>0:K!==void 0;return e.jsx("button",{onClick:()=>a(L),className:F("w-2 h-2 rounded-full transition-all",L===r?"bg-primary w-8":E?"bg-muted-foreground":"bg-muted")},L)})}),r<h.length-1?e.jsxs("button",{onClick:()=>a(r+1),disabled:!D,className:F("flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all",D?"bg-primary text-primary-foreground hover:bg-primary/90":"bg-muted text-muted-foreground cursor-not-allowed"),children:["Następne",e.jsx(Fe,{className:"w-4 h-4"})]}):e.jsxs("button",{onClick:z,disabled:m||Object.keys(o).length<h.length,className:F("flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all",m||Object.keys(o).length<h.length?"bg-muted text-muted-foreground cursor-not-allowed":"bg-green-500 text-white hover:bg-green-600"),children:[m?"Przesyłanie...":"Zakończ quiz",e.jsx(Ge,{className:"w-4 h-4"})]})]})]})},BA=()=>{const t=me(),s=hi(),{courseId:n,quizId:i,result:r}=s.state,a=y=>{const v=Math.floor(y/60),_=y%60;return`${v}:${String(_).padStart(2,"0")}`},o=y=>y>=90?"text-green-600":y>=70?"text-yellow-600":"text-red-600",l=y=>y<30?1:y<50?2:y<70?5:10+Math.floor((y-70)/3),c=r.max_attempts&&(r.attempts_used??0)<r.max_attempts,d=r.score===100,m=r.user_points||0,u=r.next_level_points||((r.user_level||1)+1)*100,h=m%100,p=u-m,j=h/100*100,x=r.question_results?.filter(y=>y.is_correct).length||0,b=r.question_results?.length||0,w=b-x;return e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-3xl",children:[e.jsxs(he.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.3},className:"space-y-6",children:[e.jsx(M,{children:e.jsxs(R,{className:"pt-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:F("inline-flex items-center justify-center w-16 h-16 rounded-full mb-4",r.passed?"bg-green-100":"bg-orange-100"),children:e.jsx(De,{className:F("w-8 h-8",r.passed?"text-green-600":"text-orange-600")})}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:r.passed?"Quiz zaliczony!":"Niezaliczone, ale zdobywasz punkty!"}),e.jsx("p",{className:"text-muted-foreground",children:r.passed?d?"Perfekcyjny wynik! Jesteś mistrzem!":"Gratulacje! Świetnie Ci poszło.":`Zdobywasz ${r.points_earned} punktów za swoją próbę!`})]}),e.jsx("div",{className:"bg-muted/50 rounded-xl p-6 mb-6",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:F("text-5xl font-bold mb-2",o(r.score)),children:[r.score,"%"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Twój wynik"})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx(Ue,{className:"w-4 h-4 text-yellow-600"}),e.jsx("span",{className:"font-semibold text-lg",children:r.points_earned})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Punktów zdobytych"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx(Ve,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-semibold",children:a(r.time_spent)})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Czas"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx(Ee,{className:"w-4 h-4 text-purple-600"}),e.jsxs("span",{className:"font-semibold",children:[r.passing_score,"%"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Próg zaliczenia"})]})]})]})}),e.jsxs(M,{children:[e.jsx($,{children:e.jsxs(O,{className:"text-lg flex items-center gap-2",children:[e.jsx(ii,{className:"w-5 h-5"}),"Postęp poziomu"]})}),e.jsx(R,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("span",{className:"font-medium",children:["Poziom ",r.user_level||1]}),e.jsxs("span",{className:"text-muted-foreground",children:[m," / ",u," punktów"]}),e.jsxs("span",{className:"font-medium",children:["Poziom ",(r.user_level||1)+1]})]}),e.jsx(Yt,{value:j,className:"h-3"}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Do następnego poziomu pozostało:",e.jsxs("span",{className:"font-semibold text-foreground ml-1",children:[p," punktów"]})]}),r.points_earned>0&&e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:["+",r.points_earned," punktów z tego quizu!"]})]})]})})]}),r.question_results&&r.question_results.length>0&&e.jsxs(M,{children:[e.jsx($,{children:e.jsxs(O,{className:"text-lg flex items-center justify-between",children:[e.jsx("span",{children:"Analiza odpowiedzi"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(xn,{className:"w-4 h-4"}),x]}),e.jsxs("span",{className:"flex items-center gap-1 text-red-600",children:[e.jsx(ll,{className:"w-4 h-4"}),w]})]})]})}),e.jsxs(R,{children:[e.jsx("div",{className:"space-y-3",children:r.question_results.map((y,v)=>e.jsx(he.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:v*.05},className:F("p-4 rounded-lg border transition-all",y.is_correct?"bg-green-50 dark:bg-green-950/30 border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-950/30 border-red-200 dark:border-red-800"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:y.is_correct?e.jsx(xn,{className:"w-5 h-5 text-green-600"}):e.jsx(ll,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h4",{className:"font-medium text-sm",children:["Pytanie ",v+1]}),e.jsxs("span",{className:F("text-sm font-semibold",y.is_correct?"text-green-600":"text-red-600"),children:[y.is_correct?`+${y.points}`:"0"," pkt"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:y.question_text}),e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-muted-foreground min-w-[120px]",children:"Twoja odpowiedź:"}),e.jsx("span",{className:F("font-medium flex-1",y.is_correct?"text-green-700 dark:text-green-400":"text-red-700 dark:text-red-400"),children:Array.isArray(y.your_answer)?y.your_answer.join(", "):y.your_answer||"Brak odpowiedzi"})]}),!y.is_correct&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-muted-foreground min-w-[120px]",children:"Poprawna odpowiedź:"}),e.jsx("span",{className:"font-medium text-green-700 dark:text-green-400 flex-1",children:Array.isArray(y.correct_answer)?y.correct_answer.join(", "):y.correct_answer})]})]})]})]})},y.question_id))}),e.jsxs("div",{className:"mt-6 p-4 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Skuteczność:"}),e.jsx("span",{className:"font-semibold",children:b>0?`${Math.round(x/b*100)}%`:"0%"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm mt-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"Zdobyte punkty:"}),e.jsxs("span",{className:"font-semibold",children:[r.question_results.filter(y=>y.is_correct).reduce((y,v)=>y+v.points,0)," / ",r.question_results.reduce((y,v)=>y+v.points,0)]})]})]})]})]}),e.jsxs(M,{className:F(r.points_earned>0?"border-primary/50":""),children:[e.jsx($,{children:e.jsxs(O,{className:"text-lg flex items-center gap-2",children:[e.jsx(st,{className:"w-5 h-5"}),"Jak obliczyliśmy Twoje punkty"]})}),e.jsxs(R,{children:[e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Punkty bazowe za wynik ",r.score,"%:"]}),e.jsxs("span",{className:"font-medium tabular-nums",children:[r.base_points||l(r.score)," pkt"]})]}),r.multipliers?.quiz_multiplier&&r.multipliers.quiz_multiplier>1&&e.jsxs("div",{className:"flex justify-between items-center text-green-600 dark:text-green-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Us,{className:"w-3 h-3"}),'Ulepszenie "Szybki umysł":']}),e.jsxs("span",{className:"font-medium",children:["×",r.multipliers.quiz_multiplier]})]}),r.streak_days&&r.streak_days>0&&r.multipliers?.streak_multiplier&&e.jsxs("div",{className:"flex justify-between items-center text-orange-600 dark:text-orange-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Zt,{className:"w-3 h-3"}),"Streak ",r.streak_days," dni:"]}),e.jsxs("span",{className:"font-medium",children:["×",r.multipliers.streak_multiplier.toFixed(1)]})]}),d&&r.perfect_bonus&&r.perfect_bonus>0&&e.jsxs("div",{className:"flex justify-between items-center text-purple-600 dark:text-purple-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(xb,{className:"w-3 h-3"}),"Bonus perfekcjonisty:"]}),e.jsxs("span",{className:"font-medium",children:["+",r.perfect_bonus," pkt"]})]}),r.multipliers?.min_points&&r.score<30&&e.jsxs("div",{className:"flex justify-between items-center text-blue-600 dark:text-blue-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ol,{className:"w-3 h-3"}),'Gwarancja "Druga szansa":']}),e.jsxs("span",{className:"font-medium",children:["min. ",r.multipliers.min_points," pkt"]})]}),e.jsx("div",{className:"pt-2 mt-2 border-t border-border/50",children:e.jsxs("div",{className:"flex justify-between items-center font-semibold",children:[e.jsx("span",{children:"Łącznie zdobywasz:"}),e.jsxs("span",{className:"text-lg text-primary",children:[r.points_earned," punktów"]})]})})]}),(!r.multipliers?.quiz_multiplier||r.multipliers.quiz_multiplier===1)&&e.jsx("div",{className:"mt-3 p-2 bg-amber-50 dark:bg-amber-900/20 rounded-md",children:e.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-400 flex items-center gap-1",children:[e.jsx(dt,{className:"w-3 h-3 flex-shrink-0"}),"Wskazówka: Kup ulepszenia w zakładce Idle aby zwiększyć punkty z quizów!"]})})]})]}),!r.passed&&e.jsx(M,{className:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800",children:e.jsxs(R,{className:"pt-6",children:[e.jsx("h4",{className:"font-medium text-sm mb-1 text-blue-700 dark:text-blue-400",children:"Nie poddawaj się! 💪"}),e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-300",children:r.score>=60?`Świetnie Ci idzie! Brakuje tylko ${r.passing_score-r.score}% do zaliczenia.`:r.score>=40?"Już prawie połowa! Przejrzyj materiały i spróbuj ponownie.":"Każda próba to krok naprzód. Wróć do materiałów i próbuj dalej!"})]})}),e.jsxs("div",{className:"flex gap-3",children:[r.passed?e.jsxs("button",{onClick:()=>t(`/student/courses/${n}`),className:"flex-1 inline-flex items-center justify-center gap-2 rounded-lg bg-primary px-4 py-2.5 text-primary-foreground hover:bg-primary/90 focus-ring",children:["Kontynuuj kurs",e.jsx(Fe,{className:"w-4 h-4"})]}):e.jsx(e.Fragment,{children:c?e.jsxs("button",{onClick:()=>t(`/student/courses/${n}/quiz/${i}`),className:"flex-1 inline-flex items-center justify-center gap-2 rounded-lg bg-primary px-4 py-2.5 text-primary-foreground hover:bg-primary/90 focus-ring",children:[e.jsx(ol,{className:"w-4 h-4"}),"Spróbuj ponownie"]}):e.jsx("button",{onClick:()=>t(`/student/courses/${n}`),className:"flex-1 rounded-lg border px-4 py-2.5 hover:bg-muted/50 focus-ring",children:"Wróć do kursu"})}),e.jsx("button",{onClick:()=>t("/student/dashboard"),className:"px-4 py-2.5 rounded-lg border hover:bg-muted/50 focus-ring",children:"Dashboard"})]}),r.max_attempts&&e.jsxs("p",{className:"text-center text-xs text-muted-foreground",children:["Wykorzystane próby: ",r.attempts_used," z ",r.max_attempts]})]}),d&&e.jsx(he.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.5},className:"mt-4 text-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"🎯 Mistrzostwo! Twoja wiedza jest imponująca!"})})]})},UA=[e.jsx(V,{path:"/courses/:courseId/quiz/:quizId",element:e.jsx(FA,{})},"quiz-take"),e.jsx(V,{path:"/courses/:courseId/quiz/:quizId/result",element:e.jsx(BA,{})},"quiz-result")],VA={"⚡":Ue,"🚀":rc,"🧠":Us,"☕":jb,"📚":gb},qA=()=>e.jsxs("div",{className:"rounded-2xl border bg-card p-6 shadow-soft animate-pulse",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-muted/70"}),e.jsxs("div",{children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted/70"}),e.jsx("div",{className:"mt-2 h-3 w-24 rounded bg-muted/60"})]})]}),e.jsx("div",{className:"h-5 w-16 rounded-full bg-muted/60"})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsx("div",{className:"h-3 w-full rounded bg-muted/60"}),e.jsx("div",{className:"h-3 w-2/3 rounded bg-muted/60"})]}),e.jsx("div",{className:"h-10 w-full rounded-lg bg-muted/60"})]}),KA=()=>{const{stats:t,refetch:s}=_n(),{data:n,isLoading:i,refetch:r}=Dr("get_idle_upgrades"),a=async l=>{try{const{data:c,error:d}=await Q.rpc("buy_idle_upgrade",{p_upgrade_id:l});if(d)throw d;c&&(H.success(`Ulepszenie zakupione! Poziom ${c.new_level}`),s(),r())}catch{H.error("Niewystarczająca ilość punktów")}},o=n||[];return e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8 pb-24 lg:pb-8",children:[e.jsxs(he.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.45},className:"relative overflow-hidden rounded-2xl border",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/[0.12] via-secondary/[0.10] to-accent/[0.12]"}),e.jsx("div",{className:"absolute inset-0 opacity-[0.06]",style:{backgroundImage:`
                linear-gradient(to right, hsl(var(--ring)/0.35) 1px, transparent 1px),
                linear-gradient(to bottom, hsl(var(--ring)/0.35) 1px, transparent 1px)
              `,backgroundSize:"28px 28px"}})]}),e.jsx("div",{className:"relative z-10 p-4 sm:p-6 md:p-8",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-12 md:items-center",children:[e.jsxs("div",{className:"md:col-span-4 space-y-2",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Ulepszenia"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Inwestuj punkty, aby zwiększyć tempo zdobywania kolejnych."})]}),e.jsxs("div",{className:"md:col-span-8 grid grid-cols-3 gap-4 md:gap-6",children:[e.jsxs("div",{className:"rounded-xl border bg-card p-5 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Punkty / h"}),e.jsx(st,{className:"h-4 w-4 text-accent"})]}),e.jsx("div",{className:"mt-2 flex items-end gap-2",children:e.jsx("span",{className:"text-4xl md:text-5xl font-semibold text-accent leading-none tabular-nums",children:e.jsx(We,{value:t.idle_rate})})}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Premia za obecność."})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-5 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Twoje punkty"}),e.jsx(Ue,{className:"h-4 w-4 text-primary"})]}),e.jsxs("div",{className:"mt-2 flex items-end gap-2",children:[e.jsx("span",{className:"text-4xl md:text-5xl font-semibold text-primary leading-none tabular-nums",children:e.jsx(We,{value:t.points})}),e.jsx("span",{className:"mb-[2px] text-sm text-muted-foreground",children:"pkt"})]}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Wydaj je na ulepszenia poniżej."})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-5 shadow-soft",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Do kolejnego poziomu"}),e.jsx(rc,{className:"h-4 w-4 text-secondary"})]}),e.jsx("div",{className:"mt-3",children:e.jsx(bn,{value:t.points%100})}),e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:["Pozostało ",100-t.points%100," pkt"]})]})]})]})})]}),e.jsxs(he.section,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.4,delay:.05},className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between gap-4",children:e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-lg sm:text-xl md:text-2xl font-semibold tracking-tight",children:"Dostępne ulepszenia"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Wybierz i zwiększ swoje tempo zdobywania punktów."})]})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 sm:gap-5",children:[i&&Array.from({length:6}).map((l,c)=>e.jsx(qA,{},c)),!i&&o.map((l,c)=>{const d=t.points>=l.next_cost,m=VA[l.icon]||Ue;return e.jsxs(vi,{index:c,className:F("group relative rounded-2xl border bg-card p-5 shadow-soft hover:bg-muted/40 transition-colors"),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-muted flex items-center justify-center shrink-0",children:e.jsx(m,{className:"w-6 h-6 text-muted-foreground"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h4",{className:"font-semibold text-sm sm:text-base text-foreground line-clamp-2",children:l.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Poziom ",l.current_level]})]})]}),e.jsx("span",{className:F("inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-[11px] font-semibold border",d?"border-primary/30 text-primary":"border-muted-foreground/25 text-muted-foreground"),children:d?"Dostępne":"Za drogie"})]}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-xs sm:text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Aktualny bonus"}),e.jsxs("span",{className:"font-medium text-green-600 dark:text-green-400",children:["+",e.jsx(We,{value:l.total_bonus})," pkt/h"]})]}),e.jsxs("div",{className:"flex justify-between text-xs sm:text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Następny poziom"}),e.jsxs("span",{className:"font-medium",children:["+",l.bonus_per_level," pkt/h"]})]})]}),e.jsxs(he.button,{whileHover:d?{scale:1.02}:{},whileTap:d?{scale:.98}:{},onClick:()=>a(l.id),disabled:!d,className:F("mt-4 w-full py-2.5 sm:py-3 rounded-lg font-medium focus-ring transition-colors",d?"bg-primary text-primary-foreground hover:bg-primary/90":"bg-muted text-muted-foreground cursor-not-allowed"),title:d?"Kup ulepszenie":"Brakuje punktów",children:["Ulepsz za ",e.jsx(We,{value:l.next_cost})," pkt"]})]},l.id)})]})]})]})},WA=[e.jsx(V,{path:"/gamification",element:e.jsx(KA,{})},"gamification")],GA=()=>e.jsx("div",{className:"rounded-2xl border bg-card p-4 shadow-soft animate-pulse",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-8 h-5 rounded bg-muted/60"}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-muted/70"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted/60"}),e.jsx("div",{className:"mt-2 h-3 w-28 rounded bg-muted/50"})]}),e.jsx("div",{className:"h-5 w-16 rounded bg-muted/60"})]})}),HA=()=>{const{data:t}=Le(),[s,n]=ee.useState("all"),{data:i,isLoading:r,refetch:a,error:o}=Dr("get_leaderboard",{p_limit:20,p_filter:s});ee.useEffect(()=>{let d=!1,m=!1;return(async()=>{if(!(d||m)){m=!0;try{await a()}finally{m=!1}}})(),()=>{d=!0}},[s]);const l=i||[],c=d=>{switch(d){case 1:return e.jsx(De,{className:"w-5 h-5 text-yellow-500"});case 2:return e.jsx(Wh,{className:"w-5 h-5 text-gray-400"});case 3:return e.jsx(Ns,{className:"w-5 h-5 text-orange-500"});default:return e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:d})}};return e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8 pb-24 lg:pb-8",children:[e.jsxs(he.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.45},className:"relative overflow-hidden rounded-2xl border",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/[0.12] via-secondary/[0.10] to-accent/[0.12]"}),e.jsx("div",{className:"absolute inset-0 opacity-[0.06]",style:{backgroundImage:`
                linear-gradient(to right, hsl(var(--ring)/0.35) 1px, transparent 1px),
                linear-gradient(to bottom, hsl(var(--ring)/0.35) 1px, transparent 1px)
              `,backgroundSize:"28px 28px"}})]}),e.jsx("div",{className:"relative z-10 p-4 sm:p-6 md:p-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Ranking"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Top 20 użytkowników według punktów."})]}),e.jsx("div",{className:"bg-muted rounded-lg p-1 inline-flex gap-1",children:[{value:"all",label:"Wszyscy"},{value:"students",label:"Uczniowie"},{value:"teachers",label:"Nauczyciele"}].map(d=>e.jsx("button",{onClick:()=>n(d.value),className:F("px-3 sm:px-4 py-1.5 rounded-md text-sm font-medium transition-colors",s===d.value?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:d.label},d.value))})]})})]}),e.jsxs(he.section,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.4,delay:.05},className:"space-y-2",children:[r&&Array.from({length:4}).map((d,m)=>e.jsx(GA,{},m)),!r&&(o||l.length===0)&&e.jsxs("div",{className:"rounded-2xl border bg-card p-8 text-center shadow-soft",children:[e.jsx("div",{className:"text-4xl",children:"🥲"}),e.jsx("h4",{className:"mt-3 text-base sm:text-lg font-semibold",children:"Brak wyników"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:o?"Nie udało się pobrać rankingu.":"Brak danych dla wybranego filtra."}),e.jsxs("button",{onClick:()=>a(),className:"mt-4 inline-flex items-center gap-2 rounded-lg border px-3 py-2 text-sm hover:bg-primary/5 focus-ring",children:[e.jsx(yb,{className:"w-4 h-4"}),"Spróbuj ponownie"]})]}),!r&&l.length>0&&l.map((d,m)=>{const u=d.user_id===t?.id,h=d.rank<=3;return e.jsxs(vi,{index:m,className:F("flex items-center gap-4 p-4 rounded-2xl border shadow-soft transition-colors",u?"bg-primary text-primary-foreground border-primary/40":h?"bg-muted/50 border-border":"bg-card hover:bg-muted/40 border-border"),children:[e.jsx("div",{className:"w-8 flex justify-center",children:c(d.rank)}),e.jsx("div",{className:F("w-10 h-10 rounded-full flex items-center justify-center font-semibold shrink-0",u?"bg-primary-foreground text-primary":h?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground"),"aria-label":`Avatar użytkownika ${d.full_name||"Użytkownik"}`,title:d.full_name||"Użytkownik",children:d.full_name?.charAt(0)??"U"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-medium truncate",children:[d.full_name||"Użytkownik",u&&e.jsx("span",{className:"ml-2 text-sm opacity-80",children:"(Ty)"})]}),e.jsxs("div",{className:F("text-sm",u?"text-primary-foreground/80":"text-muted-foreground"),children:["Poziom ",d.level," • Seria ",d.streak," dni"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-semibold tabular-nums",children:e.jsx(We,{value:d.points})}),e.jsx("div",{className:F("text-xs",u?"text-primary-foreground/80":"text-muted-foreground"),children:"punktów"})]})]},d.user_id||`${d.rank}-${m}`)})]})]})},ZA=[e.jsx(V,{path:"/leaderboard",element:e.jsx(HA,{})},"leaderboard")],Li=[{id:1,icon:Zt,title:"Pierwszy Krok",description:"Ukończ pierwszą lekcję",unlocked:!0,rarity:"common",unlockedAt:"2024-01-15",progress:100},{id:2,icon:gn,title:"Perfekcjonista",description:"Zdobądź 100% w 10 quizach",unlocked:!0,rarity:"rare",unlockedAt:"2024-02-20",progress:100},{id:3,icon:Ue,title:"Błyskawica",description:"Ukończ 5 lekcji w jeden dzień",unlocked:!1,rarity:"epic",progress:60},{id:4,icon:De,title:"Mistrz",description:"Osiągnij poziom 50",unlocked:!1,rarity:"legendary",progress:24},{id:5,icon:Ee,title:"Snajper",description:"Odpowiedz poprawnie na 100 pytań z rzędu",unlocked:!1,rarity:"epic",progress:45},{id:6,icon:rc,title:"Rakieta",description:"Ukończ kurs w mniej niż tydzień",unlocked:!1,rarity:"rare",progress:0}],ih={common:{bg:"bg-muted",ring:"ring-1 ring-border",label:"Pospolite",badge:"border border-muted-foreground/20 text-muted-foreground bg-background/60"},rare:{bg:"bg-blue-500/10",ring:"ring-1 ring-blue-500/30",label:"Rzadkie",badge:"border border-blue-500/30 text-blue-600 dark:text-blue-400"},epic:{bg:"bg-purple-500/10",ring:"ring-1 ring-purple-500/30",label:"Epiczne",badge:"border border-purple-500/30 text-purple-600 dark:text-purple-400"},legendary:{bg:"bg-orange-500/10",ring:"ring-1 ring-orange-500/30",label:"Legendarne",badge:"border border-orange-500/30 text-orange-600 dark:text-orange-400"}},QA=()=>{const t=Li.filter(i=>i.unlocked).length,s=Li.length,n=Math.round(t/s*100);return e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8 pb-24 lg:pb-8",children:[e.jsxs(he.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.45},className:"relative overflow-hidden rounded-2xl border",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/[0.12] via-secondary/[0.10] to-accent/[0.12]"}),e.jsx("div",{className:"absolute inset-0 opacity-[0.06]",style:{backgroundImage:`
                linear-gradient(to right, hsl(var(--ring)/0.35) 1px, transparent 1px),
                linear-gradient(to bottom, hsl(var(--ring)/0.35) 1px, transparent 1px)
              `,backgroundSize:"28px 28px"}})]}),e.jsxs("div",{className:"relative z-10 p-4 sm:p-6 md:p-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Osiągnięcia"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Odblokowano"," ",e.jsx("span",{className:"font-semibold tabular-nums",children:t})," ","z"," ",e.jsx("span",{className:"font-semibold tabular-nums",children:s})," ","(",n,"%)"]})]}),e.jsxs("div",{className:"w-full md:w-96",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-1.5",children:[e.jsx("span",{className:"text-muted-foreground",children:"Postęp osiągnięć"}),e.jsxs("span",{className:"font-medium tabular-nums",children:[n,"%"]})]}),e.jsx(bn,{value:n})]})]}),e.jsx("div",{className:"mt-4 grid grid-cols-2 sm:grid-cols-4 gap-2",children:Object.entries(ih).map(([i,r])=>{const a=Li.filter(l=>l.rarity===i&&l.unlocked).length,o=Li.filter(l=>l.rarity===i).length;return e.jsxs("div",{className:F("rounded-xl border bg-card/70 backdrop-blur-sm p-3 shadow-soft"),children:[e.jsxs("p",{className:"text-lg font-semibold tabular-nums",children:[a,"/",o]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.label})]},i)})})]})]}),e.jsx(he.section,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.4,delay:.05},className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-5",children:Li.map((i,r)=>{const a=ih[i.rarity],o=i.icon,l=i.unlocked?e.jsx("span",{className:F("inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-[11px] font-semibold",a.badge),children:"Odblokowane"}):e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-primary/30 text-primary px-2.5 py-1 text-[11px] font-semibold",children:[i.progress,"%"]});return e.jsxs(vi,{index:r,className:F("group relative rounded-2xl border bg-card p-5 shadow-soft hover:bg-muted/40 transition-colors",!i.unlocked&&"opacity-95"),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:F("w-12 h-12 rounded-xl flex items-center justify-center shrink-0",a.bg,a.ring),children:e.jsx(o,{className:"w-6 h-6"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm sm:text-base text-foreground line-clamp-2",children:i.title}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:i.description})]})]}),l]}),e.jsx("div",{className:"mt-4",children:i.unlocked?e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Odblokowano:"," ",e.jsx("span",{className:"font-medium",children:new Date(i.unlockedAt).toLocaleDateString("pl-PL")})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"Postęp"}),e.jsxs("span",{className:"font-medium tabular-nums",children:[i.progress,"%"]})]}),e.jsx(bn,{value:i.progress})]})})]},i.id)})})]})},YA=[e.jsx(V,{path:"/achievements",element:e.jsx(QA,{})},"achievements")],XA=()=>{const{data:t}=Le(),{stats:s}=_n(),n=t?.full_name||t?.name||t?.email||"Użytkownik",i=(t?.full_name||t?.name||"U").split(" ").map(o=>o[0]).slice(0,2).join("").toUpperCase()||"U",r=(()=>{const o=t?.created_at;return(o?new Date(o):new Date).toLocaleDateString("pl-PL")})(),a=[{icon:De,label:"Punkty",value:s.points,iconColor:"text-primary",highlight:"primary",counter:!0},{icon:Ee,label:"Ukończone quizy",value:s.quizzes_completed??0,iconColor:"text-green-600 dark:text-green-400",counter:!1},{icon:gn,label:"Perfekcyjne wyniki",value:s.perfect_scores??0,iconColor:"text-yellow-600 dark:text-yellow-400",counter:!1},{icon:Zt,label:"Najdłuższa seria",value:`${s.streak??0} dni`,iconColor:"text-destructive",counter:!1},{icon:Ve,label:"Czas nauki",value:`${Math.max(0,Math.floor((s.total_time??0)/60))}h`,iconColor:"text-blue-600 dark:text-blue-400",counter:!1},{icon:De,label:"Poziom",value:`Poziom ${s.level??1}`,iconColor:"text-secondary",counter:!1}];return e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8 pb-24 lg:pb-8",children:[e.jsxs(he.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.45},className:"relative overflow-hidden rounded-2xl border",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/[0.12] via-secondary/[0.10] to-accent/[0.12]"}),e.jsx("div",{className:"absolute inset-0 opacity-[0.06]",style:{backgroundImage:`
                linear-gradient(to right, hsl(var(--ring)/0.35) 1px, transparent 1px),
                linear-gradient(to bottom, hsl(var(--ring)/0.35) 1px, transparent 1px)
              `,backgroundSize:"28px 28px"}})]}),e.jsx("div",{className:"relative z-10 p-4 sm:p-6 md:p-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-6",children:[e.jsxs("div",{className:"flex items-start gap-4 sm:gap-6",children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 rounded-2xl bg-primary text-primary-foreground flex items-center justify-center text-xl sm:text-2xl font-semibold shadow-soft",children:i}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:n}),e.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-muted-foreground",children:[t?.email&&e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[e.jsx(Ea,{className:"w-4 h-4 shrink-0"}),e.jsx("span",{className:"truncate",children:t.email})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(vs,{className:"w-4 h-4"}),e.jsxs("span",{children:["Dołączył ",r]})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("button",{className:"inline-flex items-center gap-2 rounded-lg border px-3 py-2 text-sm hover:bg-primary/5 focus-ring",children:[e.jsx(bb,{className:"w-4 h-4"}),"Edytuj profil"]}),e.jsx("button",{className:"inline-flex items-center gap-2 rounded-lg bg-primary px-3 py-2 text-sm text-primary-foreground hover:bg-primary/90 focus-ring",children:"Ustawienia"})]})]})})]}),e.jsxs(he.section,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.4,delay:.05},children:[e.jsx("h2",{className:"text-lg sm:text-xl md:text-2xl font-semibold tracking-tight mb-4",children:"Statystyki"}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-5",children:a.map((o,l)=>{const c=o.icon;return e.jsx(vi,{index:l,className:"group relative rounded-2xl border bg-card p-5 shadow-soft hover:bg-muted/40 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-muted flex items-center justify-center shrink-0",children:e.jsx(c,{className:`w-6 h-6 ${o.iconColor}`})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:`text-2xl font-semibold leading-none tabular-nums ${o.highlight==="primary"?"text-primary":o.highlight==="secondary"?"text-secondary":o.highlight==="accent"?"text-accent":"text-foreground"}`,children:o.counter?e.jsx(We,{value:Number(o.value)}):o.value}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:o.label})]})]})},o.label)})})]}),e.jsxs(he.section,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.4,delay:.08},className:"space-y-4",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold tracking-tight",children:"Ustawienia"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:flex-wrap gap-3",children:[e.jsx(he.button,{whileHover:{x:2},whileTap:{scale:.98},className:"w-full sm:w-auto sm:min-w-[220px] inline-flex items-center justify-center rounded-xl bg-primary text-primary-foreground px-4 py-3 shadow-soft hover:bg-primary/90 focus-ring",children:e.jsxs("span",{className:"inline-flex items-center gap-2 font-medium",children:[e.jsx(un,{className:"w-4 h-4"}),"Zmień hasło"]})}),e.jsx(he.button,{whileHover:{x:2},whileTap:{scale:.98},className:"w-full sm:w-auto sm:min-w-[220px] inline-flex items-center justify-center rounded-xl bg-secondary text-white px-4 py-3 shadow-soft hover:opacity-95 focus-ring",children:e.jsxs("span",{className:"inline-flex items-center gap-2 font-medium",children:[e.jsx(Gh,{className:"w-4 h-4"}),"Ustawienia powiadomień"]})}),e.jsx(he.button,{whileHover:{x:2},whileTap:{scale:.98},className:"w-full sm:w-auto sm:min-w-[220px] inline-flex items-center justify-center rounded-xl bg-destructive text-white px-4 py-3 shadow-soft hover:bg-destructive/90 focus-ring",children:e.jsxs("span",{className:"inline-flex items-center gap-2 font-medium",children:[e.jsx(ns,{className:"w-4 h-4"}),"Usuń konto"]})})]})]})]})},JA=[e.jsx(V,{path:"/profile",element:e.jsx(XA,{})},"profile")],eD=[...fT,...xT,...bT,...$A,...UA,...WA,...ZA,...YA,...JA],tD=()=>e.jsx(Pa,{children:e.jsxs(V,{element:e.jsx(_S,{children:e.jsx(Yl,{})}),children:[e.jsx(V,{index:!0,element:e.jsx($t,{to:"dashboard",replace:!0})}),eD]})}),sD=g.lazy(()=>Promise.resolve({default:tD})),Ej=({text:t,colorClass:s})=>e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-background",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`inline-block h-12 w-12 animate-spin rounded-full border-4 border-current border-r-transparent ${s}`}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:t})]})}),nD=({children:t})=>{const{data:s,isLoading:n}=Le();return n||!s?e.jsx(Ej,{text:"Sprawdzanie uprawnień...",colorClass:"border-blue-600"}):s.role!=="student"?e.jsx($t,{to:"/teacher/dashboard/overview",replace:!0}):e.jsx(e.Fragment,{children:t})},iD=e.jsx(V,{path:"/student/*",element:e.jsx(tc,{fallback:e.jsx(sc,{to:"/login"}),children:e.jsx(nD,{children:e.jsx(g.Suspense,{fallback:e.jsx(Ej,{text:"Ładowanie panelu ucznia...",colorClass:"border-blue-600"}),children:e.jsx(sD,{})})})},"student-auth")}),rD=_o.includes(Gd)?_o:[{name:"dashboard",list:"/admin/dashboard/overview",meta:{label:"Dashboard",icon:e.jsx(wb,{className:"h-4 w-4"})}},Gd,..._o],aD={name:"dashboard",list:"/teacher/dashboard/overview",meta:{label:"Zasoby edukacyjne",icon:e.jsx(Se,{className:"h-4 w-4"})}},oD={name:"ai-tools",list:"/teacher/ai-tools",meta:{label:"Narzędzia AI",icon:e.jsx(Ct,{className:"h-4 w-4"})}},lD=[aD,{...uu,meta:{...uu.meta,parent:"dashboard",label:"Kursy"}},{...mu,meta:{...mu.meta,parent:"dashboard",label:"Tematy"}},{...bu,meta:{...bu.meta,parent:"dashboard",hide:!0}},{...wu,meta:{...wu.meta,parent:"dashboard",label:"Grupy"}},oD,{...Au,list:"/teacher/course-structure",meta:{...Au.meta,parent:"ai-tools"}},Vz,Xz,{...Nu,meta:{...Nu.meta,parent:"reports"}},{...ku,meta:{...ku.meta,parent:"reports"}},{...zu,meta:{...zu.meta,parent:"reports"}},{...Su,meta:{...Su.meta,parent:"reports"}},{...Cu,meta:{...Cu.meta,parent:"reports"}}],cD={name:"student-root",meta:{label:"Panel ucznia",route:"/student/dashboard/overview"}},dD=[cD],uD=()=>{const t=me(),[s,n]=g.useState(0),[i,r]=g.useState("");g.useEffect(()=>{const o=()=>n(window.scrollY);return window.addEventListener("scroll",o),()=>window.removeEventListener("scroll",o)},[]);const a=[{name:"Sty",value:65},{name:"Lut",value:72},{name:"Mar",value:78},{name:"Kwi",value:85},{name:"Maj",value:88},{name:"Cze",value:94}];return e.jsxs("div",{className:"min-h-screen bg-white text-foreground",children:[e.jsx("nav",{className:"fixed top-0 w-full z-50 bg-white/80 backdrop-blur-xl border-b border-gray-100",children:e.jsx("div",{className:"container mx-auto px-6 py-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-pink-600 to-purple-700 rounded-xl flex items-center justify-center",children:e.jsx(De,{className:"w-5 h-5 text-white"})}),e.jsx("span",{className:"text-xl font-bold",children:"Smart Up"})]}),e.jsxs("div",{className:"hidden md:flex items-center gap-8",children:[e.jsx("a",{href:"#funkcje",className:"text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors",children:"Funkcje"}),e.jsx("a",{href:"#kursy",className:"text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors",children:"Kursy"}),e.jsx("a",{href:"#firma",className:"text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors",children:"Dla firm"}),e.jsx("a",{href:"#cennik",className:"text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors",children:"Cennik"}),e.jsx(I,{className:"bg-gray-900 hover:bg-gray-800 text-white text-sm px-6",onClick:()=>t("/login"),children:"Rozpocznij"})]})]})})}),e.jsx("section",{className:"pt-32 pb-20 overflow-hidden",children:e.jsx("div",{className:"container mx-auto px-6",children:e.jsxs("div",{className:"grid lg:grid-cols-12 gap-8 items-center",children:[e.jsxs("div",{className:"lg:col-span-5",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-purple-50 rounded-full mb-8",children:[e.jsx(Ue,{className:"w-4 h-4 text-purple-700"}),e.jsx("span",{className:"text-sm font-medium text-purple-700",children:"Gamifikacja w edukacji"})]}),e.jsxs("h1",{className:"text-5xl md:text-6xl font-bold leading-tight mb-6",children:["Nauka, która",e.jsx("span",{className:"block text-transparent bg-clip-text bg-gradient-to-r from-pink-600 to-purple-700",children:"motywuje"})]}),e.jsx("p",{className:"text-lg text-gray-600 mb-8 leading-relaxed",children:"Przekształć edukację w angażującą przygodę. System poziomów, punktów i nagród sprawia, że nauka staje się uzależniająca."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-12",children:[e.jsxs(I,{size:"lg",className:"bg-gray-900 hover:bg-gray-800 text-white px-8",onClick:()=>t("/login"),children:["Zacznij za darmo",e.jsx(Fe,{className:"ml-2 h-4 w-4"})]}),e.jsx(I,{size:"lg",variant:"outline",className:"border-gray-300",children:"Zobacz demo"})]}),e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:"15k+"}),e.jsx("div",{className:"text-sm text-gray-500",children:"aktywnych uczniów"})]}),e.jsx("div",{className:"w-px h-12 bg-gray-200"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:"92%"}),e.jsx("div",{className:"text-sm text-gray-500",children:"ukończalność"})]}),e.jsx("div",{className:"w-px h-12 bg-gray-200"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:"4.9"}),e.jsx("div",{className:"text-sm text-gray-500",children:"ocena"})]})]})]}),e.jsx("div",{className:"lg:col-span-7",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -inset-4 bg-gradient-to-r from-pink-600/5 to-purple-700/5 rounded-3xl blur-2xl"}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-6 py-4 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-pink-600 to-purple-700 rounded-lg flex items-center justify-center",children:e.jsx(De,{className:"w-4 h-4 text-white"})}),e.jsx("span",{className:"font-semibold",children:"Dashboard ucznia"})]}),e.jsx(q,{className:"bg-green-50 text-green-700 border-green-200",children:"Online"})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-pink-50 to-pink-100 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ld,{className:"w-5 h-5 text-pink-600"}),e.jsx("span",{className:"text-xs text-gray-500",children:"+125"})]}),e.jsx("div",{className:"text-2xl font-bold",children:"1,842"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Punkty XP"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ee,{className:"w-5 h-5 text-purple-700"}),e.jsx("span",{className:"text-xs text-gray-500",children:"75%"})]}),e.jsx("div",{className:"text-2xl font-bold",children:"Lvl 12"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Poziom"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-teal-50 to-teal-100 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ns,{className:"w-5 h-5 text-teal-600"}),e.jsx("span",{className:"text-xs text-gray-500",children:"New!"})]}),e.jsx("div",{className:"text-2xl font-bold",children:"24"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Odznaki"})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("span",{className:"text-sm font-medium",children:"Postęp nauki"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ostatnie 6 miesięcy"})]}),e.jsx(Ae,{width:"100%",height:120,children:e.jsxs(Va,{data:a,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorProgress",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#db2777",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#db2777",stopOpacity:0})]})}),e.jsx(Vs,{type:"monotone",dataKey:"value",stroke:"#db2777",strokeWidth:2,fill:"url(#colorProgress)"}),e.jsx(ct,{dataKey:"name",axisLine:!1,tickLine:!1,tick:{fontSize:11}}),e.jsx(nt,{hide:!0})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Aktywne kursy"}),e.jsx("a",{href:"#",className:"text-purple-700 hover:underline",children:"Zobacz wszystkie"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-pink-600 to-purple-700 rounded-lg flex items-center justify-center",children:e.jsx(cl,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:"JavaScript: Gra w kodowanie"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Rozdział 4 z 12"})]})]}),e.jsx(jt,{className:"w-4 h-4 text-gray-400"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-teal-500 to-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(ii,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:"Analiza danych: Quest"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Rozdział 7 z 10"})]})]}),e.jsx(jt,{className:"w-4 h-4 text-gray-400"})]})]})]})]})]})]})})]})})}),e.jsx("section",{id:"funkcje",className:"py-20 bg-gray-50",children:e.jsxs("div",{className:"container mx-auto px-6",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsxs("h2",{className:"text-4xl font-bold mb-4",children:["Funkcje, które"," ",e.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-pink-600 to-purple-700",children:"angażują"})]}),e.jsx("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto",children:"System zaprojektowany, aby uczynić naukę uzależniającą jak najlepsza gra"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-pink-600/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-pink-600 to-purple-700 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(De,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-3",children:"System poziomów"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"99 poziomów do zdobycia. Każdy poziom odblokowuje nowe możliwości i nagrody."}),e.jsxs("div",{className:"flex items-center text-sm text-pink-600 font-medium",children:["Dowiedz się więcej",e.jsx(Fe,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]}),e.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-700/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-purple-700 to-teal-500 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(Ld,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-3",children:"Idle Points"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Zdobywaj punkty nawet gdy nie uczysz się aktywnie. System pasywnego rozwoju."}),e.jsxs("div",{className:"flex items-center text-sm text-purple-700 font-medium",children:["Dowiedz się więcej",e.jsx(Fe,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]}),e.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-teal-500/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-teal-500 to-blue-600 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(Ee,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-3",children:"Wyzwania"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Codzienne i tygodniowe wyzwania z dodatkowymi nagrodami za ukończenie."}),e.jsxs("div",{className:"flex items-center text-sm text-teal-600 font-medium",children:["Dowiedz się więcej",e.jsx(Fe,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]}),e.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-orange-500/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-orange-500 to-yellow-500 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(oe,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-3",children:"Rankingi"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Rywalizuj z innymi uczniami. Rankingi globalne, lokalne i grupowe."}),e.jsxs("div",{className:"flex items-center text-sm text-orange-600 font-medium",children:["Dowiedz się więcej",e.jsx(Fe,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]}),e.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-700/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-purple-700 to-pink-600 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(Ns,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-3",children:"Odznaki"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Kolekcjonuj unikalne odznaki za osiągnięcia i kamienie milowe."}),e.jsxs("div",{className:"flex items-center text-sm text-purple-700 font-medium",children:["Dowiedz się więcej",e.jsx(Fe,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]}),e.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-teal-500/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-teal-500 to-purple-700 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(ii,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-3",children:"Analityka"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Szczegółowe statystyki postępów i personalizowane rekomendacje."}),e.jsxs("div",{className:"flex items-center text-sm text-teal-600 font-medium",children:["Dowiedz się więcej",e.jsx(Fe,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]})]})]})}),e.jsx("section",{className:"py-20 bg-white",children:e.jsxs("div",{className:"container mx-auto px-6",children:[e.jsxs("div",{className:"max-w-3xl mx-auto text-center mb-16",children:[e.jsxs("h2",{className:"text-4xl font-bold mb-4",children:["Jak to"," ",e.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-pink-600 to-purple-700",children:"działa"})]}),e.jsx("p",{className:"text-lg text-gray-600",children:"Cztery proste kroki do rozpoczęcia nauki z gamifikacją"})]}),e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-1/2 transform -translate-x-1/2 top-0 bottom-0 w-0.5 bg-gray-200"}),e.jsx("div",{className:"space-y-12",children:[{number:"01",title:"Stwórz profil",description:"Wybierz swoją rolę i spersonalizuj doświadczenie nauki",icon:oe,color:"from-pink-600 to-purple-700"},{number:"02",title:"Wybierz kursy",description:"Przeglądaj bibliotekę kursów i wybierz te, które Cię interesują",icon:ni,color:"from-purple-700 to-teal-500"},{number:"03",title:"Ucz się i graj",description:"Rozwiązuj quizy, zdobywaj punkty i awansuj na kolejne poziomy",icon:cl,color:"from-teal-500 to-blue-600"},{number:"04",title:"Śledź postępy",description:"Monitoruj swoje osiągnięcia i rywalizuj z innymi",icon:st,color:"from-orange-500 to-yellow-500"}].map((o,l)=>e.jsx("div",{className:"relative",children:e.jsxs("div",{className:`flex items-center ${l%2===0?"flex-row":"flex-row-reverse"}`,children:[e.jsxs("div",{className:`w-5/12 ${l%2===0?"text-right pr-8":"text-left pl-8"}`,children:[e.jsxs("div",{className:`inline-flex items-center gap-4 mb-2 ${l%2===0?"flex-row-reverse":""}`,children:[e.jsx("h3",{className:"text-2xl font-bold",children:o.title}),e.jsx("span",{className:"text-4xl font-bold text-gray-200",children:o.number})]}),e.jsx("p",{className:"text-gray-600 text-lg",children:o.description})]}),e.jsx("div",{className:"w-2/12 flex justify-center",children:e.jsx("div",{className:`relative z-10 w-16 h-16 bg-gradient-to-br ${o.color} rounded-2xl flex items-center justify-center shadow-lg`,children:e.jsx(o.icon,{className:"w-8 h-8 text-white"})})}),e.jsx("div",{className:"w-5/12"})]})},l))})]})})]})}),e.jsx("section",{className:"py-20 bg-gradient-to-br from-gray-900 to-gray-800",children:e.jsx("div",{className:"container mx-auto px-6",children:e.jsx("div",{className:"grid md:grid-cols-4 gap-8",children:[{value:"15k+",label:"Aktywnych uczniów",icon:oe},{value:"200+",label:"Kursów",icon:ni},{value:"92%",label:"Ukończalność",icon:Ee},{value:"4.9/5",label:"Ocena",icon:gn}].map((o,l)=>e.jsxs("div",{className:"text-center",children:[e.jsx(o.icon,{className:"w-8 h-8 mx-auto mb-4 text-white/60"}),e.jsx("div",{className:"text-4xl font-bold text-white mb-2",children:o.value}),e.jsx("div",{className:"text-sm text-white/60",children:o.label})]},l))})})}),e.jsx("section",{className:"py-20 bg-white",children:e.jsx("div",{className:"container mx-auto px-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[e.jsxs("h2",{className:"text-4xl font-bold mb-6",children:["Gotowy na naukę, która"," ",e.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-pink-600 to-purple-700",children:"wciąga"}),"?"]}),e.jsx("p",{className:"text-lg text-gray-600 mb-8 max-w-2xl mx-auto",children:"Dołącz do tysięcy uczniów, którzy odkryli radość z nauki dzięki gamifikacji. Pierwsze 30 dni gratis."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center mb-8",children:[e.jsx(J,{type:"email",placeholder:"twoj@email.pl",value:i,onChange:o=>r(o.target.value),className:"max-w-xs h-12"}),e.jsxs(I,{size:"lg",className:"bg-gradient-to-r from-pink-600 to-purple-700 hover:opacity-90 text-white px-8 h-12",onClick:()=>t("/login"),children:["Rozpocznij za darmo",e.jsx(Fe,{className:"ml-2 h-4 w-4"})]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Bez karty kredytowej • Anuluj w każdej chwili • Pełny dostęp"})]})})}),e.jsx("footer",{className:"bg-gray-900 text-white py-12",children:e.jsx("div",{className:"container mx-auto px-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-white/10 rounded-lg flex items-center justify-center",children:e.jsx(De,{className:"w-4 h-4"})}),e.jsx("span",{className:"text-lg font-bold",children:"Smart Up"})]}),e.jsx("div",{className:"text-sm text-white/60",children:"© 2025 Smart Up. Wszystkie prawa zastrzeżone."})]})})})]})},mD=new Vy({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:!1,staleTime:300*1e3}}});function hD({children:t}){const{pathname:s}=hi(),n=s.split("/")[1],i=n==="admin"?rD:n==="teacher"?lD:n==="student"?dD:[];return e.jsx(Ky,{dataProvider:Hy(Q),authProvider:qb,routerProvider:Wy,resources:i,options:{syncWithLocation:!0,warnWhenUnsavedChanges:!1,useNewQueryKeys:!0,disableTelemetry:!0},children:t})}function fD(){return e.jsx(qy,{client:mD,children:e.jsx(My,{children:e.jsx(hD,{children:e.jsxs(Pa,{children:[e.jsx(V,{path:"/",element:e.jsx(uD,{})}),sf,Zb,Xb,tw,Qw,NS,iD,e.jsx(V,{path:"*",element:e.jsx($t,{to:"/",replace:!0})})]})})})})}const pD=document.getElementById("root"),xD=Ib.createRoot(pD);xD.render(e.jsxs(ee.StrictMode,{children:[e.jsx(fD,{}),e.jsx(By,{position:"top-right",richColors:!0,closeButton:!0,duration:4e3,toastOptions:{style:{width:"500px",fontSize:"20px"},className:"sonner-toast"}})]}));export{$s as A,I as B,M as C,Qs as F,J as I,ke as L,Fs as a,$ as b,O as c,lc as d,R as e,se as f,Ys as g,nr as h,ef as i,Xh as l,Jh as r,Q as s,tf as u};
